"use strict";var mvsStories=(()=>{var $Be=Object.create;var f3=Object.defineProperty;var eEe=Object.getOwnPropertyDescriptor;var tEe=Object.getOwnPropertyNames;var rEe=Object.getPrototypeOf,nEe=Object.prototype.hasOwnProperty;var ju=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),Gi=(e,t)=>{for(var r in t)f3(e,r,{get:t[r],enumerable:!0})},dJ=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of tEe(t))!nEe.call(e,o)&&o!==r&&f3(e,o,{get:()=>t[o],enumerable:!(n=eEe(t,o))||n.enumerable});return e};var _t=(e,t,r)=>(r=e!=null?$Be(rEe(e)):{},dJ(t||!e||!e.__esModule?f3(r,"default",{value:e,enumerable:!0}):r,e)),oEe=e=>dJ(f3({},"__esModule",{value:!0}),e);var l$=ju(Ro=>{"use strict";var UP=Symbol.for("react.element"),TEe=Symbol.for("react.portal"),PEe=Symbol.for("react.fragment"),_Ee=Symbol.for("react.strict_mode"),REe=Symbol.for("react.profiler"),DEe=Symbol.for("react.provider"),wEe=Symbol.for("react.context"),MEe=Symbol.for("react.forward_ref"),BEe=Symbol.for("react.suspense"),EEe=Symbol.for("react.memo"),kEe=Symbol.for("react.lazy"),KJ=Symbol.iterator;function FEe(e){return e===null||typeof e!="object"?null:(e=KJ&&e[KJ]||e["@@iterator"],typeof e=="function"?e:null)}var e$={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},t$=Object.assign,r$={};function ov(e,t,r){this.props=e,this.context=t,this.refs=r$,this.updater=r||e$}ov.prototype.isReactComponent={};ov.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};ov.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function n$(){}n$.prototype=ov.prototype;function sU(e,t,r){this.props=e,this.context=t,this.refs=r$,this.updater=r||e$}var lU=sU.prototype=new n$;lU.constructor=sU;t$(lU,ov.prototype);lU.isPureReactComponent=!0;var JJ=Array.isArray,o$=Object.prototype.hasOwnProperty,uU={current:null},i$={key:!0,ref:!0,__self:!0,__source:!0};function a$(e,t,r){var n,o={},i=null,a=null;if(t!=null)for(n in t.ref!==void 0&&(a=t.ref),t.key!==void 0&&(i=""+t.key),t)o$.call(t,n)&&!i$.hasOwnProperty(n)&&(o[n]=t[n]);var s=arguments.length-2;if(s===1)o.children=r;else if(1<s){for(var l=Array(s),u=0;u<s;u++)l[u]=arguments[u+2];o.children=l}if(e&&e.defaultProps)for(n in s=e.defaultProps,s)o[n]===void 0&&(o[n]=s[n]);return{$$typeof:UP,type:e,key:i,ref:a,props:o,_owner:uU.current}}function LEe(e,t){return{$$typeof:UP,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function cU(e){return typeof e=="object"&&e!==null&&e.$$typeof===UP}function VEe(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(r){return t[r]})}var $J=/\/+/g;function aU(e,t){return typeof e=="object"&&e!==null&&e.key!=null?VEe(""+e.key):t.toString(36)}function G3(e,t,r,n,o){var i=typeof e;(i==="undefined"||i==="boolean")&&(e=null);var a=!1;if(e===null)a=!0;else switch(i){case"string":case"number":a=!0;break;case"object":switch(e.$$typeof){case UP:case TEe:a=!0}}if(a)return a=e,o=o(a),e=n===""?"."+aU(a,0):n,JJ(o)?(r="",e!=null&&(r=e.replace($J,"$&/")+"/"),G3(o,t,r,"",function(u){return u})):o!=null&&(cU(o)&&(o=LEe(o,r+(!o.key||a&&a.key===o.key?"":(""+o.key).replace($J,"$&/")+"/")+e)),t.push(o)),1;if(a=0,n=n===""?".":n+":",JJ(e))for(var s=0;s<e.length;s++){i=e[s];var l=n+aU(i,s);a+=G3(i,t,r,l,o)}else if(l=FEe(e),typeof l=="function")for(e=l.call(e),s=0;!(i=e.next()).done;)i=i.value,l=n+aU(i,s++),a+=G3(i,t,r,l,o);else if(i==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return a}function O3(e,t,r){if(e==null)return e;var n=[],o=0;return G3(e,n,"","",function(i){return t.call(r,i,o++)}),n}function OEe(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(r){(e._status===0||e._status===-1)&&(e._status=1,e._result=r)},function(r){(e._status===0||e._status===-1)&&(e._status=2,e._result=r)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var _c={current:null},U3={transition:null},GEe={ReactCurrentDispatcher:_c,ReactCurrentBatchConfig:U3,ReactCurrentOwner:uU};function s$(){throw Error("act(...) is not supported in production builds of React.")}Ro.Children={map:O3,forEach:function(e,t,r){O3(e,function(){t.apply(this,arguments)},r)},count:function(e){var t=0;return O3(e,function(){t++}),t},toArray:function(e){return O3(e,function(t){return t})||[]},only:function(e){if(!cU(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};Ro.Component=ov;Ro.Fragment=PEe;Ro.Profiler=REe;Ro.PureComponent=sU;Ro.StrictMode=_Ee;Ro.Suspense=BEe;Ro.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=GEe;Ro.act=s$;Ro.cloneElement=function(e,t,r){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var n=t$({},e.props),o=e.key,i=e.ref,a=e._owner;if(t!=null){if(t.ref!==void 0&&(i=t.ref,a=uU.current),t.key!==void 0&&(o=""+t.key),e.type&&e.type.defaultProps)var s=e.type.defaultProps;for(l in t)o$.call(t,l)&&!i$.hasOwnProperty(l)&&(n[l]=t[l]===void 0&&s!==void 0?s[l]:t[l])}var l=arguments.length-2;if(l===1)n.children=r;else if(1<l){s=Array(l);for(var u=0;u<l;u++)s[u]=arguments[u+2];n.children=s}return{$$typeof:UP,type:e.type,key:o,ref:i,props:n,_owner:a}};Ro.createContext=function(e){return e={$$typeof:wEe,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:DEe,_context:e},e.Consumer=e};Ro.createElement=a$;Ro.createFactory=function(e){var t=a$.bind(null,e);return t.type=e,t};Ro.createRef=function(){return{current:null}};Ro.forwardRef=function(e){return{$$typeof:MEe,render:e}};Ro.isValidElement=cU;Ro.lazy=function(e){return{$$typeof:kEe,_payload:{_status:-1,_result:e},_init:OEe}};Ro.memo=function(e,t){return{$$typeof:EEe,type:e,compare:t===void 0?null:t}};Ro.startTransition=function(e){var t=U3.transition;U3.transition={};try{e()}finally{U3.transition=t}};Ro.unstable_act=s$;Ro.useCallback=function(e,t){return _c.current.useCallback(e,t)};Ro.useContext=function(e){return _c.current.useContext(e)};Ro.useDebugValue=function(){};Ro.useDeferredValue=function(e){return _c.current.useDeferredValue(e)};Ro.useEffect=function(e,t){return _c.current.useEffect(e,t)};Ro.useId=function(){return _c.current.useId()};Ro.useImperativeHandle=function(e,t,r){return _c.current.useImperativeHandle(e,t,r)};Ro.useInsertionEffect=function(e,t){return _c.current.useInsertionEffect(e,t)};Ro.useLayoutEffect=function(e,t){return _c.current.useLayoutEffect(e,t)};Ro.useMemo=function(e,t){return _c.current.useMemo(e,t)};Ro.useReducer=function(e,t,r){return _c.current.useReducer(e,t,r)};Ro.useRef=function(e){return _c.current.useRef(e)};Ro.useState=function(e){return _c.current.useState(e)};Ro.useSyncExternalStore=function(e,t,r){return _c.current.useSyncExternalStore(e,t,r)};Ro.useTransition=function(){return _c.current.useTransition()};Ro.version="18.3.1"});var Mi=ju(($At,u$)=>{"use strict";u$.exports=l$()});var x$=ju(sa=>{"use strict";function fU(e,t){var r=e.length;e.push(t);e:for(;0<r;){var n=r-1>>>1,o=e[n];if(0<N3(o,t))e[n]=t,e[r]=o,r=n;else break e}}function vf(e){return e.length===0?null:e[0]}function H3(e){if(e.length===0)return null;var t=e[0],r=e.pop();if(r!==t){e[0]=r;e:for(var n=0,o=e.length,i=o>>>1;n<i;){var a=2*(n+1)-1,s=e[a],l=a+1,u=e[l];if(0>N3(s,r))l<o&&0>N3(u,s)?(e[n]=u,e[l]=r,n=l):(e[n]=s,e[a]=r,n=a);else if(l<o&&0>N3(u,r))e[n]=u,e[l]=r,n=l;else break e}}return t}function N3(e,t){var r=e.sortIndex-t.sortIndex;return r!==0?r:e.id-t.id}typeof performance=="object"&&typeof performance.now=="function"?(c$=performance,sa.unstable_now=function(){return c$.now()}):(mU=Date,m$=mU.now(),sa.unstable_now=function(){return mU.now()-m$});var c$,mU,m$,wh=[],rx=[],HEe=1,$d=null,Zu=3,j3=!1,M0=!1,zP=!1,f$=typeof setTimeout=="function"?setTimeout:null,h$=typeof clearTimeout=="function"?clearTimeout:null,d$=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function hU(e){for(var t=vf(rx);t!==null;){if(t.callback===null)H3(rx);else if(t.startTime<=e)H3(rx),t.sortIndex=t.expirationTime,fU(wh,t);else break;t=vf(rx)}}function gU(e){if(zP=!1,hU(e),!M0)if(vf(wh)!==null)M0=!0,bU(yU);else{var t=vf(rx);t!==null&&xU(gU,t.startTime-e)}}function yU(e,t){M0=!1,zP&&(zP=!1,h$(HP),HP=-1),j3=!0;var r=Zu;try{for(hU(t),$d=vf(wh);$d!==null&&(!($d.expirationTime>t)||e&&!b$());){var n=$d.callback;if(typeof n=="function"){$d.callback=null,Zu=$d.priorityLevel;var o=n($d.expirationTime<=t);t=sa.unstable_now(),typeof o=="function"?$d.callback=o:$d===vf(wh)&&H3(wh),hU(t)}else H3(wh);$d=vf(wh)}if($d!==null)var i=!0;else{var a=vf(rx);a!==null&&xU(gU,a.startTime-t),i=!1}return i}finally{$d=null,Zu=r,j3=!1}}var W3=!1,z3=null,HP=-1,g$=5,y$=-1;function b$(){return!(sa.unstable_now()-y$<g$)}function dU(){if(z3!==null){var e=sa.unstable_now();y$=e;var t=!0;try{t=z3(!0,e)}finally{t?NP():(W3=!1,z3=null)}}else W3=!1}var NP;typeof d$=="function"?NP=function(){d$(dU)}:typeof MessageChannel<"u"?(pU=new MessageChannel,p$=pU.port2,pU.port1.onmessage=dU,NP=function(){p$.postMessage(null)}):NP=function(){f$(dU,0)};var pU,p$;function bU(e){z3=e,W3||(W3=!0,NP())}function xU(e,t){HP=f$(function(){e(sa.unstable_now())},t)}sa.unstable_IdlePriority=5;sa.unstable_ImmediatePriority=1;sa.unstable_LowPriority=4;sa.unstable_NormalPriority=3;sa.unstable_Profiling=null;sa.unstable_UserBlockingPriority=2;sa.unstable_cancelCallback=function(e){e.callback=null};sa.unstable_continueExecution=function(){M0||j3||(M0=!0,bU(yU))};sa.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):g$=0<e?Math.floor(1e3/e):5};sa.unstable_getCurrentPriorityLevel=function(){return Zu};sa.unstable_getFirstCallbackNode=function(){return vf(wh)};sa.unstable_next=function(e){switch(Zu){case 1:case 2:case 3:var t=3;break;default:t=Zu}var r=Zu;Zu=t;try{return e()}finally{Zu=r}};sa.unstable_pauseExecution=function(){};sa.unstable_requestPaint=function(){};sa.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var r=Zu;Zu=e;try{return t()}finally{Zu=r}};sa.unstable_scheduleCallback=function(e,t,r){var n=sa.unstable_now();switch(typeof r=="object"&&r!==null?(r=r.delay,r=typeof r=="number"&&0<r?n+r:n):r=n,e){case 1:var o=-1;break;case 2:o=250;break;case 5:o=1073741823;break;case 4:o=1e4;break;default:o=5e3}return o=r+o,e={id:HEe++,callback:t,priorityLevel:e,startTime:r,expirationTime:o,sortIndex:-1},r>n?(e.sortIndex=r,fU(rx,e),vf(wh)===null&&e===vf(rx)&&(zP?(h$(HP),HP=-1):zP=!0,xU(gU,r-n))):(e.sortIndex=o,fU(wh,e),M0||j3||(M0=!0,bU(yU))),e};sa.unstable_shouldYield=b$;sa.unstable_wrapCallback=function(e){var t=Zu;return function(){var r=Zu;Zu=t;try{return e.apply(this,arguments)}finally{Zu=r}}}});var S$=ju((nTt,C$)=>{"use strict";C$.exports=x$()});var Tre=ju(ld=>{"use strict";var jEe=Mi(),ad=S$();function er(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,r=1;r<arguments.length;r++)t+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Ree=new Set,m2={};function j0(e,t){Tv(e,t),Tv(e+"Capture",t)}function Tv(e,t){for(m2[e]=t,e=0;e<t.length;e++)Ree.add(t[e])}var Ty=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),zU=Object.prototype.hasOwnProperty,WEe=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,v$={},I$={};function XEe(e){return zU.call(I$,e)?!0:zU.call(v$,e)?!1:WEe.test(e)?I$[e]=!0:(v$[e]=!0,!1)}function QEe(e,t,r,n){if(r!==null&&r.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return n?!1:r!==null?!r.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function ZEe(e,t,r,n){if(t===null||typeof t>"u"||QEe(e,t,r,n))return!0;if(n)return!1;if(r!==null)switch(r.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function wc(e,t,r,n,o,i,a){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=n,this.attributeNamespace=o,this.mustUseProperty=r,this.propertyName=e,this.type=t,this.sanitizeURL=i,this.removeEmptyString=a}var Ru={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){Ru[e]=new wc(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];Ru[t]=new wc(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){Ru[e]=new wc(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){Ru[e]=new wc(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){Ru[e]=new wc(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){Ru[e]=new wc(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){Ru[e]=new wc(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){Ru[e]=new wc(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){Ru[e]=new wc(e,5,!1,e.toLowerCase(),null,!1,!1)});var kN=/[\-:]([a-z])/g;function FN(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(kN,FN);Ru[t]=new wc(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(kN,FN);Ru[t]=new wc(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(kN,FN);Ru[t]=new wc(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){Ru[e]=new wc(e,1,!1,e.toLowerCase(),null,!1,!1)});Ru.xlinkHref=new wc("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){Ru[e]=new wc(e,1,!1,e.toLowerCase(),null,!0,!0)});function LN(e,t,r,n){var o=Ru.hasOwnProperty(t)?Ru[t]:null;(o!==null?o.type!==0:n||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(ZEe(t,r,o,n)&&(r=null),n||o===null?XEe(t)&&(r===null?e.removeAttribute(t):e.setAttribute(t,""+r)):o.mustUseProperty?e[o.propertyName]=r===null?o.type===3?!1:"":r:(t=o.attributeName,n=o.attributeNamespace,r===null?e.removeAttribute(t):(o=o.type,r=o===3||o===4&&r===!0?"":""+r,n?e.setAttributeNS(n,t,r):e.setAttribute(t,r))))}var Dy=jEe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,X3=Symbol.for("react.element"),sv=Symbol.for("react.portal"),lv=Symbol.for("react.fragment"),VN=Symbol.for("react.strict_mode"),HU=Symbol.for("react.profiler"),Dee=Symbol.for("react.provider"),wee=Symbol.for("react.context"),ON=Symbol.for("react.forward_ref"),jU=Symbol.for("react.suspense"),WU=Symbol.for("react.suspense_list"),GN=Symbol.for("react.memo"),ox=Symbol.for("react.lazy"),Mee=Symbol.for("react.offscreen"),A$=Symbol.iterator;function jP(e){return e===null||typeof e!="object"?null:(e=A$&&e[A$]||e["@@iterator"],typeof e=="function"?e:null)}var qa=Object.assign,CU;function JP(e){if(CU===void 0)try{throw Error()}catch(r){var t=r.stack.trim().match(/\n( *(at )?)/);CU=t&&t[1]||""}return`
`+CU+e}var SU=!1;function vU(e,t){if(!e||SU)return"";SU=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(u){var n=u}Reflect.construct(e,[],t)}else{try{t.call()}catch(u){n=u}e.call(t.prototype)}else{try{throw Error()}catch(u){n=u}e()}}catch(u){if(u&&n&&typeof u.stack=="string"){for(var o=u.stack.split(`
`),i=n.stack.split(`
`),a=o.length-1,s=i.length-1;1<=a&&0<=s&&o[a]!==i[s];)s--;for(;1<=a&&0<=s;a--,s--)if(o[a]!==i[s]){if(a!==1||s!==1)do if(a--,s--,0>s||o[a]!==i[s]){var l=`
`+o[a].replace(" at new "," at ");return e.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",e.displayName)),l}while(1<=a&&0<=s);break}}}finally{SU=!1,Error.prepareStackTrace=r}return(e=e?e.displayName||e.name:"")?JP(e):""}function qEe(e){switch(e.tag){case 5:return JP(e.type);case 16:return JP("Lazy");case 13:return JP("Suspense");case 19:return JP("SuspenseList");case 0:case 2:case 15:return e=vU(e.type,!1),e;case 11:return e=vU(e.type.render,!1),e;case 1:return e=vU(e.type,!0),e;default:return""}}function XU(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case lv:return"Fragment";case sv:return"Portal";case HU:return"Profiler";case VN:return"StrictMode";case jU:return"Suspense";case WU:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case wee:return(e.displayName||"Context")+".Consumer";case Dee:return(e._context.displayName||"Context")+".Provider";case ON:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case GN:return t=e.displayName||null,t!==null?t:XU(e.type)||"Memo";case ox:t=e._payload,e=e._init;try{return XU(e(t))}catch{}}return null}function YEe(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return XU(t);case 8:return t===VN?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function bx(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function Bee(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function KEe(e){var t=Bee(e)?"checked":"value",r=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),n=""+e[t];if(!e.hasOwnProperty(t)&&typeof r<"u"&&typeof r.get=="function"&&typeof r.set=="function"){var o=r.get,i=r.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return o.call(this)},set:function(a){n=""+a,i.call(this,a)}}),Object.defineProperty(e,t,{enumerable:r.enumerable}),{getValue:function(){return n},setValue:function(a){n=""+a},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function Q3(e){e._valueTracker||(e._valueTracker=KEe(e))}function Eee(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var r=t.getValue(),n="";return e&&(n=Bee(e)?e.checked?"true":"false":e.value),e=n,e!==r?(t.setValue(e),!0):!1}function Sw(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function QU(e,t){var r=t.checked;return qa({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:r??e._wrapperState.initialChecked})}function T$(e,t){var r=t.defaultValue==null?"":t.defaultValue,n=t.checked!=null?t.checked:t.defaultChecked;r=bx(t.value!=null?t.value:r),e._wrapperState={initialChecked:n,initialValue:r,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function kee(e,t){t=t.checked,t!=null&&LN(e,"checked",t,!1)}function ZU(e,t){kee(e,t);var r=bx(t.value),n=t.type;if(r!=null)n==="number"?(r===0&&e.value===""||e.value!=r)&&(e.value=""+r):e.value!==""+r&&(e.value=""+r);else if(n==="submit"||n==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?qU(e,t.type,r):t.hasOwnProperty("defaultValue")&&qU(e,t.type,bx(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function P$(e,t,r){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var n=t.type;if(!(n!=="submit"&&n!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,r||t===e.value||(e.value=t),e.defaultValue=t}r=e.name,r!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,r!==""&&(e.name=r)}function qU(e,t,r){(t!=="number"||Sw(e.ownerDocument)!==e)&&(r==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+r&&(e.defaultValue=""+r))}var $P=Array.isArray;function xv(e,t,r,n){if(e=e.options,t){t={};for(var o=0;o<r.length;o++)t["$"+r[o]]=!0;for(r=0;r<e.length;r++)o=t.hasOwnProperty("$"+e[r].value),e[r].selected!==o&&(e[r].selected=o),o&&n&&(e[r].defaultSelected=!0)}else{for(r=""+bx(r),t=null,o=0;o<e.length;o++){if(e[o].value===r){e[o].selected=!0,n&&(e[o].defaultSelected=!0);return}t!==null||e[o].disabled||(t=e[o])}t!==null&&(t.selected=!0)}}function YU(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(er(91));return qa({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function _$(e,t){var r=t.value;if(r==null){if(r=t.children,t=t.defaultValue,r!=null){if(t!=null)throw Error(er(92));if($P(r)){if(1<r.length)throw Error(er(93));r=r[0]}t=r}t==null&&(t=""),r=t}e._wrapperState={initialValue:bx(r)}}function Fee(e,t){var r=bx(t.value),n=bx(t.defaultValue);r!=null&&(r=""+r,r!==e.value&&(e.value=r),t.defaultValue==null&&e.defaultValue!==r&&(e.defaultValue=r)),n!=null&&(e.defaultValue=""+n)}function R$(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function Lee(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function KU(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?Lee(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var Z3,Vee=(function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,r,n,o){MSApp.execUnsafeLocalFunction(function(){return e(t,r,n,o)})}:e})(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(Z3=Z3||document.createElement("div"),Z3.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=Z3.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function d2(e,t){if(t){var r=e.firstChild;if(r&&r===e.lastChild&&r.nodeType===3){r.nodeValue=t;return}}e.textContent=t}var r2={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},JEe=["Webkit","ms","Moz","O"];Object.keys(r2).forEach(function(e){JEe.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),r2[t]=r2[e]})});function Oee(e,t,r){return t==null||typeof t=="boolean"||t===""?"":r||typeof t!="number"||t===0||r2.hasOwnProperty(e)&&r2[e]?(""+t).trim():t+"px"}function Gee(e,t){e=e.style;for(var r in t)if(t.hasOwnProperty(r)){var n=r.indexOf("--")===0,o=Oee(r,t[r],n);r==="float"&&(r="cssFloat"),n?e.setProperty(r,o):e[r]=o}}var $Ee=qa({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function JU(e,t){if(t){if($Ee[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(er(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(er(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(er(61))}if(t.style!=null&&typeof t.style!="object")throw Error(er(62))}}function $U(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var eN=null;function UN(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var tN=null,Cv=null,Sv=null;function D$(e){if(e=w2(e)){if(typeof tN!="function")throw Error(er(280));var t=e.stateNode;t&&(t=qw(t),tN(e.stateNode,e.type,t))}}function Uee(e){Cv?Sv?Sv.push(e):Sv=[e]:Cv=e}function Nee(){if(Cv){var e=Cv,t=Sv;if(Sv=Cv=null,D$(e),t)for(e=0;e<t.length;e++)D$(t[e])}}function zee(e,t){return e(t)}function Hee(){}var IU=!1;function jee(e,t,r){if(IU)return e(t,r);IU=!0;try{return zee(e,t,r)}finally{IU=!1,(Cv!==null||Sv!==null)&&(Hee(),Nee())}}function p2(e,t){var r=e.stateNode;if(r===null)return null;var n=qw(r);if(n===null)return null;r=n[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(e=e.type,n=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!n;break e;default:e=!1}if(e)return null;if(r&&typeof r!="function")throw Error(er(231,t,typeof r));return r}var rN=!1;if(Ty)try{iv={},Object.defineProperty(iv,"passive",{get:function(){rN=!0}}),window.addEventListener("test",iv,iv),window.removeEventListener("test",iv,iv)}catch{rN=!1}var iv;function eke(e,t,r,n,o,i,a,s,l){var u=Array.prototype.slice.call(arguments,3);try{t.apply(r,u)}catch(c){this.onError(c)}}var n2=!1,vw=null,Iw=!1,nN=null,tke={onError:function(e){n2=!0,vw=e}};function rke(e,t,r,n,o,i,a,s,l){n2=!1,vw=null,eke.apply(tke,arguments)}function nke(e,t,r,n,o,i,a,s,l){if(rke.apply(this,arguments),n2){if(n2){var u=vw;n2=!1,vw=null}else throw Error(er(198));Iw||(Iw=!0,nN=u)}}function W0(e){var t=e,r=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,(t.flags&4098)!==0&&(r=t.return),e=t.return;while(e)}return t.tag===3?r:null}function Wee(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function w$(e){if(W0(e)!==e)throw Error(er(188))}function oke(e){var t=e.alternate;if(!t){if(t=W0(e),t===null)throw Error(er(188));return t!==e?null:e}for(var r=e,n=t;;){var o=r.return;if(o===null)break;var i=o.alternate;if(i===null){if(n=o.return,n!==null){r=n;continue}break}if(o.child===i.child){for(i=o.child;i;){if(i===r)return w$(o),e;if(i===n)return w$(o),t;i=i.sibling}throw Error(er(188))}if(r.return!==n.return)r=o,n=i;else{for(var a=!1,s=o.child;s;){if(s===r){a=!0,r=o,n=i;break}if(s===n){a=!0,n=o,r=i;break}s=s.sibling}if(!a){for(s=i.child;s;){if(s===r){a=!0,r=i,n=o;break}if(s===n){a=!0,n=i,r=o;break}s=s.sibling}if(!a)throw Error(er(189))}}if(r.alternate!==n)throw Error(er(190))}if(r.tag!==3)throw Error(er(188));return r.stateNode.current===r?e:t}function Xee(e){return e=oke(e),e!==null?Qee(e):null}function Qee(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=Qee(e);if(t!==null)return t;e=e.sibling}return null}var Zee=ad.unstable_scheduleCallback,M$=ad.unstable_cancelCallback,ike=ad.unstable_shouldYield,ake=ad.unstable_requestPaint,Ls=ad.unstable_now,ske=ad.unstable_getCurrentPriorityLevel,NN=ad.unstable_ImmediatePriority,qee=ad.unstable_UserBlockingPriority,Aw=ad.unstable_NormalPriority,lke=ad.unstable_LowPriority,Yee=ad.unstable_IdlePriority,Ww=null,kh=null;function uke(e){if(kh&&typeof kh.onCommitFiberRoot=="function")try{kh.onCommitFiberRoot(Ww,e,void 0,(e.current.flags&128)===128)}catch{}}var _f=Math.clz32?Math.clz32:dke,cke=Math.log,mke=Math.LN2;function dke(e){return e>>>=0,e===0?32:31-(cke(e)/mke|0)|0}var q3=64,Y3=4194304;function e2(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function Tw(e,t){var r=e.pendingLanes;if(r===0)return 0;var n=0,o=e.suspendedLanes,i=e.pingedLanes,a=r&268435455;if(a!==0){var s=a&~o;s!==0?n=e2(s):(i&=a,i!==0&&(n=e2(i)))}else a=r&~o,a!==0?n=e2(a):i!==0&&(n=e2(i));if(n===0)return 0;if(t!==0&&t!==n&&(t&o)===0&&(o=n&-n,i=t&-t,o>=i||o===16&&(i&4194240)!==0))return t;if((n&4)!==0&&(n|=r&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=n;0<t;)r=31-_f(t),o=1<<r,n|=e[r],t&=~o;return n}function pke(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function fke(e,t){for(var r=e.suspendedLanes,n=e.pingedLanes,o=e.expirationTimes,i=e.pendingLanes;0<i;){var a=31-_f(i),s=1<<a,l=o[a];l===-1?((s&r)===0||(s&n)!==0)&&(o[a]=pke(s,t)):l<=t&&(e.expiredLanes|=s),i&=~s}}function oN(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function Kee(){var e=q3;return q3<<=1,(q3&4194240)===0&&(q3=64),e}function AU(e){for(var t=[],r=0;31>r;r++)t.push(e);return t}function R2(e,t,r){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-_f(t),e[t]=r}function hke(e,t){var r=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var n=e.eventTimes;for(e=e.expirationTimes;0<r;){var o=31-_f(r),i=1<<o;t[o]=0,n[o]=-1,e[o]=-1,r&=~i}}function zN(e,t){var r=e.entangledLanes|=t;for(e=e.entanglements;r;){var n=31-_f(r),o=1<<n;o&t|e[n]&t&&(e[n]|=t),r&=~o}}var Bi=0;function Jee(e){return e&=-e,1<e?4<e?(e&268435455)!==0?16:536870912:4:1}var $ee,HN,ete,tte,rte,iN=!1,K3=[],cx=null,mx=null,dx=null,f2=new Map,h2=new Map,ax=[],gke="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function B$(e,t){switch(e){case"focusin":case"focusout":cx=null;break;case"dragenter":case"dragleave":mx=null;break;case"mouseover":case"mouseout":dx=null;break;case"pointerover":case"pointerout":f2.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":h2.delete(t.pointerId)}}function WP(e,t,r,n,o,i){return e===null||e.nativeEvent!==i?(e={blockedOn:t,domEventName:r,eventSystemFlags:n,nativeEvent:i,targetContainers:[o]},t!==null&&(t=w2(t),t!==null&&HN(t)),e):(e.eventSystemFlags|=n,t=e.targetContainers,o!==null&&t.indexOf(o)===-1&&t.push(o),e)}function yke(e,t,r,n,o){switch(t){case"focusin":return cx=WP(cx,e,t,r,n,o),!0;case"dragenter":return mx=WP(mx,e,t,r,n,o),!0;case"mouseover":return dx=WP(dx,e,t,r,n,o),!0;case"pointerover":var i=o.pointerId;return f2.set(i,WP(f2.get(i)||null,e,t,r,n,o)),!0;case"gotpointercapture":return i=o.pointerId,h2.set(i,WP(h2.get(i)||null,e,t,r,n,o)),!0}return!1}function nte(e){var t=k0(e.target);if(t!==null){var r=W0(t);if(r!==null){if(t=r.tag,t===13){if(t=Wee(r),t!==null){e.blockedOn=t,rte(e.priority,function(){ete(r)});return}}else if(t===3&&r.stateNode.current.memoizedState.isDehydrated){e.blockedOn=r.tag===3?r.stateNode.containerInfo:null;return}}}e.blockedOn=null}function mw(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var r=aN(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(r===null){r=e.nativeEvent;var n=new r.constructor(r.type,r);eN=n,r.target.dispatchEvent(n),eN=null}else return t=w2(r),t!==null&&HN(t),e.blockedOn=r,!1;t.shift()}return!0}function E$(e,t,r){mw(e)&&r.delete(t)}function bke(){iN=!1,cx!==null&&mw(cx)&&(cx=null),mx!==null&&mw(mx)&&(mx=null),dx!==null&&mw(dx)&&(dx=null),f2.forEach(E$),h2.forEach(E$)}function XP(e,t){e.blockedOn===t&&(e.blockedOn=null,iN||(iN=!0,ad.unstable_scheduleCallback(ad.unstable_NormalPriority,bke)))}function g2(e){function t(o){return XP(o,e)}if(0<K3.length){XP(K3[0],e);for(var r=1;r<K3.length;r++){var n=K3[r];n.blockedOn===e&&(n.blockedOn=null)}}for(cx!==null&&XP(cx,e),mx!==null&&XP(mx,e),dx!==null&&XP(dx,e),f2.forEach(t),h2.forEach(t),r=0;r<ax.length;r++)n=ax[r],n.blockedOn===e&&(n.blockedOn=null);for(;0<ax.length&&(r=ax[0],r.blockedOn===null);)nte(r),r.blockedOn===null&&ax.shift()}var vv=Dy.ReactCurrentBatchConfig,Pw=!0;function xke(e,t,r,n){var o=Bi,i=vv.transition;vv.transition=null;try{Bi=1,jN(e,t,r,n)}finally{Bi=o,vv.transition=i}}function Cke(e,t,r,n){var o=Bi,i=vv.transition;vv.transition=null;try{Bi=4,jN(e,t,r,n)}finally{Bi=o,vv.transition=i}}function jN(e,t,r,n){if(Pw){var o=aN(e,t,r,n);if(o===null)MU(e,t,n,_w,r),B$(e,n);else if(yke(o,e,t,r,n))n.stopPropagation();else if(B$(e,n),t&4&&-1<gke.indexOf(e)){for(;o!==null;){var i=w2(o);if(i!==null&&$ee(i),i=aN(e,t,r,n),i===null&&MU(e,t,n,_w,r),i===o)break;o=i}o!==null&&n.stopPropagation()}else MU(e,t,n,null,r)}}var _w=null;function aN(e,t,r,n){if(_w=null,e=UN(n),e=k0(e),e!==null)if(t=W0(e),t===null)e=null;else if(r=t.tag,r===13){if(e=Wee(t),e!==null)return e;e=null}else if(r===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return _w=e,null}function ote(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(ske()){case NN:return 1;case qee:return 4;case Aw:case lke:return 16;case Yee:return 536870912;default:return 16}default:return 16}}var lx=null,WN=null,dw=null;function ite(){if(dw)return dw;var e,t=WN,r=t.length,n,o="value"in lx?lx.value:lx.textContent,i=o.length;for(e=0;e<r&&t[e]===o[e];e++);var a=r-e;for(n=1;n<=a&&t[r-n]===o[i-n];n++);return dw=o.slice(e,1<n?1-n:void 0)}function pw(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function J3(){return!0}function k$(){return!1}function sd(e){function t(r,n,o,i,a){this._reactName=r,this._targetInst=o,this.type=n,this.nativeEvent=i,this.target=a,this.currentTarget=null;for(var s in e)e.hasOwnProperty(s)&&(r=e[s],this[s]=r?r(i):i[s]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?J3:k$,this.isPropagationStopped=k$,this}return qa(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var r=this.nativeEvent;r&&(r.preventDefault?r.preventDefault():typeof r.returnValue!="unknown"&&(r.returnValue=!1),this.isDefaultPrevented=J3)},stopPropagation:function(){var r=this.nativeEvent;r&&(r.stopPropagation?r.stopPropagation():typeof r.cancelBubble!="unknown"&&(r.cancelBubble=!0),this.isPropagationStopped=J3)},persist:function(){},isPersistent:J3}),t}var Bv={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},XN=sd(Bv),D2=qa({},Bv,{view:0,detail:0}),Ske=sd(D2),TU,PU,QP,Xw=qa({},D2,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:QN,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==QP&&(QP&&e.type==="mousemove"?(TU=e.screenX-QP.screenX,PU=e.screenY-QP.screenY):PU=TU=0,QP=e),TU)},movementY:function(e){return"movementY"in e?e.movementY:PU}}),F$=sd(Xw),vke=qa({},Xw,{dataTransfer:0}),Ike=sd(vke),Ake=qa({},D2,{relatedTarget:0}),_U=sd(Ake),Tke=qa({},Bv,{animationName:0,elapsedTime:0,pseudoElement:0}),Pke=sd(Tke),_ke=qa({},Bv,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),Rke=sd(_ke),Dke=qa({},Bv,{data:0}),L$=sd(Dke),wke={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Mke={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Bke={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Eke(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=Bke[e])?!!t[e]:!1}function QN(){return Eke}var kke=qa({},D2,{key:function(e){if(e.key){var t=wke[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=pw(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?Mke[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:QN,charCode:function(e){return e.type==="keypress"?pw(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?pw(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),Fke=sd(kke),Lke=qa({},Xw,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),V$=sd(Lke),Vke=qa({},D2,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:QN}),Oke=sd(Vke),Gke=qa({},Bv,{propertyName:0,elapsedTime:0,pseudoElement:0}),Uke=sd(Gke),Nke=qa({},Xw,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),zke=sd(Nke),Hke=[9,13,27,32],ZN=Ty&&"CompositionEvent"in window,o2=null;Ty&&"documentMode"in document&&(o2=document.documentMode);var jke=Ty&&"TextEvent"in window&&!o2,ate=Ty&&(!ZN||o2&&8<o2&&11>=o2),O$=" ",G$=!1;function ste(e,t){switch(e){case"keyup":return Hke.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function lte(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var uv=!1;function Wke(e,t){switch(e){case"compositionend":return lte(t);case"keypress":return t.which!==32?null:(G$=!0,O$);case"textInput":return e=t.data,e===O$&&G$?null:e;default:return null}}function Xke(e,t){if(uv)return e==="compositionend"||!ZN&&ste(e,t)?(e=ite(),dw=WN=lx=null,uv=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return ate&&t.locale!=="ko"?null:t.data;default:return null}}var Qke={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function U$(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!Qke[e.type]:t==="textarea"}function ute(e,t,r,n){Uee(n),t=Rw(t,"onChange"),0<t.length&&(r=new XN("onChange","change",null,r,n),e.push({event:r,listeners:t}))}var i2=null,y2=null;function Zke(e){Cte(e,0)}function Qw(e){var t=dv(e);if(Eee(t))return e}function qke(e,t){if(e==="change")return t}var cte=!1;Ty&&(Ty?(ew="oninput"in document,ew||(RU=document.createElement("div"),RU.setAttribute("oninput","return;"),ew=typeof RU.oninput=="function"),$3=ew):$3=!1,cte=$3&&(!document.documentMode||9<document.documentMode));var $3,ew,RU;function N$(){i2&&(i2.detachEvent("onpropertychange",mte),y2=i2=null)}function mte(e){if(e.propertyName==="value"&&Qw(y2)){var t=[];ute(t,y2,e,UN(e)),jee(Zke,t)}}function Yke(e,t,r){e==="focusin"?(N$(),i2=t,y2=r,i2.attachEvent("onpropertychange",mte)):e==="focusout"&&N$()}function Kke(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return Qw(y2)}function Jke(e,t){if(e==="click")return Qw(t)}function $ke(e,t){if(e==="input"||e==="change")return Qw(t)}function eFe(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var Df=typeof Object.is=="function"?Object.is:eFe;function b2(e,t){if(Df(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(n=0;n<r.length;n++){var o=r[n];if(!zU.call(t,o)||!Df(e[o],t[o]))return!1}return!0}function z$(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function H$(e,t){var r=z$(e);e=0;for(var n;r;){if(r.nodeType===3){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=z$(r)}}function dte(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?dte(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function pte(){for(var e=window,t=Sw();t instanceof e.HTMLIFrameElement;){try{var r=typeof t.contentWindow.location.href=="string"}catch{r=!1}if(r)e=t.contentWindow;else break;t=Sw(e.document)}return t}function qN(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function tFe(e){var t=pte(),r=e.focusedElem,n=e.selectionRange;if(t!==r&&r&&r.ownerDocument&&dte(r.ownerDocument.documentElement,r)){if(n!==null&&qN(r)){if(t=n.start,e=n.end,e===void 0&&(e=t),"selectionStart"in r)r.selectionStart=t,r.selectionEnd=Math.min(e,r.value.length);else if(e=(t=r.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var o=r.textContent.length,i=Math.min(n.start,o);n=n.end===void 0?i:Math.min(n.end,o),!e.extend&&i>n&&(o=n,n=i,i=o),o=H$(r,i);var a=H$(r,n);o&&a&&(e.rangeCount!==1||e.anchorNode!==o.node||e.anchorOffset!==o.offset||e.focusNode!==a.node||e.focusOffset!==a.offset)&&(t=t.createRange(),t.setStart(o.node,o.offset),e.removeAllRanges(),i>n?(e.addRange(t),e.extend(a.node,a.offset)):(t.setEnd(a.node,a.offset),e.addRange(t)))}}for(t=[],e=r;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof r.focus=="function"&&r.focus(),r=0;r<t.length;r++)e=t[r],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var rFe=Ty&&"documentMode"in document&&11>=document.documentMode,cv=null,sN=null,a2=null,lN=!1;function j$(e,t,r){var n=r.window===r?r.document:r.nodeType===9?r:r.ownerDocument;lN||cv==null||cv!==Sw(n)||(n=cv,"selectionStart"in n&&qN(n)?n={start:n.selectionStart,end:n.selectionEnd}:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection(),n={anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset}),a2&&b2(a2,n)||(a2=n,n=Rw(sN,"onSelect"),0<n.length&&(t=new XN("onSelect","select",null,t,r),e.push({event:t,listeners:n}),t.target=cv)))}function tw(e,t){var r={};return r[e.toLowerCase()]=t.toLowerCase(),r["Webkit"+e]="webkit"+t,r["Moz"+e]="moz"+t,r}var mv={animationend:tw("Animation","AnimationEnd"),animationiteration:tw("Animation","AnimationIteration"),animationstart:tw("Animation","AnimationStart"),transitionend:tw("Transition","TransitionEnd")},DU={},fte={};Ty&&(fte=document.createElement("div").style,"AnimationEvent"in window||(delete mv.animationend.animation,delete mv.animationiteration.animation,delete mv.animationstart.animation),"TransitionEvent"in window||delete mv.transitionend.transition);function Zw(e){if(DU[e])return DU[e];if(!mv[e])return e;var t=mv[e],r;for(r in t)if(t.hasOwnProperty(r)&&r in fte)return DU[e]=t[r];return e}var hte=Zw("animationend"),gte=Zw("animationiteration"),yte=Zw("animationstart"),bte=Zw("transitionend"),xte=new Map,W$="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Cx(e,t){xte.set(e,t),j0(t,[e])}for(rw=0;rw<W$.length;rw++)nw=W$[rw],X$=nw.toLowerCase(),Q$=nw[0].toUpperCase()+nw.slice(1),Cx(X$,"on"+Q$);var nw,X$,Q$,rw;Cx(hte,"onAnimationEnd");Cx(gte,"onAnimationIteration");Cx(yte,"onAnimationStart");Cx("dblclick","onDoubleClick");Cx("focusin","onFocus");Cx("focusout","onBlur");Cx(bte,"onTransitionEnd");Tv("onMouseEnter",["mouseout","mouseover"]);Tv("onMouseLeave",["mouseout","mouseover"]);Tv("onPointerEnter",["pointerout","pointerover"]);Tv("onPointerLeave",["pointerout","pointerover"]);j0("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));j0("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));j0("onBeforeInput",["compositionend","keypress","textInput","paste"]);j0("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));j0("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));j0("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var t2="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),nFe=new Set("cancel close invalid load scroll toggle".split(" ").concat(t2));function Z$(e,t,r){var n=e.type||"unknown-event";e.currentTarget=r,nke(n,t,void 0,e),e.currentTarget=null}function Cte(e,t){t=(t&4)!==0;for(var r=0;r<e.length;r++){var n=e[r],o=n.event;n=n.listeners;e:{var i=void 0;if(t)for(var a=n.length-1;0<=a;a--){var s=n[a],l=s.instance,u=s.currentTarget;if(s=s.listener,l!==i&&o.isPropagationStopped())break e;Z$(o,s,u),i=l}else for(a=0;a<n.length;a++){if(s=n[a],l=s.instance,u=s.currentTarget,s=s.listener,l!==i&&o.isPropagationStopped())break e;Z$(o,s,u),i=l}}}if(Iw)throw e=nN,Iw=!1,nN=null,e}function Ca(e,t){var r=t[pN];r===void 0&&(r=t[pN]=new Set);var n=e+"__bubble";r.has(n)||(Ste(t,e,2,!1),r.add(n))}function wU(e,t,r){var n=0;t&&(n|=4),Ste(r,e,n,t)}var ow="_reactListening"+Math.random().toString(36).slice(2);function x2(e){if(!e[ow]){e[ow]=!0,Ree.forEach(function(r){r!=="selectionchange"&&(nFe.has(r)||wU(r,!1,e),wU(r,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[ow]||(t[ow]=!0,wU("selectionchange",!1,t))}}function Ste(e,t,r,n){switch(ote(t)){case 1:var o=xke;break;case 4:o=Cke;break;default:o=jN}r=o.bind(null,t,r,e),o=void 0,!rN||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(o=!0),n?o!==void 0?e.addEventListener(t,r,{capture:!0,passive:o}):e.addEventListener(t,r,!0):o!==void 0?e.addEventListener(t,r,{passive:o}):e.addEventListener(t,r,!1)}function MU(e,t,r,n,o){var i=n;if((t&1)===0&&(t&2)===0&&n!==null)e:for(;;){if(n===null)return;var a=n.tag;if(a===3||a===4){var s=n.stateNode.containerInfo;if(s===o||s.nodeType===8&&s.parentNode===o)break;if(a===4)for(a=n.return;a!==null;){var l=a.tag;if((l===3||l===4)&&(l=a.stateNode.containerInfo,l===o||l.nodeType===8&&l.parentNode===o))return;a=a.return}for(;s!==null;){if(a=k0(s),a===null)return;if(l=a.tag,l===5||l===6){n=i=a;continue e}s=s.parentNode}}n=n.return}jee(function(){var u=i,c=UN(r),m=[];e:{var d=xte.get(e);if(d!==void 0){var p=XN,h=e;switch(e){case"keypress":if(pw(r)===0)break e;case"keydown":case"keyup":p=Fke;break;case"focusin":h="focus",p=_U;break;case"focusout":h="blur",p=_U;break;case"beforeblur":case"afterblur":p=_U;break;case"click":if(r.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":p=F$;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":p=Ike;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":p=Oke;break;case hte:case gte:case yte:p=Pke;break;case bte:p=Uke;break;case"scroll":p=Ske;break;case"wheel":p=zke;break;case"copy":case"cut":case"paste":p=Rke;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":p=V$}var f=(t&4)!==0,g=!f&&e==="scroll",y=f?d!==null?d+"Capture":null:d;f=[];for(var x=u,S;x!==null;){S=x;var I=S.stateNode;if(S.tag===5&&I!==null&&(S=I,y!==null&&(I=p2(x,y),I!=null&&f.push(C2(x,I,S)))),g)break;x=x.return}0<f.length&&(d=new p(d,h,null,r,c),m.push({event:d,listeners:f}))}}if((t&7)===0){e:{if(d=e==="mouseover"||e==="pointerover",p=e==="mouseout"||e==="pointerout",d&&r!==eN&&(h=r.relatedTarget||r.fromElement)&&(k0(h)||h[Py]))break e;if((p||d)&&(d=c.window===c?c:(d=c.ownerDocument)?d.defaultView||d.parentWindow:window,p?(h=r.relatedTarget||r.toElement,p=u,h=h?k0(h):null,h!==null&&(g=W0(h),h!==g||h.tag!==5&&h.tag!==6)&&(h=null)):(p=null,h=u),p!==h)){if(f=F$,I="onMouseLeave",y="onMouseEnter",x="mouse",(e==="pointerout"||e==="pointerover")&&(f=V$,I="onPointerLeave",y="onPointerEnter",x="pointer"),g=p==null?d:dv(p),S=h==null?d:dv(h),d=new f(I,x+"leave",p,r,c),d.target=g,d.relatedTarget=S,I=null,k0(c)===u&&(f=new f(y,x+"enter",h,r,c),f.target=S,f.relatedTarget=g,I=f),g=I,p&&h)t:{for(f=p,y=h,x=0,S=f;S;S=av(S))x++;for(S=0,I=y;I;I=av(I))S++;for(;0<x-S;)f=av(f),x--;for(;0<S-x;)y=av(y),S--;for(;x--;){if(f===y||y!==null&&f===y.alternate)break t;f=av(f),y=av(y)}f=null}else f=null;p!==null&&q$(m,d,p,f,!1),h!==null&&g!==null&&q$(m,g,h,f,!0)}}e:{if(d=u?dv(u):window,p=d.nodeName&&d.nodeName.toLowerCase(),p==="select"||p==="input"&&d.type==="file")var v=qke;else if(U$(d))if(cte)v=$ke;else{v=Kke;var A=Yke}else(p=d.nodeName)&&p.toLowerCase()==="input"&&(d.type==="checkbox"||d.type==="radio")&&(v=Jke);if(v&&(v=v(e,u))){ute(m,v,r,c);break e}A&&A(e,d,u),e==="focusout"&&(A=d._wrapperState)&&A.controlled&&d.type==="number"&&qU(d,"number",d.value)}switch(A=u?dv(u):window,e){case"focusin":(U$(A)||A.contentEditable==="true")&&(cv=A,sN=u,a2=null);break;case"focusout":a2=sN=cv=null;break;case"mousedown":lN=!0;break;case"contextmenu":case"mouseup":case"dragend":lN=!1,j$(m,r,c);break;case"selectionchange":if(rFe)break;case"keydown":case"keyup":j$(m,r,c)}var P;if(ZN)e:{switch(e){case"compositionstart":var T="onCompositionStart";break e;case"compositionend":T="onCompositionEnd";break e;case"compositionupdate":T="onCompositionUpdate";break e}T=void 0}else uv?ste(e,r)&&(T="onCompositionEnd"):e==="keydown"&&r.keyCode===229&&(T="onCompositionStart");T&&(ate&&r.locale!=="ko"&&(uv||T!=="onCompositionStart"?T==="onCompositionEnd"&&uv&&(P=ite()):(lx=c,WN="value"in lx?lx.value:lx.textContent,uv=!0)),A=Rw(u,T),0<A.length&&(T=new L$(T,e,null,r,c),m.push({event:T,listeners:A}),P?T.data=P:(P=lte(r),P!==null&&(T.data=P)))),(P=jke?Wke(e,r):Xke(e,r))&&(u=Rw(u,"onBeforeInput"),0<u.length&&(c=new L$("onBeforeInput","beforeinput",null,r,c),m.push({event:c,listeners:u}),c.data=P))}Cte(m,t)})}function C2(e,t,r){return{instance:e,listener:t,currentTarget:r}}function Rw(e,t){for(var r=t+"Capture",n=[];e!==null;){var o=e,i=o.stateNode;o.tag===5&&i!==null&&(o=i,i=p2(e,r),i!=null&&n.unshift(C2(e,i,o)),i=p2(e,t),i!=null&&n.push(C2(e,i,o))),e=e.return}return n}function av(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function q$(e,t,r,n,o){for(var i=t._reactName,a=[];r!==null&&r!==n;){var s=r,l=s.alternate,u=s.stateNode;if(l!==null&&l===n)break;s.tag===5&&u!==null&&(s=u,o?(l=p2(r,i),l!=null&&a.unshift(C2(r,l,s))):o||(l=p2(r,i),l!=null&&a.push(C2(r,l,s)))),r=r.return}a.length!==0&&e.push({event:t,listeners:a})}var oFe=/\r\n?/g,iFe=/\u0000|\uFFFD/g;function Y$(e){return(typeof e=="string"?e:""+e).replace(oFe,`
`).replace(iFe,"")}function iw(e,t,r){if(t=Y$(t),Y$(e)!==t&&r)throw Error(er(425))}function Dw(){}var uN=null,cN=null;function mN(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var dN=typeof setTimeout=="function"?setTimeout:void 0,aFe=typeof clearTimeout=="function"?clearTimeout:void 0,K$=typeof Promise=="function"?Promise:void 0,sFe=typeof queueMicrotask=="function"?queueMicrotask:typeof K$<"u"?function(e){return K$.resolve(null).then(e).catch(lFe)}:dN;function lFe(e){setTimeout(function(){throw e})}function BU(e,t){var r=t,n=0;do{var o=r.nextSibling;if(e.removeChild(r),o&&o.nodeType===8)if(r=o.data,r==="/$"){if(n===0){e.removeChild(o),g2(t);return}n--}else r!=="$"&&r!=="$?"&&r!=="$!"||n++;r=o}while(r);g2(t)}function px(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function J$(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var r=e.data;if(r==="$"||r==="$!"||r==="$?"){if(t===0)return e;t--}else r==="/$"&&t++}e=e.previousSibling}return null}var Ev=Math.random().toString(36).slice(2),Eh="__reactFiber$"+Ev,S2="__reactProps$"+Ev,Py="__reactContainer$"+Ev,pN="__reactEvents$"+Ev,uFe="__reactListeners$"+Ev,cFe="__reactHandles$"+Ev;function k0(e){var t=e[Eh];if(t)return t;for(var r=e.parentNode;r;){if(t=r[Py]||r[Eh]){if(r=t.alternate,t.child!==null||r!==null&&r.child!==null)for(e=J$(e);e!==null;){if(r=e[Eh])return r;e=J$(e)}return t}e=r,r=e.parentNode}return null}function w2(e){return e=e[Eh]||e[Py],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function dv(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(er(33))}function qw(e){return e[S2]||null}var fN=[],pv=-1;function Sx(e){return{current:e}}function Sa(e){0>pv||(e.current=fN[pv],fN[pv]=null,pv--)}function la(e,t){pv++,fN[pv]=e.current,e.current=t}var xx={},Ju=Sx(xx),ym=Sx(!1),G0=xx;function Pv(e,t){var r=e.type.contextTypes;if(!r)return xx;var n=e.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===t)return n.__reactInternalMemoizedMaskedChildContext;var o={},i;for(i in r)o[i]=t[i];return n&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=o),o}function bm(e){return e=e.childContextTypes,e!=null}function ww(){Sa(ym),Sa(Ju)}function $$(e,t,r){if(Ju.current!==xx)throw Error(er(168));la(Ju,t),la(ym,r)}function vte(e,t,r){var n=e.stateNode;if(t=t.childContextTypes,typeof n.getChildContext!="function")return r;n=n.getChildContext();for(var o in n)if(!(o in t))throw Error(er(108,YEe(e)||"Unknown",o));return qa({},r,n)}function Mw(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||xx,G0=Ju.current,la(Ju,e),la(ym,ym.current),!0}function eee(e,t,r){var n=e.stateNode;if(!n)throw Error(er(169));r?(e=vte(e,t,G0),n.__reactInternalMemoizedMergedChildContext=e,Sa(ym),Sa(Ju),la(Ju,e)):Sa(ym),la(ym,r)}var Sy=null,Yw=!1,EU=!1;function Ite(e){Sy===null?Sy=[e]:Sy.push(e)}function mFe(e){Yw=!0,Ite(e)}function vx(){if(!EU&&Sy!==null){EU=!0;var e=0,t=Bi;try{var r=Sy;for(Bi=1;e<r.length;e++){var n=r[e];do n=n(!0);while(n!==null)}Sy=null,Yw=!1}catch(o){throw Sy!==null&&(Sy=Sy.slice(e+1)),Zee(NN,vx),o}finally{Bi=t,EU=!1}}return null}var fv=[],hv=0,Bw=null,Ew=0,ep=[],tp=0,U0=null,vy=1,Iy="";function B0(e,t){fv[hv++]=Ew,fv[hv++]=Bw,Bw=e,Ew=t}function Ate(e,t,r){ep[tp++]=vy,ep[tp++]=Iy,ep[tp++]=U0,U0=e;var n=vy;e=Iy;var o=32-_f(n)-1;n&=~(1<<o),r+=1;var i=32-_f(t)+o;if(30<i){var a=o-o%5;i=(n&(1<<a)-1).toString(32),n>>=a,o-=a,vy=1<<32-_f(t)+o|r<<o|n,Iy=i+e}else vy=1<<i|r<<o|n,Iy=e}function YN(e){e.return!==null&&(B0(e,1),Ate(e,1,0))}function KN(e){for(;e===Bw;)Bw=fv[--hv],fv[hv]=null,Ew=fv[--hv],fv[hv]=null;for(;e===U0;)U0=ep[--tp],ep[tp]=null,Iy=ep[--tp],ep[tp]=null,vy=ep[--tp],ep[tp]=null}var id=null,od=null,wa=!1,Pf=null;function Tte(e,t){var r=rp(5,null,null,0);r.elementType="DELETED",r.stateNode=t,r.return=e,t=e.deletions,t===null?(e.deletions=[r],e.flags|=16):t.push(r)}function tee(e,t){switch(e.tag){case 5:var r=e.type;return t=t.nodeType!==1||r.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,id=e,od=px(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,id=e,od=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(r=U0!==null?{id:vy,overflow:Iy}:null,e.memoizedState={dehydrated:t,treeContext:r,retryLane:1073741824},r=rp(18,null,null,0),r.stateNode=t,r.return=e,e.child=r,id=e,od=null,!0):!1;default:return!1}}function hN(e){return(e.mode&1)!==0&&(e.flags&128)===0}function gN(e){if(wa){var t=od;if(t){var r=t;if(!tee(e,t)){if(hN(e))throw Error(er(418));t=px(r.nextSibling);var n=id;t&&tee(e,t)?Tte(n,r):(e.flags=e.flags&-4097|2,wa=!1,id=e)}}else{if(hN(e))throw Error(er(418));e.flags=e.flags&-4097|2,wa=!1,id=e}}}function ree(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;id=e}function aw(e){if(e!==id)return!1;if(!wa)return ree(e),wa=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!mN(e.type,e.memoizedProps)),t&&(t=od)){if(hN(e))throw Pte(),Error(er(418));for(;t;)Tte(e,t),t=px(t.nextSibling)}if(ree(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(er(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var r=e.data;if(r==="/$"){if(t===0){od=px(e.nextSibling);break e}t--}else r!=="$"&&r!=="$!"&&r!=="$?"||t++}e=e.nextSibling}od=null}}else od=id?px(e.stateNode.nextSibling):null;return!0}function Pte(){for(var e=od;e;)e=px(e.nextSibling)}function _v(){od=id=null,wa=!1}function JN(e){Pf===null?Pf=[e]:Pf.push(e)}var dFe=Dy.ReactCurrentBatchConfig;function ZP(e,t,r){if(e=r.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(r._owner){if(r=r._owner,r){if(r.tag!==1)throw Error(er(309));var n=r.stateNode}if(!n)throw Error(er(147,e));var o=n,i=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===i?t.ref:(t=function(a){var s=o.refs;a===null?delete s[i]:s[i]=a},t._stringRef=i,t)}if(typeof e!="string")throw Error(er(284));if(!r._owner)throw Error(er(290,e))}return e}function sw(e,t){throw e=Object.prototype.toString.call(t),Error(er(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function nee(e){var t=e._init;return t(e._payload)}function _te(e){function t(y,x){if(e){var S=y.deletions;S===null?(y.deletions=[x],y.flags|=16):S.push(x)}}function r(y,x){if(!e)return null;for(;x!==null;)t(y,x),x=x.sibling;return null}function n(y,x){for(y=new Map;x!==null;)x.key!==null?y.set(x.key,x):y.set(x.index,x),x=x.sibling;return y}function o(y,x){return y=yx(y,x),y.index=0,y.sibling=null,y}function i(y,x,S){return y.index=S,e?(S=y.alternate,S!==null?(S=S.index,S<x?(y.flags|=2,x):S):(y.flags|=2,x)):(y.flags|=1048576,x)}function a(y){return e&&y.alternate===null&&(y.flags|=2),y}function s(y,x,S,I){return x===null||x.tag!==6?(x=UU(S,y.mode,I),x.return=y,x):(x=o(x,S),x.return=y,x)}function l(y,x,S,I){var v=S.type;return v===lv?c(y,x,S.props.children,I,S.key):x!==null&&(x.elementType===v||typeof v=="object"&&v!==null&&v.$$typeof===ox&&nee(v)===x.type)?(I=o(x,S.props),I.ref=ZP(y,x,S),I.return=y,I):(I=Cw(S.type,S.key,S.props,null,y.mode,I),I.ref=ZP(y,x,S),I.return=y,I)}function u(y,x,S,I){return x===null||x.tag!==4||x.stateNode.containerInfo!==S.containerInfo||x.stateNode.implementation!==S.implementation?(x=NU(S,y.mode,I),x.return=y,x):(x=o(x,S.children||[]),x.return=y,x)}function c(y,x,S,I,v){return x===null||x.tag!==7?(x=O0(S,y.mode,I,v),x.return=y,x):(x=o(x,S),x.return=y,x)}function m(y,x,S){if(typeof x=="string"&&x!==""||typeof x=="number")return x=UU(""+x,y.mode,S),x.return=y,x;if(typeof x=="object"&&x!==null){switch(x.$$typeof){case X3:return S=Cw(x.type,x.key,x.props,null,y.mode,S),S.ref=ZP(y,null,x),S.return=y,S;case sv:return x=NU(x,y.mode,S),x.return=y,x;case ox:var I=x._init;return m(y,I(x._payload),S)}if($P(x)||jP(x))return x=O0(x,y.mode,S,null),x.return=y,x;sw(y,x)}return null}function d(y,x,S,I){var v=x!==null?x.key:null;if(typeof S=="string"&&S!==""||typeof S=="number")return v!==null?null:s(y,x,""+S,I);if(typeof S=="object"&&S!==null){switch(S.$$typeof){case X3:return S.key===v?l(y,x,S,I):null;case sv:return S.key===v?u(y,x,S,I):null;case ox:return v=S._init,d(y,x,v(S._payload),I)}if($P(S)||jP(S))return v!==null?null:c(y,x,S,I,null);sw(y,S)}return null}function p(y,x,S,I,v){if(typeof I=="string"&&I!==""||typeof I=="number")return y=y.get(S)||null,s(x,y,""+I,v);if(typeof I=="object"&&I!==null){switch(I.$$typeof){case X3:return y=y.get(I.key===null?S:I.key)||null,l(x,y,I,v);case sv:return y=y.get(I.key===null?S:I.key)||null,u(x,y,I,v);case ox:var A=I._init;return p(y,x,S,A(I._payload),v)}if($P(I)||jP(I))return y=y.get(S)||null,c(x,y,I,v,null);sw(x,I)}return null}function h(y,x,S,I){for(var v=null,A=null,P=x,T=x=0,R=null;P!==null&&T<S.length;T++){P.index>T?(R=P,P=null):R=P.sibling;var w=d(y,P,S[T],I);if(w===null){P===null&&(P=R);break}e&&P&&w.alternate===null&&t(y,P),x=i(w,x,T),A===null?v=w:A.sibling=w,A=w,P=R}if(T===S.length)return r(y,P),wa&&B0(y,T),v;if(P===null){for(;T<S.length;T++)P=m(y,S[T],I),P!==null&&(x=i(P,x,T),A===null?v=P:A.sibling=P,A=P);return wa&&B0(y,T),v}for(P=n(y,P);T<S.length;T++)R=p(P,y,T,S[T],I),R!==null&&(e&&R.alternate!==null&&P.delete(R.key===null?T:R.key),x=i(R,x,T),A===null?v=R:A.sibling=R,A=R);return e&&P.forEach(function(E){return t(y,E)}),wa&&B0(y,T),v}function f(y,x,S,I){var v=jP(S);if(typeof v!="function")throw Error(er(150));if(S=v.call(S),S==null)throw Error(er(151));for(var A=v=null,P=x,T=x=0,R=null,w=S.next();P!==null&&!w.done;T++,w=S.next()){P.index>T?(R=P,P=null):R=P.sibling;var E=d(y,P,w.value,I);if(E===null){P===null&&(P=R);break}e&&P&&E.alternate===null&&t(y,P),x=i(E,x,T),A===null?v=E:A.sibling=E,A=E,P=R}if(w.done)return r(y,P),wa&&B0(y,T),v;if(P===null){for(;!w.done;T++,w=S.next())w=m(y,w.value,I),w!==null&&(x=i(w,x,T),A===null?v=w:A.sibling=w,A=w);return wa&&B0(y,T),v}for(P=n(y,P);!w.done;T++,w=S.next())w=p(P,y,T,w.value,I),w!==null&&(e&&w.alternate!==null&&P.delete(w.key===null?T:w.key),x=i(w,x,T),A===null?v=w:A.sibling=w,A=w);return e&&P.forEach(function(M){return t(y,M)}),wa&&B0(y,T),v}function g(y,x,S,I){if(typeof S=="object"&&S!==null&&S.type===lv&&S.key===null&&(S=S.props.children),typeof S=="object"&&S!==null){switch(S.$$typeof){case X3:e:{for(var v=S.key,A=x;A!==null;){if(A.key===v){if(v=S.type,v===lv){if(A.tag===7){r(y,A.sibling),x=o(A,S.props.children),x.return=y,y=x;break e}}else if(A.elementType===v||typeof v=="object"&&v!==null&&v.$$typeof===ox&&nee(v)===A.type){r(y,A.sibling),x=o(A,S.props),x.ref=ZP(y,A,S),x.return=y,y=x;break e}r(y,A);break}else t(y,A);A=A.sibling}S.type===lv?(x=O0(S.props.children,y.mode,I,S.key),x.return=y,y=x):(I=Cw(S.type,S.key,S.props,null,y.mode,I),I.ref=ZP(y,x,S),I.return=y,y=I)}return a(y);case sv:e:{for(A=S.key;x!==null;){if(x.key===A)if(x.tag===4&&x.stateNode.containerInfo===S.containerInfo&&x.stateNode.implementation===S.implementation){r(y,x.sibling),x=o(x,S.children||[]),x.return=y,y=x;break e}else{r(y,x);break}else t(y,x);x=x.sibling}x=NU(S,y.mode,I),x.return=y,y=x}return a(y);case ox:return A=S._init,g(y,x,A(S._payload),I)}if($P(S))return h(y,x,S,I);if(jP(S))return f(y,x,S,I);sw(y,S)}return typeof S=="string"&&S!==""||typeof S=="number"?(S=""+S,x!==null&&x.tag===6?(r(y,x.sibling),x=o(x,S),x.return=y,y=x):(r(y,x),x=UU(S,y.mode,I),x.return=y,y=x),a(y)):r(y,x)}return g}var Rv=_te(!0),Rte=_te(!1),kw=Sx(null),Fw=null,gv=null,$N=null;function e5(){$N=gv=Fw=null}function t5(e){var t=kw.current;Sa(kw),e._currentValue=t}function yN(e,t,r){for(;e!==null;){var n=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,n!==null&&(n.childLanes|=t)):n!==null&&(n.childLanes&t)!==t&&(n.childLanes|=t),e===r)break;e=e.return}}function Iv(e,t){Fw=e,$N=gv=null,e=e.dependencies,e!==null&&e.firstContext!==null&&((e.lanes&t)!==0&&(gm=!0),e.firstContext=null)}function op(e){var t=e._currentValue;if($N!==e)if(e={context:e,memoizedValue:t,next:null},gv===null){if(Fw===null)throw Error(er(308));gv=e,Fw.dependencies={lanes:0,firstContext:e}}else gv=gv.next=e;return t}var F0=null;function r5(e){F0===null?F0=[e]:F0.push(e)}function Dte(e,t,r,n){var o=t.interleaved;return o===null?(r.next=r,r5(t)):(r.next=o.next,o.next=r),t.interleaved=r,_y(e,n)}function _y(e,t){e.lanes|=t;var r=e.alternate;for(r!==null&&(r.lanes|=t),r=e,e=e.return;e!==null;)e.childLanes|=t,r=e.alternate,r!==null&&(r.childLanes|=t),r=e,e=e.return;return r.tag===3?r.stateNode:null}var ix=!1;function n5(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function wte(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Ay(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function fx(e,t,r){var n=e.updateQueue;if(n===null)return null;if(n=n.shared,(ti&2)!==0){var o=n.pending;return o===null?t.next=t:(t.next=o.next,o.next=t),n.pending=t,_y(e,r)}return o=n.interleaved,o===null?(t.next=t,r5(n)):(t.next=o.next,o.next=t),n.interleaved=t,_y(e,r)}function fw(e,t,r){if(t=t.updateQueue,t!==null&&(t=t.shared,(r&4194240)!==0)){var n=t.lanes;n&=e.pendingLanes,r|=n,t.lanes=r,zN(e,r)}}function oee(e,t){var r=e.updateQueue,n=e.alternate;if(n!==null&&(n=n.updateQueue,r===n)){var o=null,i=null;if(r=r.firstBaseUpdate,r!==null){do{var a={eventTime:r.eventTime,lane:r.lane,tag:r.tag,payload:r.payload,callback:r.callback,next:null};i===null?o=i=a:i=i.next=a,r=r.next}while(r!==null);i===null?o=i=t:i=i.next=t}else o=i=t;r={baseState:n.baseState,firstBaseUpdate:o,lastBaseUpdate:i,shared:n.shared,effects:n.effects},e.updateQueue=r;return}e=r.lastBaseUpdate,e===null?r.firstBaseUpdate=t:e.next=t,r.lastBaseUpdate=t}function Lw(e,t,r,n){var o=e.updateQueue;ix=!1;var i=o.firstBaseUpdate,a=o.lastBaseUpdate,s=o.shared.pending;if(s!==null){o.shared.pending=null;var l=s,u=l.next;l.next=null,a===null?i=u:a.next=u,a=l;var c=e.alternate;c!==null&&(c=c.updateQueue,s=c.lastBaseUpdate,s!==a&&(s===null?c.firstBaseUpdate=u:s.next=u,c.lastBaseUpdate=l))}if(i!==null){var m=o.baseState;a=0,c=u=l=null,s=i;do{var d=s.lane,p=s.eventTime;if((n&d)===d){c!==null&&(c=c.next={eventTime:p,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var h=e,f=s;switch(d=t,p=r,f.tag){case 1:if(h=f.payload,typeof h=="function"){m=h.call(p,m,d);break e}m=h;break e;case 3:h.flags=h.flags&-65537|128;case 0:if(h=f.payload,d=typeof h=="function"?h.call(p,m,d):h,d==null)break e;m=qa({},m,d);break e;case 2:ix=!0}}s.callback!==null&&s.lane!==0&&(e.flags|=64,d=o.effects,d===null?o.effects=[s]:d.push(s))}else p={eventTime:p,lane:d,tag:s.tag,payload:s.payload,callback:s.callback,next:null},c===null?(u=c=p,l=m):c=c.next=p,a|=d;if(s=s.next,s===null){if(s=o.shared.pending,s===null)break;d=s,s=d.next,d.next=null,o.lastBaseUpdate=d,o.shared.pending=null}}while(!0);if(c===null&&(l=m),o.baseState=l,o.firstBaseUpdate=u,o.lastBaseUpdate=c,t=o.shared.interleaved,t!==null){o=t;do a|=o.lane,o=o.next;while(o!==t)}else i===null&&(o.shared.lanes=0);z0|=a,e.lanes=a,e.memoizedState=m}}function iee(e,t,r){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var n=e[t],o=n.callback;if(o!==null){if(n.callback=null,n=r,typeof o!="function")throw Error(er(191,o));o.call(n)}}}var M2={},Fh=Sx(M2),v2=Sx(M2),I2=Sx(M2);function L0(e){if(e===M2)throw Error(er(174));return e}function o5(e,t){switch(la(I2,t),la(v2,e),la(Fh,M2),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:KU(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=KU(t,e)}Sa(Fh),la(Fh,t)}function Dv(){Sa(Fh),Sa(v2),Sa(I2)}function Mte(e){L0(I2.current);var t=L0(Fh.current),r=KU(t,e.type);t!==r&&(la(v2,e),la(Fh,r))}function i5(e){v2.current===e&&(Sa(Fh),Sa(v2))}var Qa=Sx(0);function Vw(e){for(var t=e;t!==null;){if(t.tag===13){var r=t.memoizedState;if(r!==null&&(r=r.dehydrated,r===null||r.data==="$?"||r.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if((t.flags&128)!==0)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var kU=[];function a5(){for(var e=0;e<kU.length;e++)kU[e]._workInProgressVersionPrimary=null;kU.length=0}var hw=Dy.ReactCurrentDispatcher,FU=Dy.ReactCurrentBatchConfig,N0=0,Za=null,Cl=null,Gl=null,Ow=!1,s2=!1,A2=0,pFe=0;function qu(){throw Error(er(321))}function s5(e,t){if(t===null)return!1;for(var r=0;r<t.length&&r<e.length;r++)if(!Df(e[r],t[r]))return!1;return!0}function l5(e,t,r,n,o,i){if(N0=i,Za=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,hw.current=e===null||e.memoizedState===null?yFe:bFe,e=r(n,o),s2){i=0;do{if(s2=!1,A2=0,25<=i)throw Error(er(301));i+=1,Gl=Cl=null,t.updateQueue=null,hw.current=xFe,e=r(n,o)}while(s2)}if(hw.current=Gw,t=Cl!==null&&Cl.next!==null,N0=0,Gl=Cl=Za=null,Ow=!1,t)throw Error(er(300));return e}function u5(){var e=A2!==0;return A2=0,e}function Bh(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Gl===null?Za.memoizedState=Gl=e:Gl=Gl.next=e,Gl}function ip(){if(Cl===null){var e=Za.alternate;e=e!==null?e.memoizedState:null}else e=Cl.next;var t=Gl===null?Za.memoizedState:Gl.next;if(t!==null)Gl=t,Cl=e;else{if(e===null)throw Error(er(310));Cl=e,e={memoizedState:Cl.memoizedState,baseState:Cl.baseState,baseQueue:Cl.baseQueue,queue:Cl.queue,next:null},Gl===null?Za.memoizedState=Gl=e:Gl=Gl.next=e}return Gl}function T2(e,t){return typeof t=="function"?t(e):t}function LU(e){var t=ip(),r=t.queue;if(r===null)throw Error(er(311));r.lastRenderedReducer=e;var n=Cl,o=n.baseQueue,i=r.pending;if(i!==null){if(o!==null){var a=o.next;o.next=i.next,i.next=a}n.baseQueue=o=i,r.pending=null}if(o!==null){i=o.next,n=n.baseState;var s=a=null,l=null,u=i;do{var c=u.lane;if((N0&c)===c)l!==null&&(l=l.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),n=u.hasEagerState?u.eagerState:e(n,u.action);else{var m={lane:c,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};l===null?(s=l=m,a=n):l=l.next=m,Za.lanes|=c,z0|=c}u=u.next}while(u!==null&&u!==i);l===null?a=n:l.next=s,Df(n,t.memoizedState)||(gm=!0),t.memoizedState=n,t.baseState=a,t.baseQueue=l,r.lastRenderedState=n}if(e=r.interleaved,e!==null){o=e;do i=o.lane,Za.lanes|=i,z0|=i,o=o.next;while(o!==e)}else o===null&&(r.lanes=0);return[t.memoizedState,r.dispatch]}function VU(e){var t=ip(),r=t.queue;if(r===null)throw Error(er(311));r.lastRenderedReducer=e;var n=r.dispatch,o=r.pending,i=t.memoizedState;if(o!==null){r.pending=null;var a=o=o.next;do i=e(i,a.action),a=a.next;while(a!==o);Df(i,t.memoizedState)||(gm=!0),t.memoizedState=i,t.baseQueue===null&&(t.baseState=i),r.lastRenderedState=i}return[i,n]}function Bte(){}function Ete(e,t){var r=Za,n=ip(),o=t(),i=!Df(n.memoizedState,o);if(i&&(n.memoizedState=o,gm=!0),n=n.queue,c5(Lte.bind(null,r,n,e),[e]),n.getSnapshot!==t||i||Gl!==null&&Gl.memoizedState.tag&1){if(r.flags|=2048,P2(9,Fte.bind(null,r,n,o,t),void 0,null),Ul===null)throw Error(er(349));(N0&30)!==0||kte(r,t,o)}return o}function kte(e,t,r){e.flags|=16384,e={getSnapshot:t,value:r},t=Za.updateQueue,t===null?(t={lastEffect:null,stores:null},Za.updateQueue=t,t.stores=[e]):(r=t.stores,r===null?t.stores=[e]:r.push(e))}function Fte(e,t,r,n){t.value=r,t.getSnapshot=n,Vte(t)&&Ote(e)}function Lte(e,t,r){return r(function(){Vte(t)&&Ote(e)})}function Vte(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!Df(e,r)}catch{return!0}}function Ote(e){var t=_y(e,1);t!==null&&Rf(t,e,1,-1)}function aee(e){var t=Bh();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:T2,lastRenderedState:e},t.queue=e,e=e.dispatch=gFe.bind(null,Za,e),[t.memoizedState,e]}function P2(e,t,r,n){return e={tag:e,create:t,destroy:r,deps:n,next:null},t=Za.updateQueue,t===null?(t={lastEffect:null,stores:null},Za.updateQueue=t,t.lastEffect=e.next=e):(r=t.lastEffect,r===null?t.lastEffect=e.next=e:(n=r.next,r.next=e,e.next=n,t.lastEffect=e)),e}function Gte(){return ip().memoizedState}function gw(e,t,r,n){var o=Bh();Za.flags|=e,o.memoizedState=P2(1|t,r,void 0,n===void 0?null:n)}function Kw(e,t,r,n){var o=ip();n=n===void 0?null:n;var i=void 0;if(Cl!==null){var a=Cl.memoizedState;if(i=a.destroy,n!==null&&s5(n,a.deps)){o.memoizedState=P2(t,r,i,n);return}}Za.flags|=e,o.memoizedState=P2(1|t,r,i,n)}function see(e,t){return gw(8390656,8,e,t)}function c5(e,t){return Kw(2048,8,e,t)}function Ute(e,t){return Kw(4,2,e,t)}function Nte(e,t){return Kw(4,4,e,t)}function zte(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function Hte(e,t,r){return r=r!=null?r.concat([e]):null,Kw(4,4,zte.bind(null,t,e),r)}function m5(){}function jte(e,t){var r=ip();t=t===void 0?null:t;var n=r.memoizedState;return n!==null&&t!==null&&s5(t,n[1])?n[0]:(r.memoizedState=[e,t],e)}function Wte(e,t){var r=ip();t=t===void 0?null:t;var n=r.memoizedState;return n!==null&&t!==null&&s5(t,n[1])?n[0]:(e=e(),r.memoizedState=[e,t],e)}function Xte(e,t,r){return(N0&21)===0?(e.baseState&&(e.baseState=!1,gm=!0),e.memoizedState=r):(Df(r,t)||(r=Kee(),Za.lanes|=r,z0|=r,e.baseState=!0),t)}function fFe(e,t){var r=Bi;Bi=r!==0&&4>r?r:4,e(!0);var n=FU.transition;FU.transition={};try{e(!1),t()}finally{Bi=r,FU.transition=n}}function Qte(){return ip().memoizedState}function hFe(e,t,r){var n=gx(e);if(r={lane:n,action:r,hasEagerState:!1,eagerState:null,next:null},Zte(e))qte(t,r);else if(r=Dte(e,t,r,n),r!==null){var o=Dc();Rf(r,e,n,o),Yte(r,t,n)}}function gFe(e,t,r){var n=gx(e),o={lane:n,action:r,hasEagerState:!1,eagerState:null,next:null};if(Zte(e))qte(t,o);else{var i=e.alternate;if(e.lanes===0&&(i===null||i.lanes===0)&&(i=t.lastRenderedReducer,i!==null))try{var a=t.lastRenderedState,s=i(a,r);if(o.hasEagerState=!0,o.eagerState=s,Df(s,a)){var l=t.interleaved;l===null?(o.next=o,r5(t)):(o.next=l.next,l.next=o),t.interleaved=o;return}}catch{}r=Dte(e,t,o,n),r!==null&&(o=Dc(),Rf(r,e,n,o),Yte(r,t,n))}}function Zte(e){var t=e.alternate;return e===Za||t!==null&&t===Za}function qte(e,t){s2=Ow=!0;var r=e.pending;r===null?t.next=t:(t.next=r.next,r.next=t),e.pending=t}function Yte(e,t,r){if((r&4194240)!==0){var n=t.lanes;n&=e.pendingLanes,r|=n,t.lanes=r,zN(e,r)}}var Gw={readContext:op,useCallback:qu,useContext:qu,useEffect:qu,useImperativeHandle:qu,useInsertionEffect:qu,useLayoutEffect:qu,useMemo:qu,useReducer:qu,useRef:qu,useState:qu,useDebugValue:qu,useDeferredValue:qu,useTransition:qu,useMutableSource:qu,useSyncExternalStore:qu,useId:qu,unstable_isNewReconciler:!1},yFe={readContext:op,useCallback:function(e,t){return Bh().memoizedState=[e,t===void 0?null:t],e},useContext:op,useEffect:see,useImperativeHandle:function(e,t,r){return r=r!=null?r.concat([e]):null,gw(4194308,4,zte.bind(null,t,e),r)},useLayoutEffect:function(e,t){return gw(4194308,4,e,t)},useInsertionEffect:function(e,t){return gw(4,2,e,t)},useMemo:function(e,t){var r=Bh();return t=t===void 0?null:t,e=e(),r.memoizedState=[e,t],e},useReducer:function(e,t,r){var n=Bh();return t=r!==void 0?r(t):t,n.memoizedState=n.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},n.queue=e,e=e.dispatch=hFe.bind(null,Za,e),[n.memoizedState,e]},useRef:function(e){var t=Bh();return e={current:e},t.memoizedState=e},useState:aee,useDebugValue:m5,useDeferredValue:function(e){return Bh().memoizedState=e},useTransition:function(){var e=aee(!1),t=e[0];return e=fFe.bind(null,e[1]),Bh().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,r){var n=Za,o=Bh();if(wa){if(r===void 0)throw Error(er(407));r=r()}else{if(r=t(),Ul===null)throw Error(er(349));(N0&30)!==0||kte(n,t,r)}o.memoizedState=r;var i={value:r,getSnapshot:t};return o.queue=i,see(Lte.bind(null,n,i,e),[e]),n.flags|=2048,P2(9,Fte.bind(null,n,i,r,t),void 0,null),r},useId:function(){var e=Bh(),t=Ul.identifierPrefix;if(wa){var r=Iy,n=vy;r=(n&~(1<<32-_f(n)-1)).toString(32)+r,t=":"+t+"R"+r,r=A2++,0<r&&(t+="H"+r.toString(32)),t+=":"}else r=pFe++,t=":"+t+"r"+r.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},bFe={readContext:op,useCallback:jte,useContext:op,useEffect:c5,useImperativeHandle:Hte,useInsertionEffect:Ute,useLayoutEffect:Nte,useMemo:Wte,useReducer:LU,useRef:Gte,useState:function(){return LU(T2)},useDebugValue:m5,useDeferredValue:function(e){var t=ip();return Xte(t,Cl.memoizedState,e)},useTransition:function(){var e=LU(T2)[0],t=ip().memoizedState;return[e,t]},useMutableSource:Bte,useSyncExternalStore:Ete,useId:Qte,unstable_isNewReconciler:!1},xFe={readContext:op,useCallback:jte,useContext:op,useEffect:c5,useImperativeHandle:Hte,useInsertionEffect:Ute,useLayoutEffect:Nte,useMemo:Wte,useReducer:VU,useRef:Gte,useState:function(){return VU(T2)},useDebugValue:m5,useDeferredValue:function(e){var t=ip();return Cl===null?t.memoizedState=e:Xte(t,Cl.memoizedState,e)},useTransition:function(){var e=VU(T2)[0],t=ip().memoizedState;return[e,t]},useMutableSource:Bte,useSyncExternalStore:Ete,useId:Qte,unstable_isNewReconciler:!1};function Af(e,t){if(e&&e.defaultProps){t=qa({},t),e=e.defaultProps;for(var r in e)t[r]===void 0&&(t[r]=e[r]);return t}return t}function bN(e,t,r,n){t=e.memoizedState,r=r(n,t),r=r==null?t:qa({},t,r),e.memoizedState=r,e.lanes===0&&(e.updateQueue.baseState=r)}var Jw={isMounted:function(e){return(e=e._reactInternals)?W0(e)===e:!1},enqueueSetState:function(e,t,r){e=e._reactInternals;var n=Dc(),o=gx(e),i=Ay(n,o);i.payload=t,r!=null&&(i.callback=r),t=fx(e,i,o),t!==null&&(Rf(t,e,o,n),fw(t,e,o))},enqueueReplaceState:function(e,t,r){e=e._reactInternals;var n=Dc(),o=gx(e),i=Ay(n,o);i.tag=1,i.payload=t,r!=null&&(i.callback=r),t=fx(e,i,o),t!==null&&(Rf(t,e,o,n),fw(t,e,o))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var r=Dc(),n=gx(e),o=Ay(r,n);o.tag=2,t!=null&&(o.callback=t),t=fx(e,o,n),t!==null&&(Rf(t,e,n,r),fw(t,e,n))}};function lee(e,t,r,n,o,i,a){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(n,i,a):t.prototype&&t.prototype.isPureReactComponent?!b2(r,n)||!b2(o,i):!0}function Kte(e,t,r){var n=!1,o=xx,i=t.contextType;return typeof i=="object"&&i!==null?i=op(i):(o=bm(t)?G0:Ju.current,n=t.contextTypes,i=(n=n!=null)?Pv(e,o):xx),t=new t(r,i),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=Jw,e.stateNode=t,t._reactInternals=e,n&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=o,e.__reactInternalMemoizedMaskedChildContext=i),t}function uee(e,t,r,n){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(r,n),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(r,n),t.state!==e&&Jw.enqueueReplaceState(t,t.state,null)}function xN(e,t,r,n){var o=e.stateNode;o.props=r,o.state=e.memoizedState,o.refs={},n5(e);var i=t.contextType;typeof i=="object"&&i!==null?o.context=op(i):(i=bm(t)?G0:Ju.current,o.context=Pv(e,i)),o.state=e.memoizedState,i=t.getDerivedStateFromProps,typeof i=="function"&&(bN(e,t,i,r),o.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof o.getSnapshotBeforeUpdate=="function"||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(t=o.state,typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount(),t!==o.state&&Jw.enqueueReplaceState(o,o.state,null),Lw(e,r,o,n),o.state=e.memoizedState),typeof o.componentDidMount=="function"&&(e.flags|=4194308)}function wv(e,t){try{var r="",n=t;do r+=qEe(n),n=n.return;while(n);var o=r}catch(i){o=`
Error generating stack: `+i.message+`
`+i.stack}return{value:e,source:t,stack:o,digest:null}}function OU(e,t,r){return{value:e,source:null,stack:r??null,digest:t??null}}function CN(e,t){try{console.error(t.value)}catch(r){setTimeout(function(){throw r})}}var CFe=typeof WeakMap=="function"?WeakMap:Map;function Jte(e,t,r){r=Ay(-1,r),r.tag=3,r.payload={element:null};var n=t.value;return r.callback=function(){Nw||(Nw=!0,wN=n),CN(e,t)},r}function $te(e,t,r){r=Ay(-1,r),r.tag=3;var n=e.type.getDerivedStateFromError;if(typeof n=="function"){var o=t.value;r.payload=function(){return n(o)},r.callback=function(){CN(e,t)}}var i=e.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(r.callback=function(){CN(e,t),typeof n!="function"&&(hx===null?hx=new Set([this]):hx.add(this));var a=t.stack;this.componentDidCatch(t.value,{componentStack:a!==null?a:""})}),r}function cee(e,t,r){var n=e.pingCache;if(n===null){n=e.pingCache=new CFe;var o=new Set;n.set(t,o)}else o=n.get(t),o===void 0&&(o=new Set,n.set(t,o));o.has(r)||(o.add(r),e=kFe.bind(null,e,t,r),t.then(e,e))}function mee(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function dee(e,t,r,n,o){return(e.mode&1)===0?(e===t?e.flags|=65536:(e.flags|=128,r.flags|=131072,r.flags&=-52805,r.tag===1&&(r.alternate===null?r.tag=17:(t=Ay(-1,1),t.tag=2,fx(r,t,1))),r.lanes|=1),e):(e.flags|=65536,e.lanes=o,e)}var SFe=Dy.ReactCurrentOwner,gm=!1;function Rc(e,t,r,n){t.child=e===null?Rte(t,null,r,n):Rv(t,e.child,r,n)}function pee(e,t,r,n,o){r=r.render;var i=t.ref;return Iv(t,o),n=l5(e,t,r,n,i,o),r=u5(),e!==null&&!gm?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~o,Ry(e,t,o)):(wa&&r&&YN(t),t.flags|=1,Rc(e,t,n,o),t.child)}function fee(e,t,r,n,o){if(e===null){var i=r.type;return typeof i=="function"&&!x5(i)&&i.defaultProps===void 0&&r.compare===null&&r.defaultProps===void 0?(t.tag=15,t.type=i,ere(e,t,i,n,o)):(e=Cw(r.type,null,n,t,t.mode,o),e.ref=t.ref,e.return=t,t.child=e)}if(i=e.child,(e.lanes&o)===0){var a=i.memoizedProps;if(r=r.compare,r=r!==null?r:b2,r(a,n)&&e.ref===t.ref)return Ry(e,t,o)}return t.flags|=1,e=yx(i,n),e.ref=t.ref,e.return=t,t.child=e}function ere(e,t,r,n,o){if(e!==null){var i=e.memoizedProps;if(b2(i,n)&&e.ref===t.ref)if(gm=!1,t.pendingProps=n=i,(e.lanes&o)!==0)(e.flags&131072)!==0&&(gm=!0);else return t.lanes=e.lanes,Ry(e,t,o)}return SN(e,t,r,n,o)}function tre(e,t,r){var n=t.pendingProps,o=n.children,i=e!==null?e.memoizedState:null;if(n.mode==="hidden")if((t.mode&1)===0)t.memoizedState={baseLanes:0,cachePool:null,transitions:null},la(bv,nd),nd|=r;else{if((r&1073741824)===0)return e=i!==null?i.baseLanes|r:r,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,la(bv,nd),nd|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},n=i!==null?i.baseLanes:r,la(bv,nd),nd|=n}else i!==null?(n=i.baseLanes|r,t.memoizedState=null):n=r,la(bv,nd),nd|=n;return Rc(e,t,o,r),t.child}function rre(e,t){var r=t.ref;(e===null&&r!==null||e!==null&&e.ref!==r)&&(t.flags|=512,t.flags|=2097152)}function SN(e,t,r,n,o){var i=bm(r)?G0:Ju.current;return i=Pv(t,i),Iv(t,o),r=l5(e,t,r,n,i,o),n=u5(),e!==null&&!gm?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~o,Ry(e,t,o)):(wa&&n&&YN(t),t.flags|=1,Rc(e,t,r,o),t.child)}function hee(e,t,r,n,o){if(bm(r)){var i=!0;Mw(t)}else i=!1;if(Iv(t,o),t.stateNode===null)yw(e,t),Kte(t,r,n),xN(t,r,n,o),n=!0;else if(e===null){var a=t.stateNode,s=t.memoizedProps;a.props=s;var l=a.context,u=r.contextType;typeof u=="object"&&u!==null?u=op(u):(u=bm(r)?G0:Ju.current,u=Pv(t,u));var c=r.getDerivedStateFromProps,m=typeof c=="function"||typeof a.getSnapshotBeforeUpdate=="function";m||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(s!==n||l!==u)&&uee(t,a,n,u),ix=!1;var d=t.memoizedState;a.state=d,Lw(t,n,a,o),l=t.memoizedState,s!==n||d!==l||ym.current||ix?(typeof c=="function"&&(bN(t,r,c,n),l=t.memoizedState),(s=ix||lee(t,r,s,n,d,l,u))?(m||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount()),typeof a.componentDidMount=="function"&&(t.flags|=4194308)):(typeof a.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=n,t.memoizedState=l),a.props=n,a.state=l,a.context=u,n=s):(typeof a.componentDidMount=="function"&&(t.flags|=4194308),n=!1)}else{a=t.stateNode,wte(e,t),s=t.memoizedProps,u=t.type===t.elementType?s:Af(t.type,s),a.props=u,m=t.pendingProps,d=a.context,l=r.contextType,typeof l=="object"&&l!==null?l=op(l):(l=bm(r)?G0:Ju.current,l=Pv(t,l));var p=r.getDerivedStateFromProps;(c=typeof p=="function"||typeof a.getSnapshotBeforeUpdate=="function")||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(s!==m||d!==l)&&uee(t,a,n,l),ix=!1,d=t.memoizedState,a.state=d,Lw(t,n,a,o);var h=t.memoizedState;s!==m||d!==h||ym.current||ix?(typeof p=="function"&&(bN(t,r,p,n),h=t.memoizedState),(u=ix||lee(t,r,u,n,d,h,l)||!1)?(c||typeof a.UNSAFE_componentWillUpdate!="function"&&typeof a.componentWillUpdate!="function"||(typeof a.componentWillUpdate=="function"&&a.componentWillUpdate(n,h,l),typeof a.UNSAFE_componentWillUpdate=="function"&&a.UNSAFE_componentWillUpdate(n,h,l)),typeof a.componentDidUpdate=="function"&&(t.flags|=4),typeof a.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof a.componentDidUpdate!="function"||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),t.memoizedProps=n,t.memoizedState=h),a.props=n,a.state=h,a.context=l,n=u):(typeof a.componentDidUpdate!="function"||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),n=!1)}return vN(e,t,r,n,i,o)}function vN(e,t,r,n,o,i){rre(e,t);var a=(t.flags&128)!==0;if(!n&&!a)return o&&eee(t,r,!1),Ry(e,t,i);n=t.stateNode,SFe.current=t;var s=a&&typeof r.getDerivedStateFromError!="function"?null:n.render();return t.flags|=1,e!==null&&a?(t.child=Rv(t,e.child,null,i),t.child=Rv(t,null,s,i)):Rc(e,t,s,i),t.memoizedState=n.state,o&&eee(t,r,!0),t.child}function nre(e){var t=e.stateNode;t.pendingContext?$$(e,t.pendingContext,t.pendingContext!==t.context):t.context&&$$(e,t.context,!1),o5(e,t.containerInfo)}function gee(e,t,r,n,o){return _v(),JN(o),t.flags|=256,Rc(e,t,r,n),t.child}var IN={dehydrated:null,treeContext:null,retryLane:0};function AN(e){return{baseLanes:e,cachePool:null,transitions:null}}function ore(e,t,r){var n=t.pendingProps,o=Qa.current,i=!1,a=(t.flags&128)!==0,s;if((s=a)||(s=e!==null&&e.memoizedState===null?!1:(o&2)!==0),s?(i=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(o|=1),la(Qa,o&1),e===null)return gN(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?((t.mode&1)===0?t.lanes=1:e.data==="$!"?t.lanes=8:t.lanes=1073741824,null):(a=n.children,e=n.fallback,i?(n=t.mode,i=t.child,a={mode:"hidden",children:a},(n&1)===0&&i!==null?(i.childLanes=0,i.pendingProps=a):i=tM(a,n,0,null),e=O0(e,n,r,null),i.return=t,e.return=t,i.sibling=e,t.child=i,t.child.memoizedState=AN(r),t.memoizedState=IN,e):d5(t,a));if(o=e.memoizedState,o!==null&&(s=o.dehydrated,s!==null))return vFe(e,t,a,n,s,o,r);if(i){i=n.fallback,a=t.mode,o=e.child,s=o.sibling;var l={mode:"hidden",children:n.children};return(a&1)===0&&t.child!==o?(n=t.child,n.childLanes=0,n.pendingProps=l,t.deletions=null):(n=yx(o,l),n.subtreeFlags=o.subtreeFlags&14680064),s!==null?i=yx(s,i):(i=O0(i,a,r,null),i.flags|=2),i.return=t,n.return=t,n.sibling=i,t.child=n,n=i,i=t.child,a=e.child.memoizedState,a=a===null?AN(r):{baseLanes:a.baseLanes|r,cachePool:null,transitions:a.transitions},i.memoizedState=a,i.childLanes=e.childLanes&~r,t.memoizedState=IN,n}return i=e.child,e=i.sibling,n=yx(i,{mode:"visible",children:n.children}),(t.mode&1)===0&&(n.lanes=r),n.return=t,n.sibling=null,e!==null&&(r=t.deletions,r===null?(t.deletions=[e],t.flags|=16):r.push(e)),t.child=n,t.memoizedState=null,n}function d5(e,t){return t=tM({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function lw(e,t,r,n){return n!==null&&JN(n),Rv(t,e.child,null,r),e=d5(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function vFe(e,t,r,n,o,i,a){if(r)return t.flags&256?(t.flags&=-257,n=OU(Error(er(422))),lw(e,t,a,n)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(i=n.fallback,o=t.mode,n=tM({mode:"visible",children:n.children},o,0,null),i=O0(i,o,a,null),i.flags|=2,n.return=t,i.return=t,n.sibling=i,t.child=n,(t.mode&1)!==0&&Rv(t,e.child,null,a),t.child.memoizedState=AN(a),t.memoizedState=IN,i);if((t.mode&1)===0)return lw(e,t,a,null);if(o.data==="$!"){if(n=o.nextSibling&&o.nextSibling.dataset,n)var s=n.dgst;return n=s,i=Error(er(419)),n=OU(i,n,void 0),lw(e,t,a,n)}if(s=(a&e.childLanes)!==0,gm||s){if(n=Ul,n!==null){switch(a&-a){case 4:o=2;break;case 16:o=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:o=32;break;case 536870912:o=268435456;break;default:o=0}o=(o&(n.suspendedLanes|a))!==0?0:o,o!==0&&o!==i.retryLane&&(i.retryLane=o,_y(e,o),Rf(n,e,o,-1))}return b5(),n=OU(Error(er(421))),lw(e,t,a,n)}return o.data==="$?"?(t.flags|=128,t.child=e.child,t=FFe.bind(null,e),o._reactRetry=t,null):(e=i.treeContext,od=px(o.nextSibling),id=t,wa=!0,Pf=null,e!==null&&(ep[tp++]=vy,ep[tp++]=Iy,ep[tp++]=U0,vy=e.id,Iy=e.overflow,U0=t),t=d5(t,n.children),t.flags|=4096,t)}function yee(e,t,r){e.lanes|=t;var n=e.alternate;n!==null&&(n.lanes|=t),yN(e.return,t,r)}function GU(e,t,r,n,o){var i=e.memoizedState;i===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:n,tail:r,tailMode:o}:(i.isBackwards=t,i.rendering=null,i.renderingStartTime=0,i.last=n,i.tail=r,i.tailMode=o)}function ire(e,t,r){var n=t.pendingProps,o=n.revealOrder,i=n.tail;if(Rc(e,t,n.children,r),n=Qa.current,(n&2)!==0)n=n&1|2,t.flags|=128;else{if(e!==null&&(e.flags&128)!==0)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&yee(e,r,t);else if(e.tag===19)yee(e,r,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}n&=1}if(la(Qa,n),(t.mode&1)===0)t.memoizedState=null;else switch(o){case"forwards":for(r=t.child,o=null;r!==null;)e=r.alternate,e!==null&&Vw(e)===null&&(o=r),r=r.sibling;r=o,r===null?(o=t.child,t.child=null):(o=r.sibling,r.sibling=null),GU(t,!1,o,r,i);break;case"backwards":for(r=null,o=t.child,t.child=null;o!==null;){if(e=o.alternate,e!==null&&Vw(e)===null){t.child=o;break}e=o.sibling,o.sibling=r,r=o,o=e}GU(t,!0,r,null,i);break;case"together":GU(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function yw(e,t){(t.mode&1)===0&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Ry(e,t,r){if(e!==null&&(t.dependencies=e.dependencies),z0|=t.lanes,(r&t.childLanes)===0)return null;if(e!==null&&t.child!==e.child)throw Error(er(153));if(t.child!==null){for(e=t.child,r=yx(e,e.pendingProps),t.child=r,r.return=t;e.sibling!==null;)e=e.sibling,r=r.sibling=yx(e,e.pendingProps),r.return=t;r.sibling=null}return t.child}function IFe(e,t,r){switch(t.tag){case 3:nre(t),_v();break;case 5:Mte(t);break;case 1:bm(t.type)&&Mw(t);break;case 4:o5(t,t.stateNode.containerInfo);break;case 10:var n=t.type._context,o=t.memoizedProps.value;la(kw,n._currentValue),n._currentValue=o;break;case 13:if(n=t.memoizedState,n!==null)return n.dehydrated!==null?(la(Qa,Qa.current&1),t.flags|=128,null):(r&t.child.childLanes)!==0?ore(e,t,r):(la(Qa,Qa.current&1),e=Ry(e,t,r),e!==null?e.sibling:null);la(Qa,Qa.current&1);break;case 19:if(n=(r&t.childLanes)!==0,(e.flags&128)!==0){if(n)return ire(e,t,r);t.flags|=128}if(o=t.memoizedState,o!==null&&(o.rendering=null,o.tail=null,o.lastEffect=null),la(Qa,Qa.current),n)break;return null;case 22:case 23:return t.lanes=0,tre(e,t,r)}return Ry(e,t,r)}var are,TN,sre,lre;are=function(e,t){for(var r=t.child;r!==null;){if(r.tag===5||r.tag===6)e.appendChild(r.stateNode);else if(r.tag!==4&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===t)break;for(;r.sibling===null;){if(r.return===null||r.return===t)return;r=r.return}r.sibling.return=r.return,r=r.sibling}};TN=function(){};sre=function(e,t,r,n){var o=e.memoizedProps;if(o!==n){e=t.stateNode,L0(Fh.current);var i=null;switch(r){case"input":o=QU(e,o),n=QU(e,n),i=[];break;case"select":o=qa({},o,{value:void 0}),n=qa({},n,{value:void 0}),i=[];break;case"textarea":o=YU(e,o),n=YU(e,n),i=[];break;default:typeof o.onClick!="function"&&typeof n.onClick=="function"&&(e.onclick=Dw)}JU(r,n);var a;r=null;for(u in o)if(!n.hasOwnProperty(u)&&o.hasOwnProperty(u)&&o[u]!=null)if(u==="style"){var s=o[u];for(a in s)s.hasOwnProperty(a)&&(r||(r={}),r[a]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(m2.hasOwnProperty(u)?i||(i=[]):(i=i||[]).push(u,null));for(u in n){var l=n[u];if(s=o?.[u],n.hasOwnProperty(u)&&l!==s&&(l!=null||s!=null))if(u==="style")if(s){for(a in s)!s.hasOwnProperty(a)||l&&l.hasOwnProperty(a)||(r||(r={}),r[a]="");for(a in l)l.hasOwnProperty(a)&&s[a]!==l[a]&&(r||(r={}),r[a]=l[a])}else r||(i||(i=[]),i.push(u,r)),r=l;else u==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,s=s?s.__html:void 0,l!=null&&s!==l&&(i=i||[]).push(u,l)):u==="children"?typeof l!="string"&&typeof l!="number"||(i=i||[]).push(u,""+l):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(m2.hasOwnProperty(u)?(l!=null&&u==="onScroll"&&Ca("scroll",e),i||s===l||(i=[])):(i=i||[]).push(u,l))}r&&(i=i||[]).push("style",r);var u=i;(t.updateQueue=u)&&(t.flags|=4)}};lre=function(e,t,r,n){r!==n&&(t.flags|=4)};function qP(e,t){if(!wa)switch(e.tailMode){case"hidden":t=e.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e.tail=null:r.sibling=null;break;case"collapsed":r=e.tail;for(var n=null;r!==null;)r.alternate!==null&&(n=r),r=r.sibling;n===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:n.sibling=null}}function Yu(e){var t=e.alternate!==null&&e.alternate.child===e.child,r=0,n=0;if(t)for(var o=e.child;o!==null;)r|=o.lanes|o.childLanes,n|=o.subtreeFlags&14680064,n|=o.flags&14680064,o.return=e,o=o.sibling;else for(o=e.child;o!==null;)r|=o.lanes|o.childLanes,n|=o.subtreeFlags,n|=o.flags,o.return=e,o=o.sibling;return e.subtreeFlags|=n,e.childLanes=r,t}function AFe(e,t,r){var n=t.pendingProps;switch(KN(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Yu(t),null;case 1:return bm(t.type)&&ww(),Yu(t),null;case 3:return n=t.stateNode,Dv(),Sa(ym),Sa(Ju),a5(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),(e===null||e.child===null)&&(aw(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&(t.flags&256)===0||(t.flags|=1024,Pf!==null&&(EN(Pf),Pf=null))),TN(e,t),Yu(t),null;case 5:i5(t);var o=L0(I2.current);if(r=t.type,e!==null&&t.stateNode!=null)sre(e,t,r,n,o),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!n){if(t.stateNode===null)throw Error(er(166));return Yu(t),null}if(e=L0(Fh.current),aw(t)){n=t.stateNode,r=t.type;var i=t.memoizedProps;switch(n[Eh]=t,n[S2]=i,e=(t.mode&1)!==0,r){case"dialog":Ca("cancel",n),Ca("close",n);break;case"iframe":case"object":case"embed":Ca("load",n);break;case"video":case"audio":for(o=0;o<t2.length;o++)Ca(t2[o],n);break;case"source":Ca("error",n);break;case"img":case"image":case"link":Ca("error",n),Ca("load",n);break;case"details":Ca("toggle",n);break;case"input":T$(n,i),Ca("invalid",n);break;case"select":n._wrapperState={wasMultiple:!!i.multiple},Ca("invalid",n);break;case"textarea":_$(n,i),Ca("invalid",n)}JU(r,i),o=null;for(var a in i)if(i.hasOwnProperty(a)){var s=i[a];a==="children"?typeof s=="string"?n.textContent!==s&&(i.suppressHydrationWarning!==!0&&iw(n.textContent,s,e),o=["children",s]):typeof s=="number"&&n.textContent!==""+s&&(i.suppressHydrationWarning!==!0&&iw(n.textContent,s,e),o=["children",""+s]):m2.hasOwnProperty(a)&&s!=null&&a==="onScroll"&&Ca("scroll",n)}switch(r){case"input":Q3(n),P$(n,i,!0);break;case"textarea":Q3(n),R$(n);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(n.onclick=Dw)}n=o,t.updateQueue=n,n!==null&&(t.flags|=4)}else{a=o.nodeType===9?o:o.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=Lee(r)),e==="http://www.w3.org/1999/xhtml"?r==="script"?(e=a.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof n.is=="string"?e=a.createElement(r,{is:n.is}):(e=a.createElement(r),r==="select"&&(a=e,n.multiple?a.multiple=!0:n.size&&(a.size=n.size))):e=a.createElementNS(e,r),e[Eh]=t,e[S2]=n,are(e,t,!1,!1),t.stateNode=e;e:{switch(a=$U(r,n),r){case"dialog":Ca("cancel",e),Ca("close",e),o=n;break;case"iframe":case"object":case"embed":Ca("load",e),o=n;break;case"video":case"audio":for(o=0;o<t2.length;o++)Ca(t2[o],e);o=n;break;case"source":Ca("error",e),o=n;break;case"img":case"image":case"link":Ca("error",e),Ca("load",e),o=n;break;case"details":Ca("toggle",e),o=n;break;case"input":T$(e,n),o=QU(e,n),Ca("invalid",e);break;case"option":o=n;break;case"select":e._wrapperState={wasMultiple:!!n.multiple},o=qa({},n,{value:void 0}),Ca("invalid",e);break;case"textarea":_$(e,n),o=YU(e,n),Ca("invalid",e);break;default:o=n}JU(r,o),s=o;for(i in s)if(s.hasOwnProperty(i)){var l=s[i];i==="style"?Gee(e,l):i==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&Vee(e,l)):i==="children"?typeof l=="string"?(r!=="textarea"||l!=="")&&d2(e,l):typeof l=="number"&&d2(e,""+l):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(m2.hasOwnProperty(i)?l!=null&&i==="onScroll"&&Ca("scroll",e):l!=null&&LN(e,i,l,a))}switch(r){case"input":Q3(e),P$(e,n,!1);break;case"textarea":Q3(e),R$(e);break;case"option":n.value!=null&&e.setAttribute("value",""+bx(n.value));break;case"select":e.multiple=!!n.multiple,i=n.value,i!=null?xv(e,!!n.multiple,i,!1):n.defaultValue!=null&&xv(e,!!n.multiple,n.defaultValue,!0);break;default:typeof o.onClick=="function"&&(e.onclick=Dw)}switch(r){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}}n&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return Yu(t),null;case 6:if(e&&t.stateNode!=null)lre(e,t,e.memoizedProps,n);else{if(typeof n!="string"&&t.stateNode===null)throw Error(er(166));if(r=L0(I2.current),L0(Fh.current),aw(t)){if(n=t.stateNode,r=t.memoizedProps,n[Eh]=t,(i=n.nodeValue!==r)&&(e=id,e!==null))switch(e.tag){case 3:iw(n.nodeValue,r,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&iw(n.nodeValue,r,(e.mode&1)!==0)}i&&(t.flags|=4)}else n=(r.nodeType===9?r:r.ownerDocument).createTextNode(n),n[Eh]=t,t.stateNode=n}return Yu(t),null;case 13:if(Sa(Qa),n=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(wa&&od!==null&&(t.mode&1)!==0&&(t.flags&128)===0)Pte(),_v(),t.flags|=98560,i=!1;else if(i=aw(t),n!==null&&n.dehydrated!==null){if(e===null){if(!i)throw Error(er(318));if(i=t.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(er(317));i[Eh]=t}else _v(),(t.flags&128)===0&&(t.memoizedState=null),t.flags|=4;Yu(t),i=!1}else Pf!==null&&(EN(Pf),Pf=null),i=!0;if(!i)return t.flags&65536?t:null}return(t.flags&128)!==0?(t.lanes=r,t):(n=n!==null,n!==(e!==null&&e.memoizedState!==null)&&n&&(t.child.flags|=8192,(t.mode&1)!==0&&(e===null||(Qa.current&1)!==0?Sl===0&&(Sl=3):b5())),t.updateQueue!==null&&(t.flags|=4),Yu(t),null);case 4:return Dv(),TN(e,t),e===null&&x2(t.stateNode.containerInfo),Yu(t),null;case 10:return t5(t.type._context),Yu(t),null;case 17:return bm(t.type)&&ww(),Yu(t),null;case 19:if(Sa(Qa),i=t.memoizedState,i===null)return Yu(t),null;if(n=(t.flags&128)!==0,a=i.rendering,a===null)if(n)qP(i,!1);else{if(Sl!==0||e!==null&&(e.flags&128)!==0)for(e=t.child;e!==null;){if(a=Vw(e),a!==null){for(t.flags|=128,qP(i,!1),n=a.updateQueue,n!==null&&(t.updateQueue=n,t.flags|=4),t.subtreeFlags=0,n=r,r=t.child;r!==null;)i=r,e=n,i.flags&=14680066,a=i.alternate,a===null?(i.childLanes=0,i.lanes=e,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=a.childLanes,i.lanes=a.lanes,i.child=a.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=a.memoizedProps,i.memoizedState=a.memoizedState,i.updateQueue=a.updateQueue,i.type=a.type,e=a.dependencies,i.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),r=r.sibling;return la(Qa,Qa.current&1|2),t.child}e=e.sibling}i.tail!==null&&Ls()>Mv&&(t.flags|=128,n=!0,qP(i,!1),t.lanes=4194304)}else{if(!n)if(e=Vw(a),e!==null){if(t.flags|=128,n=!0,r=e.updateQueue,r!==null&&(t.updateQueue=r,t.flags|=4),qP(i,!0),i.tail===null&&i.tailMode==="hidden"&&!a.alternate&&!wa)return Yu(t),null}else 2*Ls()-i.renderingStartTime>Mv&&r!==1073741824&&(t.flags|=128,n=!0,qP(i,!1),t.lanes=4194304);i.isBackwards?(a.sibling=t.child,t.child=a):(r=i.last,r!==null?r.sibling=a:t.child=a,i.last=a)}return i.tail!==null?(t=i.tail,i.rendering=t,i.tail=t.sibling,i.renderingStartTime=Ls(),t.sibling=null,r=Qa.current,la(Qa,n?r&1|2:r&1),t):(Yu(t),null);case 22:case 23:return y5(),n=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==n&&(t.flags|=8192),n&&(t.mode&1)!==0?(nd&1073741824)!==0&&(Yu(t),t.subtreeFlags&6&&(t.flags|=8192)):Yu(t),null;case 24:return null;case 25:return null}throw Error(er(156,t.tag))}function TFe(e,t){switch(KN(t),t.tag){case 1:return bm(t.type)&&ww(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return Dv(),Sa(ym),Sa(Ju),a5(),e=t.flags,(e&65536)!==0&&(e&128)===0?(t.flags=e&-65537|128,t):null;case 5:return i5(t),null;case 13:if(Sa(Qa),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(er(340));_v()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return Sa(Qa),null;case 4:return Dv(),null;case 10:return t5(t.type._context),null;case 22:case 23:return y5(),null;case 24:return null;default:return null}}var uw=!1,Ku=!1,PFe=typeof WeakSet=="function"?WeakSet:Set,Nr=null;function yv(e,t){var r=e.ref;if(r!==null)if(typeof r=="function")try{r(null)}catch(n){ps(e,t,n)}else r.current=null}function PN(e,t,r){try{r()}catch(n){ps(e,t,n)}}var bee=!1;function _Fe(e,t){if(uN=Pw,e=pte(),qN(e)){if("selectionStart"in e)var r={start:e.selectionStart,end:e.selectionEnd};else e:{r=(r=e.ownerDocument)&&r.defaultView||window;var n=r.getSelection&&r.getSelection();if(n&&n.rangeCount!==0){r=n.anchorNode;var o=n.anchorOffset,i=n.focusNode;n=n.focusOffset;try{r.nodeType,i.nodeType}catch{r=null;break e}var a=0,s=-1,l=-1,u=0,c=0,m=e,d=null;t:for(;;){for(var p;m!==r||o!==0&&m.nodeType!==3||(s=a+o),m!==i||n!==0&&m.nodeType!==3||(l=a+n),m.nodeType===3&&(a+=m.nodeValue.length),(p=m.firstChild)!==null;)d=m,m=p;for(;;){if(m===e)break t;if(d===r&&++u===o&&(s=a),d===i&&++c===n&&(l=a),(p=m.nextSibling)!==null)break;m=d,d=m.parentNode}m=p}r=s===-1||l===-1?null:{start:s,end:l}}else r=null}r=r||{start:0,end:0}}else r=null;for(cN={focusedElem:e,selectionRange:r},Pw=!1,Nr=t;Nr!==null;)if(t=Nr,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,Nr=e;else for(;Nr!==null;){t=Nr;try{var h=t.alternate;if((t.flags&1024)!==0)switch(t.tag){case 0:case 11:case 15:break;case 1:if(h!==null){var f=h.memoizedProps,g=h.memoizedState,y=t.stateNode,x=y.getSnapshotBeforeUpdate(t.elementType===t.type?f:Af(t.type,f),g);y.__reactInternalSnapshotBeforeUpdate=x}break;case 3:var S=t.stateNode.containerInfo;S.nodeType===1?S.textContent="":S.nodeType===9&&S.documentElement&&S.removeChild(S.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(er(163))}}catch(I){ps(t,t.return,I)}if(e=t.sibling,e!==null){e.return=t.return,Nr=e;break}Nr=t.return}return h=bee,bee=!1,h}function l2(e,t,r){var n=t.updateQueue;if(n=n!==null?n.lastEffect:null,n!==null){var o=n=n.next;do{if((o.tag&e)===e){var i=o.destroy;o.destroy=void 0,i!==void 0&&PN(t,r,i)}o=o.next}while(o!==n)}}function $w(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var r=t=t.next;do{if((r.tag&e)===e){var n=r.create;r.destroy=n()}r=r.next}while(r!==t)}}function _N(e){var t=e.ref;if(t!==null){var r=e.stateNode;e.tag,e=r,typeof t=="function"?t(e):t.current=e}}function ure(e){var t=e.alternate;t!==null&&(e.alternate=null,ure(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[Eh],delete t[S2],delete t[pN],delete t[uFe],delete t[cFe])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function cre(e){return e.tag===5||e.tag===3||e.tag===4}function xee(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||cre(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function RN(e,t,r){var n=e.tag;if(n===5||n===6)e=e.stateNode,t?r.nodeType===8?r.parentNode.insertBefore(e,t):r.insertBefore(e,t):(r.nodeType===8?(t=r.parentNode,t.insertBefore(e,r)):(t=r,t.appendChild(e)),r=r._reactRootContainer,r!=null||t.onclick!==null||(t.onclick=Dw));else if(n!==4&&(e=e.child,e!==null))for(RN(e,t,r),e=e.sibling;e!==null;)RN(e,t,r),e=e.sibling}function DN(e,t,r){var n=e.tag;if(n===5||n===6)e=e.stateNode,t?r.insertBefore(e,t):r.appendChild(e);else if(n!==4&&(e=e.child,e!==null))for(DN(e,t,r),e=e.sibling;e!==null;)DN(e,t,r),e=e.sibling}var Pu=null,Tf=!1;function nx(e,t,r){for(r=r.child;r!==null;)mre(e,t,r),r=r.sibling}function mre(e,t,r){if(kh&&typeof kh.onCommitFiberUnmount=="function")try{kh.onCommitFiberUnmount(Ww,r)}catch{}switch(r.tag){case 5:Ku||yv(r,t);case 6:var n=Pu,o=Tf;Pu=null,nx(e,t,r),Pu=n,Tf=o,Pu!==null&&(Tf?(e=Pu,r=r.stateNode,e.nodeType===8?e.parentNode.removeChild(r):e.removeChild(r)):Pu.removeChild(r.stateNode));break;case 18:Pu!==null&&(Tf?(e=Pu,r=r.stateNode,e.nodeType===8?BU(e.parentNode,r):e.nodeType===1&&BU(e,r),g2(e)):BU(Pu,r.stateNode));break;case 4:n=Pu,o=Tf,Pu=r.stateNode.containerInfo,Tf=!0,nx(e,t,r),Pu=n,Tf=o;break;case 0:case 11:case 14:case 15:if(!Ku&&(n=r.updateQueue,n!==null&&(n=n.lastEffect,n!==null))){o=n=n.next;do{var i=o,a=i.destroy;i=i.tag,a!==void 0&&((i&2)!==0||(i&4)!==0)&&PN(r,t,a),o=o.next}while(o!==n)}nx(e,t,r);break;case 1:if(!Ku&&(yv(r,t),n=r.stateNode,typeof n.componentWillUnmount=="function"))try{n.props=r.memoizedProps,n.state=r.memoizedState,n.componentWillUnmount()}catch(s){ps(r,t,s)}nx(e,t,r);break;case 21:nx(e,t,r);break;case 22:r.mode&1?(Ku=(n=Ku)||r.memoizedState!==null,nx(e,t,r),Ku=n):nx(e,t,r);break;default:nx(e,t,r)}}function Cee(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var r=e.stateNode;r===null&&(r=e.stateNode=new PFe),t.forEach(function(n){var o=LFe.bind(null,e,n);r.has(n)||(r.add(n),n.then(o,o))})}}function If(e,t){var r=t.deletions;if(r!==null)for(var n=0;n<r.length;n++){var o=r[n];try{var i=e,a=t,s=a;e:for(;s!==null;){switch(s.tag){case 5:Pu=s.stateNode,Tf=!1;break e;case 3:Pu=s.stateNode.containerInfo,Tf=!0;break e;case 4:Pu=s.stateNode.containerInfo,Tf=!0;break e}s=s.return}if(Pu===null)throw Error(er(160));mre(i,a,o),Pu=null,Tf=!1;var l=o.alternate;l!==null&&(l.return=null),o.return=null}catch(u){ps(o,t,u)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)dre(t,e),t=t.sibling}function dre(e,t){var r=e.alternate,n=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(If(t,e),Mh(e),n&4){try{l2(3,e,e.return),$w(3,e)}catch(f){ps(e,e.return,f)}try{l2(5,e,e.return)}catch(f){ps(e,e.return,f)}}break;case 1:If(t,e),Mh(e),n&512&&r!==null&&yv(r,r.return);break;case 5:if(If(t,e),Mh(e),n&512&&r!==null&&yv(r,r.return),e.flags&32){var o=e.stateNode;try{d2(o,"")}catch(f){ps(e,e.return,f)}}if(n&4&&(o=e.stateNode,o!=null)){var i=e.memoizedProps,a=r!==null?r.memoizedProps:i,s=e.type,l=e.updateQueue;if(e.updateQueue=null,l!==null)try{s==="input"&&i.type==="radio"&&i.name!=null&&kee(o,i),$U(s,a);var u=$U(s,i);for(a=0;a<l.length;a+=2){var c=l[a],m=l[a+1];c==="style"?Gee(o,m):c==="dangerouslySetInnerHTML"?Vee(o,m):c==="children"?d2(o,m):LN(o,c,m,u)}switch(s){case"input":ZU(o,i);break;case"textarea":Fee(o,i);break;case"select":var d=o._wrapperState.wasMultiple;o._wrapperState.wasMultiple=!!i.multiple;var p=i.value;p!=null?xv(o,!!i.multiple,p,!1):d!==!!i.multiple&&(i.defaultValue!=null?xv(o,!!i.multiple,i.defaultValue,!0):xv(o,!!i.multiple,i.multiple?[]:"",!1))}o[S2]=i}catch(f){ps(e,e.return,f)}}break;case 6:if(If(t,e),Mh(e),n&4){if(e.stateNode===null)throw Error(er(162));o=e.stateNode,i=e.memoizedProps;try{o.nodeValue=i}catch(f){ps(e,e.return,f)}}break;case 3:if(If(t,e),Mh(e),n&4&&r!==null&&r.memoizedState.isDehydrated)try{g2(t.containerInfo)}catch(f){ps(e,e.return,f)}break;case 4:If(t,e),Mh(e);break;case 13:If(t,e),Mh(e),o=e.child,o.flags&8192&&(i=o.memoizedState!==null,o.stateNode.isHidden=i,!i||o.alternate!==null&&o.alternate.memoizedState!==null||(h5=Ls())),n&4&&Cee(e);break;case 22:if(c=r!==null&&r.memoizedState!==null,e.mode&1?(Ku=(u=Ku)||c,If(t,e),Ku=u):If(t,e),Mh(e),n&8192){if(u=e.memoizedState!==null,(e.stateNode.isHidden=u)&&!c&&(e.mode&1)!==0)for(Nr=e,c=e.child;c!==null;){for(m=Nr=c;Nr!==null;){switch(d=Nr,p=d.child,d.tag){case 0:case 11:case 14:case 15:l2(4,d,d.return);break;case 1:yv(d,d.return);var h=d.stateNode;if(typeof h.componentWillUnmount=="function"){n=d,r=d.return;try{t=n,h.props=t.memoizedProps,h.state=t.memoizedState,h.componentWillUnmount()}catch(f){ps(n,r,f)}}break;case 5:yv(d,d.return);break;case 22:if(d.memoizedState!==null){vee(m);continue}}p!==null?(p.return=d,Nr=p):vee(m)}c=c.sibling}e:for(c=null,m=e;;){if(m.tag===5){if(c===null){c=m;try{o=m.stateNode,u?(i=o.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(s=m.stateNode,l=m.memoizedProps.style,a=l!=null&&l.hasOwnProperty("display")?l.display:null,s.style.display=Oee("display",a))}catch(f){ps(e,e.return,f)}}}else if(m.tag===6){if(c===null)try{m.stateNode.nodeValue=u?"":m.memoizedProps}catch(f){ps(e,e.return,f)}}else if((m.tag!==22&&m.tag!==23||m.memoizedState===null||m===e)&&m.child!==null){m.child.return=m,m=m.child;continue}if(m===e)break e;for(;m.sibling===null;){if(m.return===null||m.return===e)break e;c===m&&(c=null),m=m.return}c===m&&(c=null),m.sibling.return=m.return,m=m.sibling}}break;case 19:If(t,e),Mh(e),n&4&&Cee(e);break;case 21:break;default:If(t,e),Mh(e)}}function Mh(e){var t=e.flags;if(t&2){try{e:{for(var r=e.return;r!==null;){if(cre(r)){var n=r;break e}r=r.return}throw Error(er(160))}switch(n.tag){case 5:var o=n.stateNode;n.flags&32&&(d2(o,""),n.flags&=-33);var i=xee(e);DN(e,i,o);break;case 3:case 4:var a=n.stateNode.containerInfo,s=xee(e);RN(e,s,a);break;default:throw Error(er(161))}}catch(l){ps(e,e.return,l)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function RFe(e,t,r){Nr=e,pre(e,t,r)}function pre(e,t,r){for(var n=(e.mode&1)!==0;Nr!==null;){var o=Nr,i=o.child;if(o.tag===22&&n){var a=o.memoizedState!==null||uw;if(!a){var s=o.alternate,l=s!==null&&s.memoizedState!==null||Ku;s=uw;var u=Ku;if(uw=a,(Ku=l)&&!u)for(Nr=o;Nr!==null;)a=Nr,l=a.child,a.tag===22&&a.memoizedState!==null?Iee(o):l!==null?(l.return=a,Nr=l):Iee(o);for(;i!==null;)Nr=i,pre(i,t,r),i=i.sibling;Nr=o,uw=s,Ku=u}See(e,t,r)}else(o.subtreeFlags&8772)!==0&&i!==null?(i.return=o,Nr=i):See(e,t,r)}}function See(e){for(;Nr!==null;){var t=Nr;if((t.flags&8772)!==0){var r=t.alternate;try{if((t.flags&8772)!==0)switch(t.tag){case 0:case 11:case 15:Ku||$w(5,t);break;case 1:var n=t.stateNode;if(t.flags&4&&!Ku)if(r===null)n.componentDidMount();else{var o=t.elementType===t.type?r.memoizedProps:Af(t.type,r.memoizedProps);n.componentDidUpdate(o,r.memoizedState,n.__reactInternalSnapshotBeforeUpdate)}var i=t.updateQueue;i!==null&&iee(t,i,n);break;case 3:var a=t.updateQueue;if(a!==null){if(r=null,t.child!==null)switch(t.child.tag){case 5:r=t.child.stateNode;break;case 1:r=t.child.stateNode}iee(t,a,r)}break;case 5:var s=t.stateNode;if(r===null&&t.flags&4){r=s;var l=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&r.focus();break;case"img":l.src&&(r.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var u=t.alternate;if(u!==null){var c=u.memoizedState;if(c!==null){var m=c.dehydrated;m!==null&&g2(m)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(er(163))}Ku||t.flags&512&&_N(t)}catch(d){ps(t,t.return,d)}}if(t===e){Nr=null;break}if(r=t.sibling,r!==null){r.return=t.return,Nr=r;break}Nr=t.return}}function vee(e){for(;Nr!==null;){var t=Nr;if(t===e){Nr=null;break}var r=t.sibling;if(r!==null){r.return=t.return,Nr=r;break}Nr=t.return}}function Iee(e){for(;Nr!==null;){var t=Nr;try{switch(t.tag){case 0:case 11:case 15:var r=t.return;try{$w(4,t)}catch(l){ps(t,r,l)}break;case 1:var n=t.stateNode;if(typeof n.componentDidMount=="function"){var o=t.return;try{n.componentDidMount()}catch(l){ps(t,o,l)}}var i=t.return;try{_N(t)}catch(l){ps(t,i,l)}break;case 5:var a=t.return;try{_N(t)}catch(l){ps(t,a,l)}}}catch(l){ps(t,t.return,l)}if(t===e){Nr=null;break}var s=t.sibling;if(s!==null){s.return=t.return,Nr=s;break}Nr=t.return}}var DFe=Math.ceil,Uw=Dy.ReactCurrentDispatcher,p5=Dy.ReactCurrentOwner,np=Dy.ReactCurrentBatchConfig,ti=0,Ul=null,Ys=null,_u=0,nd=0,bv=Sx(0),Sl=0,_2=null,z0=0,eM=0,f5=0,u2=null,hm=null,h5=0,Mv=1/0,Cy=null,Nw=!1,wN=null,hx=null,cw=!1,ux=null,zw=0,c2=0,MN=null,bw=-1,xw=0;function Dc(){return(ti&6)!==0?Ls():bw!==-1?bw:bw=Ls()}function gx(e){return(e.mode&1)===0?1:(ti&2)!==0&&_u!==0?_u&-_u:dFe.transition!==null?(xw===0&&(xw=Kee()),xw):(e=Bi,e!==0||(e=window.event,e=e===void 0?16:ote(e.type)),e)}function Rf(e,t,r,n){if(50<c2)throw c2=0,MN=null,Error(er(185));R2(e,r,n),((ti&2)===0||e!==Ul)&&(e===Ul&&((ti&2)===0&&(eM|=r),Sl===4&&sx(e,_u)),xm(e,n),r===1&&ti===0&&(t.mode&1)===0&&(Mv=Ls()+500,Yw&&vx()))}function xm(e,t){var r=e.callbackNode;fke(e,t);var n=Tw(e,e===Ul?_u:0);if(n===0)r!==null&&M$(r),e.callbackNode=null,e.callbackPriority=0;else if(t=n&-n,e.callbackPriority!==t){if(r!=null&&M$(r),t===1)e.tag===0?mFe(Aee.bind(null,e)):Ite(Aee.bind(null,e)),sFe(function(){(ti&6)===0&&vx()}),r=null;else{switch(Jee(n)){case 1:r=NN;break;case 4:r=qee;break;case 16:r=Aw;break;case 536870912:r=Yee;break;default:r=Aw}r=Sre(r,fre.bind(null,e))}e.callbackPriority=t,e.callbackNode=r}}function fre(e,t){if(bw=-1,xw=0,(ti&6)!==0)throw Error(er(327));var r=e.callbackNode;if(Av()&&e.callbackNode!==r)return null;var n=Tw(e,e===Ul?_u:0);if(n===0)return null;if((n&30)!==0||(n&e.expiredLanes)!==0||t)t=Hw(e,n);else{t=n;var o=ti;ti|=2;var i=gre();(Ul!==e||_u!==t)&&(Cy=null,Mv=Ls()+500,V0(e,t));do try{BFe();break}catch(s){hre(e,s)}while(!0);e5(),Uw.current=i,ti=o,Ys!==null?t=0:(Ul=null,_u=0,t=Sl)}if(t!==0){if(t===2&&(o=oN(e),o!==0&&(n=o,t=BN(e,o))),t===1)throw r=_2,V0(e,0),sx(e,n),xm(e,Ls()),r;if(t===6)sx(e,n);else{if(o=e.current.alternate,(n&30)===0&&!wFe(o)&&(t=Hw(e,n),t===2&&(i=oN(e),i!==0&&(n=i,t=BN(e,i))),t===1))throw r=_2,V0(e,0),sx(e,n),xm(e,Ls()),r;switch(e.finishedWork=o,e.finishedLanes=n,t){case 0:case 1:throw Error(er(345));case 2:E0(e,hm,Cy);break;case 3:if(sx(e,n),(n&130023424)===n&&(t=h5+500-Ls(),10<t)){if(Tw(e,0)!==0)break;if(o=e.suspendedLanes,(o&n)!==n){Dc(),e.pingedLanes|=e.suspendedLanes&o;break}e.timeoutHandle=dN(E0.bind(null,e,hm,Cy),t);break}E0(e,hm,Cy);break;case 4:if(sx(e,n),(n&4194240)===n)break;for(t=e.eventTimes,o=-1;0<n;){var a=31-_f(n);i=1<<a,a=t[a],a>o&&(o=a),n&=~i}if(n=o,n=Ls()-n,n=(120>n?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*DFe(n/1960))-n,10<n){e.timeoutHandle=dN(E0.bind(null,e,hm,Cy),n);break}E0(e,hm,Cy);break;case 5:E0(e,hm,Cy);break;default:throw Error(er(329))}}}return xm(e,Ls()),e.callbackNode===r?fre.bind(null,e):null}function BN(e,t){var r=u2;return e.current.memoizedState.isDehydrated&&(V0(e,t).flags|=256),e=Hw(e,t),e!==2&&(t=hm,hm=r,t!==null&&EN(t)),e}function EN(e){hm===null?hm=e:hm.push.apply(hm,e)}function wFe(e){for(var t=e;;){if(t.flags&16384){var r=t.updateQueue;if(r!==null&&(r=r.stores,r!==null))for(var n=0;n<r.length;n++){var o=r[n],i=o.getSnapshot;o=o.value;try{if(!Df(i(),o))return!1}catch{return!1}}}if(r=t.child,t.subtreeFlags&16384&&r!==null)r.return=t,t=r;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function sx(e,t){for(t&=~f5,t&=~eM,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var r=31-_f(t),n=1<<r;e[r]=-1,t&=~n}}function Aee(e){if((ti&6)!==0)throw Error(er(327));Av();var t=Tw(e,0);if((t&1)===0)return xm(e,Ls()),null;var r=Hw(e,t);if(e.tag!==0&&r===2){var n=oN(e);n!==0&&(t=n,r=BN(e,n))}if(r===1)throw r=_2,V0(e,0),sx(e,t),xm(e,Ls()),r;if(r===6)throw Error(er(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,E0(e,hm,Cy),xm(e,Ls()),null}function g5(e,t){var r=ti;ti|=1;try{return e(t)}finally{ti=r,ti===0&&(Mv=Ls()+500,Yw&&vx())}}function H0(e){ux!==null&&ux.tag===0&&(ti&6)===0&&Av();var t=ti;ti|=1;var r=np.transition,n=Bi;try{if(np.transition=null,Bi=1,e)return e()}finally{Bi=n,np.transition=r,ti=t,(ti&6)===0&&vx()}}function y5(){nd=bv.current,Sa(bv)}function V0(e,t){e.finishedWork=null,e.finishedLanes=0;var r=e.timeoutHandle;if(r!==-1&&(e.timeoutHandle=-1,aFe(r)),Ys!==null)for(r=Ys.return;r!==null;){var n=r;switch(KN(n),n.tag){case 1:n=n.type.childContextTypes,n!=null&&ww();break;case 3:Dv(),Sa(ym),Sa(Ju),a5();break;case 5:i5(n);break;case 4:Dv();break;case 13:Sa(Qa);break;case 19:Sa(Qa);break;case 10:t5(n.type._context);break;case 22:case 23:y5()}r=r.return}if(Ul=e,Ys=e=yx(e.current,null),_u=nd=t,Sl=0,_2=null,f5=eM=z0=0,hm=u2=null,F0!==null){for(t=0;t<F0.length;t++)if(r=F0[t],n=r.interleaved,n!==null){r.interleaved=null;var o=n.next,i=r.pending;if(i!==null){var a=i.next;i.next=o,n.next=a}r.pending=n}F0=null}return e}function hre(e,t){do{var r=Ys;try{if(e5(),hw.current=Gw,Ow){for(var n=Za.memoizedState;n!==null;){var o=n.queue;o!==null&&(o.pending=null),n=n.next}Ow=!1}if(N0=0,Gl=Cl=Za=null,s2=!1,A2=0,p5.current=null,r===null||r.return===null){Sl=1,_2=t,Ys=null;break}e:{var i=e,a=r.return,s=r,l=t;if(t=_u,s.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var u=l,c=s,m=c.tag;if((c.mode&1)===0&&(m===0||m===11||m===15)){var d=c.alternate;d?(c.updateQueue=d.updateQueue,c.memoizedState=d.memoizedState,c.lanes=d.lanes):(c.updateQueue=null,c.memoizedState=null)}var p=mee(a);if(p!==null){p.flags&=-257,dee(p,a,s,i,t),p.mode&1&&cee(i,u,t),t=p,l=u;var h=t.updateQueue;if(h===null){var f=new Set;f.add(l),t.updateQueue=f}else h.add(l);break e}else{if((t&1)===0){cee(i,u,t),b5();break e}l=Error(er(426))}}else if(wa&&s.mode&1){var g=mee(a);if(g!==null){(g.flags&65536)===0&&(g.flags|=256),dee(g,a,s,i,t),JN(wv(l,s));break e}}i=l=wv(l,s),Sl!==4&&(Sl=2),u2===null?u2=[i]:u2.push(i),i=a;do{switch(i.tag){case 3:i.flags|=65536,t&=-t,i.lanes|=t;var y=Jte(i,l,t);oee(i,y);break e;case 1:s=l;var x=i.type,S=i.stateNode;if((i.flags&128)===0&&(typeof x.getDerivedStateFromError=="function"||S!==null&&typeof S.componentDidCatch=="function"&&(hx===null||!hx.has(S)))){i.flags|=65536,t&=-t,i.lanes|=t;var I=$te(i,s,t);oee(i,I);break e}}i=i.return}while(i!==null)}bre(r)}catch(v){t=v,Ys===r&&r!==null&&(Ys=r=r.return);continue}break}while(!0)}function gre(){var e=Uw.current;return Uw.current=Gw,e===null?Gw:e}function b5(){(Sl===0||Sl===3||Sl===2)&&(Sl=4),Ul===null||(z0&268435455)===0&&(eM&268435455)===0||sx(Ul,_u)}function Hw(e,t){var r=ti;ti|=2;var n=gre();(Ul!==e||_u!==t)&&(Cy=null,V0(e,t));do try{MFe();break}catch(o){hre(e,o)}while(!0);if(e5(),ti=r,Uw.current=n,Ys!==null)throw Error(er(261));return Ul=null,_u=0,Sl}function MFe(){for(;Ys!==null;)yre(Ys)}function BFe(){for(;Ys!==null&&!ike();)yre(Ys)}function yre(e){var t=Cre(e.alternate,e,nd);e.memoizedProps=e.pendingProps,t===null?bre(e):Ys=t,p5.current=null}function bre(e){var t=e;do{var r=t.alternate;if(e=t.return,(t.flags&32768)===0){if(r=AFe(r,t,nd),r!==null){Ys=r;return}}else{if(r=TFe(r,t),r!==null){r.flags&=32767,Ys=r;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{Sl=6,Ys=null;return}}if(t=t.sibling,t!==null){Ys=t;return}Ys=t=e}while(t!==null);Sl===0&&(Sl=5)}function E0(e,t,r){var n=Bi,o=np.transition;try{np.transition=null,Bi=1,EFe(e,t,r,n)}finally{np.transition=o,Bi=n}return null}function EFe(e,t,r,n){do Av();while(ux!==null);if((ti&6)!==0)throw Error(er(327));r=e.finishedWork;var o=e.finishedLanes;if(r===null)return null;if(e.finishedWork=null,e.finishedLanes=0,r===e.current)throw Error(er(177));e.callbackNode=null,e.callbackPriority=0;var i=r.lanes|r.childLanes;if(hke(e,i),e===Ul&&(Ys=Ul=null,_u=0),(r.subtreeFlags&2064)===0&&(r.flags&2064)===0||cw||(cw=!0,Sre(Aw,function(){return Av(),null})),i=(r.flags&15990)!==0,(r.subtreeFlags&15990)!==0||i){i=np.transition,np.transition=null;var a=Bi;Bi=1;var s=ti;ti|=4,p5.current=null,_Fe(e,r),dre(r,e),tFe(cN),Pw=!!uN,cN=uN=null,e.current=r,RFe(r,e,o),ake(),ti=s,Bi=a,np.transition=i}else e.current=r;if(cw&&(cw=!1,ux=e,zw=o),i=e.pendingLanes,i===0&&(hx=null),uke(r.stateNode,n),xm(e,Ls()),t!==null)for(n=e.onRecoverableError,r=0;r<t.length;r++)o=t[r],n(o.value,{componentStack:o.stack,digest:o.digest});if(Nw)throw Nw=!1,e=wN,wN=null,e;return(zw&1)!==0&&e.tag!==0&&Av(),i=e.pendingLanes,(i&1)!==0?e===MN?c2++:(c2=0,MN=e):c2=0,vx(),null}function Av(){if(ux!==null){var e=Jee(zw),t=np.transition,r=Bi;try{if(np.transition=null,Bi=16>e?16:e,ux===null)var n=!1;else{if(e=ux,ux=null,zw=0,(ti&6)!==0)throw Error(er(331));var o=ti;for(ti|=4,Nr=e.current;Nr!==null;){var i=Nr,a=i.child;if((Nr.flags&16)!==0){var s=i.deletions;if(s!==null){for(var l=0;l<s.length;l++){var u=s[l];for(Nr=u;Nr!==null;){var c=Nr;switch(c.tag){case 0:case 11:case 15:l2(8,c,i)}var m=c.child;if(m!==null)m.return=c,Nr=m;else for(;Nr!==null;){c=Nr;var d=c.sibling,p=c.return;if(ure(c),c===u){Nr=null;break}if(d!==null){d.return=p,Nr=d;break}Nr=p}}}var h=i.alternate;if(h!==null){var f=h.child;if(f!==null){h.child=null;do{var g=f.sibling;f.sibling=null,f=g}while(f!==null)}}Nr=i}}if((i.subtreeFlags&2064)!==0&&a!==null)a.return=i,Nr=a;else e:for(;Nr!==null;){if(i=Nr,(i.flags&2048)!==0)switch(i.tag){case 0:case 11:case 15:l2(9,i,i.return)}var y=i.sibling;if(y!==null){y.return=i.return,Nr=y;break e}Nr=i.return}}var x=e.current;for(Nr=x;Nr!==null;){a=Nr;var S=a.child;if((a.subtreeFlags&2064)!==0&&S!==null)S.return=a,Nr=S;else e:for(a=x;Nr!==null;){if(s=Nr,(s.flags&2048)!==0)try{switch(s.tag){case 0:case 11:case 15:$w(9,s)}}catch(v){ps(s,s.return,v)}if(s===a){Nr=null;break e}var I=s.sibling;if(I!==null){I.return=s.return,Nr=I;break e}Nr=s.return}}if(ti=o,vx(),kh&&typeof kh.onPostCommitFiberRoot=="function")try{kh.onPostCommitFiberRoot(Ww,e)}catch{}n=!0}return n}finally{Bi=r,np.transition=t}}return!1}function Tee(e,t,r){t=wv(r,t),t=Jte(e,t,1),e=fx(e,t,1),t=Dc(),e!==null&&(R2(e,1,t),xm(e,t))}function ps(e,t,r){if(e.tag===3)Tee(e,e,r);else for(;t!==null;){if(t.tag===3){Tee(t,e,r);break}else if(t.tag===1){var n=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof n.componentDidCatch=="function"&&(hx===null||!hx.has(n))){e=wv(r,e),e=$te(t,e,1),t=fx(t,e,1),e=Dc(),t!==null&&(R2(t,1,e),xm(t,e));break}}t=t.return}}function kFe(e,t,r){var n=e.pingCache;n!==null&&n.delete(t),t=Dc(),e.pingedLanes|=e.suspendedLanes&r,Ul===e&&(_u&r)===r&&(Sl===4||Sl===3&&(_u&130023424)===_u&&500>Ls()-h5?V0(e,0):f5|=r),xm(e,t)}function xre(e,t){t===0&&((e.mode&1)===0?t=1:(t=Y3,Y3<<=1,(Y3&130023424)===0&&(Y3=4194304)));var r=Dc();e=_y(e,t),e!==null&&(R2(e,t,r),xm(e,r))}function FFe(e){var t=e.memoizedState,r=0;t!==null&&(r=t.retryLane),xre(e,r)}function LFe(e,t){var r=0;switch(e.tag){case 13:var n=e.stateNode,o=e.memoizedState;o!==null&&(r=o.retryLane);break;case 19:n=e.stateNode;break;default:throw Error(er(314))}n!==null&&n.delete(t),xre(e,r)}var Cre;Cre=function(e,t,r){if(e!==null)if(e.memoizedProps!==t.pendingProps||ym.current)gm=!0;else{if((e.lanes&r)===0&&(t.flags&128)===0)return gm=!1,IFe(e,t,r);gm=(e.flags&131072)!==0}else gm=!1,wa&&(t.flags&1048576)!==0&&Ate(t,Ew,t.index);switch(t.lanes=0,t.tag){case 2:var n=t.type;yw(e,t),e=t.pendingProps;var o=Pv(t,Ju.current);Iv(t,r),o=l5(null,t,n,e,o,r);var i=u5();return t.flags|=1,typeof o=="object"&&o!==null&&typeof o.render=="function"&&o.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,bm(n)?(i=!0,Mw(t)):i=!1,t.memoizedState=o.state!==null&&o.state!==void 0?o.state:null,n5(t),o.updater=Jw,t.stateNode=o,o._reactInternals=t,xN(t,n,e,r),t=vN(null,t,n,!0,i,r)):(t.tag=0,wa&&i&&YN(t),Rc(null,t,o,r),t=t.child),t;case 16:n=t.elementType;e:{switch(yw(e,t),e=t.pendingProps,o=n._init,n=o(n._payload),t.type=n,o=t.tag=OFe(n),e=Af(n,e),o){case 0:t=SN(null,t,n,e,r);break e;case 1:t=hee(null,t,n,e,r);break e;case 11:t=pee(null,t,n,e,r);break e;case 14:t=fee(null,t,n,Af(n.type,e),r);break e}throw Error(er(306,n,""))}return t;case 0:return n=t.type,o=t.pendingProps,o=t.elementType===n?o:Af(n,o),SN(e,t,n,o,r);case 1:return n=t.type,o=t.pendingProps,o=t.elementType===n?o:Af(n,o),hee(e,t,n,o,r);case 3:e:{if(nre(t),e===null)throw Error(er(387));n=t.pendingProps,i=t.memoizedState,o=i.element,wte(e,t),Lw(t,n,null,r);var a=t.memoizedState;if(n=a.element,i.isDehydrated)if(i={element:n,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},t.updateQueue.baseState=i,t.memoizedState=i,t.flags&256){o=wv(Error(er(423)),t),t=gee(e,t,n,r,o);break e}else if(n!==o){o=wv(Error(er(424)),t),t=gee(e,t,n,r,o);break e}else for(od=px(t.stateNode.containerInfo.firstChild),id=t,wa=!0,Pf=null,r=Rte(t,null,n,r),t.child=r;r;)r.flags=r.flags&-3|4096,r=r.sibling;else{if(_v(),n===o){t=Ry(e,t,r);break e}Rc(e,t,n,r)}t=t.child}return t;case 5:return Mte(t),e===null&&gN(t),n=t.type,o=t.pendingProps,i=e!==null?e.memoizedProps:null,a=o.children,mN(n,o)?a=null:i!==null&&mN(n,i)&&(t.flags|=32),rre(e,t),Rc(e,t,a,r),t.child;case 6:return e===null&&gN(t),null;case 13:return ore(e,t,r);case 4:return o5(t,t.stateNode.containerInfo),n=t.pendingProps,e===null?t.child=Rv(t,null,n,r):Rc(e,t,n,r),t.child;case 11:return n=t.type,o=t.pendingProps,o=t.elementType===n?o:Af(n,o),pee(e,t,n,o,r);case 7:return Rc(e,t,t.pendingProps,r),t.child;case 8:return Rc(e,t,t.pendingProps.children,r),t.child;case 12:return Rc(e,t,t.pendingProps.children,r),t.child;case 10:e:{if(n=t.type._context,o=t.pendingProps,i=t.memoizedProps,a=o.value,la(kw,n._currentValue),n._currentValue=a,i!==null)if(Df(i.value,a)){if(i.children===o.children&&!ym.current){t=Ry(e,t,r);break e}}else for(i=t.child,i!==null&&(i.return=t);i!==null;){var s=i.dependencies;if(s!==null){a=i.child;for(var l=s.firstContext;l!==null;){if(l.context===n){if(i.tag===1){l=Ay(-1,r&-r),l.tag=2;var u=i.updateQueue;if(u!==null){u=u.shared;var c=u.pending;c===null?l.next=l:(l.next=c.next,c.next=l),u.pending=l}}i.lanes|=r,l=i.alternate,l!==null&&(l.lanes|=r),yN(i.return,r,t),s.lanes|=r;break}l=l.next}}else if(i.tag===10)a=i.type===t.type?null:i.child;else if(i.tag===18){if(a=i.return,a===null)throw Error(er(341));a.lanes|=r,s=a.alternate,s!==null&&(s.lanes|=r),yN(a,r,t),a=i.sibling}else a=i.child;if(a!==null)a.return=i;else for(a=i;a!==null;){if(a===t){a=null;break}if(i=a.sibling,i!==null){i.return=a.return,a=i;break}a=a.return}i=a}Rc(e,t,o.children,r),t=t.child}return t;case 9:return o=t.type,n=t.pendingProps.children,Iv(t,r),o=op(o),n=n(o),t.flags|=1,Rc(e,t,n,r),t.child;case 14:return n=t.type,o=Af(n,t.pendingProps),o=Af(n.type,o),fee(e,t,n,o,r);case 15:return ere(e,t,t.type,t.pendingProps,r);case 17:return n=t.type,o=t.pendingProps,o=t.elementType===n?o:Af(n,o),yw(e,t),t.tag=1,bm(n)?(e=!0,Mw(t)):e=!1,Iv(t,r),Kte(t,n,o),xN(t,n,o,r),vN(null,t,n,!0,e,r);case 19:return ire(e,t,r);case 22:return tre(e,t,r)}throw Error(er(156,t.tag))};function Sre(e,t){return Zee(e,t)}function VFe(e,t,r,n){this.tag=e,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function rp(e,t,r,n){return new VFe(e,t,r,n)}function x5(e){return e=e.prototype,!(!e||!e.isReactComponent)}function OFe(e){if(typeof e=="function")return x5(e)?1:0;if(e!=null){if(e=e.$$typeof,e===ON)return 11;if(e===GN)return 14}return 2}function yx(e,t){var r=e.alternate;return r===null?(r=rp(e.tag,t,e.key,e.mode),r.elementType=e.elementType,r.type=e.type,r.stateNode=e.stateNode,r.alternate=e,e.alternate=r):(r.pendingProps=t,r.type=e.type,r.flags=0,r.subtreeFlags=0,r.deletions=null),r.flags=e.flags&14680064,r.childLanes=e.childLanes,r.lanes=e.lanes,r.child=e.child,r.memoizedProps=e.memoizedProps,r.memoizedState=e.memoizedState,r.updateQueue=e.updateQueue,t=e.dependencies,r.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},r.sibling=e.sibling,r.index=e.index,r.ref=e.ref,r}function Cw(e,t,r,n,o,i){var a=2;if(n=e,typeof e=="function")x5(e)&&(a=1);else if(typeof e=="string")a=5;else e:switch(e){case lv:return O0(r.children,o,i,t);case VN:a=8,o|=8;break;case HU:return e=rp(12,r,t,o|2),e.elementType=HU,e.lanes=i,e;case jU:return e=rp(13,r,t,o),e.elementType=jU,e.lanes=i,e;case WU:return e=rp(19,r,t,o),e.elementType=WU,e.lanes=i,e;case Mee:return tM(r,o,i,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case Dee:a=10;break e;case wee:a=9;break e;case ON:a=11;break e;case GN:a=14;break e;case ox:a=16,n=null;break e}throw Error(er(130,e==null?e:typeof e,""))}return t=rp(a,r,t,o),t.elementType=e,t.type=n,t.lanes=i,t}function O0(e,t,r,n){return e=rp(7,e,n,t),e.lanes=r,e}function tM(e,t,r,n){return e=rp(22,e,n,t),e.elementType=Mee,e.lanes=r,e.stateNode={isHidden:!1},e}function UU(e,t,r){return e=rp(6,e,null,t),e.lanes=r,e}function NU(e,t,r){return t=rp(4,e.children!==null?e.children:[],e.key,t),t.lanes=r,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function GFe(e,t,r,n,o){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=AU(0),this.expirationTimes=AU(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=AU(0),this.identifierPrefix=n,this.onRecoverableError=o,this.mutableSourceEagerHydrationData=null}function C5(e,t,r,n,o,i,a,s,l){return e=new GFe(e,t,r,s,l),t===1?(t=1,i===!0&&(t|=8)):t=0,i=rp(3,null,null,t),e.current=i,i.stateNode=e,i.memoizedState={element:n,isDehydrated:r,cache:null,transitions:null,pendingSuspenseBoundaries:null},n5(i),e}function UFe(e,t,r){var n=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:sv,key:n==null?null:""+n,children:e,containerInfo:t,implementation:r}}function vre(e){if(!e)return xx;e=e._reactInternals;e:{if(W0(e)!==e||e.tag!==1)throw Error(er(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(bm(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(er(171))}if(e.tag===1){var r=e.type;if(bm(r))return vte(e,r,t)}return t}function Ire(e,t,r,n,o,i,a,s,l){return e=C5(r,n,!0,e,o,i,a,s,l),e.context=vre(null),r=e.current,n=Dc(),o=gx(r),i=Ay(n,o),i.callback=t??null,fx(r,i,o),e.current.lanes=o,R2(e,o,n),xm(e,n),e}function rM(e,t,r,n){var o=t.current,i=Dc(),a=gx(o);return r=vre(r),t.context===null?t.context=r:t.pendingContext=r,t=Ay(i,a),t.payload={element:e},n=n===void 0?null:n,n!==null&&(t.callback=n),e=fx(o,t,a),e!==null&&(Rf(e,o,a,i),fw(e,o,a)),a}function jw(e){return e=e.current,e.child?(e.child.tag===5,e.child.stateNode):null}function Pee(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var r=e.retryLane;e.retryLane=r!==0&&r<t?r:t}}function S5(e,t){Pee(e,t),(e=e.alternate)&&Pee(e,t)}function NFe(){return null}var Are=typeof reportError=="function"?reportError:function(e){console.error(e)};function v5(e){this._internalRoot=e}nM.prototype.render=v5.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(er(409));rM(e,t,null,null)};nM.prototype.unmount=v5.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;H0(function(){rM(null,e,null,null)}),t[Py]=null}};function nM(e){this._internalRoot=e}nM.prototype.unstable_scheduleHydration=function(e){if(e){var t=tte();e={blockedOn:null,target:e,priority:t};for(var r=0;r<ax.length&&t!==0&&t<ax[r].priority;r++);ax.splice(r,0,e),r===0&&nte(e)}};function I5(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function oM(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function _ee(){}function zFe(e,t,r,n,o){if(o){if(typeof n=="function"){var i=n;n=function(){var u=jw(a);i.call(u)}}var a=Ire(t,n,e,0,null,!1,!1,"",_ee);return e._reactRootContainer=a,e[Py]=a.current,x2(e.nodeType===8?e.parentNode:e),H0(),a}for(;o=e.lastChild;)e.removeChild(o);if(typeof n=="function"){var s=n;n=function(){var u=jw(l);s.call(u)}}var l=C5(e,0,!1,null,null,!1,!1,"",_ee);return e._reactRootContainer=l,e[Py]=l.current,x2(e.nodeType===8?e.parentNode:e),H0(function(){rM(t,l,r,n)}),l}function iM(e,t,r,n,o){var i=r._reactRootContainer;if(i){var a=i;if(typeof o=="function"){var s=o;o=function(){var l=jw(a);s.call(l)}}rM(t,a,e,o)}else a=zFe(r,t,e,o,n);return jw(a)}$ee=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var r=e2(t.pendingLanes);r!==0&&(zN(t,r|1),xm(t,Ls()),(ti&6)===0&&(Mv=Ls()+500,vx()))}break;case 13:H0(function(){var n=_y(e,1);if(n!==null){var o=Dc();Rf(n,e,1,o)}}),S5(e,1)}};HN=function(e){if(e.tag===13){var t=_y(e,134217728);if(t!==null){var r=Dc();Rf(t,e,134217728,r)}S5(e,134217728)}};ete=function(e){if(e.tag===13){var t=gx(e),r=_y(e,t);if(r!==null){var n=Dc();Rf(r,e,t,n)}S5(e,t)}};tte=function(){return Bi};rte=function(e,t){var r=Bi;try{return Bi=e,t()}finally{Bi=r}};tN=function(e,t,r){switch(t){case"input":if(ZU(e,r),t=r.name,r.type==="radio"&&t!=null){for(r=e;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<r.length;t++){var n=r[t];if(n!==e&&n.form===e.form){var o=qw(n);if(!o)throw Error(er(90));Eee(n),ZU(n,o)}}}break;case"textarea":Fee(e,r);break;case"select":t=r.value,t!=null&&xv(e,!!r.multiple,t,!1)}};zee=g5;Hee=H0;var HFe={usingClientEntryPoint:!1,Events:[w2,dv,qw,Uee,Nee,g5]},YP={findFiberByHostInstance:k0,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},jFe={bundleType:YP.bundleType,version:YP.version,rendererPackageName:YP.rendererPackageName,rendererConfig:YP.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Dy.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=Xee(e),e===null?null:e.stateNode},findFiberByHostInstance:YP.findFiberByHostInstance||NFe,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&(KP=__REACT_DEVTOOLS_GLOBAL_HOOK__,!KP.isDisabled&&KP.supportsFiber))try{Ww=KP.inject(jFe),kh=KP}catch{}var KP;ld.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=HFe;ld.createPortal=function(e,t){var r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!I5(t))throw Error(er(200));return UFe(e,t,null,r)};ld.createRoot=function(e,t){if(!I5(e))throw Error(er(299));var r=!1,n="",o=Are;return t!=null&&(t.unstable_strictMode===!0&&(r=!0),t.identifierPrefix!==void 0&&(n=t.identifierPrefix),t.onRecoverableError!==void 0&&(o=t.onRecoverableError)),t=C5(e,1,!1,null,null,r,!1,n,o),e[Py]=t.current,x2(e.nodeType===8?e.parentNode:e),new v5(t)};ld.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(er(188)):(e=Object.keys(e).join(","),Error(er(268,e)));return e=Xee(t),e=e===null?null:e.stateNode,e};ld.flushSync=function(e){return H0(e)};ld.hydrate=function(e,t,r){if(!oM(t))throw Error(er(200));return iM(null,e,t,!0,r)};ld.hydrateRoot=function(e,t,r){if(!I5(e))throw Error(er(405));var n=r!=null&&r.hydratedSources||null,o=!1,i="",a=Are;if(r!=null&&(r.unstable_strictMode===!0&&(o=!0),r.identifierPrefix!==void 0&&(i=r.identifierPrefix),r.onRecoverableError!==void 0&&(a=r.onRecoverableError)),t=Ire(t,null,e,1,r??null,o,!1,i,a),e[Py]=t.current,x2(e),n)for(e=0;e<n.length;e++)r=n[e],o=r._getVersion,o=o(r._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[r,o]:t.mutableSourceEagerHydrationData.push(r,o);return new nM(t)};ld.render=function(e,t,r){if(!oM(t))throw Error(er(200));return iM(null,e,t,!1,r)};ld.unmountComponentAtNode=function(e){if(!oM(e))throw Error(er(40));return e._reactRootContainer?(H0(function(){iM(null,null,e,!1,function(){e._reactRootContainer=null,e[Py]=null})}),!0):!1};ld.unstable_batchedUpdates=g5;ld.unstable_renderSubtreeIntoContainer=function(e,t,r,n){if(!oM(r))throw Error(er(200));if(e==null||e._reactInternals===void 0)throw Error(er(38));return iM(e,t,r,!1,n)};ld.version="18.3.1-next-f1338f8080-20240426"});var Rre=ju((iTt,_re)=>{"use strict";function Pre(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(Pre)}catch(e){console.error(e)}}Pre(),_re.exports=Tre()});var T5=ju(A5=>{"use strict";var Dre=Rre();A5.createRoot=Dre.createRoot,A5.hydrateRoot=Dre.hydrateRoot;var aTt});var Dne=ju(CM=>{"use strict";var fLe=Mi(),hLe=Symbol.for("react.element"),gLe=Symbol.for("react.fragment"),yLe=Object.prototype.hasOwnProperty,bLe=fLe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,xLe={key:!0,ref:!0,__self:!0,__source:!0};function Rne(e,t,r){var n,o={},i=null,a=null;r!==void 0&&(i=""+r),t.key!==void 0&&(i=""+t.key),t.ref!==void 0&&(a=t.ref);for(n in t)yLe.call(t,n)&&!xLe.hasOwnProperty(n)&&(o[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps,t)o[n]===void 0&&(o[n]=t[n]);return{$$typeof:hLe,type:e,key:i,ref:a,props:o,_owner:bLe.current}}CM.Fragment=gLe;CM.jsx=Rne;CM.jsxs=Rne});var ur=ju((bPt,wne)=>{"use strict";wne.exports=Dne()});var boe=ju((w2t,yoe)=>{"use strict";var poe=/\/\*[^*]*\*+([^/*][^*]*\*+)*\//g,jVe=/\n/g,WVe=/^\s*/,XVe=/^(\*?[-#/*\\\w]+(\[[0-9a-z_-]+\])?)\s*/,QVe=/^:\s*/,ZVe=/^((?:'(?:\\'|.)*?'|"(?:\\"|.)*?"|\([^)]*?\)|[^};])+)/,qVe=/^[;\s]*/,YVe=/^\s+|\s+$/g,KVe=`
`,foe="/",hoe="*",rS="",JVe="comment",$Ve="declaration";function eOe(e,t){if(typeof e!="string")throw new TypeError("First argument must be a string");if(!e)return[];t=t||{};var r=1,n=1;function o(h){var f=h.match(jVe);f&&(r+=f.length);var g=h.lastIndexOf(KVe);n=~g?h.length-g:n+h.length}function i(){var h={line:r,column:n};return function(f){return f.position=new a(h),u(),f}}function a(h){this.start=h,this.end={line:r,column:n},this.source=t.source}a.prototype.content=e;function s(h){var f=new Error(t.source+":"+r+":"+n+": "+h);if(f.reason=h,f.filename=t.source,f.line=r,f.column=n,f.source=e,!t.silent)throw f}function l(h){var f=h.exec(e);if(f){var g=f[0];return o(g),e=e.slice(g.length),f}}function u(){l(WVe)}function c(h){var f;for(h=h||[];f=m();)f!==!1&&h.push(f);return h}function m(){var h=i();if(!(foe!=e.charAt(0)||hoe!=e.charAt(1))){for(var f=2;rS!=e.charAt(f)&&(hoe!=e.charAt(f)||foe!=e.charAt(f+1));)++f;if(f+=2,rS===e.charAt(f-1))return s("End of comment missing");var g=e.slice(2,f-2);return n+=2,o(g),e=e.slice(f),n+=2,h({type:JVe,comment:g})}}function d(){var h=i(),f=l(XVe);if(f){if(m(),!l(QVe))return s("property missing ':'");var g=l(ZVe),y=h({type:$Ve,property:goe(f[0].replace(poe,rS)),value:g?goe(g[0].replace(poe,rS)):rS});return l(qVe),y}}function p(){var h=[];c(h);for(var f;f=d();)f!==!1&&(h.push(f),c(h));return h}return u(),p()}function goe(e){return e?e.replace(YVe,rS):rS}yoe.exports=eOe});var xoe=ju(X2=>{"use strict";var tOe=X2&&X2.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(X2,"__esModule",{value:!0});X2.default=nOe;var rOe=tOe(boe());function nOe(e,t){let r=null;if(!e||typeof e!="string")return r;let n=(0,rOe.default)(e),o=typeof t=="function";return n.forEach(i=>{if(i.type!=="declaration")return;let{property:a,value:s}=i;o?t(a,s,i):s&&(r=r||{},r[a]=s)}),r}});var Soe=ju(LM=>{"use strict";Object.defineProperty(LM,"__esModule",{value:!0});LM.camelCase=void 0;var oOe=/^--[a-zA-Z0-9_-]+$/,iOe=/-([a-z])/g,aOe=/^[^-]+$/,sOe=/^-(webkit|moz|ms|o|khtml)-/,lOe=/^-(ms)-/,uOe=function(e){return!e||aOe.test(e)||oOe.test(e)},cOe=function(e,t){return t.toUpperCase()},Coe=function(e,t){return"".concat(t,"-")},mOe=function(e,t){return t===void 0&&(t={}),uOe(e)?e:(e=e.toLowerCase(),t.reactCompat?e=e.replace(lOe,Coe):e=e.replace(sOe,Coe),e.replace(iOe,cOe))};LM.camelCase=mOe});var Ioe=ju((nz,voe)=>{"use strict";var dOe=nz&&nz.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},pOe=dOe(xoe()),fOe=Soe();function rz(e,t){var r={};return!e||typeof e!="string"||(0,pOe.default)(e,function(n,o){n&&o&&(r[(0,fOe.camelCase)(n,t)]=o)}),r}rz.default=rz;voe.exports=rz});var Qie=ju((aMt,Xie)=>{"use strict";var aB=Object.prototype.hasOwnProperty,Wie=Object.prototype.toString,Gie=Object.defineProperty,Uie=Object.getOwnPropertyDescriptor,Nie=function(t){return typeof Array.isArray=="function"?Array.isArray(t):Wie.call(t)==="[object Array]"},zie=function(t){if(!t||Wie.call(t)!=="[object Object]")return!1;var r=aB.call(t,"constructor"),n=t.constructor&&t.constructor.prototype&&aB.call(t.constructor.prototype,"isPrototypeOf");if(t.constructor&&!r&&!n)return!1;var o;for(o in t);return typeof o>"u"||aB.call(t,o)},Hie=function(t,r){Gie&&r.name==="__proto__"?Gie(t,r.name,{enumerable:!0,configurable:!0,value:r.newValue,writable:!0}):t[r.name]=r.newValue},jie=function(t,r){if(r==="__proto__")if(aB.call(t,r)){if(Uie)return Uie(t,r).value}else return;return t[r]};Xie.exports=function e(){var t,r,n,o,i,a,s=arguments[0],l=1,u=arguments.length,c=!1;for(typeof s=="boolean"&&(c=s,s=arguments[1]||{},l=2),(s==null||typeof s!="object"&&typeof s!="function")&&(s={});l<u;++l)if(t=arguments[l],t!=null)for(r in t)n=jie(s,r),o=jie(t,r),s!==o&&(c&&o&&(zie(o)||(i=Nie(o)))?(i?(i=!1,a=n&&Nie(n)?n:[]):a=n&&zie(n)?n:{},Hie(s,{name:r,newValue:e(c,a,o)})):typeof o<"u"&&Hie(s,{name:r,newValue:o}));return s}});var iue=ju(Pm=>{"use strict";var da={Remove:"remove",Replace:"replace",Add:"add"},Kle=Symbol.for("__MUTATIVE_PROXY_DRAFT__"),Jle=Symbol("__MUTATIVE_RAW_RETURN_SYMBOL__"),QB=Symbol.iterator,_m={mutable:"mutable",immutable:"immutable"},G9={};function B_(e,t){return e instanceof Map?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function Qle(e,t){if(t in e){let r=Reflect.getPrototypeOf(e);for(;r;){let n=Reflect.getOwnPropertyDescriptor(r,t);if(n)return n;r=Reflect.getPrototypeOf(r)}}}function U9(e){return Object.getPrototypeOf(e)===Set.prototype}function N9(e){return Object.getPrototypeOf(e)===Map.prototype}function Sd(e){var t;return(t=e.copy)!==null&&t!==void 0?t:e.original}function rg(e){return!!Do(e)}function Do(e){return typeof e!="object"?null:e?.[Kle]}function z9(e){var t;let r=Do(e);return r?(t=r.copy)!==null&&t!==void 0?t:r.original:e}function mp(e,t){if(!e||typeof e!="object")return!1;let r;return Object.getPrototypeOf(e)===Object.prototype||Array.isArray(e)||e instanceof Map||e instanceof Set||!!t?.mark&&((r=t.mark(e,_m))===_m.immutable||typeof r=="function")}function $le(e,t=[]){if(Object.hasOwnProperty.call(e,"key")){let r=e.parent.copy,n=Do(ng(r,e.key));if(n!==null&&n?.original!==e.original)return null;let o=e.parent.type===3,i=o?Array.from(e.parent.setMap.keys()).indexOf(e.key):e.key;if(!(o&&r.size>i||B_(r,i)))return null;t.push(i)}if(e.parent)return $le(e.parent,t);t.reverse();try{(function(r,n){for(let o=0;o<n.length-1;o+=1){let i=n[o];if(typeof(r=ng(Hy(r)===3?Array.from(r):r,i))!="object")throw new Error(`Cannot resolve patch at '${n.join("/")}'.`)}})(e.copy,t)}catch{return null}return t}function Hy(e){return Array.isArray(e)?1:e instanceof Map?2:e instanceof Set?3:0}function ng(e,t){return Hy(e)===2?e.get(t):e[t]}function k_(e,t,r){Hy(e)===2?e.set(t,r):e[t]=r}function M9(e,t){let r=Do(e);return(r?Sd(r):e)[t]}function zy(e,t){return e===t?e!==0||1/e==1/t:e!=e&&t!=t}function B9(e){if(e)for(;e.finalities.revoke.length>0;)e.finalities.revoke.pop()()}function SS(e,t){return t?e:[""].concat(e).map((r=>{let n=`${r}`;return n.indexOf("/")===-1&&n.indexOf("~")===-1?n:n.replace(/~/g,"~0").replace(/\//g,"~1")})).join("/")}var tze=Object.prototype.propertyIsEnumerable;function eue(e,t){let r;if(Array.isArray(e))return Array.prototype.concat.call(e);if(e instanceof Set)return U9(e)?Set.prototype.difference?Set.prototype.difference.call(e,new Set):new Set(e.values()):new(Object.getPrototypeOf(e)).constructor(e.values());if(e instanceof Map)return N9(e)?new Map(e):new(Object.getPrototypeOf(e)).constructor(e);if(t?.mark&&(r=t.mark(e,_m),r!==void 0)&&r!==_m.mutable){if(r===_m.immutable)return(function(n){let o=Object.create(Object.getPrototypeOf(n));return Reflect.ownKeys(n).forEach((i=>{let a=Reflect.getOwnPropertyDescriptor(n,i);a.enumerable&&a.configurable&&a.writable?o[i]=n[i]:(a.writable||(a.writable=!0,a.configurable=!0),(a.get||a.set)&&(a={configurable:!0,writable:!0,enumerable:a.enumerable,value:n[i]}),Reflect.defineProperty(o,i,a))})),o})(e);if(typeof r=="function")return r();throw new Error(`Unsupported mark result: ${r}`)}if(typeof e=="object"&&Object.getPrototypeOf(e)===Object.prototype){let n={};return Object.keys(e).forEach((o=>{n[o]=e[o]})),Object.getOwnPropertySymbols(e).forEach((o=>{tze.call(e,o)&&(n[o]=e[o])})),n}throw new Error("Please check mark() to ensure that it is a stable marker draftable function.")}function Uc(e){e.copy||(e.copy=eue(e.original,e.options))}function bI(e){if(!mp(e))return z9(e);if(Array.isArray(e))return e.map(bI);if(e instanceof Map){let r=Array.from(e.entries()).map((([n,o])=>[n,bI(o)]));return N9(e)?new Map(r):new(Object.getPrototypeOf(e)).constructor(r)}if(e instanceof Set){let r=Array.from(e).map(bI);return U9(e)?new Set(r):new(Object.getPrototypeOf(e)).constructor(r)}let t=Object.create(Object.getPrototypeOf(e));for(let r in e)t[r]=bI(e[r]);return t}function XB(e){return rg(e)?bI(e):e}function tg(e){var t;e.assignedMap=(t=e.assignedMap)!==null&&t!==void 0?t:new Map,e.operated||(e.operated=!0,e.parent&&tg(e.parent))}function Zle(){throw new Error("Cannot modify frozen object")}function M_(e){return e&&typeof e=="object"&&!Object.isFrozen(e)}function yI(e,t,r,n,o){if(!(Object.isFrozen(e)||rg(e)))switch(Hy(e)){case 2:for(let[i,a]of e)M_(i)&&yI(i),M_(a)&&yI(a);e.set=e.clear=e.delete=Zle;break;case 3:for(let i of e)M_(i)&&yI(i);e.add=e.clear=e.delete=Zle;break;case 1:Object.freeze(e);for(let i of e)M_(i)&&yI(i);break;default:Object.freeze(e),Object.keys(e).forEach((i=>{let a=e[i];M_(a)&&yI(a)}))}}function H9(e,t){let r=Hy(e);if(r===0)Reflect.ownKeys(e).forEach((n=>{t(n,e[n],e)}));else if(r===1){let n=0;for(let o of e)t(n,o,e),n+=1}else e.forEach(((n,o)=>t(o,n,e)))}function tue(e,t,r){if(rg(e)||!mp(e,r)||t.has(e)||Object.isFrozen(e))return;let n=e instanceof Set,o=n?new Map:void 0;if(t.add(e),H9(e,((i,a)=>{var s;if(rg(a)){let l=Do(a);Uc(l);let u=!((s=l.assignedMap)===null||s===void 0)&&s.size||l.operated?l.copy:l.original;k_(n?o:e,i,u)}else tue(a,t,r)})),o){let i=e,a=Array.from(i);i.clear(),a.forEach((s=>{i.add(o.has(s)?o.get(s):s)}))}}function rze(e,t){let r=e.type===3?e.setMap:e.copy;e.finalities.revoke.length>1&&e.assignedMap.get(t)&&r&&tue(ng(r,t),e.finalities.handledSet,e.options)}function E9(e){e.type===3&&e.copy&&(e.copy.clear(),e.setMap.forEach((t=>{e.copy.add(z9(t))})))}function k9(e,t,r,n){if(e.operated&&e.assignedMap&&e.assignedMap.size>0&&!e.finalized){if(r&&n){let o=$le(e);o&&t(e,o,r,n)}e.finalized=!0}}function j9(e,t,r,n){let o=Do(r);o&&(o.callbacks||(o.callbacks=[]),o.callbacks.push(((i,a)=>{let s=e.type===3?e.setMap:e.copy;if(zy(ng(s,t),r)){let l=o.original;o.copy&&(l=o.copy),E9(e),k9(e,n,i,a),k_(s,t,l)}})),e.options.enableAutoFreeze&&o.finalities!==e.finalities&&(e.options.enableAutoFreeze=!1)),mp(r,e.options)&&e.finalities.draft.push((()=>{zy(ng(e.type===3?e.setMap:e.copy,t),r)&&rze(e,t)}))}function E_(e,t,r,n){let{pathAsArray:o=!0}=e.options.enablePatches;switch(e.type){case 0:case 2:return(function({original:i,copy:a,assignedMap:s},l,u,c,m){s.forEach(((d,p)=>{let h=ng(i,p),f=XB(ng(a,p)),g=d?B_(i,p)?da.Replace:da.Add:da.Remove;if(zy(h,f)&&g===da.Replace)return;let y=SS(l.concat(p),m);u.push(g===da.Remove?{op:g,path:y}:{op:g,path:y,value:f}),c.push(g===da.Add?{op:da.Remove,path:y}:g===da.Remove?{op:da.Add,path:y,value:h}:{op:da.Replace,path:y,value:h})}))})(e,t,r,n,o);case 1:return(function(i,a,s,l,u){let{original:c,assignedMap:m,options:d}=i,p=i.copy;p.length<c.length&&([c,p]=[p,c],[s,l]=[l,s]);for(let h=0;h<c.length;h+=1)if(m.get(h.toString())&&p[h]!==c[h]){let f=SS(a.concat([h]),u);s.push({op:da.Replace,path:f,value:XB(p[h])}),l.push({op:da.Replace,path:f,value:XB(c[h])})}for(let h=c.length;h<p.length;h+=1){let f=SS(a.concat([h]),u);s.push({op:da.Add,path:f,value:XB(p[h])})}if(c.length<p.length){let{arrayLengthAssignment:h=!0}=d.enablePatches;if(h){let f=SS(a.concat(["length"]),u);l.push({op:da.Replace,path:f,value:c.length})}else for(let f=p.length;c.length<f;f-=1){let g=SS(a.concat([f-1]),u);l.push({op:da.Remove,path:g})}}})(e,t,r,n,o);case 3:return(function({original:i,copy:a},s,l,u,c){let m=0;i.forEach((d=>{if(!a.has(d)){let p=SS(s.concat([m]),c);l.push({op:da.Remove,path:p,value:d}),u.unshift({op:da.Add,path:p,value:d})}m+=1})),m=0,a.forEach((d=>{if(!i.has(d)){let p=SS(s.concat([m]),c);l.push({op:da.Add,path:p,value:d}),u.unshift({op:da.Remove,path:p,value:d})}m+=1}))})(e,t,r,n,o)}}var F9=!1,ZB=(e,t,r=!1)=>{if(typeof e=="object"&&e!==null&&(!mp(e,t)||r)&&!F9)throw new Error("Strict mode: Mutable data cannot be accessed directly, please use 'unsafe(callback)' wrap.")},L9={get size(){return Sd(Do(this)).size},has(e){return Sd(Do(this)).has(e)},set(e,t){let r=Do(this),n=Sd(r);return n.has(e)&&zy(n.get(e),t)||(Uc(r),tg(r),r.assignedMap.set(e,!0),r.copy.set(e,t),j9(r,e,t,E_)),this},delete(e){if(!this.has(e))return!1;let t=Do(this);return Uc(t),tg(t),t.original.has(e)?t.assignedMap.set(e,!1):t.assignedMap.delete(e),t.copy.delete(e),!0},clear(){let e=Do(this);if(this.size){Uc(e),tg(e),e.assignedMap=new Map;for(let[t]of e.original)e.assignedMap.set(t,!1);e.copy.clear()}},forEach(e,t){Sd(Do(this)).forEach(((r,n)=>{e.call(t,this.get(n),n,this)}))},get(e){var t,r;let n=Do(this),o=Sd(n).get(e),i=((r=(t=n.options).mark)===null||r===void 0?void 0:r.call(t,o,_m))===_m.mutable;if(n.options.strict&&ZB(o,n.options,i),i||n.finalized||!mp(o,n.options)||o!==n.original.get(e))return o;let a=G9.createDraft({original:o,parentDraft:n,key:e,finalities:n.finalities,options:n.options});return Uc(n),n.copy.set(e,a),a},keys(){return Sd(Do(this)).keys()},values(){let e=this.keys();return{[QB]:()=>this.values(),next:()=>{let t=e.next();return t.done?t:{done:!1,value:this.get(t.value)}}}},entries(){let e=this.keys();return{[QB]:()=>this.entries(),next:()=>{let t=e.next();if(t.done)return t;let r=this.get(t.value);return{done:!1,value:[t.value,r]}}}},[QB](){return this.entries()}},nze=Reflect.ownKeys(L9),qle=(e,t,{isValuesIterator:r})=>()=>{var n,o;let i=t.next();if(i.done)return i;let a=i.value,s=e.setMap.get(a),l=Do(s),u=((o=(n=e.options).mark)===null||o===void 0?void 0:o.call(n,s,_m))===_m.mutable;if(e.options.strict&&ZB(a,e.options,u),u||l||!mp(a,e.options)||e.finalized||!e.original.has(a))l&&(s=l.proxy);else{let c=G9.createDraft({original:a,parentDraft:e,key:a,finalities:e.finalities,options:e.options});e.setMap.set(a,c),s=c}return{done:!1,value:r?s:[s,s]}},qB={get size(){return Do(this).setMap.size},has(e){let t=Do(this);if(t.setMap.has(e))return!0;Uc(t);let r=Do(e);return!(!r||!t.setMap.has(r.original))},add(e){let t=Do(this);return this.has(e)||(Uc(t),tg(t),t.assignedMap.set(e,!0),t.setMap.set(e,e),j9(t,e,e,E_)),this},delete(e){if(!this.has(e))return!1;let t=Do(this);Uc(t),tg(t);let r=Do(e);return r&&t.setMap.has(r.original)?(t.assignedMap.set(r.original,!1),t.setMap.delete(r.original)):(!r&&t.setMap.has(e)?t.assignedMap.set(e,!1):t.assignedMap.delete(e),t.setMap.delete(e))},clear(){if(!this.size)return;let e=Do(this);Uc(e),tg(e);for(let t of e.original)e.assignedMap.set(t,!1);e.setMap.clear()},values(){let e=Do(this);Uc(e);let t=e.setMap.keys();return{[Symbol.iterator]:()=>this.values(),next:qle(e,t,{isValuesIterator:!0})}},entries(){let e=Do(this);Uc(e);let t=e.setMap.keys();return{[Symbol.iterator]:()=>this.entries(),next:qle(e,t,{isValuesIterator:!1})}},keys(){return this.values()},[QB](){return this.values()},forEach(e,t){let r=this.values(),n=r.next();for(;!n.done;)e.call(t,n.value,n.value,this),n=r.next()}};Set.prototype.difference&&Object.assign(qB,{intersection(e){return Set.prototype.intersection.call(new Set(this.values()),e)},union(e){return Set.prototype.union.call(new Set(this.values()),e)},difference(e){return Set.prototype.difference.call(new Set(this.values()),e)},symmetricDifference(e){return Set.prototype.symmetricDifference.call(new Set(this.values()),e)},isSubsetOf(e){return Set.prototype.isSubsetOf.call(new Set(this.values()),e)},isSupersetOf(e){return Set.prototype.isSupersetOf.call(new Set(this.values()),e)},isDisjointFrom(e){return Set.prototype.isDisjointFrom.call(new Set(this.values()),e)}});var oze=Reflect.ownKeys(qB),rue={get(e,t,r){var n,o;let i=(n=e.copy)===null||n===void 0?void 0:n[t];if(i&&e.finalities.draftsCache.has(i))return i;if(t===Kle)return e;let a;if(e.options.mark){let u=t==="size"&&(e.original instanceof Map||e.original instanceof Set)?Reflect.get(e.original,t):Reflect.get(e.original,t,r);if(a=e.options.mark(u,_m),a===_m.mutable)return e.options.strict&&ZB(u,e.options,!0),u}let s=Sd(e);if(s instanceof Map&&nze.includes(t))return t==="size"?Object.getOwnPropertyDescriptor(L9,"size").get.call(e.proxy):L9[t].bind(e.proxy);if(s instanceof Set&&oze.includes(t))return t==="size"?Object.getOwnPropertyDescriptor(qB,"size").get.call(e.proxy):qB[t].bind(e.proxy);if(!B_(s,t)){let u=Qle(s,t);return u?"value"in u?u.value:(o=u.get)===null||o===void 0?void 0:o.call(e.proxy):void 0}let l=s[t];if(e.options.strict&&ZB(l,e.options),e.finalized||!mp(l,e.options))return l;if(l===M9(e.original,t)){if(Uc(e),e.copy[t]=W9({original:e.original[t],parentDraft:e,key:e.type===1?Number(t):t,finalities:e.finalities,options:e.options}),typeof a=="function"){let u=Do(e.copy[t]);return Uc(u),tg(u),u.copy}return e.copy[t]}return rg(l)&&e.finalities.draftsCache.add(l),l},set(e,t,r){var n;if(e.type===3||e.type===2)throw new Error("Map/Set draft does not support any property assignment.");let o;if(e.type===1&&t!=="length"&&(!(Number.isInteger(o=Number(t))&&o>=0)||t!==0&&o!==0&&String(o)!==String(t)))throw new Error("Only supports setting array indices and the 'length' property.");let i=Qle(Sd(e),t);if(i?.set)return i.set.call(e.proxy,r),!0;let a=M9(Sd(e),t),s=Do(a);return s&&zy(s.original,r)?(e.copy[t]=r,e.assignedMap=(n=e.assignedMap)!==null&&n!==void 0?n:new Map,e.assignedMap.set(t,!1),!0):(zy(r,a)&&(r!==void 0||B_(e.original,t))||(Uc(e),tg(e),B_(e.original,t)&&zy(r,e.original[t])?e.assignedMap.delete(t):e.assignedMap.set(t,!0),e.copy[t]=r,j9(e,t,r,E_)),!0)},has:(e,t)=>t in Sd(e),ownKeys:e=>Reflect.ownKeys(Sd(e)),getOwnPropertyDescriptor(e,t){let r=Sd(e),n=Reflect.getOwnPropertyDescriptor(r,t);return n&&{writable:!0,configurable:e.type!==1||t!=="length",enumerable:n.enumerable,value:r[t]}},getPrototypeOf:e=>Reflect.getPrototypeOf(e.original),setPrototypeOf(){throw new Error("Cannot call 'setPrototypeOf()' on drafts")},defineProperty(){throw new Error("Cannot call 'defineProperty()' on drafts")},deleteProperty(e,t){var r;return e.type===1?rue.set.call(this,e,t,void 0,e.proxy):(M9(e.original,t)!==void 0||t in e.original?(Uc(e),tg(e),e.assignedMap.set(t,!1)):(e.assignedMap=(r=e.assignedMap)!==null&&r!==void 0?r:new Map,e.assignedMap.delete(t)),e.copy&&delete e.copy[t],!0)}};function W9(e){let{original:t,parentDraft:r,key:n,finalities:o,options:i}=e,a=Hy(t),s={type:a,finalized:!1,parent:r,original:t,copy:null,proxy:null,finalities:o,options:i,setMap:a===3?new Map(t.entries()):void 0};(n||"key"in e)&&(s.key=n);let{proxy:l,revoke:u}=Proxy.revocable(a===1?Object.assign([],s):s,rue);if(o.revoke.push(u),s.proxy=l,r){let c=r;c.finalities.draft.push(((m,d)=>{var p;let h=Do(l),f=c.type===3?c.setMap:c.copy,g=ng(f,n),y=Do(g);if(y){let x=y.original;y.operated&&(x=z9(g)),E9(y),k9(y,E_,m,d),k_(f,n,x)}(p=h.callbacks)===null||p===void 0||p.forEach((x=>{x(m,d)}))}))}else{let c=Do(l);c.finalities.draft.push(((m,d)=>{E9(c),k9(c,E_,m,d)}))}return l}function ize(e,t,r,n,o){var i;let a=Do(e),s=(i=a?.original)!==null&&i!==void 0?i:e,l=!!t.length;if(a?.operated)for(;a.finalities.draft.length>0;)a.finalities.draft.pop()(r,n);let u=l?t[0]:a?a.operated?a.copy:a.original:e;return a&&B9(a),o&&yI(u,0,a==null||a.options.updatedValues),[u,r&&l?[{op:da.Replace,path:[],value:t[0]}]:r,n&&l?[{op:da.Replace,path:[],value:s}]:n]}function V9(e){let{rootDraft:t,value:r,useRawReturn:n=!1,isRoot:o=!0}=e;H9(r,((i,a,s)=>{let l=Do(a);if(l&&t&&l.finalities===t.finalities){e.isContainDraft=!0;let u=l.original;if(s instanceof Set){let c=Array.from(s);s.clear(),c.forEach((m=>s.add(i===m?u:m)))}else k_(s,i,u)}else typeof a=="object"&&a!==null&&(e.value=a,e.isRoot=!1,V9(e))}))}function nue(e){var t;let r=Do(e);if(!mp(e,r?.options))return e;let n=Hy(e);if(r&&!r.operated)return r.original;let o;function i(){o=n===2?N9(e)?new Map(e):new(Object.getPrototypeOf(e)).constructor(e):n===3?Array.from(r.setMap.values()):eue(e,r?.options)}if(r){r.finalized=!0;try{i()}finally{r.finalized=!1}}else o=e;if(H9(o,((a,s)=>{if(r&&zy(ng(r.original,a),s))return;let l=nue(s);l!==s&&(o===e&&i(),k_(o,a,l))})),n===3){let a=(t=r?.original)!==null&&t!==void 0?t:o;return U9(a)?new Set(o):new(Object.getPrototypeOf(a)).constructor(o)}return o}function O9(e){if(!rg(e))throw new Error(`current() is only used for Draft, parameter: ${e}`);return nue(e)}G9.createDraft=W9;var oue=e=>function t(r,n,o){var i,a,s;if(typeof r=="function"&&typeof n!="function")return function(I,...v){return t(I,(A=>r.call(this,A,...v)),n)};let l=r,u=n,c=o;typeof n!="function"&&(c=n),c=Object.assign(Object.assign({},e),c);let m=rg(l)?O9(l):l,d=Array.isArray(c.mark)?(I,v)=>{for(let A of c.mark){let P=A(I,v);if(P)return P}}:c.mark,p=(i=c.enablePatches)!==null&&i!==void 0&&i,h=(a=c.strict)!==null&&a!==void 0&&a,f={enableAutoFreeze:(s=c.enableAutoFreeze)!==null&&s!==void 0&&s,mark:d,strict:h,enablePatches:p};if(!mp(m,f)&&typeof m=="object"&&m!==null)throw new Error("Invalid base state: create() only supports plain objects, arrays, Set, Map or using mark() to mark the state as immutable.");let[g,y]=(function(I,v){var A;let P={draft:[],revoke:[],handledSet:new WeakSet,draftsCache:new WeakSet},T,R;v.enablePatches&&(T=[],R=[]);let w=((A=v.mark)===null||A===void 0?void 0:A.call(v,I,_m))!==_m.mutable&&mp(I,v)?W9({original:I,parentDraft:null,finalities:P,options:v}):I;return[w,(E=[])=>{let[M,D,B]=ize(w,E,T,R,v.enableAutoFreeze);return v.enablePatches?[M,D,B]:M}]})(m,f);if(typeof n!="function"){if(!mp(m,f))throw new Error("Invalid base state: create() only supports plain objects, arrays, Set, Map or using mark() to mark the state as immutable.");return[g,y]}let x;try{x=u(g)}catch(I){throw B9(Do(g)),I}let S=I=>{let v=Do(g);if(!rg(I)){if(I!==void 0&&!zy(I,g)&&v?.operated)throw new Error("Either the value is returned as a new non-draft value, or only the draft is modified without returning any value.");let P=I?.[Jle];if(P){let T=P[0];return f.strict&&typeof I=="object"&&I!==null&&V9({rootDraft:v,value:I,useRawReturn:!0}),y([T])}if(I!==void 0)return typeof I=="object"&&I!==null&&V9({rootDraft:v,value:I}),y([I])}if(I===g||I===void 0)return y([]);let A=Do(I);if(f===A.options){if(A.operated)throw new Error("Cannot return a modified child draft.");return y([O9(I)])}return y([I])};return x instanceof Promise?x.then(S,(I=>{throw B9(Do(g)),I})):S(x)},Yle=oue(),aze=Object.prototype.constructor.toString();Pm.apply=function(e,t,r){let n;for(n=t.length-1;n>=0;n-=1){let{value:i,op:a,path:s}=t[n];if(!s.length&&a===da.Replace||s===""&&a===da.Add){e=i;break}}n>-1&&(t=t.slice(n+1));let o=i=>{t.forEach((a=>{let{path:s,op:l}=a,u=(function(h){return Array.isArray(h)?h:h.split("/").map((f=>f.replace(/~1/g,"/").replace(/~0/g,"~"))).slice(1)})(s),c=i;for(let h=0;h<u.length-1;h+=1){let f=Hy(c),g=u[h];if(typeof g!="string"&&typeof g!="number"&&(g=String(g)),(f===0||f===1)&&(g==="__proto__"||g==="constructor")||typeof c=="function"&&g==="prototype")throw new Error("Patching reserved attributes like __proto__ and constructor is not allowed.");if(c=ng(f===3?Array.from(c):c,g),typeof c!="object")throw new Error(`Cannot apply patch at '${u.join("/")}'.`)}let m=Hy(c),d=bI(a.value),p=u[u.length-1];switch(l){case da.Replace:switch(m){case 2:return c.set(p,d);case 3:throw new Error("Cannot apply replace patch to set.");default:return c[p]=d}case da.Add:switch(m){case 1:return p==="-"?c.push(d):c.splice(p,0,d);case 2:return c.set(p,d);case 3:return c.add(d);default:return c[p]=d}case da.Remove:switch(m){case 1:return c.splice(p,1);case 2:return c.delete(p);case 3:return c.delete(a.value);default:return delete c[p]}default:throw new Error(`Unsupported patch operation: ${l}.`)}}))};if(!r?.mutable){if(rg(e)){if(r!==void 0)throw new Error("Cannot apply patches with options to a draft.");return o(e),e}return Yle(e,o,Object.assign(Object.assign({},r),{enablePatches:!1}))}o(e)},Pm.castDraft=function(e){return e},Pm.castImmutable=function(e){return e},Pm.castMutable=function(e){return e},Pm.create=Yle,Pm.current=O9,Pm.isDraft=rg,Pm.isDraftable=mp,Pm.makeCreator=oue,Pm.markSimpleObject=e=>{if((t=>{if(!t||typeof t!="object")return!1;let r=Object.getPrototypeOf(t);if(r===null)return!0;let n=Object.hasOwnProperty.call(r,"constructor")&&r.constructor;return n===Object||typeof n=="function"&&Function.toString.call(n)===aze})(e))return _m.immutable},Pm.original=function(e){let t=Do(e);if(!t)throw new Error(`original() is only used for a draft, parameter: ${e}`);return t.original},Pm.rawReturn=function(e){if(arguments.length===0)throw new Error("rawReturn() must be called with a value.");if(arguments.length>1)throw new Error("rawReturn() must be called with one argument.");return{[Jle]:[e]}},Pm.unsafe=function(e){let t;F9=!0;try{t=e()}finally{F9=!1}return t}});var sue=ju((pOt,aue)=>{"use strict";aue.exports=iue()});var DSt={};Gi(DSt,{MVSData:()=>Ym,downloadCurrentStory:()=>RSt,getContext:()=>HG,loadFromData:()=>TSt,loadFromID:()=>_St,loadFromURL:()=>YBe});var WG=function(e,t){return WG=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(r[o]=n[o])},WG(e,t)};function Wu(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");WG(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}function pJ(e,t,r,n){function o(i){return i instanceof r?i:new r(function(a){a(i)})}return new(r||(r=Promise))(function(i,a){function s(c){try{u(n.next(c))}catch(m){a(m)}}function l(c){try{u(n.throw(c))}catch(m){a(m)}}function u(c){c.done?i(c.value):o(c.value).then(s,l)}u((n=n.apply(e,t||[])).next())})}function h3(e,t){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,a=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return a.next=s(0),a.throw=s(1),a.return=s(2),typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function s(u){return function(c){return l([u,c])}}function l(u){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,u[0]&&(r=0)),r;)try{if(n=1,o&&(i=u[0]&2?o.return:u[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,u[1])).done)return i;switch(o=0,i&&(u=[u[0]&2,i.value]),u[0]){case 0:case 1:i=u;break;case 4:return r.label++,{value:u[1],done:!1};case 5:r.label++,o=u[1],u=[0];continue;case 7:u=r.ops.pop(),r.trys.pop();continue;default:if(i=r.trys,!(i=i.length>0&&i[i.length-1])&&(u[0]===6||u[0]===2)){r=0;continue}if(u[0]===3&&(!i||u[1]>i[0]&&u[1]<i[3])){r.label=u[1];break}if(u[0]===6&&r.label<i[1]){r.label=i[1],i=u;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(u);break}i[2]&&r.ops.pop(),r.trys.pop();continue}u=t.call(e,r)}catch(c){u=[6,c],o=0}finally{n=i=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}function gy(e){var t=typeof Symbol=="function"&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function yy(e,t){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),o,i=[],a;try{for(;(t===void 0||t-- >0)&&!(o=n.next()).done;)i.push(o.value)}catch(s){a={error:s}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(a)throw a.error}}return i}function by(e,t,r){if(r||arguments.length===2)for(var n=0,o=t.length,i;n<o;n++)(i||!(n in t))&&(i||(i=Array.prototype.slice.call(t,0,n)),i[n]=t[n]);return e.concat(i||Array.prototype.slice.call(t))}function P0(e){return this instanceof P0?(this.v=e,this):new P0(e)}function fJ(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=r.apply(e,t||[]),o,i=[];return o=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),s("next"),s("throw"),s("return",a),o[Symbol.asyncIterator]=function(){return this},o;function a(p){return function(h){return Promise.resolve(h).then(p,m)}}function s(p,h){n[p]&&(o[p]=function(f){return new Promise(function(g,y){i.push([p,f,g,y])>1||l(p,f)})},h&&(o[p]=h(o[p])))}function l(p,h){try{u(n[p](h))}catch(f){d(i[0][3],f)}}function u(p){p.value instanceof P0?Promise.resolve(p.value.v).then(c,m):d(i[0][2],p)}function c(p){l("next",p)}function m(p){l("throw",p)}function d(p,h){p(h),i.shift(),i.length&&l(i[0][0],i[0][1])}}function hJ(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=e[Symbol.asyncIterator],r;return t?t.call(e):(e=typeof gy=="function"?gy(e):e[Symbol.iterator](),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(i){r[i]=e[i]&&function(a){return new Promise(function(s,l){a=e[i](a),o(s,l,a.done,a.value)})}}function o(i,a,s,l){Promise.resolve(l).then(function(u){i({value:u,done:s})},a)}}function si(e){return typeof e=="function"}function g3(e){var t=function(n){Error.call(n),n.stack=new Error().stack},r=e(t);return r.prototype=Object.create(Error.prototype),r.prototype.constructor=r,r}var y3=g3(function(e){return function(r){e(this),this.message=r?r.length+` errors occurred during unsubscription:
`+r.map(function(n,o){return o+1+") "+n.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=r}});function _0(e,t){if(e){var r=e.indexOf(t);0<=r&&e.splice(r,1)}}var Qb=(function(){function e(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}return e.prototype.unsubscribe=function(){var t,r,n,o,i;if(!this.closed){this.closed=!0;var a=this._parentage;if(a)if(this._parentage=null,Array.isArray(a))try{for(var s=gy(a),l=s.next();!l.done;l=s.next()){var u=l.value;u.remove(this)}}catch(f){t={error:f}}finally{try{l&&!l.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}else a.remove(this);var c=this.initialTeardown;if(si(c))try{c()}catch(f){i=f instanceof y3?f.errors:[f]}var m=this._finalizers;if(m){this._finalizers=null;try{for(var d=gy(m),p=d.next();!p.done;p=d.next()){var h=p.value;try{gJ(h)}catch(f){i=i??[],f instanceof y3?i=by(by([],yy(i)),yy(f.errors)):i.push(f)}}}catch(f){n={error:f}}finally{try{p&&!p.done&&(o=d.return)&&o.call(d)}finally{if(n)throw n.error}}}if(i)throw new y3(i)}},e.prototype.add=function(t){var r;if(t&&t!==this)if(this.closed)gJ(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=(r=this._finalizers)!==null&&r!==void 0?r:[]).push(t)}},e.prototype._hasParent=function(t){var r=this._parentage;return r===t||Array.isArray(r)&&r.includes(t)},e.prototype._addParent=function(t){var r=this._parentage;this._parentage=Array.isArray(r)?(r.push(t),r):r?[r,t]:t},e.prototype._removeParent=function(t){var r=this._parentage;r===t?this._parentage=null:Array.isArray(r)&&_0(r,t)},e.prototype.remove=function(t){var r=this._finalizers;r&&_0(r,t),t instanceof e&&t._removeParent(this)},e.EMPTY=(function(){var t=new e;return t.closed=!0,t})(),e})();var XG=Qb.EMPTY;function b3(e){return e instanceof Qb||e&&"closed"in e&&si(e.remove)&&si(e.add)&&si(e.unsubscribe)}function gJ(e){si(e)?e():e.unsubscribe()}var Cf={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1};var K1={setTimeout:function(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];var o=K1.delegate;return o?.setTimeout?o.setTimeout.apply(o,by([e,t],yy(r))):setTimeout.apply(void 0,by([e,t],yy(r)))},clearTimeout:function(e){var t=K1.delegate;return(t?.clearTimeout||clearTimeout)(e)},delegate:void 0};function x3(e){K1.setTimeout(function(){var t=Cf.onUnhandledError;if(t)t(e);else throw e})}function QG(){}var yJ=(function(){return ZG("C",void 0,void 0)})();function bJ(e){return ZG("E",void 0,e)}function xJ(e){return ZG("N",e,void 0)}function ZG(e,t,r){return{kind:e,value:t,error:r}}var R0=null;function J1(e){if(Cf.useDeprecatedSynchronousErrorHandling){var t=!R0;if(t&&(R0={errorThrown:!1,error:null}),e(),t){var r=R0,n=r.errorThrown,o=r.error;if(R0=null,n)throw o}}else e()}function CJ(e){Cf.useDeprecatedSynchronousErrorHandling&&R0&&(R0.errorThrown=!0,R0.error=e)}var BP=(function(e){Wu(t,e);function t(r){var n=e.call(this)||this;return n.isStopped=!1,r?(n.destination=r,b3(r)&&r.add(n)):n.destination=lEe,n}return t.create=function(r,n,o){return new S3(r,n,o)},t.prototype.next=function(r){this.isStopped?YG(xJ(r),this):this._next(r)},t.prototype.error=function(r){this.isStopped?YG(bJ(r),this):(this.isStopped=!0,this._error(r))},t.prototype.complete=function(){this.isStopped?YG(yJ,this):(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(r){this.destination.next(r)},t.prototype._error=function(r){try{this.destination.error(r)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t})(Qb);var iEe=Function.prototype.bind;function qG(e,t){return iEe.call(e,t)}var aEe=(function(){function e(t){this.partialObserver=t}return e.prototype.next=function(t){var r=this.partialObserver;if(r.next)try{r.next(t)}catch(n){C3(n)}},e.prototype.error=function(t){var r=this.partialObserver;if(r.error)try{r.error(t)}catch(n){C3(n)}else C3(t)},e.prototype.complete=function(){var t=this.partialObserver;if(t.complete)try{t.complete()}catch(r){C3(r)}},e})(),S3=(function(e){Wu(t,e);function t(r,n,o){var i=e.call(this)||this,a;if(si(r)||!r)a={next:r??void 0,error:n??void 0,complete:o??void 0};else{var s;i&&Cf.useDeprecatedNextContext?(s=Object.create(r),s.unsubscribe=function(){return i.unsubscribe()},a={next:r.next&&qG(r.next,s),error:r.error&&qG(r.error,s),complete:r.complete&&qG(r.complete,s)}):a=r}return i.destination=new aEe(a),i}return t})(BP);function C3(e){Cf.useDeprecatedSynchronousErrorHandling?CJ(e):x3(e)}function sEe(e){throw e}function YG(e,t){var r=Cf.onStoppedNotification;r&&K1.setTimeout(function(){return r(e,t)})}var lEe={closed:!0,next:QG,error:sEe,complete:QG};var $1=(function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"})();function ev(e){return e}function SJ(e){return e.length===0?ev:e.length===1?e[0]:function(r){return e.reduce(function(n,o){return o(n)},r)}}var Zs=(function(){function e(t){t&&(this._subscribe=t)}return e.prototype.lift=function(t){var r=new e;return r.source=this,r.operator=t,r},e.prototype.subscribe=function(t,r,n){var o=this,i=cEe(t)?t:new S3(t,r,n);return J1(function(){var a=o,s=a.operator,l=a.source;i.add(s?s.call(i,l):l?o._subscribe(i):o._trySubscribe(i))}),i},e.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(r){t.error(r)}},e.prototype.forEach=function(t,r){var n=this;return r=vJ(r),new r(function(o,i){var a=new S3({next:function(s){try{t(s)}catch(l){i(l),a.unsubscribe()}},error:i,complete:o});n.subscribe(a)})},e.prototype._subscribe=function(t){var r;return(r=this.source)===null||r===void 0?void 0:r.subscribe(t)},e.prototype[$1]=function(){return this},e.prototype.pipe=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return SJ(t)(this)},e.prototype.toPromise=function(t){var r=this;return t=vJ(t),new t(function(n,o){var i;r.subscribe(function(a){return i=a},function(a){return o(a)},function(){return n(i)})})},e.create=function(t){return new e(t)},e})();function vJ(e){var t;return(t=e??Cf.Promise)!==null&&t!==void 0?t:Promise}function uEe(e){return e&&si(e.next)&&si(e.error)&&si(e.complete)}function cEe(e){return e&&e instanceof BP||uEe(e)&&b3(e)}function mEe(e){return si(e?.lift)}function kl(e){return function(t){if(mEe(t))return t.lift(function(r){try{return e(r,this)}catch(n){this.error(n)}});throw new TypeError("Unable to lift unknown Observable type")}}function Fl(e,t,r,n,o){return new dEe(e,t,r,n,o)}var dEe=(function(e){Wu(t,e);function t(r,n,o,i,a,s){var l=e.call(this,r)||this;return l.onFinalize=a,l.shouldUnsubscribe=s,l._next=n?function(u){try{n(u)}catch(c){r.error(c)}}:e.prototype._next,l._error=i?function(u){try{i(u)}catch(c){r.error(c)}finally{this.unsubscribe()}}:e.prototype._error,l._complete=o?function(){try{o()}catch(u){r.error(u)}finally{this.unsubscribe()}}:e.prototype._complete,l}return t.prototype.unsubscribe=function(){var r;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var n=this.closed;e.prototype.unsubscribe.call(this),!n&&((r=this.onFinalize)===null||r===void 0||r.call(this))}},t})(BP);var IJ=g3(function(e){return function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}});var Pn=(function(e){Wu(t,e);function t(){var r=e.call(this)||this;return r.closed=!1,r.currentObservers=null,r.observers=[],r.isStopped=!1,r.hasError=!1,r.thrownError=null,r}return t.prototype.lift=function(r){var n=new AJ(this,this);return n.operator=r,n},t.prototype._throwIfClosed=function(){if(this.closed)throw new IJ},t.prototype.next=function(r){var n=this;J1(function(){var o,i;if(n._throwIfClosed(),!n.isStopped){n.currentObservers||(n.currentObservers=Array.from(n.observers));try{for(var a=gy(n.currentObservers),s=a.next();!s.done;s=a.next()){var l=s.value;l.next(r)}}catch(u){o={error:u}}finally{try{s&&!s.done&&(i=a.return)&&i.call(a)}finally{if(o)throw o.error}}}})},t.prototype.error=function(r){var n=this;J1(function(){if(n._throwIfClosed(),!n.isStopped){n.hasError=n.isStopped=!0,n.thrownError=r;for(var o=n.observers;o.length;)o.shift().error(r)}})},t.prototype.complete=function(){var r=this;J1(function(){if(r._throwIfClosed(),!r.isStopped){r.isStopped=!0;for(var n=r.observers;n.length;)n.shift().complete()}})},t.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(t.prototype,"observed",{get:function(){var r;return((r=this.observers)===null||r===void 0?void 0:r.length)>0},enumerable:!1,configurable:!0}),t.prototype._trySubscribe=function(r){return this._throwIfClosed(),e.prototype._trySubscribe.call(this,r)},t.prototype._subscribe=function(r){return this._throwIfClosed(),this._checkFinalizedStatuses(r),this._innerSubscribe(r)},t.prototype._innerSubscribe=function(r){var n=this,o=this,i=o.hasError,a=o.isStopped,s=o.observers;return i||a?XG:(this.currentObservers=null,s.push(r),new Qb(function(){n.currentObservers=null,_0(s,r)}))},t.prototype._checkFinalizedStatuses=function(r){var n=this,o=n.hasError,i=n.thrownError,a=n.isStopped;o?r.error(i):a&&r.complete()},t.prototype.asObservable=function(){var r=new Zs;return r.source=this,r},t.create=function(r,n){return new AJ(r,n)},t})(Zs);var AJ=(function(e){Wu(t,e);function t(r,n){var o=e.call(this)||this;return o.destination=r,o.source=n,o}return t.prototype.next=function(r){var n,o;(o=(n=this.destination)===null||n===void 0?void 0:n.next)===null||o===void 0||o.call(n,r)},t.prototype.error=function(r){var n,o;(o=(n=this.destination)===null||n===void 0?void 0:n.error)===null||o===void 0||o.call(n,r)},t.prototype.complete=function(){var r,n;(n=(r=this.destination)===null||r===void 0?void 0:r.complete)===null||n===void 0||n.call(r)},t.prototype._subscribe=function(r){var n,o;return(o=(n=this.source)===null||n===void 0?void 0:n.subscribe(r))!==null&&o!==void 0?o:XG},t})(Pn);var Di=(function(e){Wu(t,e);function t(r){var n=e.call(this)||this;return n._value=r,n}return Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),t.prototype._subscribe=function(r){var n=e.prototype._subscribe.call(this,r);return!n.closed&&r.next(this._value),n},t.prototype.getValue=function(){var r=this,n=r.hasError,o=r.thrownError,i=r._value;if(n)throw o;return this._throwIfClosed(),i},t.prototype.next=function(r){e.prototype.next.call(this,this._value=r)},t})(Pn);var KG={now:function(){return(KG.delegate||Date).now()},delegate:void 0};var TJ=(function(e){Wu(t,e);function t(r,n){return e.call(this)||this}return t.prototype.schedule=function(r,n){return n===void 0&&(n=0),this},t})(Qb);var EP={setInterval:function(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];var o=EP.delegate;return o?.setInterval?o.setInterval.apply(o,by([e,t],yy(r))):setInterval.apply(void 0,by([e,t],yy(r)))},clearInterval:function(e){var t=EP.delegate;return(t?.clearInterval||clearInterval)(e)},delegate:void 0};var PJ=(function(e){Wu(t,e);function t(r,n){var o=e.call(this,r,n)||this;return o.scheduler=r,o.work=n,o.pending=!1,o}return t.prototype.schedule=function(r,n){var o;if(n===void 0&&(n=0),this.closed)return this;this.state=r;var i=this.id,a=this.scheduler;return i!=null&&(this.id=this.recycleAsyncId(a,i,n)),this.pending=!0,this.delay=n,this.id=(o=this.id)!==null&&o!==void 0?o:this.requestAsyncId(a,this.id,n),this},t.prototype.requestAsyncId=function(r,n,o){return o===void 0&&(o=0),EP.setInterval(r.flush.bind(r,this),o)},t.prototype.recycleAsyncId=function(r,n,o){if(o===void 0&&(o=0),o!=null&&this.delay===o&&this.pending===!1)return n;n!=null&&EP.clearInterval(n)},t.prototype.execute=function(r,n){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var o=this._execute(r,n);if(o)return o;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},t.prototype._execute=function(r,n){var o=!1,i;try{this.work(r)}catch(a){o=!0,i=a||new Error("Scheduled action threw falsy error")}if(o)return this.unsubscribe(),i},t.prototype.unsubscribe=function(){if(!this.closed){var r=this,n=r.id,o=r.scheduler,i=o.actions;this.work=this.state=this.scheduler=null,this.pending=!1,_0(i,this),n!=null&&(this.id=this.recycleAsyncId(o,n,null)),this.delay=null,e.prototype.unsubscribe.call(this)}},t})(TJ);var JG=(function(){function e(t,r){r===void 0&&(r=e.now),this.schedulerActionCtor=t,this.now=r}return e.prototype.schedule=function(t,r,n){return r===void 0&&(r=0),new this.schedulerActionCtor(this,t).schedule(n,r)},e.now=KG.now,e})();var _J=(function(e){Wu(t,e);function t(r,n){n===void 0&&(n=JG.now);var o=e.call(this,r,n)||this;return o.actions=[],o._active=!1,o}return t.prototype.flush=function(r){var n=this.actions;if(this._active){n.push(r);return}var o;this._active=!0;do if(o=r.execute(r.state,r.delay))break;while(r=n.shift());if(this._active=!1,o){for(;r=n.shift();)r.unsubscribe();throw o}},t})(JG);var kP=new _J(PJ),RJ=kP;var v3=new Zs(function(e){return e.complete()});function I3(e){return e&&si(e.schedule)}function DJ(e){return e[e.length-1]}function wJ(e){return I3(DJ(e))?e.pop():void 0}function MJ(e,t){return typeof DJ(e)=="number"?e.pop():t}var A3=(function(e){return e&&typeof e.length=="number"&&typeof e!="function"});function T3(e){return si(e?.then)}function P3(e){return si(e[$1])}function _3(e){return Symbol.asyncIterator&&si(e?.[Symbol.asyncIterator])}function R3(e){return new TypeError("You provided "+(e!==null&&typeof e=="object"?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function pEe(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var D3=pEe();function w3(e){return si(e?.[D3])}function M3(e){return fJ(this,arguments,function(){var r,n,o,i;return h3(this,function(a){switch(a.label){case 0:r=e.getReader(),a.label=1;case 1:a.trys.push([1,,9,10]),a.label=2;case 2:return[4,P0(r.read())];case 3:return n=a.sent(),o=n.value,i=n.done,i?[4,P0(void 0)]:[3,5];case 4:return[2,a.sent()];case 5:return[4,P0(o)];case 6:return[4,a.sent()];case 7:return a.sent(),[3,2];case 8:return[3,10];case 9:return r.releaseLock(),[7];case 10:return[2]}})})}function B3(e){return si(e?.getReader)}function pm(e){if(e instanceof Zs)return e;if(e!=null){if(P3(e))return fEe(e);if(A3(e))return hEe(e);if(T3(e))return gEe(e);if(_3(e))return BJ(e);if(w3(e))return yEe(e);if(B3(e))return bEe(e)}throw R3(e)}function fEe(e){return new Zs(function(t){var r=e[$1]();if(si(r.subscribe))return r.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function hEe(e){return new Zs(function(t){for(var r=0;r<e.length&&!t.closed;r++)t.next(e[r]);t.complete()})}function gEe(e){return new Zs(function(t){e.then(function(r){t.closed||(t.next(r),t.complete())},function(r){return t.error(r)}).then(null,x3)})}function yEe(e){return new Zs(function(t){var r,n;try{for(var o=gy(e),i=o.next();!i.done;i=o.next()){var a=i.value;if(t.next(a),t.closed)return}}catch(s){r={error:s}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}t.complete()})}function BJ(e){return new Zs(function(t){xEe(e,t).catch(function(r){return t.error(r)})})}function bEe(e){return BJ(M3(e))}function xEe(e,t){var r,n,o,i;return pJ(this,void 0,void 0,function(){var a,s;return h3(this,function(l){switch(l.label){case 0:l.trys.push([0,5,6,11]),r=hJ(e),l.label=1;case 1:return[4,r.next()];case 2:if(n=l.sent(),!!n.done)return[3,4];if(a=n.value,t.next(a),t.closed)return[2];l.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return s=l.sent(),o={error:s},[3,11];case 6:return l.trys.push([6,,9,10]),n&&!n.done&&(i=r.return)?[4,i.call(r)]:[3,8];case 7:l.sent(),l.label=8;case 8:return[3,10];case 9:if(o)throw o.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}})})}function Kd(e,t,r,n,o){n===void 0&&(n=0),o===void 0&&(o=!1);var i=t.schedule(function(){r(),o?e.add(this.schedule(null,n)):this.unsubscribe()},n);if(e.add(i),!o)return i}function E3(e,t){return t===void 0&&(t=0),kl(function(r,n){r.subscribe(Fl(n,function(o){return Kd(n,e,function(){return n.next(o)},t)},function(){return Kd(n,e,function(){return n.complete()},t)},function(o){return Kd(n,e,function(){return n.error(o)},t)}))})}function k3(e,t){return t===void 0&&(t=0),kl(function(r,n){n.add(e.schedule(function(){return r.subscribe(n)},t))})}function EJ(e,t){return pm(e).pipe(k3(t),E3(t))}function kJ(e,t){return pm(e).pipe(k3(t),E3(t))}function FJ(e,t){return new Zs(function(r){var n=0;return t.schedule(function(){n===e.length?r.complete():(r.next(e[n++]),r.closed||this.schedule())})})}function LJ(e,t){return new Zs(function(r){var n;return Kd(r,t,function(){n=e[D3](),Kd(r,t,function(){var o,i,a;try{o=n.next(),i=o.value,a=o.done}catch(s){r.error(s);return}a?r.complete():r.next(i)},0,!0)}),function(){return si(n?.return)&&n.return()}})}function F3(e,t){if(!e)throw new Error("Iterable cannot be null");return new Zs(function(r){Kd(r,t,function(){var n=e[Symbol.asyncIterator]();Kd(r,t,function(){n.next().then(function(o){o.done?r.complete():r.next(o.value)})},0,!0)})})}function VJ(e,t){return F3(M3(e),t)}function OJ(e,t){if(e!=null){if(P3(e))return EJ(e,t);if(A3(e))return FJ(e,t);if(T3(e))return kJ(e,t);if(_3(e))return F3(e,t);if(w3(e))return LJ(e,t);if(B3(e))return VJ(e,t)}throw R3(e)}function GJ(e,t){return t?OJ(e,t):pm(e)}function UJ(e){return e instanceof Date&&!isNaN(e)}function D0(e,t){return kl(function(r,n){var o=0;r.subscribe(Fl(n,function(i){n.next(e.call(t,i,o++))}))})}function NJ(e,t,r,n,o,i,a,s){var l=[],u=0,c=0,m=!1,d=function(){m&&!l.length&&!u&&t.complete()},p=function(f){return u<n?h(f):l.push(f)},h=function(f){i&&t.next(f),u++;var g=!1;pm(r(f,c++)).subscribe(Fl(t,function(y){o?.(y),i?p(y):t.next(y)},function(){g=!0},void 0,function(){if(g)try{u--;for(var y=function(){var x=l.shift();a?Kd(t,a,function(){return h(x)}):h(x)};l.length&&u<n;)y();d()}catch(x){t.error(x)}}))};return e.subscribe(Fl(t,p,function(){m=!0,d()})),function(){s?.()}}function $G(e,t,r){return r===void 0&&(r=1/0),si(t)?$G(function(n,o){return D0(function(i,a){return t(n,i,o,a)})(pm(e(n,o)))},r):(typeof t=="number"&&(r=t),kl(function(n,o){return NJ(n,o,e,r)}))}function zJ(e){return e===void 0&&(e=1/0),$G(ev,e)}function HJ(e,t,r){e===void 0&&(e=0),r===void 0&&(r=RJ);var n=-1;return t!=null&&(I3(t)?r=t:n=t),new Zs(function(o){var i=UJ(e)?+e-r.now():e;i<0&&(i=0);var a=0;return r.schedule(function(){o.closed||(o.next(a++),0<=n?this.schedule(void 0,n):o.complete())},i)})}function fm(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=wJ(e),n=MJ(e,1/0),o=e;return o.length?o.length===1?pm(o[0]):zJ(n)(GJ(o,r)):v3}function Rh(e,t){return kl(function(r,n){var o=0;r.subscribe(Fl(n,function(i){return e.call(t,i,o++)&&n.next(i)}))})}function Zb(e,t){return t===void 0&&(t=kP),kl(function(r,n){var o=null,i=null,a=null,s=function(){if(o){o.unsubscribe(),o=null;var u=i;i=null,n.next(u)}};function l(){var u=a+e,c=t.now();if(c<u){o=this.schedule(void 0,u-c),n.add(o);return}s()}r.subscribe(Fl(n,function(u){i=u,a=t.now(),o||(o=t.schedule(l,e),n.add(o))},function(){s(),n.complete()},void 0,function(){i=o=null}))})}function eU(e){return e<=0?function(){return v3}:kl(function(t,r){var n=0;t.subscribe(Fl(r,function(o){++n<=e&&(r.next(o),e<=n&&r.complete())}))})}function FP(e,t){return t===void 0&&(t=ev),e=e??CEe,kl(function(r,n){var o,i=!0;r.subscribe(Fl(n,function(a){var s=t(a);(i||!e(o,s))&&(i=!1,o=s,n.next(a))}))})}function CEe(e,t){return e===t}function LP(e){return Rh(function(t,r){return e<=r})}function jJ(e,t){return kl(function(r,n){var o=t??{},i=o.leading,a=i===void 0?!0:i,s=o.trailing,l=s===void 0?!1:s,u=!1,c=null,m=null,d=!1,p=function(){m?.unsubscribe(),m=null,l&&(g(),d&&n.complete())},h=function(){m=null,d&&n.complete()},f=function(y){return m=pm(e(y)).subscribe(Fl(n,p,h))},g=function(){if(u){u=!1;var y=c;c=null,n.next(y),!d&&f(y)}};r.subscribe(Fl(n,function(y){u=!0,c=y,!(m&&!m.closed)&&(a?g():f(y))},function(){d=!0,!(l&&u&&m&&!m.closed)&&n.complete()}))})}function Xu(e,t,r){t===void 0&&(t=kP);var n=HJ(e,t);return jJ(function(){return n},r)}var tU=class{constructor(t){this.name=t;this.commands=new Di(void 0);this.state={viewers:new Di([]),currentStoryData:new Di(void 0),isLoading:new Di(!1)}}dispatch(t){this.commands.next(t)}};function tv(e){let t=e?.container??window;t.componentContexts??={};let r=e?.name??"<default>";return t.componentContexts[r]||(t.componentContexts[r]=new tU(e?.name)),t.componentContexts[r]}var L3=Object.prototype.hasOwnProperty;function WJ(e,t){for(let r of Object.keys(t))L3.call(t,r)&&typeof e[r]>"u"&&(e[r]=t[r]);return e}function SEe(e,t){let r=!1;for(let n of Object.keys(t))if(L3.call(t,n)&&t[n]!==e[n]){r=!0;break}return r?Object.assign({},e,t):e}function qb(e,t){if(!e)return!t;if(!t)return!1;let r=Object.keys(e);if(Object.keys(t).length!==r.length)return!1;for(let n of r)if(!L3.call(e,n)||e[n]!==t[n])return!1;return!0}function XJ(e,t){let r=e;for(let n=0;n<t.length;n++)if(t[n]&&(r=SEe(e,t[n]),r!==e)){for(let o=n+1;o<t.length;o++)r=Object.assign(r,t[o]);break}return r}function Wo(e){if(e===null||typeof e!="object")return e;if(e instanceof Array){let t=[];for(let r=0,n=e.length;r<n;r++)t[r]=Wo(e[r]);return t}if(typeof e=="object"&&!("prototype"in e)){let t={};for(let r in e)L3.call(e,r)&&(t[r]=Wo(e[r]));return t}throw new Error(`Can't clone, type "${typeof e}" unsupported`)}function VP(e,t){let r={};for(let n of Object.keys(e))r[n]=t(e[n]);return r}function QJ(e,t){let r={};for(let n of e)r[n]=t(n);return r}function wi(e,t){if(e)for(let r of Object.keys(e))t(e[r],r)}function Ll(e,t){let r={};for(let n of t)Object.hasOwn(e,n)&&(r[n]=e[n]);return r}function rU(e,t,r){let n={};for(let o of t){let i=r[o];i!==null&&(i===void 0&&(i=o),Object.hasOwn(e,i)&&(n[o]=e[i]))}return n}function nU(e){let t;for(let n in e){let o=e[n].length;if(t!==void 0&&t!==o)throw new Error("FormatError: arrays must have the same length.");t=o}if(t===void 0)return[];let r=new Array(t);for(let n=0;n<t;n++){let o={};for(let i in e)o[i]=e[i][n];r[n]=o}return r}function Tu(e,t){let r={...e};for(let n of t)delete r[n];return r}function vEe(e,t){let r={};for(let n=0;n<e.length;n++)r[e[n]]=t[n];return r}function rv(e){return typeof e=="object"&&e!==null&&!Array.isArray(e)}async function ZJ(e){let t=Object.keys(e),r=Object.values(e),n=await Promise.all(r);return vEe(t,n)}var Tc;(t=>{function e(){let r=new oU,n=(()=>r.create());return n.dispose=()=>r.dispose(),n.behavior=o=>r.behavior(o),n}t.create=e})(Tc||={});var oU=class{constructor(){this._eventList=[];this._disposed=!1}create(){let t=new Pn;return this._eventList.push(t),t}behavior(t){let r=new Di(t);return this._eventList.push(r),r}dispose(){if(!this._disposed){for(let t of this._eventList)t.complete();this._disposed=!0}}};function xy(e){return JSON.stringify(e,(t,r)=>rv(r)?IEe(r):r)}function V3(e){return JSON.stringify(e,void 0,"	").replace(/,\n\t*/g,", ").replace(/\n\t*/g,"")}function IEe(e){let t={};for(let r of Object.keys(e).sort()){let n=e[r];n!==void 0&&(t[r]=n)}return t}function xl(e){let t=-1/0;for(let r=0,n=e.length;r<n;++r)e[r]>t&&(t=e[r]);return t}function Yb(e){let t=1/0;for(let r=0,n=e.length;r<n;++r)e[r]<t&&(t=e[r]);return t}function Qu(e){let t=1/0,r=-1/0;for(let n=0,o=e.length;n<o;++n)e[n]<t&&(t=e[n]),e[n]>r&&(r=e[n]);return[t,r]}function iU(e,t=1,r=0){let n=e.length,o=0;for(let i=r;i<n;i+=t)o+=e[i];return o}function Kb(e,t=1,r=0){return iU(e,t,r)/(e.length/t)}function Jb(e){let t=e.length,r=0;for(let n=0;n<t;++n){let o=e[n];r+=o*o}return Math.sqrt(r/t)}function Xa(e,t){for(let r=0,n=t?Math.min(t,e.length):e.length;r<n;++r)e[r]=r;return e}function Sf(e,t){let r=0,n=!1;for(let o=e.length;r<o;r++)if(e[r]===t){n=!0;break}return n?($b(e,r),!0):!1}function $b(e,t){for(let r=t,n=e.length-1;r<n;r++)e[r]=e[r+1];e.pop()}function li(e,t){return e.indexOf(t)>=0?!1:(e.push(t),!0)}function Jd(e,t){let r=e.indexOf(t);if(r<0)return!1;for(let n=r,o=e.length-1;n<o;n++)e[n]=e[n+1];return e.pop(),!0}function nv(e,t){let r=0;for(let n=0,o=e.length;n<o;++n)t.includes(e[n])&&(r+=1);return r}function w0(e,t){if(!e||e.length===0)return!t||t.length===0;if(!t)return!1;let r=e.length;if(r!==t.length)return!1;for(let n=0;n<r;n++)if(e[n]!==t[n])return!1;return!0}function qJ(e){for(let t=0,r=e.length;t<r;t++)if(e[t]!==t)return!1;return!0}function OP(e,t,r){for(let n=0,o=e.length;n<o;++n)if(e[n][0]===t){e[n][1]=r;return}e.push([t,r])}function Vl(e,t){t===void 0&&(t=e,e=0);let r=Math.max(t-e,0),n=Array(r);for(let o=0;o<r;o++)n[o]=e+o;return n}function ex(e,t){let r=e.length,n=t.length;e.length+=n;for(let o=0;o<n;o++)e[r+o]=t[o];return e}function GP(e,t){return AEe(e,t)?e:e.sort(t)}function AEe(e,t){for(let r=1,n=e.length;r<n;r++)if(t(e[r-1],e[r])>0)return!1;return!0}function Dh(e,t){let r=e.length,n=0;for(let o=0;o<r;o++)t(e[o])&&(e[n++]=e[o]);return e.length=n,e}function YJ(e){let t=new Set,r=[];for(let n of e){let o=xy(n);t.has(o)||(t.add(o),r.push(n))}return r}var Pc=class{constructor(){this.subs=void 0}subscribe(t,r){if(!t)return{unsubscribe:()=>{}};typeof this.subs>"u"&&(this.subs=[]);let n=t.subscribe(r);return this.subs.push(n),{unsubscribe:()=>{n&&this.subs&&Jd(this.subs,n)&&(n.unsubscribe(),n=void 0)}}}get ev(){return this._ev||(this._ev=Tc.create())}dispose(){if(this._ev&&this._ev.dispose(),this.subs){for(let t of this.subs)t.unsubscribe();this.subs=void 0}}},qs=class extends Pc{updateState(...t){let r=this.state,n=XJ(r,t);return n!==r?(this._state=n,!0):!1}get state(){return this._state}constructor(t){super(),this._state=t}};var tx=_t(Mi());function UEe(e){let[,t]=tx.default.useState({}),r=tx.default.useRef();return r.current=e?.value,tx.default.useEffect(()=>{if(!e)return;let n=e.subscribe(o=>{r.current!==o&&t({})});return()=>n.unsubscribe()},[e]),e?.value}function NEe(e){return tx.default.useSyncExternalStore(tx.default.useCallback(t=>{let r=e?.pipe(LP(1)).subscribe(t);return()=>r?.unsubscribe()},[e]),tx.default.useCallback(()=>e?.value,[e]))}var zEe=tx.default.useSyncExternalStore?NEe:UEe;function Ol(e){return zEe(e)}var Qae=_t(T5());var Uv=_t(Mi());var Vy=_t(Mi());var X0=Math.PI/2,wre=Math.PI/180;function kr(e){return e*wre}function Ya(e){return e/wre}function Ix(e){return e!==0&&(e&e-1)===0}function Mre(...e){let t=0,r=0;for(let n=0,o=e.length;n<o;++n){let i=e[n],a=Math.abs(i);a>r&&(t=i,r=a)}return t}function aM(e,t){return e*t}function sM(e){let t=0,r=0,n=0,o=-1,i=e*2+1,a=i/2,s=[];for(let l=Math.pow(i,2);l>0;--l){if(-a<t&&t<=a&&-a<r&&r<=a&&s.push([t,r]),t===r||t<0&&t===-r||t>0&&t===1-r){let u=n;n=-o,o=u}t+=n,r+=o}return s}function wf(e,t,r){return(e-t)/(r-t)}function _r(e,t,r){return Math.max(t,Math.min(r,e))}function WFe(e){return _r(e,0,1)}function to(e,t,r){return e+(t-e)*r}function kv(e,t,r,n,o,i){let a=(r-e)*i,s=(n-t)*i,l=o*o,u=o*l;return(2*t-2*r+a+s)*u+(-3*t+3*r-2*a-s)*l+a*o+t}function lM(e,t,r,n){let o=1-n;return o*o*e+2*o*n*t+n*n*r}function uM(e,t,r){return r=WFe(wf(r,e,t)),r*r*(3-2*r)}function Ma(){return Ma.zero()}(E=>{function e(){let M=[.1,0,0];return M[0]=0,M}E.zero=e;function t(M,D,B){let k=e();return k[0]=M,k[1]=D,k[2]=B,k}E.create=t;function r(M,D,B,k){return M[0]=D,M[1]=B,M[2]=k,M}E.set=r;function n(M,D){let B=D[0]-M[0],k=D[1]-M[1],F=D[2]-M[2];return Math.sqrt(B*B+k*k+F*F)}E.distance=n;function o(M,D){let[B,k,F]=Le.toRgb(D),[z,j,Y]=w(B,k,F),G=116*j-16;return M[0]=G<0?0:G,M[1]=500*(z-j),M[2]=200*(j-Y),M}E.fromColor=o;function i(M,D){return Cm.toLab(M,D)}E.fromHcl=i;function a(M){let D=(M[0]+16)/116,B=isNaN(M[1])?D:D+M[1]/500,k=isNaN(M[2])?D:D-M[2]/200;D=g*P(D),B=f*P(B),k=y*P(k);let F=A(3.2404542*B-1.5371385*D-.4985314*k),z=A(-.969266*B+1.8760108*D+.041556*k),j=A(.0556434*B-.2040259*D+1.0572252*k);return Le.fromRgb(Math.round(_r(F,0,255)),Math.round(_r(z,0,255)),Math.round(_r(j,0,255)))}E.toColor=a;function s(M,D){let[B,k,F]=D,z=Math.sqrt(k*k+F*F),j=(Ya(Math.atan2(F,k))+360)%360;return Math.round(z*1e4)===0&&(j=Number.NaN),M[0]=j,M[1]=z,M[2]=B,M}E.toHcl=s;function l(M,D){return M[0]=D[0],M[1]=D[1],M[2]=D[2],M}E.copy=l;function u(M,D,B){return M[0]=D[0]-h*B,M[1]=D[1],M[2]=D[2],M}E.darken=u;function c(M,D,B){return u(M,D,-B)}E.lighten=c;let m=[0,0,0];function d(M,D,B){return s(m,D),Cm.toLab(M,Cm.saturate(m,m,B))}E.saturate=d;function p(M,D,B){return d(M,D,-B)}E.desaturate=p;let h=18,f=.95047,g=1,y=1.08883,x=.137931034,S=.206896552,I=.12841855,v=.008856452;function A(M){return 255*(M<=.00304?12.92*M:1.055*Math.pow(M,1/2.4)-.055)}function P(M){return M>S?M*M*M:I*(M-x)}function T(M){return(M/=255)<=.04045?M/12.92:Math.pow((M+.055)/1.055,2.4)}function R(M){return M>v?Math.pow(M,1/3):M/I+x}function w(M,D,B){M=T(M),D=T(D),B=T(B);let k=R((.4124564*M+.3575761*D+.1804375*B)/f),F=R((.2126729*M+.7151522*D+.072175*B)/g),z=R((.0193339*M+.119192*D+.9503041*B)/y);return[k,F,z]}})(Ma||={});function Cm(){return Cm.zero()}(y=>{function e(){let x=[.1,0,0];return x[0]=0,x}y.zero=e;function t(x,S,I){let v=e();return v[0]=x,v[1]=S,v[2]=I,v}y.create=t;function r(x,S,I,v){return x[0]=S,x[1]=I,x[2]=v,x}y.set=r;function n(x){return!isNaN(x[0])}y.hasHue=n;let o=[0,0,0];function i(x,S){return Ma.toHcl(x,Ma.fromColor(o,S))}y.fromColor=i;function a(x,S){return Ma.toHcl(x,S)}y.fromLab=a;let s=[0,0,0];function l(x){return Ma.toColor(u(s,x))}y.toColor=l;function u(x,S){let[I,v,A]=S;return isNaN(I)&&(I=0),I=kr(I),x[0]=A,x[1]=Math.cos(I)*v,x[2]=Math.sin(I)*v,x}y.toLab=u;function c(x,S){return x[0]=S[0],x[1]=S[1],x[2]=S[2],x}y.copy=c;function m(x,S,I){return x[0]=S[0],x[1]=Math.max(0,S[1]+g*I),x[2]=S[2],x}y.saturate=m;function d(x,S,I){return m(x,S,-I)}y.desaturate=d;let p=[0,0,0];function h(x,S,I){return u(p,S),Ma.toHcl(x,Ma.darken(p,p,I))}y.darken=h;function f(x,S,I){return h(x,S,-I)}y.lighten=f;let g=18})(Cm||={});function Q0(){return Q0.zero()}(n=>{function e(){let o=[.1,0,0];return o[0]=0,o}n.zero=e;function t(o,i){return o[0]=(i>>16&255)/255,o[1]=(i>>8&255)/255,o[2]=(i&255)/255,o}n.fromColor=t;function r(o){return o[0]*255<<16|o[1]*255<<8|o[2]*255}n.toColor=r})(Q0||={});function Lh(){return Lh.zero()}(u=>{function e(){let c=[.1,0,0];return c[0]=0,c}u.zero=e;let t=Q0();function r(c,m){return Q0.fromColor(t,m),u.fromRgb(c,t)}u.fromColor=r;function n(c){return s(t,c),Q0.toColor(t)}u.toColor=n;function o(c,m){let[d,p,h]=m,f=Math.min(d,p,h),g=Math.max(d,p,h),y=(g+f)/2,x=0,S=0;return g===f?(x=0,S=Number.NaN):x=y<.5?(g-f)/(g+f):(g-f)/(2-g-f),d===g?S=(p-h)/(g-f):p===g?S=2+(h-d)/(g-f):h===g&&(S=4+(d-p)/(g-f)),S*=60,S<0&&(S+=360),c[0]=S,c[1]=x,c[2]=y,c}u.fromRgb=o;let i=[0,0,0],a=[0,0,0];function s(c,m){let[d,p,h]=m,f,g,y;if(p===0)f=g=y=h;else{let x=i,S=a,I=h<.5?h*(1+p):h+p-h*p,v=2*h-I,A=d/360;x[0]=A+1/3,x[1]=A,x[2]=A-1/3;for(let P=0;P<3;P++)x[P]<0&&(x[P]+=1),x[P]>1&&(x[P]-=1),6*x[P]<1?S[P]=v+(I-v)*6*x[P]:2*x[P]<1?S[P]=I:3*x[P]<2?S[P]=v+(I-v)*(2/3-x[P])*6:S[P]=v;f=S[0],g=S[1],y=S[2]}return c[0]=f,c[1]=g,c[2]=y,c}u.toRgb=s;function l(c,m,d,p){let h=m,f=d,[g,y,x]=h,[S,I,v]=f,A,P,T;!isNaN(g)&&!isNaN(S)?(S>g&&S-g>180?T=S-(g+360):S<g&&g-S>180?T=S+360-g:T=S-g,P=g+p*T):isNaN(g)?isNaN(S)?P=Number.NaN:(P=S,(x===1||x===0)&&(A=I)):(P=g,(v===1||v===0)&&(A=y)),A===void 0&&(A=y+p*(I-y));let R=x+p*(v-x);return c[0]=P,c[1]=A,c[2]=R,c}u.interpolate=l})(Lh||={});function Le(e){return e}(Y=>{function e(G){return`rgb(${G>>16&255}, ${G>>8&255}, ${G&255})`}Y.toStyle=e;function t(G){return"#"+("000000"+G.toString(16)).slice(-6)}Y.toHexStyle=t;function r(G){return"0x"+("000000"+G.toString(16)).slice(-6)}Y.toHexString=r;function n(G){return`RGB: ${Y.toRgb(G).join(", ")}`}Y.toRgbString=n;function o(G){return[G>>16&255,G>>8&255,G&255]}Y.toRgb=o;function i(G){return[(G>>16&255)/255,(G>>8&255)/255,(G&255)/255]}Y.toRgbNormalized=i;function a(G){return parseInt(G.replace("#","0x"))}Y.fromHexStyle=a;function s(G){return parseInt(G)}Y.fromHexString=s;function l(G,X,U){return G<<16|X<<8|U}Y.fromRgb=l;function u(G,X,U){return G*255<<16|X*255<<8|U*255}Y.fromNormalizedRgb=u;function c(G,X){return l(G[X],G[X+1],G[X+2])}Y.fromArray=c;function m(G,X){return u(G[X],G[X+1],G[X+2])}Y.fromNormalizedArray=m;function d(G){return typeof G=="number"?G:G[0]}Y.fromColorListEntry=d;function p(G,X,U){return X[U]=G>>16&255,X[U+1]=G>>8&255,X[U+2]=G&255,X}Y.toArray=p;function h(G,X,U){return X[U]=(G>>16&255)/255,X[U+1]=(G>>8&255)/255,X[U+2]=(G&255)/255,X}Y.toArrayNormalized=h;function f(G,X){return G[0]=X>>16&255,G[1]=X>>8&255,G[2]=X&255,G}Y.toVec3=f;function g(G,X){return G[0]=(X>>16&255)/255,G[1]=(X>>8&255)/255,G[2]=(X&255)/255,G}Y.toVec3Normalized=g;function y(G,X,U){let L=G>>16&255,q=G>>8&255,te=G&255,J=X>>16&255,ee=X>>8&255,ce=X&255,fe=L+(J-L)*U,O=q+(ee-q)*U,V=te+(ce-te)*U;return fe<<16|O<<8|V}Y.interpolate=y;let x=Lh.zero(),S=Lh.zero();function I(G,X,U){let L=Lh.fromColor(x,G),q=Lh.fromColor(S,X);return Lh.interpolate(L,L,q,U),Lh.toColor(L)}Y.interpolateHsl=I;function v(G){let X=G>>16&255,U=G>>8&255,L=G&255;return X!==U||X!==L}Y.hasHue=v;let A=[0,0,0];function P(G,X){return v(G)?(Cm.fromColor(A,G),Cm.toColor(Cm.saturate(A,A,X))):G}Y.saturate=P;function T(G,X){return P(G,-X)}Y.desaturate=T;let R=[0,0,0];function w(G,X){return Ma.fromColor(R,G),Ma.toColor(Ma.darken(R,R,X))}Y.darken=w;function E(G,X){return w(G,-X)}Y.lighten=E;function M(G){return G<=.03928?G/12.92:Math.pow((G+.055)/1.055,2.4)}function D(G){let X=M((G>>16&255)/255),U=M((G>>8&255)/255),L=M((G&255)/255);return .2126*X+.7152*U+.0722*L}Y.luminance=D;function B(G,X){let U=D(G),L=D(X);return U>L?(U+.05)/(L+.05):(L+.05)/(U+.05)}Y.contrast=B;function k(G){return G<.04045?G*.0773993808:Math.pow(G*.9478672986+.0521327014,2.4)}function F(G){return u(k((G>>16&255)/255),k((G>>8&255)/255),k((G&255)/255))}Y.sRGBToLinear=F;function z(G){return G<.0031308?G*12.92:1.055*Math.pow(G,.41666)-.055}function j(G){return u(z((G>>16&255)/255),z((G>>8&255)/255),z((G&255)/255))}Y.linearToSRGB=j})(Le||={});function rn(e,t,r,n){return{label:e,description:r,list:n,type:t}}function Vh(e,t,r){let n={};for(let o in e){let i=e[o];i=Le.saturate(i,t),i=Le.darken(i,-r),n[o]=i}return n}function Bre(e,t=" "){return e.replace(/([a-z\xE0-\xFF])([A-Z\xC0\xDF])/g,`$1${t}$2`)}function Ks(e){return Sm(Bre(e))}var XFe=e=>e.toUpperCase();function Ere(e){return e?typeof e=="string"?e.toUpperCase():`${e}`.toUpperCase():""}function Sm(e){return e.toLowerCase().replace(/^\w|\s\w/g,XFe)}function QFe(e){return e.replace(/_/g," ")}function ZFe(e){return e.replace(/-/g," ")}function va(e){return Sm(Bre(QFe(ZFe(e))))}function kre(e,t){let r=Object.keys(t),n=Object.values(t);return new Function(...r,`return \`${e}\`;`)(...n)}function ud(e){return e.replace(/<\/?[^>]+>/g,"")}function wy(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}var Sr={reds:rn("Reds","sequential","Reds, sequential color scheme from ColorBrewer 2.0",[16774640,16703698,16563105,16552562,16476746,15678252,13309981,10817301,6750221]),oranges:rn("Oranges","sequential","Oranges, sequential color scheme from ColorBrewer 2.0",[16774635,16705230,16634018,16625259,16616764,15821075,14239745,10892803,8333060]),greens:rn("Greens","sequential","Greens, sequential color scheme from ColorBrewer 2.0",[16252149,15070688,13101504,10607003,7652470,4303709,2329413,27948,17435]),blues:rn("Blues","sequential","Blues, sequential color scheme from ColorBrewer 2.0",[16251903,14609399,13032431,10406625,7057110,4362950,2191797,545180,536683]),purples:rn("Purples","sequential","Purples, sequential color scheme from ColorBrewer 2.0",[16579581,15724021,14342891,12369372,10394312,8420794,6967715,5515151,4128893]),greys:rn("Greys","sequential","Greys, sequential color scheme from ColorBrewer 2.0",[16777215,15790320,14277081,12434877,9868950,7566195,5395026,2434341,0]),"orange-red":rn("Orange-Red","sequential","OrRd, sequential color scheme from ColorBrewer 2.0",[16775148,16705736,16635038,16628612,16551257,15689032,14102559,11730944,8323072]),"blue-green":rn("Blue-Green","sequential","BuGn, sequential color scheme from ColorBrewer 2.0",[16252157,15070713,13429990,10082505,6734500,4304502,2329413,27948,17435]),"purple-blue-green":rn("Purple-Blue-Green","sequential","PuBuGn, sequential color scheme from ColorBrewer 2.0",[16775163,15524592,13685222,10927579,6793679,3576e3,164234,93273,83510]),"green-blue":rn("Green-Blue","sequential","GnBu, sequential color scheme from ColorBrewer 2.0",[16252144,14742491,13429701,11066805,8113348,5157843,2854078,551084,540801]),"purple-blue":rn("Purple-Blue","sequential","PuBu, sequential color scheme from ColorBrewer 2.0",[16775163,15525874,13685222,10927579,7645647,3576e3,356528,285325,145496]),"blue-purple":rn("Blue-Purple","sequential","BuPu, sequential color scheme from ColorBrewer 2.0",[16252157,14740724,12571622,10403034,9213638,9202609,8929693,8458108,5046347]),"red-purple":rn("Red-Purple","sequential","RdPu, sequential color scheme from ColorBrewer 2.0",[16775155,16638173,16565696,16424885,16214177,14496919,11403646,7995767,4784234]),"purple-red":rn("Purple-Red","sequential","PuRd, sequential color scheme from ColorBrewer 2.0",[16250105,15196655,13941210,13210823,14640560,15149450,13505110,9961539,6750239]),"yellow-orange-red":rn("Yellow-Orange-Red","sequential","YlOrRd, sequential color scheme from ColorBrewer 2.0",[16777164,16772512,16701814,16691788,16616764,16535082,14883356,12386342,8388646]),"yellow-orange-brown":rn("Yellow-Orange-Brown","sequential","YlOrBr, sequential color scheme from ColorBrewer 2.0",[16777189,16775100,16704401,16696399,16685353,15495188,13388802,10040324,6694150]),"yellow-green":rn("Yellow-Green","sequential","YlGn, sequential color scheme from ColorBrewer 2.0",[16777189,16252089,14282915,11394446,7915129,4303709,2327619,26679,17705]),"yellow-green-blue":rn("Yellow-Green-Blue","sequential","YlGnBu, sequential color scheme from ColorBrewer 2.0",[16777177,15595697,13101492,8375739,4306628,1937856,2252456,2438292,531800]),"red-blue":rn("Red-Blue","diverging","RdBu, diverging color scheme from ColorBrewer 2.0",[6750239,11671595,14049357,16033154,16636871,16250871,13755888,9618910,4428739,2188972,340065]),"red-grey":rn("Red-Grey","diverging","RdGy, diverging color scheme from ColorBrewer 2.0",[6750239,11671595,14049357,16033154,16636871,16777215,14737632,12237498,8882055,5066061,1710618]),"pink-yellow-green":rn("Pink-Yellow-Green","diverging","PiYG, diverging color scheme from ColorBrewer 2.0",[9306450,12917629,14579630,15840986,16638191,16250871,15136208,12116358,8371265,5083681,2581529]),"brown-white-green":rn("Brown-White-Green","diverging","BrBG, diverging color scheme from ColorBrewer 2.0",[5517317,9195786,12550445,14664317,16181443,16119285,13101797,8441281,3512207,91742,15408]),"purple-green":rn("Purple-Green","diverging","PRGn, diverging color scheme from ColorBrewer 2.0",[4194379,7744131,10055851,12756431,15193320,16250871,14282963,10935200,5942881,1800247,17435]),"purple-orange":rn("Purple-Orange","diverging","PuOr, diverging color scheme from ColorBrewer 2.0",[2949195,5515144,8418220,11709394,14211819,16250871,16703670,16627811,14713364,11753478,8338184]),"orange-purple":rn("Orange-Purple","diverging","Reversed PuOr, diverging color scheme from ColorBrewer 2.0",[8338184,11753478,14713364,16627811,16703670,16250871,14211819,11709394,8418220,5515144,2949195]),"red-yellow-green":rn("Red-Yellow-Green","diverging","RdYlGn, diverging color scheme from ColorBrewer 2.0",[10813478,14102567,16018755,16625249,16703627,16777151,14282635,10934634,6733155,1742928,26679]),"red-yellow-blue":rn("Red-Yellow-Blue","diverging","RdYlBu, diverging color scheme from ColorBrewer 2.0",[10813478,14102567,16018755,16625249,16703632,16777151,14742520,11262441,7646673,4552116,3225237]),spectral:rn("Spectral","diverging","Spectral, diverging color scheme from ColorBrewer 2.0",[10355010,13975119,16018755,16625249,16703627,16777151,15136152,11263396,6734501,3311805,6180770]),magma:rn("Magma","sequential","Magma, sequential color scheme from Matplotlib, perceptually uniform shades of black-red-white",[4,131595,328726,591648,920363,1314358,1708098,2167117,2691418,3346535,3870576,4460406,4985210,5510013,5969279,6560384,7019905,7676289,8135554,8660609,9185665,9710720,10235519,10826110,11351164,12007289,12532343,13057395,13516656,14042475,14567784,14962532,15357537,15687006,16017244,16216156,16349533,16483167,16551011,16619112,16686957,16689523,16692347,16694658,16696970,16699282,16701594,16638627,16640940,16577718,16580031]),"magma-no-black":rn("Magma (no black)","sequential","Magma, sequential color scheme from Matplotlib, perceptually uniform shades of black-red-white (with the black region removed)",[4329332,4853881,5378684,5903742,6363263,6888576,7413633,7938689,8463745,8988801,9513600,10038655,10563454,11088508,11613562,12138360,12728949,13254258,13714030,14239338,14699366,15094114,15489119,15753309,16017499,16216411,16350045,16483424,16551523,16619368,16621934,16689780,16692091,16694402,16696969,16633746,16636058,16638371,16575148,16577461,16514239]),inferno:rn("Inferno","sequential","Inferno, sequential color scheme from Matplotlib, perceptually uniform shades of black-red-yellow",[4,131596,328727,657186,1050925,1444665,1969221,2427985,3082843,3737955,4328040,4852843,5377645,5902702,6427502,6952814,7477870,8133997,8659051,9184105,9643623,10168676,10693729,11218782,11743834,12334932,12794703,13254730,13583429,14109502,14504250,14833460,15162926,15427112,15757088,15955993,16154643,16288012,16421383,16489222,16557322,16559634,16497183,16434218,16305463,16176966,16048470,15919721,15921789,16120210,16580516]),"inferno-no-black":rn("Inferno (no black)","sequential","Inferno, sequential color scheme from Matplotlib, perceptually uniform shades of black-red-yellow (with the black region removed)",[4721514,5246316,5771373,6296430,6821486,7346542,7871597,8396651,8921450,9446504,9971557,10496610,10956127,11481435,12006486,12466258,12926285,13386056,13780802,14241085,14570295,14965297,15229227,15558693,15757342,15956248,16154897,16288267,16421638,16489734,16492043,16494612,16496926,16368426,16305463,16111429,15982678,15853928,15856253,16119953,16580260]),plasma:rn("Plasma","sequential","Plasma, sequential color scheme from Matplotlib, perceptually uniform shades of blue-red-yellow",[1771148,2426257,3081365,3671193,4195228,4784799,5308834,5833124,6357158,6815911,7340200,7864744,8324007,8783782,9309348,9769377,10164126,10624154,11018902,11413393,11808141,12137352,12466307,12795519,13124730,13453685,13717361,14046573,14309992,14573668,14837344,15035483,15299159,15497299,15695438,15893834,16091974,16224833,16357693,16425017,16557877,16625457,16627245,16629289,16631334,16567845,16438820,16310052,16115494,15921190,15726625]),viridis:rn("Viridis","sequential","Viridis, sequential color scheme from Matplotlib, perceptually uniform shades of blue-green-yellow",[4524123,4656994,4658793,4726127,4727668,4663929,4599933,4535937,4406404,4276870,4081800,3952010,3822475,3627148,3497356,3302029,3172237,3042446,2912654,2782862,2652814,2523022,2393229,2328973,2198924,2069132,2004874,2005897,2007175,2139525,2337154,2666111,3060348,3520376,4045684,4570991,5227369,5883748,6605661,7392854,8180303,8967495,9819967,10672695,11525166,12443174,13295646,14148121,15000344,15852828,16639780]),cividis:rn("Cividis","sequential","Cividis, sequential color scheme from Matplotlib, perceptually uniform shades of blue-grey-yellow, should look effectively identical to colorblind and non-colorblind users",[8273,9305,10079,76644,339560,668266,1062508,1390957,1916270,2375790,2835566,3295342,3754862,4214638,4543085,5068397,5462638,5856878,6185326,6579567,6908272,7236721,7499890,7828595,8091764,8354933,8617846,8946551,9209463,9472888,9736056,10064760,10327928,10656632,10985591,11379830,11708532,12102770,12497264,12891501,13285994,13745766,14140259,14600287,14994522,15389014,15717970,16046926,16310347,16508232,16640581]),twilight:rn("Twilight","cyclical","Twilight, cyclical color scheme from Matplotlib, perceptually uniform shades of white-blue-black-red-white",[14670305,14211037,13554648,12766675,11847630,10993866,10139847,9351365,8628419,8036290,7509952,7048895,6718653,6519739,6386105,6252470,6184114,6181293,6112935,6044831,5976470,5777291,5447293,5052270,4592479,4067665,3674181,3281211,3150646,3543352,4067644,4657728,5379141,6166345,6953549,7741007,8463184,9120336,9777743,10304079,10830671,11291984,11687762,12083541,12348505,12613471,12878439,13077872,13211771,13411209,13545111,13809830,14074293,14338756,14537169,14735067,14801121]),"set-2":rn("Set-2","qualitative","Set2, categorical color scheme from ColorBrewer 2.0",[6734501,16551266,9281739,15174339,10934356,16767279,15058068,11776947]),accent:rn("Accent","qualitative","Accent, categorical color scheme from ColorBrewer 2.0",[8374655,12496596,16629894,16777113,3697840,15729279,12540695,6710886]),"set-1":rn("Set-1","qualitative","Set1, categorical color scheme from ColorBrewer 2.0",[14948892,3636920,5091146,9981603,16744192,16777011,10901032,16220607,10066329]),"set-3":rn("Set-3","qualitative","Set3, categorical color scheme from ColorBrewer 2.0",[9294791,16777139,12499674,16482418,8434131,16626786,11787881,16567781,14277081,12353725,13429701,16772463]),"dark-2":rn("Dark-2","qualitative","Dark2, categorical color scheme from ColorBrewer 2.0",[1810039,14245634,7696563,15149450,6727198,15117058,10909213,6710886]),paired:rn("Paired","qualitative","Paired, categorical color scheme from ColorBrewer 2.0",[10931939,2062516,11722634,3383340,16489113,14883356,16629615,16744192,13284054,6962586,16777113,11622696]),"pastel-2":rn("Pastel-2","qualitative","Pastel2, categorical color scheme from ColorBrewer 2.0",[11789005,16633260,13358568,16042724,15136201,16773806,15852236,13421772]),"pastel-1":rn("Pastel-1","qualitative","Pastel1, categorical color scheme from ColorBrewer 2.0",[16495790,11783651,13429701,14601188,16701862,16777164,15063229,16636652,15921906]),turbo:rn("Turbo","sequential","Turbo color scheme from D3.js, improved (smooth) rainbow colormap for visualization",[2299675,3547990,4337541,4799658,4934343,4872413,4613867,4289780,3900152,3510520,3120629,2796271,2602726,2474716,2477264,2611140,2875575,3270826,3731101,4387984,5109892,5897080,6815085,7798371,8781145,9829201,10811209,11858498,12774460,13755446,14605618,15389486,16042283,16563496,16757029,16753699,16750369,16746782,16743196,16608538,16146200,15487253,14763026,13973263,13052940,12198408,11344133,10621442,9965056,9571328,9440256]),"turbo-no-black":rn("Turbo (no black)","sequential","Turbo color scheme from D3.js, improved (smooth) rainbow colormap for visualization, with black region removed",[4866485,4872413,4354034,3770361,3120629,2667241,2475736,2611140,3073454,3928216,5109892,6487408,8126047,9829201,11531332,13167162,14605618,15780908,16693543,16753699,16748063,16741916,16146200,15026195,13644558,12198408,10818563,9833728]),warm:rn("Warm","sequential","Warm, sequential color scheme from D3.js",[7225514,7684013,8208303,8797873,9322162,9846195,10370483,10960051,11484338,12008625,12532911,13057452,13581737,14040742,14434210,14959005,15352473,15746196,16074382,16402824,16665475,16731772,16732790,16733808,16734826,16735843,16737117,16738135,16739409,16740939,16742471,16743746,16745277,16747065,16748598,16487987,16162097,15901743,15575598,15184174,14858031,14466608,14140466,13748788,13422648,13030972,12704833,12378438,12052044,11791187,11530331]),cool:rn("Cool","sequential","Cool, sequential color scheme from D3.js",[7225514,7095217,6899639,6769597,6574275,6313160,6117837,5856977,5596117,5335513,5009115,4748510,4422368,4161761,3835361,3575009,3314401,3053791,2793438,2598363,2337752,2208213,2013137,1883340,1819335,1755074,1691068,1692086,1758640,1825706,1957795,2155164,2352790,2615695,2878601,3207042,3600764,3994230,4453489,4912492,5437031,5961315,6551391,7140956,7730778,8386136,8975703,9630807,10285911,10940761,11530331]),"cubehelix-default":rn("CubehelixDefault","sequential","CubehelixDefault, sequential color scheme from D3.js",[0,525064,984594,1313308,1576742,1709360,1776697,1712705,1649479,1520715,1457486,1394254,1396557,1529674,1662534,2057794,2518076,3109175,3765555,4618288,5536047,6519343,7568178,8550967,9599551,10516809,11368789,12155235,12745329,13270146,13663891,13861539,13928371,13929921,13800654,13606106,13411811,13217514,12957935,12829170,12700403,12768243,12835826,13099761,13428976,13823727,14349039,14939888,15530483,16186616,16777215]),rainbow:rn("Rainbow","cyclical","Rainbow, cyclical color scheme from D3.js",[7225514,8208303,9322162,10370483,11484338,12532911,13581737,14434210,15352473,16074382,16665475,16732790,16734826,16737117,16739409,16742471,16745277,16748598,16162097,15575598,14858031,14140466,13422648,12704833,12052044,11530331,10285911,8975703,7730777,6485855,5437031,4453489,3600764,2878601,2352790,1957795,1758896,1691068,1819335,2013137,2337752,2793438,3314401,3835617,4422368,5009115,5596117,6117837,6574275,6899639,7225514]),sinebow:rn("Sinebow","cyclical","Sinebow, cyclical color scheme from D3.js",[16728128,16666162,16473382,16149788,15695122,15174923,14458117,13740802,12892928,11978752,10999043,9953287,8972813,7860757,6879262,5831722,4849463,3931972,3079507,2357858,1635442,1109378,648082,317858,118193,49087,111053,303833,561890,1081837,1602292,2319098,3036157,3884287,4798463,5778172,6823928,7804402,8916458,9897952,10945493,11927752,12845243,13697708,14419357,15141773,15667837,16129133,16459357,16659022,16728128]),"category-10":rn("Category10","qualitative","Category10, categorical color scheme from D3.js / tab10 from Matplotlib (default in Matplotlib)",[2062260,16744206,2924588,14034728,9725885,9197131,14907330,8355711,12369186,1556175]),"observable-10":rn("Observable10","qualitative","Observable10, categorical color scheme from D3.js",[4352464,15708440,16740956,7128496,3975505,16747191,10773490,9944053,10251086,9738400]),"tableau-10":rn("Tableau10","qualitative","Tableau10, categorical color scheme from D3.js",[5142951,15896108,14767961,7780274,5873999,15583561,11500193,16752039,10253663,12234923]),"simple-rainbow":rn("Simple rainbow","sequential","Simple 5-color rainbow (blue-green-yellow-orange-red)",[3367393,3516485,16383744,15501073,12526114]),"red-white-blue":rn("Red-White-Blue","diverging","Diverging color scheme with red-white-blue",[12526114,16777215,3367393]),"many-distinct":rn("Many-Distinct","qualitative","Customized color scheme combining colors from multiple standard schemes (Dark2, Set1, Set2)",[1810039,14245634,7696563,15149450,6727198,15117058,10909213,6710886,14948892,3636920,5091146,9981603,16744192,16777011,10901032,16220607,10066329,6734501,16551266,9281739,15174339,10934356,16767279,15058068,11776947])},qFe=Object.keys(Sr),cM=qFe.map(e=>[e,Sr[e].label,Sm(Sr[e].type),Sr[e].description]),Fre=cM.filter(e=>Sr[e[0]].type==="sequential"||Sr[e[0]].type==="diverging"||Sr[e[0]].type==="cyclical"),Lre=cM.filter(e=>Sr[e[0]].type==="qualitative");function Ka(e){return e in Sr?Sr[e]:(console.warn(`unknown color list named '${e}'`),Sr["red-yellow-blue"])}var Ia;(n=>{function e(o){return o}n.create=e;function t(o,i){return(o&i)!==0}n.has=t;function r(o,i){return!!i&&(o&i)===i}n.hasAll=r})(Ia||={});var Yn;(I=>{function e(v=512){return{current:[],offset:0,capacity:v,chunks:[]}}I.create=e;function t(v){return v.chunks.length?(v.offset>0&&(v.chunks[v.chunks.length]=v.current.length===v.offset?v.current.join(""):v.current.slice(0,v.offset).join("")),v.chunks.join("")):v.current.length===v.offset?v.current.join(""):v.current.splice(0,v.offset).join("")}I.getString=t;function r(v){let A=0;for(let P of v.chunks)A+=P.length;for(let P=0;P<v.offset;P++)A+=v.current[P].length;return A}I.getSize=r;function n(v){return v.offset>0&&(v.current.length===v.offset?v.chunks[v.chunks.length]=v.current.join(""):v.chunks[v.chunks.length]=v.current.slice(0,v.offset).join(""),v.offset=0),v.chunks}I.getChunks=n;let o;(A=>A[A.Count=512]="Count")(o||={});let i=[];(function(){let v="";for(let A=0;A<512;A++)i[A]=v,v=v+" "})();function a(v){c(v,`
`)}I.newline=a;function s(v,A){A>0&&c(v,i[A])}I.whitespace=s;function l(v){c(v," ")}I.whitespace1=l;function u(v,A){A&&(v.offset===v.capacity&&(v.chunks[v.chunks.length]=v.current.join(""),v.offset=0),v.current[v.offset++]=A)}I.write=u;function c(v,A){v.offset===v.capacity&&(v.chunks[v.chunks.length]=v.current.join(""),v.offset=0),v.current[v.offset++]=A}I.writeSafe=c;function m(v,A,P){if(!A){s(v,P);return}let T=P-A.length;s(v,T),c(v,A)}I.writePadLeft=m;function d(v,A,P){if(!A){s(v,P);return}let T=P-A.length;c(v,A),s(v,T)}I.writePadRight=d;function p(v,A){c(v,""+A)}I.writeInteger=p;function h(v,A){c(v,""+A+" ")}I.writeIntegerAndSpace=h;function f(v,A,P){let T=""+A,R=P-T.length;s(v,R),c(v,T)}I.writeIntegerPadLeft=f;function g(v,A,P){let T=""+A,R=P-T.length;c(v,T),s(v,R)}I.writeIntegerPadRight=g;function y(v,A,P){c(v,""+Math.round(P*A)/P)}I.writeFloat=y;function x(v,A,P,T){let R=""+Math.round(P*A)/P,w=T-R.length;s(v,w),c(v,R)}I.writeFloatPadLeft=x;function S(v,A,P,T){let R=""+Math.round(P*A)/P,w=T-R.length;c(v,R),s(v,w)}I.writeFloatPadRight=S})(Yn||={});var En=(function(){if(typeof window<"u"&&window.performance){let e=window.performance;return()=>e.now()}else return typeof process<"u"&&process.hrtime!=="undefined"&&typeof process.hrtime=="function"?()=>{let e=process.hrtime();return e[0]*1e3+e[1]/1e6}:Date.now?()=>Date.now():()=>+new Date})();function Fv(e,t=!0){if(isNaN(e))return"n/a";let r=Math.floor(e/(3600*1e3)),n=Math.floor(e/(60*1e3)%60),o=Math.floor(e/1e3%60),i=Math.floor(e%1e3).toString();for(;i.length<3;)i="0"+i;for(;!t&&i.length>1&&i[i.length-1]==="0";)i=i.substr(0,i.length-1);return r>0?`${r}h${n}m${o}.${i}s`:n>0?`${n}m${o}.${i}s`:o>0?`${o}.${i}s`:`${e.toFixed(0)}ms`}var fn;(i=>{let e=typeof btoa<"u"?btoa:a=>Buffer.from(a).toString("base64"),t=[];function r(){let a=+new Date+En();for(let s=0;s<16;s++)t[s]=String.fromCharCode((a+Math.random()*255)%255|0),a=Math.floor(a/255);return e(t.join("")).replace(/\+/g,"-").replace(/\//g,"_").substr(0,22)}i.create22=r;function n(){let a=+new Date+En();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(l){let u=(a+Math.random()*16)%16|0;return a=Math.floor(a/16),(l==="x"?u:u&3|8).toString(16)})}i.createv4=n;function o(a){return typeof a=="string"}i.is=o})(fn||={});function YFe(e,t){return e-t}function KFe(e){return Array.prototype.sort.call(e,YFe),e}var Vre;(p=>{class e{constructor(){this.size=0}has(f){return!1}forEach(f,g){return g}}class t{constructor(f){this.idx=f;this.size=1}has(f){return f===this.idx}forEach(f,g){return f(this.idx,g),g}}class r{constructor(f,g){this.mask=f;this.size=g;this.length=f.length}has(f){return f<this.length&&!!this.mask[f]}_forEach(f,g){for(let y=0;y<this.length;y++)this.mask[y]&&f(y,g)}forEach(f,g){return this._forEach(f,g),g}}class n{constructor(f){this.size=f}has(f){return!0}_forEach(f,g){for(let y=0;y<this.size;y++)f(y,g)}forEach(f,g){return this._forEach(f,g),g}}class o{constructor(f){this.set=f;this._flat=void 0;this.size=f.size}has(f){return this.set.has(f)}_forEach(f,g){for(let y of this.flatten())f(y,g)}flatten(){if(this._flat)return this._flat;let f=new Int32Array(this.size),g=0;return this.set.forEach(y=>f[g++]=y),KFe(f),this._flat=f,this._flat}forEach(f,g){return this._forEach(f,g),g}}function i(h){return new n(h)}p.always=i,p.never=new e;function s(h){return new o(h)}p.ofSet=s;function l(h){return new t(h)}p.singleton=l;function u(h){let f=h.length;if(f===0)return new e;if(f===1)return new t(h[0]);let g=0;for(let S of h)S>g&&(g=S);if(f===g)return new n(f);if(f/g<1/12){let S=new Set;for(let I of h)S.add(I);return new o(S)}let x=new Int8Array(g+1);for(let S of h)x[S]=1;return new r(x,h.length)}p.ofUniqueIndices=u;function c(h,f){return new r(h,f)}p.ofMask=c;function m(h,f){for(let g of f)if(h.has(g))return!0;return!1}p.hasAny=m;function d(h,f){let g=0,y=0;if(f.forEach(x=>{h.has(x)||(g++,x>y&&(y=x))}),g/y<1/12){let x=new Set;return f.forEach(S=>{h.has(S)||x.add(S)}),s(x)}else{let x=new Uint8Array(y+1);return f.forEach(S=>{h.has(S)||(x[S]=1)}),c(x,g)}}p.complement=d})(Vre||={});function gi(e=0,t=Number.MAX_SAFE_INTEGER){let r=e;return()=>{let n=r;return r=(r+1)%t,n}}var mM;(r=>{function e(n){return{ref:n}}r.create=e;function t(n,o){return n.ref=o,n}r.set=t})(mM||={});var JFe=gi(0,2147483647),My;(r=>{function e(n,o){return{id:JFe(),version:0,value:n,metadata:o}}r.create=e;function t(n,o){return{id:n.id,version:n.version+1,value:o,metadata:n.metadata}}r.withValue=t})(My||={});var _;(o=>{function e(i,a){return mM.create(My.create(i,a))}o.create=e;function t(i,a){return mM.set(i,My.withValue(i.ref,a))}o.update=t;function r(i,a){return mM.set(i,a)}o.set=r;function n(i,a){return i.ref.value!==a?t(i,a):i}o.updateIfChanged=n})(_||={});var vl=function(){};function Oh(e,t){let r=Math.pow(10,t);return Math.round(r*e)/r}function Yi(e,t){let r=e.length;if(r!==t.length)return!1;for(let n=0;n<r;n++)if(e[n]!==t[n])return!1;return!0}var Gre=Object.prototype.hasOwnProperty;function qi(e,t){if(e===t)return!0;let r=Array.isArray(e),n=Array.isArray(t);if(r&&n){if(e.length!==t.length)return!1;for(let o=0;o<e.length;o++)if(!qi(e[o],t[o]))return!1;return!0}if(r!==n)return!1;if(e&&t&&typeof e=="object"&&typeof t=="object"){let o=Object.keys(e);if(o.length!==Object.keys(t).length)return!1;let i=e instanceof Date,a=t instanceof Date;if(i&&a)return e.getTime()===t.getTime();if(i!==a)return!1;let s=e instanceof RegExp,l=t instanceof RegExp;if(s&&l)return e.toString()===t.toString();if(s!==l)return!1;for(let u=0;u<o.length;u++)if(!Gre.call(t,o[u]))return!1;for(let u=0;u<o.length;u++)if(!qi(e[o[u]],t[o[u]]))return!1;return!0}return!1}function Z0(e,t){if(e===t)return!0;let r=Array.isArray(e),n=Array.isArray(t);return r&&n?$Fe(e,t):r!==n?!1:e&&t&&typeof e=="object"&&typeof t=="object"?Gh(e,t):!1}function Gh(e,t){if(e===t)return!0;if(!e||!t)return!1;let r=Object.keys(e);if(Object.keys(t).length!==r.length)return!1;for(let n of r)if(!Gre.call(e,n)||e[n]!==t[n])return!1;return!0}function $Fe(e,t){if(e===t)return!0;if(!e||!t||e.length!==t.length)return!1;for(let r=0,n=e.length;r<n;++r)if(e[r]!==t[r])return!1;return!0}function ua(e,t){return e!==void 0?e:t}function Ore(e){return(e<10?"0":"")+e}function Ure(e){let t=e.getHours(),r=e.getMinutes(),n=e.getSeconds();return`${t}:${Ore(r)}:${Ore(n)}`}function Nl(e){return{kind:"table-legend",table:e}}function Nre(e,t,r){return{kind:"scale-legend",minLabel:e,maxLabel:t,colors:r}}function Lv(e,t){for(let r=0,n=e.length;r<n;r++)if(t(e[r]))return e[r]}function Vv(e){if(Array.from)return Array.from(e);let t=[];for(;;){let{done:r,value:n}=e.next();if(r)break;t[t.length]=n}return t}function B2(e,t,r){let n=t-e+1,o=r?new r(n):new Int32Array(n);for(let i=0;i<n;i++)o[i]=i+e;return o}function zre(e,t){let r=new(eLe(e))(t.length);for(let n=0,o=t.length;n<o;n++)r[n]=e[t[n]];return r}function eLe(e){let t=e.constructor;if(!t)throw new Error("data does not define a constructor and it should");return t}function dM(e){let t=e^e>>4;return t=(t^3735928559)+(t<<5),t=t^t>>11,t}function $u(e,t){let r=23;return r=31*r+e|0,r=31*r+t|0,r=r^r>>4,r=(r^3735928559)+(r<<5),r=r^r>>11,r}function Hre(e,t,r){let n=23;return n=31*n+e|0,n=31*n+t|0,n=31*n+r|0,n=n^n>>4,n=(n^3735928559)+(n<<5),n=n^n>>11,n}function jre(e,t,r,n){let o=23;return o=31*o+e|0,o=31*o+t|0,o=31*o+r|0,o=31*o+n|0,o=o^o>>4,o=(o^3735928559)+(o<<5),o=o^o>>11,o}function q0(e){let t=0;for(let r=0,n=e.length;r<n;r++)t=(t<<5)-t+e.charCodeAt(r)|0;return t}function ca(e,t){return(e+t)*(e+t+1)/2+t}function Mc(e,t){return e<t?ca(e,t):ca(t,e)}function Ov(e,t){let r=Math.floor((Math.sqrt(8*t+1)-1)/2),n=(r*r+r)/2,o=t-n;return e[0]=r-o,e[1]=o,e}function ui(e){let t=2166136261;for(let r=0,n=e.length;r<n;++r)t^=e[r],t+=(t<<1)+(t<<4)+(t<<7)+(t<<8)+(t<<24);return t>>>0}var P5=class{constructor(){this.hashTarget=new Uint32Array(8);this.numberBytes=new Uint8Array(8);this.numberView=new DataView(this.numberBytes.buffer)}hash(t){return this.hashTarget.set(tLe),this.hashValue(t,0),iLe(this.hashTarget)}hashValue(t,r){if(r>50)return;let n=typeof t;switch(this.addByte(n.charCodeAt(0)),n){case"string":this.addString(t);break;case"number":this.addNumber(t);break;case"boolean":this.addByte(t?1:0);break;case"object":t===null?this.addByte(0):Array.isArray(t)?this.addArray(t,r):this.addObject(t,r);break;case"undefined":this.addByte(255);break}}addByte(t){this.hashTarget[0]^=t&255,rLe(this.hashTarget)}addString(t){for(let r=0;r<t.length;r++){let n=t.charCodeAt(r);n<128?this.addByte(n):n<2048?(this.addByte(192|n>>6),this.addByte(128|n&63)):(this.addByte(224|n>>12),this.addByte(128|n>>6&63),this.addByte(128|n&63))}}addNumber(t){if(Number.isNaN(t))this.addByte(127),this.addByte(192),this.addByte(0),this.addByte(0),this.addByte(0),this.addByte(0),this.addByte(0),this.addByte(0);else if(!Number.isFinite(t))t>0?(this.addByte(127),this.addByte(128),this.addByte(0),this.addByte(0)):(this.addByte(255),this.addByte(128),this.addByte(0),this.addByte(0)),this.addByte(0),this.addByte(0),this.addByte(0),this.addByte(0);else{this.numberView.setFloat64(0,t,!1);for(let r=0;r<8;r++)this.addByte(this.numberBytes[r])}}addArray(t,r){this.addNumber(t.length);for(let n=0;n<t.length;n++)this.addNumber(n),this.hashValue(t[n],r+1)}addObject(t,r){let n=Object.keys(t).sort();this.addNumber(n.length);for(let o of n)this.addString(o),this.hashValue(t[o],r+1)}},XTt=new P5,tLe=new Uint32Array([1818371886,129696066,1656234357,1653982605,383153456,3715178979,3004645376,256]),By=new Uint32Array(8),Ey=new Uint32Array(8);function rLe(e){By[0]=0,By[1]=0,By[2]=e[0]<<24,By[3]=e[0]>>>8|e[1]<<24,By[4]=e[1]>>>8|e[2]<<24,By[5]=e[2]>>>8|e[3]<<24,By[6]=e[3]>>>8|e[4]<<24,By[7]=e[4]>>>8|e[5]<<24,Ey[0]=e[0]<<8,Ey[1]=e[0]>>>24|e[1]<<8,Ey[2]=e[1]>>>24|e[2]<<8,Ey[3]=e[2]>>>24|e[3]<<8,Ey[4]=e[3]>>>24|e[4]<<8,Ey[5]=e[4]>>>24|e[5]<<8,Ey[6]=e[5]>>>24|e[6]<<8,Ey[7]=e[6]>>>24|e[7]<<8;let t=0;for(let r=0;r<8;r++){let n=e[r]*59+t;e[r]=n>>>0,t=Math.floor(n/4294967296)}t=0;for(let r=0;r<8;r++){let n=e[r]+By[r]+Ey[r]+t;e[r]=n>>>0,t=n>=4294967296?1:0}}var nLe=["00000000","0000000","000000","00000","0000","000","00","0"];function oLe(e){let t=e.toString(16);return t.length>=8?t:nLe[t.length]+t}function iLe(e){let t="";for(let r=7;r>=0;r--)t+=oLe(e[r]);return t}function _5(e,t=42){let r=JSON.stringify(e);return Xre(r,t)}function Wre(e,t){let r={length:e.length,charCodeAt(n){return e[n]}};return Xre(r,t)}function Xre(e,t){let r=t>>>0,n=t>>>0,o=t>>>0,i=t>>>0,a=e.length%16,s=e.length-a;for(let d=0;d<s;d+=16){let p=e.charCodeAt(d)&255|(e.charCodeAt(d+1)&255)<<8|(e.charCodeAt(d+2)&255)<<16|(e.charCodeAt(d+3)&255)<<24,h=e.charCodeAt(d+4)&255|(e.charCodeAt(d+5)&255)<<8|(e.charCodeAt(d+6)&255)<<16|(e.charCodeAt(d+7)&255)<<24,f=e.charCodeAt(d+8)&255|(e.charCodeAt(d+9)&255)<<8|(e.charCodeAt(d+10)&255)<<16|(e.charCodeAt(d+11)&255)<<24,g=e.charCodeAt(d+12)&255|(e.charCodeAt(d+13)&255)<<8|(e.charCodeAt(d+14)&255)<<16|(e.charCodeAt(d+15)&255)<<24;p=Math.imul(p,597399067),p=p<<15|p>>>17,p=Math.imul(p,2869860233),r^=p,r=r<<19|r>>>13,r+=n,r=Math.imul(r,5)+1444728091,h=Math.imul(h,2869860233),h=h<<16|h>>>16,h=Math.imul(h,951274213),n^=h,n=n<<17|n>>>15,n+=o,n=Math.imul(n,5)+197830471,f=Math.imul(f,951274213),f=f<<17|f>>>15,f=Math.imul(f,2716044179),o^=f,o=o<<15|o>>>17,o+=i,o=Math.imul(o,5)+2530024501,g=Math.imul(g,2716044179),g=g<<13|g>>>19,g=Math.imul(g,597399067),i^=g,i=i<<13|i>>>19,i+=r,i=Math.imul(i,5)+850148119}let l=0,u=0,c=0,m=0;switch(a){case 15:m^=e.charCodeAt(s+14)<<16;case 14:m^=e.charCodeAt(s+13)<<8;case 13:m^=e.charCodeAt(s+12),m=Math.imul(m,2716044179),m=m<<13|m>>>19,m=Math.imul(m,597399067),i^=m;case 12:c^=e.charCodeAt(s+11)<<24;case 11:c^=e.charCodeAt(s+10)<<16;case 10:c^=e.charCodeAt(s+9)<<8;case 9:c^=e.charCodeAt(s+8),c=Math.imul(c,951274213),c=c<<17|c>>>15,c=Math.imul(c,2716044179),o^=c;case 8:u^=e.charCodeAt(s+7)<<24;case 7:u^=e.charCodeAt(s+6)<<16;case 6:u^=e.charCodeAt(s+5)<<8;case 5:u^=e.charCodeAt(s+4),u=Math.imul(u,2869860233),u=u<<16|u>>>16,u=Math.imul(u,951274213),n^=u;case 4:l^=e.charCodeAt(s+3)<<24;case 3:l^=e.charCodeAt(s+2)<<16;case 2:l^=e.charCodeAt(s+1)<<8;case 1:l^=e.charCodeAt(s),l=Math.imul(l,597399067),l=l<<15|l>>>17,l=Math.imul(l,2869860233),r^=l}return r^=e.length,n^=e.length,o^=e.length,i^=e.length,r+=n,r+=o,r+=i,n+=r,o+=r,i+=r,r^=r>>>16,r=Math.imul(r,2246822507),r^=r>>>13,r=Math.imul(r,3266489909),r^=r>>>16,n^=n>>>16,n=Math.imul(n,2246822507),n^=n>>>13,n=Math.imul(n,3266489909),n^=n>>>16,o^=o>>>16,o=Math.imul(o,2246822507),o^=o>>>13,o=Math.imul(o,3266489909),o^=o>>>16,i^=i>>>16,i=Math.imul(i,2246822507),i^=i>>>13,i=Math.imul(i,3266489909),i^=i>>>16,r+=n,r+=o,r+=i,n+=r,o+=r,i+=r,(r>>>0).toString(16).padStart(8,"0")+(n>>>0).toString(16).padStart(8,"0")+(o>>>0).toString(16).padStart(8,"0")+(i>>>0).toString(16).padStart(8,"0")}function pM(e,t,r){return e[t]-e[r]}function ky(e,t,r){let n=e[t];e[t]=e[r],e[r]=n}function Qre(e,t,r,n){let o=r+n>>1;return t(e,r,n)>0?t(e,r,o)>0?t(e,o,n)>0?o:n:r:t(e,n,o)>0?t(e,o,r)>0?o:r:n}function aLe(e,t,r){let{cmp:n,swap:o,data:i,parts:a}=e,s=t+1,l=r;for(o(i,t,Qre(i,n,t,r));n(i,l,t)>0;)--l;for(let u=t+1;u<=l;u++){let c=n(i,u,t);if(c>0){for(o(i,u,l),--l;n(i,l,t)>0;)--l;u--}else c===0&&(o(i,u,s),s++)}for(let u=t;u<s;u++)o(i,u,t+l-u);a[0]=l-s+t+1,a[1]=l}function sLe({data:e,cmp:t,swap:r},n,o){for(let i=n+1;i<=o;i++){let a=i-1;for(;a>=n&&t(e,a,a+1)>0;)r(e,a,a+1),a=a-1}}function fM(e,t,r){let{parts:n}=e;for(;t<r;){if(r-t<16){sLe(e,t,r);return}aLe(e,t,r);let o=n[0],i=n[1];o-t<r-i?(fM(e,t,o-1),t=i+1):(fM(e,i+1,r),r=o-1)}}function lLe(e,t,r,n){let o=r+1,i=n;ky(e,r,Qre(e,pM,r,n));let a=e[r];for(;e[i]>a;)--i;for(let s=r+1;s<=i;s++){let l=e[s];if(l>a){for(ky(e,s,i),--i;e[i]>a;)--i;s--}else l===a&&(ky(e,s,o),++o)}for(let s=r;s<o;s++)ky(e,s,r+i-s);t[0]=i-o+r+1,t[1]=i}function uLe(e,t,r){for(let n=t+1;n<=r;n++){let o=e[n],i=n-1;for(;i>=t&&e[i]>o;)e[i+1]=e[i],i=i-1;e[i+1]=o}}function R5(e,t,r,n){for(;r<n;){if(n-r<16){uLe(e,r,n);return}lLe(e,t,r,n);let o=t[0],i=t[1];o-r<n-i?(R5(e,t,r,o-1),r=i+1):(R5(e,t,i+1,n),n=o-1)}}function Js(e,t=pM){return cLe(e,0,e.length,t)}function cLe(e,t,r,n=pM){return n===pM?R5(e,[0,0],t,r-1):fM({data:e,cmp:n,swap:ky,parts:[0,0]},t,r-1),e}function hM(e,t,r,n,o){return fM({data:e,cmp:n,swap:o,parts:[0,0]},t,r-1),e}var Aa;(f=>{f.Zero=0;let{_int32:t,_float64:r,_int32_1:n,_float64_1:o}=(function(){let g=new ArrayBuffer(8),y=new ArrayBuffer(8);return{_int32:new Int32Array(g),_float64:new Float64Array(g),_int32_1:new Int32Array(y),_float64_1:new Float64Array(y)}})();function i(g){return typeof g=="number"}f.is=i;function a(g,y){return t[0]=g,t[1]=y,r[0]}f.create=a;function s(g){return r[0]=g,t[1]-t[0]}f.diff=s;function l(g){return r[0]=g,t[0]}f.fst=l;function u(g){return r[0]=g,t[1]}f.snd=u;function c(g,y){return r[0]=g,o[0]=y,t[0]===n[0]&&t[1]===n[1]}f.areEqual=c;function m(g,y){r[0]=g,o[0]=y;let x=t[0]-n[0];return x!==0?x:t[1]-n[1]}f.compare=m;function d(g,y,x){r[0]=g[y],o[0]=g[x];let S=t[0]-n[0];return S!==0?S:t[1]-n[1]}f.compareInArray=d;function p(g){return r[0]=g,$u(t[0],t[1])}f.hashCode=p;function h(g){return r[0]=g,`(${t[0]}, ${t[1]})`}f.toString=h})(Aa||={});var D5=Aa.Zero;function w5(e,t){return t<e?Aa.create(e,e):Aa.create(e,t+1)}function yM(e,t){return t<=e?Aa.create(e,e):Aa.create(e,t)}function Zre(e){return e<0?Aa.create(0,0):Aa.create(0,e)}var qre=Aa.is,Mf=Aa.fst,Uh=Aa.snd,E2=Aa.fst;function k2(e){return Aa.snd(e)-1}var Ax=Aa.diff,Yre=Aa.hashCode,Kre=Aa.toString;function Jre(e,t){return Aa.fst(e)<=t&&t<Aa.snd(e)}function $re(e,t){let r=Mf(e);return t>=r&&t<Uh(e)?t-r:-1}function ene(e,t){return Aa.fst(e)+t}var tne=Aa.areEqual;function M5(e,t){let r=Ax(e),n=Ax(t);return r===0&&n===0?!0:r>0&&n>0&&k2(e)>=E2(t)&&E2(e)<=k2(t)}function rne(e,t){return Ax(e)?Ax(t)?Mf(e)<=Mf(t)&&Uh(e)>=Uh(t):!0:Ax(t)===0}function gM(e,t){let r=Mf(e);if(t<=r)return 0;let n=Uh(e);return t>=n?n-r:t-r}function nne(e,t,r){let n=Mf(r),o=Mf(e);if(t<=n+o)return n;let i=Uh(r);return t>=i+o?i:t-o}function B5(e,t,r){return yM(gM(e,t),gM(e,r+1))}function one(e,t){return M5(e,t)?yM(Math.max(Mf(e),Mf(t)),Math.min(Uh(e),Uh(t))):D5}function ine(e,t){return Ax(B5(e,E2(t),k2(t)))}function ane(e,t){return Aa.create(Mf(e)+t,Uh(e)+t)}var ye;(R=>(R.Empty=D5,R.ofSingleton=w=>w5(w,w),R.ofRange=w5,R.ofBounds=yM,R.ofLength=Zre,R.is=qre,R.has=Jre,R.indexOf=$re,R.getAt=ene,R.start=Mf,R.end=Uh,R.min=E2,R.max=k2,R.size=Ax,R.hashCode=Yre,R.toString=Kre,R.areEqual=tne,R.areIntersecting=M5,R.isSubInterval=rne,R.findPredecessorIndex=gM,R.findPredecessorIndexInInterval=nne,R.findRange=B5,R.intersectionSize=ine,R.intersect=one,R.offset=ane))(ye||={});var Gv=[];function sne(e){return[e]}function lne(e){return e}function une(e){return Js(e),e}function E5(e,t){if(t<e)return[];let r=new Int32Array(t-e+1);for(let n=e;n<=t;n++)r[n-e]=n;return r}function cne(e){return e&&(Array.isArray(e)||!!e.buffer)}function k5(e){return e[e.length-1]-e[0]+1===e.length}function bM(e){return e[0]}function xM(e){return e[e.length-1]+1}function mne(e){return e[0]}function dne(e){return e[e.length-1]}function F5(e){return e.length}function pne(e){let t=e.length;return t?t>2?jre(t,e[0],e[t-1],e[t>>1]):Hre(t,e[0],e[t-1]):0}function fne(e){let t=e.length;return t>5?`[${e[0]}, ${e[1]}, ..., ${e[t-1]}], length ${t}`:`[${e.join(", ")}]`}function L5(e,t){let r=e.length;return r===0?-1:e[0]<=t&&t<=e[r-1]?xne(e,t,0,r):-1}function hne(e,t,r){return V5(e,t,ye.start(r),ye.end(r))}function V5(e,t,r,n){return e.length===0||n<=r?-1:e[r]<=t&&t<=e[n-1]?xne(e,t,r,n):-1}function gne(e,t){return L5(e,t)>=0}function O5(e,t){if(e===t)return!0;let r=e.length;if(r!==t.length||e[0]!==t[0]||e[r-1]!==t[r-1])return!1;if(k5(e))return!0;r--;for(let n=1;n<r;n++)if(e[n]!==t[n])return!1;return!0}function Tx(e,t){return Cne(e,t,0,e.length)}function yne(e,t,r){return Cne(e,t,ye.start(r),ye.end(r))}function bne(e,t,r){return ye.ofBounds(Tx(e,t),Tx(e,r+1))}function xne(e,t,r,n){let o=r,i=n-1;for(;o<=i;){if(o+11>i){for(let l=o;l<=i;l++)if(t===e[l])return l;return-1}let a=o+i>>1,s=e[a];if(t<s)i=a-1;else if(t>s)o=a+1;else return a}return-1}function Cne(e,t,r,n){if(r===n||e[r]>=t)return r;if(e[n-1]<t)return n;let o=r,i=n;for(;i-o>4;){let a=o+i>>1;e[a]>=t?i=a:o=a+1}for(let a=o;a<i;a++)if(e[a]>=t)return a;return i}function Sne(e,t){if(e===t)return!0;let{startI:r,startJ:n,endI:o,endJ:i}=Y0(e,t);for(;r<o&&n<i;){let a=e[r],s=t[n];if(a<s)r++;else if(a>s)n++;else return!0}return!1}function vne(e,t){if(e===t)return!0;let r=t.length,{startI:n,startJ:o,endI:i,endJ:a}=Y0(e,t);if(a-o<r||i-n<r)return!1;let s=0;for(;n<i&&o<a;){let l=e[n],u=t[o];l<u?n++:l>u?o++:(n++,o++,s++)}return s===r}function G5(e,t){if(e===t)return e;let r=e.length,n=t.length;if(r===0)return t;if(n===0)return e;if(e[0]>t[0])return G5(t,e);let{startI:o,startJ:i,endI:a,endJ:s}=Y0(e,t),l=U5(e,t,o,i,a,s);if(l===r&&l===n||l===n)return e;if(l===r)return t;let u=new Int32Array(r+n-l),c=0,m=0,d=0;for(c=0;c<o;c++)u[d++]=e[c];for(;m<s&&e[o]>t[m];)u[d++]=t[m++];for(;c<a&&m<s;){let p=e[c],h=t[m];p<h?(u[d++]=p,c++):p>h?(u[d++]=h,m++):(u[d++]=p,c++,m++)}for(;c<a;c++)u[d++]=e[c];for(;m<s;m++)u[d++]=t[m];for(;c<r;c++)u[d++]=e[c];for(;m<n;m++)u[d++]=t[m];return u}function Ine(e,t){if(e===t)return F5(e);let{startI:r,startJ:n,endI:o,endJ:i}=Y0(e,t);return U5(e,t,r,n,o,i)}function U5(e,t,r,n,o,i){let a=r,s=n,l=0;for(;a<o&&s<i;){let u=e[a],c=t[s];u<c?a++:u>c?s++:(a++,s++,l++)}return l}function Ane(e,t){if(e===t)return e;let{startI:r,startJ:n,endI:o,endJ:i}=Y0(e,t),a=U5(e,t,r,n,o,i),s=e.length,l=t.length;if(!a)return Gv;if(a===s&&a===l||a===l)return t;if(a===s)return e;let u=new Int32Array(a),c=0,m=r,d=n;for(;m<o&&d<i;){let p=e[m],h=t[d];p<h?m++:(p>h||(u[c++]=p,m++),d++)}return u}function Tne(e,t){if(e===t)return Gv;let r=e.length,{startI:n,startJ:o,endI:i,endJ:a}=Y0(e,t),s=n,l=o,u=0;for(;s<i&&l<a;){let d=e[s],p=t[l];d<p?s++:d>p?l++:(s++,l++,u++)}if(!u)return e;if(u>=r)return Gv;let c=new Int32Array(r-u),m=0;for(let d=0;d<n;d++)c[m++]=e[d];for(s=n,l=o;s<i&&l<a;){let d=e[s],p=t[l];d<p?(c[m++]=d,s++):(d>p||s++,l++)}for(;s<r;s++)c[m++]=e[s];return c}function Pne(e){if(e.length<2)return e;let t=1;for(let o=0,i=e.length-1;o<i;o++)e[o]!==e[o+1]&&t++;if(t===e.length)return e;let r=new Int32Array(t),n=0;for(let o=0,i=e.length-1;o<i;o++)e[o]!==e[o+1]&&(r[n++]=e[o]);return r[n]=e[e.length-1],r}function _ne(e,t){if(O5(e,t))return B2(0,e.length-1);let{startI:r,startJ:n,endI:o,endJ:i}=Y0(e,t),a=r,s=n,l=0;for(;a<o&&s<i;){let d=e[a],p=t[s];d<p?a++:d>p?s++:(a++,s++,l++)}let u=e.length;if(!l)return Gv;if(l===u)return B2(0,e.length-1);let c=new Int32Array(l),m=0;for(a=r,s=n;a<o&&s<i;){let d=e[a],p=t[s];d<p?a++:(d>p||(c[m++]=a,a++),s++)}return c}var Fy={startI:0,startJ:0,endI:0,endJ:0};function Y0(e,t){let r=e.length,n=t.length,o=r/n;return r>=128||n>=128||o<=.34||o>=2.99?(Fy.startI=Tx(e,bM(t)),Fy.startJ=Tx(t,bM(e)),Fy.endI=Tx(e,xM(t)),Fy.endJ=Tx(t,xM(e))):(Fy.startI=0,Fy.startJ=0,Fy.endI=r,Fy.endJ=n),Fy}var Be;(k=>(k.Empty=Gv,k.ofUnsortedArray=une,k.ofSingleton=sne,k.ofSortedArray=lne,k.ofRange=E5,k.ofBounds=(F,z)=>E5(F,z-1),k.is=cne,k.isRange=k5,k.has=gne,k.indexOf=L5,k.indexOfInInterval=hne,k.indexOfInRange=V5,k.start=bM,k.end=xM,k.min=mne,k.max=dne,k.size=F5,k.hashCode=pne,k.toString=fne,k.areEqual=O5,k.areIntersecting=Sne,k.isSubset=vne,k.union=G5,k.intersect=Ane,k.subtract=Tne,k.findPredecessorIndex=Tx,k.findPredecessorIndexInInterval=yne,k.findRange=bne,k.intersectionSize=Ine,k.deduplicate=Pne,k.indicesOf=_ne))(Be||={});var pLe={domain:[0,1],reverse:!1,listOrName:"red-yellow-blue",minLabel:"",maxLabel:""},Ja;(s=>{function e(l){return r(l,"continuous")}s.create=e;function t(l){return r(l,"discrete")}s.createDiscrete=t;function r(l,u){let{domain:c,reverse:m,listOrName:d}={...pLe,...l},p=typeof d=="string"?Ka(d).list:d,h=m?p.slice().reverse():p,f=0,g=0,y=0;function x(P,T){g=P,y=T,f=y-g||1}x(c[0],c[1]);let S=ua(l.minLabel,g.toString()),I=ua(l.maxLabel,y.toString()),v;if(h.every(P=>Array.isArray(P))){let P=[...h];P.sort((E,M)=>E[1]-M[1]);let T=P.map(E=>E[0]),R=Be.ofSortedArray(P.map(E=>E[1])),w=T.length-1;switch(u){case"continuous":v=E=>n(E,T,R,g,w,f);break;case"discrete":v=E=>i(E,T,R,g,w,f);break}}else switch(u){case"continuous":v=P=>o(P,h,g,f);break;case"discrete":v=P=>a(P,h,g,y,f);break}return{color:v,colorToArray:(P,T,R)=>{Le.toArray(v(P),T,R)},normalizedColorToArray:(P,T,R)=>{Le.toArrayNormalized(v(P),T,R)},setDomain:x,get legend(){return Nre(S,I,h)}}}function n(l,u,c,m,d,p){let h=_r((l-m)/p,0,1),f=Be.findPredecessorIndex(c,h);if(f===0)return u[0];if(f>d)return u[d];let g=c[f-1],y=c[f],x=_r((h-g)/(y-g),0,1);return Le.interpolate(u[f-1],u[f],x)}function o(l,u,c,m){let d=Math.min(u.length-1,Math.max(0,(l-c)/m*(u.length-1))),p=Math.floor(d),h=u[p],f=u[Math.ceil(d)];return Le.interpolate(h,f,d-p)}function i(l,u,c,m,d,p){if(u.length===0)return Le.fromRgb(0,0,0);let h=_r((l-m)/p,0,1),f=Be.findPredecessorIndex(c,h);return f===0?u[0]:f>d?u[d]:u[f]}function a(l,u,c,m,d){if(u.length===0)return Le.fromRgb(0,0,0);let p=d/u.length;if(l<=c)return u[0];if(l>=m)return u[u.length-1];let h=Math.min(u.length-1,Math.floor((l-c)/p));return u[h]}})(Ja||={});var st=_t(ur());function Dn(e){return e.svg?(0,st.jsx)("span",{className:`msp-icon msp-material-icon${e.inline?" msp-icon-inline":""}`,title:e.title,style:e.style,children:(0,st.jsx)(e.svg,{})}):null}var SM=(0,st.jsx)("circle",{r:"6px",id:"circle-left",cy:"12px",cx:"8px",strokeWidth:"1px"}),vM=(0,st.jsx)("circle",{r:"6px",id:"circle-right",cy:"12px",cx:"16px",strokeWidth:"1px"}),CLe=(0,st.jsxs)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:[(0,st.jsxs)("defs",{children:[SM,vM]}),(0,st.jsxs)("g",{children:[(0,st.jsx)("use",{href:"#circle-left",className:"msp-shape-filled"}),(0,st.jsx)("use",{href:"#circle-right",className:"msp-shape-filled"}),(0,st.jsx)("use",{href:"#circle-left",className:"msp-shape-empty"})]})]});function F2(){return CLe}var SLe=(0,st.jsxs)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:[(0,st.jsxs)("defs",{children:[SM,vM,(0,st.jsxs)("mask",{id:"mask-left",children:[(0,st.jsx)("use",{href:"#circle-left",fill:"white",stroke:"white"}),(0,st.jsx)("use",{href:"#circle-right",fill:"black",strokeWidth:"0px",stroke:"white"})]})]}),(0,st.jsxs)("g",{children:[(0,st.jsx)("use",{href:"#circle-left",className:"msp-shape-filled",mask:"url(#mask-left)"}),(0,st.jsx)("use",{href:"#circle-right",className:"msp-shape-empty"})]})]});function L2(){return SLe}var vLe=(0,st.jsxs)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:[(0,st.jsxs)("defs",{children:[SM,vM,(0,st.jsx)("clipPath",{id:"clip-left",children:(0,st.jsx)("use",{href:"#circle-right"})})]}),(0,st.jsxs)("g",{children:[(0,st.jsx)("use",{href:"#circle-left",className:"msp-shape-filled",clipPath:"url(#clip-left)"}),(0,st.jsx)("use",{href:"#circle-left",className:"msp-shape-empty"}),(0,st.jsx)("use",{href:"#circle-right",className:"msp-shape-empty"})]})]});function V2(){return vLe}var ILe=(0,st.jsxs)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:[(0,st.jsxs)("defs",{children:[SM,vM]}),(0,st.jsxs)("g",{children:[(0,st.jsx)("use",{href:"#circle-left",className:"msp-shape-empty"}),(0,st.jsx)("use",{href:"#circle-right",className:"msp-shape-filled"})]})]});function K0(){return ILe}var ALe=(0,st.jsx)("svg",{width:"17px",height:"17px",viewBox:"0 0 299.463 299.463",strokeWidth:"6px",children:(0,st.jsx)("g",{children:(0,st.jsx)("path",{d:"M256.851,173.832v-48.201c22.916-4.918,34.151-30.668,22.556-50.771c-11.547-20.004-39.486-23.251-55.242-5.844 l-41.746-24.106C189.618,22.603,172.861,0,149.734,0c-23.132,0-39.881,22.609-32.685,44.911L75.305,69.016 C59.522,51.586,31.597,54.88,20.061,74.863c-11.63,20.163-0.298,45.862,22.557,50.769v48.2 c-22.821,4.898-34.195,30.591-22.556,50.771c11.529,19.972,39.454,23.285,55.242,5.845l41.746,24.106 c-7.199,22.308,9.559,44.911,32.685,44.911c23.132,0,39.88-22.609,32.685-44.911l41.745-24.106 c15.817,17.469,43.73,14.099,55.242-5.844c0,0,0-0.001,0.001-0.002c4.587-7.953,5.805-17.213,3.431-26.076 C279.392,185.657,269.129,176.461,256.851,173.832z M249.62,72.088c20.568,0,27.428,27.191,10.008,37.239 c-0.003,0.002-0.006,0.003-0.009,0.005c-10.04,5.81-22.85,1.762-27.877-8.475C225.206,87.548,234.938,72.088,249.62,72.088z M149.734,14.4c11.005,0,19.958,8.954,19.958,19.959c0,11.127-9.077,19.958-19.958,19.958c-10.95,0-19.958-8.9-19.958-19.958 C129.776,23.354,138.729,14.4,149.734,14.4z M39.84,109.328c-17.451-10.067-10.534-37.24,10.01-37.24 c15.311,0,24.922,16.653,17.251,29.942C61.681,111.397,49.517,114.925,39.84,109.328z M59.802,224.702 c-9.535,5.503-21.768,2.229-27.268-7.298c-7.639-13.242,1.887-29.945,17.236-29.945c0.013,0,0.027,0,0.04,0 C70.07,187.48,77.49,214.469,59.802,224.702z M149.734,285.062c-11.005,0-19.958-8.954-19.958-19.958 c0-11.127,9.077-19.958,19.958-19.958c10.954,0,19.958,8.903,19.958,19.958C169.693,276.109,160.74,285.062,149.734,285.062z M216.953,217.982l-41.727,24.095c-13.778-15.22-37.459-14.94-50.983,0l-41.728-24.096c6.196-19.289-5.541-39.835-25.498-44.149 V125.63c19.752-4.268,31.762-24.65,25.498-44.149l41.727-24.095c13.629,15.055,37.32,15.093,50.983,0l41.728,24.096 c-6.196,19.29,5.534,39.835,25.498,44.149v48.202C222.61,178.123,210.721,198.581,216.953,217.982z M266.935,217.404 c-5.501,9.528-17.732,12.802-27.261,7.302c-17.682-10.23-10.301-37.247,10.032-37.247 C264.984,187.459,274.602,204.112,266.935,217.404z"})})});function Mne(){return ALe}var TLe=(0,st.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",strokeWidth:"0.1px",children:(0,st.jsx)("path",{d:"M21,16.5C21,16.88 20.79,17.21 20.47,17.38L12.57,21.82C12.41,21.94 12.21,22 12,22C11.79,22 11.59,21.94 11.43,21.82L3.53,17.38C3.21,17.21 3,16.88 3,16.5V7.5C3,7.12 3.21,6.79 3.53,6.62L11.43,2.18C11.59,2.06 11.79,2 12,2C12.21,2 12.41,2.06 12.57,2.18L20.47,6.62C20.79,6.79 21,7.12 21,7.5V16.5M12,4.15L6.04,7.5L12,10.85L17.96,7.5L12,4.15M5,15.91L11,19.29V12.58L5,9.21V15.91M19,15.91V9.21L13,12.58V19.29L19,15.91Z"})});function O2(){return TLe}var PLe=(0,st.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,st.jsx)("path",{d:"M10.07,14.27C10.57,14.03 11.16,14.25 11.4,14.75L13.7,19.74L15.5,18.89L13.19,13.91C12.95,13.41 13.17,12.81 13.67,12.58L13.95,12.5L16.25,12.05L8,5.12V15.9L9.82,14.43L10.07,14.27M13.64,21.97C13.14,22.21 12.54,22 12.31,21.5L10.13,16.76L7.62,18.78C7.45,18.92 7.24,19 7,19A1,1 0 0,1 6,18V3A1,1 0 0,1 7,2C7.24,2 7.47,2.09 7.64,2.23L7.65,2.22L19.14,11.86C19.57,12.22 19.62,12.85 19.27,13.27C19.12,13.45 18.91,13.57 18.7,13.61L15.54,14.23L17.74,18.96C18,19.46 17.76,20.05 17.26,20.28L13.64,21.97Z"})});function _Le(){return PLe}var RLe=(0,st.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,st.jsx)("path",{fill:"currentColor",d:"M7.5,5.6L5,7L6.4,4.5L5,2L7.5,3.4L10,2L8.6,4.5L10,7L7.5,5.6M19.5,15.4L22,14L20.6,16.5L22,19L19.5,17.6L17,19L18.4,16.5L17,14L19.5,15.4M22,2L20.6,4.5L22,7L19.5,5.6L17,7L18.4,4.5L17,2L19.5,3.4L22,2M13.34,12.78L15.78,10.34L13.66,8.22L11.22,10.66L13.34,12.78M14.37,7.29L16.71,9.63C17.1,10 17.1,10.65 16.71,11.04L5.04,22.71C4.65,23.1 4,23.1 3.63,22.71L1.29,20.37C0.9,20 0.9,19.35 1.29,18.96L12.96,7.29C13.35,6.9 14,6.9 14.37,7.29Z"})});function Bne(){return RLe}var DLe=(0,st.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",strokeWidth:"0.1px",children:(0,st.jsx)("path",{d:"M3 17.25V21H6.75L17.81 9.93L14.06 6.18L3 17.25M22.61 18.36L18.36 22.61L13.16 17.41L14.93 15.64L15.93 16.64L18.4 14.16L19.82 15.58L18.36 17L19.42 18L20.84 16.6L22.61 18.36M6.61 10.83L1.39 5.64L5.64 1.39L7.4 3.16L4.93 5.64L6 6.7L8.46 4.22L9.88 5.64L8.46 7.05L9.46 8.05L6.61 10.83M20.71 7C21.1 6.61 21.1 6 20.71 5.59L18.37 3.29C18 2.9 17.35 2.9 16.96 3.29L15.12 5.12L18.87 8.87L20.71 7Z"})});function Ene(){return DLe}var wLe=(0,st.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,st.jsx)("path",{d:"M22 11V3h-7v3H9V3H2v8h7V8h2v10h4v3h7v-8h-7v3h-2V8h2v3h7zM7 9H4V5h3v4zm10 6h3v4h-3v-4zm0-10h3v4h-3V5z"})});function N5(){return wLe}var MLe=(0,st.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,st.jsx)("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"})});function Bf(){return MLe}var BLe=(0,st.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,st.jsx)("path",{d:"M20 12l-1.41-1.41L13 16.17V4h-2v12.17l-5.58-5.59L4 12l8 8 8-8z"})});function kne(){return ELe}var ELe=(0,st.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,st.jsx)("path",{d:"M15 2c-2.71 0-5.05 1.54-6.22 3.78-1.28.67-2.34 1.72-3 3C3.54 9.95 2 12.29 2 15c0 3.87 3.13 7 7 7 2.71 0 5.05-1.54 6.22-3.78 1.28-.67 2.34-1.72 3-3C20.46 14.05 22 11.71 22 9c0-3.87-3.13-7-7-7M9 20c-2.76 0-5-2.24-5-5 0-1.12.37-2.16 1-3 0 3.87 3.13 7 7 7-.84.63-1.88 1-3 1m3-3c-2.76 0-5-2.24-5-5 0-1.12.37-2.16 1-3 0 3.86 3.13 6.99 7 7-.84.63-1.88 1-3 1m4.7-3.3c-.53.19-1.1.3-1.7.3-2.76 0-5-2.24-5-5 0-.6.11-1.17.3-1.7.53-.19 1.1-.3 1.7-.3 2.76 0 5 2.24 5 5 0 .6-.11 1.17-.3 1.7M19 12c0-3.86-3.13-6.99-7-7 .84-.63 1.87-1 3-1 2.76 0 5 2.24 5 5 0 1.12-.37 2.16-1 3"})});function _x(){return BLe}var kLe=(0,st.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,st.jsx)("path",{d:"M7 10l5 5 5-5z"})});function ec(){return kLe}var FLe=(0,st.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,st.jsx)("path",{d:"M10 17l5-5-5-5v10z"})});function tc(){return FLe}var LLe=(0,st.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,st.jsx)("path",{d:"M4 12l1.41 1.41L11 7.83V20h2V7.83l5.58 5.59L20 12l-8-8-8 8z"})});function Rx(){return LLe}var VLe=(0,st.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,st.jsx)("path",{d:"M12 6v3l4-4-4-4v3c-4.42 0-8 3.58-8 8 0 1.57.46 3.03 1.24 4.26L6.7 14.8c-.45-.83-.7-1.79-.7-2.8 0-3.31 2.69-6 6-6zm6.76 1.74L17.3 9.2c.44.84.7 1.79.7 2.8 0 3.31-2.69 6-6 6v-3l-4 4 4 4v-3c4.42 0 8-3.58 8-8 0-1.57-.46-3.03-1.24-4.26z"})});function Fne(){return VLe}var OLe=(0,st.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,st.jsx)("path",{d:"M19 12h-2v3h-3v2h5zM7 9h3V7H5v5h2zm14-6H3c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m0 16.01H3V4.99h18z"})});function Lne(){return OLe}var GLe=(0,st.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,st.jsx)("path",{d:"M6 13c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm0 4c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm0-8c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm-3 .5c-.28 0-.5.22-.5.5s.22.5.5.5.5-.22.5-.5-.22-.5-.5-.5zM6 5c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm15 5.5c.28 0 .5-.22.5-.5s-.22-.5-.5-.5-.5.22-.5.5.22.5.5.5zM14 7c.55 0 1-.45 1-1s-.45-1-1-1-1 .45-1 1 .45 1 1 1zm0-3.5c.28 0 .5-.22.5-.5s-.22-.5-.5-.5-.5.22-.5.5.22.5.5.5zm-11 10c-.28 0-.5.22-.5.5s.22.5.5.5.5-.22.5-.5-.22-.5-.5-.5zm7 7c-.28 0-.5.22-.5.5s.22.5.5.5.5-.22.5-.5-.22-.5-.5-.5zm0-17c.28 0 .5-.22.5-.5s-.22-.5-.5-.5-.5.22-.5.5.22.5.5.5zM10 7c.55 0 1-.45 1-1s-.45-1-1-1-1 .45-1 1 .45 1 1 1zm0 5.5c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zm8 .5c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm0 4c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm0-8c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm0-4c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm3 8.5c-.28 0-.5.22-.5.5s.22.5.5.5.5-.22.5-.5-.22-.5-.5-.5zM14 17c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm0 3.5c-.28 0-.5.22-.5.5s.22.5.5.5.5-.22.5-.5-.22-.5-.5-.5zm-4-12c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zm0 8.5c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm4-4.5c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zm0-4c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5z"})});function z5(){return GLe}var ULe=(0,st.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,st.jsx)("path",{d:"M15 7v12.97l-4.21-1.81-.79-.34-.79.34L5 19.97V7h10m4-6H8.99C7.89 1 7 1.9 7 3h10c1.1 0 2 .9 2 2v13l2 1V3c0-1.1-.9-2-2-2zm-4 4H5c-1.1 0-2 .9-2 2v16l7-3 7 3V7c0-1.1-.9-2-2-2z"})});function Ly(){return ULe}var NLe=(0,st.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,st.jsx)("path",{d:"M7 14c-1.66 0-3 1.34-3 3 0 1.31-1.16 2-2 2 .92 1.22 2.49 2 4 2 2.21 0 4-1.79 4-4 0-1.66-1.34-3-3-3zm13.71-9.37l-1.34-1.34a.9959.9959 0 00-1.41 0L9 12.25 11.75 15l8.96-8.96c.39-.39.39-1.02 0-1.41z"})});function IM(){return NLe}var zLe=(0,st.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,st.jsx)("path",{d:"M22.61 18.99l-9.08-9.08c.93-2.34.45-5.1-1.44-7C9.79.61 6.21.4 3.66 2.26L7.5 6.11 6.08 7.52 2.25 3.69C.39 6.23.6 9.82 2.9 12.11c1.86 1.86 4.57 2.35 6.89 1.48l9.11 9.11c.39.39 1.02.39 1.41 0l2.3-2.3c.4-.38.4-1.01 0-1.41zm-3 1.6l-9.46-9.46c-.61.45-1.29.72-2 .82-1.36.2-2.79-.21-3.83-1.25C3.37 9.76 2.93 8.5 3 7.26l3.09 3.09 4.24-4.24-3.09-3.09c1.24-.07 2.49.37 3.44 1.31 1.08 1.08 1.49 2.57 1.24 3.96-.12.71-.42 1.37-.88 1.96l9.45 9.45-.88.89z"})});function Vne(){return zLe}var HLe=(0,st.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,st.jsx)("path",{d:"M22.7 19l-9.1-9.1c.9-2.3.4-5-1.5-6.9-2-2-5-2.4-7.4-1.3L9 6 6 9 1.6 4.7C.4 7.1.9 10.1 2.9 12.1c1.9 1.9 4.6 2.4 6.9 1.5l9.1 9.1c.4.4 1 .4 1.4 0l2.3-2.3c.5-.4.5-1.1.1-1.4z"})});function One(){return HLe}var jLe=(0,st.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,st.jsx)("path",{d:"M14.25 2.26l-.08-.04-.01.02C13.46 2.09 12.74 2 12 2 6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10c0-4.75-3.31-8.72-7.75-9.74zM19.41 9h-7.99l2.71-4.7c2.4.66 4.35 2.42 5.28 4.7zM13.1 4.08L10.27 9l-1.15 2L6.4 6.3C7.84 4.88 9.82 4 12 4c.37 0 .74.03 1.1.08zM5.7 7.09L8.54 12l1.15 2H4.26C4.1 13.36 4 12.69 4 12c0-1.85.64-3.55 1.7-4.91zM4.59 15h7.98l-2.71 4.7c-2.4-.67-4.34-2.42-5.27-4.7zm6.31 4.91L14.89 13l2.72 4.7C16.16 19.12 14.18 20 12 20c-.38 0-.74-.04-1.1-.09zm7.4-3l-4-6.91h5.43c.17.64.27 1.31.27 2 0 1.85-.64 3.55-1.7 4.91z"})});function Gne(){return jLe}var WLe=(0,st.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,st.jsx)("path",{d:"M9.4 10.5l4.77-8.26C13.47 2.09 12.75 2 12 2c-2.4 0-4.6.85-6.32 2.25l3.66 6.35.06-.1zM21.54 9c-.92-2.92-3.15-5.26-6-6.34L11.88 9h9.66zm.26 1h-7.49l.29.5 4.76 8.25C21 16.97 22 14.61 22 12c0-.69-.07-1.35-.2-2zM8.54 12l-3.9-6.75C3.01 7.03 2 9.39 2 12c0 .69.07 1.35.2 2h7.49l-1.15-2zm-6.08 3c.92 2.92 3.15 5.26 6 6.34L12.12 15H2.46zm11.27 0l-3.9 6.76c.7.15 1.42.24 2.17.24 2.4 0 4.6-.85 6.32-2.25l-3.66-6.35-.93 1.6z"})});function Une(){return WLe}var XLe=(0,st.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,st.jsx)("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm3.59-13L12 10.59 8.41 7 7 8.41 10.59 12 7 15.59 8.41 17 12 13.41 15.59 17 17 15.59 13.41 12 17 8.41z"})});function G2(){return XLe}var QLe=(0,st.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,st.jsx)("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12 17 15.59z"})});function AM(){return QLe}var ZLe=(0,st.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,st.jsx)("path",{d:"M12 8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm-7 7H3v4c0 1.1.9 2 2 2h4v-2H5v-4zM5 5h4V3H5c-1.1 0-2 .9-2 2v4h2V5zm14-2h-4v2h4v4h2V5c0-1.1-.9-2-2-2zm0 16h-4v2h4c1.1 0 2-.9 2-2v-4h-2v4z"})});function Nne(){return ZLe}var qLe=(0,st.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,st.jsx)("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"})});function cd(){return qLe}var YLe=(0,st.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,st.jsx)("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})});function H5(){return YLe}var KLe=(0,st.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,st.jsx)("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})});function Bc(){return KLe}var JLe=(0,st.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,st.jsx)("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96zM14 13v4h-4v-4H7l5-5 5 5h-3z"})});function zne(){return JLe}var $Le=(0,st.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,st.jsx)("path",{d:"M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"})});function Hne(){return $Le}var eVe=(0,st.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,st.jsx)("path",{d:"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm-1 4H8c-1.1 0-1.99.9-1.99 2L6 21c0 1.1.89 2 1.99 2H19c1.1 0 2-.9 2-2V11l-6-6zM8 21V7h6v5h5v9H8z"})});function jne(){return eVe}var tVe=(0,st.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,st.jsx)("path",{d:"M17 15h2V7c0-1.1-.9-2-2-2H9v2h8v8zM7 17V1H5v4H1v2h4v10c0 1.1.9 2 2 2h10v4h2v-4h4v-2H7z"})});function Wne(){return tVe}var rVe=(0,st.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,st.jsx)("path",{d:"M3 5v4h2V5h4V3H5c-1.1 0-2 .9-2 2zm2 10H3v4c0 1.1.9 2 2 2h4v-2H5v-4zm14 4h-4v2h4c1.1 0 2-.9 2-2v-4h-2v4zm0-16h-4v2h4v4h2V5c0-1.1-.9-2-2-2z"})});function Xne(){return rVe}var nVe=(0,st.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,st.jsx)("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14zm-5.04-6.71l-2.75 3.54-1.96-2.36L6.5 17h11l-3.54-4.71z"})});function Qne(){return nVe}var oVe=(0,st.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,st.jsx)("path",{d:"M16 9v10H8V9h8m-1.5-6h-5l-1 1H5v2h14V4h-3.5l-1-1zM18 7H6v12c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7z"})});function $s(){return oVe}var iVe=(0,st.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,st.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"})});function j5(){return iVe}var aVe=(0,st.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",strokeWidth:"0.1px",children:(0,st.jsx)("path",{d:"M3 13h2v-2H3v2zm0 4h2v-2H3v2zm2 4v-2H3c0 1.1.89 2 2 2zM3 9h2V7H3v2zm12 12h2v-2h-2v2zm4-18H9c-1.11 0-2 .9-2 2v10c0 1.1.89 2 2 2h10c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 12H9V5h10v10zm-8 6h2v-2h-2v2zm-4 0h2v-2H7v2z"})});function sVe(){return aVe}var lVe=(0,st.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,st.jsx)("path",{d:"M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"})});function Zne(){return lVe}var uVe=(0,st.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,st.jsx)("path",{d:"M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"})});function U2(){return uVe}var cVe=(0,st.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,st.jsx)("path",{d:"M11 18h2v-2h-2v2zm1-16C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm0-14c-2.21 0-4 1.79-4 4h2c0-1.1.9-2 2-2s2 .9 2 2c0 2-3 1.75-3 5h2c0-2.25 3-2.5 3-5 0-2.21-1.79-4-4-4z"})});function Du(){return cVe}var mVe=(0,st.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,st.jsx)("path",{d:"M12 5.69l5 4.5V18h-2v-6H9v6H7v-7.81l5-4.5M12 3L2 12h3v8h6v-6h2v6h6v-8h3L12 3z"})});function N2(){return mVe}var dVe=(0,st.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,st.jsx)("path",{d:"M19.5 9.5c-1.03 0-1.9.62-2.29 1.5h-2.92c-.39-.88-1.26-1.5-2.29-1.5s-1.9.62-2.29 1.5H6.79c-.39-.88-1.26-1.5-2.29-1.5C3.12 9.5 2 10.62 2 12s1.12 2.5 2.5 2.5c1.03 0 1.9-.62 2.29-1.5h2.92c.39.88 1.26 1.5 2.29 1.5s1.9-.62 2.29-1.5h2.92c.39.88 1.26 1.5 2.29 1.5 1.38 0 2.5-1.12 2.5-2.5s-1.12-2.5-2.5-2.5z"})});function pVe(){return dVe}var fVe=(0,st.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,st.jsx)("path",{d:"M6 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm12 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm-6 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"})});function Dx(){return fVe}var hVe=(0,st.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,st.jsx)("path",{d:"M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"})});function W5(){return hVe}var gVe=(0,st.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,st.jsx)("path",{d:"M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"})});function X5(){return gVe}var yVe=(0,st.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,st.jsx)("path",{d:"M19 4H5c-1.11 0-2 .9-2 2v12c0 1.1.89 2 2 2h4v-2H5V8h14v10h-4v2h4c1.1 0 2-.9 2-2V6c0-1.1-.89-2-2-2zm-7 6l-4 4h3v6h2v-6h3l-4-4z"})});function qne(){return yVe}var bVe=(0,st.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,st.jsx)("path",{d:"M8 5v14l11-7z"})});function TM(){return bVe}var xVe=(0,st.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,st.jsx)("path",{d:"M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"})});function J0(){return xVe}var CVe=(0,st.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,st.jsx)("path",{d:"M19 13H5v-2h14v2z"})});function z2(){return CVe}var SVe=(0,st.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,st.jsx)("path",{d:"M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9zm-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8H12z"})});function H2(){return SVe}var vVe=(0,st.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",strokeWidth:"0.1px",children:(0,st.jsx)("path",{d:"M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm2 16H5V5h11.17L19 7.83V19zm-7-7c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3zM6 6h9v4H6z"})});function PM(){return vVe}var IVe=(0,st.jsxs)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:[(0,st.jsx)("circle",{cx:"7",cy:"14",r:"3"}),(0,st.jsx)("circle",{cx:"11",cy:"6",r:"3"}),(0,st.jsx)("circle",{cx:"16.6",cy:"17.6",r:"3"})]});function AVe(){return IVe}var TVe=(0,st.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,st.jsx)("path",{d:"M6 6h2v12H6zm3.5 6l8.5 6V6z"})});function Yne(){return TVe}var PVe=(0,st.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,st.jsx)("path",{d:"M6 6h12v12H6z"})});function _M(){return PVe}var _Ve=(0,st.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,st.jsx)("path",{d:"M4 6h16v2H4zm2-4h12v2H6zm14 8H4c-1.1 0-2 .9-2 2v8c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2v-8c0-1.1-.9-2-2-2zm0 10H4v-8h16v8zm-10-7.27v6.53L16 16z"})});function Kne(){return _Ve}var RVe=(0,st.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,st.jsx)("path",{d:"M6.99 11L3 15l3.99 4v-3H14v-2H6.99v-3zM21 9l-3.99-4v3H10v2h7.01v3L21 9z"})});function Jne(){return RVe}var DVe=(0,st.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,st.jsx)("path",{d:"M3 17v2h6v-2H3zM3 5v2h10V5H3zm10 16v-2h8v-2h-8v-2h-2v6h2zM7 9v2H3v2h4v2h2V9H7zm14 4v-2H11v2h10zm-6-4h2V7h4V5h-4V3h-2v6z"})});function Il(){return DVe}var wVe=(0,st.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,st.jsx)("path",{d:"M12 6c3.79 0 7.17 2.13 8.82 5.5-.59 1.22-1.42 2.27-2.41 3.12l1.41 1.41c1.39-1.23 2.49-2.77 3.18-4.53C21.27 7.11 17 4 12 4c-1.27 0-2.49.2-3.64.57l1.65 1.65C10.66 6.09 11.32 6 12 6zm-1.07 1.14L13 9.21c.57.25 1.03.71 1.28 1.28l2.07 2.07c.08-.34.14-.7.14-1.07C16.5 9.01 14.48 7 12 7c-.37 0-.72.05-1.07.14zM2.01 3.87l2.68 2.68C3.06 7.83 1.77 9.53 1 11.5 2.73 15.89 7 19 12 19c1.52 0 2.98-.29 4.32-.82l3.42 3.42 1.41-1.41L3.42 2.45 2.01 3.87zm7.5 7.5l2.61 2.61c-.04.01-.08.02-.12.02-1.38 0-2.5-1.12-2.5-2.5 0-.05.01-.08.01-.13zm-3.4-3.4l1.75 1.75c-.23.55-.36 1.15-.36 1.78 0 2.48 2.02 4.5 4.5 4.5.63 0 1.23-.13 1.77-.36l.98.98c-.88.24-1.8.38-2.75.38-3.79 0-7.17-2.13-8.82-5.5.7-1.43 1.72-2.61 2.93-3.53z"})});function md(){return wVe}var MVe=(0,st.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,st.jsx)("path",{d:"M12 6c3.79 0 7.17 2.13 8.82 5.5C19.17 14.87 15.79 17 12 17s-7.17-2.13-8.82-5.5C4.83 8.13 8.21 6 12 6m0-2C7 4 2.73 7.11 1 11.5 2.73 15.89 7 19 12 19s9.27-3.11 11-7.5C21.27 7.11 17 4 12 4zm0 5c1.38 0 2.5 1.12 2.5 2.5S13.38 14 12 14s-2.5-1.12-2.5-2.5S10.62 9 12 9m0-2c-2.48 0-4.5 2.02-4.5 4.5S9.52 16 12 16s4.5-2.02 4.5-4.5S14.48 7 12 7z"})});function vm(){return MVe}var BVe=(0,st.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,st.jsx)("path",{d:"M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"})});function RM(){return BVe}var EVe=(0,st.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,st.jsx)("path",{d:"M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0 c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2 c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1 C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06 c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41 l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41 c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36 c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"})});function $ne(){return EVe}var kVe=(0,st.jsxs)("svg",{width:"16px",height:"16px",viewBox:"0 0 16 16",children:[(0,st.jsx)("path",{d:"M8 1.248c1.857 0 3.526.641 4.65 1.794a5 5 0 0 1 2.518 1.09C13.907 1.482 11.295 0 8 0 4.75 0 2.12 1.48.844 4.122a5 5 0 0 1 2.289-1.047C4.236 1.872 5.974 1.248 8 1.248"}),(0,st.jsx)("path",{d:"M12 12a4 4 0 0 1-2.786-1.13l-.002-.002a1.6 1.6 0 0 0-.276-.167A2.2 2.2 0 0 0 8 10.5c-.414 0-.729.103-.935.201a1.6 1.6 0 0 0-.277.167l-.002.002A4 4 0 1 1 4 4h8a4 4 0 0 1 0 8"})]});function eoe(){return kVe}var toe=_Le,roe=AVe,DM=pVe,noe=sVe;var bo=_t(ur()),zl=class extends Vy.Component{constructor(){super(...arguments);this.state={isExpanded:!!this.props.initialExpanded};this.headerClicked=()=>{this.props.onHeaderClick?this.props.onHeaderClick():this.setState({isExpanded:!this.state.isExpanded})}}render(){let r=this.props.hideOffset?"msp-control-group-children":"msp-control-group-children msp-control-offset";return this.props.childrenClassName&&(r+=" "+this.props.childrenClassName),(0,bo.jsxs)("div",{className:"msp-control-group-wrapper",style:{position:"relative",marginTop:this.props.noTopMargin?0:void 0},children:[(0,bo.jsx)("div",{className:"msp-control-group-header",style:{marginLeft:this.props.headerLeftMargin},title:this.props.title,children:(0,bo.jsxs)(gr,{onClick:this.headerClicked,children:[!this.props.hideExpander&&(0,bo.jsx)(Dn,{svg:this.state.isExpanded?tc:ec}),this.props.topRightIcon&&(0,bo.jsx)(Dn,{svg:this.props.topRightIcon,style:{position:"absolute",right:"2px",top:0}}),(0,bo.jsx)("b",{children:this.props.header})]})}),this.state.isExpanded&&(0,bo.jsx)("div",{className:r,style:{display:this.state.isExpanded?"block":"none",maxHeight:this.props.maxHeight,overflow:"hidden",overflowY:"auto"},children:this.props.children})]})}};function ooe(e){return e}var Ec=class extends Vy.PureComponent{constructor(){super(...arguments);this.input=Vy.createRef();this.delayHandle=void 0;this.pendingValue=void 0;this.state={originalValue:"",value:""};this.onBlur=()=>{this.setState({value:""+this.state.originalValue}),this.props.onBlur&&this.props.onBlur()};this.raiseOnChange=()=>{this.pendingValue!==void 0&&(this.props.onChange(this.pendingValue),this.pendingValue=void 0)};this.onChange=r=>{let n=r.target.value;if(this.props.isValid&&!this.props.isValid(n)||this.props.numeric&&Number.isNaN(+n)){this.clearTimeout(),this.setState({value:n});return}if(this.props.numeric)this.setState({value:n},()=>this.triggerChanged(n,+n));else{let i=(this.props.toValue||ooe)(n),a=(this.props.fromValue||ooe)(i);this.setState({value:a},()=>this.triggerChanged(a,i))}};this.onKeyUp=r=>{(r.charCode===27||r.keyCode===27||r.key==="Escape")&&this.props.blurOnEscape&&this.input.current&&this.input.current.blur()};this.onKeyPress=r=>{(r.keyCode===13||r.charCode===13||r.key==="Enter")&&(this.isPending&&(this.clearTimeout(),this.raiseOnChange()),this.props.blurOnEnter&&this.input.current&&this.input.current.blur(),this.props.onEnter&&this.props.onEnter()),r.stopPropagation()}}get isPending(){return typeof this.delayHandle<"u"}clearTimeout(){this.isPending&&(clearTimeout(this.delayHandle),this.delayHandle=void 0)}triggerChanged(r,n){this.clearTimeout(),r!==this.state.originalValue&&(this.props.delayMs?(this.pendingValue=n,this.delayHandle=setTimeout(this.raiseOnChange,this.props.delayMs)):this.props.onChange(n))}static getDerivedStateFromProps(r,n){let o=r.fromValue?r.fromValue(r.value):r.value;return o===n.originalValue?null:{originalValue:o,value:o}}render(){return(0,bo.jsx)("input",{type:"text",className:this.props.className,style:this.props.style,ref:this.input,onBlur:this.onBlur,value:this.state.value,placeholder:this.props.placeholder,onChange:this.onChange,onKeyPress:this.props.onEnter||this.props.blurOnEnter||this.props.blurOnEscape?this.onKeyPress:void 0,onKeyDown:this.props.blurOnEscape?this.onKeyUp:void 0,disabled:!!this.props.isDisabled})}},wM=class extends Vy.Component{constructor(){super(...arguments);this.state={isExpanded:!1};this.toggleExpanded=()=>this.setState({isExpanded:!this.state.isExpanded})}render(){let{label:r,pivot:n,controls:o}=this.props;return(0,bo.jsxs)(bo.Fragment,{children:[(0,bo.jsx)(Hl,{label:(0,bo.jsxs)(bo.Fragment,{children:[r,(0,bo.jsx)("button",{className:"msp-btn-link msp-btn-icon msp-control-group-expander",onClick:this.toggleExpanded,title:`${this.state.isExpanded?"Less":"More"} options`,style:{background:"transparent",textAlign:"left",padding:"0"},children:(0,bo.jsx)(Dn,{svg:this.state.isExpanded?z2:Bf,style:{display:"inline-block"}})})]}),control:n,children:this.props.colorStripe&&(0,bo.jsx)("div",{className:"msp-expandable-group-color-stripe",style:{backgroundColor:Le.toStyle(this.props.colorStripe)}})}),this.state.isExpanded&&(0,bo.jsx)("div",{className:"msp-control-offset",children:o})]})}};function Ef(e){return(0,bo.jsxs)("div",{className:`msp-section-header${e.accent?" msp-transform-header-brand-"+e.accent:""}`,children:[e.icon&&(0,bo.jsx)(Dn,{svg:e.icon}),e.title," ",(0,bo.jsx)("small",{children:e.desc})]})}function gr(e){let t="msp-btn";e.inline||(t+=" msp-btn-block"),e.noOverflow&&(t+=" msp-no-overflow"),e.flex&&(t+=" msp-flex-item"),(e.commit==="on"||e.commit)&&(t+=" msp-btn-commit msp-btn-commit-on"),e.commit==="off"&&(t+=" msp-btn-commit msp-btn-commit-off"),e.children||(t+=" msp-btn-childless"),e.className&&(t+=" "+e.className);let r;return e.flex&&(typeof e.flex=="number"?r={flex:`0 0 ${e.flex}px`,padding:0,maxWidth:`${e.flex}px`}:typeof e.flex=="string"&&(r={flex:`0 0 ${e.flex}`,padding:0,maxWidth:e.flex})),e.style&&(r?Object.assign(r,e.style):r=e.style),(0,bo.jsxs)("button",{onClick:e.onClick,title:e.title,disabled:e.disabled,style:r,className:t,"data-id":e["data-id"],"data-color":e["data-color"],onContextMenu:e.onContextMenu,onMouseEnter:e.onMouseEnter,onMouseLeave:e.onMouseLeave,children:[e.icon&&(0,bo.jsx)(Dn,{svg:e.icon}),e.children]})}function sr(e){let t=`msp-btn msp-btn-icon${e.small?"-small":""}${e.className?" "+e.className:""}`;typeof e.toggleState<"u"&&(t+=` msp-btn-link-toggle-${e.toggleState?"on":"off"}`),e.transparent&&(t+=" msp-transparent-bg");let r;return e.flex&&(typeof e.flex=="boolean"?r={flex:"0 0 32px",padding:0}:typeof e.flex=="number"?r={flex:`0 0 ${e.flex}px`,padding:0,maxWidth:`${e.flex}px`}:r={flex:`0 0 ${e.flex}`,padding:0,maxWidth:e.flex}),e.style&&(r?Object.assign(r,e.style):r=e.style),(0,bo.jsxs)("button",{className:t,onClick:e.onClick,title:e.title,disabled:e.disabled,"data-id":e["data-id"],style:r,children:[e.svg&&(0,bo.jsx)(Dn,{svg:e.svg}),e.extraContent]})}var yi=class extends Vy.PureComponent{constructor(){super(...arguments);this.onClick=r=>{r.currentTarget.blur(),this.props.toggle()}}render(){let r=this.props,n=r.label,o=r.isSelected?`${r.className||""} msp-control-current`:r.className;return(0,bo.jsx)(gr,{icon:this.props.icon,onClick:this.onClick,title:this.props.title,inline:this.props.inline,disabled:r.disabled,style:r.style,className:o,children:n&&this.props.isSelected?(0,bo.jsx)("b",{children:n}):n})}},fs=class extends Vy.PureComponent{constructor(){super(...arguments);this.state={isExpanded:!!this.props.initiallyExpanded};this.toggleExpanded=()=>this.setState({isExpanded:!this.state.isExpanded})}render(){return(0,bo.jsxs)(bo.Fragment,{children:[(0,bo.jsx)("div",{className:"msp-control-group-header",style:{marginTop:this.props.marginTop!==void 0?this.props.marginTop:"1px",marginLeft:this.props.headerLeftMargin},children:(0,bo.jsxs)("button",{className:"msp-btn msp-form-control msp-btn-block",onClick:this.toggleExpanded,style:this.props.headerStyle,children:[(0,bo.jsx)(Dn,{svg:this.state.isExpanded?ec:tc}),this.props.header]})}),this.state.isExpanded&&(this.props.noOffset?this.props.children:(0,bo.jsx)("div",{className:this.props.accent?"msp-accent-offset":"msp-control-offset",children:this.props.children}))]})}};function Hl(e){let t="msp-control-row";return e.className&&(t+=" "+e.className),(0,bo.jsxs)("div",{className:t,children:[(0,bo.jsx)("span",{className:"msp-control-row-label",title:e.title,children:e.label}),(0,bo.jsx)("div",{className:"msp-control-row-ctrl",children:e.control}),e.children]})}var $0=_t(ur()),Al=Uv.createContext(void 0),Fr=class extends Uv.Component{constructor(r,n){super(r);this.subs=void 0;this.plugin=n,this.init&&this.init()}static{this.contextType=Al}subscribe(r,n){typeof this.subs>"u"&&(this.subs=[]),this.subs.push(r.subscribe(n))}componentWillUnmount(){if(this.subs){for(let r of this.subs)r.unsubscribe();this.subs=void 0}}},bi=class extends Uv.PureComponent{constructor(r,n){super(r,n);this.subs=void 0;this.plugin=n,this.init&&this.init()}static{this.contextType=Al}subscribe(r,n){typeof this.subs>"u"&&(this.subs=[]),this.subs.push(r.subscribe(n))}componentWillUnmount(){if(this.subs){for(let r of this.subs)r.unsubscribe();this.subs=void 0}}},kc=class extends Fr{toggleCollapsed(){this.setState({isCollapsed:!this.state.isCollapsed})}componentDidUpdate(t){this.props.initiallyCollapsed!==void 0&&t.initiallyCollapsed!==this.props.initiallyCollapsed&&this.setState({isCollapsed:this.props.initiallyCollapsed})}render(){if(this.state.isHidden)return null;let t=this.state.header.toLowerCase().replace(/\s/g,""),r=this.state.isCollapsed?"msp-transform-wrapper msp-transform-wrapper-collapsed":"msp-transform-wrapper";return(0,$0.jsxs)("div",{className:r,children:[(0,$0.jsx)("div",{id:t,className:"msp-transform-header",children:(0,$0.jsxs)(gr,{icon:this.state.brand?void 0:this.state.isCollapsed?tc:ec,noOverflow:!0,onClick:()=>this.toggleCollapsed(),className:this.state.brand?`msp-transform-header-brand msp-transform-header-brand-${this.state.brand.accent}`:void 0,title:`Click to ${this.state.isCollapsed?"expand":"collapse"}`,children:[(0,$0.jsx)(Dn,{svg:this.state.brand?.svg,inline:!0}),this.state.header,(0,$0.jsx)("small",{style:{margin:"0 6px"},children:this.state.isCollapsed?"":this.state.description})]})}),!this.state.isCollapsed&&this.renderControls()]})}constructor(t,r){super(t,r);let n=this.defaultState();t.initiallyCollapsed!==void 0&&(n.isCollapsed=t.initiallyCollapsed),t.header!==void 0&&(n.header=t.header),this.state=n}};var gB=_t(Mi());var Ff=_t(Mi());function ioe(e,t){let r=t||{};return(e[e.length-1]===""?[...e,""]:e).join((r.padRight?" ":"")+","+(r.padLeft===!1?"":" ")).trim()}var FVe=/^[$_\p{ID_Start}][$_\u{200C}\u{200D}\p{ID_Continue}]*$/u,LVe=/^[$_\p{ID_Start}][-$_\u{200C}\u{200D}\p{ID_Continue}]*$/u,VVe={};function MM(e,t){return((t||VVe).jsx?LVe:FVe).test(e)}var OVe=/[ \t\n\f\r]/g;function Q5(e){return typeof e=="object"?e.type==="text"?aoe(e.value):!1:aoe(e)}function aoe(e){return e.replace(OVe,"")===""}var Oy=class{constructor(t,r,n){this.normal=r,this.property=t,n&&(this.space=n)}};Oy.prototype.normal={};Oy.prototype.property={};Oy.prototype.space=void 0;function Z5(e,t){let r={},n={};for(let o of e)Object.assign(r,o.property),Object.assign(n,o.normal);return new Oy(r,n,t)}function j2(e){return e.toLowerCase()}var jl=class{constructor(t,r){this.attribute=r,this.property=t}};jl.prototype.attribute="";jl.prototype.booleanish=!1;jl.prototype.boolean=!1;jl.prototype.commaOrSpaceSeparated=!1;jl.prototype.commaSeparated=!1;jl.prototype.defined=!1;jl.prototype.mustUseProperty=!1;jl.prototype.number=!1;jl.prototype.overloadedBoolean=!1;jl.prototype.property="";jl.prototype.spaceSeparated=!1;jl.prototype.space=void 0;var W2={};Gi(W2,{boolean:()=>Kn,booleanish:()=>hs,commaOrSpaceSeparated:()=>Im,commaSeparated:()=>wx,number:()=>$t,overloadedBoolean:()=>BM,spaceSeparated:()=>Ei});var GVe=0,Kn=eS(),hs=eS(),BM=eS(),$t=eS(),Ei=eS(),wx=eS(),Im=eS();function eS(){return 2**++GVe}var q5=Object.keys(W2),tS=class extends jl{constructor(t,r,n,o){let i=-1;if(super(t,r),soe(this,"space",o),typeof n=="number")for(;++i<q5.length;){let a=q5[i];soe(this,q5[i],(n&W2[a])===W2[a])}}};tS.prototype.defined=!0;function soe(e,t,r){r&&(e[t]=r)}function ap(e){let t={},r={};for(let[n,o]of Object.entries(e.properties)){let i=new tS(n,e.transform(e.attributes||{},n),o,e.space);e.mustUseProperty&&e.mustUseProperty.includes(n)&&(i.mustUseProperty=!0),t[n]=i,r[j2(n)]=n,r[j2(i.attribute)]=n}return new Oy(t,r,e.space)}var Y5=ap({properties:{ariaActiveDescendant:null,ariaAtomic:hs,ariaAutoComplete:null,ariaBusy:hs,ariaChecked:hs,ariaColCount:$t,ariaColIndex:$t,ariaColSpan:$t,ariaControls:Ei,ariaCurrent:null,ariaDescribedBy:Ei,ariaDetails:null,ariaDisabled:hs,ariaDropEffect:Ei,ariaErrorMessage:null,ariaExpanded:hs,ariaFlowTo:Ei,ariaGrabbed:hs,ariaHasPopup:null,ariaHidden:hs,ariaInvalid:null,ariaKeyShortcuts:null,ariaLabel:null,ariaLabelledBy:Ei,ariaLevel:$t,ariaLive:null,ariaModal:hs,ariaMultiLine:hs,ariaMultiSelectable:hs,ariaOrientation:null,ariaOwns:Ei,ariaPlaceholder:null,ariaPosInSet:$t,ariaPressed:hs,ariaReadOnly:hs,ariaRelevant:null,ariaRequired:hs,ariaRoleDescription:Ei,ariaRowCount:$t,ariaRowIndex:$t,ariaRowSpan:$t,ariaSelected:hs,ariaSetSize:$t,ariaSort:null,ariaValueMax:$t,ariaValueMin:$t,ariaValueNow:$t,ariaValueText:null,role:null},transform(e,t){return t==="role"?t:"aria-"+t.slice(4).toLowerCase()}});function EM(e,t){return t in e?e[t]:t}function kM(e,t){return EM(e,t.toLowerCase())}var loe=ap({attributes:{acceptcharset:"accept-charset",classname:"class",htmlfor:"for",httpequiv:"http-equiv"},mustUseProperty:["checked","multiple","muted","selected"],properties:{abbr:null,accept:wx,acceptCharset:Ei,accessKey:Ei,action:null,allow:null,allowFullScreen:Kn,allowPaymentRequest:Kn,allowUserMedia:Kn,alt:null,as:null,async:Kn,autoCapitalize:null,autoComplete:Ei,autoFocus:Kn,autoPlay:Kn,blocking:Ei,capture:null,charSet:null,checked:Kn,cite:null,className:Ei,cols:$t,colSpan:null,content:null,contentEditable:hs,controls:Kn,controlsList:Ei,coords:$t|wx,crossOrigin:null,data:null,dateTime:null,decoding:null,default:Kn,defer:Kn,dir:null,dirName:null,disabled:Kn,download:BM,draggable:hs,encType:null,enterKeyHint:null,fetchPriority:null,form:null,formAction:null,formEncType:null,formMethod:null,formNoValidate:Kn,formTarget:null,headers:Ei,height:$t,hidden:BM,high:$t,href:null,hrefLang:null,htmlFor:Ei,httpEquiv:Ei,id:null,imageSizes:null,imageSrcSet:null,inert:Kn,inputMode:null,integrity:null,is:null,isMap:Kn,itemId:null,itemProp:Ei,itemRef:Ei,itemScope:Kn,itemType:Ei,kind:null,label:null,lang:null,language:null,list:null,loading:null,loop:Kn,low:$t,manifest:null,max:null,maxLength:$t,media:null,method:null,min:null,minLength:$t,multiple:Kn,muted:Kn,name:null,nonce:null,noModule:Kn,noValidate:Kn,onAbort:null,onAfterPrint:null,onAuxClick:null,onBeforeMatch:null,onBeforePrint:null,onBeforeToggle:null,onBeforeUnload:null,onBlur:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onContextLost:null,onContextMenu:null,onContextRestored:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnded:null,onError:null,onFocus:null,onFormData:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLanguageChange:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadEnd:null,onLoadStart:null,onMessage:null,onMessageError:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRejectionHandled:null,onReset:null,onResize:null,onScroll:null,onScrollEnd:null,onSecurityPolicyViolation:null,onSeeked:null,onSeeking:null,onSelect:null,onSlotChange:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnhandledRejection:null,onUnload:null,onVolumeChange:null,onWaiting:null,onWheel:null,open:Kn,optimum:$t,pattern:null,ping:Ei,placeholder:null,playsInline:Kn,popover:null,popoverTarget:null,popoverTargetAction:null,poster:null,preload:null,readOnly:Kn,referrerPolicy:null,rel:Ei,required:Kn,reversed:Kn,rows:$t,rowSpan:$t,sandbox:Ei,scope:null,scoped:Kn,seamless:Kn,selected:Kn,shadowRootClonable:Kn,shadowRootDelegatesFocus:Kn,shadowRootMode:null,shape:null,size:$t,sizes:null,slot:null,span:$t,spellCheck:hs,src:null,srcDoc:null,srcLang:null,srcSet:null,start:$t,step:null,style:null,tabIndex:$t,target:null,title:null,translate:null,type:null,typeMustMatch:Kn,useMap:null,value:hs,width:$t,wrap:null,writingSuggestions:null,align:null,aLink:null,archive:Ei,axis:null,background:null,bgColor:null,border:$t,borderColor:null,bottomMargin:$t,cellPadding:null,cellSpacing:null,char:null,charOff:null,classId:null,clear:null,code:null,codeBase:null,codeType:null,color:null,compact:Kn,declare:Kn,event:null,face:null,frame:null,frameBorder:null,hSpace:$t,leftMargin:$t,link:null,longDesc:null,lowSrc:null,marginHeight:$t,marginWidth:$t,noResize:Kn,noHref:Kn,noShade:Kn,noWrap:Kn,object:null,profile:null,prompt:null,rev:null,rightMargin:$t,rules:null,scheme:null,scrolling:hs,standby:null,summary:null,text:null,topMargin:$t,valueType:null,version:null,vAlign:null,vLink:null,vSpace:$t,allowTransparency:null,autoCorrect:null,autoSave:null,disablePictureInPicture:Kn,disableRemotePlayback:Kn,prefix:null,property:null,results:$t,security:null,unselectable:null},space:"html",transform:kM});var uoe=ap({attributes:{accentHeight:"accent-height",alignmentBaseline:"alignment-baseline",arabicForm:"arabic-form",baselineShift:"baseline-shift",capHeight:"cap-height",className:"class",clipPath:"clip-path",clipRule:"clip-rule",colorInterpolation:"color-interpolation",colorInterpolationFilters:"color-interpolation-filters",colorProfile:"color-profile",colorRendering:"color-rendering",crossOrigin:"crossorigin",dataType:"datatype",dominantBaseline:"dominant-baseline",enableBackground:"enable-background",fillOpacity:"fill-opacity",fillRule:"fill-rule",floodColor:"flood-color",floodOpacity:"flood-opacity",fontFamily:"font-family",fontSize:"font-size",fontSizeAdjust:"font-size-adjust",fontStretch:"font-stretch",fontStyle:"font-style",fontVariant:"font-variant",fontWeight:"font-weight",glyphName:"glyph-name",glyphOrientationHorizontal:"glyph-orientation-horizontal",glyphOrientationVertical:"glyph-orientation-vertical",hrefLang:"hreflang",horizAdvX:"horiz-adv-x",horizOriginX:"horiz-origin-x",horizOriginY:"horiz-origin-y",imageRendering:"image-rendering",letterSpacing:"letter-spacing",lightingColor:"lighting-color",markerEnd:"marker-end",markerMid:"marker-mid",markerStart:"marker-start",navDown:"nav-down",navDownLeft:"nav-down-left",navDownRight:"nav-down-right",navLeft:"nav-left",navNext:"nav-next",navPrev:"nav-prev",navRight:"nav-right",navUp:"nav-up",navUpLeft:"nav-up-left",navUpRight:"nav-up-right",onAbort:"onabort",onActivate:"onactivate",onAfterPrint:"onafterprint",onBeforePrint:"onbeforeprint",onBegin:"onbegin",onCancel:"oncancel",onCanPlay:"oncanplay",onCanPlayThrough:"oncanplaythrough",onChange:"onchange",onClick:"onclick",onClose:"onclose",onCopy:"oncopy",onCueChange:"oncuechange",onCut:"oncut",onDblClick:"ondblclick",onDrag:"ondrag",onDragEnd:"ondragend",onDragEnter:"ondragenter",onDragExit:"ondragexit",onDragLeave:"ondragleave",onDragOver:"ondragover",onDragStart:"ondragstart",onDrop:"ondrop",onDurationChange:"ondurationchange",onEmptied:"onemptied",onEnd:"onend",onEnded:"onended",onError:"onerror",onFocus:"onfocus",onFocusIn:"onfocusin",onFocusOut:"onfocusout",onHashChange:"onhashchange",onInput:"oninput",onInvalid:"oninvalid",onKeyDown:"onkeydown",onKeyPress:"onkeypress",onKeyUp:"onkeyup",onLoad:"onload",onLoadedData:"onloadeddata",onLoadedMetadata:"onloadedmetadata",onLoadStart:"onloadstart",onMessage:"onmessage",onMouseDown:"onmousedown",onMouseEnter:"onmouseenter",onMouseLeave:"onmouseleave",onMouseMove:"onmousemove",onMouseOut:"onmouseout",onMouseOver:"onmouseover",onMouseUp:"onmouseup",onMouseWheel:"onmousewheel",onOffline:"onoffline",onOnline:"ononline",onPageHide:"onpagehide",onPageShow:"onpageshow",onPaste:"onpaste",onPause:"onpause",onPlay:"onplay",onPlaying:"onplaying",onPopState:"onpopstate",onProgress:"onprogress",onRateChange:"onratechange",onRepeat:"onrepeat",onReset:"onreset",onResize:"onresize",onScroll:"onscroll",onSeeked:"onseeked",onSeeking:"onseeking",onSelect:"onselect",onShow:"onshow",onStalled:"onstalled",onStorage:"onstorage",onSubmit:"onsubmit",onSuspend:"onsuspend",onTimeUpdate:"ontimeupdate",onToggle:"ontoggle",onUnload:"onunload",onVolumeChange:"onvolumechange",onWaiting:"onwaiting",onZoom:"onzoom",overlinePosition:"overline-position",overlineThickness:"overline-thickness",paintOrder:"paint-order",panose1:"panose-1",pointerEvents:"pointer-events",referrerPolicy:"referrerpolicy",renderingIntent:"rendering-intent",shapeRendering:"shape-rendering",stopColor:"stop-color",stopOpacity:"stop-opacity",strikethroughPosition:"strikethrough-position",strikethroughThickness:"strikethrough-thickness",strokeDashArray:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeLineCap:"stroke-linecap",strokeLineJoin:"stroke-linejoin",strokeMiterLimit:"stroke-miterlimit",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",tabIndex:"tabindex",textAnchor:"text-anchor",textDecoration:"text-decoration",textRendering:"text-rendering",transformOrigin:"transform-origin",typeOf:"typeof",underlinePosition:"underline-position",underlineThickness:"underline-thickness",unicodeBidi:"unicode-bidi",unicodeRange:"unicode-range",unitsPerEm:"units-per-em",vAlphabetic:"v-alphabetic",vHanging:"v-hanging",vIdeographic:"v-ideographic",vMathematical:"v-mathematical",vectorEffect:"vector-effect",vertAdvY:"vert-adv-y",vertOriginX:"vert-origin-x",vertOriginY:"vert-origin-y",wordSpacing:"word-spacing",writingMode:"writing-mode",xHeight:"x-height",playbackOrder:"playbackorder",timelineBegin:"timelinebegin"},properties:{about:Im,accentHeight:$t,accumulate:null,additive:null,alignmentBaseline:null,alphabetic:$t,amplitude:$t,arabicForm:null,ascent:$t,attributeName:null,attributeType:null,azimuth:$t,bandwidth:null,baselineShift:null,baseFrequency:null,baseProfile:null,bbox:null,begin:null,bias:$t,by:null,calcMode:null,capHeight:$t,className:Ei,clip:null,clipPath:null,clipPathUnits:null,clipRule:null,color:null,colorInterpolation:null,colorInterpolationFilters:null,colorProfile:null,colorRendering:null,content:null,contentScriptType:null,contentStyleType:null,crossOrigin:null,cursor:null,cx:null,cy:null,d:null,dataType:null,defaultAction:null,descent:$t,diffuseConstant:$t,direction:null,display:null,dur:null,divisor:$t,dominantBaseline:null,download:Kn,dx:null,dy:null,edgeMode:null,editable:null,elevation:$t,enableBackground:null,end:null,event:null,exponent:$t,externalResourcesRequired:null,fill:null,fillOpacity:$t,fillRule:null,filter:null,filterRes:null,filterUnits:null,floodColor:null,floodOpacity:null,focusable:null,focusHighlight:null,fontFamily:null,fontSize:null,fontSizeAdjust:null,fontStretch:null,fontStyle:null,fontVariant:null,fontWeight:null,format:null,fr:null,from:null,fx:null,fy:null,g1:wx,g2:wx,glyphName:wx,glyphOrientationHorizontal:null,glyphOrientationVertical:null,glyphRef:null,gradientTransform:null,gradientUnits:null,handler:null,hanging:$t,hatchContentUnits:null,hatchUnits:null,height:null,href:null,hrefLang:null,horizAdvX:$t,horizOriginX:$t,horizOriginY:$t,id:null,ideographic:$t,imageRendering:null,initialVisibility:null,in:null,in2:null,intercept:$t,k:$t,k1:$t,k2:$t,k3:$t,k4:$t,kernelMatrix:Im,kernelUnitLength:null,keyPoints:null,keySplines:null,keyTimes:null,kerning:null,lang:null,lengthAdjust:null,letterSpacing:null,lightingColor:null,limitingConeAngle:$t,local:null,markerEnd:null,markerMid:null,markerStart:null,markerHeight:null,markerUnits:null,markerWidth:null,mask:null,maskContentUnits:null,maskUnits:null,mathematical:null,max:null,media:null,mediaCharacterEncoding:null,mediaContentEncodings:null,mediaSize:$t,mediaTime:null,method:null,min:null,mode:null,name:null,navDown:null,navDownLeft:null,navDownRight:null,navLeft:null,navNext:null,navPrev:null,navRight:null,navUp:null,navUpLeft:null,navUpRight:null,numOctaves:null,observer:null,offset:null,onAbort:null,onActivate:null,onAfterPrint:null,onBeforePrint:null,onBegin:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnd:null,onEnded:null,onError:null,onFocus:null,onFocusIn:null,onFocusOut:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadStart:null,onMessage:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onMouseWheel:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRepeat:null,onReset:null,onResize:null,onScroll:null,onSeeked:null,onSeeking:null,onSelect:null,onShow:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnload:null,onVolumeChange:null,onWaiting:null,onZoom:null,opacity:null,operator:null,order:null,orient:null,orientation:null,origin:null,overflow:null,overlay:null,overlinePosition:$t,overlineThickness:$t,paintOrder:null,panose1:null,path:null,pathLength:$t,patternContentUnits:null,patternTransform:null,patternUnits:null,phase:null,ping:Ei,pitch:null,playbackOrder:null,pointerEvents:null,points:null,pointsAtX:$t,pointsAtY:$t,pointsAtZ:$t,preserveAlpha:null,preserveAspectRatio:null,primitiveUnits:null,propagate:null,property:Im,r:null,radius:null,referrerPolicy:null,refX:null,refY:null,rel:Im,rev:Im,renderingIntent:null,repeatCount:null,repeatDur:null,requiredExtensions:Im,requiredFeatures:Im,requiredFonts:Im,requiredFormats:Im,resource:null,restart:null,result:null,rotate:null,rx:null,ry:null,scale:null,seed:null,shapeRendering:null,side:null,slope:null,snapshotTime:null,specularConstant:$t,specularExponent:$t,spreadMethod:null,spacing:null,startOffset:null,stdDeviation:null,stemh:null,stemv:null,stitchTiles:null,stopColor:null,stopOpacity:null,strikethroughPosition:$t,strikethroughThickness:$t,string:null,stroke:null,strokeDashArray:Im,strokeDashOffset:null,strokeLineCap:null,strokeLineJoin:null,strokeMiterLimit:$t,strokeOpacity:$t,strokeWidth:null,style:null,surfaceScale:$t,syncBehavior:null,syncBehaviorDefault:null,syncMaster:null,syncTolerance:null,syncToleranceDefault:null,systemLanguage:Im,tabIndex:$t,tableValues:null,target:null,targetX:$t,targetY:$t,textAnchor:null,textDecoration:null,textRendering:null,textLength:null,timelineBegin:null,title:null,transformBehavior:null,type:null,typeOf:Im,to:null,transform:null,transformOrigin:null,u1:null,u2:null,underlinePosition:$t,underlineThickness:$t,unicode:null,unicodeBidi:null,unicodeRange:null,unitsPerEm:$t,values:null,vAlphabetic:$t,vMathematical:$t,vectorEffect:null,vHanging:$t,vIdeographic:$t,version:null,vertAdvY:$t,vertOriginX:$t,vertOriginY:$t,viewBox:null,viewTarget:null,visibility:null,width:null,widths:null,wordSpacing:null,writingMode:null,x:null,x1:null,x2:null,xChannelSelector:null,xHeight:$t,y:null,y1:null,y2:null,yChannelSelector:null,z:null,zoomAndPan:null},space:"svg",transform:EM});var K5=ap({properties:{xLinkActuate:null,xLinkArcRole:null,xLinkHref:null,xLinkRole:null,xLinkShow:null,xLinkTitle:null,xLinkType:null},space:"xlink",transform(e,t){return"xlink:"+t.slice(5).toLowerCase()}});var J5=ap({attributes:{xmlnsxlink:"xmlns:xlink"},properties:{xmlnsXLink:null,xmlns:null},space:"xmlns",transform:kM});var $5=ap({properties:{xmlBase:null,xmlLang:null,xmlSpace:null},space:"xml",transform(e,t){return"xml:"+t.slice(3).toLowerCase()}});var ez={classId:"classID",dataType:"datatype",itemId:"itemID",strokeDashArray:"strokeDasharray",strokeDashOffset:"strokeDashoffset",strokeLineCap:"strokeLinecap",strokeLineJoin:"strokeLinejoin",strokeMiterLimit:"strokeMiterlimit",typeOf:"typeof",xLinkActuate:"xlinkActuate",xLinkArcRole:"xlinkArcrole",xLinkHref:"xlinkHref",xLinkRole:"xlinkRole",xLinkShow:"xlinkShow",xLinkTitle:"xlinkTitle",xLinkType:"xlinkType",xmlnsXLink:"xmlnsXlink"};var UVe=/[A-Z]/g,coe=/-[a-z]/g,NVe=/^data[-\w.:]+$/i;function tz(e,t){let r=j2(t),n=t,o=jl;if(r in e.normal)return e.property[e.normal[r]];if(r.length>4&&r.slice(0,4)==="data"&&NVe.test(t)){if(t.charAt(4)==="-"){let i=t.slice(5).replace(coe,HVe);n="data"+i.charAt(0).toUpperCase()+i.slice(1)}else{let i=t.slice(4);if(!coe.test(i)){let a=i.replace(UVe,zVe);a.charAt(0)!=="-"&&(a="-"+a),t="data"+a}}o=tS}return new o(n,t)}function zVe(e){return"-"+e.toLowerCase()}function HVe(e){return e.charAt(1).toUpperCase()}var moe=Z5([Y5,loe,K5,J5,$5],"html"),FM=Z5([Y5,uoe,K5,J5,$5],"svg");function doe(e){return e.join(" ").trim()}var _oe=_t(Ioe(),1);var VM=Aoe("end"),Nv=Aoe("start");function Aoe(e){return t;function t(r){let n=r&&r.position&&r.position[e]||{};if(typeof n.line=="number"&&n.line>0&&typeof n.column=="number"&&n.column>0)return{line:n.line,column:n.column,offset:typeof n.offset=="number"&&n.offset>-1?n.offset:void 0}}}function oz(e){let t=Nv(e),r=VM(e);if(t&&r)return{start:t,end:r}}function Mx(e){return!e||typeof e!="object"?"":"position"in e||"type"in e?Toe(e.position):"start"in e||"end"in e?Toe(e):"line"in e||"column"in e?iz(e):""}function iz(e){return Poe(e&&e.line)+":"+Poe(e&&e.column)}function Toe(e){return iz(e&&e.start)+"-"+iz(e&&e.end)}function Poe(e){return e&&typeof e=="number"?e:1}var Vs=class extends Error{constructor(t,r,n){super(),typeof r=="string"&&(n=r,r=void 0);let o="",i={},a=!1;if(r&&("line"in r&&"column"in r?i={place:r}:"start"in r&&"end"in r?i={place:r}:"type"in r?i={ancestors:[r],place:r.position}:i={...r}),typeof t=="string"?o=t:!i.cause&&t&&(a=!0,o=t.message,i.cause=t),!i.ruleId&&!i.source&&typeof n=="string"){let l=n.indexOf(":");l===-1?i.ruleId=n:(i.source=n.slice(0,l),i.ruleId=n.slice(l+1))}if(!i.place&&i.ancestors&&i.ancestors){let l=i.ancestors[i.ancestors.length-1];l&&(i.place=l.position)}let s=i.place&&"start"in i.place?i.place.start:i.place;this.ancestors=i.ancestors||void 0,this.cause=i.cause||void 0,this.column=s?s.column:void 0,this.fatal=void 0,this.file="",this.message=o,this.line=s?s.line:void 0,this.name=Mx(i.place)||"1:1",this.place=i.place||void 0,this.reason=this.message,this.ruleId=i.ruleId||void 0,this.source=i.source||void 0,this.stack=a&&i.cause&&typeof i.cause.stack=="string"?i.cause.stack:"",this.actual=void 0,this.expected=void 0,this.note=void 0,this.url=void 0}};Vs.prototype.file="";Vs.prototype.name="";Vs.prototype.reason="";Vs.prototype.message="";Vs.prototype.stack="";Vs.prototype.column=void 0;Vs.prototype.line=void 0;Vs.prototype.ancestors=void 0;Vs.prototype.cause=void 0;Vs.prototype.fatal=void 0;Vs.prototype.place=void 0;Vs.prototype.ruleId=void 0;Vs.prototype.source=void 0;var az={}.hasOwnProperty,hOe=new Map,gOe=/[A-Z]/g,yOe=new Set(["table","tbody","thead","tfoot","tr"]),bOe=new Set(["td","th"]),Roe="https://github.com/syntax-tree/hast-util-to-jsx-runtime";function sz(e,t){if(!t||t.Fragment===void 0)throw new TypeError("Expected `Fragment` in options");let r=t.filePath||void 0,n;if(t.development){if(typeof t.jsxDEV!="function")throw new TypeError("Expected `jsxDEV` in options when `development: true`");n=POe(r,t.jsxDEV)}else{if(typeof t.jsx!="function")throw new TypeError("Expected `jsx` in production options");if(typeof t.jsxs!="function")throw new TypeError("Expected `jsxs` in production options");n=TOe(r,t.jsx,t.jsxs)}let o={Fragment:t.Fragment,ancestors:[],components:t.components||{},create:n,elementAttributeNameCase:t.elementAttributeNameCase||"react",evaluater:t.createEvaluater?t.createEvaluater():void 0,filePath:r,ignoreInvalidStyle:t.ignoreInvalidStyle||!1,passKeys:t.passKeys!==!1,passNode:t.passNode||!1,schema:t.space==="svg"?FM:moe,stylePropertyNameCase:t.stylePropertyNameCase||"dom",tableCellAlignToStyle:t.tableCellAlignToStyle!==!1},i=Doe(o,e,void 0);return i&&typeof i!="string"?i:o.create(e,o.Fragment,{children:i||void 0},void 0)}function Doe(e,t,r){if(t.type==="element")return xOe(e,t,r);if(t.type==="mdxFlowExpression"||t.type==="mdxTextExpression")return COe(e,t);if(t.type==="mdxJsxFlowElement"||t.type==="mdxJsxTextElement")return vOe(e,t,r);if(t.type==="mdxjsEsm")return SOe(e,t);if(t.type==="root")return IOe(e,t,r);if(t.type==="text")return AOe(e,t)}function xOe(e,t,r){let n=e.schema,o=n;t.tagName.toLowerCase()==="svg"&&n.space==="html"&&(o=FM,e.schema=o),e.ancestors.push(t);let i=Moe(e,t.tagName,!1),a=_Oe(e,t),s=uz(e,t);return yOe.has(t.tagName)&&(s=s.filter(function(l){return typeof l=="string"?!Q5(l):!0})),woe(e,a,i,t),lz(a,s),e.ancestors.pop(),e.schema=n,e.create(t,i,a,r)}function COe(e,t){if(t.data&&t.data.estree&&e.evaluater){let n=t.data.estree.body[0];return n.type,e.evaluater.evaluateExpression(n.expression)}Q2(e,t.position)}function SOe(e,t){if(t.data&&t.data.estree&&e.evaluater)return e.evaluater.evaluateProgram(t.data.estree);Q2(e,t.position)}function vOe(e,t,r){let n=e.schema,o=n;t.name==="svg"&&n.space==="html"&&(o=FM,e.schema=o),e.ancestors.push(t);let i=t.name===null?e.Fragment:Moe(e,t.name,!0),a=ROe(e,t),s=uz(e,t);return woe(e,a,i,t),lz(a,s),e.ancestors.pop(),e.schema=n,e.create(t,i,a,r)}function IOe(e,t,r){let n={};return lz(n,uz(e,t)),e.create(t,e.Fragment,n,r)}function AOe(e,t){return t.value}function woe(e,t,r,n){typeof r!="string"&&r!==e.Fragment&&e.passNode&&(t.node=n)}function lz(e,t){if(t.length>0){let r=t.length>1?t:t[0];r&&(e.children=r)}}function TOe(e,t,r){return n;function n(o,i,a,s){let u=Array.isArray(a.children)?r:t;return s?u(i,a,s):u(i,a)}}function POe(e,t){return r;function r(n,o,i,a){let s=Array.isArray(i.children),l=Nv(n);return t(o,i,a,s,{columnNumber:l?l.column-1:void 0,fileName:e,lineNumber:l?l.line:void 0},void 0)}}function _Oe(e,t){let r={},n,o;for(o in t.properties)if(o!=="children"&&az.call(t.properties,o)){let i=DOe(e,o,t.properties[o]);if(i){let[a,s]=i;e.tableCellAlignToStyle&&a==="align"&&typeof s=="string"&&bOe.has(t.tagName)?n=s:r[a]=s}}if(n){let i=r.style||(r.style={});i[e.stylePropertyNameCase==="css"?"text-align":"textAlign"]=n}return r}function ROe(e,t){let r={};for(let n of t.attributes)if(n.type==="mdxJsxExpressionAttribute")if(n.data&&n.data.estree&&e.evaluater){let i=n.data.estree.body[0];i.type;let a=i.expression;a.type;let s=a.properties[0];s.type,Object.assign(r,e.evaluater.evaluateExpression(s.argument))}else Q2(e,t.position);else{let o=n.name,i;if(n.value&&typeof n.value=="object")if(n.value.data&&n.value.data.estree&&e.evaluater){let s=n.value.data.estree.body[0];s.type,i=e.evaluater.evaluateExpression(s.expression)}else Q2(e,t.position);else i=n.value===null?!0:n.value;r[o]=i}return r}function uz(e,t){let r=[],n=-1,o=e.passKeys?new Map:hOe;for(;++n<t.children.length;){let i=t.children[n],a;if(e.passKeys){let l=i.type==="element"?i.tagName:i.type==="mdxJsxFlowElement"||i.type==="mdxJsxTextElement"?i.name:void 0;if(l){let u=o.get(l)||0;a=l+"-"+u,o.set(l,u+1)}}let s=Doe(e,i,a);s!==void 0&&r.push(s)}return r}function DOe(e,t,r){let n=tz(e.schema,t);if(!(r==null||typeof r=="number"&&Number.isNaN(r))){if(Array.isArray(r)&&(r=n.commaSeparated?ioe(r):doe(r)),n.property==="style"){let o=typeof r=="object"?r:wOe(e,String(r));return e.stylePropertyNameCase==="css"&&(o=MOe(o)),["style",o]}return[e.elementAttributeNameCase==="react"&&n.space?ez[n.property]||n.property:n.attribute,r]}}function wOe(e,t){try{return(0,_oe.default)(t,{reactCompat:!0})}catch(r){if(e.ignoreInvalidStyle)return{};let n=r,o=new Vs("Cannot parse `style` attribute",{ancestors:e.ancestors,cause:n,ruleId:"style",source:"hast-util-to-jsx-runtime"});throw o.file=e.filePath||void 0,o.url=Roe+"#cannot-parse-style-attribute",o}}function Moe(e,t,r){let n;if(!r)n={type:"Literal",value:t};else if(t.includes(".")){let o=t.split("."),i=-1,a;for(;++i<o.length;){let s=MM(o[i])?{type:"Identifier",name:o[i]}:{type:"Literal",value:o[i]};a=a?{type:"MemberExpression",object:a,property:s,computed:!!(i&&s.type==="Literal"),optional:!1}:s}n=a}else n=MM(t)&&!/^[a-z]/.test(t)?{type:"Identifier",name:t}:{type:"Literal",value:t};if(n.type==="Literal"){let o=n.value;return az.call(e.components,o)?e.components[o]:o}if(e.evaluater)return e.evaluater.evaluateExpression(n);Q2(e)}function Q2(e,t){let r=new Vs("Cannot handle MDX estrees without `createEvaluater`",{ancestors:e.ancestors,place:t,ruleId:"mdx-estree",source:"hast-util-to-jsx-runtime"});throw r.file=e.filePath||void 0,r.url=Roe+"#cannot-handle-mdx-estrees-without-createevaluater",r}function MOe(e){let t={},r;for(r in e)az.call(e,r)&&(t[BOe(r)]=e[r]);return t}function BOe(e){let t=e.replace(gOe,EOe);return t.slice(0,3)==="ms-"&&(t="-"+t),t}function EOe(e){return"-"+e.toLowerCase()}var Z2={action:["form"],cite:["blockquote","del","ins","q"],data:["object"],formAction:["button","input"],href:["a","area","base","link"],icon:["menuitem"],itemId:null,manifest:["html"],ping:["a","area"],poster:["video"],src:["audio","embed","iframe","img","input","script","source","track","video"]};var Xv=_t(ur(),1),nae=_t(Mi(),1);var kOe={};function nS(e,t){let r=t||kOe,n=typeof r.includeImageAlt=="boolean"?r.includeImageAlt:!0,o=typeof r.includeHtml=="boolean"?r.includeHtml:!0;return Eoe(e,n,o)}function Eoe(e,t,r){if(FOe(e)){if("value"in e)return e.type==="html"&&!r?"":e.value;if(t&&"alt"in e&&e.alt)return e.alt;if("children"in e)return Boe(e.children,t,r)}return Array.isArray(e)?Boe(e,t,r):""}function Boe(e,t,r){let n=[],o=-1;for(;++o<e.length;)n[o]=Eoe(e[o],t,r);return n.join("")}function FOe(e){return!!(e&&typeof e=="object")}var koe=document.createElement("i");function zv(e){let t="&"+e+";";koe.innerHTML=t;let r=koe.textContent;return r.charCodeAt(r.length-1)===59&&e!=="semi"||r===t?!1:r}function Os(e,t,r,n){let o=e.length,i=0,a;if(t<0?t=-t>o?0:o+t:t=t>o?o:t,r=r>0?r:0,n.length<1e4)a=Array.from(n),a.unshift(t,r),e.splice(...a);else for(r&&e.splice(t,r);i<n.length;)a=n.slice(i,i+1e4),a.unshift(t,0),e.splice(...a),i+=1e4,t+=1e4}function Fc(e,t){return e.length>0?(Os(e,e.length,0,t),e):t}var Foe={}.hasOwnProperty;function OM(e){let t={},r=-1;for(;++r<e.length;)LOe(t,e[r]);return t}function LOe(e,t){let r;for(r in t){let o=(Foe.call(e,r)?e[r]:void 0)||(e[r]={}),i=t[r],a;if(i)for(a in i){Foe.call(o,a)||(o[a]=[]);let s=i[a];VOe(o[a],Array.isArray(s)?s:s?[s]:[])}}}function VOe(e,t){let r=-1,n=[];for(;++r<t.length;)(t[r].add==="after"?e:n).push(t[r]);Os(e,0,0,n)}function GM(e,t){let r=Number.parseInt(e,t);return r<9||r===11||r>13&&r<32||r>126&&r<160||r>55295&&r<57344||r>64975&&r<65008||(r&65535)===65535||(r&65535)===65534||r>1114111?"\uFFFD":String.fromCodePoint(r)}function rc(e){return e.replace(/[\t\n\r ]+/g," ").replace(/^ | $/g,"").toLowerCase().toUpperCase()}var Tl=Bx(/[A-Za-z]/),gs=Bx(/[\dA-Za-z]/),Loe=Bx(/[#-'*+\--9=?A-Z^-~]/);function oS(e){return e!==null&&(e<32||e===127)}var q2=Bx(/\d/),Voe=Bx(/[\dA-Fa-f]/),Ooe=Bx(/[!-/:-@[-`{-~]/);function Ar(e){return e!==null&&e<-2}function xo(e){return e!==null&&(e<0||e===32)}function xn(e){return e===-2||e===-1||e===32}var iS=Bx(/\p{P}|\p{S}/u),Nh=Bx(/\s/);function Bx(e){return t;function t(r){return r!==null&&r>-1&&e.test(String.fromCharCode(r))}}function sp(e){let t=[],r=-1,n=0,o=0;for(;++r<e.length;){let i=e.charCodeAt(r),a="";if(i===37&&gs(e.charCodeAt(r+1))&&gs(e.charCodeAt(r+2)))o=2;else if(i<128)/[!#$&-;=?-Z_a-z~]/.test(String.fromCharCode(i))||(a=String.fromCharCode(i));else if(i>55295&&i<57344){let s=e.charCodeAt(r+1);i<56320&&s>56319&&s<57344?(a=String.fromCharCode(i,s),o=1):a="\uFFFD"}else a=String.fromCharCode(i);a&&(t.push(e.slice(n,r),encodeURIComponent(a)),n=r+o+1,a=""),o&&(r+=o,o=0)}return t.join("")+e.slice(n)}function hn(e,t,r,n){let o=n?n-1:Number.POSITIVE_INFINITY,i=0;return a;function a(l){return xn(l)?(e.enter(r),s(l)):t(l)}function s(l){return xn(l)&&i++<o?(e.consume(l),s):(e.exit(r),t(l))}}var Goe={tokenize:OOe};function OOe(e){let t=e.attempt(this.parser.constructs.contentInitial,n,o),r;return t;function n(s){if(s===null){e.consume(s);return}return e.enter("lineEnding"),e.consume(s),e.exit("lineEnding"),hn(e,t,"linePrefix")}function o(s){return e.enter("paragraph"),i(s)}function i(s){let l=e.enter("chunkText",{contentType:"text",previous:r});return r&&(r.next=l),r=l,a(s)}function a(s){if(s===null){e.exit("chunkText"),e.exit("paragraph"),e.consume(s);return}return Ar(s)?(e.consume(s),e.exit("chunkText"),i):(e.consume(s),a)}}var Noe={tokenize:GOe},Uoe={tokenize:UOe};function GOe(e){let t=this,r=[],n=0,o,i,a;return s;function s(S){if(n<r.length){let I=r[n];return t.containerState=I[1],e.attempt(I[0].continuation,l,u)(S)}return u(S)}function l(S){if(n++,t.containerState._closeFlow){t.containerState._closeFlow=void 0,o&&x();let I=t.events.length,v=I,A;for(;v--;)if(t.events[v][0]==="exit"&&t.events[v][1].type==="chunkFlow"){A=t.events[v][1].end;break}y(n);let P=I;for(;P<t.events.length;)t.events[P][1].end={...A},P++;return Os(t.events,v+1,0,t.events.slice(I)),t.events.length=P,u(S)}return s(S)}function u(S){if(n===r.length){if(!o)return d(S);if(o.currentConstruct&&o.currentConstruct.concrete)return h(S);t.interrupt=!!(o.currentConstruct&&!o._gfmTableDynamicInterruptHack)}return t.containerState={},e.check(Uoe,c,m)(S)}function c(S){return o&&x(),y(n),d(S)}function m(S){return t.parser.lazy[t.now().line]=n!==r.length,a=t.now().offset,h(S)}function d(S){return t.containerState={},e.attempt(Uoe,p,h)(S)}function p(S){return n++,r.push([t.currentConstruct,t.containerState]),d(S)}function h(S){if(S===null){o&&x(),y(0),e.consume(S);return}return o=o||t.parser.flow(t.now()),e.enter("chunkFlow",{_tokenizer:o,contentType:"flow",previous:i}),f(S)}function f(S){if(S===null){g(e.exit("chunkFlow"),!0),y(0),e.consume(S);return}return Ar(S)?(e.consume(S),g(e.exit("chunkFlow")),n=0,t.interrupt=void 0,s):(e.consume(S),f)}function g(S,I){let v=t.sliceStream(S);if(I&&v.push(null),S.previous=i,i&&(i.next=S),i=S,o.defineSkip(S.start),o.write(v),t.parser.lazy[S.start.line]){let A=o.events.length;for(;A--;)if(o.events[A][1].start.offset<a&&(!o.events[A][1].end||o.events[A][1].end.offset>a))return;let P=t.events.length,T=P,R,w;for(;T--;)if(t.events[T][0]==="exit"&&t.events[T][1].type==="chunkFlow"){if(R){w=t.events[T][1].end;break}R=!0}for(y(n),A=P;A<t.events.length;)t.events[A][1].end={...w},A++;Os(t.events,T+1,0,t.events.slice(P)),t.events.length=A}}function y(S){let I=r.length;for(;I-- >S;){let v=r[I];t.containerState=v[1],v[0].exit.call(t,e)}r.length=S}function x(){o.write([null]),i=void 0,o=void 0,t.containerState._closeFlow=void 0}}function UOe(e,t,r){return hn(e,e.attempt(this.parser.constructs.document,t,r),"linePrefix",this.parser.constructs.disable.null.includes("codeIndented")?void 0:4)}function Gy(e){if(e===null||xo(e)||Nh(e))return 1;if(iS(e))return 2}function Ex(e,t,r){let n=[],o=-1;for(;++o<e.length;){let i=e[o].resolveAll;i&&!n.includes(i)&&(t=i(t,r),n.push(i))}return t}var Y2={name:"attention",resolveAll:NOe,tokenize:zOe};function NOe(e,t){let r=-1,n,o,i,a,s,l,u,c;for(;++r<e.length;)if(e[r][0]==="enter"&&e[r][1].type==="attentionSequence"&&e[r][1]._close){for(n=r;n--;)if(e[n][0]==="exit"&&e[n][1].type==="attentionSequence"&&e[n][1]._open&&t.sliceSerialize(e[n][1]).charCodeAt(0)===t.sliceSerialize(e[r][1]).charCodeAt(0)){if((e[n][1]._close||e[r][1]._open)&&(e[r][1].end.offset-e[r][1].start.offset)%3&&!((e[n][1].end.offset-e[n][1].start.offset+e[r][1].end.offset-e[r][1].start.offset)%3))continue;l=e[n][1].end.offset-e[n][1].start.offset>1&&e[r][1].end.offset-e[r][1].start.offset>1?2:1;let m={...e[n][1].end},d={...e[r][1].start};zoe(m,-l),zoe(d,l),a={type:l>1?"strongSequence":"emphasisSequence",start:m,end:{...e[n][1].end}},s={type:l>1?"strongSequence":"emphasisSequence",start:{...e[r][1].start},end:d},i={type:l>1?"strongText":"emphasisText",start:{...e[n][1].end},end:{...e[r][1].start}},o={type:l>1?"strong":"emphasis",start:{...a.start},end:{...s.end}},e[n][1].end={...a.start},e[r][1].start={...s.end},u=[],e[n][1].end.offset-e[n][1].start.offset&&(u=Fc(u,[["enter",e[n][1],t],["exit",e[n][1],t]])),u=Fc(u,[["enter",o,t],["enter",a,t],["exit",a,t],["enter",i,t]]),u=Fc(u,Ex(t.parser.constructs.insideSpan.null,e.slice(n+1,r),t)),u=Fc(u,[["exit",i,t],["enter",s,t],["exit",s,t],["exit",o,t]]),e[r][1].end.offset-e[r][1].start.offset?(c=2,u=Fc(u,[["enter",e[r][1],t],["exit",e[r][1],t]])):c=0,Os(e,n-1,r-n+3,u),r=n+u.length-c-2;break}}for(r=-1;++r<e.length;)e[r][1].type==="attentionSequence"&&(e[r][1].type="data");return e}function zOe(e,t){let r=this.parser.constructs.attentionMarkers.null,n=this.previous,o=Gy(n),i;return a;function a(l){return i=l,e.enter("attentionSequence"),s(l)}function s(l){if(l===i)return e.consume(l),s;let u=e.exit("attentionSequence"),c=Gy(l),m=!c||c===2&&o||r.includes(l),d=!o||o===2&&c||r.includes(n);return u._open=!!(i===42?m:m&&(o||!d)),u._close=!!(i===42?d:d&&(c||!m)),t(l)}}function zoe(e,t){e.column+=t,e.offset+=t,e._bufferIndex+=t}var cz={name:"autolink",tokenize:HOe};function HOe(e,t,r){let n=0;return o;function o(p){return e.enter("autolink"),e.enter("autolinkMarker"),e.consume(p),e.exit("autolinkMarker"),e.enter("autolinkProtocol"),i}function i(p){return Tl(p)?(e.consume(p),a):p===64?r(p):u(p)}function a(p){return p===43||p===45||p===46||gs(p)?(n=1,s(p)):u(p)}function s(p){return p===58?(e.consume(p),n=0,l):(p===43||p===45||p===46||gs(p))&&n++<32?(e.consume(p),s):(n=0,u(p))}function l(p){return p===62?(e.exit("autolinkProtocol"),e.enter("autolinkMarker"),e.consume(p),e.exit("autolinkMarker"),e.exit("autolink"),t):p===null||p===32||p===60||oS(p)?r(p):(e.consume(p),l)}function u(p){return p===64?(e.consume(p),c):Loe(p)?(e.consume(p),u):r(p)}function c(p){return gs(p)?m(p):r(p)}function m(p){return p===46?(e.consume(p),n=0,c):p===62?(e.exit("autolinkProtocol").type="autolinkEmail",e.enter("autolinkMarker"),e.consume(p),e.exit("autolinkMarker"),e.exit("autolink"),t):d(p)}function d(p){if((p===45||gs(p))&&n++<63){let h=p===45?d:m;return e.consume(p),h}return r(p)}}var zh={partial:!0,tokenize:jOe};function jOe(e,t,r){return n;function n(i){return xn(i)?hn(e,o,"linePrefix")(i):o(i)}function o(i){return i===null||Ar(i)?t(i):r(i)}}var UM={continuation:{tokenize:XOe},exit:QOe,name:"blockQuote",tokenize:WOe};function WOe(e,t,r){let n=this;return o;function o(a){if(a===62){let s=n.containerState;return s.open||(e.enter("blockQuote",{_container:!0}),s.open=!0),e.enter("blockQuotePrefix"),e.enter("blockQuoteMarker"),e.consume(a),e.exit("blockQuoteMarker"),i}return r(a)}function i(a){return xn(a)?(e.enter("blockQuotePrefixWhitespace"),e.consume(a),e.exit("blockQuotePrefixWhitespace"),e.exit("blockQuotePrefix"),t):(e.exit("blockQuotePrefix"),t(a))}}function XOe(e,t,r){let n=this;return o;function o(a){return xn(a)?hn(e,i,"linePrefix",n.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(a):i(a)}function i(a){return e.attempt(UM,t,r)(a)}}function QOe(e){e.exit("blockQuote")}var NM={name:"characterEscape",tokenize:ZOe};function ZOe(e,t,r){return n;function n(i){return e.enter("characterEscape"),e.enter("escapeMarker"),e.consume(i),e.exit("escapeMarker"),o}function o(i){return Ooe(i)?(e.enter("characterEscapeValue"),e.consume(i),e.exit("characterEscapeValue"),e.exit("characterEscape"),t):r(i)}}var zM={name:"characterReference",tokenize:qOe};function qOe(e,t,r){let n=this,o=0,i,a;return s;function s(m){return e.enter("characterReference"),e.enter("characterReferenceMarker"),e.consume(m),e.exit("characterReferenceMarker"),l}function l(m){return m===35?(e.enter("characterReferenceMarkerNumeric"),e.consume(m),e.exit("characterReferenceMarkerNumeric"),u):(e.enter("characterReferenceValue"),i=31,a=gs,c(m))}function u(m){return m===88||m===120?(e.enter("characterReferenceMarkerHexadecimal"),e.consume(m),e.exit("characterReferenceMarkerHexadecimal"),e.enter("characterReferenceValue"),i=6,a=Voe,c):(e.enter("characterReferenceValue"),i=7,a=q2,c(m))}function c(m){if(m===59&&o){let d=e.exit("characterReferenceValue");return a===gs&&!zv(n.sliceSerialize(d))?r(m):(e.enter("characterReferenceMarker"),e.consume(m),e.exit("characterReferenceMarker"),e.exit("characterReference"),t)}return a(m)&&o++<i?(e.consume(m),c):r(m)}}var Hoe={partial:!0,tokenize:KOe},HM={concrete:!0,name:"codeFenced",tokenize:YOe};function YOe(e,t,r){let n=this,o={partial:!0,tokenize:v},i=0,a=0,s;return l;function l(A){return u(A)}function u(A){let P=n.events[n.events.length-1];return i=P&&P[1].type==="linePrefix"?P[2].sliceSerialize(P[1],!0).length:0,s=A,e.enter("codeFenced"),e.enter("codeFencedFence"),e.enter("codeFencedFenceSequence"),c(A)}function c(A){return A===s?(a++,e.consume(A),c):a<3?r(A):(e.exit("codeFencedFenceSequence"),xn(A)?hn(e,m,"whitespace")(A):m(A))}function m(A){return A===null||Ar(A)?(e.exit("codeFencedFence"),n.interrupt?t(A):e.check(Hoe,f,I)(A)):(e.enter("codeFencedFenceInfo"),e.enter("chunkString",{contentType:"string"}),d(A))}function d(A){return A===null||Ar(A)?(e.exit("chunkString"),e.exit("codeFencedFenceInfo"),m(A)):xn(A)?(e.exit("chunkString"),e.exit("codeFencedFenceInfo"),hn(e,p,"whitespace")(A)):A===96&&A===s?r(A):(e.consume(A),d)}function p(A){return A===null||Ar(A)?m(A):(e.enter("codeFencedFenceMeta"),e.enter("chunkString",{contentType:"string"}),h(A))}function h(A){return A===null||Ar(A)?(e.exit("chunkString"),e.exit("codeFencedFenceMeta"),m(A)):A===96&&A===s?r(A):(e.consume(A),h)}function f(A){return e.attempt(o,I,g)(A)}function g(A){return e.enter("lineEnding"),e.consume(A),e.exit("lineEnding"),y}function y(A){return i>0&&xn(A)?hn(e,x,"linePrefix",i+1)(A):x(A)}function x(A){return A===null||Ar(A)?e.check(Hoe,f,I)(A):(e.enter("codeFlowValue"),S(A))}function S(A){return A===null||Ar(A)?(e.exit("codeFlowValue"),x(A)):(e.consume(A),S)}function I(A){return e.exit("codeFenced"),t(A)}function v(A,P,T){let R=0;return w;function w(k){return A.enter("lineEnding"),A.consume(k),A.exit("lineEnding"),E}function E(k){return A.enter("codeFencedFence"),xn(k)?hn(A,M,"linePrefix",n.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(k):M(k)}function M(k){return k===s?(A.enter("codeFencedFenceSequence"),D(k)):T(k)}function D(k){return k===s?(R++,A.consume(k),D):R>=a?(A.exit("codeFencedFenceSequence"),xn(k)?hn(A,B,"whitespace")(k):B(k)):T(k)}function B(k){return k===null||Ar(k)?(A.exit("codeFencedFence"),P(k)):T(k)}}}function KOe(e,t,r){let n=this;return o;function o(a){return a===null?r(a):(e.enter("lineEnding"),e.consume(a),e.exit("lineEnding"),i)}function i(a){return n.parser.lazy[n.now().line]?r(a):t(a)}}var K2={name:"codeIndented",tokenize:$Oe},JOe={partial:!0,tokenize:e4e};function $Oe(e,t,r){let n=this;return o;function o(u){return e.enter("codeIndented"),hn(e,i,"linePrefix",5)(u)}function i(u){let c=n.events[n.events.length-1];return c&&c[1].type==="linePrefix"&&c[2].sliceSerialize(c[1],!0).length>=4?a(u):r(u)}function a(u){return u===null?l(u):Ar(u)?e.attempt(JOe,a,l)(u):(e.enter("codeFlowValue"),s(u))}function s(u){return u===null||Ar(u)?(e.exit("codeFlowValue"),a(u)):(e.consume(u),s)}function l(u){return e.exit("codeIndented"),t(u)}}function e4e(e,t,r){let n=this;return o;function o(a){return n.parser.lazy[n.now().line]?r(a):Ar(a)?(e.enter("lineEnding"),e.consume(a),e.exit("lineEnding"),o):hn(e,i,"linePrefix",5)(a)}function i(a){let s=n.events[n.events.length-1];return s&&s[1].type==="linePrefix"&&s[2].sliceSerialize(s[1],!0).length>=4?t(a):Ar(a)?o(a):r(a)}}var mz={name:"codeText",previous:r4e,resolve:t4e,tokenize:n4e};function t4e(e){let t=e.length-4,r=3,n,o;if((e[r][1].type==="lineEnding"||e[r][1].type==="space")&&(e[t][1].type==="lineEnding"||e[t][1].type==="space")){for(n=r;++n<t;)if(e[n][1].type==="codeTextData"){e[r][1].type="codeTextPadding",e[t][1].type="codeTextPadding",r+=2,t-=2;break}}for(n=r-1,t++;++n<=t;)o===void 0?n!==t&&e[n][1].type!=="lineEnding"&&(o=n):(n===t||e[n][1].type==="lineEnding")&&(e[o][1].type="codeTextData",n!==o+2&&(e[o][1].end=e[n-1][1].end,e.splice(o+2,n-o-2),t-=n-o-2,n=o+2),o=void 0);return e}function r4e(e){return e!==96||this.events[this.events.length-1][1].type==="characterEscape"}function n4e(e,t,r){let n=this,o=0,i,a;return s;function s(d){return e.enter("codeText"),e.enter("codeTextSequence"),l(d)}function l(d){return d===96?(e.consume(d),o++,l):(e.exit("codeTextSequence"),u(d))}function u(d){return d===null?r(d):d===32?(e.enter("space"),e.consume(d),e.exit("space"),u):d===96?(a=e.enter("codeTextSequence"),i=0,m(d)):Ar(d)?(e.enter("lineEnding"),e.consume(d),e.exit("lineEnding"),u):(e.enter("codeTextData"),c(d))}function c(d){return d===null||d===32||d===96||Ar(d)?(e.exit("codeTextData"),u(d)):(e.consume(d),c)}function m(d){return d===96?(e.consume(d),i++,m):i===o?(e.exit("codeTextSequence"),e.exit("codeText"),t(d)):(a.type="codeTextData",c(d))}}var jM=class{constructor(t){this.left=t?[...t]:[],this.right=[]}get(t){if(t<0||t>=this.left.length+this.right.length)throw new RangeError("Cannot access index `"+t+"` in a splice buffer of size `"+(this.left.length+this.right.length)+"`");return t<this.left.length?this.left[t]:this.right[this.right.length-t+this.left.length-1]}get length(){return this.left.length+this.right.length}shift(){return this.setCursor(0),this.right.pop()}slice(t,r){let n=r??Number.POSITIVE_INFINITY;return n<this.left.length?this.left.slice(t,n):t>this.left.length?this.right.slice(this.right.length-n+this.left.length,this.right.length-t+this.left.length).reverse():this.left.slice(t).concat(this.right.slice(this.right.length-n+this.left.length).reverse())}splice(t,r,n){let o=r||0;this.setCursor(Math.trunc(t));let i=this.right.splice(this.right.length-o,Number.POSITIVE_INFINITY);return n&&J2(this.left,n),i.reverse()}pop(){return this.setCursor(Number.POSITIVE_INFINITY),this.left.pop()}push(t){this.setCursor(Number.POSITIVE_INFINITY),this.left.push(t)}pushMany(t){this.setCursor(Number.POSITIVE_INFINITY),J2(this.left,t)}unshift(t){this.setCursor(0),this.right.push(t)}unshiftMany(t){this.setCursor(0),J2(this.right,t.reverse())}setCursor(t){if(!(t===this.left.length||t>this.left.length&&this.right.length===0||t<0&&this.left.length===0))if(t<this.left.length){let r=this.left.splice(t,Number.POSITIVE_INFINITY);J2(this.right,r.reverse())}else{let r=this.right.splice(this.left.length+this.right.length-t,Number.POSITIVE_INFINITY);J2(this.left,r.reverse())}}};function J2(e,t){let r=0;if(t.length<1e4)e.push(...t);else for(;r<t.length;)e.push(...t.slice(r,r+1e4)),r+=1e4}function WM(e){let t={},r=-1,n,o,i,a,s,l,u,c=new jM(e);for(;++r<c.length;){for(;r in t;)r=t[r];if(n=c.get(r),r&&n[1].type==="chunkFlow"&&c.get(r-1)[1].type==="listItemPrefix"&&(l=n[1]._tokenizer.events,i=0,i<l.length&&l[i][1].type==="lineEndingBlank"&&(i+=2),i<l.length&&l[i][1].type==="content"))for(;++i<l.length&&l[i][1].type!=="content";)l[i][1].type==="chunkText"&&(l[i][1]._isInFirstContentOfListItem=!0,i++);if(n[0]==="enter")n[1].contentType&&(Object.assign(t,o4e(c,r)),r=t[r],u=!0);else if(n[1]._container){for(i=r,o=void 0;i--;)if(a=c.get(i),a[1].type==="lineEnding"||a[1].type==="lineEndingBlank")a[0]==="enter"&&(o&&(c.get(o)[1].type="lineEndingBlank"),a[1].type="lineEnding",o=i);else if(!(a[1].type==="linePrefix"||a[1].type==="listItemIndent"))break;o&&(n[1].end={...c.get(o)[1].start},s=c.slice(o,r),s.unshift(n),c.splice(o,r-o+1,s))}}return Os(e,0,Number.POSITIVE_INFINITY,c.slice(0)),!u}function o4e(e,t){let r=e.get(t)[1],n=e.get(t)[2],o=t-1,i=[],a=r._tokenizer;a||(a=n.parser[r.contentType](r.start),r._contentTypeTextTrailing&&(a._contentTypeTextTrailing=!0));let s=a.events,l=[],u={},c,m,d=-1,p=r,h=0,f=0,g=[f];for(;p;){for(;e.get(++o)[1]!==p;);i.push(o),p._tokenizer||(c=n.sliceStream(p),p.next||c.push(null),m&&a.defineSkip(p.start),p._isInFirstContentOfListItem&&(a._gfmTasklistFirstContentOfListItem=!0),a.write(c),p._isInFirstContentOfListItem&&(a._gfmTasklistFirstContentOfListItem=void 0)),m=p,p=p.next}for(p=r;++d<s.length;)s[d][0]==="exit"&&s[d-1][0]==="enter"&&s[d][1].type===s[d-1][1].type&&s[d][1].start.line!==s[d][1].end.line&&(f=d+1,g.push(f),p._tokenizer=void 0,p.previous=void 0,p=p.next);for(a.events=[],p?(p._tokenizer=void 0,p.previous=void 0):g.pop(),d=g.length;d--;){let y=s.slice(g[d],g[d+1]),x=i.pop();l.push([x,x+y.length-1]),e.splice(x,2,y)}for(l.reverse(),d=-1;++d<l.length;)u[h+l[d][0]]=h+l[d][1],h+=l[d][1]-l[d][0]-1;return u}var dz={resolve:a4e,tokenize:s4e},i4e={partial:!0,tokenize:l4e};function a4e(e){return WM(e),e}function s4e(e,t){let r;return n;function n(s){return e.enter("content"),r=e.enter("chunkContent",{contentType:"content"}),o(s)}function o(s){return s===null?i(s):Ar(s)?e.check(i4e,a,i)(s):(e.consume(s),o)}function i(s){return e.exit("chunkContent"),e.exit("content"),t(s)}function a(s){return e.consume(s),e.exit("chunkContent"),r.next=e.enter("chunkContent",{contentType:"content",previous:r}),r=r.next,o}}function l4e(e,t,r){let n=this;return o;function o(a){return e.exit("chunkContent"),e.enter("lineEnding"),e.consume(a),e.exit("lineEnding"),hn(e,i,"linePrefix")}function i(a){if(a===null||Ar(a))return r(a);let s=n.events[n.events.length-1];return!n.parser.constructs.disable.null.includes("codeIndented")&&s&&s[1].type==="linePrefix"&&s[2].sliceSerialize(s[1],!0).length>=4?t(a):e.interrupt(n.parser.constructs.flow,r,t)(a)}}function XM(e,t,r,n,o,i,a,s,l){let u=l||Number.POSITIVE_INFINITY,c=0;return m;function m(y){return y===60?(e.enter(n),e.enter(o),e.enter(i),e.consume(y),e.exit(i),d):y===null||y===32||y===41||oS(y)?r(y):(e.enter(n),e.enter(a),e.enter(s),e.enter("chunkString",{contentType:"string"}),f(y))}function d(y){return y===62?(e.enter(i),e.consume(y),e.exit(i),e.exit(o),e.exit(n),t):(e.enter(s),e.enter("chunkString",{contentType:"string"}),p(y))}function p(y){return y===62?(e.exit("chunkString"),e.exit(s),d(y)):y===null||y===60||Ar(y)?r(y):(e.consume(y),y===92?h:p)}function h(y){return y===60||y===62||y===92?(e.consume(y),p):p(y)}function f(y){return!c&&(y===null||y===41||xo(y))?(e.exit("chunkString"),e.exit(s),e.exit(a),e.exit(n),t(y)):c<u&&y===40?(e.consume(y),c++,f):y===41?(e.consume(y),c--,f):y===null||y===32||y===40||oS(y)?r(y):(e.consume(y),y===92?g:f)}function g(y){return y===40||y===41||y===92?(e.consume(y),f):f(y)}}function QM(e,t,r,n,o,i){let a=this,s=0,l;return u;function u(p){return e.enter(n),e.enter(o),e.consume(p),e.exit(o),e.enter(i),c}function c(p){return s>999||p===null||p===91||p===93&&!l||p===94&&!s&&"_hiddenFootnoteSupport"in a.parser.constructs?r(p):p===93?(e.exit(i),e.enter(o),e.consume(p),e.exit(o),e.exit(n),t):Ar(p)?(e.enter("lineEnding"),e.consume(p),e.exit("lineEnding"),c):(e.enter("chunkString",{contentType:"string"}),m(p))}function m(p){return p===null||p===91||p===93||Ar(p)||s++>999?(e.exit("chunkString"),c(p)):(e.consume(p),l||(l=!xn(p)),p===92?d:m)}function d(p){return p===91||p===92||p===93?(e.consume(p),s++,m):m(p)}}function ZM(e,t,r,n,o,i){let a;return s;function s(d){return d===34||d===39||d===40?(e.enter(n),e.enter(o),e.consume(d),e.exit(o),a=d===40?41:d,l):r(d)}function l(d){return d===a?(e.enter(o),e.consume(d),e.exit(o),e.exit(n),t):(e.enter(i),u(d))}function u(d){return d===a?(e.exit(i),l(a)):d===null?r(d):Ar(d)?(e.enter("lineEnding"),e.consume(d),e.exit("lineEnding"),hn(e,u,"linePrefix")):(e.enter("chunkString",{contentType:"string"}),c(d))}function c(d){return d===a||d===null||Ar(d)?(e.exit("chunkString"),u(d)):(e.consume(d),d===92?m:c)}function m(d){return d===a||d===92?(e.consume(d),c):c(d)}}function aS(e,t){let r;return n;function n(o){return Ar(o)?(e.enter("lineEnding"),e.consume(o),e.exit("lineEnding"),r=!0,n):xn(o)?hn(e,n,r?"linePrefix":"lineSuffix")(o):t(o)}}var pz={name:"definition",tokenize:c4e},u4e={partial:!0,tokenize:m4e};function c4e(e,t,r){let n=this,o;return i;function i(p){return e.enter("definition"),a(p)}function a(p){return QM.call(n,e,s,r,"definitionLabel","definitionLabelMarker","definitionLabelString")(p)}function s(p){return o=rc(n.sliceSerialize(n.events[n.events.length-1][1]).slice(1,-1)),p===58?(e.enter("definitionMarker"),e.consume(p),e.exit("definitionMarker"),l):r(p)}function l(p){return xo(p)?aS(e,u)(p):u(p)}function u(p){return XM(e,c,r,"definitionDestination","definitionDestinationLiteral","definitionDestinationLiteralMarker","definitionDestinationRaw","definitionDestinationString")(p)}function c(p){return e.attempt(u4e,m,m)(p)}function m(p){return xn(p)?hn(e,d,"whitespace")(p):d(p)}function d(p){return p===null||Ar(p)?(e.exit("definition"),n.parser.defined.push(o),t(p)):r(p)}}function m4e(e,t,r){return n;function n(s){return xo(s)?aS(e,o)(s):r(s)}function o(s){return ZM(e,i,r,"definitionTitle","definitionTitleMarker","definitionTitleString")(s)}function i(s){return xn(s)?hn(e,a,"whitespace")(s):a(s)}function a(s){return s===null||Ar(s)?t(s):r(s)}}var fz={name:"hardBreakEscape",tokenize:d4e};function d4e(e,t,r){return n;function n(i){return e.enter("hardBreakEscape"),e.consume(i),o}function o(i){return Ar(i)?(e.exit("hardBreakEscape"),t(i)):r(i)}}var hz={name:"headingAtx",resolve:p4e,tokenize:f4e};function p4e(e,t){let r=e.length-2,n=3,o,i;return e[n][1].type==="whitespace"&&(n+=2),r-2>n&&e[r][1].type==="whitespace"&&(r-=2),e[r][1].type==="atxHeadingSequence"&&(n===r-1||r-4>n&&e[r-2][1].type==="whitespace")&&(r-=n+1===r?2:4),r>n&&(o={type:"atxHeadingText",start:e[n][1].start,end:e[r][1].end},i={type:"chunkText",start:e[n][1].start,end:e[r][1].end,contentType:"text"},Os(e,n,r-n+1,[["enter",o,t],["enter",i,t],["exit",i,t],["exit",o,t]])),e}function f4e(e,t,r){let n=0;return o;function o(c){return e.enter("atxHeading"),i(c)}function i(c){return e.enter("atxHeadingSequence"),a(c)}function a(c){return c===35&&n++<6?(e.consume(c),a):c===null||xo(c)?(e.exit("atxHeadingSequence"),s(c)):r(c)}function s(c){return c===35?(e.enter("atxHeadingSequence"),l(c)):c===null||Ar(c)?(e.exit("atxHeading"),t(c)):xn(c)?hn(e,s,"whitespace")(c):(e.enter("atxHeadingText"),u(c))}function l(c){return c===35?(e.consume(c),l):(e.exit("atxHeadingSequence"),s(c))}function u(c){return c===null||c===35||xo(c)?(e.exit("atxHeadingText"),s(c)):(e.consume(c),u)}}var joe=["address","article","aside","base","basefont","blockquote","body","caption","center","col","colgroup","dd","details","dialog","dir","div","dl","dt","fieldset","figcaption","figure","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hr","html","iframe","legend","li","link","main","menu","menuitem","nav","noframes","ol","optgroup","option","p","param","search","section","summary","table","tbody","td","tfoot","th","thead","title","tr","track","ul"],gz=["pre","script","style","textarea"];var yz={concrete:!0,name:"htmlFlow",resolveTo:y4e,tokenize:b4e},h4e={partial:!0,tokenize:C4e},g4e={partial:!0,tokenize:x4e};function y4e(e){let t=e.length;for(;t--&&!(e[t][0]==="enter"&&e[t][1].type==="htmlFlow"););return t>1&&e[t-2][1].type==="linePrefix"&&(e[t][1].start=e[t-2][1].start,e[t+1][1].start=e[t-2][1].start,e.splice(t-2,2)),e}function b4e(e,t,r){let n=this,o,i,a,s,l;return u;function u(L){return c(L)}function c(L){return e.enter("htmlFlow"),e.enter("htmlFlowData"),e.consume(L),m}function m(L){return L===33?(e.consume(L),d):L===47?(e.consume(L),i=!0,f):L===63?(e.consume(L),o=3,n.interrupt?t:G):Tl(L)?(e.consume(L),a=String.fromCharCode(L),g):r(L)}function d(L){return L===45?(e.consume(L),o=2,p):L===91?(e.consume(L),o=5,s=0,h):Tl(L)?(e.consume(L),o=4,n.interrupt?t:G):r(L)}function p(L){return L===45?(e.consume(L),n.interrupt?t:G):r(L)}function h(L){let q="CDATA[";return L===q.charCodeAt(s++)?(e.consume(L),s===q.length?n.interrupt?t:M:h):r(L)}function f(L){return Tl(L)?(e.consume(L),a=String.fromCharCode(L),g):r(L)}function g(L){if(L===null||L===47||L===62||xo(L)){let q=L===47,te=a.toLowerCase();return!q&&!i&&gz.includes(te)?(o=1,n.interrupt?t(L):M(L)):joe.includes(a.toLowerCase())?(o=6,q?(e.consume(L),y):n.interrupt?t(L):M(L)):(o=7,n.interrupt&&!n.parser.lazy[n.now().line]?r(L):i?x(L):S(L))}return L===45||gs(L)?(e.consume(L),a+=String.fromCharCode(L),g):r(L)}function y(L){return L===62?(e.consume(L),n.interrupt?t:M):r(L)}function x(L){return xn(L)?(e.consume(L),x):w(L)}function S(L){return L===47?(e.consume(L),w):L===58||L===95||Tl(L)?(e.consume(L),I):xn(L)?(e.consume(L),S):w(L)}function I(L){return L===45||L===46||L===58||L===95||gs(L)?(e.consume(L),I):v(L)}function v(L){return L===61?(e.consume(L),A):xn(L)?(e.consume(L),v):S(L)}function A(L){return L===null||L===60||L===61||L===62||L===96?r(L):L===34||L===39?(e.consume(L),l=L,P):xn(L)?(e.consume(L),A):T(L)}function P(L){return L===l?(e.consume(L),l=null,R):L===null||Ar(L)?r(L):(e.consume(L),P)}function T(L){return L===null||L===34||L===39||L===47||L===60||L===61||L===62||L===96||xo(L)?v(L):(e.consume(L),T)}function R(L){return L===47||L===62||xn(L)?S(L):r(L)}function w(L){return L===62?(e.consume(L),E):r(L)}function E(L){return L===null||Ar(L)?M(L):xn(L)?(e.consume(L),E):r(L)}function M(L){return L===45&&o===2?(e.consume(L),F):L===60&&o===1?(e.consume(L),z):L===62&&o===4?(e.consume(L),X):L===63&&o===3?(e.consume(L),G):L===93&&o===5?(e.consume(L),Y):Ar(L)&&(o===6||o===7)?(e.exit("htmlFlowData"),e.check(h4e,U,D)(L)):L===null||Ar(L)?(e.exit("htmlFlowData"),D(L)):(e.consume(L),M)}function D(L){return e.check(g4e,B,U)(L)}function B(L){return e.enter("lineEnding"),e.consume(L),e.exit("lineEnding"),k}function k(L){return L===null||Ar(L)?D(L):(e.enter("htmlFlowData"),M(L))}function F(L){return L===45?(e.consume(L),G):M(L)}function z(L){return L===47?(e.consume(L),a="",j):M(L)}function j(L){if(L===62){let q=a.toLowerCase();return gz.includes(q)?(e.consume(L),X):M(L)}return Tl(L)&&a.length<8?(e.consume(L),a+=String.fromCharCode(L),j):M(L)}function Y(L){return L===93?(e.consume(L),G):M(L)}function G(L){return L===62?(e.consume(L),X):L===45&&o===2?(e.consume(L),G):M(L)}function X(L){return L===null||Ar(L)?(e.exit("htmlFlowData"),U(L)):(e.consume(L),X)}function U(L){return e.exit("htmlFlow"),t(L)}}function x4e(e,t,r){let n=this;return o;function o(a){return Ar(a)?(e.enter("lineEnding"),e.consume(a),e.exit("lineEnding"),i):r(a)}function i(a){return n.parser.lazy[n.now().line]?r(a):t(a)}}function C4e(e,t,r){return n;function n(o){return e.enter("lineEnding"),e.consume(o),e.exit("lineEnding"),e.attempt(zh,t,r)}}var bz={name:"htmlText",tokenize:S4e};function S4e(e,t,r){let n=this,o,i,a;return s;function s(G){return e.enter("htmlText"),e.enter("htmlTextData"),e.consume(G),l}function l(G){return G===33?(e.consume(G),u):G===47?(e.consume(G),v):G===63?(e.consume(G),S):Tl(G)?(e.consume(G),T):r(G)}function u(G){return G===45?(e.consume(G),c):G===91?(e.consume(G),i=0,h):Tl(G)?(e.consume(G),x):r(G)}function c(G){return G===45?(e.consume(G),p):r(G)}function m(G){return G===null?r(G):G===45?(e.consume(G),d):Ar(G)?(a=m,z(G)):(e.consume(G),m)}function d(G){return G===45?(e.consume(G),p):m(G)}function p(G){return G===62?F(G):G===45?d(G):m(G)}function h(G){let X="CDATA[";return G===X.charCodeAt(i++)?(e.consume(G),i===X.length?f:h):r(G)}function f(G){return G===null?r(G):G===93?(e.consume(G),g):Ar(G)?(a=f,z(G)):(e.consume(G),f)}function g(G){return G===93?(e.consume(G),y):f(G)}function y(G){return G===62?F(G):G===93?(e.consume(G),y):f(G)}function x(G){return G===null||G===62?F(G):Ar(G)?(a=x,z(G)):(e.consume(G),x)}function S(G){return G===null?r(G):G===63?(e.consume(G),I):Ar(G)?(a=S,z(G)):(e.consume(G),S)}function I(G){return G===62?F(G):S(G)}function v(G){return Tl(G)?(e.consume(G),A):r(G)}function A(G){return G===45||gs(G)?(e.consume(G),A):P(G)}function P(G){return Ar(G)?(a=P,z(G)):xn(G)?(e.consume(G),P):F(G)}function T(G){return G===45||gs(G)?(e.consume(G),T):G===47||G===62||xo(G)?R(G):r(G)}function R(G){return G===47?(e.consume(G),F):G===58||G===95||Tl(G)?(e.consume(G),w):Ar(G)?(a=R,z(G)):xn(G)?(e.consume(G),R):F(G)}function w(G){return G===45||G===46||G===58||G===95||gs(G)?(e.consume(G),w):E(G)}function E(G){return G===61?(e.consume(G),M):Ar(G)?(a=E,z(G)):xn(G)?(e.consume(G),E):R(G)}function M(G){return G===null||G===60||G===61||G===62||G===96?r(G):G===34||G===39?(e.consume(G),o=G,D):Ar(G)?(a=M,z(G)):xn(G)?(e.consume(G),M):(e.consume(G),B)}function D(G){return G===o?(e.consume(G),o=void 0,k):G===null?r(G):Ar(G)?(a=D,z(G)):(e.consume(G),D)}function B(G){return G===null||G===34||G===39||G===60||G===61||G===96?r(G):G===47||G===62||xo(G)?R(G):(e.consume(G),B)}function k(G){return G===47||G===62||xo(G)?R(G):r(G)}function F(G){return G===62?(e.consume(G),e.exit("htmlTextData"),e.exit("htmlText"),t):r(G)}function z(G){return e.exit("htmlTextData"),e.enter("lineEnding"),e.consume(G),e.exit("lineEnding"),j}function j(G){return xn(G)?hn(e,Y,"linePrefix",n.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(G):Y(G)}function Y(G){return e.enter("htmlTextData"),a(G)}}var sS={name:"labelEnd",resolveAll:T4e,resolveTo:P4e,tokenize:_4e},v4e={tokenize:R4e},I4e={tokenize:D4e},A4e={tokenize:w4e};function T4e(e){let t=-1,r=[];for(;++t<e.length;){let n=e[t][1];if(r.push(e[t]),n.type==="labelImage"||n.type==="labelLink"||n.type==="labelEnd"){let o=n.type==="labelImage"?4:2;n.type="data",t+=o}}return e.length!==r.length&&Os(e,0,e.length,r),e}function P4e(e,t){let r=e.length,n=0,o,i,a,s;for(;r--;)if(o=e[r][1],i){if(o.type==="link"||o.type==="labelLink"&&o._inactive)break;e[r][0]==="enter"&&o.type==="labelLink"&&(o._inactive=!0)}else if(a){if(e[r][0]==="enter"&&(o.type==="labelImage"||o.type==="labelLink")&&!o._balanced&&(i=r,o.type!=="labelLink")){n=2;break}}else o.type==="labelEnd"&&(a=r);let l={type:e[i][1].type==="labelLink"?"link":"image",start:{...e[i][1].start},end:{...e[e.length-1][1].end}},u={type:"label",start:{...e[i][1].start},end:{...e[a][1].end}},c={type:"labelText",start:{...e[i+n+2][1].end},end:{...e[a-2][1].start}};return s=[["enter",l,t],["enter",u,t]],s=Fc(s,e.slice(i+1,i+n+3)),s=Fc(s,[["enter",c,t]]),s=Fc(s,Ex(t.parser.constructs.insideSpan.null,e.slice(i+n+4,a-3),t)),s=Fc(s,[["exit",c,t],e[a-2],e[a-1],["exit",u,t]]),s=Fc(s,e.slice(a+1)),s=Fc(s,[["exit",l,t]]),Os(e,i,e.length,s),e}function _4e(e,t,r){let n=this,o=n.events.length,i,a;for(;o--;)if((n.events[o][1].type==="labelImage"||n.events[o][1].type==="labelLink")&&!n.events[o][1]._balanced){i=n.events[o][1];break}return s;function s(d){return i?i._inactive?m(d):(a=n.parser.defined.includes(rc(n.sliceSerialize({start:i.end,end:n.now()}))),e.enter("labelEnd"),e.enter("labelMarker"),e.consume(d),e.exit("labelMarker"),e.exit("labelEnd"),l):r(d)}function l(d){return d===40?e.attempt(v4e,c,a?c:m)(d):d===91?e.attempt(I4e,c,a?u:m)(d):a?c(d):m(d)}function u(d){return e.attempt(A4e,c,m)(d)}function c(d){return t(d)}function m(d){return i._balanced=!0,r(d)}}function R4e(e,t,r){return n;function n(m){return e.enter("resource"),e.enter("resourceMarker"),e.consume(m),e.exit("resourceMarker"),o}function o(m){return xo(m)?aS(e,i)(m):i(m)}function i(m){return m===41?c(m):XM(e,a,s,"resourceDestination","resourceDestinationLiteral","resourceDestinationLiteralMarker","resourceDestinationRaw","resourceDestinationString",32)(m)}function a(m){return xo(m)?aS(e,l)(m):c(m)}function s(m){return r(m)}function l(m){return m===34||m===39||m===40?ZM(e,u,r,"resourceTitle","resourceTitleMarker","resourceTitleString")(m):c(m)}function u(m){return xo(m)?aS(e,c)(m):c(m)}function c(m){return m===41?(e.enter("resourceMarker"),e.consume(m),e.exit("resourceMarker"),e.exit("resource"),t):r(m)}}function D4e(e,t,r){let n=this;return o;function o(s){return QM.call(n,e,i,a,"reference","referenceMarker","referenceString")(s)}function i(s){return n.parser.defined.includes(rc(n.sliceSerialize(n.events[n.events.length-1][1]).slice(1,-1)))?t(s):r(s)}function a(s){return r(s)}}function w4e(e,t,r){return n;function n(i){return e.enter("reference"),e.enter("referenceMarker"),e.consume(i),e.exit("referenceMarker"),o}function o(i){return i===93?(e.enter("referenceMarker"),e.consume(i),e.exit("referenceMarker"),e.exit("reference"),t):r(i)}}var xz={name:"labelStartImage",resolveAll:sS.resolveAll,tokenize:M4e};function M4e(e,t,r){let n=this;return o;function o(s){return e.enter("labelImage"),e.enter("labelImageMarker"),e.consume(s),e.exit("labelImageMarker"),i}function i(s){return s===91?(e.enter("labelMarker"),e.consume(s),e.exit("labelMarker"),e.exit("labelImage"),a):r(s)}function a(s){return s===94&&"_hiddenFootnoteSupport"in n.parser.constructs?r(s):t(s)}}var Cz={name:"labelStartLink",resolveAll:sS.resolveAll,tokenize:B4e};function B4e(e,t,r){let n=this;return o;function o(a){return e.enter("labelLink"),e.enter("labelMarker"),e.consume(a),e.exit("labelMarker"),e.exit("labelLink"),i}function i(a){return a===94&&"_hiddenFootnoteSupport"in n.parser.constructs?r(a):t(a)}}var $2={name:"lineEnding",tokenize:E4e};function E4e(e,t){return r;function r(n){return e.enter("lineEnding"),e.consume(n),e.exit("lineEnding"),hn(e,t,"linePrefix")}}var lS={name:"thematicBreak",tokenize:k4e};function k4e(e,t,r){let n=0,o;return i;function i(u){return e.enter("thematicBreak"),a(u)}function a(u){return o=u,s(u)}function s(u){return u===o?(e.enter("thematicBreakSequence"),l(u)):n>=3&&(u===null||Ar(u))?(e.exit("thematicBreak"),t(u)):r(u)}function l(u){return u===o?(e.consume(u),n++,l):(e.exit("thematicBreakSequence"),xn(u)?hn(e,s,"whitespace")(u):s(u))}}var nc={continuation:{tokenize:O4e},exit:U4e,name:"list",tokenize:V4e},F4e={partial:!0,tokenize:N4e},L4e={partial:!0,tokenize:G4e};function V4e(e,t,r){let n=this,o=n.events[n.events.length-1],i=o&&o[1].type==="linePrefix"?o[2].sliceSerialize(o[1],!0).length:0,a=0;return s;function s(p){let h=n.containerState.type||(p===42||p===43||p===45?"listUnordered":"listOrdered");if(h==="listUnordered"?!n.containerState.marker||p===n.containerState.marker:q2(p)){if(n.containerState.type||(n.containerState.type=h,e.enter(h,{_container:!0})),h==="listUnordered")return e.enter("listItemPrefix"),p===42||p===45?e.check(lS,r,u)(p):u(p);if(!n.interrupt||p===49)return e.enter("listItemPrefix"),e.enter("listItemValue"),l(p)}return r(p)}function l(p){return q2(p)&&++a<10?(e.consume(p),l):(!n.interrupt||a<2)&&(n.containerState.marker?p===n.containerState.marker:p===41||p===46)?(e.exit("listItemValue"),u(p)):r(p)}function u(p){return e.enter("listItemMarker"),e.consume(p),e.exit("listItemMarker"),n.containerState.marker=n.containerState.marker||p,e.check(zh,n.interrupt?r:c,e.attempt(F4e,d,m))}function c(p){return n.containerState.initialBlankLine=!0,i++,d(p)}function m(p){return xn(p)?(e.enter("listItemPrefixWhitespace"),e.consume(p),e.exit("listItemPrefixWhitespace"),d):r(p)}function d(p){return n.containerState.size=i+n.sliceSerialize(e.exit("listItemPrefix"),!0).length,t(p)}}function O4e(e,t,r){let n=this;return n.containerState._closeFlow=void 0,e.check(zh,o,i);function o(s){return n.containerState.furtherBlankLines=n.containerState.furtherBlankLines||n.containerState.initialBlankLine,hn(e,t,"listItemIndent",n.containerState.size+1)(s)}function i(s){return n.containerState.furtherBlankLines||!xn(s)?(n.containerState.furtherBlankLines=void 0,n.containerState.initialBlankLine=void 0,a(s)):(n.containerState.furtherBlankLines=void 0,n.containerState.initialBlankLine=void 0,e.attempt(L4e,t,a)(s))}function a(s){return n.containerState._closeFlow=!0,n.interrupt=void 0,hn(e,e.attempt(nc,t,r),"linePrefix",n.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(s)}}function G4e(e,t,r){let n=this;return hn(e,o,"listItemIndent",n.containerState.size+1);function o(i){let a=n.events[n.events.length-1];return a&&a[1].type==="listItemIndent"&&a[2].sliceSerialize(a[1],!0).length===n.containerState.size?t(i):r(i)}}function U4e(e){e.exit(this.containerState.type)}function N4e(e,t,r){let n=this;return hn(e,o,"listItemPrefixWhitespace",n.parser.constructs.disable.null.includes("codeIndented")?void 0:5);function o(i){let a=n.events[n.events.length-1];return!xn(i)&&a&&a[1].type==="listItemPrefixWhitespace"?t(i):r(i)}}var qM={name:"setextUnderline",resolveTo:z4e,tokenize:H4e};function z4e(e,t){let r=e.length,n,o,i;for(;r--;)if(e[r][0]==="enter"){if(e[r][1].type==="content"){n=r;break}e[r][1].type==="paragraph"&&(o=r)}else e[r][1].type==="content"&&e.splice(r,1),!i&&e[r][1].type==="definition"&&(i=r);let a={type:"setextHeading",start:{...e[n][1].start},end:{...e[e.length-1][1].end}};return e[o][1].type="setextHeadingText",i?(e.splice(o,0,["enter",a,t]),e.splice(i+1,0,["exit",e[n][1],t]),e[n][1].end={...e[i][1].end}):e[n][1]=a,e.push(["exit",a,t]),e}function H4e(e,t,r){let n=this,o;return i;function i(u){let c=n.events.length,m;for(;c--;)if(n.events[c][1].type!=="lineEnding"&&n.events[c][1].type!=="linePrefix"&&n.events[c][1].type!=="content"){m=n.events[c][1].type==="paragraph";break}return!n.parser.lazy[n.now().line]&&(n.interrupt||m)?(e.enter("setextHeadingLine"),o=u,a(u)):r(u)}function a(u){return e.enter("setextHeadingLineSequence"),s(u)}function s(u){return u===o?(e.consume(u),s):(e.exit("setextHeadingLineSequence"),xn(u)?hn(e,l,"lineSuffix")(u):l(u))}function l(u){return u===null||Ar(u)?(e.exit("setextHeadingLine"),t(u)):r(u)}}var Woe={tokenize:j4e};function j4e(e){let t=this,r=e.attempt(zh,n,e.attempt(this.parser.constructs.flowInitial,o,hn(e,e.attempt(this.parser.constructs.flow,o,e.attempt(dz,o)),"linePrefix")));return r;function n(i){if(i===null){e.consume(i);return}return e.enter("lineEndingBlank"),e.consume(i),e.exit("lineEndingBlank"),t.currentConstruct=void 0,r}function o(i){if(i===null){e.consume(i);return}return e.enter("lineEnding"),e.consume(i),e.exit("lineEnding"),t.currentConstruct=void 0,r}}var Xoe={resolveAll:Yoe()},Qoe=qoe("string"),Zoe=qoe("text");function qoe(e){return{resolveAll:Yoe(e==="text"?W4e:void 0),tokenize:t};function t(r){let n=this,o=this.parser.constructs[e],i=r.attempt(o,a,s);return a;function a(c){return u(c)?i(c):s(c)}function s(c){if(c===null){r.consume(c);return}return r.enter("data"),r.consume(c),l}function l(c){return u(c)?(r.exit("data"),i(c)):(r.consume(c),l)}function u(c){if(c===null)return!0;let m=o[c],d=-1;if(m)for(;++d<m.length;){let p=m[d];if(!p.previous||p.previous.call(n,n.previous))return!0}return!1}}}function Yoe(e){return t;function t(r,n){let o=-1,i;for(;++o<=r.length;)i===void 0?r[o]&&r[o][1].type==="data"&&(i=o,o++):(!r[o]||r[o][1].type!=="data")&&(o!==i+2&&(r[i][1].end=r[o-1][1].end,r.splice(i+2,o-i-2),o=i+2),i=void 0);return e?e(r,n):r}}function W4e(e,t){let r=0;for(;++r<=e.length;)if((r===e.length||e[r][1].type==="lineEnding")&&e[r-1][1].type==="data"){let n=e[r-1][1],o=t.sliceStream(n),i=o.length,a=-1,s=0,l;for(;i--;){let u=o[i];if(typeof u=="string"){for(a=u.length;u.charCodeAt(a-1)===32;)s++,a--;if(a)break;a=-1}else if(u===-2)l=!0,s++;else if(u!==-1){i++;break}}if(t._contentTypeTextTrailing&&r===e.length&&(s=0),s){let u={type:r===e.length||l||s<2?"lineSuffix":"hardBreakTrailing",start:{_bufferIndex:i?a:n.start._bufferIndex+a,_index:n.start._index+i,line:n.end.line,column:n.end.column-s,offset:n.end.offset-s},end:{...n.end}};n.end={...u.start},n.start.offset===n.end.offset?Object.assign(n,u):(e.splice(r,0,["enter",u,t],["exit",u,t]),r+=2)}r++}return e}var Sz={};Gi(Sz,{attentionMarkers:()=>$4e,contentInitial:()=>Q4e,disable:()=>eGe,document:()=>X4e,flow:()=>q4e,flowInitial:()=>Z4e,insideSpan:()=>J4e,string:()=>Y4e,text:()=>K4e});var X4e={42:nc,43:nc,45:nc,48:nc,49:nc,50:nc,51:nc,52:nc,53:nc,54:nc,55:nc,56:nc,57:nc,62:UM},Q4e={91:pz},Z4e={[-2]:K2,[-1]:K2,32:K2},q4e={35:hz,42:lS,45:[qM,lS],60:yz,61:qM,95:lS,96:HM,126:HM},Y4e={38:zM,92:NM},K4e={[-5]:$2,[-4]:$2,[-3]:$2,33:xz,38:zM,42:Y2,60:[cz,bz],91:Cz,92:[fz,NM],93:sS,95:Y2,96:mz},J4e={null:[Y2,Xoe]},$4e={null:[42,95]},eGe={null:[]};function Koe(e,t,r){let n={_bufferIndex:-1,_index:0,line:r&&r.line||1,column:r&&r.column||1,offset:r&&r.offset||0},o={},i=[],a=[],s=[],l=!0,u={attempt:R(P),check:R(T),consume:I,enter:v,exit:A,interrupt:R(T,{interrupt:!0})},c={code:null,containerState:{},defineSkip:y,events:[],now:g,parser:e,previous:null,sliceSerialize:h,sliceStream:f,write:p},m=t.tokenize.call(c,u),d;return t.resolveAll&&i.push(t),c;function p(D){return a=Fc(a,D),x(),a[a.length-1]!==null?[]:(w(t,0),c.events=Ex(i,c.events,c),c.events)}function h(D,B){return rGe(f(D),B)}function f(D){return tGe(a,D)}function g(){let{_bufferIndex:D,_index:B,line:k,column:F,offset:z}=n;return{_bufferIndex:D,_index:B,line:k,column:F,offset:z}}function y(D){o[D.line]=D.column,M()}function x(){let D;for(;n._index<a.length;){let B=a[n._index];if(typeof B=="string")for(D=n._index,n._bufferIndex<0&&(n._bufferIndex=0);n._index===D&&n._bufferIndex<B.length;)S(B.charCodeAt(n._bufferIndex));else S(B)}}function S(D){l=void 0,d=D,m=m(D)}function I(D){Ar(D)?(n.line++,n.column=1,n.offset+=D===-3?2:1,M()):D!==-1&&(n.column++,n.offset++),n._bufferIndex<0?n._index++:(n._bufferIndex++,n._bufferIndex===a[n._index].length&&(n._bufferIndex=-1,n._index++)),c.previous=D,l=!0}function v(D,B){let k=B||{};return k.type=D,k.start=g(),c.events.push(["enter",k,c]),s.push(k),k}function A(D){let B=s.pop();return B.end=g(),c.events.push(["exit",B,c]),B}function P(D,B){w(D,B.from)}function T(D,B){B.restore()}function R(D,B){return k;function k(F,z,j){let Y,G,X,U;return Array.isArray(F)?q(F):"tokenize"in F?q([F]):L(F);function L(ce){return fe;function fe(O){let V=O!==null&&ce[O],Z=O!==null&&ce.null,pe=[...Array.isArray(V)?V:V?[V]:[],...Array.isArray(Z)?Z:Z?[Z]:[]];return q(pe)(O)}}function q(ce){return Y=ce,G=0,ce.length===0?j:te(ce[G])}function te(ce){return fe;function fe(O){return U=E(),X=ce,ce.partial||(c.currentConstruct=ce),ce.name&&c.parser.constructs.disable.null.includes(ce.name)?ee(O):ce.tokenize.call(B?Object.assign(Object.create(c),B):c,u,J,ee)(O)}}function J(ce){return l=!0,D(X,U),z}function ee(ce){return l=!0,U.restore(),++G<Y.length?te(Y[G]):j}}}function w(D,B){D.resolveAll&&!i.includes(D)&&i.push(D),D.resolve&&Os(c.events,B,c.events.length-B,D.resolve(c.events.slice(B),c)),D.resolveTo&&(c.events=D.resolveTo(c.events,c))}function E(){let D=g(),B=c.previous,k=c.currentConstruct,F=c.events.length,z=Array.from(s);return{from:F,restore:j};function j(){n=D,c.previous=B,c.currentConstruct=k,c.events.length=F,s=z,M()}}function M(){n.line in o&&n.column<2&&(n.column=o[n.line],n.offset+=o[n.line]-1)}}function tGe(e,t){let r=t.start._index,n=t.start._bufferIndex,o=t.end._index,i=t.end._bufferIndex,a;if(r===o)a=[e[r].slice(n,i)];else{if(a=e.slice(r,o),n>-1){let s=a[0];typeof s=="string"?a[0]=s.slice(n):a.shift()}i>0&&a.push(e[o].slice(0,i))}return a}function rGe(e,t){let r=-1,n=[],o;for(;++r<e.length;){let i=e[r],a;if(typeof i=="string")a=i;else switch(i){case-5:{a="\r";break}case-4:{a=`
`;break}case-3:{a=`\r
`;break}case-2:{a=t?" ":"	";break}case-1:{if(!t&&o)continue;a=" ";break}default:a=String.fromCharCode(i)}o=i===-2,n.push(a)}return n.join("")}function vz(e){let n={constructs:OM([Sz,...(e||{}).extensions||[]]),content:o(Goe),defined:[],document:o(Noe),flow:o(Woe),lazy:{},string:o(Qoe),text:o(Zoe)};return n;function o(i){return a;function a(s){return Koe(n,i,s)}}}function Iz(e){for(;!WM(e););return e}var Joe=/[\0\t\n\r]/g;function Az(){let e=1,t="",r=!0,n;return o;function o(i,a,s){let l=[],u,c,m,d,p;for(i=t+(typeof i=="string"?i.toString():new TextDecoder(a||void 0).decode(i)),m=0,t="",r&&(i.charCodeAt(0)===65279&&m++,r=void 0);m<i.length;){if(Joe.lastIndex=m,u=Joe.exec(i),d=u&&u.index!==void 0?u.index:i.length,p=i.charCodeAt(d),!u){t=i.slice(m);break}if(p===10&&m===d&&n)l.push(-3),n=void 0;else switch(n&&(l.push(-5),n=void 0),m<d&&(l.push(i.slice(m,d)),e+=d-m),p){case 0:{l.push(65533),e++;break}case 9:{for(c=Math.ceil(e/4)*4,l.push(-2);e++<c;)l.push(-1);break}case 10:{l.push(-4),e=1;break}default:n=!0,e=1}m=d+1}return s&&(n&&l.push(-5),t&&l.push(t),l.push(null)),l}}var nGe=/\\([!-/:-@[-`{-~])|&(#(?:\d{1,7}|x[\da-f]{1,6})|[\da-z]{1,31});/gi;function $oe(e){return e.replace(nGe,oGe)}function oGe(e,t,r){if(t)return t;if(r.charCodeAt(0)===35){let o=r.charCodeAt(1),i=o===120||o===88;return GM(r.slice(i?2:1),i?16:10)}return zv(r)||e}var tie={}.hasOwnProperty;function Tz(e,t,r){return typeof t!="string"&&(r=t,t=void 0),iGe(r)(Iz(vz(r).document().write(Az()(e,t,!0))))}function iGe(e){let t={transforms:[],canContainEols:["emphasis","fragment","heading","paragraph","strong"],enter:{autolink:i(re),autolinkProtocol:R,autolinkEmail:R,atxHeading:i(ae),blockQuote:i(O),characterEscape:R,characterReference:R,codeFenced:i(V),codeFencedFenceInfo:a,codeFencedFenceMeta:a,codeIndented:i(V,a),codeText:i(Z,a),codeTextData:R,data:R,codeFlowValue:R,definition:i(pe),definitionDestinationString:a,definitionLabelString:a,definitionTitleString:a,emphasis:i($),hardBreakEscape:i(Se),hardBreakTrailing:i(Se),htmlFlow:i(ve,a),htmlFlowData:R,htmlText:i(ve,a),htmlTextData:R,image:i(K),label:a,link:i(re),listItem:i(ge),listItemValue:d,listOrdered:i(le,m),listUnordered:i(le),paragraph:i(Ee),reference:L,referenceString:a,resourceDestinationString:a,resourceTitleString:a,setextHeading:i(ae),strong:i(nt),thematicBreak:i(be)},exit:{atxHeading:l(),atxHeadingSequence:v,autolink:l(),autolinkEmail:fe,autolinkProtocol:ce,blockQuote:l(),characterEscapeValue:w,characterReferenceMarkerHexadecimal:te,characterReferenceMarkerNumeric:te,characterReferenceValue:J,characterReference:ee,codeFenced:l(g),codeFencedFence:f,codeFencedFenceInfo:p,codeFencedFenceMeta:h,codeFlowValue:w,codeIndented:l(y),codeText:l(k),codeTextData:w,data:w,definition:l(),definitionDestinationString:I,definitionLabelString:x,definitionTitleString:S,emphasis:l(),hardBreakEscape:l(M),hardBreakTrailing:l(M),htmlFlow:l(D),htmlFlowData:w,htmlText:l(B),htmlTextData:w,image:l(z),label:Y,labelText:j,lineEnding:E,link:l(F),listItem:l(),listOrdered:l(),listUnordered:l(),paragraph:l(),referenceString:q,resourceDestinationString:G,resourceTitleString:X,resource:U,setextHeading:l(T),setextHeadingLineSequence:P,setextHeadingText:A,strong:l(),thematicBreak:l()}};rie(t,(e||{}).mdastExtensions||[]);let r={};return n;function n(Re){let Fe={type:"root",children:[]},Ne={stack:[Fe],tokenStack:[],config:t,enter:s,exit:u,buffer:a,resume:c,data:r},ot=[],it=-1;for(;++it<Re.length;)if(Re[it][1].type==="listOrdered"||Re[it][1].type==="listUnordered")if(Re[it][0]==="enter")ot.push(it);else{let Xt=ot.pop();it=o(Re,Xt,it)}for(it=-1;++it<Re.length;){let Xt=t[Re[it][0]];tie.call(Xt,Re[it][1].type)&&Xt[Re[it][1].type].call(Object.assign({sliceSerialize:Re[it][2].sliceSerialize},Ne),Re[it][1])}if(Ne.tokenStack.length>0){let Xt=Ne.tokenStack[Ne.tokenStack.length-1];(Xt[1]||eie).call(Ne,void 0,Xt[0])}for(Fe.position={start:kx(Re.length>0?Re[0][1].start:{line:1,column:1,offset:0}),end:kx(Re.length>0?Re[Re.length-2][1].end:{line:1,column:1,offset:0})},it=-1;++it<t.transforms.length;)Fe=t.transforms[it](Fe)||Fe;return Fe}function o(Re,Fe,Ne){let ot=Fe-1,it=-1,Xt=!1,$r,bt,xr,tn;for(;++ot<=Ne;){let pn=Re[ot];switch(pn[1].type){case"listUnordered":case"listOrdered":case"blockQuote":{pn[0]==="enter"?it++:it--,tn=void 0;break}case"lineEndingBlank":{pn[0]==="enter"&&($r&&!tn&&!it&&!xr&&(xr=ot),tn=void 0);break}case"linePrefix":case"listItemValue":case"listItemMarker":case"listItemPrefix":case"listItemPrefixWhitespace":break;default:tn=void 0}if(!it&&pn[0]==="enter"&&pn[1].type==="listItemPrefix"||it===-1&&pn[0]==="exit"&&(pn[1].type==="listUnordered"||pn[1].type==="listOrdered")){if($r){let io=ot;for(bt=void 0;io--;){let Hn=Re[io];if(Hn[1].type==="lineEnding"||Hn[1].type==="lineEndingBlank"){if(Hn[0]==="exit")continue;bt&&(Re[bt][1].type="lineEndingBlank",Xt=!0),Hn[1].type="lineEnding",bt=io}else if(!(Hn[1].type==="linePrefix"||Hn[1].type==="blockQuotePrefix"||Hn[1].type==="blockQuotePrefixWhitespace"||Hn[1].type==="blockQuoteMarker"||Hn[1].type==="listItemIndent"))break}xr&&(!bt||xr<bt)&&($r._spread=!0),$r.end=Object.assign({},bt?Re[bt][1].start:pn[1].end),Re.splice(bt||ot,0,["exit",$r,pn[2]]),ot++,Ne++}if(pn[1].type==="listItemPrefix"){let io={type:"listItem",_spread:!1,start:Object.assign({},pn[1].start),end:void 0};$r=io,Re.splice(ot,0,["enter",io,pn[2]]),ot++,Ne++,xr=void 0,tn=!0}}}return Re[Fe][1]._spread=Xt,Ne}function i(Re,Fe){return Ne;function Ne(ot){s.call(this,Re(ot),ot),Fe&&Fe.call(this,ot)}}function a(){this.stack.push({type:"fragment",children:[]})}function s(Re,Fe,Ne){this.stack[this.stack.length-1].children.push(Re),this.stack.push(Re),this.tokenStack.push([Fe,Ne||void 0]),Re.position={start:kx(Fe.start),end:void 0}}function l(Re){return Fe;function Fe(Ne){Re&&Re.call(this,Ne),u.call(this,Ne)}}function u(Re,Fe){let Ne=this.stack.pop(),ot=this.tokenStack.pop();if(ot)ot[0].type!==Re.type&&(Fe?Fe.call(this,Re,ot[0]):(ot[1]||eie).call(this,Re,ot[0]));else throw new Error("Cannot close `"+Re.type+"` ("+Mx({start:Re.start,end:Re.end})+"): it\u2019s not open");Ne.position.end=kx(Re.end)}function c(){return nS(this.stack.pop())}function m(){this.data.expectingFirstListItemValue=!0}function d(Re){if(this.data.expectingFirstListItemValue){let Fe=this.stack[this.stack.length-2];Fe.start=Number.parseInt(this.sliceSerialize(Re),10),this.data.expectingFirstListItemValue=void 0}}function p(){let Re=this.resume(),Fe=this.stack[this.stack.length-1];Fe.lang=Re}function h(){let Re=this.resume(),Fe=this.stack[this.stack.length-1];Fe.meta=Re}function f(){this.data.flowCodeInside||(this.buffer(),this.data.flowCodeInside=!0)}function g(){let Re=this.resume(),Fe=this.stack[this.stack.length-1];Fe.value=Re.replace(/^(\r?\n|\r)|(\r?\n|\r)$/g,""),this.data.flowCodeInside=void 0}function y(){let Re=this.resume(),Fe=this.stack[this.stack.length-1];Fe.value=Re.replace(/(\r?\n|\r)$/g,"")}function x(Re){let Fe=this.resume(),Ne=this.stack[this.stack.length-1];Ne.label=Fe,Ne.identifier=rc(this.sliceSerialize(Re)).toLowerCase()}function S(){let Re=this.resume(),Fe=this.stack[this.stack.length-1];Fe.title=Re}function I(){let Re=this.resume(),Fe=this.stack[this.stack.length-1];Fe.url=Re}function v(Re){let Fe=this.stack[this.stack.length-1];if(!Fe.depth){let Ne=this.sliceSerialize(Re).length;Fe.depth=Ne}}function A(){this.data.setextHeadingSlurpLineEnding=!0}function P(Re){let Fe=this.stack[this.stack.length-1];Fe.depth=this.sliceSerialize(Re).codePointAt(0)===61?1:2}function T(){this.data.setextHeadingSlurpLineEnding=void 0}function R(Re){let Ne=this.stack[this.stack.length-1].children,ot=Ne[Ne.length-1];(!ot||ot.type!=="text")&&(ot=at(),ot.position={start:kx(Re.start),end:void 0},Ne.push(ot)),this.stack.push(ot)}function w(Re){let Fe=this.stack.pop();Fe.value+=this.sliceSerialize(Re),Fe.position.end=kx(Re.end)}function E(Re){let Fe=this.stack[this.stack.length-1];if(this.data.atHardBreak){let Ne=Fe.children[Fe.children.length-1];Ne.position.end=kx(Re.end),this.data.atHardBreak=void 0;return}!this.data.setextHeadingSlurpLineEnding&&t.canContainEols.includes(Fe.type)&&(R.call(this,Re),w.call(this,Re))}function M(){this.data.atHardBreak=!0}function D(){let Re=this.resume(),Fe=this.stack[this.stack.length-1];Fe.value=Re}function B(){let Re=this.resume(),Fe=this.stack[this.stack.length-1];Fe.value=Re}function k(){let Re=this.resume(),Fe=this.stack[this.stack.length-1];Fe.value=Re}function F(){let Re=this.stack[this.stack.length-1];if(this.data.inReference){let Fe=this.data.referenceType||"shortcut";Re.type+="Reference",Re.referenceType=Fe,delete Re.url,delete Re.title}else delete Re.identifier,delete Re.label;this.data.referenceType=void 0}function z(){let Re=this.stack[this.stack.length-1];if(this.data.inReference){let Fe=this.data.referenceType||"shortcut";Re.type+="Reference",Re.referenceType=Fe,delete Re.url,delete Re.title}else delete Re.identifier,delete Re.label;this.data.referenceType=void 0}function j(Re){let Fe=this.sliceSerialize(Re),Ne=this.stack[this.stack.length-2];Ne.label=$oe(Fe),Ne.identifier=rc(Fe).toLowerCase()}function Y(){let Re=this.stack[this.stack.length-1],Fe=this.resume(),Ne=this.stack[this.stack.length-1];if(this.data.inReference=!0,Ne.type==="link"){let ot=Re.children;Ne.children=ot}else Ne.alt=Fe}function G(){let Re=this.resume(),Fe=this.stack[this.stack.length-1];Fe.url=Re}function X(){let Re=this.resume(),Fe=this.stack[this.stack.length-1];Fe.title=Re}function U(){this.data.inReference=void 0}function L(){this.data.referenceType="collapsed"}function q(Re){let Fe=this.resume(),Ne=this.stack[this.stack.length-1];Ne.label=Fe,Ne.identifier=rc(this.sliceSerialize(Re)).toLowerCase(),this.data.referenceType="full"}function te(Re){this.data.characterReferenceType=Re.type}function J(Re){let Fe=this.sliceSerialize(Re),Ne=this.data.characterReferenceType,ot;Ne?(ot=GM(Fe,Ne==="characterReferenceMarkerNumeric"?10:16),this.data.characterReferenceType=void 0):ot=zv(Fe);let it=this.stack[this.stack.length-1];it.value+=ot}function ee(Re){let Fe=this.stack.pop();Fe.position.end=kx(Re.end)}function ce(Re){w.call(this,Re);let Fe=this.stack[this.stack.length-1];Fe.url=this.sliceSerialize(Re)}function fe(Re){w.call(this,Re);let Fe=this.stack[this.stack.length-1];Fe.url="mailto:"+this.sliceSerialize(Re)}function O(){return{type:"blockquote",children:[]}}function V(){return{type:"code",lang:null,meta:null,value:""}}function Z(){return{type:"inlineCode",value:""}}function pe(){return{type:"definition",identifier:"",label:null,title:null,url:""}}function $(){return{type:"emphasis",children:[]}}function ae(){return{type:"heading",depth:0,children:[]}}function Se(){return{type:"break"}}function ve(){return{type:"html",value:""}}function K(){return{type:"image",title:null,url:"",alt:null}}function re(){return{type:"link",title:null,url:"",children:[]}}function le(Re){return{type:"list",ordered:Re.type==="listOrdered",start:null,spread:Re._spread,children:[]}}function ge(Re){return{type:"listItem",spread:Re._spread,checked:null,children:[]}}function Ee(){return{type:"paragraph",children:[]}}function nt(){return{type:"strong",children:[]}}function at(){return{type:"text",value:""}}function be(){return{type:"thematicBreak"}}}function kx(e){return{line:e.line,column:e.column,offset:e.offset}}function rie(e,t){let r=-1;for(;++r<t.length;){let n=t[r];Array.isArray(n)?rie(e,n):aGe(e,n)}}function aGe(e,t){let r;for(r in t)if(tie.call(t,r))switch(r){case"canContainEols":{let n=t[r];n&&e[r].push(...n);break}case"transforms":{let n=t[r];n&&e[r].push(...n);break}case"enter":case"exit":{let n=t[r];n&&Object.assign(e[r],n);break}}}function eie(e,t){throw e?new Error("Cannot close `"+e.type+"` ("+Mx({start:e.start,end:e.end})+"): a different token (`"+t.type+"`, "+Mx({start:t.start,end:t.end})+") is open"):new Error("Cannot close document, a token (`"+t.type+"`, "+Mx({start:t.start,end:t.end})+") is still open")}function YM(e){let t=this;t.parser=r;function r(n){return Tz(n,{...t.data("settings"),...e,extensions:t.data("micromarkExtensions")||[],mdastExtensions:t.data("fromMarkdownExtensions")||[]})}}function nie(e,t){let r={type:"element",tagName:"blockquote",properties:{},children:e.wrap(e.all(t),!0)};return e.patch(t,r),e.applyData(t,r)}function oie(e,t){let r={type:"element",tagName:"br",properties:{},children:[]};return e.patch(t,r),[e.applyData(t,r),{type:"text",value:`
`}]}function iie(e,t){let r=t.value?t.value+`
`:"",n={},o=t.lang?t.lang.split(/\s+/):[];o.length>0&&(n.className=["language-"+o[0]]);let i={type:"element",tagName:"code",properties:n,children:[{type:"text",value:r}]};return t.meta&&(i.data={meta:t.meta}),e.patch(t,i),i=e.applyData(t,i),i={type:"element",tagName:"pre",properties:{},children:[i]},e.patch(t,i),i}function aie(e,t){let r={type:"element",tagName:"del",properties:{},children:e.all(t)};return e.patch(t,r),e.applyData(t,r)}function sie(e,t){let r={type:"element",tagName:"em",properties:{},children:e.all(t)};return e.patch(t,r),e.applyData(t,r)}function lie(e,t){let r=typeof e.options.clobberPrefix=="string"?e.options.clobberPrefix:"user-content-",n=String(t.identifier).toUpperCase(),o=sp(n.toLowerCase()),i=e.footnoteOrder.indexOf(n),a,s=e.footnoteCounts.get(n);s===void 0?(s=0,e.footnoteOrder.push(n),a=e.footnoteOrder.length):a=i+1,s+=1,e.footnoteCounts.set(n,s);let l={type:"element",tagName:"a",properties:{href:"#"+r+"fn-"+o,id:r+"fnref-"+o+(s>1?"-"+s:""),dataFootnoteRef:!0,ariaDescribedBy:["footnote-label"]},children:[{type:"text",value:String(a)}]};e.patch(t,l);let u={type:"element",tagName:"sup",properties:{},children:[l]};return e.patch(t,u),e.applyData(t,u)}function uie(e,t){let r={type:"element",tagName:"h"+t.depth,properties:{},children:e.all(t)};return e.patch(t,r),e.applyData(t,r)}function cie(e,t){if(e.options.allowDangerousHtml){let r={type:"raw",value:t.value};return e.patch(t,r),e.applyData(t,r)}}function KM(e,t){let r=t.referenceType,n="]";if(r==="collapsed"?n+="[]":r==="full"&&(n+="["+(t.label||t.identifier)+"]"),t.type==="imageReference")return[{type:"text",value:"!["+t.alt+n}];let o=e.all(t),i=o[0];i&&i.type==="text"?i.value="["+i.value:o.unshift({type:"text",value:"["});let a=o[o.length-1];return a&&a.type==="text"?a.value+=n:o.push({type:"text",value:n}),o}function mie(e,t){let r=String(t.identifier).toUpperCase(),n=e.definitionById.get(r);if(!n)return KM(e,t);let o={src:sp(n.url||""),alt:t.alt};n.title!==null&&n.title!==void 0&&(o.title=n.title);let i={type:"element",tagName:"img",properties:o,children:[]};return e.patch(t,i),e.applyData(t,i)}function die(e,t){let r={src:sp(t.url)};t.alt!==null&&t.alt!==void 0&&(r.alt=t.alt),t.title!==null&&t.title!==void 0&&(r.title=t.title);let n={type:"element",tagName:"img",properties:r,children:[]};return e.patch(t,n),e.applyData(t,n)}function pie(e,t){let r={type:"text",value:t.value.replace(/\r?\n|\r/g," ")};e.patch(t,r);let n={type:"element",tagName:"code",properties:{},children:[r]};return e.patch(t,n),e.applyData(t,n)}function fie(e,t){let r=String(t.identifier).toUpperCase(),n=e.definitionById.get(r);if(!n)return KM(e,t);let o={href:sp(n.url||"")};n.title!==null&&n.title!==void 0&&(o.title=n.title);let i={type:"element",tagName:"a",properties:o,children:e.all(t)};return e.patch(t,i),e.applyData(t,i)}function hie(e,t){let r={href:sp(t.url)};t.title!==null&&t.title!==void 0&&(r.title=t.title);let n={type:"element",tagName:"a",properties:r,children:e.all(t)};return e.patch(t,n),e.applyData(t,n)}function gie(e,t,r){let n=e.all(t),o=r?sGe(r):yie(t),i={},a=[];if(typeof t.checked=="boolean"){let c=n[0],m;c&&c.type==="element"&&c.tagName==="p"?m=c:(m={type:"element",tagName:"p",properties:{},children:[]},n.unshift(m)),m.children.length>0&&m.children.unshift({type:"text",value:" "}),m.children.unshift({type:"element",tagName:"input",properties:{type:"checkbox",checked:t.checked,disabled:!0},children:[]}),i.className=["task-list-item"]}let s=-1;for(;++s<n.length;){let c=n[s];(o||s!==0||c.type!=="element"||c.tagName!=="p")&&a.push({type:"text",value:`
`}),c.type==="element"&&c.tagName==="p"&&!o?a.push(...c.children):a.push(c)}let l=n[n.length-1];l&&(o||l.type!=="element"||l.tagName!=="p")&&a.push({type:"text",value:`
`});let u={type:"element",tagName:"li",properties:i,children:a};return e.patch(t,u),e.applyData(t,u)}function sGe(e){let t=!1;if(e.type==="list"){t=e.spread||!1;let r=e.children,n=-1;for(;!t&&++n<r.length;)t=yie(r[n])}return t}function yie(e){let t=e.spread;return t??e.children.length>1}function bie(e,t){let r={},n=e.all(t),o=-1;for(typeof t.start=="number"&&t.start!==1&&(r.start=t.start);++o<n.length;){let a=n[o];if(a.type==="element"&&a.tagName==="li"&&a.properties&&Array.isArray(a.properties.className)&&a.properties.className.includes("task-list-item")){r.className=["contains-task-list"];break}}let i={type:"element",tagName:t.ordered?"ol":"ul",properties:r,children:e.wrap(n,!0)};return e.patch(t,i),e.applyData(t,i)}function xie(e,t){let r={type:"element",tagName:"p",properties:{},children:e.all(t)};return e.patch(t,r),e.applyData(t,r)}function Cie(e,t){let r={type:"root",children:e.wrap(e.all(t))};return e.patch(t,r),e.applyData(t,r)}function Sie(e,t){let r={type:"element",tagName:"strong",properties:{},children:e.all(t)};return e.patch(t,r),e.applyData(t,r)}function vie(e,t){let r=e.all(t),n=r.shift(),o=[];if(n){let a={type:"element",tagName:"thead",properties:{},children:e.wrap([n],!0)};e.patch(t.children[0],a),o.push(a)}if(r.length>0){let a={type:"element",tagName:"tbody",properties:{},children:e.wrap(r,!0)},s=Nv(t.children[1]),l=VM(t.children[t.children.length-1]);s&&l&&(a.position={start:s,end:l}),o.push(a)}let i={type:"element",tagName:"table",properties:{},children:e.wrap(o,!0)};return e.patch(t,i),e.applyData(t,i)}function Iie(e,t,r){let n=r?r.children:void 0,i=(n?n.indexOf(t):1)===0?"th":"td",a=r&&r.type==="table"?r.align:void 0,s=a?a.length:t.children.length,l=-1,u=[];for(;++l<s;){let m=t.children[l],d={},p=a?a[l]:void 0;p&&(d.align=p);let h={type:"element",tagName:i,properties:d,children:[]};m&&(h.children=e.all(m),e.patch(m,h),h=e.applyData(m,h)),u.push(h)}let c={type:"element",tagName:"tr",properties:{},children:e.wrap(u,!0)};return e.patch(t,c),e.applyData(t,c)}function Aie(e,t){let r={type:"element",tagName:"td",properties:{},children:e.all(t)};return e.patch(t,r),e.applyData(t,r)}function Pie(e){let t=String(e),r=/\r?\n|\r/g,n=r.exec(t),o=0,i=[];for(;n;)i.push(Tie(t.slice(o,n.index),o>0,!0),n[0]),o=n.index+n[0].length,n=r.exec(t);return i.push(Tie(t.slice(o),o>0,!1)),i.join("")}function Tie(e,t,r){let n=0,o=e.length;if(t){let i=e.codePointAt(n);for(;i===9||i===32;)n++,i=e.codePointAt(n)}if(r){let i=e.codePointAt(o-1);for(;i===9||i===32;)o--,i=e.codePointAt(o-1)}return o>n?e.slice(n,o):""}function _ie(e,t){let r={type:"text",value:Pie(String(t.value))};return e.patch(t,r),e.applyData(t,r)}function Rie(e,t){let r={type:"element",tagName:"hr",properties:{},children:[]};return e.patch(t,r),e.applyData(t,r)}var Die={blockquote:nie,break:oie,code:iie,delete:aie,emphasis:sie,footnoteReference:lie,heading:uie,html:cie,imageReference:mie,image:die,inlineCode:pie,linkReference:fie,link:hie,listItem:gie,list:bie,paragraph:xie,root:Cie,strong:Sie,table:vie,tableCell:Aie,tableRow:Iie,text:_ie,thematicBreak:Rie,toml:JM,yaml:JM,definition:JM,footnoteDefinition:JM};function JM(){}var wie=typeof self=="object"?self:globalThis,mGe=(e,t)=>{let r=(o,i)=>(e.set(i,o),o),n=o=>{if(e.has(o))return e.get(o);let[i,a]=t[o];switch(i){case 0:case-1:return r(a,o);case 1:{let s=r([],o);for(let l of a)s.push(n(l));return s}case 2:{let s=r({},o);for(let[l,u]of a)s[n(l)]=n(u);return s}case 3:return r(new Date(a),o);case 4:{let{source:s,flags:l}=a;return r(new RegExp(s,l),o)}case 5:{let s=r(new Map,o);for(let[l,u]of a)s.set(n(l),n(u));return s}case 6:{let s=r(new Set,o);for(let l of a)s.add(n(l));return s}case 7:{let{name:s,message:l}=a;return r(new wie[s](l),o)}case 8:return r(BigInt(a),o);case"BigInt":return r(Object(BigInt(a)),o);case"ArrayBuffer":return r(new Uint8Array(a).buffer,a);case"DataView":{let{buffer:s}=new Uint8Array(a);return r(new DataView(s),a)}}return r(new wie[i](a),o)};return n},Rz=e=>mGe(new Map,e)(0);var Hv="",{toString:dGe}={},{keys:pGe}=Object,e_=e=>{let t=typeof e;if(t!=="object"||!e)return[0,t];let r=dGe.call(e).slice(8,-1);switch(r){case"Array":return[1,Hv];case"Object":return[2,Hv];case"Date":return[3,Hv];case"RegExp":return[4,Hv];case"Map":return[5,Hv];case"Set":return[6,Hv];case"DataView":return[1,r]}return r.includes("Array")?[1,r]:r.includes("Error")?[7,r]:[2,r]},eB=([e,t])=>e===0&&(t==="function"||t==="symbol"),fGe=(e,t,r,n)=>{let o=(a,s)=>{let l=n.push(a)-1;return r.set(s,l),l},i=a=>{if(r.has(a))return r.get(a);let[s,l]=e_(a);switch(s){case 0:{let c=a;switch(l){case"bigint":s=8,c=a.toString();break;case"function":case"symbol":if(e)throw new TypeError("unable to serialize "+l);c=null;break;case"undefined":return o([-1],a)}return o([s,c],a)}case 1:{if(l){let d=a;return l==="DataView"?d=new Uint8Array(a.buffer):l==="ArrayBuffer"&&(d=new Uint8Array(a)),o([l,[...d]],a)}let c=[],m=o([s,c],a);for(let d of a)c.push(i(d));return m}case 2:{if(l)switch(l){case"BigInt":return o([l,a.toString()],a);case"Boolean":case"Number":case"String":return o([l,a.valueOf()],a)}if(t&&"toJSON"in a)return i(a.toJSON());let c=[],m=o([s,c],a);for(let d of pGe(a))(e||!eB(e_(a[d])))&&c.push([i(d),i(a[d])]);return m}case 3:return o([s,a.toISOString()],a);case 4:{let{source:c,flags:m}=a;return o([s,{source:c,flags:m}],a)}case 5:{let c=[],m=o([s,c],a);for(let[d,p]of a)(e||!(eB(e_(d))||eB(e_(p))))&&c.push([i(d),i(p)]);return m}case 6:{let c=[],m=o([s,c],a);for(let d of a)(e||!eB(e_(d)))&&c.push(i(d));return m}}let{message:u}=a;return o([s,{name:l,message:u}],a)};return i},Dz=(e,{json:t,lossy:r}={})=>{let n=[];return fGe(!(t||r),!!t,new Map,n)(e),n};var jv=typeof structuredClone=="function"?(e,t)=>t&&("json"in t||"lossy"in t)?Rz(Dz(e,t)):structuredClone(e):(e,t)=>Rz(Dz(e,t));function hGe(e,t){let r=[{type:"text",value:"\u21A9"}];return t>1&&r.push({type:"element",tagName:"sup",properties:{},children:[{type:"text",value:String(t)}]}),r}function gGe(e,t){return"Back to reference "+(e+1)+(t>1?"-"+t:"")}function Fie(e){let t=typeof e.options.clobberPrefix=="string"?e.options.clobberPrefix:"user-content-",r=e.options.footnoteBackContent||hGe,n=e.options.footnoteBackLabel||gGe,o=e.options.footnoteLabel||"Footnotes",i=e.options.footnoteLabelTagName||"h2",a=e.options.footnoteLabelProperties||{className:["sr-only"]},s=[],l=-1;for(;++l<e.footnoteOrder.length;){let u=e.footnoteById.get(e.footnoteOrder[l]);if(!u)continue;let c=e.all(u),m=String(u.identifier).toUpperCase(),d=sp(m.toLowerCase()),p=0,h=[],f=e.footnoteCounts.get(m);for(;f!==void 0&&++p<=f;){h.length>0&&h.push({type:"text",value:" "});let x=typeof r=="string"?r:r(l,p);typeof x=="string"&&(x={type:"text",value:x}),h.push({type:"element",tagName:"a",properties:{href:"#"+t+"fnref-"+d+(p>1?"-"+p:""),dataFootnoteBackref:"",ariaLabel:typeof n=="string"?n:n(l,p),className:["data-footnote-backref"]},children:Array.isArray(x)?x:[x]})}let g=c[c.length-1];if(g&&g.type==="element"&&g.tagName==="p"){let x=g.children[g.children.length-1];x&&x.type==="text"?x.value+=" ":g.children.push({type:"text",value:" "}),g.children.push(...h)}else c.push(...h);let y={type:"element",tagName:"li",properties:{id:t+"fn-"+d},children:e.wrap(c,!0)};e.patch(u,y),s.push(y)}if(s.length!==0)return{type:"element",tagName:"section",properties:{dataFootnotes:!0,className:["footnotes"]},children:[{type:"element",tagName:i,properties:{...jv(a),id:"footnote-label"},children:[{type:"text",value:o}]},{type:"text",value:`
`},{type:"element",tagName:"ol",properties:{},children:e.wrap(s,!0)},{type:"text",value:`
`}]}}var Fx=(function(e){if(e==null)return CGe;if(typeof e=="function")return tB(e);if(typeof e=="object")return Array.isArray(e)?yGe(e):bGe(e);if(typeof e=="string")return xGe(e);throw new Error("Expected function, string, or object as test")});function yGe(e){let t=[],r=-1;for(;++r<e.length;)t[r]=Fx(e[r]);return tB(n);function n(...o){let i=-1;for(;++i<t.length;)if(t[i].apply(this,o))return!0;return!1}}function bGe(e){let t=e;return tB(r);function r(n){let o=n,i;for(i in e)if(o[i]!==t[i])return!1;return!0}}function xGe(e){return tB(t);function t(r){return r&&r.type===e}}function tB(e){return t;function t(r,n,o){return!!(SGe(r)&&e.call(this,r,typeof n=="number"?n:void 0,o||void 0))}}function CGe(){return!0}function SGe(e){return e!==null&&typeof e=="object"&&"type"in e}var Lie=[],rB=!0,uS=!1,nB="skip";function t_(e,t,r,n){let o;typeof t=="function"&&typeof r!="function"?(n=r,r=t):o=t;let i=Fx(o),a=n?-1:1;s(e,void 0,[])();function s(l,u,c){let m=l&&typeof l=="object"?l:{};if(typeof m.type=="string"){let p=typeof m.tagName=="string"?m.tagName:typeof m.name=="string"?m.name:void 0;Object.defineProperty(d,"name",{value:"node ("+(l.type+(p?"<"+p+">":""))+")"})}return d;function d(){let p=Lie,h,f,g;if((!t||i(l,u,c[c.length-1]||void 0))&&(p=vGe(r(l,c)),p[0]===uS))return p;if("children"in l&&l.children){let y=l;if(y.children&&p[0]!==nB)for(f=(n?y.children.length:-1)+a,g=c.concat(y);f>-1&&f<y.children.length;){let x=y.children[f];if(h=s(x,f,g)(),h[0]===uS)return h;f=typeof h[1]=="number"?h[1]:f+a}}return p}}}function vGe(e){return Array.isArray(e)?e:typeof e=="number"?[rB,e]:e==null?Lie:[e]}function cS(e,t,r,n){let o,i,a;typeof t=="function"&&typeof r!="function"?(i=void 0,a=t,o=r):(i=t,a=r,o=n),t_(e,i,s,o);function s(l,u){let c=u[u.length-1],m=c?c.children.indexOf(l):void 0;return a(l,m,c)}}var wz={}.hasOwnProperty,IGe={};function Oie(e,t){let r=t||IGe,n=new Map,o=new Map,i=new Map,a={...Die,...r.handlers},s={all:u,applyData:TGe,definitionById:n,footnoteById:o,footnoteCounts:i,footnoteOrder:[],handlers:a,one:l,options:r,patch:AGe,wrap:_Ge};return cS(e,function(c){if(c.type==="definition"||c.type==="footnoteDefinition"){let m=c.type==="definition"?n:o,d=String(c.identifier).toUpperCase();m.has(d)||m.set(d,c)}}),s;function l(c,m){let d=c.type,p=s.handlers[d];if(wz.call(s.handlers,d)&&p)return p(s,c,m);if(s.options.passThrough&&s.options.passThrough.includes(d)){if("children"in c){let{children:f,...g}=c,y=jv(g);return y.children=s.all(c),y}return jv(c)}return(s.options.unknownHandler||PGe)(s,c,m)}function u(c){let m=[];if("children"in c){let d=c.children,p=-1;for(;++p<d.length;){let h=s.one(d[p],c);if(h){if(p&&d[p-1].type==="break"&&(!Array.isArray(h)&&h.type==="text"&&(h.value=Vie(h.value)),!Array.isArray(h)&&h.type==="element")){let f=h.children[0];f&&f.type==="text"&&(f.value=Vie(f.value))}Array.isArray(h)?m.push(...h):m.push(h)}}}return m}}function AGe(e,t){e.position&&(t.position=oz(e))}function TGe(e,t){let r=t;if(e&&e.data){let n=e.data.hName,o=e.data.hChildren,i=e.data.hProperties;if(typeof n=="string")if(r.type==="element")r.tagName=n;else{let a="children"in r?r.children:[r];r={type:"element",tagName:n,properties:{},children:a}}r.type==="element"&&i&&Object.assign(r.properties,jv(i)),"children"in r&&r.children&&o!==null&&o!==void 0&&(r.children=o)}return r}function PGe(e,t){let r=t.data||{},n="value"in t&&!(wz.call(r,"hProperties")||wz.call(r,"hChildren"))?{type:"text",value:t.value}:{type:"element",tagName:"div",properties:{},children:e.all(t)};return e.patch(t,n),e.applyData(t,n)}function _Ge(e,t){let r=[],n=-1;for(t&&r.push({type:"text",value:`
`});++n<e.length;)n&&r.push({type:"text",value:`
`}),r.push(e[n]);return t&&e.length>0&&r.push({type:"text",value:`
`}),r}function Vie(e){let t=0,r=e.charCodeAt(t);for(;r===9||r===32;)t++,r=e.charCodeAt(t);return e.slice(t)}function oB(e,t){let r=Oie(e,t),n=r.one(e,void 0),o=Fie(r),i=Array.isArray(n)?{type:"root",children:n}:n||{type:"root",children:[]};return o&&("children"in i,i.children.push({type:"text",value:`
`},o)),i}function iB(e,t){return e&&"run"in e?async function(r,n){let o=oB(r,{file:n,...t});await e.run(o,n)}:function(r,n){return oB(r,{file:n,...e||t})}}function Mz(e){if(e)throw e}var lB=_t(Qie(),1);function r_(e){if(typeof e!="object"||e===null)return!1;let t=Object.getPrototypeOf(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)}function Bz(){let e=[],t={run:r,use:n};return t;function r(...o){let i=-1,a=o.pop();if(typeof a!="function")throw new TypeError("Expected function as last argument, not "+a);s(null,...o);function s(l,...u){let c=e[++i],m=-1;if(l){a(l);return}for(;++m<o.length;)(u[m]===null||u[m]===void 0)&&(u[m]=o[m]);o=u,c?Zie(c,s)(...u):a(null,...u)}}function n(o){if(typeof o!="function")throw new TypeError("Expected `middelware` to be a function, not "+o);return e.push(o),t}}function Zie(e,t){let r;return n;function n(...a){let s=e.length>a.length,l;s&&a.push(o);try{l=e.apply(this,a)}catch(u){let c=u;if(s&&r)throw c;return o(c)}s||(l&&l.then&&typeof l.then=="function"?l.then(i,o):l instanceof Error?o(l):i(l))}function o(a,...s){r||(r=!0,t(a,...s))}function i(a){o(null,a)}}var kf={basename:RGe,dirname:DGe,extname:wGe,join:MGe,sep:"/"};function RGe(e,t){if(t!==void 0&&typeof t!="string")throw new TypeError('"ext" argument must be a string');n_(e);let r=0,n=-1,o=e.length,i;if(t===void 0||t.length===0||t.length>e.length){for(;o--;)if(e.codePointAt(o)===47){if(i){r=o+1;break}}else n<0&&(i=!0,n=o+1);return n<0?"":e.slice(r,n)}if(t===e)return"";let a=-1,s=t.length-1;for(;o--;)if(e.codePointAt(o)===47){if(i){r=o+1;break}}else a<0&&(i=!0,a=o+1),s>-1&&(e.codePointAt(o)===t.codePointAt(s--)?s<0&&(n=o):(s=-1,n=a));return r===n?n=a:n<0&&(n=e.length),e.slice(r,n)}function DGe(e){if(n_(e),e.length===0)return".";let t=-1,r=e.length,n;for(;--r;)if(e.codePointAt(r)===47){if(n){t=r;break}}else n||(n=!0);return t<0?e.codePointAt(0)===47?"/":".":t===1&&e.codePointAt(0)===47?"//":e.slice(0,t)}function wGe(e){n_(e);let t=e.length,r=-1,n=0,o=-1,i=0,a;for(;t--;){let s=e.codePointAt(t);if(s===47){if(a){n=t+1;break}continue}r<0&&(a=!0,r=t+1),s===46?o<0?o=t:i!==1&&(i=1):o>-1&&(i=-1)}return o<0||r<0||i===0||i===1&&o===r-1&&o===n+1?"":e.slice(o,r)}function MGe(...e){let t=-1,r;for(;++t<e.length;)n_(e[t]),e[t]&&(r=r===void 0?e[t]:r+"/"+e[t]);return r===void 0?".":BGe(r)}function BGe(e){n_(e);let t=e.codePointAt(0)===47,r=EGe(e,!t);return r.length===0&&!t&&(r="."),r.length>0&&e.codePointAt(e.length-1)===47&&(r+="/"),t?"/"+r:r}function EGe(e,t){let r="",n=0,o=-1,i=0,a=-1,s,l;for(;++a<=e.length;){if(a<e.length)s=e.codePointAt(a);else{if(s===47)break;s=47}if(s===47){if(!(o===a-1||i===1))if(o!==a-1&&i===2){if(r.length<2||n!==2||r.codePointAt(r.length-1)!==46||r.codePointAt(r.length-2)!==46){if(r.length>2){if(l=r.lastIndexOf("/"),l!==r.length-1){l<0?(r="",n=0):(r=r.slice(0,l),n=r.length-1-r.lastIndexOf("/")),o=a,i=0;continue}}else if(r.length>0){r="",n=0,o=a,i=0;continue}}t&&(r=r.length>0?r+"/..":"..",n=2)}else r.length>0?r+="/"+e.slice(o+1,a):r=e.slice(o+1,a),n=a-o-1;o=a,i=0}else s===46&&i>-1?i++:i=-1}return r}function n_(e){if(typeof e!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(e))}var qie={cwd:kGe};function kGe(){return"/"}function Wv(e){return!!(e!==null&&typeof e=="object"&&"href"in e&&e.href&&"protocol"in e&&e.protocol&&e.auth===void 0)}function Yie(e){if(typeof e=="string")e=new URL(e);else if(!Wv(e)){let t=new TypeError('The "path" argument must be of type string or an instance of URL. Received `'+e+"`");throw t.code="ERR_INVALID_ARG_TYPE",t}if(e.protocol!=="file:"){let t=new TypeError("The URL must be of scheme file");throw t.code="ERR_INVALID_URL_SCHEME",t}return FGe(e)}function FGe(e){if(e.hostname!==""){let n=new TypeError('File URL host must be "localhost" or empty on darwin');throw n.code="ERR_INVALID_FILE_URL_HOST",n}let t=e.pathname,r=-1;for(;++r<t.length;)if(t.codePointAt(r)===37&&t.codePointAt(r+1)===50){let n=t.codePointAt(r+2);if(n===70||n===102){let o=new TypeError("File URL path must not include encoded / characters");throw o.code="ERR_INVALID_FILE_URL_PATH",o}}return decodeURIComponent(t)}var Ez=["history","path","basename","stem","extname","dirname"],mS=class{constructor(t){let r;t?Wv(t)?r={path:t}:typeof t=="string"||LGe(t)?r={value:t}:r=t:r={},this.cwd="cwd"in r?"":qie.cwd(),this.data={},this.history=[],this.messages=[],this.value,this.map,this.result,this.stored;let n=-1;for(;++n<Ez.length;){let i=Ez[n];i in r&&r[i]!==void 0&&r[i]!==null&&(this[i]=i==="history"?[...r[i]]:r[i])}let o;for(o in r)Ez.includes(o)||(this[o]=r[o])}get basename(){return typeof this.path=="string"?kf.basename(this.path):void 0}set basename(t){Fz(t,"basename"),kz(t,"basename"),this.path=kf.join(this.dirname||"",t)}get dirname(){return typeof this.path=="string"?kf.dirname(this.path):void 0}set dirname(t){Kie(this.basename,"dirname"),this.path=kf.join(t||"",this.basename)}get extname(){return typeof this.path=="string"?kf.extname(this.path):void 0}set extname(t){if(kz(t,"extname"),Kie(this.dirname,"extname"),t){if(t.codePointAt(0)!==46)throw new Error("`extname` must start with `.`");if(t.includes(".",1))throw new Error("`extname` cannot contain multiple dots")}this.path=kf.join(this.dirname,this.stem+(t||""))}get path(){return this.history[this.history.length-1]}set path(t){Wv(t)&&(t=Yie(t)),Fz(t,"path"),this.path!==t&&this.history.push(t)}get stem(){return typeof this.path=="string"?kf.basename(this.path,this.extname):void 0}set stem(t){Fz(t,"stem"),kz(t,"stem"),this.path=kf.join(this.dirname||"",t+(this.extname||""))}fail(t,r,n){let o=this.message(t,r,n);throw o.fatal=!0,o}info(t,r,n){let o=this.message(t,r,n);return o.fatal=void 0,o}message(t,r,n){let o=new Vs(t,r,n);return this.path&&(o.name=this.path+":"+o.name,o.file=this.path),o.fatal=!1,this.messages.push(o),o}toString(t){return this.value===void 0?"":typeof this.value=="string"?this.value:new TextDecoder(t||void 0).decode(this.value)}};function kz(e,t){if(e&&e.includes(kf.sep))throw new Error("`"+t+"` cannot be a path: did not expect `"+kf.sep+"`")}function Fz(e,t){if(!e)throw new Error("`"+t+"` cannot be empty")}function Kie(e,t){if(!e)throw new Error("Setting `"+t+"` requires `path` to be set too")}function LGe(e){return!!(e&&typeof e=="object"&&"byteLength"in e&&"byteOffset"in e)}var Jie=(function(e){let n=this.constructor.prototype,o=n[e],i=function(){return o.apply(i,arguments)};return Object.setPrototypeOf(i,n),i});var VGe={}.hasOwnProperty,Gz=class e extends Jie{constructor(){super("copy"),this.Compiler=void 0,this.Parser=void 0,this.attachers=[],this.compiler=void 0,this.freezeIndex=-1,this.frozen=void 0,this.namespace={},this.parser=void 0,this.transformers=Bz()}copy(){let t=new e,r=-1;for(;++r<this.attachers.length;){let n=this.attachers[r];t.use(...n)}return t.data((0,lB.default)(!0,{},this.namespace)),t}data(t,r){return typeof t=="string"?arguments.length===2?(Oz("data",this.frozen),this.namespace[t]=r,this):VGe.call(this.namespace,t)&&this.namespace[t]||void 0:t?(Oz("data",this.frozen),this.namespace=t,this):this.namespace}freeze(){if(this.frozen)return this;let t=this;for(;++this.freezeIndex<this.attachers.length;){let[r,...n]=this.attachers[this.freezeIndex];if(n[0]===!1)continue;n[0]===!0&&(n[0]=void 0);let o=r.call(t,...n);typeof o=="function"&&this.transformers.use(o)}return this.frozen=!0,this.freezeIndex=Number.POSITIVE_INFINITY,this}parse(t){this.freeze();let r=sB(t),n=this.parser||this.Parser;return Lz("parse",n),n(String(r),r)}process(t,r){let n=this;return this.freeze(),Lz("process",this.parser||this.Parser),Vz("process",this.compiler||this.Compiler),r?o(void 0,r):new Promise(o);function o(i,a){let s=sB(t),l=n.parse(s);n.run(l,s,function(c,m,d){if(c||!m||!d)return u(c);let p=m,h=n.stringify(p,d);GGe(h)?d.value=h:d.result=h,u(c,d)});function u(c,m){c||!m?a(c):i?i(m):r(void 0,m)}}}processSync(t){let r=!1,n;return this.freeze(),Lz("processSync",this.parser||this.Parser),Vz("processSync",this.compiler||this.Compiler),this.process(t,o),eae("processSync","process",r),n;function o(i,a){r=!0,Mz(i),n=a}}run(t,r,n){$ie(t),this.freeze();let o=this.transformers;return!n&&typeof r=="function"&&(n=r,r=void 0),n?i(void 0,n):new Promise(i);function i(a,s){let l=sB(r);o.run(t,l,u);function u(c,m,d){let p=m||t;c?s(c):a?a(p):n(void 0,p,d)}}}runSync(t,r){let n=!1,o;return this.run(t,r,i),eae("runSync","run",n),o;function i(a,s){Mz(a),o=s,n=!0}}stringify(t,r){this.freeze();let n=sB(r),o=this.compiler||this.Compiler;return Vz("stringify",o),$ie(t),o(t,n)}use(t,...r){let n=this.attachers,o=this.namespace;if(Oz("use",this.frozen),t!=null)if(typeof t=="function")l(t,r);else if(typeof t=="object")Array.isArray(t)?s(t):a(t);else throw new TypeError("Expected usable value, not `"+t+"`");return this;function i(u){if(typeof u=="function")l(u,[]);else if(typeof u=="object")if(Array.isArray(u)){let[c,...m]=u;l(c,m)}else a(u);else throw new TypeError("Expected usable value, not `"+u+"`")}function a(u){if(!("plugins"in u)&&!("settings"in u))throw new Error("Expected usable value but received an empty preset, which is probably a mistake: presets typically come with `plugins` and sometimes with `settings`, but this has neither");s(u.plugins),u.settings&&(o.settings=(0,lB.default)(!0,o.settings,u.settings))}function s(u){let c=-1;if(u!=null)if(Array.isArray(u))for(;++c<u.length;){let m=u[c];i(m)}else throw new TypeError("Expected a list of plugins, not `"+u+"`")}function l(u,c){let m=-1,d=-1;for(;++m<n.length;)if(n[m][0]===u){d=m;break}if(d===-1)n.push([u,...c]);else if(c.length>0){let[p,...h]=c,f=n[d][1];r_(f)&&r_(p)&&(p=(0,lB.default)(!0,f,p)),n[d]=[u,p,...h]}}}},Uz=new Gz().freeze();function Lz(e,t){if(typeof t!="function")throw new TypeError("Cannot `"+e+"` without `parser`")}function Vz(e,t){if(typeof t!="function")throw new TypeError("Cannot `"+e+"` without `compiler`")}function Oz(e,t){if(t)throw new Error("Cannot call `"+e+"` on a frozen processor.\nCreate a new processor first, by calling it: use `processor()` instead of `processor`.")}function $ie(e){if(!r_(e)||typeof e.type!="string")throw new TypeError("Expected node, got `"+e+"`")}function eae(e,t,r){if(!r)throw new Error("`"+e+"` finished async. Use `"+t+"` instead")}function sB(e){return OGe(e)?e:new mS(e)}function OGe(e){return!!(e&&typeof e=="object"&&"message"in e&&"messages"in e)}function GGe(e){return typeof e=="string"||UGe(e)}function UGe(e){return!!(e&&typeof e=="object"&&"byteLength"in e&&"byteOffset"in e)}var NGe="https://github.com/remarkjs/react-markdown/blob/main/changelog.md",tae=[],rae={allowDangerousHtml:!0},zGe=/^(https?|ircs?|mailto|xmpp)$/i,HGe=[{from:"astPlugins",id:"remove-buggy-html-in-markdown-parser"},{from:"allowDangerousHtml",id:"remove-buggy-html-in-markdown-parser"},{from:"allowNode",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"allowElement"},{from:"allowedTypes",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"allowedElements"},{from:"className",id:"remove-classname"},{from:"disallowedTypes",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"disallowedElements"},{from:"escapeHtml",id:"remove-buggy-html-in-markdown-parser"},{from:"includeElementIndex",id:"#remove-includeelementindex"},{from:"includeNodeIndex",id:"change-includenodeindex-to-includeelementindex"},{from:"linkTarget",id:"remove-linktarget"},{from:"plugins",id:"change-plugins-to-remarkplugins",to:"remarkPlugins"},{from:"rawSourcePos",id:"#remove-rawsourcepos"},{from:"renderers",id:"change-renderers-to-components",to:"components"},{from:"source",id:"change-source-to-children",to:"children"},{from:"sourcePos",id:"#remove-sourcepos"},{from:"transformImageUri",id:"#add-urltransform",to:"urlTransform"},{from:"transformLinkUri",id:"#add-urltransform",to:"urlTransform"}];function o_(e){let t=jGe(e),r=WGe(e);return XGe(t.runSync(t.parse(r),r),e)}function jGe(e){let t=e.rehypePlugins||tae,r=e.remarkPlugins||tae,n=e.remarkRehypeOptions?{...e.remarkRehypeOptions,...rae}:rae;return Uz().use(YM).use(r).use(iB,n).use(t)}function WGe(e){let t=e.children||"",r=new mS;return typeof t=="string"?r.value=t:(""+t,void 0),r}function XGe(e,t){let r=t.allowedElements,n=t.allowElement,o=t.components,i=t.disallowedElements,a=t.skipHtml,s=t.unwrapDisallowed,l=t.urlTransform||oae;for(let c of HGe)Object.hasOwn(t,c.from)&&(""+c.from+(c.to?"use `"+c.to+"` instead":"remove it")+NGe+c.id,void 0);return r&&i&&void 0,cS(e,u),sz(e,{Fragment:Xv.Fragment,components:o,ignoreInvalidStyle:!0,jsx:Xv.jsx,jsxs:Xv.jsxs,passKeys:!0,passNode:!0});function u(c,m,d){if(c.type==="raw"&&d&&typeof m=="number")return a?d.children.splice(m,1):d.children[m]={type:"text",value:c.value},m;if(c.type==="element"){let p;for(p in Z2)if(Object.hasOwn(Z2,p)&&Object.hasOwn(c.properties,p)){let h=c.properties[p],f=Z2[p];(f===null||f.includes(c.tagName))&&(c.properties[p]=l(String(h||""),p,c))}}if(c.type==="element"){let p=r?!r.includes(c.tagName):i?i.includes(c.tagName):!1;if(!p&&n&&typeof m=="number"&&(p=!n(c,m,d)),p&&d&&typeof m=="number")return s&&c.children?d.children.splice(m,1,...c.children):d.children.splice(m,1),m}}}function oae(e){let t=e.indexOf(":"),r=e.indexOf("?"),n=e.indexOf("#"),o=e.indexOf("/");return t===-1||o!==-1&&t>o||r!==-1&&t>r||n!==-1&&t>n||zGe.test(e.slice(0,t))?e:""}function Nz(e,t){let r=String(e);if(typeof t!="string")throw new TypeError("Expected character");let n=0,o=r.indexOf(t);for(;o!==-1;)n++,o=r.indexOf(t,o+t.length);return n}function zz(e){if(typeof e!="string")throw new TypeError("Expected a string");return e.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")}function Hz(e,t,r){let o=Fx((r||{}).ignore||[]),i=QGe(t),a=-1;for(;++a<i.length;)t_(e,"text",s);function s(u,c){let m=-1,d;for(;++m<c.length;){let p=c[m],h=d?d.children:void 0;if(o(p,h?h.indexOf(p):void 0,d))return;d=p}if(d)return l(u,c)}function l(u,c){let m=c[c.length-1],d=i[a][0],p=i[a][1],h=0,g=m.children.indexOf(u),y=!1,x=[];d.lastIndex=0;let S=d.exec(u.value);for(;S;){let I=S.index,v={index:S.index,input:S.input,stack:[...c,u]},A=p(...S,v);if(typeof A=="string"&&(A=A.length>0?{type:"text",value:A}:void 0),A===!1?d.lastIndex=I+1:(h!==I&&x.push({type:"text",value:u.value.slice(h,I)}),Array.isArray(A)?x.push(...A):A&&x.push(A),h=I+S[0].length,y=!0),!d.global)break;S=d.exec(u.value)}return y?(h<u.value.length&&x.push({type:"text",value:u.value.slice(h)}),m.children.splice(g,1,...x)):x=[u],g+x.length}}function QGe(e){let t=[];if(!Array.isArray(e))throw new TypeError("Expected find and replace tuple or list of tuples");let r=!e[0]||Array.isArray(e[0])?e:[e],n=-1;for(;++n<r.length;){let o=r[n];t.push([ZGe(o[0]),qGe(o[1])])}return t}function ZGe(e){return typeof e=="string"?new RegExp(zz(e),"g"):e}function qGe(e){return typeof e=="function"?e:function(){return e}}var jz="phrasing",Wz=["autolink","link","image","label"];function Qz(){return{transforms:[tUe],enter:{literalAutolink:YGe,literalAutolinkEmail:Xz,literalAutolinkHttp:Xz,literalAutolinkWww:Xz},exit:{literalAutolink:eUe,literalAutolinkEmail:$Ge,literalAutolinkHttp:KGe,literalAutolinkWww:JGe}}}function Zz(){return{unsafe:[{character:"@",before:"[+\\-.\\w]",after:"[\\-.\\w]",inConstruct:jz,notInConstruct:Wz},{character:".",before:"[Ww]",after:"[\\-.\\w]",inConstruct:jz,notInConstruct:Wz},{character:":",before:"[ps]",after:"\\/",inConstruct:jz,notInConstruct:Wz}]}}function YGe(e){this.enter({type:"link",title:null,url:"",children:[]},e)}function Xz(e){this.config.enter.autolinkProtocol.call(this,e)}function KGe(e){this.config.exit.autolinkProtocol.call(this,e)}function JGe(e){this.config.exit.data.call(this,e);let t=this.stack[this.stack.length-1];t.type,t.url="http://"+this.sliceSerialize(e)}function $Ge(e){this.config.exit.autolinkEmail.call(this,e)}function eUe(e){this.exit(e)}function tUe(e){Hz(e,[[/(https?:\/\/|www(?=\.))([-.\w]+)([^ \t\r\n]*)/gi,rUe],[/(?<=^|\s|\p{P}|\p{S})([-.\w+]+)@([-\w]+(?:\.[-\w]+)+)/gu,nUe]],{ignore:["link","linkReference"]})}function rUe(e,t,r,n,o){let i="";if(!iae(o)||(/^w/i.test(t)&&(r=t+r,t="",i="http://"),!oUe(r)))return!1;let a=iUe(r+n);if(!a[0])return!1;let s={type:"link",title:null,url:i+t+a[0],children:[{type:"text",value:t+a[0]}]};return a[1]?[s,{type:"text",value:a[1]}]:s}function nUe(e,t,r,n){return!iae(n,!0)||/[-\d_]$/.test(r)?!1:{type:"link",title:null,url:"mailto:"+t+"@"+r,children:[{type:"text",value:t+"@"+r}]}}function oUe(e){let t=e.split(".");return!(t.length<2||t[t.length-1]&&(/_/.test(t[t.length-1])||!/[a-zA-Z\d]/.test(t[t.length-1]))||t[t.length-2]&&(/_/.test(t[t.length-2])||!/[a-zA-Z\d]/.test(t[t.length-2])))}function iUe(e){let t=/[!"&'),.:;<>?\]}]+$/.exec(e);if(!t)return[e,void 0];e=e.slice(0,t.index);let r=t[0],n=r.indexOf(")"),o=Nz(e,"("),i=Nz(e,")");for(;n!==-1&&o>i;)e+=r.slice(0,n+1),r=r.slice(n+1),n=r.indexOf(")"),i++;return[e,r]}function iae(e,t){let r=e.input.charCodeAt(e.index-1);return(e.index===0||Nh(r)||iS(r))&&(!t||r!==47)}aae.peek=fUe;function aUe(){this.buffer()}function sUe(e){this.enter({type:"footnoteReference",identifier:"",label:""},e)}function lUe(){this.buffer()}function uUe(e){this.enter({type:"footnoteDefinition",identifier:"",label:"",children:[]},e)}function cUe(e){let t=this.resume(),r=this.stack[this.stack.length-1];r.type,r.identifier=rc(this.sliceSerialize(e)).toLowerCase(),r.label=t}function mUe(e){this.exit(e)}function dUe(e){let t=this.resume(),r=this.stack[this.stack.length-1];r.type,r.identifier=rc(this.sliceSerialize(e)).toLowerCase(),r.label=t}function pUe(e){this.exit(e)}function fUe(){return"["}function aae(e,t,r,n){let o=r.createTracker(n),i=o.move("[^"),a=r.enter("footnoteReference"),s=r.enter("reference");return i+=o.move(r.safe(r.associationId(e),{after:"]",before:i})),s(),a(),i+=o.move("]"),i}function qz(){return{enter:{gfmFootnoteCallString:aUe,gfmFootnoteCall:sUe,gfmFootnoteDefinitionLabelString:lUe,gfmFootnoteDefinition:uUe},exit:{gfmFootnoteCallString:cUe,gfmFootnoteCall:mUe,gfmFootnoteDefinitionLabelString:dUe,gfmFootnoteDefinition:pUe}}}function Yz(e){let t=!1;return e&&e.firstLineBlank&&(t=!0),{handlers:{footnoteDefinition:r,footnoteReference:aae},unsafe:[{character:"[",inConstruct:["label","phrasing","reference"]}]};function r(n,o,i,a){let s=i.createTracker(a),l=s.move("[^"),u=i.enter("footnoteDefinition"),c=i.enter("label");return l+=s.move(i.safe(i.associationId(n),{before:l,after:"]"})),c(),l+=s.move("]:"),n.children&&n.children.length>0&&(s.shift(4),l+=s.move((t?`
`:" ")+i.indentLines(i.containerFlow(n,s.current()),t?sae:hUe))),u(),l}}function hUe(e,t,r){return t===0?e:sae(e,t,r)}function sae(e,t,r){return(r?"":"    ")+e}var gUe=["autolink","destinationLiteral","destinationRaw","reference","titleQuote","titleApostrophe"];lae.peek=xUe;function Kz(){return{canContainEols:["delete"],enter:{strikethrough:yUe},exit:{strikethrough:bUe}}}function Jz(){return{unsafe:[{character:"~",inConstruct:"phrasing",notInConstruct:gUe}],handlers:{delete:lae}}}function yUe(e){this.enter({type:"delete",children:[]},e)}function bUe(e){this.exit(e)}function lae(e,t,r,n){let o=r.createTracker(n),i=r.enter("strikethrough"),a=o.move("~~");return a+=r.containerPhrasing(e,{...o.current(),before:a,after:"~"}),a+=o.move("~~"),i(),a}function xUe(){return"~"}function CUe(e){return e.length}function cae(e,t){let r=t||{},n=(r.align||[]).concat(),o=r.stringLength||CUe,i=[],a=[],s=[],l=[],u=0,c=-1;for(;++c<e.length;){let f=[],g=[],y=-1;for(e[c].length>u&&(u=e[c].length);++y<e[c].length;){let x=SUe(e[c][y]);if(r.alignDelimiters!==!1){let S=o(x);g[y]=S,(l[y]===void 0||S>l[y])&&(l[y]=S)}f.push(x)}a[c]=f,s[c]=g}let m=-1;if(typeof n=="object"&&"length"in n)for(;++m<u;)i[m]=uae(n[m]);else{let f=uae(n);for(;++m<u;)i[m]=f}m=-1;let d=[],p=[];for(;++m<u;){let f=i[m],g="",y="";f===99?(g=":",y=":"):f===108?g=":":f===114&&(y=":");let x=r.alignDelimiters===!1?1:Math.max(1,l[m]-g.length-y.length),S=g+"-".repeat(x)+y;r.alignDelimiters!==!1&&(x=g.length+x+y.length,x>l[m]&&(l[m]=x),p[m]=x),d[m]=S}a.splice(1,0,d),s.splice(1,0,p),c=-1;let h=[];for(;++c<a.length;){let f=a[c],g=s[c];m=-1;let y=[];for(;++m<u;){let x=f[m]||"",S="",I="";if(r.alignDelimiters!==!1){let v=l[m]-(g[m]||0),A=i[m];A===114?S=" ".repeat(v):A===99?v%2?(S=" ".repeat(v/2+.5),I=" ".repeat(v/2-.5)):(S=" ".repeat(v/2),I=S):I=" ".repeat(v)}r.delimiterStart!==!1&&!m&&y.push("|"),r.padding!==!1&&!(r.alignDelimiters===!1&&x==="")&&(r.delimiterStart!==!1||m)&&y.push(" "),r.alignDelimiters!==!1&&y.push(S),y.push(x),r.alignDelimiters!==!1&&y.push(I),r.padding!==!1&&y.push(" "),(r.delimiterEnd!==!1||m!==u-1)&&y.push("|")}h.push(r.delimiterEnd===!1?y.join("").replace(/ +$/,""):y.join(""))}return h.join(`
`)}function SUe(e){return e==null?"":String(e)}function uae(e){let t=typeof e=="string"?e.codePointAt(0):0;return t===67||t===99?99:t===76||t===108?108:t===82||t===114?114:0}function mae(e,t,r,n){let o=r.enter("blockquote"),i=r.createTracker(n);i.move("> "),i.shift(2);let a=r.indentLines(r.containerFlow(e,i.current()),vUe);return o(),a}function vUe(e,t,r){return">"+(r?"":" ")+e}function pae(e,t){return dae(e,t.inConstruct,!0)&&!dae(e,t.notInConstruct,!1)}function dae(e,t,r){if(typeof t=="string"&&(t=[t]),!t||t.length===0)return r;let n=-1;for(;++n<t.length;)if(e.includes(t[n]))return!0;return!1}function $z(e,t,r,n){let o=-1;for(;++o<r.unsafe.length;)if(r.unsafe[o].character===`
`&&pae(r.stack,r.unsafe[o]))return/[ \t]/.test(n.before)?"":" ";return`\\
`}function fae(e,t){let r=String(e),n=r.indexOf(t),o=n,i=0,a=0;if(typeof t!="string")throw new TypeError("Expected substring");for(;n!==-1;)n===o?++i>a&&(a=i):i=1,o=n+t.length,n=r.indexOf(t,o);return a}function hae(e,t){return!!(t.options.fences===!1&&e.value&&!e.lang&&/[^ \r\n]/.test(e.value)&&!/^[\t ]*(?:[\r\n]|$)|(?:^|[\r\n])[\t ]*$/.test(e.value))}function gae(e){let t=e.options.fence||"`";if(t!=="`"&&t!=="~")throw new Error("Cannot serialize code with `"+t+"` for `options.fence`, expected `` ` `` or `~`");return t}function yae(e,t,r,n){let o=gae(r),i=e.value||"",a=o==="`"?"GraveAccent":"Tilde";if(hae(e,r)){let m=r.enter("codeIndented"),d=r.indentLines(i,IUe);return m(),d}let s=r.createTracker(n),l=o.repeat(Math.max(fae(i,o)+1,3)),u=r.enter("codeFenced"),c=s.move(l);if(e.lang){let m=r.enter(`codeFencedLang${a}`);c+=s.move(r.safe(e.lang,{before:c,after:" ",encode:["`"],...s.current()})),m()}if(e.lang&&e.meta){let m=r.enter(`codeFencedMeta${a}`);c+=s.move(" "),c+=s.move(r.safe(e.meta,{before:c,after:`
`,encode:["`"],...s.current()})),m()}return c+=s.move(`
`),i&&(c+=s.move(i+`
`)),c+=s.move(l),u(),c}function IUe(e,t,r){return(r?"":"    ")+e}function Qv(e){let t=e.options.quote||'"';if(t!=='"'&&t!=="'")throw new Error("Cannot serialize title with `"+t+"` for `options.quote`, expected `\"`, or `'`");return t}function bae(e,t,r,n){let o=Qv(r),i=o==='"'?"Quote":"Apostrophe",a=r.enter("definition"),s=r.enter("label"),l=r.createTracker(n),u=l.move("[");return u+=l.move(r.safe(r.associationId(e),{before:u,after:"]",...l.current()})),u+=l.move("]: "),s(),!e.url||/[\0- \u007F]/.test(e.url)?(s=r.enter("destinationLiteral"),u+=l.move("<"),u+=l.move(r.safe(e.url,{before:u,after:">",...l.current()})),u+=l.move(">")):(s=r.enter("destinationRaw"),u+=l.move(r.safe(e.url,{before:u,after:e.title?" ":`
`,...l.current()}))),s(),e.title&&(s=r.enter(`title${i}`),u+=l.move(" "+o),u+=l.move(r.safe(e.title,{before:u,after:o,...l.current()})),u+=l.move(o),s()),a(),u}function xae(e){let t=e.options.emphasis||"*";if(t!=="*"&&t!=="_")throw new Error("Cannot serialize emphasis with `"+t+"` for `options.emphasis`, expected `*`, or `_`");return t}function Lx(e){return"&#x"+e.toString(16).toUpperCase()+";"}function Zv(e,t,r){let n=Gy(e),o=Gy(t);return n===void 0?o===void 0?r==="_"?{inside:!0,outside:!0}:{inside:!1,outside:!1}:o===1?{inside:!0,outside:!0}:{inside:!1,outside:!0}:n===1?o===void 0?{inside:!1,outside:!1}:o===1?{inside:!0,outside:!0}:{inside:!1,outside:!1}:o===void 0?{inside:!1,outside:!1}:o===1?{inside:!0,outside:!1}:{inside:!1,outside:!1}}eH.peek=AUe;function eH(e,t,r,n){let o=xae(r),i=r.enter("emphasis"),a=r.createTracker(n),s=a.move(o),l=a.move(r.containerPhrasing(e,{after:o,before:s,...a.current()})),u=l.charCodeAt(0),c=Zv(n.before.charCodeAt(n.before.length-1),u,o);c.inside&&(l=Lx(u)+l.slice(1));let m=l.charCodeAt(l.length-1),d=Zv(n.after.charCodeAt(0),m,o);d.inside&&(l=l.slice(0,-1)+Lx(m));let p=a.move(o);return i(),r.attentionEncodeSurroundingInfo={after:d.outside,before:c.outside},s+l+p}function AUe(e,t,r){return r.options.emphasis||"*"}function Cae(e,t){let r=!1;return cS(e,function(n){if("value"in n&&/\r?\n|\r/.test(n.value)||n.type==="break")return r=!0,uS}),!!((!e.depth||e.depth<3)&&nS(e)&&(t.options.setext||r))}function Sae(e,t,r,n){let o=Math.max(Math.min(6,e.depth||1),1),i=r.createTracker(n);if(Cae(e,r)){let c=r.enter("headingSetext"),m=r.enter("phrasing"),d=r.containerPhrasing(e,{...i.current(),before:`
`,after:`
`});return m(),c(),d+`
`+(o===1?"=":"-").repeat(d.length-(Math.max(d.lastIndexOf("\r"),d.lastIndexOf(`
`))+1))}let a="#".repeat(o),s=r.enter("headingAtx"),l=r.enter("phrasing");i.move(a+" ");let u=r.containerPhrasing(e,{before:"# ",after:`
`,...i.current()});return/^[\t ]/.test(u)&&(u=Lx(u.charCodeAt(0))+u.slice(1)),u=u?a+" "+u:a,r.options.closeAtx&&(u+=" "+a),l(),s(),u}tH.peek=TUe;function tH(e){return e.value||""}function TUe(){return"<"}rH.peek=PUe;function rH(e,t,r,n){let o=Qv(r),i=o==='"'?"Quote":"Apostrophe",a=r.enter("image"),s=r.enter("label"),l=r.createTracker(n),u=l.move("![");return u+=l.move(r.safe(e.alt,{before:u,after:"]",...l.current()})),u+=l.move("]("),s(),!e.url&&e.title||/[\0- \u007F]/.test(e.url)?(s=r.enter("destinationLiteral"),u+=l.move("<"),u+=l.move(r.safe(e.url,{before:u,after:">",...l.current()})),u+=l.move(">")):(s=r.enter("destinationRaw"),u+=l.move(r.safe(e.url,{before:u,after:e.title?" ":")",...l.current()}))),s(),e.title&&(s=r.enter(`title${i}`),u+=l.move(" "+o),u+=l.move(r.safe(e.title,{before:u,after:o,...l.current()})),u+=l.move(o),s()),u+=l.move(")"),a(),u}function PUe(){return"!"}nH.peek=_Ue;function nH(e,t,r,n){let o=e.referenceType,i=r.enter("imageReference"),a=r.enter("label"),s=r.createTracker(n),l=s.move("!["),u=r.safe(e.alt,{before:l,after:"]",...s.current()});l+=s.move(u+"]["),a();let c=r.stack;r.stack=[],a=r.enter("reference");let m=r.safe(r.associationId(e),{before:l,after:"]",...s.current()});return a(),r.stack=c,i(),o==="full"||!u||u!==m?l+=s.move(m+"]"):o==="shortcut"?l=l.slice(0,-1):l+=s.move("]"),l}function _Ue(){return"!"}oH.peek=RUe;function oH(e,t,r){let n=e.value||"",o="`",i=-1;for(;new RegExp("(^|[^`])"+o+"([^`]|$)").test(n);)o+="`";for(/[^ \r\n]/.test(n)&&(/^[ \r\n]/.test(n)&&/[ \r\n]$/.test(n)||/^`|`$/.test(n))&&(n=" "+n+" ");++i<r.unsafe.length;){let a=r.unsafe[i],s=r.compilePattern(a),l;if(a.atBreak)for(;l=s.exec(n);){let u=l.index;n.charCodeAt(u)===10&&n.charCodeAt(u-1)===13&&u--,n=n.slice(0,u)+" "+n.slice(l.index+1)}}return o+n+o}function RUe(){return"`"}function iH(e,t){let r=nS(e);return!!(!t.options.resourceLink&&e.url&&!e.title&&e.children&&e.children.length===1&&e.children[0].type==="text"&&(r===e.url||"mailto:"+r===e.url)&&/^[a-z][a-z+.-]+:/i.test(e.url)&&!/[\0- <>\u007F]/.test(e.url))}aH.peek=DUe;function aH(e,t,r,n){let o=Qv(r),i=o==='"'?"Quote":"Apostrophe",a=r.createTracker(n),s,l;if(iH(e,r)){let c=r.stack;r.stack=[],s=r.enter("autolink");let m=a.move("<");return m+=a.move(r.containerPhrasing(e,{before:m,after:">",...a.current()})),m+=a.move(">"),s(),r.stack=c,m}s=r.enter("link"),l=r.enter("label");let u=a.move("[");return u+=a.move(r.containerPhrasing(e,{before:u,after:"](",...a.current()})),u+=a.move("]("),l(),!e.url&&e.title||/[\0- \u007F]/.test(e.url)?(l=r.enter("destinationLiteral"),u+=a.move("<"),u+=a.move(r.safe(e.url,{before:u,after:">",...a.current()})),u+=a.move(">")):(l=r.enter("destinationRaw"),u+=a.move(r.safe(e.url,{before:u,after:e.title?" ":")",...a.current()}))),l(),e.title&&(l=r.enter(`title${i}`),u+=a.move(" "+o),u+=a.move(r.safe(e.title,{before:u,after:o,...a.current()})),u+=a.move(o),l()),u+=a.move(")"),s(),u}function DUe(e,t,r){return iH(e,r)?"<":"["}sH.peek=wUe;function sH(e,t,r,n){let o=e.referenceType,i=r.enter("linkReference"),a=r.enter("label"),s=r.createTracker(n),l=s.move("["),u=r.containerPhrasing(e,{before:l,after:"]",...s.current()});l+=s.move(u+"]["),a();let c=r.stack;r.stack=[],a=r.enter("reference");let m=r.safe(r.associationId(e),{before:l,after:"]",...s.current()});return a(),r.stack=c,i(),o==="full"||!u||u!==m?l+=s.move(m+"]"):o==="shortcut"?l=l.slice(0,-1):l+=s.move("]"),l}function wUe(){return"["}function qv(e){let t=e.options.bullet||"*";if(t!=="*"&&t!=="+"&&t!=="-")throw new Error("Cannot serialize items with `"+t+"` for `options.bullet`, expected `*`, `+`, or `-`");return t}function vae(e){let t=qv(e),r=e.options.bulletOther;if(!r)return t==="*"?"-":"*";if(r!=="*"&&r!=="+"&&r!=="-")throw new Error("Cannot serialize items with `"+r+"` for `options.bulletOther`, expected `*`, `+`, or `-`");if(r===t)throw new Error("Expected `bullet` (`"+t+"`) and `bulletOther` (`"+r+"`) to be different");return r}function Iae(e){let t=e.options.bulletOrdered||".";if(t!=="."&&t!==")")throw new Error("Cannot serialize items with `"+t+"` for `options.bulletOrdered`, expected `.` or `)`");return t}function uB(e){let t=e.options.rule||"*";if(t!=="*"&&t!=="-"&&t!=="_")throw new Error("Cannot serialize rules with `"+t+"` for `options.rule`, expected `*`, `-`, or `_`");return t}function Aae(e,t,r,n){let o=r.enter("list"),i=r.bulletCurrent,a=e.ordered?Iae(r):qv(r),s=e.ordered?a==="."?")":".":vae(r),l=t&&r.bulletLastUsed?a===r.bulletLastUsed:!1;if(!e.ordered){let c=e.children?e.children[0]:void 0;if((a==="*"||a==="-")&&c&&(!c.children||!c.children[0])&&r.stack[r.stack.length-1]==="list"&&r.stack[r.stack.length-2]==="listItem"&&r.stack[r.stack.length-3]==="list"&&r.stack[r.stack.length-4]==="listItem"&&r.indexStack[r.indexStack.length-1]===0&&r.indexStack[r.indexStack.length-2]===0&&r.indexStack[r.indexStack.length-3]===0&&(l=!0),uB(r)===a&&c){let m=-1;for(;++m<e.children.length;){let d=e.children[m];if(d&&d.type==="listItem"&&d.children&&d.children[0]&&d.children[0].type==="thematicBreak"){l=!0;break}}}}l&&(a=s),r.bulletCurrent=a;let u=r.containerFlow(e,n);return r.bulletLastUsed=a,r.bulletCurrent=i,o(),u}function Tae(e){let t=e.options.listItemIndent||"one";if(t!=="tab"&&t!=="one"&&t!=="mixed")throw new Error("Cannot serialize items with `"+t+"` for `options.listItemIndent`, expected `tab`, `one`, or `mixed`");return t}function Pae(e,t,r,n){let o=Tae(r),i=r.bulletCurrent||qv(r);t&&t.type==="list"&&t.ordered&&(i=(typeof t.start=="number"&&t.start>-1?t.start:1)+(r.options.incrementListMarker===!1?0:t.children.indexOf(e))+i);let a=i.length+1;(o==="tab"||o==="mixed"&&(t&&t.type==="list"&&t.spread||e.spread))&&(a=Math.ceil(a/4)*4);let s=r.createTracker(n);s.move(i+" ".repeat(a-i.length)),s.shift(a);let l=r.enter("listItem"),u=r.indentLines(r.containerFlow(e,s.current()),c);return l(),u;function c(m,d,p){return d?(p?"":" ".repeat(a))+m:(p?i:i+" ".repeat(a-i.length))+m}}function _ae(e,t,r,n){let o=r.enter("paragraph"),i=r.enter("phrasing"),a=r.containerPhrasing(e,n);return i(),o(),a}var lH=Fx(["break","delete","emphasis","footnote","footnoteReference","image","imageReference","inlineCode","inlineMath","link","linkReference","mdxJsxTextElement","mdxTextExpression","strong","text","textDirective"]);function Rae(e,t,r,n){return(e.children.some(function(a){return lH(a)})?r.containerPhrasing:r.containerFlow).call(r,e,n)}function Dae(e){let t=e.options.strong||"*";if(t!=="*"&&t!=="_")throw new Error("Cannot serialize strong with `"+t+"` for `options.strong`, expected `*`, or `_`");return t}uH.peek=MUe;function uH(e,t,r,n){let o=Dae(r),i=r.enter("strong"),a=r.createTracker(n),s=a.move(o+o),l=a.move(r.containerPhrasing(e,{after:o,before:s,...a.current()})),u=l.charCodeAt(0),c=Zv(n.before.charCodeAt(n.before.length-1),u,o);c.inside&&(l=Lx(u)+l.slice(1));let m=l.charCodeAt(l.length-1),d=Zv(n.after.charCodeAt(0),m,o);d.inside&&(l=l.slice(0,-1)+Lx(m));let p=a.move(o+o);return i(),r.attentionEncodeSurroundingInfo={after:d.outside,before:c.outside},s+l+p}function MUe(e,t,r){return r.options.strong||"*"}function wae(e,t,r,n){return r.safe(e.value,n)}function Mae(e){let t=e.options.ruleRepetition||3;if(t<3)throw new Error("Cannot serialize rules with repetition `"+t+"` for `options.ruleRepetition`, expected `3` or more");return t}function Bae(e,t,r){let n=(uB(r)+(r.options.ruleSpaces?" ":"")).repeat(Mae(r));return r.options.ruleSpaces?n.slice(0,-1):n}var i_={blockquote:mae,break:$z,code:yae,definition:bae,emphasis:eH,hardBreak:$z,heading:Sae,html:tH,image:rH,imageReference:nH,inlineCode:oH,link:aH,linkReference:sH,list:Aae,listItem:Pae,paragraph:_ae,root:Rae,strong:uH,text:wae,thematicBreak:Bae};function mH(){return{enter:{table:BUe,tableData:Eae,tableHeader:Eae,tableRow:kUe},exit:{codeText:FUe,table:EUe,tableData:cH,tableHeader:cH,tableRow:cH}}}function BUe(e){let t=e._align;this.enter({type:"table",align:t.map(function(r){return r==="none"?null:r}),children:[]},e),this.data.inTable=!0}function EUe(e){this.exit(e),this.data.inTable=void 0}function kUe(e){this.enter({type:"tableRow",children:[]},e)}function cH(e){this.exit(e)}function Eae(e){this.enter({type:"tableCell",children:[]},e)}function FUe(e){let t=this.resume();this.data.inTable&&(t=t.replace(/\\([\\|])/g,LUe));let r=this.stack[this.stack.length-1];r.type,r.value=t,this.exit(e)}function LUe(e,t){return t==="|"?t:e}function dH(e){let t=e||{},r=t.tableCellPadding,n=t.tablePipeAlign,o=t.stringLength,i=r?" ":"|";return{unsafe:[{character:"\r",inConstruct:"tableCell"},{character:`
`,inConstruct:"tableCell"},{atBreak:!0,character:"|",after:"[	 :-]"},{character:"|",inConstruct:"tableCell"},{atBreak:!0,character:":",after:"-"},{atBreak:!0,character:"-",after:"[:|-]"}],handlers:{inlineCode:d,table:a,tableCell:l,tableRow:s}};function a(p,h,f,g){return u(c(p,f,g),p.align)}function s(p,h,f,g){let y=m(p,f,g),x=u([y]);return x.slice(0,x.indexOf(`
`))}function l(p,h,f,g){let y=f.enter("tableCell"),x=f.enter("phrasing"),S=f.containerPhrasing(p,{...g,before:i,after:i});return x(),y(),S}function u(p,h){return cae(p,{align:h,alignDelimiters:n,padding:r,stringLength:o})}function c(p,h,f){let g=p.children,y=-1,x=[],S=h.enter("table");for(;++y<g.length;)x[y]=m(g[y],h,f);return S(),x}function m(p,h,f){let g=p.children,y=-1,x=[],S=h.enter("tableRow");for(;++y<g.length;)x[y]=l(g[y],p,h,f);return S(),x}function d(p,h,f){let g=i_.inlineCode(p,h,f);return f.stack.includes("tableCell")&&(g=g.replace(/\|/g,"\\$&")),g}}function pH(){return{exit:{taskListCheckValueChecked:kae,taskListCheckValueUnchecked:kae,paragraph:VUe}}}function fH(){return{unsafe:[{atBreak:!0,character:"-",after:"[:|-]"}],handlers:{listItem:OUe}}}function kae(e){let t=this.stack[this.stack.length-2];t.type,t.checked=e.type==="taskListCheckValueChecked"}function VUe(e){let t=this.stack[this.stack.length-2];if(t&&t.type==="listItem"&&typeof t.checked=="boolean"){let r=this.stack[this.stack.length-1];r.type;let n=r.children[0];if(n&&n.type==="text"){let o=t.children,i=-1,a;for(;++i<o.length;){let s=o[i];if(s.type==="paragraph"){a=s;break}}a===r&&(n.value=n.value.slice(1),n.value.length===0?r.children.shift():r.position&&n.position&&typeof n.position.start.offset=="number"&&(n.position.start.column++,n.position.start.offset++,r.position.start=Object.assign({},n.position.start)))}}this.exit(e)}function OUe(e,t,r,n){let o=e.children[0],i=typeof e.checked=="boolean"&&o&&o.type==="paragraph",a="["+(e.checked?"x":" ")+"] ",s=r.createTracker(n);i&&s.move(a);let l=i_.listItem(e,t,r,{...n,...s.current()});return i&&(l=l.replace(/^(?:[*+-]|\d+\.)([\r\n]| {1,3})/,u)),l;function u(c){return c+a}}function hH(){return[Qz(),qz(),Kz(),mH(),pH()]}function gH(e){return{extensions:[Zz(),Yz(e),Jz(),dH(e),fH()]}}var GUe={tokenize:jUe,partial:!0},Fae={tokenize:WUe,partial:!0},Lae={tokenize:XUe,partial:!0},Vae={tokenize:QUe,partial:!0},UUe={tokenize:ZUe,partial:!0},Oae={name:"wwwAutolink",tokenize:zUe,previous:Uae},Gae={name:"protocolAutolink",tokenize:HUe,previous:Nae},Uy={name:"emailAutolink",tokenize:NUe,previous:zae},Hh={};function bH(){return{text:Hh}}var dS=48;for(;dS<123;)Hh[dS]=Uy,dS++,dS===58?dS=65:dS===91&&(dS=97);Hh[43]=Uy;Hh[45]=Uy;Hh[46]=Uy;Hh[95]=Uy;Hh[72]=[Uy,Gae];Hh[104]=[Uy,Gae];Hh[87]=[Uy,Oae];Hh[119]=[Uy,Oae];function NUe(e,t,r){let n=this,o,i;return a;function a(m){return!yH(m)||!zae.call(n,n.previous)||xH(n.events)?r(m):(e.enter("literalAutolink"),e.enter("literalAutolinkEmail"),s(m))}function s(m){return yH(m)?(e.consume(m),s):m===64?(e.consume(m),l):r(m)}function l(m){return m===46?e.check(UUe,c,u)(m):m===45||m===95||gs(m)?(i=!0,e.consume(m),l):c(m)}function u(m){return e.consume(m),o=!0,l}function c(m){return i&&o&&Tl(n.previous)?(e.exit("literalAutolinkEmail"),e.exit("literalAutolink"),t(m)):r(m)}}function zUe(e,t,r){let n=this;return o;function o(a){return a!==87&&a!==119||!Uae.call(n,n.previous)||xH(n.events)?r(a):(e.enter("literalAutolink"),e.enter("literalAutolinkWww"),e.check(GUe,e.attempt(Fae,e.attempt(Lae,i),r),r)(a))}function i(a){return e.exit("literalAutolinkWww"),e.exit("literalAutolink"),t(a)}}function HUe(e,t,r){let n=this,o="",i=!1;return a;function a(m){return(m===72||m===104)&&Nae.call(n,n.previous)&&!xH(n.events)?(e.enter("literalAutolink"),e.enter("literalAutolinkHttp"),o+=String.fromCodePoint(m),e.consume(m),s):r(m)}function s(m){if(Tl(m)&&o.length<5)return o+=String.fromCodePoint(m),e.consume(m),s;if(m===58){let d=o.toLowerCase();if(d==="http"||d==="https")return e.consume(m),l}return r(m)}function l(m){return m===47?(e.consume(m),i?u:(i=!0,l)):r(m)}function u(m){return m===null||oS(m)||xo(m)||Nh(m)||iS(m)?r(m):e.attempt(Fae,e.attempt(Lae,c),r)(m)}function c(m){return e.exit("literalAutolinkHttp"),e.exit("literalAutolink"),t(m)}}function jUe(e,t,r){let n=0;return o;function o(a){return(a===87||a===119)&&n<3?(n++,e.consume(a),o):a===46&&n===3?(e.consume(a),i):r(a)}function i(a){return a===null?r(a):t(a)}}function WUe(e,t,r){let n,o,i;return a;function a(u){return u===46||u===95?e.check(Vae,l,s)(u):u===null||xo(u)||Nh(u)||u!==45&&iS(u)?l(u):(i=!0,e.consume(u),a)}function s(u){return u===95?n=!0:(o=n,n=void 0),e.consume(u),a}function l(u){return o||n||!i?r(u):t(u)}}function XUe(e,t){let r=0,n=0;return o;function o(a){return a===40?(r++,e.consume(a),o):a===41&&n<r?i(a):a===33||a===34||a===38||a===39||a===41||a===42||a===44||a===46||a===58||a===59||a===60||a===63||a===93||a===95||a===126?e.check(Vae,t,i)(a):a===null||xo(a)||Nh(a)?t(a):(e.consume(a),o)}function i(a){return a===41&&n++,e.consume(a),o}}function QUe(e,t,r){return n;function n(s){return s===33||s===34||s===39||s===41||s===42||s===44||s===46||s===58||s===59||s===63||s===95||s===126?(e.consume(s),n):s===38?(e.consume(s),i):s===93?(e.consume(s),o):s===60||s===null||xo(s)||Nh(s)?t(s):r(s)}function o(s){return s===null||s===40||s===91||xo(s)||Nh(s)?t(s):n(s)}function i(s){return Tl(s)?a(s):r(s)}function a(s){return s===59?(e.consume(s),n):Tl(s)?(e.consume(s),a):r(s)}}function ZUe(e,t,r){return n;function n(i){return e.consume(i),o}function o(i){return gs(i)?r(i):t(i)}}function Uae(e){return e===null||e===40||e===42||e===95||e===91||e===93||e===126||xo(e)}function Nae(e){return!Tl(e)}function zae(e){return!(e===47||yH(e))}function yH(e){return e===43||e===45||e===46||e===95||gs(e)}function xH(e){let t=e.length,r=!1;for(;t--;){let n=e[t][1];if((n.type==="labelLink"||n.type==="labelImage")&&!n._balanced){r=!0;break}if(n._gfmAutolinkLiteralWalkedInto){r=!1;break}}return e.length>0&&!r&&(e[e.length-1][1]._gfmAutolinkLiteralWalkedInto=!0),r}var qUe={tokenize:rNe,partial:!0};function CH(){return{document:{91:{name:"gfmFootnoteDefinition",tokenize:$Ue,continuation:{tokenize:eNe},exit:tNe}},text:{91:{name:"gfmFootnoteCall",tokenize:JUe},93:{name:"gfmPotentialFootnoteCall",add:"after",tokenize:YUe,resolveTo:KUe}}}}function YUe(e,t,r){let n=this,o=n.events.length,i=n.parser.gfmFootnotes||(n.parser.gfmFootnotes=[]),a;for(;o--;){let l=n.events[o][1];if(l.type==="labelImage"){a=l;break}if(l.type==="gfmFootnoteCall"||l.type==="labelLink"||l.type==="label"||l.type==="image"||l.type==="link")break}return s;function s(l){if(!a||!a._balanced)return r(l);let u=rc(n.sliceSerialize({start:a.end,end:n.now()}));return u.codePointAt(0)!==94||!i.includes(u.slice(1))?r(l):(e.enter("gfmFootnoteCallLabelMarker"),e.consume(l),e.exit("gfmFootnoteCallLabelMarker"),t(l))}}function KUe(e,t){let r=e.length,n;for(;r--;)if(e[r][1].type==="labelImage"&&e[r][0]==="enter"){n=e[r][1];break}e[r+1][1].type="data",e[r+3][1].type="gfmFootnoteCallLabelMarker";let o={type:"gfmFootnoteCall",start:Object.assign({},e[r+3][1].start),end:Object.assign({},e[e.length-1][1].end)},i={type:"gfmFootnoteCallMarker",start:Object.assign({},e[r+3][1].end),end:Object.assign({},e[r+3][1].end)};i.end.column++,i.end.offset++,i.end._bufferIndex++;let a={type:"gfmFootnoteCallString",start:Object.assign({},i.end),end:Object.assign({},e[e.length-1][1].start)},s={type:"chunkString",contentType:"string",start:Object.assign({},a.start),end:Object.assign({},a.end)},l=[e[r+1],e[r+2],["enter",o,t],e[r+3],e[r+4],["enter",i,t],["exit",i,t],["enter",a,t],["enter",s,t],["exit",s,t],["exit",a,t],e[e.length-2],e[e.length-1],["exit",o,t]];return e.splice(r,e.length-r+1,...l),e}function JUe(e,t,r){let n=this,o=n.parser.gfmFootnotes||(n.parser.gfmFootnotes=[]),i=0,a;return s;function s(m){return e.enter("gfmFootnoteCall"),e.enter("gfmFootnoteCallLabelMarker"),e.consume(m),e.exit("gfmFootnoteCallLabelMarker"),l}function l(m){return m!==94?r(m):(e.enter("gfmFootnoteCallMarker"),e.consume(m),e.exit("gfmFootnoteCallMarker"),e.enter("gfmFootnoteCallString"),e.enter("chunkString").contentType="string",u)}function u(m){if(i>999||m===93&&!a||m===null||m===91||xo(m))return r(m);if(m===93){e.exit("chunkString");let d=e.exit("gfmFootnoteCallString");return o.includes(rc(n.sliceSerialize(d)))?(e.enter("gfmFootnoteCallLabelMarker"),e.consume(m),e.exit("gfmFootnoteCallLabelMarker"),e.exit("gfmFootnoteCall"),t):r(m)}return xo(m)||(a=!0),i++,e.consume(m),m===92?c:u}function c(m){return m===91||m===92||m===93?(e.consume(m),i++,u):u(m)}}function $Ue(e,t,r){let n=this,o=n.parser.gfmFootnotes||(n.parser.gfmFootnotes=[]),i,a=0,s;return l;function l(h){return e.enter("gfmFootnoteDefinition")._container=!0,e.enter("gfmFootnoteDefinitionLabel"),e.enter("gfmFootnoteDefinitionLabelMarker"),e.consume(h),e.exit("gfmFootnoteDefinitionLabelMarker"),u}function u(h){return h===94?(e.enter("gfmFootnoteDefinitionMarker"),e.consume(h),e.exit("gfmFootnoteDefinitionMarker"),e.enter("gfmFootnoteDefinitionLabelString"),e.enter("chunkString").contentType="string",c):r(h)}function c(h){if(a>999||h===93&&!s||h===null||h===91||xo(h))return r(h);if(h===93){e.exit("chunkString");let f=e.exit("gfmFootnoteDefinitionLabelString");return i=rc(n.sliceSerialize(f)),e.enter("gfmFootnoteDefinitionLabelMarker"),e.consume(h),e.exit("gfmFootnoteDefinitionLabelMarker"),e.exit("gfmFootnoteDefinitionLabel"),d}return xo(h)||(s=!0),a++,e.consume(h),h===92?m:c}function m(h){return h===91||h===92||h===93?(e.consume(h),a++,c):c(h)}function d(h){return h===58?(e.enter("definitionMarker"),e.consume(h),e.exit("definitionMarker"),o.includes(i)||o.push(i),hn(e,p,"gfmFootnoteDefinitionWhitespace")):r(h)}function p(h){return t(h)}}function eNe(e,t,r){return e.check(zh,t,e.attempt(qUe,t,r))}function tNe(e){e.exit("gfmFootnoteDefinition")}function rNe(e,t,r){let n=this;return hn(e,o,"gfmFootnoteDefinitionIndent",5);function o(i){let a=n.events[n.events.length-1];return a&&a[1].type==="gfmFootnoteDefinitionIndent"&&a[2].sliceSerialize(a[1],!0).length===4?t(i):r(i)}}function SH(e){let r=(e||{}).singleTilde,n={name:"strikethrough",tokenize:i,resolveAll:o};return r==null&&(r=!0),{text:{126:n},insideSpan:{null:[n]},attentionMarkers:{null:[126]}};function o(a,s){let l=-1;for(;++l<a.length;)if(a[l][0]==="enter"&&a[l][1].type==="strikethroughSequenceTemporary"&&a[l][1]._close){let u=l;for(;u--;)if(a[u][0]==="exit"&&a[u][1].type==="strikethroughSequenceTemporary"&&a[u][1]._open&&a[l][1].end.offset-a[l][1].start.offset===a[u][1].end.offset-a[u][1].start.offset){a[l][1].type="strikethroughSequence",a[u][1].type="strikethroughSequence";let c={type:"strikethrough",start:Object.assign({},a[u][1].start),end:Object.assign({},a[l][1].end)},m={type:"strikethroughText",start:Object.assign({},a[u][1].end),end:Object.assign({},a[l][1].start)},d=[["enter",c,s],["enter",a[u][1],s],["exit",a[u][1],s],["enter",m,s]],p=s.parser.constructs.insideSpan.null;p&&Os(d,d.length,0,Ex(p,a.slice(u+1,l),s)),Os(d,d.length,0,[["exit",m,s],["enter",a[l][1],s],["exit",a[l][1],s],["exit",c,s]]),Os(a,u-1,l-u+3,d),l=u+d.length-2;break}}for(l=-1;++l<a.length;)a[l][1].type==="strikethroughSequenceTemporary"&&(a[l][1].type="data");return a}function i(a,s,l){let u=this.previous,c=this.events,m=0;return d;function d(h){return u===126&&c[c.length-1][1].type!=="characterEscape"?l(h):(a.enter("strikethroughSequenceTemporary"),p(h))}function p(h){let f=Gy(u);if(h===126)return m>1?l(h):(a.consume(h),m++,p);if(m<2&&!r)return l(h);let g=a.exit("strikethroughSequenceTemporary"),y=Gy(h);return g._open=!y||y===2&&!!f,g._close=!f||f===2&&!!y,s(h)}}}var cB=class{constructor(){this.map=[]}add(t,r,n){nNe(this,t,r,n)}consume(t){if(this.map.sort(function(i,a){return i[0]-a[0]}),this.map.length===0)return;let r=this.map.length,n=[];for(;r>0;)r-=1,n.push(t.slice(this.map[r][0]+this.map[r][1]),this.map[r][2]),t.length=this.map[r][0];n.push(t.slice()),t.length=0;let o=n.pop();for(;o;){for(let i of o)t.push(i);o=n.pop()}this.map.length=0}};function nNe(e,t,r,n){let o=0;if(!(r===0&&n.length===0)){for(;o<e.map.length;){if(e.map[o][0]===t){e.map[o][1]+=r,e.map[o][2].push(...n);return}o+=1}e.map.push([t,r,n])}}function Hae(e,t){let r=!1,n=[];for(;t<e.length;){let o=e[t];if(r){if(o[0]==="enter")o[1].type==="tableContent"&&n.push(e[t+1][1].type==="tableDelimiterMarker"?"left":"none");else if(o[1].type==="tableContent"){if(e[t-1][1].type==="tableDelimiterMarker"){let i=n.length-1;n[i]=n[i]==="left"?"center":"right"}}else if(o[1].type==="tableDelimiterRow")break}else o[0]==="enter"&&o[1].type==="tableDelimiterRow"&&(r=!0);t+=1}return n}function vH(){return{flow:{null:{name:"table",tokenize:oNe,resolveAll:iNe}}}}function oNe(e,t,r){let n=this,o=0,i=0,a;return s;function s(w){let E=n.events.length-1;for(;E>-1;){let B=n.events[E][1].type;if(B==="lineEnding"||B==="linePrefix")E--;else break}let M=E>-1?n.events[E][1].type:null,D=M==="tableHead"||M==="tableRow"?A:l;return D===A&&n.parser.lazy[n.now().line]?r(w):D(w)}function l(w){return e.enter("tableHead"),e.enter("tableRow"),u(w)}function u(w){return w===124||(a=!0,i+=1),c(w)}function c(w){return w===null?r(w):Ar(w)?i>1?(i=0,n.interrupt=!0,e.exit("tableRow"),e.enter("lineEnding"),e.consume(w),e.exit("lineEnding"),p):r(w):xn(w)?hn(e,c,"whitespace")(w):(i+=1,a&&(a=!1,o+=1),w===124?(e.enter("tableCellDivider"),e.consume(w),e.exit("tableCellDivider"),a=!0,c):(e.enter("data"),m(w)))}function m(w){return w===null||w===124||xo(w)?(e.exit("data"),c(w)):(e.consume(w),w===92?d:m)}function d(w){return w===92||w===124?(e.consume(w),m):m(w)}function p(w){return n.interrupt=!1,n.parser.lazy[n.now().line]?r(w):(e.enter("tableDelimiterRow"),a=!1,xn(w)?hn(e,h,"linePrefix",n.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(w):h(w))}function h(w){return w===45||w===58?g(w):w===124?(a=!0,e.enter("tableCellDivider"),e.consume(w),e.exit("tableCellDivider"),f):v(w)}function f(w){return xn(w)?hn(e,g,"whitespace")(w):g(w)}function g(w){return w===58?(i+=1,a=!0,e.enter("tableDelimiterMarker"),e.consume(w),e.exit("tableDelimiterMarker"),y):w===45?(i+=1,y(w)):w===null||Ar(w)?I(w):v(w)}function y(w){return w===45?(e.enter("tableDelimiterFiller"),x(w)):v(w)}function x(w){return w===45?(e.consume(w),x):w===58?(a=!0,e.exit("tableDelimiterFiller"),e.enter("tableDelimiterMarker"),e.consume(w),e.exit("tableDelimiterMarker"),S):(e.exit("tableDelimiterFiller"),S(w))}function S(w){return xn(w)?hn(e,I,"whitespace")(w):I(w)}function I(w){return w===124?h(w):w===null||Ar(w)?!a||o!==i?v(w):(e.exit("tableDelimiterRow"),e.exit("tableHead"),t(w)):v(w)}function v(w){return r(w)}function A(w){return e.enter("tableRow"),P(w)}function P(w){return w===124?(e.enter("tableCellDivider"),e.consume(w),e.exit("tableCellDivider"),P):w===null||Ar(w)?(e.exit("tableRow"),t(w)):xn(w)?hn(e,P,"whitespace")(w):(e.enter("data"),T(w))}function T(w){return w===null||w===124||xo(w)?(e.exit("data"),P(w)):(e.consume(w),w===92?R:T)}function R(w){return w===92||w===124?(e.consume(w),T):T(w)}}function iNe(e,t){let r=-1,n=!0,o=0,i=[0,0,0,0],a=[0,0,0,0],s=!1,l=0,u,c,m,d=new cB;for(;++r<e.length;){let p=e[r],h=p[1];p[0]==="enter"?h.type==="tableHead"?(s=!1,l!==0&&(jae(d,t,l,u,c),c=void 0,l=0),u={type:"table",start:Object.assign({},h.start),end:Object.assign({},h.end)},d.add(r,0,[["enter",u,t]])):h.type==="tableRow"||h.type==="tableDelimiterRow"?(n=!0,m=void 0,i=[0,0,0,0],a=[0,r+1,0,0],s&&(s=!1,c={type:"tableBody",start:Object.assign({},h.start),end:Object.assign({},h.end)},d.add(r,0,[["enter",c,t]])),o=h.type==="tableDelimiterRow"?2:c?3:1):o&&(h.type==="data"||h.type==="tableDelimiterMarker"||h.type==="tableDelimiterFiller")?(n=!1,a[2]===0&&(i[1]!==0&&(a[0]=a[1],m=mB(d,t,i,o,void 0,m),i=[0,0,0,0]),a[2]=r)):h.type==="tableCellDivider"&&(n?n=!1:(i[1]!==0&&(a[0]=a[1],m=mB(d,t,i,o,void 0,m)),i=a,a=[i[1],r,0,0])):h.type==="tableHead"?(s=!0,l=r):h.type==="tableRow"||h.type==="tableDelimiterRow"?(l=r,i[1]!==0?(a[0]=a[1],m=mB(d,t,i,o,r,m)):a[1]!==0&&(m=mB(d,t,a,o,r,m)),o=0):o&&(h.type==="data"||h.type==="tableDelimiterMarker"||h.type==="tableDelimiterFiller")&&(a[3]=r)}for(l!==0&&jae(d,t,l,u,c),d.consume(t.events),r=-1;++r<t.events.length;){let p=t.events[r];p[0]==="enter"&&p[1].type==="table"&&(p[1]._align=Hae(t.events,r))}return e}function mB(e,t,r,n,o,i){let a=n===1?"tableHeader":n===2?"tableDelimiter":"tableData",s="tableContent";r[0]!==0&&(i.end=Object.assign({},Yv(t.events,r[0])),e.add(r[0],0,[["exit",i,t]]));let l=Yv(t.events,r[1]);if(i={type:a,start:Object.assign({},l),end:Object.assign({},l)},e.add(r[1],0,[["enter",i,t]]),r[2]!==0){let u=Yv(t.events,r[2]),c=Yv(t.events,r[3]),m={type:s,start:Object.assign({},u),end:Object.assign({},c)};if(e.add(r[2],0,[["enter",m,t]]),n!==2){let d=t.events[r[2]],p=t.events[r[3]];if(d[1].end=Object.assign({},p[1].end),d[1].type="chunkText",d[1].contentType="text",r[3]>r[2]+1){let h=r[2]+1,f=r[3]-r[2]-1;e.add(h,f,[])}}e.add(r[3]+1,0,[["exit",m,t]])}return o!==void 0&&(i.end=Object.assign({},Yv(t.events,o)),e.add(o,0,[["exit",i,t]]),i=void 0),i}function jae(e,t,r,n,o){let i=[],a=Yv(t.events,r);o&&(o.end=Object.assign({},a),i.push(["exit",o,t])),n.end=Object.assign({},a),i.push(["exit",n,t]),e.add(r+1,0,i)}function Yv(e,t){let r=e[t],n=r[0]==="enter"?"start":"end";return r[1][n]}var aNe={name:"tasklistCheck",tokenize:sNe};function IH(){return{text:{91:aNe}}}function sNe(e,t,r){let n=this;return o;function o(l){return n.previous!==null||!n._gfmTasklistFirstContentOfListItem?r(l):(e.enter("taskListCheck"),e.enter("taskListCheckMarker"),e.consume(l),e.exit("taskListCheckMarker"),i)}function i(l){return xo(l)?(e.enter("taskListCheckValueUnchecked"),e.consume(l),e.exit("taskListCheckValueUnchecked"),a):l===88||l===120?(e.enter("taskListCheckValueChecked"),e.consume(l),e.exit("taskListCheckValueChecked"),a):r(l)}function a(l){return l===93?(e.enter("taskListCheckMarker"),e.consume(l),e.exit("taskListCheckMarker"),e.exit("taskListCheck"),s):r(l)}function s(l){return Ar(l)?t(l):xn(l)?e.check({tokenize:lNe},t,r)(l):r(l)}}function lNe(e,t,r){return hn(e,n,"whitespace");function n(o){return o===null?r(o):t(o)}}function Wae(e){return OM([bH(),CH(),SH(e),vH(),IH()])}var uNe={};function dB(e){let t=this,r=e||uNe,n=t.data(),o=n.micromarkExtensions||(n.micromarkExtensions=[]),i=n.fromMarkdownExtensions||(n.fromMarkdownExtensions=[]),a=n.toMarkdownExtensions||(n.toMarkdownExtensions=[]);o.push(Wae(r)),i.push(hH()),a.push(gH(r))}var Lt={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflower:6591981,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,laserlemon:16777044,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrod:16448210,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,maroon2:8323072,maroon3:11546720,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,purple2:8323199,purple3:10494192,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},mFt=(function(){let e=new Map;return Object.keys(Lt).forEach(t=>{e.set(Lt[t],t)}),e})();var cNe=/^#([0-9A-F]{3}){1,2}$/i,mNe=/^rgb\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)$/i;function Vx(e){if(e==null)return;let t;if(cNe.test(e)&&(e.length===4&&(e=`#${e[1]}${e[1]}${e[2]}${e[2]}${e[3]}${e[3]}`),t=Le.fromHexStyle(e),t!==void 0&&!isNaN(t))||(t=Lt[e.toLowerCase()],t!==void 0))return t;let r=mNe.exec(e);if(r){let n=parseInt(r[1],10),o=parseInt(r[2],10),i=parseInt(r[3],10);if(n>=0&&n<=255&&o>=0&&o<=255&&i>=0&&i<=255)return Le.fromRgb(n,o,i)}}function pB(e){let t=e.length,r=[];if(e.every(o=>Array.isArray(o))){let o=[...e];if(!o[0])return"linear-gradient(to right, #000 0%, #000 100%)";o.sort((i,a)=>i[1]-a[1]),r.push(`${Le.toStyle(o[0][0])} ${(100*o[0][1]).toFixed(2)}%`);for(let i=0,a=o.length-1;i<a;++i){let[s,l]=o[i],[u,c]=o[i+1],m=l+(c-l)/2;r.push(`${Le.toStyle(s)} ${(100*m).toFixed(2)}%`,`${Le.toStyle(u)} ${(100*m).toFixed(2)}%`)}r.push(`${Le.toStyle(o[o.length-1][0])} ${(100*o[o.length-1][1]).toFixed(2)}%`)}else{r.push(`${Kv(e[0])} ${100*(1/t)}%`);for(let o=1,i=t-1;o<i;++o)r.push(`${Kv(e[o])} ${100*(o/t)}%`,`${Kv(e[o])} ${100*((o+1)/t)}%`);r.push(`${Kv(e[t-1])} ${100*((t-1)/t)}%`)}return`linear-gradient(to right, ${r.join(", ")})`}function fB(e){if(e.length===0)return"linear-gradient(to right, #000 0%, #000 100%)";let t=e.every(n=>Array.isArray(n)),r;if(t){let n=[...e];n.sort((o,i)=>o[1]-i[1]),r=n.map(o=>Kv(o,!0))}else r=e.map(n=>Kv(n));return`linear-gradient(to right, ${r.join(", ")})`}function Kv(e,t=!1){return Array.isArray(e)?t?`${Le.toStyle(e[0])} ${(100*e[1]).toFixed(2)}%`:Le.toStyle(e[0]):Le.toStyle(e)}function Xae(e,t=/,/){let r=[],n=e.replace(/\s+/g,""),o=0,i=0;for(let a=0,s=n.length;a<s;++a){let l=n[a];if(l==="("){i++;continue}else if(l===")"){i>0&&i--;continue}if(i>0||!t.test(l))continue;let u=n.substring(o,a);o=a+1;let c=Vx(u);c!==void 0&&r.push(c)}if(o<n.length){let a=n.substring(o),s=Vx(a);console.log(a,s),s!==void 0&&r.push(s)}return r}var Lc=_t(ur());function hB({children:e,components:t}){return(0,Lc.jsxs)("div",{className:"msp-markdown",children:[(0,Lc.jsx)(dNe,{}),(0,Lc.jsx)(o_,{skipHtml:!0,components:{a:gNe,img:pNe,...t},remarkPlugins:[dB],children:e})]})}function dNe(){let e=(0,Ff.useRef)(null),t=(0,Ff.useContext)(Al),r=Ol(t?.managers.markdownExtensions.state.audioPlayer);return(0,Ff.useEffect)(()=>{if(e.current)return e.current.appendChild(r),()=>{r?.remove()}},[r]),r?(0,Lc.jsx)("div",{className:"msp-markdown-audio-player",ref:e}):null}function pNe({src:e,element:t,alt:r}){let n=(0,Ff.useContext)(Al);if(!e)return t;AH(n);let o=n?.managers.markdownExtensions.parseArgs(e);if(o)return n?.managers.markdownExtensions.tryRender(o,hNe)??t;{let i=n?.managers.markdownExtensions.tryResolveUri(e);if(typeof i?.then=="function")return(0,Lc.jsx)(fNe,{alt:r,data:i});if(typeof i=="string"&&i)return(0,Lc.jsx)("img",{src:i,alt:r})}return(0,Lc.jsx)("img",{src:e,alt:r})}function fNe({alt:e,data:t}){let[r,n]=(0,Ff.useState)(void 0);return(0,Ff.useEffect)(()=>{let o=!0;return t.then(i=>{o&&n(i)}).catch(i=>{console.error("Failed to load static image",i),o&&n(void 0)}),()=>{o=!1}},[t]),r?(0,Lc.jsx)("img",{src:r,alt:e}):null}var hNe=[{name:"color-swatch",reactRenderFn:({args:e})=>{let t=e["color-swatch"];return t?(0,Lc.jsx)("span",{style:{display:"inline-block",width:"0.75em",height:"0.75em",backgroundColor:t,borderRadius:"25%"}}):null}},{name:"color-palette",reactRenderFn:({args:e})=>{let t=e["color-palette-name"],r=e["color-palette-colors"],n=e["color-palette-width"]??"150px",o=e["color-palette-height"]??"0.5em",i="color-palette-discrete"in e;if(!t&&!r)return null;let a=r?Xae(r):Sr[t.toLowerCase()]?.list;return a?.length?(0,Lc.jsx)("span",{style:{display:"inline-block",minWidth:n,height:o,background:(i?pB:fB)(a),borderRadius:"2px"}}):(console.warn("Color palette could not be resolved.",e),null)}}];function gNe({href:e,children:t,element:r}){let n=(0,Ff.useContext)(Al);if(!e)return r;AH(n);let o=n?.managers.markdownExtensions.parseArgs(e);return o?(0,Lc.jsx)("a",{href:"#",onClick:i=>{i.preventDefault(),n?.managers.markdownExtensions.tryExecute("click",o)},onMouseEnter:()=>n?.managers.markdownExtensions.tryExecute("mouse-enter",o),onMouseLeave:()=>n?.managers.markdownExtensions.tryExecute("mouse-leave",o),children:t}):e[0]==="#"?(AH(n),(0,Lc.jsx)("a",{href:"#",onClick:i=>{i.preventDefault(),n?.managers.snapshot.applyKey(e.substring(1))},children:t})):e?(0,Lc.jsxs)("a",{href:e,target:"_blank",rel:"noopener noreferrer",children:[t,"\u2934"]}):t}function AH(e){e||console.warn("Markdown component requires a PluginReactContext to be set.")}var Ki=_t(ur()),PH=class extends Pc{constructor(r){super();this.options=r;this.root=void 0;this.state=new Di({all:[]});this.context=tv(r?.context)}get viewer(){return this.context.state.viewers.value?.find(r=>this.options?.viewerName===r.name)}sync(){let r=this.viewer?.model.plugin?.managers.snapshot;this.state.next({entry:r?.current,index:r?.current?r?.getIndex(r.current):void 0,all:r?.state.entries.toArray()??[]})}async mount(r){this.root=r,(0,Qae.createRoot)(r).render((0,Ki.jsx)(bNe,{model:this}));let n,o;this.subscribe(this.context.state.viewers.pipe(D0(i=>i.find(a=>this.options?.viewerName===a.name)),FP((i,a)=>i?.model===a?.model)),i=>{n!==i&&(n=i?.model,o?.unsubscribe()),i&&(o=this.subscribe(i.model.plugin?.managers.snapshot.events.changed,()=>{this.sync()}),this.sync())}),this.sync()}};function yNe(){return(0,Ki.jsxs)("div",{children:[(0,Ki.jsx)("div",{style:{marginBottom:16},children:(0,Ki.jsx)("i",{children:"Loading times may vary depending on the story size, your internet connection, and device performance"})}),(0,Ki.jsxs)("div",{children:["Fetching data",(0,Ki.jsx)(TH,{})]}),(0,Ki.jsxs)("div",{children:["Generating animations",(0,Ki.jsx)(TH,{})]}),(0,Ki.jsxs)("div",{children:["Preparing visuals",(0,Ki.jsx)(TH,{})]})]})}function TH(){let[e,t]=(0,gB.useState)(0);return(0,gB.useEffect)(()=>{let r=setInterval(()=>{t(n=>(n+1)%4)},Math.random()*500+300);return()=>clearInterval(r)},[]),(0,Ki.jsx)("span",{children:".".repeat(e)})}function bNe({model:e}){let t=Ol(e.state),r=Ol(e.context.state.isLoading),n={display:"flex",flexDirection:"column",height:"100%"},o="mvs-stories-markdown-explanation";return r?(0,Ki.jsxs)("div",{style:n,className:o,children:[(0,Ki.jsx)("h3",{children:"The story will be ready momentarily"}),(0,Ki.jsx)(yNe,{})]}):t.all.length===0?(0,Ki.jsx)("div",{style:n,className:o,children:(0,Ki.jsx)("i",{children:"No snapshot loaded or no description available"})}):(0,Ki.jsxs)("div",{style:n,className:o,children:[(0,Ki.jsxs)("div",{style:{display:"flex",flexDirection:"row",width:"100%",gap:"8px"},children:[(0,Ki.jsxs)("span",{style:{lineHeight:"38px",minWidth:60,maxWidth:60,flexShrink:0},children:[typeof t.index=="number"?t.index+1:"-","/",t.all.length]}),(0,Ki.jsx)("button",{onClick:()=>e.viewer?.model.plugin?.managers.snapshot.applyNext(-1),style:{flexGrow:1,flexShrink:0},children:"Prev"}),(0,Ki.jsx)("button",{onClick:()=>e.viewer?.model.plugin?.managers.snapshot.applyNext(1),style:{flexGrow:1,flexShrink:0},children:"Next"})]}),(0,Ki.jsx)("div",{style:{flexGrow:1,overflow:"hidden",overflowY:"auto",position:"relative"},children:(0,Ki.jsx)("div",{style:{position:"absolute",inset:0},children:(0,Ki.jsx)(Al.Provider,{value:e.viewer?.model.plugin,children:(0,Ki.jsx)(hB,{children:t.entry?.description??"Description not available"})})})})]})}var _H=class extends HTMLElement{constructor(){super();this.model=void 0}async connectedCallback(){this.model=new PH({context:{name:this.getAttribute("context-name")??void 0},viewerName:this.getAttribute("viewer-name")??void 0}),await this.model.mount(this)}disconnectedCallback(){this.model?.dispose(),this.model=void 0}};window.customElements.define("mvs-stories-snapshot-markdown",_H);var Gn;(o=>{function e(){return i=>t(i)}o.factory=e;function t(i){return class{constructor(s,l){this.data=s;this.id=fn.create22();this.type=i;this.label=l&&l.label||i.name,this.description=l&&l.description}static{this.type=i}static is(s){return!!s&&i===s.type}}}o.create=t;function r(i,a){if(!i.tags)return!1;for(let s of i.tags)if(s===a)return!0;return!1}o.hasTag=r,o.Null={id:fn.create22(),type:{name:"Null",typeClass:"Null"},data:void 0,label:"Null"}})(Gn||={});var a_;(r=>{function e(n){let o=n;return!!o&&!!o.transform&&!!o.parent&&!!o.status}r.is=e;function t(n,o){let i=typeof o=="string"?o:r.is(o)?o.transform.ref:o.ref;return n.cells.get(i)}r.resolve=t})(a_||={});var Jv=class{constructor(t,r){this.ref=t;this.state=r}get cell(){return this.state?.cells.get(this.ref)}get obj(){return this.state?.cells.get(this.ref)?.obj}get data(){return this.obj?.data}update(t,r){if(!this.state)throw new Error("To use update() from StateObjectSelector, 'state' must be defined.");return r||(r=this.state.build()),(r||this.state.build()).to(this).update(t),r}checkValid(){if(!this.state)throw new Error("Unassigned State.");let t=this.cell;if(!t)throw new Error("Not created at all. Did you await/then the corresponding state update?");if(t.status==="ok")return!0;throw t.status==="error"?new Error(t.errorText):t.obj===Gn.Null?new Error("The object is Null."):new Error("Unresolved. Did you await/then the corresponding state update?")}get isOk(){let t=this.cell;return t&&t.status==="ok"&&t.obj!==Gn.Null}},ci;(n=>{function e(o){if(o)return typeof o=="string"?o:a_.is(o)?o.transform.ref:o.cell?.transform.ref}n.resolveRef=e;function t(o,i){if(i)return a_.is(i)?i:typeof i=="string"?o.cells.get(i):i.cell}n.resolve=t;function r(o,i){let a=t(o,i);if(!(!a||!a.obj||a.status!=="ok"))return a}n.resolveAndCheck=r})(ci||={});var vB="@@__IMMUTABLE_INDEXED__@@";function up(e){return!!(e&&e[vB])}var IB="@@__IMMUTABLE_KEYED__@@";function Ba(e){return!!(e&&e[IB])}function HH(e){return Ba(e)||up(e)}var bse="@@__IMMUTABLE_ITERABLE__@@";function gd(e){return!!(e&&e[bse])}var oc=function(t){return gd(t)?t:Am(t)},cp=(function(e){function t(r){return Ba(r)?r:Hx(r)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t})(oc),fS=(function(e){function t(r){return up(r)?r:Lf(r)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t})(oc),sI=(function(e){function t(r){return gd(r)&&!HH(r)?r:cI(r)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t})(oc);oc.Keyed=cp;oc.Indexed=fS;oc.Set=sI;var lI=0,yd=1,bd=2,kH=typeof Symbol=="function"&&Symbol.iterator,xse="@@iterator",PB=kH||xse,ri=function(t){this.next=t};ri.prototype.toString=function(){return"[Iterator]"};ri.KEYS=lI;ri.VALUES=yd;ri.ENTRIES=bd;ri.prototype.inspect=ri.prototype.toSource=function(){return this.toString()};ri.prototype[PB]=function(){return this};function Ea(e,t,r,n){var o=e===lI?t:e===yd?r:[t,r];return n?n.value=o:n={value:o,done:!1},n}function Oc(){return{value:void 0,done:!0}}function Cse(e){return Array.isArray(e)?!0:!!_B(e)}function Zae(e){return!!(e&&typeof e.next=="function")}function FH(e){var t=_B(e);return t&&t.call(e)}function _B(e){var t=e&&(kH&&e[kH]||e[xse]);if(typeof t=="function")return t}function xNe(e){var t=_B(e);return t&&t===e.entries}function CNe(e){var t=_B(e);return t&&t===e.keys}var b_="delete",$i=5,fd=1<<$i,Vc=fd-1,No={};function LH(){return{value:!1}}function lp(e){e&&(e.value=!0)}function jH(){}function $v(e){return e.size===void 0&&(e.size=e.__iterate(Sse)),e.size}function Ux(e,t){if(typeof t!="number"){var r=t>>>0;if(""+r!==t||r===4294967295)return NaN;t=r}return t<0?$v(e)+t:t}function Sse(){return!0}function RB(e,t,r){return(e===0&&!Ise(e)||r!==void 0&&e<=-r)&&(t===void 0||r!==void 0&&t>=r)}function x_(e,t){return vse(e,t,0)}function DB(e,t){return vse(e,t,t)}function vse(e,t,r){return e===void 0?r:Ise(e)?t===1/0?t:Math.max(0,t+e)|0:t===void 0||t===e?e:Math.min(t,e)|0}function Ise(e){return e<0||e===0&&1/e===-1/0}var Ase="@@__IMMUTABLE_RECORD__@@";function hS(e){return!!(e&&e[Ase])}function Qh(e){return gd(e)||hS(e)}var Nx="@@__IMMUTABLE_ORDERED__@@";function Xh(e){return!!(e&&e[Nx])}var Tse="@@__IMMUTABLE_SEQ__@@";function WH(e){return!!(e&&e[Tse])}var uI=Object.prototype.hasOwnProperty;function Pse(e){return Array.isArray(e)||typeof e=="string"?!0:e&&typeof e=="object"&&Number.isInteger(e.length)&&e.length>=0&&(e.length===0?Object.keys(e).length===1:e.hasOwnProperty(e.length-1))}var Am=(function(e){function t(r){return r==null?QH():Qh(r)?r.toSeq():vNe(r)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.toSeq=function(){return this},t.prototype.toString=function(){return this.__toString("Seq {","}")},t.prototype.cacheResult=function(){return!this._cache&&this.__iterateUncached&&(this._cache=this.entrySeq().toArray(),this.size=this._cache.length),this},t.prototype.__iterate=function(n,o){var i=this._cache;if(i){for(var a=i.length,s=0;s!==a;){var l=i[o?a-++s:s++];if(n(l[1],l[0],this)===!1)break}return s}return this.__iterateUncached(n,o)},t.prototype.__iterator=function(n,o){var i=this._cache;if(i){var a=i.length,s=0;return new ri(function(){if(s===a)return Oc();var l=i[o?a-++s:s++];return Ea(n,l[0],l[1])})}return this.__iteratorUncached(n,o)},t})(oc),Hx=(function(e){function t(r){return r==null?QH().toKeyedSeq():gd(r)?Ba(r)?r.toSeq():r.fromEntrySeq():hS(r)?r.toSeq():ZH(r)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.toKeyedSeq=function(){return this},t})(Am),Lf=(function(e){function t(r){return r==null?QH():gd(r)?Ba(r)?r.entrySeq():r.toIndexedSeq():hS(r)?r.toSeq().entrySeq():_se(r)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.of=function(){return t(arguments)},t.prototype.toIndexedSeq=function(){return this},t.prototype.toString=function(){return this.__toString("Seq [","]")},t})(Am),cI=(function(e){function t(r){return(gd(r)&&!HH(r)?r:Lf(r)).toSetSeq()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.of=function(){return t(arguments)},t.prototype.toSetSeq=function(){return this},t})(Am);Am.isSeq=WH;Am.Keyed=Hx;Am.Set=cI;Am.Indexed=Lf;Am.prototype[Tse]=!0;var eI=(function(e){function t(r){this._array=r,this.size=r.length}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.get=function(n,o){return this.has(n)?this._array[Ux(this,n)]:o},t.prototype.__iterate=function(n,o){for(var i=this._array,a=i.length,s=0;s!==a;){var l=o?a-++s:s++;if(n(i[l],l,this)===!1)break}return s},t.prototype.__iterator=function(n,o){var i=this._array,a=i.length,s=0;return new ri(function(){if(s===a)return Oc();var l=o?a-++s:s++;return Ea(n,l,i[l])})},t})(Lf),XH=(function(e){function t(r){var n=Object.keys(r).concat(Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(r):[]);this._object=r,this._keys=n,this.size=n.length}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.get=function(n,o){return o!==void 0&&!this.has(n)?o:this._object[n]},t.prototype.has=function(n){return uI.call(this._object,n)},t.prototype.__iterate=function(n,o){for(var i=this._object,a=this._keys,s=a.length,l=0;l!==s;){var u=a[o?s-++l:l++];if(n(i[u],u,this)===!1)break}return l},t.prototype.__iterator=function(n,o){var i=this._object,a=this._keys,s=a.length,l=0;return new ri(function(){if(l===s)return Oc();var u=a[o?s-++l:l++];return Ea(n,u,i[u])})},t})(Hx);XH.prototype[Nx]=!0;var SNe=(function(e){function t(r){this._collection=r,this.size=r.length||r.size}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.__iterateUncached=function(n,o){if(o)return this.cacheResult().__iterate(n,o);var i=this._collection,a=FH(i),s=0;if(Zae(a))for(var l;!(l=a.next()).done&&n(l.value,s++,this)!==!1;);return s},t.prototype.__iteratorUncached=function(n,o){if(o)return this.cacheResult().__iterator(n,o);var i=this._collection,a=FH(i);if(!Zae(a))return new ri(Oc);var s=0;return new ri(function(){var l=a.next();return l.done?l:Ea(n,s++,l.value)})},t})(Lf),qae;function QH(){return qae||(qae=new eI([]))}function ZH(e){var t=qH(e);if(t)return t.fromEntrySeq();if(typeof e=="object")return new XH(e);throw new TypeError("Expected Array or collection object of [k, v] entries, or keyed object: "+e)}function _se(e){var t=qH(e);if(t)return t;throw new TypeError("Expected Array or collection object of values: "+e)}function vNe(e){var t=qH(e);if(t)return xNe(e)?t.fromEntrySeq():CNe(e)?t.toSetSeq():t;if(typeof e=="object")return new XH(e);throw new TypeError("Expected Array or collection object of values, or keyed object: "+e)}function qH(e){return Pse(e)?new eI(e):Cse(e)?new SNe(e):void 0}function C_(){return this.__ensureOwner()}function S_(){return this.__ownerID?this:this.__ensureOwner(new jH)}var s_=typeof Math.imul=="function"&&Math.imul(4294967295,2)===-2?Math.imul:function(t,r){t|=0,r|=0;var n=t&65535,o=r&65535;return n*o+((t>>>16)*o+n*(r>>>16)<<16>>>0)|0};function wB(e){return e>>>1&1073741824|e&3221225471}var INe=Object.prototype.valueOf;function dd(e){if(e==null)return Yae(e);if(typeof e.hashCode=="function")return wB(e.hashCode(e));var t=DNe(e);if(t==null)return Yae(t);switch(typeof t){case"boolean":return t?1108378657:1108378656;case"number":return ANe(t);case"string":return t.length>wNe?TNe(t):VH(t);case"object":case"function":return _Ne(t);case"symbol":return PNe(t);default:if(typeof t.toString=="function")return VH(t.toString());throw new Error("Value type "+typeof t+" cannot be hashed.")}}function Yae(e){return e===null?1108378658:1108378659}function ANe(e){if(e!==e||e===1/0)return 0;var t=e|0;for(t!==e&&(t^=e*4294967295);e>4294967295;)e/=4294967295,t^=e;return wB(t)}function TNe(e){var t=wH[e];return t===void 0&&(t=VH(e),DH===MNe&&(DH=0,wH={}),DH++,wH[e]=t),t}function VH(e){for(var t=0,r=0;r<e.length;r++)t=31*t+e.charCodeAt(r)|0;return wB(t)}function PNe(e){var t=$ae[e];return t!==void 0||(t=Rse(),$ae[e]=t),t}function _Ne(e){var t;if(OH&&(t=GH.get(e),t!==void 0)||(t=e[pS],t!==void 0)||!Jae&&(t=e.propertyIsEnumerable&&e.propertyIsEnumerable[pS],t!==void 0||(t=RNe(e),t!==void 0)))return t;if(t=Rse(),OH)GH.set(e,t);else{if(Kae!==void 0&&Kae(e)===!1)throw new Error("Non-extensible objects are not allowed as keys.");if(Jae)Object.defineProperty(e,pS,{enumerable:!1,configurable:!1,writable:!1,value:t});else if(e.propertyIsEnumerable!==void 0&&e.propertyIsEnumerable===e.constructor.prototype.propertyIsEnumerable)e.propertyIsEnumerable=function(){return this.constructor.prototype.propertyIsEnumerable.apply(this,arguments)},e.propertyIsEnumerable[pS]=t;else if(e.nodeType!==void 0)e[pS]=t;else throw new Error("Unable to set a non-enumerable property on object.")}return t}var Kae=Object.isExtensible,Jae=(function(){try{return Object.defineProperty({},"@",{}),!0}catch{return!1}})();function RNe(e){if(e&&e.nodeType>0)switch(e.nodeType){case 1:return e.uniqueID;case 9:return e.documentElement&&e.documentElement.uniqueID}}function DNe(e){return e.valueOf!==INe&&typeof e.valueOf=="function"?e.valueOf(e):e}function Rse(){var e=++RH;return RH&1073741824&&(RH=0),e}var OH=typeof WeakMap=="function",GH;OH&&(GH=new WeakMap);var $ae=Object.create(null),RH=0,pS="__immutablehash__";typeof Symbol=="function"&&(pS=Symbol(pS));var wNe=16,MNe=255,DH=0,wH={},MB=(function(e){function t(r,n){this._iter=r,this._useKeys=n,this.size=r.size}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.get=function(n,o){return this._iter.get(n,o)},t.prototype.has=function(n){return this._iter.has(n)},t.prototype.valueSeq=function(){return this._iter.valueSeq()},t.prototype.reverse=function(){var n=this,o=YH(this,!0);return this._useKeys||(o.valueSeq=function(){return n._iter.toSeq().reverse()}),o},t.prototype.map=function(n,o){var i=this,a=Ese(this,n,o);return this._useKeys||(a.valueSeq=function(){return i._iter.toSeq().map(n,o)}),a},t.prototype.__iterate=function(n,o){var i=this;return this._iter.__iterate(function(a,s){return n(a,s,i)},o)},t.prototype.__iterator=function(n,o){return this._iter.__iterator(n,o)},t})(Hx);MB.prototype[Nx]=!0;var Dse=(function(e){function t(r){this._iter=r,this.size=r.size}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.includes=function(n){return this._iter.includes(n)},t.prototype.__iterate=function(n,o){var i=this,a=0;return o&&$v(this),this._iter.__iterate(function(s){return n(s,o?i.size-++a:a++,i)},o)},t.prototype.__iterator=function(n,o){var i=this,a=this._iter.__iterator(yd,o),s=0;return o&&$v(this),new ri(function(){var l=a.next();return l.done?l:Ea(n,o?i.size-++s:s++,l.value,l)})},t})(Lf),wse=(function(e){function t(r){this._iter=r,this.size=r.size}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.has=function(n){return this._iter.includes(n)},t.prototype.__iterate=function(n,o){var i=this;return this._iter.__iterate(function(a){return n(a,a,i)},o)},t.prototype.__iterator=function(n,o){var i=this._iter.__iterator(yd,o);return new ri(function(){var a=i.next();return a.done?a:Ea(n,a.value,a.value,a)})},t})(cI),Mse=(function(e){function t(r){this._iter=r,this.size=r.size}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.entrySeq=function(){return this._iter.toSeq()},t.prototype.__iterate=function(n,o){var i=this;return this._iter.__iterate(function(a){if(a){tse(a);var s=gd(a);return n(s?a.get(1):a[1],s?a.get(0):a[0],i)}},o)},t.prototype.__iterator=function(n,o){var i=this._iter.__iterator(yd,o);return new ri(function(){for(;;){var a=i.next();if(a.done)return a;var s=a.value;if(s){tse(s);var l=gd(s);return Ea(n,l?s.get(0):s[0],l?s.get(1):s[1],a)}}})},t})(Hx);Dse.prototype.cacheResult=MB.prototype.cacheResult=wse.prototype.cacheResult=Mse.prototype.cacheResult=$H;function Bse(e){var t=Zh(e);return t._iter=e,t.size=e.size,t.flip=function(){return e},t.reverse=function(){var r=e.reverse.apply(this);return r.flip=function(){return e.reverse()},r},t.has=function(r){return e.includes(r)},t.includes=function(r){return e.has(r)},t.cacheResult=$H,t.__iterateUncached=function(r,n){var o=this;return e.__iterate(function(i,a){return r(a,i,o)!==!1},n)},t.__iteratorUncached=function(r,n){if(r===bd){var o=e.__iterator(r,n);return new ri(function(){var i=o.next();if(!i.done){var a=i.value[0];i.value[0]=i.value[1],i.value[1]=a}return i})}return e.__iterator(r===yd?lI:yd,n)},t}function Ese(e,t,r){var n=Zh(e);return n.size=e.size,n.has=function(o){return e.has(o)},n.get=function(o,i){var a=e.get(o,No);return a===No?i:t.call(r,a,o,e)},n.__iterateUncached=function(o,i){var a=this;return e.__iterate(function(s,l,u){return o(t.call(r,s,l,u),l,a)!==!1},i)},n.__iteratorUncached=function(o,i){var a=e.__iterator(bd,i);return new ri(function(){var s=a.next();if(s.done)return s;var l=s.value,u=l[0];return Ea(o,u,t.call(r,l[1],u,e),s)})},n}function YH(e,t){var r=this,n=Zh(e);return n._iter=e,n.size=e.size,n.reverse=function(){return e},e.flip&&(n.flip=function(){var o=Bse(e);return o.reverse=function(){return e.flip()},o}),n.get=function(o,i){return e.get(t?o:-1-o,i)},n.has=function(o){return e.has(t?o:-1-o)},n.includes=function(o){return e.includes(o)},n.cacheResult=$H,n.__iterate=function(o,i){var a=this,s=0;return i&&$v(e),e.__iterate(function(l,u){return o(l,t?u:i?a.size-++s:s++,a)},!i)},n.__iterator=function(o,i){var a=0;i&&$v(e);var s=e.__iterator(bd,!i);return new ri(function(){var l=s.next();if(l.done)return l;var u=l.value;return Ea(o,t?u[0]:i?r.size-++a:a++,u[1],l)})},n}function kse(e,t,r,n){var o=Zh(e);return n&&(o.has=function(i){var a=e.get(i,No);return a!==No&&!!t.call(r,a,i,e)},o.get=function(i,a){var s=e.get(i,No);return s!==No&&t.call(r,s,i,e)?s:a}),o.__iterateUncached=function(i,a){var s=this,l=0;return e.__iterate(function(u,c,m){if(t.call(r,u,c,m))return l++,i(u,n?c:l-1,s)},a),l},o.__iteratorUncached=function(i,a){var s=e.__iterator(bd,a),l=0;return new ri(function(){for(;;){var u=s.next();if(u.done)return u;var c=u.value,m=c[0],d=c[1];if(t.call(r,d,m,e))return Ea(i,n?m:l++,d,u)}})},o}function BNe(e,t,r){var n=Cd().asMutable();return e.__iterate(function(o,i){n.update(t.call(r,o,i,e),0,function(a){return a+1})}),n.asImmutable()}function ENe(e,t,r){var n=Ba(e),o=(Xh(e)?tl():Cd()).asMutable();e.__iterate(function(a,s){o.update(t.call(r,a,s,e),function(l){return l=l||[],l.push(n?[s,a]:a),l})});var i=JH(e);return o.map(function(a){return Ji(e,i(a))}).asImmutable()}function kNe(e,t,r){var n=Ba(e),o=[[],[]];e.__iterate(function(a,s){o[t.call(r,a,s,e)?1:0].push(n?[s,a]:a)});var i=JH(e);return o.map(function(a){return Ji(e,i(a))})}function KH(e,t,r,n){var o=e.size;if(RB(t,r,o))return e;if(typeof o>"u"&&(t<0||r<0))return KH(e.toSeq().cacheResult(),t,r,n);var i=x_(t,o),a=DB(r,o),s=a-i,l;s===s&&(l=s<0?0:s);var u=Zh(e);return u.size=l===0?l:e.size&&l||void 0,!n&&WH(e)&&l>=0&&(u.get=function(c,m){return c=Ux(this,c),c>=0&&c<l?e.get(c+i,m):m}),u.__iterateUncached=function(c,m){var d=this;if(l===0)return 0;if(m)return this.cacheResult().__iterate(c,m);var p=0,h=!0,f=0;return e.__iterate(function(g,y){if(!(h&&(h=p++<i)))return f++,c(g,n?y:f-1,d)!==!1&&f!==l}),f},u.__iteratorUncached=function(c,m){if(l!==0&&m)return this.cacheResult().__iterator(c,m);if(l===0)return new ri(Oc);var d=e.__iterator(c,m),p=0,h=0;return new ri(function(){for(;p++<i;)d.next();if(++h>l)return Oc();var f=d.next();return n||c===yd||f.done?f:c===lI?Ea(c,h-1,void 0,f):Ea(c,h-1,f.value[1],f)})},u}function FNe(e,t,r){var n=Zh(e);return n.__iterateUncached=function(o,i){var a=this;if(i)return this.cacheResult().__iterate(o,i);var s=0;return e.__iterate(function(l,u,c){return t.call(r,l,u,c)&&++s&&o(l,u,a)}),s},n.__iteratorUncached=function(o,i){var a=this;if(i)return this.cacheResult().__iterator(o,i);var s=e.__iterator(bd,i),l=!0;return new ri(function(){if(!l)return Oc();var u=s.next();if(u.done)return u;var c=u.value,m=c[0],d=c[1];return t.call(r,d,m,a)?o===bd?u:Ea(o,m,d,u):(l=!1,Oc())})},n}function Fse(e,t,r,n){var o=Zh(e);return o.__iterateUncached=function(i,a){var s=this;if(a)return this.cacheResult().__iterate(i,a);var l=!0,u=0;return e.__iterate(function(c,m,d){if(!(l&&(l=t.call(r,c,m,d))))return u++,i(c,n?m:u-1,s)}),u},o.__iteratorUncached=function(i,a){var s=this;if(a)return this.cacheResult().__iterator(i,a);var l=e.__iterator(bd,a),u=!0,c=0;return new ri(function(){var m,d,p;do{if(m=l.next(),m.done)return n||i===yd?m:i===lI?Ea(i,c++,void 0,m):Ea(i,c++,m.value[1],m);var h=m.value;d=h[0],p=h[1],u&&(u=t.call(r,p,d,s))}while(u);return i===bd?m:Ea(i,d,p,m)})},o}var LNe=(function(e){function t(r){this._wrappedIterables=r.flatMap(function(n){return n._wrappedIterables?n._wrappedIterables:[n]}),this.size=this._wrappedIterables.reduce(function(n,o){if(n!==void 0){var i=o.size;if(i!==void 0)return n+i}},0),this[IB]=this._wrappedIterables[0][IB],this[vB]=this._wrappedIterables[0][vB],this[Nx]=this._wrappedIterables[0][Nx]}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.__iterateUncached=function(n,o){if(this._wrappedIterables.length!==0){if(o)return this.cacheResult().__iterate(n,o);for(var i=0,a=Ba(this),s=a?bd:yd,l=this._wrappedIterables[i].__iterator(s,o),u=!0,c=0;u;){for(var m=l.next();m.done;){if(i++,i===this._wrappedIterables.length)return c;l=this._wrappedIterables[i].__iterator(s,o),m=l.next()}var d=a?n(m.value[1],m.value[0],this):n(m.value,c,this);u=d!==!1,c++}return c}},t.prototype.__iteratorUncached=function(n,o){var i=this;if(this._wrappedIterables.length===0)return new ri(Oc);if(o)return this.cacheResult().__iterator(n,o);var a=0,s=this._wrappedIterables[a].__iterator(n,o);return new ri(function(){for(var l=s.next();l.done;){if(a++,a===i._wrappedIterables.length)return l;s=i._wrappedIterables[a].__iterator(n,o),l=s.next()}return l})},t})(Am);function VNe(e,t){var r=Ba(e),n=[e].concat(t).map(function(i){return gd(i)?r&&(i=cp(i)):i=r?ZH(i):_se(Array.isArray(i)?i:[i]),i}).filter(function(i){return i.size!==0});if(n.length===0)return e;if(n.length===1){var o=n[0];if(o===e||r&&Ba(o)||up(e)&&up(o))return o}return new LNe(n)}function Lse(e,t,r){var n=Zh(e);return n.__iterateUncached=function(o,i){if(i)return this.cacheResult().__iterate(o,i);var a=0,s=!1;function l(u,c){u.__iterate(function(m,d){return(!t||c<t)&&gd(m)?l(m,c+1):(a++,o(m,r?d:a-1,n)===!1&&(s=!0)),!s},i)}return l(e,0),a},n.__iteratorUncached=function(o,i){if(i)return this.cacheResult().__iterator(o,i);var a=e.__iterator(o,i),s=[],l=0;return new ri(function(){for(;a;){var u=a.next();if(u.done!==!1){a=s.pop();continue}var c=u.value;if(o===bd&&(c=c[1]),(!t||s.length<t)&&gd(c))s.push(a),a=c.__iterator(o,i);else return r?u:Ea(o,l++,c,u)}return Oc()})},n}function ONe(e,t,r){var n=JH(e);return e.toSeq().map(function(o,i){return n(t.call(r,o,i,e))}).flatten(!0)}function GNe(e,t){var r=Zh(e);return r.size=e.size&&e.size*2-1,r.__iterateUncached=function(n,o){var i=this,a=0;return e.__iterate(function(s){return(!a||n(t,a++,i)!==!1)&&n(s,a++,i)!==!1},o),a},r.__iteratorUncached=function(n,o){var i=e.__iterator(yd,o),a=0,s;return new ri(function(){return(!s||a%2)&&(s=i.next(),s.done)?s:a%2?Ea(n,a++,t):Ea(n,a++,s.value,s)})},r}function tI(e,t,r){t||(t=Vse);var n=Ba(e),o=0,i=e.toSeq().map(function(a,s){return[s,a,o++,r?r(a,s,e):a]}).valueSeq().toArray();return i.sort(function(a,s){return t(a[3],s[3])||a[2]-s[2]}).forEach(n?function(a,s){i[s].length=2}:function(a,s){i[s]=a[1]}),n?Hx(i):up(e)?Lf(i):cI(i)}function yB(e,t,r){if(t||(t=Vse),r){var n=e.toSeq().map(function(o,i){return[o,r(o,i,e)]}).reduce(function(o,i){return ese(t,o[1],i[1])?i:o});return n&&n[0]}return e.reduce(function(o,i){return ese(t,o,i)?i:o})}function ese(e,t,r){var n=e(r,t);return n===0&&r!==t&&(r==null||r!==r)||n>0}function bB(e,t,r,n){var o=Zh(e),i=new eI(r).map(function(a){return a.size});return o.size=n?i.max():i.min(),o.__iterate=function(a,s){for(var l=this.__iterator(yd,s),u,c=0;!(u=l.next()).done&&a(u.value,c++,this)!==!1;);return c},o.__iteratorUncached=function(a,s){var l=r.map(function(m){return m=oc(m),FH(s?m.reverse():m)}),u=0,c=!1;return new ri(function(){var m;return c||(m=l.map(function(d){return d.next()}),c=n?m.every(function(d){return d.done}):m.some(function(d){return d.done})),c?Oc():Ea(a,u++,t.apply(null,m.map(function(d){return d.value})))})},o}function Ji(e,t){return e===t?e:WH(e)?t:e.constructor(t)}function tse(e){if(e!==Object(e))throw new TypeError("Expected [K, V] tuple: "+e)}function JH(e){return Ba(e)?cp:up(e)?fS:sI}function Zh(e){return Object.create((Ba(e)?Hx:up(e)?Lf:cI).prototype)}function $H(){return this._iter.cacheResult?(this._iter.cacheResult(),this.size=this._iter.size,this):Am.prototype.cacheResult.call(this)}function Vse(e,t){return e===void 0&&t===void 0?0:e===void 0?1:t===void 0?-1:e>t?1:e<t?-1:0}function rse(e){return!!(e&&typeof e.equals=="function"&&typeof e.hashCode=="function")}function hd(e,t){if(e===t||e!==e&&t!==t)return!0;if(!e||!t)return!1;if(typeof e.valueOf=="function"&&typeof t.valueOf=="function"){if(e=e.valueOf(),t=t.valueOf(),e===t||e!==e&&t!==t)return!0;if(!e||!t)return!1}return!!(rse(e)&&rse(t)&&e.equals(t))}function Ose(e,t,r,n){return mI(e,[t],r,n)}function Gse(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];return Nse(this,e)}function Use(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];if(typeof e!="function")throw new TypeError("Invalid merger function: "+e);return Nse(this,t,e)}function Nse(e,t,r){for(var n=[],o=0;o<t.length;o++){var i=cp(t[o]);i.size!==0&&n.push(i)}return n.length===0?e:e.toSeq().size===0&&!e.__ownerID&&n.length===1?hS(e)?e:e.constructor(n[0]):e.withMutations(function(a){for(var s=r?function(u,c){Ose(a,c,No,function(m){return m===No?u:r(m,u,c)})}:function(u,c){a.set(c,u)},l=0;l<n.length;l++)n[l].forEach(s)})}var UNe=Object.prototype.toString;function NNe(e){if(!e||typeof e!="object"||UNe.call(e)!=="[object Object]")return!1;var t=Object.getPrototypeOf(e);if(t===null)return!0;for(var r=t,n=Object.getPrototypeOf(t);n!==null;)r=n,n=Object.getPrototypeOf(r);return r===t}function zx(e){return typeof e=="object"&&(Qh(e)||Array.isArray(e)||NNe(e))}function jh(e,t){t=t||0;for(var r=Math.max(0,e.length-t),n=new Array(r),o=0;o<r;o++)n[o]=e[o+t];return n}function AB(e){if(Array.isArray(e))return jh(e);var t={};for(var r in e)uI.call(e,r)&&(t[r]=e[r]);return t}function e9(e,t,r){return t9(e,t,zNe(r))}function t9(e,t,r){if(!zx(e))throw new TypeError("Cannot merge into non-data-structure value: "+e);if(Qh(e))return typeof r=="function"&&e.mergeWith?e.mergeWith.apply(e,[r].concat(t)):e.merge?e.merge.apply(e,t):e.concat.apply(e,t);for(var n=Array.isArray(e),o=e,i=n?fS:cp,a=n?function(l){o===e&&(o=AB(o)),o.push(l)}:function(l,u){var c=uI.call(o,u),m=c&&r?r(o[u],l,u):l;(!c||m!==o[u])&&(o===e&&(o=AB(o)),o[u]=m)},s=0;s<t.length;s++)i(t[s]).forEach(a);return o}function zNe(e){function t(r,n,o){return zx(r)&&zx(n)&&HNe(r,n)?t9(r,[n],t):e?e(r,n,o):n}return t}function HNe(e,t){var r=Am(e),n=Am(t);return up(r)===up(n)&&Ba(r)===Ba(n)}function zse(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];return e9(this,e)}function Hse(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];return e9(this,t,e)}function r9(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];return mI(this,e,Wh(),function(n){return e9(n,t)})}function n9(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];return mI(this,e,Wh(),function(n){return t9(n,t)})}function jNe(e,t,r){return mI(e,t,No,function(){return r})}function o9(e,t){return jNe(this,e,t)}function i9(e,t,r){return arguments.length===1?e(this):Ose(this,e,t,r)}function a9(e,t,r){return mI(this,e,t,r)}function s9(){return this.__altered}function v_(e){var t=this.asMutable();return e(t),t.wasAltered()?t.__ensureOwner(this.__ownerID):this}var jse="@@__IMMUTABLE_MAP__@@";function l9(e){return!!(e&&e[jse])}function m_(e,t){if(!e)throw new Error(t)}function pd(e){m_(e!==1/0,"Cannot perform this action with an infinite size.")}var Cd=(function(e){function t(r){return r==null?Wh():l9(r)&&!Xh(r)?r:Wh().withMutations(function(n){var o=e(r);pd(o.size),o.forEach(function(i,a){return n.set(a,i)})})}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.toString=function(){return this.__toString("Map {","}")},t.prototype.get=function(n,o){return this._root?this._root.get(0,void 0,n,o):o},t.prototype.set=function(n,o){return ise(this,n,o)},t.prototype.remove=function(n){return ise(this,n,No)},t.prototype.deleteAll=function(n){var o=oc(n);return o.size===0?this:this.withMutations(function(i){o.forEach(function(a){return i.remove(a)})})},t.prototype.clear=function(){return this.size===0?this:this.__ownerID?(this.size=0,this._root=null,this.__hash=void 0,this.__altered=!0,this):Wh()},t.prototype.sort=function(n){return tl(tI(this,n))},t.prototype.sortBy=function(n,o){return tl(tI(this,o,n))},t.prototype.map=function(n,o){var i=this;return this.withMutations(function(a){a.forEach(function(s,l){a.set(l,n.call(o,s,l,i))})})},t.prototype.__iterator=function(n,o){return new WNe(this,n,o)},t.prototype.__iterate=function(n,o){var i=this,a=0;return this._root&&this._root.iterate(function(s){return a++,n(s[1],s[0],i)},o),a},t.prototype.__ensureOwner=function(n){return n===this.__ownerID?this:n?u9(this.size,this._root,n,this.__hash):this.size===0?Wh():(this.__ownerID=n,this.__altered=!1,this)},t})(cp);Cd.isMap=l9;var Ta=Cd.prototype;Ta[jse]=!0;Ta[b_]=Ta.remove;Ta.removeAll=Ta.deleteAll;Ta.setIn=o9;Ta.removeIn=Ta.deleteIn=d9;Ta.update=i9;Ta.updateIn=a9;Ta.merge=Ta.concat=Gse;Ta.mergeWith=Use;Ta.mergeDeep=zse;Ta.mergeDeepWith=Hse;Ta.mergeIn=n9;Ta.mergeDeepIn=r9;Ta.withMutations=v_;Ta.wasAltered=s9;Ta.asImmutable=C_;Ta["@@transducer/init"]=Ta.asMutable=S_;Ta["@@transducer/step"]=function(e,t){return e.set(t[0],t[1])};Ta["@@transducer/result"]=function(e){return e.asImmutable()};var p_=function(t,r){this.ownerID=t,this.entries=r};p_.prototype.get=function(t,r,n,o){for(var i=this.entries,a=0,s=i.length;a<s;a++)if(hd(n,i[a][0]))return i[a][1];return o};p_.prototype.update=function(t,r,n,o,i,a,s){for(var l=i===No,u=this.entries,c=0,m=u.length;c<m&&!hd(o,u[c][0]);c++);var d=c<m;if(d?u[c][1]===i:l)return this;if(lp(s),(l||!d)&&lp(a),!(l&&u.length===1)){if(!d&&!l&&u.length>=KNe)return XNe(t,u,o,i);var p=t&&t===this.ownerID,h=p?u:jh(u);return d?l?c===m-1?h.pop():h[c]=h.pop():h[c]=[o,i]:h.push([o,i]),p?(this.entries=h,this):new p_(t,h)}};var rI=function(t,r,n){this.ownerID=t,this.bitmap=r,this.nodes=n};rI.prototype.get=function(t,r,n,o){r===void 0&&(r=dd(n));var i=1<<((t===0?r:r>>>t)&Vc),a=this.bitmap;return(a&i)===0?o:this.nodes[Wse(a&i-1)].get(t+$i,r,n,o)};rI.prototype.update=function(t,r,n,o,i,a,s){n===void 0&&(n=dd(o));var l=(r===0?n:n>>>r)&Vc,u=1<<l,c=this.bitmap,m=(c&u)!==0;if(!m&&i===No)return this;var d=Wse(c&u-1),p=this.nodes,h=m?p[d]:void 0,f=c9(h,t,r+$i,n,o,i,a,s);if(f===h)return this;if(!m&&f&&p.length>=JNe)return ZNe(t,p,c,l,f);if(m&&!f&&p.length===2&&ase(p[d^1]))return p[d^1];if(m&&f&&p.length===1&&ase(f))return f;var g=t&&t===this.ownerID,y=m?f?c:c^u:c|u,x=m?f?Xse(p,d,f,g):YNe(p,d,g):qNe(p,d,f,g);return g?(this.bitmap=y,this.nodes=x,this):new rI(t,y,x)};var f_=function(t,r,n){this.ownerID=t,this.count=r,this.nodes=n};f_.prototype.get=function(t,r,n,o){r===void 0&&(r=dd(n));var i=(t===0?r:r>>>t)&Vc,a=this.nodes[i];return a?a.get(t+$i,r,n,o):o};f_.prototype.update=function(t,r,n,o,i,a,s){n===void 0&&(n=dd(o));var l=(r===0?n:n>>>r)&Vc,u=i===No,c=this.nodes,m=c[l];if(u&&!m)return this;var d=c9(m,t,r+$i,n,o,i,a,s);if(d===m)return this;var p=this.count;if(!m)p++;else if(!d&&(p--,p<$Ne))return QNe(t,c,p,l);var h=t&&t===this.ownerID,f=Xse(c,l,d,h);return h?(this.count=p,this.nodes=f,this):new f_(t,p,f)};var nI=function(t,r,n){this.ownerID=t,this.keyHash=r,this.entries=n};nI.prototype.get=function(t,r,n,o){for(var i=this.entries,a=0,s=i.length;a<s;a++)if(hd(n,i[a][0]))return i[a][1];return o};nI.prototype.update=function(t,r,n,o,i,a,s){n===void 0&&(n=dd(o));var l=i===No;if(n!==this.keyHash)return l?this:(lp(s),lp(a),m9(this,t,r,n,[o,i]));for(var u=this.entries,c=0,m=u.length;c<m&&!hd(o,u[c][0]);c++);var d=c<m;if(d?u[c][1]===i:l)return this;if(lp(s),(l||!d)&&lp(a),l&&m===2)return new Ny(t,this.keyHash,u[c^1]);var p=t&&t===this.ownerID,h=p?u:jh(u);return d?l?c===m-1?h.pop():h[c]=h.pop():h[c]=[o,i]:h.push([o,i]),p?(this.entries=h,this):new nI(t,this.keyHash,h)};var Ny=function(t,r,n){this.ownerID=t,this.keyHash=r,this.entry=n};Ny.prototype.get=function(t,r,n,o){return hd(n,this.entry[0])?this.entry[1]:o};Ny.prototype.update=function(t,r,n,o,i,a,s){var l=i===No,u=hd(o,this.entry[0]);if(u?i===this.entry[1]:l)return this;if(lp(s),l){lp(a);return}return u?t&&t===this.ownerID?(this.entry[1]=i,this):new Ny(t,this.keyHash,[o,i]):(lp(a),m9(this,t,r,dd(o),[o,i]))};p_.prototype.iterate=nI.prototype.iterate=function(e,t){for(var r=this.entries,n=0,o=r.length-1;n<=o;n++)if(e(r[t?o-n:n])===!1)return!1};rI.prototype.iterate=f_.prototype.iterate=function(e,t){for(var r=this.nodes,n=0,o=r.length-1;n<=o;n++){var i=r[t?o-n:n];if(i&&i.iterate(e,t)===!1)return!1}};Ny.prototype.iterate=function(e,t){return e(this.entry)};var WNe=(function(e){function t(r,n,o){this._type=n,this._reverse=o,this._stack=r._root&&nse(r._root)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.next=function(){for(var n=this._type,o=this._stack;o;){var i=o.node,a=o.index++,s=void 0;if(i.entry){if(a===0)return MH(n,i.entry)}else if(i.entries){if(s=i.entries.length-1,a<=s)return MH(n,i.entries[this._reverse?s-a:a])}else if(s=i.nodes.length-1,a<=s){var l=i.nodes[this._reverse?s-a:a];if(l){if(l.entry)return MH(n,l.entry);o=this._stack=nse(l,o)}continue}o=this._stack=this._stack.__prev}return Oc()},t})(ri);function MH(e,t){return Ea(e,t[0],t[1])}function nse(e,t){return{node:e,index:0,__prev:t}}function u9(e,t,r,n){var o=Object.create(Ta);return o.size=e,o._root=t,o.__ownerID=r,o.__hash=n,o.__altered=!1,o}var ose;function Wh(){return ose||(ose=u9(0))}function ise(e,t,r){var n,o;if(e._root){var i=LH(),a=LH();if(n=c9(e._root,e.__ownerID,0,void 0,t,r,i,a),!a.value)return e;o=e.size+(i.value?r===No?-1:1:0)}else{if(r===No)return e;o=1,n=new p_(e.__ownerID,[[t,r]])}return e.__ownerID?(e.size=o,e._root=n,e.__hash=void 0,e.__altered=!0,e):n?u9(o,n):Wh()}function c9(e,t,r,n,o,i,a,s){return e?e.update(t,r,n,o,i,a,s):i===No?e:(lp(s),lp(a),new Ny(t,n,[o,i]))}function ase(e){return e.constructor===Ny||e.constructor===nI}function m9(e,t,r,n,o){if(e.keyHash===n)return new nI(t,n,[e.entry,o]);var i=(r===0?e.keyHash:e.keyHash>>>r)&Vc,a=(r===0?n:n>>>r)&Vc,s,l=i===a?[m9(e,t,r+$i,n,o)]:(s=new Ny(t,n,o),i<a?[e,s]:[s,e]);return new rI(t,1<<i|1<<a,l)}function XNe(e,t,r,n){e||(e=new jH);for(var o=new Ny(e,dd(r),[r,n]),i=0;i<t.length;i++){var a=t[i];o=o.update(e,0,void 0,a[0],a[1])}return o}function QNe(e,t,r,n){for(var o=0,i=0,a=new Array(r),s=0,l=1,u=t.length;s<u;s++,l<<=1){var c=t[s];c!==void 0&&s!==n&&(o|=l,a[i++]=c)}return new rI(e,o,a)}function ZNe(e,t,r,n,o){for(var i=0,a=new Array(fd),s=0;r!==0;s++,r>>>=1)a[s]=r&1?t[i++]:void 0;return a[n]=o,new f_(e,i+1,a)}function Wse(e){return e-=e>>1&1431655765,e=(e&858993459)+(e>>2&858993459),e=e+(e>>4)&252645135,e+=e>>8,e+=e>>16,e&127}function Xse(e,t,r,n){var o=n?e:jh(e);return o[t]=r,o}function qNe(e,t,r,n){var o=e.length+1;if(n&&t+1===o)return e[t]=r,e;for(var i=new Array(o),a=0,s=0;s<o;s++)s===t?(i[s]=r,a=-1):i[s]=e[s+a];return i}function YNe(e,t,r){var n=e.length-1;if(r&&t===n)return e.pop(),e;for(var o=new Array(n),i=0,a=0;a<n;a++)a===t&&(i=1),o[a]=e[a+i];return o}var KNe=fd/4,JNe=fd/2,$Ne=fd/4;function Qse(e){if(Pse(e)&&typeof e!="string")return e;if(Xh(e))return e.toArray();throw new TypeError("Invalid keyPath: expected Ordered Collection or Array: "+e)}function h_(e){try{return typeof e=="string"?JSON.stringify(e):String(e)}catch{return JSON.stringify(e)}}function e5e(e,t){return Qh(e)?e.has(t):zx(e)&&uI.call(e,t)}function Zse(e,t,r){return Qh(e)?e.get(t,r):e5e(e,t)?typeof e.get=="function"?e.get(t):e[t]:r}function t5e(e,t){if(!zx(e))throw new TypeError("Cannot update non-data-structure value: "+e);if(Qh(e)){if(!e.remove)throw new TypeError("Cannot update immutable value without .remove() method: "+e);return e.remove(t)}if(!uI.call(e,t))return e;var r=AB(e);return Array.isArray(r)?r.splice(t,1):delete r[t],r}function r5e(e,t,r){if(!zx(e))throw new TypeError("Cannot update non-data-structure value: "+e);if(Qh(e)){if(!e.set)throw new TypeError("Cannot update immutable value without .set() method: "+e);return e.set(t,r)}if(uI.call(e,t)&&r===e[t])return e;var n=AB(e);return n[t]=r,n}function mI(e,t,r,n){n||(n=r,r=void 0);var o=qse(Qh(e),e,Qse(t),0,r,n);return o===No?r:o}function qse(e,t,r,n,o,i){var a=t===No;if(n===r.length){var s=a?o:t,l=i(s);return l===s?t:l}if(!a&&!zx(t))throw new TypeError("Cannot update within non-data-structure value in path ["+Array.from(r).slice(0,n).map(h_)+"]: "+t);var u=r[n],c=a?No:Zse(t,u,No),m=qse(c===No?e:Qh(c),c,r,n+1,o,i);return m===c?t:m===No?t5e(t,u):r5e(a?e?Wh():{}:t,u,m)}function n5e(e,t){return mI(e,t,function(){return No})}function d9(e){return n5e(this,e)}var Yse="@@__IMMUTABLE_LIST__@@";function Kse(e){return!!(e&&e[Yse])}var qh=(function(e){function t(r){var n=SB();if(r==null)return n;if(Kse(r))return r;var o=e(r),i=o.size;return i===0?n:(pd(i),i>0&&i<fd?g_(0,i,$i,null,new Gx(o.toArray())):n.withMutations(function(a){a.setSize(i),o.forEach(function(s,l){return a.set(l,s)})}))}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.of=function(){return this(arguments)},t.prototype.toString=function(){return this.__toString("List [","]")},t.prototype.get=function(n,o){if(n=Ux(this,n),n>=0&&n<this.size){n+=this._origin;var i=Jse(this,n);return i&&i.array[n&Vc]}return o},t.prototype.set=function(n,o){return o5e(this,n,o)},t.prototype.remove=function(n){return this.has(n)?n===0?this.shift():n===this.size-1?this.pop():this.splice(n,1):this},t.prototype.insert=function(n,o){return this.splice(n,0,o)},t.prototype.clear=function(){return this.size===0?this:this.__ownerID?(this.size=this._origin=this._capacity=0,this._level=$i,this._root=this._tail=this.__hash=void 0,this.__altered=!0,this):SB()},t.prototype.push=function(){var n=arguments,o=this.size;return this.withMutations(function(i){Ox(i,0,o+n.length);for(var a=0;a<n.length;a++)i.set(o+a,n[a])})},t.prototype.pop=function(){return Ox(this,0,-1)},t.prototype.unshift=function(){var n=arguments;return this.withMutations(function(o){Ox(o,-n.length);for(var i=0;i<n.length;i++)o.set(i,n[i])})},t.prototype.shift=function(){return Ox(this,1)},t.prototype.shuffle=function(n){return n===void 0&&(n=Math.random),this.withMutations(function(o){for(var i=o.size,a,s;i;)a=Math.floor(n()*i--),s=o.get(a),o.set(a,o.get(i)),o.set(i,s)})},t.prototype.concat=function(){for(var n=arguments,o=[],i=0;i<arguments.length;i++){var a=n[i],s=e(typeof a!="string"&&Cse(a)?a:[a]);s.size!==0&&o.push(s)}return o.length===0?this:this.size===0&&!this.__ownerID&&o.length===1?this.constructor(o[0]):this.withMutations(function(l){o.forEach(function(u){return u.forEach(function(c){return l.push(c)})})})},t.prototype.setSize=function(n){return Ox(this,0,n)},t.prototype.map=function(n,o){var i=this;return this.withMutations(function(a){for(var s=0;s<i.size;s++)a.set(s,n.call(o,a.get(s),s,i))})},t.prototype.slice=function(n,o){var i=this.size;return RB(n,o,i)?this:Ox(this,x_(n,i),DB(o,i))},t.prototype.__iterator=function(n,o){var i=o?this.size:0,a=sse(this,o);return new ri(function(){var s=a();return s===d_?Oc():Ea(n,o?--i:i++,s)})},t.prototype.__iterate=function(n,o){for(var i=o?this.size:0,a=sse(this,o),s;(s=a())!==d_&&n(s,o?--i:i++,this)!==!1;);return i},t.prototype.__ensureOwner=function(n){return n===this.__ownerID?this:n?g_(this._origin,this._capacity,this._level,this._root,this._tail,n,this.__hash):this.size===0?SB():(this.__ownerID=n,this.__altered=!1,this)},t})(fS);qh.isList=Kse;var el=qh.prototype;el[Yse]=!0;el[b_]=el.remove;el.merge=el.concat;el.setIn=o9;el.deleteIn=el.removeIn=d9;el.update=i9;el.updateIn=a9;el.mergeIn=n9;el.mergeDeepIn=r9;el.withMutations=v_;el.wasAltered=s9;el.asImmutable=C_;el["@@transducer/init"]=el.asMutable=S_;el["@@transducer/step"]=function(e,t){return e.push(t)};el["@@transducer/result"]=function(e){return e.asImmutable()};var Gx=function(t,r){this.array=t,this.ownerID=r};Gx.prototype.removeBefore=function(t,r,n){if((n&(1<<r+$i)-1)===0||this.array.length===0)return this;var o=n>>>r&Vc;if(o>=this.array.length)return new Gx([],t);var i=o===0,a;if(r>0){var s=this.array[o];if(a=s&&s.removeBefore(t,r-$i,n),a===s&&i)return this}if(i&&!a)return this;var l=oI(this,t);if(!i)for(var u=0;u<o;u++)l.array[u]=void 0;return a&&(l.array[o]=a),l};Gx.prototype.removeAfter=function(t,r,n){if(n===(r?1<<r+$i:fd)||this.array.length===0)return this;var o=n-1>>>r&Vc;if(o>=this.array.length)return this;var i;if(r>0){var a=this.array[o];if(i=a&&a.removeAfter(t,r-$i,n),i===a&&o===this.array.length-1)return this}var s=oI(this,t);return s.array.splice(o+1),i&&(s.array[o]=i),s};var d_={};function sse(e,t){var r=e._origin,n=e._capacity,o=y_(n),i=e._tail;return a(e._root,e._level,0);function a(u,c,m){return c===0?s(u,m):l(u,c,m)}function s(u,c){var m=c===o?i&&i.array:u&&u.array,d=c>r?0:r-c,p=n-c;return p>fd&&(p=fd),function(){if(d===p)return d_;var h=t?--p:d++;return m&&m[h]}}function l(u,c,m){var d,p=u&&u.array,h=m>r?0:r-m>>c,f=(n-m>>c)+1;return f>fd&&(f=fd),function(){for(;;){if(d){var g=d();if(g!==d_)return g;d=null}if(h===f)return d_;var y=t?--f:h++;d=a(p&&p[y],c-$i,m+(y<<c))}}}}function g_(e,t,r,n,o,i,a){var s=Object.create(el);return s.size=t-e,s._origin=e,s._capacity=t,s._level=r,s._root=n,s._tail=o,s.__ownerID=i,s.__hash=a,s.__altered=!1,s}function SB(){return g_(0,0,$i)}function o5e(e,t,r){if(t=Ux(e,t),t!==t)return e;if(t>=e.size||t<0)return e.withMutations(function(a){t<0?Ox(a,t).set(0,r):Ox(a,0,t+1).set(t,r)});t+=e._origin;var n=e._tail,o=e._root,i=LH();return t>=y_(e._capacity)?n=UH(n,e.__ownerID,0,t,r,i):o=UH(o,e.__ownerID,e._level,t,r,i),i.value?e.__ownerID?(e._root=o,e._tail=n,e.__hash=void 0,e.__altered=!0,e):g_(e._origin,e._capacity,e._level,o,n):e}function UH(e,t,r,n,o,i){var a=n>>>r&Vc,s=e&&a<e.array.length;if(!s&&o===void 0)return e;var l;if(r>0){var u=e&&e.array[a],c=UH(u,t,r-$i,n,o,i);return c===u?e:(l=oI(e,t),l.array[a]=c,l)}return s&&e.array[a]===o?e:(i&&lp(i),l=oI(e,t),o===void 0&&a===l.array.length-1?l.array.pop():l.array[a]=o,l)}function oI(e,t){return t&&e&&t===e.ownerID?e:new Gx(e?e.array.slice():[],t)}function Jse(e,t){if(t>=y_(e._capacity))return e._tail;if(t<1<<e._level+$i){for(var r=e._root,n=e._level;r&&n>0;)r=r.array[t>>>n&Vc],n-=$i;return r}}function Ox(e,t,r){t!==void 0&&(t|=0),r!==void 0&&(r|=0);var n=e.__ownerID||new jH,o=e._origin,i=e._capacity,a=o+t,s=r===void 0?i:r<0?i+r:o+r;if(a===o&&s===i)return e;if(a>=s)return e.clear();for(var l=e._level,u=e._root,c=0;a+c<0;)u=new Gx(u&&u.array.length?[void 0,u]:[],n),l+=$i,c+=1<<l;c&&(a+=c,o+=c,s+=c,i+=c);for(var m=y_(i),d=y_(s);d>=1<<l+$i;)u=new Gx(u&&u.array.length?[u]:[],n),l+=$i;var p=e._tail,h=d<m?Jse(e,s-1):d>m?new Gx([],n):p;if(p&&d>m&&a<i&&p.array.length){u=oI(u,n);for(var f=u,g=l;g>$i;g-=$i){var y=m>>>g&Vc;f=f.array[y]=oI(f.array[y],n)}f.array[m>>>$i&Vc]=p}if(s<i&&(h=h&&h.removeAfter(n,0,s)),a>=d)a-=d,s-=d,l=$i,u=null,h=h&&h.removeBefore(n,0,a);else if(a>o||d<m){for(c=0;u;){var x=a>>>l&Vc;if(x!==d>>>l&Vc)break;x&&(c+=(1<<l)*x),l-=$i,u=u.array[x]}u&&a>o&&(u=u.removeBefore(n,l,a-c)),u&&d<m&&(u=u.removeAfter(n,l,d-c)),c&&(a-=c,s-=c)}return e.__ownerID?(e.size=s-a,e._origin=a,e._capacity=s,e._level=l,e._root=u,e._tail=h,e.__hash=void 0,e.__altered=!0,e):g_(a,s,l,u,h)}function y_(e){return e<fd?0:e-1>>>$i<<$i}function $se(e){return l9(e)&&Xh(e)}var tl=(function(e){function t(r){return r==null?l_():$se(r)?r:l_().withMutations(function(n){var o=cp(r);pd(o.size),o.forEach(function(i,a){return n.set(a,i)})})}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.of=function(){return this(arguments)},t.prototype.toString=function(){return this.__toString("OrderedMap {","}")},t.prototype.get=function(n,o){var i=this._map.get(n);return i!==void 0?this._list.get(i)[1]:o},t.prototype.clear=function(){return this.size===0?this:this.__ownerID?(this.size=0,this._map.clear(),this._list.clear(),this.__altered=!0,this):l_()},t.prototype.set=function(n,o){return use(this,n,o)},t.prototype.remove=function(n){return use(this,n,No)},t.prototype.__iterate=function(n,o){var i=this;return this._list.__iterate(function(a){return a&&n(a[1],a[0],i)},o)},t.prototype.__iterator=function(n,o){return this._list.fromEntrySeq().__iterator(n,o)},t.prototype.__ensureOwner=function(n){if(n===this.__ownerID)return this;var o=this._map.__ensureOwner(n),i=this._list.__ensureOwner(n);return n?p9(o,i,n,this.__hash):this.size===0?l_():(this.__ownerID=n,this.__altered=!1,this._map=o,this._list=i,this)},t})(Cd);tl.isOrderedMap=$se;tl.prototype[Nx]=!0;tl.prototype[b_]=tl.prototype.remove;function p9(e,t,r,n){var o=Object.create(tl.prototype);return o.size=e?e.size:0,o._map=e,o._list=t,o.__ownerID=r,o.__hash=n,o.__altered=!1,o}var lse;function l_(){return lse||(lse=p9(Wh(),SB()))}function use(e,t,r){var n=e._map,o=e._list,i=n.get(t),a=i!==void 0,s,l;if(r===No){if(!a)return e;o.size>=fd&&o.size>=n.size*2?(l=o.filter(function(u,c){return u!==void 0&&i!==c}),s=l.toKeyedSeq().map(function(u){return u[0]}).flip().toMap(),e.__ownerID&&(s.__ownerID=l.__ownerID=e.__ownerID)):(s=n.remove(t),l=i===o.size-1?o.pop():o.set(i,void 0))}else if(a){if(r===o.get(i)[1])return e;s=n,l=o.set(i,[t,r])}else s=n.set(t,o.size),l=o.set(o.size,[t,r]);return e.__ownerID?(e.size=s.size,e._map=s,e._list=l,e.__hash=void 0,e.__altered=!0,e):p9(s,l)}var ele="@@__IMMUTABLE_STACK__@@";function NH(e){return!!(e&&e[ele])}var f9=(function(e){function t(r){return r==null?xB():NH(r)?r:xB().pushAll(r)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.of=function(){return this(arguments)},t.prototype.toString=function(){return this.__toString("Stack [","]")},t.prototype.get=function(n,o){var i=this._head;for(n=Ux(this,n);i&&n--;)i=i.next;return i?i.value:o},t.prototype.peek=function(){return this._head&&this._head.value},t.prototype.push=function(){var n=arguments;if(arguments.length===0)return this;for(var o=this.size+arguments.length,i=this._head,a=arguments.length-1;a>=0;a--)i={value:n[a],next:i};return this.__ownerID?(this.size=o,this._head=i,this.__hash=void 0,this.__altered=!0,this):u_(o,i)},t.prototype.pushAll=function(n){if(n=e(n),n.size===0)return this;if(this.size===0&&NH(n))return n;pd(n.size);var o=this.size,i=this._head;return n.__iterate(function(a){o++,i={value:a,next:i}},!0),this.__ownerID?(this.size=o,this._head=i,this.__hash=void 0,this.__altered=!0,this):u_(o,i)},t.prototype.pop=function(){return this.slice(1)},t.prototype.clear=function(){return this.size===0?this:this.__ownerID?(this.size=0,this._head=void 0,this.__hash=void 0,this.__altered=!0,this):xB()},t.prototype.slice=function(n,o){if(RB(n,o,this.size))return this;var i=x_(n,this.size),a=DB(o,this.size);if(a!==this.size)return e.prototype.slice.call(this,n,o);for(var s=this.size-i,l=this._head;i--;)l=l.next;return this.__ownerID?(this.size=s,this._head=l,this.__hash=void 0,this.__altered=!0,this):u_(s,l)},t.prototype.__ensureOwner=function(n){return n===this.__ownerID?this:n?u_(this.size,this._head,n,this.__hash):this.size===0?xB():(this.__ownerID=n,this.__altered=!1,this)},t.prototype.__iterate=function(n,o){var i=this;if(o)return new eI(this.toArray()).__iterate(function(l,u){return n(l,u,i)},o);for(var a=0,s=this._head;s&&n(s.value,a++,this)!==!1;)s=s.next;return a},t.prototype.__iterator=function(n,o){if(o)return new eI(this.toArray()).__iterator(n,o);var i=0,a=this._head;return new ri(function(){if(a){var s=a.value;return a=a.next,Ea(n,i++,s)}return Oc()})},t})(fS);f9.isStack=NH;var Gc=f9.prototype;Gc[ele]=!0;Gc.shift=Gc.pop;Gc.unshift=Gc.push;Gc.unshiftAll=Gc.pushAll;Gc.withMutations=v_;Gc.wasAltered=s9;Gc.asImmutable=C_;Gc["@@transducer/init"]=Gc.asMutable=S_;Gc["@@transducer/step"]=function(e,t){return e.unshift(t)};Gc["@@transducer/result"]=function(e){return e.asImmutable()};function u_(e,t,r,n){var o=Object.create(Gc);return o.size=e,o._head=t,o.__ownerID=r,o.__hash=n,o.__altered=!1,o}var cse;function xB(){return cse||(cse=u_(0))}function mse(e,t,r,n,o,i){return pd(e.size),e.__iterate(function(a,s,l){o?(o=!1,r=a):r=t.call(n,r,a,s,l)},i),r}function i5e(e,t){return t}function a5e(e,t){return[t,e]}function BH(e){return function(){for(var t=[],r=arguments.length;r--;)t[r]=arguments[r];return!e.apply(this,t)}}function dse(e){return function(){for(var t=[],r=arguments.length;r--;)t[r]=arguments[r];return-e.apply(this,t)}}function pse(e,t){return e<t?1:e>t?-1:0}function tle(e,t){if(e===t)return!0;if(!gd(t)||e.size!==void 0&&t.size!==void 0&&e.size!==t.size||e.__hash!==void 0&&t.__hash!==void 0&&e.__hash!==t.__hash||Ba(e)!==Ba(t)||up(e)!==up(t)||Xh(e)!==Xh(t))return!1;if(e.size===0&&t.size===0)return!0;var r=!HH(e);if(Xh(e)){var n=e.entries();return t.every(function(l,u){var c=n.next().value;return c&&hd(c[1],l)&&(r||hd(c[0],u))})&&n.next().done}var o=!1;if(e.size===void 0)if(t.size===void 0)typeof e.cacheResult=="function"&&e.cacheResult();else{o=!0;var i=e;e=t,t=i}var a=!0,s=t.__iterate(function(l,u){if(r?!e.has(l):o?!hd(l,e.get(u,No)):!hd(e.get(u,No),l))return a=!1,!1});return a&&e.size===s}var s5e=(function(e){function t(r,n,o){if(o===void 0&&(o=1),!(this instanceof t))return new t(r,n,o);if(m_(o!==0,"Cannot step a Range by 0"),m_(r!==void 0,"You must define a start value when using Range"),m_(n!==void 0,"You must define an end value when using Range"),o=Math.abs(o),n<r&&(o=-o),this._start=r,this._end=n,this._step=o,this.size=Math.max(0,Math.ceil((n-r)/o-1)+1),this.size===0){if(EH)return EH;EH=this}}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.toString=function(){return this.size===0?"Range []":"Range [ "+this._start+"..."+this._end+(this._step!==1?" by "+this._step:"")+" ]"},t.prototype.get=function(n,o){return this.has(n)?this._start+Ux(this,n)*this._step:o},t.prototype.includes=function(n){var o=(n-this._start)/this._step;return o>=0&&o<this.size&&o===Math.floor(o)},t.prototype.slice=function(n,o){return RB(n,o,this.size)?this:(n=x_(n,this.size),o=DB(o,this.size),o<=n?new t(0,0):new t(this.get(n,this._end),this.get(o,this._end),this._step))},t.prototype.indexOf=function(n){var o=n-this._start;if(o%this._step===0){var i=o/this._step;if(i>=0&&i<this.size)return i}return-1},t.prototype.lastIndexOf=function(n){return this.indexOf(n)},t.prototype.__iterate=function(n,o){for(var i=this.size,a=this._step,s=o?this._start+(i-1)*a:this._start,l=0;l!==i&&n(s,o?i-++l:l++,this)!==!1;)s+=o?-a:a;return l},t.prototype.__iterator=function(n,o){var i=this.size,a=this._step,s=o?this._start+(i-1)*a:this._start,l=0;return new ri(function(){if(l===i)return Oc();var u=s;return s+=o?-a:a,Ea(n,o?i-++l:l++,u)})},t.prototype.equals=function(n){return n instanceof t?this._start===n._start&&this._end===n._end&&this._step===n._step:tle(this,n)},t})(Lf),EH,rle="@@__IMMUTABLE_SET__@@";function h9(e){return!!(e&&e[rle])}var BB=(function(e){function t(r){return r==null?c_():h9(r)&&!Xh(r)?r:c_().withMutations(function(n){var o=e(r);pd(o.size),o.forEach(function(i){return n.add(i)})})}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.of=function(){return this(arguments)},t.fromKeys=function(n){return this(cp(n).keySeq())},t.intersect=function(n){return n=oc(n).toArray(),n.length?wu.intersect.apply(t(n.pop()),n):c_()},t.union=function(n){return n=oc(n).toArray(),n.length?wu.union.apply(t(n.pop()),n):c_()},t.prototype.toString=function(){return this.__toString("Set {","}")},t.prototype.has=function(n){return this._map.has(n)},t.prototype.add=function(n){return CB(this,this._map.set(n,n))},t.prototype.remove=function(n){return CB(this,this._map.remove(n))},t.prototype.clear=function(){return CB(this,this._map.clear())},t.prototype.map=function(n,o){var i=this,a=!1,s=CB(this,this._map.mapEntries(function(l){var u=l[1],c=n.call(o,u,u,i);return c!==u&&(a=!0),[c,c]},o));return a?s:this},t.prototype.union=function(){for(var n=[],o=arguments.length;o--;)n[o]=arguments[o];return n=n.filter(function(i){return i.size!==0}),n.length===0?this:this.size===0&&!this.__ownerID&&n.length===1?this.constructor(n[0]):this.withMutations(function(i){for(var a=0;a<n.length;a++)typeof n[a]=="string"?i.add(n[a]):e(n[a]).forEach(function(s){return i.add(s)})})},t.prototype.intersect=function(){for(var n=[],o=arguments.length;o--;)n[o]=arguments[o];if(n.length===0)return this;n=n.map(function(a){return e(a)});var i=[];return this.forEach(function(a){n.every(function(s){return s.includes(a)})||i.push(a)}),this.withMutations(function(a){i.forEach(function(s){a.remove(s)})})},t.prototype.subtract=function(){for(var n=[],o=arguments.length;o--;)n[o]=arguments[o];if(n.length===0)return this;n=n.map(function(a){return e(a)});var i=[];return this.forEach(function(a){n.some(function(s){return s.includes(a)})&&i.push(a)}),this.withMutations(function(a){i.forEach(function(s){a.remove(s)})})},t.prototype.sort=function(n){return xd(tI(this,n))},t.prototype.sortBy=function(n,o){return xd(tI(this,o,n))},t.prototype.wasAltered=function(){return this._map.wasAltered()},t.prototype.__iterate=function(n,o){var i=this;return this._map.__iterate(function(a){return n(a,a,i)},o)},t.prototype.__iterator=function(n,o){return this._map.__iterator(n,o)},t.prototype.__ensureOwner=function(n){if(n===this.__ownerID)return this;var o=this._map.__ensureOwner(n);return n?this.__make(o,n):this.size===0?this.__empty():(this.__ownerID=n,this._map=o,this)},t})(sI);BB.isSet=h9;var wu=BB.prototype;wu[rle]=!0;wu[b_]=wu.remove;wu.merge=wu.concat=wu.union;wu.withMutations=v_;wu.asImmutable=C_;wu["@@transducer/init"]=wu.asMutable=S_;wu["@@transducer/step"]=function(e,t){return e.add(t)};wu["@@transducer/result"]=function(e){return e.asImmutable()};wu.__empty=c_;wu.__make=nle;function CB(e,t){return e.__ownerID?(e.size=t.size,e._map=t,e):t===e._map?e:t.size===0?e.__empty():e.__make(t)}function nle(e,t){var r=Object.create(wu);return r.size=e?e.size:0,r._map=e,r.__ownerID=t,r}var fse;function c_(){return fse||(fse=nle(Wh()))}function ole(e,t,r){for(var n=Qse(t),o=0;o!==n.length;)if(e=Zse(e,n[o++],No),e===No)return r;return e}function ile(e,t){return ole(this,e,t)}function l5e(e,t){return ole(e,t,No)!==No}function u5e(e){return l5e(this,e)}function ale(){pd(this.size);var e={};return this.__iterate(function(t,r){e[r]=t}),e}function TB(e){if(!e||typeof e!="object")return e;if(!gd(e)){if(!zx(e))return e;e=Am(e)}if(Ba(e)){var t={};return e.__iterate(function(n,o){t[o]=TB(n)}),t}var r=[];return e.__iterate(function(n){r.push(TB(n))}),r}function c5e(e){if(e.size===1/0)return 0;var t=Xh(e),r=Ba(e),n=t?1:0;return e.__iterate(r?t?function(o,i){n=31*n+hse(dd(o),dd(i))|0}:function(o,i){n=n+hse(dd(o),dd(i))|0}:t?function(o){n=31*n+dd(o)|0}:function(o){n=n+dd(o)|0}),m5e(e.size,n)}function m5e(e,t){return t=s_(t,3432918353),t=s_(t<<15|t>>>-15,461845907),t=s_(t<<13|t>>>-13,5),t=(t+3864292196|0)^e,t=s_(t^t>>>16,2246822507),t=s_(t^t>>>13,3266489909),t=wB(t^t>>>16),t}function hse(e,t){return e^t+2654435769+(e<<6)+(e>>2)|0}function gS(e,t){var r=function(n){e.prototype[n]=t[n]};return Object.keys(t).forEach(r),Object.getOwnPropertySymbols&&Object.getOwnPropertySymbols(t).forEach(r),e}oc.Iterator=ri;gS(oc,{toArray:function(){pd(this.size);var t=new Array(this.size||0),r=Ba(this),n=0;return this.__iterate(function(o,i){t[n++]=r?[i,o]:o}),t},toIndexedSeq:function(){return new Dse(this)},toJS:function(){return TB(this)},toKeyedSeq:function(){return new MB(this,!0)},toMap:function(){return Cd(this.toKeyedSeq())},toObject:ale,toOrderedMap:function(){return tl(this.toKeyedSeq())},toOrderedSet:function(){return xd(Ba(this)?this.valueSeq():this)},toSet:function(){return BB(Ba(this)?this.valueSeq():this)},toSetSeq:function(){return new wse(this)},toSeq:function(){return up(this)?this.toIndexedSeq():Ba(this)?this.toKeyedSeq():this.toSetSeq()},toStack:function(){return f9(Ba(this)?this.valueSeq():this)},toList:function(){return qh(Ba(this)?this.valueSeq():this)},toString:function(){return"[Collection]"},__toString:function(t,r){return this.size===0?t+r:t+" "+this.toSeq().map(this.__toStringMapper).join(", ")+" "+r},concat:function(){for(var t=[],r=arguments.length;r--;)t[r]=arguments[r];return Ji(this,VNe(this,t))},includes:function(t){return this.some(function(r){return hd(r,t)})},entries:function(){return this.__iterator(bd)},every:function(t,r){pd(this.size);var n=!0;return this.__iterate(function(o,i,a){if(!t.call(r,o,i,a))return n=!1,!1}),n},filter:function(t,r){return Ji(this,kse(this,t,r,!0))},partition:function(t,r){return kNe(this,t,r)},find:function(t,r,n){var o=this.findEntry(t,r);return o?o[1]:n},forEach:function(t,r){return pd(this.size),this.__iterate(r?t.bind(r):t)},join:function(t){pd(this.size),t=t!==void 0?""+t:",";var r="",n=!0;return this.__iterate(function(o){n?n=!1:r+=t,r+=o!=null?o.toString():""}),r},keys:function(){return this.__iterator(lI)},map:function(t,r){return Ji(this,Ese(this,t,r))},reduce:function(t,r,n){return mse(this,t,r,n,arguments.length<2,!1)},reduceRight:function(t,r,n){return mse(this,t,r,n,arguments.length<2,!0)},reverse:function(){return Ji(this,YH(this,!0))},slice:function(t,r){return Ji(this,KH(this,t,r,!0))},some:function(t,r){pd(this.size);var n=!1;return this.__iterate(function(o,i,a){if(t.call(r,o,i,a))return n=!0,!1}),n},sort:function(t){return Ji(this,tI(this,t))},values:function(){return this.__iterator(yd)},butLast:function(){return this.slice(0,-1)},isEmpty:function(){return this.size!==void 0?this.size===0:!this.some(function(){return!0})},count:function(t,r){return $v(t?this.toSeq().filter(t,r):this)},countBy:function(t,r){return BNe(this,t,r)},equals:function(t){return tle(this,t)},entrySeq:function(){var t=this;if(t._cache)return new eI(t._cache);var r=t.toSeq().map(a5e).toIndexedSeq();return r.fromEntrySeq=function(){return t.toSeq()},r},filterNot:function(t,r){return this.filter(BH(t),r)},findEntry:function(t,r,n){var o=n;return this.__iterate(function(i,a,s){if(t.call(r,i,a,s))return o=[a,i],!1}),o},findKey:function(t,r){var n=this.findEntry(t,r);return n&&n[0]},findLast:function(t,r,n){return this.toKeyedSeq().reverse().find(t,r,n)},findLastEntry:function(t,r,n){return this.toKeyedSeq().reverse().findEntry(t,r,n)},findLastKey:function(t,r){return this.toKeyedSeq().reverse().findKey(t,r)},first:function(t){return this.find(Sse,null,t)},flatMap:function(t,r){return Ji(this,ONe(this,t,r))},flatten:function(t){return Ji(this,Lse(this,t,!0))},fromEntrySeq:function(){return new Mse(this)},get:function(t,r){return this.find(function(n,o){return hd(o,t)},void 0,r)},getIn:ile,groupBy:function(t,r){return ENe(this,t,r)},has:function(t){return this.get(t,No)!==No},hasIn:u5e,isSubset:function(t){return t=typeof t.includes=="function"?t:oc(t),this.every(function(r){return t.includes(r)})},isSuperset:function(t){return t=typeof t.isSubset=="function"?t:oc(t),t.isSubset(this)},keyOf:function(t){return this.findKey(function(r){return hd(r,t)})},keySeq:function(){return this.toSeq().map(i5e).toIndexedSeq()},last:function(t){return this.toSeq().reverse().first(t)},lastKeyOf:function(t){return this.toKeyedSeq().reverse().keyOf(t)},max:function(t){return yB(this,t)},maxBy:function(t,r){return yB(this,r,t)},min:function(t){return yB(this,t?dse(t):pse)},minBy:function(t,r){return yB(this,r?dse(r):pse,t)},rest:function(){return this.slice(1)},skip:function(t){return t===0?this:this.slice(Math.max(0,t))},skipLast:function(t){return t===0?this:this.slice(0,-Math.max(0,t))},skipWhile:function(t,r){return Ji(this,Fse(this,t,r,!0))},skipUntil:function(t,r){return this.skipWhile(BH(t),r)},sortBy:function(t,r){return Ji(this,tI(this,r,t))},take:function(t){return this.slice(0,Math.max(0,t))},takeLast:function(t){return this.slice(-Math.max(0,t))},takeWhile:function(t,r){return Ji(this,FNe(this,t,r))},takeUntil:function(t,r){return this.takeWhile(BH(t),r)},update:function(t){return t(this)},valueSeq:function(){return this.toIndexedSeq()},hashCode:function(){return this.__hash||(this.__hash=c5e(this))}});var ic=oc.prototype;ic[bse]=!0;ic[PB]=ic.values;ic.toJSON=ic.toArray;ic.__toStringMapper=h_;ic.inspect=ic.toSource=function(){return this.toString()};ic.chain=ic.flatMap;ic.contains=ic.includes;gS(cp,{flip:function(){return Ji(this,Bse(this))},mapEntries:function(t,r){var n=this,o=0;return Ji(this,this.toSeq().map(function(i,a){return t.call(r,[a,i],o++,n)}).fromEntrySeq())},mapKeys:function(t,r){var n=this;return Ji(this,this.toSeq().flip().map(function(o,i){return t.call(r,o,i,n)}).flip())}});var I_=cp.prototype;I_[IB]=!0;I_[PB]=ic.entries;I_.toJSON=ale;I_.__toStringMapper=function(e,t){return h_(t)+": "+h_(e)};gS(fS,{toKeyedSeq:function(){return new MB(this,!1)},filter:function(t,r){return Ji(this,kse(this,t,r,!1))},findIndex:function(t,r){var n=this.findEntry(t,r);return n?n[0]:-1},indexOf:function(t){var r=this.keyOf(t);return r===void 0?-1:r},lastIndexOf:function(t){var r=this.lastKeyOf(t);return r===void 0?-1:r},reverse:function(){return Ji(this,YH(this,!1))},slice:function(t,r){return Ji(this,KH(this,t,r,!1))},splice:function(t,r){var n=arguments.length;if(r=Math.max(r||0,0),n===0||n===2&&!r)return this;t=x_(t,t<0?this.count():this.size);var o=this.slice(0,t);return Ji(this,n===1?o:o.concat(jh(arguments,2),this.slice(t+r)))},findLastIndex:function(t,r){var n=this.findLastEntry(t,r);return n?n[0]:-1},first:function(t){return this.get(0,t)},flatten:function(t){return Ji(this,Lse(this,t,!1))},get:function(t,r){return t=Ux(this,t),t<0||this.size===1/0||this.size!==void 0&&t>this.size?r:this.find(function(n,o){return o===t},void 0,r)},has:function(t){return t=Ux(this,t),t>=0&&(this.size!==void 0?this.size===1/0||t<this.size:this.indexOf(t)!==-1)},interpose:function(t){return Ji(this,GNe(this,t))},interleave:function(){var t=[this].concat(jh(arguments)),r=bB(this.toSeq(),Lf.of,t),n=r.flatten(!0);return r.size&&(n.size=r.size*t.length),Ji(this,n)},keySeq:function(){return s5e(0,this.size)},last:function(t){return this.get(-1,t)},skipWhile:function(t,r){return Ji(this,Fse(this,t,r,!1))},zip:function(){var t=[this].concat(jh(arguments));return Ji(this,bB(this,gse,t))},zipAll:function(){var t=[this].concat(jh(arguments));return Ji(this,bB(this,gse,t,!0))},zipWith:function(t){var r=jh(arguments);return r[0]=this,Ji(this,bB(this,t,r))}});var dI=fS.prototype;dI[vB]=!0;dI[Nx]=!0;gS(sI,{get:function(t,r){return this.has(t)?t:r},includes:function(t){return this.has(t)},keySeq:function(){return this.valueSeq()}});var iI=sI.prototype;iI.has=ic.includes;iI.contains=iI.includes;iI.keys=iI.values;gS(Hx,I_);gS(Lf,dI);gS(cI,iI);function gse(){return jh(arguments)}function sle(e){return h9(e)&&Xh(e)}var xd=(function(e){function t(r){return r==null?zH():sle(r)?r:zH().withMutations(function(n){var o=sI(r);pd(o.size),o.forEach(function(i){return n.add(i)})})}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.of=function(){return this(arguments)},t.fromKeys=function(n){return this(cp(n).keySeq())},t.prototype.toString=function(){return this.__toString("OrderedSet {","}")},t})(BB);xd.isOrderedSet=sle;var yS=xd.prototype;yS[Nx]=!0;yS.zip=dI.zip;yS.zipWith=dI.zipWith;yS.zipAll=dI.zipAll;yS.__empty=zH;yS.__make=lle;function lle(e,t){var r=Object.create(yS);return r.size=e?e.size:0,r._map=e,r.__ownerID=t,r}var yse;function zH(){return yse||(yse=lle(l_()))}function d5e(e){if(hS(e))throw new Error("Can not call `Record` with an immutable Record as default values. Use a plain javascript object instead.");if(Qh(e))throw new Error("Can not call `Record` with an immutable Collection as default values. Use a plain javascript object instead.");if(e===null||typeof e!="object")throw new Error("Can not call `Record` with a non-object as default values. Use a plain javascript object instead.")}var Wl=function(t,r){var n;d5e(t);var o=function(s){var l=this;if(s instanceof o)return s;if(!(this instanceof o))return new o(s);if(!n){n=!0;var u=Object.keys(t),c=i._indices={};i._name=r,i._keys=u,i._defaultValues=t;for(var m=0;m<u.length;m++){var d=u[m];c[d]=m,i[d]?typeof console=="object"&&console.warn&&console.warn("Cannot define "+y9(this)+' with property "'+d+'" since that property name is part of the Record API.'):p5e(i,d)}}return this.__ownerID=void 0,this._values=qh().withMutations(function(p){p.setSize(l._keys.length),cp(s).forEach(function(h,f){p.set(l._indices[f],h===l._defaultValues[f]?void 0:h)})}),this},i=o.prototype=Object.create(ma);return i.constructor=o,r&&(o.displayName=r),o};Wl.prototype.toString=function(){for(var t=y9(this)+" { ",r=this._keys,n,o=0,i=r.length;o!==i;o++)n=r[o],t+=(o?", ":"")+n+": "+h_(this.get(n));return t+" }"};Wl.prototype.equals=function(t){return this===t||hS(t)&&aI(this).equals(aI(t))};Wl.prototype.hashCode=function(){return aI(this).hashCode()};Wl.prototype.has=function(t){return this._indices.hasOwnProperty(t)};Wl.prototype.get=function(t,r){if(!this.has(t))return r;var n=this._indices[t],o=this._values.get(n);return o===void 0?this._defaultValues[t]:o};Wl.prototype.set=function(t,r){if(this.has(t)){var n=this._values.set(this._indices[t],r===this._defaultValues[t]?void 0:r);if(n!==this._values&&!this.__ownerID)return g9(this,n)}return this};Wl.prototype.remove=function(t){return this.set(t)};Wl.prototype.clear=function(){var t=this._values.clear().setSize(this._keys.length);return this.__ownerID?this:g9(this,t)};Wl.prototype.wasAltered=function(){return this._values.wasAltered()};Wl.prototype.toSeq=function(){return aI(this)};Wl.prototype.toJS=function(){return TB(this)};Wl.prototype.entries=function(){return this.__iterator(bd)};Wl.prototype.__iterator=function(t,r){return aI(this).__iterator(t,r)};Wl.prototype.__iterate=function(t,r){return aI(this).__iterate(t,r)};Wl.prototype.__ensureOwner=function(t){if(t===this.__ownerID)return this;var r=this._values.__ensureOwner(t);return t?g9(this,r,t):(this.__ownerID=t,this._values=r,this)};Wl.isRecord=hS;Wl.getDescriptiveName=y9;var ma=Wl.prototype;ma[Ase]=!0;ma[b_]=ma.remove;ma.deleteIn=ma.removeIn=d9;ma.getIn=ile;ma.hasIn=ic.hasIn;ma.merge=Gse;ma.mergeWith=Use;ma.mergeIn=n9;ma.mergeDeep=zse;ma.mergeDeepWith=Hse;ma.mergeDeepIn=r9;ma.setIn=o9;ma.update=i9;ma.updateIn=a9;ma.withMutations=v_;ma.asMutable=S_;ma.asImmutable=C_;ma[PB]=ma.entries;ma.toJSON=ma.toObject=ic.toObject;ma.inspect=ma.toSource=function(){return this.toString()};function g9(e,t,r){var n=Object.create(Object.getPrototypeOf(e));return n._values=t,n.__ownerID=r,n}function y9(e){return e.constructor.displayName||e.constructor.name||"Record"}function aI(e){return ZH(e._keys.map(function(t){return[t,e.get(t)]}))}function p5e(e,t){try{Object.defineProperty(e,t,{get:function(){return this.get(t)},set:function(r){m_(this.__ownerID,"Cannot set on an immutable record."),this.set(t,r)}})}catch{}}function Ce(){return Ce.zero()}(E=>{function e(){let M=[.1,0];return M[0]=0,M}E.zero=e;function t(M){let D=e();return D[0]=M[0],D[1]=M[1],D}E.clone=t;function r(M){return o(M.x,M.y)}E.fromObj=r;function n(M){return{x:M[0],y:M[1]}}E.toObj=n;function o(M,D){let B=e();return B[0]=M,B[1]=D,B}E.create=o;function i(M){return Number.isNaN(M[0])||Number.isNaN(M[1])}E.hasNaN=i;function a(M,D,B){return D[B+0]=M[0],D[B+1]=M[1],D}E.toArray=a;function s(M,D,B){return M[0]=D[B+0],M[1]=D[B+1],M}E.fromArray=s;function l(M,D){return M[0]=D[0],M[1]=D[1],M}E.copy=l;function u(M,D,B){return M[0]=D,M[1]=B,M}E.set=u;function c(M,D,B){return M[0]=D[0]+B[0],M[1]=D[1]+B[1],M}E.add=c;function m(M,D,B){return M[0]=D[0]-B[0],M[1]=D[1]-B[1],M}E.sub=m;function d(M,D,B){return M[0]=D[0]*B[0],M[1]=D[1]*B[1],M}E.mul=d;function p(M,D,B){return M[0]=D[0]/B[0],M[1]=D[1]/B[1],M}E.div=p;function h(M,D,B){return M[0]=D[0]*B,M[1]=D[1]*B,M}E.scale=h;function f(M,D){return M[0]=Math.round(D[0]),M[1]=Math.round(D[1]),M}E.round=f;function g(M,D){return M[0]=Math.ceil(D[0]),M[1]=Math.ceil(D[1]),M}E.ceil=g;function y(M,D){return M[0]=Math.floor(D[0]),M[1]=Math.floor(D[1]),M}E.floor=y;function x(M,D){let B=D[0]-M[0],k=D[1]-M[1];return Math.sqrt(B*B+k*k)}E.distance=x;function S(M,D){let B=D[0]-M[0],k=D[1]-M[1];return B*B+k*k}E.squaredDistance=S;function I(M){let D=M[0],B=M[1];return Math.sqrt(D*D+B*B)}E.magnitude=I;function v(M){let D=M[0],B=M[1];return D*D+B*B}E.squaredMagnitude=v;function A(M,D,B){return h(M,T(M,D),B)}E.setMagnitude=A;function P(M,D){return M[0]=1/D[0],M[1]=1/D[1],M}E.inverse=P;function T(M,D){let B=D[0],k=D[1],F=B*B+k*k;return F>0&&(F=1/Math.sqrt(F),M[0]=D[0]*F,M[1]=D[1]*F),M}E.normalize=T;function R(M,D){return M[0]===D[0]&&M[1]===D[1]}E.areEqual=R;function w(M,D){return`[${M[0].toPrecision(D)} ${M[1].toPrecision(D)}}]`}E.toString=w})(Ce||={});function mo(e,t,r){return Math.abs(e-t)<=r}function Mt(){return Mt.zero()}(fe=>{function e(){let O=[.1,0,0,0,0,0,0,0,0];return O[0]=0,O}fe.zero=e;function t(){let O=e();return O[0]=1,O[1]=0,O[2]=0,O[3]=0,O[4]=1,O[5]=0,O[6]=0,O[7]=0,O[8]=1,O}fe.identity=t;function r(O){return O[0]=1,O[1]=0,O[2]=0,O[3]=0,O[4]=1,O[5]=0,O[6]=0,O[7]=0,O[8]=1,O}fe.setIdentity=r;function n(O,V,Z){return V[Z+0]=O[0],V[Z+1]=O[1],V[Z+2]=O[2],V[Z+3]=O[3],V[Z+4]=O[4],V[Z+5]=O[5],V[Z+6]=O[6],V[Z+7]=O[7],V[Z+8]=O[8],V}fe.toArray=n;function o(O,V,Z){return O[0]=V[Z+0],O[1]=V[Z+1],O[2]=V[Z+2],O[3]=V[Z+3],O[4]=V[Z+4],O[5]=V[Z+5],O[6]=V[Z+6],O[7]=V[Z+7],O[8]=V[Z+8],O}fe.fromArray=o;function i(O,V,Z,pe){return O[0]=V[0],O[1]=V[1],O[2]=V[2],O[3]=Z[0],O[4]=Z[1],O[5]=Z[2],O[6]=pe[0],O[7]=pe[1],O[8]=pe[2],O}fe.fromColumns=i;function a(O,V){return O[0]=V[0],O[1]=V[1],O[2]=V[2],O[3]=V[4],O[4]=V[5],O[5]=V[6],O[6]=V[8],O[7]=V[9],O[8]=V[10],O}fe.fromMat4=a;let s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];function l(O,V,Z){return H.fromEuler(s,V,Z),a(O,s)}fe.fromEuler=l;function u(O,V,Z){return H.fromRotation(s,V,Z),a(O,s)}fe.fromRotation=u;function c(O,V,Z,pe,$,ae,Se,ve,K){let re=e();return re[0]=O,re[1]=V,re[2]=Z,re[3]=pe,re[4]=$,re[5]=ae,re[6]=Se,re[7]=ve,re[8]=K,re}fe.create=c;let m=t();function d(O,V){return f(O,m,typeof V>"u"?1e-6:V)}fe.isIdentity=d;function p(O){for(let V=0;V<9;V++)if(Number.isNaN(O[V]))return!0;return!1}fe.hasNaN=p;function h(O){return x(e(),O)}fe.clone=h;function f(O,V,Z){for(let pe=0;pe<9;pe++)if(Math.abs(O[pe]-V[pe])>Z)return!1;return!0}fe.areEqual=f;function g(O,V,Z,pe){O[3*Z+V]=pe}fe.setValue=g;function y(O,V,Z){return O[3*Z+V]}fe.getValue=y;function x(O,V){return O[0]=V[0],O[1]=V[1],O[2]=V[2],O[3]=V[3],O[4]=V[4],O[5]=V[5],O[6]=V[6],O[7]=V[7],O[8]=V[8],O}fe.copy=x;function S(O,V){if(O===V){let Z=V[1],pe=V[2],$=V[5];O[1]=V[3],O[2]=V[6],O[3]=Z,O[5]=V[7],O[6]=pe,O[7]=$}else O[0]=V[0],O[1]=V[3],O[2]=V[6],O[3]=V[1],O[4]=V[4],O[5]=V[7],O[6]=V[2],O[7]=V[5],O[8]=V[8];return O}fe.transpose=S;function I(O,V){let Z=V[0],pe=V[1],$=V[2],ae=V[3],Se=V[4],ve=V[5],K=V[6],re=V[7],le=V[8],ge=le*Se-ve*re,Ee=-le*ae+ve*K,nt=re*ae-Se*K,at=Z*ge+pe*Ee+$*nt;return at?(at=1/at,O[0]=ge*at,O[1]=(-le*pe+$*re)*at,O[2]=(ve*pe-$*Se)*at,O[3]=Ee*at,O[4]=(le*Z-$*K)*at,O[5]=(-ve*Z+$*ae)*at,O[6]=nt*at,O[7]=(-re*Z+pe*K)*at,O[8]=(Se*Z-pe*ae)*at,O):(console.warn("non-invertible matrix.",V),O)}fe.invert=I;function v(O,V){return O===V?(O[3]=V[1],O[6]=V[2],O[7]=V[5]):(O[0]=V[0],O[1]=V[1],O[2]=V[2],O[3]=V[1],O[4]=V[4],O[5]=V[5],O[6]=V[2],O[7]=V[5],O[8]=V[8]),O}fe.symmtricFromUpper=v;function A(O,V){return O===V?(O[1]=V[3],O[2]=V[6],O[5]=V[7]):(O[0]=V[0],O[1]=V[3],O[2]=V[6],O[3]=V[3],O[4]=V[4],O[5]=V[7],O[6]=V[6],O[7]=V[7],O[8]=V[8]),O}fe.symmtricFromLower=A;function P(O){let V=O[0],Z=O[1],pe=O[2],$=O[3],ae=O[4],Se=O[5],ve=O[6],K=O[7],re=O[8],le=re*ae-Se*K,ge=-re*$+Se*ve,Ee=K*$-ae*ve;return V*le+Z*ge+pe*Ee}fe.determinant=P;function T(O){return O[0]+O[4]+O[8]}fe.trace=T;function R(O,V,Z){return O[0]=V[0]-Z[0],O[1]=V[1]-Z[1],O[2]=V[2]-Z[2],O[3]=V[3]-Z[3],O[4]=V[4]-Z[4],O[5]=V[5]-Z[5],O[6]=V[6]-Z[6],O[7]=V[7]-Z[7],O[8]=V[8]-Z[8],O}fe.sub=R;function w(O,V,Z){return O[0]=V[0]+Z[0],O[1]=V[1]+Z[1],O[2]=V[2]+Z[2],O[3]=V[3]+Z[3],O[4]=V[4]+Z[4],O[5]=V[5]+Z[5],O[6]=V[6]+Z[6],O[7]=V[7]+Z[7],O[8]=V[8]+Z[8],O}fe.add=w;function E(O,V,Z){let pe=V[0],$=V[1],ae=V[2],Se=V[3],ve=V[4],K=V[5],re=V[6],le=V[7],ge=V[8],Ee=Z[0],nt=Z[1],at=Z[2],be=Z[3],Re=Z[4],Fe=Z[5],Ne=Z[6],ot=Z[7],it=Z[8];return O[0]=Ee*pe+nt*Se+at*re,O[1]=Ee*$+nt*ve+at*le,O[2]=Ee*ae+nt*K+at*ge,O[3]=be*pe+Re*Se+Fe*re,O[4]=be*$+Re*ve+Fe*le,O[5]=be*ae+Re*K+Fe*ge,O[6]=Ne*pe+ot*Se+it*re,O[7]=Ne*$+ot*ve+it*le,O[8]=Ne*ae+ot*K+it*ge,O}fe.mul=E;function M(O,V,Z){return O[0]=V[0]-Z,O[1]=V[1]-Z,O[2]=V[2]-Z,O[3]=V[3]-Z,O[4]=V[4]-Z,O[5]=V[5]-Z,O[6]=V[6]-Z,O[7]=V[7]-Z,O[8]=V[8]-Z,O}fe.subScalar=M;function D(O,V,Z){return O[0]=V[0]+Z,O[1]=V[1]+Z,O[2]=V[2]+Z,O[3]=V[3]+Z,O[4]=V[4]+Z,O[5]=V[5]+Z,O[6]=V[6]+Z,O[7]=V[7]+Z,O[8]=V[8]+Z,O}fe.addScalar=D;function B(O,V,Z){return O[0]=V[0]*Z,O[1]=V[1]*Z,O[2]=V[2]*Z,O[3]=V[3]*Z,O[4]=V[4]*Z,O[5]=V[5]*Z,O[6]=V[6]*Z,O[7]=V[7]*Z,O[8]=V[8]*Z,O}fe.mulScalar=B;let k=Math.PI/3,F=e();function z(O,V){let Z=V[1]*V[1]+V[2]*V[2]+V[5]*V[5];if(Z===0)O[0]=V[0],O[1]=V[4],O[2]=V[8];else{let pe=T(V)/3,$=V[0]-pe,ae=V[4]-pe,Se=V[8]-pe,ve=$*$+ae*ae+Se*Se+2*Z,K=Math.sqrt(ve/6);B(F,fe.Identity,pe),R(F,V,F),B(F,F,1/K);let re=P(F)/2,le=re<=-1?k:re>=1?0:Math.acos(re)/3;O[0]=pe+2*K*Math.cos(le),O[2]=pe+2*K*Math.cos(le+2*k),O[1]=3*pe-O[0]-O[2]}return O}fe.symmetricEigenvalues=z;let j=[.1,0,0],Y=[.1,0,0],G=[.1,0,0],X=[.1,0,0],U=[.1,0,0],L=[.1,0,0];function q(O,V,Z){b.set(j,V[0]-Z,V[1],V[2]),b.set(Y,V[1],V[4]-Z,V[5]),b.set(G,V[2],V[5],V[8]-Z),b.cross(X,j,Y),b.cross(U,j,G),b.cross(L,Y,G);let pe=b.dot(X,X),$=b.dot(U,U),ae=b.dot(L,L),Se=pe,ve=0;return $>Se&&(Se=$,ve=1),ae>Se&&(ve=2),ve===0?b.scale(O,X,1/Math.sqrt(pe)):ve===1?b.scale(O,U,1/Math.sqrt($)):b.scale(O,L,1/Math.sqrt(ae)),O}fe.eigenvector=q;function te(O,V){return a(O,V),I(O,O),S(O,O),O}fe.directionTransform=te,fe.Identity=t();function ee(O,V){return O[0]*V[0]+O[1]*V[1]+O[2]*V[2]+O[3]*V[3]+O[4]*V[4]+O[5]*V[5]+O[6]*V[6]+O[7]*V[7]+O[8]*V[8]}fe.innerProduct=ee;function ce(O,V){let Z=V[0],pe=V[1],$=V[2],ae=V[4],Se=V[5],ve=V[6],K=V[8],re=V[9],le=V[10];return O[0]=Se*le-ve*re,O[1]=ve*K-ae*le,O[2]=ae*re-Se*K,O[3]=re*$-le*pe,O[4]=le*Z-K*$,O[5]=K*pe-re*Z,O[6]=pe*ve-$*Se,O[7]=$*ae-Z*ve,O[8]=Z*Se-pe*ae,O}fe.adjointFromMat4=ce})(Mt||={});function bS(e){return Object.keys(e)}function Mr(e){throw new Error("unreachable")}function jx(e){return typeof e?.then=="function"}function lr(){return lr.zero()}(pe=>{function e(){let $=[.1,0,0,0];return $[0]=0,$}pe.zero=e;function t(){let $=e();return $[3]=1,$}pe.identity=t;function r($){$[0]=0,$[1]=0,$[2]=0,$[3]=1}pe.setIdentity=r;function n($){return Number.isNaN($[0])||Number.isNaN($[1])||Number.isNaN($[2])||Number.isNaN($[3])}pe.hasNaN=n;function o($,ae,Se,ve){let K=t();return K[0]=$,K[1]=ae,K[2]=Se,K[3]=ve,K}pe.create=o;function i($,ae,Se){Se=Se*.5;let ve=Math.sin(Se);return $[0]=ve*ae[0],$[1]=ve*ae[1],$[2]=ve*ae[2],$[3]=Math.cos(Se),$}pe.setAxisAngle=i;function a($,ae){let Se=Math.acos(ae[3])*2,ve=Math.sin(Se/2);return ve!==0?($[0]=ae[0]/ve,$[1]=ae[1]/ve,$[2]=ae[2]/ve):($[0]=1,$[1]=0,$[2]=0),Se}pe.getAxisAngle=a;function s($,ae,Se){let ve=ae[0],K=ae[1],re=ae[2],le=ae[3],ge=Se[0],Ee=Se[1],nt=Se[2],at=Se[3];return $[0]=ve*at+le*ge+K*nt-re*Ee,$[1]=K*at+le*Ee+re*ge-ve*nt,$[2]=re*at+le*nt+ve*Ee-K*ge,$[3]=le*at-ve*ge-K*Ee-re*nt,$}pe.multiply=s;function l($,ae,Se){Se*=.5;let ve=ae[0],K=ae[1],re=ae[2],le=ae[3],ge=Math.sin(Se),Ee=Math.cos(Se);return $[0]=ve*Ee+le*ge,$[1]=K*Ee+re*ge,$[2]=re*Ee-K*ge,$[3]=le*Ee-ve*ge,$}pe.rotateX=l;function u($,ae,Se){Se*=.5;let ve=ae[0],K=ae[1],re=ae[2],le=ae[3],ge=Math.sin(Se),Ee=Math.cos(Se);return $[0]=ve*Ee-re*ge,$[1]=K*Ee+le*ge,$[2]=re*Ee+ve*ge,$[3]=le*Ee-K*ge,$}pe.rotateY=u;function c($,ae,Se){Se*=.5;let ve=ae[0],K=ae[1],re=ae[2],le=ae[3],ge=Math.sin(Se),Ee=Math.cos(Se);return $[0]=ve*Ee+K*ge,$[1]=K*Ee-ve*ge,$[2]=re*Ee+le*ge,$[3]=le*Ee-re*ge,$}pe.rotateZ=c;function m($,ae){let Se=ae[0],ve=ae[1],K=ae[2];return $[0]=Se,$[1]=ve,$[2]=K,$[3]=Math.sqrt(Math.abs(1-Se*Se-ve*ve-K*K)),$}pe.calculateW=m;function d($,ae,Se,ve){let K=ae[0],re=ae[1],le=ae[2],ge=ae[3],Ee=Se[0],nt=Se[1],at=Se[2],be=Se[3],Re,Fe,Ne,ot,it;return Fe=K*Ee+re*nt+le*at+ge*be,Fe<0&&(Fe=-Fe,Ee=-Ee,nt=-nt,at=-at,be=-be),1-Fe>1e-6?(Re=Math.acos(Fe),Ne=Math.sin(Re),ot=Math.sin((1-ve)*Re)/Ne,it=Math.sin(ve*Re)/Ne):(ot=1-ve,it=ve),$[0]=ot*K+it*Ee,$[1]=ot*re+it*nt,$[2]=ot*le+it*at,$[3]=ot*ge+it*be,$}pe.slerp=d;function p($,ae){let Se=ae[0],ve=ae[1],K=ae[2],re=ae[3],le=Se*Se+ve*ve+K*K+re*re,ge=le?1/le:0;return $[0]=-Se*ge,$[1]=-ve*ge,$[2]=-K*ge,$[3]=re*ge,$}pe.invert=p;function h($,ae){return $[0]=-ae[0],$[1]=-ae[1],$[2]=-ae[2],$[3]=ae[3],$}pe.conjugate=h;function f($,ae){return $[0]*ae[0]+$[1]*ae[1]+$[2]*ae[2]+$[3]*ae[3]}pe.dot=f;function g($,ae){let Se=ae[0]+ae[4]+ae[8],ve;if(Se>0)ve=Math.sqrt(Se+1),$[3]=.5*ve,ve=.5/ve,$[0]=(ae[5]-ae[7])*ve,$[1]=(ae[6]-ae[2])*ve,$[2]=(ae[1]-ae[3])*ve;else{let K=0;ae[4]>ae[0]&&(K=1),ae[8]>ae[K*3+K]&&(K=2);let re=(K+1)%3,le=(K+2)%3;ve=Math.sqrt(ae[K*3+K]-ae[re*3+re]-ae[le*3+le]+1),$[K]=.5*ve,ve=.5/ve,$[3]=(ae[re*3+le]-ae[le*3+re])*ve,$[re]=(ae[re*3+K]+ae[K*3+re])*ve,$[le]=(ae[le*3+K]+ae[K*3+le])*ve}return $}pe.fromMat3=g;let y=[0,0,0,0,0,0,0,0,0,0,0,0];function x($,ae){return Mt.fromMat4(y,ae),g($,y)}pe.fromMat4=x;function S($,ae,Se){let[ve,K,re]=ae,le=Math.cos(ve/2),ge=Math.cos(K/2),Ee=Math.cos(re/2),nt=Math.sin(ve/2),at=Math.sin(K/2),be=Math.sin(re/2);switch(Se){case"XYZ":$[0]=nt*ge*Ee+le*at*be,$[1]=le*at*Ee-nt*ge*be,$[2]=le*ge*be+nt*at*Ee,$[3]=le*ge*Ee-nt*at*be;break;case"YXZ":$[0]=nt*ge*Ee+le*at*be,$[1]=le*at*Ee-nt*ge*be,$[2]=le*ge*be-nt*at*Ee,$[3]=le*ge*Ee+nt*at*be;break;case"ZXY":$[0]=nt*ge*Ee-le*at*be,$[1]=le*at*Ee+nt*ge*be,$[2]=le*ge*be+nt*at*Ee,$[3]=le*ge*Ee-nt*at*be;break;case"ZYX":$[0]=nt*ge*Ee-le*at*be,$[1]=le*at*Ee+nt*ge*be,$[2]=le*ge*be-nt*at*Ee,$[3]=le*ge*Ee+nt*at*be;break;case"YZX":$[0]=nt*ge*Ee+le*at*be,$[1]=le*at*Ee+nt*ge*be,$[2]=le*ge*be-nt*at*Ee,$[3]=le*ge*Ee-nt*at*be;break;case"XZY":$[0]=nt*ge*Ee-le*at*be,$[1]=le*at*Ee-nt*ge*be,$[2]=le*ge*be+nt*at*Ee,$[3]=le*ge*Ee+nt*at*be;break;default:Mr(Se)}return $}pe.fromEuler=S;let I=[0,0,0];function v($,ae,Se){let ve=b.dot(ae,Se)+1;return ve<1e-6?(ve=0,Math.abs(ae[0])>Math.abs(ae[2])?b.set(I,-ae[1],ae[0],0):b.set(I,0,-ae[2],ae[1])):b.cross(I,ae,Se),$[0]=I[0],$[1]=I[1],$[2]=I[2],$[3]=ve,X($,$),$}pe.fromUnitVec3=v;let A=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];function P($,ae,Se,ve){return H.fromBasis(A,ae,Se,ve),x($,A)}pe.fromBasis=P;function T($){let ae=e();return ae[0]=$[0],ae[1]=$[1],ae[2]=$[2],ae[3]=$[3],ae}pe.clone=T;function R($){return o($.x,$.y,$.z,$.w)}pe.fromObj=R;function w($){return{x:$[0],y:$[1],z:$[2],w:$[3]}}pe.toObj=w;function E($,ae,Se){return ae[Se+0]=$[0],ae[Se+1]=$[1],ae[Se+2]=$[2],ae[Se+3]=$[3],ae}pe.toArray=E;function M($,ae,Se){return $[0]=ae[Se+0],$[1]=ae[Se+1],$[2]=ae[Se+2],$[3]=ae[Se+3],$}pe.fromArray=M;function D($,ae){return $[0]=ae[0],$[1]=ae[1],$[2]=ae[2],$[3]=ae[3],$}pe.copy=D;function B($,ae,Se,ve,K){return $[0]=ae,$[1]=Se,$[2]=ve,$[3]=K,$}pe.set=B;function k($,ae){return $[0]===ae[0]&&$[1]===ae[1]&&$[2]===ae[2]&&$[3]===ae[3]}pe.exactEquals=k;function F($,ae){let Se=$[0],ve=$[1],K=$[2],re=$[3],le=ae[0],ge=ae[1],Ee=ae[2],nt=ae[3];return Math.abs(Se-le)<=1e-6*Math.max(1,Math.abs(Se),Math.abs(le))&&Math.abs(ve-ge)<=1e-6*Math.max(1,Math.abs(ve),Math.abs(ge))&&Math.abs(K-Ee)<=1e-6*Math.max(1,Math.abs(K),Math.abs(Ee))&&Math.abs(re-nt)<=1e-6*Math.max(1,Math.abs(re),Math.abs(nt))}pe.equals=F;function z($,ae,Se){return $[0]=ae[0]+Se[0],$[1]=ae[1]+Se[1],$[2]=ae[2]+Se[2],$[3]=ae[3]+Se[3],$}pe.add=z;function j($){let ae=$[0],Se=$[1],ve=$[2],K=$[3];return Math.sqrt(ae*ae+Se*Se+ve*ve+K*K)}pe.magnitude=j;function Y($){let ae=$[0],Se=$[1],ve=$[2],K=$[3];return ae*ae+Se*Se+ve*ve+K*K}pe.squaredMagnitude=Y;function G($,ae){return 2*Math.acos(Math.abs(_r(f($,ae),-1,1)))}pe.angle=G;function X($,ae){let Se=ae[0],ve=ae[1],K=ae[2],re=ae[3],le=Se*Se+ve*ve+K*K+re*re;return le>0&&(le=1/Math.sqrt(le),$[0]=Se*le,$[1]=ve*le,$[2]=K*le,$[3]=re*le),$}pe.normalize=X;let U=[0,0,0],L=[1,0,0],q=[0,1,0];function te($,ae,Se){let ve=b.dot(ae,Se);return ve<-.999999?(b.cross(U,L,ae),b.magnitude(U)<1e-6&&b.cross(U,q,ae),b.normalize(U,U),i($,U,Math.PI),$):ve>.999999?($[0]=0,$[1]=0,$[2]=0,$[3]=1,$):(b.cross(U,ae,Se),$[0]=U[0],$[1]=U[1],$[2]=U[2],$[3]=1+ve,X($,$))}pe.rotationTo=te;let J=e(),ee=e();function ce($,ae,Se,ve,K,re){return d(J,ae,K,re),d(ee,Se,ve,re),d($,J,ee,2*re*(1-re)),$}pe.sqlerp=ce;let fe=[0,0,0,0,0,0,0,0,0];function O($,ae,Se,ve){return fe[0]=Se[0],fe[3]=Se[1],fe[6]=Se[2],fe[1]=ve[0],fe[4]=ve[1],fe[7]=ve[2],fe[2]=-ae[0],fe[5]=-ae[1],fe[8]=-ae[2],X($,g($,fe))}pe.setAxes=O;function V($,ae){return`[${$[0].toPrecision(ae)} ${$[1].toPrecision(ae)} ${$[2].toPrecision(ae)}  ${$[3].toPrecision(ae)}]`}pe.toString=V,pe.Identity=t()})(lr||={});function H(){return H.zero()}(ao=>{function e(){let N=[.1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];return N[0]=0,N}ao.zero=e;function t(){let N=e();return N[0]=1,N[1]=0,N[2]=0,N[3]=0,N[4]=0,N[5]=1,N[6]=0,N[7]=0,N[8]=0,N[9]=0,N[10]=1,N[11]=0,N[12]=0,N[13]=0,N[14]=0,N[15]=1,N}ao.identity=t;function r(N){return N[0]=1,N[1]=0,N[2]=0,N[3]=0,N[4]=0,N[5]=1,N[6]=0,N[7]=0,N[8]=0,N[9]=0,N[10]=1,N[11]=0,N[12]=0,N[13]=0,N[14]=0,N[15]=1,N}ao.setIdentity=r;function n(N){for(let oe=0;oe<16;oe++)if(N[oe]!==0)return!1;return!0}ao.isZero=n;function o(N){for(let oe=0;oe<16;oe++)N[oe]=0;return N}ao.setZero=o;function i(N){let oe=e();for(let Ve=0;Ve<4;Ve++){let $e=N[Ve];for(let ct=0;ct<4;ct++)oe[4*ct+Ve]=$e[ct]}return oe}ao.ofRows=i;let a=t();function s(N,oe){return u(N,a,typeof oe>"u"?1e-6:oe)}ao.isIdentity=s;function l(N){for(let oe=0;oe<16;oe++)if(Number.isNaN(N[oe]))return!0;return!1}ao.hasNaN=l;function u(N,oe,Ve){for(let $e=0;$e<16;$e++)if(Math.abs(N[$e]-oe[$e])>Ve)return!1;return!0}ao.areEqual=u;function c(N,oe,Ve,$e){N[4*Ve+oe]=$e}ao.setValue=c;function m(N,oe,Ve){return N[4*Ve+oe]}ao.getValue=m;function d(N,oe,Ve){return oe[Ve+0]=N[0],oe[Ve+1]=N[1],oe[Ve+2]=N[2],oe[Ve+3]=N[3],oe[Ve+4]=N[4],oe[Ve+5]=N[5],oe[Ve+6]=N[6],oe[Ve+7]=N[7],oe[Ve+8]=N[8],oe[Ve+9]=N[9],oe[Ve+10]=N[10],oe[Ve+11]=N[11],oe[Ve+12]=N[12],oe[Ve+13]=N[13],oe[Ve+14]=N[14],oe[Ve+15]=N[15],oe}ao.toArray=d;function p(N,oe,Ve){return N[0]=oe[Ve+0],N[1]=oe[Ve+1],N[2]=oe[Ve+2],N[3]=oe[Ve+3],N[4]=oe[Ve+4],N[5]=oe[Ve+5],N[6]=oe[Ve+6],N[7]=oe[Ve+7],N[8]=oe[Ve+8],N[9]=oe[Ve+9],N[10]=oe[Ve+10],N[11]=oe[Ve+11],N[12]=oe[Ve+12],N[13]=oe[Ve+13],N[14]=oe[Ve+14],N[15]=oe[Ve+15],N}ao.fromArray=p;function h(N,oe,Ve,$e){return o(N),c(N,0,0,oe[0]),c(N,1,0,oe[1]),c(N,2,0,oe[2]),c(N,0,1,Ve[0]),c(N,1,1,Ve[1]),c(N,2,1,Ve[2]),c(N,0,2,$e[0]),c(N,1,2,$e[1]),c(N,2,2,$e[2]),c(N,3,3,1),N}ao.fromBasis=h;function f(N,oe){return N[0]=oe[0],N[1]=oe[1],N[2]=oe[2],N[3]=oe[3],N[4]=oe[4],N[5]=oe[5],N[6]=oe[6],N[7]=oe[7],N[8]=oe[8],N[9]=oe[9],N[10]=oe[10],N[11]=oe[11],N[12]=oe[12],N[13]=oe[13],N[14]=oe[14],N[15]=oe[15],N}ao.copy=f;function g(N){return f(e(),N)}ao.clone=g;function y(N,oe){return N[0]=oe[12],N[1]=oe[13],N[2]=oe[14],N}ao.getTranslation=y;function x(N,oe){let Ve=oe[0],$e=oe[1],ct=oe[2],vt=oe[4],Pt=oe[5],Ot=oe[6],Ft=oe[8],Dt=oe[9],wt=oe[10];return N[0]=Math.sqrt(Ve*Ve+$e*$e+ct*ct),N[1]=Math.sqrt(vt*vt+Pt*Pt+Ot*Ot),N[2]=Math.sqrt(Ft*Ft+Dt*Dt+wt*wt),N}ao.getScaling=x;function S(N,oe){let Ve=oe[0]+oe[5]+oe[10],$e=0;return Ve>0?($e=Math.sqrt(Ve+1)*2,N[3]=.25*$e,N[0]=(oe[6]-oe[9])/$e,N[1]=(oe[8]-oe[2])/$e,N[2]=(oe[1]-oe[4])/$e):oe[0]>oe[5]&&oe[0]>oe[10]?($e=Math.sqrt(1+oe[0]-oe[5]-oe[10])*2,N[3]=(oe[6]-oe[9])/$e,N[0]=.25*$e,N[1]=(oe[1]+oe[4])/$e,N[2]=(oe[8]+oe[2])/$e):oe[5]>oe[10]?($e=Math.sqrt(1+oe[5]-oe[0]-oe[10])*2,N[3]=(oe[8]-oe[2])/$e,N[0]=(oe[1]+oe[4])/$e,N[1]=.25*$e,N[2]=(oe[6]+oe[9])/$e):($e=Math.sqrt(1+oe[10]-oe[0]-oe[5])*2,N[3]=(oe[1]-oe[4])/$e,N[0]=(oe[8]+oe[2])/$e,N[1]=(oe[6]+oe[9])/$e,N[2]=.25*$e),N}ao.getRotation=S;function I(N,oe){let Ve=1/Math.sqrt(oe[0]*oe[0]+oe[1]*oe[1]+oe[2]*oe[2]),$e=1/Math.sqrt(oe[4]*oe[4]+oe[5]*oe[5]+oe[6]*oe[6]),ct=1/Math.sqrt(oe[8]*oe[8]+oe[9]*oe[9]+oe[10]*oe[10]);return N[0]=oe[0]*Ve,N[1]=oe[1]*Ve,N[2]=oe[2]*Ve,N[3]=0,N[4]=oe[4]*$e,N[5]=oe[5]*$e,N[6]=oe[6]*$e,N[7]=0,N[8]=oe[8]*ct,N[9]=oe[9]*ct,N[10]=oe[10]*ct,N[11]=0,N[12]=0,N[13]=0,N[14]=0,N[15]=1,N}ao.extractRotation=I;function v(N,oe){if(N===oe){let Ve=oe[1],$e=oe[2],ct=oe[3],vt=oe[6],Pt=oe[7],Ot=oe[11];N[1]=oe[4],N[2]=oe[8],N[3]=oe[12],N[4]=Ve,N[6]=oe[9],N[7]=oe[13],N[8]=$e,N[9]=vt,N[11]=oe[14],N[12]=ct,N[13]=Pt,N[14]=Ot}else N[0]=oe[0],N[1]=oe[4],N[2]=oe[8],N[3]=oe[12],N[4]=oe[1],N[5]=oe[5],N[6]=oe[9],N[7]=oe[13],N[8]=oe[2],N[9]=oe[6],N[10]=oe[10],N[11]=oe[14],N[12]=oe[3],N[13]=oe[7],N[14]=oe[11],N[15]=oe[15];return N}ao.transpose=v;function A(N,oe){let Ve=oe[0],$e=oe[1],ct=oe[2],vt=oe[3],Pt=oe[4],Ot=oe[5],Ft=oe[6],Dt=oe[7],wt=oe[8],Nt=oe[9],Zt=oe[10],zt=oe[11],hr=oe[12],ar=oe[13],fr=oe[14],me=oe[15],Ie=Ve*Ot-$e*Pt,Pe=Ve*Ft-ct*Pt,_e=Ve*Dt-vt*Pt,Ze=$e*Ft-ct*Ot,ze=$e*Dt-vt*Ot,Rt=ct*Dt-vt*Ft,ir=wt*ar-Nt*hr,Oe=wt*fr-Zt*hr,ht=wt*me-zt*hr,Ye=Nt*fr-Zt*ar,dr=Nt*me-zt*ar,Xr=Zt*me-zt*fr,we=Ie*Xr-Pe*dr+_e*Ye+Ze*ht-ze*Oe+Rt*ir;return we?(we=1/we,N[0]=(Ot*Xr-Ft*dr+Dt*Ye)*we,N[1]=(ct*dr-$e*Xr-vt*Ye)*we,N[2]=(ar*Rt-fr*ze+me*Ze)*we,N[3]=(Zt*ze-Nt*Rt-zt*Ze)*we,N[4]=(Ft*ht-Pt*Xr-Dt*Oe)*we,N[5]=(Ve*Xr-ct*ht+vt*Oe)*we,N[6]=(fr*_e-hr*Rt-me*Pe)*we,N[7]=(wt*Rt-Zt*_e+zt*Pe)*we,N[8]=(Pt*dr-Ot*ht+Dt*ir)*we,N[9]=($e*ht-Ve*dr-vt*ir)*we,N[10]=(hr*ze-ar*_e+me*Ie)*we,N[11]=(Nt*_e-wt*ze-zt*Ie)*we,N[12]=(Ot*Oe-Pt*Ye-Ft*ir)*we,N[13]=(Ve*Ye-$e*Oe+ct*ir)*we,N[14]=(ar*Pe-hr*Ze-fr*Ie)*we,N[15]=(wt*Ze-Nt*Pe+Zt*Ie)*we,!0):!1}ao.tryInvert=A;function P(N,oe){return A(N,oe)||console.warn("non-invertible matrix.",oe),N}ao.invert=P;function T(N,oe,Ve){let $e=oe[0],ct=oe[1],vt=oe[2],Pt=oe[3],Ot=oe[4],Ft=oe[5],Dt=oe[6],wt=oe[7],Nt=oe[8],Zt=oe[9],zt=oe[10],hr=oe[11],ar=oe[12],fr=oe[13],me=oe[14],Ie=oe[15],Pe=Ve[0],_e=Ve[1],Ze=Ve[2],ze=Ve[3];return N[0]=Pe*$e+_e*Ot+Ze*Nt+ze*ar,N[1]=Pe*ct+_e*Ft+Ze*Zt+ze*fr,N[2]=Pe*vt+_e*Dt+Ze*zt+ze*me,N[3]=Pe*Pt+_e*wt+Ze*hr+ze*Ie,Pe=Ve[4],_e=Ve[5],Ze=Ve[6],ze=Ve[7],N[4]=Pe*$e+_e*Ot+Ze*Nt+ze*ar,N[5]=Pe*ct+_e*Ft+Ze*Zt+ze*fr,N[6]=Pe*vt+_e*Dt+Ze*zt+ze*me,N[7]=Pe*Pt+_e*wt+Ze*hr+ze*Ie,Pe=Ve[8],_e=Ve[9],Ze=Ve[10],ze=Ve[11],N[8]=Pe*$e+_e*Ot+Ze*Nt+ze*ar,N[9]=Pe*ct+_e*Ft+Ze*Zt+ze*fr,N[10]=Pe*vt+_e*Dt+Ze*zt+ze*me,N[11]=Pe*Pt+_e*wt+Ze*hr+ze*Ie,Pe=Ve[12],_e=Ve[13],Ze=Ve[14],ze=Ve[15],N[12]=Pe*$e+_e*Ot+Ze*Nt+ze*ar,N[13]=Pe*ct+_e*Ft+Ze*Zt+ze*fr,N[14]=Pe*vt+_e*Dt+Ze*zt+ze*me,N[15]=Pe*Pt+_e*wt+Ze*hr+ze*Ie,N}ao.mul=T;function R(N,oe,Ve,$e,ct,vt){let Pt=oe[0+ct],Ot=oe[1+ct],Ft=oe[2+ct],Dt=oe[3+ct],wt=oe[4+ct],Nt=oe[5+ct],Zt=oe[6+ct],zt=oe[7+ct],hr=oe[8+ct],ar=oe[9+ct],fr=oe[10+ct],me=oe[11+ct],Ie=oe[12+ct],Pe=oe[13+ct],_e=oe[14+ct],Ze=oe[15+ct],ze=Ve[0+vt],Rt=Ve[1+vt],ir=Ve[2+vt],Oe=Ve[3+vt];return N[0+$e]=ze*Pt+Rt*wt+ir*hr+Oe*Ie,N[1+$e]=ze*Ot+Rt*Nt+ir*ar+Oe*Pe,N[2+$e]=ze*Ft+Rt*Zt+ir*fr+Oe*_e,N[3+$e]=ze*Dt+Rt*zt+ir*me+Oe*Ze,ze=Ve[4+vt],Rt=Ve[5+vt],ir=Ve[6+vt],Oe=Ve[7+vt],N[4+$e]=ze*Pt+Rt*wt+ir*hr+Oe*Ie,N[5+$e]=ze*Ot+Rt*Nt+ir*ar+Oe*Pe,N[6+$e]=ze*Ft+Rt*Zt+ir*fr+Oe*_e,N[7+$e]=ze*Dt+Rt*zt+ir*me+Oe*Ze,ze=Ve[8+vt],Rt=Ve[9+vt],ir=Ve[10+vt],Oe=Ve[11+vt],N[8+$e]=ze*Pt+Rt*wt+ir*hr+Oe*Ie,N[9+$e]=ze*Ot+Rt*Nt+ir*ar+Oe*Pe,N[10+$e]=ze*Ft+Rt*Zt+ir*fr+Oe*_e,N[11+$e]=ze*Dt+Rt*zt+ir*me+Oe*Ze,ze=Ve[12+vt],Rt=Ve[13+vt],ir=Ve[14+vt],Oe=Ve[15+vt],N[12+$e]=ze*Pt+Rt*wt+ir*hr+Oe*Ie,N[13+$e]=ze*Ot+Rt*Nt+ir*ar+Oe*Pe,N[14+$e]=ze*Ft+Rt*Zt+ir*fr+Oe*_e,N[15+$e]=ze*Dt+Rt*zt+ir*me+Oe*Ze,N}ao.mulOffset=R;function w(N,oe,Ve,$e){return T(N,T(N,oe,Ve),$e)}ao.mul3=w;function E(N,oe,Ve){let $e=Ve[0],ct=Ve[1],vt=Ve[2],Pt,Ot,Ft,Dt,wt,Nt,Zt,zt,hr,ar,fr,me;return oe===N?(N[12]=oe[0]*$e+oe[4]*ct+oe[8]*vt+oe[12],N[13]=oe[1]*$e+oe[5]*ct+oe[9]*vt+oe[13],N[14]=oe[2]*$e+oe[6]*ct+oe[10]*vt+oe[14],N[15]=oe[3]*$e+oe[7]*ct+oe[11]*vt+oe[15]):(Pt=oe[0],Ot=oe[1],Ft=oe[2],Dt=oe[3],wt=oe[4],Nt=oe[5],Zt=oe[6],zt=oe[7],hr=oe[8],ar=oe[9],fr=oe[10],me=oe[11],N[0]=Pt,N[1]=Ot,N[2]=Ft,N[3]=Dt,N[4]=wt,N[5]=Nt,N[6]=Zt,N[7]=zt,N[8]=hr,N[9]=ar,N[10]=fr,N[11]=me,N[12]=Pt*$e+wt*ct+hr*vt+oe[12],N[13]=Ot*$e+Nt*ct+ar*vt+oe[13],N[14]=Ft*$e+Zt*ct+fr*vt+oe[14],N[15]=Dt*$e+zt*ct+me*vt+oe[15]),N}ao.translate=E;function M(N,oe){return N[0]=1,N[1]=0,N[2]=0,N[3]=0,N[4]=0,N[5]=1,N[6]=0,N[7]=0,N[8]=0,N[9]=0,N[10]=1,N[11]=0,N[12]=oe[0],N[13]=oe[1],N[14]=oe[2],N[15]=1,N}ao.fromTranslation=M;function D(N,oe){return N[12]=oe[0],N[13]=oe[1],N[14]=oe[2],N}ao.setTranslation=D;function B(N,oe,Ve,$e){return N[0]=Ve[0],N[4]=Ve[1],N[8]=Ve[2],N[1]=$e[0],N[5]=$e[1],N[9]=$e[2],N[2]=oe[0],N[6]=oe[1],N[10]=oe[2],N}ao.setAxes=B;function k(N,oe,Ve,$e){let ct=$e[0],vt=$e[1],Pt=$e[2],Ot=Math.sqrt(ct*ct+vt*vt+Pt*Pt);if(Math.abs(Ot)<1e-6)return t();Ot=1/Ot,ct*=Ot,vt*=Ot,Pt*=Ot;let Ft=Math.sin(Ve),Dt=Math.cos(Ve),wt=1-Dt,Nt=oe[0],Zt=oe[1],zt=oe[2],hr=oe[3],ar=oe[4],fr=oe[5],me=oe[6],Ie=oe[7],Pe=oe[8],_e=oe[9],Ze=oe[10],ze=oe[11],Rt=ct*ct*wt+Dt,ir=vt*ct*wt+Pt*Ft,Oe=Pt*ct*wt-vt*Ft,ht=ct*vt*wt-Pt*Ft,Ye=vt*vt*wt+Dt,dr=Pt*vt*wt+ct*Ft,Xr=ct*Pt*wt+vt*Ft,we=vt*Pt*wt-ct*Ft,qt=Pt*Pt*wt+Dt;return N[0]=Nt*Rt+ar*ir+Pe*Oe,N[1]=Zt*Rt+fr*ir+_e*Oe,N[2]=zt*Rt+me*ir+Ze*Oe,N[3]=hr*Rt+Ie*ir+ze*Oe,N[4]=Nt*ht+ar*Ye+Pe*dr,N[5]=Zt*ht+fr*Ye+_e*dr,N[6]=zt*ht+me*Ye+Ze*dr,N[7]=hr*ht+Ie*Ye+ze*dr,N[8]=Nt*Xr+ar*we+Pe*qt,N[9]=Zt*Xr+fr*we+_e*qt,N[10]=zt*Xr+me*we+Ze*qt,N[11]=hr*Xr+Ie*we+ze*qt,oe!==N&&(N[12]=oe[12],N[13]=oe[13],N[14]=oe[14],N[15]=oe[15]),N}ao.rotate=k;function F(N,oe,Ve){let $e=Ve[0],ct=Ve[1],vt=Ve[2],Pt=Math.sqrt($e*$e+ct*ct+vt*vt);if(Math.abs(Pt)<1e-6)return r(N);Pt=1/Pt,$e*=Pt,ct*=Pt,vt*=Pt;let Ot=Math.sin(oe),Ft=Math.cos(oe),Dt=1-Ft;return N[0]=$e*$e*Dt+Ft,N[1]=ct*$e*Dt+vt*Ot,N[2]=vt*$e*Dt-ct*Ot,N[3]=0,N[4]=$e*ct*Dt-vt*Ot,N[5]=ct*ct*Dt+Ft,N[6]=vt*ct*Dt+$e*Ot,N[7]=0,N[8]=$e*vt*Dt+ct*Ot,N[9]=ct*vt*Dt-$e*Ot,N[10]=vt*vt*Dt+Ft,N[11]=0,N[12]=0,N[13]=0,N[14]=0,N[15]=1,N}ao.fromRotation=F;function z(N,oe,Ve){let $e=Ve[0],ct=Ve[1],vt=Ve[2];return N[0]=oe[0]*$e,N[1]=oe[1]*$e,N[2]=oe[2]*$e,N[3]=oe[3]*$e,N[4]=oe[4]*ct,N[5]=oe[5]*ct,N[6]=oe[6]*ct,N[7]=oe[7]*ct,N[8]=oe[8]*vt,N[9]=oe[9]*vt,N[10]=oe[10]*vt,N[11]=oe[11]*vt,N[12]=oe[12],N[13]=oe[13],N[14]=oe[14],N[15]=oe[15],N}ao.scale=z;function j(N,oe,Ve){return N[0]=oe[0]*Ve,N[1]=oe[1]*Ve,N[2]=oe[2]*Ve,N[3]=oe[3]*Ve,N[4]=oe[4]*Ve,N[5]=oe[5]*Ve,N[6]=oe[6]*Ve,N[7]=oe[7]*Ve,N[8]=oe[8]*Ve,N[9]=oe[9]*Ve,N[10]=oe[10]*Ve,N[11]=oe[11]*Ve,N[12]=oe[12],N[13]=oe[13],N[14]=oe[14],N[15]=oe[15],N}ao.scaleUniformly=j;function Y(N,oe){return N[0]=oe[0],N[1]=0,N[2]=0,N[3]=0,N[4]=0,N[5]=oe[1],N[6]=0,N[7]=0,N[8]=0,N[9]=0,N[10]=oe[2],N[11]=0,N[12]=0,N[13]=0,N[14]=0,N[15]=1,N}ao.fromScaling=Y;function G(N,oe){return N[0]=oe,N[1]=0,N[2]=0,N[3]=0,N[4]=0,N[5]=oe,N[6]=0,N[7]=0,N[8]=0,N[9]=0,N[10]=oe,N[11]=0,N[12]=0,N[13]=0,N[14]=0,N[15]=1,N}ao.fromUniformScaling=G;let X=[0,0,0],U=[0,0,0];function L(N,oe,Ve){let $e=b.cross(X,oe,b.unitX);b.dot($e,$e)<1e-6&&b.cross($e,oe,b.unitY),b.normalize($e,$e);let ct=b.cross(U,oe,$e);return b.normalize(ct,ct),B(N,oe,$e,ct),N[12]=Ve[0],N[13]=Ve[1],N[14]=Ve[2],N[15]=1,N}ao.fromPlane=L;function q(N,oe){return N[0]=oe[0],N[1]=oe[1],N[2]=oe[2],N[4]=oe[3],N[5]=oe[4],N[6]=oe[5],N[8]=oe[6],N[9]=oe[7],N[10]=oe[8],N}ao.fromMat3=q;function te(N,oe,Ve,$e){let[ct,vt,Pt,Ot]=Ve,Ft=ct+ct,Dt=vt+vt,wt=Pt+Pt,Nt=ct*Ft,Zt=ct*Dt,zt=ct*wt,hr=vt*Dt,ar=vt*wt,fr=Pt*wt,me=Ot*Ft,Ie=Ot*Dt,Pe=Ot*wt,[_e,Ze,ze]=$e;return N[0]=(1-(hr+fr))*_e,N[1]=(Zt+Pe)*_e,N[2]=(zt-Ie)*_e,N[3]=0,N[4]=(Zt-Pe)*Ze,N[5]=(1-(Nt+fr))*Ze,N[6]=(ar+me)*Ze,N[7]=0,N[8]=(zt+Ie)*ze,N[9]=(ar-me)*ze,N[10]=(1-(Nt+hr))*ze,N[11]=0,N[12]=oe[0],N[13]=oe[1],N[14]=oe[2],N[15]=1,N}ao.compose=te;let J=[0,0,0],ee=e();function ce(N,oe,Ve,$e){let ct=b.magnitude(b.set(J,N[0],N[1],N[2])),vt=b.magnitude(b.set(J,N[4],N[5],N[6])),Pt=b.magnitude(b.set(J,N[8],N[9],N[10]));V(N)<0&&(ct=-ct),oe[0]=N[12],oe[1]=N[13],oe[2]=N[14],f(ee,N);let Ft=1/ct,Dt=1/vt,wt=1/Pt;return ee[0]*=Ft,ee[1]*=Ft,ee[2]*=Ft,ee[4]*=Dt,ee[5]*=Dt,ee[6]*=Dt,ee[8]*=wt,ee[9]*=wt,ee[10]*=wt,S(Ve,ee),$e[0]=ct,$e[1]=vt,$e[2]=Pt,N}ao.decompose=ce;function fe(N){let oe=b(),Ve=lr(),$e=b();return ce(N,oe,Ve,$e),{position:oe,quaternion:Ve,scale:$e}}ao.getDecomposition=fe;function O(N){let oe="";for(let Ve=0;Ve<4;Ve++){for(let $e=0;$e<4;$e++)oe+=N[4*$e+Ve].toString(),$e<3&&(oe+=" ");Ve<3&&(oe+=`
`)}return oe}ao.makeTable=O;function V(N){let oe=N[0],Ve=N[1],$e=N[2],ct=N[3],vt=N[4],Pt=N[5],Ot=N[6],Ft=N[7],Dt=N[8],wt=N[9],Nt=N[10],Zt=N[11],zt=N[12],hr=N[13],ar=N[14],fr=N[15],me=oe*Pt-Ve*vt,Ie=oe*Ot-$e*vt,Pe=oe*Ft-ct*vt,_e=Ve*Ot-$e*Pt,Ze=Ve*Ft-ct*Pt,ze=$e*Ft-ct*Ot,Rt=Dt*hr-wt*zt,ir=Dt*ar-Nt*zt,Oe=Dt*fr-Zt*zt,ht=wt*ar-Nt*hr,Ye=wt*fr-Zt*hr,dr=Nt*fr-Zt*ar;return me*dr-Ie*Ye+Pe*ht+_e*Oe-Ze*ir+ze*Rt}ao.determinant=V;function Z(N,oe){return pe(N,typeof oe<"u"?oe:1e-6)}ao.isRotationAndTranslation=Z;function pe(N,oe){let Ve=N[0],$e=N[1],ct=N[2],vt=N[3],Pt=N[4],Ot=N[5],Ft=N[6],Dt=N[7],wt=N[8],Nt=N[9],Zt=N[10],zt=N[11],hr=N[15];if(!mo(hr,1,oe)||!mo(vt,0,oe)||!mo(Dt,0,oe)||!mo(zt,0,oe))return!1;let ar=Math.abs(Ve*(Ot*Zt-Ft*Nt)-$e*(Pt*Zt-Ft*wt)+ct*(Pt*Nt-Ot*wt));return!!mo(ar,1,oe)}function $(N,oe){return ae(N,typeof oe<"u"?oe:1e-6)}ao.isTranslationAndUniformScaling=$;function ae(N,oe){let Ve=N[0];return mo(N[1],0,oe)&&mo(N[2],0,oe)&&mo(N[3],0,oe)&&mo(N[4],0,oe)&&mo(N[5],Ve,oe)&&mo(N[6],0,oe)&&mo(N[7],0,oe)&&mo(N[8],0,oe)&&mo(N[9],0,oe)&&mo(N[10],Ve,oe)&&mo(N[11],0,oe)&&mo(N[15],1,oe)}function Se(N,oe){let Ve=oe[0],$e=oe[1],ct=oe[2],vt=oe[3],Pt=Ve+Ve,Ot=$e+$e,Ft=ct+ct,Dt=Ve*Pt,wt=$e*Pt,Nt=$e*Ot,Zt=ct*Pt,zt=ct*Ot,hr=ct*Ft,ar=vt*Pt,fr=vt*Ot,me=vt*Ft;return N[0]=1-Nt-hr,N[1]=wt+me,N[2]=Zt-fr,N[3]=0,N[4]=wt-me,N[5]=1-Dt-hr,N[6]=zt+ar,N[7]=0,N[8]=Zt+fr,N[9]=zt-ar,N[10]=1-Dt-Nt,N[11]=0,N[12]=0,N[13]=0,N[14]=0,N[15]=1,N}ao.fromQuat=Se;function ve(N,oe,Ve){let $e=oe[0],ct=oe[1],vt=oe[2],Pt=Math.cos($e),Ot=Math.sin($e),Ft=Math.cos(ct),Dt=Math.sin(ct),wt=Math.cos(vt),Nt=Math.sin(vt);if(Ve==="XYZ"){let Zt=Pt*wt,zt=Pt*Nt,hr=Ot*wt,ar=Ot*Nt;N[0]=Ft*wt,N[4]=-Ft*Nt,N[8]=Dt,N[1]=zt+hr*Dt,N[5]=Zt-ar*Dt,N[9]=-Ot*Ft,N[2]=ar-Zt*Dt,N[6]=hr+zt*Dt,N[10]=Pt*Ft}else if(Ve==="YXZ"){let Zt=Ft*wt,zt=Ft*Nt,hr=Dt*wt,ar=Dt*Nt;N[0]=Zt+ar*Ot,N[4]=hr*Ot-zt,N[8]=Pt*Dt,N[1]=Pt*Nt,N[5]=Pt*wt,N[9]=-Ot,N[2]=zt*Ot-hr,N[6]=ar+Zt*Ot,N[10]=Pt*Ft}else if(Ve==="ZXY"){let Zt=Ft*wt,zt=Ft*Nt,hr=Dt*wt,ar=Dt*Nt;N[0]=Zt-ar*Ot,N[4]=-Pt*Nt,N[8]=hr+zt*Ot,N[1]=zt+hr*Ot,N[5]=Pt*wt,N[9]=ar-Zt*Ot,N[2]=-Pt*Dt,N[6]=Ot,N[10]=Pt*Ft}else if(Ve==="ZYX"){let Zt=Pt*wt,zt=Pt*Nt,hr=Ot*wt,ar=Ot*Nt;N[0]=Ft*wt,N[4]=hr*Dt-zt,N[8]=Zt*Dt+ar,N[1]=Ft*Nt,N[5]=ar*Dt+Zt,N[9]=zt*Dt-hr,N[2]=-Dt,N[6]=Ot*Ft,N[10]=Pt*Ft}else if(Ve==="YZX"){let Zt=Pt*Ft,zt=Pt*Dt,hr=Ot*Ft,ar=Ot*Dt;N[0]=Ft*wt,N[4]=ar-Zt*Nt,N[8]=hr*Nt+zt,N[1]=Nt,N[5]=Pt*wt,N[9]=-Ot*wt,N[2]=-Dt*wt,N[6]=zt*Nt+hr,N[10]=Zt-ar*Nt}else if(Ve==="XZY"){let Zt=Pt*Ft,zt=Pt*Dt,hr=Ot*Ft,ar=Ot*Dt;N[0]=Ft*wt,N[4]=-Nt,N[8]=Dt*wt,N[1]=Zt*Nt+ar,N[5]=Pt*wt,N[9]=zt*Nt-hr,N[2]=hr*Nt-zt,N[6]=Ot*wt,N[10]=ar*Nt+Zt}return N[3]=0,N[7]=0,N[11]=0,N[12]=0,N[13]=0,N[14]=0,N[15]=1,N}ao.fromEuler=ve;function K(N,oe,Ve,$e,ct,vt,Pt){let Ot=2*vt/(Ve-oe),Ft=2*vt/($e-ct),Dt=(Ve+oe)/(Ve-oe),wt=($e+ct)/($e-ct),Nt=-(Pt+vt)/(Pt-vt),Zt=-2*Pt*vt/(Pt-vt);return N[0]=Ot,N[1]=0,N[2]=0,N[3]=0,N[4]=0,N[5]=Ft,N[6]=0,N[7]=0,N[8]=Dt,N[9]=wt,N[10]=Nt,N[11]=-1,N[12]=0,N[13]=0,N[14]=Zt,N[15]=0,N}ao.perspective=K;function re(N,oe,Ve,$e,ct,vt,Pt){let Ot=1/(Ve-oe),Ft=1/($e-ct),Dt=1/(Pt-vt),wt=(Ve+oe)*Ot,Nt=($e+ct)*Ft,Zt=(Pt+vt)*Dt;return N[0]=2*Ot,N[1]=0,N[2]=0,N[3]=0,N[4]=0,N[5]=2*Ft,N[6]=0,N[7]=0,N[8]=0,N[9]=0,N[10]=-2*Dt,N[11]=0,N[12]=-wt,N[13]=-Nt,N[14]=-Zt,N[15]=1,N}ao.ortho=re;function le(N,oe,Ve,$e){let ct,vt,Pt,Ot,Ft,Dt,wt,Nt,Zt,zt,hr=oe[0],ar=oe[1],fr=oe[2],me=$e[0],Ie=$e[1],Pe=$e[2],_e=Ve[0],Ze=Ve[1],ze=Ve[2];return Math.abs(hr-_e)<1e-6&&Math.abs(ar-Ze)<1e-6&&Math.abs(fr-ze)<1e-6?r(N):(wt=hr-_e,Nt=ar-Ze,Zt=fr-ze,zt=1/Math.sqrt(wt*wt+Nt*Nt+Zt*Zt),wt*=zt,Nt*=zt,Zt*=zt,ct=Ie*Zt-Pe*Nt,vt=Pe*wt-me*Zt,Pt=me*Nt-Ie*wt,zt=Math.sqrt(ct*ct+vt*vt+Pt*Pt),zt?(zt=1/zt,ct*=zt,vt*=zt,Pt*=zt):(ct=0,vt=0,Pt=0),Ot=Nt*Pt-Zt*vt,Ft=Zt*ct-wt*Pt,Dt=wt*vt-Nt*ct,zt=Math.sqrt(Ot*Ot+Ft*Ft+Dt*Dt),zt?(zt=1/zt,Ot*=zt,Ft*=zt,Dt*=zt):(Ot=0,Ft=0,Dt=0),N[0]=ct,N[1]=Ot,N[2]=wt,N[3]=0,N[4]=vt,N[5]=Ft,N[6]=Nt,N[7]=0,N[8]=Pt,N[9]=Dt,N[10]=Zt,N[11]=0,N[12]=-(ct*hr+vt*ar+Pt*fr),N[13]=-(Ot*hr+Ft*ar+Dt*fr),N[14]=-(wt*hr+Nt*ar+Zt*fr),N[15]=1,N)}ao.lookAt=le;function ge(N,oe,Ve,$e){let ct=oe[0],vt=oe[1],Pt=oe[2],Ot=$e[0],Ft=$e[1],Dt=$e[2],wt=ct-Ve[0],Nt=vt-Ve[1],Zt=Pt-Ve[2],zt=wt*wt+Nt*Nt+Zt*Zt;zt>0&&(zt=1/Math.sqrt(zt),wt*=zt,Nt*=zt,Zt*=zt);let hr=Ft*Zt-Dt*Nt,ar=Dt*wt-Ot*Zt,fr=Ot*Nt-Ft*wt;return zt=hr*hr+ar*ar+fr*fr,zt>0&&(zt=1/Math.sqrt(zt),hr*=zt,ar*=zt,fr*=zt),N[0]=hr,N[1]=ar,N[2]=fr,N[3]=0,N[4]=Nt*fr-Zt*ar,N[5]=Zt*hr-wt*fr,N[6]=wt*ar-Nt*hr,N[7]=0,N[8]=wt,N[9]=Nt,N[10]=Zt,N[11]=0,N[12]=ct,N[13]=vt,N[14]=Pt,N[15]=1,N}ao.targetTo=ge;function Ee(N,oe){o(N);for(let Ve=0;Ve<4;Ve++){let $e=oe[Ve];c(N,Ve,$e,1)}return N}ao.fromPermutation=Ee;function nt(N){let oe=N[0]*N[0]+N[1]*N[1]+N[2]*N[2],Ve=N[4]*N[4]+N[5]*N[5]+N[6]*N[6],$e=N[8]*N[8]+N[9]*N[9]+N[10]*N[10];return Math.sqrt(Math.max(oe,Ve,$e))}ao.getMaxScaleOnAxis=nt;function at(N){return{x:b.create(N[0],N[1],N[2]),y:b.create(N[4],N[5],N[6]),z:b.create(N[8],N[9],N[10])}}ao.extractBasis=at;let be=[1,0,0],Re=[0,1,0],Fe=[0,0,1];ao.rotX90=F(e(),kr(90),be),ao.rotX180=F(e(),kr(180),be),ao.rotY90=F(e(),kr(90),Re),ao.rotY180=F(e(),kr(180),Re),ao.rotY270=F(e(),kr(270),Re),ao.rotZ90=F(e(),kr(90),Fe),ao.rotZ180=F(e(),kr(180),Fe),ao.rotXY90=T(e(),ao.rotX90,ao.rotY90),ao.rotZY90=T(e(),ao.rotZ90,ao.rotY90),ao.rotZYZ90=T(e(),ao.rotZY90,ao.rotZ90),ao.rotZ90X180=T(e(),ao.rotZ90,ao.rotX180),ao.rotY90Z180=T(e(),ao.rotY90,ao.rotZ180),ao.id=t()})(H||={});var b9=isFinite;function b(){return b.zero()}(fr=>{function e(){let me=[.1,0,0];return me[0]=0,me}fr.zero=e;function t(me){let Ie=e();return Ie[0]=me[0],Ie[1]=me[1],Ie[2]=me[2],Ie}fr.clone=t;function r(me){return b9(me[0])&&b9(me[1])&&b9(me[2])}fr.isFinite=r;function n(me){return Number.isInteger(me[0])&&Number.isInteger(me[1])&&Number.isInteger(me[2])}fr.isInteger=n;function o(me){return Number.isNaN(me[0])||Number.isNaN(me[1])||Number.isNaN(me[2])}fr.hasNaN=o;function i(me){return me[0]=NaN,me[1]=NaN,me[2]=NaN,me}fr.setNaN=i;function a(me){return c(me.x,me.y,me.z)}fr.fromObj=a;function s(me){return{x:me[0],y:me[1],z:me[2]}}fr.toObj=s;function l(me,Ie,Pe){return me[0]=Ie[Pe+0],me[1]=Ie[Pe+1],me[2]=Ie[Pe+2],me}fr.fromArray=l;function u(me,Ie,Pe){return Ie[Pe+0]=me[0],Ie[Pe+1]=me[1],Ie[Pe+2]=me[2],Ie}fr.toArray=u;function c(me,Ie,Pe){let _e=e();return _e[0]=me,_e[1]=Ie,_e[2]=Pe,_e}fr.create=c;function m(me){let Ie=e();return Ie[0]=me[0],Ie[1]=me[1],Ie[2]=me[2],Ie}fr.ofArray=m;function d(me,Ie,Pe,_e){return me[0]=Ie,me[1]=Pe,me[2]=_e,me}fr.set=d;function p(me,Ie){return me[0]=Ie[0],me[1]=Ie[1],me[2]=Ie[2],me}fr.copy=p;function h(me,Ie,Pe){return me[0]=Ie[0]+Pe[0],me[1]=Ie[1]+Pe[1],me[2]=Ie[2]+Pe[2],me}fr.add=h;function f(me,Ie,Pe){return me[0]=Ie[0]-Pe[0],me[1]=Ie[1]-Pe[1],me[2]=Ie[2]-Pe[2],me}fr.sub=f;function g(me,Ie,Pe){return me[0]=Ie[0]*Pe[0],me[1]=Ie[1]*Pe[1],me[2]=Ie[2]*Pe[2],me}fr.mul=g;function y(me,Ie,Pe){return me[0]=Ie[0]/Pe[0],me[1]=Ie[1]/Pe[1],me[2]=Ie[2]/Pe[2],me}fr.div=y;function x(me,Ie,Pe){return me[0]=Ie[0]*Pe,me[1]=Ie[1]*Pe,me[2]=Ie[2]*Pe,me}fr.scale=x;function S(me,Ie,Pe,_e){return me[0]=Ie[0]+Pe[0]*_e,me[1]=Ie[1]+Pe[1]*_e,me[2]=Ie[2]+Pe[2]*_e,me}fr.scaleAndAdd=S;function I(me,Ie,Pe,_e){return me[0]=Ie[0]-Pe[0]*_e,me[1]=Ie[1]-Pe[1]*_e,me[2]=Ie[2]-Pe[2]*_e,me}fr.scaleAndSub=I;function v(me,Ie,Pe){return me[0]=Ie[0]+Pe,me[1]=Ie[1]+Pe,me[2]=Ie[2]+Pe,me}fr.addScalar=v;function A(me,Ie,Pe){return me[0]=Ie[0]-Pe,me[1]=Ie[1]-Pe,me[2]=Ie[2]-Pe,me}fr.subScalar=A;function P(me,Ie){return me[0]=Math.round(Ie[0]),me[1]=Math.round(Ie[1]),me[2]=Math.round(Ie[2]),me}fr.round=P;function T(me,Ie){return me[0]=Math.ceil(Ie[0]),me[1]=Math.ceil(Ie[1]),me[2]=Math.ceil(Ie[2]),me}fr.ceil=T;function R(me,Ie){return me[0]=Math.floor(Ie[0]),me[1]=Math.floor(Ie[1]),me[2]=Math.floor(Ie[2]),me}fr.floor=R;function w(me,Ie){return me[0]=Math.trunc(Ie[0]),me[1]=Math.trunc(Ie[1]),me[2]=Math.trunc(Ie[2]),me}fr.trunc=w;function E(me,Ie){return me[0]=Math.abs(Ie[0]),me[1]=Math.abs(Ie[1]),me[2]=Math.abs(Ie[2]),me}fr.abs=E;function M(me,Ie,Pe){return me[0]=Math.min(Ie[0],Pe[0]),me[1]=Math.min(Ie[1],Pe[1]),me[2]=Math.min(Ie[2],Pe[2]),me}fr.min=M;function D(me,Ie,Pe){return me[0]=Math.max(Ie[0],Pe[0]),me[1]=Math.max(Ie[1],Pe[1]),me[2]=Math.max(Ie[2],Pe[2]),me}fr.max=D;function B(me,Ie,Pe,_e){return me[0]=Math.max(Pe[0],Math.min(_e[0],Ie[0])),me[1]=Math.max(Pe[1],Math.min(_e[1],Ie[1])),me[2]=Math.max(Pe[2],Math.min(_e[2],Ie[2])),me}fr.clamp=B;function k(me,Ie){let Pe=Ie[0]-me[0],_e=Ie[1]-me[1],Ze=Ie[2]-me[2];return Math.sqrt(Pe*Pe+_e*_e+Ze*Ze)}fr.distance=k;function F(me,Ie){let Pe=Ie[0]-me[0],_e=Ie[1]-me[1],Ze=Ie[2]-me[2];return Pe*Pe+_e*_e+Ze*Ze}fr.squaredDistance=F;function z(me){let Ie=me[0],Pe=me[1],_e=me[2];return Math.sqrt(Ie*Ie+Pe*Pe+_e*_e)}fr.magnitude=z;function j(me){let Ie=me[0],Pe=me[1],_e=me[2];return Ie*Ie+Pe*Pe+_e*_e}fr.squaredMagnitude=j;function Y(me,Ie,Pe){return x(me,U(me,Ie),Pe)}fr.setMagnitude=Y;function G(me,Ie){return me[0]=-Ie[0],me[1]=-Ie[1],me[2]=-Ie[2],me}fr.negate=G;function X(me,Ie){return me[0]=1/Ie[0],me[1]=1/Ie[1],me[2]=1/Ie[2],me}fr.inverse=X;function U(me,Ie){let Pe=Ie[0],_e=Ie[1],Ze=Ie[2],ze=Pe*Pe+_e*_e+Ze*Ze;return ze>0&&(ze=1/Math.sqrt(ze),me[0]=Ie[0]*ze,me[1]=Ie[1]*ze,me[2]=Ie[2]*ze),me}fr.normalize=U;function L(me,Ie){return me[0]*Ie[0]+me[1]*Ie[1]+me[2]*Ie[2]}fr.dot=L;function q(me,Ie,Pe){let _e=Ie[0],Ze=Ie[1],ze=Ie[2],Rt=Pe[0],ir=Pe[1],Oe=Pe[2];return me[0]=Ze*Oe-ze*ir,me[1]=ze*Rt-_e*Oe,me[2]=_e*ir-Ze*Rt,me}fr.cross=q;function te(me,Ie,Pe,_e){let Ze=Ie[0],ze=Ie[1],Rt=Ie[2];return me[0]=Ze+_e*(Pe[0]-Ze),me[1]=ze+_e*(Pe[1]-ze),me[2]=Rt+_e*(Pe[2]-Rt),me}fr.lerp=te;let J=e();function ee(me,Ie,Pe,_e){let Ze=_r(L(Ie,Pe),-1,1),ze=Math.acos(Ze)*_e;return S(J,Pe,Ie,-Ze),U(J,J),h(me,x(me,Ie,Math.cos(ze)),x(J,J,Math.sin(ze)))}fr.slerp=ee;function ce(me,Ie,Pe,_e,Ze,ze){let Rt=ze*ze,ir=Rt*(2*ze-3)+1,Oe=Rt*(ze-2)+ze,ht=Rt*(ze-1),Ye=Rt*(3-2*ze);return me[0]=Ie[0]*ir+Pe[0]*Oe+_e[0]*ht+Ze[0]*Ye,me[1]=Ie[1]*ir+Pe[1]*Oe+_e[1]*ht+Ze[1]*Ye,me[2]=Ie[2]*ir+Pe[2]*Oe+_e[2]*ht+Ze[2]*Ye,me}fr.hermite=ce;function fe(me,Ie,Pe,_e,Ze,ze){let Rt=1-ze,ir=Rt*Rt,Oe=ze*ze,ht=ir*Rt,Ye=3*ze*ir,dr=3*Oe*Rt,Xr=Oe*ze;return me[0]=Ie[0]*ht+Pe[0]*Ye+_e[0]*dr+Ze[0]*Xr,me[1]=Ie[1]*ht+Pe[1]*Ye+_e[1]*dr+Ze[1]*Xr,me[2]=Ie[2]*ht+Pe[2]*Ye+_e[2]*dr+Ze[2]*Xr,me}fr.bezier=fe;function O(me,Ie,Pe,_e,Ze){return me[0]=lM(Ie[0],Pe[0],_e[0],Ze),me[1]=lM(Ie[1],Pe[1],_e[1],Ze),me[2]=lM(Ie[2],Pe[2],_e[2],Ze),me}fr.quadraticBezier=O;function V(me,Ie,Pe,_e,Ze,ze,Rt){return me[0]=kv(Ie[0],Pe[0],_e[0],Ze[0],ze,Rt),me[1]=kv(Ie[1],Pe[1],_e[1],Ze[1],ze,Rt),me[2]=kv(Ie[2],Pe[2],_e[2],Ze[2],ze,Rt),me}fr.spline=V;function Z(me,Ie){let Pe=Math.random()*2*Math.PI,_e=Math.random()*2-1,Ze=Math.sqrt(1-_e*_e)*Ie;return me[0]=Math.cos(Pe)*Ze,me[1]=Math.sin(Pe)*Ze,me[2]=_e*Ie,me}fr.random=Z;function pe(me,Ie,Pe){let _e=Ie[0],Ze=Ie[1],ze=Ie[2],Rt=1/(Pe[3]*_e+Pe[7]*Ze+Pe[11]*ze+Pe[15]||1);return me[0]=(Pe[0]*_e+Pe[4]*Ze+Pe[8]*ze+Pe[12])*Rt,me[1]=(Pe[1]*_e+Pe[5]*Ze+Pe[9]*ze+Pe[13])*Rt,me[2]=(Pe[2]*_e+Pe[6]*Ze+Pe[10]*ze+Pe[14])*Rt,me}fr.transformMat4=pe;function $(me,Ie,Pe){let _e=Ie[0],Ze=Ie[1],ze=Ie[2];return me[0]=Pe[0]*_e+Pe[4]*Ze+Pe[8]*ze,me[1]=Pe[1]*_e+Pe[5]*Ze+Pe[9]*ze,me[2]=Pe[2]*_e+Pe[6]*Ze+Pe[10]*ze,U(me,me)}fr.transformDirection=$;function ae(me,Ie,Pe,_e,Ze,ze){let Rt=Ie[0+Ze],ir=Ie[1+Ze],Oe=Ie[2+Ze],ht=1/(Pe[3+ze]*Rt+Pe[7+ze]*ir+Pe[11+ze]*Oe+Pe[15+ze]||1);return me[0+_e]=(Pe[0+ze]*Rt+Pe[4+ze]*ir+Pe[8+ze]*Oe+Pe[12+ze])*ht,me[1+_e]=(Pe[1+ze]*Rt+Pe[5+ze]*ir+Pe[9+ze]*Oe+Pe[13+ze])*ht,me[2+_e]=(Pe[2+ze]*Rt+Pe[6+ze]*ir+Pe[10+ze]*Oe+Pe[14+ze])*ht,me}fr.transformMat4Offset=ae;function Se(me,Ie,Pe,_e,Ze,ze){let Rt=Ie[0+Ze],ir=Ie[1+Ze],Oe=Ie[2+Ze];me[0+_e]=Pe[0+ze]*Rt+Pe[4+ze]*ir+Pe[8+ze]*Oe,me[1+_e]=Pe[1+ze]*Rt+Pe[5+ze]*ir+Pe[9+ze]*Oe,me[2+_e]=Pe[2+ze]*Rt+Pe[6+ze]*ir+Pe[10+ze]*Oe;let ht=Math.hypot(me[0+_e],me[1+_e],me[2+_e]);return ht>0&&(me[0+_e]/=ht,me[1+_e]/=ht,me[2+_e]/=ht),me}fr.transformDirectionOffset=Se;function ve(me,Ie,Pe){let _e=Ie[0],Ze=Ie[1],ze=Ie[2];return me[0]=_e*Pe[0]+Ze*Pe[3]+ze*Pe[6],me[1]=_e*Pe[1]+Ze*Pe[4]+ze*Pe[7],me[2]=_e*Pe[2]+Ze*Pe[5]+ze*Pe[8],me}fr.transformMat3=ve;function K(me,Ie,Pe){let _e=Ie[0],Ze=Ie[1],ze=Ie[2],Rt=Pe[0],ir=Pe[1],Oe=Pe[2],ht=Pe[3],Ye=ht*_e+ir*ze-Oe*Ze,dr=ht*Ze+Oe*_e-Rt*ze,Xr=ht*ze+Rt*Ze-ir*_e,we=-Rt*_e-ir*Ze-Oe*ze;return me[0]=Ye*ht+we*-Rt+dr*-Oe-Xr*-ir,me[1]=dr*ht+we*-ir+Xr*-Rt-Ye*-Oe,me[2]=Xr*ht+we*-Oe+Ye*-ir-dr*-Rt,me}fr.transformQuat=K;function re(me,Ie){let Pe=Math.sqrt(j(me)*j(Ie));if(Pe===0)return Math.PI/2;let _e=L(me,Ie)/Pe;return Math.acos(_r(_e,-1,1))}fr.angle=re;let le=e(),ge=e(),Ee=e(),nt=e(),at=e(),be=e(),Re=e();function Fe(me,Ie,Pe,_e){f(le,me,Ie),f(ge,Pe,Ie),f(Ee,Ie,Pe),f(nt,_e,Pe),q(at,le,ge),q(be,Ee,nt);let Ze=re(at,be);return q(Re,at,be),L(ge,Re)>0?Ze:-Ze}fr.dihedralAngle=Fe;function Ne(me,Ie,Pe,_e){return fr.set(me,_e*Math.cos(Pe)*Math.sin(Ie),_e*Math.sin(Pe)*Math.sin(Ie),_e*Math.cos(Ie))}fr.directionFromSpherical=Ne;function ot(me,Ie){return me[0]===Ie[0]&&me[1]===Ie[1]&&me[2]===Ie[2]}fr.exactEquals=ot;function it(me,Ie){let Pe=me[0],_e=me[1],Ze=me[2],ze=Ie[0],Rt=Ie[1],ir=Ie[2];return Math.abs(Pe-ze)<=1e-6*Math.max(1,Math.abs(Pe),Math.abs(ze))&&Math.abs(_e-Rt)<=1e-6*Math.max(1,Math.abs(_e),Math.abs(Rt))&&Math.abs(Ze-ir)<=1e-6*Math.max(1,Math.abs(Ze),Math.abs(ir))}fr.equals=it;let Xt=e();function $r(me,Ie,Pe){let _e=re(Ie,Pe);if(Math.abs(_e)<1e-4)return H.setIdentity(me);if(Math.abs(_e-Math.PI)<1e-6)return H.fromRotation(me,Math.PI,Math.abs(Ie[0])<.9?fr.unitX:fr.unitZ);let Ze=q(Xt,Ie,Pe);return H.fromRotation(me,_e,Ze)}fr.makeRotation=$r;function bt(me){return me[0]===0&&me[1]===0&&me[2]===0}fr.isZero=bt;function xr(me,Ie,Pe,_e){f(me,Ie,_e);let Ze=L(Pe,me)/j(Pe);return h(me,x(me,Pe,Ze),_e)}fr.projectPointOnVector=xr;let tn=e();function pn(me,Ie,Pe,_e){return U(tn,Pe),f(me,Ie,_e),f(me,Ie,x(tn,tn,L(me,tn)))}fr.projectPointOnPlane=pn;function io(me,Ie,Pe){let _e=L(Pe,Ie)/j(Pe);return x(me,Pe,_e)}fr.projectOnVector=io;let Hn=e();function Zi(me,Ie,Pe){return io(Hn,Ie,Pe),f(me,Ie,Hn)}fr.projectOnPlane=Zi;function mm(me,Ie,Pe){return U(me,q(me,q(me,Ie,Pe),Ie)),!fr.isZero(me)||(me[0]=1,me[1]=0,me[2]=0,U(me,q(me,q(me,Ie,me),Ie)),!fr.isZero(me))||(me[0]=0,me[1]=1,me[2]=0,U(me,q(me,q(me,Ie,me),Ie)),!fr.isZero(me))||(U(me,Pe),!fr.isZero(me))||(me[0]=1,me[1]=0,me[2]=0),me}fr.orthogonalize=mm;function ao(me,Ie,Pe){return L(Ie,Pe)>0?p(me,Ie):G(me,p(me,Ie)),me}fr.matchDirection=ao;function N(me,Ie){if(bt(Ie))return p(me,fr.unitX);{let Pe=e();return Math.abs(Ie[0])<Math.abs(Ie[1])&&Math.abs(Ie[0])<Math.abs(Ie[2])?(Pe[0]=0,Pe[1]=Ie[2],Pe[2]=-Ie[1]):Math.abs(Ie[1])<Math.abs(Ie[2])?(Pe[0]=-Ie[2],Pe[1]=0,Pe[2]=Ie[0]):(Pe[0]=Ie[1],Pe[1]=-Ie[0],Pe[2]=0),U(me,Pe)}}fr.orthogonalDirection=N;let oe=e(),Ve=e();function $e(me,Ie,Pe,_e){return f(oe,Pe,Ie),f(Ve,_e,Ie),U(me,q(me,oe,Ve))}fr.triangleNormal=$e;let ct=e();function vt(me,Ie,Pe){return fr.scaleAndAdd(me,Ie,fr.sub(ct,Pe,Ie),.5)}fr.center=vt;function Pt(me,Ie){return`[${me[0].toPrecision(Ie)} ${me[1].toPrecision(Ie)} ${me[2].toPrecision(Ie)}]`}fr.toString=Pt,fr.origin=c(0,0,0),fr.unit=c(1,1,1),fr.negUnit=c(-1,-1,-1),fr.unitX=c(1,0,0),fr.unitY=c(0,1,0),fr.unitZ=c(0,0,1),fr.negUnitX=c(-1,0,0),fr.negUnitY=c(0,-1,0),fr.negUnitZ=c(0,0,-1)})(b||={});var Tm={is(e){return typeof e.charCodeAt=="function"},toString(e){try{return e.toString()}catch(t){throw new Error(`Failed to convert StringLike object into string. This might be because the length ${e.length} exceeds maximum allowed string length ${xS}. (${t})`)}}},xS=536870888,EB=28,kB=class e{constructor(t=EB){this._chunks=[];this._length=0;this._tmpArray=[];this.STRING_CHUNK_SIZE=2**t,this.STRING_CHUNK_SHIFT=t,this.STRING_CHUNK_MASK=2**t-1}get length(){return this._length}static fromString(t,r=EB){let n=new e(r);return n._append(t),n}static fromStrings(t,r=EB){let n=new e(r);for(let o of t)n._append(o);return n}static fromUtf8Data(t,r=0,n=t.length,o=EB){let i=2**o,a=[],s=r;for(;s<n;){let l=Math.min(s+i,n);if(l<n){for(;(t[l]&192)===128;)if(l--,l===s)throw new Error("Input is rubbish, no UTF-8 character start found in a chunk")}let u=Yh(t,s,l-s);a.push(u),s=l}return e.fromStrings(a,o)}_append(t){let r=this.STRING_CHUNK_SIZE,n=this._chunks.length===0||this._chunks[this._chunks.length-1].length===r?"":this._chunks.pop(),o=r-n.length;for(this._chunks.push(n+t.substring(0,o));o<t.length;)this._chunks.push(t.substring(o,o+r)),o+=r;this._length+=t.length}_getChunkIndex(t){return t>>>this.STRING_CHUNK_SHIFT}_getIndexInChunk(t){return t&this.STRING_CHUNK_MASK}_isOutOfRange(t){return t<0||t>=this.length}at(t){return-this.length<=t&&t<0?this.at(t+this.length):this.charAt(t)||void 0}charAt(t){if(this._isOutOfRange(t))return"";let r=this._getChunkIndex(t),n=this._getIndexInChunk(t);return this._chunks[r][n]}charCodeAt(t){if(this._isOutOfRange(t))return NaN;let r=this._getChunkIndex(t),n=this._getIndexInChunk(t);return this._chunks[r].charCodeAt(n)}substring(t,r){let n=Math.min(Math.max(t??0,0),this.length),o=Math.min(Math.max(r??this.length,0),this.length);if(n>o)return this.substring(o,n);if(n===o)return"";if(o-n>xS)throw new Error(`Trying to create get a substring longer (${o-n}) than maximum allowed string length (${xS}).`);let i=this._getChunkIndex(n),a=this._getIndexInChunk(n),s=this._getChunkIndex(o),l=this._getIndexInChunk(o);if(i===s)return this._chunks[i].substring(a,l);{let u=this._getTmpArray();u.push(this._chunks[i].substring(a,this.STRING_CHUNK_SIZE));for(let c=i+1;c<s;c++)u.push(this._chunks[c]);return u.push(this._chunks[s].substring(0,l)),u.join("")}}_getTmpArray(){for(;this._tmpArray.length;)this._tmpArray.pop();return this._tmpArray}indexOf(t,r=0){if(t.length>this.STRING_CHUNK_SIZE)throw new Error("NotImplementedError: indexOf is only implemented for searchString shorter than STRING_CHUNK_SIZE");r<0&&(r=0);let n=this._getChunkIndex(r);for(let o=n;o<this._chunks.length;o++){let i=this._chunks[o],a=o===n?this._getIndexInChunk(r):0,s=i.indexOf(t,a);if(s>=0)return o*this.STRING_CHUNK_SIZE+s;if(o!==this._chunks.length-1){let l=Math.max(this.STRING_CHUNK_SIZE-t.length+1,a),c=(i.substring(l,void 0)+this._chunks[o+1].substring(0,t.length-1)).indexOf(t);if(c>=0)return o*this.STRING_CHUNK_SIZE+l+c}}return-1}includes(t,r=0){return this.indexOf(t,r)>=0}startsWith(t,r=0){if(t.length>this.STRING_CHUNK_SIZE)throw new Error("NotImplementedError: startsWith is only implemented for searchString shorter than STRING_CHUNK_SIZE");return this.substring(r,r+t.length)===t}toString(){try{return this._chunks.join("")}catch(t){throw new Error(`Failed to convert StringLike object into string. This might be because the length ${this.length} exceeds maximum allowed string length ${xS}. (${t})`)}}};function Wx(e,t,r){for(let n=0,o=r.length;n<o;n++){let i=r.charCodeAt(n);if(i<128){e[t++]=i>>>0&127|0;continue}if(i<2048){e[t++]=i>>>6&31|192,e[t++]=i>>>0&63|128;continue}if(i<65536){e[t++]=i>>>12&15|224,e[t++]=i>>>6&63|128,e[t++]=i>>>0&63|128;continue}if(i<1114112){e[t++]=i>>>18&7|240,e[t++]=i>>>12&63|128,e[t++]=i>>>6&63|128,e[t++]=i>>>0&63|128;continue}throw new Error("bad codepoint "+i)}}var f5e=(function(){let e=[];for(let t=0;t<1024;t++)e[t]=String.fromCharCode(t);return e})();function cle(e){throw new Error(e)}function h5e(e,t,r){let n=f5e,o,i=0,a=[],s=512;for(let l=t,u=t+r;l<u;l++){let c=e[l];(c&128)===0?a[i++]=n[c]:(c&224)===192?a[i++]=n[(c&15)<<6|e[++l]&63]:(c&240)===224?a[i++]=String.fromCharCode((c&15)<<12|(e[++l]&63)<<6|(e[++l]&63)<<0):(c&248)===240?a[i++]=String.fromCharCode((c&7)<<18|(e[++l]&63)<<12|(e[++l]&63)<<6|(e[++l]&63)<<0):cle("Invalid byte "+c.toString(16)),i===s&&(o=o||[],o[o.length]=a.join(""),i=0)}return o?(i>0&&(o[o.length]=a.slice(0,i).join("")),o.join("")):a.slice(0,i).join("")}var ule=typeof TextDecoder<"u"?new TextDecoder:void 0;function Yh(e,t=0,r=e.length){if(ule){let n=t||r!==e.length?e.subarray(t,t+r):e;return ule.decode(n)}else return h5e(e,t,r)}function FB(e,t=0,r=e.length){if(r<=xS)return Yh(e,t,r);let n=kB.fromUtf8Data(e,t,t+r);return n.length<=xS?n.toString():n}function pI(e){let t=0;for(let r=0,n=e.length;r<n;r++){let o=e.charCodeAt(r);if(o<128){t+=1;continue}if(o<2048){t+=2;continue}if(o<65536){t+=3;continue}if(o<1114112){t+=4;continue}cle("bad codepoint "+o)}return t}function g5e(){let e=(function(){let f=typeof window<"u"&&window,g=typeof self<"u"&&typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&self;return f||typeof global<"u"&&global||g})(),t={},r=typeof document<"u"?document:void 0,n=1,o;function i(f,...g){typeof f!="function"&&(f=new Function(""+f));let y={callback:f,args:g};return t[n]=y,o(n),n++}function a(f){delete t[f]}function s(f){let g=f.callback,y=f.args;switch(y.length){case 0:g();break;case 1:g(y[0]);break;case 2:g(y[0],y[1]);break;case 3:g(y[0],y[1],y[2]);break;default:g.apply(void 0,y);break}}function l(f){let g=t[f];a(f),s(g)}function u(){o=function(f){process.nextTick(function(){l(f)})}}function c(){if(e&&e.postMessage&&!e.importScripts){let f=!0,g=e.onmessage;return e.onmessage=function(){f=!1},e.postMessage("","*"),e.onmessage=g,f}}function m(){let f="setImmediate$"+Math.random()+"$",g=function(y){y.source===e&&typeof y.data=="string"&&y.data.indexOf(f)===0&&l(+y.data.slice(f.length))};window.addEventListener?window.addEventListener("message",g,!1):window.attachEvent("onmessage",g),o=function(y){window.postMessage(f+y,"*")}}function d(){let f=new MessageChannel;f.port1.onmessage=function(g){let y=g.data;l(y)},o=function(g){f.port2.postMessage(g)}}function p(){let f=r.documentElement;o=function(g){let y=r.createElement("script");y.onreadystatechange=function(){l(g),y.onreadystatechange=null,f.removeChild(y),y=null},f.appendChild(y)}}function h(){o=function(f){setTimeout(l,0,f)}}return typeof process<"u"&&{}.toString.call(process)==="[object process]"?u():c()?m():typeof MessageChannel<"u"?d():r&&"onreadystatechange"in r.createElement("script")?p():h(),{setImmediate:i,clearImmediate:a}}var x9=(function(){return typeof setImmediate<"u"?typeof window<"u"?{setImmediate:(e,...t)=>window.setImmediate(e,...t),clearImmediate:e=>window.clearImmediate(e)}:{setImmediate,clearImmediate}:g5e()})();function y5e(e){x9.setImmediate(e)}var Vf={setImmediate:x9.setImmediate,clearImmediate:x9.clearImmediate,immediatePromise(){return new Promise(y5e)},delay(e,t=void 0){return new Promise(r=>setTimeout(r,e,t))}};var Xx=(function(){try{return!0}catch{return!1}})(),Yt=(function(){try{return!1}catch{return!1}})(),je=!1;var LB=[];function mle(e){LB.includes(e)||LB.push(e)}function dle(e){let t=LB.indexOf(e);t!==-1&&LB.splice(t,1)}var b5e=typeof performance<"u"&&!!performance.mark&&performance.measure,C9=b5e&&je,A_;(i=>{function e(a){return`startTask${a.id}`}function t(a){return`endTask${a.id}`}function r(a){C9&&performance.mark(e(a))}i.markStart=r;function n(a){C9&&performance.mark(t(a))}i.markEnd=n;function o(a){C9&&performance.measure(`\u2733\uFE0F ${a.name}`,e(a),t(a))}i.measure=o})(A_||={});function ple(e,t,r=250){let n=yle(e,t,r),o=new VB(n,n.root);return S9(e,o)}function fle(e,t,r=250){let n=yle(e,t,r);return new VB(n,n.root)}function OB(e,t){return S9(t,e)}function hle(e,t,r){return e.runChild(t,r)}function gle(e){return{taskId:e.id,taskName:e.name,message:"",startedTime:0,canAbort:!0,isIndeterminate:!0,current:0,max:0}}function yle(e,t,r){let n={abortRequested:!1,treeAborted:!1,reason:""};return{updateRateMs:r,lastNotified:En(),observer:t,abortToken:n,taskId:e.id,root:{progress:gle(e),children:[]},tryAbort:x5e(n)}}function x5e(e){return t=>{e.abortRequested=!0,e.reason=t||e.reason}}function ble(e){return{progress:{...e.progress},children:e.children.map(ble)}}function xle(e){return e.progress.canAbort&&e.children.every(xle)}function C5e(e){return{root:ble(e.root),canAbort:xle(e.root),requestAbort:e.tryAbort}}async function S9(e,t){A_.markStart(e),t.node.progress.startedTime=En();try{let r=await e.f(t);return A_.markEnd(e),A_.measure(e),t.info.abortToken.abortRequested&&Cle(t.info),r}catch(r){throw Ae.isAbort(r)&&(t.isAborted=!0,t.node.children.length>0&&await new Promise(n=>{t.onChildrenFinished=n}),e.onAbort&&e.onAbort()),r}}function Cle(e){throw e.abortToken.treeAborted||(e.abortToken.treeAborted=!0,Sle(e.root),vle(e,En())),Ae.Aborted(e.abortToken.reason)}function Sle(e){let t=e.progress;t.isIndeterminate=!0,t.canAbort=!1,t.message="Aborting...";for(let r of e.children)Sle(r)}function vle(e,t){e.lastNotified=t;let r=C5e(e);e.observer(r)}var VB=class e{constructor(t,r){this.isSynchronous=!1;this.isExecuting=!0;this.lastUpdatedTime=0;this.onChildrenFinished=void 0;this.node=r,this.info=t}checkAborted(){this.info.abortToken.abortRequested&&(this.isAborted=!0,Cle(this.info))}get shouldUpdate(){return this.checkAborted(),En()-this.lastUpdatedTime>this.info.updateRateMs}updateProgress(t){if(this.checkAborted(),!t)return;let r=this.node.progress;typeof t=="string"?(r.message=t,r.isIndeterminate=!0):(typeof t.canAbort<"u"&&(r.canAbort=t.canAbort),typeof t.message<"u"&&(r.message=t.message),typeof t.current<"u"&&(r.current=t.current),typeof t.max<"u"&&(r.max=t.max),r.isIndeterminate=typeof r.current>"u"||typeof r.max>"u",typeof t.isIndeterminate<"u"&&(r.isIndeterminate=t.isIndeterminate))}update(t,r){if(this.lastUpdatedTime=En(),this.updateProgress(t),!r)return vle(this.info,this.lastUpdatedTime),this.checkAborted(),Vf.immediatePromise()}async runChild(t,r){this.updateProgress(r);let n={progress:gle(t),children:[]},o=this.node.children;o.push(n);let i=new e(this.info,n);try{return await S9(t,i)}catch(a){if(Ae.isAbort(a)&&this.isAborted)return;throw a}finally{let a=o.indexOf(n);if(a>=0){for(let s=a,l=o.length-1;s<l;s++)o[s]=o[s+1];o.pop()}o.length===0&&this.onChildrenFinished&&this.onChildrenFinished()}}};var v9=class{constructor(){this.shouldUpdate=!1;this.isSynchronous=!0}update(t,r){}},fI=new v9;var Ae;(c=>{class e{constructor(d,p,h){this.name=d;this.f=p;this.onAbort=h;this.id=u()}run(d,p=250){return d?ple(this,d,p):this.f(fI)}runAsChild(d,p){return d.isSynchronous?this.f(fI):hle(d,this,p)}runInContext(d){return d.isSynchronous?this.f(fI):OB(d,this)}}function t(m){let d=m;return!!m&&typeof d.id=="number"&&typeof d.name=="string"&&!!d.run}c.is=t;function r(m){return!!m&&!!m.isAborted}c.isAbort=r;function n(m){return{isAborted:!0,reason:m,toString(){return`Aborted${m?": "+m:""}`}}}c.Aborted=n;function o(m,d,p){return new e(m,d,p)}c.create=o;function i(m,d){return o(m,async p=>d)}c.constant=i;function a(){return o("",async m=>{})}c.empty=a;function s(m,d){return o(m,async p=>{throw new Error(d)})}c.fail=s;function l(m,d){return t(m)?d?m.runInContext(d):m.run():m}c.resolveInContext=l;let u=gi(0,1073741823)})(Ae||={});var Ile;(t=>t.Synchronous=fI)(Ile||={});var Ale;(r=>{function e(n,o=""){let i=n.progress;if(!n.children.length)return i.isIndeterminate?`${o}${i.taskName}: ${i.message}`:`${o}${i.taskName}: [${i.current}/${i.max}] ${i.message}`;let a=o+"  |_ ",s=n.children.map(l=>e(l,a));return i.isIndeterminate?`${o}${i.taskName}: ${i.message}
${s.join(`
`)}`:`${o}${i.taskName}: [${i.current}/${i.max}] ${i.message}
${s.join(`
`)}`}function t(n){return e(n.root)}r.format=t})(Ale||={});async function ys(e,t,r,n,o){let i=Math.max(t,0),a=0,s=0;if(e.isSynchronous)return n(Number.MAX_SAFE_INTEGER,r),r;let l=En(),u=0,c=0;for(;(u=n(i,r))>0;){a+=u;let m=En()-l;c+=m,s+=m,e.shouldUpdate&&(await o(e,r,a),i=Math.round(c*a/s)+1,l=En(),c=0)}return e.shouldUpdate&&await o(e,r,a),r}var Of=typeof process<"u"&&process.versions!=null&&process.versions.node!=null,I9=S5e();function S5e(){if(typeof File>"u"||Of){class e{arrayBuffer(){return this.blob.arrayBuffer()}slice(r,n,o){return this.blob.slice(r,n,o)}stream(){return this.blob.stream()}text(){return this.blob.text()}bytes(){return this.blob.bytes()}constructor(r,n,o){this.blob=new Blob(r,o),this.size=this.blob.size,this.type=this.blob.type,this.name=n,this.lastModified=o?.lastModified??0,this.webkitRelativePath=""}}return e}else return File}function Tle(e){return e>>0}function Kh(e,t){return e[t]|e[t+1]<<8}function Qx(e,t,r){e[t]=r&255,e[t+1]=r>>8&255}function Zx(e,t){return e[t+3]*(256*256*256)+(e[t+2]<<16|e[t+1]<<8|e[t])}function Jh(e,t,r){e[t]=r&255,e[t+1]=r>>8&255,e[t+2]=r>>16&255,e[t+3]=r>>24&255}function v5e(e,t,r){let n="";for(let o=0;o<r;o++)n+=String.fromCharCode(e[t+o]);return n}function I5e(e){return e.length<2?"0"+e:e}function Ple(e,t,r){let n="",o;for(let i=0;i<r;i++)n+="%"+I5e(e[t+i].toString(16));try{o=decodeURIComponent(n)}catch{return v5e(e,t,r)}return o}function _le(e,t,r){let n=r.length,o=0;for(let i=0;i<n;i++){let a=r.charCodeAt(i);if((a&4294967168)===0)e[t+o]=a,o++;else if((a&4294965248)===0)e[t+o]=192|a>>6,e[t+o+1]=128|a>>0&63,o+=2;else if((a&4294901760)===0)e[t+o]=224|a>>12,e[t+o+1]=128|a>>6&63,e[t+o+2]=128|a>>0&63,o+=3;else if((a&4294967295-(1<<21)+1)===0)e[t+o]=240|a>>18,e[t+o+1]=128|a>>12&63,e[t+o+2]=128|a>>6&63,e[t+o+3]=128|a>>0&63,o+=4;else throw new Error("e")}return o}function A9(e){let t=e.length,r=0;for(let n=0;n<t;n++){let o=e.charCodeAt(n);if((o&4294967168)===0)r++;else if((o&4294965248)===0)r+=2;else if((o&4294901760)===0)r+=3;else if((o&4294967295-(1<<21)+1)===0)r+=4;else throw new Error("e")}return r}var A5e=(function(){let e=new Uint32Array(256);for(let t=0;t<256;t++){let r=t;for(let n=0;n<8;n++)r&1?r=3988292384^r>>>1:r=r>>>1;e[t]=r}return e})();function T5e(e,t,r,n){for(let o=0;o<n;o++)e=A5e[(e^t[r+o])&255]^e>>>8;return e}function T9(e,t,r){return T5e(4294967295,e,t,r)^4294967295}var GB={deflate:void 0,"deflate-raw":void 0,gzip:void 0};function UB(e){if(GB[e]===void 0)try{new CompressionStream(e),GB[e]=!0}catch{GB[e]=!1}return!!GB[e]}var Bt=(function(){let e=Uint16Array,t=Uint32Array;return{next_code:new e(16),bl_count:new e(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new e(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new t(32),flmap:new e(512),fltree:[],fdmap:new e(32),fdtree:[],lmap:new e(32768),ltree:[],ttree:[],dmap:new e(32768),dtree:[],imap:new e(512),itree:[],rev15:new e(32768),lhst:new t(286),dhst:new t(30),ihst:new t(19),lits:new t(15e3),strt:new e(65536),prev:new e(32768)}})();(function(){for(let r=0;r<32768;r++){let n=r;n=(n&2863311530)>>>1|(n&1431655765)<<1,n=(n&3435973836)>>>2|(n&858993459)<<2,n=(n&4042322160)>>>4|(n&252645135)<<4,n=(n&4278255360)>>>8|(n&16711935)<<8,Bt.rev15[r]=(n>>>16|n<<16)>>>17}function t(r,n,o){for(;n--!==0;)r.push(0,o)}for(let r=0;r<32;r++)Bt.ldef[r]=Bt.of0[r]<<3|Bt.exb[r],Bt.ddef[r]=Bt.df0[r]<<4|Bt.dxb[r];t(Bt.fltree,144,8),t(Bt.fltree,112,9),t(Bt.fltree,24,7),t(Bt.fltree,8,8),$h(Bt.fltree,9),hI(Bt.fltree,9,Bt.flmap),gI(Bt.fltree,9),t(Bt.fdtree,32,5),$h(Bt.fdtree,5),hI(Bt.fdtree,5,Bt.fdmap),gI(Bt.fdtree,5),t(Bt.itree,19,0),t(Bt.ltree,286,0),t(Bt.dtree,30,0),t(Bt.ttree,320,0)})();function hI(e,t,r){let n=e.length,o=Bt.rev15;for(let i=0;i<n;i+=2)if(e[i+1]!==0){let a=i>>1,s=e[i+1],l=a<<4|s,u=t-s,c=e[i]<<u,m=c+(1<<u);for(;c!==m;){let d=o[c]>>>15-t;r[d]=l,c++}}}function $h(e,t){let r=e.length,n=Bt.bl_count;for(let a=0;a<=t;a++)n[a]=0;for(let a=1;a<r;a+=2)n[e[a]]++;let o=Bt.next_code,i=0;n[0]=0;for(let a=1;a<=t;a++)i=i+n[a-1]<<1,o[a]=i;for(let a=0;a<r;a+=2){let s=e[a+1];s!==0&&(e[a]=o[s],o[s]++)}}function gI(e,t){let r=Bt.rev15,n=15-t;for(let o=0;o<e.length;o+=2){let i=e[o]<<t-e[o+1];e[o]=r[i]>>>n}}function P5e(e,t){let r=t===void 0;return t===void 0&&(t=new Uint8Array(e.length>>>2<<3)),{data:e,buf:t,noBuf:r,BFINAL:0,off:0,pos:0}}function _5e(e,t){let{data:r,noBuf:n}=e,{buf:o,BFINAL:i,off:a,pos:s}=e,l=0;for(;i===0&&l<t;){let u,c,m=0,d=0;i=_9(r,s,1),l+=1;let p=_9(r,s+1,2);if(s+=3,p===0){(s&7)!==0&&(s+=8-(s&7));let h=(s>>>3)+4,f=r[h-4]|r[h-3]<<8;n&&(o=P9(o,a+f)),o.set(new Uint8Array(r.buffer,r.byteOffset+h,f),a),s=h+f<<3,a+=f;continue}if(n&&(o=P9(o,a+(1<<17))),p===1)u=Bt.flmap,c=Bt.fdmap,m=511,d=31;else if(p===2){let h=qx(r,s,5)+257,f=qx(r,s+5,5)+1,g=qx(r,s+10,4)+4;s+=14;for(let I=0;I<38;I+=2)Bt.itree[I]=0,Bt.itree[I+1]=0;let y=1;for(let I=0;I<g;I++){let v=qx(r,s+I*3,3);Bt.itree[(Bt.ordr[I]<<1)+1]=v,v>y&&(y=v)}s+=3*g,$h(Bt.itree,y),hI(Bt.itree,y,Bt.imap),u=Bt.lmap,c=Bt.dmap,s=R5e(Bt.imap,(1<<y)-1,h+f,r,s,Bt.ttree);let x=Rle(Bt.ttree,0,h,Bt.ltree);m=(1<<x)-1;let S=Rle(Bt.ttree,h,f,Bt.dtree);d=(1<<S)-1,$h(Bt.ltree,x),hI(Bt.ltree,x,u),$h(Bt.dtree,S),hI(Bt.dtree,S,c)}else throw new Error(`unknown BTYPE ${p}`);for(;;){let h=u[R9(r,s)&m];s+=h&15;let f=h>>>4;if(!(f>>>8))o[a++]=f;else{if(f===256)break;{let g=a+f-254;if(f>264){let v=Bt.ldef[f-257];g=a+(v>>>3)+qx(r,s,v&7),s+=v&7}let y=c[R9(r,s)&d];s+=y&15;let x=y>>>4,S=Bt.ddef[x],I=(S>>>4)+_9(r,s,S&15);for(s+=S&15,n&&(o=P9(o,a+(1<<17)));a<g;)o[a]=o[a++-I],o[a]=o[a++-I],o[a]=o[a++-I],o[a]=o[a++-I];a=g}}}}e.buf=o,e.BFINAL=i,e.off=a,e.pos=s}async function Dle(e,t,r){if(t[0]===3&&t[1]===0)return r||new Uint8Array(0);if(UB("deflate-raw")){let o=new DecompressionStream("deflate-raw"),a=new Blob([t]).stream().pipeThrough(o),s=0,l=[],u=a.getReader(),c=async()=>{let{done:m,value:d}=await u.read();if(!m)return e.shouldUpdate&&await e.update({message:"Inflating blocks...",current:s,max:r?.length}),r?r.set(d,s):l.push(d),s+=d.length,c()};if(await c(),!r){r=new Uint8Array(s);for(let m=0,d=0;m<l.length;m++)r.set(l[m],d),d+=l[m].length}return r}let n=P5e(t,r);for(;n.BFINAL===0;)e.shouldUpdate&&await e.update({message:"Inflating blocks...",current:n.pos,max:t.length}),_5e(n,100);return n.buf.length===n.off?n.buf:n.buf.slice(0,n.off)}function P9(e,t){let r=e.length;if(t<=r)return e;let n=new Uint8Array(Math.max(r<<1,t));return n.set(e,0),n}function R5e(e,t,r,n,o,i){let a=0;for(;a<r;){let s=e[R9(n,o)&t];o+=s&15;let l=s>>>4;if(l<=15)i[a]=l,a++;else{let u=0,c=0;l===16?(c=3+qx(n,o,2),o+=2,u=i[a-1]):l===17?(c=3+qx(n,o,3),o+=3):l===18&&(c=11+qx(n,o,7),o+=7);let m=a+c;for(;a<m;)i[a]=u,a++}}return o}function Rle(e,t,r,n){let o=0,i=0,a=n.length>>>1;for(;i<r;){let s=e[i+t];n[i<<1]=0,n[(i<<1)+1]=s,s>o&&(o=s),i++}for(;i<a;)n[i<<1]=0,n[(i<<1)+1]=0,i++;return o}function qx(e,t,r){return(e[t>>>3]|e[(t>>>3)+1]<<8)>>>(t&7)&(1<<r)-1}function _9(e,t,r){return(e[t>>>3]|e[(t>>>3)+1]<<8|e[(t>>>3)+2]<<16)>>>(t&7)&(1<<r)-1}function R9(e,t){return(e[t>>>3]|e[(t>>>3)+1]<<8|e[(t>>>3)+2]<<16)>>>(t&7)}function NB(e,t,r){let n=[],o=e.length,i=t.length;for(let h=0;h<i;h+=2)t[h]=0,t[h+1]=0;for(let h=0;h<o;h++)e[h]!==0&&n.push({lit:h,f:e[h],d:void 0});let a=n.length,s=n.slice(0);if(a===0)return 0;if(a===1){let h=n[0].lit,f=h===0?1:0;return t[(h<<1)+1]=1,t[(f<<1)+1]=1,1}n.sort(function(h,f){return h.f-f.f});let l=n[0],u=n[1],c=0,m=1,d=2;for(n[0]={lit:-1,f:l.f+u.f,l,r:u,d:0};m!==a-1;)c!==m&&(d===a||n[c].f<n[d].f)?l=n[c++]:l=n[d++],c!==m&&(d===a||n[c].f<n[d].f)?u=n[c++]:u=n[d++],n[m++]={lit:-1,f:l.f+u.f,l,r:u,d:void 0};let p=D9(n[m-1],0);p>r&&(D5e(s,r,p),p=r);for(let h=0;h<a;h++)t[(s[h].lit<<1)+1]=s[h].d;return p}function D9(e,t){return e.lit!==-1?(e.d=t,t):Math.max(D9(e.l,t+1),D9(e.r,t+1))}function D5e(e,t,r){let n=0,o=0,i=1<<r-t;for(e.sort(function(a,s){return s.d===a.d?a.f-s.f:s.d-a.d}),n=0;n<e.length&&e[n].d>t;n++){let a=e[n].d;e[n].d=t,o+=i-(1<<r-a)}for(o=o>>>r-t;o>0;){let a=e[n].d;a<t?(e[n].d++,o-=1<<t-a-1):n++}for(;n>=0;n--)e[n].d===t&&o<0&&(e[n].d--,o++);o!==0&&console.log("debt left")}function w5e(e,t,r,n){let{lits:o,strt:i,prev:a}=Bt;return{data:e,out:t,opt:B5e[n],i:0,pos:r<<3,cvrd:0,dlen:e.length,li:0,lc:0,bs:0,ebits:0,c:0,nc:0,lits:o,strt:i,prev:a}}function M5e(e,t){let{data:r,dlen:n,out:o,opt:i}=e,{i:a,pos:s,cvrd:l,li:u,lc:c,bs:m,ebits:d,c:p,nc:h}=e,{lits:f,strt:g,prev:y}=Bt,x=Math.min(a+t,n);for(;a<x;a++){if(p=h,a+1<n-2){h=w9(r,a+1);let S=a+1&32767;y[S]=g[h],g[h]=S}if(l<=a){(u>14e3||c>26697)&&n-a>100&&(l<a&&(f[u]=a-l,u+=2,l=a),s=kle(a===n-1||l===n?1:0,f,u,d,r,m,a-m,o,s),u=c=d=0,m=a);let S=0;if(a<n-2&&(S=E5e(r,a,y,p,Math.min(i[2],n-a),i[3])),S!==0){let I=S>>>16,v=S&65535,A=Ble(I,Bt.of0);Bt.lhst[257+A]++;let P=Ble(v,Bt.df0);Bt.dhst[P]++,d+=Bt.exb[A]+Bt.dxb[P],f[u]=I<<23|a-l,f[u+1]=v<<16|A<<8|P,u+=2,l=a+I}else Bt.lhst[r[a]]++;c++}}e.i=a,e.pos=s,e.cvrd=l,e.li=u,e.lc=c,e.bs=m,e.ebits=d,e.c=p,e.nc=h}var B5e=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]];async function Ele(e,t,r,n,o){if(UB("deflate-raw")){let h=new CompressionStream("deflate-raw"),y=new Blob([t]).stream().pipeThrough(h).getReader(),x=n,S=async()=>{let{done:I,value:v}=await y.read();if(!I)return e.shouldUpdate&&await e.update({message:"Deflating...",current:x,max:r.length}),r.set(v,x),x+=v.length,S()};return await S(),x}let i=w5e(t,r,n,o),{dlen:a}=i;if(o===0){let{i:h,pos:f}=i;for(;h<a;){let g=Math.min(65535,a-h);CS(r,f,h+g===a?1:0),f=Fle(t,h,g,r,f+8),h+=g}return f>>>3}for(a>2&&(i.nc=w9(t,0),i.strt[i.nc]=0);i.i<a;)e.shouldUpdate&&await e.update({message:"Deflating...",current:i.i,max:a}),M5e(i,1024*1024);let{li:s,cvrd:l,pos:u}=i,{i:c,lits:m,bs:d,ebits:p}=i;for((d!==c||t.length===0)&&(l<c&&(m[s]=c-l,s+=2,l=c),u=kle(1,m,s,p,t,d,c-d,r,u));(u&7)!==0;)u++;return u>>>3}function E5e(e,t,r,n,o,i){let a=t&32767,s=r[a],l=a-s+32768&32767;if(s===a||n!==w9(e,t-l))return 0;let u=0,c=0,m=Math.min(32767,t);for(;l<=m&&--i!==0&&s!==a;){if(u===0||e[t+u]===e[t+u-l]){let d=k5e(e,t,l);if(d>u){if(u=d,c=l,u>=o)break;l+2<d&&(d=l+2);let p=0;for(let h=0;h<d-2;h++){let f=t-l+h+32768&32767,g=r[f],y=f-g+32768&32767;y>p&&(p=y,s=f)}}}a=s,s=r[a],l+=a-s+32768&32767}return u<<16|c}function k5e(e,t,r){if(e[t]!==e[t-r]||e[t+1]!==e[t+1-r]||e[t+2]!==e[t+2-r])return 0;let n=t,o=Math.min(e.length,t+258);for(t+=3;t<o&&e[t]===e[t-r];)t++;return t-n}function w9(e,t){return(e[t]<<8|e[t+1])+(e[t+2]<<4)&65535}function kle(e,t,r,n,o,i,a,s,l){Bt.lhst[256]++;let[u,c,m,d,p,h,f,g]=F5e(),y=((l+3&7)===0?0:8-(l+3&7))+32+(a<<3),x=n+T_(Bt.fltree,Bt.lhst)+T_(Bt.fdtree,Bt.dhst),S=n+T_(Bt.ltree,Bt.lhst)+T_(Bt.dtree,Bt.dhst);S+=14+3*h+T_(Bt.itree,Bt.ihst)+(Bt.ihst[16]*2+Bt.ihst[17]*3+Bt.ihst[18]*7);for(let v=0;v<286;v++)Bt.lhst[v]=0;for(let v=0;v<30;v++)Bt.dhst[v]=0;for(let v=0;v<19;v++)Bt.ihst[v]=0;let I=y<x&&y<S?0:x<S?1:2;if(zB(s,l,e),zB(s,l+1,I),l+=3,I===0){for(;(l&7)!==0;)l++;l=Fle(o,i,a,s,l)}else{let v,A;if(I===1)v=Bt.fltree,A=Bt.fdtree;else if(I===2){$h(Bt.ltree,u),gI(Bt.ltree,u),$h(Bt.dtree,c),gI(Bt.dtree,c),$h(Bt.itree,m),gI(Bt.itree,m),v=Bt.ltree,A=Bt.dtree,CS(s,l,d-257),l+=5,CS(s,l,p-1),l+=5,CS(s,l,h-4),l+=4;for(let T=0;T<h;T++)CS(s,l+T*3,Bt.itree[(Bt.ordr[T]<<1)+1]);l+=3*h,l=wle(f,Bt.itree,s,l),l=wle(g,Bt.itree,s,l)}else Mr(I);let P=i;for(let T=0;T<r;T+=2){let R=t[T],w=R>>>23,E=P+(R&(1<<23)-1);for(;P<E;)l=P_(o[P++],v,s,l);if(w!==0){let M=t[T+1],D=M>>16,B=M>>8&255,k=M&255;l=P_(257+B,v,s,l),CS(s,l,w-Bt.of0[B]),l+=Bt.exb[B],l=P_(k,A,s,l),zB(s,l,D-Bt.df0[k]),l+=Bt.dxb[k],P+=w}}l=P_(256,v,s,l)}return l}function Fle(e,t,r,n,o){let i=o>>>3;return n[i]=r,n[i+1]=r>>>8,n[i+2]=255-n[i],n[i+3]=255-n[i+1],i+=4,n.set(new Uint8Array(e.buffer,t,r),i),o+(r+4<<3)}function F5e(){let e=NB(Bt.lhst,Bt.ltree,15),t=NB(Bt.dhst,Bt.dtree,15),r=[],n=Mle(Bt.ltree,r),o=[],i=Mle(Bt.dtree,o);for(let l=0;l<r.length;l+=2)Bt.ihst[r[l]]++;for(let l=0;l<o.length;l+=2)Bt.ihst[o[l]]++;let a=NB(Bt.ihst,Bt.itree,7),s=19;for(;s>4&&Bt.itree[(Bt.ordr[s-1]<<1)+1]===0;)s--;return[e,t,a,n,i,s,r,o]}function T_(e,t){let r=0;for(let n=0;n<t.length;n++)r+=t[n]*e[(n<<1)+1];return r}function wle(e,t,r,n){for(let o=0;o<e.length;o+=2){let i=e[o],a=e[o+1];n=P_(i,t,r,n);let s=i===16?2:i===17?3:7;i>15&&(CS(r,n,a),n+=s)}return n}function Mle(e,t){let r=e.length;for(;r!==2&&e[r-1]===0;)r-=2;for(let n=0;n<r;n+=2){let o=e[n+1],i=n+3<r?e[n+3]:-1,a=n+5<r?e[n+5]:-1,s=n===0?-1:e[n-1];if(o===0&&i===o&&a===o){let l=n+5;for(;l+2<r&&e[l+2]===o;)l+=2;let u=Math.min(l+1-n>>>1,138);u<11?t.push(17,u-3):t.push(18,u-11),n+=u*2-2}else if(o===s&&i===o&&a===o){let l=n+5;for(;l+2<r&&e[l+2]===o;)l+=2;let u=Math.min(l+1-n>>>1,6);t.push(16,u-3),n+=u*2-2}else t.push(o,0)}return r>>>1}function Ble(e,t){let r=0;return t[r|16]<=e&&(r|=16),t[r|8]<=e&&(r|=8),t[r|4]<=e&&(r|=4),t[r|2]<=e&&(r|=2),t[r|1]<=e&&(r|=1),r}function P_(e,t,r,n){return zB(r,n,t[e<<1]),n+t[(e<<1)+1]}function CS(e,t,r){r=r<<(t&7);let n=t>>>3;e[n]|=r,e[n+1]|=r>>>8}function zB(e,t,r){r=r<<(t&7);let n=t>>>3;e[n]|=r,e[n+1]|=r>>>8,e[n+2]|=r>>>16}async function Yx(e,t,r=!1){let n=Object.create(null),o=new Uint8Array(t);if(Kh(o,0)!==19280)throw new Error('Invalid ZIP file. A valid ZIP file must start with two magic bytes \\x50\\x4b ("PK" in ASCII).');let i=o.length-4;for(;Zx(o,i)!==101010256;)i--;let a=i;a+=4,a+=4;let s=Kh(o,a);a+=2,a+=2,a+=4;let l=Zx(o,a);a+=4,a=l;for(let u=0;u<s;u++){a+=4,a+=4,a+=4,a+=4,a+=4,a+=4,a+=4;let c=Kh(o,a),m=Kh(o,a+2),d=Kh(o,a+4);a+=6,a+=8;let p=Zx(o,a);a+=4,a+=c+m+d,await L5e(e,o,p,n,r)}return n}async function L5e(e,t,r,n,o){r+=4,r+=2,r+=2;let i=Kh(t,r);r+=2,r+=4,r+=4;let a=Zx(t,r);r+=4;let s=Zx(t,r);r+=4;let l=Kh(t,r);r+=2;let u=Kh(t,r);r+=2;let c=Ple(t,r,l);if(r+=l,r+=u,o){n[c]={size:s,csize:a};return}let m=new Uint8Array(t.buffer,r,a);if(i===0)n[c]=m;else if(i===8){let d=new Uint8Array(s);await Vle(e,m,d),n[c]=d}else throw new Error(`unknown compression method: ${i}`)}async function Vle(e,t,r){return Dle(e,t,r)}async function HB(e,t,r){let n=t[3],o=10;if(n&4){let c=Kh(t,o);o+=c}if(n&8){let c=o;for(;t[c]!==0;)++c;o=c+1}if(n&16){let c=o;for(;t[c]!==0;)++c;o=c+1}n&1&&(o+=2);let i=Tle(Zx(t,t.length-8)),a=Zx(t,t.length-4);r===void 0&&(r=new Uint8Array(a));let s=new Uint8Array(t.buffer,t.byteOffset+o,t.length-o-8),l=await Vle(e,s,r),u=T9(l,0,l.length);return i!==u&&console.error("ungzip: checksums don't match"),l}async function V5e(e,t,r){r===void 0&&(r={level:6});let n=new Uint8Array(50+Math.floor(t.length*1.1)),o=await Ele(e,t,n,0,r.level);return new Uint8Array(n.buffer,0,o)}function Ole(e,t=!1){return Ae.create("Zip",r=>O5e(r,e,t))}async function O5e(e,t,r=!1){let n=0,o={};for(let m in t){let d=!G5e(m)&&!r,p=t[m],h=T9(p,0,p.length);o[m]={cpr:d,usize:p.length,crc:h,file:d?await V5e(e,p):p}}for(let m in o)n+=o[m].file.length+30+46+2*A9(m);n+=22;let i=new Uint8Array(n),a=0,s=[];for(let m in o){let d=o[m];s.push(a),a=Lle(i,a,m,d,0)}let l=0,u=a;for(let m in o){let d=o[m];s.push(a),a=Lle(i,a,m,d,1,s[l++])}let c=a-u;return Jh(i,a,101010256),a+=4,a+=4,Qx(i,a,l),a+=2,Qx(i,a,l),a+=2,Jh(i,a,c),a+=4,Jh(i,a,u),a+=4,a+=2,i.buffer}function G5e(e){let t=e.split(".").pop().toLowerCase();return"png,jpg,jpeg,zip".indexOf(t)!==-1}function Lle(e,t,r,n,o,i=0){let a=n.file;Jh(e,t,o===0?67324752:33639248),t+=4,o===1&&(t+=2),Qx(e,t,20),t+=2,Qx(e,t,0),t+=2,Qx(e,t,n.cpr?8:0),t+=2,Jh(e,t,0),t+=4,Jh(e,t,n.crc),t+=4,Jh(e,t,a.length),t+=4,Jh(e,t,n.usize),t+=4,Qx(e,t,A9(r)),t+=2,Qx(e,t,0),t+=2,o===1&&(t+=2,t+=2,t+=6,Jh(e,t,i),t+=4);let s=_le(e,t,r);return t+=s,o===0&&(e.set(a,t),t+=a.length),t}function eg(e,t){return H5e(e,t)}function R_(e){return typeof e=="string"?Ule(e,e,"string"):Ule(e.title,e.url,e.type||"string",e.body,e.headers)}function U5e(e){if(Of)throw new Error("`isDone` should not be used when running in Node.js");if(e instanceof FileReader)return e.readyState===FileReader.DONE;if(e instanceof XMLHttpRequest)return e.readyState===XMLHttpRequest.DONE;throw new Error("unknown data type")}function Gle(e){return e?"Failed to download data. Possible reasons: Resource is not available, or CORS is not allowed on the server.":"Failed to open file."}function jle(e,t,r){if(Of)throw new Error("`readData` should not be used when running in Node.js");return new Promise((n,o)=>{if(U5e(r)){let{error:a}=r;a!=null?o(a??Gle(r instanceof XMLHttpRequest)):n(r);return}let i=!1;r.onerror=a=>{if(i)return;let{error:s}=a.target;o(s??Gle(r instanceof XMLHttpRequest))},r.onprogress=a=>{if(!(!e.shouldUpdate||i))try{a.lengthComputable?e.update({message:t,isIndeterminate:!1,current:a.loaded,max:a.total}):e.update({message:`${t} ${(a.loaded/1024/1024).toFixed(2)} MB`,isIndeterminate:!0})}catch(s){i=!0,o(s)}},r.onload=a=>{n(r)}})}function Wle(e){return/\.gz$/i.test(e)?1:/\.zip$/i.test(e)?2:0}var N5e=/^(__MACOSX|.DS_Store)/;async function z5e(e,t,r){switch(r){case 0:return t;case 1:return HB(e,t);case 2:let n=await Yx(e,t.buffer),o=Object.keys(n).filter(i=>!N5e.test(i));if(o.length!==1)throw new Error("can only decompress zip files with a single entry");return n[o[0]]}}async function jB(e,t,r,n){if(t===null)throw new Error("no data given");let o=new Uint8Array(t);if(n!==0&&r!=="zip"&&(o=await z5e(e,o,n)),r==="binary")return o;if(r==="zip")return await Yx(e,o.buffer);if(r==="string")return FB(o);if(r==="xml")return new DOMParser().parseFromString(Yh(o),"application/xml");if(r==="json")return JSON.parse(Yh(o));throw new Error(`could not get requested response data '${r}'`)}function H5e(e,t){if(Of)return j5e(e,t);let r;return Ae.create("Read File",async n=>{try{await n.update({message:"Opening file...",canAbort:!0}),r=new FileReader,r.readAsArrayBuffer(e);let i=(await jle(n,"Reading...",r)).result;return await n.update({message:"Processing file...",canAbort:!1}),await jB(n,i,t,Wle(e.name))}finally{r=void 0}},()=>{r&&r.abort()})}function j5e(e,t){return Ae.create("Read File",async r=>{await r.update({message:"Opening file...",canAbort:!1});let n=await e.arrayBuffer();return await r.update({message:"Processing file...",canAbort:!1}),await jB(r,n,t,Wle(e.name))})}var __=class e{static{this.pool=[]}static{this.poolSize=15}static get(){if(Of)throw new Error("`RequestPool.get` should not be used when running in Node.js");return this.pool.length?this.pool.pop():new XMLHttpRequest}static emptyFunc(){}static deposit(t){this.pool.length<this.poolSize&&(t.onabort=e.emptyFunc,t.onerror=e.emptyFunc,t.onload=e.emptyFunc,t.onprogress=e.emptyFunc,this.pool.push(t))}};function W5e(e,t){if(e.status>=200&&e.status<400){let{response:r}=e;if(__.deposit(e),(t==="binary"||t==="zip")&&r instanceof ArrayBuffer)return new Uint8Array(r);if(t==="string"&&typeof r=="string")return r;if(t==="xml"&&r instanceof XMLDocument)return r;if(t==="json"&&typeof r=="object")return r;throw new Error(`could not get requested response data '${t}'`)}else throw __.deposit(e),new Error(`Download failed with status code ${e.status}`)}function X5e(e){switch(e){case"json":return"json";case"xml":return"document";case"string":return"text";case"binary":return"arraybuffer";case"zip":return"arraybuffer"}}function Ule(e,t,r,n,o){if(Of)return t.startsWith("file://")?q5e(e,t,r,n,o):Y5e(e,t,r,n,o);let i;return Ae.create(e||"Download",async a=>{if(i=__.get(),i.open(n?"post":"get",t,!0),o)for(let[u,c]of o)i.setRequestHeader(u,c);i.responseType=X5e(r),i.send(n),await a.update({message:"Waiting for server...",canAbort:!0});let s=await jle(a,"Downloading...",i);return i=void 0,await a.update({message:"Parsing response...",canAbort:!1}),W5e(s,r)},()=>{i&&(i.abort(),i=void 0)})}var Nle;function Q5e(){if(!Nle)throw new Error("When running in Node.js and reading from files, call mol-util/data-source's setFSModule function first.");return Nle}function Z5e(e){return new Promise((t,r)=>{Q5e().readFile(e,(n,o)=>{n?r(n):t(o)})})}function q5e(e,t,r,n,o){if(!Of)throw new Error("This function should only be used when running in Node.js");if(!t.startsWith("file://"))throw new Error("This function is only for URLs with protocol file://");return Ae.create(e??"Download",async i=>{let a=t.substring(7);await i.update({message:"Loading file...",canAbort:!1});let s=await Z5e(a);return await i.update({message:"Parsing response...",canAbort:!1}),await jB(i,s.buffer,r,0)})}function Y5e(e,t,r,n,o){if(!Of)throw new Error("This function should only be used when running in Node.js");let i=new AbortController;return Ae.create(e??"Download",async a=>{await a.update({message:"Downloading...",canAbort:!0});let s=await fetch(t,{signal:i.signal});if(!(s.status>=200&&s.status<400))throw new Error(`Download failed with status code ${s.status}`);let l=await s.bytes();return await a.update({message:"Parsing response...",canAbort:!1}),await jB(a,l.buffer,r,0)},()=>{i.abort()})}async function Xle(e,t,r,n){let o=r.length,i=new Array(r.length);await e.update({message:"Downloading...",current:0,max:o});let a=[],s=[],l=0;for(let c=Math.min(o,n);l<c;l++){let m=r[l];a.push(Hle(l,m.id,t.resolve(sn.getUrlAsset(t,m.url),m.isBinary?"binary":"string").runAsChild(e))),s.push(l)}let u=0;for(;a.length>0;){let c=await Promise.race(a),m=r[c.index],d=s.indexOf(c.index);if(u++,c.kind==="error"&&!m.canFail)throw new Error(`${m.url}: ${c.error}`);if(e.shouldUpdate&&await e.update({message:"Downloading...",current:u,max:o}),i[c.index]=c,a=a.filter(zle,d),s=s.filter(zle,d),l<o){let p=r[l],h=t.resolve(sn.getUrlAsset(t,p.url),p.isBinary?"binary":"string").runAsChild(e);a.push(Hle(l,p.id,h)),s.push(l),l++}}return i}function zle(e,t){return this!==t}async function Hle(e,t,r){try{return{kind:"ok",result:await r,index:e,id:t}}catch(n){return{kind:"error",error:n,index:e,id:t}}}var sn;(s=>{function e(l,u){return{kind:"url",id:fn.create22(),url:l,...u}}s.Url=e;function t(l){return{kind:"file",id:fn.create22(),name:l.name,file:l}}s.File=t;function r(l){return l?.kind==="url"}s.isUrl=r;function n(l){return l?.kind==="file"}s.isFile=n;function o(l,u,c){return{data:l,dispose:()=>{c.release(u)}}}s.Wrapper=o;function i(l){return typeof l=="string"?l:l.url}s.getUrl=i;function a(l,u,c){return typeof u=="string"?l.tryFindUrl(u,c)||e(u,{body:c}):u}s.getUrlAsset=a})(sn||={});var WB=class{constructor(){this._assets=new Map}get assets(){return Vv(this._assets.values())}tryFindUrl(t,r){let n=this.assets.values();for(;;){let o=n.next();if(o.done)return;let i=o.value.asset;if(sn.isUrl(i)&&i.url===t&&(i.body||"")===(r||""))return i}}tryFindFilename(t){let r=this._assets.values();for(;;){let{done:n,value:o}=r.next();if(n)break;if(o.file.name===t)return o.asset}}set(t,r,n){this._assets.set(t.id,{asset:t,file:r,refCount:0,tag:n?.tag,isStatic:n?.isStatic})}get(t){return this._assets.get(t.id)}delete(t){return this._assets.delete(t.id)}has(t){return this._assets.has(t.id)}resolve(t,r,n=!0){return sn.isUrl(t)?Ae.create(`Download ${t.title||t.url}`,async o=>{if(this._assets.has(t.id)){let s=this._assets.get(t.id);return s.refCount++,sn.Wrapper(await eg(s.file,r).runInContext(o),t,this)}if(!n)return sn.Wrapper(await R_({...t,type:r}).runInContext(o),t,this);let i=await R_({...t,type:"binary"}).runInContext(o),a=new I9([i],"raw-data");return this._assets.set(t.id,{asset:t,file:a,refCount:1}),sn.Wrapper(await eg(a,r).runInContext(o),t,this)}):Ae.create(`Read ${t.name}`,async o=>{if(this._assets.has(t.id)){let i=this._assets.get(t.id);return i.refCount++,sn.Wrapper(await eg(i.file,r).runInContext(o),t,this)}if(!(t.file instanceof I9))throw new Error(`Cannot resolve file asset '${t.name}' (${t.id})`);return n&&this._assets.set(t.id,{asset:t,file:t.file,refCount:1}),sn.Wrapper(await eg(t.file,r).runInContext(o),t,this)})}release(t){let r=this._assets.get(t.id);r&&(r.refCount--,r.refCount<=0&&!r.isStatic&&this._assets.delete(t.id))}clearTag(t){let r=Array.from(this._assets.keys());for(let n of r){let o=this._assets.get(n);o&&o.tag===t&&this._assets.delete(n)}}clear(){this._assets.clear()}dispose(){this.clear()}};var C;(ve=>{ve.Essential={isEssential:!0};function t(K,re){return re&&(re.label&&(K.label=re.label),re.description&&(K.description=re.description),re.legend&&(K.legend=re.legend),re.fieldLabels&&(K.fieldLabels=re.fieldLabels),re.isHidden&&(K.isHidden=re.isHidden),re.shortLabel&&(K.shortLabel=re.shortLabel),re.twoColumns&&(K.twoColumns=re.twoColumns),re.isEssential&&(K.isEssential=re.isEssential),re.category&&(K.category=re.category),re.hideIf&&(K.hideIf=re.hideIf),re.help&&(K.help=re.help)),K}function r(K){let re={...K};return re.isOptional=!0,re}ve.Optional=r;function n(K,re){return t({type:"value",defaultValue:K},re)}ve.Value=n;function o(K,re,le){return t({type:"select",defaultValue:ae(K,re),options:re,cycle:le?.cycle},le)}ve.Select=o;function i(K,re,le){let ge=t({type:"multi-select",defaultValue:K,options:re},le);return le?.emptyValue&&(ge.emptyValue=le.emptyValue),ge}ve.MultiSelect=i;function a(K,re){return t({type:"boolean",defaultValue:K},re)}ve.Boolean=a;function s(K="",re){return t({type:"text",defaultValue:K,multiline:re?.multiline,placeholder:re?.placeholder,disableInteractiveUpdates:re?.disableInteractiveUpdates},re)}ve.Text=s;function l(K,re){let le=t({type:"color",defaultValue:K},re);return re?.isExpanded&&(le.isExpanded=re.isExpanded),le}ve.Color=l;function u(K,re){let le;if(typeof K=="string"){let ge=Ka(K);le={kind:ge.type!=="qualitative"?"interpolate":"set",colors:ge.list}}else le=K;return t({type:"color-list",presetKind:re?.presetKind||"all",defaultValue:le,offsets:!!re?.offsets},re)}ve.ColorList=u;function c(K,re,le){return t(f({type:"vec3",defaultValue:K},re),le)}ve.Vec3=c;function m(K,re){return t({type:"mat4",defaultValue:K},re)}ve.Mat4=m;function d(K,re){let le=typeof K=="string"?sn.Url(K):sn.Url(K.url,{body:K.body});return t({type:"url",defaultValue:le},re)}ve.Url=d;function p(K){let re=t({type:"file",defaultValue:null},K);return K?.accept&&(re.accept=K.accept),re}ve.File=p;function h(K){let re=t({type:"file-list",defaultValue:null},K);return K?.accept&&(re.accept=K.accept),re}ve.FileList=h;function f(K,re){return re&&(typeof re.min<"u"&&(K.min=re.min),typeof re.max<"u"&&(K.max=re.max),typeof re.step<"u"&&(K.step=re.step)),K}function g(K,re,le){let ge=t(f({type:"number",defaultValue:K},re),le);return le?.immediateUpdate&&(ge.immediateUpdate=!0),ge}ve.Numeric=g;function y(K,re,le){return t(f({type:"interval",defaultValue:K},re),le)}ve.Interval=y;function x(K,re){let le=t({type:"line-graph",defaultValue:K},re);return re?.getVolume&&(le.getVolume=re.getVolume),le}ve.LineGraph=x;function S(K,re){let le=t({type:"group",defaultValue:re?.customDefault||F(K),params:K},re);return re?.presets&&(le.presets=re.presets),re?.isExpanded&&(le.isExpanded=re.isExpanded),re?.isFlat&&(le.isFlat=re.isFlat),re?.pivot&&(le.pivot=re.pivot),le}ve.Group=S;function I(K){return S({},K)}ve.EmptyGroup=I;function v(K,re,le,ge){let Ee=ae(K,re);return t({type:"mapped",defaultValue:{name:Ee,params:le(Ee).defaultValue},select:o(Ee,re,ge),map:le},ge)}ve.Mapped=v;function A(K,re,le){let ge=le?.options?le.options:Object.keys(re).map(nt=>[nt,re[nt].label||va(nt)]),Ee=ae(K,ge);return t({type:"mapped",defaultValue:{name:Ee,params:re[Ee].defaultValue},select:o(Ee,ge,le),map:nt=>re[nt]},le)}ve.MappedStatic=A;function P(K,re,le){return t({type:"object-list",element:K,getLabel:re,ctor:T,defaultValue:le?.defaultValue||[]},le)}ve.ObjectList=P;function T(){return F(this.element)}function R(){throw new Error("getValue not set. Fix runtime.")}function w(K,re,le){return t({type:"value-ref",defaultValue:{ref:le?.defaultRef??"",getValue:R},getOptions:K,resolveRef:re},le)}ve.ValueRef=w;function E(K){return t({type:"data-ref",defaultValue:{ref:K?.defaultRef??"",getValue:R}},K)}ve.DataRef=E;function M(K,re,le){return t({type:"converted",defaultValue:re(le.defaultValue),converted:le,fromValue:K,toValue:re},le)}ve.Converted=M;function D(K,re,le,ge,Ee){let nt=Object.keys(re).map(at=>[at,at]);return t({type:"conditioned",select:o(le(K),nt,Ee),defaultValue:K,conditionParams:re,conditionForValue:le,conditionedValue:ge},Ee)}ve.Conditioned=D;function B(K,re){return t({type:"script",defaultValue:K},re)}ve.Script=B;function k(K){return 0}ve.For=k;function F(K){let re={};for(let le of Object.keys(K))K[le].isOptional||(re[le]=K[le].defaultValue);return re}ve.getDefaultValues=F;function z(K,re,le){return()=>K(re,le)}function j(K,re,le){if(re){if(K.type==="value-ref"){let ge=re;ge.ref?ge.getValue=z(K.resolveRef,ge.ref,le):ge.getValue=()=>{throw new Error("Unset ref in ValueRef value.")}}else if(K.type==="data-ref"){let ge=re;ge.ref?ge.getValue=z(le,ge.ref,le):ge.getValue=()=>{throw new Error("Unset ref in ValueRef value.")}}else if(K.type==="group")X(K.params,re,le);else if(K.type==="mapped"){let ge=re,Ee=K.map(ge.name);j(Ee,ge.params,le)}else if(K.type==="object-list"){if(!G(K.element))return;for(let ge of re)X(K.element,ge,le)}}}function Y(K){if(K.type==="value-ref"||K.type==="data-ref")return!0;if(K.type==="group"){if(G(K.params))return!0}else if(K.type==="mapped"){for(let[re]of K.select.options)if(Y(K.map(re)))return!0}else if(K.type==="object-list")return G(K.element);return!1}function G(K){for(let re of Object.keys(K))if(Y(K[re]))return!0;return!1}function X(K,re,le){for(let ge of Object.keys(K))j(K[ge],re?.[ge],le)}ve.resolveRefs=X;function U(K,re){for(let le of Object.keys(K))K[le].isOptional||(K[le].defaultValue=re[le])}ve.setDefaultValues=U;function L(K){return Wo(K)}ve.clone=L;function q(K,re){}ve.validate=q;function te(K,re,le){if(re===le)return!0;if(typeof re!="object"||typeof le!="object")return!1;for(let ge of Object.keys(K))if(!J(K[ge],re[ge],le[ge]))return!1;return!0}ve.areEqual=te;function J(K,re,le){if(re===le)return!0;if(K.type==="group")return te(K.params,re,le);if(K.type==="mapped"){let ge=re,Ee=le;if(ge.name!==Ee.name)return!1;let nt=K.map(ge.name);return J(nt,ge.params,Ee.params)}else if(K.type==="multi-select"){let ge=re,Ee=le;if(ge.length!==Ee.length)return!1;if(ge.length<10){for(let nt=0,at=ge.length;nt<at;nt++)if(ge[nt]!==Ee[nt]&&Ee.indexOf(ge[nt])<0)return!1}else{let nt=new Set(Ee);for(let at=0,be=ge.length;at<be;at++)if(ge[at]!==Ee[at]&&!nt.has(ge[at]))return!1}return!0}else{if(K.type==="interval")return re[0]===le[0]&&re[1]===le[1];if(K.type==="line-graph"){let ge=re,Ee=le;if(ge.length!==Ee.length)return!1;for(let nt=0,at=ge.length;nt<at;nt++)if(!Ce.areEqual(ge[nt],Ee[nt]))return!1;return!0}else{if(K.type==="vec3")return b.equals(re,le);if(K.type==="mat4")return H.areEqual(re,le,1e-6);if(K.type==="script"){let ge=re,Ee=le;return ge.language===Ee.language&&ge.expression===Ee.expression}else if(K.type==="object-list"){let ge=re,Ee=le,nt=ge.length;if(nt!==Ee.length)return!1;for(let at=0;at<nt;at++)if(!te(K.element,ge[at],Ee[at]))return!1;return!0}else if(typeof re=="object"&&typeof le=="object")return Gh(re,le)}}return!1}ve.isParamEqual=J;function ee(K,re,le){if(re===void 0)return{...le};if(le===void 0)return{...re};let ge={};for(let Ee of Object.keys(K))ge[Ee]=ce(K[Ee],re[Ee],le[Ee]);return ge}ve.merge=ee;function ce(K,re,le){if(re===void 0)return typeof le=="object"&&!Array.isArray(le)?{...le}:le;if(le===void 0)return typeof re=="object"&&!Array.isArray(re)?{...re}:re;if(K.type==="group")return ee(K.params,re,le);if(K.type==="mapped"){let ge=re,Ee=le;if(ge.name!==Ee.name)return{...Ee};let nt=K.map(Ee.name);return{name:Ee.name,params:ce(nt,ge.params,Ee.params)}}else return K.type==="value"?le:typeof re=="object"&&typeof le=="object"?Array.isArray(le)?le:{...re,...le}:le}ve.mergeParam=ce;function fe(K,re){for(let le of K.options)if(le[0]===re)return!0;return!1}function O(K,re,le){if(re==null)return le?K.defaultValue:void 0;if(K.type==="value")return re;if(K.type==="group"){let ge={};for(let Ee of Object.keys(K.params)){let nt=K.params[Ee];re[Ee]===void 0?le&&(ge[Ee]=nt.defaultValue):ge[Ee]=O(nt,re[Ee],le)}return ge}else if(K.type==="mapped"){let ge=re;if(typeof ge.name!="string")return K.defaultValue;if(typeof ge.params>"u")return le?K.defaultValue:void 0;if(!fe(K.select,ge.name))return K.defaultValue;let Ee=K.map(ge.name);return{name:ge.name,params:O(Ee,ge.params,le)}}else{if(K.type==="select")return fe(K,re)?re:K.defaultValue;if(K.type==="multi-select"){if(!Array.isArray(re))return K.defaultValue;let ge=re.filter(function(Ee){return fe(this,Ee)},K);return re.length>0&&ge.length===0?K.defaultValue:ge}else if(K.type==="object-list")return Array.isArray(re)?re.map(ge=>V(K.element,ge,le?"all":"skip")):K.defaultValue}return re}function V(K,re,le){if(typeof re!="object"||re===null)return le?F(K):re;let ge={};for(let Ee of Object.keys(K)){let nt=K[Ee];re[Ee]===void 0?le==="all"&&(ge[Ee]=nt.defaultValue):ge[Ee]=O(nt,re[Ee],le!=="skip")}return ge}ve.normalizeParams=V;function Z(K,re){let le=[];for(let ge of Object.keys(K))if(!re)typeof K[ge]=="string"?le.push([ge,K[ge]]):le.push([ge,re===null?ge:va(ge)]);else{let Ee=re(ge,K[ge]);le.push(typeof Ee=="string"?[ge,Ee]:[ge,Ee[0],Ee[1]])}return le}ve.objectToOptions=Z;function pe(K,re){let le=[];for(let ge of K)re?le.push([ge,re(ge)]):le.push([ge,re===null?ge:va(ge)]);return le}ve.arrayToOptions=pe;function $(K,re){for(let le of K.options)if(le[0]===re)return le[1];return""}ve.optionLabel=$;function ae(K,re){for(let le of re)if(le[0]===K)return K;return re.length>0?re[0][0]:void 0}function Se(K,re){let le={};for(let ge of Object.keys(re)){let Ee=re[ge];!K[ge]||Ee===null||Ee===void 0||K[ge].defaultValue===Ee||(le[ge]={...K[ge],defaultValue:Ee})}return{...K,...le}}ve.withDefaults=Se})(C||={});var Gs;(o=>{function e(i){let a={create(s){return{action:a,params:s}},id:fn.create22(),definition:i,createDefaultParams(s,l){return i.params?C.getDefaultValues(i.params(s,l)):{}}};return a}o.create=e;function t(i){let a=i.definition;return e({from:a.from,display:a.display,params:a.params,isApplicable:i.definition.isApplicable?(s,l,u)=>i.definition.isApplicable(s,u):void 0,run({cell:s,state:l,params:u}){let c=l.build().to(s.transform.ref).apply(i,u);return l.updateTree(c)}})}o.fromTransformer=t;let r;(s=>{function i(l){return u=>e({from:l.from instanceof Array?l.from:l.from?[l.from]:[],display:typeof l.display=="string"?{name:l.display}:l.display?l.display:{name:"Unnamed State Action"},params:typeof l.params=="object"?()=>l.params:l.params?l.params:void 0,isApplicable:l.isApplicable,...typeof u=="function"?{run:u}:u})}s.build=l=>i(l)})(r=o.Builder||={}),o.build=r.build})(Gs||={});var et;(f=>{function e(g,y,x){return g.definition.params?g.definition.params(y,x):{}}f.getParamDefinition=e;function t(g){return!!g&&typeof g.toAction=="function"&&typeof g.apply=="function"}f.is=t;let r;(I=>(I[I.Unchanged=0]="Unchanged",I[I.Updated=1]="Updated",I[I.Recreate=2]="Recreate",I[I.Null=3]="Null"))(r=f.UpdateResult||={});let n=new Map,o=new Map;function i(g){for(let y of g.definition.from)o.has(y.type)?o.get(y.type).push(g):o.set(y.type,[g])}function a(){return Array.from(n.values())}f.getAll=a;function s(g){let y=n.get(g);if(!y)throw new Error(`A transformer with signature '${g}' is not registered.`);return y}f.get=s;function l(g){return o.get(g)||[]}f.fromType=l;function u(g,y){let{name:x}=y,S=`${g}.${x}`;n.has(S)&&console.warn(`A transform with id '${x}' is already registered. Please pick a unique identifier for your transforms and/or register them only once. This is to ensure that transforms can be serialized and replayed.`);let I={apply(v,A,P){return Br.create(v,I,A,P)},toAction(){return Gs.fromTransformer(I)},namespace:g,id:S,definition:y,createDefaultParams(v,A){return y.params?C.getDefaultValues(y.params(v,A)):{}}};return n.set(S,I),i(I),I}f.create=u;function c(g){return y=>u(g,y)}f.factory=c;function m(g){return d.build(g)}f.builderFactory=m;let d;(x=>{function g(S,I){return v=>u(S,{name:I.name,from:I.from instanceof Array?I.from:[I.from],to:I.to instanceof Array?I.to:[I.to],display:typeof I.display=="string"?{name:I.display}:I.display?I.display:{name:Sm(I.name.replace(/[-]/g," "))},params:typeof I.params=="object"?()=>I.params:I.params?I.params:void 0,isDecorator:I.isDecorator,...v})}function y(S){return I=>g(S,I)}x.build=y})(d=f.Builder||={});function p(g){return d.build(g)}f.build=p,f.ROOT=u("build-in",{name:"root",from:[],to:[],display:{name:"Root",description:"For internal use."},apply(){throw new Error("should never be applied")},update(){return 0}})})(et||={});var Br;(x=>{x.RootRef="-=root=-";function t(S,I){return I?typeof I.isCollapsed<"u"&&S.isCollapsed!==I.isCollapsed||typeof I.isHidden<"u"&&S.isHidden!==I.isHidden||typeof I.isGhost<"u"&&S.isGhost!==I.isGhost||typeof I.isLocked<"u"&&S.isLocked!==I.isLocked:!1}x.isStateChange=t;function r(S,I){if(!I)return!1;let v=!1;for(let A of Object.keys(I)){let P=I[A],T=S[A];!!P!=!!T&&(v=!0,S[A]=P)}return v}x.assignState=r;function n(S,I){if(!I)return!1;let v=!1;for(let A of Object.keys(I)){let P=I[A],T=S[A];!!P!=!!T&&(v=!0,P!==void 0?S[A]=P:delete S[A])}for(let A of Object.keys(S)){let P=I[A],T=S[A];!!P!=!!T&&(v=!0,P!==void 0?S[A]=P:delete S[A])}return v}x.syncState=n;function o(S,I,v,A){let P=A&&A.ref?A.ref:fn.create22(),T;return A&&A.tags&&(T=typeof A.tags=="string"?[A.tags]:A.tags,T.length===0?T=void 0:T.sort()),{parent:S,transformer:I,state:A?.state||{},tags:T,ref:P,dependsOn:A&&A.dependsOn,params:v,version:fn.create22()}}x.create=o;function i(S,I){return{...S,params:I,version:fn.create22()}}x.withParams=i;function a(S,I){return I?{...S,state:{...S.state,...I}}:S}x.withState=a;function s(S,I){let v;return I&&(v=typeof I=="string"?[I]:I,v.length===0?v=void 0:v.sort()),{...S,tags:v,version:fn.create22()}}x.withTags=s;function l(S,I){let v;return I&&(v=typeof I=="string"?[I]:I,v.length===0?v=void 0:v.sort()),{...S,dependsOn:v,version:fn.create22()}}x.withDependsOn=l;function u(S,I){return{...S,parent:I,version:fn.create22()}}x.withParent=u;function c(S){return o(x.RootRef,et.ROOT,{},{ref:x.RootRef,state:S})}x.createRoot=c;function m(S,I){return S.tags?S.tags.indexOf(I)>=0:!1}x.hasTag=m;function d(S,I){if(!S.tags)return typeof I!="string"&&I.length===0;if(typeof I=="string")return m(S,I);for(let v of I)if(S.tags.indexOf(v)<0)return!1;return!0}x.hasTags=d;let p={};function h(S){let I;try{I=_5(S.params??p)}catch{let v=S.transformer.definition.customSerialization?S.transformer.definition.customSerialization.toJSON:f;I=_5(v(S.params??p))}S.version=I}x.setParamsHashVersion=h;function f(S){return S}function g(S){let I=S.transformer.definition.customSerialization?S.transformer.definition.customSerialization.toJSON:f,v;for(let A of Object.keys(S.state))S.state[A]&&(v||(v={}),v[A]=!0);return{parent:S.parent,transformer:S.transformer.id,params:S.params?I(S.params):void 0,state:v,tags:S.tags,ref:S.ref,dependsOn:S.dependsOn,version:S.version}}x.toJSON=g;function y(S){let I=et.get(S.transformer),v=I.definition.customSerialization?I.definition.customSerialization.fromJSON:f;return{parent:S.parent,transformer:I,params:S.params?v(S.params):void 0,state:S.state||{},tags:S.tags,ref:S.ref,dependsOn:S.dependsOn,version:S.version}}x.fromJSON=y})(Br||={});var w_=class{constructor(t){this.tree=t;this.transforms=this.tree.transforms;this.children=this.tree.children;this.dependencies=this.tree.dependencies;this.changedNodes=!1;this.changedChildren=!1;this.changedDependencies=!1;this._childMutations=void 0;this._dependencyMutations=void 0;this._stateUpdates=void 0}get childMutations(){return this._childMutations?this._childMutations:(this._childMutations=new Map,this._childMutations)}get dependencyMutations(){return this._dependencyMutations?this._dependencyMutations:(this._dependencyMutations=new Map,this._dependencyMutations)}changeNodes(){this.changedNodes||(this.changedNodes=!0,this.transforms=this.transforms.asMutable())}changeChildren(){this.changedChildren||(this.changedChildren=!0,this.children=this.children.asMutable())}changeDependencies(){this.changedDependencies||(this.changedDependencies=!0,this.dependencies=this.dependencies.asMutable())}get root(){return this.transforms.get(Br.RootRef)}asTransient(){return this.asImmutable().asTransient()}addChild(t,r){if(this.changeChildren(),this.childMutations.has(t))this.childMutations.get(t).add(r);else{let n=this.children.get(t).asMutable();n.add(r),this.children.set(t,n),this.childMutations.set(t,n)}}removeChild(t,r){if(this.changeChildren(),this.childMutations.has(t))this.childMutations.get(t).remove(r);else{let n=this.children.get(t).asMutable();n.remove(r),this.children.set(t,n),this.childMutations.set(t,n)}}clearRoot(){let t=Br.RootRef;if(this.children.get(t).size===0)return;this.changeChildren();let r=xd();this.children.set(t,r),this.childMutations.set(t,r)}mutateDependency(t,r,n){let o=this.dependencyMutations.get(t);if(!o){let i=this.dependencies.get(t);if(!i&&n==="remove")return;this.changeDependencies(),o=i?i.asMutable():xd().asMutable(),this.dependencyMutations.set(t,o),this.dependencies.set(t,o)}n==="add"?o.add(r):o.remove(r)}changeParent(t,r){D_(this.transforms,t);let n=this.transforms.get(t);this.removeChild(n.parent,t),this.addChild(r,t),this.changeNodes(),this.transforms.set(t,Br.withParent(n,r))}add(t){let r=t.ref;this.transforms.has(t.ref)&&this.transforms.get(t.ref).parent!==t.parent&&$5e(t.ref);let n=this.children.get(t.parent);if(n||eze(t.parent),n.has(t.ref)||this.addChild(t.parent,t.ref),this.children.has(t.ref)||(this.changedChildren||(this.changedChildren=!0,this.children=this.children.asMutable()),this.children.set(t.ref,xd())),this.changeNodes(),this.transforms.set(r,t),t.dependsOn)for(let o of t.dependsOn)this.mutateDependency(o,r,"add");return this}setParams(t,r){D_(this.transforms,t);let n=this.transforms.get(t);return qb(n.params,r)?!1:(this.changedNodes||(this.changedNodes=!0,this.transforms=this.transforms.asMutable()),this.transforms.set(n.ref,Br.withParams(n,r)),!0)}setTags(t,r){D_(this.transforms,t);let n=this.transforms.get(t),o=Br.withTags(n,r);return w0(n.tags,o.tags)?!1:(this.changedNodes||(this.changedNodes=!0,this.transforms=this.transforms.asMutable()),this.transforms.set(n.ref,o),!0)}setDependsOn(t,r){D_(this.transforms,t);let n=this.transforms.get(t),o=Br.withDependsOn(n,r);return w0(n.dependsOn,o.dependsOn)?!1:(this.changedNodes||(this.changedNodes=!0,this.transforms=this.transforms.asMutable()),this.transforms.set(n.ref,o),!0)}assignState(t,r){D_(this.transforms,t);let n=this.transforms.get(t);if(this._stateUpdates&&this._stateUpdates.has(t))return Br.assignState(n.state,r),n;{this._stateUpdates||(this._stateUpdates=new Set),this._stateUpdates.add(n.ref),this.changeNodes();let o=Br.withState(n,r);return this.transforms.set(t,o),o}}remove(t){let r=this.transforms.get(t);if(!r)return[];let n=Co.subtreePostOrder(this,r);if(t===Br.RootRef){if(n.pop(),n.length===0)return n;this.clearRoot()}else{if(n.length===0)return n;this.removeChild(r.parent,r.ref)}this.changeNodes(),this.changeChildren();for(let i of n)this.transforms.delete(i.ref),this.children.delete(i.ref),this._childMutations&&this._childMutations.delete(i.ref);let o=[];for(let i of n){if(i.dependsOn)for(let a of i.dependsOn)this.transforms.has(a)&&this.mutateDependency(a,i.ref,"remove");if(this.dependencies.has(i.ref)){let a=this.dependencies.get(i.ref).toArray();this.changeDependencies(),this.dependencies.delete(i.ref),this._dependencyMutations&&this._dependencyMutations.delete(i.ref);for(let s of a)if(this.transforms.has(s))for(let l of this.remove(s))o[o.length]=l}}for(let i of o)n[n.length]=i;return n}asImmutable(){return!this.changedNodes&&!this.changedChildren&&!this._childMutations?this.tree:(this._childMutations&&this._childMutations.forEach(K5e,this.children),this._dependencyMutations&&this._dependencyMutations.forEach(J5e,this.dependencies),Co.create(this.changedNodes?this.transforms.asImmutable():this.transforms,this.changedChildren?this.children.asImmutable():this.children,this.changedDependencies?this.dependencies.asImmutable():this.dependencies))}};function K5e(e,t){this.set(t,e.asImmutable())}function J5e(e,t){e.size===0?this.delete(t):this.set(t,e.asImmutable())}function $5e(e){throw new Error(`Transform '${e}' is already present in the tree.`)}function eze(e){throw new Error(`Parent '${e}' must be present in the tree.`)}function D_(e,t){if(!e.has(t))throw new Error(`Node '${t}' is not present in the tree.`)}var Co;(I=>{class e{constructor(A,P,T){this.transforms=A;this.children=P;this.dependencies=T}get root(){return this.transforms.get(Br.RootRef)}asTransient(){return new w_(this)}}function t(v){let A=v||Br.createRoot();return r(Cd([[A.ref,A]]),Cd([[A.ref,xd()]]),Cd())}I.createEmpty=t;function r(v,A,P){return new e(v,A,P)}I.create=r;function n(v){o(this,this.tree.transforms.get(v))}function o(v,A){let P=v.tree.children.get(A.ref);P&&P.size&&P.forEach(n,v),v.f(A,v.tree,v.state)}function i(v,A,P,T){let R={tree:v,state:P,f:T};return o(R,A),R.state}I.doPostOrder=i;function a(v){s(this,this.tree.transforms.get(v))}function s(v,A){let P=v.f(A,v.tree,v.state);if(typeof P=="boolean"&&!P)return;let T=v.tree.children.get(A.ref);T&&T.size&&T.forEach(a,v)}function l(v,A,P,T){let R={tree:v,state:P,f:T};return s(R,A),R.state}I.doPreOrder=l;function u(v,A,P){P.push(v)}function c(v,A){return i(v,A,[],u)}I.subtreePostOrder=c;function m(v,A,P){P.push(Br.toJSON(v))}function d(v){let A=[];return l(v,v.root,A,m),{transforms:A}}I.toJSON=d;function p(v){let A=Cd().asMutable(),P=Cd().asMutable(),T=Cd().asMutable();for(let w of v.transforms){let E=Br.fromJSON(w);A.set(E.ref,E),P.has(E.ref)||P.set(E.ref,xd().asMutable()),E.ref!==E.parent&&P.get(E.parent).add(E.ref)}let R=new Set;for(let w of v.transforms){let E=w.ref;if(P.set(E,P.get(E).asImmutable()),!!w.dependsOn)for(let M of w.dependsOn)R.add(M),T.has(M)?T.get(M).add(E):T.set(M,xd([E]).asMutable())}return R.forEach(w=>{T.set(w,T.get(w).asImmutable())}),r(A.asImmutable(),P.asImmutable(),T.asImmutable())}I.fromJSON=p;function h(v){console.log({tr:v.transforms.keySeq().toArray(),tr1:v.transforms.valueSeq().toArray().map(A=>A.ref),ch:v.children.keySeq().toArray()})}I.dump=h;function f(v,A,P){if(A===P)return!0;let R=v.children.get(A).values();for(;;){let w=R.next();if(w.done)return!1;if(f(v,w.value,P))return!0}}function g(v,A,P){return!v.transforms.has(A)||!v.transforms.has(P)?!1:f(v,A,P)}I.subtreeHasRef=g;function y(v,A){let P=v.children.get(A);if(P.size!==1)return A;let T=v.transforms.get(P.first());return T?.transformer.definition.isDecorator?y(v,T.ref):A}I.getDecoratorRoot=y;function x(v,A){for(let P of A){let T=v.transforms.get(P);T&&Br.setParamsHashVersion(T)}}I.setParamHashVersion=x;function S(v,A){let P=new Map(A.transforms.map(T=>[T.ref,T]));for(let T of v.transforms){let R=P.get(T.ref);R&&(T.transformer!==R.transformer||T.version!==R.version||(T.params=R.params))}}I.reuseTransformParams=S})(Co||={});var tr;(te=>{function e(J,ee){return t(J)(ee)}te.select=e;function t(J){let ee=J||l.root,ce;return n(ee)?ce=ee.compile():r(ee)?ce=l.byValue(ee).compile():o(ee)?ce=ee:ce=l.byRef(ee).compile(),ce}te.compile=t;function r(J){return J.transform!==void 0&&J.status!==void 0}function n(J){return J.compile!==void 0}function o(J){return typeof J=="function"}let i={select(J){return e(this,J||this.state)}};function a(J,ee){i[J]=function(...ce){return ee.call(void 0,this,...ce)}}function s(J){return Object.create(i,{compile:{writable:!1,configurable:!1,value:J}})}let l;(ve=>{ve.root=s(()=>K=>[K.cells.get(K.tree.root.ref)]);function ee(...K){return s(()=>re=>{let le=[];for(let ge of K){let Ee=re.cells.get(ge);Ee&&le.push(Ee)}return le})}ve.byRef=ee;function ce(...K){return s(()=>re=>K)}ve.byValue=ce;function fe(K,re=Br.RootRef){return s(()=>le=>{let ge={roots:[],cells:le.cells,type:K.type};return Co.doPreOrder(le.tree,le.tree.transforms.get(re),ge,pe),ge.roots})}ve.rootsOfType=fe;function O(K,re=Br.RootRef){return s(()=>le=>{let ge={ret:[],cells:le.cells,type:K.type};return Co.doPreOrder(le.tree,le.tree.transforms.get(re),ge,$),ge.ret})}ve.ofType=O;function V(K,re=Br.RootRef){return s(()=>le=>{let ge={ret:[],cells:le.cells,t:K};return Co.doPreOrder(le.tree,le.tree.transforms.get(re),ge,ae),ge.ret})}ve.ofTransformer=V;function Z(K,re=Br.RootRef){return s(()=>le=>{let ge={ret:[],cells:le.cells,t:K};return Co.doPreOrder(le.tree,le.tree.transforms.get(re),ge,Se),ge.ret})}ve.ofTransformerWithError=Z;function pe(K,re,le){let ge=le.cells.get(K.ref);return ge&&ge.obj&&ge.obj.type===le.type?(le.roots.push(ge),!1):!0}function $(K,re,le){let ge=le.cells.get(K.ref);return ge&&ge.obj&&ge.obj.type===le.type&&le.ret.push(ge),!0}function ae(K,re,le){let ge=le.cells.get(K.ref);return ge&&ge.obj&&ge.transform.transformer===le.t&&le.ret.push(ge),!0}function Se(K,re,le){let ge=le.cells.get(K.ref);return ge&&ge.status==="error"&&ge.transform.transformer===le.t&&le.ret.push(ge),!0}})(l=te.Generators||={}),a("flatMap",u);function u(J,ee){let ce=t(J);return s(()=>fe=>{let O=[];for(let V of ce(fe))for(let Z of ee(V,fe))O.push(Z);return O})}te.flatMap=u,a("mapObject",c);function c(J,ee){let ce=t(J);return s(()=>fe=>{let O=[];for(let V of ce(fe)){let Z=ee(V,fe);Z&&O.push(Z)}return O})}te.mapObject=c,a("unique",m);function m(J){let ee=t(J);return s(()=>ce=>{let fe=new Set,O=[];for(let V of ee(ce))V&&(fe.has(V.transform.ref)||(fe.add(V.transform.ref),O.push(V)));return O})}te.unique=m,a("first",d);function d(J){let ee=t(J);return s(()=>ce=>{let fe=ee(ce);return fe.length?[fe[0]]:[]})}te.first=d,a("filter",p);function p(J,ee){return u(J,ce=>ee(ce)?[ce]:[])}te.filter=p,a("withStatus",h);function h(J,ee){return p(J,ce=>ce.status===ee)}te.withStatus=h,a("withTag",f);function f(J,ee){return p(J,ce=>!!ce.transform.tags&&ce.transform.tags.indexOf(ee)>=0)}te.withTag=f,a("subtree",g);function g(J){return u(J,(ee,ce)=>{let fe=[];return Co.doPreOrder(ce.tree,ce.tree.transforms.get(ee.transform.ref),fe,(O,V,Z)=>{Z.push(O.ref)}),fe.map(O=>ce.cells.get(O))})}te.subtree=g,a("children",y);function y(J){return u(J,(ee,ce)=>{let fe=[];return ce.tree.children.get(ee.transform.ref).forEach(O=>fe.push(ce.cells.get(O))),fe})}te.children=y,a("ofType",x);function x(J,ee){return p(J,ce=>ce.obj?ce.obj.type===ee.type:!1)}te.ofType=x,a("ancestor",S);function S(J,ee){return m(c(J,(ce,fe)=>E(fe.tree,fe.cells,ce.transform.ref,ee)))}te.ancestor=S,a("ancestorOfType",I);function I(J,ee){return m(c(J,(ce,fe)=>B(fe.tree,fe.cells,ce.transform.ref,ee)))}te.ancestorOfType=I,a("ancestorWithTransformer",v);function v(J,ee){return m(c(J,(ce,fe)=>D(fe.tree,fe.cells,ce.transform.ref,ee)))}te.ancestorWithTransformer=v,a("withTransformer",A);function A(J,ee){return p(J,ce=>ce.transform.transformer===ee)}te.withTransformer=A,a("root",P);function P(J,ee){return m(c(J,(ce,fe)=>M(fe.tree,fe.cells,ce.transform.ref,ee)))}te.root=P,a("rootOfType",T);function T(J,ee){return m(c(J,(ce,fe)=>k(fe.tree,fe.cells,ce.transform.ref,ee)))}te.rootOfType=T,a("parent",R);function R(J){return m(c(J,(ee,ce)=>ce.cells.get(ce.tree.transforms.get(ee.transform.ref).parent)))}te.parent=R;function w(J,ee,ce,fe,O){let V=J.transforms.get(ce),Z;for(;;){V=J.transforms.get(V.parent);let pe=ee.get(V.ref);if(pe.obj&&fe(pe)&&(Z=pe,O)||V.ref===Br.RootRef)return Z}}function E(J,ee,ce,fe){return w(J,ee,ce,fe,!0)}te.findAncestor=E;function M(J,ee,ce,fe){return w(J,ee,ce,fe,!1)}te.findRoot=M;function D(J,ee,ce,fe){return E(J,ee,ce,Array.isArray(fe)?O=>fe.indexOf(O.transform.transformer)>=0:O=>O.transform.transformer===fe)}te.findAncestorWithTransformer=D;function B(J,ee,ce,fe){return E(J,ee,ce,F(fe))}te.findAncestorOfType=B;function k(J,ee,ce,fe){return M(J,ee,ce,F(fe))}te.findRootOfType=k;function F(J){return Array.isArray(J)?ee=>{for(let ce of J)if(ce.type===ee.obj.type)return!0}:ee=>ee.obj.type===J.type}function z(J,ee,ce){return Co.doPreOrder(J,J.transforms.get(ee),{refs:{},tags:ce},j).refs}te.findUniqueTagsInSubtree=z;function j(J,ee,ce){if(J.tags){for(let fe of J.tags)if(ce.tags.has(fe)){ce.refs[fe]=J.ref;break}}return!0}function Y(J,ee,ce){return Co.doPreOrder(J,J.transforms.get(ee),{ref:void 0,tag:ce},G).ref}te.findTagInSubtree=Y;function G(J,ee,ce){return J.tags&&J.tags.indexOf(ce.tag)>=0?(ce.ref=J.ref,!1):!0}function X(J,ee,ce){return Co.doPreOrder(J,J.transforms.get(ee),{refs:[],tags:ce},U).refs}te.findWithAllTags=X;function U(J,ee,ce){if(J.tags){let fe=ce.tags.size,O=0;for(let V of J.tags)if(ce.tags.has(V)&&(O++,O===fe)){ce.refs.push(J);break}}else ce.tags.size===0&&ce.refs.push(J)}function L(J,ee,ce){if(J.transforms.get(ee).transformer===ce)return J.cells.get(ee);let O=J.tree.children.get(ee);if(O.size!==1)return;let V=O.first();if(V&&J.transforms.get(V).transformer.definition.isDecorator)return L(J,V,ce)}te.tryFindDecorator=L;function q(J,ee){let ce=J.tree.children.get(ee);if(ce.size!==1)return J.cells.get(ee);let fe=ce.first();return fe&&J.transforms.get(fe).transformer.definition.isDecorator?q(J,fe):J.cells.get(ee)}te.getDecorated=q})(tr||={});var X9=_t(sue());function Pl(e,t){return typeof e=="object"&&!("prototype"in e)?(0,X9.create)({...e},t):(0,X9.create)(e,t)}var vS;(a=>{function e(s){let l=new Set;for(let u of s.actions)switch(u.kind){case"add":l.add(u.transform.ref);break;case"update":l.add(u.ref);break;case"delete":l.add(u.ref);break;case"insert":{l.add(u.ref),l.add(u.transform.ref);let c=s.tree.children.get(u.ref).toArray();for(let m of c)l.add(m);break}}return Array.from(l)}function t(s,l){if(!s.state||s.state.tree===s.editInfo.sourceTree){let m=s.tree.asImmutable();return l?.useHashVersion&&Co.setParamHashVersion(m,e(s)),m}let u=s.state.tree.asTransient();for(let m of s.actions)switch(m.kind){case"add":u.add(m.transform);break;case"update":u.setParams(m.ref,m.params);break;case"delete":u.remove(m.ref);break;case"insert":{let d=u.children.get(m.ref).toArray();u.add(m.transform);for(let p of d)u.changeParent(p,m.transform.ref);break}}s.editInfo.sourceTree=s.tree;let c=u.asImmutable();return l?.useHashVersion&&Co.setParamHashVersion(c,e(s)),c}function r(s){return!!s&&typeof s.getTree=="function"}a.is=r;function n(s){return!!s&&typeof s.getTree=="function"&&typeof s.ref=="string"}a.isTo=n;class o{get editInfo(){return this.state.editInfo}get currentTree(){return this.state.tree}to(l){let u=typeof l=="string"?l:a_.is(l)?l.transform.ref:l.ref;return new i(this.state,u,this)}toRoot(){return new i(this.state,this.state.tree.root.ref,this)}delete(l){let u=ci.resolveRef(l);return!u||!this.state.tree.transforms.has(u)?this:(this.editInfo.count++,this.state.tree.remove(u),this.state.actions.push({kind:"delete",ref:u}),this)}getTree(l){return t(this.state,l)}commit(l){if(!this.state.state)throw new Error("Cannot commit template tree");return this.state.state.runTask(this.state.state.updateTree(this,l))}constructor(l,u){this.state={state:u,tree:l.asTransient(),actions:[],editInfo:{applied:!1,sourceTree:l,count:0,lastUpdate:void 0}}}}a.Root=o;class i{constructor(l,u,c){this.state=l;this.root=c;if(this.ref=u,!this.state.tree.transforms.has(u))throw new Error(`Could not find node '${u}'.`)}get editInfo(){return this.state.editInfo}get selector(){return new Jv(this.ref,this.state.state)}getApplyRoot(){return Co.getDecoratorRoot(this.state.tree,this.ref)}apply(l,u,c){if(l.definition.isDecorator)return this.insert(l,u,c);let m=this.getApplyRoot(),d=l.apply(m,u,c);return this.state.tree.add(d),this.editInfo.count++,this.editInfo.lastUpdate=d.ref,this.state.actions.push({kind:"add",transform:d}),new i(this.state,d.ref,this.root)}applyOrUpdate(l,u,c,m){if(this.state.tree.transforms.has(l)){let d=this.to(l);return c&&d.update(c),d}else return this.apply(u,c,{...m,ref:l})}applyOrUpdateTagged(l,u,c,m){if(u.definition.isDecorator)throw new Error("Can't use applyOrUpdateTagged on decorator transformers.");let d=this.getApplyRoot(),p=this.state.tree.children.get(d).values();for(;;){let f=p.next();if(f.done)break;let g=this.state.tree.transforms.get(f.value);if(g&&Br.hasTags(g,l)){let y=this.to(f.value);return y.updateTagged(c,YB(g.tags,l,m&&m.tags)),y}}let h=u.apply(d,c,{...m,tags:YB(l,m&&m.tags)});return this.state.tree.add(h),this.editInfo.count++,this.editInfo.lastUpdate=h.ref,this.state.actions.push({kind:"add",transform:h}),new i(this.state,h.ref,this.root)}group(l,u,c){return this.apply(l,u,c)}insert(l,u,c){let m=this.state.tree.children.get(this.ref).toArray(),d=l.apply(this.ref,u,c);this.state.tree.add(d);for(let p of m)this.state.tree.changeParent(p,d.ref);return this.editInfo.count++,this.editInfo.lastUpdate=d.ref,this.state.actions.push({kind:"insert",ref:this.ref,transform:d}),new i(this.state,d.ref,this.root)}updateTagged(l,u){(this.state.tree.setParams(this.ref,l)||this.state.tree.setTags(this.ref,u))&&(this.editInfo.count++,this.editInfo.lastUpdate=this.ref,this.state.actions.push({kind:"update",ref:this.ref,params:l}))}update(l,u){let c;if(u){let m=this.state.tree.transforms.get(this.ref);c=Pl(m.params,u)}else c=typeof l=="function"?Pl(this.state.tree.transforms.get(this.ref).params,l):l;return this.state.tree.setParams(this.ref,c)&&(this.editInfo.count++,this.editInfo.lastUpdate=this.ref,this.state.actions.push({kind:"update",ref:this.ref,params:c})),this.root}updateState(l){let u=this.state.tree.transforms.get(this.ref);Br.isStateChange(u.state,l)&&(this.state.tree.assignState(this.ref,l),this.editInfo.count++,this.editInfo.lastUpdate=this.ref,this.state.actions.find(c=>c.kind==="update"&&c.ref===this.ref)||this.state.actions.push({kind:"update",ref:this.ref,params:u.params}))}tag(l){let u=this.state.tree.transforms.get(this.ref);return this.updateTagged(u.params,YB(u.tags,l)),this}dependsOn(l){let u=this.state.tree.transforms.get(this.ref);this.state.tree.setDependsOn(this.ref,YB(u.dependsOn,l))&&(this.editInfo.count++,this.editInfo.lastUpdate=this.ref,this.state.actions.push({kind:"update",ref:this.ref,params:u.params}))}to(l){return this.root.to(l)}toRoot(){return this.root.toRoot()}delete(l){return this.root.delete(l)}getTree(l){return t(this.state,l)}commit(l){if(!this.state.state)throw new Error("Cannot commit template tree");return this.state.state.runTask(this.state.state.updateTree(this,l))}}a.To=i})(vS||={});function YB(...e){let t,r=[];for(let n of e)if(n)if(t||(t=new Set),typeof n=="string"){if(t.has(n))continue;t.add(n),r.push(n)}else for(let o of n)t.has(o)||(t.add(o),r.push(o));return r}var KB=class{constructor(){this.ev=Tc.create();this.actions=new Map;this.fromTypeIndex=new Map;this.events={added:this.ev(),removed:this.ev()}}add(t){let r=et.is(t)?t.toAction():t;if(this.actions.has(r.id))return this;this.actions.set(r.id,r);for(let n of r.definition.from)this.fromTypeIndex.has(n.type)?this.fromTypeIndex.get(n.type).push(r):this.fromTypeIndex.set(n.type,[r]);return this.events.added.next(void 0),this}remove(t){let r=et.is(t)?t.toAction().id:fn.is(t)?t:t.id,n=this.actions.get(r);if(!n)return this;this.actions.delete(r);for(let o of n.definition.from){let i=this.fromTypeIndex.get(o.type);i&&(Jd(i,n),i.length===0&&this.fromTypeIndex.delete(o.type))}return this.events.removed.next(void 0),this}fromCell(t,r){let n=t.obj;if(!n)return[];let o=this.fromTypeIndex.get(n.type);if(!o)return[];let i=!1;for(let s of o)if(s.definition.isApplicable){i=!0;break}if(!i)return o;let a=[];for(let s of o)s.definition.isApplicable?s.definition.isApplicable(n,t.transform,r)&&a.push(s):a.push(s);return a}dispose(){this.ev.dispose()}};var Gf;(o=>{function e(i){return{type:"message",timestamp:new Date,message:i}}o.message=e;function t(i){return{type:"error",timestamp:new Date,message:i}}o.error=t;function r(i){return{type:"warning",timestamp:new Date,message:i}}o.warning=r;function n(i){return{type:"info",timestamp:new Date,message:i}}o.info=n})(Gf||={});var IS;(n=>{class e{constructor(i){this.cells=i;this._current=void 0}get current(){return this._current}set current(i){this._current=i}getAncestorOfType(i){if(!this._current)return;let a=this._current;for(;;){if(a=this.cells.get(a.transform.parent),!a.obj)return;if(a.obj.type===i.type)return a.obj;if(a.transform.ref===Br.RootRef)return}}getRootOfType(i){if(!this._current)return;let a=this._current,s;for(;;){if(!a.obj)return;if(a.obj.type===i.type&&(s=a),a.transform.ref===Br.RootRef)return s?s.obj:void 0;a=this.cells.get(a.transform.parent)}}}n.Impl=e;function t(o,i){let a=o.cells,s=a.get(i),l=[s];for(;s?.transform.transformer.definition.isDecorator;)s=a.get(s.transform.parent),l.push(s);return l}n.getDecoratorChain=t;function r(o,i,a){let s,l=o.cells.get(a);if(l)for(;;){if(!l.obj)return;if(l.obj.type===i.type&&(s=l),l.transform.ref===Br.RootRef)return s?s.obj:void 0;l=o.cells.get(l.transform.parent)}}n.getRootOfType=r})(IS||={});var JB=class{constructor(){this.queue=[];this.signal=new Pn}get length(){return this.queue.length}enqueue(t){return this.queue.push(t),this.queue.length===1?!0:this.waitFor(t)}handled(t){Sf(this.queue,t),this.queue.length>0&&this.signal.next({v:this.queue[0],stillPresent:!0})}remove(t){let r=Sf(this.queue,t);return r&&this.signal.next({v:t,stillPresent:!1}),r}waitFor(t){return new Promise(r=>{let n=this.signal.subscribe(({v:o,stillPresent:i})=>{o===t&&(n.unsubscribe(),r(i))})})}};var Un;(n=>{function e(){return{keys:new Set,array:[]}}n.create=e;function t({keys:o,array:i},a,s){return o.has(a)?!1:(o.add(a),i[i.length]=s,!0)}n.add=t;function r({keys:o},i){return o.has(i)}n.has=r})(Un||={});var Rm=class{constructor(t,r){this.errorFree=!0;this.ev=Tc.create();this.globalContext=void 0;this.events={cell:{stateUpdated:this.ev(),created:this.ev(),removed:this.ev()},object:{updated:this.ev(),created:this.ev(),removed:this.ev()},log:this.ev(),changed:this.ev(),historyUpdated:this.ev()};this.behaviors={currentObject:this.ev.behavior({state:this,ref:Br.RootRef}),isUpdating:this.ev.behavior(!1)};this.actions=new KB;this.cells=new Map;this.spine=new IS.Impl(this.cells);this.refResolvers=[];this.tryGetCellData=t=>{let r=this.cells.get(t)?.obj?.data;if(r===void 0){for(let[,n]of this.refResolvers)if(r=n(this,t),r!==void 0)break;if(r===void 0)throw new Error(`Cell '${t}' data undefined.`)}return r};this.historyCapacity=5;this.history=[];this.undoingHistory=!1;this.inTransaction=!1;this.inTransactionError=!1;this._inUpdate=!1;this.reverted=!1;this.updateQueue=new JB;this._tree=Co.createEmpty(Br.createRoot(r&&r.rootState)).asTransient();let o=this._tree.root;this.runTask=r.runTask,r?.historyCapacity!==void 0&&(this.historyCapacity=r.historyCapacity),this.cells.set(o.ref,{parent:this,transform:o,sourceRef:void 0,obj:t,status:"ok",state:{...o.state},errorText:void 0,params:{definition:{},values:{}},dependencies:{dependentBy:[],dependsOn:[]},cache:{}}),this.globalContext=r&&r.globalContext}get tree(){return this._tree}get transforms(){return this._tree.transforms}get current(){return this.behaviors.currentObject.value.ref}get root(){return this.cells.get(this._tree.root.ref)}build(){return new vS.Root(this.tree,this)}registerRefResolver(t,r){this.refResolvers.push([t,r])}removeRefResolver(t){this.refResolvers=this.refResolvers.filter(r=>r[0]!==t)}addHistory(t,r){this.historyCapacity!==0&&(this.history.unshift([t,r||"Update"]),this.history.length>this.historyCapacity&&this.history.pop(),this.events.historyUpdated.next({state:this}))}clearHistory(){this.history.length!==0&&(this.history=[],this.events.historyUpdated.next({state:this}))}get latestUndoLabel(){return this.history.length>0?this.history[0][1]:void 0}get canUndo(){return this.history.length>0}undo(){return Ae.create("Undo",async t=>{let r=this.history.shift();if(r){this.events.historyUpdated.next({state:this}),this.undoingHistory=!0;try{await this.updateTree(r[0],{canUndo:!1}).runInContext(t)}finally{this.undoingHistory=!1}}})}getSnapshot(){return{tree:Co.toJSON(this._tree)}}setSnapshot(t){let r=Co.fromJSON(t.tree);return this.updateTree(r)}setCurrent(t){this.behaviors.currentObject.next({state:this,ref:t})}updateCellState(t,r){let n=this.cells.get(t);if(!n)return;let o=typeof r=="function"?r(n.state):r;Br.assignState(n.state,o)&&(n.transform=this._tree.assignState(n.transform.ref,o),this.events.cell.stateUpdated.next({state:this,ref:t,cell:n}))}dispose(){this.ev.dispose(),this.actions.dispose()}select(t){return tr.select(t,this)}selectQ(t){return typeof t=="string"?tr.select(t,this):tr.select(t(tr.Generators),this)}applyAction(t,r,n=Br.RootRef){return Ae.create("Apply Action",o=>{let i=this.cells.get(n);if(!i)throw new Error(`'${n}' does not exist.`);if(i.status!=="ok")throw new Error(`Action cannot be applied to a cell with status '${i.status}'`);return q9(t.definition.run({ref:n,cell:i,a:i.obj,params:r,state:this},this.globalContext),o)})}transaction(t,r){return Ae.create("State Transaction",async n=>{let o=this.inTransaction,i=this._tree.asImmutable(),a=!1;try{o||this.behaviors.isUpdating.next(!0),this.inTransaction=!0,this.inTransactionError=!1,await t(n),this.inTransactionError&&(a=!0,await this.updateTree(i).runInContext(n))}catch(s){if(a||(a=!0,await this.updateTree(i).runInContext(n),this.events.log.next(Gf.error("Error during state transaction, reverting"))),o)throw this.inTransactionError=!0,s;if(r?.rethrowErrors)throw s;console.error(s)}finally{o||(this.inTransaction=!1,this.events.changed.next({state:this,inTransaction:!1}),this.behaviors.isUpdating.next(!1),a||(r?.canUndo?this.addHistory(i,typeof r.canUndo=="string"?r.canUndo:void 0):this.clearHistory()))}})}get inUpdate(){return this._inUpdate}updateTree(t,r){let n={tree:t,options:r};return Ae.create("Update Tree",async o=>{if(!await this.updateQueue.enqueue(n))return;this._inUpdate=!0;let a=r?.canUndo?this._tree.asImmutable():void 0,s=!1;this.inTransaction||this.behaviors.isUpdating.next(!0);try{if(vS.is(t)){if(t.editInfo.applied)throw new Error("This builder has already been applied. Create a new builder for further state updates");t.editInfo.applied=!0}this.reverted=!1;let l=r&&(r.revertIfAborted||r.revertOnError)?await this._revertibleTreeUpdate(o,n,r):await this._updateTree(o,n);return s=this.reverted,l.ctx.hadError&&(this.inTransactionError=!0),l.cell?new Jv(l.cell.transform.ref,this):void 0}finally{this._inUpdate=!1,this.updateQueue.handled(n),this.inTransaction||(this.behaviors.isUpdating.next(!1),r?.canUndo?s||this.addHistory(a,typeof r.canUndo=="string"?r.canUndo:void 0):this.undoingHistory||this.clearHistory())}},()=>{this.updateQueue.remove(n)})}async _revertibleTreeUpdate(t,r,n){let o=this.tree,i=await this._updateTree(t,r);return(i.ctx.hadError||i.ctx.wasAborted)&&n.revertOnError||i.ctx.wasAborted&&n.revertIfAborted?(this.reverted=!0,await this._updateTree(t,{tree:o,options:r.options})):i}async _updateTree(t,r){let n=!1,o=this.updateTreeAndCreateCtx(r.tree,t,r.options);try{if(n=await lze(o),vS.isTo(r.tree)){let i=this.select(r.tree.ref)[0];return{ctx:o,cell:i}}return{ctx:o}}finally{this.spine.current=void 0,n&&this.events.changed.next({state:this,inTransaction:this.inTransaction})}}updateTreeAndCreateCtx(t,r,n){let o=(vS.is(t)?t.getTree():t).asTransient(),i=this._tree;this._tree=o;let a={parent:this,editInfo:vS.is(t)?t.editInfo:void 0,errorFree:this.errorFree,taskCtx:r,oldTree:i,tree:o,cells:this.cells,spine:this.spine,results:[],options:{...sze,...n},changed:!1,hadError:!1,wasAborted:!1,newCurrent:void 0,getCellData:this.tryGetCellData};return this.errorFree=!0,a}};(r=>{function e(n,o){return new r(n,o)}r.create=e;let t;(o=>{function n(i,a){return!!a&&i.ref===a.transform.ref&&i.state===a.parent}o.isCell=n})(t=r.ObjectEvent||={})})(Rm||={});var sze={doNotLogTiming:!1,doNotUpdateCurrent:!0,revertIfAborted:!1,revertOnError:!1,canUndo:!1};async function lze(e){let t=!!(e.editInfo&&e.editInfo.count===1&&e.editInfo.lastUpdate&&e.editInfo.sourceTree===e.oldTree),r,n=[],o;if(t)r=[],o=[e.editInfo.lastUpdate];else{r=dze(e);let s=e.parent.current,l=!1;for(let u of r)if(u===s){l=!0;break}if(l){let u=lue(e.oldTree,s,r,e.cells);e.parent.setCurrent(u)}for(let u=r.length-1;u>=0;u--){let c=e.cells.get(r[u]);c&&$B(c.transform,c.obj,c?.transform.params,c.cache,e.parent.globalContext)}for(let u of r){let c=e.cells.get(u);c&&(c.parent=void 0,yze(c));let m=c&&c.obj;e.cells.delete(u),n.push(m)}o=uze(e.cells,e.tree)}let i=Cze(e,o);for(let s of i.added)e.parent.events.cell.created.next({state:e.parent,ref:s.transform.ref,cell:s});for(let s=0;s<r.length;s++){let l=r[s],u=e.oldTree.transforms.get(l).parent;e.parent.events.object.removed.next({state:e.parent,ref:l,obj:n[s]}),e.parent.events.cell.removed.next({state:e.parent,ref:l,parent:u})}if(n.length&&(n=[]),i.dependent)for(let s of i.dependent)o.push(s.transform.ref);gze(e,o);for(let s of o)await mue(e,s);e.editInfo||fze(e);let a=e.newCurrent;for(let s of e.results)s.action==="created"?(e.parent.events.object.created.next({state:e.parent,ref:s.ref,obj:s.obj}),e.newCurrent||!e.tree.transforms.get(s.ref).state.isGhost&&s.obj!==Gn.Null&&(a=s.ref)):s.action==="updated"?e.parent.events.object.updated.next({state:e.parent,ref:s.ref,action:"in-place",obj:s.obj,oldData:s.oldData}):s.action==="replaced"&&e.parent.events.object.updated.next({state:e.parent,ref:s.ref,action:"recreate",obj:s.obj,oldObj:s.oldObj});if(a)e.options.doNotUpdateCurrent||e.parent.setCurrent(a);else{let s=e.parent.current,l=e.cells.get(s);l&&(l.obj===Gn.Null||l.status==="error"&&l.errorText===Sze)&&(a=lue(e.oldTree,s,[],e.cells),e.parent.setCurrent(a))}return r.length>0||o.length>0||e.changed}function uze(e,t){let r={roots:[],cells:e};return Co.doPreOrder(t,t.root,r,cze),r.roots}function cze(e,t,r){let n=r.cells.get(e.ref);return!n||n.transform.version!==e.version?(r.roots.push(e.ref),!1):!(n.status==="error"||n&&n.obj===Gn.Null)}function mze(e,t,r){!r.newTree.transforms.has(e.ref)&&r.cells.has(e.ref)&&r.deletes.push(e.ref)}function dze(e){let t={newTree:e.tree,cells:e.cells,deletes:[]};return Co.doPostOrder(e.oldTree,e.oldTree.root,t,mze),t.deletes}function pze(e,t,r){let n=r.cells.get(e.ref);!n||!Br.syncState(n.state,e.state)||r.parent.events.cell.stateUpdated.next({state:r.parent,ref:e.ref,cell:n})}function fze(e){Co.doPreOrder(e.tree,e.tree.root,e,pze)}function eE(e,t,r,n){let o=e.cells.get(t),i=o.status!==r;o.status=r,o.errorText=n,i&&e.parent.events.cell.stateUpdated.next({state:e.parent,ref:t,cell:o})}function hze(e,t,r){r.cells.get(e.ref).transform=e,eE(r,e.ref,"pending")}function gze(e,t){for(let r of t)Co.doPreOrder(e.tree,e.tree.transforms.get(r),e,hze)}function yze(e){for(let t of e.dependencies.dependsOn)Jd(t.dependencies.dependentBy,e)}function bze(e,t,{ctx:r,added:n,visited:o}){if(o.add(e.ref),r.cells.has(e.ref))return;let i={parent:r.parent,transform:e,sourceRef:void 0,status:"pending",state:{...e.state},errorText:void 0,params:void 0,dependencies:{dependentBy:[],dependsOn:[]},cache:void 0};r.cells.set(e.ref,i),n.push(i)}function xze(e,t){if(e.transform.dependsOn)for(let r of e.transform.dependsOn){if(!t.tree.transforms.get(r))throw new Error("Cannot depend on a non-existent transform.");let o=t.cells.get(r);li(e.dependencies.dependsOn,o),li(o.dependencies.dependentBy,e)}}function Cze(e,t){let r={ctx:e,visited:new Set,added:[]};for(let o of t)Co.doPreOrder(e.tree,e.tree.transforms.get(o),r,bze);for(let o of r.added)xze(o,e);let n;return r.visited.forEach(o=>{let i=e.cells.get(o);for(let a of i.dependencies.dependentBy)r.visited.has(a.transform.ref)||(n||(n=Un.create()),Un.add(n,a.transform.ref,a))}),{added:r.added,dependent:n?n.array:void 0}}function lue(e,t,r,n){let o=new Set(r);return cue(e,t,o,n)}function cue(e,t,r,n){if(t===Br.RootRef)return t;let o=e.transforms.get(t),i=e.children.get(o.parent).values(),a,s=!1;for(;;){let l=i.next();if(l.done)break;if(r.has(l.value))continue;let u=n.get(l.value);if(!u||u.status==="error"||u.obj===Gn.Null)continue;let c=e.transforms.get(l.value);if(!c.state.isGhost){if(l.value===t){s=!0,r.has(t)||(a=t);continue}if(s)return c.ref;a=c.ref}}return a||cue(e,o.parent,r,n)}function Z9(e,t,r,n){n||(e.hadError=!0,e.parent.errorFree=!1);let o=e.cells.get(t);if(r){e.wasAborted=e.wasAborted||Ae.isAbort(r);let a=""+r;eE(e,t,"error",a),n||e.parent.events.log.next({type:"error",timestamp:new Date,message:a})}else o.params=void 0;if(o.obj){let a=o.obj;o.obj=void 0,o.cache=void 0,e.parent.events.object.removed.next({state:e.parent,ref:t,obj:a})}let i=e.tree.children.get(t).values();for(;;){let a=i.next();if(a.done)return;Z9(e,a.value,void 0,n)}}var Sze="Parent is null";async function mue(e,t){eE(e,t,"processing");let r=!1;try{let o=En(),i=await Ize(e,t),a=En()-o;i.action!=="none"&&(e.changed=!0),eE(e,t,"ok"),e.results.push(i),i.action==="created"?(r=i.obj===Gn.Null,!r&&!e.options.doNotLogTiming&&e.parent.events.log.next(Gf.info(`Created ${i.obj.label} in ${Fv(a)}.`))):i.action==="updated"?(r=i.obj===Gn.Null,!r&&!e.options.doNotLogTiming&&e.parent.events.log.next(Gf.info(`Updated ${i.obj.label} in ${Fv(a)}.`))):i.action==="replaced"&&(r=i.obj===Gn.Null,!r&&!e.options.doNotLogTiming&&e.parent.events.log.next(Gf.info(`Updated ${i.obj.label} in ${Fv(a)}.`)))}catch(o){e.changed=!0,e.hadError||(e.newCurrent=t),Z9(e,t,o,!1),console.error(o);return}let n=e.tree.children.get(t).values();for(;;){let o=n.next();if(o.done)return;r?Z9(e,o.value,void 0,!0):await mue(e,o.value)}}function vze(e,t,r,n){let o=t.transformer.definition.params,i=o?o(r,e.parent.globalContext):{};if(t.version!==t._normalized_param_version)t.params=C.normalizeParams(i,t.params,"all"),t._normalized_param_version=t.version;else{let a=C.getDefaultValues(i);t.params=t.params?WJ(t.params,a):a}return C.resolveRefs(i,t.params,e.getCellData),{definition:i,values:t.params}}async function Ize(e,t){let{oldTree:r,tree:n}=e,o=e.cells.get(t),i=o.transform;if(o.transform.ref===Br.RootRef)return{action:"none"};let a=e.cells.get(o.transform.parent);if(a?.obj===Gn.Null)if(o.sourceRef=a.transform.ref,r.transforms.has(t)&&o.params){let m=o.params.values,d=o.cache;return $B(i,o.obj,m,d,e.parent.globalContext),o.params=void 0,o.obj=Gn.Null,{ref:t,action:"updated",obj:o.obj}}else return o.params=void 0,{ref:t,action:"created",obj:Gn.Null};let l=i.transformer.definition.from.length===0?a:tr.findAncestorOfType(n,e.cells,t,i.transformer.definition.from);if(!l)throw new Error(`No suitable parent found for '${t}'`);e.spine.current=o;let u=l.obj;o.sourceRef=l.transform.ref;let c=vze(e,i,u,o);if(!r.transforms.has(t)||!o.params){o.params=c;let m=await uue(e,o,i.transformer,u,c.values);return Q9(m,i),o.obj=m,{ref:t,action:"created",obj:m}}else{let m=o.params.values,d=o.cache,p=o.obj?.data,h=c.values;switch(o.params=c,o.obj&&o.obj!==Gn.Null?await Aze(e,o,i.transformer,u,o.obj,m,h):et.UpdateResult.Recreate){case et.UpdateResult.Recreate:{let g=o.obj;$B(i,g,m,d,e.parent.globalContext);let y=await uue(e,o,i.transformer,u,h);return Q9(y,i),o.obj=y,{ref:t,action:"replaced",oldObj:g,obj:y}}case et.UpdateResult.Updated:return Q9(o.obj,i),{ref:t,action:"updated",oldData:p,obj:o.obj};case et.UpdateResult.Null:return $B(i,o.obj,m,d,e.parent.globalContext),o.obj=Gn.Null,{ref:t,action:"updated",obj:o.obj};default:return{action:"none"}}}}function $B(e,t,r,n,o){e.transformer.definition.dispose?.({b:t!==Gn.Null?t:void 0,params:r,cache:n},o)}function Q9(e,t){!e||e===Gn.Null||(e.tags=t.tags)}function q9(e,t){return typeof e.runInContext=="function"?e.runInContext(t):e}function due(e){if(e.dependencies.dependsOn.length===0)return;let t=Object.create(null);for(let r of e.dependencies.dependsOn){if(!r.obj)throw new Error("Unresolved dependency.");t[r.transform.ref]=r.obj}return t}function uue(e,t,r,n,o){return t.cache||(t.cache=Object.create(null)),q9(r.definition.apply({a:n,params:o,cache:t.cache,spine:e.spine,dependencies:due(t)},e.parent.globalContext),e.taskCtx)}async function Aze(e,t,r,n,o,i,a){return r.definition.update?(t.cache||(t.cache=Object.create(null)),q9(r.definition.update({a:n,oldParams:i,b:o,newParams:a,cache:t.cache,spine:e.spine,dependencies:due(t)},e.parent.globalContext),e.taskCtx)):et.UpdateResult.Recreate}var ne;(d=>{d.Create=Gn.factory();function t(p){return!!p&&p.type.typeClass==="Representation3D"}d.isRepresentation3D=t;function r(p){return!!p&&p.type.typeClass==="Behavior"}d.isBehavior=r;function n(p){return(0,d.Create)({...p,typeClass:"Representation3D"})}d.CreateRepresentation3D=n;function o(p){return(0,d.Create)({...p,typeClass:"Behavior"})}d.CreateBehavior=o;class i extends(0,d.Create)({name:"Root",typeClass:"Root"}){}d.Root=i;class a extends(0,d.Create)({name:"Group",typeClass:"Group"}){}d.Group=a;let s;(g=>{class p extends(0,d.Create)({name:"String Data",typeClass:"Data"}){}g.String=p;class h extends(0,d.Create)({name:"Binary Data",typeClass:"Data"}){}g.Binary=h;class f extends(0,d.Create)({name:"Data Blob",typeClass:"Data"}){}g.Blob=f})(s=d.Data||={});let l;(T=>{class p extends(0,d.Create)({name:"JSON Data",typeClass:"Data"}){}T.Json=p;class h extends(0,d.Create)({name:"CIF File",typeClass:"Data"}){}T.Cif=h;class f extends(0,d.Create)({name:"Cube File",typeClass:"Data"}){}T.Cube=f;class g extends(0,d.Create)({name:"PSF File",typeClass:"Data"}){}T.Psf=g;class y extends(0,d.Create)({name:"PRMTOP File",typeClass:"Data"}){}T.Prmtop=y;class x extends(0,d.Create)({name:"TOP File",typeClass:"Data"}){}T.Top=x;class S extends(0,d.Create)({name:"PLY File",typeClass:"Data"}){}T.Ply=S;class I extends(0,d.Create)({name:"CCP4/MRC/MAP File",typeClass:"Data"}){}T.Ccp4=I;class v extends(0,d.Create)({name:"DSN6/BRIX File",typeClass:"Data"}){}T.Dsn6=v;class A extends(0,d.Create)({name:"DX File",typeClass:"Data"}){}T.Dx=A;class P extends(0,d.Create)({name:"Format Blob",typeClass:"Data"}){}T.Blob=P})(l=d.Format||={});let u;(x=>{class p extends(0,d.Create)({name:"Coordinates",typeClass:"Object"}){}x.Coordinates=p;class h extends(0,d.Create)({name:"Topology",typeClass:"Object"}){}x.Topology=h;class f extends(0,d.Create)({name:"Model",typeClass:"Object"}){}x.Model=f;class g extends(0,d.Create)({name:"Trajectory",typeClass:"Object"}){}x.Trajectory=g;class y extends(0,d.Create)({name:"Structure",typeClass:"Object"}){}x.Structure=y,(A=>{class S extends n({name:"Structure 3D"}){}A.Representation3D=S;class I extends(0,d.Create)({name:"Structure 3D State",typeClass:"Object"}){}A.Representation3DState=I;class v extends(0,d.Create)({name:"Selections",typeClass:"Object"}){}A.Selections=v})(y=x.Structure||={})})(u=d.Molecule||={});let c;(g=>{class p extends(0,d.Create)({name:"Volume",typeClass:"Object"}){}g.Data=p;class h extends(0,d.Create)({name:"Lazy Volume",typeClass:"Object"}){}g.Lazy=h;class f extends n({name:"Volume 3D"}){}g.Representation3D=f})(c=d.Volume||={});let m;(f=>{class p extends(0,d.Create)({name:"Shape Provider",typeClass:"Object"}){}f.Provider=p;class h extends n({name:"Shape 3D"}){}f.Representation3D=h})(m=d.Shape||={})})(ne||={});var Vt;(r=>(r.CreateBuiltIn=et.factory("ms-plugin"),r.BuiltIn=et.builderFactory("ms-plugin")))(Vt||={});var Kr;(m=>{class e extends ne.Create({name:"Root",typeClass:"Root"}){}m.Root=e;class t extends ne.Create({name:"Category",typeClass:"Object"}){}m.Category=t;class r extends ne.CreateBehavior({name:"Behavior"}){}m.Behavior=r,m.Categories={common:"Common",representation:"Representation",interaction:"Interaction","custom-props":"Custom Properties",misc:"Miscellaneous"},m.CreateCategory=Vt.BuiltIn({name:"create-behavior-category",display:{name:"Behavior Category"},from:e,to:t,params:{label:C.Text("",{isHidden:!0})}})({apply({params:d}){return new t({},{label:d.label})}});let i=new Map;function a(d){return i.get(d.id)}m.getCategoryId=a;function s(d){let p=Vt.CreateBuiltIn({name:d.name,display:d.display,from:[e],to:[r],params:d.params,apply({params:h},f){let g=d.label?d.label(h):{label:d.display.name,description:d.display.description};return new r(new d.ctor(f,h),g)},update({b:h,newParams:f}){return Ae.create("Update Behavior",async()=>h.data.update?await h.data.update(f)?et.UpdateResult.Updated:et.UpdateResult.Unchanged:et.UpdateResult.Unchanged)},canAutoUpdate:d.canAutoUpdate});return i.set(p.id,d.category),p}m.create=s;function l(d,p){return class{constructor(h){this.ctx=h;this.sub=void 0}register(){this.sub=d.subscribe(this.ctx,h=>p(h,this.ctx))}dispose(){this.sub&&this.sub.unsubscribe(),this.sub=void 0}}}m.simpleCommandHandler=l;class u{constructor(p,h){this.ctx=p;this.params=h;this.subs=[]}subscribeCommand(p,h){this.subs.push(p.subscribe(this.ctx,h))}subscribeObservable(p,h){this.subs.push(p.subscribe(h))}track(p){this.subs.push(p)}dispose(){for(let p of this.subs)p.unsubscribe();this.subs=[]}update(p){return Gh(p,this.params)?!1:(this.params=p,!0)}}m.Handler=u;class c{constructor(p,h){this.plugin=p;this.params=h;this.subs=[]}subscribeCommand(p,h){this.subs.push(p.subscribe(this.plugin,h))}subscribeObservable(p,h){let f=p.subscribe(h);return this.subs.push(f),{unsubscribe:()=>{let g=this.subs.indexOf(f);g>=0&&(this.subs.splice(g,1),f.unsubscribe())}}}dispose(){for(let p of this.subs)p.unsubscribe();this.subs=[]}}m.WithSubscribers=c})(Kr||={});async function pue(e){let t=e.name.toLowerCase()||"file",r=["jpg","jpeg","png","gif","webp"].some(l=>t.endsWith(`.${l}`)),n=["mp3","wav","ogg"].some(l=>t.endsWith(`.${l}`)),o="application/octet-stream";if(r){let l=t.split(".").pop()?.toLowerCase();l==="jpg"?o="image/jpeg":o=`image/${l}`}else if(n){let l=t.split(".").pop()?.toLowerCase();l==="mp3"?o="audio/mpeg":o=`audio/${l}`}let i=await e.arrayBuffer(),a=new FileReader;return a.readAsDataURL(new Blob([i],{type:o})),await new Promise((l,u)=>{a.onload=()=>l(a.result),a.onerror=()=>u(a.error)})}var Uf=ye.Empty,xue=ye.ofSingleton,Cue=ye.ofRange,Sue=ye.ofBounds;function dp(e){return e.length?Be.isRange(e)?ye.ofRange(e[0],e[e.length-1]):e:Uf}function jy(e){return ye.is(e)?ye.size(e):Be.size(e)}function vue(e,t){return ye.is(e)?ye.has(e,t):Be.has(e,t)}function Iue(e,t){return ye.is(e)?ye.indexOf(e,t):Be.indexOf(e,t)}function tE(e,t){return ye.is(e)?ye.getAt(e,t):e[t]}function AS(e){return ye.is(e)?ye.min(e):Be.min(e)}function TS(e){return ye.is(e)?ye.max(e):Be.max(e)}function Aue(e){return ye.is(e)?ye.start(e):Be.start(e)}function Tue(e){return ye.is(e)?ye.end(e):Be.end(e)}function Pue(e){return jy(e)===0}function _ue(e){return ye.is(e)?ye.hashCode(e):Be.hashCode(e)}function Rue(e){return ye.is(e)?ye.toString(e):Be.toString(e)}function Due(e,t){return ye.is(e)?ye.is(t)?ye.areEqual(e,t):fue(e,t):ye.is(t)?fue(t,e):Be.areEqual(e,t)}function wue(e,t){return ye.is(e)?ye.is(t)?ye.areIntersecting(e,t):hue(t,e):ye.is(t)?hue(e,t):Be.areIntersecting(e,t)}function Mue(e,t){return ye.is(e)?ye.is(t)?ye.isSubInterval(e,t):Pze(e,t):ye.is(t)?Tze(e,t):Be.isSubset(e,t)}function Bue(e,t){return ye.is(e)?ye.findPredecessorIndex(e,t):Be.findPredecessorIndex(e,t)}function Eue(e,t,r){return ye.is(e)?ye.findPredecessorIndexInInterval(e,t,r):Be.findPredecessorIndexInInterval(e,t,r)}function kue(e,t,r){return ye.is(e)?ye.findRange(e,t,r):Be.findRange(e,t,r)}function Fue(e,t){return ye.is(e)?ye.is(t)?ye.intersectionSize(e,t):yue(t,e):ye.is(t)?yue(e,t):Be.intersectionSize(e,t)}function Lue(e,t){return ye.is(e)?ye.is(t)?Dze(e,t):gue(t,e):ye.is(t)?gue(e,t):dp(Be.union(e,t))}function Vue(e,t){return ye.is(e)?ye.is(t)?ye.intersect(e,t):bue(t,e):ye.is(t)?bue(e,t):dp(Be.intersect(e,t))}function Oue(e,t){return ye.is(e)?ye.is(t)?wze(e,t):Bze(e,t):ye.is(t)?Mze(e,t):dp(Be.subtract(e,t))}function fue(e,t){return ye.size(e)===Be.size(t)&&ye.start(e)===Be.start(t)&&ye.end(e)===Be.end(t)}function hue(e,t){return e.length!==0&&ye.size(Be.findRange(e,ye.min(t),ye.max(t)))!==0}function Tze(e,t){let r=ye.min(t),n=ye.max(t);if(n-r+1===0)return!0;let o=Be.min(e),i=Be.max(e);if(r<o||n>i)return!1;let a=Be.findRange(e,r,n);return ye.size(a)===ye.size(t)}function Pze(e,t){let r=ye.min(e),n=ye.max(e);if(n-r+1===0)return!1;let o=Be.min(t),i=Be.max(t);return o>=r&&i<=n}function _ze(e,t){let r=jy(e),n=jy(t);return r===0&&n===0?!0:r>0&&n>0&&TS(e)>=AS(t)&&AS(e)<=TS(t)}function Rze(e,t){return jy(e)?jy(t)?AS(e)<=AS(t)&&TS(e)>=TS(t):!0:jy(t)===0}function Dze(e,t){if(ye.areEqual(e,t))return e;let r=ye.size(e),n=ye.size(t);if(!n)return e;if(!r)return t;let o=ye.min(e),i=ye.min(t);if(_ze(e,t))return ye.ofRange(Math.min(o,i),Math.max(ye.max(e),ye.max(t)));let a,s,l,u;o<i?(a=r,s=o,l=n,u=i):(a=n,s=i,l=r,u=o);let c=new Int32Array(r+n);for(let m=0;m<a;m++)c[m]=m+s;for(let m=0;m<l;m++)c[m+a]=m+u;return dp(c)}function gue(e,t){let r=ye.size(t);if(!r)return e;if(Rze(t,e))return t;let n=ye.min(t),o=ye.max(t),i=Be.findRange(e,n,o),a=ye.start(i),s=ye.end(i),l=new Int32Array(a+(e.length-s)+r),u=0;for(let c=0;c<a;c++)l[u++]=e[c];for(let c=n;c<=o;c++)l[u++]=c;for(let c=s,m=e.length;c<m;c++)l[u++]=e[c];return dp(l)}function yue(e,t){if(!ye.size(t))return 0;let r=Be.findRange(e,ye.min(t),ye.max(t));return ye.end(r)-ye.start(r)}function bue(e,t){if(!ye.size(t))return Uf;let r=Be.findRange(e,ye.min(t),ye.max(t)),n=ye.start(r),o=ye.end(r),i=o-n;if(!i)return Uf;if(i===e.length)return e;let a=new Int32Array(i),s=0;for(let l=n;l<o;l++)a[s++]=e[l];return dp(a)}function wze(e,t){if(ye.areEqual(e,t))return Uf;if(!ye.areIntersecting(e,t))return e;let r=ye.min(e),n=ye.max(e),o=ye.min(t),i=ye.max(t);if(n<r||i<o)return e;if(ye.isSubInterval(t,e))return Uf;if(ye.isSubInterval(e,t)){let a=o-r,s=n-i;if(a<=0)return ye.ofRange(i+1,i+s);if(s<=0)return ye.ofRange(r,r+a-1);let l=new Int32Array(a+s),u=0;for(let c=0;c<a;c++)l[u++]=r+c;for(let c=1;c<=s;c++)l[u++]=i+c;return dp(l)}return r<o?ye.ofRange(r,o-1):ye.ofRange(i+1,n)}function Mze(e,t){let r=ye.min(t),n=ye.max(t);if(n<r)return e;let o=Be.findRange(e,r,n),i=ye.start(o),a=ye.end(o),s=e.length-(a-i);if(s<=0)return Uf;if(s===e.length)return e;let l=new Int32Array(s),u=0;for(let c=0;c<i;c++)l[u++]=e[c];for(let c=a,m=e.length;c<m;c++)l[u++]=e[c];return dp(l)}function Bze(e,t){let r=ye.min(e),n=ye.max(e);if(n<r)return e;let o=n-r+1,i=Be.findRange(t,r,n),a=ye.start(i),s=ye.end(i),l=s-a;if(l===0)return e;let u=o-l;if(u<=0)return Uf;let c=new Int32Array(u),m=t.length-1,d=t[Math.min(a,m)],p=t[Math.min(s,m)],h=0;for(let f=r;f<d;f++)c[h++]=f;for(let f=d;f<=p;f++)Be.indexOfInInterval(t,f,i)<0&&(c[h++]=f);for(let f=p+1;f<=n;f++)c[h++]=f;return dp(c)}function Gue(e,t,r){if(ye.is(e)){let n=ye.min(e);for(let o=n,i=ye.max(e);o<=i;o++)t(o,o-n,r)}else for(let n=0,o=e.length;n<o;n++)t(e[n],n,r);return r}function Uue(e,t,r,n){if(ye.is(e)){let o=0;for(let i=ye.min(e),a=ye.max(e);i<=a;i++){let s=t(i),l=i+1;for(;l<a&&t(l)===s;)l++;i=l-1,r(s,o,n),o++}}else{let o=0;for(let i=0,a=e.length;i<a;i++){let s=t(e[i]),l=i+1;for(;l<a&&t(e[l])===s;)l++;i=l-1,r(s,o,n),o++}}return n}function Nue(e,t,r){if(t===r)return e;let n=jy(e),o=t.length,i=r.length;if(n===0||o===0||i===0)return Uf;let a=Be.findPredecessorIndex(r,t[AS(e)]),s=Be.findPredecessorIndex(r,t[TS(e)]+1),l=0,u=0,c=0,m=a;for(;c<n&&m<s;){let p=t[tE(e,c)],h=r[m];p<h?c++:(p>h||(l++,c++),m++)}if(l===0)return Uf;if(l===o&&l===i)return e;let d=new Int32Array(l);for(u=0,c=0,m=a;c<n&&m<s;){let p=t[tE(e,c)],h=r[m];p<h?c++:(p>h||(d[u++]=m,c++),m++)}return dp(d)}var xe;(F=>{F.Empty=Uf,F.ofSingleton=xue,F.ofRange=Cue,F.ofBounds=Sue,F.ofSortedArray=dp,F.has=vue,F.indexOf=Iue,F.getAt=tE,F.isEmpty=Pue,F.min=AS,F.max=TS,F.start=Aue,F.end=Tue,F.size=jy,F.hashCode=_ue,F.areEqual=Due,F.areIntersecting=wue,F.isSubset=Mue,F.union=Lue,F.intersect=Vue,F.indexedIntersect=Nue,F.subtract=Oue,F.findPredecessorIndex=Bue,F.findPredecessorIndexInInterval=Eue,F.findRange=kue,F.intersectionSize=Fue;function w(z,j,Y){return Gue(z,j,Y)}F.forEach=w;function E(z,j,Y,G){return Uue(z,j,Y,G)}F.forEachSegment=E;function M(z){return ye.is(z)}F.isInterval=M;function D(z){return!ye.is(z)}F.isSortedArray=D;function B(z){let j=[];return F.forEach(z,Y=>j.push(Y)),j}F.toArray=B;function k(z){return Rue(z)}F.toString=k})(xe||={});function K9(e){let t=Be.ofSortedArray(e),r=Be.max(t),n=new Int32Array(r);for(let o=0,i=e.length-1;o<i;o++)for(let a=e[o],s=e[o+1];a<s;a++)n[a]=o;return{offsets:t,index:n,count:e.length-1}}function zue(e,t){let r=ye.start(t),n=new Int32Array(e.length+1);for(let o=0,i=e.length;o<i;o++)n[o]=e[o]-r;return n[e.length]=ye.end(t)-r,K9(n)}function Hue({count:e}){return e}function jue({index:e},t){return e[t]}function Wue({offsets:e},t,r){let n=xe.max(e),o=r>=n?-1:xe.findPredecessorIndex(e,r-1);return xe.findRange(t,xe.getAt(e,o),xe.getAt(e,o+1)-1)}var Y9=class{constructor(t,r,n,o){this.segments=t;this.segmentMap=r;this.set=n;this.segmentMin=0;this.segmentMax=0;this.setRange=ye.Empty;this.value={index:0,start:0,end:0};this.hasNext=!1;this.setRange=o,this.updateSegmentRange()}move(){for(;this.hasNext;)if(this.updateValue()){this.value.index=this.segmentMin++,this.hasNext=this.segmentMax>=this.segmentMin&&ye.size(this.setRange)>0;break}else this.updateSegmentRange();return this.value}updateValue(){let t=this.segments[this.segmentMin+1],r=xe.findPredecessorIndexInInterval(this.set,t,this.setRange);return this.value.start=ye.start(this.setRange),this.value.end=r,this.setRange=ye.ofBounds(r,ye.end(this.setRange)),r>this.value.start}updateSegmentRange(){let t=ye.min(this.setRange),r=ye.max(this.setRange);if(r<t){this.hasNext=!1;return}this.segmentMin=this.segmentMap[xe.getAt(this.set,t)],this.segmentMax=this.segmentMap[xe.getAt(this.set,r)],this.hasNext=this.segmentMax>=this.segmentMin}setSegment(t){this.setRange=ye.ofBounds(t.start,t.end),this.updateSegmentRange()}};function Xue(e,t,r){let n=typeof r<"u"?ye.ofBounds(r.start,r.end):ye.ofBounds(0,xe.size(t));return new Y9(e.offsets,e.index,t,n)}var Kt;(a=>(a.create=K9,a.ofOffsets=zue,a.count=Hue,a.getSegment=jue,a.projectValue=Wue,a.transientSegments=Xue))(Kt||={});function $9(e){return new J9(e)}var J9=class{remove(t){let{prev:r,next:n}=this,o=r[t],i=n[t];o>=0&&(n[o]=i,r[t]=-1),i>=0&&(r[i]=o,n[t]=-1),t===this.head&&(o<0?this.head=i:this.head=o)}has(t){return this.prev[t]>=0||this.next[t]>=0||this.head===t}constructor(t){this.head=t>0?0:-1,this.prev=new Int32Array(t),this.next=new Int32Array(t);for(let r=0;r<t;r++)this.next[r]=r+1,this.prev[r]=r-1;this.prev[0]=-1,this.next[t-1]=-1}};var Mu;(a=>{a.Empty=new Map;function t(s){return Vv(s.keys())}a.keyArray=t;function r(){return new Map}a.Mutable=r;function n(s){return s}a.asImmutable=n;function o(s){let l=r(),u=s.keys();for(;;){let{done:c,value:m}=u.next();if(c)break;l.set(m,s.get(m))}return l}a.copy=o;function i(s,l){let u=l.keys();for(;;){let{done:c,value:m}=u.next();if(c)break;s.set(m,l.get(m))}return s}a.addFrom=i})(Mu||={});var e6=class{constructor(t){this.xs=[];this.index=-1;this.length=0;this.hasNext=!1;this.length=t.length,this.hasNext=t.length>0,this.xs=t,this.index=-1,this.lastValue=t.length>0?t[0]:void 0}move(){return++this.index,this.lastValue=this.xs[this.index],this.hasNext=this.index<this.length-1,this.lastValue}},rE=class{constructor(t,r){this.max=r;this.value=0;this.hasNext=!1;this.value=t-1,this.hasNext=r>=t}move(){return++this.value,this.hasNext=this.value<this.max,this.value}},t6=class{constructor(t){this.value=t;this.hasNext=!0}move(){return this.hasNext=!1,this.value}},r6=class{constructor(t,r){this.base=t;this.f=r;this.hasNext=!1;this.hasNext=t.hasNext}move(){let t=this.f(this.base.move());return this.hasNext=this.base.hasNext,t}},n6=class{constructor(t,r){this.base=t;this.p=r;this.hasNext=this.findNext()}move(){let t=this.next;return this.hasNext=this.findNext(),t}findNext(){for(;this.base.hasNext;)if(this.next=this.base.move(),this.p(this.next))return!0;return!1}},PS;(s=>{s.Empty=new rE(0,-1);function t(l){return new e6(l)}s.Array=t;function r(l){return new t6(l)}s.Value=r;function n(l,u){return new rE(l,u)}s.Range=n;function o(l,u){return new r6(l,u)}s.map=o;function i(l,u){return new n6(l,u)}s.filter=i;function a(l,u,c){for(;l.hasNext;)if(u(l.move(),c))return c;return c}s.forEach=a})(PS||={});var ki={};Gi(ki,{createAndFillArray:()=>Lze,createArray:()=>_S,fillArrayValues:()=>Que,getArrayBounds:()=>Kx,isTypedArray:()=>nE,typedArrayWindow:()=>oE});function Kx(e,t){let r=t&&typeof t.start<"u"?Math.max(Math.min(t.start,e-1),0):0,n=t&&typeof t.end<"u"?Math.min(t.end,e):e;return{start:r,end:n}}function _S(e,t){let r=t&&typeof t.array<"u"?t.array:Array,{start:n,end:o}=Kx(e,t);return{array:new r(o-n),start:n,end:o}}function Que(e,t,r){for(let n=0,o=t.length;n<o;n++)t[n]=e(r+n);return t}function Lze(e,t,r){let{array:n,start:o}=_S(e,r);return Que(t,n,o)}function nE(e){return!!e.buffer&&typeof e.byteLength=="number"&&typeof e.BYTES_PER_ELEMENT=="number"}function oE(e,t){let{constructor:r,buffer:n,length:o,byteOffset:i,BYTES_PER_ELEMENT:a}=e,{start:s,end:l}=Kx(o,t);return s===0&&l===o?e:new r(n,i+a*s,Math.min(o,l-s))}var Dr;(I=>{function e(v,A,P){let T=[];for(let w=0;w<A.length;w++)T[w]=A[A.length-w-1];let R=[1];for(let w=1;w<v.length;w++)R[w]=v[T[w-1]];return{dimensions:v,axisOrderFastToSlow:T,axisOrderSlowToFast:A,accessDimensions:R,defaultCtor:P||Float64Array}}function t(v,A){return{space:v,data:A}}I.create=t;function r(v,A,P){let T=e(v,A,P),{get:R,set:w,add:E,dataOffset:M,getCoords:D}=d(T);return{rank:v.length,dimensions:v,axisOrderSlowToFast:A,create:p(T),get:R,set:w,add:E,dataOffset:M,getCoords:D}}I.Space=r;function n(v){return v}I.Data1=n;function o(v,A){return r([v],[0],A)}I.Vector=o;function i(v,A,P){return r([v,A],[1,0],P)}I.ColumnMajorMatrix=i;function a(v,A,P){return r([v,A],[0,1],P)}I.RowMajorMatrix=a;function s(v,A,P){if(A.rank!==2)throw new Error("Invalid tensor rank");let T=Math.min(4,A.dimensions[0]),R=Math.min(4,A.dimensions[1]);for(let w=0;w<T;w++)for(let E=0;E<R;E++)H.setValue(v,w,E,A.get(P,w,E));return v}I.toMat4=s;function l(v,A,P){if(A.rank!==2)throw new Error("Invalid tensor rank");let T=Math.min(3,A.dimensions[0]),R=Math.min(3,A.dimensions[1]);for(let w=0;w<T;w++)for(let E=0;E<R;E++)Mt.setValue(v,w,E,A.get(P,w,E));return v}I.toMat3=l;function u(v,A,P){if(A.rank!==1)throw new Error("Invalid tensor rank");let T=Math.min(3,A.dimensions[0]);for(let R=0;R<T;R++)v[R]=P[R];return v}I.toVec3=u;function c(v,A,P){if(A.rank!==1)throw new Error("Invalid tensor rank");let T=Math.min(4,A.dimensions[0]);for(let R=0;R<T;R++)v[R]=P[R];return v}I.toVec4=c;function m(v,A){let P=v.length;if(P!==A.length)return!1;for(let T=0;T<P;T++)if(v[T]!==A[T])return!1;return!0}I.areEqualExact=m;function d(v){let{dimensions:A,axisOrderFastToSlow:P}=v;switch(A.length){case 1:return{get:(T,R)=>T[R],set:(T,R,w)=>T[R]=w,add:(T,R,w)=>T[R]+=w,dataOffset:T=>T,getCoords:(T,R)=>(R[0]=T,R)};case 2:{if(P[0]===0&&P[1]===1){let T=A[0];return{get:(R,w,E)=>R[E*T+w],set:(R,w,E,M)=>R[E*T+w]=M,add:(R,w,E,M)=>R[E*T+w]+=M,dataOffset:(R,w)=>w*T+R,getCoords:(R,w)=>(w[0]=R%T,w[1]=Math.floor(R/T),w)}}if(P[0]===1&&P[1]===0){let T=A[1];return{get:(R,w,E)=>R[w*T+E],set:(R,w,E,M)=>R[w*T+E]=M,add:(R,w,E,M)=>R[w*T+E]+=M,dataOffset:(R,w)=>R*T+w,getCoords:(R,w)=>(w[0]=Math.floor(R/T),w[1]=R%T,w)}}throw new Error("bad axis order")}case 3:{if(P[0]===0&&P[1]===1&&P[2]===2){let T=A[0],R=A[1],w=T*R;return{get:(E,M,D,B)=>E[M+D*T+B*w],set:(E,M,D,B,k)=>E[M+D*T+B*w]=k,add:(E,M,D,B,k)=>E[M+D*T+B*w]+=k,dataOffset:(E,M,D)=>E+M*T+D*w,getCoords:(E,M)=>{let D=Math.floor(E/T);return M[0]=E%T,M[1]=D%R,M[2]=Math.floor(D/R),M}}}if(P[0]===0&&P[1]===2&&P[2]===1){let T=A[0],R=A[2],w=T*R;return{get:(E,M,D,B)=>E[M+B*T+D*w],set:(E,M,D,B,k)=>E[M+B*T+D*w]=k,add:(E,M,D,B,k)=>E[M+B*T+D*w]+=k,dataOffset:(E,M,D)=>E+D*T+M*w,getCoords:(E,M)=>{let D=Math.floor(E/T);return M[0]=E%T,M[1]=Math.floor(D/R),M[2]=D%R,M}}}if(P[0]===1&&P[1]===0&&P[2]===2){let T=A[1],R=A[0],w=T*R;return{get:(E,M,D,B)=>E[D+M*T+B*w],set:(E,M,D,B,k)=>E[D+M*T+B*w]=k,add:(E,M,D,B,k)=>E[D+M*T+B*w]+=k,dataOffset:(E,M,D)=>M+E*T+D*w,getCoords:(E,M)=>{let D=Math.floor(E/T);return M[0]=D%R,M[1]=E%T,M[2]=Math.floor(D/R),M}}}if(P[0]===1&&P[1]===2&&P[2]===0){let T=A[1],R=A[2],w=T*R;return{get:(E,M,D,B)=>E[D+B*T+M*w],set:(E,M,D,B,k)=>E[D+B*T+M*w]=k,add:(E,M,D,B,k)=>E[D+B*T+M*w]+=k,dataOffset:(E,M,D)=>M+D*T+E*w,getCoords:(E,M)=>{let D=Math.floor(E/T);return M[0]=Math.floor(D/R),M[1]=E%T,M[2]=D%R,M}}}if(P[0]===2&&P[1]===0&&P[2]===1){let T=A[2],R=A[0],w=T*R;return{get:(E,M,D,B)=>E[B+M*T+D*w],set:(E,M,D,B,k)=>E[B+M*T+D*w]=k,add:(E,M,D,B,k)=>E[B+M*T+D*w]+=k,dataOffset:(E,M,D)=>D+E*T+M*w,getCoords:(E,M)=>{let D=Math.floor(E/T);return M[0]=D%R,M[1]=Math.floor(D/R),M[2]=E%T,M}}}if(P[0]===2&&P[1]===1&&P[2]===0){let T=A[2],R=A[1],w=T*R;return{get:(E,M,D,B)=>E[B+D*T+M*w],set:(E,M,D,B,k)=>E[B+D*T+M*w]=k,add:(E,M,D,B,k)=>E[B+D*T+M*w]+=k,dataOffset:(E,M,D)=>D+M*T+E*w,getCoords:(E,M)=>{let D=Math.floor(E/T);return M[0]=Math.floor(D/R),M[1]=D%R,M[2]=E%T,M}}}throw new Error("bad axis order")}default:return{get:(T,...R)=>T[h(v,R)],set:(T,...R)=>T[h(v,R)]=R[R.length-1],add:(T,...R)=>T[h(v,R)]+=R[R.length-1],dataOffset:(...T)=>h(v,T),getCoords:(T,R)=>f(v,T,R)}}}function p(v){let{dimensions:A}=v,P=1;for(let T=0,R=A.length;T<R;T++)P*=A[T];return T=>new(T||v.defaultCtor)(P)}function h(v,A){let{accessDimensions:P,axisOrderFastToSlow:T}=v,R=P.length-1,w=P[R]*A[T[R]];for(let E=R-1;E>=0;E--)w=(w+A[T[E]])*P[E];return w}function f(v,A,P){let{dimensions:T,axisOrderFastToSlow:R}=v,w=T.length,E=A;for(let M=0;M<w;M++){let D=T[R[M]];P[R[M]]=E%D,E=Math.floor(E/D)}return P[R[w+1]]=E,P}function g(v){let A=[];for(let P=0;P<v.length;P++)A[P]=v[v.length-P-1];return A}I.invertAxisOrder=g;function y(v,A){let P=[];for(let T=0;T<v.length;T++)P[T]=v[A[T]];return P}function x(v){let A=new Int32Array(v.length);for(let P=0;P<v.length;P++)A[v[P]]=P;return P=>y(P,A)}I.convertToCanonicalAxisIndicesFastToSlow=x;function S(v){let A=new Int32Array(v.length);for(let P=0;P<v.length;P++)A[v[v.length-P-1]]=P;return P=>y(P,A)}I.convertToCanonicalAxisIndicesSlowToFast=S})(Dr||={});function Wy(e,t,r){for(;t<r&&e.charCodeAt(t)===32;)t++;return pp(e,t,r)}function pp(e,t,r){let n=t,o=0,i=1;for(e.charCodeAt(n)===45?(i=-1,++n):e.charCodeAt(n)===43&&++n;n<r;n++){let a=e.charCodeAt(n)-48;if(a>9||a<0)return i*o|0;o=10*o+a|0}return i*o}function Zue(e,t,r,n){return t.charCodeAt(r)===43&&r++,e*Math.pow(10,pp(t,r,n))}function que(e,t,r){for(;t<r&&e.charCodeAt(t)===32;)t++;return Nc(e,t,r)}function Nc(e,t,r){let n=t,o=1,i=0,a=0,s=1;for(e.charCodeAt(n)===45?(o=-1,++n):e.charCodeAt(n)===43&&++n;n<r;){let l=e.charCodeAt(n)-48;if(l>=0&&l<10)i=i*10+l,++n;else if(l===-2){for(++n;n<r;)if(l=e.charCodeAt(n)-48,l>=0&&l<10)a=10*a+l,s=10*s,++n;else return l===53||l===21?Zue(o*(i+a/s),e,n+1,r):o*(i+a/s);return o*(i+a/s)}else{if(l===53||l===21)return Zue(o*i,e,n+1,r);break}}return o*i}var W;(E=>{let e;(J=>{J.str={"@type":"str",T:"",valueType:"str"},J.ustr={"@type":"str",T:"",valueType:"str",transform:"uppercase"},J.lstr={"@type":"str",T:"",valueType:"str",transform:"lowercase"},J.int={"@type":"int",T:0,valueType:"int"},J.coord={"@type":"coord",T:0,valueType:"float"},J.float={"@type":"float",T:0,valueType:"float"};function j(ee){return{"@type":"str",T:ee?.defaultValue??"",transform:ee?.transform,valueType:"str"}}J.Str=j;function Y(ee=0){return{"@type":"int",T:ee,valueType:"int"}}J.Int=Y;function G(ee=0){return{"@type":"float",T:ee,valueType:"float"}}J.Float=G;function X(ee,ce=J.float){return{"@type":"tensor",T:ee.create(),space:ee,valueType:"tensor",baseType:ce}}J.Tensor=X;function U(ee,ce=J.float){return X(Dr.Vector(ee,ce["@type"]==="int"?Int32Array:Float64Array),ce)}J.Vector=U;function L(ee,ce,fe=J.float){return X(Dr.ColumnMajorMatrix(ee,ce,fe["@type"]==="int"?Int32Array:Float64Array),fe)}J.Matrix=L;function q(ee){return ee}J.Aliased=q;function te(ee,ce,fe=[]){return{"@type":"list",T:fe,separator:ee,itemParse:ce,valueType:"list"}}J.List=te})(e=E.Schema||={});function t(M){return!!M&&!!M.schema&&!!M.value}E.is=t;let r;(k=>(k[k.Present=0]="Present",k[k.NotPresent=1]="NotPresent",k[k.Unknown=2]="Unknown"))(r=E.ValueKinds||={}),E.ValueKind={Present:0,NotPresent:1,Unknown:2};function o(M,D){return Yue(D.T,M,D,1)}E.Undefined=o;function i(M,D,B){return Yue(M,D,B,0)}E.ofConst=i;function a(M){return iE(M)}E.ofLambda=a;function s(M,D){return a({value:B=>B+M,rowCount:Math.max(D-M+1,0),schema:e.int})}E.range=s;function l(M){return Xy(M)}E.ofArray=l;function u(M){return Xy({array:M,schema:e.int})}E.ofIntArray=u;function c(M){return Xy({array:M,schema:e.float})}E.ofFloatArray=c;function m(M){return Xy({array:M,schema:e.str})}E.ofStringArray=m;function d(M){return Xy({array:M,schema:e.Aliased(e.str)})}E.ofStringAliasArray=d;function p(M,D=","){return Xy({array:M,schema:e.List(D,B=>B)})}E.ofStringListArray=p;function h(M){let{count:D,data:B,indices:k}=M;return iE({value:F=>pp(B,k[2*F],k[2*F+1])||0,rowCount:D,schema:e.int})}E.ofIntTokens=h;function f(M){let{count:D,data:B,indices:k}=M;return iE({value:F=>Nc(B,k[2*F],k[2*F+1])||0,rowCount:D,schema:e.float})}E.ofFloatTokens=f;function g(M){let{count:D,data:B,indices:k}=M;return iE({value:F=>{let z=B.substring(k[2*F],k[2*F+1]);return z==="."||z==="?"?"":z},rowCount:D,schema:e.str})}E.ofStringTokens=g;function y(M,D,B){return Gze(M,D,B)}E.window=y;function x(M,D,B=!0){return Hze(M,D,B)}E.view=x;function S(M){return Vze(M)}E.createFirstIndexMap=S;function I(M){return Oze(M)}E.createIndexer=I;function v(M,D,B){return Xze(M,D,B||Array)}E.mapToArray=v;function A(M,D){return Qze(M,D)}E.areEqual=A;function P(M,D){return Yze(M,D)}E.indicesOf=P;function T(M,D){return M.__array?M:M.isDefined?Xy({array:M.toArray({array:D}),schema:M.schema,valueKind:M.valueKind}):o(M.rowCount,M.schema)}E.asArrayColumn=T;function R(M,D,B=0){if(!M.isDefined)return;let k=M.__array;if(k)for(let F=0,z=k.length;F<z;F++)D[B+F]=k[F];else for(let F=0,z=M.rowCount;F<z;F++)D[B+F]=M.value(F)}E.copyToArray=R;function w(M){for(let D=0,B=M.rowCount;D<B;D++)if(D!==M.value(D))return!1;return!0}E.isIdentity=w})(W||={});function Vze(e){let t=new Map;for(let r=0,n=e.rowCount;r<n;r++){let o=e.value(r);t.has(o)||t.set(e.value(r),r)}return t}function Oze(e){let t=new Map;for(let r=0,n=e.rowCount;r<n;r++){let o=e.value(r);t.has(o)||t.set(e.value(r),r)}return r=>t.has(r)?t.get(r):-1}function Yue(e,t,r,n){return{schema:r,__array:void 0,isDefined:n===0,rowCount:t,value:i=>e,valueKind:i=>n,toArray:i=>{let{array:a}=_S(t,i);for(let s=0,l=a.length;s<l;s++)a[s]=e;return a},areValuesEqual:(i,a)=>!0}}function iE({value:e,valueKind:t,areValuesEqual:r,rowCount:n,schema:o}){return{schema:o,__array:void 0,isDefined:!0,rowCount:n,value:e,valueKind:t||(i=>0),toArray:i=>{let{array:a,start:s}=_S(n,i);for(let l=0,u=a.length;l<u;l++)a[l]=e(l+s);return a},areValuesEqual:r||((i,a)=>e(i)===e(a))}}function Xy({array:e,schema:t,valueKind:r}){let n=e.length,o=t.T,i=t.valueType==="str"?t.transform==="lowercase"?s=>{let l=e[s];return typeof l=="string"?l.toLowerCase():`${l??o}`.toLowerCase()}:t.transform==="uppercase"?s=>{let l=e[s];return typeof l=="string"?l.toUpperCase():`${l??o}`.toUpperCase()}:s=>{let l=e[s];return typeof l=="string"?l:`${l??o}`}:s=>e[s],a=nE(e);return{schema:t,__array:e,isDefined:!0,rowCount:n,value:i,valueKind:r||(s=>0),toArray:t.valueType==="str"?t.transform==="lowercase"?s=>{let{start:l,end:u}=Kx(n,s),c=new(s&&typeof s.array<"u"?s.array:e.constructor)(u-l);for(let m=0,d=u-l;m<d;m++){let p=e[l+m];c[m]=typeof p=="string"?p.toLowerCase():`${p??o}`.toLowerCase()}return c}:t.transform==="uppercase"?s=>{let{start:l,end:u}=Kx(n,s),c=new(s&&typeof s.array<"u"?s.array:e.constructor)(u-l);for(let m=0,d=u-l;m<d;m++){let p=e[l+m];c[m]=typeof p=="string"?p.toUpperCase():`${p??o}`.toUpperCase()}return c}:s=>{let{start:l,end:u}=Kx(n,s),c=new(s&&typeof s.array<"u"?s.array:e.constructor)(u-l);for(let m=0,d=u-l;m<d;m++){let p=e[l+m];c[m]=typeof p=="string"?p:`${p??o}`}return c}:a?s=>oE(e,s):s=>{let{start:l,end:u}=Kx(n,s);if(l===0&&u===e.length)return e;let c=new(s&&typeof s.array<"u"?s.array:e.constructor)(u-l);for(let m=0,d=u-l;m<d;m++)c[m]=e[l+m];return c},areValuesEqual:(s,l)=>e[s]===e[l]}}function Gze(e,t,r){return e.isDefined?t===0&&r===e.rowCount?e:e.__array&&nE(e.__array)?Uze(e,t,r):Nze(e,t,r):W.Undefined(r-t,e.schema)}function Uze(e,t,r){let n=oE(e.__array,{start:t,end:r}),o=e.valueKind;return Xy({array:n,schema:e.schema,valueKind:i=>o(t+i)})}function Nze(e,t,r){let n=e.value,o=e.valueKind,i=e.areValuesEqual,a=t===0?n:l=>n(l+t),s=r-t;return{schema:e.schema,__array:void 0,isDefined:e.isDefined,rowCount:s,value:a,valueKind:t===0?o:l=>o(l+t),toArray:l=>{let{array:u}=_S(s,l);for(let c=0,m=u.length;c<m;c++)u[c]=n(c+t);return u},areValuesEqual:t===0?i:(l,u)=>i(l+t,u+t)}}function zze(e,t){if(e.length!==t)return!1;for(let r=0,n=e.length;r<n;r++)if(e[r]!==r)return!1;return!0}function Hze(e,t,r){return e.rowCount===0||r&&zze(t,e.rowCount)?e:e.__array&&typeof e.value(0)==typeof e.__array[0]?jze(e,t):Wze(e,t)}function jze(e,t){let r=e.__array,n=new r.constructor(t.length);for(let i=0,a=t.length;i<a;i++)n[i]=r[t[i]];let o=e.valueKind;return Xy({array:n,schema:e.schema,valueKind:i=>o(t[i])})}function Wze(e,t){let r=e.value,n=e.valueKind,o=e.areValuesEqual,i=s=>r(t[s]),a=t.length;return{schema:e.schema,__array:void 0,isDefined:e.isDefined,rowCount:a,value:i,valueKind:s=>n(t[s]),toArray:s=>{let{array:l}=_S(a,s);for(let u=0,c=l.length;u<c;u++)l[u]=r(t[u]);return l},areValuesEqual:(s,l)=>o(t[s],t[l])}}function Xze(e,t,r){let n=new r(e.rowCount);for(let o=0,i=e.rowCount;o<i;o++)n[o]=t(e.value(o));return n}function Qze(e,t){return e===t?!0:e.rowCount!==t.rowCount||e.isDefined!==t.isDefined||e.schema.valueType!==t.schema.valueType?!1:e.__array&&t.__array?Zze(e,t):qze(e,t)}function Zze(e,t){let r=e.__array,n=t.__array;for(let o=0,i=e.rowCount;o<i;o++)if(r[o]!==n[o])return!1;return!0}function qze(e,t){let r=e.value,n=t.value;for(let o=0,i=e.rowCount;o<i;o++)if(r(o)!==n(o))return!1;return!0}function Yze(e,t){let r=[],n=e.value;for(let o=0,i=e.rowCount;o<i;o++)t(n(o))&&(r[r.length]=o);return r}var wr;(S=>{function e(I){return I&&typeof I._rowCount=="number"&&!!I._columns&&!!I._schema}S.is=e;function t(I,v,A={}){let P=Object.create(null),T=Object.keys(I);P._rowCount=v._rowCount,P._columns=T,P._schema=I;for(let R of T)if(v[R])P[R]=v[R];else if(A[R])P[R]=A[R];else throw Error(`Cannot find column '${R}'.`);return P}S.pickColumns=t;function r(I,v){let A=Object.keys(v);return{_rowCount:v[A[0]].rowCount,_columns:A,_schema:I,...v}}S.ofColumns=r;function n(I,v,A){let P=Object.create(null),T=Object.keys(I);P._rowCount=A,P._columns=T,P._schema=I;for(let R of T)R in v?P[R]=v[R]:P[R]=W.Undefined(A,I[R]);return P}S.ofPartialColumns=n;function o(I,v){let A=Object.create(null),P=Object.keys(I);A._rowCount=v,A._columns=P,A._schema=I;for(let T of P)A[T]=W.Undefined(v,I[T]);return A}S.ofUndefinedColumns=o;function i(I,v){let A=Object.create(null),P=v.length,T=Object.keys(I);A._rowCount=P,A._columns=T,A._schema=I;for(let R of T)A[R]=W.ofLambda({rowCount:P,schema:I[R],value:w=>v[w][R],valueKind:w=>typeof v[w][R]>"u"?W.ValueKinds.NotPresent:W.ValueKinds.Present});return A}S.ofRows=i;function a(I,v){let A=Object.create(null),P=Object.keys(I);A._rowCount=0,A._columns=P,A._schema=I;for(let T of P)typeof v[T]<"u"?(A[T]=W.ofArray({array:v[T],schema:I[T]}),A._rowCount=v[T]?.length):A[T]=W.Undefined(A._rowCount,I[T]);return A}S.ofArrays=a;function s(I,v,A){let P=Object.create(null),T=Object.keys(v);P._rowCount=A.length,P._columns=T,P._schema=v;for(let R of T)P[R]=W.view(I[R],A);return P}S.view=s;function l(I,v,A){let P=[];for(let T=0,R=I._rowCount;T<R;++T)A(T)&&P.push(T);return s(I,v,P)}S.pick=l;function u(I,v,A,P){if(A===0&&P===I._rowCount)return I;let T=Object.create(null),R=Object.keys(v);T._rowCount=P-A,T._columns=R,T._schema=v;for(let w of R)T[w]=W.window(I[w],A,P);return T}S.window=u;function c(I,v){let A=Object.create(null),P=Object.keys(v);A._rowCount=0;for(let w of I)A._rowCount+=w._rowCount;let T={};for(let w of P)T[w]=new Array(A._rowCount);A._columns=P,A._schema=v;let R=0;for(let w of I){for(let E of P)W.copyToArray(w[E],T[E],R);R+=w._rowCount}for(let w of P)A[w]=W.ofArray({array:T[w],schema:v[w]});return A}S.concat=c;function m(I,v,A){I[v]=W.asArrayColumn(I[v],A)}S.columnToArray=m;function d(I,v){let A=new Int32Array(I._rowCount);for(let R=0,w=A.length;R<w;R++)A[R]=R;Js(A,(R,w,E)=>v(w,E));let P=!0;for(let R=0,w=A.length;R<w;R++)if(A[R]!==R){P=!1;break}if(P)return I;let T=Object.create(null);T._rowCount=I._rowCount,T._columns=I._columns,T._schema=I._schema;for(let R of I._columns)T[R]=W.view(I[R],A,!1);return T}S.sort=d;function p(I,v){if(I._rowCount!==v._rowCount||I._columns.length!==v._columns.length)return!1;for(let A of I._columns)if(!v[A])return!1;for(let A of I._columns)if(!W.areEqual(I[A],v[A]))return!1;return!0}S.areEqual=p;function h(I,v){let A=Object.create(null),{_columns:P}=I;for(let T=0;T<P.length;T++){let R=P[T];A[R]=I[R].value(v)}return A}S.getRow=h;function f(I,v){for(let A=0,P=I._rowCount;A<P;++A)if(v(A))return h(I,A)}S.pickRow=f;function g(I){let v=[],{_rowCount:A}=I;for(let P=0;P<A;P++)v[P]=h(I,P);return v}S.getRows=g;function y(I){let v={},{_columns:A}=I;for(let P=0;P<A.length;P++){let T=A[P];v[T]=I[T].toArray()}return v}S.toArrays=y;function x(I){let v=Yn.create(),{_columns:A,_rowCount:P}=I,T=1;Yn.write(v,"|");for(let R=0;R<A.length;R++)Yn.write(v,A[R]),Yn.write(v,"|"),T+=A[R].length+1;Yn.newline(v),Yn.write(v,new Array(T+1).join("-")),Yn.newline(v);for(let R=0;R<P;R++){Yn.write(v,"|");for(let w=0;w<A.length;w++){let E=I[A[w]];E.valueKind(R)===W.ValueKinds.Present?(Yn.write(v,E.value(R)),Yn.write(v,"|")):Yn.write(v,".|")}Yn.newline(v)}return Yn.getString(v)}S.formatToString=x})(wr||={});var aE;(r=>{function e(n,o,i){let a=Object.keys(i),s=Object.create(null),l=[];s._name=n,s._tableNames=l,s._schema=o;for(let u of a)wr.is(i[u])&&(s[u]=i[u],l[l.length]=u);return s}r.ofTables=e;function t(n){let o={};for(let i of n._tableNames)o[i]=wr.getRows(n[i]);return o}r.getTablesAsRows=t})(aE||={});function bs(e,t){return{value:e,unit:t}}var vd;(s=>{function e(l,u,c){let m=!!l[0].cell,d=!!l[0].velocities,p=!!l[0].forces;return{id:fn.create22(),frames:l,hasCell:m,hasVelocities:d,hasForces:p,deltaTime:u,timeOffset:c}}s.create=e;function t(l,u,c){let{x:m,y:d,z:p}=l;return l.xyzOrdering.frozen?c?l.xyzOrdering.isIdentity?(m=i(m,c),d=i(d,c),p=i(p,c)):Yi(l.xyzOrdering.index,c)||(m=o(m,l.xyzOrdering.index,c),d=o(d,l.xyzOrdering.index,c),p=o(p,l.xyzOrdering.index,c)):l.xyzOrdering.isIdentity||(m=a(m,l.xyzOrdering.index),d=a(d,l.xyzOrdering.index),p=a(p,l.xyzOrdering.index)):c&&(l.xyzOrdering.isIdentity?(l.xyzOrdering.isIdentity=!1,l.xyzOrdering.index=c,n(m,c),n(d,c),n(p,c)):Yi(l.xyzOrdering.index,c)||(m=o(m,l.xyzOrdering.index,c),d=o(d,l.xyzOrdering.index,c),p=o(p,l.xyzOrdering.index,c))),l.xyzOrdering.frozen=!0,{id:fn.create22(),atomId:u.atomId,occupancy:u.occupancy??W.ofConst(1,l.elementCount,W.Schema.int),B_iso_or_equiv:u.B_iso_or_equiv??W.ofConst(0,l.elementCount,W.Schema.float),xyzDefined:!0,x:m,y:d,z:p}}s.getAtomicConformation=t;let r=[.123];function n(l,u){let c=r;for(let m=0,d=l.length;m<d;m++)c[m]=l[u[m]];for(let m=0,d=l.length;m<d;m++)l[m]=c[m]}function o(l,u,c){let m=new Float32Array(l.length);for(let d=0,p=l.length;d<p;d++)m[d]=l[u[c[d]]];return m}function i(l,u){let c=new Float32Array(l.length);for(let m=0,d=l.length;m<d;m++)c[m]=l[u[m]];return c}function a(l,u){let c=new Float32Array(l.length);for(let m=0,d=l.length;m<d;m++)c[u[m]]=l[m];return c}})(vd||={});var RS;(t=>{function e(r,n,o,i){return{id:fn.create22(),label:r,basic:n,sourceData:i,bonds:o}}t.create=e})(RS||={});var Qy=W.Schema,se=Qy.str,ke=Qy.int,mn=Qy.float,o6=Qy.coord,Qt=Qy.Aliased,Jx=Qy.Matrix,sE=Qy.Vector,wo=Qy.lstr,DS=Qy.List,bn={atom_site:{auth_asym_id:se,auth_atom_id:se,auth_comp_id:se,auth_seq_id:ke,B_iso_or_equiv:mn,Cartn_x:o6,Cartn_y:o6,Cartn_z:o6,group_PDB:Qt(se),id:ke,label_alt_id:se,label_asym_id:se,label_atom_id:se,label_comp_id:se,label_entity_id:se,label_seq_id:ke,occupancy:mn,type_symbol:se,pdbx_PDB_ins_code:se,pdbx_PDB_model_num:ke,pdbx_formal_charge:ke,pdbx_label_index:ke,pdbx_sifts_xref_db_name:se,pdbx_sifts_xref_db_acc:se,pdbx_sifts_xref_db_num:se,pdbx_sifts_xref_db_res:se,ihm_model_id:ke},atom_site_anisotrop:{id:ke,type_symbol:se,U:Jx(3,3),U_esd:Jx(3,3),pdbx_auth_seq_id:ke,pdbx_auth_asym_id:se,pdbx_auth_atom_id:se,pdbx_auth_comp_id:se,pdbx_label_seq_id:ke,pdbx_label_alt_id:se,pdbx_label_asym_id:se,pdbx_label_atom_id:se,pdbx_label_comp_id:se,pdbx_PDB_ins_code:se},atom_sites:{entry_id:se,fract_transf_matrix:Jx(3,3),fract_transf_vector:sE(3)},audit_author:{name:se,pdbx_ordinal:ke,identifier_ORCID:se},audit_conform:{dict_location:se,dict_name:se,dict_version:se},cell:{angle_alpha:mn,angle_beta:mn,angle_gamma:mn,entry_id:se,length_a:mn,length_b:mn,length_c:mn,Z_PDB:ke,pdbx_unique_axis:se},chem_comp:{formula:se,formula_weight:mn,id:se,mon_nstd_flag:Qt(wo),name:se,type:Qt(wo),pdbx_synonyms:DS(";",e=>e)},chem_comp_bond:{atom_id_1:se,atom_id_2:se,comp_id:se,value_order:Qt(wo),pdbx_ordinal:ke,pdbx_stereo_config:Qt(wo),pdbx_aromatic_flag:Qt(wo)},citation:{book_publisher:se,country:se,id:se,journal_abbrev:se,journal_id_ASTM:se,journal_id_CSD:se,journal_id_ISSN:se,journal_volume:se,page_first:se,page_last:se,title:se,year:ke,pdbx_database_id_DOI:se,pdbx_database_id_PubMed:ke},citation_author:{citation_id:se,name:se,ordinal:ke},database_2:{database_id:Qt(wo),database_code:se},entity:{details:se,formula_weight:mn,id:se,src_method:Qt(wo),type:Qt(wo),pdbx_description:DS(",",e=>e),pdbx_number_of_molecules:ke,pdbx_parent_entity_id:se,pdbx_mutation:se,pdbx_fragment:se,pdbx_ec:DS(",",e=>e)},entity_poly:{entity_id:se,nstd_linkage:Qt(wo),nstd_monomer:Qt(wo),type:Qt(se),pdbx_strand_id:DS(",",e=>e),pdbx_seq_one_letter_code:se,pdbx_seq_one_letter_code_can:se,pdbx_target_identifier:se},entity_poly_seq:{entity_id:se,hetero:Qt(wo),mon_id:se,num:ke},entry:{id:se},exptl:{entry_id:se,method:Qt(se)},software:{classification:se,date:se,description:se,name:se,type:Qt(wo),version:se,pdbx_ordinal:ke},struct:{entry_id:se,title:se,pdbx_structure_determination_methodology:Qt(se),pdbx_descriptor:se},struct_asym:{details:se,entity_id:se,id:se,pdbx_modified:se,pdbx_blank_PDB_chainid_flag:Qt(se)},struct_conf:{beg_label_asym_id:se,beg_label_comp_id:se,beg_label_seq_id:ke,beg_auth_asym_id:se,beg_auth_comp_id:se,beg_auth_seq_id:ke,conf_type_id:Qt(wo),details:se,end_label_asym_id:se,end_label_comp_id:se,end_label_seq_id:ke,end_auth_asym_id:se,end_auth_comp_id:se,end_auth_seq_id:ke,id:se,pdbx_beg_PDB_ins_code:se,pdbx_end_PDB_ins_code:se,pdbx_PDB_helix_class:se,pdbx_PDB_helix_length:ke,pdbx_PDB_helix_id:se},struct_conn:{conn_type_id:Qt(wo),details:se,id:se,ptnr1_label_asym_id:se,ptnr1_label_atom_id:se,ptnr1_label_comp_id:se,ptnr1_label_seq_id:ke,ptnr1_auth_asym_id:se,ptnr1_auth_comp_id:se,ptnr1_auth_seq_id:ke,ptnr1_symmetry:se,ptnr2_label_asym_id:se,ptnr2_label_atom_id:se,ptnr2_label_comp_id:se,ptnr2_label_seq_id:ke,ptnr2_auth_asym_id:se,ptnr2_auth_comp_id:se,ptnr2_auth_seq_id:ke,ptnr2_symmetry:se,pdbx_ptnr1_PDB_ins_code:se,pdbx_ptnr1_label_alt_id:se,pdbx_ptnr1_standard_comp_id:se,pdbx_ptnr2_PDB_ins_code:se,pdbx_ptnr2_label_alt_id:se,pdbx_ptnr3_PDB_ins_code:se,pdbx_ptnr3_label_alt_id:se,pdbx_ptnr3_label_asym_id:se,pdbx_ptnr3_label_atom_id:se,pdbx_ptnr3_label_comp_id:se,pdbx_ptnr3_label_seq_id:ke,pdbx_PDB_id:se,pdbx_dist_value:mn,pdbx_value_order:Qt(wo)},struct_conn_type:{criteria:se,id:Qt(wo),reference:se},struct_keywords:{entry_id:se,text:DS(",",e=>e),pdbx_keywords:se},struct_mon_prot_cis:{label_alt_id:se,label_asym_id:se,label_comp_id:se,label_seq_id:ke,auth_asym_id:se,auth_comp_id:se,auth_seq_id:ke,pdbx_auth_asym_id_2:se,pdbx_auth_comp_id_2:se,pdbx_auth_seq_id_2:ke,pdbx_label_asym_id_2:se,pdbx_label_comp_id_2:se,pdbx_label_seq_id_2:ke,pdbx_PDB_ins_code:se,pdbx_PDB_ins_code_2:se,pdbx_PDB_model_num:ke,pdbx_omega_angle:se,pdbx_id:se,pdbx_auth_ins_code:se,pdbx_auth_ins_code_2:se},struct_ncs_oper:{code:Qt(se),details:se,id:ke,matrix:Jx(3,3),vector:sE(3)},struct_sheet_range:{beg_label_asym_id:se,beg_label_comp_id:se,beg_label_seq_id:ke,end_label_asym_id:se,end_label_comp_id:se,end_label_seq_id:ke,beg_auth_asym_id:se,beg_auth_comp_id:se,beg_auth_seq_id:ke,end_auth_asym_id:se,end_auth_comp_id:se,end_auth_seq_id:ke,id:se,sheet_id:se,pdbx_beg_PDB_ins_code:se,pdbx_end_PDB_ins_code:se},struct_site:{details:se,id:se,pdbx_num_residues:ke,pdbx_evidence_code:se,pdbx_auth_asym_id:se,pdbx_auth_comp_id:se,pdbx_auth_seq_id:ke,pdbx_auth_ins_code:se},struct_site_gen:{details:se,id:se,label_alt_id:se,label_asym_id:se,label_atom_id:se,label_comp_id:se,label_seq_id:ke,auth_asym_id:se,auth_atom_id:se,auth_comp_id:se,auth_seq_id:ke,site_id:se,symmetry:se,pdbx_auth_ins_code:se,pdbx_num_res:ke},struct_site_keywords:{site_id:se,text:se},symmetry:{entry_id:se,cell_setting:Qt(wo),Int_Tables_number:ke,space_group_name_Hall:se,"space_group_name_H-M":se},pdbx_database_status:{status_code:Qt(se),status_code_sf:Qt(se),status_code_mr:Qt(se),entry_id:se,recvd_initial_deposition_date:se,SG_entry:Qt(wo),deposit_site:Qt(se),process_site:Qt(se),status_code_cs:Qt(se),methods_development_category:Qt(se),pdb_format_compatible:Qt(wo)},pdbx_nonpoly_scheme:{asym_id:se,entity_id:se,mon_id:se,pdb_strand_id:se,ndb_seq_num:se,pdb_seq_num:se,auth_seq_num:se,pdb_mon_id:se,auth_mon_id:se,pdb_ins_code:se},pdbx_database_related:{db_name:Qt(se),details:se,db_id:se,content_type:Qt(se)},pdbx_entity_nonpoly:{entity_id:se,comp_id:se,name:se},pdbx_chem_comp_synonyms:{name:se,comp_id:se,provenance:Qt(se)},pdbx_chem_comp_identifier:{comp_id:se,identifier:se,type:Qt(se),program:se,program_version:se},pdbx_unobs_or_zero_occ_residues:{id:ke,polymer_flag:Qt(wo),occupancy_flag:Qt(ke),PDB_model_num:ke,auth_asym_id:se,auth_comp_id:se,auth_seq_id:ke,PDB_ins_code:se,label_asym_id:se,label_comp_id:se,label_seq_id:ke},pdbx_struct_mod_residue:{id:ke,auth_asym_id:se,auth_comp_id:se,auth_seq_id:ke,PDB_ins_code:se,label_asym_id:se,label_comp_id:se,label_seq_id:ke,parent_comp_id:se,details:se},pdbx_struct_oper_list:{id:se,type:Qt(se),name:se,symmetry_operation:se,matrix:Jx(3,3),vector:sE(3)},pdbx_struct_assembly:{method_details:se,oligomeric_details:se,oligomeric_count:ke,details:se,id:se},pdbx_struct_assembly_gen:{asym_id_list:DS(",",e=>e),assembly_id:se,oper_expression:se},pdbx_reference_entity_list:{prd_id:se,ref_entity_id:se,type:Qt(wo),details:se,component_id:ke},pdbx_reference_entity_link:{link_id:ke,prd_id:se,details:se,ref_entity_id_1:se,ref_entity_id_2:se,entity_seq_num_1:ke,entity_seq_num_2:ke,comp_id_1:se,comp_id_2:se,atom_id_1:se,atom_id_2:se,value_order:Qt(wo),component_1:ke,component_2:ke,link_class:Qt(se)},pdbx_reference_entity_poly_link:{link_id:ke,prd_id:se,ref_entity_id:se,component_id:ke,entity_seq_num_1:ke,entity_seq_num_2:ke,comp_id_1:se,comp_id_2:se,atom_id_1:se,atom_id_2:se,value_order:Qt(wo)},pdbx_molecule:{prd_id:se,instance_id:ke,asym_id:se},pdbx_molecule_features:{prd_id:se,class:Qt(wo),type:Qt(wo),name:se,details:se},entity_src_nat:{entity_id:se,pdbx_organism_scientific:se,pdbx_plasmid_name:se,pdbx_src_id:ke,pdbx_beg_seq_num:ke,pdbx_end_seq_num:ke},entity_src_gen:{entity_id:se,pdbx_gene_src_gene:DS(",",e=>e),pdbx_gene_src_scientific_name:se,plasmid_name:se,pdbx_src_id:ke,pdbx_beg_seq_num:ke,pdbx_end_seq_num:ke},pdbx_entity_src_syn:{organism_scientific:se,entity_id:se,pdbx_src_id:ke,pdbx_beg_seq_num:ke,pdbx_end_seq_num:ke},pdbx_entity_branch_descriptor:{entity_id:se,descriptor:se,type:Qt(wo),program:se,program_version:se,ordinal:ke},pdbx_entity_instance_feature:{details:se,feature_type:Qt(se),auth_asym_id:se,asym_id:se,auth_seq_num:se,seq_num:ke,comp_id:se,auth_comp_id:se,ordinal:ke},pdbx_entity_branch_list:{entity_id:se,hetero:Qt(wo),comp_id:se,num:ke},pdbx_entity_branch_link:{link_id:ke,details:se,entity_id:se,entity_branch_list_num_1:ke,entity_branch_list_num_2:ke,comp_id_1:se,comp_id_2:se,atom_id_1:se,leaving_atom_id_1:se,atom_stereo_config_1:Qt(wo),atom_id_2:se,leaving_atom_id_2:se,atom_stereo_config_2:Qt(wo),value_order:Qt(wo)},pdbx_entity_branch:{entity_id:se,type:Qt(se)},pdbx_branch_scheme:{entity_id:se,hetero:Qt(wo),asym_id:se,mon_id:se,num:ke,pdb_asym_id:se,pdb_seq_num:se,pdb_mon_id:se,auth_asym_id:se,auth_seq_num:se,auth_mon_id:se},pdbx_chem_comp_related:{comp_id:se,related_comp_id:se,relationship_type:Qt(se),details:se},ihm_starting_model_details:{starting_model_id:se,entity_id:se,entity_description:se,asym_id:se,entity_poly_segment_id:ke,starting_model_source:Qt(se),starting_model_auth_asym_id:se,starting_model_sequence_offset:ke,dataset_list_id:ke},ihm_starting_comparative_models:{id:ke,starting_model_id:se,starting_model_auth_asym_id:se,starting_model_seq_id_begin:ke,starting_model_seq_id_end:ke,template_auth_asym_id:se,template_seq_id_begin:ke,template_seq_id_end:ke,template_sequence_identity:mn,template_sequence_identity_denominator:Qt(ke),template_dataset_list_id:ke,alignment_file_id:ke},ihm_starting_model_seq_dif:{id:ke,entity_id:se,asym_id:se,seq_id:ke,comp_id:se,starting_model_id:se,db_asym_id:se,db_seq_id:ke,db_comp_id:se,details:se},ihm_model_representation:{id:ke,name:se,details:se},ihm_model_representation_details:{id:ke,representation_id:ke,entity_poly_segment_id:ke,entity_id:se,entity_description:se,entity_asym_id:se,model_object_primitive:Qt(se),starting_model_id:se,model_mode:Qt(se),model_granularity:Qt(se),model_object_count:ke},ihm_struct_assembly_details:{id:ke,assembly_id:ke,parent_assembly_id:ke,entity_description:se,entity_id:se,asym_id:se,entity_poly_segment_id:ke},ihm_struct_assembly:{id:ke,name:se,description:se},ihm_modeling_protocol:{id:ke,num_steps:ke,protocol_name:se},ihm_modeling_protocol_details:{id:ke,protocol_id:ke,step_id:ke,struct_assembly_id:ke,dataset_group_id:ke,struct_assembly_description:se,step_name:se,step_method:se,num_models_begin:ke,num_models_end:ke,multi_scale_flag:Qt(wo),multi_state_flag:Qt(wo),ordered_flag:Qt(wo),script_file_id:ke,software_id:ke},ihm_multi_state_modeling:{state_id:ke,state_group_id:ke,population_fraction:mn,population_fraction_sd:mn,state_type:se,state_name:se,experiment_type:Qt(se),details:se},ihm_modeling_post_process:{id:ke,protocol_id:ke,analysis_id:ke,step_id:ke,type:Qt(se),feature:Qt(se),num_models_begin:ke,num_models_end:ke},ihm_ensemble_info:{ensemble_id:ke,ensemble_name:se,post_process_id:ke,model_group_id:ke,ensemble_clustering_method:Qt(se),ensemble_clustering_feature:Qt(se),num_ensemble_models:ke,num_ensemble_models_deposited:ke,ensemble_precision_value:mn,ensemble_file_id:ke},ihm_model_list:{model_id:ke,model_name:se,assembly_id:ke,protocol_id:ke,representation_id:ke},ihm_model_group:{id:ke,name:se,details:se},ihm_model_group_link:{model_id:ke,group_id:ke},ihm_model_representative:{id:ke,model_group_id:ke,model_id:ke,selection_criteria:Qt(se)},ihm_dataset_list:{id:ke,data_type:Qt(se),database_hosted:Qt(wo)},ihm_dataset_group:{id:ke,name:se,application:Qt(se),details:se},ihm_dataset_group_link:{dataset_list_id:ke,group_id:ke},ihm_related_datasets:{dataset_list_id_derived:ke,dataset_list_id_primary:ke},ihm_dataset_related_db_reference:{id:ke,dataset_list_id:ke,db_name:Qt(se),accession_code:se,version:se,details:se},ihm_external_reference_info:{reference_id:ke,reference_provider:se,reference_type:Qt(se),reference:se,refers_to:Qt(se),associated_url:se},ihm_external_files:{id:ke,reference_id:ke,file_path:se,content_type:Qt(se),file_size_bytes:mn,details:se},ihm_dataset_external_reference:{id:ke,dataset_list_id:ke,file_id:ke},ihm_localization_density_files:{id:ke,file_id:ke,ensemble_id:ke,entity_id:se,entity_poly_segment_id:ke,asym_id:se},ihm_predicted_contact_restraint:{id:ke,group_id:ke,entity_id_1:se,entity_id_2:se,asym_id_1:se,asym_id_2:se,comp_id_1:se,comp_id_2:se,seq_id_1:ke,seq_id_2:ke,rep_atom_1:Qt(se),rep_atom_2:Qt(se),distance_lower_limit:mn,distance_upper_limit:mn,probability:mn,restraint_type:Qt(se),model_granularity:Qt(se),dataset_list_id:ke,software_id:ke},ihm_cross_link_list:{id:ke,group_id:ke,entity_description_1:se,entity_description_2:se,entity_id_1:se,entity_id_2:se,comp_id_1:se,comp_id_2:se,seq_id_1:ke,seq_id_2:ke,linker_type:Qt(se),dataset_list_id:ke},ihm_cross_link_restraint:{id:ke,group_id:ke,entity_id_1:se,entity_id_2:se,asym_id_1:se,asym_id_2:se,comp_id_1:se,comp_id_2:se,seq_id_1:ke,seq_id_2:ke,atom_id_1:se,atom_id_2:se,restraint_type:Qt(se),conditional_crosslink_flag:Qt(se),model_granularity:Qt(se),distance_threshold:mn,psi:mn,sigma_1:mn,sigma_2:mn},ihm_cross_link_result_parameters:{id:ke,restraint_id:ke,model_id:ke,psi:mn,sigma_1:mn,sigma_2:mn},ihm_2dem_class_average_restraint:{id:ke,dataset_list_id:ke,number_raw_micrographs:ke,pixel_size_width:mn,pixel_size_height:mn,image_resolution:mn,image_segment_flag:Qt(wo),number_of_projections:ke,struct_assembly_id:ke,details:se},ihm_2dem_class_average_fitting:{id:ke,restraint_id:ke,model_id:ke,cross_correlation_coefficient:mn,rot_matrix:Jx(3,3),tr_vector:sE(3)},ihm_3dem_restraint:{id:ke,dataset_list_id:ke,model_id:ke,struct_assembly_id:ke,fitting_method:se,number_of_gaussians:ke,cross_correlation_coefficient:mn},ihm_sas_restraint:{id:ke,dataset_list_id:ke,model_id:ke,struct_assembly_id:ke,profile_segment_flag:Qt(wo),fitting_atom_type:se,fitting_method:se,fitting_state:Qt(se),radius_of_gyration:mn,chi_value:mn,details:se},ihm_starting_model_coord:{ordinal_id:ke,starting_model_id:se,group_PDB:Qt(se),id:ke,type_symbol:se,entity_id:se,atom_id:se,comp_id:se,seq_id:ke,asym_id:se,Cartn_x:mn,Cartn_y:mn,Cartn_z:mn,B_iso_or_equiv:mn},ihm_sphere_obj_site:{id:ke,entity_id:se,seq_id_begin:ke,seq_id_end:ke,asym_id:se,Cartn_x:mn,Cartn_y:mn,Cartn_z:mn,object_radius:mn,rmsf:mn,model_id:ke},ihm_gaussian_obj_site:{id:ke,entity_id:se,seq_id_begin:ke,seq_id_end:ke,asym_id:se,mean_Cartn_x:mn,mean_Cartn_y:mn,mean_Cartn_z:mn,weight:mn,covariance_matrix:Jx(3,3),model_id:ke},ihm_gaussian_obj_ensemble:{id:ke,entity_id:se,seq_id_begin:ke,seq_id_end:ke,asym_id:se,mean_Cartn_x:mn,mean_Cartn_y:mn,mean_Cartn_z:mn,weight:mn,covariance_matrix:Jx(3,3),ensemble_id:ke},ihm_feature_list:{feature_id:ke,feature_type:Qt(se),entity_type:Qt(se)},ihm_poly_residue_feature:{ordinal_id:ke,feature_id:ke,entity_id:se,asym_id:se,comp_id_begin:se,comp_id_end:se,seq_id_begin:ke,seq_id_end:ke},ihm_derived_distance_restraint:{id:ke,group_id:ke,feature_id_1:ke,feature_id_2:ke,group_conditionality:Qt(se),random_exclusion_fraction:mn,distance_upper_limit:mn,restraint_type:Qt(se),dataset_list_id:ke},ma_model_list:{ordinal_id:ke,model_id:ke,model_group_id:ke,model_name:se,model_group_name:se,model_type:Qt(se),data_id:ke},ma_target_entity:{entity_id:se,data_id:ke,origin:Qt(se)},ma_target_entity_instance:{asym_id:se,entity_id:se,details:se},ma_target_ref_db_details:{target_entity_id:se,db_name:Qt(se),db_code:se,db_accession:se,seq_db_isoform:se,seq_db_align_begin:se,seq_db_align_end:se,ncbi_taxonomy_id:se,organism_scientific:se},ma_data:{id:ke,content_type:Qt(se),content_type_other_details:se,name:se},ma_software_group:{ordinal_id:ke,group_id:ke,software_id:ke},ma_qa_metric:{id:ke,name:se,type:Qt(se),mode:Qt(se),software_group_id:ke},ma_qa_metric_global:{ordinal_id:ke,model_id:ke,metric_id:ke,metric_value:mn},ma_qa_metric_local:{ordinal_id:ke,model_id:ke,label_asym_id:se,label_seq_id:ke,label_comp_id:se,metric_id:ke,metric_value:mn},ma_qa_metric_local_pairwise:{ordinal_id:ke,model_id:ke,label_asym_id_1:se,label_seq_id_1:ke,label_comp_id_1:se,label_asym_id_2:se,label_seq_id_2:ke,label_comp_id_2:se,metric_id:ke,metric_value:mn}};var Kue={type_symbol:W.Schema.Aliased(bn.atom_site.type_symbol),label_atom_id:bn.atom_site.label_atom_id,auth_atom_id:bn.atom_site.auth_atom_id,label_alt_id:bn.atom_site.label_alt_id,label_comp_id:bn.atom_site.label_comp_id,auth_comp_id:bn.atom_site.auth_comp_id,pdbx_formal_charge:bn.atom_site.pdbx_formal_charge},Jue={group_PDB:bn.atom_site.group_PDB,label_seq_id:bn.atom_site.label_seq_id,auth_seq_id:bn.atom_site.auth_seq_id,pdbx_PDB_ins_code:bn.atom_site.pdbx_PDB_ins_code},$ue={label_asym_id:bn.atom_site.label_asym_id,auth_asym_id:bn.atom_site.auth_asym_id,label_entity_id:bn.atom_site.label_entity_id},i6;(t=>{function e(){return{label_entity_id:"",label_asym_id:"",auth_seq_id:0,pdbx_PDB_ins_code:void 0}}t.EmptyResidueKey=e})(i6||={});var wS;(a=>{function e(s,l){return s.residueAtomSegments.index[s.chainAtomSegments.offsets[l]]}a.chainStartResidueIndex=e;function t(s,l){return s.residueAtomSegments.index[s.chainAtomSegments.offsets[l+1]-1]+1}a.chainEndResidueIndexExcl=t;function r(s,l){return t(s,l)-e(s,l)}a.chainResidueCount=r;function n(s,l){return s.residueAtomSegments.offsets[l]}a.residueFirstAtomIndex=n;function o(s,l){return s.chainAtomSegments.index[l]}a.atomChainIndex=o;function i(s,l){return s.chainAtomSegments.index[s.residueAtomSegments.offsets[l]]}a.residueChainIndex=i})(wS||={});var F_={H:1,D:1,T:1,HE:2,LI:3,BE:4,B:5,C:6,N:7,O:8,F:9,NE:10,NA:11,MG:12,AL:13,SI:14,P:15,S:16,CL:17,AR:18,K:19,CA:20,SC:21,TI:22,V:23,CR:24,MN:25,FE:26,CO:27,NI:28,CU:29,ZN:30,GA:31,GE:32,AS:33,SE:34,BR:35,KR:36,RB:37,SR:38,Y:39,ZR:40,NB:41,MO:42,TC:43,RU:44,RH:45,PD:46,AG:47,CD:48,IN:49,SN:50,SB:51,TE:52,I:53,XE:54,CS:55,BA:56,LA:57,CE:58,PR:59,ND:60,PM:61,SM:62,EU:63,GD:64,TB:65,DY:66,HO:67,ER:68,TM:69,YB:70,LU:71,HF:72,TA:73,W:74,RE:75,OS:76,IR:77,PT:78,AU:79,HG:80,TL:81,PB:82,BI:83,PO:84,AT:85,RN:86,FR:87,RA:88,AC:89,TH:90,PA:91,U:92,NP:93,PU:94,AM:95,CM:96,BK:97,CF:98,ES:99,FM:100,MD:101,NO:102,LR:103,RF:104,DB:105,SG:106,BH:107,HS:108,MT:109},Jze={1:1.1,2:1.4,3:1.81,4:1.53,5:1.92,6:1.7,7:1.55,8:1.52,9:1.47,10:1.54,11:2.27,12:1.73,13:1.84,14:2.1,15:1.8,16:1.8,17:1.75,18:1.88,19:2.75,20:2.31,21:2.3,22:2.15,23:2.05,24:2.05,25:2.05,26:2.05,27:2,28:2,29:2,30:2.1,31:1.87,32:2.11,33:1.85,34:1.9,35:1.83,36:2.02,37:3.03,38:2.49,39:2.4,40:2.3,41:2.15,42:2.1,43:2.05,44:2.05,45:2,46:2.05,47:2.1,48:2.2,49:2.2,50:1.93,51:2.17,52:2.06,53:1.98,54:2.16,55:3.43,56:2.68,57:2.5,58:2.48,59:2.47,60:2.45,61:2.43,62:2.42,63:2.4,64:2.38,65:2.37,66:2.35,67:2.33,68:2.32,69:2.3,70:2.28,71:2.27,72:2.25,73:2.2,74:2.1,75:2.05,76:2,77:2,78:2.05,79:2.1,80:2.05,81:1.96,82:2.02,83:2.07,84:1.97,85:2.02,86:2.2,87:3.48,88:2.83,89:2,90:2.4,91:2,92:2.3,93:2,94:2,95:2,96:2,97:2,98:2,99:2,100:2,101:2,102:2,103:2,104:2,105:2,106:2,107:2,108:2,109:2},$ze={1:1.008,2:4.0026,3:6.94,4:9.0122,5:10.81,6:10.81,7:14.007,8:15.999,9:18.998,10:20.18,11:22.99,12:24.305,13:26.982,14:28.085,15:30.974,16:32.06,17:35.45,18:39.948,19:39.098,20:40.078,21:44.956,22:47.867,23:50.942,24:51.996,25:54.938,26:55.845,27:58.933,28:58.693,29:63.546,30:65.38,31:69.723,32:72.63,33:74.922,34:78.971,35:79.904,36:83.798,37:85.468,38:87.62,39:88.906,40:91.224,41:92.906,42:95.95,43:96.906,44:101.07,45:102.91,46:106.42,47:107.87,48:112.41,49:114.82,50:118.71,51:121.76,52:127.6,53:127.6,54:131.29,55:132.91,56:137.33,57:138.91,58:140.12,59:140.91,60:144.24,61:144.912,62:150.36,63:151.96,64:157.25,65:158.93,66:162.5,67:164.93,68:167.26,69:168.93,70:173.05,71:174.97,72:178.49,73:180.95,74:183.84,75:186.21,76:190.23,77:192.22,78:195.08,79:196.97,80:200.59,81:204.38,82:207.2,83:208.98,84:1.97,85:2.02,86:2.2,87:3.48,88:2.83,89:2,90:232.04,91:231.04,92:238.03,93:237.048,94:244.064,95:243.061,96:247.07,97:247.07,98:251.079,99:252.083,100:257.095,101:258.098,102:259.101,103:262.11,104:267.122,105:270.131,106:271.134,107:270.133,108:270.134,109:278.156},eHe=1.7,tHe=10.81,rHe=0;function Dm(e){let t=F_[e];return t===void 0?eHe:Jze[t]}function ece(e){let t=F_[e];return t===void 0?tHe:$ze[t]}function $x(e){let t=F_[e];return t===void 0?rHe:t}function Xl(e){return e}(t=>{function e(r){return r.__key||(r.__key=fn.create22()),r.__key}t.getUUID=e})(Xl||={});var $a=class{constructor(){this._list=[];this._set=new Set;this._refs=new Map;this._assets=new Map}get all(){return this._list}add(t){this._set.has(t)||(this._list.push(t),this._set.add(t))}reference(t,r){let n=this._refs.get(t)||0;n+=r?1:-1,this._refs.set(t,Math.max(n,0))}hasReference(t){return(this._refs.get(t)||0)>0}has(t){return this._set.has(t)}assets(t,r){let n=this._assets.get(t);if(n)for(let o of n)o.dispose();r?this._assets.set(t,r):this._assets.delete(t)}dispose(){this._assets.forEach(t=>{for(let r of t)r.dispose()})}};function Et(){return Et.zero()}(E=>{function e(){let M=[.1,0,0,0];return M[0]=0,M}E.zero=e;function t(M){let D=e();return D[0]=M[0],D[1]=M[1],D[2]=M[2],D[3]=M[3],D}E.clone=t;function r(M,D,B,k){let F=e();return F[0]=M,F[1]=D,F[2]=B,F[3]=k,F}E.create=r;function n(M,D){return M[0]=D.center[0],M[1]=D.center[1],M[2]=D.center[2],M[3]=D.radius,M}E.fromSphere=n;function o(M){return n(e(),M)}E.ofSphere=o;function i(M){return Number.isNaN(M[0])||Number.isNaN(M[1])||Number.isNaN(M[2])||Number.isNaN(M[3])}E.hasNaN=i;function a(M,D,B){return D[B+0]=M[0],D[B+1]=M[1],D[B+2]=M[2],D[B+3]=M[3],D}E.toArray=a;function s(M,D,B){return M[0]=D[B+0],M[1]=D[B+1],M[2]=D[B+2],M[3]=D[B+3],M}E.fromArray=s;function l(M,D,B){D[B+0]=M[0],D[B+1]=M[1],D[B+2]=M[2]}E.toVec3Array=l;function u(M,D,B){return M[0]=D[B+0],M[1]=D[B+1],M[2]=D[B+2],M[3]=0,M}E.fromVec3Array=u;function c(M,D){return M[0]=D[0],M[1]=D[1],M[2]=D[2],M[3]=D[3],M}E.copy=c;function m(M,D,B,k,F){return M[0]=D,M[1]=B,M[2]=k,M[3]=F,M}E.set=m;function d(M,D,B){return M[0]=D[0]+B[0],M[1]=D[1]+B[1],M[2]=D[2]+B[2],M[3]=D[3]+B[3],M}E.add=d;function p(M,D){let B=D[0]-M[0],k=D[1]-M[1],F=D[2]-M[2],z=D[3]-M[3];return Math.sqrt(B*B+k*k+F*F+z*z)}E.distance=p;function h(M,D,B){return M[0]=D[0]*B,M[1]=D[1]*B,M[2]=D[2]*B,M[4]=D[4]*B,M}E.scale=h;function f(M,D){return M[0]=Math.round(D[0]),M[1]=Math.round(D[1]),M[2]=Math.round(D[2]),M[3]=Math.round(D[3]),M}E.round=f;function g(M,D){return M[0]=Math.ceil(D[0]),M[1]=Math.ceil(D[1]),M[2]=Math.ceil(D[2]),M[3]=Math.ceil(D[3]),M}E.ceil=g;function y(M,D){return M[0]=Math.floor(D[0]),M[1]=Math.floor(D[1]),M[2]=Math.floor(D[2]),M[3]=Math.floor(D[3]),M}E.floor=y;function x(M,D){let B=D[0]-M[0],k=D[1]-M[1],F=D[2]-M[2],z=D[3]-M[3];return B*B+k*k+F*F+z*z}E.squaredDistance=x;function S(M){let D=M[0],B=M[1],k=M[2],F=M[3];return Math.sqrt(D*D+B*B+k*k+F*F)}E.norm=S;function I(M){let D=M[0],B=M[1],k=M[2],F=M[3];return D*D+B*B+k*k+F*F}E.squaredNorm=I;function v(M,D,B){let k=D[0],F=D[1],z=D[2],j=D[3];return M[0]=B[0]*k+B[4]*F+B[8]*z+B[12]*j,M[1]=B[1]*k+B[5]*F+B[9]*z+B[13]*j,M[2]=B[2]*k+B[6]*F+B[10]*z+B[14]*j,M[3]=B[3]*k+B[7]*F+B[11]*z+B[15]*j,M}E.transformMat4=v;function A(M,D){return M[0]*D[0]+M[1]*D[1]+M[2]*D[2]+M[3]*D[3]}E.dot=A;function P(M,D){return M[0]=1/D[0],M[1]=1/D[1],M[2]=1/D[2],M[3]=1/D[3],M}E.inverse=P;function T(M,D){return M[0]===D[0]&&M[1]===D[1]&&M[2]===D[2]&&M[3]===D[3]}E.exactEquals=T;function R(M,D){let B=M[0],k=M[1],F=M[2],z=M[3],j=D[0],Y=D[1],G=D[2],X=D[3];return Math.abs(B-j)<=1e-6*Math.max(1,Math.abs(B),Math.abs(j))&&Math.abs(k-Y)<=1e-6*Math.max(1,Math.abs(k),Math.abs(Y))&&Math.abs(F-G)<=1e-6*Math.max(1,Math.abs(F),Math.abs(G))&&Math.abs(z-X)<=1e-6*Math.max(1,Math.abs(z),Math.abs(X))}E.equals=R;function w(M,D){return`[${M[0].toPrecision(D)} ${M[1].toPrecision(D)} ${M[2].toPrecision(D)}  ${M[3].toPrecision(D)}]`}E.toString=w})(Et||={});function tce(e,t){let r=[],n=[],o=[];e.x.length&&(r.push(...Qu(e.x)),n.push(...Qu(e.y)),o.push(...Qu(e.z))),t&&(t.spheres.x.length&&(r.push(...Qu(t.spheres.x)),n.push(...Qu(t.spheres.y)),o.push(...Qu(t.spheres.z))),t.gaussians.x.length&&(r.push(...Qu(t.gaussians.x)),n.push(...Qu(t.gaussians.y)),o.push(...Qu(t.gaussians.z))));let[i,a]=Qu(r),[s,l]=Qu(n),[u,c]=Qu(o),m=i+(a-i)/2,d=s+(l-s)/2,p=u+(c-u)/2;return b.create(m,d,p)}function rce(e){let t=new Set,r=new Set;return e.properties.structAsymMap.forEach(({auth_id:n},o)=>{t.add(n),r.add(o)}),{auth:t.size,label:r.size}}var qe;(m=>{function e(d){return d.creator&&d.chunkSize}m.is=e;function t(d){let p=d.growBy*d.elementSize;d.currentSize=p,d.currentIndex=0,d.currentChunk=new d.ctor(p),d.allocatedSize+=p,d.chunks[d.chunks.length]=d.currentChunk}function r(d,p,h,f,g){d.currentIndex>=d.currentSize&&t(d);let y=d.currentChunk,x=d.currentIndex;return y[x]=p,y[x+1]=h,y[x+2]=f,y[x+3]=g,d.currentIndex+=4,d.elementCount++}m.add4=r;function n(d,p,h,f){d.currentIndex>=d.currentSize&&t(d);let g=d.currentChunk,y=d.currentIndex;return g[y]=p,g[y+1]=h,g[y+2]=f,d.currentIndex+=3,d.elementCount++}m.add3=n;function o(d,p,h){d.currentIndex>=d.currentSize&&t(d);let f=d.currentChunk,g=d.currentIndex;return f[g]=p,f[g+1]=h,d.currentIndex+=2,d.elementCount++}m.add2=o;function i(d,p){return d.currentIndex>=d.currentSize&&t(d),d.currentChunk[d.currentIndex]=p,d.currentIndex+=1,d.elementCount++}m.add=i;function a(d,p,h){for(let f=0;f<p;f++)d.currentIndex>=d.currentSize&&t(d),d.currentChunk[d.currentIndex++]=h,d.elementCount++;return d.elementCount}m.addRepeat=a;function s(d,p){let{elementSize:h}=d;for(let f=0,g=p.length;f<g;f+=h){d.currentIndex>=d.currentSize&&t(d);let{currentChunk:y}=d;for(let x=0;x<h;x++)y[d.currentIndex++]=p[f+x];d.elementCount++}return d.elementCount}m.addMany=s;function l(d,p=!1){return u(d,p)}m.compact=l;function u(d,p){let{ctor:h,chunks:f,currentIndex:g}=d;if(!f.length)return new h(0);if(f.length===1&&(p||g===d.allocatedSize))return f[0];let y=0;for(let v=0,A=f.length-1;v<A;v++)y+=f[v].length;y+=d.currentIndex;let x=new h(y),S=0;if(x.buffer)for(let v=0,A=f.length-1;v<A;v++)x.set(f[v],S),S+=f[v].length;else for(let v=0,A=f.length-1;v<A;v++){let P=f[v];for(let T=0,R=P.length;T<R;T++)x[S+T]=P[T];S+=P.length}let I=f[f.length-1];if(x.buffer&&g>=d.currentSize)x.set(I,S);else for(let v=0,A=I.length;v<A;v++)x[S+v]=I[v];return x}m._compact=u;function c(d,p,h,f){let g={ctor:d,elementSize:p,growBy:Math.max(1,Math.ceil(h)),allocatedSize:0,elementCount:0,currentSize:0,currentChunk:void 0,currentIndex:0,chunks:[]};if(typeof f>"u")return g;if(typeof f=="number")return g.currentChunk=new d(f*p),g.allocatedSize=f*p,g.currentSize=g.currentChunk.length,g.chunks[0]=g.currentChunk,g;let y=f;if(y.length%p!==0)throw new Error("initialChunk length must be a multiple of the element size.");return g.currentChunk=y,g.allocatedSize=y.length,g.currentSize=y.length,g.chunks[0]=y,g}m.create=c})(qe||={});function nHe(e,t,r){return e[t].key<e[r].key?-1:1}function oHe(e,t,r,n,o){let i=new Map,a=[],s=t(e[0]),l=!0;for(let p=n;p<o;p++){let h=t(e[p]);if(i.has(h))i.get(h).count++,s!==h&&(l=!1);else{let f={key:h,count:1,offset:p};i.set(h,f),a[a.length]=f}s=h}let u=new Int32Array(a.length+1);u[a.length]=o;let c=!0;if(r){for(let p=1,h=a.length;p<h;p++)if(a[p-1].key>a[p].key){c=!1;break}}if(l&&c){for(let p=0;p<a.length;p++)u[p]=a[p].offset;return u}r&&!c&&hM(a,0,a.length,nHe,ky);let m=0;for(let p=0;p<a.length;p++){let h=a[p];h.offset=m,m+=h.count}let d=new Int32Array(o-n);for(let p=n;p<o;p++){let h=t(e[p]),f=i.get(h);d[f.offset++]=e[p]}for(let p=0,h=d.length;p<h;p++)e[p+n]=d[p];u[0]=n;for(let p=1;p<a.length;p++)u[p]=a[p-1].offset+n;return u}function lE(e,t,r){let n=r&&r.start||0,o=r&&r.end||e.length;if(o-n<=0)throw new Error("Can only bucket non-empty collections.");return oHe(e,t,!!(r&&r.sort),n,o)}var a6=class{constructor(t,r){this.getHash=t;this.areEqual=r;this.id=0;this.byHash=new Map;this.groups=[]}createGroup(t,r){let n=this.id++,o=[t];return this.groups[n]=o,{id:n,keys:o,value:r}}add(t,r){let n=this.getHash(r);if(this.byHash.has(n)){let o=this.byHash.get(n);for(let a=0,s=o.length;a<s;a++){let l=o[a];if(this.areEqual(r,l.value))return l.keys[l.keys.length]=t,l.value}let i=this.createGroup(t,r);return o[o.length]=i,i.value}else{let o=this.createGroup(t,r);return this.byHash.set(n,[o]),o.value}}};function nce(e,t){return new a6(e,t)}var xs;(c=>{function e(m,d){if(m===d)return!0;if(m.vertexCount!==d.vertexCount||m.edgeCount!==d.edgeCount)return!1;let{a:p,b:h,offset:f}=m,{a:g,b:y,offset:x}=d;for(let S=0,I=m.a.length;S<I;S++)if(p[S]!==g[S])return!1;for(let S=0,I=m.b.length;S<I;S++)if(h[S]!==y[S])return!1;for(let S=0,I=m.offset.length;S<I;S++)if(f[S]!==x[S])return!1;for(let S of Object.keys(m.edgeProps)){let I=m.edgeProps[S],v=d.edgeProps[S];if(!v)return!1;for(let A=0,P=I.length;A<P;A++)if(I[A]!==v[A])return!1}return!0}c.areEqual=e;class t{constructor(d,p,h,f,g,y){this.offset=d;this.a=p;this.b=h;this.edgeCount=f;this.props=y;this.vertexCount=d.length-1,this.edgeProps=g||{}}getEdgeIndex(d,p){let h,f;d<p?(h=d,f=p):(h=p,f=d);for(let g=this.offset[h],y=this.offset[h+1];g<y;g++)if(this.b[g]===f)return g;return-1}getDirectedEdgeIndex(d,p){for(let h=this.offset[d],f=this.offset[d+1];h<f;h++)if(this.b[h]===p)return h;return-1}getVertexEdgeCount(d){return this.offset[d+1]-this.offset[d]}}function r(m,d,p,h,f,g){return new t(m,d,p,h,f,g)}c.create=r;class n{constructor(d,p,h){this.vertexCount=d;this.xs=p;this.ys=h;this.current=0;this.curA=0;this.curB=0;this.edgeCount=p.length,this.offsets=new Int32Array(this.vertexCount+1),this.bucketFill=new Int32Array(this.vertexCount);let f=new Int32Array(this.vertexCount);for(let y=0,x=this.xs.length;y<x;y++)f[this.xs[y]]++;for(let y=0,x=this.ys.length;y<x;y++)f[this.ys[y]]++;let g=0;for(let y=0;y<this.vertexCount;y++)this.offsets[y]=g,g+=f[y];this.offsets[this.vertexCount]=g,this.slotCount=g,this.a=new Int32Array(g),this.b=new Int32Array(g)}createGraph(d,p){return r(this.offsets,this.a,this.b,this.edgeCount,d,p)}addNextEdge(){let d=this.xs[this.current],p=this.ys[this.current],h=this.offsets[d]+this.bucketFill[d];this.a[h]=d,this.b[h]=p,this.bucketFill[d]++;let f=this.offsets[p]+this.bucketFill[p];this.a[f]=p,this.b[f]=d,this.bucketFill[p]++,this.current++,this.curA=h,this.curB=f}addAllEdges(){for(let d=0;d<this.edgeCount;d++)this.addNextEdge()}assignProperty(d,p){d[this.curA]=p,d[this.curB]=p}assignDirectedProperty(d,p,h,f){d[this.curA]=p,d[this.curB]=f,h[this.curB]=p,h[this.curA]=f}}c.EdgeBuilder=n;class o{constructor(d,p,h){this.vertexCount=d;this.xs=p;this.ys=h;this.current=0;this.curA=0;this.edgeCount=p.length,this.offsets=new Int32Array(this.vertexCount+1),this.bucketFill=new Int32Array(this.vertexCount);let f=new Int32Array(this.vertexCount);for(let y=0,x=this.xs.length;y<x;y++)f[this.xs[y]]++;let g=0;for(let y=0;y<this.vertexCount;y++)this.offsets[y]=g,g+=f[y];this.offsets[this.vertexCount]=g,this.slotCount=g,this.a=new Int32Array(g),this.b=new Int32Array(g)}createGraph(d,p){return r(this.offsets,this.a,this.b,this.edgeCount,d,p)}addNextEdge(){let d=this.xs[this.current],p=this.ys[this.current],h=this.offsets[d]+this.bucketFill[d];this.a[h]=d,this.b[h]=p,this.bucketFill[d]++,this.current++,this.curA=h}addAllEdges(){for(let d=0;d<this.edgeCount;d++)this.addNextEdge()}assignProperty(d,p){d[this.curA]=p}}c.DirectedEdgeBuilder=o;class i{constructor(d){this.vertexCount=d;this.xs=[];this.ys=[];this.included=new Set}addEdge(d,p){let h=d,f=p;d>p&&(h=p,f=d);let g=ca(h,f);return this.included.has(g)?!1:(this.included.add(g),this.xs[this.xs.length]=h,this.ys[this.ys.length]=f,!0)}getGraph(){return a(this.vertexCount,this.xs,this.ys)}getEdgeBuiler(){return new n(this.vertexCount,this.xs,this.ys)}}c.UniqueEdgeBuilder=i;function a(m,d,p){let h=new c.EdgeBuilder(m,d,p);return h.addAllEdges(),h.createGraph({})}c.fromVertexPairs=a;function s(m,d,p){let{b:h,offset:f,vertexCount:g,edgeProps:y}=m,x=new Int32Array(g);for(let E=0,M=d.length;E<M;E++)x[d[E]]=E+1;let S=0;for(let E=0;E<g;E++)if(x[E]!==0)for(let M=f[E],D=f[E+1];M<D;M++)h[M]>E&&x[h[M]]!==0&&S++;let I=new Int32Array(d.length+1),v=new Int32Array(2*S),A=new Int32Array(2*S),P=new Int32Array(2*S),T=0,R=0;for(let E=0;E<g;E++){if(x[E]===0)continue;let M=x[E]-1;for(let D=f[E],B=f[E+1];D<B;D++){let k=x[h[D]];k!==0&&(A[T]=M,P[T]=k-1,v[T]=D,T++)}I[++R]=T}let w={};for(let E of Object.keys(y))w[E]=zre(y[E],v);return r(I,A,P,S,w,p)}c.induceByVertices=s;function l(m){let d=m.vertexCount;if(d===0)return{componentCount:0,componentIndex:new Int32Array(0)};if(m.edgeCount===0){let S=new Int32Array(d);for(let I=0,v=d;I<v;I++)S[I]=I;return{componentCount:d,componentIndex:S}}let p=new Int32Array(d);for(let S=0,I=d;S<I;S++)p[S]=-1;let h=0;p[0]=h;let{offset:f,b:g}=m,y=[0],x=$9(d);for(x.remove(0);y.length>0;){let S=y.pop(),I=p[S];for(let v=f[S],A=f[S+1];v<A;v++){let P=g[v];x.has(P)&&(x.remove(P),y.push(P),p[P]=I)}y.length===0&&x.head>=0&&(y.push(x.head),p[x.head]=++h,x.remove(x.head))}return{componentCount:d,componentIndex:p}}c.connectedComponents=l;function u(m,d,p,h){if(Be.areIntersecting(d,p))return!0;if(h<1)return!1;let f=new Set;for(let g=0,y=d.length;g<y;++g)f.add(d[g]);return oce(m,d,p,h,f)}c.areVertexSetsConnected=u})(xs||={});function oce(e,t,r,n,o){let{b:i,offset:a}=e,s=[];for(let l=0,u=t.length;l<u;++l){let c=t[l];for(let m=a[c],d=a[c+1];m<d;++m){let p=i[m];if(!o.has(p)){if(Be.has(r,p))return!0;o.add(p),s[s.length]=p}}}return n>1?oce(e,s,r,n-1,o):!1}var s6=class{constructor(){this.map=new Map;this.applicable=new Map}add(t,r,n){this.map.set(t,r),n&&this.applicable.set(t,n)}remove(t){this.map.delete(t),this.applicable.delete(t)}get(t){return this.map.get(t)}isApplicable(t){if(!this.map.has(t.sourceData.kind))return!1;let r=this.applicable.get(t.sourceData.kind);return r?r(t):!0}};var _l;(t=>{function e(r,n){let{name:o}=r,i=new s6;return{descriptor:r,formatRegistry:i,isApplicable(a){return i.isApplicable(a)},get(a){let s=n?.asDynamic?a._dynamicPropertyData:a._staticPropertyData;if(s[o])return s[o];if(a.customProperties.has(r))return;let l=i.get(a.sourceData.kind);if(l)return s[o]=l(a),a.customProperties.add(r),s[o]},set(a,s){n?.asDynamic?a._dynamicPropertyData[o]=s:a._staticPropertyData[o]=s},delete(a){n?.asDynamic?delete a._dynamicPropertyData[o]:delete a._staticPropertyData[o]}}}t.create=e})(_l||={});var l6=new Set(["145","147","149","289","291","293","445","475","491","510","604","045","05L","07E","07Y","08U","09X","0AT","0BD","0H0","0HX","0LP","0MK","0NZ","0TS","0UB","0V4","0WK","0XY","0YT","10M","12E","14T","15L","16F","16G","16O","17T","18D","18O","18T","1AR","1BW","1CF","1FT","1GL","1GN","1JB","1LL","1NA","1S3","1S4","1SD","1X4","20S","20X","22O","22S","23V","24S","25E","26M","26O","26Q","26R","26V","26W","26Y","27C","2DG","2DR","2F8","2FG","2FL","2FP","2GL","2GS","2H5","2HA","2M4","2M5","2M8","2OS","2SI","2WP","2WS","32O","34V","38J","3BU","3CM","3DO","3DY","3FM","3GR","3HD","3J3","3J4","3LJ","3LR","3MF","3MG","3MK","3R3","3S6","3SA","3YW","40J","42D","44S","46D","46M","46Z","48Z","49A","49S","49T","49V","4AM","4CQ","4GC","4GL","4GP","4JA","4N2","4NN","4QY","4R1","4RS","4SG","4U0","4U1","4U2","4UZ","4V5","50A","51N","56N","57S","5DI","5GF","5GO","5II","5KQ","5KS","5KT","5KV","5L2","5L3","5LS","5LT","5MM","5N6","5QP","5RP","5SA","5SP","5TH","5TJ","5TK","5TM","61J","62I","64K","66O","6BG","6C2","6DM","6GB","6GP","6GR","6K3","6KH","6KL","6KS","6KU","6KW","6LA","6LS","6LW","6MJ","6MN","6PG","6PY","6PZ","6S2","6SA","6UD","6Y6","6YR","6ZC","73E","79J","7CV","7D1","7GP","7JZ","7K2","7K3","7NU","7SA","83Y","89Y","8B7","8B9","8EX","8GA","8GG","8GP","8I4","8LM","8LR","8OQ","8PK","8S0","8YV","95Z","96O","98U","9AM","9C1","9CD","9GP","9KJ","9MR","9OK","9PG","9QG","9QZ","9RN","9S7","9SG","9SJ","9SM","9SP","9T1","9T7","9VP","9WJ","9WN","9WZ","9YW","A0K","A1AIO","A1APB","A1APC","A1APD","A1CCV","A1CCW","A1EAX","A1EFW","A1EGT","A1EGV","A1EGW","A1EGX","A1EGY","A1EJ0","A1EJ2","A1EKO","A1EN6","A1H03","A1H0P","A1H0Z","A1H10","A1H1B","A1H1F","A1H1V","A1I9U","A1ID6","A1IH4","A1IVP","A1IZL","A1JAQ","A1L1P","A1Q","A2G","A5C","A6P","AAL","AAO","ABC","ABD","ABE","ABF","ABL","AC1","ACG","ACR","ACX","ADA","ADG","ADR","AF1","AFD","AFL","AFO","AFP","AFR","AGC","AGH","AGL","AGR","AH2","AH8","AHG","AHM","AHR","AIG","ALL","ALX","AMG","AMN","AMU","AMV","ANA","AOG","AOS","AQA","ARA","ARB","ARE","ARI","ARW","ASC","ASG","ASO","AXP","AXR","AY9","AZC","B0D","B16","B1H","B1N","B2G","B4G","B6D","B7G","B8D","B9D","BBK","BBV","BCD","BCW","BDF","BDG","BDP","BDR","BDZ","BEM","BFN","BFP","BG6","BG8","BGC","BGL","BGN","BGP","BGS","BHG","BM3","BM7","BMA","BMX","BND","BNG","BNX","BO1","BOG","BQY","BRI","BS7","BTG","BTU","BW3","BWG","BXF","BXP","BXX","BXY","BZD","C3B","C3G","C3X","C4B","C4W","C4X","C5X","CAP","CBF","CBI","CBK","CDR","CE5","CE6","CE8","CEG","CEX","CEY","CEZ","CGF","CJB","CKB","CKP","CNP","CR1","CR6","CRA","CT3","CTO","CTR","CTT","D0N","D1M","D5E","D6G","DAF","DAG","DAN","DDA","DDB","DDL","DEG","DEL","DFR","DFX","DG0","DGC","DGD","DGM","DGO","DGS","DGU","DIG","DJB","DJE","DK4","DKX","DKZ","DL6","DLD","DLF","DLG","DMU","DNO","DO8","DOM","DP5","DPC","DQQ","DQR","DR2","DR3","DR4","DR5","DRI","DSR","DT6","DVC","DYM","E3M","E4P","E5G","EAG","EBG","EBQ","ED6","EEN","EEQ","EGA","EJT","EMP","EMZ","EPG","EQP","EQV","ERE","ERI","ETT","EUS","F1P","F1X","F55","F58","F6P","F8X","FBP","FCA","FCB","FCT","FDP","FDQ","FFC","FFX","FIF","FIX","FK9","FKD","FMF","FMO","FNG","FNY","FRU","FSA","FSI","FSM","FSR","FSW","FU4","FUB","FUC","FUD","FUF","FUL","FUY","FVQ","FX1","FYJ","G0S","G16","G1P","G20","G28","G2F","G3F","G3I","G4D","G4S","G6D","G6P","G6S","G7P","G8Z","GAA","GAC","GAD","GAF","GAL","GAT","GBH","GC1","GC4","GC9","GCB","GCD","GCN","GCO","GCS","GCT","GCU","GCV","GCW","GDA","GDL","GE1","GE3","GFP","GIV","GL0","GL1","GL2","GL4","GL5","GL6","GL7","GL9","GLA","GLB","GLC","GLD","GLF","GLG","GLO","GLP","GLS","GLT","GLW","GM0","GMB","GMH","GMT","GMZ","GN1","GN4","GNS","GNX","GP0","GP1","GP4","GPH","GPK","GPM","GPO","GPQ","GPU","GPV","GPW","GQ1","GRF","GRX","GS1","GS4","GS9","GSA","GSD","GTE","GTH","GTK","GTM","GTR","GU0","GU1","GU2","GU3","GU4","GU5","GU6","GU8","GU9","GUF","GUL","GUP","GUZ","GXL","GXV","GYE","GYG","GYP","GYU","GYV","GZL","H1M","H1S","H2P","H3S","H53","H6Q","H6Z","HBZ","HD4","HDL","HLA","HMS","HNV","HNW","HSG","HSH","HSJ","HSQ","HSR","HSU","HSX","HSY","HSZ","HTG","HTM","HVC","I57","IAB","IDC","IDF","IDG","IDR","IDS","IDT","IDU","IDX","IDY","IEM","IN1","IPT","ISD","ISL","ISX","IVG","IXD","J5B","JFZ","JHM","JLT","JRV","JS2","JSV","JV4","JVA","JVS","JZR","K5B","K99","KBA","KBG","KD5","KDA","KDB","KDD","KDE","KDF","KDM","KDN","KDO","KDR","KFN","KG1","KGM","KHP","KME","KO1","KO2","KOT","KQC","KTU","L1L","L6N","L6S","L6T","LAG","LAH","LAI","LAK","LAO","LAT","LB2","LBS","LBT","LCN","LDY","LEC","LER","LFC","LFR","LGC","LGU","LKA","LKS","LM2","LMO","LMT","LMU","LNV","LOG","LOX","LPK","LRH","LSM","LTG","LTM","LVO","LVZ","LXB","LXC","LXZ","LZ0","M1F","M1P","M2F","M3M","M3N","M55","M6D","M6P","M7B","M7P","M8C","MA1","MA2","MA3","MA8","MAB","MAF","MAG","MAL","MAN","MAT","MAV","MAW","MBE","MBF","MBG","MCU","MDA","MDP","MFA","MFB","MFU","MG5","MGA","MGC","MGL","MGS","MJJ","MLB","MLR","MMA","MMN","MN0","MNA","MQG","MQT","MRH","MRP","MSX","MTT","MUB","MUG","MUR","MVP","MXY","MXZ","MYG","N1L","N3U","N9S","NA1","NAA","NAG","NBG","NBX","NBY","NDG","NED","NFG","NG1","NG6","NGA","NGB","NGC","NGE","NGF","NGK","NGL","NGR","NGS","NGY","NGZ","NHF","NLC","NM6","NM9","NNG","NOJ","NPF","NSQ","NT1","NTF","NTO","NTP","NXD","NYT","O1G","OAK","OEL","OI7","OPM","ORP","OSU","OTG","OTN","OTU","OX2","P53","P6P","P8E","PA1","PA5","PAV","PDX","PH5","PKM","PNA","PNG","PNJ","PNW","PPC","PRP","PSG","PSJ","PSV","PTQ","PUF","PZU","QDK","QIF","QKH","QPS","QV4","R1P","R1X","R2B","R2G","R5P","RAA","RAE","RAF","RAM","RAO","RAT","RB5","RBL","RCD","RDP","REL","RER","RF5","RG1","RGG","RHA","RHC","RI2","RIB","RIP","RM4","RNS","RNT","ROB","ROR","RP3","RP5","RP6","RPA","RR7","RRJ","RRY","RST","RTG","RTV","RUB","RUG","RUU","RV7","RVG","RVM","RWI","RY7","RZM","S6P","S7P","S81","SA0","SCG","SCR","SDD","SDY","SEJ","SF6","SF9","SFJ","SFU","SG4","SG5","SG6","SG7","SGA","SGC","SGD","SGN","SGS","SHB","SHD","SHG","SI3","SIA","SID","SIO","SIZ","SLB","SLM","SLT","SMD","SN5","SNG","SOE","SOG","SOL","SOR","SR1","SSG","SSH","STW","STZ","SUC","SUP","SUS","SWE","SZZ","T68","T6D","T6P","T6T","TA6","TAG","TCB","TCG","TDG","TEU","TF0","TFU","TGA","TGK","TGR","TGY","TH1","TM5","TM6","TM9","TMR","TMX","TNX","TOA","TOC","TQY","TRE","TRV","TS8","TT7","TTV","TTZ","TU4","TUG","TUJ","TUP","TUR","TVD","TVG","TVM","TVS","TVV","TVY","TW7","TWA","TWD","TWG","TWJ","TWY","TXB","TY6","TYV","U1Y","U2A","U2D","U63","U8V","U97","U9A","U9D","U9G","U9J","U9M","UAP","UBH","UBO","UCD","UDC","UEA","V3M","V3P","V71","VDF","VG1","VJ1","VJ4","VKN","VTB","W9T","WIA","WKO","WKT","WOO","WT8","WUN","WZ1","WZ2","WZ4","X0X","X1P","X1X","X2F","X2Y","X34","X4S","X5S","X6N","X6X","X6Y","X6Z","XBP","XDP","XDX","XGP","XIL","XIQ","XKJ","XLF","XLS","XMM","XS2","XUL","XXM","XXR","XXX","XY6","XY9","XYB","XYF","XYL","XYP","XYS","XYT","XYZ","YDR","YIO","YJM","YKR","YO5","YX0","YX1","YYB","YYD","YYH","YYJ","YYK","YYM","YYQ","YYR","YZ0","YZT","Z0F","Z15","Z16","Z2D","Z2T","Z3K","Z3L","Z3Q","Z3U","Z4K","Z4R","Z4S","Z4U","Z4V","Z4W","Z4Y","Z57","Z5J","Z5L","Z61","Z6G","Z6H","Z6J","Z6W","Z8H","Z8T","Z9D","Z9E","Z9H","Z9K","Z9L","Z9M","Z9N","Z9W","ZB0","ZB1","ZB2","ZB3","ZCD","ZCZ","ZD0","ZDC","ZDM","ZDO","ZEE","ZEL","ZGE","ZMR","UMQ","SQD"]);var or={Blue:37052,Green:42577,Yellow:16765952,Orange:16021792,Pink:16162465,Purple:10830745,LightBlue:9424105,Brown:10582605,Red:15539236,Secondary:15854817};var aHe={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,10:10,11:11};function ice(e,t){return e===10?t===4?12:t===5?13:t===6?14:t===7?15:10:aHe[e]}var uE={abbr:"Unk",name:"Unknown",color:or.Secondary,type:10},xI=[{abbr:"Glc",name:"Glucose",color:or.Blue,type:0},{abbr:"Man",name:"Mannose",color:or.Green,type:0},{abbr:"Gal",name:"Galactose",color:or.Yellow,type:0},{abbr:"Gul",name:"Gulose",color:or.Orange,type:0},{abbr:"Alt",name:"Altrose",color:or.Pink,type:0},{abbr:"All",name:"Allose",color:or.Purple,type:0},{abbr:"Tal",name:"Talose",color:or.LightBlue,type:0},{abbr:"Ido",name:"Idose",color:or.Brown,type:0},{abbr:"GlcNAc",name:"N-Acetyl Glucosamine",color:or.Blue,type:1},{abbr:"ManNAc",name:"N-Acetyl Mannosamine",color:or.Green,type:1},{abbr:"GalNAc",name:"N-Acetyl Galactosamine",color:or.Yellow,type:1},{abbr:"GulNAc",name:"N-Acetyl Gulosamine",color:or.Orange,type:1},{abbr:"AltNAc",name:"N-Acetyl Altrosamine",color:or.Pink,type:1},{abbr:"AllNAc",name:"N-Acetyl Allosamine",color:or.Purple,type:1},{abbr:"TalNAc",name:"N-Acetyl Talosamine",color:or.LightBlue,type:1},{abbr:"IdoNAc",name:"N-Acetyl Idosamine",color:or.Brown,type:1},{abbr:"GlcN",name:"Glucosamine",color:or.Blue,type:2},{abbr:"ManN",name:"Mannosamine",color:or.Green,type:2},{abbr:"GalN",name:"Galactosamine",color:or.Yellow,type:2},{abbr:"GulN",name:"Gulosamine",color:or.Orange,type:2},{abbr:"AltN",name:"Altrosamine",color:or.Pink,type:2},{abbr:"AllN",name:"Allosamine",color:or.Purple,type:2},{abbr:"TalN",name:"Talosamine",color:or.LightBlue,type:2},{abbr:"IdoN",name:"Idosamine",color:or.Brown,type:2},{abbr:"GlcNS",name:"N-sulfo Glucosamine",color:or.Blue,type:2},{abbr:"GlcA",name:"Glucuronic Acid",color:or.Blue,type:3},{abbr:"ManA",name:"Mannuronic Acid",color:or.Green,type:3},{abbr:"GalA",name:"Galacturonic Acid",color:or.Yellow,type:3},{abbr:"GulA",name:"Guluronic Acid",color:or.Orange,type:3},{abbr:"AltA",name:"Altruronic Acid",color:or.Pink,type:3},{abbr:"AllA",name:"Alluronic Acid",color:or.Purple,type:3},{abbr:"TalA",name:"Taluronic Acid",color:or.LightBlue,type:3},{abbr:"IdoA",name:"Iduronic Acid",color:or.Brown,type:3},{abbr:"Qui",name:"Quinovose",color:or.Blue,type:4},{abbr:"Rha",name:"Rhamnose",color:or.Green,type:4},{abbr:"6dGul",name:"6-Deoxy Gulose",color:or.Orange,type:4},{abbr:"6dAlt",name:"6-Deoxy Altrose",color:or.Pink,type:4},{abbr:"6dTal",name:"6-Deoxy Talose",color:or.LightBlue,type:4},{abbr:"Fuc",name:"Fucose",color:or.Red,type:4},{abbr:"QuiNAc",name:"N-Acetyl Quinovosamine",color:or.Blue,type:5},{abbr:"RhaNAc",name:"N-Acetyl Rhamnosamine",color:or.Green,type:5},{abbr:"6dAltNAc",name:"N-Acetyl 6-Deoxy Altrosamine",color:or.Pink,type:5},{abbr:"6dTalNAc",name:"N-Acetyl 6-Deoxy Talosamine",color:or.LightBlue,type:5},{abbr:"FucNAc",name:"N-Acetyl Fucosamine",color:or.Red,type:5},{abbr:"AAT",name:"AAT",color:or.Red,type:5},{abbr:"Oli",name:"Olivose",color:or.Blue,type:6},{abbr:"Tyv",name:"Tyvelose",color:or.Green,type:6},{abbr:"Abe",name:"Abequose",color:or.Orange,type:6},{abbr:"Par",name:"Paratose",color:or.Pink,type:6},{abbr:"Dig",name:"Digitoxose",color:or.Purple,type:6},{abbr:"Col",name:"Colitose",color:or.LightBlue,type:6},{abbr:"Ara",name:"Arabinose",color:or.Green,type:7},{abbr:"Lyx",name:"Lyxose",color:or.Yellow,type:7},{abbr:"Xyl",name:"Xylose",color:or.Orange,type:7},{abbr:"Rib",name:"Ribose",color:or.Pink,type:7},{abbr:"Kdn",name:"Keto-Deoxy Nonulonic Acid",color:or.Green,type:8},{abbr:"Neu5Ac",name:"N-Acetyl Neuraminic Acid",color:or.Purple,type:8},{abbr:"Neu5Gc",name:"N-Glycolyl Neuraminic Acid",color:or.LightBlue,type:8},{abbr:"Neu",name:"Neuraminic Acid",color:or.Brown,type:8},{abbr:"Sia",name:"Sialic acid",color:or.Red,type:8},{abbr:"Pse",name:"Pseudaminic Acid",color:or.Green,type:9},{abbr:"Leg",name:"Legionaminic Acid",color:or.Yellow,type:9},{abbr:"Aci",name:"Acinetaminic Acid",color:or.Pink,type:9},{abbr:"4eLeg",name:"4-Epilegionaminic Acid",color:or.LightBlue,type:9},{abbr:"Bac",name:"Bacillosamine",color:or.Blue,type:10},{abbr:"LDmanHep",name:"L-Glycero-D-Manno Heptose",color:or.Green,type:10},{abbr:"Kdo",name:"Keto-Deoxy Octulonic Acid",color:or.Yellow,type:10},{abbr:"Dha",name:"3-Deoxy Lyxo-Heptulosaric Acid",color:or.Orange,type:10},{abbr:"DDmanHep",name:"D-Glycero-D-Manno-Heptose",color:or.Pink,type:10},{abbr:"MurNAc",name:"N-Acetyl Muramic Acid",color:or.Purple,type:10},{abbr:"MurNGc",name:"N-Glycolyl Muramic Acid",color:or.LightBlue,type:10},{abbr:"Mur",name:"Muramic Acid",color:or.Brown,type:10},{abbr:"K3O",name:"D-glycero-a-D-talo-oct-2-Ulosonic Acid",color:or.Red,type:10},{abbr:"dUA",name:"4-deoxy-4,5-didehydro iduronic acid",color:or.Secondary,type:10},{abbr:"Api",name:"Apicose",color:or.Green,type:11},{abbr:"Fru",name:"Fructose",color:or.Green,type:11},{abbr:"Tag",name:"Tagatose",color:or.Yellow,type:11},{abbr:"Sor",name:"Sorbose",color:or.Orange,type:11},{abbr:"Psi",name:"Psicose",color:or.Pink,type:11}],ace=(function(){let e=new Map;for(let t=0,r=xI.length;t<r;++t){let n=xI[t];e.set(n.abbr,n)}return e})(),sce=[["Glc-family",or.Blue],["Man-family",or.Green],["Gal-family",or.Yellow],["Gul-family",or.Orange],["Alt-family",or.Pink],["All-family",or.Purple],["Tal-family",or.LightBlue],["Ido-family",or.Brown],["Fuc-family",or.Red],["Generic/Unknown/Secondary",or.Secondary]],lce={Glc:["GLC","BGC","Z8T","TRE","MLR"],Man:["MAN","BMA"],Gal:["GLA","GAL","GZL","GXL","GIV"],Gul:["4GL","GL0","GUP","Z8H"],Alt:["Z6H","3MK","SHD"],All:["AFD","ALL","WOO","Z2D"],Tal:["ZEE","A5C","SDY"],Ido:["ZCD","Z0F","4N2"],GlcNAc:["NDG","NAG","NGZ"],ManNAc:["BM3","BM7"],GalNAc:["A2G","NGA","YYQ"],GulNAc:["LXB"],AltNAc:[],AllNAc:["NAA"],TalNAc:[],IdoNAc:["LXZ","HSQ"],GlcN:["PA1","GCS"],ManN:["95Z"],GalN:["X6X","1GN"],GulN:[],AltN:[],AllN:[],TalN:[],IdoN:[],GlcA:["GCU","BDP"],ManA:["MAV","BEM"],GalA:["ADA","GTR","GTK"],GulA:["LGU"],AltA:[],AllA:[],TalA:["X1X","X0X"],IdoA:["IDR"],Qui:["G6D","YYK"],Rha:["RAM","RM4","XXR"],"6dGul":["66O"],"6dAlt":[],"6dTal":[],Fuc:["FUC","FUL","FCA","FCB","GYE"],QuiNAc:["Z9W"],RhaNAc:[],"6dAltNAc":[],"6dTalNAc":[],FucNAc:["49T"],Oli:["DDA","RAE","Z5J"],Tyv:["TYV"],Abe:["ABE"],Par:["PZU"],Dig:["Z3U"],Col:[],Ara:["64K","ARA","ARB","AHR","FUB","BXY","BXX","SEJ"],Lyx:["LDY","Z4W"],Xyl:["XYS","XYP","XYZ","HSY","LXC"],Rib:["YYM","RIP","RIB","BDR","0MK","Z6J","32O"],Kdn:["KDM","KDN"],Neu5Ac:["SIA","SLB"],Neu5Gc:["NGC","NGE"],Neu:[],Sia:[],Pse:[],Leg:[],Aci:[],"4eLeg":[],Bac:[],LDmanHep:["GMH"],Kdo:["KDO"],Dha:[],DDmanHep:["289"],MurNAc:["MUB","AMU"],MurNGc:[],Mur:["1S4","MUR"],Api:["XXM"],Fru:["BDF","Z9N","FRU","LFR"],Tag:["T6T"],Sor:["SOE","UEA"],Psi:["PSV","SF6","SF9","TTV"]},uce={Glc:["AGLC","BGLC"],GlcNAc:["AGLCNA","BGLCNA","BGLCN0"],GlcA:["AGLCA","BGLCA","BGLCA0"],Man:["AMAN","BMAN"],Rha:["ARHM","BRHM"],Ara:["AARB","BARB"],Gal:["AGAL","BGAL"],GalNAc:["AGALNA","BGALNA"],Gul:["AGUL","BGUL"],Alt:["AALT","BALT"],All:["AALL","BALL"],Tal:["ATAL","BTAL"],Ido:["AIDO","BIDO"],IdoA:["AIDOA","BIDOA"],Fuc:["AFUC","BFUC"],Lyx:["ALYF","BLYF"],Xyl:["AXYL","BXYL","AXYF","BXYF"],Rib:["ARIB","BRIB"],Fru:["AFRU","BFRU"],Neu5Ac:["ANE5AC","BNE5AC"]},sHe={Glc:["0GA","0GB","1GA","1GB","2GA","2GB","3GA","3GB","4GA","4GB","6GA","6GB","ZGA","ZGB","YGA","YGB","XGA","XGB","WGA","WGB","VGA","VGB","UGA","UGB","TGA","TGB","SGA","SGB","RGA","RGB","QGA","QGB","PGA","PGB","0gA","0gB","1gA","1gB","2gA","2gB","3gA","3gB","4gA","4gB","6gA","6gB","ZgA","ZgB","YgA","YgB","XgA","XgB","WgA","WgB","VgA","VgB","UgA","UgB","TgA","TgB","SgA","SgB","RgA","RgB","QgA","QgB","PgA","PgB"],GlcNAc:["0YA","0YB","1YA","1YB","3YA","3YB","4YA","4YB","6YA","6YB","WYA","WYB","VYA","VYB","UYA","UYB","QYA","QYB","0yA","0yB","1yA","1yB","3yA","3yB","4yA","4yB","6yA","6yB","WyA","WyB","VyA","VyB","UyA","UyB","QyA","QyB","0YS","0Ys","3YS","3Ys","4YS","4Ys","6YS","6Ys","QYS","QYs","UYS","UYs","VYS","VYs","WYS","WYs","0yS","0ys","3yS","3ys","4yS","4ys"],GlcA:["0ZA","0ZB","1ZA","1ZB","2ZA","2ZB","3ZA","3ZB","4ZA","4ZB","ZZA","ZZB","YZA","YZB","WZA","WZB","TZA","TZB","0zA","0zB","1zA","1zB","2zA","2zB","3zA","3zB","4zA","4zB","ZzA","ZzB","YzA","YzB","WzA","WzB","TzA","TzB","TZBP","WZBP","YZBP","4ZBP","ZZBP","3ZBP","2ZBP","1ZBP","0ZBP","0ZF","1ZF","4ZF","0Zf","1Zf","4Zf"],GlcN:["0YN","3YN","4YN","6YN","WYN","VYN","UYN","QYN","3Yn","4Yn","WYn","0Yn","0YP","3YP","4YP","6YP","WYP","VYP","UYP","QYP","0Yp","3Yp","4Yp","WYp","QYN","WYN","VYN","3YN","UYN","4YN","6YN","1YN","0YN","QYn","VYn","WYn","3Yn","UYn","6Yn","4Yn","1Yn","0Yn","QYNP","WYNP","VYNP","3YNP","UYNP","4YNP","6YNP","1YNP","0YNP","QYnP","UYnP","VYnP","6YnP","WYnP","4YnP","3YnP","1YnP","0YnP"],Man:["0MA","0MB","1MA","1MB","2MA","2MB","3MA","3MB","4MA","4MB","6MA","6MB","ZMA","ZMB","YMA","YMB","XMA","XMB","WMA","WMB","VMA","VMB","UMA","UMB","TMA","TMB","SMA","SMB","RMA","RMB","QMA","QMB","PMA","PMB","0mA","0mB","1mA","1mB","2mA","2mB","3mA","3mB","4mA","4mB","6mA","6mB","ZmA","ZmB","YmA","YmB","XmA","XmB","WmA","WmB","VmA","VmB","UmA","UmB","TmA","TmB","SmA","SmB","RmA","RmB","QmA","QmB","PmA","PmB"],ManNAc:["0WA","0WB","1WA","1WB","3WA","3WB","4WA","4WB","6WA","6WB","WWA","WWB","VWA","VWB","UWA","UWB","QWA","QWB","0wA","0wB","1wA","1wB","3wA","3wB","4wA","4wB","6wA","6wB","WwA","WwB","VwA","VwB","UwA","UwB","QwA","QwB"],Ara:["0AA","0AB","1AA","1AB","2AA","2AB","3AA","3AB","4AA","4AB","ZAA","ZAB","YAA","YAB","WAA","WAB","TAA","TAB","0AD","0AU","1AD","1AU","2AD","2AU","3AD","3AU","5AD","5AU","ZAD","ZAU","0aA","0aB","1aA","1aB","2aA","2aB","3aA","3aB","4aA","4aB","ZaA","ZaB","YaA","YaB","WaA","WaB","TaA","TaB","0aD","0aU","1aD","1aU","2aD","2aU","3aD","3aU","5aD","5aU","ZaD","ZaU"],Gal:["0LA","0LB","1LA","1LB","2LA","2LB","3LA","3LB","4LA","4LB","6LA","6LB","ZLA","ZLB","YLA","YLB","XLA","XLB","WLA","WLB","VLA","VLB","ULA","ULB","TLA","TLB","SLA","SLB","RLA","RLB","QLA","QLB","PLA","PLB","0lA","0lB","1lA","1lB","2lA","2lB","3lA","3lB","4lA","4lB","6lA","6lB","ZlA","ZlB","YlA","YlB","XlA","XlB","WlA","WlB","VlA","VlB","UlA","UlB","TlA","TlB","SlA","SlB","RlA","RlB","QlA","QlB","PlA","PlB"],GalNAc:["0VA","0VB","1VA","1VB","3VA","3VB","4VA","4VB","6VA","6VB","WVA","WVB","VVA","VVB","UVA","UVB","QVA","QVB","0vA","0vB","1vA","1vB","3vA","3vB","4vA","4vB","6vA","6vB","WvA","WvB","VvA","VvB","UvA","UvB","QvA","QvB"],GalA:["0OA","0OB","1OA","1OB","2OA","2OB","3OA","3OB","4OA","4OB","ZOA","ZOB","YOA","YOB","WOA","WOB","TOA","TOB","0oA","0oB","1oA","1oB","2oA","2oB","3oA","3oB","4oA","4oB","ZoA","ZoB","YoA","YoB","WoA","WoB","ToA","ToB"],Gul:["0KA","0KB","1KA","1KB","2KA","2KB","3KA","3KB","4KA","4KB","6KA","6KB","ZKA","ZKB","YKA","YKB","XKA","XKB","WKA","WKB","VKA","VKB","UKA","UKB","TKA","TKB","SKA","SKB","RKA","RKB","QKA","QKB","PKA","PKB","0kA","0kB","1kA","1kB","2kA","2kB","3kA","3kB","4kA","4kB","6kA","6kB","ZkA","ZkB","YkA","YkB","XkA","XkB","WkA","WkB","VkA","VkB","UkA","UkB","TkA","TkB","SkA","SkB","RkA","RkB","QkA","QkB","PkA","PkB"],Alt:["0EA","0EB","1EA","1EB","2EA","2EB","3EA","3EB","4EA","4EB","6EA","6EB","ZEA","ZEB","YEA","YEB","XEA","XEB","WEA","WEB","VEA","VEB","UEA","UEB","TEA","TEB","SEA","SEB","REA","REB","QEA","QEB","PEA","PEB","0eA","0eB","1eA","1eB","2eA","2eB","3eA","3eB","4eA","4eB","6eA","6eB","ZeA","ZeB","YeA","YeB","XeA","XeB","WeA","WeB","VeA","VeB","UeA","UeB","TeA","TeB","SeA","SeB","ReA","ReB","QeA","QeB","PeA","PeB"],All:["0NA","0NB","1NA","1NB","2NA","2NB","3NA","3NB","4NA","4NB","6NA","6NB","ZNA","ZNB","YNA","YNB","XNA","XNB","WNA","WNB","VNA","VNB","UNA","UNB","TNA","TNB","SNA","SNB","RNA","RNB","QNA","QNB","PNA","PNB","0nA","0nB","1nA","1nB","2nA","2nB","3nA","3nB","4nA","4nB","6nA","6nB","ZnA","ZnB","YnA","YnB","XnA","XnB","WnA","WnB","VnA","VnB","UnA","UnB","TnA","TnB","SnA","SnB","RnA","RnB","QnA","QnB","PnA","PnB"],Tal:["0TA","0TB","1TA","1TB","2TA","2TB","3TA","3TB","4TA","4TB","6TA","6TB","ZTA","ZTB","YTA","YTB","XTA","XTB","WTA","WTB","VTA","VTB","UTA","UTB","TTA","TTB","STA","STB","RTA","RTB","QTA","QTB","PTA","PTB","0tA","0tB","1tA","1tB","2tA","2tB","3tA","3tB","4tA","4tB","6tA","6tB","ZtA","ZtB","YtA","YtB","XtA","XtB","WtA","WtB","VtA","VtB","UtA","UtB","TtA","TtB","StA","StB","RtA","RtB","QtA","QtB","PtA","PtB"],Ido:["0IA","0IB","1IA","1IB","2IA","2IB","3IA","3IB","4IA","4IB","6IA","6IB","ZIA","ZIB","YIA","YIB","XIA","XIB","WIA","WIB","VIA","VIB","UIA","UIB","TIA","TIB","SIA","SIB","RIA","RIB","QIA","QIB","PIA","PIB","0iA","0iB","1iA","1iB","2iA","2iB","3iA","3iB","4iA","4iB","6iA","6iB","ZiA","ZiB","YiA","YiB","XiA","XiB","WiA","WiB","ViA","ViB","UiA","UiB","TiA","TiB","SiA","SiB","RiA","RiB","QiA","QiB","PiA","PiB"],IdoA:["0UA","0UB","1UA","1UB","2UA","2UB","3UA","3UB","4UA","4UB","ZUA","ZUB","YUA","YUB","WUA","WUB","TUA","TUB","0uA","0uB","1uA","1uB","2uA","2uB","3uA","3uB","4uA","4uB","ZuA","ZuB","YuA","YuB","WuA","WuB","TuA","TuB","YuAP"],Fuc:["0FA","0FB","1FA","1FB","2FA","2FB","3FA","3FB","4FA","4FB","ZFA","ZFB","YFA","YFB","WFA","WFB","TFA","TFB","0fA","0fB","1fA","1fB","2fA","2fB","3fA","3fB","4fA","4fB","ZfA","ZfB","YfA","YfB","WfA","WfB","TfA","TfB"],Rha:["0HA","0HB","1HA","1HB","2HA","2HB","3HA","3HB","4HA","4HB","ZHA","ZHB","YHA","YHB","WHA","WHB","THA","THB","0hA","0hB","1hA","1hB","2hA","2hB","3hA","3hB","4hA","4hB","ZhA","ZhB","YhA","YhB","WhA","WhB","ThA","ThB"],Qui:["0QA","0QB","1QA","1QB","2QA","2QB","3QA","3QB","4QA","4QB","ZQA","ZQB","YQA","YQB","WQA","WQB","TQA","TQB","0qA","0qB","1qA","1qB","2qA","2qB","3qA","3qB","4qA","4qB","ZqA","ZqB","YqA","YqB","WqA","WqB","TqA","TqB"],Lyx:["0DA","0DB","1DA","1DB","2DA","2DB","3DA","3DB","4DA","4DB","ZDA","ZDB","YDA","YDB","WDA","WDB","TDA","TDB","0DD","0DU","1DD","1DU","2DD","2DU","3DD","3DU","5DD","5DU","ZDD","ZDU","0dA","0dB","1dA","1dB","2dA","2dB","3dA","3dB","4dA","4dB","ZdA","ZdB","YdA","YdB","WdA","WdB","TdA","TdB","0dD","0dU","1dD","1dU","2dD","2dU","3dD","3dU","5dD","5dU","ZdD","ZdU"],Xyl:["0XA","0XB","1XA","1XB","2XA","2XB","3XA","3XB","4XA","4XB","ZXA","ZXB","YXA","YXB","WXA","WXB","TXA","TXB","0XD","0XU","1XD","1XU","2XD","2XU","3XD","3XU","5XD","5XU","ZXD","ZXU","0xA","0xB","1xA","1xB","2xA","2xB","3xA","3xB","4xA","4xB","ZxA","ZxB","YxA","YxB","WxA","WxB","TxA","TxB","0xD","0xU","1xD","1xU","2xD","2xU","3xD","3xU","5xD","5xU","ZxD","ZxU"],Rib:["0RA","0RB","1RA","1RB","2RA","2RB","3RA","3RB","4RA","4RB","ZRA","ZRB","YRA","YRB","WRA","WRB","TRA","TRB","0RD","0RU","1RD","1RU","2RD","2RU","3RD","3RU","5RD","5RU","ZRD","ZRU","0rA","0rB","1rA","1rB","2rA","2rB","3rA","3rB","4rA","4rB","ZrA","ZrB","YrA","YrB","WrA","WrB","TrA","TrB","0rD","0rU","1rD","1rU","2rD","2rU","3rD","3rU","5rD","5rU","ZrD","ZrU"],Fru:["0CA","0CB","1CA","1CB","2CA","2CB","3CA","3CB","4CA","4CB","5CA","5CB","WCA","WCB","0CD","0CU","1CD","1CU","2CD","2CU","3CD","3CU","4CD","4CU","6CD","6CU","WCD","WCU","VCD","VCU","UCD","UCU","QCD","QCU","0cA","0cB","1cA","1cB","2cA","2cB","3cA","3cB","4cA","4cB","5cA","5cB","WcA","WcB","0cD","0cU","1cD","1cU","2cD","2cU","3cD","3cU","4cD","4cU","6cD","6cU","WcD","WcU","VcD","VcU","UcD","UcU","QcD","QcU"],Tag:["0JA","0JB","1JA","1JB","2JA","2JB","3JA","3JB","4JA","4JB","5JA","5JB","WJA","WJB","0JD","0JU","1JD","1JU","2JD","2JU","3JD","3JU","4JD","4JU","6JD","6JU","WJD","WJU","VJD","VJU","UJD","UJU","QJD","QJU","0jA","0jB","1jA","1jB","2jA","2jB","3jA","3jB","4jA","4jB","5jA","5jB","WjA","WjB","0jD","0jU","1jD","1jU","2jD","2jU","3jD","3jU","4jD","4jU","6jD","6jU","WjD","WjU","VjD","VjU","UjD","UjU","QjD","QjU"],Sor:["0BA","0BB","1BA","1BB","2BA","2BB","3BA","3BB","4BA","4BB","5BA","5BB","WBA","WBB","0BD","0BU","1BD","1BU","2BD","2BU","3BD","3BU","4BD","4BU","6BD","6BU","WBD","WBU","VBD","VBU","UBD","UBU","QBD","QBU","0bA","0bB","1bA","1bB","2bA","2bB","3bA","3bB","4bA","4bB","5bA","5bB","WbA","WbB","0bD","0bU","1bD","1bU","2bD","2bU","3bD","3bU","4bD","4bU","6bD","6bU","WbD","WbU","VbD","VbU","UbD","UbU","QbD","QbU"],Psi:["0PA","0PB","1PA","1PB","2PA","2PB","3PA","3PB","4PA","4PB","5PA","5PB","WPA","WPB","0PD","0PU","1PD","1PU","2PD","2PU","3PD","3PU","4PD","4PU","6PD","6PU","WPD","WPU","VPD","VPU","UPD","UPU","QPD","QPU","0pA","0pB","1pA","1pB","2pA","2pB","3pA","3pB","4pA","4pB","5pA","5pB","WpA","WpB","0pD","0pU","1pD","1pU","2pD","2pU","3pD","3pU","4pD","4pU","6pD","6pU","WpD","WpU","VpD","VpU","UpD","UpU","QpD","QpU"],Neu5Ac:["0SA","0SB","4SA","4SB","7SA","7SB","8SA","8SB","9SA","9SB","ASA","ASB","BSA","BSB","CSA","CSB","DSA","DSB","ESA","ESB","FSA","FSB","GSA","GSB","HSA","HSB","ISA","ISB","JSA","JSB","KSA","KSB","0sA","0sB","4sA","4sB","7sA","7sB","8sA","8sB","9sA","9sB","AsA","AsB","BsA","BsB","CsA","CsB","DsA","DsB","EsA","EsB","FsA","FsB","GsA","GsB","HsA","HsB","IsA","IsB","JsA","JsB","KsA","KsB"],Neu5Gc:["0GL","4GL","7GL","8GL","9GL","CGL","DGL","EGL","FGL","GGL","HGL","IGL","JGL","KGL","0gL","4gL","7gL","8gL","9gL","AgL","BgL","CgL","DgL","EgL","FgL","GgL","HgL","IgL","JgL","KgL"],Tyv:["YTV","4TV","2TV","1TV","0TV","YTv","4Tv","2Tv","1Tv","0Tv"],Abe:["YAE","2AE","4AE","1AE","0AE","YAe","4Ae","2Ae","1Ae","0Ae"],Bac:["0BC","1BC","3BC","0bC","1bC","3bC"],Kdn:["0KN","4KN","5KN","7KN","8KN","9KN","AKN","BKN","CKN","DKN","EKN","FKN","GKN","HKN","IKN","JKN","KKN","LKN","MKN","NKN","OKN","PKN","QKN","RKN","SKN","TKN","UKN","VKN","WKN","XKN","YKN","0Kn","4Kn","5Kn","7Kn","8Kn","9Kn","AKn","BKn","CKn","DKn","EKn","FKn","GKn","HKn","IKn","JKn","KKn","LKn","MKn","NKn","OKn","PKn","QKn","RKn","SKn","TKn","UKn","VKn","WKn","XKn","YKn"],Kdo:["0KO","4KO","5KO","7KO","8KO","AKO","BKO","CKO","DKO","EKO","FKO","GKO","HKO","IKO","JKO","KKO","0Ko","4Ko","5Ko","7Ko","8Ko","AKo","BKo","CKo","DKo","EKo","FKo","GKo","HKo","IKo","JKo","KKo"],QuiNAc:["0QF","1QF","3QF","0Qf","1Qf","3Qf"],AAT:["0FC","1FC","3FC","0Fc","1Fc","3Fc"],Ara4N:["ZaN","3aN","2aN","1aN","0aN","Zan","3an","2an","1an","0an"],Aci:["JeC","8eC","4eC","2eC","0eC","Jec","8ec","4ec","2ec","0ec"],Leg:["JLG","8LG","4LG","2LG","0LG","JLg","8Lg","4Lg","2Lg","0Lg"],Pse:["JmP","8mP","4mP","2mP","0mP","Jmp","8mp","4mp","2mp","0mp"],Fus:["EgF","HgF","JgF","8gF","KgF","7gF","4gF","2gF","0gF","Egf","Hgf","Jgf","8gf","Kgf","7gf","4gf","2gf","0gf"],DDmanpHep:["ODH","NDH","LDH","MDH","KDH","7DH","PDH","SDH","RDH","XDH","QDH","VDH","UDH","6DH","TDH","ZDH","YDH","2DH","WDH","3DH","4DH","1DH","ODh","NDh","LDh","MDh","KDh","7Dh","PDh","SDh","RDh","XDh","QDh","VDh","UDh","6Dh","TDh","ZDh","YDh","2Dh","WDh","3Dh","4Dh","1Dh"],LDmanpHep:["OLH","NLH","LLH","MLH","KLH","7LH","PLH","SLH","RLH","XLH","QLH","VLH","ULH","6LH","TLH","ZLH","YLH","2LH","WLH","3LH","4LH","1LH","OLh","NLh","LLh","MLh","KLh","7Lh","PLh","SLh","RLh","XLh","QLh","VLh","ULh","6Lh","TLh","ZLh","YLh","2Lh","WLh","3Lh","4Lh","1Lh"],K3O:["dKX","EKX","hKX","HKX","jKX","JKX","pKX","8KX","MKX","kKX","KKX","qKX","7KX","xKX","WKX","tKX","3KX","sKX","4KX","5KX","2KX","0KX","dKx","EKx","hKx","HKx","jKx","JKx","pKx","8Kx","MKx","kKx","KKx","qKx","7Kx","xKx","WKx","tKx","3Kx","sKx","4Kx","5Kx","2Kx","0Kx"],MurNAc:["UMR","4MR","6MR","1MR","0MR","UMr","4Mr","6Mr","1Mr","0Mr"],Oli:["WdR","4dR","3dR","1dR","0dR"],dUA:["Z45","345","245","145","045"],GlcNS:["QYS","UYS","VYS","6YS","WYS","4YS","3YS","1YS","0YS","QYs","UYs","VYs","6Ys","WYs","4Ys","3Ys","1Ys","0Ys","QyS","UyS","VyS","6yS","WyS","4yS","3yS","1yS","0yS","Qys","Uys","Vys","6ys","Wys","4ys","3ys","1ys","0ys"]},cce=(function(){let e=new Map;for(let t=0,r=xI.length;t<r;++t){let n=xI[t],o=lce[n.abbr];if(o)for(let a=0,s=o.length;a<s;++a)e.set(o[a],n);let i=uce[n.abbr];if(i)for(let a=0,s=i.length;a<s;++a)e.set(i[a],n)}return l6.forEach(t=>{e.has(t)||e.set(t,uE)}),e})(),lHe=(function(){let e=new Map;for(let t=0,r=xI.length;t<r;++t){let n=xI[t],o=lce[n.abbr];if(o)for(let s=0,l=o.length;s<l;++s)e.set(o[s],n);let i=uce[n.abbr];if(i)for(let s=0,l=i.length;s<l;++s)e.set(i[s],n);let a=sHe[n.abbr];if(a)for(let s=0,l=a.length;s<l;++s)e.has(a[s])||e.set(a[s],n)}return l6.forEach(t=>{e.has(t)||e.set(t,uE)}),e})();function mce(e){fp=e==="default"?cce:lHe}var fp=cce;var go;(d=>{function e(p){return Array.from(p.values())}d.toArray=e;function t(p,h){if(p===h)return!0;if(p.size<h.size)return!1;for(let f of h)if(!p.has(f))return!1;return!0}d.isSuperset=t;function r(p,...h){for(let f=0;f<h.length;f++)for(let g of h[f])p.add(g);return p}d.add=r;function n(p,h){let f=new Set(p);if(p===h)return f;for(let g of h)f.add(g);return f}d.union=n;function o(...p){if(p.length===0)return new Set;let h=new Set(p[0]);for(let f=1,g=p.length;f<g;f++)for(let y of p[f])h.add(y);return h}d.unionMany=o;function i(p){if(p.length===0)return new Set;let h=new Set(p[0]);for(let f=1;f<p.length;f++)for(let g of p[f])h.add(g);return h}d.unionManyArrays=i;function a(p,h){if(p===h)return new Set(p);let f=new Set;for(let g of h)p.has(g)&&f.add(g);return f}d.intersection=a;function s(p,h){if(p===h)return p.size>0;p.size<h.size&&([p,h]=[h,p]);for(let f of h)if(p.has(f))return!0;return!1}d.areIntersecting=s;function l(p,h){if(p===h)return p.size;p.size<h.size&&([p,h]=[h,p]);let f=0;for(let g of h)p.has(g)&&(f+=1);return f}d.intersectionSize=l;function u(p,h){if(p===h)return new Set;let f=new Set(p);for(let g of h)f.delete(g);return f}d.difference=u;function c(p,h){if(p===h)return 0;let f=p.size;for(let g of p)h.has(g)&&(f-=1);return f}d.differenceSize=c;function m(p,h){if(p===h)return!0;if(p.size!==h.size)return!1;for(let f of h)if(!p.has(f))return!1;return!0}d.areEqual=m})(go||={});var u6=new Set(["DAPC","DBPC","DFPC","DGPC","DIPC","DLPC","DNPC","DOPC","DPPC","DRPC","DTPC","DVPC","DXPC","DYPC","LPPC","PAPC","PEPC","PGPC","PIPC","POPC","PRPC","PUPC","DAPE","DBPE","DFPE","DGPE","DIPE","DLPE","DNPE","DOPE","DPPE","DRPE","DTPE","DUPE","DVPE","DXPE","DYPE","LPPE","PAPE","PGPE","PIPE","POPE","PQPE","PRPE","PUPE","DAPS","DBPS","DFPS","DGPS","DIPS","DLPS","DNPS","DOPS","DPPS","DRPS","DTPS","DUPS","DVPS","DXPS","DYPS","LPPS","PAPS","PGPS","PIPS","POPS","PQPS","PRPS","PUPS","DAPA","DBPA","DFPA","DGPA","DIPA","DLPA","DNPA","DOPA","DPPA","DRPA","DTPA","DVPA","DXPA","DYPA","LPPA","PAPA","PGPA","PIPA","POPA","PRPA","PUPA","DAPG","DBPG","DFPG","DGPG","DIPG","DLPG","DNPG","DOPG","DPPG","DRPG","DTPG","DVPG","DXPG","DYPG","LPPG","PAPG","PGPG","PIPG","POPG","PRPG","DMPC","DPP","DPPI","PAPI","PIPI","POP","POPI","PUPI","PVP","PVPI","PADG","PIDG","PODG","PUDG","PVDG","APC","CPC","IPC","LPC","OPC","PPC","TPC","UPC","VPC","BNSM","DBSM","DPSM","DXSM","PGSM","PNSM","POSM","PVSM","XNSM","DPCE","DXCE","PNCE","XNCE"]);var c6=new Set(["118","119","543","1AL","1CU","2FK","2HP","2OF","3CO","3MT","3NI","3OF","3P8","4MO","4PU","4TI","6MO","ACT","AG","AL","ALF","AM","ATH","AU","AU3","AUC","AZI","BA","BCT","BEF","BF4","BO4","BR","BS3","BSY","CA","CAC","CD","CD1","CD3","CD5","CE","CF","CHT","CL","CO","CO3","CO5","CON","CR","CS","CSB","CU","CU1","CU3","CUA","CUZ","CYN","DME","DMI","DSC","DTI","DY","E4N","EDR","EMC","ER3","EU","EU3","F","FE","FE2","FPO","GA","GD3","GEP","HAI","HG","HGC","IN","IOD","IR","IR3","IRI","IUM","K","KO4","LA","LCO","LCP","LI","LU","MAC","MG","MH2","MH3","MLI","MMC","MN","MN3","MN5","MN6","MO1","MO2","MO3","MO4","MO5","MO6","MOO","MOS","MOW","MW1","MW2","MW3","NA","NA2","NA5","NA6","NAO","NAW","ND","NET","NH4","NI","NI1","NI2","NI3","NO2","NO3","NRU","NT3","O4M","OAA","OC1","OC2","OC3","OC4","OC5","OC6","OC7","OC8","OCL","OCM","OCN","OCO","OF1","OF2","OF3","OH","OS","OS4","OXL","PB","PBM","PD","PDV","PER","PI","PO3","PO4","PR","PT","PT4","PTN","RB","RH3","RHD","RHF","RU","SB","SCN","SE4","SEK","SM","SMO","SO3","SO4","SR","T1A","TB","TBA","TCN","TEA","TH","THE","TL","TMA","TRA","UNX","V","VN3","VO4","W","WO5","Y1","YB","YB2","YH","YT3","ZCM","ZN","ZN2","ZN3","ZNO","ZO3","ZR","ZTM","NCO","OHX"]);var uHe=(function(){let e=Object.create(null),t=[];for(let r=65;r<=90;r++)t[t.length]=String.fromCharCode(r);for(let r=97;r<=122;r++)t[t.length]=String.fromCharCode(r);for(let r=48;r<=57;r++)t[t.length]=String.fromCharCode(r);for(let r of t){e[r]=r.toUpperCase();for(let n of t){e[r+n]=(r+n).toUpperCase();for(let o of t)e[r+n+o]=(r+n+o).toUpperCase()}}return e})();function Nf(e){return uHe[e]||e.toUpperCase()}var dce=new Map([[1,"H"],[2,"He"],[3,"Li"],[4,"Be"],[5,"B"],[6,"C"],[7,"N"],[8,"O"],[9,"F"],[10,"Ne"],[11,"Na"],[12,"Mg"],[13,"Al"],[14,"Si"],[15,"P"],[16,"S"],[17,"Cl"],[18,"Ar"],[19,"K"],[20,"Ca"],[21,"Sc"],[22,"Ti"],[23,"V"],[24,"Cr"],[25,"Mn"],[26,"Fe"],[27,"Co"],[28,"Ni"],[29,"Cu"],[30,"Zn"],[31,"Ga"],[32,"Ge"],[33,"As"],[34,"Se"],[35,"Br"],[36,"Kr"],[37,"Rb"],[38,"Sr"],[39,"Y"],[40,"Zr"],[41,"Nb"],[42,"Mo"],[43,"Tc"],[44,"Ru"],[45,"Rh"],[46,"Pd"],[47,"Ag"],[48,"Cd"],[49,"In"],[50,"Sn"],[51,"Sb"],[52,"Te"],[53,"I"],[54,"Xe"],[55,"Cs"],[56,"Ba"],[57,"La"],[58,"Ce"],[59,"Pr"],[60,"Nd"],[61,"Pm"],[62,"Sm"],[63,"Eu"],[64,"Gd"],[65,"Tb"],[66,"Dy"],[67,"Ho"],[68,"Er"],[69,"Tm"],[70,"Yb"],[71,"Lu"],[72,"Hf"],[73,"Ta"],[74,"W"],[75,"Re"],[76,"Os"],[77,"Ir"],[78,"Pt"],[79,"Au"],[80,"Hg"],[81,"Tl"],[82,"Pb"],[83,"Bi"],[84,"Po"],[85,"At"],[86,"Rn"],[87,"Fr"],[88,"Ra"],[89,"Ac"],[90,"Th"],[91,"Pa"],[92,"U"],[93,"Np"],[94,"Pu"],[95,"Am"],[96,"Cm"],[97,"Bk"],[98,"Cf"],[99,"Es"],[100,"Fm"],[101,"Md"],[102,"No"],[103,"Lr"],[104,"Rf"],[105,"Db"],[106,"Sg"],[107,"Bh"],[108,"Hs"],[109,"Mt"],[110,"Ds"],[111,"Rg"],[112,"Cn"],[113,"Uut"],[114,"Fl"],[115,"Uup"],[116,"Lv"],[117,"Uus"],[118,"Uuo"]].map(e=>[e[0],Nf(e[1])]));function pce(e){return dce.has(e)?dce.get(e):Nf("H")}var fce={0:{trace:new Set,directionFrom:new Set,directionTo:new Set,backboneStart:new Set,backboneEnd:new Set,coarseBackbone:new Set},1:{trace:new Set(["CA"]),directionFrom:new Set(["C"]),directionTo:new Set(["O","OC1","O1","OX1","OXT","OT1"]),backboneStart:new Set(["N"]),backboneEnd:new Set(["C"]),coarseBackbone:new Set(["CA","CA1","BB","BAS"])},2:{trace:new Set(["CA"]),directionFrom:new Set(["C"]),directionTo:new Set(["O"]),backboneStart:new Set(["N"]),backboneEnd:new Set(["CD"]),coarseBackbone:new Set(["CA"])},3:{trace:new Set(["CA"]),directionFrom:new Set(["C"]),directionTo:new Set(["O"]),backboneStart:new Set(["N"]),backboneEnd:new Set(["CG"]),coarseBackbone:new Set(["CA"])},4:{trace:new Set(["O3'","O3*"]),directionFrom:new Set(["C4'","C4*"]),directionTo:new Set(["C3'","C3*"]),backboneStart:new Set(["P"]),backboneEnd:new Set(["O3'","O3*"]),coarseBackbone:new Set(["P"])},5:{trace:new Set(["O3'","O3*"]),directionFrom:new Set(["C3'","C3*"]),directionTo:new Set(["C1'","C1*"]),backboneStart:new Set(["P"]),backboneEnd:new Set(["O3'","O3*"]),coarseBackbone:new Set(["P"])},6:{trace:new Set(["N4'","N4*"]),directionFrom:new Set(["N4'","N4*"]),directionTo:new Set(["C7'","C7*"]),backboneStart:new Set(["N1'","N1*"]),backboneEnd:new Set(["C'","C*"]),coarseBackbone:new Set(["P"])}},Id=new Set(["CA","C","N","O","O1","O2","OC1","OC2","OT1","OT2","OX1","OXT","H","H1","H2","H3","HA","HN","HXT","BB"]),CI=new Set(["P","OP1","OP2","HOP2","HOP3","O2'","O3'","O4'","O5'","C1'","C2'","C3'","C4'","C5'","H1'","H2'","H2''","HO2'","H3'","H4'","H5'","H5''","HO3'","HO5'","O2*","O3*","O4*","O5*","C1*","C2*","C3*","C4*","C5*"]),hce=new Set(["d-peptide linking","d-peptide nh3 amino terminus","d-peptide cooh carboxy terminus","d-gamma-peptide, c-delta linking","d-beta-peptide, c-gamma linking"]),gce=new Set(["l-peptide linking","l-peptide nh3 amino terminus","l-peptide cooh carboxy terminus","l-gamma-peptide, c-delta linking","l-beta-peptide, c-gamma linking"]),cHe=new Set(["d-gamma-peptide, c-delta linking","l-gamma-peptide, c-delta linking"]),mHe=new Set(["d-beta-peptide, c-gamma linking","l-beta-peptide, c-gamma linking"]),dHe=new Set(["d-peptide nh3 amino terminus","d-peptide cooh carboxy terminus","l-peptide nh3 amino terminus","l-peptide cooh carboxy terminus"]),yce=new Set(["peptide linking","peptide-like"]),pHe=go.unionMany(hce,gce,yce),bce=new Set(["dna linking","l-dna linking","dna oh 5 prime terminus","dna oh 3 prime terminus"]),xce=new Set(["rna linking","l-rna linking","rna oh 5 prime terminus","rna oh 3 prime terminus"]),Cce=go.unionMany(new Set(["d-saccharide, beta linking","l-saccharide, beta linking","d-saccharide, alpha linking","l-saccharide, alpha linking","l-saccharide","d-saccharide","saccharide"]),new Set(["d-saccharide 1,4 and 1,4 linking","l-saccharide 1,4 and 1,4 linking","d-saccharide 1,4 and 1,6 linking","l-saccharide 1,4 and 1,6 linking"])),fHe=new Set(["non-polymer","other"]),hHe=new Set(["ion"]),gHe=new Set(["lipid"]),SI=new Set(["SOL","WAT","HOH","H2O","W","DOD","D3O","TIP","TIP3","TIP4","SPC"]),cE=new Set(["HIS","ARG","LYS","ILE","PHE","LEU","TRP","ALA","MET","PRO","CYS","ASN","VAL","GLY","SER","GLN","TYR","ASP","GLU","THR","SEC","PYL","UNK","MSE","SEP","TPO","PTR","PCA","HYP","HSD","HSE","HSP","LSN","ASPP","GLUP","HID","HIE","HIP","LYN","ASH","GLH"]),Sce=new Set(["DAL","DAR","DSG","DAS","DCY","DGL","DGN","DHI","DIL","DLE","DLY","MED","DPN","DPR","DSN","DTH","DTR","DTY","DVA","DNE"]),MS=go.unionMany(cE,Sce),vce=new Set(["NME","ACE","NH2","FOR","FMT"]),vI=new Set(["A","C","T","G","I","U","N"]),II=new Set(["DA","DC","DT","DG","DI","DU","DN"]),m6=new Set(["APN","CPN","TPN","GPN"]),yHe=new Set(["A","G","I","DA","DG","DI","APN","GPN"]),bHe=new Set(["C","T","U","DC","DT","DU","CPN","TPN"]),BS=go.unionMany(vI,II,m6),Ice=e=>yHe.has(e.toUpperCase()),Ace=e=>bHe.has(e.toUpperCase()),Zy=go.unionMany(MS,BS);function Ql(e,t){return t=t.toUpperCase(),m6.has(t)?8:pHe.has(e)?5:xce.has(e)?6:bce.has(e)?7:Cce.has(e)?9:SI.has(t)?2:c6.has(t)?3:u6.has(t)?4:fHe.has(e)?fp.has(t)?9:MS.has(t)?5:vI.has(t)?6:II.has(t)?7:1:0}function Tce(e,t){return t===5?cHe.has(e)?2:mHe.has(e)?3:dHe.has(e)?0:1:t===6?4:t===7?5:t===8?6:0}function d6(e){return e=e.toUpperCase(),MS.has(e)?"peptide linking":vI.has(e)?"rna linking":II.has(e)?"dna linking":fp.has(e)?"saccharide":"other"}function Pce(e){return{formula:"",formula_weight:0,id:e,name:e,mon_nstd_flag:Zy.has(e)?"y":"n",pdbx_synonyms:[],type:d6(e)}}function _ce(e){return e=e.toUpperCase(),SI.has(e)?"water":Zy.has(e)?"polymer":fp.has(e)?"branched":"non-polymer"}function Rce(e,t){return e=e.toUpperCase(),gce.has(t)?"polypeptide(L)":hce.has(t)?"polypeptide(D)":xce.has(t)?"polyribonucleotide":bce.has(t)?"polydeoxyribonucleotide":Cce.has(t)||fp.has(e)?"oligosaccharide":m6.has(e)?"peptide nucleic acid":cE.has(e)?"polypeptide(L)":Sce.has(e)?"polypeptide(D)":vI.has(e)?"polyribonucleotide":II.has(e)?"polydeoxyribonucleotide":hHe.has(t)||c6.has(e)?"ion":gHe.has(t)||u6.has(e)?"lipid":yce.has(t)?"peptide-like":"other"}function eC(e){return pa(e)||p6(e)}function pa(e){return e===7||e===6||e===8}function p6(e){return e===5}var rr;(s=>{s.is=Ia.has,s.create=Ia.create;let r;(L=>(L[L.None=0]="None",L[L.DoubleHelix=1]="DoubleHelix",L[L.Helix=2]="Helix",L[L.Beta=4]="Beta",L[L.Bend=8]="Bend",L[L.Turn=16]="Turn",L[L.LeftHanded=32]="LeftHanded",L[L.RightHanded=64]="RightHanded",L[L.ClassicTurn=128]="ClassicTurn",L[L.InverseTurn=256]="InverseTurn",L[L.HelixOther=512]="HelixOther",L[L.Helix27=1024]="Helix27",L[L.Helix3Ten=2048]="Helix3Ten",L[L.HelixAlpha=4096]="HelixAlpha",L[L.HelixGamma=8192]="HelixGamma",L[L.HelixOmega=16384]="HelixOmega",L[L.HelixPi=32768]="HelixPi",L[L.HelixPolyproline=65536]="HelixPolyproline",L[L.DoubleHelixOther=131072]="DoubleHelixOther",L[L.DoubleHelixZ=262144]="DoubleHelixZ",L[L.DoubleHelixA=524288]="DoubleHelixA",L[L.DoubleHelixB=1048576]="DoubleHelixB",L[L.BetaOther=2097152]="BetaOther",L[L.BetaStrand=4194304]="BetaStrand",L[L.BetaSheet=8388608]="BetaSheet",L[L.BetaBarell=16777216]="BetaBarell",L[L.TurnOther=33554432]="TurnOther",L[L.Turn1=67108864]="Turn1",L[L.Turn2=134217728]="Turn2",L[L.Turn3=268435456]="Turn3",L[L.NA=536870912]="NA"))(r=s.Flag||={}),s.SecondaryStructureMmcif={helx_lh_27_p:1058,helx_lh_3t_p:2082,helx_lh_al_p:4130,helx_lh_a_n:524321,helx_lh_b_n:1048609,helx_lh_ga_p:8226,helx_lh_n:33,helx_lh_om_p:16418,helx_lh_ot_n:131105,helx_lh_ot_p:546,helx_lh_p:34,helx_lh_pi_p:32802,helx_lh_pp_p:65570,helx_lh_z_n:262177,helx_n:1,helx_ot_n:1,helx_ot_p:2,helx_p:2,helx_rh_27_p:1090,helx_rh_3t_p:2114,helx_rh_al_p:4162,helx_rh_a_n:524353,helx_rh_b_n:1048641,helx_rh_ga_p:8258,helx_rh_n:65,helx_rh_om_p:16450,helx_rh_ot_n:131137,helx_rh_ot_p:578,helx_rh_p:66,helx_rh_pi_p:32834,helx_rh_pp_p:65602,helx_rh_z_n:262209,strn:4194308,turn_ot_p:33554448,turn_p:16,turn_ty1p_p:67109136,turn_ty1_p:67109008,turn_ty2p_p:134218e3,turn_ty2_p:134217872,turn_ty3p_p:268435728,turn_ty3_p:268435600,bend:8,other:0},s.SecondaryStructurePdb={1:4162,2:16450,3:32834,4:8258,5:2114,6:4130,7:16418,8:8226,9:1026,10:65538},s.SecondaryStructureStride={H:4098,G:2050,I:32770,E:8388612,B:4194308,T:16,C:536870912},s.SecondaryStructureDssp={H:4098,B:4194308,E:8388612,G:2050,I:32770,T:16,S:8}})(rr||={});var xt;(u=>{u.is=Ia.has;let t;(y=>(y[y.None=0]="None",y[y.Covalent=1]="Covalent",y[y.MetallicCoordination=2]="MetallicCoordination",y[y.HydrogenBond=4]="HydrogenBond",y[y.Disulfide=8]="Disulfide",y[y.Aromatic=16]="Aromatic",y[y.Computed=32]="Computed"))(t=u.Flag||={});function r(c){return Ia.create(c)}u.create=r;function n(c){return(c&1)!==0}u.isCovalent=n;function o(c){return c===Math.pow(2,6)-1}u.isAll=o,u.Names={covalent:1,"metal-coordination":2,"hydrogen-bond":4,disulfide:8,aromatic:16,computed:32};function a(c){return c in u.Names}u.isName=a;function s(c){switch(c){case"covalent":return 1;case"metal-coordination":return 2;case"hydrogen-bond":return 4;case"disulfide":return 8;case"aromatic":return 16;case"computed":return 32}}u.fromName=s;function l(c){let m=0;for(let d=0,p=c.length;d<p;++d)m|=s(c[d]);return m}u.fromNames=l})(xt||={});var mE={ALA:[.17,.5,.33],ARG:[.81,1.81,1],ASN:[.42,.85,.43],ASP:[1.23,3.64,2.41],ASH:[-.07,.43,.5],CYS:[-.24,-.02,.22],GLN:[.58,.77,.19],GLU:[2.02,3.63,1.61],GLH:[-.01,.11,.12],GLY:[.01,1.15,1.14],HIS:[.17,.11,-.06],ILE:[-.31,-1.12,-.81],LEU:[-.56,-1.25,-.69],LYS:[.99,2.8,1.81],MET:[-.23,-.67,-.44],PHE:[-1.13,-1.71,-.58],PRO:[.45,.14,-.31],SER:[.13,.46,.33],THR:[.14,.25,.11],TRP:[-1.85,-2.09,-.24],TYR:[-.94,-.71,.23],VAL:[.07,-.46,-.53],HSD:[.17,.11,-.06],HSE:[.17,.11,-.06],HSP:[.96,2.33,1.37],HID:[.17,.11,-.06],HIE:[.17,.11,-.06],HIP:[.96,2.33,1.37]};function CHe(e,t,r,n){let o=new xs.EdgeBuilder(n,e,t),i=new Int32Array(o.slotCount),a=new Array(o.slotCount),s=new Array(o.slotCount),l=new Int8Array(o.slotCount),u=new Array(o.slotCount),c=new Array(o.slotCount);for(let m=0,d=o.edgeCount;m<d;m++)o.addNextEdge(),o.assignProperty(i,r.key?r.key[m]:-1),o.assignDirectedProperty(a,r.operatorA?r.operatorA[m]:-1,s,r.operatorB?r.operatorB[m]:-1),o.assignProperty(l,r.order?r.order[m]:1),o.assignProperty(u,r.distance?r.distance[m]:-1),o.assignProperty(c,r.flag?r.flag[m]:xt.Flag.Covalent);return o.createGraph({key:i,operatorA:a,operatorB:s,order:l,distance:u,flag:c})}var Xo;(i=>{i.Descriptor={name:"index_pair_bonds"},i.Provider=_l.create(i.Descriptor,{asDynamic:!0}),i.DefaultProps={maxDistance:-1,cacheable:!0};function n(a,s={}){let l={...i.DefaultProps,...s},{pairs:u,count:c}=a,m=u.indexA.toArray(),d=u.indexB.toArray(),p=u.key&&u.key.toArray(),h=u.operatorA&&u.operatorA.toArray(),f=u.operatorB&&u.operatorB.toArray(),g=u.order&&u.order.toArray(),y=u.distance&&u.distance.toArray(),x=u.flag&&u.flag.toArray(),S=!1;if(h&&f){S=!0;for(let A=0,P=h.length;A<P;++A)if(h[A]===-1||f[A]===-1){S=!1;break}}let I=CHe(m,d,{key:p,operatorA:h,operatorB:f,order:g,distance:y,flag:x},c),v=new Map;if(S){let{operatorA:A,operatorB:P}=I.edgeProps;for(let T=0,R=A.length;T<R;++T)if(A[T]===P[T]){let w=A[T];v.has(w)?v.get(w).push(T):v.set(w,[T])}}return{bonds:I,maxDistance:l.maxDistance,cacheable:l.cacheable,hasOperators:S,bySameOperator:v}}i.fromData=n;function o(a,s,l,u,c){let m,d,p,h;s<l?(m=s,d=l,p=u,h=c):(m=l,d=s,p=c,h=u);for(let f=a.offset[m],g=a.offset[m+1];f<g;f++)if(a.b[f]===d&&a.edgeProps.operatorA[f]===p&&a.edgeProps.operatorB[f]===h)return f;return-1}i.getEdgeIndexForOperators=o})(Xo||={});function jt(e){return function(t){return dE(e,t)}}function dE(e,t){let{data:r,indices:n,count:o}=e,{valueType:i}=t,a=i==="str"?s=>r.substring(n[2*s],n[2*s+1]):i==="int"?s=>pp(r,n[2*s],n[2*s+1])||0:s=>Nc(r,n[2*s],n[2*s+1])||0;return{schema:t,__array:void 0,isDefined:!0,rowCount:o,value:a,valueKind:s=>W.ValueKinds.Present,toArray:s=>ki.createAndFillArray(o,a,s),areValuesEqual:f6(e)}}function f6(e){let{data:t,indices:r}=e;return function(n,o){let i=r[2*n],a=r[2*o],s=r[2*n+1]-i;if(s!==r[2*o+1]-a)return!1;for(let l=0;l<s;l++)if(t.charCodeAt(l+i)!==t.charCodeAt(l+a))return!1;return!0}}function Dce(e){let{count:t,indices:r}=e;for(let n=0;n<t;++n)if(r[2*n]!==r[2*n+1])return!1;return!0}function ES(e,t){return{name:t,blocks:e}}function kS(e,t,r,n=[]){return{categoryNames:e,header:r,categories:t,saveFrames:n,getField(o){let[i,a]=o.split(".");return t[i].getField(a||"")}}}function wce(e,t,r){return{categoryNames:e,header:r,categories:t}}function fa(e,t,r,n){return{rowCount:t,name:e,fieldNames:[...r],getField(o){return n[o]}}}(n=>{function e(o){return{rowCount:0,name:o,fieldNames:[],getField(i){}}}n.empty=e;function t(o,i){let a=Object.keys(i);return{rowCount:a.length>0?i[a[0]].rowCount:0,name:o,fieldNames:a,getField(s){return i[s]}}}n.ofFields=t;function r(o,i){let a={};for(let s of i._columns)a[s]=Tt.ofColumn(i[s]);return t(o,a)}n.ofTable=r})(fa||={});var Tt;(a=>{function e(s){return t([s])}a.ofString=e;function t(s){let l=s.length,u=p=>{let h=s[p];return!h||h==="."||h==="?"?"":h},c=p=>{let h=s[p];return pp(h,0,h.length)||0},m=p=>{let h=s[p];return Nc(h,0,h.length)||0};return{__array:void 0,binaryEncoding:void 0,isDefined:!0,rowCount:l,str:u,int:c,float:m,valueKind:p=>{let h=s[p],f=h.length;if(f>1)return W.ValueKinds.Present;if(f===0)return W.ValueKinds.NotPresent;let g=h.charCodeAt(0);return g===46?W.ValueKinds.NotPresent:g===63?W.ValueKinds.Unknown:W.ValueKinds.Present},areValuesEqual:(p,h)=>s[p]===s[h],toStringArray:p=>p?ki.createAndFillArray(l,u,p):s,toIntArray:p=>ki.createAndFillArray(l,c,p),toFloatArray:p=>ki.createAndFillArray(l,m,p)}}a.ofStrings=t;function r(s){let l=s.length,u=p=>""+s[p],c=p=>s[p],m=p=>W.ValueKinds.Present,d=p=>!p||p.array&&s instanceof p.array?s:ki.createAndFillArray(l,c,p);return{__array:void 0,binaryEncoding:void 0,isDefined:!0,rowCount:l,str:u,int:c,float:c,valueKind:m,areValuesEqual:(p,h)=>s[p]===s[h],toStringArray:p=>ki.createAndFillArray(l,u,p),toIntArray:d,toFloatArray:d}}a.ofNumbers=r;function n(s){let{data:l,indices:u,count:c}=s,m=f=>{let g=l.substring(u[2*f],u[2*f+1]);return g==="."||g==="?"?"":g},d=f=>pp(l,u[2*f],u[2*f+1])||0,p=f=>Nc(l,u[2*f],u[2*f+1])||0;return{__array:void 0,binaryEncoding:void 0,isDefined:!0,rowCount:c,str:m,int:d,float:p,valueKind:f=>{let g=u[2*f],y=u[2*f+1]-g;if(y>1)return W.ValueKinds.Present;if(y===0)return W.ValueKinds.NotPresent;let x=l.charCodeAt(g);return x===46?W.ValueKinds.NotPresent:x===63?W.ValueKinds.Unknown:W.ValueKinds.Present},areValuesEqual:f6(s),toStringArray:f=>ki.createAndFillArray(c,m,f),toIntArray:f=>ki.createAndFillArray(c,d,f),toFloatArray:f=>ki.createAndFillArray(c,p,f)}}a.ofTokens=n;function o(s){let{rowCount:l,valueKind:u,areValuesEqual:c,isDefined:m}=s,d,p,h;switch(s.schema.valueType){case"float":case"int":d=g=>""+s.value(g),p=s.value,h=s.value;break;case"str":d=s.value,p=g=>{let y=s.value(g);return pp(y,0,y.length)||0},h=g=>{let y=s.value(g);return Nc(y,0,y.length)||0};break;case"list":let{separator:f}=s.schema;d=g=>s.value(g).join(f),p=g=>NaN,h=g=>NaN;break;default:throw new Error(`unsupported valueType '${s.schema.valueType}'`)}return{__array:void 0,binaryEncoding:void 0,isDefined:m,rowCount:l,str:d,int:p,float:h,valueKind:u,areValuesEqual:c,toStringArray:f=>ki.createAndFillArray(l,d,f),toIntArray:f=>ki.createAndFillArray(l,p,f),toFloatArray:f=>ki.createAndFillArray(l,h,f)}}a.ofColumn=o;function i(s,l){return o(W.Undefined(s,l))}a.ofUndefined=i})(Tt||={});function Mce(e,t,r,n){let o=r?0:1;switch(t){case 1:return n==="brackets"?i=>`${e}[${i+o}]`:i=>`${e}_${i+o}`;case 2:return n==="brackets"?(i,a)=>`${e}[${i+o}][${a+o}]`:(i,a)=>`${e}_${i+o}${a+o}`;case 3:return n==="brackets"?(i,a,s)=>`${e}[${i+o}][${a+o}][${s+o}]`:(i,a,s)=>`${e}_${i+o}${a+o}${s+o}`;default:throw new Error("Tensors with rank > 3 or rank 0 are currently not supported.")}}function Bce(e,t,r,n){let o=t.create();if(t.rank===1){let i=t.dimensions[0];for(let a=0;a<i;a++){let s=e.getField(n(a));t.set(o,a,s?s.float(r):0)}}else if(t.rank===2){let i=t.dimensions[0],a=t.dimensions[1];for(let s=0;s<i;s++)for(let l=0;l<a;l++){let u=e.getField(n(s,l));t.set(o,s,l,u?u.float(r):0)}}else if(t.rank===3){let i=t.dimensions[0],a=t.dimensions[1],s=t.dimensions[2];for(let l=0;l<i;l++)for(let u=0;u<a;u++)for(let c=0;c<s;c++){let m=e.getField(n(l,u,c));t.set(o,l,u,c,m?m.float(r):0)}}else throw new Error("Tensors with rank > 3 or rank 0 are currently not supported.");return o}var L_;(n=>{function e(o){return o.replace(".","_").replace(/\[/,"_").replace(/(\[|\])/g,"")}n.canonical=e;function t(o,i){return e(o)===e(i)}n.equal=t;function r(o,i,a=!1){let s=`${o}${i?`.${i}`:""}`;return a?e(s):s}n.create=r})(L_||={});function kce(e,t,r){let n={};for(let o of t.blocks)n[o.header]=wm(e,o,r);return n}function wm(e,t,r){return THe(e,t,r)}function fE(e,t){return new pE(t,e,!0)}function SHe(e){switch(e.valueType){case"str":return(t,r,n)=>vHe(e,t,t.str,t.toStringArray);case"int":return(t,r,n)=>Ece(e,t,t.int,t.toIntArray);case"float":return(t,r,n)=>Ece(e,t,t.float,t.toFloatArray);case"list":throw new Error("Use createListColumn instead.");case"tensor":throw new Error("Use createTensorColumn instead.")}}function vHe(e,t,r,n){return{schema:e,__array:t.__array,isDefined:t.isDefined,rowCount:t.rowCount,value:e.transform==="lowercase"?o=>r(o).toLowerCase():e.transform==="uppercase"?o=>r(o).toUpperCase():r,valueKind:t.valueKind,areValuesEqual:t.areValuesEqual,toArray:e.transform==="lowercase"?o=>Array.from(n(o)).map(i=>i.toLowerCase()):e.transform==="uppercase"?o=>Array.from(n(o)).map(i=>i.toUpperCase()):n}}function Ece(e,t,r,n){return{schema:e,__array:t.__array,isDefined:t.isDefined,rowCount:t.rowCount,value:r,valueKind:t.valueKind,areValuesEqual:t.areValuesEqual,toArray:n}}function IHe(e,t,r){let n=e.separator,o=e.itemParse,i=t.getField(r),a=i?l=>i.str(l).split(n).map(u=>o(u.trim())).filter(u=>!!u):l=>[],s=l=>ki.createAndFillArray(t.rowCount,a,l);return{schema:e,__array:void 0,isDefined:!!i,rowCount:t.rowCount,value:a,valueKind:i?i.valueKind:()=>W.ValueKinds.NotPresent,areValuesEqual:(l,u)=>Yi(a(l),a(u)),toArray:s}}function AHe(e,t,r){let n=e.space,o=t.fieldNames.includes(`${r}[0]`)||t.fieldNames.includes(`${r}[0][0]`)||t.fieldNames.includes(`${r}[0][0][0]`),i=o?0:1,a=t.fieldNames.includes(`${r}_1`)||t.fieldNames.includes(`${r}_11`)||t.fieldNames.includes(`${r}_111`)?"underscore":"brackets",s=Mce(r,n.rank,o,a),l=t.getField(s(i,i,i))||W.Undefined(t.rowCount,e),u=m=>Bce(t,n,m,s),c=m=>ki.createAndFillArray(t.rowCount,u,m);return{schema:e,__array:void 0,isDefined:l.isDefined,rowCount:t.rowCount,value:u,valueKind:l.valueKind,areValuesEqual:(m,d)=>Dr.areEqualExact(u(m),u(d)),toArray:c}}var pE=class{constructor(t,r,n){this._isDefined=n;let o=Object.keys(r);this._rowCount=t.rowCount,this._columns=o,this._schema=r;let i=Object.create(null);for(let a of o)Object.defineProperty(this,a,{get:function(){if(i[a])return i[a];let s=r[a];if(s.valueType==="list")i[a]=IHe(s,t,a);else if(s.valueType==="tensor")i[a]=AHe(s,t,a);else{let l=SHe(s),u=t.getField(a);i[a]=u?l(u,t,a):W.Undefined(t.rowCount,s)}return i[a]},enumerable:!0,configurable:!1})}};function THe(e,t,r){let n=Object.create(null);for(let o of Object.keys(e))n[o]=RHe(o,e[o],t,r);return aE.ofTables(t.header,e,n)}function PHe(e){let t=Object.create(null);for(let r of Object.keys(e.categories))for(let n of e.categories[r].fieldNames){let o=L_.create(r,n,!0);t[o]=e.categories[r].getField(n)}return t}function _He(e,t,r,n){let o=L_.create(t,e),i=L_.canonical(o);if(i in r)return r[i];if(n&&o in n)for(let a of n[o]){let s=L_.canonical(a);if(s in r)return r[s]}}function RHe(e,t,r,n){let o=r.categories[e];if(n){let i=PHe(r),a=Object.create(null),s=[],l=0;for(let u of Object.keys(t)){let c=_He(u,e,i,n);c&&(a[u]=c,s.push(u),l=c.rowCount)}o={rowCount:l,name:e,fieldNames:[...s],getField(u){return a[u]}}}return new pE(o||fa.empty(e),t,!!o)}function ea(){return ea.empty()}(m=>{function e(d,p,h,f){return{origin:d,dirA:p,dirB:h,dirC:f}}m.create=e;function t(){return{origin:b(),dirA:b(),dirB:b(),dirC:b()}}m.empty=t;function r(d,p){return b.copy(d.origin,p.origin),b.copy(d.dirA,p.dirA),b.copy(d.dirB,p.dirB),b.copy(d.dirC,p.dirC),d}m.copy=r;function n(d){return r(t(),d)}m.clone=n;function o(d,p){return b.set(d,b.magnitude(p.dirA)*2,b.magnitude(p.dirB)*2,b.magnitude(p.dirC)*2)}m.size=o;let i=b();function a(d){return o(i,d),i[0]*i[1]*i[2]}m.volume=a;function s(d,p){return b.copy(d.origin,p.origin),b.normalize(d.dirA,p.dirA),b.normalize(d.dirB,p.dirB),b.normalize(d.dirC,p.dirC),d}m.normalize=s;let l=Mt();function u(d,p,h){b.transformMat4(d.origin,p.origin,h);let f=Mt.directionTransform(l,h);return b.transformMat3(d.dirA,p.dirA,f),b.transformMat3(d.dirB,p.dirB,f),b.transformMat3(d.dirC,p.dirC,f),d}m.transform=u;function c(d,p,h){return b.scale(d.dirA,p.dirA,h),b.scale(d.dirB,p.dirB,h),b.scale(d.dirC,p.dirC,h),d}m.scale=c})(ea||={});var zn;(m=>{function e(d,p,h=Float32Array){let f=d*p;return{data:new h(f),size:f,cols:d,rows:p}}m.create=e;function t(d,p,h){return d.data[d.rows*h+p]}m.get=t;function r(d,p,h,f){return d.data[d.rows*h+p]=f,d}m.set=r;function n(d,p,h,f){return d.data[d.rows*h+p]+=f,d}m.add=n;function o(d){return d.data.fill(0),d}m.makeZero=o;function i(d){return{data:d.data.slice(),size:d.size,cols:d.cols,rows:d.rows}}m.clone=i;function a(d,p,h){return{data:d,size:p*h,cols:p,rows:h}}m.fromArray=a;function s(d,p){if(d.cols!==p.rows||d.rows!==p.cols)throw new Error("transpose: matrix dimensions incompatible");if(d.data===p.data)throw new Error("transpose: matrices share memory");let h=p.rows,f=p.cols,g=p.data,y=d.data;for(let x=0,S=0,I=0;x<h;I+=1,S+=f,++x){let v=I;for(let A=0;A<f;v+=h,A++)y[v]=g[S+A]}return d}m.transpose=s;function l(d,p,h){let f=p.cols,g=p.rows,y=h.rows,x=p.data,S=h.data,I=d.data;for(let v=0,A=0,P=0;v<g;A+=f,v++)for(let T=0,R=0;R<y;P++,R++){let w=0,E=A;for(let M=0;M<f;E++,T++,M++)w+=x[E]*S[T];I[P]=w}return d}m.multiplyABt=l;function u(d){let p=d.rows,h=d.cols,f=d.data,g=new Array(h);for(let y=0;y<h;++y)g[y]=0;for(let y=0,x=0;y<p;++y)for(let S=0;S<h;++S,++x)g[S]+=f[x];for(let y=0;y<h;++y)g[y]/=p;return g}m.meanRows=u;function c(d,p){let h=d.rows,f=d.cols,g=d.data;for(let y=0,x=0;y<h;++y)for(let S=0;S<f;++S,++x)g[x]-=p[S];return d}m.subRows=c})(zn||={});function g6(e,t,r,n){n=e[t],e[t]=e[r],e[r]=n}function DHe(e,t){return e=Math.abs(e),t=Math.abs(t),e>t?(t/=e,e*Math.sqrt(1+t*t)):t>0?(e/=t,t*Math.sqrt(1+e*e)):0}var wHe=1192092896e-16,MHe=1e-37;function BHe(e,t,r,n,o,i,a,s){let l=wHe*2,u=MHe,c=0,m=0,d=0,p=0,h=Math.max(i,30),f=0,g=0,y=0,x=0,S=0,I=0,v=0,A=0,P=0,T=0,R=0,w=0,E=0,M=0,D=0,B=0,k=0,F=4660,z=0,j=0,Y=0,G=new Float64Array(a<<3);for(;c<a;c++){for(d=0,R=0;d<i;d++)A=e[c*t+d],R+=A*A;if(G[c]=R,n){for(d=0;d<a;d++)n[c*o+d]=0;n[c*o+c]=1}}for(;p<h;p++){for(S=0,c=0;c<a-1;c++)for(m=c+1;m<a;m++){for(f=c*t|0,g=m*t|0,D=G[c],B=0,k=G[m],d=2,B+=e[f]*e[g],B+=e[f+1]*e[g+1];d<i;d++)B+=e[f+d]*e[g+d];if(!(Math.abs(B)<=l*Math.sqrt(D*k))){for(B*=2,w=D-k,E=DHe(B,w),w<0?(M=(E-w)*.5,v=Math.sqrt(M/E),I=B/(E*v*2)):(I=Math.sqrt((E+w)/(E*2)),v=B/(E*I*2)),D=0,k=0,d=2,P=I*e[f]+v*e[g],T=-v*e[f]+I*e[g],e[f]=P,e[g]=T,D+=P*P,k+=T*T,P=I*e[f+1]+v*e[g+1],T=-v*e[f+1]+I*e[g+1],e[f+1]=P,e[g+1]=T,D+=P*P,k+=T*T;d<i;d++)P=I*e[f+d]+v*e[g+d],T=-v*e[f+d]+I*e[g+d],e[f+d]=P,e[g+d]=T,D+=P*P,k+=T*T;if(G[c]=D,G[m]=k,S=1,n)for(y=c*o|0,x=m*o|0,d=2,P=I*n[y]+v*n[x],T=-v*n[y]+I*n[x],n[y]=P,n[x]=T,P=I*n[y+1]+v*n[x+1],T=-v*n[y+1]+I*n[x+1],n[y+1]=P,n[x+1]=T;d<a;d++)P=I*n[y+d]+v*n[x+d],T=-v*n[y+d]+I*n[x+d],n[y+d]=P,n[x+d]=T}}if(S===0)break}for(c=0;c<a;c++){for(d=0,R=0;d<i;d++)A=e[c*t+d],R+=A*A;G[c]=Math.sqrt(R)}for(c=0;c<a-1;c++){for(m=c,d=c+1;d<a;d++)G[m]<G[d]&&(m=d);if(c!==m&&(g6(G,c,m,R),n)){for(d=0;d<i;d++)g6(e,c*t+d,m*t+d,A);for(d=0;d<a;d++)g6(n,c*o+d,m*o+d,A)}}for(c=0;c<a;c++)r[c]=G[c];if(n)for(c=0;c<s;c++){for(R=c<a?G[c]:0;R<=u;){for(j=1/i,d=0;d<i;d++)F=F*214013+2531011,z=(F>>16&32767&256)!==0?j:-j,e[c*t+d]=z;for(p=0;p<2;p++)for(m=0;m<c;m++){for(R=0,d=0;d<i;d++)R+=e[c*t+d]*e[m*t+d];for(Y=0,d=0;d<i;d++)A=e[c*t+d]-R*e[m*t+d],e[c*t+d]=A,Y+=Math.abs(A);for(Y=Y?1/Y:0,d=0;d<i;d++)e[c*t+d]*=Y}for(R=0,d=0;d<i;d++)A=e[c*t+d],R+=A*A;R=Math.sqrt(R)}for(v=1/R,d=0;d<i;d++)e[c*t+d]*=v}}function Fce(e,t,r,n){let o=0,i=0,a=e.rows,s=e.cols,l=a,u=s;l<u&&(o=1,i=l,l=u,u=i);let c=zn.create(l,l),m=zn.create(1,u),d=zn.create(u,u);if(o===0)zn.transpose(c,e);else{for(i=0;i<s*a;i++)c.data[i]=e.data[i];for(;i<u*l;i++)c.data[i]=0}if(BHe(c.data,l,m.data,d.data,u,l,u,l),t){for(i=0;i<u;i++)t.data[i]=m.data[i];for(;i<s;i++)t.data[i]=0}o===0?(r&&zn.transpose(r,c),n&&zn.transpose(n,d)):(r&&zn.transpose(r,d),n&&zn.transpose(n,c))}var Bu;(i=>{function e(a){let s=t(a),l=o(a,s);return{momentsAxes:s,boxAxes:l}}i.ofPositions=e;function t(a){if(a.length===3)return ea.create(b.fromArray(b(),a,0),b.create(1,0,0),b.create(0,1,0),b.create(0,0,1));let s=zn.fromArray(a,3,a.length/3),l=s.rows,u=l/3,c=zn.create(3,3),m=zn.create(1,3),d=zn.create(3,3),p=zn.create(3,3),h=zn.meanRows(s),f=zn.subRows(zn.clone(s),h),g=zn.transpose(zn.create(l,3),f);zn.multiplyABt(c,g,g),Fce(c,m,d,p);let y=b.create(h[0],h[1],h[2]),x=b.create(d.data[0],d.data[3],d.data[6]),S=b.create(d.data[1],d.data[4],d.data[7]),I=b.create(d.data[2],d.data[5],d.data[8]);return b.scale(x,x,Math.sqrt(m.data[0]/u)),b.scale(S,S,Math.sqrt(m.data[1]/u)),b.scale(I,I,Math.sqrt(m.data[2]/u)),ea.create(y,x,S,I)}i.calculateMomentsAxes=t;function r(a){let s=ea.clone(a);return b.magnitude(s.dirC)<1e-6&&b.cross(s.dirC,s.dirA,s.dirB),ea.normalize(s,s)}i.calculateNormalizedAxes=r;let n=b();function o(a,s){if(a.length===3)return ea.clone(s);let l=-1/0,u=-1/0,c=-1/0,m=-1/0,d=-1/0,p=-1/0,h=b(),f=b(),g=s.origin,y=r(s);for(let w=0,E=a.length;w<E;w+=3){b.projectPointOnVector(h,b.fromArray(h,a,w),y.dirA,g);let M=b.dot(y.dirA,b.normalize(f,b.sub(f,h,g))),D=b.distance(h,g);M>0?D>l&&(l=D):D>u&&(u=D),b.projectPointOnVector(h,b.fromArray(h,a,w),y.dirB,g);let B=b.dot(y.dirB,b.normalize(f,b.sub(f,h,g))),k=b.distance(h,g);B>0?k>c&&(c=k):k>m&&(m=k),b.projectPointOnVector(h,b.fromArray(h,a,w),y.dirC,g);let F=b.dot(y.dirC,b.normalize(f,b.sub(f,h,g))),z=b.distance(h,g);F>0?z>d&&(d=z):z>p&&(p=z)}let x=b.setMagnitude(b(),y.dirA,(l+u)/2),S=b.setMagnitude(b(),y.dirB,(c+m)/2),I=b.setMagnitude(b(),y.dirC,(d+p)/2),v=b.isFinite(x),A=b.isFinite(S),P=b.isFinite(I),T=b(),R=function(w,E,M){b.copy(n,g),v&&b.scaleAndAdd(n,n,y.dirA,w),A&&b.scaleAndAdd(n,n,y.dirB,E),P&&b.scaleAndAdd(n,n,y.dirC,M),b.add(T,T,n)};return R(l,c,d),R(l,c,-p),R(l,-m,-p),R(l,-m,d),R(-u,-m,-p),R(-u,-m,d),R(-u,c,d),R(-u,c,-p),b.scale(T,T,1/8),ea.create(T,x,S,I)}i.calculateBoxAxes=o})(Bu||={});function he(){return he.zero()}(D=>{function e(B){return B.extrema!==void 0}D.hasExtrema=e;function t(B,k){return{center:B,radius:k}}D.create=t;function r(){return{center:b(),radius:0}}D.zero=r;function n(B){let k=t(b.clone(B.center),B.radius);return e(B)&&(k.extrema=B.extrema.map(F=>b.clone(F))),k}D.clone=n;function o(B,k,F){return b.copy(B.center,k),B.radius=F,B}D.set=o;function i(B,k){return b.copy(B.center,k.center),B.radius=k.radius,e(k)&&a(B,k.extrema.map(F=>b.clone(F))),B}D.copy=i;function a(B,k){return B.extrema!==void 0?(B.extrema.length=0,B.extrema.push(...k)):B.extrema=k,B}D.setExtrema=a;function s(B){let{x:k,y:F,z,indices:j}=B,Y=0,G=0,X=0,U=0,L=xe.size(j);for(let q=0;q<L;q++){let te=xe.getAt(j,q);Y+=k[te],G+=F[te],X+=z[te]}L>0&&(Y/=L,G/=L,X/=L);for(let q=0;q<L;q++){let te=xe.getAt(j,q),J=k[te]-Y,ee=F[te]-G,ce=z[te]-X,fe=J*J+ee*ee+ce*ce;fe>U&&(U=fe)}return{center:b.create(Y,G,X),radius:Math.sqrt(U)}}D.computeBounding=s;function l(B,k,F){return b.transformMat4(B.center,k.center,F),B.radius=k.radius*H.getMaxScaleOnAxis(F),e(k)&&a(B,k.extrema.map(z=>b.transformMat4(b(),z,F))),B}D.transform=l;function u(B,k,F){return b.add(B.center,k.center,F),e(k)&&a(B,k.extrema.map(z=>b.add(b(),z,F))),B}D.translate=u;function c(B,k,F){return b.scale(B.center,k.center,F),B.radius=k.radius*F,e(k)&&a(B,k.extrema.map(z=>b.scale(b(),z,F))),B}D.scale=c;function m(B,k,F){return b.scale(B.center,k.center,F),B.radius=k.radius*F,B}D.scaleNX=m;function d(B,k,F){return b.toArray(B.center,k,F),k[F+3]=B.radius,k}D.toArray=d;function p(B,k,F){return b.fromArray(B.center,k,F),B.radius=k[F+3],B}D.fromArray=p;function h(B,k){return b.scale(B.center,b.add(B.center,k.max,k.min),.5),B.radius=b.distance(B.center,k.max),D.setExtrema(B,[b.create(k.min[0],k.min[1],k.min[2]),b.create(k.max[0],k.max[1],k.max[2]),b.create(k.max[0],k.min[1],k.min[2]),b.create(k.min[0],k.max[1],k.max[2]),b.create(k.min[0],k.min[1],k.max[2]),b.create(k.max[0],k.min[1],k.max[2]),b.create(k.max[0],k.max[1],k.min[2]),b.create(k.min[0],k.max[1],k.min[2])]),B}D.fromBox3D=h;function f(B,k){return b.copy(B.center,k.origin),B.radius=Math.max(b.magnitude(k.dirA),b.magnitude(k.dirB),b.magnitude(k.dirC)),B}D.fromAxes3D=f;let g=b();function y(B,k,F){let[z,j,Y]=k,G=b.create(0,0,0);b.transformMat4(G,G,F);let X=b.create(z,j,Y);b.transformMat4(X,X,F);let U=b.create(z,0,0);b.transformMat4(U,U,F);let L=b.create(0,j,Y);b.transformMat4(L,L,F);let q=b.create(0,0,Y);b.transformMat4(q,q,F);let te=b.create(z,0,Y);b.transformMat4(te,te,F);let J=b.create(z,j,0);b.transformMat4(J,J,F);let ee=b.create(0,j,0);b.transformMat4(ee,ee,F),b.add(g,G,X),b.scale(g,g,.5);let ce=Math.max(b.distance(G,X),b.distance(U,L));return D.set(B,g,ce/2),D.setExtrema(B,[G,X,U,L,q,te,J,ee]),B}D.fromDimensionsAndTransform=y;let x=b();function S(B,k,F){return b.distance(k.center,F)<k.radius?D.copy(B,k):(b.sub(x,k.center,F),b.sub(x,k.center,x),b.setMagnitude(x,x,k.radius),b.scale(B.center,b.add(x,x,F),.5),B.radius=b.distance(B.center,F),B)}D.addVec3=S;function I(B,k,F){return b.copy(B.center,k.center),B.radius=Math.max(k.radius,b.distance(k.center,F.center)+F.radius),e(k)&&e(F)&&a(B,[...k.extrema.map(z=>b.clone(z)),...F.extrema.map(z=>b.clone(z))]),B}D.expandBySphere=I;let v=b();function A(B,k,F){if(b.copy(B.center,k.center),B.radius=k.radius+F,k.radius<1e-12||(k.extrema?.length??0)<=1)return B.extrema=void 0,B;if(e(k)){let z=new Float32Array(k.extrema.length*3);for(let Y=0;Y<k.extrema.length;Y++)b.toArray(k.extrema[Y],z,Y*3);let j=Bu.calculateMomentsAxes(z);ea.scale(j,ea.normalize(j,j),F),a(B,k.extrema.map(Y=>{b.normalize(v,b.sub(v,Y,k.center));let G=b.clone(Y),X=b.dot(v,j.dirA)<0?-1:1;b.scaleAndAdd(G,G,j.dirA,X);let U=b.dot(v,j.dirB)<0?-1:1;b.scaleAndAdd(G,G,j.dirB,U);let L=b.dot(v,j.dirC)<0?-1:1;return b.scaleAndAdd(G,G,j.dirC,L),b.distance(B.center,G)>B.radius&&(k.extrema.length>=14&&b.normalize(v,b.sub(v,G,k.center)),b.scaleAndAdd(G,B.center,v,B.radius)),G}))}return B}D.expand=A;function P(B,k){return B.radius===k.radius&&b.exactEquals(B.center,k.center)}D.exactEquals=P;function T(B,k){let F=B.radius,z=k.radius;return Math.abs(F-z)<=1e-6*Math.max(1,Math.abs(F),Math.abs(z))&&b.equals(B.center,k.center)}D.equals=T;function R(B,k){if(e(k)){for(let F of k.extrema)if(b.distance(B.center,F)>B.radius)return!1;return!0}else return b.distance(B.center,k.center)+k.radius<=B.radius}D.includes=R;function w(B,k){return b.distance(B.center,k.center)<=B.radius+k.radius}D.overlaps=w;function E(B,k){return b.distance(B.center,k.center)-B.radius+k.radius}D.distance=E;function M(B,k){let{center:F,radius:z}=B;return b.distance(k,F)-z}D.distanceToVec=M})(he||={});function pt(){return pt.zero()}(D=>{function e(B,k){return{min:B,max:k}}D.create=e;function t(){return{min:b(),max:b()}}D.zero=t;function r(B,k){return b.copy(B.min,k.min),b.copy(B.max,k.max),B}D.copy=r;function n(B,k,F){return b.copy(B.min,k),b.copy(B.max,F),B}D.set=n;function o(B){return r(t(),B)}D.clone=o;let i=b();function a(B,k){return he.hasExtrema(k)&&k.extrema.length>=14?l(B,k.extrema):(b.set(i,k.radius,k.radius,k.radius),b.sub(B.min,k.center,i),b.add(B.max,k.center,i),B)}D.fromSphere3D=a;function s(B,k){for(let F=0,z=k.length;F<z;F++)y(B,k[F]);return B}D.addVec3Array=s;function l(B,k){return g(B),s(B,k),B}D.fromVec3Array=l;function u(B,k){return he.hasExtrema(k)&&k.extrema.length>=14?s(B,k.extrema):(y(B,b.subScalar(i,k.center,k.radius)),y(B,b.addScalar(i,k.center,k.radius)),B)}D.addSphere3D=u;function c(B,k){return y(B,k.min),y(B,k.max),B}D.addBox3D=c;function m(B,k){return b.clamp(i,k.center,B.min,B.max),b.squaredDistance(i,k.center)<=k.radius*k.radius}D.intersectsSphere3D=m;function d(B){let k=b.create(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),F=b.create(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),{x:z,y:j,z:Y,indices:G}=B;for(let X=0,U=xe.size(G);X<U;X++){let L=xe.getAt(G,X);k[0]=Math.min(z[L],k[0]),k[1]=Math.min(j[L],k[1]),k[2]=Math.min(Y[L],k[2]),F[0]=Math.max(z[L],F[0]),F[1]=Math.max(j[L],F[1]),F[2]=Math.max(Y[L],F[2])}return{min:k,max:F}}D.computeBounding=d;function p(B,k){return b.sub(B,k.max,k.min)}D.size=p;let h=b();function f(B){return p(h,B),h[0]*h[1]*h[2]}D.volume=f;function g(B){return b.set(B.min,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),b.set(B.max,-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),B}D.setEmpty=g;function y(B,k){return b.min(B.min,B.min,k),b.max(B.max,B.max,k),B}D.add=y;function x(B,k,F){return b.sub(B.min,k.min,F),b.add(B.max,k.max,F),B}D.expand=x;function S(B,k,F){return b.subScalar(B.min,k.min,F),b.addScalar(B.max,k.max,F),B}D.expandUniformly=S;function I(B,k,F){return b.scale(B.min,k.min,F),b.scale(B.max,k.max,F),B}D.scale=I;let v=b();function A(B,k,F){let[z,j,Y]=k.min,[G,X,U]=k.max;return g(B),y(B,b.transformMat4(v,b.set(v,z,j,Y),F)),y(B,b.transformMat4(v,b.set(v,z,j,U),F)),y(B,b.transformMat4(v,b.set(v,z,X,Y),F)),y(B,b.transformMat4(v,b.set(v,z,X,U),F)),y(B,b.transformMat4(v,b.set(v,G,j,Y),F)),y(B,b.transformMat4(v,b.set(v,G,j,U),F)),y(B,b.transformMat4(v,b.set(v,G,X,Y),F)),y(B,b.transformMat4(v,b.set(v,G,X,U),F)),B}D.transform=A;function P(B,k){return!(k[0]<B.min[0]||k[0]>B.max[0]||k[1]<B.min[1]||k[1]>B.max[1]||k[2]<B.min[2]||k[2]>B.max[2])}D.containsVec3=P;function T(B,k){return!(B.max[0]<k.min[0]||B.min[0]>k.max[0]||B.max[1]<k.min[1]||B.min[1]>k.max[1]||B.max[2]<k.min[2]||B.min[2]>k.max[2])}D.overlaps=T;function R(B,k){let F=k.center,z=k.radius;return!(F[0]-z<B.min[0]||F[0]+z>B.max[0]||F[1]-z<B.min[1]||F[1]+z>B.max[1]||F[2]-z<B.min[2]||F[2]+z>B.max[2])}D.containsSphere3D=R;function w(B,k){return b.center(B,k.max,k.min)}D.center=w;function E(B,k){return b.exactEquals(B.min,k.min)&&b.exactEquals(B.max,k.max)}D.exactEquals=E;function M(B,k){return b.equals(B.min,k.min)&&b.equals(B.max,k.max)}D.equals=M})(pt||={});function tC(e,t,r){let n=new Float32Array(e);for(let o=0;o<n.length;o++)n[o]=t+r*o;return n}var Jn;(A=>{A.DefaultName="1_555",A.Default=n(A.DefaultName,H.identity()),A.RotationTranslationEpsilon=.005;function n(P,T,R){let{assembly:w,ncsId:E,hkl:M,spgrOp:D,key:B}=R||{},k=M?b.clone(M):b();D=D??-1,B=B??-1,E=E||-1;let F=H.isIdentity(T),z=s(R,F),j=R?.instanceId??P;return F?{name:P,instanceId:j,assembly:w,matrix:T,inverse:H.identity(),isIdentity:!0,hkl:k,spgrOp:D,ncsId:E,suffix:z,key:B}:(H.isRotationAndTranslation(T,A.RotationTranslationEpsilon)||console.warn(`Symmetry operator (${P}) should be a composition of rotation and translation.`),{name:P,instanceId:j,assembly:w,matrix:T,inverse:H.invert(H(),T),isIdentity:!1,hkl:k,spgrOp:D,key:B,ncsId:E,suffix:z})}A.create=n;function o(P){return!!P&&!!P.matrix&&!!P.inverse&&typeof P.name=="string"}function i(P,T,R,w){let E=M=>M>=0&&M<=9?`${M}`:`(${M})`;return`${P+1}_${E(T+5)}${E(R+5)}${E(w+5)}`}A.getSymmetryOperatorName=i;function a(P){return"ASM-"+P.join("-")}A.getAssemblyOperatorName=a;function s(P,T){if(!P)return"";if(P.assembly)return o(P)?P.suffix:T?"":`_${P.assembly.operId}`;if(typeof P.spgrOp<"u"&&typeof P.hkl<"u"&&P.spgrOp!==-1){let[R,w,E]=P.hkl;return`-${i(P.spgrOp,R,w,E)}`}return P.ncsId!==-1?`_${P.ncsId}`:""}let l=H();function u(P,T){H.setIdentity(l);for(let R=0;R<3;R++)for(let w=0;w<3;w++)H.setValue(l,R,w,Mt.getValue(P,R,w));return H.setTranslation(l,T),H.isRotationAndTranslation(l,A.RotationTranslationEpsilon)}A.checkIfRotationAndTranslation=u;function c(P,T,R,w){let E=H.identity();for(let M=0;M<3;M++)for(let D=0;D<3;D++)H.setValue(E,M,D,Mt.getValue(T,M,D));return H.setTranslation(E,R),n(P,E,{ncsId:w})}A.ofRotationAndOffset=c;let m=lr.identity(),d=lr(),p=lr(),h=b();function f(P,T,R){let w=T.inverse;if(T.isIdentity)return H.copy(P,w);let E=1-R;H.getRotation(d,w),lr.slerp(d,m,d,E);let M=lr.getAxisAngle(h,d);return H.fromRotation(P,M,h),H.setValue(P,0,3,E*H.getValue(w,0,3)),H.setValue(P,1,3,E*H.getValue(w,1,3)),H.setValue(P,2,3,E*H.getValue(w,2,3)),P}A.lerpFromIdentity=f;function g(P,T,R,w){if(Math.abs(w)<=1e-5)return H.copy(P,T);if(Math.abs(w-1)<=1e-5)return H.copy(P,R);H.getRotation(d,T),H.getRotation(p,R),lr.slerp(p,d,p,w);let E=lr.getAxisAngle(h,p);return H.fromRotation(P,E,h),H.setValue(P,0,3,to(H.getValue(T,0,3),H.getValue(R,0,3),w)),H.setValue(P,1,3,to(H.getValue(T,1,3),H.getValue(R,1,3),w)),H.setValue(P,2,3,to(H.getValue(T,2,3),H.getValue(R,2,3),w)),P}A.slerp=g;function y(P,T){let R=H.mul(H(),T.matrix,P.matrix);return n(T.name,R,T)}A.compose=y;class x{constructor(T,R,w=hE){this.operator=T;this.coordinates=R;this.r=w;this._x=R.x,this._y=R.y,this._z=R.z,this._m=T.matrix}invariantPosition(T,R){return R[0]=this._x[T],R[1]=this._y[T],R[2]=this._z[T],R}position(T,R){return R[0]=this._x[T],R[1]=this._y[T],R[2]=this._z[T],b.transformMat4(R,R,this._m),R}x(T){let R=this._m,w=R[0],E=R[4],M=R[8],D=R[12],B=this._x[T],k=this._y[T],F=this._z[T],z=R[3]*B+R[7]*k+R[11]*F+R[15]||1;return(w*B+E*k+M*F+D)/z}y(T){let R=this._m,w=R[1],E=R[5],M=R[9],D=R[13],B=this._x[T],k=this._y[T],F=this._z[T],z=R[3]*B+R[7]*k+R[11]*F+R[15]||1;return(w*B+E*k+M*F+D)/z}z(T){let R=this._m,w=R[2],E=R[6],M=R[10],D=R[14],B=this._x[T],k=this._y[T],F=this._z[T],z=R[3]*B+R[7]*k+R[11]*F+R[15]||1;return(w*B+E*k+M*F+D)/z}}class S{constructor(T,R,w=hE){this.operator=T;this.coordinates=R;this.r=w;this._x=R.x,this._y=R.y,this._z=R.z,this._m=T.matrix}invariantPosition(T,R){return R[0]=this._x[T],R[1]=this._y[T],R[2]=this._z[T],R}position(T,R){return R[0]=this.x(T),R[1]=this.y(T),R[2]=this.z(T),R}x(T){let R=this._m;return R[0]*this._x[T]+R[4]*this._y[T]+R[8]*this._z[T]+R[12]}y(T){let R=this._m;return R[1]*this._x[T]+R[5]*this._y[T]+R[9]*this._z[T]+R[13]}z(T){let R=this._m;return R[2]*this._x[T]+R[6]*this._y[T]+R[10]*this._z[T]+R[14]}}class I{constructor(T,R,w=hE){this.operator=T;this.coordinates=R;this.r=w;this._x=R.x,this._y=R.y,this._z=R.z}invariantPosition(T,R){return R[0]=this._x[T],R[1]=this._y[T],R[2]=this._z[T],R}position(T,R){return R[0]=this._x[T],R[1]=this._y[T],R[2]=this._z[T],R}x(T){return this._x[T]}y(T){return this._y[T]}z(T){return this._z[T]}}function v(P,T,R=hE){return H.isIdentity(P.matrix)?new I(P,T,R):EHe(P.matrix)?new S(P,T,R):new x(P,T,R)}A.createMapping=v})(Jn||={});function hE(e){return 0}function EHe(e){return e[3]===0&&e[7]===0&&e[11]===0&&e[15]===1}var gE=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[-1,0,0,0],[0,-1,0,0],[0,0,-1,0],[0,1,0,.5],[1,0,0,.5],[-1,0,0,.5],[0,0,1,.5],[0,-1,0,.5],[0,0,-1,.5],[1,0,0,.25],[0,-1,0,.25],[0,0,1,.25],[-1,0,0,.25],[0,1,0,.25],[0,-1,0,.75],[0,0,1,.75],[0,1,0,.75],[1,0,0,.75],[-1,0,0,.75],[0,0,-1,.25],[0,0,-1,.75],[1,-1,0,0],[-1,1,0,0],[0,0,1,.3333333333333333],[0,0,1,.6666666666666666],[1,0,0,.6666666666666666],[0,1,0,.3333333333333333],[0,-1,0,.6666666666666666],[1,-1,0,.3333333333333333],[-1,1,0,.6666666666666666],[-1,0,0,.3333333333333333],[1,0,0,.3333333333333333],[0,1,0,.6666666666666666],[0,-1,0,.3333333333333333],[1,-1,0,.6666666666666666],[-1,1,0,.3333333333333333],[-1,0,0,.6666666666666666],[0,0,-1,.3333333333333333],[0,0,-1,.6666666666666666],[0,0,1,.8333333333333334],[0,0,1,.16666666666666666],[0,0,-1,.8333333333333334],[0,0,-1,.16666666666666666]],Lce=[[0,1,2],[3,4,5],[3,1,5],[3,6,5],[7,6,2],[8,6,5],[0,4,2],[0,4,9],[7,10,2],[7,10,9],[0,10,2],[8,10,5],[3,1,11],[3,6,11],[0,10,9],[8,6,11],[3,4,2],[0,4,5],[3,4,9],[7,10,5],[8,4,9],[8,10,9],[8,10,2],[0,6,9],[3,10,9],[0,10,11],[7,1,9],[8,1,11],[7,4,11],[7,6,9],[7,10,11],[3,10,2],[8,1,5],[0,4,11],[3,1,2],[3,1,9],[7,4,2],[8,1,2],[8,1,9],[3,6,9],[7,4,9],[8,6,2],[8,6,9],[3,6,2],[12,13,14],[15,16,14],[12,17,18],[15,19,18],[20,13,18],[21,16,18],[20,17,14],[21,19,14],[0,1,5],[8,10,11],[7,6,11],[7,6,5],[8,4,2],[7,4,5],[7,1,5],[7,1,11],[0,10,5],[0,1,11],[0,6,11],[0,6,5],[3,10,11],[8,4,11],[15,13,22],[12,16,22],[15,17,23],[12,19,23],[21,13,23],[20,16,23],[21,17,22],[20,19,22],[4,0,2],[1,3,2],[4,0,14],[1,3,18],[4,0,9],[1,3,9],[4,0,18],[1,3,14],[10,7,9],[6,8,9],[4,7,14],[6,3,18],[10,0,18],[1,8,14],[1,3,5],[4,0,5],[6,8,11],[10,7,11],[1,3,11],[4,0,11],[10,7,2],[6,8,2],[3,10,22],[7,1,23],[8,4,23],[0,6,22],[1,0,5],[4,3,5],[1,0,23],[4,3,22],[10,7,14],[6,8,18],[8,6,22],[7,10,23],[4,3,11],[1,0,11],[1,0,22],[4,3,23],[10,7,18],[6,8,14],[8,6,23],[7,10,22],[6,7,11],[10,8,11],[8,1,23],[0,10,22],[3,6,22],[7,4,23],[4,3,2],[1,0,2],[10,8,2],[6,7,2],[4,3,9],[1,0,9],[10,8,9],[6,7,9],[4,8,14],[6,0,18],[10,3,18],[1,7,14],[4,8,18],[6,0,14],[10,3,14],[1,7,18],[6,7,5],[10,8,5],[6,8,5],[10,7,5],[8,1,22],[0,10,23],[3,6,23],[7,4,22],[4,24,2],[25,3,2],[4,24,26],[25,3,27],[4,24,27],[25,3,26],[28,29,26],[30,31,26],[32,33,26],[34,35,27],[36,37,27],[38,39,27],[2,0,1],[1,2,0],[1,25,5],[24,0,5],[39,36,40],[35,38,40],[37,34,40],[33,30,41],[29,32,41],[31,28,41],[5,3,4],[4,5,3],[25,1,5],[0,24,5],[24,4,5],[3,25,5],[4,3,41],[25,1,40],[24,4,41],[3,25,40],[4,3,40],[25,1,41],[24,4,40],[3,25,41],[35,34,40],[37,36,40],[39,38,40],[29,28,41],[31,30,41],[33,32,41],[3,5,4],[5,4,3],[25,1,2],[0,24,2],[24,4,2],[3,25,2],[25,1,9],[0,24,9],[24,4,9],[3,25,9],[30,33,26],[32,29,26],[28,31,26],[36,39,27],[38,35,27],[34,37,27],[0,2,1],[2,1,0],[30,33,42],[32,29,42],[28,31,42],[36,39,43],[38,35,43],[34,37,43],[7,9,6],[9,6,7],[25,1,11],[0,24,11],[24,4,11],[3,25,11],[35,34,44],[37,36,44],[39,38,44],[29,28,45],[31,30,45],[33,32,45],[8,11,10],[11,10,8],[1,25,2],[24,0,2],[1,25,42],[24,0,43],[1,25,43],[24,0,42],[1,25,27],[24,0,26],[1,25,26],[24,0,27],[1,25,9],[24,0,9],[4,24,5],[25,3,5],[4,24,11],[25,3,11],[1,0,40],[4,3,44],[0,24,45],[1,0,41],[4,3,45],[0,24,44],[0,24,40],[0,24,41],[2,3,4],[5,3,1],[5,0,4],[4,2,3],[1,5,3],[4,5,0],[2,7,6],[2,8,10],[5,8,6],[5,7,10],[1,9,7],[4,9,8],[1,11,8],[4,11,7],[9,0,6],[9,3,10],[11,3,6],[11,0,10],[6,2,7],[10,2,8],[6,5,8],[10,5,7],[9,7,1],[9,8,4],[11,8,1],[11,7,4],[6,9,0],[10,9,3],[6,11,3],[10,11,0],[9,7,6],[9,8,10],[11,8,6],[11,7,10],[6,9,7],[10,9,8],[6,11,8],[10,11,7],[2,3,10],[5,8,1],[11,0,4],[10,2,3],[1,5,8],[4,11,0],[5,0,1],[2,0,4],[2,3,1],[1,5,0],[4,2,0],[1,2,3],[11,8,10],[11,7,6],[9,7,10],[9,8,6],[10,11,8],[6,11,7],[10,9,7],[6,9,8],[5,8,10],[5,7,6],[2,7,10],[2,8,6],[4,11,8],[1,11,7],[4,9,7],[1,9,8],[11,3,10],[11,0,6],[9,0,10],[9,3,6],[10,5,8],[6,5,7],[10,2,7],[6,2,8],[11,8,4],[11,7,1],[9,7,4],[9,8,1],[10,11,3],[6,11,0],[10,9,0],[6,9,3],[22,15,13],[22,12,16],[14,12,13],[14,15,16],[13,22,15],[16,22,12],[13,14,12],[16,14,15],[22,21,17],[22,20,19],[14,20,17],[14,21,19],[13,23,21],[16,23,20],[13,18,20],[16,18,21],[23,15,17],[23,12,19],[18,12,17],[18,15,19],[17,22,21],[19,22,20],[17,14,20],[19,14,21],[23,21,13],[23,20,16],[18,20,13],[18,21,16],[17,23,15],[19,23,12],[17,18,12],[19,18,15],[5,0,6],[2,7,4],[9,3,1],[6,5,0],[4,2,7],[1,9,3],[0,2,4],[3,2,1],[0,5,1],[2,1,3],[2,4,0],[5,1,0],[7,9,10],[8,9,6],[7,11,6],[9,6,8],[9,10,7],[11,6,7],[1,7,11],[4,8,11],[1,8,9],[4,7,9],[0,9,10],[3,9,6],[3,11,10],[0,11,6],[2,6,8],[2,10,7],[5,6,7],[5,10,8],[6,0,11],[10,3,11],[6,3,9],[10,0,9],[7,2,10],[8,2,6],[8,5,10],[7,5,6],[9,1,8],[9,4,7],[11,1,7],[11,4,8],[7,9,4],[8,9,1],[8,11,4],[7,11,1],[9,6,3],[9,10,0],[11,6,0],[11,10,3],[19,12,23],[13,15,22],[16,21,18],[17,20,14],[20,14,17],[21,18,16],[15,22,13],[12,23,19],[18,16,21],[14,17,20],[23,19,12],[22,13,15],[19,20,22],[13,21,23],[16,15,14],[17,12,18],[20,18,13],[21,14,19],[15,23,17],[12,22,16],[18,19,15],[14,13,12],[23,16,20],[22,17,21],[16,12,22],[17,15,23],[19,21,14],[13,20,18],[12,14,13],[15,18,19],[21,22,17],[20,23,16],[14,16,15],[18,17,12],[22,19,20],[23,13,21],[16,20,23],[17,21,22],[19,15,18],[13,12,14],[12,18,17],[15,14,16],[21,23,13],[20,22,19],[14,19,21],[18,13,20],[22,16,12],[23,17,15],[19,12,22],[17,21,23],[16,15,18],[13,20,14],[20,14,13],[15,18,16],[21,23,17],[12,22,19],[18,16,15],[14,13,20],[22,19,12],[23,17,21],[3,2,4],[3,5,1],[0,5,4],[2,4,3],[5,1,3],[5,4,0],[1,7,9],[4,8,9],[1,8,11],[4,7,11],[0,9,6],[3,9,10],[3,11,6],[0,11,10],[2,6,7],[2,10,8],[5,6,8],[5,10,7],[6,0,9],[10,3,9],[6,3,11],[10,0,11],[7,2,6],[8,2,10],[8,5,6],[7,5,10],[9,1,7],[9,4,8],[11,1,8],[11,4,7],[7,9,1],[8,9,4],[8,11,1],[7,11,4],[9,6,0],[9,10,3],[11,6,3],[11,10,0],[8,9,10],[8,11,6],[7,11,10],[9,10,8],[11,6,8],[11,10,7],[6,0,2],[10,3,2],[6,3,5],[10,0,5],[7,2,1],[8,2,4],[8,5,1],[7,5,4],[9,1,0],[9,4,3],[11,1,3],[11,4,0],[1,7,2],[4,8,2],[1,8,5],[4,7,5],[0,9,1],[3,9,4],[3,11,1],[0,11,4],[2,6,0],[2,10,3],[5,6,3],[5,10,0],[0,2,6],[3,2,10],[3,5,6],[0,5,10],[2,1,7],[2,4,8],[5,1,8],[5,4,7],[16,12,14],[13,21,18],[19,15,23],[17,20,22],[12,14,16],[21,18,13],[15,23,19],[20,22,17],[14,16,12],[18,13,21],[23,19,15],[22,17,20],[19,20,18],[17,15,14],[16,21,22],[13,12,23],[20,18,19],[15,14,17],[21,22,16],[12,23,13],[18,19,20],[14,17,15],[22,16,21],[23,13,12],[6,0,5],[10,3,5],[6,3,2],[10,0,2],[7,2,4],[8,2,1],[8,5,4],[7,5,1],[9,1,3],[9,4,0],[11,1,0],[11,4,3],[1,7,5],[4,8,5],[1,8,2],[4,7,2],[0,9,4],[3,9,1],[3,11,4],[0,11,1],[2,6,3],[2,10,0],[5,6,0],[5,10,3],[0,2,10],[3,2,6],[3,5,10],[0,5,6],[2,1,8],[2,4,7],[5,1,7],[5,4,8],[21,17,23],[20,16,22],[12,13,18],[15,19,14],[23,21,17],[22,20,16],[18,12,13],[14,15,19],[17,23,21],[16,22,20],[13,18,12],[19,14,15],[21,13,22],[20,19,23],[12,17,14],[15,16,18],[23,15,13],[22,12,19],[18,20,17],[14,21,16],[17,22,15],[16,23,12],[13,14,20],[19,18,21],[15,17,22],[12,16,23],[20,13,14],[21,19,18],[22,21,13],[23,20,19],[14,12,17],[18,15,16],[13,23,15],[19,22,12],[17,18,20],[16,14,21],[15,13,23],[12,19,22],[20,17,18],[21,16,14],[22,15,17],[23,12,16],[14,20,13],[18,21,19],[13,22,21],[19,23,20],[17,14,12],[16,18,15],[6,5,3],[4,9,3],[9,3,4],[5,7,4],[4,5,7],[5,3,6]],Vce=[[0],[0,1],[0,2],[0,3],[0,2,4,5],[0,6],[0,7],[0,6,4,8],[0,7,4,9],[0,6,2,1],[0,3,1,10],[0,6,2,1,4,8,5,11],[0,12,1,7],[0,1,13,14],[0,12,1,7,4,15,11,9],[0,16,2,17],[0,18,12,17],[0,16,5,19],[0,20,13,19],[0,18,12,17,4,21,15,19],[0,16,2,17,4,22,5,19],[0,16,2,17,23,24,13,25,26,20,27,28,4,22,5,19],[0,16,17,2,29,21,30,15],[0,20,13,19,29,31,32,33],[0,16,6,34],[0,18,7,34],[0,16,7,35],[0,16,36,37],[0,18,36,38],[0,16,14,39],[0,20,40,34],[0,16,8,41],[0,18,8,42],[0,16,9,42],[0,16,6,34,4,22,8,41],[0,18,7,34,4,21,9,41],[0,16,7,35,4,22,9,42],[0,16,6,34,23,24,14,39],[0,16,10,43,23,24,7,35],[0,16,36,37,23,24,9,42],[0,16,8,41,23,24,40,38],[0,16,6,34,23,24,14,39,26,20,40,38,4,22,8,41],[0,16,44,45,23,24,46,47,26,20,48,49,4,22,50,51],[0,16,6,34,29,21,9,42],[0,16,8,41,29,21,7,35],[0,16,36,37,29,21,14,39],[0,16,2,17,1,52,6,34],[0,16,2,17,53,54,9,42],[0,16,12,33,1,52,7,35],[0,16,2,17,11,55,8,41],[0,56,2,57,1,58,6,37],[0,56,15,25,1,58,9,39],[0,20,27,17,1,59,40,34],[0,56,12,28,1,58,7,38],[0,16,5,19,1,52,8,41],[0,22,13,28,1,55,14,38],[0,18,13,60,1,61,14,43],[0,16,15,30,1,52,9,42],[0,16,5,19,11,55,6,34],[0,21,12,19,1,54,7,41],[0,20,13,19,1,59,14,41],[0,20,3,30,1,59,10,42],[0,18,12,17,1,61,7,34,4,21,15,19,11,54,9,41],[0,24,13,17,1,62,14,34,4,20,27,19,11,59,40,41],[0,16,2,17,1,52,6,34,4,22,5,19,11,55,8,41],[0,16,12,33,1,52,7,35,4,22,15,30,11,55,9,42],[0,31,3,17,1,63,10,34,4,56,32,19,11,58,36,41],[0,22,2,19,64,59,14,38,4,16,5,17,65,62,40,39],[0,16,2,17,1,52,6,34,23,24,13,25,64,62,14,39,26,20,27,28,65,59,40,38,4,22,5,19,11,55,8,41],[0,16,2,17,66,67,44,45,23,24,13,25,68,69,46,47,26,20,27,28,70,71,48,49,4,22,5,19,72,73,50,51],[0,16,2,17,1,52,6,34,29,21,15,30,53,54,9,42],[0,16,5,19,1,52,8,41,29,21,12,33,53,54,7,35],[0,20,13,19,1,59,14,41,29,31,32,33,53,63,36,35],[0,31,3,17,1,63,10,34,29,20,27,30,53,59,40,42],[0,16,74,75],[0,18,76,77],[0,16,78,79],[0,18,80,81],[0,16,74,75,29,21,82,83],[0,21,84,85,29,16,86,87],[0,16,88,89],[0,16,88,89,29,21,90,91],[0,16,74,75,1,52,88,89],[0,16,78,79,1,52,92,93],[0,16,94,95,11,55,88,89],[0,16,82,83,53,54,88,89],[0,16,74,75,1,52,88,89,29,21,82,83,53,54,90,91],[0,21,84,85,96,97,88,91,29,16,86,87,98,99,90,89],[0,16,74,75,2,17,100,101],[0,16,94,95,5,19,100,101],[0,18,76,77,2,33,102,103],[0,18,104,105,106,107,100,108],[0,16,78,79,2,17,109,108],[0,16,82,83,15,30,100,101],[0,18,80,81,2,33,110,111],[0,18,112,113,114,115,100,108],[0,16,74,75,2,17,100,101,29,21,82,83,15,30,116,117],[0,21,84,85,118,119,116,101,29,16,86,87,120,121,100,117],[0,16,74,75,6,34,122,123],[0,16,74,75,8,41,124,125],[0,16,78,79,7,35,122,123],[0,16,82,83,9,42,122,123],[0,16,74,75,7,35,126,127],[0,16,74,75,9,42,128,129],[0,16,78,79,6,34,126,127],[0,16,78,79,8,41,128,129],[0,16,74,75,6,34,122,123,29,21,82,83,9,42,128,129],[0,16,74,75,7,35,126,127,29,21,82,83,8,41,124,125],[0,21,84,85,6,42,130,131,29,16,86,87,9,34,132,133],[0,21,84,85,7,41,134,135,29,16,86,87,8,35,136,137],[0,16,89,88,2,17,122,123],[0,16,89,88,12,33,126,127],[0,16,89,88,5,19,124,125],[0,16,89,88,15,30,128,129],[0,16,88,89,6,34,100,101],[0,16,89,88,7,35,109,108],[0,16,89,88,8,41,138,139],[0,16,89,88,9,42,116,117],[0,16,89,88,6,34,100,101,29,21,91,90,9,42,116,117],[0,16,89,88,7,35,109,108,29,21,91,90,8,41,138,139],[0,16,89,88,2,17,122,123,29,21,91,90,15,30,128,129],[0,16,89,88,118,121,132,131,29,21,91,90,120,119,130,133],[0,16,74,75,2,17,100,101,1,52,88,89,6,34,122,123],[0,16,74,75,12,33,109,108,1,52,88,89,7,35,126,127],[0,16,74,75,2,17,100,101,11,55,140,141,8,41,124,125],[0,16,74,75,2,17,100,101,53,54,90,91,9,42,128,129],[0,16,74,75,5,19,138,139,1,52,88,89,8,41,124,125],[0,16,74,75,15,30,116,117,1,52,88,89,9,42,128,129],[0,16,94,95,5,19,100,101,11,55,88,89,6,34,124,125],[0,16,94,95,15,30,109,108,11,55,88,89,7,35,128,129],[0,16,78,79,2,17,109,108,1,52,92,93,6,34,126,127],[0,16,78,79,12,33,100,101,1,52,92,93,7,35,122,123],[0,16,82,83,12,33,138,139,53,54,88,89,8,41,126,127],[0,16,82,83,2,17,116,117,53,54,88,89,9,42,122,123],[0,16,78,79,5,19,116,117,1,52,92,93,8,41,128,129],[0,16,82,83,15,30,100,101,1,52,90,91,9,42,122,123],[0,16,82,83,15,30,100,101,53,54,88,89,6,34,128,129],[0,16,82,83,5,19,109,108,53,54,88,89,7,35,124,125],[0,16,74,75,2,17,100,101,1,52,88,89,6,34,122,123,29,21,82,83,15,30,116,117,53,54,90,91,9,42,128,129],[0,16,74,75,12,33,109,108,1,52,88,89,7,35,126,127,29,21,82,83,5,19,138,139,53,54,90,91,8,41,124,125],[0,21,84,85,118,119,116,101,96,97,88,91,9,34,132,133,29,16,86,87,120,121,100,117,98,99,90,89,6,42,130,131],[0,21,84,85,142,143,138,108,96,97,88,91,8,35,136,137,29,16,86,87,144,145,109,139,98,99,90,89,7,41,134,135],[0,146,147],[0,148,149],[0,150,151],[0,146,147,152,153,154,155,156,157],[0,158,159],[0,146,147,1,160,161],[0,146,147,1,160,161,152,153,154,162,163,164,155,156,157,165,166,167],[0,158,159,1,168,169],[0,146,147,101,170,171],[0,146,147,100,172,173],[0,148,149,174,175,171],[0,148,149,100,176,177],[0,150,151,178,179,171],[0,150,151,100,180,181],[0,146,147,100,172,173,152,153,154,182,183,184,155,156,157,185,186,187],[0,158,159,101,188,189],[0,146,147,122,190,191],[0,146,147,123,192,193],[0,146,147,126,194,195],[0,146,147,127,196,197],[0,146,147,122,190,191,152,153,154,198,199,200,155,156,157,201,202,203],[0,158,159,123,204,205],[0,146,147,126,194,195,152,153,154,206,207,208,155,156,157,209,210,211],[0,158,159,129,212,213],[0,146,147,101,170,171,1,160,161,123,192,193],[0,146,147,108,214,215,1,160,161,127,196,197],[0,146,147,100,172,173,1,160,161,122,190,191],[0,146,147,109,216,217,1,160,161,126,194,195],[0,146,147,100,172,173,1,160,161,122,190,191,152,153,154,182,183,184,162,163,164,198,199,200,155,156,157,185,186,187,165,166,167,201,202,203],[0,158,159,101,188,189,1,168,169,123,204,205],[0,146,147,109,216,217,1,160,161,126,194,195,152,153,154,218,219,220,162,163,164,206,207,208,155,156,157,221,222,223,165,166,167,209,210,211],[0,158,159,117,224,225,1,168,169,129,212,213],[0,146,147,16,226,227],[0,148,149,18,228,229],[0,150,151,18,230,231],[0,150,151,16,232,233],[0,148,149,16,234,235],[0,146,147,18,236,237],[0,146,147,52,238,239],[0,146,147,16,226,227,1,160,161,52,238,239],[0,146,147,18,236,237,1,160,161,61,240,241],[0,146,147,16,226,227,100,172,173,101,170,171],[0,148,149,18,228,229,242,172,181,243,214,244],[0,150,151,18,230,231,245,172,177,246,214,247],[0,150,151,16,232,233,245,172,177,174,170,248],[0,148,149,16,234,235,242,172,181,178,170,249],[0,146,147,18,236,237,100,172,173,108,214,215],[0,146,147,16,226,227,122,190,191,123,192,193],[0,146,147,16,226,227,126,194,195,127,196,197],[0,146,147,18,236,237,126,194,195,123,192,193],[0,146,147,18,236,237,122,190,191,127,196,197],[0,146,147,52,238,239,122,190,191,101,170,171],[0,146,147,61,240,241,126,194,195,101,170,171],[0,146,147,52,238,239,100,172,173,123,192,193],[0,146,147,61,240,241,100,172,173,127,196,197],[0,146,147,16,226,227,100,172,173,101,170,171,1,160,161,52,239,238,122,190,191,123,192,193],[0,146,147,16,226,227,109,216,217,108,214,215,1,160,161,52,239,238,126,194,195,127,196,197],[0,146,147,18,236,237,109,216,217,101,170,171,1,160,161,61,241,240,126,194,195,123,192,193],[0,146,147,18,236,237,100,172,173,108,214,215,1,160,161,61,241,240,122,190,191,127,196,197],[0,16,2,17,158,250,251,252,159,253,254,255],[0,16,2,17,158,250,251,252,159,253,254,255,23,24,13,25,256,257,258,259,260,261,262,263,26,20,27,28,264,265,266,267,268,269,270,271,4,22,5,19,272,273,274,275,276,277,278,279],[0,16,2,17,158,250,251,252,159,253,254,255,29,21,15,30,280,281,282,283,284,285,286,287],[0,20,13,19,158,273,266,259,159,261,278,271],[0,20,13,19,158,273,266,259,159,261,278,271,29,31,32,33,280,288,289,290,284,291,292,293],[0,16,2,17,158,250,251,252,159,253,254,255,1,52,6,34,168,294,295,296,169,297,298,299],[0,16,2,17,158,250,251,252,159,253,254,255,53,54,9,42,300,301,302,303,304,305,306,307],[0,16,2,17,158,250,251,252,159,253,254,255,1,52,6,34,168,294,295,296,169,297,298,299,23,24,13,25,256,257,258,259,260,261,262,263,64,62,14,39,308,309,310,311,312,313,314,315,26,20,27,28,264,265,266,267,268,269,270,271,65,59,40,38,316,317,318,319,320,321,322,323,4,22,5,19,272,273,274,275,276,277,278,279,11,55,8,41,324,325,326,327,328,329,330,331],[0,16,2,17,158,250,251,252,159,253,254,255,66,67,44,45,332,333,334,335,336,337,338,339,23,24,13,25,256,257,258,259,260,261,262,263,68,69,46,47,340,341,342,343,344,345,346,347,26,20,27,28,264,265,266,267,268,269,270,271,70,71,48,49,348,349,350,351,352,353,354,355,4,22,5,19,272,273,274,275,276,277,278,279,72,73,50,51,356,357,358,359,360,361,362,363],[0,16,2,17,158,250,251,252,159,253,254,255,1,52,6,34,168,294,295,296,169,297,298,299,29,21,15,30,280,281,282,283,284,285,286,287,53,54,9,42,300,301,302,303,304,305,306,307],[0,20,13,19,158,273,266,259,159,261,278,271,1,59,14,41,168,325,318,311,169,313,330,323],[0,20,13,19,158,273,266,259,159,261,278,271,1,59,14,41,168,325,318,311,169,313,330,323,29,31,32,33,280,288,289,290,284,291,292,293,53,63,36,35,300,364,365,366,304,367,368,369],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189],[0,16,2,17,158,250,251,252,159,253,254,255,116,117,83,82,376,377,224,378,379,380,381,225],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,23,24,13,25,256,257,258,259,260,261,262,263,382,383,384,385,386,387,388,389,390,391,392,393,26,20,27,28,264,265,266,267,268,269,270,271,394,395,396,397,398,399,400,401,402,403,404,405,4,22,5,19,272,273,274,275,276,277,278,279,138,139,95,94,406,407,408,409,410,411,412,413],[0,24,5,28,158,265,258,275,159,277,270,263,414,415,416,417,418,419,420,421,422,423,424,425,23,16,27,19,256,273,251,267,260,269,278,255,426,427,428,429,430,431,432,433,434,435,436,437,26,22,13,17,264,250,274,259,268,261,254,279,438,439,440,441,442,443,444,445,446,447,448,449,4,20,2,25,272,257,266,252,276,253,262,271,450,451,452,453,454,455,456,457,458,459,460,461],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,29,21,15,30,280,281,282,283,284,285,286,287,116,117,83,82,376,377,224,378,379,380,381,225],[0,20,13,19,158,273,266,259,159,261,278,271,450,415,440,429,454,431,420,445,458,447,436,425],[0,20,13,19,158,273,266,259,159,261,278,271,462,463,464,465,466,467,468,469,470,471,472,473],[0,20,13,19,158,273,266,259,159,261,278,271,462,463,464,465,466,467,468,469,470,471,472,473,29,31,32,33,280,288,289,290,284,291,292,293,450,415,440,429,454,431,420,445,458,447,436,425],[0,16,2,17,158,250,251,252,159,253,254,255,123,122,88,89,204,474,475,476,205,477,478,479],[0,16,2,17,158,250,251,252,159,253,254,255,123,122,88,89,204,474,475,476,205,477,478,479,23,24,13,25,256,257,258,259,260,261,262,263,480,481,482,483,484,485,486,487,488,489,490,491,26,20,27,28,264,265,266,267,268,269,270,271,492,493,494,495,496,497,498,499,500,501,502,503,4,22,5,19,272,273,274,275,276,277,278,279,125,124,140,141,504,505,506,507,508,509,510,511],[0,16,2,17,158,250,251,252,159,253,254,255,123,122,88,89,204,474,475,476,205,477,478,479,29,21,15,30,280,281,282,283,284,285,286,287,129,128,90,91,212,512,513,514,213,515,516,517],[0,16,2,17,158,250,251,252,159,253,254,255,129,128,90,91,212,512,513,514,213,515,516,517],[0,16,2,17,158,250,251,252,159,253,254,255,129,128,90,91,212,512,513,514,213,515,516,517,23,24,13,25,256,257,258,259,260,261,262,263,518,519,520,521,522,523,524,525,526,527,528,529,26,20,27,28,264,265,266,267,268,269,270,271,530,531,532,533,534,535,536,537,538,539,540,541,4,22,5,19,272,273,274,275,276,277,278,279,127,126,92,93,542,543,544,545,546,547,548,549],[0,20,13,19,158,273,266,259,159,261,278,271,550,551,552,553,554,555,556,557,558,559,560,561,29,31,32,33,280,288,289,290,284,291,292,293,562,563,564,565,566,567,568,569,570,571,572,573],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,1,52,6,34,168,294,295,296,169,297,298,299,122,123,89,88,475,476,204,474,479,478,477,205],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,53,54,9,42,300,301,302,303,304,305,306,307,128,129,91,90,513,514,212,512,517,516,515,213],[0,16,2,17,158,250,251,252,159,253,254,255,116,117,83,82,376,377,224,378,379,380,381,225,1,52,6,34,168,294,295,296,169,297,298,299,128,129,91,90,513,514,212,512,517,516,515,213],[0,16,2,17,158,250,251,252,159,253,254,255,116,117,83,82,376,377,224,378,379,380,381,225,53,54,9,42,300,301,302,303,304,305,306,307,122,123,89,88,475,476,204,474,479,478,477,205],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,1,52,6,34,168,294,295,296,169,297,298,299,122,123,89,88,475,476,204,474,479,478,477,205,23,24,13,25,256,257,258,259,260,261,262,263,382,383,384,385,386,387,388,389,390,391,392,393,64,62,14,39,308,309,310,311,312,313,314,315,481,480,483,482,486,487,484,485,491,490,489,488,26,20,27,28,264,265,266,267,268,269,270,271,394,395,396,397,398,399,400,401,402,403,404,405,65,59,40,38,316,317,318,319,320,321,322,323,493,492,495,494,498,499,496,497,503,502,501,500,4,22,5,19,272,273,274,275,276,277,278,279,138,139,95,94,406,407,408,409,410,411,412,413,11,55,8,41,324,325,326,327,328,329,330,331,124,125,141,140,506,507,504,505,511,510,509,508],[0,16,2,17,158,250,251,252,159,253,254,255,116,117,83,82,376,377,224,378,379,380,381,225,1,52,6,34,168,294,295,296,169,297,298,299,128,129,91,90,513,514,212,512,517,516,515,213,23,24,13,25,256,257,258,259,260,261,262,263,574,575,576,577,578,579,580,581,582,583,584,585,64,62,14,39,308,309,310,311,312,313,314,315,519,518,521,520,524,525,522,523,529,528,527,526,26,20,27,28,264,265,266,267,268,269,270,271,586,587,588,589,590,591,592,593,594,595,596,597,65,59,40,38,316,317,318,319,320,321,322,323,531,530,533,532,536,537,534,535,541,540,539,538,4,22,5,19,272,273,274,275,276,277,278,279,109,108,79,78,598,599,600,601,602,603,604,605,11,55,8,41,324,325,326,327,328,329,330,331,126,127,93,92,544,545,542,543,549,548,547,546],[0,24,5,28,158,265,258,275,159,277,270,263,414,415,416,417,418,419,420,421,422,423,424,425,66,69,50,49,332,349,342,359,336,361,354,347,493,123,483,140,498,507,204,485,503,490,509,205,23,16,27,19,256,273,251,267,260,269,278,255,426,427,428,429,430,431,432,433,434,435,436,437,68,67,48,51,340,357,334,351,344,353,362,339,124,480,89,494,506,499,484,474,511,478,501,488,26,22,13,17,264,250,274,259,268,261,254,279,438,439,440,441,442,443,444,445,446,447,448,449,70,73,46,45,348,333,358,343,352,345,338,363,122,492,141,482,475,487,496,505,479,510,489,500,4,20,2,25,272,257,266,252,276,253,262,271,450,451,452,453,454,455,456,457,458,459,460,461,72,71,44,47,356,341,350,335,360,337,346,355,481,125,495,88,486,476,504,497,491,502,477,508],[0,24,5,28,158,265,258,275,159,277,270,263,414,415,416,417,418,419,420,421,422,423,424,425,606,607,608,609,610,611,612,613,614,615,616,617,531,129,521,92,536,545,212,523,541,528,547,213,23,16,27,19,256,273,251,267,260,269,278,255,426,427,428,429,430,431,432,433,434,435,436,437,618,619,620,621,622,623,624,625,626,627,628,629,126,518,91,532,544,537,522,512,549,516,539,526,26,22,13,17,264,250,274,259,268,261,254,279,438,439,440,441,442,443,444,445,446,447,448,449,630,631,632,633,634,635,636,637,638,639,640,641,128,530,93,520,513,525,534,543,517,548,527,538,4,20,2,25,272,257,266,252,276,253,262,271,450,451,452,453,454,455,456,457,458,459,460,461,642,643,644,645,646,647,648,649,650,651,652,653,519,127,533,90,524,514,542,535,529,540,515,546],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,1,52,6,34,168,294,295,296,169,297,298,299,122,123,89,88,475,476,204,474,479,478,477,205,29,21,15,30,280,281,282,283,284,285,286,287,116,117,83,82,376,377,224,378,379,380,381,225,53,54,9,42,300,301,302,303,304,305,306,307,128,129,91,90,513,514,212,512,517,516,515,213],[0,20,13,19,158,273,266,259,159,261,278,271,462,463,464,465,466,467,468,469,470,471,472,473,1,59,14,41,168,325,318,311,169,313,330,323,551,550,553,552,556,557,554,555,561,560,559,558,29,31,32,33,280,288,289,290,284,291,292,293,450,415,440,429,454,431,420,445,458,447,436,425,53,63,36,35,300,364,365,366,304,367,368,369,563,562,565,564,568,569,566,567,573,572,571,570],[0,16],[0,18],[0,16,26,20],[0,2,23,13],[0,3,4,32],[0,2,29,15],[0,3,29,27],[0,52],[0,63],[0,52,26,59],[0,63,26,54],[0,52,16,1],[0,18,1,61],[0,52,16,1,26,59,20,65],[0,31,1,63],[0,1,24,62],[0,15,1,9],[0,5,1,8],[0,31,1,63,26,21,65,54],[0,2,57,56],[0,60,3,16],[0,22,57,3],[0,2,28,20],[0,17,13,24],[0,20,19,13,4,24,17,27],[0,22,57,3,4,16,60,32],[0,22,57,3,23,20,30,12,26,24,33,15,4,16,60,32],[0,22,57,3,29,18,27,25],[0,22,3,57,1,55,10,37],[0,22,385,396,3,57,109,117],[0,22,57,3,159,279,654,655,158,274,656,657,29,18,25,27,284,658,262,269,280,659,257,267]],V_={"P 1":0,"P -1":1,"P 1 2 1":2,"P 1 21 1":3,"C 1 2 1":4,"P 1 m 1":5,"P 1 c 1":6,"C 1 m 1":7,"C 1 c 1":8,"P 1 2/m 1":9,"P 1 21/m 1":10,"C 1 2/m 1":11,"P 1 2/c 1":12,"P 1 21/c 1":13,"C 1 2/c 1":14,"P 2 2 2":15,"P 2 2 21":16,"P 21 21 2":17,"P 21 21 21":18,"C 2 2 21":19,"C 2 2 2":20,"F 2 2 2":21,"I 2 2 2":22,"I 21 21 21":23,"P m m 2":24,"P m c 21":25,"P c c 2":26,"P m a 2":27,"P c a 21":28,"P n c 2":29,"P m n 21":30,"P b a 2":31,"P n a 21":32,"P n n 2":33,"C m m 2":34,"C m c 21":35,"C c c 2":36,"A m m 2":37,"A b m 2":38,"A m a 2":39,"A b a 2":40,"F m m 2":41,"F d d 2":42,"I m m 2":43,"I b a 2":44,"I m a 2":45,"P 2/m 2/m 2/m":46,"P m m m":46,"P 2/n 2/n 2/n":47,"P n n n":47,"P 2/c 2/c 2/m":48,"P c c m":48,"P 2/b 2/a 2/n":49,"P b a n":49,"P 21/m 2/m 2/a":50,"P m m a":50,"P 2/n 21/n 2/a":51,"P n n a":51,"P 2/m 2/n 21/a":52,"P m n a":52,"P 21/c 2/c 2/a":53,"P c c a":53,"P 21/b 21/a 2/m":54,"P b a m":54,"P 21/c 21/c 2/n":55,"P c c n":55,"P 2/b 21/c 21/m":56,"P b c m":56,"P 21/n 21/n 2/m":57,"P n n m":57,"P 21/m 21/m 2/n":58,"P m m n":58,"P 21/b 2/c 21/n":59,"P b c n":59,"P 21/b 21/c 21/a":60,"P b c a":60,"P 21/n 21/m 21/a":61,"P n m a":61,"C 2/m 2/c 21/m":62,"C m c m":62,"C 2/m 2/c 21/a":63,"C m c a":63,"C 2/m 2/m 2/m":64,"C m m m":64,"C 2/c 2/c 2/m":65,"C c c m":65,"C 2/m 2/m 2/a":66,"C m m a":66,"C 2/c 2/c 2/a":67,"C c c a":67,"F 2/m 2/m 2/m":68,"F m m m":68,"F 2/d 2/d 2/d":69,"F d d d":69,"I 2/m 2/m 2/m":70,"I m m m":70,"I 2/b 2/a 2/m":71,"I b a m":71,"I 21/b 21/c 21/a":72,"I b c a":72,"I 21/m 21/m 21/a":73,"I m m a":73,"P 4":74,"P 41":75,"P 42":76,"P 43":77,"I 4":78,"I 41":79,"P -4":80,"I -4":81,"P 4/m":82,"P 42/m":83,"P 4/n":84,"P 42/n":85,"I 4/m":86,"I 41/a":87,"P 4 2 2":88,"P 4 21 2":89,"P 41 2 2":90,"P 41 21 2":91,"P 42 2 2":92,"P 42 21 2":93,"P 43 2 2":94,"P 43 21 2":95,"I 4 2 2":96,"I 41 2 2":97,"P 4 m m":98,"P 4 b m":99,"P 42 c m":100,"P 42 n m":101,"P 4 c c":102,"P 4 n c":103,"P 42 m c":104,"P 42 b c":105,"I 4 m m":106,"I 4 c m":107,"I 41 m d":108,"I 41 c d":109,"P -4 2 m":110,"P -4 2 c":111,"P -4 21 m":112,"P -4 21 c":113,"P -4 m 2":114,"P -4 c 2":115,"P -4 b 2":116,"P -4 n 2":117,"I -4 m 2":118,"I -4 c 2":119,"I -4 2 m":120,"I -4 2 d":121,"P 4/m 2/m 2/m":122,"P4/m m m":122,"P 4/m 2/c 2/c":123,"P4/m c c":123,"P 4/n 2/b 2/m":124,"P4/n b m":124,"P 4/n 2/n 2/c":125,"P4/n n c":125,"P 4/m 21/b 2/m":126,"P4/m b m":126,"P 4/m 21/n 2/c":127,"P4/m n c":127,"P 4/n 21/m 2/m":128,"P4/n m m":128,"P 4/n 2/c 2/c":129,"P4/n c c":129,"P 42/m 2/m 2/c":130,"P42/m m c":130,"P 42/m 2/c 2/m":131,"P42/m c m":131,"P 42/n 2/b 2/c":132,"P42/n b c":132,"P 42/n 2/n 2/m":133,"P42/n n m":133,"P 42/m 21/b 2/c":134,"P42/m b c":134,"P 42/m 21/n 2/m":135,"P42/m n m":135,"P 42/n 21/m 2/c":136,"P42/n m c":136,"P 42/n 21/c 2/m":137,"P42/n c m":137,"I 4/m 2/m 2/m":138,"I4/m m m":138,"I 4/m 2/c 2/m":139,"I4/m c m":139,"I 41/a 2/m 2/d":140,"I41/a m d":140,"I 41/a 2/c 2/d":141,"I41/a c d":141,"P 3":142,"P 31":143,"P 32":144,"H 3":145,"R 3":146,"P -3":147,"H -3":148,"R -3":149,"P 3 1 2":150,"P 3 2 1":151,"P 31 1 2":152,"P 31 2 1":153,"P 32 1 2":154,"P 32 2 1":155,"H 3 2":156,"R 3 2":157,"P 3 m 1":158,"P 3 1 m":159,"P 3 c 1":160,"P 3 1 c":161,"H 3 m":162,"R 3 m":163,"H 3 c":164,"R 3 c":165,"P -3 1 2/m":166,"P -3 1 m":166,"P -3 1 2/c":167,"P -3 1 c":167,"P -3 2/m 1":168,"P -3 m 1":168,"P -3 2/c 1":169,"P -3 c 1":169,"H -3 2/m":170,"H -3 m":170,"R -3 2/m":171,"R -3 m":171,"H -3 2/c":172,"H -3 c":172,"R -3 2/c":173,"R -3 c":173,"P 6":174,"P 61":175,"P 65":176,"P 62":177,"P 64":178,"P 63":179,"P -6":180,"P 6/m":181,"P 63/m":182,"P 6 2 2":183,"P 61 2 2":184,"P 65 2 2":185,"P 62 2 2":186,"P 64 2 2":187,"P 63 2 2":188,"P 6 m m":189,"P 6 c c":190,"P 63 c m":191,"P 63 m c":192,"P -6 m 2":193,"P -6 c 2":194,"P -6 2 m":195,"P -6 2 c":196,"P 6/m 2/m 2/m":197,"P 6/m m m":197,"P 6/m 2/c 2/c":198,"P 6/m c c":198,"P 63/m 2/c 2/m":199,"P 63/m c m":199,"P 63/m 2/m 2/c":200,"P 63/m m c":200,"P 2 3":201,"F 2 3":202,"I 2 3":203,"P 21 3":204,"I 21 3":205,"P 2/m -3":206,"P m -3":206,"P 2/n -3":207,"P n -3":207,"F 2/m -3":208,"F m -3":208,"F 2/d -3":209,"F d -3":209,"I 2/m -3":210,"I m -3":210,"P 21/a -3":211,"P a -3":211,"I 21/a -3":212,"I a -3":212,"P 4 3 2":213,"P 42 3 2":214,"F 4 3 2":215,"F 41 3 2":216,"I 4 3 2":217,"P 43 3 2":218,"P 41 3 2":219,"I 41 3 2":220,"P -4 3 m":221,"F -4 3 m":222,"I -4 3 m":223,"P -4 3 n":224,"F -4 3 c":225,"I -4 3 d":226,"P 4/m -3 2/m":227,"P m -3 m":227,"P 4/n -3 2/n":228,"P n -3 n":228,"P 42/m -3 2/n":229,"P m -3 n":229,"P 42/n -3 2/m":230,"P n -3 m":230,"F 4/m -3 2/m":231,"F m -3 m":231,"F 4/m -3 2/c":232,"F m -3 c":232,"F 41/d -3 2/m":233,"F d -3 m":233,"F 41/d -3 2/c":234,"F d -3 c":234,"I 4/m -3 2/m":235,"I m -3 m":235,"I 41/a -3 2/d":236,"I a -3 d":236,"P 1 1 2":237,"P 1 1 21":238,"B 1 1 2":239,"B 2":239,"A 1 2 1":240,"C 1 21 1":241,"I 1 2 1":242,"I 2":242,"I 1 21 1":243,"P 1 1 m":244,"P 1 1 b":245,"B 1 1 m":246,"B 1 1 b":247,"P 1 1 2/m":248,"P 1 1 21/m":249,"B 1 1 2/m":250,"P 1 1 2/b":251,"P 1 1 21/b":252,"P 1 21/n 1":253,"P 1 21/a 1":254,"B 1 1 2/b":255,"P 21 2 2":256,"P 2 21 2":257,"P 21 21 2 (a)":258,"P 21 2 21":259,"P 2 21 21":260,"C 2 2 21a)":261,"C 2 2 2a":262,"F 2 2 2a":263,"I 2 2 2a":264,"P 21/m 21/m 2/n a":265,"P 42 21 2a":266,"I 2 3a":267};function kHe(e){switch(e){case 1146:return 146;case 1148:return 149;case 1155:return 157;case 1160:return 163;case 1161:return 165;case 1166:return 171;case 1167:return 173;case 1003:return 237;case 1004:return 238;case 1005:return 239;case 2005:return 240;case 3005:return 241;case 4005:return 242;case 5005:return 243;case 1006:return 244;case 1007:return 245;case 1008:return 246;case 1009:return 247;case 1010:return 248;case 1011:return 249;case 1012:return 250;case 1013:return 251;case 1014:return 252;case 2014:return 253;case 3014:return 254;case 1015:return 255;case 1017:return 256;case 2017:return 257;case 1018:return 258;case 2018:return 259;case 3018:return 260;case 1020:return 261;case 1021:return 262;case 1022:return 263;case 1023:return 264;case 1059:return 265;case 1094:return 266;case 1197:return 267}let t=0;return e>146&&++t,e>148&&++t,e>155&&++t,e>160&&++t,e>161&&++t,e>166&&++t,e>167&&++t,e-1+t}function FHe(e){if(e<146)return e+1;if(e===146)return 1146;if(e<149)return e+1-1;if(e===149)return 1148;if(e<157)return e+1-2;if(e===157)return 1155;if(e<163)return e+1-3;if(e===163)return 1160;if(e<165)return e+1-4;if(e===165)return 1161;if(e<171)return e+1-5;if(e===171)return 1166;if(e<173)return e+1-6;if(e===173)return 1167;if(e<237)return e+1-7;if(e===237)return 1003;if(e===238)return 1004;if(e===239)return 1005;if(e===240)return 2005;if(e===241)return 3005;if(e===242)return 4005;if(e===243)return 5005;if(e===244)return 1006;if(e===245)return 1007;if(e===246)return 1008;if(e===247)return 1009;if(e===248)return 1010;if(e===249)return 1011;if(e===250)return 1012;if(e===251)return 1013;if(e===252)return 1014;if(e===253)return 2014;if(e===254)return 3014;if(e===255)return 1015;if(e===256)return 1017;if(e===257)return 2017;if(e===258)return 1018;if(e===259)return 2018;if(e===260)return 3018;if(e===261)return 1020;if(e===262)return 1021;if(e===263)return 1022;if(e===264)return 1023;if(e===265)return 1059;if(e===266)return 1094;if(e===267)return 1197;throw new Error(`unknown spacegroup index '${e}'`)}var y6=(function(){let e=Object.create(null);for(let t of Object.keys(V_))e[V_[t]]=t;return e})(),Oce=(function(){let e=Object.create(null);for(let t of Object.keys(V_)){let r=V_[t];e[r]=FHe(r)}return e})();function Gce(e){let t=typeof e=="number"?kHe(e):V_[e];return typeof t>"u"||typeof y6[t]>"u"?-1:t}var ha;(n=>{n.Zero=r("P 1",b.create(1,1,1),b.create(Math.PI/2,Math.PI/2,Math.PI/2));function t(o){return o?o.index===0&&o.size[0]===1&&o.size[1]===1&&o.size[1]===1:!0}n.isZero=t;function r(o,i,a){let s=Gce(o);if(s<0)return console.warn(`Unknown spacegroup '${o}', returning a 'P 1' with cellsize [1, 1, 1]`),n.Zero;let l=i[0]*i[1]*i[2],u=a[0],c=a[1],m=a[2],d=i[0],p=i[1],h=i[2],f=Math.cos(c),g=(Math.cos(u)-Math.cos(c)*Math.cos(m))/Math.sin(m),y=Math.sqrt(1-f*f-g*g),x=[d,0,0],S=[Math.cos(m)*p,Math.sin(m)*p,0],I=[f*h,g*h,y*h],v=H.ofRows([[x[0],S[0],I[0],0],[0,S[1],I[1],0],[0,0,I[2],0],[0,0,0,1]]),A=H.invert(H.zero(),v);return{index:s,size:i,volume:l,anglesInRadians:a,toFractional:A,fromFractional:v}}n.create=r})(ha||={});var rl;(g=>{g.ZeroP1=t(ha.Zero);function t(y){let x=Vce[y.index].map(v=>m(Lce[v])),S=y6[y.index],I=Oce[y.index];return{name:S,num:I,cell:y,operators:x}}g.create=t;let r=b(),n=H();function o(y,x,S,I,v,A){return b.set(r,S,I,v),H.fromTranslation(n,r),H.mul(A,H.mul(A,H.mul(A,y.cell.fromFractional,n),y.operators[x]),y.cell.toFractional)}g.setOperatorMatrix=o;function i(y,x,S,I,v){let A=o(y,x,S,I,v,H.zero());return Jn.create(Jn.getSymmetryOperatorName(x,S,I,v),A,{hkl:b.create(S,I,v),spgrOp:x})}g.getSymmetryOperator=i;let a=b(),s=b(),l=b(),u=b();function c(y,x,S,I,v,A){let P=H.zero();b.set(r,S,I,v),b.floor(a,A),H.copy(P,y.operators[x]),b.floor(s,b.transformMat4(s,A,P)),H.getTranslation(u,P),b.sub(u,u,s),b.add(u,u,a),b.add(u,u,r),H.setTranslation(P,u),H.mul(P,y.cell.fromFractional,P),H.mul(P,P,y.cell.toFractional),b.sub(l,s,a);let T=S-l[0],R=I-l[1],w=v-l[2];return Jn.create(Jn.getSymmetryOperatorName(x,T,R,w),P,{hkl:b.create(T,R,w),spgrOp:x})}g.getSymmetryOperatorRef=c;function m(y){let x=gE[y[0]],S=gE[y[1]],I=gE[y[2]];return H.ofRows([x,S,I,[0,0,0,1]])}function d(y){return[f(p(y[0],y[4],y[8]),h(y[12])),f(p(y[1],y[5],y[9]),h(y[13])),f(p(y[2],y[6],y[10]),h(y[14]))].join(",")}g.getOperatorXyz=d;function p(y,x,S){let I=[];if(y>0?I.push("+X"):y<0&&I.push("-X"),x>0?I.push("+Y"):x<0&&I.push("-Y"),S>0?I.push("+Z"):S<0&&I.push("-Z"),I.length===1)return I[0].charAt(0)==="+"?I[0].substr(1):I[0];if(I.length===2){let v=I[0].charAt(0),A=I[1].charAt(0);if(v==="+")return`${I[0].substr(1)}${I[1]}`;if(A==="+")return`${I[1].substr(1)}${I[0]}`}throw new Error(`unknown rotation '${I}', ${y} ${x} ${S}`)}function h(y){switch(y){case 1/2:return"1/2";case 1/4:return"1/4";case 3/4:return"3/4";case 1/3:return"1/3";case 2/3:return"2/3";case 1/6:return"1/6";case 5/6:return"5/6"}return""}function f(y,x){return x===""?y:y.length>2?`${y}+${x}`:y.charAt(0)==="-"?`${x}${y}`:`${x}+${y}`}})(rl||={});var ac;(o=>{function e(i,a,s){i.squaredDistances[i.count]=s,i.indices[i.count++]=a}o.add=e;function t(i){i.count=0}o.reset=t;function r(){return{count:0,indices:[],squaredDistances:[]}}o.create=r;function n(i,a){for(let s=0;s<a.count;++s)i.indices[s]=a.indices[s],i.squaredDistances[s]=a.squaredDistances[s];return i.count=a.count,i}o.copy=n})(ac||={});var x6=class{constructor(t,r){this.parent=null;this.child=null;this.degree=0;this.isMarked=!1;this.key=t,this.value=r,this.prev=this,this.next=this}},C6=class{constructor(t){if(this._index=-1,this._items=[],this._len=0,t){let r=t,n=0;do this._items[n++]=r,r=r.next;while(t!==r);this._len=n}}hasNext(){return this._index<this._len-1}next(){return this._items[++this._index]}reset(t){this._index=-1,this._len=0;let r=t,n=0;do this._items[n++]=r,r=r.next;while(t!==r);this._len=n}},b6=new C6,AI=class{constructor(t){this._minNode=null;this._nodeCount=0;this._compare=t||this._defaultCompare}clear(){this._minNode=null,this._nodeCount=0}decreaseKey(t,r){if(!t)throw new Error("Cannot decrease key of non-existent node");if(this._compare({key:r},{key:t.key})>0)throw new Error("New key is larger than old key");t.key=r;let n=t.parent;n&&this._compare(t,n)<0&&(this._cut(t,n,this._minNode),this._cascadingCut(n,this._minNode)),this._compare(t,this._minNode)<0&&(this._minNode=t)}delete(t){let r=t.parent;r&&(this._cut(t,r,this._minNode),this._cascadingCut(r,this._minNode)),this._minNode=t,this.extractMinimum()}extractMinimum(){let t=this._minNode;if(t){if(t.child){let n=t.child;do n.parent=null,n=n.next;while(n!==t.child)}let r=null;t.next!==t&&(r=t.next),this._removeNodeFromList(t),this._nodeCount--,this._minNode=this._mergeLists(r,t.child),this._minNode&&(this._minNode=this._consolidate(this._minNode))}return t}findMinimum(){return this._minNode}insert(t,r){let n=new x6(t,r);return this._minNode=this._mergeLists(this._minNode,n),this._nodeCount++,n}isEmpty(){return this._minNode===null}size(){return this._minNode===null?0:this._getNodeListSize(this._minNode)}union(t){this._minNode=this._mergeLists(this._minNode,t._minNode),this._nodeCount+=t._nodeCount}_defaultCompare(t,r){return t.key>r.key?1:t.key<r.key?-1:0}_cut(t,r,n){t.parent=null,r.degree--,t.next===t?r.child=null:r.child=t.next,this._removeNodeFromList(t);let o=this._mergeLists(n,t);return t.isMarked=!1,o}_cascadingCut(t,r){let n=t.parent;return n&&(t.isMarked?(r=this._cut(t,n,r),r=this._cascadingCut(n,r)):t.isMarked=!0),r}_consolidate(t){let r=[];for(b6.reset(t);b6.hasNext();){let o=b6.next(),i=r[o.degree];for(;i;){if(this._compare(o,i)>0){let a=o;o=i,i=a}this._linkHeaps(i,o),r[o.degree]=null,o.degree++,i=r[o.degree]}r[o.degree]=o}let n=null;for(let o=0;o<r.length;o++){let i=r[o];i&&(i.next=i,i.prev=i,n=this._mergeLists(n,i))}return n}_removeNodeFromList(t){let r=t.prev,n=t.next;r.next=n,n.prev=r,t.next=t,t.prev=t}_linkHeaps(t,r){this._removeNodeFromList(t),r.child=this._mergeLists(t,r.child),t.parent=r,t.isMarked=!1}_mergeLists(t,r){if(!t)return r||null;if(!r)return t;let n=t.next;return t.next=r.next,t.next.prev=t,r.next=n,r.next.prev=r,this._compare(t,r)<0?t:r}_getNodeListSize(t){let r=0,n=t;do r++,n.child&&(r+=this._getNodeListSize(n.child)),n=n.next;while(n!==t);return r}};function es(e){let t,r;return(...n)=>{if(!t||t.length!==n.length)return t=n,r=e.apply(void 0,n),r;for(let o=0,i=n.length;o<i;o++)if(n[o]!==t[o])return t=n,r=e.apply(void 0,n),r;return r}}function zf(e){let t=new Map;return r=>{if(t.has(r))return t.get(r);let n=e(r);return t.set(r,n),n}}function Eu(){return Eu.create(b.create(0,0,0),b.create(1,0,0))}(p=>{function e(h,f){return{origin:h,direction:f}}p.create=e;function t(h,f){return b.copy(h.origin,f.origin),b.copy(h.direction,f.direction),h}p.copy=t;function r(h){return t(p(),h)}p.clone=r;function n(h,f,g){return b.copy(h.origin,f.origin),b.normalize(h.direction,b.sub(h.direction,g,f.origin)),h}p.targetTo=n;function o(h,f,g){return b.transformMat4(h.origin,f.origin,g),b.transformDirection(h.direction,f.direction,g),h}p.transform=o;let i=b();function a(h,f){let{center:g,radius:y}=f,{origin:x,direction:S}=h,I=b.sub(i,x,g),v=b.dot(S,S),A=2*b.dot(I,S),P=b.dot(I,I)-y*y,T=A*A-4*v*P;if(T<0)return-1;let R=(-A-Math.sqrt(T))/(2*v);return R<0?-1:R}function s(h,f,g){let y=a(f,g);return y<0?!1:(b.scaleAndAdd(h,f.origin,f.direction,y),!0)}p.intersectSphere3D=s;function l(h,f){return a(h,f)>=0}p.isIntersectingSphere3D=l;function u(h,f){return b.distance(h.origin,f.center)<f.radius}p.isInsideSphere3D=u;function c(h,f){let{origin:g,direction:y}=h,[x,S,I]=f.min,[v,A,P]=f.max,[T,R,w]=g,E=1/y[0],M=1/y[1],D=1/y[2],B,k,F,z,j,Y;return E>=0?(B=(x-T)*E,k=(v-T)*E):(B=(v-T)*E,k=(x-T)*E),M>=0?(F=(S-R)*M,z=(A-R)*M):(F=(A-R)*M,z=(S-R)*M),B>z||F>k||(F>B&&(B=F),z<k&&(k=z),D>=0?(j=(I-w)*D,Y=(P-w)*D):(j=(P-w)*D,Y=(I-w)*D),B>Y||j>k)?-1:(j>B&&(B=j),Y<k&&(k=Y),B>=0?B:-1)}function m(h,f,g){let y=c(f,g);return y<0?!1:(b.scaleAndAdd(h,f.origin,f.direction,y),!0)}p.intersectBox3D=m;function d(h,f){return c(h,f)>=0}p.isIntersectingBox3D=d})(Eu||={});function zc(e,t,r){return new v6(e,t,r)}var v6=class{find(t,r,n,o,i){this.ctx.x=t,this.ctx.y=r,this.ctx.z=n,this.ctx.radius=o,this.ctx.isCheck=!1;let a=i??this.result;return Nce(this.ctx,a),a}nearest(t,r,n,o=1,i,a){this.ctx.x=t,this.ctx.y=r,this.ctx.z=n,this.ctx.k=o,this.ctx.stopIf=i;let s=a??this.result;return WHe(this.ctx,s),s}check(t,r,n,o){return this.ctx.x=t,this.ctx.y=r,this.ctx.z=n,this.ctx.radius=o,this.ctx.isCheck=!0,Nce(this.ctx,this.result)}approxNearest(t,r,n,o,i){this.ctx.x=t,this.ctx.y=r,this.ctx.z=n,this.ctx.radius=o,this.ctx.isCheck=!1;let a=i??this.result;return NHe(this.ctx,a),a}constructor(t,r,n){let o=VHe(t,r,n);this.ctx=OHe(o),this.boundary={box:o.boundingBox,sphere:o.boundingSphere},this.buckets={offset:o.bucketOffset,count:o.bucketCounts,array:o.bucketArray},this.result=ac.create()}};function LHe(e){let{expandedBox:t,size:[r,n,o],data:{x:i,y:a,z:s,radius:l,indices:u},elementCount:c,delta:m}=e,d=r*n*o,{min:[p,h,f]}=t,g=0,y=0,x=new Uint32Array(d),S=new Int32Array(c);for(let T=0;T<c;T++){let R=xe.getAt(u,T),w=Math.floor((i[R]-p)/m[0]),E=Math.floor((a[R]-h)/m[1]),M=Math.floor((s[R]-f)/m[2]),D=(w*n+E)*o+M;(x[D]+=1)===1&&(y+=1),S[T]=D}if(l)for(let T=0;T<c;T++){let R=xe.getAt(u,T);l[R]>g&&(g=l[R])}let I=new Int32Array(y);for(let T=0,R=0;T<d;T++){let w=x[T];w>0&&(x[T]=R+1,I[R]=w,R+=1)}let v=new Uint32Array(y);for(let T=1;T<y;++T)v[T]+=v[T-1]+I[T-1];let A=new Int32Array(y),P=new Int32Array(c);for(let T=0;T<c;T++){let R=x[S[T]];if(R>0){let w=R-1;P[v[w]+A[w]]=T,A[w]+=1}}return{size:e.size,bucketArray:P,bucketCounts:I,bucketOffset:v,grid:x,delta:m,min:e.expandedBox.min,data:e.data,maxRadius:g,expandedBox:e.expandedBox,boundingBox:e.boundingBox,boundingSphere:e.boundingSphere}}var Uce=2**24;function VHe(e,t,r){let n=pt.expand(pt(),t.box,b.create(.5,.5,.5)),{indices:o}=e,i=pt.size(b(),n),a,s,l=xe.size(o),u=typeof r=="number"?r:32,c=Array.isArray(r)&&r;if(c&&!b.isZero(c))s=[Math.ceil(i[0]/c[0]),Math.ceil(i[1]/c[1]),Math.ceil(i[2]/c[2])],a=c;else if(l>0){let h=Math.ceil(l/u),f=Math.pow(h/(i[0]*i[1]*i[2]),1/3);s=[Math.ceil(i[0]*f),Math.ceil(i[1]*f),Math.ceil(i[2]*f)],a=[i[0]/s[0],i[1]/s[1],i[2]/s[2]]}else a=i,s=[1,1,1];let m=s[0]*s[1]*s[2];if(m>Uce){let h=Math.cbrt(m/Uce);s=[Math.ceil(s[0]/h),Math.ceil(s[1]/h),Math.ceil(s[2]/h)],a=[i[0]/s[0],i[1]/s[1],i[2]/s[2]]}let d={x:e.x,y:e.y,z:e.z,indices:o,radius:e.radius},p={size:s,data:d,expandedBox:n,boundingBox:t.box,boundingSphere:t.sphere,elementCount:l,delta:a};return LHe(p)}function OHe(e){return{grid:e,x:.1,y:.1,z:.1,k:1,stopIf:void 0,radius:.1,isCheck:!1}}function Nce(e,t){let{min:r,size:[n,o,i],bucketOffset:a,bucketCounts:s,bucketArray:l,grid:u,data:{x:c,y:m,z:d,indices:p,radius:h},delta:f,maxRadius:g}=e.grid,{radius:y,isCheck:x,x:S,y:I,z:v}=e,A=y+g,P=A*A;ac.reset(t);let T=Math.max(0,Math.floor((S-A-r[0])/f[0])),R=Math.max(0,Math.floor((I-A-r[1])/f[1])),w=Math.max(0,Math.floor((v-A-r[2])/f[2])),E=Math.min(n-1,Math.floor((S+A-r[0])/f[0])),M=Math.min(o-1,Math.floor((I+A-r[1])/f[1])),D=Math.min(i-1,Math.floor((v+A-r[2])/f[2]));if(T>E||R>M||w>D)return!1;for(let B=T;B<=E;B++)for(let k=R;k<=M;k++)for(let F=w;F<=D;F++){let z=u[(B*o+k)*i+F];if(z===0)continue;let j=z-1,Y=a[j],G=s[j],X=Y+G;for(let U=Y;U<X;U++){let L=xe.getAt(p,l[U]),q=c[L]-S,te=m[L]-I,J=d[L]-v,ee=q*q+te*te+J*J;if(ee<=P){if(g>0&&Math.sqrt(ee)-h[L]>y)continue;if(x)return!0;ac.add(t,l[U],ee)}}}return t.count>0}function GHe(e){let t=[],r=e*2+1;for(let n=0;n<r;++n)for(let o=0;o<r;++o)for(let i=0;i<r;++i)t.push(b.create(n-e,o-e,i-e));return t.sort((n,o)=>b.squaredMagnitude(n)-b.squaredMagnitude(o)),t.flat()}var UHe=zf(GHe);function NHe(e,t){let{min:r,size:[n,o,i],bucketOffset:a,bucketCounts:s,bucketArray:l,grid:u,data:{x:c,y:m,z:d,indices:p},delta:h}=e.grid,{radius:f,x:g,y,z:x}=e,S=f*f;ac.reset(t);let I=Math.max(0,Math.floor((g-f-r[0])/h[0])),v=Math.max(0,Math.floor((y-f-r[1])/h[1])),A=Math.max(0,Math.floor((x-f-r[2])/h[2])),P=Math.min(n-1,Math.floor((g+f-r[0])/h[0])),T=Math.min(o-1,Math.floor((y+f-r[1])/h[1])),R=Math.min(i-1,Math.floor((x+f-r[2])/h[2]));if(I>P||v>T||A>R)return!1;let w=Math.floor((g-r[0])/h[0]),E=Math.floor((y-r[1])/h[1]),M=Math.floor((x-r[2])/h[2]),D=UHe(Math.max(P-I,T-v,R-A)+1);for(let B=0,k=D.length;B<k;B+=3){let F=w+D[B],z=E+D[B+1],j=M+D[B+2];if(F<I||F>P||z<v||z>T||j<A||j>R)continue;let Y=u[(F*o+z)*i+j];if(Y===0)continue;let G=Y-1,X=a[G],U=s[G],L=X+U,q=Number.MAX_VALUE;for(let te=X;te<L;te++){let J=xe.getAt(p,l[te]),ee=c[J]-g,ce=m[J]-y,fe=d[J]-x,O=ee*ee+ce*ce+fe*fe;O<=S&&O<q&&(ac.add(t,l[te],O),q=O)}if(q!==Number.MAX_VALUE)return!0}return t.count>0}var qy=Eu(),O_=new Set,S6=new Set,zHe=[.1],HHe=[.1],jHe=[.1],TI=new AI;function WHe(e,t){let{min:r,expandedBox:n,boundingSphere:{center:o},size:[i,a,s],bucketOffset:l,bucketCounts:u,bucketArray:c,grid:m,data:{x:d,y:p,z:h,indices:f,radius:g},delta:y,maxRadius:x}=e.grid,{x:S,y:I,z:v,k:A,stopIf:P}=e,T=xe.size(f);if(ac.reset(t),T===0||A<=0)return!1;let R,w,E,M=!1,D=1,B=!0,k=0,F=zHe,z=HHe,j=0,Y=!0,G,X=!1,U=jHe,L=x*x;F.length=0,U.length=0,O_.clear(),TI.clear(),b.set(qy.origin,S,I,v),pt.containsVec3(n,qy.origin)?(R=Math.floor((S-r[0])/y[0]),w=Math.floor((I-r[1])/y[1]),E=Math.floor((v-r[2])/y[2])):(Eu.targetTo(qy,qy,o),Eu.intersectBox3D(qy.origin,qy,n),R=Math.max(0,Math.min(i-1,Math.floor((qy.origin[0]-r[0])/y[0]))),w=Math.max(0,Math.min(a-1,Math.floor((qy.origin[1]-r[1])/y[1]))),E=Math.max(0,Math.min(s-1,Math.floor((qy.origin[2]-r[2])/y[2]))));let q=x!==0?Math.max(1,Math.min(i-1,Math.ceil(x/y[0]))):1,te=x!==0?Math.max(1,Math.min(a-1,Math.ceil(x/y[1]))):1,J=x!==0?Math.max(1,Math.min(s-1,Math.ceil(x/y[2]))):1;for(F.push(R,w,E,(R*a+w)*s+E);t.count<T;){let ee=D*4;for(let ce=0;ce<ee;ce+=4)if(G=F[ce+3],!O_.has(G)){O_.add(G),X=O_.size>=m.length;let fe=m[G];if(fe!==0){let O=j,V=fe-1,Z=l[V],pe=u[V],$=Z+pe;for(let ae=Z;ae<$;ae++){let Se=c[ae],ve=xe.getAt(f,Se),K=d[ve]-S,re=p[ve]-I,le=h[ve]-v,ge=K*K+re*re+le*le;if(x!==0){let Ee=g[ve];ge-=Ee*Ee}Y&&ge>j&&(j=ge),TI.insert(ge,Se)}O<j&&(Y=!1)}}z.length=0,k=0,S6.clear();for(let ce=0;ce<ee;ce+=4){R=F[ce],w=F[ce+1],E=F[ce+2];for(let fe=-q;fe<=q;fe++){let O=R+fe;if(!(O<0||O>=i))for(let V=-te;V<=te;V++){let Z=w+V;if(!(Z<0||Z>=a))for(let pe=-J;pe<=J;pe++){let $=E+pe;if(!($<0||$>=s)&&(G=(O*a+Z)*s+$,!S6.has(G)&&(S6.add(G),!O_.has(G)))){if(!B){let ae=r[0]+O*y[0]-S,Se=r[1]+Z*y[1]-I,ve=r[2]+$*y[2]-v;if(ae*ae+Se*Se+ve*ve-L>j){U.push(O,Z,$,G);continue}}z.push(O,Z,$,G),k++}}}}}if(B=!1,k===0){if(A===1){let ce=TI.findMinimum();if(ce){let{key:fe,value:O}=ce;return ac.add(t,O,fe),!0}}else for(;!TI.isEmpty()&&(X||TI.findMinimum().key<=j)&&t.count<A;){let ce=TI.extractMinimum(),fe=ce.key,O=ce.value;ac.add(t,O,fe),P&&!M&&(M=P(O,fe))}if(t.count>=A||M||t.count>=T)return t.count>0;if(B=!0,Y=!0,U.length>0){for(let ce=0,fe=U.length;ce<fe;ce++)F.push(U[ce]);U.length=0,D=F.length}}else{let ce=F;F=z,z=ce,D=k}}return t.count>0}var Q={};Gi(Q,{Bundle:()=>VI,Location:()=>Fo,Loci:()=>yp,Schema:()=>X_,Stats:()=>Fde,atomicProperty:()=>I8e,chainIndex:()=>P8e,coarseProperty:()=>A8e,entityIndex:()=>_8e,property:()=>v8e,residueIndex:()=>T8e});var Fo;(d=>{function e(p,h,f){return{kind:"element-location",structure:p,unit:h,element:f||0}}d.create=e;function t(p){return e(p.structure,p.unit,p.element)}d.clone=t;function r(p,h,f,g){return h&&(p.structure=h),f&&(p.unit=f),g!==void 0&&(p.element=g),p}d.set=r;function n(p,h){return p.unit=h.unit,p.element=h.element,p}d.copy=n;function o(p){return!!p&&p.kind==="element-location"}d.is=o;function i(p,h){return p.unit===h.unit&&p.element===h.element}d.areEqual=i;let a=b(),s=b();function l(p,h){return p.unit.conformation.position(p.element,a),h.unit.conformation.position(h.element,s),b.distance(a,s)}d.distance=l;function u(p,h){return h.unit.conformation.position(h.element,p)}d.position=u;function c(p){return p.unit.model.atomicHierarchy.residueAtomSegments.index[p.element]}d.residueIndex=c;function m(p){return p.unit.model.atomicHierarchy.chainAtomSegments.index[p.element]}d.chainIndex=m})(Fo||={});var I6=class{constructor(t,r){this.getHash=t;this.areEqual=r;this.size=0;this.byHash=new Map}add(t){let r=this.getHash(t);if(this.byHash.has(r)){let n=this.byHash.get(r);for(let o=0,i=n.length;o<i;o++)if(this.areEqual(t,n[o]))return!1;return n[n.length]=t,this.size++,!0}else return this.byHash.set(r,[t]),this.size++,!0}has(t){let r=this.getHash(t);if(!this.byHash.has(r))return!1;let n=this.byHash.get(r);for(let o=0,i=n.length;o<i;o++)if(this.areEqual(t,n[o]))return!0;return!1}};function PI(e,t){return new I6(e,t)}function G_(){return new A6}function zce(e){return{previous:null,next:null,inList:!0,value:e}}var A6=class{constructor(){this.count=0;this.first=null;this.last=null}addFirst(t){let r=zce(t);return r.inList=!0,this.first&&(this.first.previous=r),r.next=this.first,this.first=r,this.count++,this.last||(this.last=r),r}addLast(t){let r=zce(t);return this.last!==null&&(this.last.next=r),r.previous=this.last,this.last=r,this.first===null&&(this.first=r),r.inList=!0,this.count++,r}removeFirst(){let t=this.first;if(t)return this.remove(t),t.value}removeLast(){let t=this.last;if(t)return this.remove(t),t.value}remove(t){t.inList&&(t.inList=!1,t.previous!==null?t.previous.next=t.next:t.previous===null&&(this.first=t.next),t.next!==null?t.next.previous=t.previous:t.next===null&&(this.last=t.previous),t.next=null,t.previous=null,this.count--)}find(t){let r=this.first;for(;r!==null;){if(r.value===t)return r;r=r.next}}};var Me;(m=>{function e(d,p,h){return{kind:"variable",name:d,type:p,isConstraint:h}}m.Variable=e;function t(d,p,h){return{kind:"value",namespace:d,name:p,parent:h}}m.Value=t;function r(d,p,h,f){return{kind:"container",namespace:d,name:p,child:h,alias:f}}m.Container=r;function n(d){return{kind:"union",types:d}}m.Union=n;function o(d,p,h,f){let g=Object.create(null);for(let y of f)g[y]=!0;return{kind:"oneof",namespace:d,name:p,type:h,values:g}}m.OneOf=o,m.Any={kind:"any"},m.AnyValue={kind:"any-value"},m.Num=t("","Number"),m.Str=t("","String"),m.Bool=o("","Bool",m.Str,["true","false"]);function c({values:d}){return Object.keys(d).sort()}m.oneOfValues=c})(Me||={});var ts;(s=>{function e(l){return{name:l}}s.Symbol=e;function t(l,u){return u?{head:l,args:u}:{head:l}}s.Apply=t;function r(l){return!!l&&Array.isArray(l)}s.isArgumentsArray=r;function n(l){return!!l&&!Array.isArray(l)}s.isArgumentsMap=n;function o(l){return!i(l)&&!a(l)}s.isLiteral=o;function i(l){return!!l&&!!l.head&&typeof l=="object"}s.isApply=i;function a(l){return!!l&&typeof l.name=="string"}s.isSymbol=a})(ts||={});function At(e,t){let{description:r=void 0,isOptional:n=!1,isRest:o=!1,defaultValue:i=void 0}=t||{};return{type:e,isOptional:n,isRest:o,defaultValue:i,description:r}}var pr;(n=>{n.None=t({});function t(o){return{kind:"dictionary",map:o,"@type":0}}n.Dictionary=t;function r(o,i){let{nonEmpty:a=!1}=i||{};return{kind:"list",type:o,nonEmpty:a,"@type":0}}n.List=r})(pr||={});function FS(e,t,r,n){let o=function(i){return ts.Apply(ts.Symbol(o.id),i)};return o.info={namespace:"",name:e,description:n},o.id="",o.args=t,o.type=r,o}function T6(e,t,r,n){let o=function(i){return ts.Apply(ts.Symbol(o.id),i)};return o.info={namespace:e,name:t,description:n},o.id=`${e}.${t}`,o.args=pr.None,o.type=r,o}function U_(e){let t=e;return typeof t=="function"&&!!t.info&&!!t.args&&typeof t.info.namespace=="string"&&!!t.type}function Ir(e,t,r){return FS("",e,t,r)}function yE(e){jce("","",e)}function bE(e){let t=[];return Wce(e,t),t}function Hce(e){let t=/([a-z])([A-Z])([a-z]|$)/g;return e.replace(t,(r,n,o,i)=>`${n}-${o.toLocaleLowerCase()}${i}`).replace(t,(r,n,o,i)=>`${n}-${o.toLocaleLowerCase()}${i}`)}function jce(e,t,r){if(U_(r)){r.info.namespace=e,r.info.name=r.info.name||Hce(t),r.id=`${r.info.namespace}.${r.info.name}`;return}let n=`${r["@namespace"]||Hce(t)}`,o=e?`${e}.${n}`:n;for(let i of Object.keys(r))typeof r[i]!="object"&&!U_(r[i])||jce(o,i,r[i])}function Wce(e,t){if(U_(e)){t.push(e);return}for(let r of Object.keys(e))typeof e[r]!="object"&&!U_(e[r])||Wce(e[r],t)}var jn;(u=>(u.AnyVar=Me.Variable("a",Me.Any),u.AnyValueVar=Me.Variable("a",Me.Any),u.ConstrainedVar=Me.Variable("a",Me.Any,!0),u.Regex=Me.Value("Core","Regex"),u.Set=c=>Me.Container("Core","Set",c||u.AnyValueVar),u.List=c=>Me.Container("Core","List",c||u.AnyVar),u.Fn=(c,m)=>Me.Container("Core","Fn",c||u.AnyVar,m),u.Flags=(c,m)=>Me.Container("Core","Flags",c,m),u.BitFlags=(0,u.Flags)(Me.Num,"BitFlags")))(jn||={});function Us(e,t){return Ir(pr.Dictionary({0:At(e)}),e,t)}function rC(e,t){return Ir(pr.List(e,{nonEmpty:!0}),e,t)}function hp(e,t,r){return Ir(pr.Dictionary({0:At(e),1:At(e)}),t,r)}var s5t=pr.Dictionary({0:At(Me.Num),1:At(Me.Num)}),QHe={"@header":"Types",bool:Ir(pr.Dictionary({0:At(Me.AnyValue)}),Me.Bool,"Convert a value to boolean."),num:Ir(pr.Dictionary({0:At(Me.AnyValue)}),Me.Num,"Convert a value to number."),str:Ir(pr.Dictionary({0:At(Me.AnyValue)}),Me.Str,"Convert a value to string."),regex:Ir(pr.Dictionary({0:At(Me.Str,{description:"Expression"}),1:At(Me.Str,{isOptional:!0,description:"Flags, e.g. 'i' for ignore case"})}),jn.Regex,"Creates a regular expression from a string using the ECMAscript syntax."),list:Ir(pr.List(jn.AnyVar),jn.List()),set:Ir(pr.List(jn.AnyValueVar),jn.Set()),bitflags:Ir(pr.Dictionary({0:At(Me.Num)}),jn.BitFlags,"Interpret a number as bitflags."),compositeKey:Ir(pr.List(Me.AnyValue),Me.AnyValue)},ZHe={"@header":"Logic",not:Us(Me.Bool),and:rC(Me.Bool),or:rC(Me.Bool)},qHe={"@header":"Control",eval:Ir(pr.Dictionary({0:At(jn.Fn(jn.AnyVar))}),jn.AnyVar,"Evaluate a function."),fn:Ir(pr.Dictionary({0:At(jn.AnyVar)}),jn.Fn(jn.AnyVar),'Wrap an expression to a "lazy" function.'),if:Ir(pr.Dictionary({0:At(Me.Bool,{description:"Condition"}),1:At(Me.Variable("a",Me.Any),{description:"If true"}),2:At(Me.Variable("b",Me.Any),{description:"If false"})}),Me.Union([Me.Variable("a",Me.Any),Me.Variable("b",Me.Any)])),assoc:Ir(pr.Dictionary({0:At(Me.Str,{description:"Name"}),1:At(Me.Variable("a",Me.Any),{description:"Value to assign"})}),Me.Variable("a",Me.Any))},YHe={"@header":"Relational",eq:hp(Me.Variable("a",Me.AnyValue,!0),Me.Bool),neq:hp(Me.Variable("a",Me.AnyValue,!0),Me.Bool),lt:hp(Me.Num,Me.Bool),lte:hp(Me.Num,Me.Bool),gr:hp(Me.Num,Me.Bool),gre:hp(Me.Num,Me.Bool),inRange:Ir(pr.Dictionary({0:At(Me.Num,{description:"Value to test"}),1:At(Me.Num,{description:"Minimum value"}),2:At(Me.Num,{description:"Maximum value"})}),Me.Bool,"Check if the value of the 1st argument is >= 2nd and <= 3rd.")},KHe={"@header":"Math",add:rC(Me.Num),sub:rC(Me.Num),mult:rC(Me.Num),div:hp(Me.Num,Me.Num),pow:hp(Me.Num,Me.Num),mod:hp(Me.Num,Me.Num),min:rC(Me.Num),max:rC(Me.Num),cantorPairing:hp(Me.Num,Me.Num),sortedCantorPairing:hp(Me.Num,Me.Num),invertCantorPairing:Ir(pr.Dictionary({0:At(Me.Num)}),jn.List(Me.Num)),floor:Us(Me.Num),ceil:Us(Me.Num),roundInt:Us(Me.Num),trunc:Us(Me.Num),abs:Us(Me.Num),sign:Us(Me.Num),sqrt:Us(Me.Num),cbrt:Us(Me.Num),sin:Us(Me.Num),cos:Us(Me.Num),tan:Us(Me.Num),asin:Us(Me.Num),acos:Us(Me.Num),atan:Us(Me.Num),sinh:Us(Me.Num),cosh:Us(Me.Num),tanh:Us(Me.Num),exp:Us(Me.Num),log:Us(Me.Num),log10:Us(Me.Num),atan2:hp(Me.Num,Me.Num)},JHe={"@header":"Strings",concat:rC(Me.Str),match:Ir(pr.Dictionary({0:At(jn.Regex),1:At(Me.Str)}),Me.Bool)},$He={"@header":"Lists",getAt:Ir(pr.Dictionary({0:At(jn.List()),1:At(Me.Num)}),jn.AnyVar),equal:Ir(pr.Dictionary({0:At(jn.List()),1:At(jn.List())}),Me.Bool)},e9e={"@header":"Sets",has:Ir(pr.Dictionary({0:At(jn.Set(jn.ConstrainedVar)),1:At(jn.ConstrainedVar)}),Me.Bool,"Check if the the 1st argument includes the value of the 2nd."),isSubset:Ir(pr.Dictionary({0:At(jn.Set(jn.ConstrainedVar)),1:At(jn.Set(jn.ConstrainedVar))}),Me.Bool,"Check if the the 1st argument is a subset of the 2nd.")},t9e={"@header":"Flags",hasAny:Ir(pr.Dictionary({0:At(jn.Flags(jn.ConstrainedVar)),1:At(jn.Flags(jn.ConstrainedVar))}),Me.Bool,"Check if the the 1st argument has at least one of the 2nd one's flags."),hasAll:Ir(pr.Dictionary({0:At(jn.Flags(jn.ConstrainedVar)),1:At(jn.Flags(jn.ConstrainedVar))}),Me.Bool,"Check if the the 1st argument has all 2nd one's flags.")},xE={"@header":"Language Primitives",type:QHe,logic:ZHe,ctrl:qHe,rel:YHe,math:KHe,str:JHe,list:$He,set:e9e,flags:t9e};yE(xE);var r9e=bE(xE),l5t=(function(){let e=Object.create(null);for(let t of r9e)e[t.id]=t;return e})();var Wt;(f=>(f.ElementSymbol=Me.Value("Structure","ElementSymbol"),f.AtomName=Me.Value("Structure","AtomName"),f.BondFlag=Me.OneOf("Structure","BondFlag",Me.Str,["covalent","metallic","ion","hydrogen","sulfide","computed","aromatic"]),f.BondFlags=jn.Flags(f.BondFlag,"BondFlags"),f.SecondaryStructureFlag=Me.OneOf("Structure","SecondaryStructureFlag",Me.Str,["alpha","beta","3-10","pi","sheet","strand","helix","turn","none"]),f.SecondaryStructureFlags=jn.Flags(f.SecondaryStructureFlag,"SecondaryStructureFlag"),f.RingFingerprint=Me.Value("Structure","RingFingerprint"),f.EntityType=Me.OneOf("Structure","EntityType",Me.Str,["polymer","non-polymer","water","branched"]),f.EntitySubtype=Me.OneOf("Structure","EntitySubtype",Me.Str,["other","polypeptide(D)","polypeptide(L)","polydeoxyribonucleotide","polyribonucleotide","polydeoxyribonucleotide/polyribonucleotide hybrid","cyclic-pseudo-peptide","peptide nucleic acid","oligosaccharide"]),f.ObjectPrimitive=Me.OneOf("Structure","ObjectPrimitive",Me.Str,["atomistic","sphere","gaussian","other"]),f.ResidueId=Me.Value("Structure","ResidueId"),f.ElementSet=Me.Value("Structure","ElementSet"),f.ElementSelection=Me.Value("Structure","ElementSelection"),f.ElementReference=Me.Value("Structure","ElementReference"),f.ElementSelectionQuery=jn.Fn(f.ElementSelection,"ElementSelectionQuery")))(Wt||={});var o9e={"@header":"Types",elementSymbol:Ir(pr.Dictionary({0:At(Me.Str)}),Wt.ElementSymbol,"Create element symbol representation from a string value."),atomName:Ir(pr.Dictionary({0:At(Me.AnyValue)}),Wt.AtomName,"Convert a value to an atom name."),entityType:Ir(pr.Dictionary({0:At(Wt.EntityType)}),Wt.EntityType,`Create normalized representation of entity type: ${Me.oneOfValues(Wt.EntityType).join(", ")}.`),bondFlags:Ir(pr.List(Wt.BondFlag),Wt.BondFlags,`Create bond flags representation from a list of strings. Allowed flags: ${Me.oneOfValues(Wt.BondFlag).join(", ")}.`),ringFingerprint:Ir(pr.List(Wt.ElementSymbol,{nonEmpty:!0}),Wt.RingFingerprint,"Create ring fingerprint from the supplied atom element list."),secondaryStructureFlags:Ir(pr.List(Wt.SecondaryStructureFlag),Wt.SecondaryStructureFlags,`Create secondary structure flags representation from a list of strings. Allowed flags: ${Me.oneOfValues(Wt.SecondaryStructureFlag).join(", ")}.`),authResidueId:Ir(pr.Dictionary({0:At(Me.Str,{description:"auth_asym_id"}),1:At(Me.Num,{description:"auth_seq_id"}),2:At(Me.Str,{description:"pdbx_PDB_ins_code",isOptional:!0})}),Wt.ResidueId,'Residue identifier based on "auth_" annotation.'),labelResidueId:Ir(pr.Dictionary({0:At(Me.Str,{description:"label_entity_id"}),1:At(Me.Str,{description:"label_asym_id"}),2:At(Me.Num,{description:"label_seq_id"}),3:At(Me.Str,{description:"pdbx_PDB_ins_code",isOptional:!0})}),Wt.ResidueId,`Residue identifier based on mmCIF's "label_" annotation.`)},i9e={"@header":"Iteration Slots",element:Ir(pr.None,Wt.ElementReference,"A reference to the current element."),elementSetReduce:Ir(pr.None,Me.Variable("a",Me.AnyValue,!0),"Current value of the element set reducer.")},a9e={"@header":"Generators",all:Ir(pr.None,Wt.ElementSelectionQuery,"The entire structure."),atomGroups:Ir(pr.Dictionary({"entity-test":At(Me.Bool,{isOptional:!0,defaultValue:!0,description:"Test for the 1st atom of every entity"}),"chain-test":At(Me.Bool,{isOptional:!0,defaultValue:!0,description:"Test for the 1st atom of every chain"}),"residue-test":At(Me.Bool,{isOptional:!0,defaultValue:!0,description:"Test for the 1st atom every residue"}),"atom-test":At(Me.Bool,{isOptional:!0,defaultValue:!0}),"group-by":At(Me.Any,{isOptional:!0,defaultValue:"atom-key",description:"Group atoms to sets based on this property. Default: each atom has its own set"})}),Wt.ElementSelectionQuery,"Return all atoms for which the tests are satisfied, grouped into sets."),bondedAtomicPairs:Ir(pr.Dictionary({0:At(Me.Bool,{isOptional:!0,defaultValue:"true for covalent bonds",description:"Test each bond with this predicate. Each bond is visited twice with swapped atom order."})}),Wt.ElementSelectionQuery,"Return all pairs of atoms for which the test is satisfied."),rings:Ir(pr.Dictionary({fingerprint:At(Wt.RingFingerprint,{isOptional:!0}),"only-aromatic":At(Me.Bool,{isOptional:!0,defaultValue:!1})}),Wt.ElementSelectionQuery,"Return all rings or those with the specified fingerprint and/or only aromatic rings."),queryInSelection:Ir(pr.Dictionary({0:At(Wt.ElementSelectionQuery),query:At(Wt.ElementSelectionQuery),"in-complement":At(Me.Bool,{isOptional:!0,defaultValue:!1})}),Wt.ElementSelectionQuery,"Executes query only on atoms that are in the source selection."),empty:Ir(pr.None,Wt.ElementSelectionQuery,"Nada.")},s9e={"@header":"Selection Modifications",queryEach:Ir(pr.Dictionary({0:At(Wt.ElementSelectionQuery),query:At(Wt.ElementSelectionQuery)}),Wt.ElementSelectionQuery,"Query every atom set in the input selection separately."),intersectBy:Ir(pr.Dictionary({0:At(Wt.ElementSelectionQuery),by:At(Wt.ElementSelectionQuery)}),Wt.ElementSelectionQuery,"Intersect each atom set from the first sequence from atoms in the second one."),exceptBy:Ir(pr.Dictionary({0:At(Wt.ElementSelectionQuery),by:At(Wt.ElementSelectionQuery)}),Wt.ElementSelectionQuery,"Remove all atoms from 'selection' that occur in 'by'."),unionBy:Ir(pr.Dictionary({0:At(Wt.ElementSelectionQuery),by:At(Wt.ElementSelectionQuery)}),Wt.ElementSelectionQuery,"For each atom set A in the orginal sequence, combine all atoms sets in the target selection that intersect with A."),union:Ir(pr.Dictionary({0:At(Wt.ElementSelectionQuery)}),Wt.ElementSelectionQuery,"Collects all atom sets in the sequence into a single atom set."),cluster:Ir(pr.Dictionary({0:At(Wt.ElementSelectionQuery),"min-distance":At(Me.Num,{isOptional:!0,defaultValue:0}),"max-distance":At(Me.Num),"min-size":At(Me.Num,{description:"Minimal number of sets to merge, must be at least 2",isOptional:!0,defaultValue:2}),"max-size":At(Me.Num,{description:"Maximal number of sets to merge, if not set, no limit",isOptional:!0})}),Wt.ElementSelectionQuery,"Combines atom sets that have mutual distance in the interval [min-radius, max-radius]. Minimum/maximum size determines how many atom sets can be combined."),includeSurroundings:Ir(pr.Dictionary({0:At(Wt.ElementSelectionQuery),radius:At(Me.Num),"atom-radius":At(Me.Num,{isOptional:!0,defaultValue:0,description:"Value added to each atom before the distance check, for example VDW radius. Using this argument is computationally demanding."}),"as-whole-residues":At(Me.Bool,{isOptional:!0})}),Wt.ElementSelectionQuery,"For each atom set in the selection, include all surrouding atoms/residues that are within the specified radius."),surroundingLigands:Ir(pr.Dictionary({0:At(Wt.ElementSelectionQuery),radius:At(Me.Num),"include-water":At(Me.Bool,{isOptional:!0,defaultValue:!0})}),Wt.ElementSelectionQuery,"Find all ligands components around the source query."),includeConnected:Ir(pr.Dictionary({0:At(Wt.ElementSelectionQuery),"bond-test":At(Me.Bool,{isOptional:!0,defaultValue:"true for covalent bonds"}),"layer-count":At(Me.Num,{isOptional:!0,defaultValue:1,description:"Number of bonded layers to include."}),"fixed-point":At(Me.Bool,{isOptional:!0,defaultValue:!1,description:"Continue adding layers as long as new connections exist."}),"as-whole-residues":At(Me.Bool,{isOptional:!0})}),Wt.ElementSelectionQuery,"Pick all atom sets that are connected to the target."),wholeResidues:Ir(pr.Dictionary({0:At(Wt.ElementSelectionQuery)}),Wt.ElementSelectionQuery,"Expand the selection to whole residues."),expandProperty:Ir(pr.Dictionary({0:At(Wt.ElementSelectionQuery),property:At(Me.AnyValue)}),Wt.ElementSelectionQuery,"To each atom set in the selection, add all atoms that have the same property value that was already present in the set.")},l9e={"@header":"Selection Filters",pick:Ir(pr.Dictionary({0:At(Wt.ElementSelectionQuery),test:At(Me.Bool)}),Wt.ElementSelectionQuery,"Pick all atom sets that satisfy the test."),first:Ir(pr.Dictionary({0:At(Wt.ElementSelectionQuery)}),Wt.ElementSelectionQuery,"Take the 1st atom set in the sequence."),withSameAtomProperties:Ir(pr.Dictionary({0:At(Wt.ElementSelectionQuery),source:At(Wt.ElementSelectionQuery),property:At(Me.Any)}),Wt.ElementSelectionQuery,"Pick all atom sets for which the set of given atom properties is a subset of the source properties."),intersectedBy:Ir(pr.Dictionary({0:At(Wt.ElementSelectionQuery),by:At(Wt.ElementSelectionQuery)}),Wt.ElementSelectionQuery,"Pick all atom sets that have non-zero intersection with the target."),within:Ir(pr.Dictionary({0:At(Wt.ElementSelectionQuery),target:At(Wt.ElementSelectionQuery),"min-radius":At(Me.Num,{isOptional:!0,defaultValue:0}),"max-radius":At(Me.Num),"atom-radius":At(Me.Num,{isOptional:!0,defaultValue:0,description:"Value added to each atom before the distance check, for example VDW radius. Using this argument is computationally demanding."}),invert:At(Me.Bool,{isOptional:!0,defaultValue:!1,description:"If true, pick only atom sets that are further than the specified radius."})}),Wt.ElementSelectionQuery,"Pick all atom sets from selection that have any atom within the radius of any atom from target."),isConnectedTo:Ir(pr.Dictionary({0:At(Wt.ElementSelectionQuery),target:At(Wt.ElementSelectionQuery),"bond-test":At(Me.Bool,{isOptional:!0,defaultValue:"true for covalent bonds"}),disjunct:At(Me.Bool,{isOptional:!0,defaultValue:!0,description:"If true, there must exist a bond to an atom that lies outside the given atom set to pass test."}),invert:At(Me.Bool,{isOptional:!0,defaultValue:!1,description:"If true, return atom sets that are not connected."})}),Wt.ElementSelectionQuery,"Pick all atom sets that are connected to the target.")},u9e={"@header":"Selection Combinators",intersect:Ir(pr.List(Wt.ElementSelectionQuery),Wt.ElementSelectionQuery,"Return all unique atom sets that appear in all of the source selections."),merge:Ir(pr.List(Wt.ElementSelectionQuery),Wt.ElementSelectionQuery,"Merges multiple selections into a single one. Only unique atom sets are kept."),distanceCluster:Ir(pr.Dictionary({matrix:At(jn.List(jn.List(Me.Num)),{description:"Distance matrix, represented as list of rows (num[][])). Lower triangle is min distance, upper triangle is max distance."}),selections:At(jn.List(Wt.ElementSelectionQuery),{description:"A list of held selections."})}),Wt.ElementSelectionQuery,"Pick combinations of atom sets from the source sequences that are mutually within distances specified by a matrix.")},c9e={"@header":"Atom Sets",atomCount:Ir(pr.None,Me.Num),countQuery:Ir(pr.Dictionary({0:At(Wt.ElementSelectionQuery)}),Me.Num,"Counts the number of occurences of a specific query inside the current atom set."),reduce:Ir(pr.Dictionary({initial:At(Me.Variable("a",Me.AnyValue,!0),{description:"Initial value assigned to slot.atom-set-reduce. Current atom is set to the 1st atom of the current set for this."}),value:At(Me.Variable("a",Me.AnyValue,!0),{description:"Expression executed for each atom in the set"})}),Me.Variable("a",Me.AnyValue,!0),"Execute the value expression for each atom in the current atom set and return the result. Works the same way as Array.reduce in JavaScript (``result = value(value(...value(initial)))``)"),propertySet:Ir(pr.Dictionary({0:At(jn.ConstrainedVar)}),jn.Set(jn.ConstrainedVar),"Returns a set with all values of the given property in the current atom set.")},m9e={"@header":"Atom Properties",core:{"@header":"Core Properties",elementSymbol:kn(Wt.ElementSymbol),vdw:kn(Me.Num,"Van der Waals radius"),mass:kn(Me.Num,"Atomic weight"),atomicNumber:kn(Me.Num,"Atomic number"),x:kn(Me.Num,"Cartesian X coordinate"),y:kn(Me.Num,"Cartesian Y coordinate"),z:kn(Me.Num,"Cartesian Z coordinate"),atomKey:kn(Me.AnyValue,"Unique value for each atom. Main use case is grouping of atoms."),bondCount:Ir(pr.Dictionary({0:At(Wt.ElementReference,{isOptional:!0,defaultValue:"slot.current-atom"}),flags:At(Wt.BondFlags,{isOptional:!0,defaultValue:"covalent"})}),Me.Num,"Number of bonds (by default only covalent bonds are counted)."),sourceIndex:kn(Me.Num,"Index of the atom/element in the input file."),operatorName:kn(Me.Str,"Name of the symmetry operator applied to this element."),instanceId:kn(Me.Str,"Canonical name of the symmetry operator applied to this element."),operatorKey:kn(Me.Num,"Key of the symmetry operator applied to this element."),modelIndex:kn(Me.Num,"Index of the model in the input file."),modelLabel:kn(Me.Str,"Label/header of the model in the input file."),modelEntryId:kn(Me.Str,"Entry ID of the model (e.g., PDB ID).")},topology:{connectedComponentKey:kn(Me.AnyValue,"Unique value for each connected component.")},macromolecular:{"@header":"Macromolecular Properties (derived from the mmCIF format)",authResidueId:kn(Wt.ResidueId,"type.auth-residue-id symbol executed on current atom's residue"),labelResidueId:kn(Wt.ResidueId,"type.label-residue-id symbol executed on current atom's residue"),residueKey:kn(Me.AnyValue,"Unique value for each tuple ``(label_entity_id,auth_asym_id, auth_seq_id, pdbx_PDB_ins_code)``, main use case is grouping of atoms"),chainKey:kn(Me.AnyValue,"Unique value for each tuple ``(label_entity_id, auth_asym_id)``, main use case is grouping of atoms"),entityKey:kn(Me.AnyValue,"Unique value for each tuple ``label_entity_id``, main use case is grouping of atoms"),isHet:kn(Me.Bool,"Equivalent to atom_site.group_PDB !== ATOM"),id:kn(Me.Num,"_atom_site.id"),label_atom_id:kn(Wt.AtomName),label_alt_id:kn(Me.Str),label_comp_id:kn(Me.Str),label_asym_id:kn(Me.Str),label_entity_id:kn(Me.Str),label_seq_id:kn(Me.Num),auth_atom_id:kn(Wt.AtomName),auth_comp_id:kn(Me.Str),auth_asym_id:kn(Me.Str),auth_seq_id:kn(Me.Num),residueSourceIndex:kn(Me.Num),pdbx_PDB_ins_code:kn(Me.Str),pdbx_formal_charge:kn(Me.Num),occupancy:kn(Me.Num),B_iso_or_equiv:kn(Me.Num),entityType:kn(Wt.EntityType,"Type of the entity as defined in mmCIF (polymer, non-polymer, branched, water)"),entitySubtype:kn(Wt.EntitySubtype,"Subtype of the entity as defined in mmCIF _entity_poly.type and _pdbx_entity_branch.type (other, polypeptide(D), polypeptide(L), polydeoxyribonucleotide, polyribonucleotide, polydeoxyribonucleotide/polyribonucleotide hybrid, cyclic-pseudo-peptide, peptide nucleic acid, oligosaccharide)"),entityPrdId:kn(Me.Str,"The PRD ID of the entity."),entityDescription:kn(jn.List(Me.Str)),objectPrimitive:kn(Wt.ObjectPrimitive,"Type of the primitive object used to model this segment as defined in mmCIF/IHM (atomistic, sphere, gaussian, other)"),secondaryStructureKey:kn(Me.AnyValue,"Unique value for each secondary structure element."),secondaryStructureFlags:kn(Wt.SecondaryStructureFlags),isModified:kn(Me.Bool,"True if the atom belongs to modification of a standard residue."),modifiedParentName:kn(Me.Str,"'3-letter' code of the modifed parent residue."),isNonStandard:kn(Me.Bool,"True if this is a non-standard residue."),chemCompType:kn(Me.Str,"Type of the chemical component as defined in mmCIF.")},ihm:{hasSeqId:Ir(pr.Dictionary({0:At(Me.Num)}),Me.Bool,"Checks if the current element represents a given sequence id"),overlapsSeqIdRange:Ir(pr.Dictionary({beg:At(Me.Num),end:At(Me.Num)}),Me.Bool,"Checks if the current element overlaps with the specified residue range")}},d9e={"@header":"Bond Properties",flags:_I(Wt.BondFlags),order:_I(Me.Num),key:_I(Me.Num),length:_I(Me.Num),atomA:_I(Wt.ElementReference),atomB:_I(Wt.ElementReference)};function kn(e,t){return Ir(pr.Dictionary({0:At(Wt.ElementReference,{isOptional:!0,defaultValue:"slot.current-atom"})}),e,t)}function _I(e,t){return Ir(pr.None,e,t)}var Xce={"@header":"Structure Queries",type:o9e,slot:i9e,generator:a9e,modifier:s9e,filter:l9e,combinator:u9e,atomSet:c9e,atomProperty:m9e,bondProperty:d9e};var f9e={"@header":"Generators",bundleElement:Ir(pr.Dictionary({groupedUnits:At(Me.Any),set:At(Me.Any),ranges:At(Me.Any)}),Me.Any),bundle:Ir(pr.Dictionary({elements:At(Me.Any)}),Wt.ElementSelectionQuery,"A selection with single structure containing represented by the bundle."),current:Ir(pr.None,Wt.ElementSelectionQuery,"Current selection provided by the query context. Avoid using this in State Transforms.")},Qce={"@header":"Internal Queries",generator:f9e};var Te={core:xE,structureQuery:Xce,internal:Qce};yE(Te);var h9e=bE(Te),C5t=(function(){let e=Object.create(null);for(let t of h9e)e[t.id]=t;return e})();var ie;(I=>{I.core=Te.core,I.struct=Te.structureQuery,I.internal=Te.internal;function n(v){return I.struct.type.atomName([v])}I.atomName=n;function o(v){return I.struct.type.elementSymbol([v])}I.es=o;function i(...v){return I.core.type.list(v)}I.list=i;function a(...v){return I.core.type.set(v)}I.set=a;function s(v,A){return I.core.type.regex([v,A])}I.re=s;function l(v){return I.core.ctrl.fn([v])}I.fn=l;function u(v){return I.core.ctrl.eval([v])}I.evaluate=u;let c=I.struct.atomProperty.core,m=I.struct.atomProperty.macromolecular,d=I.struct.atomProperty.topology;function p(v){return c[v]()}I.acp=p;function h(v){return d[v]()}I.atp=h;function f(v){return m[v]()}I.ammp=f;let g=I.struct.atomSet.propertySet;function y(v){return g([p(v)])}I.acpSet=y;function x(v){return g([h(v)])}I.atpSet=x;function S(v){return g([f(v)])}I.ammpSet=S})(ie||={});var g9e=b.add,y9e=b.squaredDistance,b9e=b.distance;var ku=class{constructor(){this.count=0;this.center=b();this.radiusSq=0}reset(){b.set(this.center,0,0,0),this.radiusSq=0,this.count=0}includeStep(t){g9e(this.center,this.center,t),this.count++}finishedIncludeStep(){this.count!==0&&b.scale(this.center,this.center,1/this.count)}radiusStep(t){let r=y9e(t,this.center);r>this.radiusSq&&(this.radiusSq=r)}radiusSphereStep(t,r){let n=b9e(t,this.center)+r,o=n*n;o>this.radiusSq&&(this.radiusSq=o)}getSphere(t){return t||(t=he()),b.copy(t.center,this.center),t.radius=Math.sqrt(this.radiusSq),t}getCount(){return this.count}};(a=>{let e=new a,t=b(),r=b();function n({x:s,y:l,z:u},c){e.reset();let m=s.length;for(let d=0;d<m;d++)b.set(t,s[d],l[d],u[d]),e.includeStep(t);e.finishedIncludeStep();for(let d=0;d<m;d++)b.set(t,s[d],l[d],u[d]),e.radiusStep(t);return b.copy(c.center,e.center),c.radius=Math.sqrt(e.radiusSq),c}a.fromArrays=n;function o(s,l,u){e.reset();for(let c=0;c<s;c++)l(c,t),e.includeStep(t);e.finishedIncludeStep();for(let c=0;c<s;c++)l(c,t),e.radiusStep(t);return b.copy(u.center,e.center),u.radius=Math.sqrt(e.radiusSq),u}a.fromProvider=o;function i(s,l,u){e.reset();for(let c=0;c<s;c++)l(c,t,r),e.includeStep(t),e.includeStep(r);e.finishedIncludeStep();for(let c=0;c<s;c++)l(c,t,r),e.radiusStep(t),e.radiusStep(r);return b.copy(u.center,e.center),u.radius=Math.sqrt(e.radiusSq),u}a.fromPairProvider=i})(ku||={});var Ad=class e{constructor(t){this.map=t;let r=0,n=[],o=new Map,i=new Map;this.map.forEach(a=>{a.forEach(s=>{r+=s.edgeCount,s.connectedIndices.forEach(l=>{s.getEdges(l).forEach(u=>{let{unitA:c,unitB:m}=s,d=e.getEdgeIndexKey(c,m),p=e.getEdgeIndexKey(l,u.indexB),h=o.get(d);h===void 0?o.set(d,new Map([[p,n.length]])):h.set(p,n.length);let f=e.getVertexKey(l,c),g=i.get(f);g===void 0?i.set(f,[n.length]):g.push(n.length),n.push({...u,indexA:l,unitA:c,unitB:m})})})})}),this.edgeCount=r,this.edges=n,this.edgeKeyIndex=o,this.vertexKeyIndex=i}getConnectedUnits(t){return this.map.has(t)?this.map.get(t):Zce}getEdgeIndex(t,r,n,o){let i=this.edgeKeyIndex.get(e.getEdgeUnitKey(r,o));if(i===void 0)return-1;let a=i.get(e.getEdgeIndexKey(t,n));return a!==void 0?a:-1}hasEdge(t,r,n,o){return this.getEdgeIndex(t,r,n,o)!==-1}getEdge(t,r,n,o){let i=this.getEdgeIndex(t,r,n,o);return i!==-1?this.edges[i]:void 0}getEdgeIndices(t,r){return this.vertexKeyIndex.get(e.getVertexKey(t,r))||[]}};(a=>{class e{constructor(l,u,c,m,d){this.unitA=l;this.unitB=u;this.edgeCount=c;this.connectedIndices=m;this.edgeMap=d}hasEdges(l){return this.edgeMap.has(l)}getEdges(l){return this.edgeMap.has(l)?this.edgeMap.get(l):Zce}get areUnitsOrdered(){return this.unitA<this.unitB}}a.UnitPairEdges=e;function t(s,l){return ca(s,l)}a.getEdgeUnitKey=t;function r(s,l){return ca(s,l)}a.getEdgeIndexKey=r;function n(s,l){return ca(s,l)}a.getVertexKey=n;function o(s,l,u){s.has(l)?s.get(l).push(u):s.set(l,[u])}class i{constructor(){this.map=new Map}startUnitPair(l,u){this.uA=l,this.uB=u,this.mapAB=new Map,this.mapBA=new Map,this.linkedA=Un.create(),this.linkedB=Un.create(),this.linkCount=0}finishUnitPair(){this.linkCount!==0&&(o(this.map,this.uA,new e(this.uA,this.uB,this.linkCount,this.linkedA.array,this.mapAB)),o(this.map,this.uB,new e(this.uB,this.uA,this.linkCount,this.linkedB.array,this.mapBA)))}add(l,u,c){o(this.mapAB,l,{indexB:u,props:c}),o(this.mapBA,u,{indexB:l,props:c}),Un.add(this.linkedA,l,l),Un.add(this.linkedB,u,u),this.linkCount+=1}getMap(){return this.map}}a.Builder=i})(Ad||={});var Zce=[];var N_;(t=>t.Empty=xs.create([],[],[],0,{flags:[],order:[],key:[]}))(N_||={});var og=class extends Ad{getBondFromLocation(t){return ue.isAtomic(t.aUnit)&&ue.isAtomic(t.bUnit)?this.getEdge(t.aIndex,t.aUnit.id,t.bIndex,t.bUnit.id):void 0}getBondIndexFromLocation(t){return ue.isAtomic(t.aUnit)&&ue.isAtomic(t.bUnit)?this.getEdgeIndex(t.aIndex,t.aUnit.id,t.bIndex,t.bUnit.id):-1}};(t=>{class e extends Ad.UnitPairEdges{}t.UnitPairBonds=e})(og||={});var x9e=4,CE={forceCompute:!1,noCompute:!1,maxRadius:x9e},P6={H:0,h:0,D:0,d:0,T:0,t:0,He:2,HE:2,he:2,Li:3,LI:3,li:3,Be:4,BE:4,be:4,B:5,b:5,C:6,c:6,N:7,n:7,O:8,o:8,F:9,f:9,Ne:10,NE:10,ne:10,Na:11,NA:11,na:11,Mg:12,MG:12,mg:12,Al:13,AL:13,al:13,Si:14,SI:14,si:14,P:15,p:15,S:16,s:16,Cl:17,CL:17,cl:17,Ar:18,AR:18,ar:18,K:19,k:19,Ca:20,CA:20,ca:20,Sc:21,SC:21,sc:21,Ti:22,TI:22,ti:22,V:23,v:23,Cr:24,CR:24,cr:24,Mn:25,MN:25,mn:25,Fe:26,FE:26,fe:26,Co:27,CO:27,co:27,Ni:28,NI:28,ni:28,Cu:29,CU:29,cu:29,Zn:30,ZN:30,zn:30,Ga:31,GA:31,ga:31,Ge:32,GE:32,ge:32,As:33,AS:33,as:33,Se:34,SE:34,se:34,Br:35,BR:35,br:35,Kr:36,KR:36,kr:36,Rb:37,RB:37,rb:37,Sr:38,SR:38,sr:38,Y:39,y:39,Zr:40,ZR:40,zr:40,Nb:41,NB:41,nb:41,Mo:42,MO:42,mo:42,Tc:43,TC:43,tc:43,Ru:44,RU:44,ru:44,Rh:45,RH:45,rh:45,Pd:46,PD:46,pd:46,Ag:47,AG:47,ag:47,Cd:48,CD:48,cd:48,In:49,IN:49,in:49,Sn:50,SN:50,sn:50,Sb:51,SB:51,sb:51,Te:52,TE:52,te:52,I:53,i:53,Xe:54,XE:54,xe:54,Cs:55,CS:55,cs:55,Ba:56,BA:56,ba:56,La:57,LA:57,la:57,Ce:58,CE:58,ce:58,Pr:59,PR:59,pr:59,Nd:60,ND:60,nd:60,Pm:61,PM:61,pm:61,Sm:62,SM:62,sm:62,Eu:63,EU:63,eu:63,Gd:64,GD:64,gd:64,Tb:65,TB:65,tb:65,Dy:66,DY:66,dy:66,Ho:67,HO:67,ho:67,Er:68,ER:68,er:68,Tm:69,TM:69,tm:69,Yb:70,YB:70,yb:70,Lu:71,LU:71,lu:71,Hf:72,HF:72,hf:72,Ta:73,TA:73,ta:73,W:74,w:74,Re:75,RE:75,re:75,Os:76,OS:76,os:76,Ir:77,IR:77,ir:77,Pt:78,PT:78,pt:78,Au:79,AU:79,au:79,Hg:80,HG:80,hg:80,Tl:81,TL:81,tl:81,Pb:82,PB:82,pb:82,Bi:83,BI:83,bi:83,Po:84,PO:84,po:84,At:85,AT:85,at:85,Rn:86,RN:86,rn:86,Fr:87,FR:87,fr:87,Ra:88,RA:88,ra:88,Ac:89,AC:89,ac:89,Th:90,TH:90,th:90,Pa:91,PA:91,pa:91,U:92,u:92,Np:93,NP:93,np:93,Pu:94,PU:94,pu:94,Am:95,AM:95,am:95,Cm:96,CM:96,cm:96,Bk:97,BK:97,bk:97,Cf:98,CF:98,cf:98,Es:99,ES:99,es:99,Fm:100,FM:100,fm:100,Md:101,MD:101,md:101,No:102,NO:102,no:102,Lr:103,LR:103,lr:103,Rf:104,RF:104,rf:104,Db:105,DB:105,db:105,Sg:106,SG:106,sg:106,Bh:107,BH:107,bh:107,Hs:108,HS:108,hs:108,Mt:109,MT:109,mt:109},C9e={0:1.42,1:1.42,3:2.7,4:2.7,6:1.75,7:1.6,8:1.52,11:2.7,12:2.7,13:2.7,14:1.9,15:2,16:1.9,17:1.8,19:2.7,20:2.7,21:2.7,22:2.7,23:2.7,24:2.7,25:2.7,26:2.7,27:2.7,28:2.7,29:2.7,30:2.7,31:2.7,33:2.68,37:2.7,38:2.7,39:2.7,40:2.7,41:2.7,42:2.7,43:2.7,44:2.7,45:2.7,46:2.7,47:2.7,48:2.7,49:2.7,50:2.7,55:2.7,56:2.7,57:2.7,58:2.7,59:2.7,60:2.7,61:2.7,62:2.7,63:2.7,64:2.7,65:2.7,66:2.7,67:2.7,68:2.7,69:2.7,70:2.7,71:2.7,72:2.7,73:2.7,74:2.7,75:2.7,76:2.7,77:2.7,78:2.7,79:2.7,80:2.7,81:2.7,82:2.7,83:2.7,87:2.7,88:2.7,89:2.7,90:2.7,91:2.7,92:2.7,93:2.7,94:2.7,95:2.7,96:2.7,97:2.7,98:2.7,99:2.7,100:2.7,101:2.7,102:2.7,103:2.7,104:2.7,105:2.7,106:2.7,107:2.7,108:2.7,109:2.88},S9e={0:.8,20:1.31,27:1.2,35:1.15,44:1.1,54:1,60:1.84,72:1.88,84:1.75,85:1.56,86:1.76,98:1.6,99:1.68,100:1.63,112:1.6,113:1.59,114:1.36,129:1.45,135:1.47,144:1.6,152:1.45,170:1.4,180:1.55,202:2.4,222:2.24,224:1.91,225:1.98,243:2.02,269:2,293:1.9,316:1.8,420:2.37,480:2.3,512:2.3,544:2.3,612:2.1,629:1.54,665:1,813:2.6,854:2.27,894:1.93,896:2.1,937:2.05,938:2.06,981:1.62,1258:2.68,1309:2.33,1484:1,1763:2.14,1823:2.48,1882:2.1,1944:1.72,2380:2.34,3367:2.44,3733:2.11,3819:2.6,3821:2.36,4736:2.75,5724:2.73,5959:2.63,6519:2.84,6750:2.87,8991:2.81},qce=2.001,nC=(function(){let e=["LI","NA","K","RB","CS","FR","BE","MG","CA","SR","BA","RA","AL","GA","IN","SN","TL","PB","BI","SC","TI","V","CR","MN","FE","CO","NI","CU","ZN","Y","ZR","NB","MO","TC","RU","RH","PD","AG","CD","LA","HF","TA","W","RE","OS","IR","PT","AU","HG","AC","RF","DB","SG","BH","HS","MT","CE","PR","ND","PM","SM","EU","GD","TB","DY","HO","ER","TM","YB","LU","TH","PA","U","NP","PU","AM","CM","BK","CF","ES","FM","MD","NO","LR"],t=new Set;for(let r of e)t.add(P6[r]);return t})();function v9e(e,t){return e<t?(e+t)*(e+t+1)/2+t:(e+t)*(e+t+1)/2+e}function Mm(e){let t=P6[e];return t===void 0?-1:t}function I9e(e,t){if(e<0||t<0)return-1;let r=S9e[v9e(e,t)];return r===void 0?-1:r}function ig(e){if(e<0)return qce;let t=C9e[e];return t===void 0?qce:t}function RI(e,t,r,n){let o=I9e(e,t);return o>0?o:t<0?r:(r+n)/1.95}var A9e=P6.H;function gp(e){return e===A9e}var T9e=new Map([["HIS|CD2|CG",2],["HIS|CE1|ND1",2],["ARG|CZ|NH2",2],["PHE|CE1|CZ",2],["PHE|CD2|CE2",2],["PHE|CD1|CG",2],["TRP|CD1|CG",2],["TRP|CD2|CE2",2],["TRP|CE3|CZ3",2],["TRP|CH2|CZ2",2],["ASN|CG|OD1",2],["GLN|CD|OE1",2],["TYR|CD1|CG",2],["TYR|CD2|CE2",2],["TYR|CE1|CZ",2],["ASP|CG|OD1",2],["GLU|CD|OE1",2],["G|C8|N7",2],["G|C4|C5",2],["G|C2|N3",2],["G|C6|O6",2],["C|C4|N3",2],["C|C5|C6",2],["C|C2|O2",2],["A|C2|N3",2],["A|C6|N1",2],["A|C4|C5",2],["A|C8|N7",2],["U|C5|C6",2],["U|C2|O2",2],["U|C4|O4",2],["DG|C8|N7",2],["DG|C4|C5",2],["DG|C2|N3",2],["DG|C6|O6",2],["DC|C4|N3",2],["DC|C5|C6",2],["DC|C2|O2",2],["DA|C2|N3",2],["DA|C6|N1",2],["DA|C4|C5",2],["DA|C8|N7",2],["DT|C5|C6",2],["DT|C2|O2",2],["DT|C4|O4",2]]);function Yce(e,t,r){return[t,r]=t<r?[t,r]:[r,t],MS.has(e)&&t==="C"&&r==="O"||BS.has(e)&&t==="OP1"&&r==="P"?2:T9e.get(`${e}|${t}|${r}`)||1}var P9e=new Map([["LYS|NZ|RET|C15",2]]);function SE(e,t,r,n){return e>r&&([e,r]=[r,e],[t,n]=[n,t]),P9e.get(`${e}|${t}|${r}|${n}`)||1}var Kce="0.3.0",$n;(o=>{let e;(m=>(m[m.Int8=1]="Int8",m[m.Int16=2]="Int16",m[m.Int32=3]="Int32",m[m.Uint8=4]="Uint8",m[m.Uint16=5]="Uint16",m[m.Uint32=6]="Uint32"))(e=o.IntDataType||={});let t;(s=>(s[s.Float32=32]="Float32",s[s.Float64=33]="Float64"))(t=o.FloatDataType||={});function r(i){let a;return i instanceof Int8Array?a=1:i instanceof Int16Array?a=2:i instanceof Int32Array?a=3:i instanceof Uint8Array?a=4:i instanceof Uint16Array?a=5:i instanceof Uint32Array?a=6:i instanceof Float32Array?a=32:i instanceof Float64Array?a=33:a=3,a}o.getDataType=r;function n(i){if(i instanceof Int8Array||i instanceof Int16Array||i instanceof Int32Array)return!0;for(let a=0,s=i.length;a<s;a++)if(a<0)return!1;return!0}o.isSignedIntegerDataType=n})($n||={});var Jce=new Uint16Array(new Uint8Array([18,52]).buffer)[0]===13330;function $ce(e,t){let r=new ArrayBuffer(e.length),n=new Uint8Array(r);for(let o=0,i=e.length;o<i;o+=t)for(let a=0;a<t;a++)n[o+t-a-1]=e[o+a];return r}var _6=28672;function eme(e){if(e.length>_6){let t=[];for(let r=0;r<e.length;r+=_6)t.push(String.fromCharCode.apply(null,e.subarray(r,r+_6)));return t.join("")}else return String.fromCharCode.apply(null,e)}function DI(e){let t=e.data;for(let r=e.encoding.length-1;r>=0;r--)t=_9e(t,e.encoding[r]);return t}function _9e(e,t){switch(t.kind){case"ByteArray":switch(t.type){case $n.IntDataType.Uint8:return e;case $n.IntDataType.Int8:return R9e(e);case $n.IntDataType.Int16:return D9e(e);case $n.IntDataType.Uint16:return w9e(e);case $n.IntDataType.Int32:return M9e(e);case $n.IntDataType.Uint32:return B9e(e);case $n.FloatDataType.Float32:return E9e(e);case $n.FloatDataType.Float64:return k9e(e);default:Mr(t.type)}case"FixedPoint":return F9e(e,t);case"IntervalQuantization":return L9e(e,t);case"RunLength":return V9e(e,t);case"Delta":return O9e(e,t);case"IntegerPacking":return N9e(e,t);case"StringArray":return z9e(e,t)}}function tme(e,t){switch(e){case $n.IntDataType.Int8:return new Int8Array(t);case $n.IntDataType.Int16:return new Int16Array(t);case $n.IntDataType.Int32:return new Int32Array(t);case $n.IntDataType.Uint8:return new Uint8Array(t);case $n.IntDataType.Uint16:return new Uint16Array(t);case $n.IntDataType.Uint32:return new Uint32Array(t);default:return new Int32Array(t)}}function rme(e,t){switch(e){case $n.FloatDataType.Float32:return new Float32Array(t);case $n.FloatDataType.Float64:return new Float64Array(t);default:return new Float64Array(t)}}function R9e(e){return new Int8Array(e.buffer,e.byteOffset)}function wI(e,t,r){return Jce?new r(e.buffer):new r($ce(e,t))}function D9e(e){return wI(e,2,Int16Array)}function w9e(e){return wI(e,2,Uint16Array)}function M9e(e){return wI(e,4,Int32Array)}function B9e(e){return wI(e,4,Uint32Array)}function E9e(e){return wI(e,4,Float32Array)}function k9e(e){return wI(e,8,Float64Array)}function F9e(e,t){let r=e.length,n=rme(t.srcType,r),o=1/t.factor;for(let i=0;i<r;i++)n[i]=o*e[i];return n}function L9e(e,t){let r=e.length,n=rme(t.srcType,r),o=(t.max-t.min)/(t.numSteps-1),i=t.min;for(let a=0;a<r;a++)n[a]=i+o*e[a];return n}function V9e(e,t){let r=tme(t.srcType,t.srcSize),n=0;for(let o=0,i=e.length;o<i;o+=2){let a=e[o],s=e[o+1];for(let l=0;l<s;++l)r[n++]=a}return r}function O9e(e,t){let r=e.length,n=tme(t.srcType,r);if(!r)return e;n[0]=e[0]+(t.origin|0);for(let o=1;o<r;++o)n[o]=e[o]+n[o-1];return n}function G9e(e,t){let r=t.byteCount===1?127:32767,n=-r-1,o=e.length,i=new Int32Array(t.srcSize),a=0,s=0;for(;a<o;){let l=0,u=e[a];for(;u===r||u===n;)l+=u,a++,u=e[a];l+=u,i[s]=l,a++,s++}return i}function U9e(e,t){let r=t.byteCount===1?255:65535,n=e.length,o=new Int32Array(t.srcSize),i=0,a=0;for(;i<n;){let s=0,l=e[i];for(;l===r;)s+=l,i++,l=e[i];s+=l,o[a]=s,i++,a++}return o}function N9e(e,t){return e.length===t.srcSize?e:t.isUnsigned?U9e(e,t):G9e(e,t)}function z9e(e,t){let r=DI({encoding:t.offsetEncoding,data:t.offsets}),n=DI({encoding:t.dataEncoding,data:e}),o=t.stringData,i=new Array(r.length);i[0]="";for(let l=1,u=r.length;l<u;l++)i[l]=o.substring(r[l-1],r[l]);let a=0,s=new Array(n.length);for(let l=0,u=n.length;l<u;l++)s[a++]=i[n[l]+1];return s}function H9e(e,t,r){let n=1,o;for(o=0;o<t;o++){let i=n*e;if(Math.abs(Math.round(i)-i)<=r)return o;n*=10}return-1}function nme(e,t){return Math.abs(e)<t?0:Math.floor(Math.log10(Math.abs(e)))+1}function ome(e,t,r){let n=1,o=0;for(let i=0,a=e.length;i<a;i++){if(n>=0){let l=H9e(e[i],t,r);l<0?n=-1:l>n&&(n=l)}let s=Math.abs(e[i]);if(s>r){let l=Math.floor(Math.log10(Math.abs(s)))+1;l>o&&(o=l)}}return{mantissaDigits:n,integerDigits:o}}function ime(e){e=e.trim();let t=parseInt(e,10);return Number.isNaN(t)?!1:t.toString()===e}function LS(e){if(!isFinite(e))return 0;let t=1,r=0;for(;Math.round(e*t)/t!==e;)t*=10,++r;return r}function z_(e,t){return parseFloat(e.toPrecision(t))}function ame(e,t){return parseFloat(e.toFixed(t))}function H_(e){return vE.classify(e)}function sme(e){return lme.classify(e)}var vE;(d=>{function e(p,h){return p>=0?Math.ceil((p+1)/h):Math.ceil((p+1)/(-h-1))}function t(p){let h=!1;for(let f=0,g=p.length;f<g;f++)if(p[f]<0){h=!0;break}return h?{signed:h,limit8:127,limit16:32767}:{signed:h,limit8:255,limit16:65535}}function r(){return{pack8:0,pack16:0,count:0}}function n({limit8:p,limit16:h},f,g){f.pack8+=e(g,p),f.pack16+=e(g,h),f.count+=1}function o(p,h){p.pack8+=e(h,127),p.pack16+=e(h,32767),p.count+=1}function i(p){return p.count*4<p.pack16*2?{length:p.count*4,elem:4}:p.pack16*2<p.pack8?{length:p.pack16*2,elem:2}:{length:p.pack8,elem:1}}function a(p,h){let f=r();for(let g=0,y=p.length;g<y;g++)n(h,f,p[g]);return{...i(f),kind:"pack"}}function s(p,h){let f=r(),g=p[0];for(let y=1,x=p.length;y<x;y++)o(f,p[y]-g),g=p[y];return{...i(f),kind:"delta"}}function l(p,h){let f=r(),g=1;for(let y=1,x=p.length;y<x;y++)p[y-1]!==p[y]?(n(h,f,p[y-1]),n(h,f,g),g=1):g++;return n(h,f,p[p.length-1]),n(h,f,g),{...i(f),kind:"rle"}}function u(p,h){let f=r(),g=1,y=0,x=0;for(let S=1,I=p.length;S<I;S++){let v=p[S]-y;x!==v?(o(f,x),o(f,g),g=1):g++,x=v,y=p[S]}return o(f,x),o(f,g),{...i(f),kind:"delta-rle"}}function c(p){let h=t(p),f=[a(p,h),l(p,h),s(p,h),u(p,h)];return f.sort((g,y)=>g.length-y.length),f}d.getSize=c;function m(p){if(p.length<2)return wn.by(wn.byteArray);let f=c(p)[0];switch(f.kind){case"pack":return wn.by(wn.integerPacking);case"rle":return wn.by(wn.runLength).and(wn.integerPacking);case"delta":return wn.by(wn.delta).and(wn.integerPacking);case"delta-rle":return wn.by(wn.delta).and(wn.runLength).and(wn.integerPacking);default:Mr(f)}}d.classify=m})(vE||={});var lme;(n=>{function t(o){let{mantissaDigits:a,integerDigits:s}=ome(o,4,1e-6);if(a<0||a+s>10)return wn.by(wn.byteArray);if(a===0)return vE.classify(o);let l=r(a),u=new Int32Array(o.length);for(let p=0,h=o.length;p<h;p++)u[p]=Math.round(l*o[p]);let m=vE.getSize(u)[0],d=wn.by(wn.fixedPoint(l));switch(m.kind){case"pack":return d.and(wn.integerPacking);case"rle":return d.and(wn.runLength).and(wn.integerPacking);case"delta":return d.and(wn.delta).and(wn.integerPacking);case"delta-rle":return d.and(wn.delta).and(wn.runLength).and(wn.integerPacking);default:Mr(m)}}n.classify=t;function r(o){let i=1;for(let a=0;a<o;a++)i*=10;return i}})(lme||={});var IE=class e{constructor(t){this.providers=t}and(t){return new e(this.providers.concat([t]))}encode(t){let r=[];for(let n of this.providers){let o=n(t);if(!o.encodings.length)throw new Error("Encodings must be non-empty.");t=o.data;for(let i of o.encodings)r.push(i)}if(!(t instanceof Uint8Array))throw new Error("The encoding must result in a Uint8Array. Fix your encoding chain.");return{encoding:r,data:t}}},ag;(n=>{function e(o){return new IE([o])}n.by=e;function t(o){let i=e(r(o[0]));for(let a=1;a<o.length&&o[a-1].kind!=="IntegerPacking";a++)i=i.and(r(o[a]));return i}n.fromEncoding=t;function r(o){switch(o.kind){case"ByteArray":return wn.byteArray;case"FixedPoint":return wn.fixedPoint(o.factor);case"IntervalQuantization":return wn.intervalQuantizaiton(o.min,o.max,o.numSteps);case"RunLength":return wn.runLength;case"Delta":return wn.delta;case"IntegerPacking":return wn.integerPacking;case"StringArray":return wn.stringArray}}})(ag||={});var wn;(S=>{function e(I){return new IE([I])}S.by=e;function t(I){return{encodings:[{kind:"ByteArray",type:$n.IntDataType.Uint8}],data:I}}function r(I){return{encodings:[{kind:"ByteArray",type:$n.IntDataType.Int8}],data:new Uint8Array(I.buffer,I.byteOffset)}}let n={[$n.IntDataType.Int16]:function(I,v,A){I.setInt16(2*v,A,!0)},[$n.IntDataType.Uint16]:function(I,v,A){I.setUint16(2*v,A,!0)},[$n.IntDataType.Int32]:function(I,v,A){I.setInt32(4*v,A,!0)},[$n.IntDataType.Uint32]:function(I,v,A){I.setUint32(4*v,A,!0)},[$n.FloatDataType.Float32]:function(I,v,A){I.setFloat32(4*v,A,!0)},[$n.FloatDataType.Float64]:function(I,v,A){I.setFloat64(8*v,A,!0)}},o={[$n.IntDataType.Int16]:2,[$n.IntDataType.Uint16]:2,[$n.IntDataType.Int32]:4,[$n.IntDataType.Uint32]:4,[$n.FloatDataType.Float32]:4,[$n.FloatDataType.Float64]:8};function i(I){let v=$n.getDataType(I);if(v===$n.IntDataType.Int8)return r(I);if(v===$n.IntDataType.Uint8)return t(I);let A=new Uint8Array(I.length*o[v]),P=n[v],T=new DataView(A.buffer);for(let R=0,w=I.length;R<w;R++)P(T,R,I[R]);return{encodings:[{kind:"ByteArray",type:v}],data:A}}S.byteArray=i;function a(I,v){let A=$n.getDataType(I),P=new Int32Array(I.length);for(let T=0,R=I.length;T<R;T++)P[T]=Math.round(I[T]*v);return{encodings:[{kind:"FixedPoint",factor:v,srcType:A}],data:P}}function s(I){return v=>a(v,I)}S.fixedPoint=s;function l(I,v,A,P,T){let R=$n.getDataType(I);if(!I.length)return{encodings:[{kind:"IntervalQuantization",min:v,max:A,numSteps:P,srcType:R}],data:new Int32Array(0)};if(A<v){let M=v;v=A,A=M}let w=(A-v)/(P-1),E=new T(I.length);for(let M=0,D=I.length;M<D;M++){let B=I[M];B<=v?E[M]=0:B>=A?E[M]=P-1:E[M]=Math.round((B-v)/w)|0}return{encodings:[{kind:"IntervalQuantization",min:v,max:A,numSteps:P,srcType:R}],data:E}}function u(I,v,A,P=Int32Array){return T=>l(T,I,v,A,P)}S.intervalQuantizaiton=u;function c(I){let v=$n.getDataType(I);if(v===void 0&&(I=new Int32Array(I),v=$n.IntDataType.Int32),!I.length)return{encodings:[{kind:"RunLength",srcType:v,srcSize:0}],data:new Int32Array(0)};let A=2;for(let w=1,E=I.length;w<E;w++)I[w-1]!==I[w]&&(A+=2);let P=new Int32Array(A),T=0,R=1;for(let w=1,E=I.length;w<E;w++)I[w-1]!==I[w]?(P[T]=I[w-1],P[T+1]=R,R=1,T+=2):++R;return P[T]=I[I.length-1],P[T+1]=R,{encodings:[{kind:"RunLength",srcType:v,srcSize:I.length}],data:P}}S.runLength=c;function m(I){if(!$n.isSignedIntegerDataType(I))throw new Error("Only signed integer types can be encoded using delta encoding.");let v=$n.getDataType(I);if(v===void 0&&(I=new Int32Array(I),v=$n.IntDataType.Int32),!I.length)return{encodings:[{kind:"Delta",origin:0,srcType:v}],data:new I.constructor(0)};let A=new I.constructor(I.length),P=I[0];A[0]=I[0];for(let T=1,R=I.length;T<R;T++)A[T]=I[T]-I[T-1];return A[0]=0,{encodings:[{kind:"Delta",origin:P,srcType:v}],data:A}}S.delta=m;function d(I){for(let v=0,A=I.length;v<A;v++)if(I[v]<0)return!0;return!1}function p(I,v){let A=0;for(let P=0,T=I.length;P<T;P++)A+=I[P]/v|0;return A+=I.length,A}function h(I,v){let A=-v-1,P=0;for(let T=0,R=I.length;T<R;T++){let w=I[T];w>=0?P+=w/v|0:P+=w/A|0}return P+=I.length,P}function f(I){let v=d(I),A=v?h(I,127):p(I,255),P=v?h(I,32767):p(I,65535);return I.length*4<P*2?{isSigned:v,size:I.length,bytesPerElement:4}:P*2<A?{isSigned:v,size:P,bytesPerElement:2}:{isSigned:v,size:A,bytesPerElement:1}}function g(I,v){let A=v.isSigned?v.bytesPerElement===1?127:32767:v.bytesPerElement===1?255:65535,P=-A-1,T=I.length,R=v.isSigned?v.bytesPerElement===1?new Int8Array(v.size):new Int16Array(v.size):v.bytesPerElement===1?new Uint8Array(v.size):new Uint16Array(v.size),w=0;for(let M=0;M<T;M++){let D=I[M];if(D>=0)for(;D>=A;)R[w]=A,++w,D-=A;else for(;D<=P;)R[w]=P,++w,D-=P;R[w]=D,++w}let E=i(R);return{encodings:[{kind:"IntegerPacking",byteCount:v.bytesPerElement,isUnsigned:!v.isSigned,srcSize:T},E.encodings[0]],data:E.data}}function y(I){let v=f(I);return v.bytesPerElement===4?i(I):g(I,v)}S.integerPacking=y;function x(I){let v=Object.create(null),A=[],P=new Int32Array(I.length),T=qe.create(Int32Array,1,Math.min(1024,I.length<32?I.length+1:Math.round(I.length/8)+1));qe.add(T,0);let R=0,w=0;for(let F of I){if(F==null){P[w++]=-1;continue}let z=v[F];z===void 0&&(R+=F.length,z=A.length,A[z]=F,v[F]=z,qe.add(T,R)),P[w++]=z}let E=qe.compact(T),D=H_(E).encode(E),k=H_(P).encode(P);return{encodings:[{kind:"StringArray",dataEncoding:k.encoding,stringData:A.join(""),offsetEncoding:D.encoding,offsets:D.data}],data:k.data}}S.stringArray=x})(wn||={});var sc;(s=>{let e;(m=>(m[m.Str=0]="Str",m[m.Int=1]="Int",m[m.Float=2]="Float"))(e=s.Type||={});function t(l,u,c){return{name:l,type:0,value:u,valueKind:c&&c.valueKind,defaultFormat:c&&c.encoder?{encoder:c.encoder}:void 0,shouldInclude:c&&c.shouldInclude}}s.str=t;function r(l,u,c){return{name:l,type:1,value:u,valueKind:c&&c.valueKind,defaultFormat:c?{encoder:c.encoder,typedArray:c.typedArray}:void 0,shouldInclude:c&&c.shouldInclude}}s.int=r;function n(l,u,c){return{name:l,type:2,value:u,valueKind:c&&c.valueKind,defaultFormat:c?{encoder:c.encoder,typedArray:c.typedArray,digitCount:typeof c.digitCount<"u"?c.digitCount:void 0}:void 0,shouldInclude:c&&c.shouldInclude}}s.float=n;function o(l){return r(l,(u,c,m)=>m+1,{typedArray:Int32Array,encoder:wn.by(wn.delta).and(wn.runLength).and(wn.integerPacking)})}s.index=o;class i{constructor(){this.fields=[]}index(u){return this.fields.push(s.index(u)),this}str(u,c,m){return this.fields.push(s.str(u,c,m)),this}int(u,c,m){return this.fields.push(s.int(u,c,m)),this}vec(u,c,m){for(let d=0;d<c.length;d++)this.fields.push(s.int(`${u}[${d+1}]`,c[d],m));return this}float(u,c,m){return this.fields.push(s.float(u,c,m)),this}many(u){for(let c=0;c<u.length;c++)this.fields.push(u[c]);return this}add(u){return this.fields.push(u),this}getFields(){return this.fields}}s.Builder=i;function a(){return new i}s.build=a})(sc||={});var Hc;(i=>{i.Empty={fields:[],source:[]};function t(a){let s=[],l=[],u=[],c=[];for(let d of a.split(/[\r\n]+/)){if(d=d.trim(),d.length===0)continue;let p=/^!/.test(d);p&&(d=d.substr(1));let h=d.split(/\./),f=h[1],g=p?f?c:l:f?u:s;g[g.length]=d,f&&!s.includes(h[0])&&(s[s.length]=h[0])}let m=u.map(d=>d.split(".")[0]);return{includeCategory(d){return l.includes(d)?!1:s.length<=0||s.indexOf(d)!==-1},includeField(d,p){let h=d+"."+p;return c.includes(h)?!1:!m.includes(d)||u.includes(h)}}}i.filterOf=t,i.DefaultFilter={includeCategory(a){return!0},includeField(a,s){return!0}},i.DefaultFormatter={getFormat(a,s){}};function o(a,s){return s?{fields:ume(a._schema),source:[{data:a,rowCount:s.length,keys:()=>PS.Array(s)}]}:{fields:ume(a._schema),source:[{data:a,rowCount:a._rowCount}]}}i.ofTable=o})(Hc||={});var w6;(r=>{function e(n,o,i){n.startDataBlock(o);for(let a of i._tableNames)n.writeCategory({name:a,instance:()=>Hc.ofTable(i[a])})}r.writeDatabase=e;function t(n,o){for(let i of Object.keys(o))e(n,i,o[i])}r.writeDatabaseCollection=t})(w6||={});function R6(e){return(t,r)=>r[e].value(t)}function j9e(e){return(t,r)=>r[e].value(t).join(r[e].schema.separator)}function D6(e,...t){return(r,n)=>n[e].schema.space.get(n[e].value(r),...t)}function j_(e){return(t,r)=>r[e].valueKind(t)}function W9e(e,t){let r=[],n=2,o=j_(e);if(t.rank===1){let i=t.dimensions[0];for(let a=0;a<i;a++){let s=`${e}[${a+1}]`;r.push({name:s,type:n,value:D6(e,a),valueKind:o})}}else if(t.rank===2){let i=t.dimensions[0],a=t.dimensions[1];for(let s=0;s<i;s++)for(let l=0;l<a;l++){let u=`${e}[${s+1}][${l+1}]`;r.push({name:u,type:n,value:D6(e,s,l),valueKind:o})}}else if(t.rank===3){let i=t.dimensions[0],a=t.dimensions[1],s=t.dimensions[2];for(let l=0;l<i;l++)for(let u=0;u<a;u++)for(let c=0;c<s;c++){let m=`${e}[${l+1}][${u+1}][${c+1}]`;r.push({name:m,type:n,value:D6(e,l,u,c),valueKind:o})}}else throw new Error("Tensors with rank > 3 or rank 0 are currently not supported.");return r}function ume(e){let t=[];for(let r of Object.keys(e)){let n=e[r];n.valueType==="int"?t.push({name:r,type:1,value:R6(r),valueKind:j_(r)}):n.valueType==="float"?t.push({name:r,type:2,value:R6(r),valueKind:j_(r)}):n.valueType==="str"?t.push({name:r,type:0,value:R6(r),valueKind:j_(r)}):n.valueType==="list"?t.push({name:r,type:0,value:j9e(r),valueKind:j_(r)}):n.valueType==="tensor"?t.push(...W9e(r,n.space)):Mr(n.valueType)}return t}function cme(e){return e.defaultFormat&&typeof e.defaultFormat.digitCount<"u"?Math.max(0,Math.min(e.defaultFormat.digitCount,16)):6}function W_(e){return e.fields.some(t=>!!t.shouldInclude)?e.fields.filter(t=>!t.shouldInclude||e.source.some(r=>t.shouldInclude(r.data))):e.fields}function AE(e,t){let r=e.instance(t),n=r.source.filter(a=>a.rowCount>0);if(!n.length)return{instance:r,rowCount:0,source:[]};let o=n.reduce((a,s)=>a+s.rowCount,0),i=n.map(a=>({data:a.data,keys:()=>a.keys?a.keys():PS.Range(0,a.rowCount-1),rowCount:a.rowCount}));return{instance:r,rowCount:o,source:i}}var PE=class{constructor(){this.builder=Yn.create();this.encoded=!1;this.dataBlockCreated=!1;this.filter=Hc.DefaultFilter;this.formatter=Hc.DefaultFormatter;this.isBinary=!1;this.binaryEncodingProvider=void 0}setFilter(t){this.filter=t||Hc.DefaultFilter}isCategoryIncluded(t){return this.filter.includeCategory(t)}setFormatter(t){this.formatter=t||Hc.DefaultFormatter}startDataBlock(t){this.dataBlockCreated=!0,Yn.write(this.builder,`data_${(t||"").replace(/[ \n\t]/g,"").toUpperCase()}
#
`)}writeCategory(t,r,n){if(this.encoded)throw new Error("The writer contents have already been encoded, no more writing.");if(!this.dataBlockCreated)throw new Error("No data block created.");if(!n?.ignoreFilter&&!this.filter.includeCategory(t.name))return;let{instance:o,rowCount:i,source:a}=AE(t,r);i&&(i===1?Q9e(t,o,a,this.builder,this.filter,this.formatter):Z9e(t,o,a,this.builder,this.filter,this.formatter))}encode(){this.encoded=!0}writeTo(t){let r=Yn.getChunks(this.builder);for(let n=0,o=r.length;n<o;n++)t.writeString(r[n])}getSize(){return Yn.getSize(this.builder)}getData(){return Yn.getString(this.builder)}};function dme(e,t,r,n,o,i){let a=n.valueKind,s=a?a(r,t):W.ValueKinds.Present;if(s!==W.ValueKinds.Present)s===W.ValueKinds.NotPresent?J9e(e):$9e(e);else{let l=n.value(r,t,i),u=n.type;if(u===sc.Type.Str)return q9e(l)?(TE(e,l),!0):e6e(e,l);u===sc.Type.Int?Y9e(e,l):K9e(e,l,o)}return!1}function pme(e,t,r){let n=[];for(let o of t){let i=r.getFormat(e,o.name);i&&typeof i.digitCount<"u"?n[n.length]=o.type===sc.Type.Float?Math.pow(10,Math.max(0,Math.min(i.digitCount,15))):0:n[n.length]=o.type===sc.Type.Float?Math.pow(10,cme(o)):0}return n}function Q9e(e,t,r,n,o,i){let a=W_(t),s=r[0],l=s.data,u=a.reduce((p,h)=>o.includeField(e.name,h.name)?Math.max(p,h.name.length):0,0);if(u===0)return;u+=e.name.length+6;let m=s.keys().move(),d=pme(e.name,t.fields,i);for(let p=0;p<a.length;p++){let h=a[p];if(!o.includeField(e.name,h.name))continue;Yn.writePadRight(n,`_${e.name}.${h.name}`,u),dme(n,l,m,h,d[p],0)||Yn.newline(n)}Yn.write(n,`#
`)}function Z9e(e,t,r,n,o,i){let a=W_(t),s=o===Hc.DefaultFilter?a:a.filter(m=>o.includeField(e.name,m.name)),l=s.length;if(l===0)return;let u=pme(e.name,s,i);mme(n,"loop_");for(let m=0;m<l;m++)mme(n,`_${e.name}.${s[m].name}`);let c=0;for(let m=0;m<r.length;m++){let d=r[m],p=d.data;if(d.rowCount===0)continue;let h=d.keys();for(;h.hasNext;){let f=h.move(),g=!1;for(let y=0;y<l;y++)g=dme(n,p,f,s[y],u[y],c);g||Yn.newline(n),c++}}Yn.write(n,`#
`)}function q9e(e){return typeof e=="string"&&e.indexOf(`
`)>=0}function mme(e,t){Yn.write(e,t),Yn.newline(e)}function Y9e(e,t){Yn.writeInteger(e,t),Yn.whitespace1(e)}function K9e(e,t,r){Yn.writeFloat(e,t,r),Yn.whitespace1(e)}function J9e(e){Yn.writeSafe(e,". ")}function $9e(e){Yn.writeSafe(e,"? ")}function e6e(e,t){if(!t)return Yn.writeSafe(e,". "),!1;let r=t.charCodeAt(0),n=!1,o=0,i=!1,a=!1;for(let s=0,l=t.length-1;s<=l;s++)switch(t.charCodeAt(s)){case 9:n=!0;break;case 10:return TE(e,t),!0;case 32:n=!0;break;case 34:if(s&&s===l)break;if(i)return TE(e,t),!0;a=!0,n=!0,o=0;break;case 39:if(s&&s===l)break;if(a)return TE(e,t),!0;i=!0,n=!0,o=1;break}return!n&&(r===35||r===36||r===59||r===91||r===93||r===95)&&(n=!0),n?(Yn.writeSafe(e,o?'"':"'"),Yn.writeSafe(e,t),Yn.writeSafe(e,o?'" ':"' ")):(Yn.writeSafe(e,t),Yn.writeSafe(e," ")),!1}function TE(e,t){Yn.writeSafe(e,`
;`+t),Yn.writeSafe(e,`
;
`)}function fme(e){let t=new ArrayBuffer(_E(e)),r=new DataView(t),n=new Uint8Array(t);return RE(e,r,n,0),n}function _E(e){let t=typeof e;if(t==="string"){let r=pI(e);if(r<32)return 1+r;if(r<256)return 2+r;if(r<65536)return 3+r;if(r<4294967296)return 5+r}if(e instanceof Uint8Array){let r=e.byteLength;if(r<256)return 2+r;if(r<65536)return 3+r;if(r<4294967296)return 5+r}if(t==="number"){if(Math.floor(e)!==e)return 9;if(e>=0){if(e<128)return 1;if(e<256)return 2;if(e<65536)return 3;if(e<4294967296)return 5;throw new Error("Number too big 0x"+e.toString(16))}if(e>=-32)return 1;if(e>=-128)return 2;if(e>=-32768)return 3;if(e>=-2147483648)return 5;throw new Error("Number too small -0x"+e.toString(16).substr(1))}if(t==="boolean"||e===null||e===void 0)return 1;if(t==="object"){let r,n=0;if(Array.isArray(e)){r=e.length;for(let o=0;o<r;o++)n+=_E(e[o])}else{let o=Object.keys(e);r=o.length;for(let i=0;i<r;i++){let a=o[i];n+=_E(a)+_E(e[a])}}if(r<16)return 1+n;if(r<65536)return 3+n;if(r<4294967296)return 5+n;throw new Error("Array or object too long 0x"+r.toString(16))}throw new Error("Unknown type "+t)}function RE(e,t,r,n){let o=typeof e;if(o==="string"){let i=pI(e);if(i<32)return t.setUint8(n,i|160),Wx(r,n+1,e),1+i;if(i<256)return t.setUint8(n,217),t.setUint8(n+1,i),Wx(r,n+2,e),2+i;if(i<65536)return t.setUint8(n,218),t.setUint16(n+1,i),Wx(r,n+3,e),3+i;if(i<4294967296)return t.setUint8(n,219),t.setUint32(n+1,i),Wx(r,n+5,e),5+i}if(e instanceof Uint8Array){let i=e.byteLength,a=new Uint8Array(t.buffer);if(i<256)return t.setUint8(n,196),t.setUint8(n+1,i),a.set(e,n+2),2+i;if(i<65536)return t.setUint8(n,197),t.setUint16(n+1,i),a.set(e,n+3),3+i;if(i<4294967296)return t.setUint8(n,198),t.setUint32(n+1,i),a.set(e,n+5),5+i}if(o==="number"){if(!isFinite(e))throw new Error("Number not finite: "+e);if(Math.floor(e)!==e)return t.setUint8(n,203),t.setFloat64(n+1,e),9;if(e>=0){if(e<128)return t.setUint8(n,e),1;if(e<256)return t.setUint8(n,204),t.setUint8(n+1,e),2;if(e<65536)return t.setUint8(n,205),t.setUint16(n+1,e),3;if(e<4294967296)return t.setUint8(n,206),t.setUint32(n+1,e),5;throw new Error("Number too big 0x"+e.toString(16))}if(e>=-32)return t.setInt8(n,e),1;if(e>=-128)return t.setUint8(n,208),t.setInt8(n+1,e),2;if(e>=-32768)return t.setUint8(n,209),t.setInt16(n+1,e),3;if(e>=-2147483648)return t.setUint8(n,210),t.setInt32(n+1,e),5;throw new Error("Number too small -0x"+(-e).toString(16).substr(1))}if(e==null)return t.setUint8(n,192),1;if(o==="boolean")return t.setUint8(n,e?195:194),1;if(o==="object"){let i,a=0,s=Array.isArray(e),l;if(s?i=e.length:(l=Object.keys(e),i=l.length),i<16?(t.setUint8(n,i|(s?144:128)),a=1):i<65536?(t.setUint8(n,s?220:222),t.setUint16(n+1,i),a=3):i<4294967296&&(t.setUint8(n,s?221:223),t.setUint32(n+1,i),a=5),s)for(let u=0;u<i;u++)a+=RE(e[u],t,r,n+a);else for(let u=0,c=l.length;u<c;u++){let m=l[u];a+=RE(m,t,r,n+a),a+=RE(e[m],t,r,n+a)}return a}throw new Error("Unknown type "+o)}var DE=class{constructor(t,r,n){this.autoClassify=n;this.dataBlocks=[];this.filter=Hc.DefaultFilter;this.formatter=Hc.DefaultFormatter;this.isBinary=!0;this.binaryEncodingProvider=void 0;this.binaryEncodingProvider=r,this.data={encoder:t,version:Kce,dataBlocks:this.dataBlocks}}setFilter(t){this.filter=t||Hc.DefaultFilter}isCategoryIncluded(t){return this.filter.includeCategory(t)}setFormatter(t){this.formatter=t||Hc.DefaultFormatter}startDataBlock(t){this.dataBlocks.push({header:(t||"").replace(/[ \n\t]/g,"").toUpperCase(),categories:[]})}writeCategory(t,r,n){if(!this.data)throw new Error("The writer contents have already been encoded, no more writing.");if(!this.dataBlocks.length)throw new Error("No data block created.");if(!n?.ignoreFilter&&!this.filter.includeCategory(t.name))return;let{instance:o,rowCount:i,source:a}=AE(t,r);if(!i)return;let s={name:"_"+t.name,columns:[],rowCount:i},l=W_(o);for(let u of l){if(!this.filter.includeField(t.name,u.name))continue;let c=this.formatter.getFormat(t.name,u.name);s.columns.push(i6e(t.name,u,a,i,c,this.binaryEncodingProvider,this.autoClassify))}s.columns.length&&this.dataBlocks[this.dataBlocks.length-1].categories.push(s)}encode(){this.encodedData||(this.encodedData=fme(this.data),this.data=null,this.dataBlocks=null)}writeTo(t){t.writeBinary(this.encodedData)}getData(){return this.encode(),this.encodedData}getSize(){return this.encodedData.length}};function t6e(e,t){return t&&t.typedArray?t.typedArray:e.defaultFormat&&e.defaultFormat.typedArray?e.defaultFormat.typedArray:e.type===sc.Type.Str?Array:e.type===sc.Type.Int?Int32Array:Float64Array}function r6e(e){return e===sc.Type.Str?ag.by(wn.stringArray):ag.by(wn.byteArray)}function n6e(e,t,r,n){return r&&r.encoder?r.encoder:t.defaultFormat&&t.defaultFormat.encoder?t.defaultFormat.encoder:n?n.get(e,t.name):void 0}function o6e(e,t){return e===sc.Type.Str?ag.by(wn.stringArray):e===sc.Type.Int?H_(t):sme(t)}function i6e(e,t,r,n,o,i,a){let{array:s,allPresent:l,mask:u}=a6e(t,t6e(t,o),n,r),c;t.type===sc.Type.Str?c=ag.by(wn.stringArray):c=n6e(e,t,o,i),c||(a?c=o6e(t.type,s):c=r6e(t.type));let m=c.encode(s),d;if(!l){let p=ag.by(wn.runLength).and(wn.byteArray).encode(u);p.data.length<u.length?d=p:d=ag.by(wn.byteArray).encode(u)}return{name:t.name,data:m,mask:d}}function a6e(e,t,r,n){let o=e.type===sc.Type.Str,i=new t(r),a=new Uint8Array(r),s=e.valueKind,l=e.value,u=!0,c=0;for(let m=0;m<n.length;m++){let d=n[m].data,p=n[m].keys();for(;p.hasNext;){let h=p.move(),f=s?s(h,d):W.ValueKinds.Present;if(f!==W.ValueKinds.Present)a[c]=f,o&&(i[c]=""),u=!1;else{let g=l(h,d,c);typeof g=="string"&&!g?(a[c]=W.ValueKinds.NotPresent,u=!1):a[c]=W.ValueKinds.Present,i[c]=g}c++}}return{array:i,allPresent:u,mask:a}}var ta;(d=>{d.Encoder=w6,d.Category=Hc,d.Field=sc,d.Encoding=wn;function o(p){let{binary:h=!1,encoderName:f="mol*"}=p||{};return h?new DE(f,p?p.binaryEncodingPovider:void 0,p?!!p.binaryAutoClassifyEncoding:!1):new PE}d.createEncoder=o;function i(){return d.Field.build()}d.fields=i;let a=d.Encoding;d.Encodings={deltaRLE:a.by(a.delta).and(a.runLength).and(a.integerPacking),fixedPoint2:a.by(a.fixedPoint(100)).and(a.delta).and(a.integerPacking),fixedPoint3:a.by(a.fixedPoint(1e3)).and(a.delta).and(a.integerPacking)};function l(p,h){return{fields:p,source:[h]}}d.categoryInstance=l;function u(p){return{get(h,f){let g=p.categories[h];if(!g)return;let y=g.getField(f);return y&&y.binaryEncoding?ag.fromEncoding(y.binaryEncoding):void 0}}}d.createEncodingProviderFromCifFrame=u;function c(p){return{get(h,f){for(let g=0;g<p.length;g++){let y=p[g];if(y.categoryName===h&&y.columnName===f)return m(y)}}}}d.createEncodingProviderFromJsonConfig=c;function m(p){let h=p.precision;if(h!==void 0){let f=Math.pow(10,h),g=a.by(a.fixedPoint(f));switch(p.encoding){case"pack":return g.and(a.integerPacking);case"rle":return g.and(a.runLength).and(a.integerPacking);case"delta":return g.and(a.delta).and(a.integerPacking);case"delta-rle":return g.and(a.delta).and(a.runLength).and(a.integerPacking)}}else switch(p.encoding){case"pack":return a.by(a.integerPacking);case"rle":return a.by(a.runLength).and(a.integerPacking);case"delta":return a.by(a.delta).and(a.integerPacking);case"delta-rle":return a.by(a.delta).and(a.runLength).and(a.integerPacking)}throw new Error("cannot be reached")}})(ta||={});var oC;(i=>{i.Descriptor={name:"chem_comp_bond",cifExport:{prefix:"",categories:[{name:"chem_comp_bond",instance(a){let s=i.Provider.get(a.firstModel);if(!s)return ta.Category.Empty;let l=s.data;if(!l)return ta.Category.Empty;let u=a.structures[0].uniqueResidueNames,{comp_id:c,_rowCount:m}=l,d=[];for(let p=0;p<m;p++)u.has(c.value(p))&&(d[d.length]=p);return ta.Category.ofTable(l,d)}}]}},i.Provider=_l.create(i.Descriptor);function r(a,s){return wr.pick(s,bn.chem_comp_bond,l=>a.properties.chemicalComponentMap.has(s.comp_id.value(l)))}i.chemCompBondFromTable=r;function n(a){let s=new Map;function l(y){if(s.has(y))return s.get(y);let x=new o(y);return s.set(y,x),x}let{comp_id:u,atom_id_1:c,atom_id_2:m,value_order:d,pdbx_aromatic_flag:p,_rowCount:h,pdbx_ordinal:f}=a,g=l(u.value(0));for(let y=0;y<h;y++){let x=u.value(y),S=c.value(y),I=m.value(y),v=d.value(y),A=p.value(y)==="y",P=f.value(y);g.id!==x&&(g=l(x));let T=xt.Flag.Covalent,R=1;switch(A&&(T|=xt.Flag.Aromatic),v.toLowerCase()){case"delo":T|=xt.Flag.Aromatic;break;case"doub":R=2;break;case"trip":R=3;break;case"quad":R=4;break}g.add(S,I,R,T,P)}return s}i.getEntriesFromChemCompBond=n;class o{constructor(s){this.id=s;this.map=new Map}add(s,l,u,c,m,d=!0){let p=this.map.get(s);if(p!==void 0)p.get(l)===void 0&&p.set(l,{order:u,flags:c,key:m});else{let h=new Map;h.set(l,{order:u,flags:c,key:m}),this.map.set(s,h)}d&&this.add(l,s,u,c,m,!1)}}i.Entry=o})(oC||={});var jc;(a=>{a.Descriptor={name:"struct_conn",cifExport:{prefix:"",categories:[{name:"struct_conn",instance(s){let l=a.Provider.get(s.firstModel);if(!l||l.entries.length===0)return ta.Category.Empty;let u=s.structures[0],c=[];for(let m of l.entries)n(u,m.partnerA.atomIndex)&&n(u,m.partnerB.atomIndex)&&(c[c.length]=m.rowIndex);return ta.Category.ofTable(l.data,c)}}]}},a.Provider=_l.create(a.Descriptor);function r(s){let l=a.Provider.get(s);return!!l&&l.entries.length/s.atomicConformation.atomId.rowCount>.95}a.isExhaustive=r;function n({units:s},l){for(let u=0,c=s.length;u<c;u++)if(Be.indexOf(s[u].elements,l)>=0)return!0;return!1}function o(s){let l=new Map;for(let u of s){let{partnerA:{atomIndex:c},partnerB:{atomIndex:m}}=u;l.has(c)?l.get(c).push(u):l.set(c,[u]),l.has(m)?l.get(m).push(u):l.set(m,[u])}return l}a.getAtomIndexFromEntries=o;function i(s,l){let{conn_type_id:u,pdbx_dist_value:c,pdbx_value_order:m}=s,d={label_asym_id:s.ptnr1_label_asym_id,label_seq_id:s.ptnr1_label_seq_id,auth_seq_id:s.ptnr1_auth_seq_id,label_atom_id:s.ptnr1_label_atom_id,label_alt_id:s.pdbx_ptnr1_label_alt_id,ins_code:s.pdbx_ptnr1_PDB_ins_code,symmetry:s.ptnr1_symmetry},p={label_asym_id:s.ptnr2_label_asym_id,label_seq_id:s.ptnr2_label_seq_id,auth_seq_id:s.ptnr2_auth_seq_id,label_atom_id:s.ptnr2_label_atom_id,label_alt_id:s.pdbx_ptnr2_label_alt_id,ins_code:s.pdbx_ptnr2_PDB_ins_code,symmetry:s.ptnr2_symmetry},h=Array.from(l.entities.data.id.toArray()),f=(y,x)=>{if(x.label_asym_id.valueKind(y)!==W.ValueKinds.Present)return;let S=x.label_asym_id.value(y),I=x.label_atom_id.value(y);if(!I)return;let v=x.auth_seq_id.valueKind(y)===W.ValueKind.Present?x.auth_seq_id.value(y):x.label_seq_id.value(y),A=x.ins_code.value(y),P=x.label_alt_id.value(y);for(let T of h){let R=l.atomicHierarchy.index.findResidue(T,S,v,A);if(R<0)continue;let w=l.atomicHierarchy.index.findAtomOnResidue(R,I,P);if(!(w<0))return{residueIndex:R,atomIndex:w,symmetry:x.symmetry.value(y)}}},g=[];for(let y=0;y<s._rowCount;y++){let x=f(y,d),S=f(y,p);if(x===void 0||S===void 0)continue;let I=u.value(y),v=m.value(y)||"",A=xt.Flag.None,P=1;switch(v){case"sing":P=1;break;case"doub":P=2;break;case"trip":P=3;break;case"quad":P=4;break;default:P=SE(s.ptnr1_label_comp_id.value(y),s.ptnr1_label_atom_id.value(y),s.ptnr2_label_comp_id.value(y),s.ptnr2_label_atom_id.value(y))}switch(I){case"covale":A=xt.Flag.Covalent;break;case"disulf":A=xt.Flag.Covalent|xt.Flag.Disulfide;break;case"hydrog":A=xt.Flag.HydrogenBond;break;case"metalc":A=xt.Flag.MetallicCoordination;break}g.push({rowIndex:y,flags:A,order:P,distance:c.value(y),partnerA:x,partnerB:S})}return g}a.getEntriesFromStructConn=i})(jc||={});var s6e=b.distance,l6e=6,u6e=5.5,c6e=3.9;function M6(e,t,r,n,o,i,a){let s=new xs.EdgeBuilder(i,e,t),l=new Uint16Array(s.slotCount),u=new Int8Array(s.slotCount),c=new Uint32Array(s.slotCount);for(let m=0,d=s.edgeCount;m<d;m++)s.addNextEdge(),s.assignProperty(l,n[m]),s.assignProperty(u,r[m]),s.assignProperty(c,o[m]);return s.createGraph({flags:l,order:u,key:c},a)}var hme=b(),gme=b();function m6e(e,t,r){return e.conformation.position(t,hme),e.conformation.position(r,gme),s6e(hme,gme)}var d6e=new Set;function p6e(e){let t=Xo.Provider.get(e.model),{elements:r}=e,{type_symbol:n}=e.model.atomicHierarchy.atoms,o=e.elements.length,{maxDistance:i}=t,{offset:a,b:s,edgeProps:{order:l,distance:u,flag:c,key:m,operatorA:d,operatorB:p}}=t.bonds,{atomSourceIndex:h}=e.model.atomicHierarchy,{invertedIndex:f}=Gt.getInvertedAtomSourceIndex(e.model),g=[],y=[],x=[],S=[],I=[],v=e.conformation.operator.key;for(let A=0;A<o;A++){let P=r[A],T=Mm(n.value(P)),R=gp(T),w=h.value(P);for(let E=a[w],M=a[w+1];E<M;++E){let D=f[s[E]];if(P>=D)continue;let B=Be.indexOf(e.elements,D);if(B<0)continue;let k=d[E],F=p[E];if(k>=0&&k!==v||F>=0&&F!==v)continue;let z=Mm(n.value(D)),j=u[E],Y=m6e(e,P,D),G=!1;if(j>=0)G=mo(Y,j,.3);else if(i>=0)G=Y<i;else{let X=RI(T,z,ig(T),ig(z));G=Y<X,R&&gp(z)&&(G=!1)}G&&(g[g.length]=A,y[y.length]=B,S[S.length]=l[E],x[x.length]=c[E],I[I.length]=m[E])}}return M6(g,y,S,x,I,o,{canRemap:!1,cacheable:t.cacheable})}function f6e(e,t){let r=Gt.isCoarseGrained(e.model),n=r?l6e:t.maxRadius,{x:o,y:i,z:a}=e.model.atomicConformation,s=e.elements.length,{elements:l,residueIndex:u,chainIndex:c}=e,{type_symbol:m,label_atom_id:d,label_alt_id:p,label_comp_id:h}=e.model.atomicHierarchy.atoms,{label_seq_id:f}=e.model.atomicHierarchy.residues,{traceElementIndex:g}=e.model.atomicHierarchy.derived.residue,{index:y}=e.model.atomicHierarchy,{byEntityKey:x}=e.model.sequence,S=e.lookup3d,I=jc.Provider.get(e.model),v=oC.Provider.get(e.model),A=jc.isExhaustive(e.model),P=[],T=[],R=[],w=[],E=[],M=-1,D,B=!0,k=!0,F=!0,z=d6e,j=!!I?.residueCantorPairs.size;for(let Y=0;Y<s;Y++){let G=l[Y],X=m.value(G);B&&X!=="H"&&X!=="O"&&(B=!1);let U=t.forceCompute?void 0:I&&I.byAtomIndex.get(G),L=!1;if(U)for(let ve of U){let{partnerA:K,partnerB:re}=ve;if(K.symmetry!==re.symmetry)continue;let le=K.atomIndex===G?re:K,ge=Be.indexOf(e.elements,le.atomIndex);ge<0||l[ge]<G||(P[P.length]=Y,T[T.length]=ge,R[R.length]=ve.flags,w[w.length]=ve.order,E[E.length]=ve.rowIndex,L||z.clear(),L=!0,z.add(ge))}if(A)continue;let q=u[G],te=f.value(q),J=h.value(G);if(!t.forceCompute&&q!==M)if(v&&v.entries.has(J)){let ve=x[y.getEntityFromChain(c[G])];ve&&ve.sequence.microHet.has(te)?D=void 0:D=v.entries.get(J).map}else D=void 0;M=q;let ee=Mm(X),ce=d.value(G),fe=D?D.get(ce):void 0,{indices:O,count:V,squaredDistances:Z}=S.find(o[G],i[G],a[G],n),pe=gp(ee),$=ig(ee),ae=p.value(G),Se=nC.has(ee);for(let ve=0;ve<V;ve++){let K=O[ve];if(L&&z.has(K))continue;let re=l[K];if(re<=G)continue;let le=p.value(re);if(ae&&le&&ae!==le)continue;if(j){let Fe=Mc(u[G],u[re]);if(I.residueCantorPairs.has(Fe))continue}let ge=Mm(m.value(re)),Ee=gp(ge);if(pe&&Ee)continue;let nt=(Se||nC.has(ge))&&!(pe||Ee),at=u[re];if(q===at&&fe){let Fe=fe.get(d.value(re));if(Fe){P[P.length]=Y,T[T.length]=K,w[w.length]=Fe.order;let Ne=Fe.flags;nt&&(Ne|xt.Flag.Covalent&&(Ne^=xt.Flag.Covalent),Ne|=xt.Flag.MetallicCoordination),R[R.length]=Ne,E[E.length]=Fe.key}continue}let be=Math.sqrt(Z[ve]);if(be===0)continue;let Re=!1;if(r)q===at?Re=be<=u6e:Re=be<=c6e&&g[q]===G&&g[at]===re;else{let Fe=RI(ee,ge,$,ig(ge));Re=be<=Fe}if(Re){P[P.length]=Y,T[T.length]=K,w[w.length]=Yce(J,ce,d.value(re)),R[R.length]=(nt?xt.Flag.MetallicCoordination:xt.Flag.Covalent)|xt.Flag.Computed,E[E.length]=-1;let Fe=f.value(at);te===Fe&&(k=!1),Math.abs(te-Fe)>1&&(F=!1)}}}return M6(P,T,w,R,E,s,{canRemap:B||k&&F})}function h6e(e){return e.conformation.operator.key===-1?!1:!!Xo.Provider.get(e.model)?.hasOperators}function g6e(e){let t=Xo.Provider.get(e.model),r=t.bySameOperator.get(e.conformation.operator.key);if(!r)return N_.Empty;let{a:n,b:o,edgeProps:{key:i,flag:a,order:s}}=t.bonds,{invertedIndex:l}=Gt.getInvertedAtomSourceIndex(e.model),{elements:u}=e,c=[],m=[],d=[],p=[],h=[];for(let f=0,g=r.length;f<g;++f){let y=r[f];if(n[y]>=o[y])continue;let x=l[n[y]],S=Be.indexOf(u,x);if(S<0)continue;let I=l[o[y]],v=Be.indexOf(u,I);v<0||(c[c.length]=S,m[m.length]=v,d[d.length]=a[y],p[p.length]=s[y],h[h.length]=i[y])}return M6(c,m,p,d,h,u.length,{canRemap:!1,cacheable:t.cacheable})}function yme(e,t){let r={...CE,...t};return r.noCompute?N_.Empty:e.elements.length<=1?N_.Empty:!r.forceCompute&&Xo.Provider.get(e.model)?h6e(e)?g6e(e):p6e(e):f6e(e,r)}var y6e=b.distance,b6e=b.set,x6e=b.squaredDistance,C6e=b.transformMat4,bme=b(),xme=b();function Cme(e,t,r,n){return e.conformation.position(t,bme),r.conformation.position(n,xme),y6e(bme,xme)}var S6e=H(),VS=b();function v6e(e,t,r,n){let{maxRadius:o}=r,{elements:i,residueIndex:a}=e,{x:s,y:l,z:u}=e.model.atomicConformation,{elements:c,residueIndex:m}=t,d=e.elements.length,{type_symbol:p,label_alt_id:h,label_atom_id:f,label_comp_id:g}=e.model.atomicHierarchy.atoms,{type_symbol:y,label_alt_id:x,label_atom_id:S,label_comp_id:I}=t.model.atomicHierarchy.atoms,{auth_seq_id:v}=e.model.atomicHierarchy.residues,{auth_seq_id:A}=t.model.atomicHierarchy.residues,{occupancy:P}=e.model.atomicConformation,{occupancy:T}=t.model.atomicConformation,R=P.isDefined&&T.isDefined,w=e.model===t.model&&jc.Provider.get(e.model),E=!r.forceCompute&&e.model===t.model&&Xo.Provider.get(e.model),{atomSourceIndex:M}=e.model.atomicHierarchy,{invertedIndex:D}=E?Gt.getInvertedAtomSourceIndex(t.model):{invertedIndex:void 0},B=e.model===t.model&&jc.isExhaustive(e.model),k=H.mul(S6e,t.conformation.operator.inverse,e.conformation.operator.matrix),F=!H.isIdentity(k),{center:z,radius:j}=t.boundary.sphere,Y=(j+o)*(j+o);n.startUnitPair(e.id,t.id);let G=e.conformation.operator.key,X=t.conformation.operator.key;for(let U=0;U<d;U++){let L=i[U];if(b6e(VS,s[L],l[L],u[L]),F&&C6e(VS,VS,k),x6e(VS,z)>Y)continue;if(!r.forceCompute&&E){let{maxDistance:ve}=E,{offset:K,b:re,edgeProps:{order:le,distance:ge,flag:Ee,key:nt,operatorA:at,operatorB:be}}=E.bonds,Re=M.value(L),Fe=Mm(p.value(L));for(let Ne=K[Re],ot=K[Re+1];Ne<ot;++Ne){let it=D[re[Ne]],Xt=Be.indexOf(t.elements,it);if(Xt<0)continue;let $r=at[Ne],bt=be[Ne];if($r>=0&&bt>=0&&($r===bt||$r!==G||bt!==X))continue;let xr=Mm(p.value(it)),tn=ge[Ne],pn=Cme(e,L,t,it),io=!1;if(tn>=0)io=mo(pn,tn,.3);else if(ve>=0)io=pn<ve;else{let Hn=RI(Fe,xr,ig(Fe),ig(xr));io=pn<Hn,gp(Fe)&&gp(xr)&&(io=!1)}io&&n.add(U,Xt,{order:le[Ne],flag:Ee[Ne],key:nt[Ne]})}continue}let q=r.forceCompute?void 0:w&&w.byAtomIndex.get(L);if(q&&q.length){let ve=!1;for(let K of q){let{partnerA:re,partnerB:le}=K,ge=re.atomIndex===L?le:re,Ee=Be.indexOf(t.elements,ge.atomIndex);Ee<0||Cme(e,L,t,ge.atomIndex)>o||(n.add(U,Ee,{order:K.order,flag:K.flags,key:K.rowIndex}),ve=!0)}if(ve)continue}if(B)continue;let te=P.value(L),{lookup3d:J}=t,{indices:ee,count:ce,squaredDistances:fe}=J.find(VS[0],VS[1],VS[2],o);if(ce===0)continue;let O=Mm(p.value(L)),V=gp(O),Z=ig(O),pe=h.value(L),$=nC.has(O),ae=f.value(L),Se=g.value(a[L]);for(let ve=0;ve<ce;ve++){let K=ee[ve],re=c[K],le=x.value(re);if(pe&&le&&pe!==le||R&&T.value(re)<1&&te<1&&v.value(a[L])===A.value(m[re]))continue;if(w&&e.model===t.model){let Re=Mc(a[L],m[re]);if(w.residueCantorPairs.has(Re))continue}let ge=Mm(y.value(re)),Ee=gp(ge);if(V&&Ee)continue;let nt=($||nC.has(ge))&&!(V||Ee),at=Math.sqrt(fe[ve]);if(at===0)continue;let be=RI(O,ge,Z,ig(ge));if(at<=be){let Re=S.value(re),Fe=I.value(m[re]);n.add(U,K,{order:SE(Se,Fe,ae,Re),flag:(nt?xt.Flag.MetallicCoordination:xt.Flag.Covalent)|xt.Flag.Computed,key:-1})}}}n.finishUnitPair()}function I6e(e){for(let t of e.models)if(!Xo.Provider.get(t)?.hasOperators)return!1;for(let t of e.units)if(t.conformation.operator.key===-1)return!1;return!0}function A6e(e,t){let r=new Map;for(let n of e.units){let{key:o}=n.conformation.operator;r.has(o)?r.get(o).add(n):r.set(o,new Set([n]))}for(let n of e.models){let o=Xo.Provider.get(n),{a:i,b:a}=o.bonds,{order:s,flag:l,key:u,operatorA:c,operatorB:m}=o.bonds.edgeProps,{invertedIndex:d}=Gt.getInvertedAtomSourceIndex(n),p=new Map;for(let g of e.units)if(g.model===n)for(let y=0,x=g.elements.length;y<x;++y){let S=g.elements[y];p.has(S)?p.get(S).add(g):p.set(S,new Set([g]))}let h=new Map;for(let g=0,y=c.length;g<y;++g){let x,S;if(c[g]===m[g]?(x=p.get(d[i[g]]),S=p.get(d[a[g]])):(x=r.get(c[g]),S=r.get(m[g])),!(!x||!S)){for(let I of x)if(c[g]===I.conformation.operator.key)for(let v of S){if(m[g]!==v.conformation.operator.key||I===v||!ue.isAtomic(I)||!ue.isAtomic(v)||I.id>v.id)continue;let A=ca(I.id,v.id);h.has(A)?h.get(A).add(g):h.set(A,new Set([g]))}}}let f=[-1,-1];h.forEach((g,y)=>{let[x,S]=Ov(f,y),I=e.unitMap.get(x),v=e.unitMap.get(S);t.startUnitPair(x,S),g.forEach(A=>{let P=d[i[A]],T=Be.indexOf(I.elements,P);if(T<0)return;let R=d[a[A]],w=Be.indexOf(v.elements,R);w<0||t.add(T,w,{order:s[A],flag:l[A],key:u[A]})}),t.finishUnitPair()})}}var T6e={...CE,ignoreWater:!0,ignoreIon:!0};function P6e(e,t){let r=new Ad.Builder,n=e.models.some(i=>Xo.Provider.get(i)),o=e.models.some(i=>jc.isExhaustive(i));return t.noCompute||e.isCoarseGrained&&!n&&!o?new og(r.getMap()):!t.forceCompute&&I6e(e)?(A6e(e,r),new og(r.getMap())):(De.eachUnitPair(e,(i,a)=>{v6e(i,a,t,r)},{maxRadius:t.maxRadius,validUnit:i=>t.validUnit(i),validUnitPair:(i,a)=>t.validUnitPair(e,i,a)}),new og(r.getMap()))}function Sme(e,t){let r={...T6e,...t};return P6e(e,{...r,validUnit:t&&t.validUnit||(n=>ue.isAtomic(n)),validUnitPair:t&&t.validUnitPair||((n,o,i)=>{if(!De.validUnitPair(n,o,i))return!1;let s=o.model.atomicHierarchy.derived.residue.moleculeType,l=i.model.atomicHierarchy.derived.residue.moleculeType,u=(!ue.isAtomic(o)||s[o.residueIndex[o.elements[0]]]!==2)&&(!ue.isAtomic(i)||l[i.residueIndex[i.elements[0]]]!==2),c=!ue.isAtomic(o)||s[o.residueIndex[o.elements[0]]]!==3,m=!ue.isAtomic(i)||l[i.residueIndex[i.elements[0]]]!==3,d=c&&m;return(u||!r.ignoreWater)&&(d||!r.ignoreIon)?!0:_6e(o,i)})})}function _6e(e,t){if(e.model!==t.model||!ue.isAtomic(e)||!ue.isAtomic(t))return!1;let r=jc.Provider.get(e.model);if(!r)return!1;let n=e.elements.length<t.elements.length?e:t,o=e.elements.length>=t.elements.length?e:t,{elements:i}=n,{elements:a}=o,{indexOf:s}=Be;for(let l=0,u=i.length;l<u;l++){let c=i[l],m=r.byAtomIndex.get(c);if(m?.length)for(let d of m){let p=d.partnerA.atomIndex===c?d.partnerB.atomIndex:d.partnerA.atomIndex;if(s(a,p)>=0)return!0}}return!1}var It;(f=>{function e(g,y,x,S,I,v){return{kind:"bond-location",aStructure:g,aUnit:y,aIndex:x,bStructure:S,bUnit:I,bIndex:v}}f.Location=e;function t(g){return!!g&&g.kind==="bond-location"}f.isLocation=t;function r(g,y){return g.aStructure.label===y.aStructure.label&&g.bStructure.label===y.bStructure.label&&g.aIndex===y.aIndex&&g.bIndex===y.bIndex&&g.aUnit.id===y.aUnit.id&&g.bUnit.id===y.bUnit.id}f.areLocationsEqual=r;function n(g,y){return{kind:"bond-loci",structure:g,bonds:y}}f.Loci=n;function o(g){return!!g&&g.kind==="bond-loci"}f.isLoci=o;function i(g,y){if(g.structure!==y.structure||g.bonds.length!==y.bonds.length)return!1;for(let x=0,S=g.bonds.length;x<S;++x)if(!r(g.bonds[x],y.bonds[x]))return!1;return!0}f.areLociEqual=i;function a(g){return g.bonds.length===0}f.isLociEmpty=a;function s(g,y){if(y===g.structure)return g;let x=[];return g.bonds.forEach(S=>{let I=y.unitMap.get(S.aUnit.id);if(!I)return;let v=y.unitMap.get(S.bUnit.id);if(!v)return;let A=S.aUnit.elements[S.aIndex],P=Be.indexOf(I.elements,A);if(P===-1)return;let T=S.bUnit.elements[S.bIndex],R=Be.indexOf(v.elements,T);R!==-1&&x.push(e(g.structure,I,P,g.structure,v,R))}),n(y,x)}f.remapLoci=s;function l(g){let y=[],x=new Map;for(let S of g.bonds){let{aIndex:I,aUnit:v,bIndex:A,bUnit:P}=S;v===P?x.has(v.id)?x.get(v.id).push(I,A):x.set(v.id,[I,A]):(x.has(v.id)?x.get(v.id).push(I):x.set(v.id,[I]),x.has(P.id)?x.get(P.id).push(A):x.set(P.id,[A]))}return x.forEach((S,I)=>{y.push({unit:g.structure.unitMap.get(I),indices:Be.deduplicate(Be.ofUnsortedArray(S))})}),Q.Loci(g.structure,y)}f.toStructureElementLoci=l;function u(g){let{aUnit:y,aIndex:x}=g.bonds[0];return Q.Loci(g.structure,[{unit:y,indices:xe.ofSingleton(x)}])}f.toFirstStructureElementLoci=u;function c(g,y){if(y.aUnit===y.bUnit){let x=y.aUnit.bonds,S=x.getEdgeIndex(y.aIndex,y.bIndex);return S<0?xt.create(xt.Flag.None):xt.create(x.edgeProps.flags[S])}else{let x=g.interUnitBonds.getBondFromLocation(y);return x?xt.create(x.props.flag):xt.create(xt.Flag.None)}}f.getType=c;function m(g,y){if(y.aUnit===y.bUnit){let x=y.aUnit.bonds,S=x.getEdgeIndex(y.aIndex,y.bIndex);return S<0?0:x.edgeProps.order[S]}else{let x=g.interUnitBonds.getBondFromLocation(y);return x?x.props.order:0}}f.getOrder=m;function d(g){let y=0;for(let x of g.unitSymmetryGroups){let S=x.units[0];ue.isAtomic(S)&&(y+=S.bonds.edgeCount*x.units.length)}return y}f.getIntraUnitBondCount=d;class p{constructor(){this.current={};this.hasNext=!1}move(){return this.advance(),this.current}setElement(y,x,S){this.structure=y,this.unit=x,this.index=S,this.interBondIndices=y.interUnitBonds.getEdgeIndices(S,x.id),this.interBondCount=this.interBondIndices.length,this.interBondIndex=0,this.intraBondEnd=x.bonds.offset[S+1],this.intraBondIndex=x.bonds.offset[S],this.hasNext=this.interBondIndex<this.interBondCount||this.intraBondIndex<this.intraBondEnd}advance(){if(this.intraBondIndex<this.intraBondEnd)this.current.otherUnit=this.unit,this.current.otherIndex=this.unit.bonds.b[this.intraBondIndex],this.current.type=this.unit.bonds.edgeProps.flags[this.intraBondIndex],this.current.order=this.unit.bonds.edgeProps.order[this.intraBondIndex],this.intraBondIndex+=1;else if(this.interBondIndex<this.interBondCount){let y=this.structure.interUnitBonds.edges[this.interBondIndices[this.interBondIndex]];this.current.otherUnit=this.structure.unitMap.get(y.unitA!==this.unit.id?y.unitA:y.unitB),this.current.otherIndex=y.indexA!==this.index?y.indexA:y.indexB,this.current.type=y.props.flag,this.current.order=y.props.order,this.interBondIndex+=1}else{this.hasNext=!1;return}this.hasNext=this.interBondIndex<this.interBondCount||this.intraBondIndex<this.intraBondEnd}}f.ElementBondIterator=p;function h(g,y){return ku.fromPairProvider(g.bonds.length,(x,S,I)=>{let{aUnit:v,aIndex:A,bUnit:P,bIndex:T}=g.bonds[x];v.conformation.position(v.elements[A],S),P.conformation.position(P.elements[T],I)},y)}f.getBoundingSphere=h})(It||={});function Rme(e){let t=D6e(e),r=R6e(e,t),n=Kt.transientSegments(e.model.atomicHierarchy.residueAtomSegments,e.elements);for(;n.hasNext;){let o=n.move();w6e(r,o.start,o.end)}return r.rings}function R6e(e,t){return{startVertex:0,endVertex:0,count:0,isRingAtom:new Int32Array(t),marked:new Int32Array(t),queue:new Int32Array(t),pred:new Int32Array(t),depth:new Int32Array(t),left:new Int32Array(5),right:new Int32Array(5),color:new Int32Array(t),currentColor:0,currentAltLoc:"",hasAltLoc:!1,rings:[],currentRings:[],unit:e,bonds:e.bonds,altLoc:e.model.atomicHierarchy.atoms.label_alt_id}}function vme(e){e.count=e.endVertex-e.startVertex;let{isRingAtom:t,pred:r,color:n,depth:o,marked:i}=e;for(let a=0;a<e.count;a++)t[a]=0,r[a]=-1,i[a]=-1,n[a]=0,o[a]=0;e.currentColor=0,e.currentAltLoc="",e.hasAltLoc=!1}function Ime(e){let{depth:t}=e;for(let r=0;r<e.count;r++)t[r]=e.count+1}function D6e(e){let t=Kt.transientSegments(e.model.atomicHierarchy.residueAtomSegments,e.elements),r=0;for(;t.hasNext;){let n=t.move();r=Math.max(r,n.end-n.start)}return r}function Ame(e,t){let r=e.bonds.offset,n=e.startVertex+t,o=r[n],a=r[n+1]-o;return!(a<=1||e.isRingAtom[t]&&a===2)}function w6e(e,t,r){if(e.startVertex=t,e.endVertex=r,e.endVertex-e.startVertex<3)return;e.currentRings=[];let{elements:n}=e.unit,o=[];for(let a=e.startVertex;a<e.endVertex;a++){let s=e.altLoc.value(n[a]);li(o,s)}Jd(o,"");let i=1;if(o.length===0){vme(e);for(let a=0;a<e.count;a++)Ame(e,a)&&(Ime(e),i=Tme(e,a,i))}else for(let a=0;a<o.length;a++){vme(e),e.hasAltLoc=!0,e.currentAltLoc=o[a];for(let s=0;s<e.count;s++){if(!Ame(e,s))continue;let l=e.altLoc.value(n[e.startVertex+s]);l&&l!==e.currentAltLoc||(Ime(e),i=Tme(e,s,i))}}for(let a=0,s=e.currentRings.length;a<s;a++)e.rings.push(e.currentRings[a])}function M6e(e,t,r,n){if(r<t)return!1;let{pred:o,color:i,left:a,right:s}=e,l=++e.currentColor,u=t;for(let y=0;y<5&&(i[u]=l,u=o[u],!(u<0));y++);let c=0,m=0,d=!1,p=0;u=r;for(let y=0;y<5;y++){if(i[u]===l){p=u,d=!0;break}if(s[m++]=u,u=o[u],u<0)break}if(!d)return!1;u=t;for(let y=0;y<5&&(a[c++]=u,!(p===u||(u=o[u],u<0)));y++);let h=c+m;if(h<3)return!1;let f=new Int32Array(h),g=0;for(let y=0;y<c;y++)f[g++]=e.startVertex+a[y],n[a[y]]=1;for(let y=m-1;y>=0;y--)f[g++]=e.startVertex+s[y],n[s[y]]=1;Js(f);for(let y=0,x=e.currentRings.length;y<x;y++){let S=e.currentRings[y];if(f.length===S.length){if(Be.areEqual(f,S))return!1}else if(f.length>S.length&&Be.isSubset(f,S))return!1}return e.currentRings.push(Be.ofSortedArray(f)),!0}function Tme(e,t,r){let{bonds:n,startVertex:o,endVertex:i,isRingAtom:a,marked:s,queue:l,pred:u,depth:c}=e,{elements:m}=e.unit,{b:d,edgeProps:{flags:p},offset:h}=n;s[t]=r,c[t]=0,l[0]=t;let f=0,g=1;for(;f<g;){let y=l[f++],x=c[y],S=o+y,I=h[S],v=h[S+1];for(let A=I;A<v;A++){let P=d[A];if(P<o||P>=i||!xt.isCovalent(p[A]))continue;if(e.hasAltLoc){let w=e.altLoc.value(m[P]);if(w&&e.currentAltLoc!==w)continue}let T=P-o;if(s[T]===r){if(u[T]!==y&&u[y]!==T&&M6e(e,y,T,a))return r+1;continue}let R=Math.min(c[T],x+1);R>5||(c[T]=R,s[T]=r,l[g++]=T,u[T]=y)}}return r+1}function Dme(e){let t=e.length,r=new Array(t);for(let a=0;a<t;a++)r[a]=e[t-a-1];let n=Pme(e),o=Pme(r),i=!1;for(let a=0;a<t;a++){let s=e[(a+n)%t],l=r[(a+o)%t];if(s!==l){i=s<l;break}}return i?_me(e,n):_me(r,o)}function Pme(e){let t=e.length,r=new Int32Array(t*2);for(let a=0;a<r.length;a++)r[a]=-1;let n="",o="",i=0;for(let a=1;a<r.length;a++){let s=r[a-i-1];for(;s!==-1&&(n=e[a%t],o=e[(i+s+1)%t],n!==o);)n<o&&(i=a-s-1),s=r[s];s===-1?(n=e[a%t],o=e[(i+s+1)%t],n!==o?(n<o&&(i=a),r[a-i]=-1):r[a-i]=s+1):r[a-i]=s+1}return i}function _me(e,t){let r=e.length,n=[],o;for(o=0;o<r-1;o++)n.push(e[(o+t)%r]),n.push("-");return n.push(e[(o+t)%r]),n.join("")}function wme(e,t){let r=new Map,n=new Map;for(let l=0,u=e.length;l<u;l++){let c=e[l];for(let m=0,d=c.length;m<d;m++){let p=c[m];r.has(p)?r.get(p).push(l):r.set(p,[l])}}for(let l=0,u=t.length;l<u;l++){let c=t[l],m=e[c];for(let d=0,p=m.length;d<p;d++){let h=m[d];n.has(h)?n.get(h).push(c):n.set(h,[c])}}let o=new xs.UniqueEdgeBuilder(e.length);for(let l=0,u=e.length;l<u;l++){let c=e[l];for(let m=0,d=c.length;m<d;m++){let p=c[m],h=r.get(p);if(h.length!==1)for(let f=0,g=h.length;f<g;f++){let y=h[f];l>=y||o.addEdge(l,y)}}}let i=xs.connectedComponents(o.getGraph()),a=i.componentIndex,s=[];for(let l=0;l<i.componentCount;l++)s[l]=[];for(let l=0,u=e.length;l<u;l++)s[a[l]].push(l);return{elementRingIndices:r,elementAromaticRingIndices:n,ringComponentIndex:a,ringComponents:s}}var Mme={H:"Hydrogen",HE:"Helium",LI:"Lithium",BE:"Beryllium",B:"Boron",C:"Carbon",N:"Nitrogen",O:"Oxygen",F:"Fluorine",NE:"Neon",NA:"Sodium",MG:"Magnesium",AL:"Aluminum",SI:"Silicon",P:"Phosphorus",S:"Sulfur",CL:"Chlorine",AR:"Argon",K:"Potassium",CA:"Calcium",SC:"Scandium",TI:"Titanium",V:"Vanadium",CR:"Chromium",MN:"Manganese",FE:"Iron",CO:"Cobalt",NI:"Nickel",CU:"Copper",ZN:"Zinc",GA:"Gallium",GE:"Germanium",AS:"Arsenic",SE:"Selenium",BR:"Bromine",KR:"Krypton",RB:"Rubidium",SR:"Strontium",Y:"Yttrium",ZR:"Zirconium",NB:"Niobium",MO:"Molybdenum",TC:"Technetium",RU:"Ruthenium",RH:"Rhodium",PD:"Palladium",AG:"Silver",CD:"Cadmium",IN:"Indium",SN:"Tin",SB:"Antimony",TE:"Tellurium",I:"Iodine",XE:"Xenon",CS:"Cesium",BA:"Barium",LA:"Lanthanum",CE:"Cerium",PR:"Praseodymium",ND:"Neodymium",PM:"Promethium",SM:"Samarium",EU:"Europium",GD:"Gadolinium",TB:"Terbium",DY:"Dysprosium",HO:"Holmium",ER:"Erbium",TM:"Thulium",YB:"Ytterbium",LU:"Lutetium",HF:"Hafnium",TA:"Tantalum",W:"Wolfram",RE:"Rhenium",OS:"Osmium",IR:"Iridium",PT:"Platinum",AU:"Gold",HG:"Mercury",TL:"Thallium",PB:"Lead",BI:"Bismuth",PO:"Polonium",AT:"Astatine",RN:"Radon",FR:"Francium",RA:"Radium",AC:"Actinium",TH:"Thorium",PA:"Protactinium",U:"Uranium",NP:"Neptunium",PU:"Plutonium",AM:"Americium",CM:"Curium",BK:"Berkelium",CF:"Californium",ES:"Einsteinium",FM:"Fermium",MD:"Mendelevium",NO:"Nobelium",LR:"Lawrencium",RF:"Rutherfordium",DB:"Dubnium",SG:"Seaborgium",BH:"Bohrium",HS:"Hassium",MT:"Meitnerium",DS:"Darmstadtium",RG:"Roentgenium",CN:"Copernicium",NH:"Nihonium",FL:"Flerovium",MC:"Moscovium",LV:"Livermorium",TS:"Tennessine",OG:"Oganesson"},B6e=new Set(["LI","NA","K","RB","CS","FR"]);function E6e(e){return B6e.has(e)}var k6e=new Set(["BE","MG","CA","SR","BA","RA"]);function F6e(e){return k6e.has(e)}var L6e=new Set(["ZN","GA","CD","IN","SN","HG","TI","PB","BI","PO","CN"]);function V6e(e){return L6e.has(e)}var O6e=new Set(["F","CL","BR","I","AT"]);function B6(e){return O6e.has(e)}function E6(e){let t=$x(e);return t>=21&&t<=29||t>=39&&t<=47||t>=72&&t<=79||t>=104&&t<=108}function G6e(e){let t=$x(e);return t>=57&&t<=71}function U6e(e){let t=$x(e);return t>=89&&t<=103}function Bme(e){return E6e(e)||F6e(e)||G6e(e)||U6e(e)||E6(e)||V6e(e)}function N6e(e,t){let r=e.coarseElements.entityKey[t],n=e.model.sequence.byEntityKey[r].sequence,o=e.coarseElements.seq_id_begin.value(t);return n.compId.value(o-1)}function MI(e,t){switch(e.kind){case ue.Kind.Atomic:return e.model.atomicHierarchy.derived.residue.moleculeType[e.residueIndex[t]];case ue.Kind.Spheres:case ue.Kind.Gaussians:let r=N6e(e,t),n=e.model.properties.chemicalComponentMap.get(r);if(n)return Ql(n.type,r)}return 0}var z6e=new Set;function sg(e,t){let r=fce[e];if(r!==void 0){let n=r[t];if(n!==void 0)return n}return z6e}var Eme=b.zero();function wE(e,t){let r=e.conformation,n=new Float32Array(t.length*3),{elements:o}=e;for(let i=0,a=t.length;i<a;++i)r.position(o[t[i]],Eme),b.toArray(Eme,n,i*3);return n}var iC=class{constructor(t,r){this.unit=r;this.all=t}get index(){return this._index?this._index:(this._index=wme(this.all,this.aromaticRings),this._index)}get byFingerprint(){return this._byFingerprint?this._byFingerprint:(this._byFingerprint=H6e(this.unit,this.all),this._byFingerprint)}get elementRingIndices(){return this.index.elementRingIndices}get elementAromaticRingIndices(){return this.index.elementAromaticRingIndices}get ringComponentIndex(){return this.index.ringComponentIndex}get ringComponents(){return this.index.ringComponents}get aromaticRings(){return this._aromaticRings?this._aromaticRings:(this._aromaticRings=X6e(this.unit,this.all),this._aromaticRings)}},Td;(a=>{function e(s,l){let{elements:u}=s,{type_symbol:c}=s.model.atomicHierarchy.atoms,m=[];for(let d=0,p=l.length;d<p;d++)m[m.length]=c.value(u[l[d]]);return t(m)}a.fingerprint=e;function t(s){return Dme(s)}a.elementFingerprint=t;let r=new Set(["B","C","N","O","SI","P","S","GE","AS","SN","SB","BI"]),n=.05;function o(s,l){let{elements:u,bonds:{b:c,offset:m,edgeProps:{flags:d}}}=s,{type_symbol:p,label_comp_id:h}=s.model.atomicHierarchy.atoms;if(h.value(s.elements[l[0]])==="PRO")return!1;let f=0,g=!1;for(let x=0,S=l.length;x<S;++x){let I=l[x];!g&&r.has(p.value(u[I]))&&(g=!0);for(let v=m[I],A=m[I+1];v<A;++v)xt.is(xt.Flag.Aromatic,d[v])&&Be.has(l,c[v])&&(f+=1)}if(f===2*l.length)return!0;if(!g||l.length<5||f>0)return!1;let y=Bu.calculateMomentsAxes(wE(s,l));return b.magnitude(y.dirC)<n}a.isAromatic=o;function i(s,l){let{label_alt_id:u}=s.model.atomicHierarchy.atoms,{elements:c}=s;for(let m=0,d=l.length;m<d;++m){let p=c[l[m]],h=u.value(p);if(h)return h}return""}a.getAltId=i})(Td||={});(r=>{function e(n){if(ue.Traits.is(n.traits,ue.Trait.Water)||ue.Traits.is(n.traits,ue.Trait.CoarseGrained))return new r([],n);let o=Rme(n);return new r(o,n)}r.create=e;function t(n,o){let i=new Map;for(let a=0,s=o.length;a<s;a++){let l=o[a];W6e(n,l,i)}return i}r.byFingerprintAndResidue=t})(iC||={});function H6e(e,t){let r=new Map,n=0;for(let o=0,i=t.length;o<i;o++){let a=t[o],s=Td.fingerprint(e,a);r.has(s)?r.get(s).push(n):r.set(s,[n]),n++}return r}function j6e(e,t){let{elements:r}=e,n=e.model.atomicHierarchy.residueAtomSegments.index,o=n[r[t[0]]];for(let i=1,a=t.length;i<a;i++)if(o!==n[r[t[i]]])return-1;return o}function W6e(e,t,r){let n=e.byFingerprint.get(t);if(n)for(let o=0,i=n.length;o<i;o++){let a=n[o],s=j6e(e.unit,e.all[a]);s>=0&&(r.has(s)?r.get(s).push(a):r.set(s,[a]))}}function X6e(e,t){let r=[];for(let n=0,o=t.length;n<o;++n)Td.isAromatic(e,t[n])&&r.push(n);return r}var Wn;(S=>{function e(I){return Be.ofSortedArray(I)}S.ofSortedRanges=e;function t(I){return I[0]}S.start=t;function r(I){return I[I.length-1]+1}S.end=r;function n(I){return I[0]}S.min=n;function o(I){return I[I.length-1]}S.max=o;function i(I){let v=0;for(let A=0,P=I.length;A<P;A+=2)v+=I[A+1]-I[A]+1;return v}S.size=i;function a(I){return I.length/2}S.count=a;function s(I,v){return I[v*2]}S.startAt=s;function l(I,v){return I[v*2+1]+1}S.endAt=l;function u(I,v){return I[v*2]}S.minAt=u;function c(I,v){return I[v*2+1]}S.maxAt=c;function m(I,v){if(I.length!==v.length)return!1;for(let A=0,P=I.length;A<P;++A)if(I[A]!==v[A])return!1;return!0}S.areEqual=m;function d(I,v){let A=0;for(let P=0,T=I.length;P<T;P+=2)for(let R=I[P],w=I[P+1];R<=w;++R)v(R,A),++A}S.forEach=d;function p(I,v){return f(I,v)!==-1}S.has=p;function h(I,v,A){return g(I,v,A)!==-1}S.hasFrom=h;function f(I,v){return g(I,v,0)}S.firstIntersectionIndex=f;function g(I,v,A){if(u(I,A)>xe.max(v)||o(I)<xe.min(v))return-1;for(let P=A,T=a(I);P<T;++P){let R=ye.ofRange(u(I,P),c(I,P));if(xe.areIntersecting(R,v))return P}return-1}S.firstIntersectionIndexFrom=g;function y(I,v){return new x(I,v)}S.transientSegments=y;class x{constructor(v,A){this.ranges=v;this.set=A;this.value={index:0,start:0,end:0};this.curIndex=0;this.hasNext=!1;this.curIndex=f(v,A),this.hasNext=this.curIndex!==-1}updateValue(){this.value.index=this.curIndex,this.value.start=xe.findPredecessorIndex(this.set,s(this.ranges,this.curIndex)),this.value.end=xe.findPredecessorIndex(this.set,l(this.ranges,this.curIndex))}move(){return this.hasNext&&(this.updateValue(),this.curIndex=g(this.ranges,this.set,this.curIndex+1),this.hasNext=this.curIndex!==-1),this.value}}S.Iterator=x})(Wn||={});function kme(e){let t=[],{elements:r,model:n}=e,{residueAtomSegments:o}=e.model.atomicHierarchy,{traceElementIndex:i}=n.atomicHierarchy.derived.residue,a=Wn.transientSegments(e.model.atomicRanges.polymerRanges,r),s=Kt.transientSegments(o,r);for(;a.hasNext;){let l=a.move();for(s.setSegment(l);s.hasNext;){let u=s.move(),{start:c,end:m,index:d}=u;if(xe.areIntersecting(ye.ofRange(r[c],r[m-1]),r)){let p=i[d];t.push(p===-1?o.offsets[d]:p)}}}return Be.ofSortedArray(t)}function Fme(e){let t=[],{elements:r,model:n}=e,{spheres:o,gaussians:i}=n.coarseHierarchy,a=ue.isSpheres(e)?o.polymerRanges:i.polymerRanges,s=Wn.transientSegments(a,r);for(;s.hasNext;){let{start:l,end:u}=s.move();for(let c=l;c<u;++c)t.push(r[c])}return Be.ofSortedArray(t)}function Lme(e){let t=[],{elements:r,model:n,residueIndex:o}=e,{residueAtomSegments:i}=e.model.atomicHierarchy,{traceElementIndex:a}=n.atomicHierarchy.derived.residue,s=Wn.transientSegments(e.model.atomicRanges.gapRanges,e.elements);for(;s.hasNext;){let l=s.move(),u=o[r[l.start]],c=o[r[l.end-1]],m=a[u],d=a[c];t.push(m===-1?i.offsets[u]:m),t.push(d===-1?i.offsets[c]:d)}return Be.ofSortedArray(t)}function Vme(e){let t=[],{elements:r,model:n}=e,{spheres:o,gaussians:i}=n.coarseHierarchy,a=ue.isSpheres(e)?o.gapRanges:i.gapRanges,s=Wn.transientSegments(a,r);for(;s.hasNext;){let{start:l,end:u}=s.move();t.push(r[l],r[u-1])}return Be.ofSortedArray(t)}function Ome(e){let t=[],{elements:r,model:n}=e,{chainAtomSegments:o,residueAtomSegments:i}=n.atomicHierarchy,{moleculeType:a,traceElementIndex:s}=n.atomicHierarchy.derived.residue,l=Kt.transientSegments(o,r),u=Kt.transientSegments(i,r);for(;l.hasNext;)for(u.setSegment(l.move());u.hasNext;){let{index:c}=u.move();if(pa(a[c])){let m=s[c];t.push(m===-1?i.offsets[c]:m)}}return Be.ofSortedArray(t)}function Gme(e){let t=[],{elements:r,model:n}=e,{chainAtomSegments:o,residueAtomSegments:i}=n.atomicHierarchy,{moleculeType:a,traceElementIndex:s}=n.atomicHierarchy.derived.residue,l=Kt.transientSegments(o,r),u=Kt.transientSegments(i,r);for(;l.hasNext;)for(u.setSegment(l.move());u.hasNext;){let{index:c}=u.move();if(p6(a[c])){let m=s[c];t.push(m===-1?i.offsets[c]:m)}}return Be.ofSortedArray(t)}var Ume=b();function Q6e(e){let{elements:t,conformation:r}=e,n=new Float32Array(t.length*3);for(let o=0,i=t.length;o<i;o++)r.invariantPosition(t[o],Ume),b.toArray(Ume,n,o*3);return n}function k6(e){let t=Q6e(e);return Bu.ofPositions(t)}var Nme=b.dot,zme=b.copy,Z6e=b.scaleAndSub,q6e=b.scaleAndAdd,Fi=class{constructor(t){this.minDist=[];this.maxDist=[];this.extrema=[];this.centroidHelper=new ku;this.dir=Y6e(t),this.dirLength=this.dir.length,this.reset()}computeExtrema(t,r){let n=Nme(this.dir[t],r);n<this.minDist[t]&&(this.minDist[t]=n,zme(this.extrema[t*2],r)),n>this.maxDist[t]&&(this.maxDist[t]=n,zme(this.extrema[t*2+1],r))}computeSphereExtrema(t,r,n){let o=this.dir[t],i=Nme(o,r);i-n<this.minDist[t]&&(this.minDist[t]=i-n,Z6e(this.extrema[t*2],r,o,n)),i+n>this.maxDist[t]&&(this.maxDist[t]=i+n,q6e(this.extrema[t*2+1],r,o,n))}includeSphere(t){if(he.hasExtrema(t)&&t.extrema.length>1)for(let r of t.extrema)this.includePosition(r);else this.includePositionRadius(t.center,t.radius)}includePosition(t){for(let r=0;r<this.dirLength;++r)this.computeExtrema(r,t)}includePositionRadius(t,r){for(let n=0;n<this.dirLength;++n)this.computeSphereExtrema(n,t,r)}finishedIncludeStep(){for(let t=0;t<this.extrema.length;t++)this.centroidHelper.includeStep(this.extrema[t]);this.centroidHelper.finishedIncludeStep()}radiusSphere(t){if(he.hasExtrema(t)&&t.extrema.length>1)for(let r of t.extrema)this.radiusPosition(r);else this.radiusPositionRadius(t.center,t.radius)}radiusPosition(t){this.centroidHelper.radiusStep(t)}radiusPositionRadius(t,r){this.centroidHelper.radiusSphereStep(t,r)}getSphere(t){return he.setExtrema(this.centroidHelper.getSphere(t),this.extrema.slice())}getBox(t){return pt.fromVec3Array(t||pt(),this.extrema)}reset(){for(let t=0;t<this.dirLength;++t)this.minDist[t]=1/0,this.maxDist[t]=-1/0,this.extrema[t*2]=b(),this.extrema[t*2+1]=b();this.centroidHelper.reset()}};function Y6e(e){let t;switch(e){case"6":t=[...ME];break;case"14":t=[...ME,...F6];break;case"26":t=[...ME,...F6,...Hme];break;case"98":t=[...ME,...F6,...Hme,...K6e,...J6e,...$6e];break}return t.map(r=>{let n=b.create(r[0],r[1],r[2]);return b.normalize(n,n)})}var ME=[[1,0,0],[0,1,0],[0,0,1]],F6=[[1,1,1],[-1,1,1],[-1,-1,1],[1,-1,1]],Hme=[[1,1,0],[1,-1,0],[1,0,1],[1,0,-1],[0,1,1],[0,1,-1]],K6e=[[0,1,2],[0,2,1],[1,0,2],[2,0,1],[1,2,0],[2,1,0],[0,1,-2],[0,2,-1],[1,0,-2],[2,0,-1],[1,-2,0],[2,-1,0]],J6e=[[1,1,2],[2,1,1],[1,2,1],[1,-1,2],[1,1,-2],[1,-1,-2],[2,-1,1],[2,1,-1],[2,-1,-1],[1,-2,1],[1,2,-1],[1,-2,-1]],$6e=[[2,2,1],[1,2,2],[2,1,2],[2,-2,1],[2,2,-1],[2,-2,-1],[1,-2,2],[1,2,-2],[1,-2,-2],[2,-1,2],[2,1,-2],[2,-1,-2]];var jme=b.set,eje=new Fi("14"),tje=new Fi("98");function rje(e){return e>1e4?eje:tje}function EE(e){let t=pt.computeBounding(e);return{box:t,sphere:he.fromBox3D(he(),t)}}var BE=b();function Hf(e){let{x:t,y:r,z:n,radius:o,indices:i}=e,a=xe.size(i);if(a>25e4)return EE(e);let s=rje(a);s.reset();for(let u=0;u<a;u++){let c=xe.getAt(i,u);jme(BE,t[c],r[c],n[c]),s.includePositionRadius(BE,o&&o[c]||0)}s.finishedIncludeStep();for(let u=0;u<a;u++){let c=xe.getAt(i,u);jme(BE,t[c],r[c],n[c]),s.radiusPositionRadius(BE,o&&o[c]||0)}let l=s.getSphere();if(!o&&he.hasExtrema(l)&&a<=l.extrema.length){let u=[];for(let c=0;c<a;c++){let m=xe.getAt(i,c);u.push(b.create(t[m],r[m],n[m]))}he.setExtrema(l,u)}return{box:s.getBox(),sphere:l}}var kE=class e{constructor(){this.data=new Map}get(t){let r=Be.hashCode(t);if(this.data.has(r)){for(let[n,o]of this.data.get(r))if(Be.areEqual(t,n))return o}}set(t,r){let n=Be.hashCode(t);if(this.data.has(n)){let o=this.data.get(n);for(let i of o)if(Be.areEqual(t,i[0])){i[1]=r;return}o.push([t,r])}else this.data.set(n,[[t,r]])}static get(t){return t._dynamicPropertyData.ElementSetIntraBondCache||(t._dynamicPropertyData.ElementSetIntraBondCache=new e),t._dynamicPropertyData.ElementSetIntraBondCache}};var BI=class{constructor(t,r,n){this.operatorsProvider=n;this.id=t,this.details=r}get operatorGroups(){return this._operators?this._operators:(this._operators=this.operatorsProvider(),this._operators)}};(t=>{function e(r,n,o){return new t(r,n,o)}t.create=e})(BI||={});var aC;(n=>{n.Default={assemblies:[],spacegroup:rl.ZeroP1,isNonStandardCrystalFrame:!1};function t(o,i){let a=i.toLocaleLowerCase(),s=Qo.Provider.get(o);return s?Lv(s.assemblies,l=>l.id.toLowerCase()===a):void 0}n.findAssembly=t;function r(o){let{cell:i,name:a,num:s}=o.spacegroup,{size:l,anglesInRadians:u}=i,c=l[0].toFixed(2),m=l[1].toFixed(2),d=l[2].toFixed(2),p=Ya(u[0]).toFixed(2),h=Ya(u[1]).toFixed(2),f=Ya(u[2]).toFixed(2),g=[];return g.push(`Unit Cell <b>${a}</b> #${s}`),g.push(`${c}\xD7${m}\xD7${d} \u212B`),g.push(`\u03B1=${p}\xB0 \u03B2=${h}\xB0 \u03B3=${f}\xB0`),g.join(" | ")}n.getUnitcellLabel=r})(aC||={});function Wme(e,t,r){if(!e._rowCount)return[];let n=ije(r),o=[];for(let i=0;i<e._rowCount;i++)o[o.length]=nje(e,t,i,n);return o}function nje(e,t,r,n){let o=e.id.value(r),i=e.details.value(r),a=[],{assembly_id:s,oper_expression:l,asym_id_list:u}=t;for(let c=0,m=t._rowCount;c<m;c++)s.value(c)===o&&(a[a.length]={assemblyId:o,expression:l.value(c),asymIds:u.value(c)});return BI.create(o,i,oje(a,n))}function oje(e,t){return()=>{let r=[],n=0;for(let o=0;o<e.length;o++){let i=e[o],a=lje(i.expression),s=aje(a),l=sje(t,s,n,i.assemblyId),u=Xn.generators.atoms({chainTest:Xn.pred.and(Xn.pred.eq(c=>Ke.unit.operator_name(c.element),Jn.DefaultName),Xn.pred.inSet(c=>Ke.chain.label_asym_id(c.element),i.asymIds))});r[r.length]={selector:u,operators:l,asymIds:i.asymIds},n+=l.length}return r}}function ije(e){let{id:t,matrix:r,vector:n,_schema:o}=e,i=new Map,a=b();for(let s=0,l=e._rowCount;s<l;s++){let u=Dr.toMat4(H(),o.matrix.space,r.value(s));Dr.toVec3(a,o.vector.space,n.value(s)),H.setTranslation(u,a),H.setValue(u,3,3,1),i.set(t.value(s),u)}return i}function aje(e){let t=[],r=[];for(let n=0;n<e.length;n++)r[n]="";return Xme(e,t,e.length-1,r),t}function Xme(e,t,r,n){if(r<0){t[t.length]=n.slice(0);return}let o=e[r],i=o.length;for(let a=0;a<i;a++)n[r]=o[a],Xme(e,t,r-1,n)}function sje(e,t,r,n){let o=[],i=r;for(let a of t){let s=H.identity();for(let c=0;c<a.length;c++)H.mul(s,s,e.get(a[c]));i++;let l=`ASM_${i}`,u=Jn.getAssemblyOperatorName(a);o[o.length]=Jn.create(l,s,{instanceId:u,assembly:{id:n,operId:i,operList:a}})}return o}function lje(e){let t=/\(?([^\(\)]+)\)?]*/g,r=[],n=[],o;for(;o=t.exec(e);)r[r.length]=o[1];return r.forEach(i=>{let a=[];i.split(",").forEach(s=>{let l=s.indexOf("-");if(l>0){let u=parseInt(s.substring(0,l)),c=parseInt(s.substr(l+1));for(let m=u;m<=c;m++)a[a.length]=m.toString()}else a[a.length]=s.trim()}),n[n.length]=a}),n}var Qo;(o=>{o.Descriptor={name:"model_symmetry"},o.Provider=_l.create(o.Descriptor);function r(i){let a=Wme(i.pdbx_struct_assembly,i.pdbx_struct_assembly_gen,i.pdbx_struct_oper_list),s=mje(i.symmetry,i.cell),l=uje(i.atom_sites,s);return{assemblies:a,spacegroup:s,isNonStandardCrystalFrame:l,ncsOperators:dje(i.struct_ncs_oper)}}o.fromData=r;function n(i,a){let s=ha.create("P 1",i,a),l=rl.create(s);return{assemblies:[],spacegroup:l,isNonStandardCrystalFrame:!1}}o.fromCell=n})(Qo||={});function uje(e,t){return e._rowCount===0,!1}function cje(e){let t=e.Int_Tables_number.value(0),r=e["space_group_name_H-M"].value(0);return e.Int_Tables_number.isDefined?e["space_group_name_H-M"].isDefined?r:t:r}function mje(e,t){if(e._rowCount===0||t._rowCount===0)return rl.ZeroP1;let r=t.length_a.value(0),n=t.length_b.value(0),o=t.length_c.value(0);if(r===0||n===0||o===0)return rl.ZeroP1;let i=t.angle_alpha.value(0),a=t.angle_beta.value(0),s=t.angle_gamma.value(0);if(i===0||a===0||s===0)return rl.ZeroP1;let l=cje(e),u=ha.create(l,b.create(r,n,o),b.scale(b(),b.create(i,a,s),Math.PI/180));return rl.create(u)}function dje(e){if(e._rowCount===0)return;let{id:t,matrix:r,vector:n}=e,o=bn.struct_ncs_oper.matrix.space,i=bn.struct_ncs_oper.vector.space,a=[];for(let s=0;s<e._rowCount;s++){let l=Dr.toMat3(Mt(),o,r.value(s)),u=Dr.toVec3(b(),i,n.value(s));if(!Jn.checkIfRotationAndTranslation(l,u)||e.code.value(s)==="given"&&!Mt.isIdentity(l)&&!b.isZero(u))continue;let c=t.value(s);a[a.length]=Jn.ofRotationAndOffset(`ncs_${c}`,l,u,c)}return a}var pje={delocalizedTriplets:{getThirdElement:()=>{},getTripletIndices:()=>{},triplets:[]}};function Qme(e){return ue.Traits.is(e.traits,ue.Trait.Water)||ue.Traits.is(e.traits,ue.Trait.CoarseGrained)?pje:{delocalizedTriplets:fje(e)}}function fje(e){let t=e.bonds,{b:r,edgeProps:n,offset:o}=t,{order:i,flags:a}=n,{elementAromaticRingIndices:s}=e.rings,l=[],u=new Map,c=new Map,m=(d,p,h)=>{let f=l.length;l.push(Be.ofUnsortedArray([d,p,h])),u.set(Mc(d,p),h),c.has(d)?c.get(d).push(f):c.set(d,[f])};for(let d=0;d<e.elements.length;d++){if(s.has(d)||o[d+1]-o[d]+1<2)continue;let h=[];for(let f=o[d],g=o[d+1];f<g;f++){let y=a[f];xt.is(y,xt.Flag.Aromatic)&&h.push(r[f])}if(h.length>=2){m(d,h[0],h[1]);for(let f=1,g=h.length;f<g;f++)m(d,h[f],h[0])}}return{getThirdElement:(d,p)=>u.get(Mc(d,p)),getTripletIndices:d=>c.get(d),triplets:l}}var ue;(G=>{let e;(q=>(q[q.Atomic=0]="Atomic",q[q.Spheres=1]="Spheres",q[q.Gaussians=2]="Gaussians"))(e=G.Kind||={});let t;(q=>(q[q.Atomic=0]="Atomic",q[q.Spheres=1]="Spheres",q[q.Gaussians=2]="Gaussians"))(t=G.Kinds||={});function r(X){return X.kind===0}G.isAtomic=r;function n(X){return X.kind===1||X.kind===2}G.isCoarse=n;function o(X){return X.kind===1}G.isSpheres=o;function i(X){return X.kind===2}G.isGaussians=i;function a(X,U,L,q,te,J,ee,ce,fe){switch(te){case 0:return new x(X,U,L,q,J,ce,Jn.createMapping(ee,J.atomicConformation,f(J)),fe??S());case 1:return w(X,U,L,q,J,1,ce,Jn.createMapping(ee,J.coarseConformation.spheres,g(J)),fe??P());case 2:return w(X,U,L,q,J,2,ce,Jn.createMapping(ee,J.coarseConformation.gaussians,y(J)),fe??P())}}G.create=a;function s(X){let U=Mu.Mutable();for(let L=0,q=X.length;L<q;L++)U.set(X[L].id,L);return U}function l(X){let U=[];for(let L=0,q=X.length;L<q;L++)U.push(X[L].id);return ui(U)}function u(X){let U={};return{elements:X[0].elements,units:X,get unitIndexMap(){return U.unitIndexMap||(U.unitIndexMap=s(X)),U.unitIndexMap},hashCode:m(X[0]),transformHash:l(X)}}G.SymmetryGroup=u,(L=>{function X(q,te){return q.hashCode!==te.hashCode?!1:Be.areEqual(q.elements,te.elements)}L.areInvariantElementsEqual=X;function U(q){let te=Mu.Mutable();for(let J=0,ee=q.length;J<ee;++J){let ce=q[J];for(let fe=0,O=ce.units.length;fe<O;++fe)te.set(ce.units[fe].id,J)}return te}L.getUnitSymmetryGroupsIndexMap=U})(u=G.SymmetryGroup||={});function c(X){return G.isAtomic(X)?X.model.atomicConformation.id:X.model.coarseConformation.id}G.conformationId=c;function m(X){return $u(X.invariantId,Be.hashCode(X.elements))}G.hashUnit=m;let d;(ee=>(ee[ee.None=0]="None",ee[ee.MultiChain=1]="MultiChain",ee[ee.Partitioned=2]="Partitioned",ee[ee.FastBoundary=4]="FastBoundary",ee[ee.Water=8]="Water",ee[ee.CoarseGrained=16]="CoarseGrained"))(d=G.Trait||={});let p;(L=>(L.is=Ia.has,L.create=Ia.create))(p=G.Traits||={});function h(){return{}}function f(X){let U=X.atomicHierarchy.atoms.type_symbol.value;return L=>Dm(U(L))}function g(X){let U=X.coarseConformation.spheres.radius;return L=>U[L]}function y(X){return U=>0}class x{constructor(U,L,q,te,J,ee,ce,fe){this.kind=0;this.objectPrimitive="atomistic";this._transientCache=void 0;this.id=U,this.invariantId=L,this.chainGroupId=q,this.traits=te,this.model=J,this.elements=ee,this.conformation=ce,this.residueIndex=J.atomicHierarchy.residueAtomSegments.index,this.chainIndex=J.atomicHierarchy.chainAtomSegments.index,this.props=fe}get transientCache(){return this._transientCache===void 0&&(this._transientCache=new Map),this._transientCache}getChild(U){return U.length===this.elements.length?this:new x(this.id,this.invariantId,this.chainGroupId,this.traits,this.model,U,this.conformation,S())}getCopy(U,L,q,te){let J=new x(U,L,q,this.traits,this.model,this.elements,this.conformation,this.props);return te?.propagateTransientCache&&(J._transientCache=this._transientCache),J}applyOperator(U,L,q=!1){let te=q?L:Jn.compose(this.conformation.operator,L);return new x(U,this.invariantId,this.chainGroupId,this.traits,this.model,this.elements,Jn.createMapping(te,this.model.atomicConformation,this.conformation.r),this.props)}remapModel(U,L,q){q||(q={...this.props,bonds:L&&!this.props.bonds?.props?.canRemap?void 0:B(this,this.props.bonds,U,L)},G.isSameConformation(this,U)||(q.boundary=void 0,q.lookup3d=void 0,q.principalAxes=void 0));let te=this.conformation.operator,J=Qo.Provider.get(U);if(te.spgrOp!==-1&&J&&J!==Qo.Provider.get(this.model)){let[ce,fe,O]=te.hkl,{toFractional:V}=J.spacegroup.cell,Z=b.transformMat4(b(),Gt.getCenter(U),V);te=rl.getSymmetryOperatorRef(J.spacegroup,te.spgrOp,ce,fe,O,Z)}let ee=this.model.atomicConformation!==U.atomicConformation||te!==this.conformation.operator?Jn.createMapping(te,U.atomicConformation,f(U)):this.conformation;return new x(this.id,this.invariantId,this.chainGroupId,this.traits,U,this.elements,ee,q)}get boundary(){if(this.props.boundary)return this.props.boundary;let{x:U,y:L,z:q}=this.model.atomicConformation,te=Gt.getAtomicRadii(this.model);return this.props.boundary=p.is(this.traits,4)?EE({x:U,y:L,z:q,radius:te,indices:this.elements}):Hf({x:U,y:L,z:q,radius:te,indices:this.elements}),this.props.boundary}get lookup3d(){if(this.props.lookup3d)return this.props.lookup3d;let{x:U,y:L,z:q}=this.model.atomicConformation;return this.props.lookup3d=zc({x:U,y:L,z:q,indices:this.elements},this.boundary),this.props.lookup3d}get principalAxes(){return this.props.principalAxes?this.props.principalAxes:(this.props.principalAxes=k6(this),this.props.principalAxes)}get bonds(){if(this.props.bonds)return this.props.bonds;let U=kE.get(this.model),L=U.get(this.elements);return L||(L=yme(this),L.props?.cacheable&&U.set(this.elements,L)),this.props.bonds=L,this.props.bonds}get rings(){return this.props.rings?this.props.rings:(this.props.rings=iC.create(this),this.props.rings)}get resonance(){return this.props.resonance?this.props.resonance:(this.props.resonance=Qme(this),this.props.resonance)}get polymerElements(){return this.props.polymerElements?this.props.polymerElements:(this.props.polymerElements=kme(this),this.props.polymerElements)}get gapElements(){return this.props.gapElements?this.props.gapElements:(this.props.gapElements=Lme(this),this.props.gapElements)}get nucleotideElements(){return this.props.nucleotideElements?this.props.nucleotideElements:(this.props.nucleotideElements=Ome(this),this.props.nucleotideElements)}get proteinElements(){return this.props.proteinElements?this.props.proteinElements:(this.props.proteinElements=Gme(this),this.props.proteinElements)}get residueCount(){if(this.props.residueCount!==void 0)return this.props.residueCount;let U=0,L=Kt.transientSegments(this.model.atomicHierarchy.residueAtomSegments,this.elements);for(;L.hasNext;)L.move(),U+=1;return this.props.residueCount=U,this.props.residueCount}getResidueIndex(U){return this.residueIndex[this.elements[U]]}}G.Atomic=x;function S(){return h()}class I{constructor(U,L,q,te,J,ee,ce,fe,O){this._transientCache=void 0;this.kind=ee,this.objectPrimitive=ee===1?"sphere":"gaussian",this.id=U,this.invariantId=L,this.chainGroupId=q,this.traits=te,this.model=J,this.elements=ce,this.conformation=fe,this.coarseElements=ee===1?J.coarseHierarchy.spheres:J.coarseHierarchy.gaussians,this.coarseConformation=ee===1?J.coarseConformation.spheres:J.coarseConformation.gaussians,this.props=O}get transientCache(){return this._transientCache===void 0&&(this._transientCache=new Map),this._transientCache}getChild(U){return U.length===this.elements.length?this:w(this.id,this.invariantId,this.chainGroupId,this.traits,this.model,this.kind,U,this.conformation,P())}getCopy(U,L,q,te){let J=w(U,L,q,this.traits,this.model,this.kind,this.elements,this.conformation,this.props);return te?.propagateTransientCache&&(J._transientCache=this._transientCache),J}applyOperator(U,L,q=!1){let te=q?L:Jn.compose(this.conformation.operator,L);return w(U,this.invariantId,this.chainGroupId,this.traits,this.model,this.kind,this.elements,Jn.createMapping(te,this.getCoarseConformation(),this.conformation.r),this.props)}remapModel(U,L,q){let te=this.getCoarseConformation(),J=v(this.kind,U);q||(q={...this.props},G.isSameConformation(this,U)||(q.boundary=void 0,q.lookup3d=void 0,q.principalAxes=void 0));let ee=te!==J?Jn.createMapping(this.conformation.operator,J,this.kind===1?g(U):y(U)):this.conformation;return new I(this.id,this.invariantId,this.chainGroupId,this.traits,U,this.kind,this.elements,ee,q)}get boundary(){if(this.props.boundary)return this.props.boundary;let{x:U,y:L,z:q}=this.getCoarseConformation(),te=this.getCoarseRadii();return this.props.boundary=p.is(this.traits,4)?EE({x:U,y:L,z:q,radius:te,indices:this.elements}):Hf({x:U,y:L,z:q,radius:te,indices:this.elements}),this.props.boundary}get lookup3d(){if(this.props.lookup3d)return this.props.lookup3d;let{x:U,y:L,z:q}=this.getCoarseConformation();return this.props.lookup3d=zc({x:U,y:L,z:q,indices:this.elements},this.boundary),this.props.lookup3d}get principalAxes(){return this.props.principalAxes?this.props.principalAxes:(this.props.principalAxes=k6(this),this.props.principalAxes)}get polymerElements(){return this.props.polymerElements?this.props.polymerElements:(this.props.polymerElements=Fme(this),this.props.polymerElements)}get gapElements(){return this.props.gapElements?this.props.gapElements:(this.props.gapElements=Vme(this),this.props.gapElements)}getCoarseConformation(){return v(this.kind,this.model)}getCoarseRadii(){return A(this.kind,this.model)}}function v(X,U){return X===1?U.coarseConformation.spheres:U.coarseConformation.gaussians}function A(X,U){return X===1?U.coarseConformation.spheres.radius:void 0}function P(){return h()}class T extends I{}G.Spheres=T;class R extends I{}G.Gaussians=R;function w(X,U,L,q,te,J,ee,ce,fe){return new I(X,U,L,q,te,J,ee,ce,fe)}function E(X,U){return X.chainGroupId===U.chainGroupId&&X.conformation.operator.name===U.conformation.operator.name}G.areSameChainOperatorGroup=E;function M(X,U){return H.areEqual(X.conformation.operator.matrix,U.conformation.operator.matrix,1e-6)}G.areOperatorsEqual=M;function D(X,U){return X===U?!0:Be.areEqual(X.elements,U.elements)?k(X,U.model):!1}G.areConformationsEqual=D;function B(X,U,L,q){if(!U)return;if(X.model.atomicConformation.id===L.atomicConformation.id)return U;let te=Xo.Provider.get(X.model);if(te){let J=Xo.Provider.get(L);return!J||te===J?U:void 0}return U.props?.canRemap||!q||k(X,L)?U:void 0}function k(X,U){let L=Gt.CoordinatesHistory.get(Gt.getRoot(U));if(L)return L.areEqual(X.elements,X.kind,U);let q=X.elements,{x:te,y:J,z:ee}=X.conformation.coordinates,{x:ce,y:fe,z:O}=F(X.kind,U);for(let V=0,Z=q.length;V<Z;V++){let pe=q[V];if(te[pe]!==ce[pe]||J[pe]!==fe[pe]||ee[pe]!==O[pe])return!1}return!0}G.isSameConformation=k;function F(X,U){return X===0?U.atomicConformation:X===1?U.coarseConformation.spheres:U.coarseConformation.gaussians}G.getModelConformationOfKind=F;function z(X){return F(X.kind,X.model)}G.getConformation=z;function j(X,U){return X===0?U.atomicHierarchy:X===1?U.coarseHierarchy.spheres:U.coarseHierarchy.gaussians}G.getModelHierarchyOfKind=j;function Y(X){return j(X.kind,X.model)}G.getHierarchy=Y})(ue||={});var EI;(n=>{function e(o,i,a,s){o.indices[o.count]=a,o.units[o.count]=i,o.squaredDistances[o.count]=s,o.count++}n.add=e;function t(){return{count:0,indices:[],units:[],squaredDistances:[]}}n.create=t;function r(o,i){for(let a=0;a<i.count;++a)o.indices[a]=i.indices[a],o.units[a]=i.units[a],o.squaredDistances[a]=i.squaredDistances[a];return o.count=i.count,o}n.copy=r})(EI||={});function kI(){return{result:EI.create(),closeUnitsResult:ac.create(),unitGroupResult:ac.create()}}var FE=class{constructor(t){this.structure=t;this.pivot=b();this.heap=new AI;this.findContext=kI();let{units:r,boundary:n}=t,o=r.length,i=new Float32Array(o),a=new Float32Array(o),s=new Float32Array(o),l=new Float32Array(o),u=b();for(let m=0;m<o;m++){let d=r[m],p=d.boundary.sphere;b.transformMat4(u,p.center,d.conformation.operator.matrix),i[m]=u[0],a[m]=u[1],s[m]=u[2],l[m]=p.radius}let c={x:i,y:a,z:s,radius:l,indices:xe.ofBounds(0,o)};this.unitLookup=zc(c,n)}findUnitIndices(t,r,n,o){return this.unitLookup.find(t,r,n,o)}find(t,r,n,o,i){return this._find(t,r,n,o,i??this.findContext)}_find(t,r,n,o,i){ac.reset(i.result);let{units:a}=this.structure,s=this.unitLookup.find(t,r,n,o,i.closeUnitsResult);if(s.count===0)return i.result;for(let l=0,u=s.count;l<u;l++){let c=a[s.indices[l]];b.set(this.pivot,t,r,n),c.conformation.operator.isIdentity||b.transformMat4(this.pivot,this.pivot,c.conformation.operator.inverse);let d=c.lookup3d.find(this.pivot[0],this.pivot[1],this.pivot[2],o,i.unitGroupResult);for(let p=0,h=d.count;p<h;p++)EI.add(i.result,c,d.indices[p],d.squaredDistances[p])}return i.result}nearest(t,r,n,o=1,i){return this._nearest(t,r,n,o,i??this.findContext)}_nearest(t,r,n,o,i){let a=i.result,s=this.heap;ac.reset(a),s.clear();let{units:l}=this.structure,u=0,c=this.unitLookup.nearest(t,r,n,l.length,p=>(u+=l[p].elements.length)>=o,i.closeUnitsResult);if(c.count===0)return a;let m=0,d=-Number.MAX_VALUE;for(let p=0,h=c.count;p<h;p++){let f=c.squaredDistances[p];if(m>=o&&d<f)break;b.set(this.pivot,t,r,n);let g=l[c.indices[p]];g.conformation.operator.isIdentity||b.transformMat4(this.pivot,this.pivot,g.conformation.operator.inverse);let x=g.lookup3d.nearest(this.pivot[0],this.pivot[1],this.pivot[2],o,void 0,i.unitGroupResult);if(x.count!==0){m+=x.count,d=Math.max(d,x.squaredDistances[x.count-1]);for(let S=0,I=x.count;S<I;S++)s.insert(x.squaredDistances[S],{index:x.indices[S],unit:g})}}if(o===1){let p=s.findMinimum();if(p){let{key:h}=p,{unit:f,index:g}=p.value;EI.add(a,f,g,h)}}else for(;!s.isEmpty()&&a.count<o;){let p=s.extractMinimum(),{key:h}=p,{unit:f,index:g}=p.value;EI.add(a,f,g,h)}return a}findIntoBuilder(t,r,n,o,i){let{units:a}=this.structure,s=this.unitLookup.find(t,r,n,o);if(s.count!==0)for(let l=0,u=s.count;l<u;l++){let c=a[s.indices[l]];b.set(this.pivot,t,r,n),c.conformation.operator.isIdentity||b.transformMat4(this.pivot,this.pivot,c.conformation.operator.inverse);let d=c.lookup3d.find(this.pivot[0],this.pivot[1],this.pivot[2],o);if(d.count===0)continue;let p=c.elements;i.beginUnit(c.id);for(let h=0,f=d.count;h<f;h++)i.addElement(p[d.indices[h]]);i.commitUnit()}}findIntoBuilderIf(t,r,n,o,i,a){let{units:s}=this.structure,l=this.unitLookup.find(t,r,n,o);if(l.count===0)return;let u=Q.Location.create(this.structure);for(let c=0,m=l.count;c<m;c++){let d=s[l.indices[c]];b.set(this.pivot,t,r,n),d.conformation.operator.isIdentity||b.transformMat4(this.pivot,this.pivot,d.conformation.operator.inverse);let h=d.lookup3d.find(this.pivot[0],this.pivot[1],this.pivot[2],o);if(h.count===0)continue;let f=d.elements;u.unit=d,i.beginUnit(d.id);for(let g=0,y=h.count;g<y;g++)u.element=f[h.indices[g]],a(u)&&i.addElement(u.element);i.commitUnit()}}findIntoBuilderWithRadius(t,r,n,o,i,a,s,l){let{units:u}=this.structure,c=this.unitLookup.find(t,r,n,a);if(c.count===0)return;let m=Q.Location.create(this.structure),d=o+i+a;for(let p=0,h=c.count;p<h;p++){let f=u[c.indices[p]];b.set(this.pivot,t,r,n),f.conformation.operator.isIdentity||b.transformMat4(this.pivot,this.pivot,f.conformation.operator.inverse);let y=f.lookup3d.find(this.pivot[0],this.pivot[1],this.pivot[2],d);if(y.count===0)continue;let x=f.elements;m.unit=f,l.beginUnit(f.id);for(let S=0,I=y.count;S<I;S++){m.element=x[y.indices[S]];let v=s(m);Math.sqrt(y.squaredDistances[S])-o-v>a||l.addElement(x[y.indices[S]])}l.commitUnit()}}check(t,r,n,o){let{units:i}=this.structure,a=this.unitLookup.find(t,r,n,o);if(a.count===0)return!1;for(let s=0,l=a.count;s<l;s++){let u=i[a.indices[s]];if(b.set(this.pivot,t,r,n),u.conformation.operator.isIdentity||b.transformMat4(this.pivot,this.pivot,u.conformation.operator.inverse),u.lookup3d.check(this.pivot[0],this.pivot[1],this.pivot[2],o))return!0}return!1}approxNearest(t,r,n,o,i){return this._approxNearest(t,r,n,o,i??this.findContext)}_approxNearest(t,r,n,o,i){ac.reset(i.result);let{units:a}=this.structure,s=this.unitLookup.find(t,r,n,o,i.closeUnitsResult);if(s.count===0)return i.result;let l=Number.MAX_VALUE;for(let u=0,c=s.count;u<c;u++){let m=a[s.indices[u]];b.set(this.pivot,t,r,n),m.conformation.operator.isIdentity||b.transformMat4(this.pivot,this.pivot,m.conformation.operator.inverse);let p=m.lookup3d.approxNearest(this.pivot[0],this.pivot[1],this.pivot[2],o,i.unitGroupResult);for(let h=0,f=p.count;h<f;h++)p.squaredDistances[h]<l&&(EI.add(i.result,m,p.indices[h],p.squaredDistances[h]),l=p.squaredDistances[h])}return i.result}get boundary(){return this.structure.boundary}};function Ky(e,t){if(t.length===0)return De.Empty;if(t.length===1)return t[0];let r=new Map,n=new Set;for(let{units:i}of t)for(let a=0,s=i.length;a<s;a++){let l=i[a];if(r.has(l.id)){if(n.has(l.id))continue;let u=Be.union(r.get(l.id),l.elements);r.set(l.id,u),u.length===e.unitMap.get(l.id).elements.length&&n.add(l.id)}else r.set(l.id,l.elements),l.elements.length===e.unitMap.get(l.id).elements.length&&n.add(l.id)}let o=e.subsetBuilder(!0);return r.forEach(hje,o),o.getStructure()}function hje(e,t){this.setUnit(t,e)}function Zme(e,t){if(e===t)return!0;if(e.units.length!==t.units.length)return!1;let r=e.units,n=t.unitMap;for(let o=0,i=r.length;o<i;o++){let a=r[o];if(!n.has(a.id))return!1;let s=n.get(a.id);if(!Be.areEqual(a.elements,s.elements))return!1}return!0}function FI(e,t){if(e===t)return!0;let r,n;e.units.length<t.units.length?(r=e,n=t):(r=t,n=e);let o=r.units,i=n.unitMap;for(let a=0,s=o.length;a<s;a++){let l=o[a];if(!i.has(l.id))continue;let u=i.get(l.id);if(Be.areIntersecting(l.elements,u.elements))return!0}return!1}function LE(e,t){if(e===t)return e;if(!FI(e,t))return De.Empty;let r,n;e.units.length<t.units.length?(r=e,n=t):(r=t,n=e);let o=r.units,i=n.unitMap,a=[];for(let s=0,l=o.length;s<l;s++){let u=o[s];if(!i.has(u.id))continue;let c=i.get(u.id);if(Be.areIntersecting(u.elements,c.elements)){let m=Be.intersect(u.elements,c.elements);a[a.length]=u.getChild(m)}}return De.create(a,{parent:e.parent||t.parent})}function LI(e,t){if(e===t)return De.Empty;if(!FI(e,t))return e;let r=e.units,n=t.unitMap,o=[];for(let i=0,a=r.length;i<a;i++){let s=r[i];if(!n.has(s.id)){o[o.length]=s;continue}let l=n.get(s.id),u=Be.subtract(s.elements,l.elements);u.length>0&&(o[o.length]=s.getChild(u))}return De.create(o,{parent:e.parent||t.parent})}var ut;(g=>{function e(y,x){return{kind:"singletons",source:y,structure:x}}g.Singletons=e;function t(y,x){return{kind:"sequence",source:y,structures:x}}g.Sequence=t;function r(y){return e(y,De.Empty)}g.Empty=r;function n(y){return y.kind==="singletons"}g.isSingleton=n;function o(y){return n(y)?y.structure.units.length===0:y.structures.length===0}g.isEmpty=o;function i(y){return n(y)?y.structure.elementCount:y.structures.length}g.structureCount=i;function a(y){return o(y)?De.Empty:n(y)?y.structure:Ky(y.source,y.structures)}g.unionStructure=a;function s(y){let x=[],{unitMap:S}=y.source;for(let I of a(y).units)I===S.get(I.id)?x[x.length]={unit:I,indices:xe.ofBounds(0,I.elements.length)}:x[x.length]={unit:I,indices:xe.ofSortedArray(Be.indicesOf(S.get(I.id).elements,I.elements))};return Q.Loci(y.source,x)}g.toLociWithCurrentUnits=s;function l(y){let x=[],{unitMap:S}=y.source;for(let I of a(y).units){let v=S.get(I.id);v===I?x[x.length]={unit:v,indices:xe.ofBounds(0,v.elements.length)}:x[x.length]={unit:v,indices:xe.ofSortedArray(Be.indicesOf(v.elements,I.elements))}}return Q.Loci(y.source,x)}g.toLociWithSourceUnits=l;function u(y,x,S){return x.length===0?r(y):S?e(y,Ky(y,x)):t(y,x)}class c{constructor(x){this.source=x;this.structures=[];this.allSingletons=!0}add(x){let S=x.elementCount;S!==0&&(this.structures[this.structures.length]=x,S!==1&&(this.allSingletons=!1))}getSelection(){return u(this.source,this.structures,this.allSingletons)}}class m{constructor(x){this.structure=x;this.structures=[];this.allSingletons=!0;this.uniqueSets=PI(De.hashCode,De.areUnitIdsAndIndicesEqual)}add(x){let S=x.elementCount;S===0||!this.uniqueSets.add(x)||(this.structures[this.structures.length]=x,S!==1&&(this.allSingletons=!1))}getSelection(){return u(this.structure,this.structures,this.allSingletons)}}function d(y){return new c(y)}g.LinearBuilder=d;function p(y){return new m(y)}g.UniqueBuilder=p;function h(y,x){let S=0;if(g.isSingleton(y))for(let I of y.structure.units){let{elements:v}=I;for(let A=0,P=v.length;A<P;A++){let T=De.create([I.getChild(Be.ofSingleton(v[A]))],{parent:y.source});x(T,S++)}}else for(let I of y.structures)x(I,S++)}g.forEach=h;function f(y,x){return n(y)?e(x,y.structure):t(x,y.structures)}g.withInputStructure=f})(ut||={});var O6={};Gi(O6,{atomicHet:()=>vje,atomicSequence:()=>Cje,bundleElementImpl:()=>L6,bundleGenerator:()=>V6,defaultBondTest:()=>VE,spheres:()=>Ije,water:()=>Sje});function gje(e){return!!e.items}function yje(e){let{and:t}=ie.core.logic,{eq:r,gre:n,lte:o}=ie.core.rel,{macromolecular:i,ihm:a,core:s}=ie.struct.atomProperty,l={};nl(e.label_entity_id)&&(l["entity-test"]=r([i.label_entity_id(),e.label_entity_id]));let u=[];nl(e.operator_name)&&u.push(r([s.operatorName(),e.operator_name])),nl(e.instance_id)&&u.push(r([s.instanceId(),e.instance_id])),nl(e.label_asym_id)&&u.push(r([i.label_asym_id(),e.label_asym_id])),nl(e.auth_asym_id)&&u.push(r([i.auth_asym_id(),e.auth_asym_id])),u.length===1?l["chain-test"]=u[0]:u.length>1&&(l["chain-test"]=t(u));let c=[];nl(e.label_seq_id)&&c.push(a.hasSeqId({0:e.label_seq_id})),nl(e.auth_seq_id)&&c.push(r([i.auth_seq_id(),e.auth_seq_id])),nl(e.residue_index)&&c.push(r([i.residueSourceIndex(),e.residue_index])),nl(e.pdbx_PDB_ins_code)&&c.push(r([i.pdbx_PDB_ins_code(),e.pdbx_PDB_ins_code])),(nl(e.beg_label_seq_id)||nl(e.end_label_seq_id))&&c.push(a.overlapsSeqIdRange({beg:e.beg_label_seq_id,end:e.end_label_seq_id})),nl(e.beg_auth_seq_id)&&c.push(n([i.auth_seq_id(),e.beg_auth_seq_id])),nl(e.end_auth_seq_id)&&c.push(o([i.auth_seq_id(),e.end_auth_seq_id])),c.length===1?l["residue-test"]=c[0]:c.length>1&&(l["residue-test"]=t(c));let m=[];return nl(e.label_comp_id)&&m.push(r([i.label_comp_id(),e.label_comp_id])),nl(e.auth_comp_id)&&m.push(r([i.auth_comp_id(),e.auth_comp_id])),nl(e.atom_id)&&m.push(r([i.id(),e.atom_id])),nl(e.atom_index)&&m.push(r([ie.struct.atomProperty.core.sourceIndex(),e.atom_index])),nl(e.label_atom_id)&&m.push(r([i.label_atom_id(),e.label_atom_id])),nl(e.auth_atom_id)&&m.push(r([i.auth_atom_id(),e.auth_atom_id])),nl(e.type_symbol)&&m.push(r([ie.struct.atomProperty.core.elementSymbol(),e.type_symbol.toUpperCase()])),m.length===1?l["atom-test"]=m[0]:m.length>1&&(l["atom-test"]=t(m)),ie.struct.generator.atomGroups(l)}function qme(e){let t=[];return Yme(e,r=>t.push(yje(r))),t.length===1?t[0]:bje(t)}function bje(e){return ie.struct.combinator.merge(e.map(t=>ie.struct.modifier.union([t])))}function nl(e){return e!=null}function Yme(e,t){if(gje(e))if(Array.isArray(e.items))if(e.prefix)for(let r of e.items)t(Object.assign({},e.prefix,r));else for(let r of e.items)t(r);else{let r={...e.prefix},n=Object.keys(e.items),o=e.items[n[0]].length;for(let i=0;i<o;i++){for(let a of n)r[a]=e.items[a][i];t(r)}}else t(e)}function Kme(e,t,r){let n=qme(t);return yp.fromExpression(e,n,r)}function xje(e,t,r){let n=Kme(e,t,r);return VI.fromLoci(n)}var X_={forEachItem:Yme,toExpression:qme,toLoci:Kme,toBundle:xje};var VI;(p=>{p.Empty={hash:-1,elements:[]};function t(h,f){return a(ut.toLociWithSourceUnits(ut.Singletons(h,f)))}p.fromSubStructure=t;function r(h){return a(ut.toLociWithSourceUnits(h))}p.fromSelection=r;function n(h,f,g){return a(yp.fromExpression(h,f,g))}p.fromExpression=n;function o(h,f,g){return a(yp.fromQuery(h,f,g))}p.fromQuery=o;function i(h,f,g){return X_.toBundle(h,f,g)}p.fromSchema=i;function a(h){let f=[];for(let x of h.elements){let{unit:S,indices:I}=x;if(xe.size(I)===0)continue;let v=[],A=[];if(xe.isInterval(I))xe.size(I)===1?A.push(ye.min(I)):v.push(ye.min(I),ye.max(I));else{let P=0,T=I.length;for(;P<T;){let R=P;for(P++;P<T&&I[P-1]+1===I[P];)P++;let w=P;if(w-R>2)v.push(I[R],I[w-1]);else for(let E=R;E<w;E++)A[A.length]=I[E]}}f.push({unit:S,set:Be.ofSortedArray(A),ranges:Wn.ofSortedRanges(v)})}let g=new Map;for(let x=0,S=f.length;x<S;++x){let I=f[x],v=$u(ui(I.ranges),ui(I.set));if(g.has(v)){let{groupedUnits:A}=g.get(v);A.has(I.unit.invariantId)?A.get(I.unit.invariantId).push(I.unit.id):A.set(I.unit.invariantId,[I.unit.id])}else{let A=new Map;A.set(I.unit.invariantId,[I.unit.id]),g.set(v,{groupedUnits:A,set:I.set,ranges:I.ranges})}}let y=[];return g.forEach(x=>{let S=[];x.groupedUnits.forEach(I=>S.push(Be.ofUnsortedArray(I))),S.sort((I,v)=>I[0]-v[0]),y.push({groupedUnits:S,set:x.set,ranges:x.ranges})}),{hash:h.structure.hashCode,elements:y}}p.fromLoci=a;function s(h,f){let g=[];for(let y=0,x=h.length;y<x;++y){let S=h[y];f.unitMap.has(S)&&g.push(f.unitMap.get(S))}return g}function l(h,f){h.hash!==-1&&h.hash!==f.hashCode&&new Error("Bundle not compatible with given structure");let g=[];for(let y of h.elements)for(let x of y.groupedUnits){let S=s(x,f);if(S.length===0)continue;let I;if(y.ranges.length===0)I=y.set;else if(y.set.length===0)if(y.ranges.length===2)I=ye.ofRange(y.ranges[0],y.ranges[1]);else{let v=new Int32Array(Wn.size(y.ranges));Wn.forEach(y.ranges,(A,P)=>v[P]=A),I=Be.ofSortedArray(v)}else{let v=Wn.size(y.ranges),A=new Int32Array(y.set.length+v);Wn.forEach(y.ranges,(P,T)=>A[T]=P),A.set(y.set,v),I=Be.ofUnsortedArray(A)}for(let v of S)g.push({unit:v,indices:I})}return yp(f,g)}p.toLoci=l;function u(h,f){h.hash!==-1&&h.hash!==f.hashCode&&new Error("Bundle not compatible with given structure");let g=[];for(let y of h.elements)for(let x of y.groupedUnits){let S=s(x,f);if(S.length===0)continue;let I=S[0].elements,v=Wn.size(y.ranges),A=y.set.length,P=new Int32Array(A+v),T;if(v===0){for(let R=0,w=A;R<w;++R)P[R]=I[y.set[R]];T=Be.ofSortedArray(P)}else if(A===0)Wn.forEach(y.ranges,(R,w)=>P[w]=I[R]),T=Be.ofSortedArray(P);else if(Be.min(y.set)>Wn.max(y.ranges)){Wn.forEach(y.ranges,(R,w)=>P[w]=I[R]);for(let R=0,w=A;R<w;++R)P[R+v]=I[y.set[R]];T=Be.ofSortedArray(P)}else if(Wn.min(y.ranges)>Be.max(y.set)){for(let R=0,w=A;R<w;++R)P[R]=I[y.set[R]];Wn.forEach(y.ranges,(R,w)=>P[w+A]=I[R]),T=Be.ofSortedArray(P)}else{Wn.forEach(y.ranges,(R,w)=>P[w]=I[R]);for(let R=0,w=A;R<w;++R)P[R+v]=I[y.set[R]];T=Be.ofUnsortedArray(P)}for(let R of S)g.push(R.getChild(T))}return De.create(g,{parent:f})}p.toStructure=u;function c(h){return ie.internal.generator.bundleElement({groupedUnits:ie.core.type.list(h.groupedUnits.map(f=>ie.core.type.list(f))),ranges:ie.core.type.list(h.ranges),set:ie.core.type.list(h.set)})}function m(h){return ie.internal.generator.bundle({elements:ie.core.type.list(h.elements.map(c))})}p.toExpression=m;function d(h,f){if(h.elements.length!==f.elements.length)return!1;for(let g=0,y=h.elements.length;g<y;++g){let x=h.elements[g],S=f.elements[g];if(x.groupedUnits.length!==S.groupedUnits.length)return!1;for(let I=0,v=S.groupedUnits.length;I<v;++I)if(!Be.areEqual(x.groupedUnits[I],S.groupedUnits[I]))return!1;if(!Be.areEqual(x.set,S.set)||!Wn.areEqual(x.ranges,S.ranges))return!1}return!0}p.areEqual=d})(VI||={});function VE(e){return xt.isCovalent(e.atomicBond.type)}function Cje(){return function(t){let{inputStructure:r}=t,n=Q.Location.create(r),o=[];for(let i of r.units){if(i.kind!==ue.Kind.Atomic)continue;n.unit=i;let a=i.elements;if(n.element=a[0],Ke.entity.type(n)!=="polymer")continue;let s=Kt.transientSegments(i.model.atomicHierarchy.residueAtomSegments,a),l=0;for(;s.hasNext;)l++,s.move();l<8||o.push(i)}return ut.Singletons(r,De.create(o,{parent:r}))}}function Sje(){return function(t){let{inputStructure:r}=t,n=Q.Location.create(r),o=[];for(let i of r.units){if(i.kind!==ue.Kind.Atomic)continue;n.unit=i;let a=i.elements;n.element=a[0],Ke.entity.type(n)==="water"&&o.push(i)}return ut.Singletons(r,De.create(o,{parent:r}))}}function vje(){return function(t){let{inputStructure:r}=t,n=Q.Location.create(r),o=[];for(let i of r.units){if(i.kind!==ue.Kind.Atomic)continue;n.unit=i;let a=i.elements;if(n.element=a[0],Ke.entity.type(n)!=="water"){if(Ke.entity.type(n)==="polymer"){let s=Kt.transientSegments(i.model.atomicHierarchy.residueAtomSegments,a),l=0;for(;s.hasNext;)l++,s.move();if(l>=8)continue}o.push(i)}}return ut.Singletons(r,De.create(o,{parent:r}))}}function Ije(){return function(t){let{inputStructure:r}=t,n=[];for(let o of r.units)o.kind===ue.Kind.Spheres&&n.push(o);return ut.Singletons(r,De.create(n,{parent:r}))}}function L6(e,t,r){return{groupedUnits:e,ranges:t,set:r}}function V6(e){return function(r){let n={hash:r.inputStructure.hashCode,elements:e};return ut.Sequence(r.inputStructure,[VI.toStructure(n,r.inputStructure)])}}var zo=class{constructor(t,r){this.currentElementStack=[];this.currentAtomicBondStack=[];this.currentStructureStack=[];this.inputStructureStack=[];this.timeCreated=En();this.element=Q.Location.create(void 0);this.currentStructure=void 0;this.atomicBond=new OE;this.currentSelection=void 0;this.inputStructure=t,this.timeoutMs=r&&r.timeoutMs||0,this.currentSelection=r&&r.currentSelection}pushCurrentElement(){return this.currentElementStack[this.currentElementStack.length]=this.element,this.element=Q.Location.create(void 0),this.element}popCurrentElement(){this.element=this.currentElementStack.pop()}pushCurrentBond(){return this.atomicBond&&this.currentAtomicBondStack.push(this.atomicBond),this.atomicBond=new OE,this.atomicBond}popCurrentBond(){this.currentAtomicBondStack.length>0?this.atomicBond=this.currentAtomicBondStack.pop():this.atomicBond=void 0}pushCurrentStructure(){this.currentStructure&&this.currentStructureStack.push(this.currentStructure)}popCurrentStructure(){this.currentStructureStack.length?this.currentStructure=this.currentStructureStack.pop():this.currentStructure=void 0}pushInputStructure(t){this.inputStructureStack.push(this.inputStructure),this.inputStructure=t}popInputStructure(){if(this.inputStructureStack.length===0)throw new Error("Must push before pop.");this.inputStructure=this.inputStructureStack.pop()}throwIfTimedOut(){if(this.timeoutMs!==0&&En()-this.timeCreated>this.timeoutMs)throw new Error(`The query took too long to execute (> ${this.timeoutMs/1e3}s).`)}tryGetCurrentSelection(){if(!this.currentSelection)throw new Error("The current selection is not assigned.");return this.currentSelection}},OE=class{constructor(){this.a=Q.Location.create(void 0);this.aIndex=0;this.b=Q.Location.create(void 0);this.bIndex=0;this.type=xt.Flag.None;this.order=0;this.key=-1;this.testFn=VE}setStructure(t){this.a.structure=t,this.b.structure=t}setTestFn(t){this.testFn=t||VE}test(t,r){return this.testFn(t)?!0:r?(this.swap(),this.testFn(t)):!1}swap(){let t=this.aIndex;this.aIndex=this.bIndex,this.bIndex=t;let r=this.a.unit;this.a.unit=this.b.unit,this.b.unit=r;let n=this.a.element;this.a.element=this.b.element,this.b.element=n}get length(){return Q.Location.distance(this.a,this.b)}};var GE;(r=>{function e(n,o,i){return n(new zo(o,i))}r.run=e;function t(n,o,i){let a=n(new zo(o,i));return ut.toLociWithSourceUnits(a)}r.loci=t})(GE||={});var N6={};Gi(N6,{all:()=>Jme,atoms:()=>U6,bondedAtomicPairs:()=>Bje,chains:()=>Tje,none:()=>NE,querySelection:()=>Mje,residues:()=>Aje,rings:()=>wje});var OI=class{constructor(t){this.source=t;this.set=PI(De.hashCode,De.areUnitIdsAndIndicesEqual);this.structures=[];this.allSingletons=!0}add(t){t.elementCount&&(t.elementCount!==1&&(this.allSingletons=!1),this.set.add(t)&&(this.structures[this.structures.length]=t))}getSelection(){return this.allSingletons?ut.Singletons(this.source,Ky(this.source,this.structures)):ut.Sequence(this.source,this.structures)}},UE=class{constructor(t){this.source=t;this.builders=[];this.builderMap=new Map}add(t,r,n){let o=this.builderMap.get(t);o||(o=this.source.subsetBuilder(!0),this.builders[this.builders.length]=o,this.builderMap.set(t,o)),o.addToUnit(r,n)}allSingletons(){for(let t=0,r=this.builders.length;t<r;t++)if(this.builders[t].elementCount>1)return!1;return!0}singletonSelection(){let t=this.source.subsetBuilder(!0),r=Q.Location.create(this.source);for(let n=0,o=this.builders.length;n<o;n++)this.builders[n].setSingletonLocation(r),t.addToUnit(r.unit.id,r.element);return ut.Singletons(this.source,t.getStructure())}fullSelection(){let t=new Array(this.builders.length);for(let r=0,n=this.builders.length;r<n;r++)t[r]=this.builders[r].getStructure();return ut.Sequence(this.source,t)}getSelection(){return this.builders.length===0?ut.Empty(this.source):this.allSingletons()?this.singletonSelection():this.fullSelection()}};var NE=e=>ut.Sequence(e.inputStructure,[]),Jme=e=>ut.Singletons(e.inputStructure,e.inputStructure);function Aje(e){return U6({...e,groupBy:t=>Ke.residue.key(t.element)})}function Tje(e){return U6({...e,groupBy:t=>Ke.chain.key(t.element)})}function sC(e){return!0}function Pje(e){return 0}function U6(e){if(!e||!e.atomTest&&!e.residueTest&&!e.chainTest&&!e.entityTest&&!e.unitTest&&!e.groupBy)return Jme;if(e.atomTest&&!e.residueTest&&!e.chainTest&&!e.entityTest&&!e.unitTest&&!e.groupBy)return _je(e.atomTest);let t={unitTest:e.unitTest||sC,entityTest:e.entityTest||sC,chainTest:e.chainTest||sC,residueTest:e.residueTest||sC,atomTest:e.atomTest||sC,groupBy:e.groupBy||Pje};return e.groupBy?Dje(t):Rje(t)}function _je(e){return function(r){let{inputStructure:n}=r,{units:o}=n,i=r.pushCurrentElement(),a=n.subsetBuilder(!0);i.structure=n;for(let s of o){i.unit=s;let l=s.elements;a.beginUnit(s.id);for(let u=0,c=l.length;u<c;u++)i.element=l[u],e(r)&&a.addElement(i.element);a.commitUnit(),r.throwIfTimedOut()}return r.popCurrentElement(),ut.Singletons(n,a.getStructure())}}function Rje({unitTest:e,entityTest:t,chainTest:r,residueTest:n,atomTest:o}){return function(a){let{inputStructure:s}=a,{units:l}=s,u=a.pushCurrentElement(),c=s.subsetBuilder(!0),m=n===sC&&o===sC,d=o===sC;u.structure=s;for(let p of l){if(u.unit=p,!e(a))continue;let{elements:h,model:f}=p;if(c.beginUnit(p.id),p.kind===ue.Kind.Atomic){let g=Kt.transientSegments(p.model.atomicHierarchy.chainAtomSegments,h),y=Kt.transientSegments(p.model.atomicHierarchy.residueAtomSegments,h);for(;g.hasNext;){let x=g.move();if(u.element=h[x.start],!(!t(a)||!r(a))){if(m){c.addElementRange(h,x.start,x.end);continue}for(y.setSegment(x);y.hasNext;){let S=y.move();if(u.element=h[S.start],!!n(a)){if(d){c.addElementRange(h,S.start,S.end);continue}for(let I=S.start,v=S.end;I<v;I++)u.element=h[I],o(a)&&c.addElement(u.element)}}}}}else{let{chainElementSegments:g}=p.kind===ue.Kind.Spheres?f.coarseHierarchy.spheres:f.coarseHierarchy.gaussians,y=Kt.transientSegments(g,h);for(;y.hasNext;){let x=y.move();if(u.element=h[x.start],!(!t(a)||!r(a))){if(m){c.addElementRange(h,x.start,x.end);continue}for(let S=x.start,I=x.end;S<I;S++)u.element=h[S],n(a)&&c.addElement(u.element)}}}c.commitUnit(),a.throwIfTimedOut()}return a.popCurrentElement(),ut.Singletons(s,c.getStructure())}}function Dje({unitTest:e,entityTest:t,chainTest:r,residueTest:n,atomTest:o,groupBy:i}){return function(s){let{inputStructure:l}=s,{units:u}=l,c=s.pushCurrentElement(),m=new UE(l);c.structure=l;for(let d of u){if(c.unit=d,!e(s))continue;let{elements:p,model:h}=d;if(d.kind===ue.Kind.Atomic){let f=Kt.transientSegments(h.atomicHierarchy.chainAtomSegments,p),g=Kt.transientSegments(h.atomicHierarchy.residueAtomSegments,p);for(;f.hasNext;){let y=f.move();if(c.element=p[y.start],!(!t(s)||!r(s)))for(g.setSegment(y);g.hasNext;){let x=g.move();if(c.element=p[x.start],!!n(s))for(let S=x.start,I=x.end;S<I;S++)c.element=p[S],o(s)&&m.add(i(s),d.id,c.element)}}}else{let{chainElementSegments:f}=d.kind===ue.Kind.Spheres?h.coarseHierarchy.spheres:h.coarseHierarchy.gaussians,g=Kt.transientSegments(f,p);for(;g.hasNext;){let y=g.move();if(c.element=p[y.start],!(!t(s)||!r(s)))for(let x=y.start,S=y.end;x<S;x++)c.element=p[x],n(s)&&m.add(i(s),d.id,c.element)}}s.throwIfTimedOut()}return s.popCurrentElement(),m.getSelection()}}function G6(e,t,r){let n=new Int32Array(t.length);for(let o=0,i=t.length;o<i;o++)n[o]=e.elements[t[o]];return De.create([e.getChild(Be.ofSortedArray(n))],{parent:r})}function wje(e,t){return function(n){let{units:o}=n.inputStructure,i=ut.LinearBuilder(n.inputStructure);if(!e||e.length===0){for(let a of o)if(ue.isAtomic(a))if(t)for(let s of a.rings.aromaticRings)i.add(G6(a,a.rings.all[s],n.inputStructure));else for(let s of a.rings.all)i.add(G6(a,s,n.inputStructure))}else{let a=Un.create();for(let s=0;s<e.length;s++)Un.add(a,e[s],e[s]);for(let s of o){if(!ue.isAtomic(s))continue;let l=s.rings;for(let u of a.array)if(l.byFingerprint.has(u))for(let c of l.byFingerprint.get(u))t&&!l.aromaticRings.includes(c)||i.add(G6(s,l.all[c],n.inputStructure))}}return i.getSelection()}}function Mje(e,t,r=!1){return function(o){let i=e(o);if(ut.structureCount(i)===0)return i;let a=r?LI(o.inputStructure,ut.unionStructure(i)):ut.unionStructure(i);if(a.elementCount===0)return ut.Empty(o.inputStructure);o.throwIfTimedOut(),o.pushInputStructure(a);let s=t(o);return o.popInputStructure(),ut.withInputStructure(s,o.inputStructure)}}function Bje(e){return function(r){let n=r.inputStructure,o=n.interUnitBonds,i=ut.UniqueBuilder(r.inputStructure);r.pushCurrentBond();let a=r.atomicBond;a.setTestFn(e),a.setStructure(n);for(let s of n.units){if(s.kind!==ue.Kind.Atomic)continue;let{offset:l,b:u,edgeProps:{flags:c,order:m,key:d}}=s.bonds;a.a.unit=s,a.b.unit=s;for(let p=0,h=s.elements.length;p<h;p++){a.aIndex=p,a.a.element=s.elements[p];for(let f=l[p],g=l[p+1];f<g;f++)if(a.bIndex=u[f],a.b.element=s.elements[u[f]],a.type=c[f],a.order=m[f],a.key=d[f],a.test(r,!1)){let y=n.subsetBuilder(!1);y.beginUnit(s.id),y.addElement(a.a.element),y.addElement(a.b.element),y.commitUnit(),i.add(y.getStructure())}}}for(let s of o.edges)if(a.a.unit=n.unitMap.get(s.unitA),a.a.element=a.a.unit.elements[s.indexA],a.aIndex=s.indexA,a.b.unit=n.unitMap.get(s.unitB),a.b.element=a.b.unit.elements[s.indexB],a.bIndex=s.indexB,a.order=s.props.order,a.type=s.props.flag,a.key=s.props.key,a.test(r,!1)){let l=n.subsetBuilder(!1);l.addToUnit(a.a.unit.id,a.a.element),l.addToUnit(a.b.unit.id,a.b.element),i.add(l.getStructure())}return r.popCurrentBond(),i.getSelection()}}var Z6={};Gi(Z6,{exceptBy:()=>v7e,expandProperty:()=>A7e,includeConnected:()=>T7e,includeSurroundings:()=>x7e,intersectBy:()=>S7e,querySelection:()=>C7e,surroundingLigands:()=>_7e,union:()=>I7e,wholeResidues:()=>g7e});var OS=class{constructor(t){this.parent=t;this.ids=[];this.unitMap=Mu.Mutable();this.parentId=-1;this.currentUnit=Un.create();this.elementCount=0}addToUnit(t,r){let n=this.unitMap.get(t);if(n)Un.add(n,r,r)&&this.elementCount++;else{let o=Un.create();Un.add(o,r,r),this.unitMap.set(t,o),this.ids[this.ids.length]=t,this.elementCount++}}has(t,r){let n=this.unitMap.get(t);return n?Un.has(n,r):!1}beginUnit(t){this.parentId=t,this.unitMap.has(t)?this.currentUnit=this.unitMap.get(t):this.currentUnit=this.currentUnit.array.length>0?Un.create():this.currentUnit}addElement(t){Un.add(this.currentUnit,t,t)&&this.elementCount++}commitUnit(){this.currentUnit.array.length===0||this.unitMap.has(this.parentId)||(this.ids[this.ids.length]=this.parentId,this.unitMap.set(this.parentId,this.currentUnit),this.parentId=-1)}getStructure(){if(this.isEmpty)return De.Empty;let t=[];Js(this.ids);let r=Bm.UnitEquivalenceBuilder();for(let n=0,o=this.ids.length;n<o;n++){let i=this.ids[n],a=this.parent.unitMap.get(i),s=this.unitMap.get(i).array,l=s.length;if(s.length===a.elements.length){t[t.length]=a,r.add(a.id,a);continue}l>1&&Js(s);let u=a.getChild(Be.ofSortedArray(s)),c=r.add(u.id,u);u!==c&&(u=c.applyOperator(u.id,u.conformation.operator,!0)),t[t.length]=u}return De.create(t,{parent:this.parent})}get isEmpty(){return this.elementCount===0}};function GI(e,t,r,n){return{type:e,key:t,elements:r,getIndex:n}}var gt;(n=>{n.is=Ia.has,n.create=Ia.create;let r;(x=>(x[x._=0]="_",x[x.H=1]="H",x[x.B=2]="B",x[x.E=4]="E",x[x.G=8]="G",x[x.I=16]="I",x[x.S=32]="S",x[x.T=64]="T",x[x.T3=128]="T3",x[x.T4=256]="T4",x[x.T5=512]="T5",x[x.T3S=1024]="T3S",x[x.T4S=2048]="T4S",x[x.T5S=4096]="T5S"))(r=n.Flag||={})})(gt||={});var GS=class{constructor(t,r,n){this.partner1=Math.min(t,r),this.partner2=Math.max(t,r),this.type=n}};function $me(e){let{unit:t,flags:r,proteinInfo:n}=e,o=t.conformation,{traceElementIndex:i}=t.model.atomicHierarchy.derived.residue,{residueIndices:a,nIndices:s}=n,l=a.length,u=(y,x)=>y===-1?b.setNaN(x):o.position(y,x),c=b(),m=b(),d=b(),p=b(),h=b(),f=b(),g=b();e:for(let y=2;y<l-2;y++){for(let R=0;R<4;R++){let w=y+R-2;if(u(i[w],p),u(s[w+1],h),b.squaredDistance(p,h)>6.25)continue e}let x=a[y-2],S=a[y],I=a[y+2],v=i[x],A=i[S],P=i[I];u(v,c),u(A,m),u(P,d),b.sub(f,c,m),b.sub(g,m,d);let T=Ya(b.angle(f,g));T&&T>70&&(r[y]|=gt.Flag.S)}}var Eje=9,zE=-27.888,kje=-.5,ede=-9.9;function Fje(e,t,r,n){let o=b.distance(e,n),i=b.distance(t,n),a=b.distance(t,r),s=b.distance(e,r),l=zE/o-zE/i,u=zE/a-zE/s,c=l+u;return c<ede?ede:c}function tde(e,t,r){let{residueIndices:n,cIndices:o,hIndices:i,nIndices:a,oIndices:s}=t,{index:l}=e.model.atomicHierarchy,u=e.conformation,{traceElementIndex:c}=e.model.atomicHierarchy.derived.residue,m=n.length,d=[],p=[],h=[],f=b(),g=b(),y=b(),x=b(),S=b(),I=b(),v=b();for(let A=0,P=n.length;A<P;++A){let T=A,R=n[A],w=s[T],E=o[T],M=c[R];if(w===-1||E===-1||l.findAtomOnResidue(R,"OXT")!==-1)continue;u.invariantPosition(w,f),u.invariantPosition(E,g),u.invariantPosition(M,y);let{indices:D,count:B}=r.find(y[0],y[1],y[2],Eje);for(let k=0;k<B;++k){let F=D[k];if(F===T||F-1===T||F+1===T)continue;let z=a[F];if(z===-1)continue;u.invariantPosition(z,x);let j=i[F];if(j===-1){if(F===0)continue;let G=F-1,X=s[G],U=o[G];if(X===-1||U===-1)continue;u.invariantPosition(X,v),u.invariantPosition(U,I),b.sub(S,I,v);let L=b.distance(v,I);b.scaleAndAdd(S,x,S,1/L)}else u.invariantPosition(j,S);let Y=Fje(f,g,x,S);Y>kje||(d[d.length]=T,p[p.length]=F,h[h.length]=Y)}}return Lje(m,d,p,h)}function Lje(e,t,r,n){let o=new xs.DirectedEdgeBuilder(e,t,r),i=new Float32Array(o.slotCount);for(let a=0,s=o.edgeCount;a<s;a++)o.addNextEdge(),o.assignProperty(i,n[a]);return o.createGraph({energies:n})}function rde(e){let{proteinInfo:t,hbonds:r,flags:n}=e,o=[gt.Flag.T3S,gt.Flag.T4S,gt.Flag.T5S,gt.Flag.T3,gt.Flag.T4,gt.Flag.T5];for(let i=0;i<3;i++)for(let a=0,s=t.residueIndices.length-1;a<s;++a)if(r.getDirectedEdgeIndex(a,a+i+3)!==-1)if(n[a]|=o[i+3]|o[i],e.params.oldDefinition)for(let l=1;l<i+3;++l)n[a+l]|=o[i+3]|gt.Flag.T;else for(let l=0;l<=i+3;++l)n[a+l]|=o[i+3]|gt.Flag.T}function nde(e){let{proteinInfo:t,flags:r}=e,n=t.residueIndices.length,o=[gt.Flag.T3S,gt.Flag.T4S,gt.Flag.T5S,gt.Flag.T3,gt.Flag.T4,gt.Flag.T5],i=[0,0,0,gt.Flag.G,gt.Flag.H,gt.Flag.I],a=e.params.oldOrdering?[4,3,5]:[3,4,5];for(let s=0;s<a.length;s++){let l=a[s];for(let u=1,c=n-l;u<c;u++){let m=gt.create(r[u]),d=gt.create(r[u-1]),p=gt.create(r[u+1]);if(e.params.oldOrdering){if(l===3&&(gt.is(m,gt.Flag.H)||gt.is(p,gt.Flag.H))||l===5&&(gt.is(m,gt.Flag.H)||gt.is(m,gt.Flag.G)||gt.is(p,gt.Flag.H)||gt.is(p,gt.Flag.G)))continue}else if(l===4&&(gt.is(m,gt.Flag.G)||gt.is(p,gt.Flag.G))||l===5&&(gt.is(m,gt.Flag.H)||gt.is(m,gt.Flag.G)||gt.is(p,gt.Flag.H)||gt.is(p,gt.Flag.G)))continue;if(gt.is(m,o[l])&&gt.is(m,o[l-3])&&gt.is(d,o[l])&&gt.is(d,o[l-3]))if(e.params.oldDefinition)for(let h=0;h<l;h++)r[u+h]|=i[l];else for(let h=-1;h<=l;h++)r[u+h]|=i[l]}}}function Vje(e,t){if(t.type!==e.type||t.partner1!==e.firstEnd+1)return!1;if(t.type===0){if(t.partner2===e.secondEnd+1)return!0}else if(t.partner2===e.secondStart-1)return!0;return!1}function Oje(e,t){return e.type===t.type&&t.firstStart-e.firstEnd<6&&e.firstStart<t.firstStart&&t.nextLadder===0?e.type===0?ode(e,t):ode(t,e):!1}function ode(e,t){return t.secondStart-e.secondEnd>0&&(t.secondStart-e.secondEnd<6&&t.firstStart-e.firstEnd<3||t.secondStart-e.secondEnd<3)}function ade(e){let{bridges:t,ladders:r}=e;for(let n=0;n<t.length;n++){let o=t[n],i=!1;for(let a=0;a<r.length;a++){let s=r[a];Vje(s,o)&&(i=!0,s.firstEnd++,o.type===0?s.secondEnd++:s.secondStart--)}i||(r[r.length]={previousLadder:0,nextLadder:0,firstStart:o.partner1,firstEnd:o.partner1,secondStart:o.partner2,secondEnd:o.partner2,type:o.type})}for(let n=0;n<r.length;n++){let o=r[n];for(let i=n;i<r.length;i++){let a=r[i];Oje(o,a)&&(o.nextLadder=i,a.previousLadder=n)}}}function sde(e){let{proteinInfo:t,hbonds:r,flags:n,bridges:o}=e,{offset:i,b:a}=r,s,l;for(let u=0,c=t.residueIndices.length;u<c;++u)for(let m=i[u],d=i[u+1];m<d;m++){let p=a[m];u>p||(s=u+1,l=p,s!==l&&r.getDirectedEdgeIndex(l,s+1)!==-1&&(n[s]|=gt.Flag.B,n[l]|=gt.Flag.B,o[o.length]=new GS(s,l,0)),s=u,l=p-1,s!==l&&r.getDirectedEdgeIndex(l-1,s)!==-1&&(n[s]|=gt.Flag.B,n[l]|=gt.Flag.B,o[o.length]=new GS(l,s,0)),s=u,l=p,s!==l&&r.getDirectedEdgeIndex(l,s)!==-1&&(n[s]|=gt.Flag.B,n[l]|=gt.Flag.B,o[o.length]=new GS(l,s,1)),s=u+1,l=p-1,s!==l&&r.getDirectedEdgeIndex(l-1,s+1)!==-1&&(n[s]|=gt.Flag.B,n[l]|=gt.Flag.B,o[o.length]=new GS(l,s,1)))}o.sort((u,c)=>u.partner1>c.partner1?1:u.partner1<c.partner1?-1:0)}function lde(e){return gt.is(e,gt.Flag.G)||gt.is(e,gt.Flag.H)||gt.is(e,gt.Flag.I)}function ude(e){let{ladders:t,flags:r}=e;for(let n=0;n<t.length;n++){let o=t[n];for(let a=o.firstStart;a<=o.firstEnd;a++){let s=o.firstStart-a,l=o.secondStart-s;o.firstStart!==o.firstEnd?(r[a]|=gt.Flag.E,r[l]|=gt.Flag.E):(!lde(r[a])&&gt.is(r[a],gt.Flag.E)&&(r[a]|=gt.Flag.B),!lde(r[l])&&gt.is(r[l],gt.Flag.E)&&(r[l]|=gt.Flag.B))}if(o.nextLadder===0)continue;let i=t[o.nextLadder];for(let a=o.firstStart;a<=i.firstEnd;a++)r[a]|=gt.Flag.E;if(o.type===0)for(let a=o.secondStart;a<=i.secondEnd;a++)r[a]|=gt.Flag.E;else for(let a=i.secondEnd;a<=o.secondStart;a++)r[a]|=gt.Flag.E}}function cde(e,t){let{cIndices:r,nIndices:n,residueIndices:o}=t,i=e.conformation,{index:a}=e.model.atomicHierarchy,{traceElementIndex:s}=e.model.atomicHierarchy.derived.residue,l=o.length,u=(v,A)=>v===-1?b.setNaN(A):i.position(v,A),c=b(),m=b(),d=b(),p=b(),h=b(),f=b(),g=b(),y=b(),x=b();if(l===0)return{phi:new Float32Array(0),psi:new Float32Array(0)};let S=new Float32Array(l-1),I=new Float32Array(l-1);u(-1,c),u(-1,m),u(-1,d),u(r[0],p),u(s[o[0]],h),u(n[0],f),u(r[1],g),u(s[o[1]],y),u(n[1],x);for(let v=0;v<l-1;++v)a.findAtomOnResidue(o[v],"OXT")===-1&&(S[v]=Ya(b.dihedralAngle(c,f,h,p)),I[v]=Ya(b.dihedralAngle(f,h,p,x)),c=p,m=h,d=f,p=g,h=y,f=x,u(r[v+1],g),u(s[o[v+1]],y),u(n[v+1],x));return{phi:S,psi:I}}function mde(e,t){let{x:r,y:n,z:o}=e.model.atomicConformation,{traceElementIndex:i}=e.model.atomicHierarchy.derived.residue,a=new Uint32Array(t.length);for(let l=0,u=t.length;l<u;++l)a[l]=i[t[l]];let s={x:r,y:n,z:o,indices:Be.ofSortedArray(a)};return zc(s,Hf(s))}function dde(e){let{index:t}=e.model.atomicHierarchy,{proteinElements:r,residueIndex:n}=e,o=r.length,i=new Uint32Array(o),a=new Int32Array(o),s=new Int32Array(o),l=new Int32Array(o),u=new Int32Array(o);for(let c=0;c<o;++c){let m=n[r[c]];i[c]=m,a[c]=t.findAtomOnResidue(m,"C"),s[c]=t.findAtomOnResidue(m,"H"),l[c]=t.findAtomOnResidue(m,"O"),u[c]=t.findAtomOnResidue(m,"N")}return{residueIndices:Be.ofSortedArray(i),cIndices:a,hIndices:s,oIndices:l,nIndices:u}}var z6={oldDefinition:C.Boolean(!0,{description:"Whether to use the old DSSP convention for the annotation of turns and helices, causes them to be two residues shorter"}),oldOrdering:C.Boolean(!0,{description:"Alpha-helices are preferred over 3-10 helices"})},pde=C.getDefaultValues(z6);async function H6(e,t){let r=dde(e),{residueIndices:n}=r,o=mde(e,n),i=tde(e,r,o),a=n.length,s=new Uint32Array(a),l=cde(e,r),u=[],c=[],m=t.oldDefinition?Nje:Hje,d=t.oldOrdering?zje:jje,p={params:t,getResidueFlag:m,getFlagName:d,unit:e,proteinInfo:r,flags:s,hbonds:i,torsionAngles:l,ladders:u,bridges:c};rde(p),nde(p),$me(p),sde(p),ade(p),ude(p);let h=Wje(s,m),f=new Uint32Array(a),g=[],y=[],x=S=>Be.indexOf(n,S);for(let S=0,I=n.length;S<I;++S){let v=h[S];f[S]=v;let A=m(s[S]);(y.length===0||A!==y[y.length-1].flags)&&(y[y.length]=Gje(Uje(v),s[S],m)),g[S]=y.length-1}return GI(f,g,y,x)}function Gje(e,t,r){return e==="helix"?{kind:"helix",flags:r(t)}:e==="sheet"?{kind:"sheet",flags:r(t)}:e==="turn"||e==="bend"?{kind:"turn",flags:r(t)}:{kind:"none"}}function Uje(e){return e===rr.SecondaryStructureDssp.H||e===rr.SecondaryStructureDssp.G||e===rr.SecondaryStructureDssp.I?"helix":e===rr.SecondaryStructureDssp.B||e===rr.SecondaryStructureDssp.E?"sheet":e===rr.SecondaryStructureDssp.T?"turn":e===rr.SecondaryStructureDssp.S?"bend":"none"}function Nje(e){return gt.is(e,gt.Flag.H)?rr.SecondaryStructureDssp.H:gt.is(e,gt.Flag.E)?rr.SecondaryStructureDssp.E:gt.is(e,gt.Flag.B)?rr.SecondaryStructureDssp.B:gt.is(e,gt.Flag.G)?rr.SecondaryStructureDssp.G:gt.is(e,gt.Flag.I)?rr.SecondaryStructureDssp.I:gt.is(e,gt.Flag.T)?rr.SecondaryStructureDssp.T:gt.is(e,gt.Flag.S)?rr.SecondaryStructureDssp.S:rr.Flag.None}function zje(e){return gt.is(e,gt.Flag.H)?"H":gt.is(e,gt.Flag.E)?"E":gt.is(e,gt.Flag.B)?"B":gt.is(e,gt.Flag.G)?"G":gt.is(e,gt.Flag.I)?"I":gt.is(e,gt.Flag.T)?"T":gt.is(e,gt.Flag.S)?"S":"-"}function Hje(e){return gt.is(e,gt.Flag.I)?rr.SecondaryStructureDssp.I:gt.is(e,gt.Flag.H)?rr.SecondaryStructureDssp.H:gt.is(e,gt.Flag.E)?rr.SecondaryStructureDssp.E:gt.is(e,gt.Flag.B)?rr.SecondaryStructureDssp.B:gt.is(e,gt.Flag.G)?rr.SecondaryStructureDssp.G:gt.is(e,gt.Flag.T)?rr.SecondaryStructureDssp.T:gt.is(e,gt.Flag.S)?rr.SecondaryStructureDssp.S:rr.Flag.None}function jje(e){return gt.is(e,gt.Flag.I)?"I":gt.is(e,gt.Flag.H)?"H":gt.is(e,gt.Flag.E)?"E":gt.is(e,gt.Flag.B)?"B":gt.is(e,gt.Flag.G)?"G":gt.is(e,gt.Flag.T)?"T":gt.is(e,gt.Flag.S)?"S":"-"}function Wje(e,t){let r=new Uint32Array(e.length);for(let n=0,o=e.length;n<o;++n){let i=gt.create(e[n]);r[n]=t(i)}return r}var Zl;(r=>{function e(n){let o=n.descriptor.name,i=n.type==="root"?"inheritedPropertyData":"currentPropertyData",a=l=>(o in l[i]||(l[i][o]={props:{...C.getDefaultValues(n.getParams(l))},data:My.create(void 0)}),l[i][o]),s=(l,u,c)=>{let m=a(l);l[i][o]={props:u,data:My.withValue(m.data,c)}};return{label:n.label,descriptor:n.descriptor,isHidden:n.isHidden,getParams:l=>{let u=C.clone(n.getParams(l));return C.setDefaultValues(u,a(l).props),u},defaultParams:n.defaultParams,isApplicable:n.isApplicable,attach:async(l,u,c={},m)=>{m&&u.customPropertyDescriptors.reference(n.descriptor,!0),n.type==="root"&&(u=u.root);let d=a(u.root).props,p=a(u),h=C.merge(n.defaultParams,d,c);if(p.data.value&&C.areEqual(n.defaultParams,p.props,h))return;let{value:f,assets:g}=await n.obtain(l,u,h);u.customPropertyDescriptors.add(n.descriptor),u.customPropertyDescriptors.assets(n.descriptor,g),s(u,h,f)},ref:(l,u)=>l.customPropertyDescriptors.reference(n.descriptor,u),get:l=>a(l).data,set:(l,u={},c)=>{n.type==="root"&&(l=l.root);let m=a(l),d=C.merge(n.defaultParams,m.props,u);C.areEqual(n.defaultParams,m.props,d)||(s(l,d,c),l.customPropertyDescriptors.assets(n.descriptor))},props:l=>a(l).props}}r.createProvider=e;function t(n,o,i){let a={value:C.Value(i,{isHidden:!0})};return e({label:va(n),descriptor:{name:n},isHidden:!0,type:o,defaultParams:a,getParams:()=>({value:C.Value(i,{isHidden:!0})}),isApplicable:()=>!0,obtain:async(s,l,u)=>({...C.getDefaultValues(a),...u})})}r.createSimple=t})(Zl||={});var lg;(n=>{n.Descriptor={name:"model_secondary_structure"},n.Provider=_l.create(n.Descriptor);function r(o,i,a){let s=new Map,l=[{kind:"none"}],u=Xje(o,i);Qje(o,u,s,l),Zje(i,u,s,o._rowCount,l);let c=a.residues._rowCount,m=p=>p,d={type:new Int32Array(c),key:new Int32Array(c),elements:l};return s.size>0&&Yje(a,u,s,d),GI(d.type,d.key,d.elements,m)}n.fromStruct=r})(lg||={});function Xje(e,t){if(e._rowCount>0){if(e.beg_label_seq_id.valueKind(0)!==W.ValueKinds.Present||e.end_label_seq_id.valueKind(0)!==W.ValueKinds.Present)return"auth"}else if(t&&(t.beg_label_seq_id.valueKind(0)!==W.ValueKinds.Present||t.end_label_seq_id.valueKind(0)!==W.ValueKinds.Present))return"auth";return"label"}function Qje(e,t,r,n){if(!e._rowCount)return;let{beg_label_asym_id:o,beg_label_seq_id:i,beg_auth_seq_id:a,pdbx_beg_PDB_ins_code:s}=e,{end_label_seq_id:l,end_auth_seq_id:u,pdbx_end_PDB_ins_code:c}=e,{pdbx_PDB_helix_class:m,conf_type_id:d,details:p}=e,h=t==="label"?i:a,f=t==="label"?l:u;for(let g=0,y=e._rowCount;g<y;g++){let x=rr.create(m.valueKind(g)===W.ValueKinds.Present?rr.SecondaryStructurePdb[m.value(g)]:d.valueKind(g)===W.ValueKinds.Present?rr.SecondaryStructureMmcif[d.value(g)]:rr.Flag.NA),S={kind:"helix",flags:x,type_id:d.valueKind(g)===W.ValueKinds.Present?d.value(g):"helx_p",helix_class:m.value(g),details:p.valueKind(g)===W.ValueKinds.Present?p.value(g):void 0},I={startSeqId:h.value(g),startInsCode:s.value(g),endSeqId:f.value(g),endInsCode:c.value(g),type:x,key:n.length};n[n.length]=S;let v=o.value(g);if(r.has(v)){let A=r.get(v);A.has(I.startSeqId)?A.get(I.startSeqId).push(I):A.set(I.startSeqId,[I])}else r.set(v,new Map([[I.startSeqId,[I]]]))}}function Zje(e,t,r,n,o){if(!e._rowCount)return;let{beg_label_asym_id:i,beg_label_seq_id:a,beg_auth_seq_id:s,pdbx_beg_PDB_ins_code:l}=e,{end_label_seq_id:u,end_auth_seq_id:c,pdbx_end_PDB_ins_code:m}=e,{sheet_id:d}=e,p=t==="label"?a:s,h=t==="label"?u:c,f=new Map,g=n+1;for(let y=0,x=e._rowCount;y<x;y++){let S=d.value(y),I;f.has(S)?I=f.get(S):(I=g++,f.set(S,I));let v=rr.create(rr.Flag.Beta|rr.Flag.BetaSheet),A={kind:"sheet",flags:v,sheet_id:S,symmetry:void 0},P={startSeqId:p.value(y),startInsCode:l.value(y),endSeqId:h.value(y),endInsCode:m.value(y),type:v,key:o.length};o[o.length]=A;let T=i.value(y);if(r.has(T)){let R=r.get(T);R.has(P.startSeqId)?R.get(P.startSeqId).push(P):R.set(P.startSeqId,[P])}else r.set(T,new Map([[P.startSeqId,[P]]]))}}function qje(e,t,r,n,o,i){let{auth_seq_id:a,label_seq_id:s,pdbx_PDB_ins_code:l}=e.residues,{endSeqId:u,endInsCode:c,key:m,type:d}=r,p=t==="label"?s:a,h=n;for(;h<o;){let f=p.value(h);if(i.type[h]=d,i.key[h]=m,f>u||f===u&&l.value(h)===c)break;h++}}function Yje(e,t,r,n){let{count:o}=e.chainAtomSegments,{label_asym_id:i}=e.chains,{auth_seq_id:a,label_seq_id:s,pdbx_PDB_ins_code:l}=e.residues,u=t==="label"?s:a;for(let c=0;c<o;c++){let m=wS.chainStartResidueIndex(e,c),d=wS.chainEndResidueIndexExcl(e,c),p=i.value(c);if(r.has(p)){let h=r.get(p);for(let f=m;f<d;f++){let g=u.value(f);if(h.has(g)){let y=h.get(g);for(let x of y){let S=l.value(f);x.startInsCode===S&&qje(e,t,x,f,d,n)}}}}}}var Kje=[5.45,5.18,6.37],Jje=2.1,$je=[6.1,10.4,13],e7e=1.42,fde=b(),hde=b();function gde(e,t,r,n,o){let i=e.conformation,{traceElementIndex:a}=e.model.atomicHierarchy.derived.residue;for(let s=Math.max(0,r-2);s<=r;++s)for(let l=2;l<5;++l){if(s+l>=t.length)return!1;let u=t[s],c=t[s+l],m=a[u],d=a[c];if(m===-1||d===-1)return!1;i.invariantPosition(m,fde),i.invariantPosition(d,hde);let p=b.distance(fde,hde);if(Math.abs(p-n[l-2])>=o)return!1}return!0}async function j6(e){let t=e.proteinElements.length,r=new Uint32Array(t),n=[],o=[],{proteinElements:i,residueIndex:a}=e,s=i.length,l=new Uint32Array(s);for(let m=0;m<s;++m){let d=a[i[m]];l[m]=d}let u=Be.ofSortedArray(l),c=m=>Be.indexOf(u,m);for(let m=0,d=u.length;m<d;++m){let p=rr.Flag.None;gde(e,u,m,Kje,Jje)?p=rr.Flag.Helix:gde(e,u,m,$je,e7e)&&(p=rr.Flag.Beta),r[m]=p,(o.length===0||p!==n7e(o[o.length-1]))&&(o[o.length]=t7e(r7e(p),p)),n[m]=o.length-1}return GI(r,n,o,c)}function t7e(e,t){return e==="helix"?{kind:"helix",flags:t}:e==="sheet"?{kind:"sheet",flags:t}:{kind:"none"}}function r7e(e){return e===rr.Flag.Helix?"helix":e===rr.Flag.Beta?"sheet":"none"}function n7e(e){return e.kind==="helix"||e.kind==="sheet"?e.flags:rr.Flag.None}function bde(e){return{type:C.MappedStatic("auto",{auto:C.EmptyGroup({label:"Automatic"}),model:C.EmptyGroup({label:"Model"}),dssp:C.Group(z6,{label:"DSSP",isFlat:!0}),"zhang-skolnick":C.EmptyGroup({label:"Zhang-Skolnick"})},{options:[["auto","Automatic"],["model","Model"],["dssp","DSSP"],["zhang-skolnick","Zhang-Skolnick"]]})}}var yde=bde(),ol=Zl.createProvider({label:"Secondary Structure",descriptor:{name:"molstar_computed_secondary_structure"},type:"root",defaultParams:yde,getParams:bde,isApplicable:e=>!0,obtain:async(e,t,r)=>{let n={...C.getDefaultValues(yde),...r};switch(n.type.name){case"auto":return{value:await o7e(t)};case"dssp":return{value:await i7e(t,n.type.params)};case"model":return{value:await s7e(t)};case"zhang-skolnick":return{value:await a7e(t)}}}});async function o7e(e){let t=new Map;for(let r=0,n=e.unitSymmetryGroups.length;r<n;++r){let o=e.unitSymmetryGroups[r].units[0],i=o.model;if(Gt.isFromPdbArchive(i)&&Gt.isExperimental(i)&&!Gt.isCoarseGrained(i)||Gt.hasSecondaryStructure(i)){let a=lg.Provider.get(i);a&&t.set(o.invariantId,a)}else if(ue.isAtomic(o)&&!Gt.isCoarseGrained(i)){let a=await H6(o,pde);t.set(o.invariantId,a)}else if(ue.isAtomic(o)){let a=await j6(o);t.set(o.invariantId,a)}}return t}async function i7e(e,t){let r=new Map;for(let n=0,o=e.unitSymmetryGroups.length;n<o;++n){let i=e.unitSymmetryGroups[n].units[0];if(ue.isAtomic(i)&&!Gt.isCoarseGrained(i.model)){let a=await H6(i,t);r.set(i.invariantId,a)}}return r}async function a7e(e){let t=new Map;for(let r=0,n=e.unitSymmetryGroups.length;r<n;++r){let o=e.unitSymmetryGroups[r].units[0];if(ue.isAtomic(o)){let i=await j6(o);t.set(o.invariantId,i)}}return t}async function s7e(e){let t=new Map;for(let r=0,n=e.unitSymmetryGroups.length;r<n;++r){let o=e.unitSymmetryGroups[r].units[0];if(ue.isAtomic(o)){let i=lg.Provider.get(o.model);i&&t.set(o.invariantId,i)}}return t}var l7e={true:e=>!0,false:e=>!1,zero:e=>0};function ga(){throw new Error("Property only available for atomic models.")}function Jy(e){throw e?new Error(`Property only available for coarse models (${e}).`):new Error("Property only available for coarse models.")}var Q_={key:e=>e.element,x:e=>e.unit.conformation.x(e.element),y:e=>e.unit.conformation.y(e.element),z:e=>e.unit.conformation.z(e.element),id:e=>ue.isAtomic(e.unit)?e.unit.model.atomicConformation.atomId.value(e.element):ga(),occupancy:e=>ue.isAtomic(e.unit)?e.unit.model.atomicConformation.occupancy.value(e.element):ga(),B_iso_or_equiv:e=>ue.isAtomic(e.unit)?e.unit.model.atomicConformation.B_iso_or_equiv.value(e.element):ga(),sourceIndex:e=>ue.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atomSourceIndex.value(e.element):e.element,type_symbol:e=>ue.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.type_symbol.value(e.element):ga(),label_atom_id:e=>ue.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.label_atom_id.value(e.element):ga(),auth_atom_id:e=>ue.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.auth_atom_id.value(e.element):ga(),label_alt_id:e=>ue.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.label_alt_id.value(e.element):ga(),label_comp_id:Z_,auth_comp_id:e=>ue.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.auth_comp_id.value(e.element):ga(),pdbx_formal_charge:e=>ue.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.pdbx_formal_charge.value(e.element):ga(),vdw_radius:e=>ue.isAtomic(e.unit)?Dm(e.unit.model.atomicHierarchy.atoms.type_symbol.value(e.element)):ga()};function Z_(e){return ue.isAtomic(e.unit)||ga(),e.unit.model.atomicHierarchy.atoms.label_comp_id.value(e.element)}function W6(e){return ue.isAtomic(e.unit)?e.unit.model.atomicHierarchy.residues.label_seq_id.value(e.unit.residueIndex[e.element]):ga()}function u7e(e){ue.isAtomic(e.unit)||ga();let t=e.unit.model.sequence.byEntityKey[lc(e)];return t&&t.sequence.microHet.has(W6(e))}function xde(e){ue.isAtomic(e.unit)||ga();let t=e.unit.model.sequence.byEntityKey[lc(e)];return t?t.sequence.microHet.get(W6(e))||[Z_(e)]:[Z_(e)]}var c7e={key:e=>ue.isAtomic(e.unit)?e.unit.residueIndex[e.element]:ga(),group_PDB:e=>ue.isAtomic(e.unit)?e.unit.model.atomicHierarchy.residues.group_PDB.value(e.unit.residueIndex[e.element]):ga(),label_comp_id:Z_,auth_comp_id:e=>ue.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.auth_comp_id.value(e.element):ga(),label_seq_id:W6,auth_seq_id:e=>ue.isAtomic(e.unit)?e.unit.model.atomicHierarchy.residues.auth_seq_id.value(e.unit.residueIndex[e.element]):ga(),pdbx_PDB_ins_code:e=>ue.isAtomic(e.unit)?e.unit.model.atomicHierarchy.residues.pdbx_PDB_ins_code.value(e.unit.residueIndex[e.element]):ga(),isNonStandard:e=>ue.isAtomic(e.unit)?xde(e).some(t=>e.unit.model.properties.chemicalComponentMap.get(t).mon_nstd_flag[0]==="n"):ga(),hasMicroheterogeneity:u7e,microheterogeneityCompIds:xde,secondary_structure_type:e=>{ue.isAtomic(e.unit)||ga();let t=ol.get(e.structure).value?.get(e.unit.invariantId);return t?t.type[t.getIndex(e.unit.residueIndex[e.element])]:rr.Flag.NA},secondary_structure_key:e=>{ue.isAtomic(e.unit)||ga();let t=ol.get(e.structure).value?.get(e.unit.invariantId);return t?t.key[t.getIndex(e.unit.residueIndex[e.element])]:-1},chem_comp_type:e=>ue.isAtomic(e.unit)?e.unit.model.properties.chemicalComponentMap.get(Z_(e)).type:ga(),residueSourceIndex:e=>ue.isAtomic(e.unit)?e.unit.model.atomicHierarchy.residueSourceIndex.value(e.unit.residueIndex[e.element]):ga()},m7e={key:e=>ue.isAtomic(e.unit)?e.unit.chainIndex[e.element]:ga(),label_asym_id:e=>ue.isAtomic(e.unit)?e.unit.model.atomicHierarchy.chains.label_asym_id.value(e.unit.chainIndex[e.element]):e.unit.coarseElements.asym_id.value(e.element),auth_asym_id:e=>ue.isAtomic(e.unit)?e.unit.model.atomicHierarchy.chains.auth_asym_id.value(e.unit.chainIndex[e.element]):ga(),label_entity_id:e=>ue.isAtomic(e.unit)?e.unit.model.atomicHierarchy.chains.label_entity_id.value(e.unit.chainIndex[e.element]):e.unit.coarseElements.entity_id.value(e.element)},d7e={key:Q_.key,entityKey:e=>ue.isCoarse(e.unit)?e.unit.coarseElements.entityKey[e.element]:Jy(),x:Q_.x,y:Q_.y,z:Q_.z,asym_id:e=>ue.isCoarse(e.unit)?e.unit.coarseElements.asym_id.value(e.element):Jy(),entity_id:e=>ue.isCoarse(e.unit)?e.unit.coarseElements.entity_id.value(e.element):Jy(),seq_id_begin:e=>ue.isCoarse(e.unit)?e.unit.coarseElements.seq_id_begin.value(e.element):Jy(),seq_id_end:e=>ue.isCoarse(e.unit)?e.unit.coarseElements.seq_id_end.value(e.element):Jy(),sphere_radius:e=>ue.isSpheres(e.unit)?e.unit.coarseConformation.radius[e.element]:Jy("spheres"),sphere_rmsf:e=>ue.isSpheres(e.unit)?e.unit.coarseConformation.rmsf[e.element]:Jy("spheres"),gaussian_weight:e=>ue.isGaussians(e.unit)?e.unit.coarseConformation.weight[e.element]:Jy("gaussians"),gaussian_covariance_matrix:e=>ue.isGaussians(e.unit)?e.unit.coarseConformation.covariance_matrix[e.element]:Jy("gaussians")};function lc(e){switch(e.unit.kind){case ue.Kind.Atomic:return e.unit.model.atomicHierarchy.index.getEntityFromChain(e.unit.chainIndex[e.element]);case ue.Kind.Spheres:return e.unit.model.coarseHierarchy.spheres.entityKey[e.element];case ue.Kind.Gaussians:return e.unit.model.coarseHierarchy.gaussians.entityKey[e.element]}}var p7e={key:lc,id:e=>e.unit.model.entities.data.id.value(lc(e)),type:e=>e.unit.model.entities.data.type.value(lc(e)),src_method:e=>e.unit.model.entities.data.src_method.value(lc(e)),pdbx_description:e=>e.unit.model.entities.data.pdbx_description.value(lc(e)),formula_weight:e=>e.unit.model.entities.data.formula_weight.value(lc(e)),pdbx_number_of_molecules:e=>e.unit.model.entities.data.pdbx_number_of_molecules.value(lc(e)),details:e=>e.unit.model.entities.data.details.value(lc(e)),pdbx_mutation:e=>e.unit.model.entities.data.pdbx_mutation.value(lc(e)),pdbx_fragment:e=>e.unit.model.entities.data.pdbx_fragment.value(lc(e)),pdbx_ec:e=>e.unit.model.entities.data.pdbx_ec.value(lc(e)),pdbx_parent_entity_id:e=>e.unit.model.entities.data.pdbx_parent_entity_id.value(lc(e)),subtype:e=>e.unit.model.entities.subtype.value(lc(e)),prd_id:e=>e.unit.model.entities.prd_id?.value(lc(e))??""},f7e=[],h7e={id:e=>e.unit.id,chainGroupId:e=>e.unit.chainGroupId,multiChain:e=>ue.Traits.is(e.unit.traits,ue.Trait.MultiChain),object_primitive:e=>e.unit.objectPrimitive,operator_name:e=>e.unit.conformation.operator.name,instance_id:e=>e.unit.conformation.operator.instanceId,operator_key:e=>e.unit.conformation.operator.key,model_index:e=>e.unit.model.modelNum,model_label:e=>e.unit.model.label,model_entry_id:e=>e.unit.model.entryId,hkl:e=>e.unit.conformation.operator.hkl,spgrOp:e=>e.unit.conformation.operator.spgrOp,model_num:e=>e.unit.model.modelNum,pdbx_struct_assembly_id:e=>e.unit.conformation.operator.assembly?.id||Jn.DefaultName,pdbx_struct_oper_list_ids:e=>e.unit.conformation.operator.assembly?.operList||f7e,struct_ncs_oper_id:e=>e.unit.conformation.operator.ncsId},Ke={constant:l7e,atom:Q_,residue:c7e,chain:m7e,entity:p7e,unit:h7e,coarse:d7e};var lC=class{constructor(t){this.index=new Map;this.checkOperator=!1;this._asym_id=Ke.chain.label_asym_id;this._seq_id=Ke.residue.label_seq_id;this._comp_id=Ke.atom.label_comp_id;this._alt_id=Ke.atom.label_alt_id;this._ins_code=Ke.residue.pdbx_PDB_ins_code;this._op_name=Ke.unit.operator_name;this.checkOperator=t?.checkOperator??!1}add(t){let r=this.index.get(t.label_asym_id);r||(r=new Map,this.index.set(t.label_asym_id,r));let n=r.get(t.label_seq_id);return n||(n=[],r.set(t.label_seq_id,n)),this._find(t,n)?!1:(n.push(t),!0)}hasLabelAsymId(t){return this.index.has(t)}has(t){let r=this._asym_id(t);if(!this.index.has(r))return;let n=this.index.get(r),o=this._seq_id(t);if(!n.has(o))return;let i=n.get(o),a=this._comp_id(t),s=this._alt_id(t),l=this._ins_code(t),u=this._op_name(t)??"1_555";for(let c of i)if(!(c.label_comp_id!==a||c.label_alt_id!==s||c.ins_code!==l)&&!(this.checkOperator&&(c.operator_name??"1_555")!==u))return c}static getLabel(t,r=!1){return`${t.label_asym_id} ${t.label_comp_id} ${t.label_seq_id}:${t.ins_code}:${t.label_alt_id}${r?" "+(t.operator_name??"1_555"):""}`}static getEntryFromLocation(t){return{label_asym_id:Ke.chain.label_asym_id(t),label_comp_id:Ke.atom.label_comp_id(t),label_seq_id:Ke.residue.label_seq_id(t),label_alt_id:Ke.atom.label_alt_id(t),ins_code:Ke.residue.pdbx_PDB_ins_code(t),operator_name:Ke.unit.operator_name(t)??"1_555"}}_find(t,r){for(let n of r)if(!(n.label_comp_id!==t.label_comp_id||n.label_alt_id!==t.label_alt_id||n.ins_code!==t.ins_code)&&!(this.checkOperator&&(n.operator_name??"1_555")!==(t.operator_name??"1_555")))return!0;return!1}};function UI(e,t,r){let n=t.subsetBuilder(!0);for(let o of r.units){if(o.kind!==ue.Kind.Atomic){n.setUnit(o.id,o.elements);continue}let{residueAtomSegments:i}=o.model.atomicHierarchy,a=t.unitMap.get(o.id).elements,s=o.elements;n.beginUnit(o.id);let l=Kt.transientSegments(i,s);for(;l.hasNext;){let u=l.move().index;for(let c=i.offsets[u],m=i.offsets[u+1];c<m;c++)Be.has(a,c)&&n.addElement(c)}n.commitUnit(),e.throwIfTimedOut()}return n.getStructure()}function g7e(e){return function(r){let n=e(r);if(ut.isSingleton(n))return ut.Singletons(r.inputStructure,UI(r,r.inputStructure,n.structure));{let o=new OI(r.inputStructure);for(let i of n.structures)o.add(UI(r,r.inputStructure,i));return o.getSelection()}}}function X6(e,t,r,n){let o=new OS(t),i=t.lookup3d,a=n.radius;for(let s of r.units){let l=s.conformation,u=s.elements;for(let c=0,m=u.length;c<m;c++){let d=u[c];i.findIntoBuilder(l.x(d),l.y(d),l.z(d),a,o)}e.throwIfTimedOut()}return n.wholeResidues?UI(e,t,o.getStructure()):o.getStructure()}function Cde(e,t,r,n){let o=new OS(t),i=t.lookup3d,{elementRadius:a,elementRadiusClosure:s,sourceMaxRadius:l,radius:u}=n;e.pushCurrentElement(),e.element.structure=r;for(let c of r.units){e.element.unit=c;let m=c.conformation,d=c.elements;for(let p=0,h=d.length;p<h;p++){let f=d[p];e.element.element=f;let g=a(e);i.findIntoBuilderWithRadius(m.x(f),m.y(f),m.z(f),g,l,u,s,o)}e.throwIfTimedOut()}return e.popCurrentElement(),n.wholeResidues?UI(e,t,o.getStructure()):o.getStructure()}function y7e(e,t){return r=>(e.element.structure=r.structure,e.element.unit=r.unit,e.element.element=r.element,t(e))}function b7e(e,t){let r=0;e.element.structure=e.inputStructure;for(let n of e.inputStructure.units){e.element.unit=n;let o=n.elements;for(let i=0,a=o.length;i<a;i++){let s=o[i];e.element.element=s;let l=t(e);l>r&&(r=l)}}return e.throwIfTimedOut(),r}function x7e(e,t){return function(n){let o=e(n);if(t.elementRadius){let i={...t,elementRadius:t.elementRadius,elementRadiusClosure:y7e(n,t.elementRadius),sourceMaxRadius:b7e(n,t.elementRadius)};if(ut.isSingleton(o)){let a=Cde(n,n.inputStructure,o.structure,i);return ut.Singletons(n.inputStructure,a)}else{let a=new OI(n.inputStructure);for(let s of o.structures)a.add(Cde(n,n.inputStructure,s,i));return a.getSelection()}}if(ut.isSingleton(o)){let i=X6(n,n.inputStructure,o.structure,t);return ut.Singletons(n.inputStructure,i)}else{let i=new OI(n.inputStructure);for(let a of o.structures)i.add(X6(n,n.inputStructure,a,t));return i.getSelection()}}}function C7e(e,t){return function(n){let o=e(n);if(ut.structureCount(o)===0)return o;let i=ut.UniqueBuilder(n.inputStructure),a=s=>i.add(s);return ut.forEach(o,(s,l)=>{n.pushInputStructure(s),ut.forEach(t(n),a),n.popInputStructure(),l%10===0&&n.throwIfTimedOut()}),i.getSelection()}}function S7e(e,t){return function(n){let o=e(n);if(ut.structureCount(o)===0)return o;let i=t(n);if(ut.structureCount(i)===0)return ut.Empty(n.inputStructure);let a=ut.unionStructure(i),s=ut.UniqueBuilder(n.inputStructure);return ut.forEach(o,(l,u)=>{let c=LE(a,l);c.elementCount!==0&&s.add(c),u%50===0&&n.throwIfTimedOut()}),s.getSelection()}}function v7e(e,t){return function(n){let o=e(n);if(ut.structureCount(o)===0)return o;let i=t(n);if(ut.structureCount(i)===0)return o;let a=ut.unionStructure(i),s=ut.UniqueBuilder(n.inputStructure);return ut.forEach(o,(l,u)=>{let c=LI(l,a);c.elementCount!==0&&s.add(c),u%50===0&&n.throwIfTimedOut()}),s.getSelection()}}function I7e(e){return function(r){let n=ut.LinearBuilder(r.inputStructure);return n.add(ut.unionStructure(e(r))),n.getSelection()}}function A7e(e,t){return function(n){let o=e(n),i=new Map,a=[];n.pushCurrentElement(),ut.forEach(o,(l,u)=>{n.element.structure=l;for(let c of l.units){n.element.unit=c;let m=c.elements;for(let d=0,p=m.length;d<p;d++){n.element.element=m[d];let h=t(n),f;i.has(h)?f=i.get(h):(f=Un.create(),i.set(h,f)),Un.add(f,u,u)}}a[u]=n.inputStructure.subsetBuilder(!0),u%10===0&&n.throwIfTimedOut()}),n.element.structure=n.inputStructure;for(let l of n.inputStructure.units){n.element.unit=l;let u=l.elements;for(let c=0,m=u.length;c<m;c++){n.element.element=u[c];let d=t(n);if(!i.has(d))continue;let p=i.get(d).array;for(let h=0,f=p.length;h<f;h++)a[p[h]].addToUnit(l.id,u[c])}}n.popCurrentElement();let s=ut.UniqueBuilder(n.inputStructure);for(let l of a)s.add(l.getStructure());return s.getSelection()}}function T7e({query:e,layerCount:t,wholeResidues:r,bondTest:n,fixedPoint:o}){let i=Math.max(t,0);return function(s){let l=ut.UniqueBuilder(s.inputStructure),u=e(s);return s.pushCurrentBond(),s.atomicBond.setTestFn(n),ut.forEach(u,(c,m)=>{let d=c;if(o)for(;;){let p=d.elementCount;if(d=Sde(s,r,d),d.elementCount===p)break}else for(let p=0;p<i;p++)d=Sde(s,r,d);l.add(d),m%10===0&&s.throwIfTimedOut()}),s.popCurrentBond(),l.getSelection()}}function Sde(e,t,r){let n=P7e(e,r);return t?UI(e,e.inputStructure,n):n}function P7e(e,t){let r=e.inputStructure,n=r.interUnitBonds,o=new OS(r),i=e.atomicBond;for(let a of t.units){if(a.kind!==ue.Kind.Atomic){o.beginUnit(a.id);for(let p=0,h=a.elements.length;p<h;p++)o.addElement(a.elements[p]);o.commitUnit();continue}let s=r.unitMap.get(a.id),{offset:l,b:u,edgeProps:{flags:c,order:m,key:d}}=s.bonds;i.setStructure(r),i.a.unit=s,i.b.unit=s;for(let p=0,h=a.elements.length;p<h;p++){o.addToUnit(a.id,a.elements[p]);let f=Be.indexOf(s.elements,a.elements[p]);for(let g=l[f],y=l[f+1];g<y;g++){let x=u[g],S=s.elements[x];Be.has(a.elements,S)||o.has(a.id,S)||(i.aIndex=f,i.a.element=a.elements[p],i.bIndex=x,i.b.element=S,i.type=c[g],i.order=m[g],i.key=d[g],i.test(e,!0)&&o.addToUnit(a.id,S))}}for(let p of n.getConnectedUnits(s.id)){let h=t.unitMap.get(p.unitB),f=r.unitMap.get(p.unitB);for(let g of p.connectedIndices)if(Be.has(a.elements,s.elements[g]))for(let y of p.getEdges(g)){let x=f.elements[y.indexB];h&&Be.has(h.elements,x)||o.has(p.unitB,x)||(i.a.unit=s,i.aIndex=g,i.a.element=s.elements[g],i.b.unit=f,i.bIndex=y.indexB,i.b.element=x,i.type=y.props.flag,i.order=y.props.order,i.key=y.props.key,i.test(e,!0)&&o.addToUnit(p.unitB,x))}}}return o.getStructure()}function _7e({query:e,radius:t,includeWater:r}){let n=Ke.entity.type;function o(i){return n(i)==="water"}return function(a){let s=ut.unionStructure(e(a)),l=UI(a,a.inputStructure,X6(a,a.inputStructure,s,{radius:t})),u=R7e(a.inputStructure),c=D7e(a.inputStructure),m=Q.Location.create(l),d=new Map,p=new lC({checkOperator:!0});for(let g of l.units){if(g.kind!==ue.Kind.Atomic)continue;m.unit=g;let{elements:y}=g,x=Kt.transientSegments(g.model.atomicHierarchy.chainAtomSegments,y),S=Kt.transientSegments(g.model.atomicHierarchy.residueAtomSegments,y);for(;x.hasNext;){let I=x.move();m.element=y[I.start];let v=Ke.chain.label_asym_id(m),A=Ke.unit.operator_name(m);if(u.has(v)){d.has(v)?li(d.get(v),A):d.set(v,[A]);continue}let P=Ke.entity.type(m);if(!(P==="water"||P==="polymer"))for(S.setSegment(I);S.hasNext;){let T=S.move();m.element=y[T.start],c.addComponent(lC.getEntryFromLocation(m),p)}}a.throwIfTimedOut()}let h=a.inputStructure.subsetBuilder(!0);for(let g of a.inputStructure.units){if(g.kind!==ue.Kind.Atomic)continue;m.unit=g;let{elements:y}=g,x=Kt.transientSegments(g.model.atomicHierarchy.chainAtomSegments,y),S=Kt.transientSegments(g.model.atomicHierarchy.residueAtomSegments,y);for(h.beginUnit(g.id);x.hasNext;){let I=x.move();m.element=y[I.start];let v=Ke.chain.label_asym_id(m),A=Ke.unit.operator_name(m);if(d.has(v)&&d.get(v).indexOf(A)>=0){h.addElementRange(y,I.start,I.end);continue}if(p.hasLabelAsymId(v))for(S.setSegment(I);S.hasNext;){let P=S.move();m.element=y[P.start],p.has(m)&&h.addElementRange(y,P.start,P.end)}}h.commitUnit(),a.throwIfTimedOut()}let f=Ky(a.inputStructure,[h.getStructure(),s]);if(r){let g=new OS(a.inputStructure),y=a.inputStructure.lookup3d;for(let x of f.units){let S=x.conformation,I=x.elements;for(let v=0,A=I.length;v<A;v++){let P=I[v];y.findIntoBuilderIf(S.x(P),S.y(P),S.z(P),t,g,o),g.addToUnit(x.id,P)}a.throwIfTimedOut()}return ut.Sequence(a.inputStructure,[g.getStructure()])}else return ut.Sequence(a.inputStructure,[f])}}function R7e(e){let t=e.models[0],r=new Set;if(t.sourceData?.kind!=="mmCIF")return r;let{_rowCount:n,asym_id:o}=t.sourceData.data.db.pdbx_molecule;for(let i=0;i<n;i++)r.add(o.value(i));return r}function D7e(e){let t=e.models[0],r=new Q6;if(t.sourceData?.kind!=="mmCIF")return r;let n=t.sourceData.data.db.struct_conn,{conn_type_id:o}=n,{ptnr1_label_asym_id:i,ptnr1_label_comp_id:a,ptnr1_label_seq_id:s,ptnr1_symmetry:l,pdbx_ptnr1_label_alt_id:u,pdbx_ptnr1_PDB_ins_code:c}=n,{ptnr2_label_asym_id:m,ptnr2_label_comp_id:d,ptnr2_label_seq_id:p,ptnr2_symmetry:h,pdbx_ptnr2_label_alt_id:f,pdbx_ptnr2_PDB_ins_code:g}=n;for(let y=0;y<n._rowCount;y++){let x=o.value(y);if(x!=="covale"&&x!=="metalc")continue;let S={label_asym_id:i.value(y),label_comp_id:a.value(y),label_seq_id:s.value(y),label_alt_id:u.value(y),ins_code:c.value(y),operator_name:l.value(y)??"1_555"},I={label_asym_id:m.value(y),label_comp_id:d.value(y),label_seq_id:p.value(y),label_alt_id:f.value(y),ins_code:g.value(y),operator_name:h.value(y)??"1_555"};r.addEdge(S,I)}return r}var Q6=class{constructor(){this.vertices=new Map;this.edges=new Map}addVertex(t,r){this.vertices.has(r)||(this.vertices.set(r,t),this.edges.set(r,[]))}addEdge(t,r){let n=lC.getLabel(t),o=lC.getLabel(r);this.addVertex(t,n),this.addVertex(r,o),li(this.edges.get(n),o),li(this.edges.get(o),n)}addComponent(t,r){let n=lC.getLabel(t);if(!this.vertices.has(n)){r.add(t);return}let o=new Set,i=new Set,a=[n];for(i.add(n),r.add(t);a.length>0;){let s=a.pop();o.add(s);let l=this.vertices.get(s);for(let u of this.edges.get(s)){if(o.has(u)||(a.push(u),i.has(u)))continue;i.add(u);let c=this.vertices.get(u);l.operator_name===c.operator_name?r.add({...c,operator_name:t.operator_name}):r.add(c)}}}};var K6={};Gi(K6,{areIntersectedBy:()=>k7e,first:()=>M7e,getCurrentStructureProperties:()=>q_,isConnectedTo:()=>U7e,pick:()=>w7e,withSameAtomProperties:()=>E7e,within:()=>F7e});function vde(e,t,r,n,o,i){return t.elementCount===0||r.elementCount===0?!0:t.elementCount<=r.elementCount?q6.check(e,t,r,n,o,i):q6.check(e,r,t,n,o,i)}function Ide(e,t,r,n,o){return t.elementCount===0||r.elementCount===0?!0:t.elementCount<=r.elementCount?Y6.check(e,t,r,n,o):Y6.check(e,r,t,n,o)}var q6;(a=>{let e;(c=>(c[c.BelowMin=0]="BelowMin",c[c.WithinMax=1]="WithinMax",c[c.Miss=2]="Miss"))(e||={});let t=b();function r(s,l,u,c,m,d,p){let{elements:h,conformation:f}=l,g=t;s.element.unit=l;let y=!1;for(let x=0,S=h.length;x<S;x++){let I=h[x];s.element.element=I;let v=Math.max(0,b.distance(u,f.position(I,g))-c-p(s));if(v<m)return 0;v<d&&(y=!0)}return y?1:2}function n(s,l,u,c,m,d,p){let{units:h}=l,f=!1;for(let g=0,y=h.length;g<y;g++){let x=r(s,h[g],u,c,m,d,p);if(x===0)return 0;x===1&&(f=!0)}return f?1:2}let o=b();function i(s,l,u,c,m,d){if(l.elementCount===0||u.elementCount===0)return 0;let{units:p}=l,h=!1;s.element.structure=l;for(let f=0,g=p.length;f<g;f++){let y=p[f],{elements:x,conformation:S}=y;s.element.unit=y;for(let I=0,v=x.length;I<v;I++){let A=x[I];s.element.element=A;let P=n(s,u,S.position(A,o),d(s),c,m,d);if(P===0)return!1;P===1&&(h=!0)}}return h}a.check=i})(q6||={});var Y6;(i=>{let e=b();function t(a,s,l,u,c,m){let{elements:d,conformation:p}=s,h=e;a.element.unit=s;for(let f=0,g=d.length;f<g;f++){let y=d[f];if(a.element.element=y,Math.max(0,b.distance(l,p.position(y,h))-u-m(a))<=c)return!0}return!1}function r(a,s,l,u,c,m){let{units:d}=s;for(let p=0,h=d.length;p<h;p++)if(t(a,d[p],l,u,c,m))return!0;return!1}let n=b();function o(a,s,l,u,c){if(s.elementCount===0||l.elementCount===0)return 0;let{units:m}=s;a.element.structure=s;for(let d=0,p=m.length;d<p;d++){let h=m[d];a.element.unit=h;let{elements:f,conformation:g}=h;for(let y=0,x=f.length;y<x;y++){let S=f[y];if(a.element.element=S,r(a,l,g.position(S,n),c(a),u,c))return!0}}return!1}i.check=o})(Y6||={});function w7e(e,t){return r=>{let n=e(r),o=ut.LinearBuilder(r.inputStructure);return r.pushCurrentElement(),ut.forEach(n,(i,a)=>{r.currentStructure=i,t(r)&&o.add(i),a%100&&r.throwIfTimedOut()}),r.popCurrentStructure(),o.getSelection()}}function M7e(e){return t=>{let r=e(t),n=ut.LinearBuilder(t.inputStructure);if(r.kind==="singletons"){if(r.structure.elementCount>0){let o=r.structure.units[0],i=De.create([o.getChild(Be.ofSingleton(o.elements[0]))],{parent:t.inputStructure});n.add(i)}}else r.structures.length>0&&n.add(r.structures[0]);return n.getSelection()}}function q_(e,t,r){let{units:n}=e.currentStructure,o=e.pushCurrentElement();o.structure=e.currentStructure;for(let i of n){o.unit=i;let a=i.elements,s=t;if(s){for(let l=0,u=a.length;l<u;l++)o.element=a[l],r.add(s(e));e.throwIfTimedOut()}}return e.popCurrentElement(),r}function B7e(e,t,r){let n=new Set,o=t(e);return e.pushCurrentElement(),ut.forEach(o,(i,a)=>{e.currentStructure=i,q_(e,r,n),a%10&&e.throwIfTimedOut()}),e.popCurrentElement(),n}function E7e(e,t,r){return n=>{let o=e(n),i=B7e(n,t,r),a=ut.LinearBuilder(n.inputStructure);return n.pushCurrentStructure(),ut.forEach(o,(s,l)=>{n.currentStructure=s;let u=q_(n,r,new Set);go.isSuperset(i,u)&&a.add(s),l%10&&n.throwIfTimedOut()}),n.popCurrentStructure(),a.getSelection()}}function k7e(e,t){return r=>{let n=ut.unionStructure(t(r)),o=ut.LinearBuilder(r.inputStructure);return ut.forEach(e(r),(i,a)=>{FI(n,i)&&o.add(i),a%10&&r.throwIfTimedOut()}),o.getSelection()}}function F7e(e){return t=>{let r={queryCtx:t,selection:e.query(t),target:e.target(t),maxRadius:e.maxRadius,minRadius:e.minRadius?Math.max(0,e.minRadius):0,elementRadius:e.elementRadius,invert:!!e.invert};return r.minRadius===0&&typeof e.minRadius>"u"?L7e(r):r.minRadius===0?V7e(r):O7e(r)}}function L7e({queryCtx:e,selection:t,target:r,maxRadius:n,invert:o}){let i=ut.unionStructure(r).lookup3d,a=ut.LinearBuilder(e.inputStructure),s=b.zero();return ut.forEach(t,(l,u)=>{let{units:c}=l,m=!1;for(let d=0,p=c.length;d<p;d++){let h=c[d],{elements:f,conformation:g}=h;for(let y=0,x=f.length;y<x;y++){let S=f[y];if(g.position(S,s),i.check(s[0],s[1],s[2],n+g.r(S))){m=!0;break}}if(m)break}o&&(m=!m),m&&a.add(l),u%10===0&&e.throwIfTimedOut()}),a.getSelection()}function V7e({queryCtx:e,selection:t,target:r,maxRadius:n,invert:o,elementRadius:i}){let a=ut.unionStructure(r),s=ut.LinearBuilder(e.inputStructure);return e.pushCurrentElement(),ut.forEach(t,(l,u)=>{let c=Ide(e,a,l,n,i);o&&(c=!c),c&&s.add(l),u%10===0&&e.throwIfTimedOut()}),e.popCurrentElement(),s.getSelection()}function O7e({queryCtx:e,selection:t,target:r,minRadius:n,maxRadius:o,invert:i,elementRadius:a}){let s=ut.unionStructure(r),l=ut.LinearBuilder(e.inputStructure);return e.pushCurrentElement(),ut.forEach(t,(u,c)=>{let m=vde(e,s,u,n,o,a);i&&(m=!m),m&&l.add(u),c%10===0&&e.throwIfTimedOut()}),e.popCurrentElement(),l.getSelection()}function G7e(e,t){let{queryCtx:r,input:n,target:o,disjunct:i}=e,a=r.atomicBond,s=n.interUnitBonds;a.setStructure(n);for(let l of t.units){if(!ue.isAtomic(l))continue;let u=n.unitMap.get(l.id),{offset:c,b:m,edgeProps:{flags:d,order:p,key:h}}=u.bonds,f=s.getConnectedUnits(l.id),g=f.length,y=l.elements,x=u.elements;for(let S=0,I=y.length;S<I;S++){let v=Be.indexOf(x,y[S]);a.a.unit=u,a.b.unit=u;for(let A=c[v],P=c[v+1];A<P;A++)if(a.b.element=u.elements[m[A]],!(i&&Be.has(l.elements,a.b.element))&&o.hasElement(a.b)&&(a.aIndex=v,a.a.element=y[S],a.bIndex=m[A],a.type=d[A],a.order=p[A],a.key=h[A],a.test(r,!0)))return!0;for(let A=0;A<g;A++){let P=f[A],T=n.unitMap.get(P.unitB),R=T.elements,w=P.getEdges(v);for(let E=0,M=w.length;E<M;E++){let D=w[E];if(a.b.unit=T,a.b.element=R[D.indexB],!!o.hasElement(a.b)&&!(i&&t.hasElement(a.b))&&(a.a.unit=u,a.aIndex=v,a.a.element=y[S],a.bIndex=D.indexB,a.type=D.props.flag,a.order=D.props.order,a.key=D.props.key,a.test(r,!0)))return!0}}}}return!1}function U7e({query:e,target:t,disjunct:r,invert:n,bondTest:o}){return i=>{let a=t(i);if(ut.isEmpty(a))return a;let s=e(i);if(ut.isEmpty(s))return s;let l={queryCtx:i,input:i.inputStructure,disjunct:r,target:ut.unionStructure(a)},u=ut.LinearBuilder(i.inputStructure);return i.pushCurrentBond(),i.atomicBond.setTestFn(o),ut.forEach(s,(c,m)=>{(G7e(l,c)||n)&&u.add(c),m%5===0&&i.throwIfTimedOut()}),i.popCurrentBond(),u.getSelection()}}var J6={};Gi(J6,{intersect:()=>z7e,merge:()=>N7e});function N7e(e){return e.length===0?NE:e.length===1?e[0]:t=>{let r=ut.UniqueBuilder(t.inputStructure);for(let n=0;n<e.length;n++)ut.forEach(e[n](t),(o,i)=>{r.add(o),n%100&&t.throwIfTimedOut()});return r.getSelection()}}function z7e(e){return e.length===0?NE:e.length===1?e[0]:t=>{let r=[];for(let s=0;s<e.length;s++)r.push(e[s](t));let n=0,o=ut.structureCount(r[0]);for(let s=1;s<r.length;s++){let l=ut.structureCount(r[s]);l<o&&(n=s,o=l)}t.throwIfTimedOut();let i=PI(s=>s.hashCode,De.areUnitIdsAndIndicesEqual);ut.forEach(r[n],s=>i.add(s));let a=ut.UniqueBuilder(t.inputStructure);for(let s=0;s<r.length;s++)s!==n&&(ut.forEach(r[s],l=>{i.has(l)&&a.add(l)}),t.throwIfTimedOut());return a.getSelection()}}var $6={};Gi($6,{atomCount:()=>H7e,countQuery:()=>j7e,propertySet:()=>W7e});function H7e(e){return e.currentStructure.elementCount}function j7e(e){return t=>{let r=e(t);return ut.structureCount(r)}}function W7e(e){return t=>q_(t,e,new Set)}var ej;(m=>{function e(d){return!!d&&!!d.has}function t(d,p){return h=>d(h)===p}m.eq=t;function r(d,p){return h=>d(h)<p}m.lt=r;function n(d,p){return h=>d(h)<=p}m.lte=n;function o(d,p){return h=>d(h)>p}m.gt=o;function i(d,p){return h=>d(h)>=p}m.gte=i;function a(d){return!0}function s(d){return!1}function l(d,p){if(e(p))return h=>p.has(d(h));{if(p.length===0)return s;let h=new Set;for(let f=0;f<p.length;f++)h.add(p[f]);return f=>h.has(d(f))}}m.inSet=l;function u(...d){switch(d.length){case 0:return a;case 1:return d[0];case 2:{let p=d[0],h=d[1];return f=>p(f)&&h(f)}case 3:{let p=d[0],h=d[1],f=d[2];return g=>p(g)&&h(g)&&f(g)}case 4:{let p=d[0],h=d[1],f=d[2],g=d[3];return y=>p(y)&&h(y)&&f(y)&&g(y)}case 5:{let p=d[0],h=d[1],f=d[2],g=d[3],y=d[4];return x=>p(x)&&h(x)&&f(x)&&g(x)&&y(x)}case 6:{let p=d[0],h=d[1],f=d[2],g=d[3],y=d[4],x=d[5];return S=>p(S)&&h(S)&&f(S)&&g(S)&&y(S)&&x(S)}default:{let p=d.length;return h=>{for(let f=0;f<p;f++)if(!d[f])return!1;return!0}}}}m.and=u;function c(...d){switch(d.length){case 0:return s;case 1:return d[0];case 2:{let p=d[0],h=d[1];return f=>p(f)||h(f)}case 3:{let p=d[0],h=d[1],f=d[2];return g=>p(g)||h(g)||f(g)}case 4:{let p=d[0],h=d[1],f=d[2],g=d[3];return y=>p(y)||h(y)||f(y)||g(y)}case 5:{let p=d[0],h=d[1],f=d[2],g=d[3],y=d[4];return x=>p(x)||h(x)||f(x)||g(x)||y(x)}case 6:{let p=d[0],h=d[1],f=d[2],g=d[3],y=d[4],x=d[5];return S=>p(S)||h(S)||f(S)||g(S)||y(S)||x(S)}default:{let p=d.length;return h=>{for(let f=0;f<p;f++)if(d[f])return!0;return!1}}}}m.or=c})(ej||={});var Xn={generators:N6,filters:K6,modifiers:Z6,combinators:J6,pred:ej,internal:O6,atomset:$6};var Bm;(u=>{function e(c,m){return Ae.create("Build Assembly",async d=>{let p=c.models;if(p.length!==1)throw new Error("Can only build assemblies from structures based on 1 model.");let h=aC.findAssembly(p[0],m);if(!h)throw new Error(`Assembly '${m}' is not defined.`);let f=Jn.create(h.id,H.identity(),{assembly:{id:h.id,operId:0,operList:[]}}),g=De.Builder({coordinateSystem:f,label:c.label,dynamicBonds:c.dynamicBonds}),y=new zo(c);for(let x of h.operatorGroups){let S=x.selector(y);if(ut.structureCount(S)===0)continue;let{units:I}=ut.unionStructure(S);for(let v of x.operators)for(let A of I)g.addWithOperator(A,v)}return g.getStructure()})}u.buildAssembly=e;function t(c,m,d){return Ae.create("Build Symmetry Assembly",async p=>{let h=c.models;if(h.length!==1)throw new Error("Can only build symmetry assemblies from structures based on 1 model.");let f=b(),g=De.Builder({label:c.label,representativeModel:h[0],dynamicBonds:c.dynamicBonds}),y=new zo(c);for(let x of m){let I=X7e(x.asymIds)(y);if(ut.structureCount(I)===0)continue;let{units:v}=ut.unionStructure(I);for(let{index:A,shift:[P,T,R]}of x.operators){let w=Ade(d,A,P,T,R,f);for(let E of v)for(let M of w)g.addWithOperator(E,M)}}return g.getStructure()})}u.buildSymmetryAssembly=t;function r(c,m){return Ae.create("Find Symmetry Mates",d=>Y7e(d,c,m))}u.builderSymmetryMates=r;function n(c,m,d){return Ae.create("Build Symmetry",p=>q7e(p,c,m,d))}u.buildSymmetryRange=n;function o(c){return Ae.create("Build NCS",m=>Z7e(m,c))}u.buildNcs=o;function i(c,m){return c.invariantId===m.invariantId&&c.model.id===m.model.id&&Be.areEqual(c.elements,m.elements)}u.areUnitsEquivalent=i;function a(){return nce(ue.hashUnit,i)}u.UnitEquivalenceBuilder=a;function s(c){let m=a();for(let p of c.units)m.add(p.id,p);let d=[];for(let p of m.groups)d.push(ue.SymmetryGroup(p.map(h=>c.unitMap.get(h))));return d}u.computeTransformGroups=s;function l(c,m){if(c.length!==m.length)return!1;for(let d=0,p=c.length;d<p;++d){let h=c[d].units,f=m[d].units;if(h.length!==f.length||c[d].hashCode!==m[d].hashCode)return!1;for(let g=0,y=h.length;g<y;g++)if(h[g].conformation!==f[g].conformation)return!1;if(!Be.areEqual(c[d].elements,m[d].elements))return!1}return!0}u.areTransformGroupsEquivalent=l})(Bm||={});function X7e(e){return Xn.generators.atoms({chainTest:Xn.pred.and(Xn.pred.eq(t=>Ke.unit.operator_name(t.element),Jn.DefaultName),Xn.pred.inSet(t=>Ke.chain.label_asym_id(t.element),e))})}function Ade(e,t,r,n,o,i){let{spacegroup:a,ncsOperators:s}=e,l=[],{toFractional:u}=a.cell,c=b.transformMat4(b(),i,u),m=rl.getSymmetryOperatorRef(a,t,r,n,o,c);if(s&&s.length)for(let d=0,p=s.length;d<p;++d){let h=s[d],f=H.mul(H(),m.matrix,h.matrix),g=Jn.create(`${m.name} ${h.name}`,f,{assembly:m.assembly,ncsId:h.ncsId,hkl:m.hkl,spgrOp:m.spgrOp});l.push(g)}else l.push(m);return l}function Tde(e,t,r,n){let{spacegroup:o,ncsOperators:i}=e,a=i&&i.length||0,s=[];!a&&t[0]<=0&&r[0]>=0&&t[1]<=0&&r[1]>=0&&t[2]<=0&&r[2]>=0&&(s[0]=rl.getSymmetryOperator(o,0,0,0,0));for(let l=0;l<o.operators.length;l++)for(let u=t[0];u<=r[0];u++)for(let c=t[1];c<=r[1];c++)for(let m=t[2];m<=r[2];m++)!a&&l===0&&u===0&&c===0&&m===0||s.push(...Ade(e,l,u,c,m,n));return s}function Q7e(e,t){return e._operators_333&&b.equals(t,e._operators_333.ref)||(e._operators_333={ref:b.clone(t),operators:Tde(e,b.create(-3,-3,-3),b.create(3,3,3),t)}),e._operators_333.operators}function Pde(e,t){let r=De.Builder({label:e.label,dynamicBonds:e.dynamicBonds}),{units:n}=e;for(let o of t)for(let i of n)r.addWithOperator(i,o);return r.getStructure()}async function Z7e(e,t){let r=t.models;if(r.length!==1)throw new Error("Can only build NCS from structures based on 1 model.");let n=Qo.Provider.get(r[0]);if(!n)return t;let o=n.ncsOperators;return!o||!o.length?t:Pde(t,o)}async function q7e(e,t,r,n){let o=t.models;if(o.length!==1)throw new Error("Can only build symmetries from structures based on 1 model.");let i=Qo.Provider.get(o[0]);if(!i)return t;let{spacegroup:a}=i;if(ha.isZero(a.cell))return t;let s=Gt.getCenter(o[0]),l=Tde(i,r,n,s);return Pde(t,l)}async function Y7e(e,t,r){let n=t.models;if(n.length!==1)throw new Error("Can only build symmetries from structures based on 1 model.");let o=Qo.Provider.get(n[0]);if(!o)return t;let{spacegroup:i}=o;if(ha.isZero(i.cell))return t;e.shouldUpdate&&await e.update("Initialing...");let a=Gt.getCenter(n[0]),s=Q7e(o,a),l=t.lookup3d,u=new Set;function c(h,f){return`${h.invariantId}|${f.name}`}let m=De.Builder({label:t.label,dynamicBonds:t.dynamicBonds}),{units:d}=t,p=b.zero();for(let h of s){for(let f of d){let g=f.lookup3d.boundary.sphere;b.transformMat4(p,g.center,h.matrix);let y=l.findUnitIndices(p[0],p[1],p[2],g.radius+r);for(let x=0,S=y.count;x<S;x++){if(!d[y.indices[x]].lookup3d.check(p[0],p[1],p[2],g.radius+r))continue;let v=c(f,h);u.has(v)||(m.addWithOperator(f,h),u.add(v))}}e.shouldUpdate&&await e.update("Building symmetry...")}return m.getStructure()}var HE=class{constructor(t,r){this.parent=t;this.isSorted=r;this.ids=[];this.unitMap=Mu.Mutable();this.parentId=-1;this.currentUnit=[];this.elementCount=0}addToUnit(t,r){let n=this.unitMap.get(t);n?n[n.length]=r:(this.unitMap.set(t,[r]),this.ids[this.ids.length]=t),this.elementCount++}beginUnit(t){this.parentId=t,this.currentUnit=this.currentUnit.length>0?[]:this.currentUnit}addElement(t){this.currentUnit[this.currentUnit.length]=t,this.elementCount++}addElementRange(t,r,n){for(let o=r;o<n;o++)this.currentUnit[this.currentUnit.length]=t[o],this.elementCount++}commitUnit(){this.currentUnit.length!==0&&(this.ids[this.ids.length]=this.parentId,this.unitMap.set(this.parentId,this.currentUnit),this.parentId=-1)}setUnit(t,r){this.ids[this.ids.length]=t,this.unitMap.set(t,r),this.elementCount+=r.length}_getStructure(t){if(this.isEmpty)return De.Empty;let r=[];Js(this.ids);let n=Bm.UnitEquivalenceBuilder();for(let o=0,i=this.ids.length;o<i;o++){let a=this.ids[o],s=this.parent.unitMap.get(a),l=this.unitMap.get(a),u=!1;t&&(this.isSorted||Js(l),l=Be.deduplicate(Be.ofSortedArray(this.currentUnit)),u=!0);let c=l.length;if(l.length===s.elements.length){r[r.length]=s,n.add(s.id,s);continue}!this.isSorted&&!u&&c>1&&Js(l);let m=s.getChild(Be.ofSortedArray(l)),d=n.add(m.id,m);m!==d&&(m=d.applyOperator(m.id,m.conformation.operator,!0)),r[r.length]=m}return De.create(r,{parent:this.parent})}getStructure(){return this._getStructure(!1)}getStructureDeduplicate(){return this._getStructure(!0)}setSingletonLocation(t){let r=this.ids[0];t.unit=this.parent.unitMap.get(r),t.element=this.unitMap.get(r)[0]}get isEmpty(){return this.elementCount===0}};function _de(e,t){let r=1;for(;t--;)r*=e--;return r}function K7e(e,t){return t>e?0:_de(e,t)/_de(t,t)}function J7e(e){let t=e&-e,r=e+t,o=((r&-r)/t>>1)-1;return r|o}var tj=class{constructor(t,r){this.array=t;this.hasNext=!1;this.index=(1<<r)-1,this.size=K7e(t.length,r),this.maxIndex=1<<t.length,this.value=new Array(r),this.hasNext=r>0&&r<=t.length}move(){if(this.hasNext){let t=0,r=0,n=this.index;for(;n;n>>>=1,t++)n&1&&(this.value[r++]=this.array[t]);this.index=J7e(this.index),this.hasNext=this.index<this.maxIndex}return this.value}};function rj(e,t){let r=[],n=new tj(e,t);for(;n.hasNext;)r.push(n.move().slice());return r}var US=[],Rde={links:US,terminalLinks:US,elements:US,partialElements:US,getElementIndices:()=>US,getLinkIndices:()=>US,getTerminalLinkIndices:()=>US};var il=Nf("C"),Y_=Nf("O"),$7e=[Td.elementFingerprint([il,il,il,Y_]),Td.elementFingerprint([il,il,il,il,Y_]),Td.elementFingerprint([il,il,il,il,il,Y_]),Td.elementFingerprint([il,il,il,il,il,il,Y_])];function e8e(e,t){let r=-1,n=-1,o=-1,i=-1,{elements:a}=e,{type_symbol:s,label_atom_id:l}=e.model.atomicHierarchy.atoms,{b:u,offset:c}=e.bonds;for(let m=0,d=t.length;m<d;++m){let p=a[t[m]];if(s.value(p)!==il)continue;let h=0,f=0;for(let g=c[t[m]],y=c[t[m]+1];g<y;++g){let x=a[u[g]],S=s.value(x);S===Y_?++h:S===il&&++f}if(h===2){r=p;break}else h===1&&f===1?n=p:l.value(p).startsWith("C1")?o=p:i=p}return r!==-1?r:n!==-1?n:o!==-1?o:i!==-1?i:a[t[0]]}function t8e(e,t){let{elements:r}=e,{label_alt_id:n}=e.model.atomicHierarchy.atoms;return n.value(r[t])}function r8e(e,t,r,n){let o=t.conformation;return b.normalize(e,b.sub(e,n,o.position(r,e))),e}function Dde(e,t){let{elements:r}=e,{label_atom_id:n}=e.model.atomicHierarchy.atoms;return n.value(r[t])}function n8e(e,t){if(!t||!t.length)return;let{unit:r,all:n}=e,o=new Set,i=rj(Xa(new Array(t.length)),2);for(let a=0,s=i.length;a<s;++a){let l=i[a],u=n[t[l[0]]],c=n[t[l[1]]];Be.areIntersecting(u,c)&&Td.getAltId(r,u)===Td.getAltId(r,c)&&(o.add(t[l[0]]),o.add(t[l[1]]))}if(o.size){let a=[];for(let s=0,l=t.length;s<l;++s)o.has(t[s])||a.push(t[s]);return a}else return t}function o8e(e,t){return t.properties.saccharideComponentMap.get(e)}function wde(e){if(e.models.reduce((d,p)=>d+p.properties.saccharideComponentMap.size,0)===0)return Rde;let t=[],r=[],n=[],o=[],i=new Map;function a(d,p,h){return`${d}|${p}|${h}`}function s(d,p){i.has(d)?i.get(d).push(p):i.set(d,[p])}function l(d,p){b.sub(n[d].geometry.direction,n[p].geometry.center,n[d].geometry.center),b.normalize(n[d].geometry.direction,n[d].geometry.direction)}let u=b();function c(d,p,h){let f=h.conformation,g=n[d].geometry;b.sub(g.direction,f.position(h.elements[p],u),g.center),b.normalize(g.direction,g.direction)}for(let d=0,p=e.units.length;d<p;++d){let h=e.units[d];if(!ue.isAtomic(h))continue;let{model:f,rings:g}=h,{chainAtomSegments:y,residueAtomSegments:x,atoms:S}=f.atomicHierarchy,{label_comp_id:I}=S,v=Kt.transientSegments(y,h.elements),A=Kt.transientSegments(x,h.elements),P;for(;v.hasNext;)for(A.setSegment(v.move());A.hasNext;){let{index:T}=A.move(),R=o8e(I.value(x.offsets[T]),f);if(!R)continue;P||(P=iC.byFingerprintAndResidue(g,$7e));let w=n8e(g,P.get(T));if(!w||!w.length){o.push({unit:h,residueIndex:T,component:R});continue}let E=[];for(let D=0,B=w.length;D<B;++D){let k=g.all[w[D]],F=e8e(h,k),z=Bu.calculateMomentsAxes(wE(h,k)),j=Bu.calculateNormalizedAxes(z),Y=b.copy(b(),j.origin),G=b.copy(b(),j.dirC),X=r8e(b(),h,F,Y);b.orthogonalize(X,G,X);let U=Td.getAltId(h,k),L=n.length;E.push(L),s(a(T,h.id,U),L),U&&s(a(T,h.id,""),L),n.push({geometry:{center:Y,normal:G,direction:X},component:R,ringIndex:w[D],altId:U,unit:h,residueIndex:T})}let M=rj(Xa(new Array(w.length)),2);for(let D=0,B=M.length;D<B;++D){let k=M[D],F=g.all[w[k[0]]],z=g.all[w[k[1]]];if(xs.areVertexSetsConnected(h.bonds,F,z,3)){let j=E[k[0]],Y=E[k[1]];n[j].altId===n[Y].altId&&(l(j,Y),l(Y,j),t.push({carbohydrateIndexA:j,carbohydrateIndexB:Y}),t.push({carbohydrateIndexA:Y,carbohydrateIndexB:j}))}}}}function m(d,p){return i.get(a(d.getResidueIndex(p),d.id,t8e(d,p)))||[]}for(let d=0,p=n.length;d<p;++d){let h=n[d],{unit:f}=h;for(let g=d+1;g<p;++g){let y=n[g];if(f!==y.unit||h.residueIndex===y.residueIndex)continue;let x=f.rings.all[h.ringIndex],S=f.rings.all[y.ringIndex];xs.areVertexSetsConnected(f.bonds,x,S,3)&&(l(d,g),l(g,d),t.push({carbohydrateIndexA:d,carbohydrateIndexB:g}),t.push({carbohydrateIndexA:g,carbohydrateIndexB:d}))}}for(let d=0,p=e.units.length;d<p;++d){let h=e.units[d];ue.isAtomic(h)&&e.interUnitBonds.getConnectedUnits(h.id).forEach(f=>{f.connectedIndices.forEach(g=>{f.getEdges(g).forEach(({props:y,indexB:x})=>{if(!xt.isCovalent(y.flag))return;let S=e.unitMap.get(f.unitA),I=e.unitMap.get(f.unitB),v=m(S,g),A=m(I,x);if(v.length>0&&A.length>0){let P=v.length,T=A.length;for(let R=0,w=Math.max(P,T);R<w;++R){let E=v[Math.min(R,P-1)],M=A[Math.min(R,T-1)],D=Dde(S,g);(D.startsWith("O1")||D.startsWith("C1"))&&l(E,M),t.push({carbohydrateIndexA:E,carbohydrateIndexB:M})}}else if(A.length===0)for(let P of v){let T=Dde(S,g);(T.startsWith("O1")||T.startsWith("C1"))&&c(P,x,I),r.push({carbohydrateIndex:P,elementIndex:x,elementUnit:I,fromCarbohydrate:!0})}else if(v.length===0)for(let P of A)r.push({carbohydrateIndex:P,elementIndex:g,elementUnit:S,fromCarbohydrate:!1})})})})}return{links:t,terminalLinks:r,elements:n,partialElements:o,...i8e(n,t,r)}}function i8e(e,t,r){function n(m,d){return ca(m.id,d)}function o(m,d,p){let h=[],f=m.get(n(d,p));if(f!==void 0)for(let g of f)li(h,g);return h}let i=new Map;for(let m=0,d=e.length;m<d;++m){let{unit:p,ringIndex:h}=e[m],f=p.rings.all[h];for(let g=0,y=f.length;g<y;++g){let x=n(p,p.elements[f[g]]),S=i.get(x);S===void 0?i.set(x,[m]):S.push(m)}}function a(m,d){return o(i,m,d)}let s=new Map;for(let m=0,d=t.length;m<d;++m){let p=t[m],{unit:h,ringIndex:f}=e[p.carbohydrateIndexA],g=h.rings.all[f];for(let y=0,x=g.length;y<x;++y){let S=n(h,h.elements[g[y]]),I=s.get(S);I===void 0?s.set(S,[m]):I.push(m)}}function l(m,d){return o(s,m,d)}let u=new Map;for(let m=0,d=r.length;m<d;++m){let{fromCarbohydrate:p,carbohydrateIndex:h,elementUnit:f,elementIndex:g}=r[m];if(p){let{unit:y,ringIndex:x}=e[h],S=y.rings.all[x];for(let I=0,v=S.length;I<v;++I){let A=n(y,y.elements[S[I]]),P=u.get(A);P===void 0?u.set(A,[m]):P.push(m)}}else{let y=n(f,f.elements[g]),x=u.get(y);x===void 0?u.set(y,[m]):x.push(m)}}function c(m,d){return o(u,m,d)}return{getElementIndices:a,getLinkIndices:l,getTerminalLinkIndices:c}}var jE=he(),a8e=new Fi("14"),s8e=new Fi("98");function l8e(e){return e>500?a8e:s8e}function Mde(e){let{units:t}=e,r=l8e(t.length);r.reset();for(let n=0,o=t.length;n<o;n++){let i=t[n],a=i.boundary,s=i.conformation.operator;s.isIdentity?r.includeSphere(a.sphere):(he.transform(jE,a.sphere,s.matrix),r.includeSphere(jE))}r.finishedIncludeStep();for(let n=0,o=t.length;n<o;n++){let i=t[n],a=i.boundary,s=i.conformation.operator;s.isIdentity?r.radiusSphere(a.sphere):(he.transform(jE,a.sphere,s.matrix),r.radiusSphere(jE))}return{box:r.getBox(),sphere:r.getSphere()}}function Bde(e){let{units:t,elementCount:r,unitIndexMap:n}=e,o=new Uint32Array(t.length),i=new Uint32Array(r),a=new Uint32Array(r);for(let s=0,l=0,u=t.length;s<u;++s){o[s]=l;let{elements:c}=t[s];for(let m=0,d=c.length;m<d;++m){let p=l+m;i[p]=s,a[p]=c[m]}l+=c.length}return{cumulativeUnitElementCount:o,unitIndices:i,elementIndices:a,getSerialIndex:(s,l)=>o[n.get(s.id)]+xe.indexOf(s.elements,l)}}function Ede(e){let t=0,r=[];for(let l of e.unitSymmetryGroups){r.push(t);let u=l.units[0];ue.isAtomic(u)&&(t+=u.bonds.edgeCount*2*l.units.length)}let n=new Uint32Array(t),o=new Uint32Array(t),i=new Uint32Array(t),a=0,s=0;for(let l of e.unitSymmetryGroups){let u=l.units[0];if(ue.isAtomic(u)){let c=u.bonds.edgeCount*2;for(let m=0,d=l.units.length;m<d;++m)for(let p=0,h=c;p<h;++p)n[a]=s,o[a]=p,i[a]=m,a+=1}s+=1}return{bondCount:t,unitIndex:n,unitEdgeIndex:o,unitGroupIndex:i,unitGroupOffset:r}}var De=class e{constructor(t,r,n,o,i){this.units=t;this.unitMap=r;this.unitIndexMap=n;this.state=o;this._child=i?.child,this._target=i?.target,this._proxy=void 0}subsetBuilder(t){return new HE(this,t)}get elementCount(){return this.state.elementCount}get bondCount(){return this.state.bondCount===-1&&(this.state.bondCount=this.interUnitBonds.edgeCount/2+It.getIntraUnitBondCount(this)),this.state.bondCount}get hasCustomProperties(){return!!this.state.customProps&&this.state.customProps.all.length>0}get customPropertyDescriptors(){return this.state.customProps||(this.state.customProps=new $a),this.state.customProps}get currentPropertyData(){return this.state.propertyData||(this.state.propertyData=Object.create(null)),this.state.propertyData}get inheritedPropertyData(){return this.parent?this.parent.currentPropertyData:this.currentPropertyData}get polymerResidueCount(){return this.state.polymerResidueCount===-1&&(this.state.polymerResidueCount=g8e(this)),this.state.polymerResidueCount}get polymerGapCount(){return this.state.polymerGapCount===-1&&(this.state.polymerGapCount=y8e(this)),this.state.polymerGapCount}get polymerUnitCount(){return this.state.polymerUnitCount===-1&&(this.state.polymerUnitCount=b8e(this)),this.state.polymerUnitCount}get uniqueElementCount(){return this.state.uniqueElementCount===-1&&(this.state.uniqueElementCount=h8e(this)),this.state.uniqueElementCount}get atomicResidueCount(){return this.state.atomicResidueCount===-1&&(this.state.atomicResidueCount=x8e(this)),this.state.atomicResidueCount}get isCoarseGrained(){return this.models.some(t=>Gt.isCoarseGrained(t))}get isEmpty(){return this.units.length===0}get hashCode(){return this.state.hashCode!==-1?this.state.hashCode:this.computeHash()}get transformHash(){return this.state.transformHash!==-1?this.state.transformHash:(this.state.transformHash=ui(this.units.map(t=>t.id)),this.state.transformHash)}computeHash(){let t=23;for(let r=0,n=this.units.length;r<n;r++){let o=this.units[r];t=31*t+o.id|0,t=31*t+Be.hashCode(o.elements)|0}return t=31*t+this.elementCount|0,t=dM(t),t===-1&&(t=0),this.state.hashCode=t,t}elementLocations(){return new e.ElementLocationIterator(this)}get root(){return this.state.parent??this}get parent(){return this.state.parent}get coordinateSystem(){return this.state.coordinateSystem}get label(){return this.state.label}get boundary(){return this.state.boundary?this.state.boundary:(this.state.boundary=Mde(this),this.state.boundary)}get lookup3d(){return this.state.lookup3d?this.state.lookup3d:(this.state.lookup3d=new FE(this),this.state.lookup3d)}get interUnitBonds(){return this.state.interUnitBonds?this.state.interUnitBonds:(this.parent&&this.state.dynamicBonds===this.parent.state.dynamicBonds&&this.parent.state.interUnitBonds&&this.parent.state.interUnitBonds.edgeCount===0?this.state.interUnitBonds=new og(new Map):this.state.interUnitBonds=Sme(this,{ignoreWater:!this.dynamicBonds,ignoreIon:!this.dynamicBonds,validUnit:this.state.interBondsValidUnit,validUnitPair:this.state.interBondsValidUnitPair}),this.state.interUnitBonds)}get dynamicBonds(){return this.state.dynamicBonds}get interBondsValidUnit(){return this.state.interBondsValidUnit}get interBondsValidUnitPair(){return this.state.interBondsValidUnitPair}get unitSymmetryGroups(){return this.state.unitSymmetryGroups?this.state.unitSymmetryGroups:(this.state.unitSymmetryGroups=Bm.computeTransformGroups(this),this.state.unitSymmetryGroups)}get unitSymmetryGroupsIndexMap(){return this.state.unitSymmetryGroupsIndexMap?this.state.unitSymmetryGroupsIndexMap:(this.state.unitSymmetryGroupsIndexMap=ue.SymmetryGroup.getUnitSymmetryGroupsIndexMap(this.unitSymmetryGroups),this.state.unitSymmetryGroupsIndexMap)}get carbohydrates(){return this.state.carbohydrates?this.state.carbohydrates:(this.state.carbohydrates=wde(this),this.state.carbohydrates)}get models(){return this.state.models?this.state.models:(this.state.models=c8e(this),this.state.models)}get uniqueResidueNames(){return this.state.uniqueResidueNames||(this.state.uniqueResidueNames=m8e(this))}get uniqueElementSymbols(){return this.state.uniqueElementSymbols||(this.state.uniqueElementSymbols=d8e(this))}get entityIndices(){return this.state.entityIndices||(this.state.entityIndices=p8e(this))}get uniqueAtomicResidueIndices(){return this.state.uniqueAtomicResidueIndices||(this.state.uniqueAtomicResidueIndices=f8e(this))}get isAtomic(){for(let t of this.units)if(!ue.isAtomic(t))return!1;return!0}get hasAtomic(){for(let t of this.units)if(ue.isAtomic(t))return!0;return!1}get isCoarse(){for(let t of this.units)if(!ue.isCoarse(t))return!1;return!0}get hasCoarse(){for(let t of this.units)if(ue.isCoarse(t))return!0;return!1}get serialMapping(){return this.state.serialMapping||(this.state.serialMapping=Bde(this))}get intraUnitBondMapping(){return this.state.intraUnitBondMapping||(this.state.intraUnitBondMapping=Ede(this))}get model(){if(this.state.model)return this.state.model;if(this.state.representativeModel)return this.state.representativeModel;if(this.state.masterModel)return this.state.masterModel;let t=this.models;if(t.length>1)throw new Error("The structure is based on multiple models and has neither a master- nor a representative-model.");return this.state.model=t[0],this.state.model}get masterModel(){return this.state.masterModel}get representativeModel(){return this.state.representativeModel}hasElement(t){return this.unitMap.has(t.unit.id)?Be.has(this.unitMap.get(t.unit.id).elements,t.element):!1}getModelIndex(t){return this.models.indexOf(t)}remapModel(t){let{dynamicBonds:r,interUnitBonds:n,parent:o}=this.state,i=[];for(let a of this.unitSymmetryGroups){let s=a.units[0].remapModel(t,r);i.push(s);for(let l=1,u=a.units.length;l<u;++l){let c=a.units[l];i.push(c.remapModel(t,r,s.props))}}return e.create(i,{parent:o?.remapModel(t),label:this.label,interUnitBonds:r?void 0:n,dynamicBonds:r,interBondsValidUnit:this.state.interBondsValidUnit,interBondsValidUnitPair:this.state.interBondsValidUnitPair,coordinateSystem:this.state.coordinateSystem,masterModel:this.state.masterModel,representativeModel:this.state.representativeModel})}asParent(){if(this._proxy)return this._proxy;if(this.parent){let t=this.parent.coordinateSystem.isIdentity?this.parent:e.transform(this.parent,this.parent.coordinateSystem.inverse),r=this.coordinateSystem.isIdentity?t:e.transform(t,this.coordinateSystem.matrix);this._proxy=new e(r.units,r.unitMap,r.unitIndexMap,{...r.state,dynamicBonds:this.dynamicBonds},{child:this,target:this.parent})}else this._proxy=this;return this._proxy}get child(){return this._child}get target(){return this._target??this}};function u8e(e,t,r){return e[t].id-e[r].id}function c8e(e){let{units:t}=e,r=Un.create();for(let n of t)Un.add(r,n.model.id,n.model);return r.array}function m8e(e){let{microheterogeneityCompIds:t}=Ke.residue,r=new Set,n=Q.Location.create(e);for(let o of e.unitSymmetryGroups){let i=o.units[0];if(!ue.isAtomic(i))continue;let a=Kt.transientSegments(i.model.atomicHierarchy.residueAtomSegments,i.elements);for(n.unit=i;a.hasNext;){let s=a.move();n.element=i.elements[s.start];let l=t(n);for(let u of l)r.add(u)}}return r}function d8e(e){let t=Ke.atom.type_symbol,r=new Set,n=Q.Location.create(e);for(let o of e.unitSymmetryGroups){let i=o.units[0];if(ue.isAtomic(i)){n.unit=i;for(let a=0,s=i.elements.length;a<s;++a)n.element=i.elements[a],r.add(t(n))}}return r}function p8e(e){let{units:t}=e,r=Q.Location.create(e),n=Un.create();for(let o of t){let i=o.kind===ue.Kind.Atomic?Ke.entity.key:Ke.coarse.entityKey;r.unit=o;let a=o.elements,s=Kt.transientSegments(o.model.atomicHierarchy.chainAtomSegments,a);for(;s.hasNext;){let l=s.move();r.element=a[l.start];let u=i(r);Un.add(n,u,u)}}return Js(n.array),n.array}function f8e(e){let t=new Map,r=[],n=e.unitSymmetryGroups;for(let i of n){let a=i.units[0];if(!ue.isAtomic(a))continue;let s;t.has(a.model.id)?s=t.get(a.model.id):(s=Un.create(),r.push(a.model.id),t.set(a.model.id,s));let l=Kt.transientSegments(a.model.atomicHierarchy.residueAtomSegments,a.elements);for(;l.hasNext;){let u=l.move();Un.add(s,u.index,u.index)}}let o=new Map;for(let i of r){let a=t.get(i).array;Js(a),o.set(i,a)}return o}function h8e(e){let{unitSymmetryGroups:t}=e,r=0;for(let n=0,o=t.length;n<o;n++)r+=t[n].elements.length;return r}function g8e(e){let{units:t}=e,r=0;for(let n=0,o=t.length;n<o;n++)r+=t[n].polymerElements.length;return r}function y8e(e){let{units:t}=e,r=0;for(let n=0,o=t.length;n<o;n++)r+=t[n].gapElements.length/2;return r}function b8e(e){let{units:t}=e,r=0;for(let n=0,o=t.length;n<o;n++)t[n].polymerElements.length>0&&(r+=1);return r}function x8e(e){let{units:t}=e,r=0;for(let n=0,o=t.length;n<o;n++){let i=t[n];if(!ue.isAtomic(i))continue;let{elements:a,residueIndex:s}=i,l=-1,u=-1;for(let c=0,m=a.length;c<m;++c)l=s[a[c]],l!==u&&(r+=1,u=l)}return r}(fe=>{fe.Empty=l([]);function t(O){return{kind:"structure-loci",structure:O}}fe.Loci=t;function r(O){let V=[];for(let Z of O.units)V.push({unit:Z,indices:ye.ofBounds(0,Z.elements.length)});return Q.Loci(O,V)}fe.toStructureElementLoci=r;function n(O,V){return ut.toLociWithSourceUnits(ut.Singletons(O,V))}fe.toSubStructureElementLoci=n;function o(O){return!!O&&O.kind==="structure-loci"}fe.isLoci=o;function i(O,V){return O.structure===V.structure}fe.areLociEqual=i;function a(O){return O.structure.isEmpty}fe.isLociEmpty=a;function s(O,V){return V===O.structure?O:t(V)}fe.remapLoci=s;function l(O,V={}){let Z=Mu.Mutable(),pe=Mu.Mutable(),$=0,ae=!0,Se=O.length>0?O[0].id:0;for(let K=0,re=O.length;K<re;K++){let le=O[K];Z.set(le.id,le),$+=le.elements.length,le.id<Se&&(ae=!1),Se=le.id}ae||hM(O,0,O.length,u8e,ky);for(let K=0,re=O.length;K<re;K++)pe.set(O[K].id,K);let ve={hashCode:-1,transformHash:-1,elementCount:$,bondCount:-1,uniqueElementCount:-1,atomicResidueCount:-1,polymerResidueCount:-1,polymerGapCount:-1,polymerUnitCount:-1,dynamicBonds:!1,coordinateSystem:Jn.Default,label:""};return V.parent&&(ve.parent=V.parent.parent||V.parent),V.interUnitBonds&&(ve.interUnitBonds=V.interUnitBonds),V.interBondsValidUnit?ve.interBondsValidUnit=V.interBondsValidUnit:V.parent&&(ve.interBondsValidUnit=V.parent.interBondsValidUnit),V.interBondsValidUnitPair?ve.interBondsValidUnitPair=V.interBondsValidUnitPair:V.parent&&(ve.interBondsValidUnitPair=V.parent.interBondsValidUnitPair),V.dynamicBonds?ve.dynamicBonds=V.dynamicBonds:V.parent&&(ve.dynamicBonds=V.parent.dynamicBonds),V.coordinateSystem?ve.coordinateSystem=V.coordinateSystem:V.parent&&(ve.coordinateSystem=V.parent.coordinateSystem),V.label?ve.label=V.label:V.parent&&(ve.label=V.parent.label),V.masterModel?ve.masterModel=V.masterModel:V.parent&&(ve.masterModel=V.parent.masterModel),V.representativeModel?ve.representativeModel=V.representativeModel:V.parent&&(ve.representativeModel=V.parent.representativeModel),new fe(O,Z,pe,ve)}fe.create=l;async function u(O,V){if(O.frameCount===0)return fe.Empty;let Z=[],pe,$=0;for(let ae=0,Se=O.frameCount;ae<Se;++ae){let ve=await Ae.resolveInContext(O.getFrameAtIndex(ae),V);pe||(pe=ve);let K=c(ve);for(let re=0,le=K.units.length;re<le;++re){let ge=K.units[re],Ee=ge.invariantId+$,nt=ge.chainGroupId+$,at=ue.create(Z.length,Ee,nt,ge.traits,ge.kind,ge.model,ge.conformation.operator,ge.elements);Z.push(at)}$=Z.length}return l(Z,{representativeModel:pe,label:pe.label})}fe.ofTrajectory=u;function c(O,V={}){let Z=O.atomicHierarchy.chainAtomSegments,{index:pe}=O.atomicHierarchy,{auth_asym_id:$}=O.atomicHierarchy.chains,{atomicChainOperatorMappinng:ae}=O,Se=new f({label:O.label,...V});for(let K=0;K<Z.count;K++){let re=ae.get(K)||Jn.Default,le=Z.offsets[K],ge=!1,Ee=!1;if(m(O,K))for(Ee=!0;K+1<Z.count&&m(O,K+1);){let be=ae.get(K),Re=ae.get(K+1);if(be!==Re)break;ge=!0,K++}else for(;K+1<Z.count&&Z.offsets[K+1]-Z.offsets[K]===1&&Z.offsets[K+2]-Z.offsets[K+1]===1;){let be=pe.getEntityFromChain(K),Re=pe.getEntityFromChain(K+1);if(be!==Re)break;let Fe=$.value(K),Ne=$.value(K+1);if(Fe!==Ne)break;let ot=ae.get(K),it=ae.get(K+1);if(ot!==it)break;ge=!0,K++}let nt=Be.ofBounds(le,Z.offsets[K+1]),at=ue.Trait.None;ge&&(at|=ue.Trait.MultiChain),Ee&&(at|=ue.Trait.Water),Gt.isCoarseGrained(O)&&(at|=ue.Trait.CoarseGrained),Se.addUnit(ue.Kind.Atomic,O,re,nt,at)}let ve=O.coarseHierarchy;return ve.isDefined&&(ve.spheres.count>0&&d(Se,O,O.coarseHierarchy.spheres,ue.Kind.Spheres),ve.gaussians.count>0&&d(Se,O,O.coarseHierarchy.gaussians,ue.Kind.Gaussians)),Se.getStructure()}fe.ofModel=c;function m(O,V){let Z=O.atomicHierarchy.index.getEntityFromChain(V);return O.entities.data.type.value(Z)==="water"}function d(O,V,Z,pe){let{chainElementSegments:$}=Z;for(let ae=0;ae<$.count;ae++){let Se=Be.ofBounds($.offsets[ae],$.offsets[ae+1]);O.addUnit(pe,V,Jn.Default,Se,ue.Trait.None)}}function p(O,V){if(H.isIdentity(V))return O;if(!H.isRotationAndTranslation(V,Jn.RotationTranslationEpsilon))throw new Error("Only rotation/translation combination can be applied.");let Z=[];for(let ae of O.units){let Se=ae.conformation.operator,ve=Jn.create(Se.name,V,Se);Z.push(ae.applyOperator(ae.id,ve))}let pe=O.coordinateSystem,$=Jn.compose(Jn.create(pe.name,V,pe),pe);return l(Z,{parent:O,coordinateSystem:$})}fe.transform=p;function h(O,V){for(let $ of V)if(!H.isRotationAndTranslation($,Jn.RotationTranslationEpsilon))throw new Error("Only rotation/translation combination can be applied.");let Z=[],pe=0;for(let $ of O.units){let ae=$.conformation.operator;for(let Se of V){if(H.isIdentity(Se)){Z.push($);continue}let ve=Jn.create(ae.name,Se,ae);Z.push($.applyOperator(pe++,ve))}}return l(Z,{parent:O})}fe.instances=h;class f{constructor(V={}){this.props=V;this.units=[];this.invariantId=gi();this.chainGroupId=-1;this.inChainGroup=!1;this.p=b();this.singleElementUnits=new Map}beginChainGroup(){this.chainGroupId++,this.inChainGroup=!0}endChainGroup(){this.inChainGroup=!1}addUnit(V,Z,pe,$,ae,Se){Se===void 0&&(Se=this.invariantId());let ve=this.inChainGroup?this.chainGroupId:++this.chainGroupId,K=ue.create(this.units.length,Se,ve,ae,V,Z,pe,$);return this.add(K)}copyUnit(V,Z){let pe=Z?.invariantId;pe===void 0&&(pe=this.invariantId());let $=this.inChainGroup?this.chainGroupId:++this.chainGroupId,ae=V.getCopy(this.units.length,pe,$,Z);return this.add(ae)}add(V){if(V.elements.length===1){V.conformation.position(V.elements[0],this.p);let Z=[V.invariantId,this.p[0],this.p[1],this.p[2]].join("|");if(this.singleElementUnits.has(Z))return this.singleElementUnits.get(Z);this.singleElementUnits.set(Z,V)}return this.units.push(V),V}addWithOperator(V,Z,pe=!1){return this.add(V.applyOperator(this.units.length,Z,pe))}getStructure(){return l(this.units,this.props)}get isEmpty(){return this.units.length===0}}fe.StructureBuilder=f;function g(O={}){return new f(O)}fe.Builder=g;function y(O){return O.hashCode}fe.hashCode=y;function x(O){return q0(O.units.map(V=>ue.conformationId(V)).join("|"))}fe.conformationHash=x;function S(O,V){if(O===V)return!0;if(O.elementCount!==V.elementCount)return!1;let Z=O.units.length;if(Z!==V.units.length)return!1;for(let pe=0;pe<Z;pe++)if(O.units[pe].id!==V.units[pe].id)return!1;return!0}fe.areUnitIdsEqual=S;function I(O,V){if(O===V)return!0;if(!S(O,V))return!1;for(let Z=0,pe=O.units.length;Z<pe;Z++)if(!Be.areEqual(O.units[Z].elements,V.units[Z].elements))return!1;return!0}fe.areUnitIdsAndIndicesEqual=I;function v(O,V){if(O.hashCode!==V.hashCode)return!1;let Z=O.models.length;if(Z!==V.models.length)return!1;for(let pe=0;pe<Z;pe++)if(!Gt.areHierarchiesEqual(O.models[pe],V.models[pe]))return!1;return!0}fe.areHierarchiesEqual=v;function A(O,V){return O===V||O.hashCode===V.hashCode&&Bm.areTransformGroupsEquivalent(O.unitSymmetryGroups,V.unitSymmetryGroups)}fe.areEquivalent=A;function P(O,V){return A(O.root,V.root)}fe.areRootsEquivalent=P;function T(O,V){return O.root===V.root}fe.areRootsEqual=T;class R{constructor(V){this.structure=V;this.unitIndex=0;this.maxIdx=0;this.idx=-1;this.current=Q.Location.create(V),this.hasNext=V.elementCount>0,this.hasNext&&(this.elements=V.units[0].elements,this.maxIdx=this.elements.length-1,this.current.unit=V.units[0])}move(){return this.advance(),this.current.element=this.elements[this.idx],this.current}advance(){if(this.idx<this.maxIdx){this.idx++,this.idx===this.maxIdx&&(this.hasNext=this.unitIndex+1<this.structure.units.length);return}if(this.idx=0,this.unitIndex++,this.unitIndex>=this.structure.units.length){this.hasNext=!1;return}this.current.unit=this.structure.units[this.unitIndex],this.elements=this.current.unit.elements,this.maxIdx=this.elements.length-1,this.maxIdx===0&&(this.hasNext=this.unitIndex+1<this.structure.units.length)}}fe.ElementLocationIterator=R;let w=b();function E(O,V,Z){let{elements:pe,conformation:$}=O,ae=w,Se=Number.MAX_VALUE;for(let ve=0,K=pe.length;ve<K;ve++){let re=pe[ve],le=b.distance(V,$.position(re,ae))-Z-$.r(re);le<Se&&(Se=le)}return Se}function M(O,V,Z){let{units:pe}=O,$=Number.MAX_VALUE;for(let ae=0,Se=pe.length;ae<Se;ae++){let ve=pe[ae],K=E(ve,V,Z);K<$&&($=K)}return $}fe.minDistanceToPoint=M;let D=b();function B(O,V){if(O.elementCount===0||V.elementCount===0)return 0;let{units:Z}=O,pe=Number.MAX_VALUE;for(let $=0,ae=Z.length;$<ae;$++){let Se=Z[$],{elements:ve,conformation:K}=Se;for(let re=0,le=ve.length;re<le;re++){let ge=ve[re],Ee=M(V,K.position(ge,D),K.r(ge));Ee<pe&&(pe=Ee)}}return pe}fe.distance=B;function k(O){return O.elementCount===1?"1 element":`${O.elementCount} elements`}fe.elementDescription=k;function F(O,V,Z){return O.masterModel?V.model===Z.model||V.model===O.masterModel||Z.model===O.masterModel:V.model===Z.model}fe.validUnitPair=F;function z(O,V,Z){let{maxRadius:pe,validUnit:$,validUnitPair:ae}=Z;if(!O.units.some(K=>$(K)))return;let Se=O.lookup3d,ve=b();for(let K of O.units){if(!$(K))continue;let re=K.boundary.sphere;b.transformMat4(ve,re.center,K.conformation.operator.matrix);let le=Se.findUnitIndices(ve[0],ve[1],ve[2],re.radius+pe);for(let ge=0;ge<le.count;ge++){let Ee=O.units[le.indices[ge]];K.id>=Ee.id||!$(Ee)||!ae(K,Ee)||(Ee.elements.length>=K.elements.length?V(K,Ee):V(Ee,K))}}}fe.eachUnitPair=z;function j(O,{chain:V,residue:Z,atom:pe}){let $=Q.Location.create(O);for(let ae of O.units){if(ae.kind!==ue.Kind.Atomic)continue;$.unit=ae;let{elements:Se}=ae,ve=Kt.transientSegments(ae.model.atomicHierarchy.chainAtomSegments,Se),K=Kt.transientSegments(ae.model.atomicHierarchy.residueAtomSegments,Se);for(;ve.hasNext;){let re=ve.move();if(V&&($.element=Se[re.start],V($)),!(!Z&&!pe))for(K.setSegment(re);K.hasNext;){let le=K.move();if(Z&&($.element=Se[le.start],Z($)),!!pe)for(let ge=le.start,Ee=le.end;ge<Ee;ge++)$.element=Se[ge],pe($)}}}}fe.eachAtomicHierarchyElement=j,fe.DefaultSizeThresholds={smallResidueCount:10,mediumResidueCount:5e3,largeResidueCount:3e4,highSymmetryUnitCount:10,fiberResidueCount:15};function G(O){return O.unitSymmetryGroups.filter(V=>V.units[0].polymerElements.length>0)}function X(O,V){let Z=G(O);return Z.length===1&&Z[0].units.length>2&&Z[0].units[0].polymerElements.length<V.fiberResidueCount}function U(O,V){let Z=G(O);return Z.length>=1&&Z[0].units.length>V.highSymmetryUnitCount}let L;(ae=>(ae[ae.Small=0]="Small",ae[ae.Medium=1]="Medium",ae[ae.Large=2]="Large",ae[ae.Huge=3]="Huge",ae[ae.Gigantic=4]="Gigantic"))(L=fe.Size||={});function q(O,V={},Z=1){let pe={...fe.DefaultSizeThresholds,...V};return O.polymerResidueCount>=pe.largeResidueCount*Z?U(O,pe)?3:4:X(O,pe)||O.polymerResidueCount<pe.smallResidueCount*Z?0:O.polymerResidueCount<pe.mediumResidueCount*Z?1:2}fe.getSize=q,fe.Index=Zl.createSimple("index","root"),fe.MaxIndex=Zl.createSimple("max_index","root");let ee="__PrincipalAxes__";function ce(O){if(O.currentPropertyData[ee])return O.currentPropertyData[ee];let V=Q.Loci.getPrincipalAxes(fe.toStructureElementLoci(O));return O.currentPropertyData[ee]=V,V}fe.getPrincipalAxes=ce})(De||={});var nj=class{constructor(){this.map=new Map}removeSymbol(t){this.map.delete(t.symbol.id)}addSymbol(t){this.map.has(t.symbol.id)&&console.warn(`Symbol '${t.symbol.id}' already added. Call removeSymbol/removeCustomProps re-adding the symbol.`),this.map.set(t.symbol.id,t)}addCustomProp(t){if(t.symbols)for(let r of Object.keys(t.symbols))this.addSymbol(t.symbols[r])}removeCustomProp(t){if(t.symbols)for(let r of Object.keys(t.symbols))this.removeSymbol(t.symbols[r])}getRuntime(t){return this.map.get(t)}},zI=new nj,oj=class{constructor(t){this.table=t;this.constQueryContext=new zo(De.Empty)}},C8e;(r=>{function e(n){return{kind:"const",value:n}}r.Const=e;function t(n){return{kind:"dynamic",runtime:n}}r.Dynamic=t})(C8e||={});var NI;(r=>{function e(n){return{isConst:!0,fn:function(i){return n}}}r.Const=e;function t(n){return{isConst:!1,fn:n}}r.Dynamic=t})(NI||={});var K_;(t=>{function e(r,n,o,i){if(typeof r.length=="number")for(let a=0,s=r.length;a<s;a++)o(r[a](n),a,i);else{let a=0;for(let s of Object.keys(r))o(r[s](n),a++,i)}return i}t.forEachEval=e})(K_||={});var NS;(r=>{function e(n,o){return new WE(n,o,!0)}r.Const=e;function t(n,o){return new WE(n,o,!1)}r.Dynamic=t})(NS||={});var WE=class{constructor(t,r,n){this.symbol=t;this.fn=r;this.isConst=n}compile(t,r){let n,o=!1;if(!r)n=void 0,o=!0;else if(ts.isArgumentsArray(r)){n=[],o=!0;for(let i of r){let a=ij(t,i);o=o&&a.isConst,n.push(a.fn)}}else{n=Object.create(null),o=!0;for(let i of Object.keys(r)){let a=ij(t,r[i]);o=o&&a.isConst,n[i]=a.fn}}return this.isConst?this.isConst&&o?NI.Const(this.fn(t.constQueryContext,n)):NI.Dynamic(kde(this.fn,n)):NI.Dynamic(kde(this.fn,n))}};function kde(e,t){return function(n){return e(n,t)}}function ij(e,t){if(ts.isLiteral(t))return NI.Const(t);if(ts.isSymbol(t)){let n=e.table.getRuntime(t.name);return n?n.compile(e):NI.Const(t.name)}if(!ts.isSymbol(t.head))throw new Error("Can only apply symbols.");let r=e.table.getRuntime(t.head.name);if(!r)throw new Error(`Symbol '${t.head.name}' is not implemented.`);return r.compile(e,t.args)}function Wc(e){let t=new oj(zI);return ij(t,e).fn}var S8e=Aa.diff;function yp(e,t){return{kind:"element-loci",structure:e,elements:t}}(O=>{function e(V){return!!V&&V.kind==="element-loci"}O.is=e;function t(V,Z){if(V.structure!==Z.structure||V.elements.length!==Z.elements.length)return!1;for(let pe=0,$=V.elements.length;pe<$;++pe){let ae=V.elements[pe],Se=Z.elements[pe];if(ae.unit.id!==Se.unit.id||!xe.areEqual(ae.indices,Se.indices))return!1}return!0}O.areEqual=t;function r(V){for(let Z of V.elements)if(xe.size(Z.indices)>0)return!1;return!0}O.isEmpty=r;function n(V){return o(V)===V.structure.elementCount}O.isWholeStructure=n;function o(V){let Z=0;for(let{indices:pe}of V.elements)typeof pe=="number"?Z+=S8e(pe):Z+=pe.length;return Z}O.size=o;function i(V){return O(V,V.units.map(Z=>({unit:Z,indices:xe.ofBounds(0,Z.elements.length)})))}O.all=i;function a(V){return O(V,[])}O.none=a;function s(V,Z,pe){let $;typeof Z=="function"?$=Z(ie):$=Z;let ae=Wc($)(pe??new zo(V));return ut.toLociWithSourceUnits(ae)}O.fromExpression=s;function l(V,Z,pe){let $=Z(pe??new zo(V));return ut.toLociWithSourceUnits($)}O.fromQuery=l;function u(V,Z,pe){return X_.toLoci(V,Z,pe)}O.fromSchema=u;function c(V,Z){if(r(V))return;let pe=V.elements[0].unit,$=pe.elements[xe.getAt(V.elements[0].indices,0)];return Z?(Z.structure=V.structure,Z.unit=V.elements[0].unit,Z.element=$,Z):Fo.create(V.structure,pe,$)}O.getFirstLocation=c;function m(V){return r(V)?V:O(V.structure,[{unit:V.elements[0].unit,indices:xe.ofSingleton(xe.start(V.elements[0].indices))}])}O.firstElement=m;function d(V){return r(V)?V:P(m(V))}O.firstResidue=d;function p(V){return r(V)?V:M(m(V))}O.firstChain=p;function h(V){let Z=[];for(let pe of V.elements){let{unit:$,indices:ae}=pe,Se=new Int32Array(xe.size(ae));xe.forEach(ae,(ve,K)=>Se[K]=$.elements[ve]),Z.push($.getChild(Be.ofSortedArray(Se)))}return De.create(Z,{parent:V.structure.parent})}O.toStructure=h;function f(V,Z,pe){if(O.isEmpty(V))return;let $=pe||Fo.create(V.structure);$.structure=V.structure;for(let ae of V.elements){let{unit:Se,indices:ve}=ae;$.unit=Se;let{elements:K}=ae.unit;for(let re=0,le=xe.size(ve);re<le;re++)$.element=K[xe.getAt(ve,re)],Z($)}}O.forEachLocation=f;function g(V,Z){if(Z===V.structure)return V;let pe=[];return V.elements.forEach($=>{if(!Z.unitMap.has($.unit.id))return;let ae=Z.unitMap.get($.unit.id),Se=xe.indexedIntersect($.indices,$.unit.elements,ae.elements);xe.size(Se)>0&&pe.push({unit:ae,indices:Se})}),O(Z,pe)}O.remap=g;function y(V,Z){if(V.elements.length>Z.elements.length)return y(Z,V);if(O.isEmpty(V))return Z;let pe=new Map;for(let ae of V.elements)pe.set(ae.unit.id,ae.indices);let $=[];for(let ae of Z.elements)pe.has(ae.unit.id)?($[$.length]={unit:ae.unit,indices:xe.union(pe.get(ae.unit.id),ae.indices)},pe.delete(ae.unit.id)):$[$.length]=ae;return pe.forEach((ae,Se)=>{$[$.length]={unit:V.structure.unitMap.get(Se),indices:ae}}),O(V.structure,$)}O.union=y;function x(V,Z){let pe=new Map;for(let ae of Z.elements)pe.set(ae.unit.id,ae.indices);let $=[];for(let ae of V.elements)if(pe.has(ae.unit.id)){let Se=xe.subtract(ae.indices,pe.get(ae.unit.id));if(xe.size(Se)===0)continue;$[$.length]={unit:ae.unit,indices:Se}}else $[$.length]=ae;return O(V.structure,$)}O.subtract=x;function S(V,Z){let pe=new Map;for(let ae of V.elements)pe.set(ae.unit.id,ae.indices);let $=[];for(let ae of Z.elements){if(!pe.has(ae.unit.id))continue;let Se=xe.intersect(pe.get(ae.unit.id),ae.indices);xe.size(Se)!==0&&($[$.length]={unit:ae.unit,indices:Se})}return O(V.structure,$)}O.intersect=S;function I(V,Z){if(V.elements.length>Z.elements.length)return I(Z,V);if(O.isEmpty(V))return O.isEmpty(Z);let pe=new Map;for(let $ of V.elements)pe.set($.unit.id,$.indices);for(let $ of Z.elements)if(pe.has($.unit.id)&&xe.areIntersecting(pe.get($.unit.id),$.indices))return!0;return!1}O.areIntersecting=I;function v(V,Z){if(O.isEmpty(V))return O.isEmpty(Z);let pe=new Map;for(let ae of V.elements)pe.set(ae.unit.id,ae.indices);let $=!1;for(let ae of Z.elements){if(!pe.has(ae.unit.id))return!1;if(xe.isSubset(pe.get(ae.unit.id),ae.indices))$=!0;else return!1}return $}O.isSubset=v;function A(V){return V.length>3&&Be.isRange(V)?ye.ofRange(V[0],V[V.length-1]):Be.ofSortedArray(V)}function P(V,Z){let pe=[],$=new Set;for(let ae of V.elements){if(R(ae)){pe[pe.length]=ae;continue}if(ae.unit.kind===ue.Kind.Atomic){let Se=ae.unit.elements,ve=ae.unit.model.atomicHierarchy,{label_alt_id:K}=ae.unit.model.atomicHierarchy.atoms,{index:re,offsets:le}=ve.residueAtomSegments,ge=[],Ee=ae.indices,nt=xe.size(Ee),at=0;for(;at<nt;){$.clear();let be=Se[xe.getAt(Ee,at)],Re=re[be];for($.add(K.value(be)),at++;at<nt;){let Ne=Se[xe.getAt(Ee,at)];if(re[Ne]!==Re)break;$.add(K.value(Ne)),at++}let Fe=$.has("");for(let Ne=le[Re],ot=le[Re+1];Ne<ot;Ne++){let it=xe.indexOf(Se,Ne);if(it>=0){let Xt=K.value(Ne);(!Z||Fe||!Xt||$.has(Xt))&&(ge[ge.length]=it)}}}pe[pe.length]={unit:ae.unit,indices:A(ge)}}else pe[pe.length]=ae}return O(V.structure,pe)}O.extendToWholeResidues=P;function T(V){switch(V.kind){case ue.Kind.Atomic:return V.model.atomicHierarchy.chainAtomSegments;case ue.Kind.Spheres:return V.model.coarseHierarchy.spheres.chainElementSegments;case ue.Kind.Gaussians:return V.model.coarseHierarchy.gaussians.chainElementSegments}}function R(V){return V.unit.elements.length===xe.size(V.indices)}function w(V,Z,pe){let{index:$}=T(V),ae=V.elements,Se=0;for(let K=0,re=ae.length;K<re;K++){let le=ae[K],ge=$[le];Z.has(ge)&&Se++}if(Se===V.elements.length){pe[pe.length]={unit:V,indices:ye.ofBounds(0,Se)};return}let ve=new Int32Array(Se);Se=0;for(let K=0,re=ae.length;K<re;K++){let le=ae[K],ge=$[le];Z.has(ge)&&(ve[Se++]=K)}ve.length>0&&(pe[pe.length]={unit:V,indices:A(ve)})}function E(V,Z,pe,$,ae){let{index:Se}=T(V.elements[0].unit),ve=new Set;for(let K=Z;K<pe;K++){let re=V.elements[K],le=re.indices,ge=re.unit.elements;for(let Ee=0,nt=xe.size(le);Ee<nt;Ee++)ve.add(Se[ge[xe.getAt(le,Ee)]])}if($){let K=V.elements[0].unit;for(let re of V.structure.units)ue.areSameChainOperatorGroup(re,K)&&w(re,ve,ae)}else for(let K=Z;K<pe;K++)w(V.elements[K].unit,ve,ae)}function M(V){let Z=[];for(let pe=0,$=V.elements.length;pe<$;pe++){let ae=V.elements[pe];if(ue.Traits.is(ae.unit.traits,ue.Trait.Partitioned)){let Se=pe;for(;pe<$&&ue.areSameChainOperatorGroup(V.elements[pe].unit,ae.unit);)pe++;let ve=pe;pe--,E(V,Se,ve,!0,Z)}else R(ae)?Z[Z.length]=ae:E(V,pe,pe+1,!1,Z)}return O(V.structure,Z)}O.extendToWholeChains=M;function D(V){return`${V.unit.model.id}|${Ke.entity.id(V)}`}function B(V){let Z=[],pe=Fo.create(V.structure),$=new Set,{units:ae}=V.structure;for(let Se=0,ve=V.elements.length;Se<ve;Se++){let K=V.elements[Se];pe.unit=K.unit,pe.element=K.unit.elements[0],$.add(D(pe))}for(let Se=0,ve=ae.length;Se<ve;++Se){let K=ae[Se];if(pe.unit=K,pe.element=K.elements[0],$.has(D(pe))){let re=xe.ofBounds(0,K.elements.length);Z[Z.length]={unit:K,indices:re}}}return O(V.structure,Z)}O.extendToWholeEntities=B;function k(V){let Z=[],pe=new Set,{units:$}=V.structure;for(let ae=0,Se=V.elements.length;ae<Se;ae++){let ve=V.elements[ae];pe.add(ve.unit.model.id)}for(let ae=0,Se=$.length;ae<Se;++ae){let ve=$[ae];if(pe.has(ve.model.id)){let K=xe.ofBounds(0,ve.elements.length);Z[Z.length]={unit:ve,indices:K}}}return O(V.structure,Z)}O.extendToWholeModels=k;function F(V,Z){let pe=[];for(let $=0,ae=xe.size(Z);$<ae;++$)pe.push(V[xe.getAt(Z,$)]);return Be.ofSortedArray(pe)}function z(V,Z){return Be.isRange(V)&&Be.areEqual(V,Z)?ye.ofLength(V.length):A(Be.indicesOf(V,Z))}function j(V){let Z=[],pe=new Map;for(let $=0,ae=V.elements.length;$<ae;$++){let Se=V.elements[$],{model:ve}=Se.unit,K=F(Se.unit.elements,Se.indices);pe.has(ve)?pe.set(ve,Be.union(K,pe.get(ve))):pe.set(ve,K)}for(let $=0,ae=V.structure.units.length;$<ae;++$){let Se=V.structure.units[$],ve=pe.get(Se.model);if(!ve)continue;let K=z(Se.elements,ve);xe.size(K)&&(Z[Z.length]={unit:Se,indices:K})}return O(V.structure,Z)}O.extendToAllInstances=j;function Y(V){let Z=[],pe=new Set,{units:$}=V.structure;for(let ae=0,Se=V.elements.length;ae<Se;ae++){let ve=V.elements[ae];pe.add(ve.unit.conformation.operator.name)}for(let ae=0,Se=$.length;ae<Se;++ae){let ve=$[ae];if(pe.has(ve.conformation.operator.name)){let K=xe.ofBounds(0,ve.elements.length);Z[Z.length]={unit:ve,indices:K}}}return O(V.structure,Z)}O.extendToWholeOperators=Y;let G=new Fi("98"),X=b();function U(V,Z,pe){G.reset();for(let $ of V.elements){let{indices:ae}=$,{elements:Se,conformation:ve}=$.unit;for(let K=0,re=xe.size(ae);K<re;K++){let le=Se[xe.getAt(ae,K)];ve.position(le,X),Z&&b.transformMat4(X,X,Z),G.includePositionRadius(X,ve.r(le))}}G.finishedIncludeStep();for(let $ of V.elements){let{indices:ae}=$,{elements:Se,conformation:ve}=$.unit;for(let K=0,re=xe.size(ae);K<re;K++){let le=Se[xe.getAt(ae,K)];ve.position(le,X),Z&&b.transformMat4(X,X,Z),G.radiusPositionRadius(X,ve.r(le))}}return pe?(pe.box&&G.getBox(pe.box),pe.sphere&&G.getSphere(pe.sphere),pe):{box:G.getBox(),sphere:G.getSphere()}}O.getBoundary=U;let L=b();function q(V,Z,pe=0){let $=pe;for(let ae of V.elements){let{indices:Se}=ae,{elements:ve,conformation:K}=ae.unit,re=xe.size(Se);for(let le=0;le<re;le++){let ge=ve[xe.getAt(Se,le)];K.position(ge,L),b.toArray(L,Z,$+le*3)}$+=re*3}return Z}O.toPositionsArray=q;function te(V){let Z=o(V),pe=q(V,new Float32Array(3*Z));return Bu.ofPositions(pe)}O.getPrincipalAxes=te;function J(V){let Z=0;V.forEach(ae=>{Z+=o(ae)});let pe=new Float32Array(3*Z),$=0;return V.forEach(ae=>{q(ae,pe,$),$+=o(ae)*3}),Bu.ofPositions(pe)}O.getPrincipalAxesMany=J;function ee(V,Z){return ue.isAtomic(V)?V.model.atomicHierarchy.atomSourceIndex.value(Z):Z}function ce(V){if(O.isEmpty(V))return ie.struct.generator.empty();let Z=V.structure.models,pe=new Map;for(let K of V.elements){let{indices:re}=K,{elements:le}=K.unit,ge=K.unit.conformation.operator.name,Ee;pe.has(ge)?Ee=pe.get(ge).xs:(Ee=Un.create(),pe.set(ge,{modelLabel:K.unit.model.label,modelIndex:K.unit.model.modelNum,xs:Ee}));for(let nt=0,at=xe.size(re);nt<at;nt++){let be=ee(K.unit,le[xe.getAt(re,nt)]);Un.add(Ee,be,be)}}let $=[],ae=pe.keys();for(;;){let K=ae.next();if(K.done)break;let re=pe.get(K.value);$.push(fe(K.value,re.xs.array,Z.length>1,re.modelLabel,re.modelIndex))}let Se=new Map;for(let K=0,re=$.length;K<re;++K){let le=$[K],Ee=`${$u(ui(le.atom.ranges),ui(le.atom.set))}|${le.entity?le.entity.modelLabel+le.entity.modelIndex:""}`;Se.has(Ee)?Se.get(Ee).chain.opName.push(...le.chain.opName):Se.set(Ee,le)}let ve=[];return Se.forEach(K=>{let{ranges:re,set:le}=K.atom,{opName:ge}=K.chain,Ee=ie.struct.atomProperty.core.operatorName(),nt=ie.struct.atomProperty.core.sourceIndex(),at=[];le.length>0&&(at[at.length]=ie.core.set.has([ie.core.type.set(le),nt]));for(let be=0,Re=re.length/2;be<Re;be++)at[at.length]=ie.core.rel.inRange([nt,re[2*be],re[2*be+1]]);if(K.entity){let{modelLabel:be,modelIndex:Re}=K.entity;ve.push(ie.struct.generator.atomGroups({"atom-test":at.length>1?ie.core.logic.or(at):at[0],"chain-test":ge.length>1?ie.core.set.has([ie.core.type.set(ge),Ee]):ie.core.rel.eq([Ee,ge[0]]),"entity-test":ie.core.logic.and([ie.core.rel.eq([ie.struct.atomProperty.core.modelLabel(),be]),ie.core.rel.eq([ie.struct.atomProperty.core.modelIndex(),Re])])}))}else ve.push(ie.struct.generator.atomGroups({"atom-test":at.length>1?ie.core.logic.or(at):at[0],"chain-test":ge.length>1?ie.core.set.has([ie.core.type.set(ge),Ee]):ie.core.rel.eq([Ee,ge[0]])}))}),ie.struct.modifier.union([ve.length===1?ve[0]:ie.struct.combinator.merge(ve.map(K=>ie.struct.modifier.union([K])))])}O.toExpression=ce;function fe(V,Z,pe,$,ae){Js(Z);let Se=[],ve=[],K=0,re=Z.length;for(;K<re;){let le=K;for(K++;K<re&&Z[K-1]+1===Z[K];)K++;let ge=K;if(ge-le>12)Se[Se.length]=Z[le],Se[Se.length]=Z[ge-1];else for(let Ee=le;Ee<ge;Ee++)ve[ve.length]=Z[Ee]}return pe?{atom:{set:ve,ranges:Se},chain:{opName:[V]},entity:{modelLabel:$,modelIndex:ae}}:{atom:{set:ve,ranges:Se},chain:{opName:[V]}}}})(yp||={});var Fde;(s=>{function e(){return{elementCount:0,conformationCount:0,residueCount:0,chainCount:0,unitCount:0,structureCount:0,firstElementLoc:Fo.create(void 0),firstConformationLoc:Fo.create(void 0),firstResidueLoc:Fo.create(void 0),firstChainLoc:Fo.create(void 0),firstUnitLoc:Fo.create(void 0),firstStructureLoc:Fo.create(void 0)}}s.create=e;function t(l,u,c){let m=l.get(u)||0;l.set(u,m+c)}function r(l,u,c){let{indices:m,unit:d}=c,{elements:p}=d,h=xe.size(m),f=new Map,g=new Map;if(h>0&&Fo.set(l.firstElementLoc,u,d,p[xe.start(m)]),h===p.length)l.unitCount+=1,l.unitCount===1&&Fo.set(l.firstUnitLoc,u,d,p[xe.start(m)]);else if(h===1){if(ue.Traits.is(d.traits,ue.Trait.MultiChain))return;l.elementCount+=1,l.elementCount===1&&Fo.set(l.firstElementLoc,u,d,p[xe.start(m)])}else if(ue.isAtomic(d)){let{index:y,offsets:x}=d.model.atomicHierarchy.residueAtomSegments,{label_alt_id:S}=d.model.atomicHierarchy.atoms,I=0;for(;I<h;){f.clear();let v=0,A=p[xe.getAt(m,I)],P=y[A];for(t(f,S.value(A),1),++I,++v;I<h;){let T=p[xe.getAt(m,I)];if(y[T]!==P)break;t(f,S.value(T),1),++I,++v}if(x[P+1]-x[P]===v)l.residueCount+=1,l.residueCount===1&&Fo.set(l.firstResidueLoc,u,d,x[P]);else{g.clear();for(let T=x[P],R=x[P+1];T<R;++T)t(g,S.value(T),1);g.get("")===f.get("")&&f.forEach((T,R)=>{if(g.get(R)===T){if(R!==""&&(l.conformationCount+=1,l.conformationCount===1)){for(let w=x[P],E=x[P+1];w<E;++w)if(R===S.value(w)){Fo.set(l.firstConformationLoc,u,d,w);break}}v-=T}}),l.elementCount+=v}}}else l.elementCount+=h,l.elementCount===1&&Fo.set(l.firstElementLoc,u,d,p[xe.start(m)])}function n(l,u,c){let{indices:m,unit:d}=c,p=xe.size(m);if(p===0)return;let{elements:h}=d;if(!ue.Traits.is(d.traits,ue.Trait.MultiChain)){p===h.length&&(l.chainCount+=1,l.chainCount===1&&Fo.set(l.firstChainLoc,u,d,h[xe.start(m)]));return}let f=ue.isAtomic(d)?d.model.atomicHierarchy.chainAtomSegments:ue.isSpheres(d)?d.model.coarseHierarchy.spheres.chainElementSegments:ue.isGaussians(d)?d.model.coarseHierarchy.gaussians.chainElementSegments:void 0;if(!f){console.warn("StructureElement loci stats: unknown unit type");return}let{index:g,offsets:y}=f,x=0;for(;x<p;){let S=0,I=h[xe.getAt(m,x)],v=g[I];for(++x,++S;x<p;){let A=h[xe.getAt(m,x)];if(g[A]!==v)break;++x,++S}y[v+1]-y[v]===S?(l.chainCount+=1,l.chainCount===1&&Fo.set(l.firstChainLoc,u,d,y[v])):p===1&&(l.elementCount+=1,l.elementCount===1&&Fo.set(l.firstElementLoc,u,d,I))}}function o(l,u,c,m,d){let p=c[m],h=ue.isAtomic(p.unit)?p.unit.model.atomicHierarchy.chainAtomSegments:ue.isSpheres(p.unit)?p.unit.model.coarseHierarchy.spheres.chainElementSegments:ue.isGaussians(p.unit)?p.unit.model.coarseHierarchy.gaussians.chainElementSegments:void 0;if(!h){console.warn("StructureElement loci stats: unknown unit type");return}let{index:f,offsets:g}=h,y=new Map;for(let S=m;S<d;S++){p=c[S];let{indices:I,unit:v}=p,A=xe.size(I);if(A===0)continue;let{elements:P}=v;if(!ue.Traits.is(v.traits,ue.Trait.MultiChain)){let R=P[xe.start(I)];t(y,f[R],P.length);continue}let T=0;for(;T<A;){let R=0,w=P[xe.getAt(I,T)],E=f[w];for(++T,++R;T<A;){let M=P[xe.getAt(I,T)];if(f[M]!==E)break;++T,++R}t(y,E,R)}}let x=-1;if(y.forEach((S,I)=>{g[I+1]-g[I]===S&&(l.chainCount+=1,l.chainCount===1&&(x=I))}),!(x<0))for(let S=m;S<d;S++){p=c[S];let{indices:I,unit:v}=p,A=xe.size(I);if(A===0)continue;let{elements:P}=v,T=0;for(;T<A;){let R=P[xe.getAt(I,T)];if(f[R]===x){Fo.set(l.firstChainLoc,u,v,R);return}}}}function i(l){let u=e();if(yp.isEmpty(l))return u;let c=!1;if(yp.isWholeStructure(l)){if(u.structureCount+=1,u.structureCount===1){let{unit:m,indices:d}=l.elements[0];Fo.set(u.firstStructureLoc,l.structure,m,m.elements[xe.min(d)])}}else for(let m of l.elements)r(u,l.structure,m),ue.Traits.is(m.unit.traits,ue.Trait.Partitioned)?c=!0:n(u,l.structure,m);if(c)for(let m=0,d=l.elements.length;m<d;m++){let p=l.elements[m];if(!ue.Traits.is(p.unit.traits,ue.Trait.Partitioned))continue;let h=m;for(;m<d&&ue.areSameChainOperatorGroup(l.elements[m].unit,p.unit);)m++;let f=m;m--,f-h===1?n(u,l.structure,p):o(u,l.structure,l.elements,h,f)}return u}s.ofLoci=i;function a(l,u,c){return u.elementCount===1&&c.elementCount===0?Fo.copy(l.firstElementLoc,u.firstElementLoc):u.elementCount===0&&c.elementCount===1&&Fo.copy(l.firstElementLoc,c.firstElementLoc),u.conformationCount===1&&c.conformationCount===0?Fo.copy(l.firstConformationLoc,u.firstConformationLoc):u.conformationCount===0&&c.conformationCount===1&&Fo.copy(l.firstConformationLoc,c.firstConformationLoc),u.residueCount===1&&c.residueCount===0?Fo.copy(l.firstResidueLoc,u.firstResidueLoc):u.residueCount===0&&c.residueCount===1&&Fo.copy(l.firstResidueLoc,c.firstResidueLoc),u.chainCount===1&&c.chainCount===0?Fo.copy(l.firstChainLoc,u.firstChainLoc):u.chainCount===0&&c.chainCount===1&&Fo.copy(l.firstChainLoc,c.firstChainLoc),u.unitCount===1&&c.unitCount===0?Fo.copy(l.firstUnitLoc,u.firstUnitLoc):u.unitCount===0&&c.unitCount===1&&Fo.copy(l.firstUnitLoc,c.firstUnitLoc),u.structureCount===1&&c.structureCount===0?Fo.copy(l.firstStructureLoc,u.firstStructureLoc):u.structureCount===0&&c.structureCount===1&&Fo.copy(l.firstStructureLoc,c.firstStructureLoc),l.elementCount=u.elementCount+c.elementCount,l.conformationCount=u.conformationCount+c.conformationCount,l.residueCount=u.residueCount+c.residueCount,l.chainCount=u.chainCount+c.chainCount,l.unitCount=u.unitCount+c.unitCount,l.structureCount=u.structureCount+c.structureCount,l}s.add=a})(Fde||={});function v8e(e){return e}function Lde(e){throw new Error(`Property only available for ${e} models.`)}function I8e(e){return t=>ue.isAtomic(t.unit)?e(t):Lde("atomic")}function A8e(e){return t=>ue.isCoarse(t.unit)?e(t):Lde("coarse")}function T8e(e){return ue.isAtomic(e.unit)?e.unit.residueIndex[e.element]:-1}function P8e(e){return ue.isAtomic(e.unit)?e.unit.chainIndex[e.element]:-1}function _8e(e){return Ke.entity.key(e)}function St(e){return{data:e,position:0,length:e.length,lineNumber:1,tokenStart:0,tokenEnd:0}}(x=>{function e(S){return S.data.substring(S.tokenStart,S.tokenEnd)}x.getTokenString=e;function t(S){S.position=0,S.lineNumber=1,S.tokenStart=0,S.tokenEnd=0}x.reset=t;function r(S){let{data:I}=S;for(;S.position<S.length;)switch(I.charCodeAt(S.position)){case 10:return S.tokenEnd=S.position,++S.position,++S.lineNumber,!0;case 13:return S.tokenEnd=S.position,++S.position,++S.lineNumber,I.charCodeAt(S.position)===10&&++S.position,!0;default:++S.position;break}return S.tokenEnd=S.position,S.tokenStart!==S.tokenEnd}x.eatLine=r;function n(S){S.tokenStart=S.position}x.markStart=n;function o(S){return S.tokenStart=S.position,r(S)}x.markLine=o;function i(S){return o(S),e(S)}x.readLine=i;function a(S){o(S);let I=S.position;return y(S,S.tokenStart,S.tokenEnd),S.position=I,e(S)}x.readLineTrim=a;function s(S,I,v){let A=0;for(let P=0;P<I;P++){if(!o(S))return A;We.addUnchecked(v,S.tokenStart,S.tokenEnd),A++}return A}function l(S,I){let v=We.create(S.data,I*2);return s(S,I,v),v}x.markLines=l;function u(S,I){let v=[];for(let A=0;A<I;A++)v.push(x.readLine(S));return v}x.readLines=u;async function c(S,I,v,A=1e5){let P=We.create(S.data,I*2),T=0;return await ys(v,A,S,(R,w)=>{let E=Math.min(I-T,R);return s(w,E,P),T+=E,E},(R,w)=>R.update({message:"Parsing...",current:w.position,max:w.length})),P}x.readLinesAsync=c;function m(S){let I=x(S),v=We.create(I.data,Math.max(S.length/80,2));for(;o(I);)We.add(v,I.tokenStart,I.tokenEnd);return v}x.readAllLines=m;function d(S,I,v){let A=0;for(let P=0;P<I;P++){if(!o(S))return A;We.add(v,S.tokenStart,S.tokenEnd),A++}return A}async function p(S,I,v=1e5){let A=x(S),P=We.create(A.data,Math.max(S.length/80,2));return await ys(I,v,A,(T,R)=>(d(R,T,P),R.position<R.length?T:0),(T,R)=>T.update({message:"Parsing...",current:R.position,max:R.length})),P}x.readAllLinesAsync=p;function h(S){for(;S.position<S.length;)switch(S.data.charCodeAt(S.position)){case 9:case 10:case 13:case 32:S.tokenEnd=S.position;return;default:++S.position;break}S.tokenEnd=S.position}x.eatValue=h;function f(S){let I=-1;for(;S.position<S.length;){let v=S.data.charCodeAt(S.position);switch(v){case 9:case 32:I=v,++S.position;break;case 10:I!==13&&++S.lineNumber,I=v,++S.position;break;case 13:I=v,++S.position,++S.lineNumber;break;default:return I}}return I}x.skipWhitespace=f;function g(S){let I=-1;for(;S.position<S.length;){let v=S.data.charCodeAt(S.position);switch(v){case 9:case 32:I=v,++S.position;break;default:return I}}return I}x.skipStrictWhitespace=g;function y(S,I,v){let{data:A}=S,P=I,T=v-1,R=A.charCodeAt(P);for(;(R===9||R===32)&&P<=T;)R=A.charCodeAt(++P);for(R=A.charCodeAt(T);(R===9||R===32)&&T>=P;)R=A.charCodeAt(--T);return S.tokenStart=P,S.tokenEnd=T+1,S.position=v,S}x.trim=y})(St||={});function Vde(e,t,r){let n=t,o=r-1,i=e.charCodeAt(n);for(;(i===9||i===32)&&n<=o;)i=e.charCodeAt(++n);for(i=e.charCodeAt(o);(i===9||i===32)&&o>=n;)i=e.charCodeAt(--o);return e.substring(n,o+1)}var We;(i=>{function e(a){let s=new Uint32Array(1.61*a.indices.length|0);s.set(a.indices),a.indices=s,a.indicesLenMinus2=s.length-2|0}function t(a,s,l){let u=a;u.offset>u.indicesLenMinus2&&e(u),u.indices[u.offset++]=s,u.indices[u.offset++]=l,a.count++}i.add=t;function r(a,s){t(a,s.tokenStart,s.tokenEnd)}i.addToken=r;function n(a,s,l){a.indices[a.offset++]=s,a.indices[a.offset++]=l,a.count++}i.addUnchecked=n;function o(a,s){return s=Math.max(10,s),{data:a,indicesLenMinus2:s-2|0,count:0,offset:0,indices:new Uint32Array(s)}}i.create=o})(We||={});var nn;(o=>{function e(i,a=-1){return new r(i,a)}o.error=e;function t(i,a=[]){return new n(i,a)}o.success=t;class r{constructor(a,s){this.message=a;this.line=s;this.isError=!0}toString(){return this.line>=0?`[Line ${this.line}] ${this.message}`:this.message}}o.Error=r;class n{constructor(a,s){this.result=a;this.warnings=s;this.isError=!1}}o.Success=n})(nn||={});function Ode(e){for(;e.position<e.length;)switch(e.data.charCodeAt(e.position)){case 9:case 10:case 13:case 32:e.tokenEnd=e.position;return;default:++e.position;break}e.tokenEnd=e.position}function R8e(e,t){let r,n;for(++e.position;e.position<e.length;)if(n=e.data.charCodeAt(e.position),n===t)switch(r=e.data.charCodeAt(e.position+1),r){case 9:case 10:case 13:case 32:e.tokenStart++,e.tokenEnd=e.position,e.isEscaped=!0,++e.position;return;default:if(!Number.isFinite(r)){e.tokenStart++,e.tokenEnd=e.position,e.isEscaped=!0,++e.position;return}++e.position;break}else{if(n===10||n===13){e.tokenEnd=e.position;return}++e.position}e.tokenEnd=e.position}function D8e(e){for(e.position+=3;e.position<e.length;){if(e.data.charCodeAt(e.position)===39&&Nde(e)){e.tokenStart+=3,e.tokenEnd=e.position,e.isEscaped=!0,e.position+=3;return}++e.position}e.tokenEnd=e.position}function w8e(e){let t=59,r=e.position+1,n;for(;r<e.length;)if(n=e.data.charCodeAt(r),n===59&&(t===10||t===13)){for(e.position=r+1,e.tokenStart++,r--,n=e.data.charCodeAt(r);n===10||n===13;)r--,n=e.data.charCodeAt(r);e.tokenEnd=r+1,e.isEscaped=!0;return}else(n===13||n===10&&t!==13)&&e.lineNumber++,t=n,++r;return e.position=r,t}function M8e(e){for(;e.position<e.length;)if(e.data.charCodeAt(e.position)===93){++e.position,e.tokenEnd=e.position,e.isImportGet=!1;return}else++e.position}function B8e(e){for(;e.position<e.length;){let t=e.data.charCodeAt(e.position);if(t===10||t===13)return;++e.position}}function E8e(e){let t=10;for(;e.position<e.length;){let r=e.data.charCodeAt(e.position);switch(r){case 9:case 32:t=r,++e.position;break;case 10:t!==13&&++e.lineNumber,t=r,++e.position;break;case 13:t=r,++e.position,++e.lineNumber;break;default:return t}}return t}function Nde(e){return!(e.length-e.position<2||e.data.charCodeAt(e.position+1)!==39||e.data.charCodeAt(e.position+2)!==39)}function k8e(e){let t=e.data.charCodeAt(e.tokenStart);return!(t!==68&&t!==100||(t=e.data.charCodeAt(e.tokenStart+1),t!==65&&t!==97)||(t=e.data.charCodeAt(e.tokenStart+2),t!==84&&t!==116)||(t=e.data.charCodeAt(e.tokenStart+3),t!==65&&t!==97))}function F8e(e){let t=e.data.charCodeAt(e.tokenStart);return!(t!==83&&t!==115||(t=e.data.charCodeAt(e.tokenStart+1),t!==65&&t!==97)||(t=e.data.charCodeAt(e.tokenStart+2),t!==86&&t!==118)||(t=e.data.charCodeAt(e.tokenStart+3),t!==69&&t!==101))}function L8e(e){if(e.tokenEnd-e.tokenStart!==5)return!1;let t=e.data.charCodeAt(e.tokenStart);return!(t!==76&&t!==108||(t=e.data.charCodeAt(e.tokenStart+1),t!==79&&t!==111)||(t=e.data.charCodeAt(e.tokenStart+2),t!==79&&t!==111)||(t=e.data.charCodeAt(e.tokenStart+3),t!==80&&t!==112))}function V8e(e){return!(e.tokenEnd-e.tokenStart!==11||e.data.charCodeAt(e.tokenStart+1)!==105||e.data.charCodeAt(e.tokenStart+2)!==109||e.data.charCodeAt(e.tokenStart+3)!==112||e.data.charCodeAt(e.tokenStart+4)!==111||e.data.charCodeAt(e.tokenStart+5)!==114||e.data.charCodeAt(e.tokenStart+6)!==116||e.data.charCodeAt(e.tokenStart+7)!==46||e.data.charCodeAt(e.tokenStart+8)!==103||e.data.charCodeAt(e.tokenStart+9)!==101||e.data.charCodeAt(e.tokenStart+10)!==116)}function O8e(e,t,r){let n,o=r-t,i=e.tokenStart-t,a=e.tokenEnd-e.tokenStart;if(a<o)return!1;for(n=t;n<r;++n)if(e.data.charCodeAt(n)!==e.data.charCodeAt(n+i))return!1;return o===a||e.data.charCodeAt(n+i)===46}function zde(e){let t;for(t=e.tokenStart;t<e.tokenEnd;++t)if(e.data.charCodeAt(t)===46)return t;return t}function Hde(e,t){return e.data.substring(e.tokenStart,t)}function G8e(e){let t;for(t=e.tokenStart;t<e.tokenEnd;++t)if(e.data.charCodeAt(t)===46)return!1;return!0}function aj(e){return e.data.substring(e.tokenStart,e.tokenEnd)}function Gde(e){let t=E8e(e);if(e.position>=e.length){e.tokenType=6;return}e.tokenStart=e.position,e.tokenEnd=e.position,e.isEscaped=!1;let r=e.data.charCodeAt(e.position);switch(r){case 35:B8e(e),e.tokenType=5;break;case 39:if(Nde(e)){D8e(e),e.tokenType=3;break}case 34:R8e(e,r),e.tokenType=3;break;case 59:t===10||t===13?w8e(e):Ode(e),e.tokenType=3;break;default:e.isImportGet?M8e(e):Ode(e),e.isEscaped?e.tokenType=3:e.data.charCodeAt(e.tokenStart)===95?(e.inSaveFrame&&V8e(e)&&(e.isImportGet=!0),e.tokenType=4):e.tokenEnd-e.tokenStart>=5&&e.data.charCodeAt(e.tokenStart+4)===95?k8e(e)?e.tokenType=0:F8e(e)?e.tokenType=1:L8e(e)?e.tokenType=2:e.tokenType=3:e.tokenType=3;break}}function uC(e){for(Gde(e);e.tokenType===5;)Gde(e)}function U8e(e,t){return{data:e,length:e.length,position:0,tokenStart:0,tokenEnd:0,tokenType:6,lineNumber:1,isEscaped:!1,isImportGet:!1,inSaveFrame:!1,runtimeCtx:t}}function XE(){return{categoryNames:[],categoryData:Object.create(null)}}function lj(e,t){let r=Object.create(null);for(let n of e){let o=t[n];r[n]=fa(o.name,o.rowCount,o.fieldNames,o.fields)}return r}function Ude(e,t,r){return kS(e.categoryNames,lj(e.categoryNames,e.categoryData),t,r)}function N8e(e,t){return kS(e.categoryNames,lj(e.categoryNames,e.categoryData),t)}function sj(e,t,r,n,o){if(t in e.categoryData){let i=e.categoryData[t];i.fieldNames.push(...n),Object.assign(i.fields,o)}else e.categoryData[t]={name:t,rowCount:r,fieldNames:n,fields:o},e.categoryNames.push(t)}function z8e(e,t){let r=e.tokenStart,n=zde(e),o=Hde(e,n),i=Object.create(null),a=[],s=!0;for(;s;){if(e.tokenType!==4||!O8e(e,r,n)){s=!1;break}let l=aj(e).substring(o.length+1);if(uC(e),e.tokenType!==3)return{hasError:!0,errorLine:e.lineNumber,errorMessage:"Expected value."};i[l]=Tt.ofTokens({data:e.data,indices:[e.tokenStart,e.tokenEnd],count:1}),a[a.length]=l,uC(e)}return sj(t,o.substr(1),1,a,i),{hasError:!1,errorLine:0,errorMessage:""}}function H8e(e,t){let{tokenizer:r,tokens:n,fieldCount:o}=t,i=t.tokenCount,a=0;for(;r.tokenType===3&&a<e;)We.add(n[i++%o],r.tokenStart,r.tokenEnd),uC(r),a++;return t.tokenCount=i,a}function j8e(e,t){return e.update({message:"Parsing...",current:t.tokenizer.position,max:t.tokenizer.data.length})}async function W8e(e,t){let r=e.lineNumber;uC(e);let n=Hde(e,zde(e)),o=G8e(e),i=[];for(;e.tokenType===4;)i[i.length]=o?aj(e):aj(e).substring(n.length+1),uC(e);let a=n==="_atom_site"?e.data.length/100|0:32,s=[],l=i.length;for(let m=0;m<l;m++)s[m]=We.create(e.data,a);let u={fieldCount:l,tokenCount:0,tokenizer:e,tokens:s};if(await ys(e.runtimeCtx,1e6,u,H8e,j8e),u.tokenCount%l!==0)return{hasError:!0,errorLine:e.lineNumber,errorMessage:`The number of values for loop starting at line ${r} is not a multiple of the number of columns.`};let c=u.tokenCount/l|0;if(o)for(let m=0;m<l;m++){let d={"":Tt.ofTokens(s[m])};sj(t,i[m].substr(1),c,[""],d)}else{let m=Object.create(null);for(let d=0;d<l;d++)m[i[d]]=Tt.ofTokens(s[d]);sj(t,n.substr(1),c,i,m)}return{hasError:!1,errorLine:0,errorMessage:""}}function HI(e,t){return nn.error(t,e)}function X8e(e){return nn.success(e)}async function Q8e(e,t){let r=[],n=U8e(e,t),o="",i=XE(),a=[],s=XE(),l=wce(s.categoryNames,lj(s.categoryNames,s.categoryData),""),u="";for(t.update({message:"Parsing...",current:0,max:e.length}),uC(n);n.tokenType!==6;){let c=n.tokenType;if(c===0){if(n.inSaveFrame)return HI(n.lineNumber,"Unexpected data block inside a save frame.");i.categoryNames.length>0&&r.push(Ude(i,o,a)),o=e.substring(n.tokenStart+5,n.tokenEnd),i=XE(),a=[],uC(n)}else if(c===1){if(n.tokenEnd-n.tokenStart===5)s.categoryNames.length>0&&(a[a.length]=N8e(s,u)),n.inSaveFrame=!1;else{if(n.inSaveFrame)return HI(n.lineNumber,"Save frames cannot be nested.");n.inSaveFrame=!0,u=e.substring(n.tokenStart+5,n.tokenEnd),s=XE()}uC(n)}else if(c===2){let m=await W8e(n,n.inSaveFrame?s:i);if(m.hasError)return HI(m.errorLine,m.errorMessage)}else if(c===4){let m=z8e(n,n.inSaveFrame?s:i);if(m.hasError)return HI(m.errorLine,m.errorMessage)}else return console.log(n.tokenType,St.getTokenString(n)),HI(n.lineNumber,"Unexpected token. Expected data_, loop_, or data name.")}return n.inSaveFrame?HI(n.lineNumber,`Unfinished save frame (${l.header}).`):((i.categoryNames.length>0||a.length>0)&&r.push(Ude(i,o,a)),X8e(ES(r)))}function uj(e){return Ae.create("Parse CIF",async t=>await Q8e(e,t))}function jde(e){let t=e.mask?DI(e.mask):void 0,r=DI(e.data),n=ki.isTypedArray(r),o=n?t?u=>t[u]===W.ValueKinds.Present?""+r[u]:"":u=>""+r[u]:t?u=>t[u]===W.ValueKinds.Present?r[u]:"":u=>r[u],i=n?u=>r[u]:u=>{let c=r[u];return pp(c,0,c.length)},a=n?u=>r[u]:u=>{let c=r[u];return Nc(c,0,c.length)},s=t?u=>t[u]:u=>W.ValueKinds.Present,l=r.length;return{__array:r,binaryEncoding:e.data.encoding,isDefined:!0,rowCount:l,str:o,int:i,float:a,valueKind:s,areValuesEqual:(u,c)=>r[u]===r[c],toStringArray:u=>ki.createAndFillArray(l,o,u),toIntArray:n?u=>ki.typedArrayWindow(r,u):u=>ki.createAndFillArray(l,i,u),toFloatArray:n?u=>ki.typedArrayWindow(r,u):u=>ki.createAndFillArray(l,a,u)}}function qE(e){return ZE({buffer:e,offset:0,dataView:new DataView(e.buffer)})}function cj(e,t){let r={};for(let n=0;n<t;n++){let o=ZE(e);r[o]=ZE(e)}return r}function mj(e,t){let r=new Uint8Array(t),n=e.offset;for(let o=0;o<t;o++)r[o]=e.buffer[o+n];return e.offset+=t,r}function QE(e,t){let r=Yh(e.buffer,e.offset,t);return e.offset+=t,r}function dj(e,t){let r=new Array(t);for(let n=0;n<t;n++)r[n]=ZE(e);return r}function ZE(e){let t=e.buffer[e.offset],r,n;if((t&128)===0)return e.offset++,t;if((t&240)===128)return n=t&15,e.offset++,cj(e,n);if((t&240)===144)return n=t&15,e.offset++,dj(e,n);if((t&224)===160)return n=t&31,e.offset++,QE(e,n);if((t&224)===224)return r=e.dataView.getInt8(e.offset),e.offset++,r;switch(t){case 192:return e.offset++,null;case 194:return e.offset++,!1;case 195:return e.offset++,!0;case 196:return n=e.dataView.getUint8(e.offset+1),e.offset+=2,mj(e,n);case 197:return n=e.dataView.getUint16(e.offset+1),e.offset+=3,mj(e,n);case 198:return n=e.dataView.getUint32(e.offset+1),e.offset+=5,mj(e,n);case 202:return r=e.dataView.getFloat32(e.offset+1),e.offset+=5,r;case 203:return r=e.dataView.getFloat64(e.offset+1),e.offset+=9,r;case 204:return r=e.buffer[e.offset+1],e.offset+=2,r;case 205:return r=e.dataView.getUint16(e.offset+1),e.offset+=3,r;case 206:return r=e.dataView.getUint32(e.offset+1),e.offset+=5,r;case 208:return r=e.dataView.getInt8(e.offset+1),e.offset+=2,r;case 209:return r=e.dataView.getInt16(e.offset+1),e.offset+=3,r;case 210:return r=e.dataView.getInt32(e.offset+1),e.offset+=5,r;case 217:return n=e.dataView.getUint8(e.offset+1),e.offset+=2,QE(e,n);case 218:return n=e.dataView.getUint16(e.offset+1),e.offset+=3,QE(e,n);case 219:return n=e.dataView.getUint32(e.offset+1),e.offset+=5,QE(e,n);case 220:return n=e.dataView.getUint16(e.offset+1),e.offset+=3,dj(e,n);case 221:return n=e.dataView.getUint32(e.offset+1),e.offset+=5,dj(e,n);case 222:return n=e.dataView.getUint16(e.offset+1),e.offset+=3,cj(e,n);case 223:return n=e.dataView.getUint32(e.offset+1),e.offset+=5,cj(e,n)}throw new Error("Unknown type 0x"+t.toString(16))}function Z8e(e,t){for(let r=0;r<2;r++)if(e[r]>t[r])return!1;return!0}function q8e(e){let t=Object.create(null),r=Object.create(null);for(let n of e.columns)t[n.name]=n;return{rowCount:e.rowCount,name:e.name.substring(1),fieldNames:e.columns.map(n=>n.name),getField(n){let o=t[n];if(o)return r[n]||(r[n]=jde(o)),r[n]}}}function pj(e){return Ae.create("Parse BinaryCIF",async t=>{let r=[0,3];try{let n=qE(e);if(!Z8e(r,n.version.match(/(\d)\.(\d)\.\d/).slice(1).map(i=>+i)))return nn.error(`Unsupported format version. Current ${n.version}, required ${r.join(".")}.`);let o=ES(n.dataBlocks.map(i=>{let a=Object.create(null);for(let s of i.categories)a[s.name.substring(1)]=q8e(s);return kS(i.categories.map(s=>s.name.substring(1)),a,i.header)}));return nn.success(o)}catch(n){return nn.error(""+n)}})}var zS=W.Schema,mi=zS.str,Y8e=zS.float,Wde=zS.List,ug=zS.lstr,Pd=zS.Aliased,J_=zS.int,jI=zS.coord,Xde={chem_comp:{formula:mi,formula_weight:Y8e,id:mi,mon_nstd_parent_comp_id:Wde(",",e=>e),name:mi,one_letter_code:mi,three_letter_code:mi,type:Pd(ug),pdbx_synonyms:Wde(";",e=>e),pdbx_type:mi,pdbx_ambiguous_flag:mi,pdbx_replaced_by:mi,pdbx_replaces:mi,pdbx_formal_charge:J_,pdbx_model_coordinates_details:mi,pdbx_model_coordinates_db_code:mi,pdbx_ideal_coordinates_details:mi,pdbx_ideal_coordinates_missing_flag:Pd(ug),pdbx_model_coordinates_missing_flag:Pd(ug),pdbx_initial_date:mi,pdbx_modified_date:mi,pdbx_release_status:Pd(mi),pdbx_processing_site:Pd(mi)},chem_comp_atom:{alt_atom_id:mi,atom_id:mi,charge:J_,model_Cartn_x:jI,model_Cartn_y:jI,model_Cartn_z:jI,comp_id:mi,type_symbol:mi,pdbx_align:J_,pdbx_ordinal:J_,pdbx_model_Cartn_x_ideal:jI,pdbx_model_Cartn_y_ideal:jI,pdbx_model_Cartn_z_ideal:jI,pdbx_stereo_config:Pd(ug),pdbx_aromatic_flag:Pd(ug),pdbx_leaving_atom_flag:Pd(ug)},chem_comp_bond:{atom_id_1:mi,atom_id_2:mi,comp_id:mi,value_order:Pd(ug),pdbx_ordinal:J_,pdbx_stereo_config:Pd(ug),pdbx_aromatic_flag:Pd(ug)},pdbx_chem_comp_descriptor:{comp_id:mi,descriptor:mi,type:Pd(ug),program:mi,program_version:mi},pdbx_chem_comp_identifier:{comp_id:mi,identifier:mi,type:Pd(mi),program:mi,program_version:mi}};var $_=W.Schema,ln=$_.str,K8e=$_.float,$y=$_.lstr,Xc=$_.Aliased,bp=$_.int,Qde={pdbx_reference_molecule:{prd_id:ln,formula_weight:K8e,formula:ln,type:Xc($y),type_evidence_code:ln,class:Xc($y),class_evidence_code:ln,name:ln,represent_as:Xc($y),chem_comp_id:ln,compound_details:ln,description:ln,representative_PDB_id_code:ln,release_status:Xc($y),replaces:ln,replaced_by:ln},pdbx_reference_entity_list:{prd_id:ln,ref_entity_id:ln,type:Xc($y),details:ln,component_id:bp},pdbx_reference_entity_nonpoly:{prd_id:ln,ref_entity_id:ln,name:ln,chem_comp_id:ln},pdbx_reference_entity_link:{link_id:bp,prd_id:ln,details:ln,ref_entity_id_1:ln,ref_entity_id_2:ln,entity_seq_num_1:bp,entity_seq_num_2:bp,comp_id_1:ln,comp_id_2:ln,atom_id_1:ln,atom_id_2:ln,value_order:Xc($y),component_1:bp,component_2:bp,link_class:Xc(ln)},pdbx_reference_entity_poly_link:{link_id:bp,prd_id:ln,ref_entity_id:ln,component_id:bp,entity_seq_num_1:bp,entity_seq_num_2:bp,comp_id_1:ln,comp_id_2:ln,atom_id_1:ln,atom_id_2:ln,value_order:Xc($y)},pdbx_reference_entity_poly:{prd_id:ln,ref_entity_id:ln,type:Xc(ln),db_code:ln,db_name:ln},pdbx_reference_entity_poly_seq:{prd_id:ln,ref_entity_id:ln,mon_id:ln,parent_mon_id:ln,num:bp,observed:Xc($y),hetero:Xc($y)},pdbx_reference_entity_sequence:{prd_id:ln,ref_entity_id:ln,type:Xc(ln),NRP_flag:Xc(ln),one_letter_codes:ln},pdbx_reference_entity_src_nat:{prd_id:ln,ref_entity_id:ln,ordinal:bp,organism_scientific:ln,taxid:ln,db_code:ln,db_name:ln},pdbx_prd_audit:{prd_id:ln,date:ln,processing_site:Xc(ln),action_type:Xc(ln)}};var Zde=W.Schema,Cs=Zde.str,J8e=Zde.float,$8e={id:Cs,description:Cs},eWe={title:Cs,datablock_id:Cs,version:Cs},tWe={version:Cs,update:Cs,revision:Cs},rWe={id:Cs,description:Cs},nWe={id:Cs,parent_id:Cs,description:Cs},oWe={code:Cs,primitive_code:Cs,construct:Cs,detail:Cs},iWe={code:Cs,detail:Cs},aWe={from_code:Cs,to_code:Cs,operator:Cs,factor:J8e},qde={datablock:$8e,dictionary:eWe,dictionary_history:tWe,sub_category:rWe,category_group_list:nWe,item_type_list:oWe,item_units_list:iWe,item_units_conversion:aWe};var eR=W.Schema,cg=eR.str,YE=eR.int,eb=eR.float,KE=eR.Aliased,cC=eR.Vector,QQt={density_server_result:{server_version:cg,datetime_utc:cg,guid:cg,is_empty:KE(cg),has_error:KE(cg),error:cg,query_source_id:cg,query_type:KE(cg),query_box_type:KE(cg),query_box_a:cC(3),query_box_b:cC(3)}},JE={volume_data_3d_info:{name:cg,axis_order:cC(3,YE),origin:cC(3),dimensions:cC(3),sample_rate:YE,sample_count:cC(3,YE),spacegroup_number:YE,spacegroup_cell_size:cC(3),spacegroup_cell_angles:cC(3),mean_source:eb,mean_sampled:eb,sigma_source:eb,sigma_sampled:eb,min_source:eb,min_sampled:eb,max_source:eb,max_sampled:eb},volume_data_3d:{values:eb}};var $E=W.Schema,Pa=$E.float,xi=$E.str,Yde=$E.int,sWe=$E.Matrix,Kde={cell:{angle_alpha:Pa,angle_beta:Pa,angle_gamma:Pa,formula_units_z:Pa,length_a:Pa,length_b:Pa,length_c:Pa,volume:Pa},chemical:{melting_point:Pa,name_common:xi,name_systematic:xi},chemical_formula:{moiety:xi,sum:xi,weight:Pa},space_group:{crystal_system:xi,it_number:Yde,"name_h-m_full":xi},space_group_symop:{operation_xyz:xi},geom_bond:{atom_site_label_1:xi,atom_site_label_2:xi,distance:Pa,publ_flag:xi,site_symmetry_1:xi,site_symmetry_2:xi,valence:Pa},audit:{block_doi:xi},database_code:{cod:xi,csd:xi,depnum_ccdc_archive:xi,depnum_ccdc_fiz:xi,icsd:xi,mdf:xi,nbs:xi},atom_site:{adp_type:xi,calc_flag:xi,disorder_assembly:xi,disorder_group:xi,fract_x:Pa,fract_y:Pa,fract_z:Pa,label:xi,occupancy:Pa,refinement_flags:xi,site_symmetry_multiplicity:Yde,type_symbol:xi,u_iso_or_equiv:Pa},atom_site_aniso:{label:xi,u_11:Pa,u:sWe(3,3),u_12:Pa,u_13:Pa,u_22:Pa,u_23:Pa,u_33:Pa},atom_type:{description:xi,symbol:xi},atom_type_scat:{dispersion_imag:Pa,dispersion_real:Pa,source:xi}},Jde={"cell.formula_units_z":["cell_formula_units_Z"],"space_group.it_number":["space_group_IT_number","symmetry_Int_Tables_number"],"space_group.name_h-m_full":["symmetry_space_group_name_H-M"],"space_group_symop.operation_xyz":["symmetry_equiv_pos_as_xyz"],"geom_bond.atom_site_label_1":["geom_bond_atom_site_id_1"],"geom_bond.atom_site_label_2":["geom_bond_atom_site_id_2"],"geom_bond.distance":["geom_bond_dist"],"audit.block_doi":["audit_block_DOI"],"database_code.cod":["database_code_COD"],"database_code.csd":["database_code_CSD"],"database_code.depnum_ccdc_archive":["database_code_depnum_CCDC_archive"],"database_code.depnum_ccdc_fiz":["database_code_depnum_CCDC_fiz"],"database_code.icsd":["database_code_ICSD"],"database_code.mdf":["database_code_MDF"],"database_code.nbs":["database_code_NBS"],"atom_site.adp_type":["atom_site_ADP_type","atom_site_thermal_displace_type"],"atom_site.label":["atom_site_id"],"atom_site.site_symmetry_multiplicity":["atom_site_symmetry_multiplicity"],"atom_site.u_iso_or_equiv":["atom_site_U_iso_or_equiv"],"atom_site_aniso.label":["atom_site_anisotrop_id"],"atom_site_aniso.u_11":["atom_site_aniso_U_11","atom_site_anisotrop_U_11"],"atom_site_aniso.u_12":["atom_site_aniso_U_12","atom_site_anisotrop_U_12"],"atom_site_aniso.u_13":["atom_site_aniso_U_13","atom_site_anisotrop_U_13"],"atom_site_aniso.u_22":["atom_site_aniso_U_22","atom_site_anisotrop_U_22"],"atom_site_aniso.u_23":["atom_site_aniso_U_23","atom_site_anisotrop_U_23"],"atom_site_aniso.u_33":["atom_site_aniso_U_33","atom_site_anisotrop_U_33"]};var lWe=W.Schema,fj=lWe.int,$de={volume_data_3d_info:JE.volume_data_3d_info,segmentation_data_table:{set_id:fj,segment_id:fj},segmentation_data_3d:{values:fj}};var Fu={parse:e=>Tm.is(e)?uj(e):pj(e),parseText:uj,parseBinary:pj,toDatabaseCollection:kce,toDatabase:wm,schema:{mmCIF:e=>wm(bn,e),CCD:e=>wm(Xde,e),BIRD:e=>wm(Qde,e),dic:e=>wm(qde,e),cifCore:e=>wm(Kde,e,Jde),densityServer:e=>wm(JE,e),segmentation:e=>wm($de,e)}};var uWe={U:bn.atom_site_anisotrop.U,U_esd:bn.atom_site_anisotrop.U_esd},Em;(i=>{i.Schema=uWe,i.Descriptor={name:"atom_site_anisotrop",cifExport:{prefix:"",categories:[{name:"atom_site_anisotrop",instance(a){return i.Provider.get(a.firstModel)?Ln.is(a.firstModel.sourceData)?ta.Category.ofTable(a.firstModel.sourceData.data.db.atom_site_anisotrop):ta.Category.Empty:ta.Category.Empty}}]}},i.Provider=_l.create(i.Descriptor);function n(a,s){let l=new Int32Array(a.rowCount);l.fill(-1);for(let c=0,m=a.rowCount;c<m;c++)l[a.value(c)]=c;let u=new Int32Array(a.rowCount);u.fill(-1);for(let c=0,m=s.rowCount;c<m;++c){let d=l[s.value(c)];d!==-1&&(u[d]=c)}return u}i.getElementToAnsiotrop=n;function o(a,s){let l={};for(let c=0,m=a.rowCount;c<m;c++)l[a.value(c)]=c;let u=new Int32Array(a.rowCount);u.fill(-1);for(let c=0,m=s.rowCount;c<m;++c){let d=l[s.value(c)];d!==void 0&&(u[d]=c)}return u}i.getElementToAnsiotropFromLabel=o})(Em||={});var tb;(u=>{let e="molstar_global_model_transform_info";u.Schema={[e]:{matrix:W.Schema.Matrix(4,4,W.Schema.float)}},u.Descriptor={name:e,cifExport:{categories:[{name:e,instance(c){let m=i(c.firstModel);if(!m)return ta.Category.Empty;let d=wr.ofRows(u.Schema.molstar_global_model_transform_info,[{matrix:m}]);return ta.Category.ofTable(d)}}],prefix:"molstar"}},u.Provider=_l.create(u.Descriptor);function o(c,m){c.customProperties.has(u.Descriptor)||c.customProperties.add(u.Descriptor),u.Provider.set(c,m)}u.attach=o;function i(c){return u.Provider.get(c)}u.get=i;function a(c){if(!Ln.is(c.sourceData))return;let m=c.sourceData.data.frame.categories[e];if(!m)return;let d=fE(u.Schema[e],m);if(d._rowCount!==0)return d.matrix.value(0)}u.fromMmCif=a;function s(c){if(!Ln.is(c.sourceData))return!1;let m=c.sourceData.data.frame.categories[e];return!!m&&m.rowCount>0}u.hasData=s;function l(c,m){c.writeCategory({name:e,instance(){let d=wr.ofRows(u.Schema.molstar_global_model_transform_info,[{matrix:m}]);return ta.Category.ofTable(d)}})}u.writeMmCif=l})(tb||={});var LZt={label_comp_id:bn.atom_site.label_comp_id,label_seq_id:bn.atom_site.label_seq_id,pdbx_PDB_ins_code:bn.atom_site.pdbx_PDB_ins_code,label_asym_id:bn.atom_site.label_asym_id,label_entity_id:bn.atom_site.label_entity_id,auth_comp_id:bn.atom_site.auth_atom_id,auth_seq_id:bn.atom_site.auth_seq_id,auth_asym_id:bn.atom_site.auth_asym_id},VZt={...bn.chem_comp_bond,molstar_protonation_variant:W.Schema.Str()},epe={...bn.chem_comp,type:W.Schema.Aliased(W.Schema.str)};function rpe(e,t){let{ihm_model_group:r,ihm_model_group_link:n}=t,o=wr.pickRow(n,i=>n.model_id.value(i)===e);if(o){let i=wr.pickRow(r,a=>r.id.value(a)===o.group_id);if(i)return i.name}return""}function tpe(e){for(let t=0,r=e.rowCount;t<r;t++)if(e.valueKind(t)===W.ValueKinds.Present)return!0;return!1}function tR(e,t,r){(!e[t].isDefined||!tpe(e[t]))&&(e[t]=e[r]),(!e[r].isDefined||!tpe(e[r]))&&(e[r]=e[t])}function npe(e){let t=wr.ofColumns(e._schema,e);return tR(t,"label_atom_id","auth_atom_id"),tR(t,"label_comp_id","auth_comp_id"),tR(t,"label_seq_id","auth_seq_id"),tR(t,"label_asym_id","auth_asym_id"),tR(t,"label_entity_id","label_asym_id"),t}var Lo={entry:bn.entry,struct:bn.struct,struct_asym:bn.struct_asym,ihm_model_list:bn.ihm_model_list,ihm_model_group:bn.ihm_model_group,ihm_model_group_link:bn.ihm_model_group_link,entity:bn.entity,entity_poly:bn.entity_poly,entity_poly_seq:bn.entity_poly_seq,pdbx_entity_branch:bn.pdbx_entity_branch,chem_comp:epe,pdbx_chem_comp_identifier:bn.pdbx_chem_comp_identifier,atom_site:bn.atom_site,ihm_sphere_obj_site:bn.ihm_sphere_obj_site,ihm_gaussian_obj_site:bn.ihm_gaussian_obj_site,pdbx_unobs_or_zero_occ_residues:bn.pdbx_unobs_or_zero_occ_residues,pdbx_molecule:bn.pdbx_molecule};function ra(e,t=!1){let r=Object.create(null);for(let n of Object.keys(Lo))n in e?r[n]=e[n]:r[n]=wr.ofUndefinedColumns(Lo[n],0);return t&&(r.atom_site=npe(r.atom_site)),r}var Ui=class{constructor(){this.count=0;this.ids=[];this.types=[];this.descriptions=[];this.compoundsMap=new Map;this.namesMap=new Map;this.heteroMap=new Map;this.chainMap=new Map}set(t,r){this.count+=1,this.ids.push(`${this.count}`),this.types.push(t),this.descriptions.push([r])}getEntityId(t,r,n,o){return r===2?(this.waterId===void 0&&(this.set("water",o?.customName||"Water"),this.waterId=`${this.count}`),this.waterId):eC(r)?this.compoundsMap.has(n)?this.compoundsMap.get(n):(this.chainMap.has(n)||(this.set("polymer",o?.customName||`Polymer ${this.chainMap.size+1}`),this.chainMap.set(n,`${this.count}`)),this.chainMap.get(n)):(this.heteroMap.has(t)||(this.set("non-polymer",o?.customName||this.namesMap.get(t)||t),this.heteroMap.set(t,`${this.count}`)),this.heteroMap.get(t))}getEntityTable(){return wr.ofPartialColumns(Lo.entity,{id:W.ofStringArray(this.ids),type:W.ofStringAliasArray(this.types),pdbx_description:W.ofStringListArray(this.descriptions)},this.count)}setCompounds(t){for(let r=0,n=t.length;r<n;++r){let{chains:o,description:i}=t[r];this.set("polymer",i);for(let a=0,s=o.length;a<s;++a)this.compoundsMap.set(o[a],`${this.count}`)}}setNames(t){t.forEach(r=>this.namesMap.set(r[0],r[1]))}};var cWe=[new Set(["CA"]),new Set(["C"]),new Set(["N"])],mWe=[new Set(["P","O3'","O3*"]),new Set(["C4'","C4*"]),new Set(["O2'","O2*","F2'","F2*"])],dWe=[new Set(["P","O3'","O3*"]),new Set(["C3'","C3*"]),new Set(["O2'","O2*","F2'","F2*"])],pWe=new Set(["FMN","NCN","FNS","FMA","ATP","ADP","AMP","GTP","GDP","GMP","LIG"]),ope=(function(){let e=new Map;return[{id:"HIS",name:"HISTIDINE",type:"l-peptide linking"},{id:"ARG",name:"ARGININE",type:"l-peptide linking"},{id:"LYS",name:"LYSINE",type:"l-peptide linking"},{id:"ILE",name:"ISOLEUCINE",type:"l-peptide linking"},{id:"PHE",name:"PHENYLALANINE",type:"l-peptide linking"},{id:"LEU",name:"LEUCINE",type:"l-peptide linking"},{id:"TRP",name:"TRYPTOPHAN",type:"l-peptide linking"},{id:"ALA",name:"ALANINE",type:"l-peptide linking"},{id:"MET",name:"METHIONINE",type:"l-peptide linking"},{id:"CYS",name:"CYSTEINE",type:"l-peptide linking"},{id:"ASN",name:"ASPARAGINE",type:"l-peptide linking"},{id:"VAL",name:"VALINE",type:"l-peptide linking"},{id:"GLY",name:"GLYCINE",type:"peptide linking"},{id:"SER",name:"SERINE",type:"l-peptide linking"},{id:"GLN",name:"GLUTAMINE",type:"l-peptide linking"},{id:"TYR",name:"TYROSINE",type:"l-peptide linking"},{id:"ASP",name:"ASPARTIC ACID",type:"l-peptide linking"},{id:"GLU",name:"GLUTAMIC ACID",type:"l-peptide linking"},{id:"THR",name:"THREONINE",type:"l-peptide linking"},{id:"PRO",name:"PROLINE",type:"l-peptide linking"},{id:"SEC",name:"SELENOCYSTEINE",type:"l-peptide linking"},{id:"PYL",name:"PYRROLYSINE",type:"l-peptide linking"},{id:"MSE",name:"SELENOMETHIONINE",type:"l-peptide linking"},{id:"SEP",name:"PHOSPHOSERINE",type:"l-peptide linking"},{id:"TPO",name:"PHOSPHOTHREONINE",type:"l-peptide linking"},{id:"PTR",name:"O-PHOSPHOTYROSINE",type:"l-peptide linking"},{id:"PCA",name:"PYROGLUTAMIC ACID",type:"l-peptide linking"},{id:"A",name:"ADENOSINE-5'-MONOPHOSPHATE",type:"rna linking"},{id:"C",name:"CYTIDINE-5'-MONOPHOSPHATE",type:"rna linking"},{id:"T",name:"THYMIDINE-5'-MONOPHOSPHATE",type:"rna linking"},{id:"G",name:"GUANOSINE-5'-MONOPHOSPHATE",type:"rna linking"},{id:"I",name:"INOSINIC ACID",type:"rna linking"},{id:"U",name:"URIDINE-5'-MONOPHOSPHATE",type:"rna linking"},{id:"DA",name:"2'-DEOXYADENOSINE-5'-MONOPHOSPHATE",type:"dna linking"},{id:"DC",name:"2'-DEOXYCYTIDINE-5'-MONOPHOSPHATE",type:"dna linking"},{id:"DT",name:"THYMIDINE-5'-MONOPHOSPHATE",type:"dna linking"},{id:"DG",name:"2'-DEOXYGUANOSINE-5'-MONOPHOSPHATE",type:"dna linking"},{id:"DI",name:"2'-DEOXYINOSINE-5'-MONOPHOSPHATE",type:"dna linking"},{id:"DU",name:"2'-DEOXYURIDINE-5'-MONOPHOSPHATE",type:"dna linking"}].forEach(r=>e.set(r.id,r)),e})(),ipe=(function(){let e=new Map;return[{id:"ZN2",name:"ZINC ION",type:"ion"},{id:"SOD",name:"SODIUM ION",type:"ion"},{id:"CES",name:"CESIUM ION",type:"ion"},{id:"CLA",name:"CHLORIDE ION",type:"ion"},{id:"CAL",name:"CALCIUM ION",type:"ion"},{id:"POT",name:"POTASSIUM ION",type:"ion"}].forEach(r=>e.set(r.id,r)),e})(),Ni=class{constructor(t,r){this.seqId=t;this.atomId=r;this.namesMap=new Map;this.comps=new Map;this.ids=[];this.names=[];this.types=[];this.mon_nstd_flags=[]}set(t){this.comps.set(t.id,t),this.ids.push(t.id),this.names.push(t.name),this.types.push(t.type),this.mon_nstd_flags.push(Zy.has(t.id)?"y":"n")}getAtomIds(t){let r=new Set,n=this.seqId.value(t);for(;t<this.seqId.rowCount;){let o=this.seqId.value(t);if(o!==n)break;r.add(this.atomId.value(t)),n-o,t+=1}return r}hasAtomIds(t,r){for(let n=0,o=r.length;n<o;++n)if(!go.areIntersecting(t,r[n]))return!1;return!0}getType(t){return this.hasAtomIds(t,cWe)?"peptide linking":this.hasAtomIds(t,mWe)?"rna linking":this.hasAtomIds(t,dWe)?"dna linking":"other"}has(t){return this.comps.has(t)}get(t){return this.comps.get(t)}add(t,r){if(!this.has(t))if(ope.has(t))this.set(ope.get(t));else if(SI.has(t))this.set({id:t,name:"WATER",type:"non-polymer"});else if(pWe.has(t.toUpperCase()))this.set({id:t,name:this.namesMap.get(t)||t,type:"non-polymer"});else if(fp.has(t.toUpperCase()))this.set({id:t,name:this.namesMap.get(t)||t,type:"saccharide"});else{let n=this.getAtomIds(r);if(n.size===1&&ipe.has(t))this.set(ipe.get(t));else{let o=this.getType(n);this.set({id:t,name:this.namesMap.get(t)||t,type:o})}}return this.get(t)}getChemCompTable(){return wr.ofPartialColumns(Lo.chem_comp,{id:W.ofStringArray(this.ids),name:W.ofStringArray(this.names),type:W.ofStringAliasArray(this.types),mon_nstd_flag:W.ofStringAliasArray(this.mon_nstd_flags)},this.ids.length)}setNames(t){t.forEach(r=>this.namesMap.set(r[0],r[1]))}};var ape={molstar_bond_site:{atom_id_1:W.Schema.int,atom_id_2:W.Schema.int,value_order:W.Schema.Aliased(W.Schema.lstr),type_id:W.Schema.Aliased(W.Schema.lstr)}},sqt=ta.fields().int("atom_id_1",(e,t)=>t[e].atom_id_1).int("atom_id_2",(e,t)=>t[e].atom_id_2).str("value_order",(e,t)=>t[e].value_order??"",{valueKind:(e,t)=>t[e].value_order===void 0?W.ValueKinds.NotPresent:W.ValueKinds.Present}).str("type_id",(e,t)=>t[e].type_id??"",{valueKind:(e,t)=>t[e].type_id===void 0?W.ValueKinds.NotPresent:W.ValueKinds.Present}).getFields();function fWe(e){if(Ln.is(e.sourceData))return Qo.fromData(e.sourceData.data.db)}Qo.Provider.formatRegistry.add("mmCIF",fWe);function hWe(e){if(!Ln.is(e.sourceData))return;let{struct_conf:t,struct_sheet_range:r}=e.sourceData.data.db;return lg.fromStruct(t,r,e.atomicHierarchy)}lg.Provider.formatRegistry.add("mmCIF",hWe);function gWe(e){if(!Ln.is(e.sourceData))return;let{atom_site_anisotrop:t}=e.sourceData.data.db,r=wr.ofColumns(Em.Schema,t),n=Em.getElementToAnsiotrop(e.atomicConformation.atomId,t.id);return{data:r,elementToAnsiotrop:n}}function yWe(e){return Ln.is(e.sourceData)?e.sourceData.data.db.atom_site_anisotrop.U.isDefined:!1}Em.Provider.formatRegistry.add("mmCIF",gWe,yWe);function bWe(e){if(!Ln.is(e.sourceData))return;let{chem_comp_bond:t}=e.sourceData.data.db;if(t._rowCount!==0)return{data:t,entries:oC.getEntriesFromChemCompBond(t)}}oC.Provider.formatRegistry.add("mmCIF",bWe);function xWe(e){if(!Ln.is(e.sourceData))return;let{struct_conn:t}=e.sourceData.data.db;if(t._rowCount===0)return;let r=jc.getEntriesFromStructConn(t,e),n=new Set;for(let o of r)o.partnerA.residueIndex!==o.partnerB.residueIndex&&n.add(Mc(o.partnerA.residueIndex,o.partnerB.residueIndex));return{data:t,byAtomIndex:jc.getAtomIndexFromEntries(r),residueCantorPairs:n,entries:r}}jc.Provider.formatRegistry.add("mmCIF",xWe);function CWe(e){if(!Ln.is(e.sourceData))return;let{molstar_bond_site:t}=wm(ape,e.sourceData.data.frame);if(t._rowCount===0)return;let r=new Map,{atomId:n}=e.atomicConformation;for(let p=0;p<n.rowCount;p++)r.set(n.value(p),p);let o=[],i=[],a=[],s=[],{atom_id_1:l,atom_id_2:u,value_order:c,type_id:m}=t;for(let p=0;p<t._rowCount;p++){o.push(r.get(l.value(p))),i.push(r.get(u.value(p)));let h=xt.Flag.None,f=1;switch(c.value(p)){case"sing":f=1;break;case"doub":f=2;break;case"trip":f=3;break;case"quad":f=4;break;case"arom":f=1,h=xt.Flag.Aromatic;break;default:break}switch(m.value(p)){case"covale":h|=xt.Flag.Covalent;break;case"disulf":h|=xt.Flag.Covalent|xt.Flag.Disulfide;break;case"hydrog":h|=xt.Flag.HydrogenBond;break;case"metalc":h|=xt.Flag.MetallicCoordination;break}a.push(f),s.push(h)}return Xo.fromData({pairs:{indexA:W.ofIntArray(o),indexB:W.ofIntArray(i),order:W.ofIntArray(a),flag:W.ofArray({array:s,schema:W.Schema.int})},count:e.atomicHierarchy.atoms._rowCount},{maxDistance:1/0})}Xo.Provider.formatRegistry.add("mmCIF",CWe);tb.Provider.formatRegistry.add("mmCIF",tb.fromMmCif,tb.hasData);var Ln;(r=>{function e(n){return n?.kind==="mmCIF"}r.is=e;function t(n,o,i,a){return o||(o=Fu.schema.mmCIF(n)),{kind:"mmCIF",name:o._name,data:{db:o,file:a,frame:n,source:i}}}r.fromFrame=t})(Ln||={});function tk(e,t){let r=Ln.fromFrame(e,void 0,void 0,t),n=ra(r.data.db,!0);return Ae.create("Create mmCIF Model",o=>rs(n,r,o))}var ek;(o=>{let e="__CcdCoordinateType__";o.CoordinateType={get(i){return i._staticPropertyData[e]},set(i,a){return i._staticPropertyData[e]=a}};function r(i){return i?.kind==="CCD"}o.is=r;function n(i,a){return a||(a=Fu.schema.CCD(i)),{kind:"CCD",name:a._name,data:{db:a,frame:i}}}o.fromFrame=n})(ek||={});function lpe(e){let t=ek.fromFrame(e);return Ae.create("Create CCD Models",r=>SWe(t.data.db,ek.fromFrame(e),r))}async function SWe(e,t,r){let n=await spe(e,t,{coordinateType:"ideal",cartn_x:"pdbx_model_Cartn_x_ideal",cartn_y:"pdbx_model_Cartn_y_ideal",cartn_z:"pdbx_model_Cartn_z_ideal"},r),o=await spe(e,t,{coordinateType:"model",cartn_x:"model_Cartn_x",cartn_y:"model_Cartn_y",cartn_z:"model_Cartn_z"},r),i=[];n&&i.push(n),o&&i.push(o);for(let a=0,s=i.length;a<s;++a)Gt.TrajectoryInfo.set(i[a],{index:a,size:i.length});return new Rl(i)}async function spe(e,t,r,n){let{chem_comp:o,chem_comp_atom:i,chem_comp_bond:a}=e,{coordinateType:s,cartn_x:l,cartn_y:u,cartn_z:c}=r,m=o.name.value(0),d=o.id.value(0),{atom_id:p,charge:h,comp_id:f,pdbx_ordinal:g,type_symbol:y}=i,x=i._rowCount,S=[];for(let te=0;te<x;te++)i[l].valueKind(te)>0||(S[S.length]=te);let I=S.length,v=W.ofConst("A",I,W.Schema.str),A=W.ofConst(1,I,W.Schema.int),P=W.ofConst("1",I,W.Schema.str),T=W.ofConst(1,I,W.Schema.float),R=W.ofConst(1,I,W.Schema.int),w=W.view(p,S),E=W.view(f,S),M=W.view(i[l],S),D=W.view(i[u],S),B=W.view(i[c],S),k=W.view(g,S),F=W.view(y,S),z=W.view(h,S),j=wr.ofPartialColumns(Lo.atom_site,{auth_asym_id:v,auth_atom_id:w,auth_comp_id:E,auth_seq_id:A,Cartn_x:M,Cartn_y:D,Cartn_z:B,id:k,label_asym_id:v,label_atom_id:w,label_comp_id:E,label_seq_id:A,label_entity_id:P,occupancy:T,type_symbol:F,pdbx_PDB_model_num:R,pdbx_formal_charge:z},I),Y=new Ui;Y.setNames([[d,`${m} (${s})`]]),Y.getEntityId(d,0,"A");let G=new Ni(A,y);G.setNames([[d,`${m} (${s})`]]),G.add(d,0);let X=ra({entity:Y.getEntityTable(),chem_comp:G.getChemCompTable(),atom_site:j}),U=await rs(X,t,n);if(!U.representative)return;let L=U.representative,q=oC.getEntriesFromChemCompBond(a);return oC.Provider.set(L,{data:a,entries:q}),ek.CoordinateType.set(L,s),U.representative}var _d;(r=>{function e(n){let o=n.descriptor.name,i=n.type==="static"?"_staticPropertyData":"_dynamicPropertyData",a=l=>(o in l[i]||(l[i][o]={props:{...C.getDefaultValues(n.getParams(l))},data:My.create(void 0)}),l[i][o]),s=(l,u,c)=>{let m=a(l);l[i][o]={props:u,data:My.withValue(m.data,c)}};return{label:n.label,descriptor:n.descriptor,isHidden:n.isHidden,getParams:l=>{let u=C.clone(n.getParams(l));return C.setDefaultValues(u,a(l).props),u},defaultParams:n.defaultParams,isApplicable:n.isApplicable,attach:async(l,u,c={},m)=>{m&&u.customProperties.reference(n.descriptor,!0);let d=a(u),p=C.merge(n.defaultParams,d.props,c);if(d.data.value&&C.areEqual(n.defaultParams,d.props,p))return;let{value:h,assets:f}=await n.obtain(l,u,p);u.customProperties.add(n.descriptor),u.customProperties.assets(n.descriptor,f),s(u,p,h)},ref:(l,u)=>l.customProperties.reference(n.descriptor,u),get:l=>a(l)?.data,set:(l,u={},c)=>{let m=a(l),d=C.merge(n.defaultParams,m.props,u);C.areEqual(n.defaultParams,m.props,d)||(s(l,d,c),l.customProperties.assets(n.descriptor))},props:l=>a(l).props}}r.createProvider=e;function t(n,o,i){let a={value:C.Value(i,{isHidden:!0})};return e({label:va(n),descriptor:{name:n},isHidden:!0,type:o,defaultParams:a,getParams:()=>({value:C.Value(i,{isHidden:!0})}),isApplicable:()=>!0,obtain:async(s,l,u)=>({...C.getDefaultValues(a),...u})})}r.createSimple=t})(_d||={});var Qc;(i=>{i.Provider=_d.createProvider({label:"SIFTS Mapping",descriptor:{name:"sifts_sequence_mapping"},type:"static",defaultParams:{},getParams:()=>({}),isApplicable:a=>t(a),obtain:async(a,s)=>({value:o(s)})});function t(a){if(!Ln.is(a.sourceData))return!1;let{pdbx_sifts_xref_db_name:s,pdbx_sifts_xref_db_acc:l,pdbx_sifts_xref_db_num:u,pdbx_sifts_xref_db_res:c}=a.sourceData.data.db.atom_site;return s.isDefined&&l.isDefined&&u.isDefined&&c.isDefined}i.isAvailable=t;function r(a){let s=a.unit.model,l=i.Provider.get(s).value;if(!l)return"";let u=s.atomicHierarchy.residueAtomSegments.index[a.element];return l.accession[u]}i.getKey=r;function n(a){let s=a.unit.model,l=i.Provider.get(s).value;if(!l)return;let u=s.atomicHierarchy.residueAtomSegments.index[a.element],c=l.dbName[u];if(c)return`${c} ${l.accession[u]} ${l.num[u]} ${l.residue[u]}`}i.getLabel=n;function o(a){if(!Ln.is(a.sourceData))return;let{pdbx_sifts_xref_db_name:s,pdbx_sifts_xref_db_acc:l,pdbx_sifts_xref_db_num:u,pdbx_sifts_xref_db_res:c}=a.sourceData.data.db.atom_site;if(!s.isDefined||!l.isDefined||!u.isDefined||!c.isDefined)return;let{atomSourceIndex:m}=a.atomicHierarchy,{count:d,offsets:p}=a.atomicHierarchy.residueAtomSegments,h=new Array(d),f=new Array(d),g=new Array(d),y=new Array(d);for(let x=0;x<d;x++){let S=m.value(p[x]);if(s.valueKind(S)!==W.ValueKinds.Present){h[x]="",f[x]="",g[x]="",y[x]="";continue}h[x]=s.value(S),f[x]=l.value(S),g[x]=u.value(S),y[x]=c.value(S)}return{dbName:h,accession:f,num:g,residue:y}}})(Qc||={});function hj(e,t){if(Ln.is(e.sourceData))return e.sourceData.data.db[t]}function upe(e){if(e.length===0)return new Set;let t=e[0].model.entities.data.id;return new Set(cpe(e).map(r=>t.value(r)))}function cpe(e){if(e.length===0)return[];if(e.length===1)return e[0].entityIndices;let t=Un.create();for(let r of e)for(let n of r.entityIndices)Un.add(t,n,n);return Js(t.array),t.array}var mpe=ta.Category,vWe=gj("struct_asym"),IWe=gj("entity_poly"),AWe=gj("entity_poly_seq");function gj(e){return{name:e,instance({structures:t,cache:r}){return TWe(t,e,r)}}}function TWe(e,t,r){let n=hj(e[0].model,t);if(!n)return mpe.Empty;let{entity_id:o}=n,i=r.uniqueEntityIds||(r.uniqueEntityIds=upe(e)),a=W.indicesOf(o,s=>i.has(s));return mpe.ofTable(n,a)}var PWe;(t=>{function e(r){let n=Array.isArray(r)?r:[r];return{structures:n,firstModel:n[0].model,cache:Object.create(null)}}t.create=e})(PWe||={});var _We;(t=>t.AtomSitePositionsFieldNames=new Set(["id","Cartn_x","Cartn_y","Cartn_z"]))(_We||={});var ppe={molstar_atom_site_operator_mapping:{label_asym_id:W.Schema.Str(),auth_asym_id:W.Schema.Str(),operator_name:W.Schema.Str(),suffix:W.Schema.Str(),assembly_id:W.Schema.Str(),assembly_operator_id:W.Schema.Int(),symmetry_operator_index:W.Schema.Int(),symmetry_hkl:W.Schema.Vector(3),ncs_id:W.Schema.Int()}},dpe=(e,t)=>typeof t[e].operator.assembly>"u"?W.ValueKinds.NotPresent:W.ValueKinds.Present,yj=(e,t)=>t[e].operator.spgrOp===-1?W.ValueKinds.NotPresent:W.ValueKinds.Present,sKt=ta.fields().str("label_asym_id",(e,t)=>t[e].label_asym_id).str("auth_asym_id",(e,t)=>t[e].auth_asym_id).str("operator_name",(e,t)=>t[e].operator.name).str("suffix",(e,t)=>t[e].operator.suffix).str("assembly_id",(e,t)=>t[e].operator.assembly?.id||"",{valueKind:dpe}).int("assembly_operator_id",(e,t)=>t[e].operator.assembly?.operId||0,{valueKind:dpe}).int("symmetry_operator_index",(e,t)=>t[e].operator.spgrOp,{valueKind:yj}).vec("symmetry_hkl",[(e,t)=>t[e].operator.hkl[0],(e,t)=>t[e].operator.hkl[1],(e,t)=>t[e].operator.hkl[2]],{valueKind:yj}).int("ncs_id",(e,t)=>t[e].operator.ncsId,{valueKind:yj}).getFields();function fpe(e,t,r,n){let{label_comp_id:o,type_symbol:i,_rowCount:a}=e.atoms,{_rowCount:s}=e.residues,{offsets:l}=t.residueAtomSegments,u=new Uint8Array(a);for(let y=0;y<a;++y)u[y]=$x(i.value(y));let c=new Int32Array(s),m=new Int32Array(s),d=new Int32Array(s),p=new Uint8Array(s),h=new Uint8Array(s),f=new Map,g=new Map;for(let y=0;y<s;++y){let x=o.value(l[y]),S=n,I,v;if(f.has(x))I=f.get(x),v=g.get(x);else{let w;S.has(x)?w=S.get(x).type:(Xx||console.info("chemComp not found",x),w=d6(x)),I=Ql(w,x),v=Tce(w,I),f.set(x,I),g.set(x,v)}p[y]=I,h[y]=v;let A=sg(v,"trace"),P=r.findAtomsOnResidue(y,A);if(P===-1){let w=sg(v,"coarseBackbone");P=r.findAtomsOnResidue(y,w),P===-1&&eC(I)&&(P=r.findElementOnResidue(y,Nf("C")))}c[y]=P;let T=sg(v,"directionFrom");m[y]=r.findAtomsOnResidue(y,T);let R=sg(v,"directionTo");d[y]=r.findAtomsOnResidue(y,R)}return{atom:{atomicNumber:u},residue:{traceElementIndex:c,directionFromElementIndex:m,directionToElementIndex:d,moleculeType:p,polymerType:h}}}function WI(e,t){return t?t.length===1?ca(t.charCodeAt(0),e):t.length===2?ca(t.charCodeAt(0),ca(t.charCodeAt(1),e)):`${e} ${t}`:e}function RWe(e,t,r,n){if(e.has(t)){let o=e.get(t);o.has(r)||o.set(r,n)}else{let o=new Map;e.set(t,o),o.set(r,n)}}function DWe(e){throw new Error(`Missing entity entry for entity id '${e}'.`)}function wWe(e,t,r){return{entities:e,segments:r,label_seq_id:Be.ofSortedArray(t.residues.label_seq_id.toArray({array:Int32Array})),label_atom_id:t.atoms.label_atom_id,auth_atom_id:t.atoms.auth_atom_id,label_alt_id:t.atoms.label_alt_id,type_symbol:t.atoms.type_symbol,chain_index_entity_index:new Int32Array(t.chains._rowCount),entity_index_label_asym_id:new Map,chain_index_label_seq_id:new Map,auth_asym_id_auth_seq_id:new Map,chain_index_auth_seq_id:new Map,label_asym_id:new Map}}var rR=i6.EmptyResidueKey(),Cj=class{constructor(t){this.map=t;this.entityIndex=t.entities.getEntityIndex,this.residueOffsets=this.map.segments.residueAtomSegments.offsets}getEntityFromChain(t){return this.map.chain_index_entity_index[t]}findEntity(t){let r=this.map.label_asym_id.get(t);return r!==void 0?r:-1}findChainLabel(t){let r=this.entityIndex(t.label_entity_id);if(r<0||!this.map.entity_index_label_asym_id.has(r))return-1;let n=this.map.entity_index_label_asym_id.get(r);return n&&n.has(t.label_asym_id)?n.get(t.label_asym_id):-1}findChainAuth(t){if(!this.map.auth_asym_id_auth_seq_id.has(t.auth_asym_id))return-1;let r=this.map.auth_asym_id_auth_seq_id.get(t.auth_asym_id);return r.has(t.auth_seq_id)?r.get(t.auth_seq_id):-1}findResidue(t,r,n,o){let i;arguments.length===1?i=t:(rR.label_entity_id=t,rR.label_asym_id=r,rR.auth_seq_id=n,rR.pdbx_PDB_ins_code=o,i=rR);let a=this.findChainLabel(i);if(a<0)return-1;let s=this.map.chain_index_auth_seq_id.get(a),l=WI(i.auth_seq_id,i.pdbx_PDB_ins_code||"");return s.has(l)?s.get(l):-1}findResidueLabel(t){let r=this.findChainLabel(t);if(r<0)return-1;let n=this.map.chain_index_label_seq_id.get(r),o=WI(t.label_seq_id,t.pdbx_PDB_ins_code||"");return n.has(o)?n.get(o):-1}findResidueAuth(t){let r=this.findChainAuth(t);if(r<0)return-1;let n=this.map.chain_index_auth_seq_id.get(r),o=WI(t.auth_seq_id,t.pdbx_PDB_ins_code||"");return n.has(o)?n.get(o):-1}findResidueInsertion(t){let r=this.findChainLabel(t);if(r<0)return-1;let n=this.map.chain_index_label_seq_id.get(r),o=WI(t.label_seq_id,t.pdbx_PDB_ins_code||"");if(n.has(o))return n.get(o);let i=Be.findPredecessorIndex(this.map.label_seq_id,t.label_seq_id),a=wS.chainStartResidueIndex(this.map.segments,r);if(i<a)return a;let s=wS.chainEndResidueIndexExcl(this.map.segments,r)-1;return i>=s?s:i}findAtom(t){let r=this.findResidue(t);return r<0?-1:typeof t.label_alt_id>"u"?bj(this.residueOffsets[r],this.residueOffsets[r+1],this.map.label_atom_id,t.label_atom_id):xj(this.residueOffsets[r],this.residueOffsets[r+1],this.map.label_atom_id,this.map.label_alt_id,t.label_atom_id,t.label_alt_id)}findAtomAuth(t){let r=this.findResidueAuth(t);return r<0?-1:typeof t.label_alt_id>"u"?bj(this.residueOffsets[r],this.residueOffsets[r+1],this.map.auth_atom_id,t.auth_atom_id):xj(this.residueOffsets[r],this.residueOffsets[r+1],this.map.auth_atom_id,this.map.label_alt_id,t.auth_atom_id,t.label_alt_id)}findAtomOnResidue(t,r,n){return typeof n>"u"?bj(this.residueOffsets[t],this.residueOffsets[t+1],this.map.label_atom_id,r):xj(this.residueOffsets[t],this.residueOffsets[t+1],this.map.label_atom_id,this.map.label_alt_id,r,n)}findAtomsOnResidue(t,r){return MWe(this.residueOffsets[t],this.residueOffsets[t+1],this.map.label_atom_id,r)}findElementOnResidue(t,r){return BWe(this.residueOffsets[t],this.residueOffsets[t+1],this.map.type_symbol,r)}};function bj(e,t,r,n){for(let o=e;o<t;o++)if(r.value(o)===n)return o;return-1}function MWe(e,t,r,n){for(let o=e;o<t;o++)if(n.has(r.value(o)))return o;return-1}function xj(e,t,r,n,o,i){for(let a=e;a<t;a++)if(r.value(a)===o&&n.value(a)===i)return a;return-1}function BWe(e,t,r,n){for(let o=e;o<t;o++)if(r.value(o)===n)return o;return-1}function hpe(e,t,r){let n=wWe(t,e,r),{label_seq_id:o,auth_seq_id:i,pdbx_PDB_ins_code:a}=e.residues,{label_entity_id:s,label_asym_id:l,auth_asym_id:u}=e.chains,c=ye.ofBounds(0,e.atoms._rowCount),m=Kt.transientSegments(r.chainAtomSegments,c);for(;m.hasNext;){let d=m.move(),p=d.index,h=t.getEntityIndex(s.value(p));h<0&&DWe(s.value(p)),n.chain_index_entity_index[p]=h;let f=u.value(p),g=n.auth_asym_id_auth_seq_id.get(f);g||(g=new Map,n.auth_asym_id_auth_seq_id.set(f,g));let y=l.value(p);n.label_asym_id.has(y)||n.label_asym_id.set(y,h),RWe(n.entity_index_label_asym_id,h,y,p);let x=new Map,S=new Map;n.chain_index_label_seq_id.set(p,x),n.chain_index_auth_seq_id.set(p,S);let I=Kt.transientSegments(r.residueAtomSegments,c,d);for(;I.hasNext;){let A=I.move().index,P=i.value(A),T=a.value(A);x.set(WI(o.value(A),T),A),S.set(WI(P,T),A),g.set(P,p)}}return new Cj(n)}function EWe(e){if(e._rowCount===0)return{residues:[],chains:[]};let t=0,r=e._rowCount,n=[t],o=[t],{label_entity_id:i,label_asym_id:a,label_seq_id:s,auth_seq_id:l,pdbx_PDB_ins_code:u}=e;for(let c=t+1;c<r;c++){let m=!i.areValuesEqual(c-1,c)||!a.areValuesEqual(c-1,c);(m||!s.areValuesEqual(c-1,c)||!l.areValuesEqual(c-1,c)||!u.areValuesEqual(c-1,c))&&(n[n.length]=c),m&&(o[o.length]=c)}return{residues:n,chains:o}}function kWe(e,t,r){let n=wr.ofColumns(Kue,{type_symbol:W.ofArray({array:W.mapToArray(e.type_symbol,Nf),schema:W.Schema.Aliased(W.Schema.str)}),label_atom_id:e.label_atom_id,auth_atom_id:e.auth_atom_id,label_alt_id:e.label_alt_id,label_comp_id:e.label_comp_id,auth_comp_id:e.auth_comp_id,pdbx_formal_charge:e.pdbx_formal_charge}),o=wr.view(e,Jue,r.residues),i=wr.view(e,$ue,r.chains);if(!o.label_seq_id.isDefined){let s=new Int32Array(o.label_seq_id.rowCount),{residues:l,chains:u}=r,c=0,m=0;for(let d=0,p=s.length;d<p;++d)l[d]>=u[c+1]&&(c+=1,m=0),s[d]=++m;o.label_seq_id=W.ofIntArray(s)}wr.columnToArray(o,"label_seq_id",Int32Array),wr.columnToArray(o,"auth_seq_id",Int32Array);let a=FWe(t,r.residues.length,r.residues);return{atoms:n,residues:o,chains:i,atomSourceIndex:t,residueSourceIndex:a}}function FWe(e,t,r){let n=new Uint32Array(t);for(let i=0;i<t;i++){let a=r[i],s=i+1<t?r[i+1]:e.rowCount,l=e.value(a);for(let u=a+1;u<s;u++){let c=e.value(u);c<l&&(l=c)}n[i]=l}let o=Vl(t).sort((i,a)=>n[i]-n[a]);for(let i=0;i<t;i++)n[o[i]]=i;return W.ofIntArray(n)}function LWe(e){return{id:fn.create22(),atomId:e.id,occupancy:e.occupancy.isDefined?e.occupancy:W.ofConst(1,e._rowCount,W.Schema.float),B_iso_or_equiv:e.B_iso_or_equiv,xyzDefined:e.Cartn_x.isDefined&&e.Cartn_y.isDefined&&e.Cartn_z.isDefined,x:e.Cartn_x.toArray({array:Float32Array}),y:e.Cartn_y.toArray({array:Float32Array}),z:e.Cartn_z.toArray({array:Float32Array})}}function VWe(e,t){return wr.areEqual(e.chains,t.chains)&&wr.areEqual(e.residues,t.residues)&&wr.areEqual(e.atoms,t.atoms)}function OWe(e,t){let r=new Map;if(!Ln.is(t))return r;let{molstar_atom_site_operator_mapping:n}=wm(ppe,t.data.frame);if(n._rowCount===0)return r;let o=new Map,i=new Map;for(let c=0;c<n._rowCount;c++){let m=n.assembly_operator_id.valueKind(c)===W.ValueKinds.Present?{id:n.assembly_id.value(c),operList:[],operId:n.assembly_operator_id.value(c)}:void 0,d=Jn.create(n.operator_name.value(c),H.identity(),{assembly:m,spgrOp:n.symmetry_operator_index.valueKind(c)===W.ValueKinds.Present?n.symmetry_operator_index.value(c):void 0,hkl:b.ofArray(n.symmetry_hkl.value(c)),ncsId:n.ncs_id.value(c)}),p=n.suffix.value(c),h=n.label_asym_id.value(c);o.set(`${h}${p}`,{name:h,operator:d});let f=n.auth_asym_id.value(c);i.set(`${f}${p}`,f)}let{label_asym_id:a,auth_asym_id:s}=e.chains,l=new Array(a.rowCount),u=new Array(a.rowCount);for(let c=0;c<a.rowCount;c++){let m=a.value(c),d=s.value(c);if(!o.has(m)){l[c]=m,u[c]=d;continue}let{name:p,operator:h}=o.get(m);r.set(c,h),l[c]=p,u[c]=i.get(d)||d}return e.chains.label_asym_id=W.ofArray({array:l,valueKind:e.chains.label_asym_id.valueKind,schema:e.chains.label_asym_id.schema}),e.chains.auth_asym_id=W.ofArray({array:u,valueKind:e.chains.auth_asym_id.valueKind,schema:e.chains.auth_asym_id.schema}),r}function GWe(e,t,r,n,o,i){let a=EWe(e),s=kWe(e,t,a),l=OWe(s,o);if(i&&VWe(i.atomicHierarchy,s))return{sameAsPrevious:!0,hierarchy:i.atomicHierarchy,chainOperatorMapping:l};let u={residueAtomSegments:Kt.ofOffsets(a.residues,ye.ofBounds(0,e._rowCount)),chainAtomSegments:Kt.ofOffsets(a.chains,ye.ofBounds(0,e._rowCount))},c=hpe(s,r,u),m=fpe(s,u,c,n);return{sameAsPrevious:!1,hierarchy:{...s,...u,index:c,derived:m},chainOperatorMapping:l}}function Sj(e,t,r,n,o,i){let{sameAsPrevious:a,hierarchy:s,chainOperatorMapping:l}=GWe(e,t,r,n,o,i),u=LWe(e);return{sameAsPrevious:a,hierarchy:s,conformation:u,chainOperatorMapping:l}}function ype(e){return new Ij(e)}var vj=class{findElement(t,r){return r.kind=void 0,r.index=-1,!1}findSphereElement(t){return-1}findGaussianElement(t){return-1}},bpe=new vj,Ij=class{constructor(t){this.data=t;this._sphereMapping=void 0;this._gaussianMapping=void 0}get sphereMapping(){return this._sphereMapping||(this._sphereMapping=gpe(this.data.spheres)),this._sphereMapping}get gaussianMapping(){return this._gaussianMapping||(this._gaussianMapping=gpe(this.data.gaussians)),this._gaussianMapping}findSphereElement(t){let n=this.sphereMapping[t.label_entity_id];return!n||(n=n[t.label_asym_id],!n)?-1:n[t.label_seq_id]??-1}findGaussianElement(t){let n=this.gaussianMapping[t.label_entity_id];return!n||(n=n[t.label_asym_id],!n)?-1:n[t.label_seq_id]??-1}findElement(t,r){let n=this.findSphereElement(t);if(n>=0)return r.kind="spheres",r.index=n,!0;let o=this.findGaussianElement(t);return o>=0?(r.kind="gaussians",r.index=o,!0):!1}};function gpe({count:e,entity_id:t,asym_id:r,seq_id_begin:n,seq_id_end:o}){let i={};for(let a=0;a<e;a++){let s=t.value(a),l=r.value(a);i[s]||(i[s]={}),i[s][l]||(i[s][l]={});let u=i[s][l],c=n.value(a),m=o.value(a);for(let d=c;d<=m;d++)u[d]=a}return i}var xpe={chainKey:[],entityKey:[],findSequenceKey:()=>-1,findChainKey:()=>-1,getEntityFromChain:()=>-1,count:0,entity_id:W.Undefined(0,W.Schema.str),asym_id:W.Undefined(0,W.Schema.str),seq_id_begin:W.Undefined(0,W.Schema.int),seq_id_end:W.Undefined(0,W.Schema.int),chainElementSegments:Kt.create([]),polymerRanges:Wn.ofSortedRanges([]),gapRanges:Wn.ofSortedRanges([])};var Aj;(t=>t.Empty={isDefined:!1,spheres:xpe,gaussians:xpe,index:bpe})(Aj||={});function UWe(e,t,r){if(e.has(t))return e.get(t);let n=r.index++;return e.set(t,n),n}function NWe(e,t){if(e.has(t))return e.get(t);let r=new Map;return e.set(t,r),r}function zWe(e,t,r){let n=e.getEntityIndex;return{findChainKey:(a,s)=>{let l=n(a);if(l<0)return-1;let u=t.get(l);return u.has(s)?u.get(s):-1},findSequenceKey:(a,s,l)=>{let u=n(a);if(u<0)return-1;let c=t.get(u);if(c===void 0)return-1;let m=c.get(s);if(m===void 0)return-1;let d=r.get(m),{elementIndices:p,seqRanges:h}=d,f=Wn.firstIntersectionIndex(h,xe.ofSingleton(l));return f!==-1?p[f]:-1}}}function HWe(e){throw new Error(`Missing entity entry for entity id '${e}'.`)}function Tj(e,t){let{entity_id:r,asym_id:n,seq_id_begin:o,seq_id_end:i,count:a,chainElementSegments:s}=e,l=new Map,u=new Map,c={index:0},m=new Int32Array(a),d=new Int32Array(a),p=new Int32Array(s.count);for(let y=0;y<a;y++)d[y]=t.getEntityIndex(r.value(y)),d[y]<0&&HWe(r.value(y));for(let y=0;y<s.count;y++){let x=s.offsets[y],S=s.offsets[y+1],I=d[x];p[y]=I;let v=NWe(u,I),A=UWe(v,n.value(x),c);for(let w=x;w<S;w++)m[w]=A;let P=[],T=[];for(let w=x;w<S;w++){let E=o.value(w),M=i.value(w);P.push(w),T.push(E,M)}let R={elementIndices:P,seqRanges:Wn.ofSortedRanges(T)};l.set(A,R)}let{findChainKey:h,findSequenceKey:f}=zWe(t,u,l);return{chainKey:m,entityKey:d,findSequenceKey:f,findChainKey:h,getEntityFromChain:y=>p[y]}}function Pj(e,t){let r=[],n=[],o=Kt.transientSegments(e.chainElementSegments,ye.ofBounds(0,e.count)),{seq_id_begin:i,seq_id_end:a}=e;for(;o.hasNext;){let{start:s,end:l}=o.move(),u=-1,c=-1;for(let m=s;m<l;++m){let d=a.value(m);m===s?(u=m,c=a.value(m)):i.value(m)-c>1&&(r.push(u,m-1),n.push(m-1,m),u=m),m===l-1&&r.push(u,m),c=d}}return{polymerRanges:Wn.ofSortedRanges(r),gapRanges:Wn.ofSortedRanges(n)}}var _j={hierarchy:Aj.Empty,conformation:void 0};function Spe(e,t){let{ihm_sphere_obj_site:r,ihm_gaussian_obj_site:n}=e;if(r._rowCount===0&&n._rowCount===0)return _j;let o=Cpe(r),i=jWe(r),a=Tj(o,e.entities),s=Pj(o,t),l=Cpe(n),u=WWe(n),c=Tj(l,e.entities),m=Pj(l,t);return{hierarchy:{isDefined:!0,spheres:{...o,...a,...s},gaussians:{...l,...c,...m},index:ype({spheres:o,gaussians:l})},conformation:{id:fn.create22(),spheres:i,gaussians:u}}}function jWe(e){return{x:e.Cartn_x.toArray({array:Float32Array}),y:e.Cartn_y.toArray({array:Float32Array}),z:e.Cartn_z.toArray({array:Float32Array}),radius:e.object_radius.toArray({array:Float32Array}),rmsf:e.rmsf.toArray({array:Float32Array})}}function WWe(e){let t=Lo.ihm_gaussian_obj_site.covariance_matrix.space,r=[],{covariance_matrix:n}=e;for(let o=0,i=n.rowCount;o<i;o++)r[o]=Dr.toMat3(Mt(),t,n.value(o));return{x:e.mean_Cartn_x.toArray({array:Float32Array}),y:e.mean_Cartn_y.toArray({array:Float32Array}),z:e.mean_Cartn_z.toArray({array:Float32Array}),weight:e.weight.toArray({array:Float32Array}),covariance_matrix:r}}function XWe(e,t,r){let n=[0];for(let o=1,i=e.rowCount;o<i;o++)!e.areValuesEqual(o-1,o)&&(n[n.length]=o);return{chainElementSegments:Kt.ofOffsets(n,ye.ofBounds(0,e.rowCount))}}function Cpe(e){let{entity_id:t,seq_id_begin:r,seq_id_end:n,asym_id:o}=e;return{count:t.rowCount,entity_id:t,asym_id:o,seq_id_begin:r,seq_id_end:n,...XWe(o,r,n)}}var QWe={HIS:"H",ARG:"R",LYS:"K",ILE:"I",PHE:"F",LEU:"L",TRP:"W",ALA:"A",MET:"M",PRO:"P",CYS:"C",ASN:"N",VAL:"V",GLY:"G",SER:"S",GLN:"Q",TYR:"Y",ASP:"D",GLU:"E",THR:"T",SEC:"U",PYL:"O",HSD:"H",HSE:"H",HSP:"H",LSN:"K",ASPP:"D",GLUP:"E",HID:"H",HIE:"H",HIP:"H",LYN:"K",ASH:"D",GLH:"E"},ZWe={DA:"A",DC:"C",DG:"G",DT:"T",DU:"U"},qWe={A:"A",C:"C",G:"G",T:"T",U:"U"};function Rj(e){return QWe[e]||"X"}function Dj(e){return qWe[e]||"X"}function wj(e){return ZWe[e]||"X"}var XI;(l=>{let e;(p=>(p.Protein="protein",p.RNA="RNA",p.DNA="DNA",p.Generic="generic"))(e=l.Kind||={});function t(u){let c=u.code.toArray();return(c instanceof Array?c:Array.from(c)).join("")}l.getSequenceString=t;function r(u){for(let c=0,m=Math.min(u.rowCount,10);c<m;c++){let d=u.value(c)||"";if(Rj(d)!=="X")return"protein";if(Dj(d)!=="X")return"RNA";if(wj(d)!=="X")return"DNA"}return"generic"}function n(u,c){let m;switch(u){case"protein":m=Rj;break;case"DNA":m=wj;break;case"RNA":m=Dj;break;case"generic":m=()=>"X";break;default:Mr(u)}return c&&c.size>0?d=>{let p=m(d);return p!=="X"||!c.has(d)?p:m(c.get(d))}:m}function o(u,c){if(c.rowCount===0)throw new Error("cannot be empty");let m=r(u);return new i(m,u,c)}l.ofResidueNames=o;class i{constructor(c,m,d){this.kind=c;this.microHet=new Map;let p=n(c),h=[],f=[],g=[],y=new Map,x=0,S=new Map;for(let v=0,A=d.rowCount;v<A;++v){let P=d.value(v);if(S.has(P))y.has(P)?y.get(P).push(m.value(v)):y.set(P,[f[S.get(P)],m.value(v)]);else{S.set(P,x);let T=m.value(v);f[x]=T,g[x]=P,h[x]=p(T),x+=1}}let I=[];for(let v=0,A=x;v<A;++v){let P=y.get(g[v]);if(P){let T=P.map(R=>{let w=p(R);return w==="X"?R:w});I[v]=`(${T.join("|")})`}else I[v]=h[v]==="X"?f[v]:h[v]}this.length=x,this.code=W.ofStringArray(h),this.compId=W.ofStringArray(f),this.seqId=W.ofIntArray(g),this.label=W.ofStringArray(I),this.microHet=y,this.indexMap=S}index(c){return this.indexMap.get(c)}}function a(u,c){let m="generic";return new s(m,u,c)}l.ofSequenceRanges=a;class s{constructor(c,m,d){this.kind=c;this.seqIdStart=m;this.seqIdEnd=d;this.microHet=new Map;let p=0,h=Number.MAX_SAFE_INTEGER;for(let g=0,y=this.seqIdStart.rowCount;g<y;g++){let x=this.seqIdStart.value(g),S=this.seqIdEnd.value(g);x<h&&(h=x),p<S&&(p=S)}let f=p-h+1;this.code=W.ofConst("X",f,W.Schema.str),this.label=W.ofConst("",f,W.Schema.str),this.seqId=W.ofLambda({value:g=>g+h+1,rowCount:f,schema:W.Schema.int}),this.compId=W.ofConst("",f,W.Schema.str),this.length=f,this.minSeqId=h}index(c){return c-this.minSeqId}}})(XI||={});var rk;(a=>{let e={byEntityKey:{},sequences:[]};function t(...s){let l=[],u={};for(let c=0,m=s.length;c<m;++c)l.push(...s[c].sequences),Object.assign(u,s[c].byEntityKey);return{sequences:l,byEntityKey:u}}function r(s,l,u){let c=n(s,l),m=u.isDefined?o(s,u):e;return t(c,m)}a.fromHierarchy=r;function n(s,l){let{label_comp_id:u}=l.atoms,{label_seq_id:c}=l.residues,{chainAtomSegments:m,residueAtomSegments:d}=l,{count:p,offsets:h}=m,f={},g=[];if(p===1&&h[0]===0&&h[1]===0)return{byEntityKey:f,sequences:g};for(let y=0,x=l.chains._rowCount;y<x;y++){let S=l.index.getEntityFromChain(y);if(f[S]!==void 0||s.data.type.value(S)!=="polymer")continue;let I=y;for(y++;y<x&&S===l.index.getEntityFromChain(y)&&s.data.type.value(S)!=="polymer";)y++;y--;let v=d.index[h[I]],A=d.index[h[y+1]-1]+1,P=W.window(c,v,A),T=[];for(let w=v;w<A;++w)T.push(u.value(d.offsets[w]));let R=W.ofStringArray(T);f[S]={entityId:s.data.id.value(S),sequence:XI.ofResidueNames(R,P)},g.push(f[S])}return{byEntityKey:f,sequences:g}}a.fromAtomicHierarchy=n;function o(s,l){let u=i(s,l.spheres),c=i(s,l.gaussians);return t(u,c)}a.fromCoarseHierarchy=o;function i(s,l){let{chainElementSegments:u,seq_id_begin:c,seq_id_end:m}=l,{count:d,offsets:p}=u,h={},f=[];if(d===1&&p[0]===0&&p[1]===0)return{byEntityKey:h,sequences:f};for(let g=0,y=d;g<y;g++){let x=l.getEntityFromChain(g);if(h[x]!==void 0)continue;let S=g;for(g++;g<y&&x===l.getEntityFromChain(g);)g++;g--;let I=p[S],v=p[g+1]-1,A=W.window(c,I,v),P=W.window(m,I,v);h[x]={entityId:s.data.id.value(x),sequence:XI.ofSequenceRanges(A,P)},f.push(h[x])}return{byEntityKey:h,sequences:f}}a.fromCoarseElements=i})(rk||={});function Mj(e,t,r,n){if(!e.entity_poly_seq||!e.entity_poly_seq._rowCount)return rk.fromHierarchy(t,r,n);let{entity_id:o,num:i,mon_id:a}=e.entity_poly_seq,s={},l=[],u=o.rowCount,c=0;for(;c<u;){let m=c;for(;c<u-1&&o.areValuesEqual(c,c+1);)c++;c++;let d=o.value(m),p=W.window(a,m,c),h=W.window(i,m,c),f=t.getEntityIndex(d);s[f]={entityId:d,sequence:XI.ofResidueNames(p,h)},l.push(s[f])}return{byEntityKey:s,sequences:l}}async function Bj(e,t,r,n){let o=B2(r,n-1),{label_entity_id:i,label_asym_id:a,label_seq_id:s}=t,l=lE(o,i.value);e.shouldUpdate&&await e.update();for(let u=0,c=l.length-1;u<c;u++){let m=lE(o,a.value,{start:l[u],end:l[u+1]});for(let d=0,p=m.length-1;d<p;d++){let h=m[d];s.valueKind(h)===W.ValueKinds.Present&&(lE(o,s.value,{sort:!0,start:h,end:m[d+1]}),e.shouldUpdate&&await e.update())}e.shouldUpdate&&await e.update()}return qJ(o)&&o.length===t._rowCount?{atom_site:t,sourceIndex:W.ofIntArray(o)}:{atom_site:wr.view(t,t._schema,o),sourceIndex:W.ofIntArray(o)}}function vpe(e,t,r,n,o){let{polymerType:i,traceElementIndex:a,directionFromElementIndex:s,directionToElementIndex:l}=o.residue,u=i[e],c=i[t];if(u===0||c===0||a[e]===-1||a[t]===-1)return!1;let m=n.findAtomsOnResidue(e,sg(u,"backboneStart")),d=n.findAtomsOnResidue(t,sg(c,"backboneEnd"));(m===-1||d===-1)&&(m=n.findAtomsOnResidue(e,sg(u,"coarseBackbone")),d=n.findAtomsOnResidue(t,sg(c,"coarseBackbone")));let{x:p,y:h,z:f}=r,g=b.create(p[m],h[m],f[m]),y=b.create(p[d],h[d],f[d]),x=s[e]===-1||l[e]===-1||s[t]===-1||l[t]===-1;return b.distance(g,y)<(x?10:3)}function Ej(e,t,r,n){let o=[],i=[],a=new Map,s=Kt.transientSegments(e.chainAtomSegments,ye.ofBounds(0,e.atoms._rowCount)),l=Kt.transientSegments(e.residueAtomSegments,ye.ofBounds(0,e.atoms._rowCount)),{index:u,derived:c}=e,{label_seq_id:m}=e.residues,{label_entity_id:d}=e.chains,{moleculeType:p,traceElementIndex:h}=c.residue,f,g,y,x;for(;s.hasNext;){let S=s.move();l.setSegment(S),f=-1,g=-1,y=-1,x=-1;let I=t.getEntityIndex(d.value(S.index)),v=n.byEntityKey[I],A=v?v.sequence.seqId.value(v.sequence.seqId.rowCount-1):-1,P=e.residueAtomSegments.index[S.start],T=e.residueAtomSegments.index[S.end-1],R=m.value(P),w=m.value(T);for(R===1&&w===A&&r.xyzDefined&&vpe(P,T,r,u,c)&&(a.set(P,T),a.set(T,P));l.hasNext;){let E=l.move(),M=E.index,D=m.value(M);if(eC(p[M])&&h[M]!==-1)if(x!==-1)if(D!==f+1)o.push(x,y-1),i.push(g,E.end-1),x=E.start;else if(!l.hasNext)o.push(x,E.end-1);else{let B=e.residueAtomSegments.index[E.start],k=e.residueAtomSegments.index[y-1];r.xyzDefined&&!vpe(B,k,r,e.index,c)&&(o.push(x,y-1),i.push(g,E.end-1),x=E.start)}else x=E.start;else x!==-1&&(o.push(x,y-1),x=-1);g=E.start,y=E.end,f=D}}return{polymerRanges:Wn.ofSortedRanges(o),gapRanges:Wn.ofSortedRanges(i),cyclicPolymerMap:a}}function Ipe(e){let t=new Map,r=(o,i,a)=>`${o}|${i}|${a}`,n=e.pdbx_unobs_or_zero_occ_residues;for(let o=0,i=n._rowCount;o<i;++o){let a=r(n.PDB_model_num.value(o),n.label_asym_id.value(o),n.label_seq_id.value(o));t.set(a,{polymer_flag:n.polymer_flag.value(o),occupancy_flag:n.occupancy_flag.value(o)})}return{has:(o,i,a)=>t.has(r(o,i,a)),get:(o,i,a)=>t.get(r(o,i,a)),size:t.size}}function Ape(e){let t=new Map;if(e.chem_comp._rowCount>0){let{id:r}=e.chem_comp;for(let n=0,o=r.rowCount;n<o;++n)t.set(r.value(n),wr.getRow(e.chem_comp,n))}else Ppe(e).forEach(n=>{t.set(n,Pce(n))});return t}function Tpe(e){let t=new Map;if(e.pdbx_chem_comp_identifier._rowCount>0){let{comp_id:r,type:n,identifier:o}=e.pdbx_chem_comp_identifier;for(let i=0,a=r.rowCount;i<a;++i)if(n.value(i)==="SNFG CARBOHYDRATE SYMBOL"||n.value(i)==="SNFG CARB SYMBOL"){let s=o.value(i),l=ace.get(s);l?t.set(r.value(i),l):console.warn(`Unknown SNFG name '${s}'`)}}if(e.chem_comp._rowCount>0){let{id:r,type:n}=e.chem_comp;for(let o=0,i=r.rowCount;o<i;++o){let a=r.value(o);if(t.has(a))continue;let s=n.value(o);fp.has(a)?t.set(a,fp.get(a)):Ql(s,a)===9&&t.set(a,uE)}}else{let r=Ppe(e);fp.forEach((n,o)=>{!t.has(o)&&r.has(o)&&t.set(o,n)})}return t}var Ppe=zf(e=>{let t=new Set,{label_comp_id:r,auth_comp_id:n}=e.atom_site,o=r.isDefined?r:n;for(let i=0,a=o.rowCount;i<a;++i)t.add(o.value(i));return t});function kj(e,t){let r=new Map,{auth_asym_id:n,label_asym_id:o,label_entity_id:i}=e.chains;for(let a=0,s=e.chains._rowCount;a<s;a++){let l=o.value(a);r.set(l,{id:l,auth_id:n.value(a),entity_id:i.value(a)})}if(t?.struct_asym._rowCount){let{id:a,entity_id:s}=t.struct_asym;for(let l=0,u=a.rowCount;l<u;++l){let c=a.value(l);r.has(c)||r.set(c,{id:c,auth_id:"",entity_id:s.value(l)})}}return r}var _pe=W.Schema.Aliased(W.Schema.Str());function Fj(e){let t;if(e.entity.id.isDefined)t=e.entity;else{let s=new Set,l=[],u=[],{label_entity_id:c,label_comp_id:m}=e.atom_site;for(let h=0,f=e.atom_site._rowCount;h<f;h++){let g=c.value(h);s.has(g)||(l.push(g),u.push(_ce(m.value(h))),s.add(g))}let{entity_id:d}=e.ihm_sphere_obj_site;for(let h=0,f=e.ihm_sphere_obj_site._rowCount;h<f;h++){let g=d.value(h);s.has(g)||(l.push(g),u.push("polymer"),s.add(g))}let{entity_id:p}=e.ihm_gaussian_obj_site;for(let h=0,f=e.ihm_gaussian_obj_site._rowCount;h<f;h++){let g=p.value(h);s.has(g)||(l.push(g),u.push("polymer"),s.add(g))}t=wr.ofPartialColumns(Lo.entity,{id:W.ofArray({array:l,schema:Lo.entity.id}),type:W.ofArray({array:u,schema:Lo.entity.type})},l.length)}let r=W.createIndexer(t.id),n=new Array(t._rowCount);n.fill("other");let o=new Set,i=!1;if(e.entity_poly&&e.entity_poly.type.isDefined){let{entity_id:s,type:l,_rowCount:u}=e.entity_poly;for(let c=0;c<u;++c){let m=s.value(c);n[r(m)]=l.value(c),o.add(m)}}else i=!0;if(e.pdbx_entity_branch&&e.pdbx_entity_branch.entity_id.isDefined){let{entity_id:s,type:l,_rowCount:u}=e.pdbx_entity_branch;for(let c=0;c<u;++c){let m=s.value(c);n[r(m)]=l.value(c),o.add(m)}}else i=!0;if(o.size<n.length&&(i=!0),i){let s=new Map;if(e.chem_comp){let{id:l,type:u}=e.chem_comp;for(let c=0,m=e.chem_comp._rowCount;c<m;c++)s.set(l.value(c),u.value(c))}if(e.atom_site){let{label_entity_id:l,label_comp_id:u}=e.atom_site;for(let c=0,m=e.atom_site._rowCount;c<m;c++){let d=l.value(c);if(!o.has(d)){let p=u.value(c),h=s.get(p)||"other";n[r(d)]=Rce(p,h),o.add(d)}}}}let a=W.ofArray({array:n,schema:_pe});return{data:t,subtype:a,getEntityIndex:r}}function Lj(e,t,r){if(!e.pdbx_molecule||!e.pdbx_molecule.prd_id.isDefined)return t;let n=new Array(t.data._rowCount);n.fill("");let{asym_id:o,prd_id:i,_rowCount:a}=e.pdbx_molecule;for(let l=0;l<a;++l){let u=o.value(l),c=r.get(u)?.entity_id;c!==void 0&&(n[t.getEntityIndex(c)]=i.value(l))}let s=W.ofArray({array:n,schema:W.Schema.str});return{...t,prd_id:s}}var Rl=class{constructor(t){this.frames=t;this.frameCount=t.length,this.representative=t[0],this.duration=t.length}getFrameAtIndex(t){return this.frames[t]}};async function rs(e,t,r){let n=KWe(e,t),o=e.ihm_model_list._rowCount>0?await tXe(r,e,n,t):await eXe(r,e,n,t);for(let i=0;i<o.length;i++)Gt.TrajectoryInfo.set(o[i],{index:i,size:o.length});return new Rl(o)}function KWe(e,t){return{missingResidues:Ipe(e),chemicalComponentMap:Ape(e),saccharideComponentMap:Tpe(e)}}function JWe(e,t,r,n,o,i,a){let s=Sj(t,r,n,o.chemicalComponentMap,i,a),l=t.pdbx_PDB_model_num.value(0);if(a&&s.sameAsPrevious)return{...a,id:fn.create22(),modelNum:l,atomicConformation:s.conformation,_dynamicPropertyData:Object.create(null)};let u=_j,c=Mj(e,n,s.hierarchy,u.hierarchy),m=Ej(s.hierarchy,n,s.conformation,c),d=kj(s.hierarchy),p=e.entry.id.valueKind(0)===W.ValueKinds.Present?e.entry.id.value(0):i.name,h=[];return p&&h.push(p),e.struct.title.valueKind(0)===W.ValueKinds.Present&&h.push(e.struct.title.value(0)),{id:fn.create22(),entryId:p,label:h.join(" | "),entry:p,sourceData:i,modelNum:l,parent:void 0,entities:Lj(e,n,d),sequence:c,atomicHierarchy:s.hierarchy,atomicConformation:s.conformation,atomicRanges:m,atomicChainOperatorMappinng:s.chainOperatorMapping,coarseHierarchy:u.hierarchy,coarseConformation:u.conformation,properties:{...o,structAsymMap:d},customProperties:new $a,_staticPropertyData:Object.create(null),_dynamicPropertyData:Object.create(null)}}function $We(e,t,r,n){let o=Sj(t.atom_site,t.atom_site_sourceIndex,t.entities,r.chemicalComponentMap,n),i=Spe(t,r.chemicalComponentMap),a=Mj(e,t.entities,o.hierarchy,i.hierarchy),s=Ej(o.hierarchy,t.entities,o.conformation,a),l=e.entry.id.valueKind(0)===W.ValueKinds.Present?e.entry.id.value(0):n.name,u=[];l&&u.push(l),e.struct.title.valueKind(0)===W.ValueKinds.Present&&u.push(e.struct.title.value(0)),t.model_name&&u.push(t.model_name),t.model_group_name&&u.push(t.model_group_name);let c=kj(o.hierarchy,e);return{id:fn.create22(),entryId:l,label:u.join(" | "),entry:l,sourceData:n,modelNum:t.model_id,parent:void 0,entities:Lj(e,t.entities,c),sequence:a,atomicHierarchy:o.hierarchy,atomicConformation:o.conformation,atomicRanges:s,atomicChainOperatorMappinng:o.chainOperatorMapping,coarseHierarchy:i.hierarchy,coarseConformation:i.conformation,properties:{...r,structAsymMap:c},customProperties:new $a,_staticPropertyData:Object.create(null),_dynamicPropertyData:Object.create(null)}}function Rpe(e,t){let r=e.rowCount;if(!e.isDefined)return r;let n=t+1;for(;n<r&&e.areValuesEqual(t,n);)n++;return n}async function eXe(e,t,r,n){let o=[];if(t.atom_site){let i=t.atom_site.id.rowCount,a=Fj(t),s=0;for(;s<i;){let l=Rpe(t.atom_site.pdbx_PDB_model_num,s),{atom_site:u,sourceIndex:c}=await Bj(e,t.atom_site,s,l),m=JWe(t,u,c,a,r,n,o.length>0?o[o.length-1]:void 0);o.push(m),s=l}}return o}function Vj(e,t){let r=new Map,n=e._rowCount,o=0;for(;o<n;){let i=Rpe(t,o),a=t.value(o);r.set(a,{table:wr.window(e,e._schema,o,i),start:o,end:i}),o=i}return r}async function tXe(e,t,r,n){let o=Fj(t),i=t.atom_site.ihm_model_id.isDefined?t.atom_site.ihm_model_id:t.atom_site.pdbx_PDB_model_num,a=Vj(t.atom_site,i),s=Vj(t.ihm_sphere_obj_site,t.ihm_sphere_obj_site.model_id),l=Vj(t.ihm_gaussian_obj_site,t.ihm_gaussian_obj_site.model_id),u=[];if(t.ihm_model_list){let{model_id:c,model_name:m}=t.ihm_model_list;for(let d=0;d<t.ihm_model_list._rowCount;d++){let p=c.value(d),h,f;if(a.has(p)){let x=a.get(p),{atom_site:S,sourceIndex:I}=await Bj(e,t.atom_site,x.start,x.end);h=S,f=I}else h=wr.window(t.atom_site,t.atom_site._schema,0,0),f=W.ofIntArray([]);let g={model_id:p,model_name:m.value(d),model_group_name:rpe(p,t),entities:o,atom_site:h,atom_site_sourceIndex:f,ihm_sphere_obj_site:s.has(p)?s.get(p).table:wr.window(t.ihm_sphere_obj_site,t.ihm_sphere_obj_site._schema,0,0),ihm_gaussian_obj_site:l.has(p)?l.get(p).table:wr.window(t.ihm_gaussian_obj_site,t.ihm_gaussian_obj_site._schema,0,0)},y=$We(t,g,r,n);u.push(y)}}return u}var Gt;(fe=>{function e(O,V){let Z=[],{frames:pe}=V,$=t(O),ae=R(O),Se=O.atomicHierarchy.atoms._rowCount;for(let ve=0,K=pe.length;ve<K;++ve){let re=pe[ve];if(re.elementCount!==Se)throw new Error(`Frame element count mismatch, got ${re.elementCount} but expected ${Se}.`);let le={...O,id:fn.create22(),modelNum:ve,atomicConformation:o(O,re),customProperties:new $a,_staticPropertyData:Object.create(null),_dynamicPropertyData:Object.create(null)};if(re.cell){let ge=Qo.fromCell(re.cell.size,re.cell.anglesInRadians);Qo.Provider.set(le,ge)}fe.TrajectoryInfo.set(le,{index:ve,size:pe.length}),fe.CoarseGrained.set(le,ae),Z.push(le)}return{trajectory:Z,srcIndexArray:$}}function t(O){let V=O.atomicHierarchy.atomSourceIndex,Z;return"__srcIndexArray__"in O._staticPropertyData?Z=O._dynamicPropertyData.__srcIndexArray__:(Z=W.isIdentity(V)?void 0:V.toArray({array:Int32Array}),O._dynamicPropertyData.__srcIndexArray__=Z),Z}function r(O,V){return new Rl(e(O,V).trajectory)}fe.trajectoryFromModelAndCoordinates=r;function n(O,V){return Ae.create("Create Trajectory",async Z=>{let pe=await rs(O.basic,O.sourceData,Z);if(pe.frameCount===0)throw new Error("found no model");let $=pe.representative,{trajectory:ae}=e($,V),Se={pairs:O.bonds,count:$.atomicHierarchy.atoms._rowCount},ve=Xo.fromData(Se),K=R($),re=0;for(let le of ae)Xo.Provider.set(le,ve),fe.TrajectoryInfo.set(le,{index:re++,size:ae.length}),fe.CoarseGrained.set(le,K);return new Rl(ae)})}fe.trajectoryFromTopologyAndCoordinates=n;function o(O,V){return vd.getAtomicConformation(V,{atomId:O.atomicConformation.atomId,occupancy:O.atomicConformation.occupancy,B_iso_or_equiv:O.atomicConformation.B_iso_or_equiv},t(O))}fe.getAtomicConformationFromFrame=o;let i="__Center__";function a(O){if(O._dynamicPropertyData[i])return O._dynamicPropertyData[i];let V=tce(O.atomicConformation,O.coarseConformation);return O._dynamicPropertyData[i]=V,V}fe.getCenter=a;let s="__AtomicRadii__";function l(O){if(O._dynamicPropertyData[s])return O._dynamicPropertyData[s];let V=O.atomicHierarchy.atoms._rowCount,Z=O.atomicHierarchy.atoms.type_symbol.value,pe=new Float32Array(V);for(let $=0;$<V;$++)pe[$]=Dm(Z($));return O._dynamicPropertyData[s]=pe,pe}fe.getAtomicRadii=l;function u(O){let V=new Int32Array(O.rowCount),Z=!1;for(let pe=0,$=O.rowCount;pe<$;pe++){let ae=O.value(pe);ae!==pe&&(Z=!1),V[ae]=pe}return{isIdentity:Z,invertedIndex:V}}let c="__InvertedAtomSrcIndex__";function m(O){if(O._staticPropertyData[c])return O._staticPropertyData[c];let V=u(O.atomicHierarchy.atomSourceIndex);return O._staticPropertyData[c]=V,V}fe.getInvertedAtomSourceIndex=m;let d="__TrajectoryInfo__";fe.TrajectoryInfo={get(O){return O._dynamicPropertyData[d]||{index:0,size:1}},set(O,V){return O._dynamicPropertyData[d]=V}};let h="__AsymIdCount__";fe.AsymIdCount={get(O){if(O._dynamicPropertyData[h])return O._dynamicPropertyData[h];let V=rce(O);return O._dynamicPropertyData[h]=V,V}},fe.AsymIdOffset=_d.createSimple("asym_id_offset","static"),fe.Index=_d.createSimple("index","static"),fe.MaxIndex=_d.createSimple("max_index","static");function S(O){return O.parent||O}fe.getRoot=S;function I(O,V){return O.atomicHierarchy===V.atomicHierarchy&&O.coarseHierarchy===V.coarseHierarchy}fe.areHierarchiesEqual=I;let v="__CoordinatesHistory__";fe.CoordinatesHistory={get(O){return O._staticPropertyData[v]},set(O,V){return O._staticPropertyData[v]=V}};let P="__CoarseGrained__";fe.CoarseGrained={get(O){return O._staticPropertyData[P]},set(O,V){return O._staticPropertyData[P]=V}};function R(O){let V=fe.CoarseGrained.get(O);if(V===void 0){let Z=0,pe=0,{polymerType:$,directionToElementIndex:ae}=O.atomicHierarchy.derived.residue;for(let le=0;le<$.length;++le)$[le]!==0&&(Z+=1,ae[le]!==-1&&(pe+=1));let Se=!1,ve=!1,{label_atom_id:K,_rowCount:re}=O.atomicHierarchy.atoms;for(let le=0;le<re;++le){let ge=K.value(le);if(!Se&&ge==="BB"&&(Se=!0),!ve&&ge==="SC1"&&(ve=!0),Se&&ve)break}V=!1,re>0&&Z>0&&(Se&&ve||re/Z<3||pe===0)&&(V=!0),fe.CoarseGrained.set(O,V)}return V}fe.isCoarseGrained=R;function w(O){return O.properties.saccharideComponentMap.size>0}fe.hasCarbohydrate=w;function E(O){let{subtype:V}=O.entities;for(let Z=0,pe=V.rowCount;Z<pe;++Z)if(V.value(Z).startsWith("polypeptide"))return!0;return!1}fe.hasProtein=E;function M(O){let{subtype:V}=O.entities;for(let Z=0,pe=V.rowCount;Z<pe;++Z){let $=V.value(Z);if($.endsWith("ribonucleotide hybrid")||$.endsWith("ribonucleotide"))return!0}return!1}fe.hasNucleic=M;function D(O){if(!Ln.is(O.sourceData))return!1;let{db:V}=O.sourceData.data;for(let Z=0,pe=V.database_2.database_id.rowCount;Z<pe;++Z)if(V.database_2.database_id.value(Z)==="pdb")return!0;return!1}fe.isFromPdbArchive=D;function B(O){return Ln.is(O.sourceData)?O.entryId.match(/^[1-9][a-z0-9]{3,3}$/i)!==null||O.entryId.match(/^pdb_[0-9]{4,4}[1-9][a-z0-9]{3,3}$/i)!==null:!1}fe.hasPdbId=B;function k(O){if(Ln.is(O.sourceData)){let{db:V}=O.sourceData.data;return V.struct_conf.id.isDefined||V.struct_sheet_range.id.isDefined}else return lg.Provider.isApplicable(O)}fe.hasSecondaryStructure=k;let F=b.create(1.5707963,1.5707963,1.5707963),z=b.create(1,1,1);function j(O){let V=Qo.Provider.get(O)?.spacegroup;return!!V&&!(V.num===1&&b.equals(V.cell.anglesInRadians,F)&&b.equals(V.cell.size,z))}fe.hasCrystalSymmetry=j;function Y(O){if(!Ln.is(O.sourceData))return!1;let{db:V}=O.sourceData.data;for(let Z=0;Z<V.exptl.method.rowCount;Z++)if(V.exptl.method.value(Z).toUpperCase().indexOf("DIFFRACTION")>=0)return!0;return!1}fe.isFromXray=Y;function G(O){if(!Ln.is(O.sourceData))return!1;let{db:V}=O.sourceData.data;for(let Z=0;Z<V.exptl.method.rowCount;Z++)if(V.exptl.method.value(Z).toUpperCase().indexOf("MICROSCOPY")>=0)return!0;return!1}fe.isFromEm=G;function X(O){if(!Ln.is(O.sourceData))return!1;let{db:V}=O.sourceData.data;for(let Z=0;Z<V.exptl.method.rowCount;Z++)if(V.exptl.method.value(Z).toUpperCase().indexOf("NMR")>=0)return!0;return!1}fe.isFromNmr=X;function U(O){if(!Ln.is(O.sourceData))return!1;let{db:V}=O.sourceData.data;for(let Z=0;Z<V.struct.pdbx_structure_determination_methodology.rowCount;Z++)if(V.struct.pdbx_structure_determination_methodology.value(Z).toLowerCase()==="experimental")return!0;return!1}fe.isExperimental=U;function L(O){if(!Ln.is(O.sourceData))return!1;let{db:V}=O.sourceData.data;for(let Z=0;Z<V.struct.pdbx_structure_determination_methodology.rowCount;Z++)if(V.struct.pdbx_structure_determination_methodology.value(Z).toLowerCase()==="integrative")return!0;return!1}fe.isIntegrative=L;function q(O){if(!Ln.is(O.sourceData))return!1;let{db:V}=O.sourceData.data;for(let Z=0;Z<V.struct.pdbx_structure_determination_methodology.rowCount;Z++)if(V.struct.pdbx_structure_determination_methodology.value(Z).toLowerCase()==="computational")return!0;return!1}fe.isComputational=q;function te(O){if(!Ln.is(O.sourceData)||!Y(O))return!1;let{db:V}=O.sourceData.data,{status_code_sf:Z}=V.pdbx_database_status;return Z.isDefined&&Z.value(0)==="REL"}fe.hasXrayMap=te;function J(O){if(!Ln.is(O.sourceData))return!1;let{db:V}=O.sourceData.data,{db_name:Z,content_type:pe}=V.pdbx_database_related;for(let $=0,ae=V.pdbx_database_related._rowCount;$<ae;++$)if(Z.value($).toUpperCase()==="EMDB"&&pe.value($)==="associated EM volume")return!0;return!1}fe.hasEmMap=J;function ee(O){return Ln.is(O.sourceData)?te(O)||J(O):!1}fe.hasDensityMap=ee;function ce(O){if(!Ln.is(O.sourceData)||fe.isIntegrative(O))return!1;let{db:V}=O.sourceData.data;return ee(O)||B(O)&&(!V.exptl.method.isDefined||Y(O)&&(!V.pdbx_database_status.status_code_sf.isDefined||V.pdbx_database_status.status_code_sf.valueKind(0)===W.ValueKinds.Unknown)||G(O)&&!V.pdbx_database_related.db_name.isDefined)}fe.probablyHasDensityMap=ce})(Gt||={});var rXe;(c=>{function e(m,d,p){if(!d)return{rowCount:0};if(p&&p[d.id])return p[d.id];let h=d.getElements(m),f={data:h,rowCount:h.elements.length};return p&&(p[d.id]=f),f}c.getCifDataSource=e;function t(m){return new nk(m)}c.fromAtomMap=t;function r(m){return new nk(Oj(m))}c.fromAtomArray=r;let n=m=>m.atomicHierarchy.residueAtomSegments;function o(m){return new QI("residue",m,n,ue.Kind.Atomic)}c.fromResidueMap=o;function i(m){return new QI("residue",Oj(m),n,ue.Kind.Atomic)}c.fromResidueArray=i;let a=m=>m.atomicHierarchy.chainAtomSegments;function s(m){return new QI("chain",m,a,ue.Kind.Atomic)}c.fromChainMap=s;function l(m){return new QI("chain",Oj(m),a,ue.Kind.Atomic)}c.fromChainArray=l;function u(m){return new Gj(m)}c.fromEntityMap=u})(rXe||={});function Oj(e){let t=new Map;for(let r=0,n=e.length;r<n;r++)t.set(r,e[r]);return t}var QI=class{constructor(t,r,n,o){this.level=t;this.map=r;this.segmentGetter=n;this.id=fn.create22();this.kind=o}has(t){return this.map.has(t)}get(t){return this.map.get(t)}getStructureElements(t){let r=t.models;if(r.length!==1)throw new Error("Only works on structures with a single model.");let n=new Set,o=t.unitSymmetryGroups,i=[],a=this.segmentGetter(r[0]);for(let s of o){let l=s.units[0];if(l.kind!==this.kind)continue;let u=Kt.transientSegments(a,l.elements);for(;u.hasNext;){let c=u.move();!this.has(c.index)||n.has(c.index)||(n.add(c.index),i[i.length]=Q.Location.create(t,l,l.elements[c.start]))}}return i.sort((s,l)=>s.element-l.element),i}getElements(t){let r=this.segmentGetter(t.model).index,n=this.getStructureElements(t);return{elements:n,property:o=>this.get(r[n[o].element])}}},nk=class{constructor(t){this.map=t;this.id=fn.create22();this.level="atom";this.kind=ue.Kind.Atomic}has(t){return this.map.has(t)}get(t){return this.map.get(t)}getStructureElements(t){if(t.models.length!==1)throw new Error("Only works on structures with a single model.");let n=new Set,o=t.unitSymmetryGroups,i=[];for(let a of o){let s=a.units[0];if(s.kind!==this.kind)continue;let l=s.elements;for(let u=0,c=l.length;u<c;u++){let m=l[u];!this.has(m)||n.has(m)||(n.add(l[u]),i[i.length]=Q.Location.create(t,s,m))}}return i.sort((a,s)=>a.element-s.element),i}getElements(t){let r=this.getStructureElements(t);return{elements:r,property:n=>this.get(r[n].element)}}},Gj=class{constructor(t){this.map=t;this.id=fn.create22();this.level="entity";this.kind=ue.Kind.Atomic}has(t){return this.map.has(t)}get(t){return this.map.get(t)}getStructureElements(t){let r=t.models;if(r.length!==1)throw new Error("Only works on structures with a single model.");let n=r[0].atomicHierarchy.index,o=new Set,i=t.unitSymmetryGroups,a=[],s=r[0].atomicHierarchy.chainAtomSegments;for(let l of i){let u=l.units[0];if(u.kind!==this.kind)continue;let c=Kt.transientSegments(s,u.elements);for(;c.hasNext;){let m=c.move(),d=n.getEntityFromChain(m.index);!this.has(d)||o.has(d)||(o.add(d),a[a.length]=Q.Location.create(t,u,u.elements[m.start]))}}return a.sort((l,u)=>l.element-u.element),a}getElements(t){let r=this.getStructureElements(t),n=t.model.atomicHierarchy.chainAtomSegments.index,o=t.model.atomicHierarchy.index;return{elements:r,property:i=>this.get(o.getEntityFromChain(n[r[i].element]))}}};function nR(e){return C.Converted(Dpe,nXe,C.Text(Dpe(null),{...e,disableInteractiveUpdates:!0,placeholder:e?.placeholder??"null"}))}function nXe(e){let t=parseFloat(e);return isNaN(t)?null:t}function Dpe(e){return e===null?"":e.toString()}function Uj(e){return C.Converted(wpe,oXe,C.Text(wpe(null),{...e,placeholder:e?.placeholder??"null"}))}function oXe(e){return e===""?null:e}function wpe(e){return e===null?"":e}async function Bpe(e){try{return{ok:!0,value:await e}}catch(t){return{ok:!1,error:t}}}var jf=class{constructor(){this._map=new Map}get(t){return this._map.get(t)}add(t,r){this._map.has(t)||this._map.set(t,[]),this._map.get(t).push(r)}},oR=class{constructor(t){this.limit=t;this.array=new Array(t),this.map=new Map}get(t){return 0<=t&&t<this.limit?this.array[t]:this.map.get(t)}set(t,r){0<=t&&t<this.limit?this.array[t]=r:this.map.set(t,r)}};function en(e){return e!=null}function mC(...e){return e.some(en)}function ok(e){return e.filter(t=>t!=null)}function Mpe(e){return(q0(e)>>>0).toString(16).padStart(8,"0")}function ik(e){let t=e.split("").reverse().join("");return Mpe(e)+Mpe(t)}function Zo(e){return typeof e=="number"?e:Vx(e)}function Epe(e,t){let r={};for(let n of Object.keys(t)){let o=t[n],i=!1;for(let a of e)if(a.is(o)){i=!0;break}if(!(!i||!o.tags)){for(let a of o.tags)if(a.startsWith("mvs-ref:")){r[a.substring(8)]=o.data;break}}}return r}function kpe(e,t,r){if(t)for(let n of Object.keys(t)){let o=t[n],i=!1;for(let a of e)if(a.is(o)){i=!0;break}if(!(!i||!o.tags)){for(let a of o.tags)if(a.startsWith("mvs-ref:")&&a.substring(8)===r)return o}}}var dC=class{constructor(t,r){this.defaultValue=r,this.options=Object.keys(t).map(n=>[n,t[n]]),this.nameDict=t}PDSelect(t,r){return C.Select(t??this.defaultValue,this.options,r)}prettyName(t){return this.nameDict[t]}get values(){return this.options.map(([t,r])=>t)}};var zi={count(e){return e.from.length},empty(){return{from:[],to:[]}},single(e,t){return{from:[e],to:[t]}},add(e,t,r){let n=zi.count(e);if(n>0){let o=e.to[n-1];if(t<o)throw new Error("Overlapping ranges not allowed");t===o?e.to[n-1]=r:(e.from.push(t),e.to.push(r))}else e.from.push(t),e.to.push(r);return e},foreach(e,t){let r=zi.count(e);for(let n=0;n<r;n++)t(e.from[n],e.to[n])},map(e,t){let r=zi.count(e),n=new Array(r);for(let o=0;o<r;o++)n[o]=t(e.from[o],e.to[o]);return n},union(e){let t=zi.empty();for(let i of e)i&&(ex(t.from,i.from),ex(t.to,i.to));let r=Vl(t.from.length).sort((i,a)=>t.from[i]-t.from[a]),n=zi.empty(),o=-1;for(let i of r){let a=t.from[i],s=t.to[i];o>=0&&a<=n.to[o]?s>n.to[o]&&(n.to[o]=s):(n.from.push(a),n.to.push(s),o++)}return n},selectElementsInRanges(e,t,r,n={}){r??=[],r.length=0,n.value=void 0;let o=e.length,i=zi.count(t);if(o<=i){let a=Be.findPredecessorIndex(Be.ofSortedArray(t.to),e[0]+1);for(let s=0;s<o;s++){let l=e[s];for(;a<i&&t.to[a]<=l;)a++;a<i&&t.from[a]<=l&&(r.push(l),n.value??=s)}}else for(let a=0;a<i;a++){let s=t.from[a],l=t.to[a];for(let u=Be.findPredecessorIndex(e,s);u<o;u++){let c=e[u];if(c<l)r.push(c),n.value??=u;else break}}return r}};var ak={get(e){return e._dynamicPropertyData["indices-and-sortings"]??=this.create(e)},create(e){return{atomic:iXe(e),spheres:Fpe(e.coarseHierarchy.spheres),gaussians:Fpe(e.coarseHierarchy.gaussians)}}};function iXe(e){let t=e.atomicHierarchy,r=t.atoms._rowCount;if(r===0)return;let n=t.chains._rowCount,{label_entity_id:o,label_asym_id:i,auth_asym_id:a}=t.chains,{label_seq_id:s,auth_seq_id:l,pdbx_PDB_ins_code:u}=t.residues,{label_comp_id:c,auth_comp_id:m}=t.atoms,{Present:d}=W.ValueKind,p=new jf,h=new jf,f=new jf,g=new Map,y=new Map,x=new Map,S=new Map,I=new Map,v=!0,A=new Map,P=!0,T=new oR(r+1),R=new oR(r),w=new Set,E=new Set;for(let B=0;B<n;B++){p.add(o.value(B),B),h.add(i.value(B),B),f.add(a.value(B),B);let k=t.residueAtomSegments.index[t.chainAtomSegments.offsets[B]],F=t.residueAtomSegments.index[t.chainAtomSegments.offsets[B+1]-1]+1,z=Dh(Vl(k,F),L=>s.valueKind(L)===d);g.set(B,Wf.create(z,s.value));let j=Dh(Vl(k,F),L=>l.valueKind(L)===d);y.set(B,Wf.create(j,l.value));let Y=Vl(k,F);x.set(B,Wf.create(Y,t.residueSourceIndex.value));let G=new jf,X=new jf,U=new jf;for(let L=k;L<F;L++){u.valueKind(L)===d&&G.add(u.value(L),L);let q=t.residueAtomSegments.offsets[L],te=t.residueAtomSegments.offsets[L+1];for(let J=q;J<te;J++)w.add(c.value(J)),E.add(m.value(J));w.size>1&&(v=!1),E.size>1&&(P=!1);for(let J of w)X.add(J,L);for(let J of E)U.add(J,L);w.clear(),E.clear()}S.set(B,G),I.set(B,X),A.set(B,U)}let M=e.atomicConformation.atomId.value,D=t.atomSourceIndex.value;for(let B=0;B<r;B++)T.set(M(B),B),R.set(D(B),B);return{chainsByLabelEntityId:p,chainsByLabelAsymId:h,chainsByAuthAsymId:f,residuesSortedByLabelSeqId:g,residuesSortedByAuthSeqId:y,residuesSortedBySourceIndex:x,residuesByInsCode:S,residuesByLabelCompId:I,residuesByLabelCompIdIsPure:v,residuesByAuthCompId:A,residuesByAuthCompIdIsPure:P,atomsById:T,atomsBySourceIndex:R}}function Fpe(e){if(e.count===0)return;let{entity_id:t,asym_id:r,seq_id_begin:n,seq_id_end:o,chainElementSegments:i}=e,{Present:a}=W.ValueKind,s=Math.max(i.count,0),l=new jf,u=new jf,c=new Map,m={count:s,label_entity_id:new Array(s),label_asym_id:new Array(s)};for(let d=0;d<s;d++){let p=i.offsets[d],h=i.offsets[d+1],f=t.value(p),g=r.value(p);m.label_entity_id[d]=f,m.label_asym_id[d]=g,l.add(f,d),u.add(g,d);let y=Dh(Vl(p,h),I=>n.valueKind(I)===a&&o.valueKind(I)===a),x=Wf.create(y,n.value),S=x.keys.map(o.value);for(let I=1;I<S.length;I++)S[I-1]>S[I]&&(S[I]=S[I-1]);c.set(d,{...x,endUpperBounds:Be.ofSortedArray(S)})}return{chains:m,chainsByEntityId:l,chainsByAsymId:u,elementsSortedBySeqIdBegin:c}}var Wf={create(e,t){GP(e,(n,o)=>t(n)-t(o)||n-o);let r=Be.ofSortedArray(e.map(t));return{keys:e,values:r}},getKeysWithValue(e,t){return Wf.getKeysWithValueInRange(e,t,t)},getKeysWithValueInRange(e,t,r){let{keys:n,values:o}=e;if(!n)return[];let i=n.length,a=t!==void 0?Be.findPredecessorIndex(o,t):0,s;if(r!==void 0)for(s=a;s<i&&o[s]<=r;)s++;else s=i;return n.slice(a,s)}};var{str:Xf,int:rb}=W.Schema,Lpe=new dC({whole_structure:"Whole Structure",entity:"Entity",chain:"Chain (label*)",auth_chain:"Chain (auth*)",residue:"Residue (label*)",auth_residue:"Residue (auth*)",residue_range:"Residue range (label*)",auth_residue_range:"Residue range (auth*)",atom:"Atom (label*)",auth_atom:"Atom (auth*)",all_atomic:"All atomic selectors"},"all_atomic");function Nj(e){return Ll(Vpe,aXe[e])}var Vpe={group_id:Xf,label_entity_id:Xf,label_asym_id:Xf,auth_asym_id:Xf,label_seq_id:rb,auth_seq_id:rb,pdbx_PDB_ins_code:Xf,beg_label_seq_id:rb,end_label_seq_id:rb,beg_auth_seq_id:rb,end_auth_seq_id:rb,label_comp_id:Xf,auth_comp_id:Xf,residue_index:rb,label_atom_id:Xf,auth_atom_id:Xf,type_symbol:Xf,atom_id:rb,atom_index:rb,instance_id:Xf},aXe={whole_structure:["group_id"],entity:["group_id","label_entity_id"],chain:["group_id","label_entity_id","label_asym_id"],auth_chain:["group_id","auth_asym_id"],residue:["group_id","label_entity_id","label_asym_id","label_seq_id","residue_index"],auth_residue:["group_id","auth_asym_id","auth_seq_id","pdbx_PDB_ins_code","residue_index"],residue_range:["group_id","label_entity_id","label_asym_id","beg_label_seq_id","end_label_seq_id"],auth_residue_range:["group_id","auth_asym_id","beg_auth_seq_id","end_auth_seq_id"],atom:["group_id","label_entity_id","label_asym_id","label_seq_id","residue_index","label_atom_id","type_symbol","atom_id","atom_index"],auth_atom:["group_id","auth_asym_id","auth_seq_id","pdbx_PDB_ins_code","residue_index","auth_atom_id","type_symbol","atom_id","atom_index"],all_atomic:Object.keys(Vpe)};var pC=[];function zj(e,t,r,n){if(!n.atomic||en(e.instance_id)&&e.instance_id!==r)return;let o=n.atomic,i=t.atomicHierarchy,a=i.atoms._rowCount;if(a===0)return;let s=mC(e.atom_id,e.atom_index),l=mC(e.label_atom_id,e.auth_atom_id,e.type_symbol)||en(e.label_comp_id)&&!o.residuesByLabelCompIdIsPure||en(e.auth_comp_id)&&!o.residuesByAuthCompIdIsPure,u=mC(e.label_seq_id,e.auth_seq_id,e.pdbx_PDB_ins_code,e.beg_label_seq_id,e.end_label_seq_id,e.beg_auth_seq_id,e.end_auth_seq_id,e.label_comp_id,e.auth_comp_id,e.residue_index),c=mC(e.label_asym_id,e.auth_asym_id,e.label_entity_id);if(s){let f=cXe(t,e,o);return f!==void 0?zi.single(f,f+1):void 0}if(!c&&!u&&!l)return zi.single(0,a);let m=sXe(t,e,o);if(!u&&!l){let f=i.chainAtomSegments.offsets,g=zi.empty();for(let y of m)zi.add(g,f[y],f[y+1]);return g}let d=lXe(t,e,o,m);if(!l){let f=i.residueAtomSegments.offsets,g=zi.empty();for(let y of d)zi.add(g,f[y],f[y+1]);return g}let p=uXe(t,e,o,d),h=zi.empty();for(let f of p)zi.add(h,f,f+1);return h}function Upe(e,t,r,n){return zi.union(e.map(o=>zj(o,t,r,n)))}function sXe(e,t,r){let{auth_asym_id:n,label_entity_id:o,_rowCount:i}=e.atomicHierarchy.chains,a;return en(t.label_asym_id)&&(a=r.chainsByLabelAsymId.get(t.label_asym_id)??pC),en(t.auth_asym_id)&&(a?a=a.filter(s=>n.value(s)===t.auth_asym_id):a=r.chainsByAuthAsymId.get(t.auth_asym_id)??pC),en(t.label_entity_id)&&(a?a=a.filter(s=>o.value(s)===t.label_entity_id):a=r.chainsByLabelEntityId.get(t.label_entity_id)??pC),a??=Vl(i),a}function lXe(e,t,r,n){let{label_seq_id:o,auth_seq_id:i,pdbx_PDB_ins_code:a}=e.atomicHierarchy.residues,{label_comp_id:s,auth_comp_id:l}=e.atomicHierarchy.atoms,{residueAtomSegments:u,chainAtomSegments:c,residueSourceIndex:m}=e.atomicHierarchy,{Present:d}=W.ValueKind,p=[];for(let h of n){let f;if(en(t.label_seq_id)){let g=r.residuesSortedByLabelSeqId.get(h);f=Wf.getKeysWithValue(g,t.label_seq_id)}if(en(t.auth_seq_id))if(f)f=f.filter(g=>i.valueKind(g)===d&&i.value(g)===t.auth_seq_id);else{let g=r.residuesSortedByAuthSeqId.get(h);f=Wf.getKeysWithValue(g,t.auth_seq_id)}if(en(t.residue_index))if(f)f=f.filter(g=>m.value(g)===t.residue_index);else{let g=r.residuesSortedBySourceIndex.get(h);f=Wf.getKeysWithValue(g,t.residue_index)}if(en(t.pdbx_PDB_ins_code)&&(f?f=f.filter(g=>a.value(g)===t.pdbx_PDB_ins_code):f=r.residuesByInsCode.get(h).get(t.pdbx_PDB_ins_code)??pC),en(t.beg_label_seq_id)||en(t.end_label_seq_id))if(f)en(t.beg_label_seq_id)&&(f=f.filter(g=>o.valueKind(g)===d&&o.value(g)>=t.beg_label_seq_id)),en(t.end_label_seq_id)&&(f=f.filter(g=>o.valueKind(g)===d&&o.value(g)<=t.end_label_seq_id));else{let g=r.residuesSortedByLabelSeqId.get(h);f=Wf.getKeysWithValueInRange(g,t.beg_label_seq_id,t.end_label_seq_id)}if(en(t.beg_auth_seq_id)||en(t.end_auth_seq_id))if(f)en(t.beg_auth_seq_id)&&(f=f.filter(g=>i.valueKind(g)===d&&i.value(g)>=t.beg_auth_seq_id)),en(t.end_auth_seq_id)&&(f=f.filter(g=>i.valueKind(g)===d&&i.value(g)<=t.end_auth_seq_id));else{let g=r.residuesSortedByAuthSeqId.get(h);f=Wf.getKeysWithValueInRange(g,t.beg_auth_seq_id,t.end_auth_seq_id)}if(en(t.label_comp_id)&&(f?r.residuesByLabelCompIdIsPure?f=f.filter(g=>s.value(u.offsets[g])===t.label_comp_id):f=f.filter(g=>{for(let y=u.offsets[g],x=u.offsets[g+1];y<x;y++)if(s.value(y)===t.label_comp_id)return!0}):f=r.residuesByLabelCompId.get(h).get(t.label_comp_id)??pC),en(t.auth_comp_id)&&(f?r.residuesByAuthCompIdIsPure?f=f.filter(g=>l.value(u.offsets[g])===t.auth_comp_id):f=f.filter(g=>{for(let y=u.offsets[g],x=u.offsets[g+1];y<x;y++)if(l.value(y)===t.auth_comp_id)return!0}):f=r.residuesByAuthCompId.get(h).get(t.auth_comp_id)??pC),!f){let g=u.index[c.offsets[h]],y=u.index[c.offsets[h+1]-1]+1;f=Vl(g,y)}ex(p,f)}return GP(p,(h,f)=>h-f),p}function uXe(e,t,r,n){let{label_atom_id:o,auth_atom_id:i,type_symbol:a,label_comp_id:s,auth_comp_id:l}=e.atomicHierarchy.atoms,u=e.atomicHierarchy.residueAtomSegments.offsets,c=[];for(let m of n){let d=Vl(u[m],u[m+1]);en(t.label_atom_id)&&Dh(d,p=>o.value(p)===t.label_atom_id),en(t.auth_atom_id)&&Dh(d,p=>i.value(p)===t.auth_atom_id),en(t.type_symbol)&&Dh(d,p=>a.value(p)===t.type_symbol?.toUpperCase()),en(t.label_comp_id)&&!r.residuesByLabelCompIdIsPure&&Dh(d,p=>s.value(p)===t.label_comp_id),en(t.auth_comp_id)&&!r.residuesByAuthCompIdIsPure&&Dh(d,p=>l.value(p)===t.auth_comp_id),ex(c,d)}return c}function cXe(e,t,r){let n;if(!en(t.atom_id)&&!en(t.atom_index))throw new Error("ArgumentError: at least one of row.atom_id, row.atom_index must be defined.");if(en(t.atom_id)&&en(t.atom_index)){let o=r.atomsById.get(t.atom_id),i=r.atomsBySourceIndex.get(t.atom_index);if(o!==i)return;n=o}if(en(t.atom_id)&&(n=r.atomsById.get(t.atom_id)),en(t.atom_index)&&(n=r.atomsBySourceIndex.get(t.atom_index)),n!==void 0&&mXe(e,n,t))return n}function mXe(e,t,r){let n=e.atomicHierarchy,o=n.chainAtomSegments.index[t],i=n.chains.label_asym_id.value(o),a=n.chains.auth_asym_id.value(o),s=n.chains.label_entity_id.value(o);if(!km(r.label_asym_id,i)||!km(r.auth_asym_id,a)||!km(r.label_entity_id,s))return!1;let l=n.residueAtomSegments.index[t],u=n.residues.label_seq_id.valueKind(l)===W.ValueKind.Present?n.residues.label_seq_id.value(l):void 0,c=n.residues.auth_seq_id.valueKind(l)===W.ValueKind.Present?n.residues.auth_seq_id.value(l):void 0,m=n.residues.pdbx_PDB_ins_code.value(l),d=n.residueSourceIndex.value(l);if(!km(r.label_seq_id,u)||!km(r.auth_seq_id,c)||!km(r.pdbx_PDB_ins_code,m)||!Ope(r.beg_label_seq_id,r.end_label_seq_id,u)||!Ope(r.beg_auth_seq_id,r.end_auth_seq_id,c)||!km(r.residue_index,d))return!1;let p=n.atoms.label_comp_id.value(t),h=n.atoms.auth_comp_id.value(t),f=n.atoms.label_atom_id.value(t),g=n.atoms.auth_atom_id.value(t),y=n.atoms.type_symbol.value(t),x=e.atomicConformation.atomId.value(t),S=n.atomSourceIndex.value(t);return!(!km(r.label_comp_id,p)||!km(r.auth_comp_id,h)||!km(r.label_atom_id,f)||!km(r.auth_atom_id,g)||!km(r.type_symbol?.toUpperCase(),y)||!km(r.atom_id,x)||!km(r.atom_index,S))}function km(e,t){return!en(e)||t===e}function Ope(e,t,r){return!(en(e)&&(!en(r)||r<e)||en(t)&&(!en(r)||r>t))}function Hj(e,t,r,n){if(n.spheres&&!(en(e.instance_id)&&e.instance_id!==r))return Hpe(e,t.coarseHierarchy.spheres,n.spheres)}function Npe(e,t,r,n){return zi.union(e.map(o=>Hj(o,t,r,n)))}function jj(e,t,r,n){if(n.gaussians&&!(en(e.instance_id)&&e.instance_id!==r))return Hpe(e,t.coarseHierarchy.gaussians,n.gaussians)}function zpe(e,t,r,n){return zi.union(e.map(o=>jj(o,t,r,n)))}function Hpe(e,t,r){let n=t.count;if(n===0)return;let o=mC(e.label_seq_id,e.beg_label_seq_id,e.end_label_seq_id),i=mC(e.label_asym_id,e.label_entity_id);if(mC(e.auth_asym_id,e.auth_seq_id,e.pdbx_PDB_ins_code,e.beg_auth_seq_id,e.end_auth_seq_id,e.label_comp_id,e.auth_comp_id,e.residue_index,e.label_atom_id,e.auth_atom_id,e.type_symbol,e.atom_id,e.atom_index)){fXe();return}if(!i&&!o)return zi.single(0,n);let s=dXe(t,e,r);if(!o){let c=t.chainElementSegments.offsets,m=zi.empty();for(let d of s)zi.add(m,c[d],c[d+1]);return m}let l=pXe(t,e,r,s),u=zi.empty();for(let c of l)zi.add(u,c,c+1);return u}function dXe(e,t,r){let n;return en(t.label_asym_id)&&(n=r.chainsByAsymId.get(t.label_asym_id)??pC),en(t.label_entity_id)&&(n?n=n.filter(o=>e.entity_id.value(e.chainElementSegments.offsets[o])===t.label_entity_id):n=r.chainsByEntityId.get(t.label_entity_id)??pC),n??=Vl(e.chainElementSegments.count),n}function pXe(e,t,r,n){let o=[];for(let i of n){let a=r.elementsSortedBySeqIdBegin.get(i),s=Math.max(t.label_seq_id??-1/0,t.beg_label_seq_id??-1/0),l=Math.min(t.label_seq_id??1/0,t.end_label_seq_id??1/0),u=Be.findPredecessorIndex(a.endUpperBounds,s),c=Be.findPredecessorIndex(a.values,l+1);for(let m=u;m<c;m++){let d=a.keys[m];e.seq_id_end.value(d)>=s&&o.push(d)}}return GP(o,(i,a)=>i-a),o}var Gpe=!1;function fXe(){Gpe||(console.warn("Using unsupported selector fields (auth_asym_id, auth_seq_id, pdbx_PDB_ins_code, beg_auth_seq_id, end_auth_seq_id, label_comp_id, auth_comp_id, residue_index, label_atom_id, auth_atom_id, type_symbol, atom_id, atom_index) on a coarse structure. The resulting selection will be empty."),Gpe=!0)}function sk(e){return Q.Schema.toExpression(e)}function ZI(e){return Q.Schema.toExpression({items:e})}function jpe(e){let t=0,r=new Map,n=[];for(let a=0;a<e.length;a++){let s=e[a].group_id;if(!en(s))n.push(t++);else{let l=r.get(s);l===void 0?(r.set(s,t),n.push(t),t++):n.push(l)}}let o=Vl(e.length).sort((a,s)=>n[a]-n[s]),i=[];for(let a=0;a<e.length;a++)(a===0||n[o[a]]!==n[o[a-1]])&&i.push(a);return i.push(o.length),{count:i.length-1,offsets:i,grouped:o}}var hXe=new dC({json:"json",cif:"cif",bcif:"bcif"},"json"),gXe={json:"string",cif:"string",bcif:"binary"},Wj={annotations:C.ObjectList({source:C.MappedStatic("source-cif",{"source-cif":C.EmptyGroup(),url:C.Group({url:C.Text(""),format:hXe.PDSelect()})}),schema:Lpe.PDSelect(),cifBlock:C.MappedStatic("index",{index:C.Group({index:C.Numeric(0,{min:0,step:1},{description:"0-based index of the block"})}),header:C.Group({header:C.Text(void 0,{description:"Block header"})})},{description:"Specify which CIF block contains annotation data (only relevant when format=cif or format=bcif)"}),cifCategory:Uj({placeholder:"Take first category",description:"Specify which CIF category contains annotation data (only relevant when format=cif or format=bcif)"}),fieldRemapping:C.ObjectList({standardName:C.Text("",{placeholder:" ",description:"Standard name of the selector field (e.g. label_asym_id)"}),actualName:Uj({placeholder:"Ignore field",description:"Actual name of the field in the annotation data (e.g. spam_chain_id), null to ignore the field with standard name"})},e=>`"${e.standardName}": ${e.actualName===null?"null":`"${e.actualName}"`}`,{description:'Optional remapping of annotation field names { standardName1: actualName1, ... }. Use { "label_asym_id": "X" } to load actual field "X" as "label_asym_id". Use { "label_asym_id": null } to ignore actual field "label_asym_id". Fields not mentioned here are mapped implicitely (i.e. actual name = standard name).'}),id:C.Text("",{description:"Arbitrary identifier that can be referenced by MVSAnnotationColorTheme"})},e=>e.id)},nb=_d.createProvider({label:"MVS Annotations",descriptor:{name:"mvs-annotations"},type:"static",defaultParams:Wj,getParams:e=>Wj,isApplicable:e=>!0,obtain:async(e,t,r)=>{r={...C.getDefaultValues(Wj),...r};let n=r.annotations??[];return{value:await Qj.fromSpecs(e,n,t)}}}),Qj=class e{constructor(t){this.dict=t}static async fromSpecs(t,r,n){let o=r.map(Xpe),i=await _Xe(t,o,n),a={};for(let s=0;s<r.length;s++){let l=r[s];try{let u=i[s];if(!u.ok)throw u.error;a[l.id]=await lk.fromSpec(t,l,u.value)}catch(u){t.errorContext?.add("mvs",`Failed to obtain annotation (${u}).
Annotation specification source params: ${JSON.stringify(l.source.params)}`),console.error(`Failed to obtain annotation (${u}).
Annotation specification:`,l),a[l.id]=lk.createEmpty(l.schema)}}return new e(a)}getAnnotation(t){return this.dict[t]}getAllAnnotations(){return Object.values(this.dict)}};function qI(e,t){let r=e.isEmpty?[]:e.models;for(let n of r)if(n.customProperties.has(nb.descriptor)){let i=nb.get(n).value?.getAnnotation(t);if(i)return{annotation:i,model:n}}return{annotation:void 0,model:void 0}}function yXe(e,t){return t===ue.Kind.Atomic?e.atoms:t===ue.Kind.Spheres?e.spheres:t===ue.Kind.Gaussians?e.gaussians:(console.warn(`Unknown Unit.Kind value: ${t}`),null)}var lk=class e{constructor(t,r,n){this.data=t;this.schema=r;this.fieldRemapping=n;this._indexedModels=new Map;this._rows=void 0;this._hasInstanceIds=void 0;this.nRows=CXe(t)}static async fromSpec(t,r,n){n??=await Wpe(t,Xpe(r));let o;switch(n.format){case"json":o=n;break;case"cif":if(n.data.blocks.length===0)throw new Error("No block in CIF");let i=r.cifBlock,a;switch(i.name){case"header":let u=n.data.blocks.find(c=>c.header===i.params.header);if(!u)throw new Error(`CIF block with header "${i.params.header}" not found`);a=u;break;case"index":if(a=n.data.blocks[i.params.index],!a)throw new Error(`CIF block with index ${i.params.index} not found`);break}let s=r.cifCategory??Object.keys(a.categories)[0];if(!s)throw new Error("There are no categories in CIF block");let l=a.categories[s];if(!l)throw new Error(`CIF category "${s}" not found`);o={format:"cif",data:l};break}return new e(o,r.schema,Object.fromEntries(r.fieldRemapping.map(i=>[i.standardName,i.actualName])))}static createEmpty(t){return new e({format:"json",data:[]},t,{})}getValueForLocation(t,r){let n=this.getIndexedModel(t.unit.model,t.unit.conformation.operator.instanceId),o=yXe(n,t.unit.kind),i=o?o[t.element]:-1;return this.getValueForRow(i,r)}getValueForRow(t,r){if(!(t<0))switch(this.data.format){case"json":let n=bXe(t,r,this.data.data);return n===void 0||typeof n=="string"?n:`${n}`;case"cif":return xXe(t,r,this.data.data)}}getIndexedModel(t,r){let n=this.hasInstanceIds()?`${t.id}:${r}`:t.id;if(!this._indexedModels.has(n)){let o=this.getRowForEachAtom(t,r);this._indexedModels.set(n,o)}return this._indexedModels.get(n)}getRowForEachAtom(t,r){let n=ak.get(t),o=t.atomicHierarchy.atoms._rowCount,i=t.coarseHierarchy.spheres.count,a=t.coarseHierarchy.gaussians.count,s=null,l=null,u=null,c=this.getRows();for(let m=0,d=c.length;m<d;m++){let p=c[m],h=zj(p,t,r,n);s=Xj(s,o,h,m);let f=Hj(p,t,r,n);l=Xj(l,i,f,m);let g=jj(p,t,r,n);u=Xj(u,a,g,m)}return{atoms:s,spheres:l,gaussians:u}}getRows(){return this._rows??=this._getRows()}_getRows(){switch(this.data.format){case"json":return IXe(this.data.data,this.schema,this.fieldRemapping);case"cif":return AXe(this.data.data,this.schema,this.fieldRemapping)}}hasInstanceIds(){return this._hasInstanceIds??=this.getRows().some(t=>en(t.instance_id))}getDistinctValuesInField(t,r){let n=new Set,o=[];for(let i=0;i<this.nRows;i++){let a=this.getValueForRow(i,t);r&&(a=a?.toUpperCase()),a!==void 0&&!n.has(a)&&(n.add(a),o.push(a))}return o}};function bXe(e,t,r){let n=r;return Array.isArray(n)?(n[e]??{})[t]:(n[t]??[])[e]}function xXe(e,t,r){let n=r.getField(t);if(n&&n.valueKind(e)===W.ValueKind.Present)return n.str(e)}function CXe(e){switch(e.format){case"json":return SXe(e.data);case"cif":return vXe(e.data)}}function SXe(e){let t=e;if(Array.isArray(t))return t.length;{let r=Object.keys(t);return r.length>0?t[r[0]].length:0}}function vXe(e){return e.rowCount}function IXe(e,t,r){let n=e,o=Nj(t),i=Object.keys(o);if(Array.isArray(n))return n.map(a=>rU(a,i,r));{let a=rU(n,i,r);return nU(a)}}function AXe(e,t,r){let n=Nj(t),o=Object.keys(n),i={};for(let a of o){let s=r[a];if(s===null)continue;s===void 0&&(s=a);let l=TXe(e,s,n[a]);l&&(i[a]=l)}return Object.keys(i).length===0?new Array(e.rowCount).fill({}):nU(i)}function TXe(e,t,r){if(e.getField(t)===void 0)return;let o=fE({[t]:r},e)[t];return PXe(o)}function PXe(e){let t=e.rowCount,r=W.ValueKind.Present,n=new Array(t);for(let o=0;o<t;o++)n[o]=e.valueKind(o)===r?e.value(o):void 0;return n}async function Wpe(e,t,r){switch(t.kind){case"source-cif":return{format:"cif",data:RXe(r)};case"url":let n=sn.getUrlAsset(e.assetManager,t.url),o=gXe[t.format],a=(await e.assetManager.resolve(n,o).runInContext(e.runtime)).data;if(!a)throw new Error("Missing data");switch(t.format){case"json":return{format:"json",data:JSON.parse(a)};case"cif":case"bcif":let l=await Fu.parse(a).run();if(l.isError)throw new Error(`Failed to parse ${t.format}`);return{format:"cif",data:l.result}}}}async function _Xe(e,t,r){let n={};for(let i of t){let a=xy(i);n[a]??=Bpe(Wpe(e,i,r))}let o=await ZJ(n);return t.map(i=>o[xy(i)])}function RXe(e){if(e&&Ln.is(e.sourceData)){if(e.sourceData.data.file)return e.sourceData.data.file;{let t=e.sourceData.data.frame,r=kS(Array.from(t.categoryNames),t.categories,t.header);return ES([r])}}else return console.warn("Could not get CifFile from Model, returning empty CifFile"),ES([])}function Xpe(e){switch(e.source.name){case"url":return{kind:"url",...e.source.params};case"source-cif":return{kind:"source-cif"}}}function Xj(e,t,r,n){if(!r||zi.count(r)===0)return e;let o=e??Array(t).fill(-1);return zi.foreach(r,(i,a)=>o.fill(n,i,a)),o}var Qpe={isMvs:C.Boolean(!1,{description:"Flag this model as managed by MolViewSpec and enable MolViewSpec features"})},YI=_d.createProvider({label:"MVS",descriptor:{name:"mvs-is-mvs-model"},type:"static",defaultParams:Qpe,getParams:e=>Qpe,isApplicable:e=>!0,obtain:async(e,t,r)=>({value:{}})});function DXe(e){return!!YI.props(e)?.isMvs}function fC(e){return e.models.some(DXe)}var wXe={colors:C.MappedStatic("list",{list:C.ColorList("category-10",{description:"List of colors.",presetKind:"set"}),dictionary:C.ObjectList({value:C.Text(),color:C.Color(Lt.white)},e=>`${e.value}: ${Le.toHexStyle(e.color)}`,{description:"Mapping of annotation values to colors."})}),repeatColorList:C.Boolean(!1,{hideIf:e=>e.colors.name!=="list",description:"Repeat color list once all colors are depleted (only applies if `colors` is a list)."}),sort:C.Select("none",[["none","None"],["lexical","Lexical"],["numeric","Numeric"]],{hideIf:e=>e.colors.name!=="list",description:"Sort actual annotation values before assigning colors from a list (none = take values in order of their first occurrence)."}),sortDirection:C.Select("ascending",[["ascending","Ascending"],["descending","Descending"]],{hideIf:e=>e.colors.name!=="list",description:"Sort direction."}),caseInsensitive:C.Boolean(!1,{description:"Treat annotation values as case-insensitive strings."}),setMissingColor:C.Boolean(!1,{description:"Allow setting a color for missing values."}),missingColor:C.Color(Lt.white,{hideIf:e=>!e.setMissingColor,description:"Color to use when (a) `colors` is a dictionary and given key is not present, or (b) `color` is a list and there are more actual annotation values than listed colors and `repeat_color_list` is not true."})},MXe={colors:C.ObjectList({color:C.Color(Lt.white),fromValue:C.Numeric(-1/0),toValue:C.Numeric(1/0)},e=>`${Le.toHexStyle(e.color)} [${e.fromValue}, ${e.toValue}]`,{description:"Mapping of annotation value ranges to colors."}),mode:C.Select("normalized",[["normalized","Normalized"],["absolute","Absolute"]],{description:"Defines whether the annotation values should be normalized before assigning color based on checkpoints in `colors` (`x_normalized = (x - x_min) / (x_max - x_min)`, where `[x_min, x_max]` are either `value_domain` if provided, or the lowest and the highest value encountered in the annotation)."}),xMin:nR({hideIf:e=>e.mode!=="normalized",placeholder:"auto",description:'Defines `x_min` for normalization of annotation values. If not provided, minimum of the actual values will be used. Only used when `mode` is `"normalized"'}),xMax:nR({hideIf:e=>e.mode!=="normalized",placeholder:"auto",description:'Defines `x_max` for normalization of annotation values. If not provided, maximum of the actual values will be used. Only used when `mode` is `"normalized"'})},BXe={colors:C.ColorList("yellow-green",{description:"List of colors, with optional checkpoints.",presetKind:"scale",offsets:!0}),mode:C.Select("normalized",[["normalized","Normalized"],["absolute","Absolute"]],{description:"Defines whether the annotation values should be normalized before assigning color based on checkpoints in `colors` (`x_normalized = (x - x_min) / (x_max - x_min)`, where `[x_min, x_max]` are either `value_domain` if provided, or the lowest and the highest value encountered in the annotation)."}),xMin:nR({hideIf:e=>e.mode!=="normalized",placeholder:"auto",description:'Defines `x_min` for normalization of annotation values. If not provided, minimum of the actual values will be used. Only used when `mode` is `"normalized"'}),xMax:nR({hideIf:e=>e.mode!=="normalized",placeholder:"auto",description:'Defines `x_max` for normalization of annotation values. If not provided, maximum of the actual values will be used. Only used when `mode` is `"normalized"'}),setUnderflowColor:C.Boolean(!1,{description:"Allow setting a color for values below the lowest checkpoint."}),underflowColor:C.Color(Lt.white,{hideIf:e=>!e.setUnderflowColor,description:"Color for values below the lowest checkpoint."}),setOverflowColor:C.Boolean(!1,{description:"Allow setting a color for values above the highest checkpoint."}),overflowColor:C.Color(Lt.white,{hideIf:e=>!e.setOverflowColor,description:"Color for values above the highest checkpoint."})},Zpe={annotationId:C.Text("",{description:'Reference to "Annotation" custom model property'}),fieldName:C.Text("color",{description:"Annotation field (column) from which to take color values"}),background:C.Color(Lt.gainsboro,{description:"Color for elements without annotation"}),palette:C.MappedStatic("direct",{direct:C.EmptyGroup(),categorical:C.Group(wXe),discrete:C.Group(MXe),continuous:C.Group(BXe)})};function qpe(e,t){let r=()=>t.background;if(e.structure&&!e.structure.isEmpty){let{annotation:n}=qI(e.structure,t.annotationId);if(n){let o=EXe(t.palette,n,t.fieldName),i=s=>{let l=n?.getValueForLocation(s,t.fieldName);return(l!==void 0?o(l):void 0)??t.background},a=Q.Location.create(e.structure);r=s=>Q.Location.is(s)?i(s):It.isLocation(s)?(a.unit=s.aUnit,a.element=s.aUnit.elements[s.aIndex],i(a)):t.background}else console.error(`Annotation source "${t.annotationId}" not present`)}return{factory:qpe,granularity:"groupInstance",preferSmoothing:!1,color:r,props:t,description:"Assigns colors based on custom MolViewSpec annotation data."}}var uk={name:"mvs-annotation",label:"MVS Annotation",category:"Miscellaneous",factory:qpe,getParams:e=>Zpe,defaultValues:C.getDefaultValues(Zpe),isApplicable:e=>!!e.structure&&fC(e.structure)};function EXe(e,t,r){if(e.name==="direct")return Zo;if(e.name==="categorical")return kXe(e.params,t,r);if(e.name==="discrete")return FXe(e.params,t,r);if(e.name==="continuous")return LXe(e.params,t,r);throw new Error(`NotImplementedError: makePaletteFunction for ${e.name}`)}function kXe(e,t,r){let n={};if(e.colors.name==="dictionary")for(let{value:i,color:a}of e.colors.params){let s=e.caseInsensitive?i.toUpperCase():i;n[s]=a}else if(e.colors.name==="list"){let i=t.getDistinctValuesInField(r,e.caseInsensitive);e.sort==="lexical"?i.sort():e.sort==="numeric"&&i.sort((l,u)=>Number.parseFloat(l)-Number.parseFloat(u)),e.sortDirection==="descending"&&i.reverse();let a=e.colors.params.colors.map(Le.fromColorListEntry),s=0;for(let l of i)n[l]=a[s++],s>=a.length&&e.repeatColorList&&(s=0)}let o=e.setMissingColor?e.missingColor:void 0;return e.caseInsensitive?i=>n[i.toUpperCase()]??o:i=>n[i]??o}function FXe(e,t,r){if(e.colors.length===0)return()=>{};let n=Ype(e,t,r);return o=>{let i=parseFloat(o);if(isNaN(i))return;let a=n(i);for(let s=e.colors.length-1;s>=0;s--){let{color:l,fromValue:u,toValue:c}=e.colors[s];if(u<=a&&a<=c)return l}}}function LXe(e,t,r){let{colors:n,checkpoints:o}=Zj(e);if(n.length===0)return()=>{};let i=Ype(e,t,r),a=e.setUnderflowColor?e.underflowColor:void 0,s=e.setOverflowColor?e.overflowColor:void 0;return l=>{let u=parseFloat(l);if(isNaN(u))return;let c=i(u),m=Be.findPredecessorIndex(o,c);if(m===0)return c===o[0]?n[0]:a;if(m===o.length)return s;let d=(c-o[m-1])/(o[m]-o[m-1]);return Le.interpolate(n[m-1],n[m],d)}}function Ype(e,t,r){if(e.mode==="normalized"){let n=e.xMin,o=e.xMax;if(n===null||o===null){let i=t.getDistinctValuesInField(r,!1).map(parseFloat).filter(a=>!isNaN(a));i.length>0?(n??=i.reduce((a,s)=>a<s?a:s),o??=i.reduce((a,s)=>a>s?a:s)):(n??=0,o??=1)}return n===o?i=>i<n?-.5:i===n?.5:1.5:i=>(i-n)/(o-n)}else return n=>n}function Zj(e){if(e.colors.colors.every(t=>Array.isArray(t))){let t=e.colors.colors.sort((o,i)=>o[1]-i[1]),r=t.map(Le.fromColorListEntry),n=Be.ofSortedArray(t.map(o=>o[1]));return{colors:r,checkpoints:n}}else{let t=e.colors.colors.map(Le.fromColorListEntry),r=t.length-1,n=Be.ofSortedArray(t.map((o,i)=>i/r));return{colors:t,checkpoints:n}}}var yr={Atom:"Atom Property",Chain:"Chain Property",Residue:"Residue Property",Symmetry:"Symmetry",Validation:"Validation",Misc:"Miscellaneous"};var ck=13421772,VXe="Assigns colors according to the Symbol Nomenclature for Glycans (SNFG).",Kpe={};function OXe(e){return Kpe}function Jpe(e,t){let r;if(e.structure){let{elements:n,getElementIndices:o}=e.structure.carbohydrates,i=(a,s)=>{if(!ue.isAtomic(a))return ck;let l=o(a,s);return l.length>0?n[l[0]].component.color:ck};r=(a,s)=>s?or.Secondary:Q.Location.is(a)?i(a.unit,a.element):It.isLocation(a)?i(a.aUnit,a.aUnit.elements[a.aIndex]):ck}else r=()=>ck;return{factory:Jpe,granularity:"group",color:r,props:t,description:VXe,legend:Nl(sce)}}var $pe={name:"carbohydrate-symbol",label:"Carbohydrate Symbol",category:yr.Residue,factory:Jpe,getParams:OXe,defaultValues:C.getDefaultValues(Kpe),isApplicable:e=>!!e.structure&&e.structure.models.some(t=>Gt.hasCarbohydrate(t))};var efe=13421772,GXe="Gives everything the same, uniform color.",ob={value:C.Color(efe),saturation:C.Numeric(0,{min:-6,max:6,step:.1}),lightness:C.Numeric(0,{min:-6,max:6,step:.1})};function UXe(e){return ob}function Qf(e,t){let r=ua(t.value,efe);return r=Le.saturate(r,t.saturation),r=Le.lighten(r,t.lightness),{factory:Qf,granularity:"uniform",color:()=>r,props:t,description:GXe,legend:Nl([["uniform",r]])}}var tfe={name:"uniform",label:"Uniform",category:yr.Misc,factory:Qf,getParams:UXe,defaultValues:C.getDefaultValues(ob),isApplicable:e=>!0};var qj={hue:C.Interval([1,360],{min:0,max:360,step:1}),chroma:C.Interval([40,70],{min:0,max:100,step:1}),luminance:C.Interval([15,85],{min:0,max:100,step:1}),sort:C.Select("contrast",C.arrayToOptions(["none","contrast"]),{description:"no sorting leaves colors approximately ordered by hue"}),clusteringStepCount:C.Numeric(50,{min:10,max:200,step:1},{isHidden:!0}),minSampleCount:C.Numeric(800,{min:100,max:5e3,step:100},{isHidden:!0}),sampleCountFactor:C.Numeric(5,{min:1,max:100,step:1},{isHidden:!0})},KI=2,HS=[0,0,0],jS=[0,0,0];function NXe(e,t){return Ma.toHcl(HS,e),Ma.fromColor(jS,Ma.toColor(e)),HS[0]>=t.hue[0]&&HS[0]<=t.hue[1]&&HS[1]>=t.chroma[0]&&HS[1]<=t.chroma[1]&&HS[2]>=t.luminance[0]&&HS[2]<=t.luminance[1]&&jS[0]>=e[0]-KI&&jS[0]<=e[0]+KI&&jS[1]>=e[1]-KI&&jS[1]<=e[1]+KI&&jS[2]>=e[2]-KI&&jS[2]<=e[2]+KI}function zXe(e){let t=e.slice(0),r=[t.shift()];for(;t.length>0;){let n=r[r.length-1],o=0,i=Number.NEGATIVE_INFINITY;for(let a=0;a<t.length;++a){let s=Ma.distance(n,t[a]);s>i&&(i=s,o=a)}r.push(t.splice(o,1)[0])}return r}function HXe(e,t){let r=new Map,n=Math.ceil(Math.cbrt(e)),o=Cm(),i=Math.max((t.hue[1]-t.hue[0])/n,1),a=Math.max((t.chroma[1]-t.chroma[0])/n,1),s=Math.max((t.luminance[1]-t.luminance[0])/n,1);for(let l=t.hue[0]+i/2;l<=t.hue[1];l+=i)for(let u=t.chroma[0]+a/2;u<=t.chroma[1];u+=a)for(let c=t.luminance[0]+s/2;c<=t.luminance[1];c+=s){let m=Ma.fromHcl(Ma(),Cm.set(o,l,u,c));NXe(m,t)&&r.set(Ma.toColor(m),m)}return Array.from(r.values())}function rfe(e,t){let r=1/0,n=0;for(let o=0;o<e.length;o++){let i=Ma.distance(t,e[o]);i<r&&(r=i,n=o)}return n}function nfe(e,t={}){let r={...C.getDefaultValues(qj),...t};if(e<=0)return[];let n=HXe(Math.max(r.minSampleCount,e*r.sampleCountFactor),r);if(n.length<e)return console.warn("Not enough samples to generate distinct colors, increase sample count."),new Array(e).fill(Lt.lightgrey);let o=[],i=[],a=Math.floor(n.length/e);for(let l=0;l<n.length&&(o.push(n[l]),i.push([]),!(o.length>=e));l+=a);for(let l=1;l<=r.clusteringStepCount;++l){let u=Wo(i),c=Wo(n);for(let d=0;d<o.length;++d){let p=rfe(c,o[d]);u[d].push(n[p]),c.splice(p,1)}for(let d=0;d<c.length;++d){let p=rfe(o,n[d]);u[p].push(n[d])}let m=Wo(o);for(let d=0;d<u.length;++d){let p=u[d],h=p.length;if(h===0)continue;let f=0,g=0,y=0;for(let v of p)f+=v[0],g+=v[1],y+=v[2];let x=f/h,S=g/h,I=y/h;o[d]=[x,S,I]}if(qi(m,o))break}return(r.sort==="contrast"?zXe(o):o).map(l=>Ma.toColor(l))}var ife={type:"generate",colorList:"red-yellow-blue"};function ni(e={}){let t={...ife,...e};return{palette:C.MappedStatic(t.type,{colors:C.Group({list:C.ColorList(t.colorList)},{isFlat:!0}),generate:C.Group({...qj,maxCount:C.Numeric(75,{min:1,max:250,step:1})},{isFlat:!0})},{options:[["colors","Color List"],["generate","Generate Distinct"]]})}}var arr=C.getDefaultValues(ni()),ofe={valueLabel:e=>`${e+1}`,minLabel:"Start",maxLabel:"End"};function di(e,t,r={}){let n,o;if(t.palette.name==="colors"&&t.palette.params.list.kind==="interpolate"){let{list:i}=t.palette.params,a=[0,e-1],{minLabel:s,maxLabel:l}={...ofe,...r},u=i.colors;u.length===0&&(u=Ka(ife.colorList).list);let c=Ja.create({listOrName:u,domain:a,minLabel:s,maxLabel:l});o=c.legend,n=c.color}else{let i;t.palette.name==="colors"?(i=t.palette.params.list.colors.map(u=>Array.isArray(u)?u[0]:u),i.length===0&&(i=Ka("dark-2").list.map(u=>Array.isArray(u)?u[0]:u))):(e=Math.min(e,t.palette.params.maxCount),i=nfe(e,t.palette.params));let a=r.valueLabel??ofe.valueLabel,s=i.length,l=[];for(let u=0;u<e;++u){let c=u%s;l[c]===void 0?l[c]=[a(u),i[c]]:l[c][0]+=`, ${a(u)}`}o=Nl(l),n=u=>i[u%s]}return{color:n,legend:o}}var jXe="many-distinct",afe=16448250,WXe="Gives every chain a color based on its `asym_id` value.",mg={asymId:C.Select("auth",C.arrayToOptions(["auth","label"])),...ni({type:"colors",colorList:jXe})};function XXe(e){let t=C.clone(mg);return e.structure?.models.some(r=>r.coarseHierarchy.isDefined)&&(t.asymId.defaultValue="label"),t}function QXe(e,t){switch(e.kind){case ue.Kind.Atomic:return t==="auth"?Ke.chain.auth_asym_id:Ke.chain.label_asym_id;case ue.Kind.Spheres:case ue.Kind.Gaussians:return Ke.coarse.asym_id}}function sfe(e,t){let r=QXe(e.unit,t)(e);return e.structure.root.models.length>1?lfe(e.unit.model,r):r}function lfe(e,t){return`${t}|${(Gt.Index.get(e).value||0)+1}`}function ZXe(e,t){let r=new Map;for(let n of e.models){let o=Gt.AsymIdOffset.get(n).value,i=(t==="auth"?o?.auth:o?.label)||0,a=0;n.properties.structAsymMap.forEach(({auth_id:s},l)=>{let u=t==="auth"?s:l,c=e.models.length>1?lfe(n,u):u;r.has(c)||(r.set(c,a+i),++a)})}return r}function dg(e,t){let r,n;if(e.structure){let o=Q.Location.create(e.structure.root),i=ZXe(e.structure.root,t.asymId),a=Array.from(i.keys()),s=u=>a[u],l=di(i.size,t,{valueLabel:s});n=l.legend,r=u=>{let c;if(Q.Location.is(u)){let m=sfe(u,t.asymId);c=i.get(m)}else if(It.isLocation(u)){o.unit=u.aUnit,o.element=u.aUnit.elements[u.aIndex];let m=sfe(o,t.asymId);c=i.get(m)}return c===void 0?afe:l.color(c)}}else r=()=>afe;return{factory:dg,granularity:"group",color:r,props:t,description:WXe,legend:n}}var mk={name:"chain-id",label:"Chain Id",category:yr.Chain,factory:dg,getParams:XXe,defaultValues:C.getDefaultValues(mg),isApplicable:e=>!!e.structure};var ufe=13421772,qXe="Gives every element (atom or coarse sphere/gaussian) a unique color based on the position (index) of the element in the list of elements in the structure.",cfe={...ni({type:"colors",colorList:"red-yellow-blue"})};function YXe(e){return cfe}function mfe(e,t){let r,n;if(e.structure){let{units:o}=e.structure.root,i=o.length,a=new Map,s=new Map,l=0;for(let c=0;c<i;++c)a.set(c,l),l+=o[c].elements.length,s.set(o[c].id,c);let u=di(l,t);n=u.legend,r=c=>{if(Q.Location.is(c)){let m=s.get(c.unit.id),d=xe.findPredecessorIndex(o[m].elements,c.element);return u.color(a.get(m)+d)}else if(It.isLocation(c)){let m=s.get(c.aUnit.id),d=xe.findPredecessorIndex(o[m].elements,c.aUnit.elements[c.aIndex]);return u.color(a.get(m)+d)}return ufe}}else r=()=>ufe;return{factory:mfe,granularity:"groupInstance",preferSmoothing:!0,color:r,props:t,description:qXe,legend:n}}var dfe={name:"element-index",label:"Element Index",category:yr.Atom,factory:mfe,getParams:YXe,defaultValues:C.getDefaultValues(cfe),isApplicable:e=>!!e.structure};function pg(e){let t={};return wi(e,(r,n)=>{t[n]=C.Color(e[n])}),t}var KXe="many-distinct",pfe=13421772,JXe="Assigns a color based on the operator name of a transformed chain.",dk={...ni({type:"colors",colorList:KXe})};function $Xe(e){return C.clone(dk)}function eQe(e){let t=new Map;for(let r=0,n=e.units.length;r<n;++r){let o=e.units[r].conformation.operator.name;t.has(o)||t.set(o,t.size)}return t}function pk(e,t){let r,n;if(e.structure){let o=eQe(e.structure.root),i=Array.from(o.keys()),a=l=>i[l],s=di(o.size,t,{valueLabel:a});n=s.legend,r=l=>{let u;if(Q.Location.is(l)){let c=l.unit.conformation.operator.name;u=o.get(c)}else if(It.isLocation(l)){let c=l.aUnit.conformation.operator.name;u=o.get(c)}return u===void 0?pfe:s.color(u)}}else r=()=>pfe;return{factory:pk,granularity:"instance",color:r,props:t,description:JXe,legend:n}}var JI={name:"operator-name",label:"Operator Name",category:yr.Symmetry,factory:pk,getParams:$Xe,defaultValues:C.getDefaultValues(dk),isApplicable:e=>!!e.structure};var tQe="many-distinct",Yj=16448250,rQe=16715021,nQe="Gives every chain a color based on its `label_entity_id` value.",fg={...ni({type:"colors",colorList:tQe}),overrideWater:C.Boolean(!1,{description:"Override the color for water molecules."}),waterColor:C.Color(rQe,{hideIf:e=>!e.overrideWater,description:"Color for water molecules (if overrideWater is true)."})};function oQe(e){return C.clone(fg)}function fk(e,t){return`${e}|${t}`}function iQe(e){let t=new WeakMap,r=0;for(let n=0,o=e.models.length;n<o;++n){let i=e.models[n].sourceData;t.has(i)||t.set(i,r++)}return t}function aQe(e,t){let r=new Map;for(let n=0,o=e.models.length;n<o;++n){let i=t.get(e.models[n].sourceData)??-1,{label_entity_id:a}=e.models[n].atomicHierarchy.chains;for(let l=0,u=a.rowCount;l<u;++l){let c=fk(a.value(l),i);r.has(c)||r.set(c,r.size)}let{coarseHierarchy:s}=e.models[n];if(s.isDefined){let{entity_id:l}=s.spheres;for(let c=0,m=l.rowCount;c<m;++c){let d=fk(l.value(c),i);r.has(d)||r.set(d,r.size)}let{entity_id:u}=s.gaussians;for(let c=0,m=u.rowCount;c<m;++c){let d=fk(u.value(c),i);r.has(d)||r.set(d,r.size)}}}return r}function sQe(e){switch(e.unit.kind){case ue.Kind.Atomic:return Ke.chain.label_entity_id(e);case ue.Kind.Spheres:case ue.Kind.Gaussians:return Ke.coarse.entity_id(e)}}function hg(e,t){let r,n;if(e.structure){let o=Q.Location.create(e.structure.root),i=iQe(e.structure),a=aQe(e.structure.root,i),s=Array.from(a.keys()),l=c=>s[c],u=di(a.size,t,{valueLabel:l});n=u.legend,r=c=>{let m;if(Q.Location.is(c))m=c;else if(It.isLocation(c))o.unit=c.aUnit,o.element=c.aUnit.elements[c.aIndex],m=o;else return Yj;let d=sQe(m),p=i.get(m.unit.model.sourceData)??-1;if(t.overrideWater){let g=m.unit.model.entities;if(g.data.type.value(g.getEntityIndex(d))==="water")return t.waterColor}let h=fk(d,p),f=a.get(h);return f===void 0?Yj:u.color(f)}}else r=()=>Yj;return{factory:hg,granularity:"group",color:r,props:t,description:nQe,legend:n}}var ffe={name:"entity-id",label:"Entity Id",category:yr.Chain,factory:hg,getParams:oQe,defaultValues:C.getDefaultValues(fg),isApplicable:e=>!!e.structure};var Jj="dark-2",hk=16448250,lQe="Gives ranges of a polymer chain a color based on the entity source it originates from (e.g. gene, plasmid, organism).",gg={...ni({type:"colors",colorList:Jj})};function uQe(e){let t=C.clone(gg);return e.structure&&gfe(e.structure.root.models).srcKeySerialMap.size>Sr[Jj].list.length&&(t.palette.defaultValue.name="colors",t.palette.defaultValue.params={...t.palette.defaultValue.params,list:{kind:"interpolate",colors:Ka(Jj).list}}),t}function hfe(e,t){return`${e}|${t}`}function cQe(e,t,r,n,o,i){return`${e}|${t}|${r}|${i||o||n}`}function Kj(e,t,r,n,o,i,a,s){let{entity_id:l,pdbx_src_id:u,pdbx_beg_seq_num:c,pdbx_end_seq_num:m}=o;for(let d=0,p=o._rowCount;d<p;++d){let h=l.value(d),f=hfe(r,h),g;if(e.has(f))g=e.get(f);else{let P=n.entities.getEntityIndex(h),T=n.sequence.sequences[P].sequence;g=new Int16Array(T.length),e.set(f,g)}let y=a?a.value(d):"",x=s?s.value(d)[0]:"",S=cQe(r,h,i.value(d),u.value(d),y,x),I=c.valueKind(d)===W.ValueKinds.Present?c.value(d):1,v=m.valueKind(d)===W.ValueKinds.Present?m.value(d):g.length,A;t.has(S)?A=t.get(S):(A=t.size+1,t.set(S,A));for(let P=I,T=v;P<=T;++P)g[P-1]=A}}function gfe(e){let t=new Map,r=new Map;for(let n=0,o=e.length;n<o;++n){let i=e[n];if(!Ln.is(i.sourceData))continue;let{entity_src_gen:a,entity_src_nat:s,pdbx_entity_src_syn:l}=i.sourceData.data.db;Kj(t,r,n,i,a,a.pdbx_gene_src_scientific_name,a.plasmid_name,a.pdbx_gene_src_gene),Kj(t,r,n,i,s,s.pdbx_organism_scientific,s.pdbx_plasmid_name),Kj(t,r,n,i,l,l.organism_scientific)}return{seqToSrcByModelEntity:t,srcKeySerialMap:r}}function mQe(e){let t=0;return Array.from(e.keys()).map(r=>{let n=r.split("|"),o=n[2];return`${ime(n[3])?`Unnamed ${++t}`:n[3]}${o?` (${o})`:""}`})}function yg(e,t){let r,n;if(e.structure){let o=Q.Location.create(e.structure),{models:i}=e.structure.root,{seqToSrcByModelEntity:a,srcKeySerialMap:s}=gfe(i),l=mQe(s),u=d=>l[d],c=di(s.size,t,{valueLabel:u});n=c.legend;let m=d=>{let p=i.indexOf(d.unit.model),h=Ke.entity.id(d),f=hfe(p,h),g=a.get(f);if(g){let y=g[Ke.residue.label_seq_id(d)-1]-1;return y===-1?hk:c.color(y)}else return hk};r=d=>Q.Location.is(d)?m(d):It.isLocation(d)?(o.unit=d.aUnit,o.element=d.aUnit.elements[d.aIndex],m(o)):hk}else r=()=>hk;return{factory:yg,granularity:"group",color:r,props:t,description:lQe,legend:n}}var yfe={name:"entity-source",label:"Entity Source",category:yr.Chain,factory:yg,getParams:uQe,defaultValues:C.getDefaultValues(gg),isApplicable:e=>!!e.structure};var bfe=13421772,dQe="Gives every model a unique color based on its index.",bg={...ni({type:"colors",colorList:"many-distinct"})};function pQe(e){return C.clone(bg)}function xg(e,t){let r,n,o=-1;if(e.structure){let i=(Gt.MaxIndex.get(e.structure.models[0]).value??-1)+1;o=i;let a=di(i,t);n=a.legend,r=s=>Q.Location.is(s)?a.color(Gt.Index.get(s.unit.model).value||0):It.isLocation(s)?a.color(Gt.Index.get(s.aUnit.model).value||0):bfe}else r=()=>bfe;return{factory:xg,granularity:"instance",color:r,props:t,contextHash:o,description:dQe,legend:n}}var xfe={name:"model-index",label:"Model Index",category:yr.Chain,factory:xg,getParams:pQe,defaultValues:C.getDefaultValues(bg),isApplicable:e=>!!e.structure&&e.structure.elementCount>0};var Cfe=13421772,fQe="Gives every structure a unique color based on its index.",Cg={...ni({type:"colors",colorList:"many-distinct"})};function hQe(e){return C.clone(Cg)}function Sg(e,t){let r,n,o=-1;if(e.structure){let i=(De.MaxIndex.get(e.structure).value??-1)+1;o=i;let a=di(i,t);n=a.legend,r=s=>Q.Location.is(s)?a.color(De.Index.get(s.structure).value||0):It.isLocation(s)?a.color(De.Index.get(s.aStructure).value||0):Cfe}else r=()=>Cfe;return{factory:Sg,granularity:"instance",color:r,props:t,contextHash:o,description:fQe,legend:n}}var Sfe={name:"structure-index",label:"Structure Index",category:yr.Chain,factory:Sg,getParams:hQe,defaultValues:C.getDefaultValues(Cg),isApplicable:e=>!!e.structure&&e.structure.elementCount>0};var $j="dark-2",vfe=13421772,gQe="Gives every chain instance (single chain or collection of single elements) a unique color based on the position (index) of the chain in the list of chains in the structure.",gk={...ni({type:"colors",colorList:$j})};function yQe(e){let t=C.clone(gk);return e.structure&&e.structure.root.units.length>Sr[$j].list.length&&(t.palette.defaultValue.name="colors",t.palette.defaultValue.params={...t.palette.defaultValue.params,list:{kind:"interpolate",colors:Ka($j).list}}),t}function yk(e,t){let r,n;if(e.structure){let{units:o}=e.structure.root,i=di(o.length,t);n=i.legend;let a=new Map;for(let s=0,l=o.length;s<l;++s)a.set(o[s].id,i.color(s));r=s=>Q.Location.is(s)?a.get(s.unit.id):It.isLocation(s)?a.get(s.aUnit.id):vfe}else r=()=>vfe;return{factory:yk,granularity:"instance",color:r,props:t,description:gQe,legend:n}}var Ife={name:"unit-index",label:"Chain Instance",category:yr.Chain,factory:yk,getParams:yQe,defaultValues:C.getDefaultValues(gk),isApplicable:e=>!!e.structure};var Afe=13421772,bQe="Gives every model (frame) a unique color based on the index in its trajectory.",hC={...ni({type:"colors",colorList:"purples"})};function xQe(e){return C.clone(hC)}function gC(e,t){let r,n,o=-1;if(e.structure){let{models:i}=e.structure.root,a=0;for(let c of i)a=Math.max(a,Gt.TrajectoryInfo.get(c)?.size||0);let s=[a],l=di(a,t);n=l.legend;let u=new Map;for(let c=0,m=i.length;c<m;++c){let d=Gt.TrajectoryInfo.get(i[c])?.index||0;u.set(d,l.color(d)),s.push(d)}o=ui(s),r=c=>Q.Location.is(c)?u.get(Gt.TrajectoryInfo.get(c.unit.model).index):It.isLocation(c)?u.get(Gt.TrajectoryInfo.get(c.aUnit.model).index):Afe}else r=()=>Afe;return{factory:gC,granularity:"instance",color:r,props:t,contextHash:o,description:bQe,legend:n}}var Tfe={name:"trajectory-index",label:"Trajectory Index",category:yr.Chain,factory:gC,getParams:xQe,defaultValues:C.getDefaultValues(hC),isApplicable:e=>!!e.structure&&e.structure.elementCount>0&&Gt.TrajectoryInfo.get(e.structure.models[0]).size>1};var bk={H:16777215,D:16777152,T:16777120,HE:14286847,LI:13402367,BE:12779264,B:16758197,C:9474192,N:3166456,O:16715021,F:9494608,NE:11789301,NA:11230450,MG:9109248,AL:12560038,SI:1578e4,P:16744448,S:16777008,CL:2093087,AR:8442339,K:9388244,CA:4062976,SC:15132390,TI:12567239,V:10921643,CR:9083335,MN:10255047,FE:14706227,CO:15765664,NI:5296208,CU:13140019,ZN:8224944,GA:12750735,GE:6721423,AS:12419299,SE:16752896,BR:10889513,KR:6076625,RB:7351984,SR:65280,Y:9764863,ZR:9756896,NB:7586505,MO:5551541,TC:3907230,RU:2396047,RH:687500,PD:27013,AG:12632256,CD:16767375,IN:10909043,SN:6717568,SB:10380213,TE:13924864,I:9699476,XE:9699476,CS:5707663,BA:51456,LA:7394559,CE:16777159,PR:14286791,ND:13107143,PM:10747847,SM:9437127,EU:6422471,GD:4587463,TB:3211207,DY:2097095,HO:65436,ER:58997,TM:54354,YB:48952,LU:43812,HF:5096191,TA:5089023,W:2200790,RE:2522539,OS:2516630,IR:1528967,PT:13684960,AU:16765219,HG:12105936,TL:10900557,PB:5724513,BI:10375093,PO:11230208,AT:7688005,RN:4358806,FR:4325478,RA:32e3,AC:7384058,TH:47871,PA:41471,U:36863,NP:33023,PU:27647,AM:5528818,CM:7888099,BK:9064419,CF:10565332,ES:11739092,FM:11739066,MD:11734438,NO:12389767,LR:13041766,RF:13369433,DB:13697103,SG:14221381,BH:14680120,HS:15073326,MT:15400998,DS:16777215,RG:16777215,CN:16777215,UUT:16777215,FL:16777215,UUP:16777215,LV:16777215,UUH:16777215},Pfe=16777215,CQe="Assigns a color to every atom according to its chemical element.",xk={carbonColor:C.MappedStatic("chain-id",{"chain-id":C.Group(mg),"unit-index":C.Group(gk,{label:"Chain Instance"}),"entity-id":C.Group(fg),"entity-source":C.Group(gg),"operator-name":C.Group(dk),"model-index":C.Group(bg),"structure-index":C.Group(Cg),"trajectory-index":C.Group(hC),uniform:C.Group(ob),"element-symbol":C.EmptyGroup()},{description:"Use chain-id coloring for carbon atoms."}),saturation:C.Numeric(0,{min:-6,max:6,step:.1}),lightness:C.Numeric(.2,{min:-6,max:6,step:.1}),colors:C.MappedStatic("default",{default:C.EmptyGroup(),custom:C.Group(pg(bk))})};function SQe(e){return C.clone(xk)}function vQe(e,t){let r=e[t];return r===void 0?Pfe:r}function IQe(e,t){switch(t.name){case"chain-id":return dg(e,t.params);case"unit-index":return yk(e,t.params);case"entity-id":return hg(e,t.params);case"entity-source":return yg(e,t.params);case"operator-name":return pk(e,t.params);case"model-index":return xg(e,t.params);case"structure-index":return Sg(e,t.params);case"trajectory-index":return gC(e,t.params);case"uniform":return Qf(e,t.params);case"element-symbol":return;default:Mr(t)}}function Ck(e,t){let r=Vh(t.colors.name==="default"?bk:t.colors.params,t.saturation,t.lightness),n=IQe(e,t.carbonColor),o=n?.color,i=n?.contextHash??-1;function a(u,c){return o&&u==="C"?o(c,!1):vQe(r,u)}function s(u){if(Q.Location.is(u)){if(ue.isAtomic(u.unit)){let{type_symbol:c}=u.unit.model.atomicHierarchy.atoms;return a(c.value(u.element),u)}}else if(It.isLocation(u)&&ue.isAtomic(u.aUnit)){let{type_symbol:c}=u.aUnit.model.atomicHierarchy.atoms,m=c.value(u.aUnit.elements[u.aIndex]);return a(m,u)}return Pfe}let l=t.carbonColor.name==="operator-name"||t.carbonColor.name==="unit-index"?"groupInstance":"group";return{factory:Ck,granularity:l,preferSmoothing:!0,color:s,props:t,contextHash:i,description:CQe,legend:Nl(Object.keys(r).map(u=>[u,r[u]]))}}var _fe={name:"element-symbol",label:"Element Symbol",category:yr.Atom,factory:Ck,getParams:SQe,defaultValues:C.getDefaultValues(xk),isApplicable:e=>!!e.structure};var Dfe={water:3697840,ion:15729279,protein:12496596,RNA:16629894,DNA:12540695,PNA:4367514,saccharide:8374655},e7=16777113,AQe="Assigns a color based on the molecule type of a residue.",yC={saturation:C.Numeric(0,{min:-6,max:6,step:.1}),lightness:C.Numeric(0,{min:-6,max:6,step:.1}),colors:C.MappedStatic("default",{default:C.EmptyGroup(),custom:C.Group(pg(Dfe))})};function TQe(e){return yC}function Rfe(e,t,r){switch(MI(t,r)){case 2:return e.water;case 3:return e.ion;case 5:return e.protein;case 6:return e.RNA;case 7:return e.DNA;case 8:return e.PNA;case 9:return e.saccharide}return e7}function bC(e,t){let r=Vh(t.colors.name==="default"?Dfe:t.colors.params,t.saturation,t.lightness);function n(o){return Q.Location.is(o)?Rfe(r,o.unit,o.element):It.isLocation(o)?Rfe(r,o.aUnit,o.aUnit.elements[o.aIndex]):e7}return{factory:bC,granularity:"group",color:n,props:t,description:AQe,legend:Nl(Object.keys(r).map(o=>[o,r[o]]).concat([["Other/unknown",e7]]))}}var wfe={name:"molecule-type",label:"Molecule Type",category:yr.Residue,factory:bC,getParams:TQe,defaultValues:C.getDefaultValues(yC),isApplicable:e=>!!e.structure};var t7="dark-2",Mfe=16448250,PQe="Gives every polymer chain a color based on its `asym_id` value.",Efe={...ni({type:"colors",colorList:t7})};function _Qe(e){let t=C.clone(Efe);return e.structure&&kfe(e.structure.root).size>Sr[t7].list.length&&(t.palette.defaultValue.name="colors",t.palette.defaultValue.params={...t.palette.defaultValue.params,list:{kind:"interpolate",colors:Ka(t7).list}}),t}function Bfe(e){switch(e.kind){case ue.Kind.Atomic:return Ke.chain.label_asym_id;case ue.Kind.Spheres:case ue.Kind.Gaussians:return Ke.coarse.asym_id}}function kfe(e){let t=new Map;for(let r=0,n=e.unitSymmetryGroups.length;r<n;++r){let o=e.unitSymmetryGroups[r].units[0],{model:i}=o;if(ue.isAtomic(o)){let{chainAtomSegments:a,chains:s}=i.atomicHierarchy,l=Kt.transientSegments(a,o.elements);for(;l.hasNext;){let{index:u}=l.move(),c=s.label_entity_id.value(u),m=i.entities.getEntityIndex(c);if(i.entities.data.type.value(m)==="polymer"){let d=s.label_asym_id.value(u);t.has(d)||t.set(d,t.size)}}}else if(ue.isCoarse(o)){let{chainElementSegments:a,asym_id:s,entity_id:l}=ue.isSpheres(o)?i.coarseHierarchy.spheres:i.coarseHierarchy.gaussians,u=Kt.transientSegments(a,o.elements);for(;u.hasNext;){let{index:c}=u.move(),m=a.offsets[c],d=l.value(m),p=i.entities.getEntityIndex(d);if(i.entities.data.type.value(p)==="polymer"){let h=s.value(m);t.has(h)||t.set(h,t.size)}}}}return t}function Ffe(e,t){let r,n;if(e.structure){let o=Q.Location.create(e.structure),i=kfe(e.structure.root),a=Array.from(i.keys()),s=u=>a[u],l=di(i.size,t,{valueLabel:s});n=l.legend,r=u=>{let c;if(Q.Location.is(u)){let m=Bfe(u.unit);c=i.get(m(u))}else if(It.isLocation(u)){let m=Bfe(u.aUnit);o.unit=u.aUnit,o.element=u.aUnit.elements[u.aIndex],c=i.get(m(o))}return c===void 0?Mfe:l.color(c)}}else r=()=>Mfe;return{factory:Ffe,granularity:"group",color:r,props:t,description:PQe,legend:n}}var Lfe={name:"polymer-id",label:"Polymer Chain Id",category:yr.Chain,factory:Ffe,getParams:_Qe,defaultValues:C.getDefaultValues(Efe),isApplicable:e=>!!e.structure};var r7="dark-2",Vfe=13421772,RQe="Gives every polymer chain instance a unique color based on the position (index) of the polymer in the list of polymers in the structure.",Ofe={...ni({type:"colors",colorList:r7})};function DQe(e){let t=C.clone(Ofe);return e.structure&&Gfe(e.structure.root)>Sr[r7].list.length&&(t.palette.defaultValue.name="colors",t.palette.defaultValue.params={...t.palette.defaultValue.params,list:{kind:"interpolate",colors:Ka(r7).list}}),t}function Gfe(e){let t=0,{units:r}=e;for(let n=0,o=r.length;n<o;++n)r[n].polymerElements.length>0&&++t;return t}function Ufe(e,t){let r,n;if(e.structure){let o=di(Gfe(e.structure.root),t);n=o.legend;let{units:i}=e.structure.root,a=new Map;for(let s=0,l=0,u=i.length;s<u;++s)i[s].polymerElements.length>0&&(a.set(i[s].id,o.color(l)),++l);r=s=>{let l;return Q.Location.is(s)?l=a.get(s.unit.id):It.isLocation(s)&&(l=a.get(s.aUnit.id)),l!==void 0?l:Vfe}}else r=()=>Vfe;return{factory:Ufe,granularity:"instance",color:r,props:t,description:RQe,legend:n}}var Nfe={name:"polymer-index",label:"Polymer Chain Instance",category:yr.Chain,factory:Ufe,getParams:DQe,defaultValues:C.getDefaultValues(Ofe),isApplicable:e=>!!e.structure};var iR={ALA:9240460,ARG:124,ASN:16743536,ASP:10485826,CYS:16777072,GLN:16731212,GLU:6684672,GLY:15658734,HIS:7368959,ILE:19456,LEU:4546117,LYS:4671416,MET:12099650,PHE:5459026,PRO:5395026,SER:16740418,THR:12078080,TRP:5195264,TYR:9203788,VAL:16747775,A:14423100,G:3329330,I:10145074,C:16766720,T:4286945,U:4251856,DA:14423100,DG:3329330,DI:10145074,DC:16766720,DT:4286945,DU:4251856,APN:14423100,GPN:3329330,CPN:16766720,TPN:4286945},n7=16711935,wQe="Assigns a color to every residue according to its name.",vk={saturation:C.Numeric(0,{min:-6,max:6,step:.1}),lightness:C.Numeric(1,{min:-6,max:6,step:.1}),colors:C.MappedStatic("default",{default:C.EmptyGroup(),custom:C.Group(pg(iR))})};function MQe(e){return vk}function zfe(e,t){return e.model.atomicHierarchy.atoms.label_comp_id.value(t)}function Hfe(e,t){let r=e.coarseElements.seq_id_begin.value(t),n=e.coarseElements.seq_id_end.value(t);if(r===n){let o=e.coarseElements.entityKey[t];return e.model.sequence.byEntityKey[o].sequence.compId.value(r-1)}}function Sk(e,t){let r=e[t];return r===void 0?n7:r}function Ik(e,t){let r=Vh(t.colors.name==="default"?iR:t.colors.params,t.saturation,t.lightness);function n(o){if(Q.Location.is(o))if(ue.isAtomic(o.unit)){let i=zfe(o.unit,o.element);return Sk(r,i)}else{let i=Hfe(o.unit,o.element);if(i)return Sk(r,i)}else if(It.isLocation(o))if(ue.isAtomic(o.aUnit)){let i=zfe(o.aUnit,o.aUnit.elements[o.aIndex]);return Sk(r,i)}else{let i=Hfe(o.aUnit,o.aUnit.elements[o.aIndex]);if(i)return Sk(r,i)}return n7}return{factory:Ik,granularity:"group",preferSmoothing:!0,color:n,props:t,description:wQe,legend:Nl(Object.keys(r).map(o=>[o,r[o]]).concat([["Unknown",n7]]))}}var jfe={name:"residue-name",label:"Residue Name",category:yr.Residue,factory:Ik,getParams:MQe,defaultValues:C.getDefaultValues(vk),isApplicable:e=>!!e.structure};var Qfe={ARG:255,ASP:16711680,GLU:16711680,HIS:3392505,LYS:255,ALA:16777215,ASN:16777215,CYS:16777215,GLN:16777215,GLY:16777215,ILE:16777215,LEU:16777215,MET:16777215,PHE:16777215,PRO:16777215,SER:16777215,THR:16777215,TRP:16777215,TYR:16777215,VAL:16777215,MSE:16777215,SEP:16777215,TPO:16777215,PTR:16777215,PCA:16777215,HYP:16777215,HSD:16777215,HSE:16777215,HSP:255,LSN:16777215,ASPP:16777215,GLUP:16777215,HID:16777215,HIE:16777215,HIP:255,LYN:16777215,ASH:16777215,GLH:16777215,A:16777215,G:16777215,I:16777215,C:16777215,T:16777215,U:16777215,DA:16777215,DG:16777215,DI:16777215,DC:16777215,DT:16777215,DU:16777215,APN:16777215,GPN:16777215,CPN:16777215,TPN:16777215},o7=16711935,BQe="Assigns a color to every residue based on its charge state.",Zfe={method:C.MappedStatic("by-name",{"by-name":C.Group({saturation:C.Numeric(0,{min:-6,max:6,step:.1}),lightness:C.Numeric(0,{min:-6,max:6,step:.1}),colors:C.MappedStatic("default",{default:C.EmptyGroup(),custom:C.Group(pg(Qfe))})},{isFlat:!0})})};function EQe(e){return C.clone(Zfe)}function Wfe(e,t){return e.model.atomicHierarchy.atoms.label_comp_id.value(t)}function Xfe(e,t){let r=e.coarseElements.seq_id_begin.value(t),n=e.coarseElements.seq_id_end.value(t);if(r===n){let o=e.coarseElements.entityKey[t];return e.model.sequence.byEntityKey[o].sequence.compId.value(r-1)}}function Ak(e,t){let r=e[t];return r===void 0?o7:r}function qfe(e,t){let{saturation:r,lightness:n,colors:o}=t.method.params,i=Vh(t.method.params.colors.name==="default"?Qfe:o.params,r,n);function a(s){if(Q.Location.is(s))if(ue.isAtomic(s.unit)){let l=Wfe(s.unit,s.element);return Ak(i,l)}else{let l=Xfe(s.unit,s.element);if(l)return Ak(i,l)}else if(It.isLocation(s))if(ue.isAtomic(s.aUnit)){let l=Wfe(s.aUnit,s.aUnit.elements[s.aIndex]);return Ak(i,l)}else{let l=Xfe(s.aUnit,s.aUnit.elements[s.aIndex]);if(l)return Ak(i,l)}return o7}return{factory:qfe,granularity:"group",preferSmoothing:!0,color:a,props:t,description:BQe,legend:Nl(Object.keys(i).map(s=>[s,i[s]]).concat([["Unknown",o7]]))}}var Yfe={name:"residue-charge",label:"Residue Charge",category:yr.Residue,factory:qfe,getParams:EQe,defaultValues:C.getDefaultValues(Zfe),isApplicable:e=>!!e.structure};var Fm={alphaHelix:16711808,threeTenHelix:10485888,piHelix:6291584,betaTurn:6324479,betaStrand:16762880,coil:16777215,bend:6740169,turn:45670,dna:11403518,rna:16580962,carbohydrate:10921722},i7=8421504,kQe="Assigns a color based on the type of secondary structure and basic molecule type.",Tk={saturation:C.Numeric(-1,{min:-6,max:6,step:.1}),lightness:C.Numeric(0,{min:-6,max:6,step:.1}),colors:C.MappedStatic("default",{default:C.EmptyGroup(),custom:C.Group(pg(Fm))})};function FQe(e){return Tk}function Kfe(e,t,r,n){let o=rr.create(rr.Flag.None);if(n&&ue.isAtomic(t)){let i=n.get(t.invariantId);i&&(o=i.type[i.getIndex(t.residueIndex[r])])}if(rr.is(o,rr.Flag.Helix))return rr.is(o,rr.Flag.Helix3Ten)?e.threeTenHelix:rr.is(o,rr.Flag.HelixPi)?e.piHelix:e.alphaHelix;if(rr.is(o,rr.Flag.Beta))return e.betaStrand;if(rr.is(o,rr.Flag.Bend))return e.bend;if(rr.is(o,rr.Flag.Turn))return e.turn;{let i=MI(t,r);if(i===7)return e.dna;if(i===6)return e.rna;if(i===9)return e.carbohydrate;if(i===5)return e.coil}return i7}function Pk(e,t){let r=e.structure&&ol.get(e.structure),n=r?$u(r.id,r.version):-1,o=Vh(t.colors.name==="default"?Fm:t.colors.params,t.saturation,t.lightness);function i(a){return Q.Location.is(a)?Kfe(o,a.unit,a.element,r?.value):It.isLocation(a)?Kfe(o,a.aUnit,a.aUnit.elements[a.aIndex],r?.value):i7}return{factory:Pk,granularity:"group",preferSmoothing:!0,color:i,props:t,contextHash:n,description:kQe,legend:Nl(Object.keys(o).map(a=>[a,o[a]]).concat([["Other",i7]]))}}var Jfe={name:"secondary-structure",label:"Secondary Structure",category:yr.Residue,factory:Pk,getParams:FQe,defaultValues:C.getDefaultValues(Tk),isApplicable:e=>!!e.structure,ensureCustomProperties:{attach:(e,t)=>t.structure?ol.attach(e,t.structure,void 0,!0):Promise.resolve(),detach:e=>e.structure&&ol.ref(e.structure,!1)}};var LQe=13421772,VQe="Gives every polymer residue a color based on its `seq_id` value.",_k={list:C.ColorList("turbo-no-black",{presetKind:"scale"})};function OQe(e){return _k}function $fe(e,t){let{model:r}=e;switch(e.kind){case ue.Kind.Atomic:let n=r.atomicHierarchy.residueAtomSegments.index[t];return r.atomicHierarchy.residues.label_seq_id.value(n);case ue.Kind.Spheres:return Math.round((r.coarseHierarchy.spheres.seq_id_begin.value(t)+r.coarseHierarchy.spheres.seq_id_end.value(t))/2);case ue.Kind.Gaussians:return Math.round((r.coarseHierarchy.gaussians.seq_id_begin.value(t)+r.coarseHierarchy.gaussians.seq_id_end.value(t))/2)}}function ehe(e,t){let{model:r}=e,n="";switch(e.kind){case ue.Kind.Atomic:let a=r.atomicHierarchy.chainAtomSegments.index[t];n=r.atomicHierarchy.chains.label_entity_id.value(a);break;case ue.Kind.Spheres:n=r.coarseHierarchy.spheres.entity_id.value(t);break;case ue.Kind.Gaussians:n=r.coarseHierarchy.gaussians.entity_id.value(t);break}if(n==="")return 0;let o=r.entities.getEntityIndex(n);if(o===-1)return 0;let i=r.sequence.byEntityKey[o];return i===void 0?0:i.sequence.length}function Rk(e,t){let r=Ja.create({listOrName:t.list.colors,minLabel:"Start",maxLabel:"End"});return{factory:Rk,granularity:"group",preferSmoothing:!0,color:o=>{if(Q.Location.is(o)){let{unit:i,element:a}=o,s=$fe(i,a);if(s>0){let l=ehe(i,a);if(l)return r.setDomain(0,l-1),r.color(s)}}else if(It.isLocation(o)){let{aUnit:i,aIndex:a}=o,s=$fe(i,i.elements[a]);if(s>0){let l=ehe(i,i.elements[a]);if(l)return r.setDomain(0,l-1),r.color(s)}}return LQe},props:t,description:VQe,legend:r?r.legend:void 0}}var the={name:"sequence-id",label:"Sequence Id",category:yr.Residue,factory:Rk,getParams:OQe,defaultValues:C.getDefaultValues(_k),isApplicable:e=>!!e.structure};function GQe(e,t){for(let r=0,n=t*3;r<n;r+=3){let o=e[r],i=e[r+1],a=e[r+2],s=1/Math.sqrt(o*o+i*i+a*a);e[r]=o*s,e[r+1]=i*s,e[r+2]=a*s}return e}var Lm=b();function Zc(e,t,r,n){for(let o=0,i=n*3;o<i;o+=3)b.fromArray(Lm,t,r+o),b.transformMat4(Lm,Lm,e),b.toArray(Lm,t,r+o)}function ihe(e,t,r,n){for(let o=0,i=n*3;o<i;o+=3)b.fromArray(Lm,t,r+o),b.transformMat3(Lm,Lm,e),b.toArray(Lm,t,r+o)}function ahe(e,t){for(let r=0,n=e.length;r<n;r+=3)b.fromArray(Lm,e,r),b.normalize(Lm,Lm),b.scale(Lm,Lm,t),b.toArray(Lm,e,r)}var rhe=b(),a7=b(),nhe=b(),xp=b(),ohe=b();function Dk(e,t,r,n,o){for(let i=0,a=o*3;i<a;i+=3){let s=t[i]*3,l=t[i+1]*3,u=t[i+2]*3;b.fromArray(rhe,e,s),b.fromArray(a7,e,l),b.fromArray(nhe,e,u),b.sub(xp,nhe,a7),b.sub(ohe,rhe,a7),b.cross(xp,xp,ohe),r[s]+=xp[0],r[s+1]+=xp[1],r[s+2]+=xp[2],r[l]+=xp[0],r[l+1]+=xp[1],r[l+2]+=xp[2],r[u]+=xp[0],r[u+1]+=xp[1],r[u+2]+=xp[2]}return GQe(r,n)}function Cp(e,t,r=1){let n=xl(e),o=new Int32Array(n+2),i=new Int32Array(t),a=new Int32Array(t);for(let u=0,c=t*r;u<c;u+=r)++a[e[u]];let s=0;for(let u=0;u<t;u++)o[u]=s,s+=a[u];o[t]=s;let l=new Int32Array(s);for(let u=0,c=t*r;u<c;u+=r){let m=e[u],d=o[m]+i[m];l[d]=u,++i[m]}return{indices:l,offsets:o}}var s7=b.fromArray,wk=b.transformMat4Offset;function UQe(e,t){e=Math.max(e,2);let r=Math.sqrt(e),n=Math.ceil(r);n=n+(t-n%t)%t;let o=n>0?Math.ceil(e/n):0;return{width:n,height:o,length:n*o*t}}function So(e,t,r,n){let{length:o,width:i,height:a}=UQe(e,t);return n=n&&n.length>=o?n:new r(o),{array:n,width:i,height:a}}var Sp=b(),NQe=new Fi("14"),zQe=new Fi("98");function she(e){return e>1e5?NQe:zQe}function Vm(e,t,r){let n=r*3,o=she(t);o.reset();for(let a=0,s=t*3;a<s;a+=n)s7(Sp,e,a),o.includePosition(Sp);o.finishedIncludeStep();for(let a=0,s=t*3;a<s;a+=n)s7(Sp,e,a),o.radiusPosition(Sp);let i=o.getSphere();if(t<=14){let a=[];for(let s=0,l=t*3;s<l;s+=n)a.push(s7(b(),e,s));he.setExtrema(i,a)}return i}var l7=H();function Li(e,t,r,n){if(r===1){H.fromArray(l7,t,n);let l=he.clone(e);return H.isIdentity(l7)?l:he.transform(l,l,l7)}let o=she(r);o.reset();let{center:i,radius:a,extrema:s}=e;if(s&&r<=14){for(let l=0,u=r;l<u;++l)for(let c of s)wk(Sp,c,t,0,0,l*16+n),o.includePosition(Sp);o.finishedIncludeStep();for(let l=0,u=r;l<u;++l)for(let c of s)wk(Sp,c,t,0,0,l*16+n),o.radiusPosition(Sp)}else{for(let l=0,u=r;l<u;++l)wk(Sp,i,t,0,0,l*16+n),o.includePositionRadius(Sp,a);o.finishedIncludeStep();for(let l=0,u=r;l<u;++l)wk(Sp,i,t,0,0,l*16+n),o.radiusPositionRadius(Sp,a)}return o.getSphere()}var Lu=new Uint8Array(772);Lu[1]=1;Lu[2]=1;Lu[3]=1;Lu[256]=1;Lu[512]=1;Lu[768]=1;Lu[257]=2;Lu[513]=2;Lu[769]=2;Lu[258]=2;Lu[514]=2;Lu[770]=2;Lu[259]=2;Lu[515]=2;Lu[771]=2;function u7(e,t){if(t===0)return 0;let r=new Uint32Array(e.buffer,0,e.buffer.byteLength>>2),n=t-4>>2,o=4*n,i=0;if(n<0)for(let a=0;a<t;++a)i+=e[a]&&1;else{for(let a=0;a<n;++a){let s=r[a];i+=Lu[s&65535]+Lu[s>>16]}for(let a=o;a<t;++a)i+=e[a]&&1}return i/t}function yo(e,t,r){let n=So(Math.max(1,e),1,Uint8Array,r&&r.tMarker.ref.value.array),o=u7(n.array,e),i=o===0?0:-1;return r?(_.updateIfChanged(r.uMarker,0),_.update(r.tMarker,n),_.update(r.uMarkerTexDim,Ce.create(n.width,n.height)),_.updateIfChanged(r.markerAverage,o),_.updateIfChanged(r.markerStatus,i),_.updateIfChanged(r.dMarkerType,t),r):{uMarker:_.create(0),tMarker:_.create(n),uMarkerTexDim:_.create(Ce.create(n.width,n.height)),markerAverage:_.create(o),markerStatus:_.create(i),dMarkerType:_.create(t)}}var fir={array:new Uint8Array(1),width:1,height:1};var Vu={kind:"null-location"};function Mk(e,t,r){return{kind:"data-location",tag:e,data:t,element:r}}function un(e,t,r,n,o=!1,i=()=>!1,a){if(e%r!==0)throw new Error("incompatible groupCount and stride");let s={location:Vu,location2:Vu,index:0,groupIndex:0,instanceIndex:0,isSecondary:!1},l=s.groupIndex<e,u=!1,c=0,m=0,d=!1,p=!!a;return{get hasNext(){return l},get isNextNewInstance(){return u},groupCount:e,instanceCount:t,count:e*t,stride:r,nonInstanceable:o,hasLocation2:p,move(){return l&&(s.groupIndex=c,s.instanceIndex=m,s.index=m*e+c,s.location=n(c,d?-1:m),p&&(s.location2=a(c,d?-1:m)),s.isSecondary=i(c,d?-1:m),c+=r,c===e?(++m,u=!0,m<t&&(c=0)):u=!1,l=c<e),s},reset(){s.location=Vu,s.location2=Vu,s.index=0,s.groupIndex=0,s.instanceIndex=0,s.isSecondary=!1,l=s.groupIndex<e,u=!1,c=0,m=0,d=!1},skipInstance(){l&&s.instanceIndex===m&&(++m,c=0,l=m<t)},voidInstances(){d=!0}}}var vg={get hasNext(){return!1},get isNextNewInstance(){return!1},groupCount:0,instanceCount:0,count:0,stride:0,nonInstanceable:!1,hasLocation2:!1,move(){return{location:Vu,location2:Vu,index:0,groupIndex:0,instanceIndex:0,isSecondary:!1}},reset(){},skipInstance(){},voidInstances(){}};function zs(e,t){return{kind:"position-location",position:e?b.clone(e):b(),normal:t?b.clone(t):b()}}function $I(e){return!!e&&e.kind==="position-location"}var uhe=gi();function HQe(e,t){switch(t){case e.FRAMEBUFFER_COMPLETE:return"complete";case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"incomplete attachment";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"incomplete missing attachment";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"incomplete dimensions";case e.FRAMEBUFFER_UNSUPPORTED:return"unsupported"}if(Ht(e))switch(t){case e.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE:return"incomplete multisample";case e.RENDERBUFFER_SAMPLES:return"renderbuffer samples"}return"unknown error"}function eA(e,t){let r=e.checkFramebufferStatus(e.FRAMEBUFFER);if(r!==e.FRAMEBUFFER_COMPLETE){let n=HQe(e,r);throw new Error(`Framebuffer status: ${n}${t?` (${t})`:""}`)}}function lhe(e){let t=e.createFramebuffer();if(t===null)throw new Error("Could not create WebGL framebuffer");return t}function che(e){let t=lhe(e),r=!1;return{id:uhe(),bind:()=>e.bindFramebuffer(e.FRAMEBUFFER,t),reset:()=>{t=lhe(e)},destroy:()=>{r||(e.deleteFramebuffer(t),r=!0)}}}function mhe(){return{id:uhe(),bind:()=>{},reset:()=>{},destroy:()=>{}}}function c7(e){let t=phe(e);if(t===null)throw new Error('Could not find support for "instanced_arrays"');let r=hhe(e);if(r===null)throw new Error('Could not find support for "element_index_uint"');let n=fhe(e);if(n===null)throw new Error('Could not find support for "standard_derivatives"');let o=yhe(e);Yt&&o===null&&console.log('Could not find support for "texture_float"');let i=bhe(e);Yt&&i===null&&console.log('Could not find support for "texture_float_linear"');let a=xhe(e);Yt&&a===null&&console.log('Could not find support for "texture_half_float"');let s=Che(e);Yt&&s===null&&console.log('Could not find support for "texture_half_float_linear"');let l=Rhe(e);Yt&&l===null&&console.log('Could not find support for "depth_texture"');let u=She(e);Yt&&u===null&&console.log('Could not find support for "blend_minmax"');let c=ghe(e);Yt&&c===null&&console.log('Could not find support for "vertex_array_object"');let m=vhe(e);Yt&&m===null&&console.log('Could not find support for "frag_depth"');let d=Ihe(e);Yt&&d===null&&console.log('Could not find support for "color_buffer_float"');let p=Ahe(e);Yt&&p===null&&console.log('Could not find support for "color_buffer_half_float"');let h=The(e);Yt&&h===null&&console.log('Could not find support for "draw_buffers"');let f=Phe(e);Yt&&f===null&&console.log('Could not find support for "draw_buffers_indexed"');let g=_he(e);Yt&&g===null&&console.log('Could not find support for "shader_texture_lod"');let y=Dhe(e);Yt&&y===null&&console.log('Could not find support for "sRGB"');let x=whe(e);Yt&&x===null&&console.log('Could not find support for "disjoint_timer_query"');let S=Mhe(e);Yt&&S===null&&console.log('Could not find support for "multi_draw"');let I=Bhe(e);Yt&&I===null&&console.log('Could not find support for "draw_instanced_base_vertex_base_instance"');let v=Ehe(e);Yt&&v===null&&console.log('Could not find support for "multi_draw_instanced_base_vertex_base_instance"');let A=khe(e);Yt&&A===null&&console.log('Could not find support for "parallel_shader_compile"');let P=Fhe(e);Yt&&P===null&&console.log('Could not find support for "fbo_render_mipmap"');let T=Lhe(e);Yt&&T===null&&console.log('Could not find support for "provoking_vertex"');let R=Vhe(e);Yt&&R===null&&console.log('Could not find support for "clip_cull_distance"');let w=Ohe(e);Yt&&w===null&&console.log('Could not find support for "conservative_depth"');let E=Ghe(e);Yt&&E===null&&console.log('Could not find support for "stencil_texturing"');let M=Uhe(e);Yt&&M===null&&console.log('Could not find support for "clip_control"');let D=Nhe(e);Yt&&D===null&&console.log('Could not find support for "render_snorm"');let B=zhe(e);Yt&&B===null&&console.log('Could not find support for "render_shared_exponent"');let k=Hhe(e);Yt&&k===null&&console.log('Could not find support for "texture_norm16"');let F=jhe(e);Yt&&F===null&&console.log('Could not find support for "depth_clamp"');let z=Whe(e);Yt&&z===null&&console.log('Could not find support for "multiview2"');let j=Xhe(e);return{instancedArrays:t,standardDerivatives:n,elementIndexUint:r,textureFloat:o,textureFloatLinear:i,textureHalfFloat:a,textureHalfFloatLinear:s,depthTexture:l,blendMinMax:u,vertexArrayObject:c,fragDepth:m,colorBufferFloat:d,colorBufferHalfFloat:p,drawBuffers:h,drawBuffersIndexed:f,shaderTextureLod:g,sRGB:y,disjointTimerQuery:x,multiDraw:S,drawInstancedBaseVertexBaseInstance:I,multiDrawInstancedBaseVertexBaseInstance:v,parallelShaderCompile:A,fboRenderMipmap:P,provokingVertex:T,clipCullDistance:R,conservativeDepth:w,stencilTexturing:E,clipControl:M,renderSnorm:D,renderSharedExponent:B,textureNorm16:k,depthClamp:F,multiview2:z,noNonInstancedActiveAttribs:j}}function dhe(e,t){let r=c7(e);wi(t,(n,o)=>{o==="noNonInstancedActiveAttribs"?t.noNonInstancedActiveAttribs=r.noNonInstancedActiveAttribs:n!==null&&(r[o]===null?t[o]=null:Object.assign(n,r[o]))})}function Qhe(e,t){let r={},n=e.getParameter(e.FRONT_FACE),o=e.getParameter(e.CULL_FACE_MODE),i=e.getParameter(e.DEPTH_WRITEMASK),a=e.getParameter(e.DEPTH_CLEAR_VALUE),s=e.getParameter(e.DEPTH_FUNC),l=e.getParameter(e.COLOR_WRITEMASK),u=e.getParameter(e.COLOR_CLEAR_VALUE),c=e.getParameter(e.BLEND_SRC_RGB),m=e.getParameter(e.BLEND_DST_RGB),d=e.getParameter(e.BLEND_SRC_ALPHA),p=e.getParameter(e.BLEND_DST_ALPHA),h=e.getParameter(e.BLEND_COLOR),f=e.getParameter(e.BLEND_EQUATION_RGB),g=e.getParameter(e.BLEND_EQUATION_ALPHA),y=e.getParameter(e.STENCIL_FUNC),x=e.getParameter(e.STENCIL_VALUE_MASK),S=e.getParameter(e.STENCIL_REF),I=e.getParameter(e.STENCIL_BACK_FUNC),v=e.getParameter(e.STENCIL_BACK_VALUE_MASK),A=e.getParameter(e.STENCIL_BACK_REF),P=e.getParameter(e.STENCIL_WRITEMASK),T=e.getParameter(e.STENCIL_BACK_WRITEMASK),R=e.getParameter(e.STENCIL_FAIL),w=e.getParameter(e.STENCIL_PASS_DEPTH_PASS),E=e.getParameter(e.STENCIL_PASS_DEPTH_FAIL),M=e.getParameter(e.STENCIL_BACK_FAIL),D=e.getParameter(e.STENCIL_BACK_PASS_DEPTH_PASS),B=e.getParameter(e.STENCIL_BACK_PASS_DEPTH_FAIL),k=e.getParameter(e.MAX_VERTEX_ATTRIBS),F=[],z=e.getParameter(e.VIEWPORT),j=e.getParameter(e.SCISSOR_BOX),Y=t.clipControl?e.getParameter(t.clipControl.CLIP_ORIGIN):-1,G=t.clipControl?e.getParameter(t.clipControl.CLIP_DEPTH_MODE):-1,X=()=>{for(let U=0;U<k;++U)F[U]=0};return X(),{currentProgramId:-1,currentMaterialId:-1,currentRenderItemId:-1,enable:U=>{r[U]!==!0&&(e.enable(U),r[U]=!0)},disable:U=>{r[U]!==!1&&(e.disable(U),r[U]=!1)},frontFace:U=>{U!==n&&(e.frontFace(U),n=U)},cullFace:U=>{U!==o&&(e.cullFace(U),o=U)},depthMask:U=>{U!==i&&(e.depthMask(U),i=U)},clearDepth:U=>{U!==a&&(e.clearDepth(U),a=U)},depthFunc:U=>{U!==s&&(e.depthFunc(U),s=U)},colorMask:(U,L,q,te)=>{(U!==l[0]||L!==l[1]||q!==l[2]||te!==l[3])&&(e.colorMask(U,L,q,te),l[0]=U,l[1]=L,l[2]=q,l[3]=te)},clearColor:(U,L,q,te)=>{(U!==u[0]||L!==u[1]||q!==u[2]||te!==u[3])&&(e.clearColor(U,L,q,te),u[0]=U,u[1]=L,u[2]=q,u[3]=te)},blendFunc:(U,L)=>{(U!==c||L!==m||U!==d||L!==p)&&(e.blendFunc(U,L),c=U,m=L,d=U,p=L)},blendFuncSeparate:(U,L,q,te)=>{(U!==c||L!==m||q!==d||te!==p)&&(e.blendFuncSeparate(U,L,q,te),c=U,m=L,d=q,p=te)},blendEquation:U=>{(U!==f||U!==g)&&(e.blendEquation(U),f=U,g=U)},blendEquationSeparate:(U,L)=>{(U!==f||L!==g)&&(e.blendEquationSeparate(U,L),f=U,g=L)},blendColor:(U,L,q,te)=>{(U!==h[0]||L!==h[1]||q!==h[2]||te!==h[3])&&(e.blendColor(U,L,q,te),h[0]=U,h[1]=L,h[2]=q,h[3]=te)},stencilFunc:(U,L,q)=>{(U!==y||L!==S||q!==x||U!==I||L!==A||q!==v)&&(e.stencilFunc(U,L,q),y=U,S=L,x=q,I=U,A=L,v=q)},stencilFuncSeparate:(U,L,q,te)=>{U===e.FRONT?(L!==y||q!==S||te!==x)&&(e.stencilFuncSeparate(U,L,q,te),y=L,S=q,x=te):U===e.BACK?(L!==I||q!==A||te!==v)&&(e.stencilFuncSeparate(U,L,q,te),I=L,A=q,v=te):U===e.FRONT_AND_BACK&&(L!==y||q!==S||te!==x||L!==I||q!==A||te!==v)&&(e.stencilFuncSeparate(U,L,q,te),y=L,S=q,x=te,I=L,A=q,v=te)},stencilMask:U=>{(U!==P||U!==T)&&(e.stencilMask(U),P=U,T=U)},stencilMaskSeparate:(U,L)=>{U===e.FRONT?L!==P&&(e.stencilMaskSeparate(U,L),P=L):U===e.BACK?L!==T&&(e.stencilMaskSeparate(U,L),T=L):U===e.FRONT_AND_BACK&&(L!==P||L!==T)&&(e.stencilMaskSeparate(U,L),P=L,T=L)},stencilOp:(U,L,q)=>{(U!==R||L!==E||q!==w||U!==M||L!==B||q!==D)&&(e.stencilOp(U,L,q),R=U,E=L,w=q,M=U,B=L,D=q)},stencilOpSeparate:(U,L,q,te)=>{U===e.FRONT?(L!==R||q!==E||te!==w)&&(e.stencilOpSeparate(U,L,q,te),R=L,E=q,w=te):U===e.BACK?(L!==M||q!==B||te!==D)&&(e.stencilOpSeparate(U,L,q,te),M=L,B=q,D=te):U===e.FRONT_AND_BACK&&(L!==R||q!==E||te!==w||L!==M||q!==B||te!==D)&&(e.stencilOpSeparate(U,L,q,te),R=L,E=q,w=te,M=L,B=q,D=te)},enableVertexAttrib:U=>{e.enableVertexAttribArray(U),F[U]=1},clearVertexAttribsState:X,disableUnusedVertexAttribs:()=>{for(let U=0;U<k;++U)F[U]===0&&e.disableVertexAttribArray(U)},viewport:(U,L,q,te)=>{(U!==z[0]||L!==z[1]||q!==z[2]||te!==z[3])&&(e.viewport(U,L,q,te),z[0]=U,z[1]=L,z[2]=q,z[3]=te)},scissor:(U,L,q,te)=>{(U!==j[0]||L!==j[1]||q!==j[2]||te!==j[3])&&(e.scissor(U,L,q,te),j[0]=U,j[1]=L,j[2]=q,j[3]=te)},clipControl:t.clipControl?(U,L)=>{(U!==Y||L!==G)&&(t.clipControl.clipControl(U,L),Y=U,G=L)}:void 0,reset:()=>{r={},n=e.getParameter(e.FRONT_FACE),o=e.getParameter(e.CULL_FACE_MODE),i=e.getParameter(e.DEPTH_WRITEMASK),a=e.getParameter(e.DEPTH_CLEAR_VALUE),s=e.getParameter(e.DEPTH_FUNC),l=e.getParameter(e.COLOR_WRITEMASK),u=e.getParameter(e.COLOR_CLEAR_VALUE),c=e.getParameter(e.BLEND_SRC_RGB),m=e.getParameter(e.BLEND_DST_RGB),d=e.getParameter(e.BLEND_SRC_ALPHA),p=e.getParameter(e.BLEND_DST_ALPHA),h=e.getParameter(e.BLEND_COLOR),f=e.getParameter(e.BLEND_EQUATION_RGB),g=e.getParameter(e.BLEND_EQUATION_ALPHA),y=e.getParameter(e.STENCIL_FUNC),x=e.getParameter(e.STENCIL_VALUE_MASK),S=e.getParameter(e.STENCIL_REF),I=e.getParameter(e.STENCIL_BACK_FUNC),v=e.getParameter(e.STENCIL_BACK_VALUE_MASK),A=e.getParameter(e.STENCIL_BACK_REF),P=e.getParameter(e.STENCIL_WRITEMASK),T=e.getParameter(e.STENCIL_BACK_WRITEMASK),R=e.getParameter(e.STENCIL_FAIL),w=e.getParameter(e.STENCIL_PASS_DEPTH_PASS),E=e.getParameter(e.STENCIL_PASS_DEPTH_FAIL),M=e.getParameter(e.STENCIL_BACK_FAIL),D=e.getParameter(e.STENCIL_BACK_PASS_DEPTH_PASS),B=e.getParameter(e.STENCIL_BACK_PASS_DEPTH_FAIL),k=e.getParameter(e.MAX_VERTEX_ATTRIBS),F.length=0;for(let U=0;U<k;++U)F[U]=0;z=e.getParameter(e.VIEWPORT),j=e.getParameter(e.SCISSOR_BOX),Y=t.clipControl?e.getParameter(t.clipControl.CLIP_ORIGIN):-1,G=t.clipControl?e.getParameter(t.clipControl.CLIP_DEPTH_MODE):-1}}}var Zhe=`
float preFogAlpha = gl_FragColor.a;
if (uFog) {
    float viewZ = depthToViewZ(uIsOrtho, fragmentDepth, uNear, uFar);
    float fogFactor = smoothstep(uFogNear, uFogFar, abs(viewZ));
    float fogAlpha = (1.0 - fogFactor) * gl_FragColor.a;
    if (!uTransparentBackground) {
        if (gl_FragColor.a < 1.0) {
            // transparent objects are blended with background color
            gl_FragColor.a = fogAlpha;
        } else {
            // mix opaque objects with background color
            gl_FragColor.rgb = mix(gl_FragColor.rgb, uFogColor, fogFactor);
        }
    } else {
        #if defined(dRenderVariant_colorDpoit) && !defined(dGeometryType_directVolume)
            if (gl_FragColor.a < 1.0) {
                // transparent objects are blended with background color
                gl_FragColor.a = fogAlpha;
            } else {
                // opaque objects need to be pre-multiplied alpha
                gl_FragColor.rgb *= fogAlpha;
                gl_FragColor.a = fogAlpha;
            }
        #else
            // pre-multiplied alpha expected for transparent background
            gl_FragColor.rgb *= fogAlpha;
            gl_FragColor.a = fogAlpha;
        #endif
    }
} else if (uTransparentBackground) {
    #if !defined(dRenderVariant_colorDpoit) && !defined(dGeometryType_directVolume)
        // pre-multiplied alpha expected for transparent background
        gl_FragColor.rgb *= gl_FragColor.a;
    #endif
}
`;var qhe=`
if (interior) {
    material.rgb = mix(material.rgb, uInteriorColor.rgb, uInteriorColor.a);

    float isf = clamp(uInteriorSubstance.a, 0.0, 0.99); // clamp to avoid artifacts
    metalness = mix(metalness, uInteriorSubstance.r, isf);
    roughness = mix(roughness, uInteriorSubstance.g, isf);
    bumpiness = mix(bumpiness, uInteriorSubstance.b, isf);

    #ifdef dTransparentBackfaces_opaque
        material.a = 1.0;
    #endif
}
`;var Yhe=`
#if defined(dIgnoreLight)
    #ifdef bumpEnabled
        if (uBumpFrequency > 0.0 && uBumpAmplitude > 0.0 && bumpiness > 0.0) {
            material.rgb += fbm(vModelPosition * uBumpFrequency) * uBumpAmplitude * bumpiness;
            material.rgb -= 0.5 * uBumpAmplitude * bumpiness;
        }
    #endif

    #if defined(dRenderVariant_color)
        material.rgb += material.rgb * emissive;
    #endif

    gl_FragColor = material;
#else
    #ifdef bumpEnabled
        if (uBumpFrequency > 0.0 && uBumpAmplitude > 0.0 && bumpiness > 0.0) {
            normal = perturbNormal(-vViewPosition, normal, fbm(vModelPosition * uBumpFrequency), (uBumpAmplitude * bumpiness) / uBumpFrequency);
        }
    #endif

    vec4 color = material;

    #if defined(dCelShaded)
        // clamp to avoid artifacts
        metalness = clamp(metalness, 0.0, 0.99);
        roughness = clamp(roughness, 0.05, 1.0);
    #endif

    GeometricContext geometry;
    geometry.position = -vViewPosition;
    geometry.normal = normal;
    geometry.viewDir = normalize(vViewPosition);

    PhysicalMaterial physicalMaterial;
    physicalMaterial.diffuseColor = color.rgb * (1.0 - metalness);
    #ifdef enabledFragDepth
        physicalMaterial.roughness = min(max(roughness, 0.0525), 1.0);
    #else
        vec3 dxy = max(abs(dFdx(normal)), abs(dFdy(normal)));
        float geometryRoughness = max(max(dxy.x, dxy.y), dxy.z);
        physicalMaterial.roughness = min(max(roughness, 0.0525) + geometryRoughness, 1.0);
    #endif
    physicalMaterial.specularColor = mix(vec3(0.04), color.rgb, metalness);
    physicalMaterial.specularF90 = 1.0;

    IncidentLight directLight;

    vec3 outgoingLight = vec3(0.0);

    #if defined(dCelShaded)
        float celDiffuse;
        float celSpecular;
        float celIntensity;

        #pragma unroll_loop_start
        for (int i = 0; i < dLightCount; ++i) {
            directLight.direction = uLightDirection[i];
            directLight.color = uLightColor[i] * PI; // * PI for punctual light

            celDiffuse = RECIPROCAL_PI * max(dot(geometry.normal, directLight.direction), 0.0) * (1.0 - metalness);
            celSpecular = luminance(saturate(dot(geometry.normal, directLight.direction)) * BRDF_GGX(directLight.direction, geometry.viewDir, geometry.normal, physicalMaterial.specularColor, physicalMaterial.specularF90, roughness));

            celIntensity = celDiffuse + celSpecular;
            celIntensity = ceil(celIntensity * uCelSteps) / uCelSteps;

            outgoingLight += color.rgb * directLight.color * celIntensity;
        }
        #pragma unroll_loop_end

        outgoingLight += physicalMaterial.diffuseColor * luminance(uAmbientColor);
    #else
        ReflectedLight reflectedLight = ReflectedLight(vec3(0.0), vec3(0.0), vec3(0.0), vec3(0.0));

        #pragma unroll_loop_start
        for (int i = 0; i < dLightCount; ++i) {
            directLight.direction = uLightDirection[i];
            directLight.color = uLightColor[i] * PI; // * PI for punctual light
            RE_Direct_Physical(directLight, geometry, physicalMaterial, reflectedLight);
        }
        #pragma unroll_loop_end

        vec3 irradiance = uAmbientColor * PI; // * PI for punctual light
        RE_IndirectDiffuse_Physical(irradiance, geometry, physicalMaterial, reflectedLight);

        // indirect specular only metals
        vec3 radiance = uAmbientColor * metalness;
        vec3 iblIrradiance = uAmbientColor * metalness;
        vec3 clearcoatRadiance = vec3(0.0);
        RE_IndirectSpecular_Physical(radiance, iblIrradiance, clearcoatRadiance, geometry, physicalMaterial, reflectedLight);

        outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular;
    #endif
    outgoingLight = clamp(outgoingLight, 0.01, 0.99); // prevents black artifacts on specular highlight with transparent background

    #if defined(dRenderVariant_color)
        outgoingLight += color.rgb * emissive;
    #endif

    gl_FragColor = vec4(outgoingLight, color.a);
#endif

gl_FragColor.rgb *= uExposure;
`;var Khe=`

#if defined(dColorMarker)
    if (marker > 0.0) {
        if ((uMarkerPriority == 1 && marker != 2.0) || (uMarkerPriority != 1 && marker == 1.0)) {
            gl_FragColor.rgb = mix(gl_FragColor.rgb, uHighlightColor, uHighlightStrength);
            gl_FragColor.a = max(gl_FragColor.a, uHighlightStrength * 0.002); // for direct-volume rendering
        } else {
            gl_FragColor.rgb = mix(gl_FragColor.rgb, uSelectColor, uSelectStrength);
            gl_FragColor.a = max(gl_FragColor.a, uSelectStrength * 0.002); // for direct-volume rendering
        }
    } else if (uMarkerAverage > 0.0) {
        gl_FragColor.rgb = mix(gl_FragColor.rgb, uDimColor, uDimStrength);
        gl_FragColor.a = max(gl_FragColor.a, uDimStrength * 0.002); // for direct-volume rendering
    }
#endif
`;var Jhe=`
#if dClipObjectCount != 0 && defined(dClipping)
    #if defined(dClippingType_instance)
        vClipping = readFromTexture(tClipping, aInstance, uClippingTexDim).a;
    #elif defined(dMarkerType_groupInstance)
        vClipping = readFromTexture(tClipping, aInstance * float(uGroupCount) + group, uClippingTexDim).a;
    #endif
#endif
`;var $he=`
#if defined(dRenderVariant_color) || defined(dRenderVariant_tracing)
    #if defined(dColorType_attribute)
        vColor.rgb = aColor;
    #elif defined(dColorType_instance)
        vColor.rgb = readFromTexture(tColor, aInstance, uColorTexDim).rgb;
    #elif defined(dColorType_group)
        #if defined(dDualColor)
            vec4 color2;
            if (aColorMode == 2.0) {
                vColor.rgb = readFromTexture(tColor, group, uColorTexDim).rgb;
            } else {
                vColor.rgb = readFromTexture(tColor, group * 2.0, uColorTexDim).rgb;
                color2.rgb = readFromTexture(tColor, group * 2.0 + 1.0, uColorTexDim).rgb;
            }
        #else
            vColor.rgb = readFromTexture(tColor, group, uColorTexDim).rgb;
        #endif
    #elif defined(dColorType_groupInstance)
        #if defined(dDualColor)
            vec4 color2;
            if (aColorMode == 2.0) {
                vColor.rgb = readFromTexture(tColor, aInstance * float(uGroupCount) + group, uColorTexDim).rgb;
            } else {
                vColor.rgb = readFromTexture(tColor, (aInstance * float(uGroupCount) + group) * 2.0, uColorTexDim).rgb;
                color2.rgb = readFromTexture(tColor, (aInstance * float(uGroupCount) + group) * 2.0 + 1.0, uColorTexDim).rgb;
            }
        #else
            vColor.rgb = readFromTexture(tColor, aInstance * float(uGroupCount) + group, uColorTexDim).rgb;
        #endif
    #elif defined(dColorType_vertex)
        vColor.rgb = readFromTexture(tColor, vertexId, uColorTexDim).rgb;
    #elif defined(dColorType_vertexInstance)
        vColor.rgb = readFromTexture(tColor, int(aInstance) * uVertexCount + vertexId, uColorTexDim).rgb;
    #elif defined(dColorType_volume)
        vec3 cgridPos = (uColorGridTransform.w * (position - uColorGridTransform.xyz)) / uColorGridDim;
        vColor.rgb = texture3dFrom2dLinear(tColorGrid, cgridPos, uColorGridDim, uColorTexDim).rgb;
    #elif defined(dColorType_volumeInstance)
        vec3 cgridPos = (uColorGridTransform.w * (vModelPosition / uModelScale - uColorGridTransform.xyz)) / uColorGridDim;
        vColor.rgb = texture3dFrom2dLinear(tColorGrid, cgridPos, uColorGridDim, uColorTexDim).rgb;
    #endif

    #ifdef dUsePalette
        vPaletteV = ((vColor.r * 256.0 * 256.0 * 255.0 + vColor.g * 256.0 * 255.0 + vColor.b * 255.0) - 1.0) / PALETTE_SCALE;
    #endif

    #ifdef dOverpaint
        #if defined(dOverpaintType_instance)
            vOverpaint = readFromTexture(tOverpaint, aInstance, uOverpaintTexDim);
        #elif defined(dOverpaintType_groupInstance)
            vOverpaint = readFromTexture(tOverpaint, aInstance * float(uGroupCount) + group, uOverpaintTexDim);
        #elif defined(dOverpaintType_vertexInstance)
            vOverpaint = readFromTexture(tOverpaint, int(aInstance) * uVertexCount + vertexId, uOverpaintTexDim);
        #elif defined(dOverpaintType_volumeInstance)
            vec3 ogridPos = (uOverpaintGridTransform.w * (vModelPosition / uModelScale - uOverpaintGridTransform.xyz)) / uOverpaintGridDim;
            vOverpaint = texture3dFrom2dLinear(tOverpaintGrid, ogridPos, uOverpaintGridDim, uOverpaintTexDim);
        #endif

        // pre-mix to avoid darkening due to empty overpaint
        #ifdef dColorType_uniform
            vOverpaint.rgb = mix(uColor.rgb, vOverpaint.rgb, vOverpaint.a);
        #else
            vOverpaint.rgb = mix(vColor.rgb, vOverpaint.rgb, vOverpaint.a);
        #endif
        vOverpaint *= uOverpaintStrength;
    #endif

    #ifdef dEmissive
        #if defined(dEmissiveType_instance)
            vEmissive = readFromTexture(tEmissive, aInstance, uEmissiveTexDim).a;
        #elif defined(dEmissiveType_groupInstance)
            vEmissive = readFromTexture(tEmissive, aInstance * float(uGroupCount) + group, uEmissiveTexDim).a;
        #elif defined(dEmissiveType_vertexInstance)
            vEmissive = readFromTexture(tEmissive, int(aInstance) * uVertexCount + vertexId, uEmissiveTexDim).a;
        #elif defined(dEmissiveType_volumeInstance)
            vec3 egridPos = (uEmissiveGridTransform.w * (vModelPosition / uModelScale - uEmissiveGridTransform.xyz)) / uEmissiveGridDim;
            vEmissive = texture3dFrom2dLinear(tEmissiveGrid, egridPos, uEmissiveGridDim, uEmissiveTexDim).a;
        #endif
        vEmissive *= uEmissiveStrength;
    #endif

    #ifdef dSubstance
        #if defined(dSubstanceType_instance)
            vSubstance = readFromTexture(tSubstance, aInstance, uSubstanceTexDim);
        #elif defined(dSubstanceType_groupInstance)
            vSubstance = readFromTexture(tSubstance, aInstance * float(uGroupCount) + group, uSubstanceTexDim);
        #elif defined(dSubstanceType_vertexInstance)
            vSubstance = readFromTexture(tSubstance, int(aInstance) * uVertexCount + vertexId, uSubstanceTexDim);
        #elif defined(dSubstanceType_volumeInstance)
            vec3 sgridPos = (uSubstanceGridTransform.w * (vModelPosition / uModelScale - uSubstanceGridTransform.xyz)) / uSubstanceGridDim;
            vSubstance = texture3dFrom2dLinear(tSubstanceGrid, sgridPos, uSubstanceGridDim, uSubstanceTexDim);
        #endif

        // pre-mix to avoid artifacts due to empty substance
        vSubstance.rgb = mix(vec3(uMetalness, uRoughness, uBumpiness), vSubstance.rgb, vSubstance.a);
        vSubstance *= uSubstanceStrength;
    #endif
#elif defined(dRenderVariant_emissive)
    #ifdef dEmissive
        #if defined(dEmissiveType_instance)
            vEmissive = readFromTexture(tEmissive, aInstance, uEmissiveTexDim).a;
        #elif defined(dEmissiveType_groupInstance)
            vEmissive = readFromTexture(tEmissive, aInstance * float(uGroupCount) + group, uEmissiveTexDim).a;
        #elif defined(dEmissiveType_vertexInstance)
            vEmissive = readFromTexture(tEmissive, int(aInstance) * uVertexCount + vertexId, uEmissiveTexDim).a;
        #elif defined(dEmissiveType_volumeInstance)
            vec3 egridPos = (uEmissiveGridTransform.w * (vModelPosition / uModelScale - uEmissiveGridTransform.xyz)) / uEmissiveGridDim;
            vEmissive = texture3dFrom2dLinear(tEmissiveGrid, egridPos, uEmissiveGridDim, uEmissiveTexDim).a;
        #endif
        vEmissive *= uEmissiveStrength;
    #endif
#elif defined(dRenderVariant_pick)
    #ifdef requiredDrawBuffers
        vObject = vec4(packIntToRGB(float(uObjectId)), 1.0);
        vInstance = vec4(packIntToRGB(aInstance), 1.0);
        vGroup = vec4(packIntToRGB(group), 1.0);
    #else
        if (uPickType == 1) {
            vColor = vec4(packIntToRGB(float(uObjectId)), 1.0);
        } else if (uPickType == 2) {
            vColor = vec4(packIntToRGB(aInstance), 1.0);
        } else {
            vColor = vec4(packIntToRGB(group), 1.0);
        }
    #endif
#endif

#ifdef dTransparency
    #if defined(dTransparencyType_instance)
        vTransparency = readFromTexture(tTransparency, aInstance, uTransparencyTexDim).a;
    #elif defined(dTransparencyType_groupInstance)
        vTransparency = readFromTexture(tTransparency, aInstance * float(uGroupCount) + group, uTransparencyTexDim).a;
    #elif defined(dTransparencyType_vertexInstance)
        vTransparency = readFromTexture(tTransparency, int(aInstance) * uVertexCount + vertexId, uTransparencyTexDim).a;
    #elif defined(dTransparencyType_volumeInstance)
        vec3 tgridPos = (uTransparencyGridTransform.w * (vModelPosition / uModelScale - uTransparencyGridTransform.xyz)) / uTransparencyGridDim;
        vTransparency = texture3dFrom2dLinear(tTransparencyGrid, tgridPos, uTransparencyGridDim, uTransparencyTexDim).a;
    #endif
    vTransparency *= uTransparencyStrength;
#endif
`;var ege=`
#ifdef dGeometryType_textureMesh
    float group = unpackRGBToInt(readFromTexture(tGroup, vertexId, uGeoTexDim).rgb);
#else
    float group = aGroup;
#endif
`;var tge=`
#if defined(dNeedsMarker)
    #if defined(dMarkerType_instance)
        vMarker = readFromTexture(tMarker, aInstance, uMarkerTexDim).a;
    #elif defined(dMarkerType_groupInstance)
        vMarker = readFromTexture(tMarker, aInstance * float(uGroupCount) + group, uMarkerTexDim).a;
    #endif
#endif
`;var rge=`
#if defined(dNeedsMarker)
    float marker = uMarker;
    if (uMarker == -1.0) {
        marker = floor(vMarker * 255.0 + 0.5); // rounding required to work on some cards on win
    }
#endif

#if defined(dRenderVariant_color) || defined(dRenderVariant_tracing)
    #if defined(dUsePalette)
        vec4 material = vec4(texture2D(tPalette, vec2(vPaletteV, 0.5)).rgb, uAlpha);
    #elif defined(dColorType_uniform)
        vec4 material = vec4(uColor, uAlpha);
    #elif defined(dColorType_varying)
        vec4 material = vec4(vColor.rgb, uAlpha);
    #endif

    // mix material with overpaint
    #if defined(dOverpaint)
        material.rgb = mix(material.rgb, vOverpaint.rgb, vOverpaint.a);
    #endif

    float emissive = uEmissive;
    #ifdef dEmissive
        emissive += vEmissive;
    #endif

    float metalness = uMetalness;
    float roughness = uRoughness;
    float bumpiness = uBumpiness;
    #ifdef dSubstance
        float sf = clamp(vSubstance.a, 0.0, 0.99); // clamp to avoid artifacts
        metalness = mix(metalness, vSubstance.r, sf);
        roughness = mix(roughness, vSubstance.g, sf);
        bumpiness = mix(bumpiness, vSubstance.b, sf);
    #endif

    #if defined(dXrayShaded)
        material.a = calcXrayShadedAlpha(material.a, normal);
    #endif
#elif defined(dRenderVariant_depth)
    if (fragmentDepth > getDepth(gl_FragCoord.xy / uDrawingBufferSize)) {
        discard;
    }
    vec4 material;
    if (uRenderMask == MaskOpaque) {
        #if defined(dXrayShaded)
            discard;
        #endif
        #if defined(dTransparency)
            float dta = 1.0 - vTransparency;
            #if __VERSION__ == 100 || defined(dVaryingGroup)
                if (vTransparency < 0.1) dta = 1.0; // hard cutoff to avoid artifacts
            #endif

            if (uAlpha * dta < 1.0) {
                discard;
            }
        #else
            if (uAlpha < 1.0) {
                discard;
            }
        #endif
        material = packDepthToRGBA(fragmentDepth);
    } else if (uRenderMask == MaskTransparent) {
        float alpha = uAlpha;
        #if defined(dTransparency)
            float dta = 1.0 - vTransparency;
            alpha *= dta;
        #endif

        #ifdef dXrayShaded
            alpha = calcXrayShadedAlpha(alpha, normal);
        #else
            if (alpha == 1.0) {
                discard;
            }
        #endif
        material = packDepthWithAlphaToRGBA(fragmentDepth, alpha);
    }
#elif defined(dRenderVariant_marking)
    vec4 material;
    if(uMarkingType == 1) {
        if (marker > 0.0)
            discard;
        #ifdef enabledFragDepth
            material = packDepthToRGBA(gl_FragDepthEXT);
        #else
            material = packDepthToRGBA(gl_FragCoord.z);
        #endif
    } else {
        if (marker == 0.0)
            discard;
        float depthTest = 1.0;
        if (uMarkingDepthTest) {
            depthTest = (fragmentDepth >= getDepthPacked(gl_FragCoord.xy / uDrawingBufferSize)) ? 1.0 : 0.0;
        }
        bool isHighlight = intMod(marker, 2.0) > 0.1;
        float viewZ = depthToViewZ(uIsOrtho, fragmentDepth, uNear, uFar);
        float fogFactor = smoothstep(uFogNear, uFogFar, abs(viewZ));
        if (fogFactor == 1.0)
            discard;
        material = vec4(0.0, depthTest, isHighlight ? 1.0 : 0.0, 1.0 - fogFactor);
    }
#elif defined(dRenderVariant_emissive)
    float emissive = uEmissive;
    #ifdef dEmissive
        emissive += vEmissive;
    #endif
    vec4 material = vec4(emissive);
#endif

// apply per-group transparency
#if defined(dTransparency) && (defined(dRenderVariant_pick) || defined(dRenderVariant_color) || defined(dRenderVariant_emissive) || defined(dRenderVariant_tracing))
    float ta = 1.0 - vTransparency;
    if (vTransparency < 0.09) ta = 1.0; // hard cutoff looks better

    #if defined(dRenderVariant_pick)
        if (ta * uAlpha < uPickingAlphaThreshold)
            discard; // ignore so the element below can be picked
    #elif defined(dRenderVariant_emissive)
        if (ta < 1.0)
            discard; // emissive not supported with transparency
    #elif defined(dRenderVariant_color) || defined(dRenderVariant_tracing)
        material.a *= ta;
    #endif
#endif
`;var nge=`
mat4 model = uModel * aTransform;
mat4 modelView = uView * model;
#ifdef dGeometryType_textureMesh
    vec3 position = readFromTexture(tPosition, vertexId, uGeoTexDim).xyz;
#else
    vec3 position = aPosition;
#endif
vec4 position4 = vec4(position, 1.0);
// for accessing tColorGrid in vert shader and for clipping in frag shader
vModelPosition = (model * position4).xyz;
vec4 mvPosition = modelView * position4;
vViewPosition = mvPosition.xyz;
gl_Position = uProjection * mvPosition;
`;var oge=`
#if defined(dSizeType_uniform)
    float size = uSize;
#elif defined(dSizeType_attribute)
    float size = aSize;
#elif defined(dSizeType_instance)
    float size = unpackRGBToInt(readFromTexture(tSize, aInstance, uSizeTexDim).rgb);
#elif defined(dSizeType_group)
    float size = unpackRGBToInt(readFromTexture(tSize, group, uSizeTexDim).rgb);
#elif defined(dSizeType_groupInstance)
    float size = unpackRGBToInt(readFromTexture(tSize, aInstance * float(uGroupCount) + group, uSizeTexDim).rgb);
#endif

#if defined(dSizeType_instance) || defined(dSizeType_group) || defined(dSizeType_groupInstance)
    size /= 100.0; // NOTE factor also set in TypeScript
#endif

size *= uSizeFactor;
`;var ige=`
float viewZ = depthToViewZ(uIsOrtho, fragmentDepth, uNear, uFar);
float fogFactor = smoothstep(uFogNear, uFogFar, abs(viewZ));
float fogAlpha = (1.0 - fogFactor) * uAlpha;
float alpha = uAlpha;
#ifdef dXrayShaded
    // add bias to make picking xray shaded elements easier
    alpha = calcXrayShadedAlpha(alpha, normal) + (0.3 * uPickingAlphaThreshold);
#endif
// if not opaque enough ignore so the element below can be picked
if (alpha < uPickingAlphaThreshold || fogAlpha < 0.1) {
    #ifdef dTransparentBackfaces_opaque
        if (!interior) discard;
    #else
        discard;
    #endif
}
`;var age=`
#if defined(dRenderVariant_color) || defined(dRenderVariant_tracing)
    #if defined(dTransparentBackfaces_off)
        if (interior && material.a < 1.0) discard;
    #elif defined(dTransparentBackfaces_opaque)
        if (interior) material.a = 1.0;
    #endif

    #if !defined(dXrayShaded)
        if ((uRenderMask == MaskOpaque && material.a < 1.0) ||
            (uRenderMask == MaskTransparent && material.a == 1.0)
        ) {
            discard;
        }
    #endif
#endif

#if defined(dRenderVariant_depth)
    #if defined(dTransparentBackfaces_off)
        if (interior) discard;
    #endif
#endif
`;var sge=`
#if defined(dClipVariant_instance) && dClipObjectCount != 0
    vec3 mCenter = (uModel * aTransform * vec4(uInvariantBoundingSphere.xyz, 1.0)).xyz;
    if (clipTest(mCenter / uModelScale)) {
        // move out of [ -w, +w ] to 'discard' in vert shader
        gl_Position.z = 2.0 * gl_Position.w;
    }
#endif
`;var lge=`
#if defined(dClipVariant_pixel) && dClipObjectCount != 0
    if (clipTest(vModelPosition / uModelScale))
        discard;
#endif
`;var uge=`
uniform float uMetalness;
uniform float uRoughness;
uniform float uBumpiness;
#ifdef bumpEnabled
    uniform float uBumpFrequency;
    uniform float uBumpAmplitude;
#endif
uniform float uEmissive;

// Density value to estimate object thickness
uniform float uDensity;

#if defined(dRenderVariant_color) || defined(dRenderVariant_tracing)
    #if defined(dColorType_uniform)
        uniform vec3 uColor;
    #elif defined(dColorType_varying)
        varying vec4 vColor;
    #endif

    #ifdef dUsePalette
        uniform sampler2D tPalette;
        varying float vPaletteV;
    #endif

    #ifdef dOverpaint
        varying vec4 vOverpaint;
    #endif

    #ifdef dEmissive
        varying float vEmissive;
    #endif

    #ifdef dSubstance
        varying vec4 vSubstance;
    #endif
#elif defined(dRenderVariant_emissive)
    #ifdef dEmissive
        varying float vEmissive;
    #endif
#elif defined(dRenderVariant_pick)
    #if __VERSION__ == 100 || !defined(dVaryingGroup)
        #ifdef requiredDrawBuffers
            varying vec4 vObject;
            varying vec4 vInstance;
            varying vec4 vGroup;
        #else
            varying vec4 vColor;
        #endif
    #else
        #ifdef requiredDrawBuffers
            flat in vec4 vObject;
            flat in vec4 vInstance;
            flat in vec4 vGroup;
        #else
            flat in vec4 vColor;
        #endif
    #endif
#endif

#ifdef dTransparency
    varying float vTransparency;
#endif
`;var cge=`
uniform float uMetalness;
uniform float uRoughness;
uniform float uBumpiness;

#if defined(dRenderVariant_color) || defined(dRenderVariant_tracing)
    #if defined(dColorType_uniform)
        uniform vec3 uColor;
    #elif defined(dColorType_attribute)
        varying vec4 vColor;
        attribute vec3 aColor;
    #elif defined(dColorType_texture)
        varying vec4 vColor;
        uniform vec2 uColorTexDim;
        uniform sampler2D tColor;
    #elif defined(dColorType_grid)
        varying vec4 vColor;
        uniform vec2 uColorTexDim;
        uniform vec3 uColorGridDim;
        uniform vec4 uColorGridTransform;
        uniform sampler2D tColorGrid;
    #elif defined(dColorType_direct)
        varying vec4 vColor;
    #endif

    #ifdef dUsePalette
        varying float vPaletteV;
    #endif

    #ifdef dOverpaint
        #if defined(dOverpaintType_instance) || defined(dOverpaintType_groupInstance) || defined(dOverpaintType_vertexInstance)
            varying vec4 vOverpaint;
            uniform vec2 uOverpaintTexDim;
            uniform sampler2D tOverpaint;
        #elif defined(dOverpaintType_volumeInstance)
            varying vec4 vOverpaint;
            uniform vec2 uOverpaintTexDim;
            uniform vec3 uOverpaintGridDim;
            uniform vec4 uOverpaintGridTransform;
            uniform sampler2D tOverpaintGrid;
        #endif
        uniform float uOverpaintStrength;
    #endif

    #ifdef dEmissive
        #if defined(dEmissiveType_instance) || defined(dEmissiveType_groupInstance) || defined(dEmissiveType_vertexInstance)
            varying float vEmissive;
            uniform vec2 uEmissiveTexDim;
            uniform sampler2D tEmissive;
        #elif defined(dEmissiveType_volumeInstance)
            varying float vEmissive;
            uniform vec2 uEmissiveTexDim;
            uniform vec3 uEmissiveGridDim;
            uniform vec4 uEmissiveGridTransform;
            uniform sampler2D tEmissiveGrid;
        #endif
        uniform float uEmissiveStrength;
    #endif

    #ifdef dSubstance
        #if defined(dSubstanceType_instance) || defined(dSubstanceType_groupInstance) || defined(dSubstanceType_vertexInstance)
            varying vec4 vSubstance;
            uniform vec2 uSubstanceTexDim;
            uniform sampler2D tSubstance;
        #elif defined(dSubstanceType_volumeInstance)
            varying vec4 vSubstance;
            uniform vec2 uSubstanceTexDim;
            uniform vec3 uSubstanceGridDim;
            uniform vec4 uSubstanceGridTransform;
            uniform sampler2D tSubstanceGrid;
        #endif
        uniform float uSubstanceStrength;
    #endif
#elif defined(dRenderVariant_emissive)
    #ifdef dEmissive
        #if defined(dEmissiveType_instance) || defined(dEmissiveType_groupInstance) || defined(dEmissiveType_vertexInstance)
            varying float vEmissive;
            uniform vec2 uEmissiveTexDim;
            uniform sampler2D tEmissive;
        #elif defined(dEmissiveType_volumeInstance)
            varying float vEmissive;
            uniform vec2 uEmissiveTexDim;
            uniform vec3 uEmissiveGridDim;
            uniform vec4 uEmissiveGridTransform;
            uniform sampler2D tEmissiveGrid;
        #endif
        uniform float uEmissiveStrength;
    #endif
#elif defined(dRenderVariant_pick)
    #if __VERSION__ == 100 || !defined(dVaryingGroup)
        #ifdef requiredDrawBuffers
            varying vec4 vObject;
            varying vec4 vInstance;
            varying vec4 vGroup;
        #else
            varying vec4 vColor;
        #endif
    #else
        #ifdef requiredDrawBuffers
            flat out vec4 vObject;
            flat out vec4 vInstance;
            flat out vec4 vGroup;
        #else
            flat out vec4 vColor;
        #endif
    #endif
#endif

#ifdef dTransparency
    #if defined(dTransparencyType_instance) || defined(dTransparencyType_groupInstance) || defined(dTransparencyType_vertexInstance)
        varying float vTransparency;
        uniform vec2 uTransparencyTexDim;
        uniform sampler2D tTransparency;
    #elif defined(dTransparencyType_volumeInstance)
        varying float vTransparency;
        uniform vec2 uTransparencyTexDim;
        uniform vec3 uTransparencyGridDim;
        uniform vec4 uTransparencyGridTransform;
        uniform sampler2D tTransparencyGrid;
    #endif
    uniform float uTransparencyStrength;
#endif
`;var mge=`
vec3 quaternionTransform(const in vec4 q, const in vec3 v) {
    vec3 t = 2.0 * cross(q.xyz, v);
    return v + q.w * t + cross(q.xyz, t);
}

vec4 computePlane(const in vec3 normal, const in vec3 inPoint) {
    return vec4(normalize(normal), -dot(normal, inPoint));
}

float planeSD(const in vec4 plane, const in vec3 center) {
    return -dot(plane.xyz, center - plane.xyz * -plane.w);
}

float sphereSD(const in vec3 position, const in vec4 rotation, const in vec3 size, const in vec3 center) {
    return (
        length(quaternionTransform(vec4(-rotation.x, -rotation.y, -rotation.z, rotation.w), center - position) / size) - 1.0
    ) * min(min(size.x, size.y), size.z);
}

float cubeSD(const in vec3 position, const in vec4 rotation, const in vec3 size, const in vec3 center) {
    vec3 d = abs(quaternionTransform(vec4(-rotation.x, -rotation.y, -rotation.z, rotation.w), center - position)) - size;
    return min(max(d.x, max(d.y, d.z)), 0.0) + length(max(d, 0.0));
}

float cylinderSD(const in vec3 position, const in vec4 rotation, const in vec3 size, const in vec3 center) {
    vec3 t = quaternionTransform(vec4(-rotation.x, -rotation.y, -rotation.z, rotation.w), center - position);

    vec2 d = abs(vec2(length(t.xz), t.y)) - size.xy;
    return min(max(d.x, d.y), 0.0) + length(max(d, 0.0));
}

float infiniteConeSD(const in vec3 position, const in vec4 rotation, const in vec3 size, const in vec3 center) {
    vec3 t = quaternionTransform(vec4(-rotation.x, -rotation.y, -rotation.z, rotation.w), center - position);

    float q = length(t.xy);
    return dot(size.xy, vec2(q, t.z));
}

float getSignedDistance(const in vec3 center, const in int type, const in vec3 position, const in vec4 rotation, const in vec3 scale, const in mat4 transform) {
    vec3 c = (transform * vec4(center, 1.0)).xyz;
    if (type == 1) {
        vec3 normal = quaternionTransform(rotation, vec3(0.0, 1.0, 0.0));
        vec4 plane = computePlane(normal, position);
        return planeSD(plane, c);
    } else if (type == 2) {
        return sphereSD(position, rotation, scale * 0.5, c);
    } else if (type == 3) {
        return cubeSD(position, rotation, scale * 0.5, c);
    } else if (type == 4) {
        return cylinderSD(position, rotation, scale * 0.5, c);
    } else if (type == 5) {
        return infiniteConeSD(position, rotation, scale * 0.5, c);
    } else {
        return 0.1;
    }
}

#if __VERSION__ == 100
    // 8-bit
    int bitwiseAnd(in int a, in int b) {
        int d = 128;
        int result = 0;
        for (int i = 0; i < 8; ++i) {
            if (d <= 0) break;
            if (a >= d && b >= d) result += d;
            if (a >= d) a -= d;
            if (b >= d) b -= d;
            d /= 2;
        }
        return result;
    }

    bool hasBit(const in int mask, const in int bit) {
        return bitwiseAnd(mask, bit) == 0;
    }
#else
    bool hasBit(const in int mask, const in int bit) {
        return (mask & bit) == 0;
    }
#endif

#if dClipObjectCount != 0
    bool clipTest(const in vec3 center) {
        // flag is a bit-flag for clip-objects to ignore (note, object ids start at 1 not 0)
        #if defined(dClipping)
            int flag = int(floor(vClipping * 255.0 + 0.5));
        #else
            int flag = 0;
        #endif

        #pragma unroll_loop_start
        for (int i = 0; i < dClipObjectCount; ++i) {
            if (flag == 0 || hasBit(flag, UNROLLED_LOOP_INDEX + 1)) {
                bool test = getSignedDistance(center, uClipObjectType[i], uClipObjectPosition[i], uClipObjectRotation[i], uClipObjectScale[i], uClipObjectTransform[i]) <= 0.0;
                if ((!uClipObjectInvert[i] && test) || (uClipObjectInvert[i] && !test)) {
                    return true;
                }
            }
        }
        #pragma unroll_loop_end
        return false;
    }
#endif
`;var dge=`
uniform int uObjectId;
uniform int uInstanceCount;
uniform int uGroupCount;

uniform int uPickType;
uniform int uMarkingType;

uniform vec4 uCameraPlane;
uniform vec4 uLod;

#if dClipObjectCount != 0
    uniform int uClipObjectType[dClipObjectCount];
    uniform bool uClipObjectInvert[dClipObjectCount];
    uniform vec3 uClipObjectPosition[dClipObjectCount];
    uniform vec4 uClipObjectRotation[dClipObjectCount];
    uniform vec3 uClipObjectScale[dClipObjectCount];
    uniform mat4 uClipObjectTransform[dClipObjectCount];

    #if defined(dClipping)
        #if __VERSION__ == 100 || defined(dClippingType_instance) || !defined(dVaryingGroup)
            varying float vClipping;
        #else
            flat in float vClipping;
        #endif
    #endif
#endif

#if defined(dColorMarker)
    uniform vec3 uHighlightColor;
    uniform vec3 uSelectColor;
    uniform vec3 uDimColor;
    uniform float uHighlightStrength;
    uniform float uSelectStrength;
    uniform float uDimStrength;
    uniform int uMarkerPriority;
    uniform float uMarkerAverage;
#endif

#if defined(dNeedsMarker)
    uniform float uMarker;
    #if __VERSION__ == 100 || defined(dMarkerType_instance) || !defined(dVaryingGroup)
        varying float vMarker;
    #else
        flat in float vMarker;
    #endif
#endif

#if defined(dRenderVariant_colorDpoit)
    #define MAX_DPOIT_DEPTH 99999.0 // NOTE constant also set in TypeScript
    uniform sampler2D tDpoitDepth;
    uniform sampler2D tDpoitFrontColor;
#endif

varying vec3 vModelPosition;
varying vec3 vViewPosition;

uniform vec2 uViewOffset;
uniform float uModelScale;

uniform float uNear;
uniform float uFar;
uniform float uIsOrtho;

uniform bool uFog;
uniform float uFogNear;
uniform float uFogFar;
uniform vec3 uFogColor;

uniform float uAlpha;
uniform float uPickingAlphaThreshold;
uniform bool uTransparentBackground;

uniform bool uDoubleSided;
bool interior;

uniform float uXrayEdgeFalloff;
uniform float uCelSteps;
uniform float uExposure;

uniform mat4 uProjection;

uniform int uRenderMask;
uniform bool uMarkingDepthTest;

uniform sampler2D tDepth;
uniform vec2 uDrawingBufferSize;

float getDepthPacked(const in vec2 coords) {
    return unpackRGBAToDepth(texture2D(tDepth, coords));
}

float getDepth(const in vec2 coords) {
    #ifdef depthTextureSupport
        return texture2D(tDepth, coords).r;
    #else
        return unpackRGBAToDepth(texture2D(tDepth, coords));
    #endif
}

float calcDepth(const in vec3 pos) {
    vec2 clipZW = pos.z * uProjection[2].zw + uProjection[3].zw;
    return 0.5 + 0.5 * clipZW.x / clipZW.y;
}

// "Bump Mapping Unparametrized Surfaces on the GPU" Morten S. Mikkelsen
// https://mmikk.github.io/papers3d/mm_sfgrad_bump.pdf
vec3 perturbNormal(in vec3 position, in vec3 normal, in float height, in float scale) {
    vec3 sigmaS = dFdx(position);
    vec3 sigmaT = dFdy(position);

    vec3 r1 = cross(sigmaT, normal);
    vec3 r2 = cross(normal, sigmaS);
    float det = dot(sigmaS, r1);
    if (det == 0.0) return normal;

    float bs = dFdx(height);
    float bt = dFdy(height);

    vec3 surfGrad = sign(det) * (bs * r1 + bt * r2);
    return normalize(abs(det) * normal - scale * surfGrad);
}

float hash(in float h) {
    return fract(sin(h) * 43758.5453123);
}

float noise(in vec3 x) {
    vec3 p = floor(x);
    vec3 f = fract(x);
    f = f * f * (3.0 - 2.0 * f);

    float n = p.x + p.y * 157.0 + 113.0 * p.z;
    return mix(
        mix(mix(hash(n + 0.0), hash(n + 1.0), f.x),
            mix(hash(n + 157.0), hash(n + 158.0), f.x), f.y),
        mix(mix(hash(n + 113.0), hash(n + 114.0), f.x),
            mix(hash(n + 270.0), hash(n + 271.0), f.x), f.y), f.z);
}

float fbm(in vec3 p) {
    float f = 0.0;
    f += 0.5 * noise(p);
    p *= 2.01;
    f += 0.25 * noise(p);
    p *= 2.02;
    f += 0.125 * noise(p);

    return f;
}

#ifdef dXrayShaded
    float calcXrayShadedAlpha(in float alpha, const in vec3 normal) {
        #if defined(dXrayShaded_on)
            alpha *= 1.0 - pow(abs(dot(normal, vec3(0.0, 0.0, 1.0))), uXrayEdgeFalloff);
        #elif defined(dXrayShaded_inverted)
            alpha *= pow(abs(dot(normal, vec3(0.0, 0.0, 1.0))), uXrayEdgeFalloff);
        #endif
        return clamp(alpha, 0.001, 0.999);
    }
#endif
`;var pge=`
uniform mat4 uProjection, uModel, uView;
uniform vec3 uCameraPosition;
uniform vec4 uCameraPlane;

uniform int uObjectId;
uniform int uVertexCount;
uniform int uInstanceCount;
uniform int uGroupCount;
uniform vec4 uInvariantBoundingSphere;
uniform vec4 uLod;

uniform bool uDoubleSided;
uniform int uPickType;

#if dClipObjectCount != 0
    uniform int uClipObjectType[dClipObjectCount];
    uniform bool uClipObjectInvert[dClipObjectCount];
    uniform vec3 uClipObjectPosition[dClipObjectCount];
    uniform vec4 uClipObjectRotation[dClipObjectCount];
    uniform vec3 uClipObjectScale[dClipObjectCount];
    uniform mat4 uClipObjectTransform[dClipObjectCount];

    #if defined(dClipping)
        uniform vec2 uClippingTexDim;
        uniform sampler2D tClipping;
        #if __VERSION__ == 100 || defined(dClippingType_instance) || !defined(dVaryingGroup)
            varying float vClipping;
        #else
            flat out float vClipping;
        #endif
    #endif
#endif

#if defined(dNeedsMarker)
    uniform float uMarker;
    uniform vec2 uMarkerTexDim;
    uniform sampler2D tMarker;
    #if __VERSION__ == 100 || defined(dMarkerType_instance) || !defined(dVaryingGroup)
        varying float vMarker;
    #else
        flat out float vMarker;
    #endif
#endif

varying vec3 vModelPosition;
varying vec3 vViewPosition;

uniform float uModelScale;

#if defined(noNonInstancedActiveAttribs)
    // int() is needed for some Safari versions
    // see https://bugs.webkit.org/show_bug.cgi?id=244152
    #define VertexID int(gl_VertexID)
#else
    attribute float aVertex;
    #define VertexID int(aVertex)
#endif

#if defined(enabledMultiDraw)
    #define DrawID gl_DrawID
#else
    #define DrawID uDrawId
#endif
`;var fge=`
// TODO find a better place for these convenience defines

#if defined(dRenderVariant_colorBlended) || defined(dRenderVariant_colorWboit) || defined(dRenderVariant_colorDpoit)
    #define dRenderVariant_color
#endif

#if defined(dColorType_instance) || defined(dColorType_group) || defined(dColorType_groupInstance) || defined(dColorType_vertex) || defined(dColorType_vertexInstance)
    #define dColorType_texture
#endif

#if defined(dColorType_volume) || defined(dColorType_volumeInstance)
    #define dColorType_grid
#endif

#if defined(dColorType_attribute) || defined(dColorType_texture) || defined(dColorType_grid)
    #define dColorType_varying
#endif

#if ((defined(dRenderVariant_color) || defined(dRenderVariant_tracing)) && defined(dColorMarker)) || defined(dRenderVariant_marking)
    #define dNeedsMarker
#endif

#if defined(dXrayShaded_on) || defined(dXrayShaded_inverted)
    #define dXrayShaded
#endif

#if defined(dRenderVariant_color) || defined(dRenderVariant_tracing) || ((defined(dRenderVariant_depth) || defined(dRenderVariant_pick)) && defined(dXrayShaded))
    #define dNeedsNormal
#endif

#define MaskAll 0
#define MaskOpaque 1
#define MaskTransparent 2

//

#define PI 3.14159265
#define RECIPROCAL_PI 0.31830988618
#define EPSILON 1e-6
#define ONE_MINUS_EPSILON 1.0 - EPSILON
#define TWO_PI 6.2831853
#define HALF_PI 1.570796325

#define PALETTE_SCALE 16777214.0 // (1 << 24) - 2

#define saturate(a) clamp(a, 0.0, 1.0)

#if __VERSION__ == 100
    #define round(x) floor((x) + 0.5)
#endif

float intDiv(const in float a, const in float b) { return float(int(a) / int(b)); }
vec2 ivec2Div(const in vec2 a, const in vec2 b) { return vec2(ivec2(a) / ivec2(b)); }
float intMod(const in float a, const in float b) { return a - b * float(int(a) / int(b)); }
int imod(const in int a, const in int b) { return a - b * (a / b); }

float pow2(const in float x) { return x * x; }

vec3 packIntToRGB(in float value) {
    value = clamp(round(value), 0.0, 16777216.0 - 1.0) + 1.0;
    vec3 c = vec3(0.0);
    c.b = mod(value, 256.0);
    value = floor(value / 256.0);
    c.g = mod(value, 256.0);
    value = floor(value / 256.0);
    c.r = mod(value, 256.0);
    return c / 255.0;
}
float unpackRGBToInt(const in vec3 rgb) {
    return (floor(rgb.r * 255.0 + 0.5) * 256.0 * 256.0 + floor(rgb.g * 255.0 + 0.5) * 256.0 + floor(rgb.b * 255.0 + 0.5)) - 1.0;
}

vec2 packUnitIntervalToRG(const in float v) {
    vec2 enc;
    enc.xy = vec2(fract(v * 256.0), v);
    enc.y -= enc.x * (1.0 / 256.0);
    enc.xy *=  256.0 / 255.0;

    return enc;
}

float unpackRGToUnitInterval(const in vec2 enc) {
    return dot(enc, vec2(255.0 / (256.0 * 256.0), 255.0 / 256.0));
}

float pack2x4(vec2 v) {
    vec2 clamped_v = clamp(v, 0.0, 1.0);
    vec2 scaled_v = floor(clamped_v * 15.0 + 0.5); // round to 0\u201315
    float c = scaled_v.x + scaled_v.y * 16.0;
    return c / 255.0;
}

vec2 unpack2x4(float f) {
    float c = floor(f * 255.0 + 0.5);
    float lo = mod(c, 16.0);
    float hi = floor(c / 16.0);
    return vec2(lo, hi) / 15.0;
}

vec3 screenSpaceToViewSpace(const in vec3 ssPos, const in mat4 invProjection) {
    vec4 p = vec4(ssPos * 2.0 - 1.0, 1.0);
    p = invProjection * p;
    return p.xyz / p.w;
}

const float PackUpscale = 256.0 / 255.0; // fraction -> 0..1 (including 1)
const float UnpackDownscale = 255.0 / 256.0; // 0..1 -> fraction (excluding 1)
const vec3 PackFactors = vec3(256.0 * 256.0 * 256.0, 256.0 * 256.0,  256.0);
const vec4 UnpackFactors = UnpackDownscale / vec4(PackFactors, 1.0);
const float ShiftRight8 = 1.0 / 256.0;

vec4 packDepthToRGBA(const in float v) {
    vec4 r = vec4(fract(v * PackFactors), v);
    r.yzw -= r.xyz * ShiftRight8; // tidy overflow
    return r * PackUpscale;
}
float unpackRGBAToDepth(const in vec4 v) {
    return dot(v, UnpackFactors);
}

vec4 packDepthWithAlphaToRGBA(const in float depth, const in float alpha){
    vec3 r = vec3(fract(depth * PackFactors.yz), depth);
    r.yz -= r.xy * ShiftRight8; // tidy overflow
    return vec4(r * PackUpscale, alpha);
}
vec2 unpackRGBAToDepthWithAlpha(const in vec4 v) {
    return vec2(dot(v.xyz, UnpackFactors.yzw), v.w);
}

vec4 sRGBToLinear(const in vec4 c) {
    return vec4(mix(pow(c.rgb * 0.9478672986 + vec3(0.0521327014), vec3(2.4)), c.rgb * 0.0773993808, vec3(lessThanEqual(c.rgb, vec3(0.04045)))), c.a);
}
vec4 linearTosRGB(const in vec4 c) {
    return vec4(mix(pow(c.rgb, vec3(0.41666)) * 1.055 - vec3(0.055), c.rgb * 12.92, vec3(lessThanEqual(c.rgb, vec3(0.0031308)))), c.a);
}

float luminance(vec3 c) {
    // https://www.w3.org/TR/WCAG21/#dfn-relative-luminance
    const vec3 W = vec3(0.2125, 0.7154, 0.0721);
    return dot(c, W);
}

float linearizeDepth(const in float depth, const in float near, const in float far) {
    return (2.0 * near) / (far + near - depth * (far - near));
}

float perspectiveDepthToViewZ(const in float invClipZ, const in float near, const in float far) {
    return (near * far) / ((far - near) * invClipZ - far);
}

float orthographicDepthToViewZ(const in float linearClipZ, const in float near, const in float far) {
    return linearClipZ * (near - far) - near;
}

float depthToViewZ(const in float isOrtho, const in float linearClipZ, const in float near, const in float far) {
    return isOrtho == 1.0 ? orthographicDepthToViewZ(linearClipZ, near, far) : perspectiveDepthToViewZ(linearClipZ, near, far);
}

// see https://github.com/graphitemaster/normals_revisited and https://www.shadertoy.com/view/3s33zj
mat3 adjoint(const in mat4 m) {
    return mat3(
        cross(m[1].xyz, m[2].xyz),
        cross(m[2].xyz, m[0].xyz),
        cross(m[0].xyz, m[1].xyz)
    );
}

#if __VERSION__ == 100
    // transpose

    float transpose(const in float m) {
        return m;
    }

    mat2 transpose2(const in mat2 m) {
        return mat2(
            m[0][0], m[1][0],
            m[0][1], m[1][1]
        );
    }

    mat3 transpose3(const in mat3 m) {
        return mat3(
            m[0][0], m[1][0], m[2][0],
            m[0][1], m[1][1], m[2][1],
            m[0][2], m[1][2], m[2][2]
        );
    }

    mat4 transpose4(const in mat4 m) {
        return mat4(
            m[0][0], m[1][0], m[2][0], m[3][0],
            m[0][1], m[1][1], m[2][1], m[3][1],
            m[0][2], m[1][2], m[2][2], m[3][2],
            m[0][3], m[1][3], m[2][3], m[3][3]
        );
    }

    // inverse

    float inverse(const in float m) {
        return 1.0 / m;
    }

    mat2 inverse2(const in mat2 m) {
        return mat2(m[1][1],-m[0][1],
                -m[1][0], m[0][0]) / (m[0][0]*m[1][1] - m[0][1]*m[1][0]);
    }

    mat3 inverse3(const in mat3 m) {
        float a00 = m[0][0], a01 = m[0][1], a02 = m[0][2];
        float a10 = m[1][0], a11 = m[1][1], a12 = m[1][2];
        float a20 = m[2][0], a21 = m[2][1], a22 = m[2][2];

        float b01 = a22 * a11 - a12 * a21;
        float b11 = -a22 * a10 + a12 * a20;
        float b21 = a21 * a10 - a11 * a20;

        float det = a00 * b01 + a01 * b11 + a02 * b21;

        return mat3(b01, (-a22 * a01 + a02 * a21), (a12 * a01 - a02 * a11),
                    b11, (a22 * a00 - a02 * a20), (-a12 * a00 + a02 * a10),
                    b21, (-a21 * a00 + a01 * a20), (a11 * a00 - a01 * a10)) / det;
    }

    mat4 inverse4(const in mat4 m) {
        float
            a00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3],
            a10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3],
            a20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3],
            a30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3],

            b00 = a00 * a11 - a01 * a10,
            b01 = a00 * a12 - a02 * a10,
            b02 = a00 * a13 - a03 * a10,
            b03 = a01 * a12 - a02 * a11,
            b04 = a01 * a13 - a03 * a11,
            b05 = a02 * a13 - a03 * a12,
            b06 = a20 * a31 - a21 * a30,
            b07 = a20 * a32 - a22 * a30,
            b08 = a20 * a33 - a23 * a30,
            b09 = a21 * a32 - a22 * a31,
            b10 = a21 * a33 - a23 * a31,
            b11 = a22 * a33 - a23 * a32,

            det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;

        return mat4(
            a11 * b11 - a12 * b10 + a13 * b09,
            a02 * b10 - a01 * b11 - a03 * b09,
            a31 * b05 - a32 * b04 + a33 * b03,
            a22 * b04 - a21 * b05 - a23 * b03,
            a12 * b08 - a10 * b11 - a13 * b07,
            a00 * b11 - a02 * b08 + a03 * b07,
            a32 * b02 - a30 * b05 - a33 * b01,
            a20 * b05 - a22 * b02 + a23 * b01,
            a10 * b10 - a11 * b08 + a13 * b06,
            a01 * b08 - a00 * b10 - a03 * b06,
            a30 * b04 - a31 * b02 + a33 * b00,
            a21 * b02 - a20 * b04 - a23 * b00,
            a11 * b07 - a10 * b09 - a12 * b06,
            a00 * b09 - a01 * b07 + a02 * b06,
            a31 * b01 - a30 * b03 - a32 * b00,
            a20 * b03 - a21 * b01 + a22 * b00) / det;
    }

    #define isNaN(x) ((x) != (x))
    #define isInf(x) ((x) == (x) + 1.0)
#else
    #define transpose2(m) transpose(m)
    #define transpose3(m) transpose(m)
    #define transpose4(m) transpose(m)

    #define inverse2(m) inverse(m)
    #define inverse3(m) inverse(m)
    #define inverse4(m) inverse(m)

    #define isNaN isnan
    #define isInf isinf
#endif
`;var hge=`
if (uLod.w == 0.0 && (uLod.x != 0.0 || uLod.y != 0.0)) {
    float d = (dot(uCameraPlane.xyz, vModelPosition) + uCameraPlane.w) / uModelScale;
    float ta = min(
        smoothstep(uLod.x, uLod.x + uLod.z, d),
        1.0 - smoothstep(uLod.y - uLod.z, uLod.y, d)
    );

    #if defined(dRenderVariant_color) || defined(dRenderVariant_tracing)
        float at = 0.0;

        // shift by view-offset during multi-sample rendering to allow for blending
        vec2 coord = gl_FragCoord.xy + uViewOffset * 0.25;

        const mat4 thresholdMatrix = mat4(
            1.0 / 17.0,  9.0 / 17.0,  3.0 / 17.0, 11.0 / 17.0,
            13.0 / 17.0,  5.0 / 17.0, 15.0 / 17.0,  7.0 / 17.0,
            4.0 / 17.0, 12.0 / 17.0,  2.0 / 17.0, 10.0 / 17.0,
            16.0 / 17.0,  8.0 / 17.0, 14.0 / 17.0,  6.0 / 17.0
        );
        int ci = int(intMod(coord.x, 4.0));
        int ri = int(intMod(coord.y, 4.0));
        #if __VERSION__ == 100
            vec4 i = vec4(float(ci * 4 + ri));
            vec4 v = thresholdMatrix[0] * vec4(equal(i, vec4(0.0, 1.0, 2.0, 3.0))) +
                thresholdMatrix[1] * vec4(equal(i, vec4(4.0, 5.0, 6.0, 7.0))) +
                thresholdMatrix[2] * vec4(equal(i, vec4(8.0, 9.0, 10.0, 11.0))) +
                thresholdMatrix[3] * vec4(equal(i, vec4(12.0, 13.0, 14.0, 15.0)));
            at = v.x + v.y + v.z + v.w;
        #else
            at = thresholdMatrix[ci][ri];
        #endif

        if (ta < 0.99 && (ta < 0.01 || ta < at)) {
            discard;
        }
    #else
        if (ta < uPickingAlphaThreshold) {
            discard;
        }
    #endif
}
`;var gge=`
    // floatToRgba adapted from https://github.com/equinor/glsl-float-to-rgba
    // MIT License, Copyright (c) 2020 Equinor

    float shiftRight (float v, float amt) {
    v = floor(v) + 0.5;
    return floor(v / exp2(amt));
    }
    float shiftLeft (float v, float amt) {
        return floor(v * exp2(amt) + 0.5);
    }
    float maskLast (float v, float bits) {
        return mod(v, shiftLeft(1.0, bits));
    }
    float extractBits (float num, float from, float to) {
        from = floor(from + 0.5); to = floor(to + 0.5);
        return maskLast(shiftRight(num, from), to - from);
    }

    vec4 floatToRgba(float texelFloat, bool littleEndian) {
        if (texelFloat == 0.0) return vec4(0.0, 0.0, 0.0, 0.0);
        float sign = texelFloat > 0.0 ? 0.0 : 1.0;
        texelFloat = abs(texelFloat);
        float exponent = floor(log2(texelFloat));
        float biased_exponent = exponent + 127.0;
        float fraction = ((texelFloat / exp2(exponent)) - 1.0) * 8388608.0;
        float t = biased_exponent / 2.0;
        float last_bit_of_biased_exponent = fract(t) * 2.0;
        float remaining_bits_of_biased_exponent = floor(t);
        float byte4 = extractBits(fraction, 0.0, 8.0) / 255.0;
        float byte3 = extractBits(fraction, 8.0, 16.0) / 255.0;
        float byte2 = (last_bit_of_biased_exponent * 128.0 + extractBits(fraction, 16.0, 23.0)) / 255.0;
        float byte1 = (sign * 128.0 + remaining_bits_of_biased_exponent) / 255.0;
        return (
            littleEndian
                ? vec4(byte4, byte3, byte2, byte1)
                : vec4(byte1, byte2, byte3, byte4)
        );
    }
`;var yge=`
#if dLightCount != 0
    uniform vec3 uLightDirection[dLightCount];
    uniform vec3 uLightColor[dLightCount];
#endif
uniform vec3 uAmbientColor;

struct PhysicalMaterial {
    vec3 diffuseColor;
    float roughness;
    vec3 specularColor;
    float specularF90;
};

struct IncidentLight {
    vec3 color;
    vec3 direction;
};

struct ReflectedLight {
    vec3 directDiffuse;
    vec3 directSpecular;
    vec3 indirectDiffuse;
    vec3 indirectSpecular;
};

struct GeometricContext {
    vec3 position;
    vec3 normal;
    vec3 viewDir;
};

vec3 BRDF_Lambert(const in vec3 diffuseColor) {
    return RECIPROCAL_PI * diffuseColor;
}

vec3 F_Schlick(const in vec3 f0, const in float f90, const in float dotVH) {
    // Original approximation by Christophe Schlick '94
    // float fresnel = pow( 1.0 - dotVH, 5.0 );
    // Optimized variant (presented by Epic at SIGGRAPH '13)
    // https://cdn2.unrealengine.com/Resources/files/2013SiggraphPresentationsNotes-26915738.pdf
    float fresnel = exp2((-5.55473 * dotVH - 6.98316) * dotVH);
    return f0 * (1.0 - fresnel) + (f90 * fresnel);
}

// Moving Frostbite to Physically Based Rendering 3.0 - page 12, listing 2
// https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf
float V_GGX_SmithCorrelated(const in float alpha, const in float dotNL, const in float dotNV) {
    float a2 = pow2(alpha);
    float gv = dotNL * sqrt(a2 + (1.0 - a2) * pow2(dotNV));
    float gl = dotNV * sqrt(a2 + (1.0 - a2) * pow2(dotNL));
    return 0.5 / max(gv + gl, EPSILON);
}

// Microfacet Models for Refraction through Rough Surfaces - equation (33)
// http://graphicrants.blogspot.com/2013/08/specular-brdf-reference.html
// alpha is "roughness squared" in Disney\u2019s reparameterization
float D_GGX(const in float alpha, const in float dotNH) {
    float a2 = pow2(alpha);
    float denom = pow2(dotNH) * (a2 - 1.0) + 1.0; // avoid alpha = 0 with dotNH = 1
    return RECIPROCAL_PI * a2 / pow2(denom);
}

// GGX Distribution, Schlick Fresnel, GGX_SmithCorrelated Visibility
vec3 BRDF_GGX(const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness) {
    float alpha = pow2(roughness); // UE4's roughness
    vec3 halfDir = normalize( lightDir + viewDir);
    float dotNL = saturate(dot(normal, lightDir));
    float dotNV = saturate(dot(normal, viewDir));
    float dotNH = saturate(dot(normal, halfDir));
    float dotVH = saturate(dot(viewDir, halfDir));
    vec3 F = F_Schlick(f0, f90, dotVH);
    float V = V_GGX_SmithCorrelated(alpha, dotNL, dotNV);
    float D = D_GGX(alpha, dotNH);
    return F * (V * D);
}

// Analytical approximation of the DFG LUT, one half of the
// split-sum approximation used in indirect specular lighting.
// via 'environmentBRDF' from "Physically Based Shading on Mobile"
// https://www.unrealengine.com/blog/physically-based-shading-on-mobile
vec2 DFGApprox(const in vec3 normal, const in vec3 viewDir, const in float roughness) {
    float dotNV = saturate(dot(normal, viewDir));
    const vec4 c0 = vec4(-1, -0.0275, -0.572, 0.022);
    const vec4 c1 = vec4(1, 0.0425, 1.04, -0.04);
    vec4 r = roughness * c0 + c1;
    float a004 = min(r.x * r.x, exp2(-9.28 * dotNV)) * r.x + r.y;
    vec2 fab = vec2(-1.04, 1.04) * a004 + r.zw;
    return fab;
}

// Fdez-Ag\xFCera's "Multiple-Scattering Microfacet Model for Real-Time Image Based Lighting"
// Approximates multiscattering in order to preserve energy.
// http://www.jcgt.org/published/0008/01/03/
void computeMultiscattering(const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter) {
    vec2 fab = DFGApprox(normal, viewDir, roughness);
    vec3 FssEss = specularColor * fab.x + specularF90 * fab.y;
    float Ess = fab.x + fab.y;
    float Ems = 1.0 - Ess;
    vec3 Favg = specularColor + (1.0 - specularColor) * 0.047619; // 1/21
    vec3 Fms = FssEss * Favg / (1.0 - Ems * Favg);
    singleScatter += FssEss;
    multiScatter += Fms * Ems;
}

void RE_Direct_Physical(const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
    float dotNL = saturate(dot(geometry.normal, directLight.direction));
    vec3 irradiance = dotNL * directLight.color;
    reflectedLight.directSpecular += irradiance * BRDF_GGX(directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness);
    reflectedLight.directDiffuse += irradiance * BRDF_Lambert(material.diffuseColor);
}

void RE_IndirectDiffuse_Physical(const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
    reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert(material.diffuseColor);
}

void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
    // Both indirect specular and indirect diffuse light accumulate here
    vec3 singleScattering = vec3(0.0);
    vec3 multiScattering = vec3(0.0);
    vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
    computeMultiscattering(geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering);
    vec3 diffuse = material.diffuseColor * (1.0 - ( singleScattering + multiScattering));
    reflectedLight.indirectSpecular += radiance * singleScattering;
    reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
    reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
`;var bge=`
varying vec3 vNormal;
`;var xge=`
vec4 readFromTexture(const in sampler2D tex, const in float i, const in vec2 dim) {
    float x = intMod(i, dim.x);
    float y = floor(intDiv(i, dim.x));
    vec2 uv = (vec2(x, y) + 0.5) / dim;
    return texture2D(tex, uv);
}

vec4 readFromTexture(const in sampler2D tex, const in int i, const in vec2 dim) {
    int x = imod(i, int(dim.x));
    int y = i / int(dim.x);
    vec2 uv = (vec2(x, y) + 0.5) / dim;
    return texture2D(tex, uv);
}
`;var Cge=`
    // rgbaToFloat adapted from https://github.com/ihmeuw/glsl-rgba-to-float
    // BSD 3-Clause License
    //
    // Copyright (c) 2019, Institute for Health Metrics and Evaluation All rights reserved.
    // Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:
    //  - Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.
    //  - Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.
    //  - Neither the name of the copyright holder nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.
    //
    // THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES,
    // INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
    // IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY,
    // OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA,
    // OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
    // OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED
    // OF THE POSSIBILITY OF SUCH DAMAGE.

    ivec4 floatsToBytes(vec4 inputFloats, bool littleEndian) {
        ivec4 bytes = ivec4(inputFloats * 255.0);
        return (
            littleEndian
                ? bytes.abgr
                : bytes
        );
    }

    // Break the four bytes down into an array of 32 bits.
    void bytesToBits(const in ivec4 bytes, out bool bits[32]) {
        for (int channelIndex = 0; channelIndex < 4; ++channelIndex) {
            float acc = float(bytes[channelIndex]);
            for (int indexInByte = 7; indexInByte >= 0; --indexInByte) {
                float powerOfTwo = exp2(float(indexInByte));
                bool bit = acc >= powerOfTwo;
                bits[channelIndex * 8 + (7 - indexInByte)] = bit;
                acc = mod(acc, powerOfTwo);
            }
        }
    }

    // Compute the exponent of the 32-bit float.
    float getExponent(bool bits[32]) {
        const int startIndex = 1;
        const int bitStringLength = 8;
        const int endBeforeIndex = startIndex + bitStringLength;
        float acc = 0.0;
        int pow2 = bitStringLength - 1;
        for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {
            acc += float(bits[bitIndex]) * exp2(float(pow2--));
        }
        return acc;
    }

    // Compute the mantissa of the 32-bit float.
    float getMantissa(bool bits[32], bool subnormal) {
        const int startIndex = 9;
        const int bitStringLength = 23;
        const int endBeforeIndex = startIndex + bitStringLength;
        // Leading/implicit/hidden bit convention:
        // If the number is not subnormal (with exponent 0), we add a leading 1 digit.
        float acc = float(!subnormal) * exp2(float(bitStringLength));
        int pow2 = bitStringLength - 1;
        for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {
            acc += float(bits[bitIndex]) * exp2(float(pow2--));
        }
        return acc;
    }

    // Parse the float from its 32 bits.
    float bitsToFloat(bool bits[32]) {
        float signBit = float(bits[0]) * -2.0 + 1.0;
        float exponent = getExponent(bits);
        bool subnormal = abs(exponent - 0.0) < 0.01;
        float mantissa = getMantissa(bits, subnormal);
        float exponentBias = 127.0;
        return signBit * mantissa * exp2(exponent - exponentBias - 23.0);
    }

    float rgbaToFloat(vec4 texelRGBA, bool littleEndian) {
        ivec4 rgbaBytes = floatsToBytes(texelRGBA, littleEndian);
        bool bits[32];
        bytesToBits(rgbaBytes, bits);
        return bitsToFloat(bits);
    }
`;var Sge=`
#if defined(dSizeType_uniform)
    uniform float uSize;
#elif defined(dSizeType_attribute)
    attribute float aSize;
#elif defined(dSizeType_instance) || defined(dSizeType_group) || defined(dSizeType_groupInstance)
    uniform vec2 uSizeTexDim;
    uniform sampler2D tSize;
#endif

uniform float uSizeFactor;
`;var vge=`
vec4 texture3dFrom1dTrilinear(const in sampler2D tex, const in vec3 pos, const in vec3 gridDim, const in vec2 texDim, const in float offset) {
    float gdYZ = gridDim.z * gridDim.y;
    float gdZ = gridDim.z;
    vec3 p0 = floor(pos * gridDim);
    vec3 p1 = ceil(pos * gridDim);
    vec3 pd = (pos * gridDim - p0) / (p1 - p0);
    vec4 s000 = readFromTexture(tex, offset + p0.z + p0.y * gdZ + p0.x * gdYZ, texDim);
    vec4 s100 = readFromTexture(tex, offset + p0.z + p0.y * gdZ + p1.x * gdYZ, texDim);
    vec4 s001 = readFromTexture(tex, offset + p1.z + p0.y * gdZ + p0.x * gdYZ, texDim);
    vec4 s101 = readFromTexture(tex, offset + p1.z + p0.y * gdZ + p1.x * gdYZ, texDim);
    vec4 s010 = readFromTexture(tex, offset + p0.z + p1.y * gdZ + p0.x * gdYZ, texDim);
    vec4 s110 = readFromTexture(tex, offset + p0.z + p1.y * gdZ + p1.x * gdYZ, texDim);
    vec4 s011 = readFromTexture(tex, offset + p1.z + p1.y * gdZ + p0.x * gdYZ, texDim);
    vec4 s111 = readFromTexture(tex, offset + p1.z + p1.y * gdZ + p1.x * gdYZ, texDim);
    vec4 s00 = mix(s000, s100, pd.x);
    vec4 s01 = mix(s001, s101, pd.x);
    vec4 s10 = mix(s010, s110, pd.x);
    vec4 s11 = mix(s011, s111, pd.x);
    vec4 s0 = mix(s00, s10, pd.y);
    vec4 s1 = mix(s01, s11, pd.y);
    return mix(s0, s1, pd.z);
}
`;var Ige=`
vec4 texture3dFrom2dLinear(sampler2D tex, vec3 pos, vec3 gridDim, vec2 texDim) {
    float zSlice0 = floor(pos.z * gridDim.z);
    float column0 = intMod(zSlice0 * gridDim.x, texDim.x) / gridDim.x;
    float row0 = floor(intDiv(zSlice0 * gridDim.x, texDim.x));
    vec2 coord0 = (vec2(column0 * gridDim.x, row0 * gridDim.y) + (pos.xy * gridDim.xy)) / texDim;
    vec4 color0 = texture2D(tex, coord0);

    float zSlice1 = zSlice0 + 1.0;
    float column1 = intMod(zSlice1 * gridDim.x, texDim.x) / gridDim.x;
    float row1 = floor(intDiv(zSlice1 * gridDim.x, texDim.x));
    vec2 coord1 = (vec2(column1 * gridDim.x, row1 * gridDim.y) + (pos.xy * gridDim.xy)) / texDim;
    vec4 color1 = texture2D(tex, coord1);

    float delta0 = abs((pos.z * gridDim.z) - zSlice0);
    return mix(color0, color1, delta0);
}
`;var Age=`
vec4 texture3dFrom2dNearest(sampler2D tex, vec3 pos, vec3 gridDim, vec2 texDim) {
    float zSlice = floor(pos.z * gridDim.z + 0.5); // round to nearest z-slice
    float column = intMod(zSlice * gridDim.x, texDim.x) / gridDim.x;
    float row = floor(intDiv(zSlice * gridDim.x, texDim.x));
    vec2 coord = (vec2(column * gridDim.x, row * gridDim.y) + (pos.xy * gridDim.xy)) / texDim;
    return texture2D(tex, coord);
}
`;var Tge=`
#if defined(dRenderVariant_colorWboit)
    if (uRenderMask == MaskOpaque) {
        if (preFogAlpha < 1.0) {
            discard;
        }
    } else if (uRenderMask == MaskTransparent) {
        if (preFogAlpha != 1.0 && fragmentDepth < getDepth(gl_FragCoord.xy / uDrawingBufferSize)) {
            #ifdef dTransparentBackfaces_off
                if (interior) discard;
            #endif
            float alpha = gl_FragColor.a;
            float wboitWeight = alpha * clamp(pow(1.0 - fragmentDepth, 2.0), 0.01, 1.0);
            gl_FragColor = vec4(gl_FragColor.rgb * alpha * wboitWeight, alpha);
            // extra alpha is to handle pre-multiplied alpha
            #ifndef dGeometryType_directVolume
                gl_FragData[1] = vec4((uTransparentBackground ? alpha : 1.0) * alpha * wboitWeight);
            #else
                gl_FragData[1] = vec4(alpha * alpha * wboitWeight);
            #endif
        } else {
            discard;
        }
    }
#endif
`;var Pge=`
#if defined(dRenderVariant_colorDpoit)
    if (uRenderMask == MaskOpaque) {
        if (preFogAlpha < 1.0) {
            discard;
        }
    } else if (uRenderMask == MaskTransparent) {
        vec2 coords = gl_FragCoord.xy / uDrawingBufferSize;
        if (preFogAlpha != 1.0 && fragmentDepth < getDepth(coords)) {
            #ifdef dTransparentBackfaces_off
                if (interior) discard;
            #endif

            // adapted from https://github.com/tsherif/webgl2examples
            // The MIT License, Copyright 2017 Tarek Sherif, Shuai Shao

            vec2 lastDepth = texture2D(tDpoitDepth, coords).rg;
            vec4 lastFrontColor = texture2D(tDpoitFrontColor, coords);

            vec4 fragColor = gl_FragColor;

            // depth value always increases
            // so we can use MAX blend equation
            gl_FragData[2].rg = vec2(-MAX_DPOIT_DEPTH);

            // front color always increases
            // so we can use MAX blend equation
            gl_FragColor = lastFrontColor;

            // back color is separately blend afterwards each pass
            gl_FragData[1] = vec4(0.0);

            float nearestDepth = -lastDepth.x;
            float furthestDepth = lastDepth.y;
            float alphaMultiplier = 1.0 - lastFrontColor.a;

            if (fragmentDepth < nearestDepth || fragmentDepth > furthestDepth) {
                // Skip this depth since it's been peeled.
                return;
            }

            if (fragmentDepth > nearestDepth && fragmentDepth < furthestDepth) {
                // This needs to be peeled.
                // The ones remaining after MAX blended for
                // all need-to-peel will be peeled next pass.
                gl_FragData[2].rg = vec2(-fragmentDepth, fragmentDepth);
                return;
            }

            // write to back and front color buffer
            if (fragmentDepth == nearestDepth) {
                gl_FragColor.rgb += fragColor.rgb * fragColor.a * alphaMultiplier;
                gl_FragColor.a = 1.0 - alphaMultiplier * (1.0 - fragColor.a);
            } else {
                gl_FragData[1] += fragColor;
            }

        } else {
            discard;
        }
    }
#endif
`;var _ge=`
precision highp float;
precision highp int;

#include common
#include read_from_texture
#include common_vert_params
#include color_vert_params
#include size_vert_params
#include common_clip

uniform float uPixelRatio;
uniform vec4 uViewport;

attribute vec3 aPosition;
attribute mat4 aTransform;
attribute float aInstance;
attribute float aGroup;

void main(){
    int vertexId = VertexID;

    #include assign_group
    #include assign_color_varying
    #include assign_marker_varying
    #include assign_clipping_varying
    #include assign_position
    #include assign_size

    #ifdef dPointSizeAttenuation
        gl_PointSize = size * uPixelRatio * ((uViewport.w / 2.0) / -mvPosition.z) * 5.0;
    #else
        gl_PointSize = size * uPixelRatio;
    #endif
    gl_PointSize = max(1.0, gl_PointSize);

    gl_Position = uProjection * mvPosition;

    #include clip_instance
}
`;var Rge=`
precision highp float;
precision highp int;

#include common
#include common_frag_params
#include color_frag_params
#include common_clip

const vec2 center = vec2(0.5);
const float radius = 0.5;

void main(){
    #include fade_lod
    #include clip_pixel

    float fragmentDepth = gl_FragCoord.z;
    #include assign_material_color

    #if defined(dPointStyle_circle)
        float dist = distance(gl_PointCoord, center);
        if (dist > radius) discard;
    #elif defined(dPointStyle_fuzzy)
        float dist = distance(gl_PointCoord, center);
        float fuzzyAlpha = 1.0 - smoothstep(0.0, radius, dist);
        if (fuzzyAlpha < 0.0001) discard;
    #endif

    #if defined(dPointStyle_fuzzy) && (defined(dRenderVariant_color) || defined(dRenderVariant_tracing))
        material.a *= fuzzyAlpha;
    #endif

    #include check_transparency

    #if defined(dRenderVariant_pick)
        #include check_picking_alpha
        #ifdef requiredDrawBuffers
            gl_FragColor = vObject;
            gl_FragData[1] = vInstance;
            gl_FragData[2] = vGroup;
            gl_FragData[3] = packDepthToRGBA(fragmentDepth);
        #else
            gl_FragColor = vColor;
        #endif
    #elif defined(dRenderVariant_depth)
        gl_FragColor = material;
    #elif defined(dRenderVariant_marking)
        gl_FragColor = material;
    #elif defined(dRenderVariant_emissive)
        gl_FragColor = material;
    #elif defined(dRenderVariant_color) || defined(dRenderVariant_tracing)
        gl_FragColor = material;
        #include apply_marker_color

        #if defined(dRenderVariant_color)
            #include apply_fog
            #include wboit_write
            #include dpoit_write
        #elif defined(dRenderVariant_tracing)
            gl_FragData[1] = vec4(normalize(vViewPosition), emissive);
            gl_FragData[2] = vec4(material.rgb, uDensity);
        #endif
    #endif
}
`;var Dge=`
precision highp float;
precision highp int;

#include common
#include read_from_texture
#include common_vert_params
#include color_vert_params
#include size_vert_params
#include common_clip

uniform mat4 uModelView;
uniform mat4 uInvProjection;
uniform float uIsOrtho;
uniform bool uIsAsymmetricProjection;

uniform vec2 uTexDim;
uniform sampler2D tPositionGroup;

attribute mat4 aTransform;
attribute float aInstance;

varying float vRadius;
varying vec3 vPoint;
varying vec3 vPointViewPosition;

/**
 * Bounding rectangle of a clipped, perspective-projected 3D Sphere.
 * Michael Mara, Morgan McGuire. 2013
 *
 * Specialization by Arseny Kapoulkine, MIT License Copyright (c) 2018
 * https://github.com/zeux/niagara
 *
 * Only works for for symmetric projections.
 */
void sphereProjection(const in vec3 p, const in float r, const in vec2 mapping) {
    vec3 pr = p * r;
    float pzr2 = p.z * p.z - r * r;

    float vx = sqrt(p.x * p.x + pzr2);
    float minx = ((vx * p.x - pr.z) / (vx * p.z + pr.x)) * uProjection[0][0];
    float maxx = ((vx * p.x + pr.z) / (vx * p.z - pr.x)) * uProjection[0][0];

    float vy = sqrt(p.y * p.y + pzr2);
    float miny = ((vy * p.y - pr.z) / (vy * p.z + pr.y)) * uProjection[1][1];
    float maxy = ((vy * p.y + pr.z) / (vy * p.z - pr.y)) * uProjection[1][1];

    gl_Position.xy = vec2(maxx + minx, maxy + miny) * -0.5;
    gl_Position.xy -= mapping * vec2(maxx - minx, maxy - miny) * 0.5;
    gl_Position.xy *= gl_Position.w;
}

const mat4 D = mat4(
    1.0, 0.0, 0.0, 0.0,
    0.0, 1.0, 0.0, 0.0,
    0.0, 0.0, 1.0, 0.0,
    0.0, 0.0, 0.0, -1.0
);

/**
 * Compute point size and center using the technique described in:
 * "GPU-Based Ray-Casting of Quadratic Surfaces" http://dl.acm.org/citation.cfm?id=2386396
 * by Christian Sigg, Tim Weyrich, Mario Botsch, Markus Gross.
 */
void quadraticProjection(const in vec3 position, const in float radius, const in vec2 mapping) {
    vec2 xbc, ybc;

    mat4 T = mat4(
        radius, 0.0, 0.0, 0.0,
        0.0, radius, 0.0, 0.0,
        0.0, 0.0, radius, 0.0,
        position.x, position.y, position.z, 1.0
    );

    mat4 R = transpose4(uProjection * uModelView * aTransform * T);
    float A = dot(R[3], D * R[3]);
    float B = -2.0 * dot(R[0], D * R[3]);
    float C = dot(R[0], D * R[0]);
    xbc[0] = (-B - sqrt(B * B - 4.0 * A * C)) / (2.0 * A);
    xbc[1] = (-B + sqrt(B * B - 4.0 * A * C)) / (2.0 * A);
    float sx = abs(xbc[0] - xbc[1]) * 0.5;

    A = dot(R[3], D * R[3]);
    B = -2.0 * dot(R[1], D * R[3]);
    C = dot(R[1], D * R[1]);
    ybc[0] = (-B - sqrt(B * B - 4.0 * A * C)) / (2.0 * A);
    ybc[1] = (-B + sqrt(B * B - 4.0 * A * C)) / (2.0 * A);
    float sy = abs(ybc[0] - ybc[1]) * 0.5;

    gl_Position.xy = vec2(0.5 * (xbc.x + xbc.y), 0.5 * (ybc.x + ybc.y));
    gl_Position.xy -= mapping * vec2(sx, sy);
    gl_Position.xy *= gl_Position.w;
}

void main(void){
    vec2 mapping = vec2(1.0, 1.0); // vertices 2 and 5
    #if __VERSION__ == 100
        int m = imod(VertexID, 6);
    #else
        int m = VertexID % 6;
    #endif
    if (m == 0) {
        mapping = vec2(-1.0, 1.0);
    } else if (m == 1 || m == 3) {
        mapping = vec2(-1.0, -1.0);
    } else if (m == 4) {
        mapping = vec2(1.0, -1.0);
    }

    int vertexId = VertexID / 6;

    vec4 positionGroup = readFromTexture(tPositionGroup, vertexId, uTexDim);
    vec3 position = positionGroup.rgb;
    float group = positionGroup.a;

    #include assign_color_varying
    #include assign_marker_varying
    #include assign_clipping_varying
    #include assign_size

    vRadius = size * uModelScale;

    vec4 position4 = vec4(position, 1.0);
    vModelPosition = (uModel * aTransform * position4).xyz; // for clipping in frag shader

    float d;
    if (uLod.w != 0.0 && (uLod.x != 0.0 || uLod.y != 0.0)) {
        if (uModelScale != 1.0) {
            vRadius *= uLod.w;
        } else {
            d = (dot(uCameraPlane.xyz, vModelPosition) + uCameraPlane.w) / uModelScale;
            float f = min(
                smoothstep(uLod.x, uLod.x + uLod.z, d),
                1.0 - smoothstep(uLod.y - uLod.z, uLod.y, d)
            ) * uLod.w;
            vRadius *= f;
        }
    }

    vec4 mvPosition = uModelView * aTransform * position4;

    #ifdef dApproximate
        vec4 mvCorner = vec4(mvPosition.xyz, 1.0);
        mvCorner.xy += mapping * vRadius;
        gl_Position = uProjection * mvCorner;
    #else
        if (uIsOrtho == 1.0) {
            vec4 mvCorner = vec4(mvPosition.xyz, 1.0);
            mvCorner.xy += mapping * vRadius;
            gl_Position = uProjection * mvCorner;
        } else if (uIsAsymmetricProjection) {
            gl_Position = uProjection * vec4(mvPosition.xyz, 1.0);
            quadraticProjection(position, vRadius / uModelScale, mapping);
        } else {
            gl_Position = uProjection * vec4(mvPosition.xyz, 1.0);
            sphereProjection(mvPosition.xyz, vRadius, mapping);
        }
    #endif

    vec4 vPoint4 = uInvProjection * gl_Position;
    vPoint = vPoint4.xyz / vPoint4.w;
    vPointViewPosition = -mvPosition.xyz / mvPosition.w;

    if (gl_Position.z < -gl_Position.w) {
        mvPosition.z -= 2.0 * vRadius; // avoid clipping
        gl_Position.z = (uProjection * vec4(mvPosition.xyz, 1.0)).z;
    }

    if (uModelScale == 1.0) {
        if (uLod.w != 0.0 && (uLod.x != 0.0 || uLod.y != 0.0)) {
            if (d < uLod.x || d > uLod.y) {
                // move out of [ -w, +w ] to 'discard' in vert shader
                gl_Position.z = 2.0 * gl_Position.w;
            }
        }
    }

    #if defined(dClipPrimitive) && !defined(dClipVariant_instance) && dClipObjectCount != 0
        if (clipTest(vModelPosition / uModelScale)) {
            // move out of [ -w, +w ] to 'discard' in vert shader
            gl_Position.z = 2.0 * gl_Position.w;
        }
    #else
        #include clip_instance
    #endif
}
`;var wge=`
precision highp float;
precision highp int;

#define bumpEnabled

#include common
#include common_frag_params
#include color_frag_params
#include light_frag_params
#include common_clip

uniform mat4 uInvView;
uniform float uAlphaThickness;

uniform vec4 uInteriorColor;
uniform vec4 uInteriorSubstance;

varying float vRadius;
varying vec3 vPoint;
varying vec3 vPointViewPosition;

#ifdef dSolidInterior
    const bool solidInterior = true;
#else
    const bool solidInterior = false;
#endif

bool SphereImpostor(out vec3 modelPos, out vec3 cameraPos, out vec3 cameraNormal, out bool interior, out float fragmentDepth){
    vec3 cameraSpherePos = -vPointViewPosition;

    vec3 rayOrigin = mix(vec3(0.0, 0.0, 0.0), vPoint, uIsOrtho);
    vec3 rayDirection = mix(normalize(vPoint), vec3(0.0, 0.0, 1.0), uIsOrtho);
    vec3 cameraSphereDir = mix(cameraSpherePos, rayOrigin - cameraSpherePos, uIsOrtho);

    float B = dot(rayDirection, cameraSphereDir);
    float det = B * B + vRadius * vRadius - dot(cameraSphereDir, cameraSphereDir);

    if (det < 0.0) return false;

    float sqrtDet = sqrt(det);
    float posT = mix(B + sqrtDet, B - sqrtDet, uIsOrtho);
    float negT = mix(B - sqrtDet, B + sqrtDet, uIsOrtho);

    cameraPos = rayDirection * negT + rayOrigin;
    modelPos = (uInvView * vec4(cameraPos, 1.0)).xyz;
    fragmentDepth = calcDepth(cameraPos);

    bool objectClipped = false;

    #if !defined(dClipPrimitive) && defined(dClipVariant_pixel) && dClipObjectCount != 0
        if (clipTest(modelPos)) {
            objectClipped = true;
            fragmentDepth = -1.0;
        }
    #endif

    if (fragmentDepth > 0.0) {
        cameraNormal = normalize(cameraPos - cameraSpherePos);
        interior = false;
        return true;
    } else if (uDoubleSided || solidInterior) {
        cameraPos = rayDirection * posT + rayOrigin;
        modelPos = (uInvView * vec4(cameraPos, 1.0)).xyz;
        fragmentDepth = calcDepth(cameraPos);
        cameraNormal = -normalize(cameraPos - cameraSpherePos);
        interior = true;
        if (fragmentDepth > 0.0) {
            #ifdef dSolidInterior
                if (!objectClipped) {
                    fragmentDepth = 0.0 + (0.0000001 / vRadius);
                    cameraNormal = -mix(normalize(vPoint), vec3(0.0, 0.0, -1.0), uIsOrtho);

                    // intersection of ray with near plane
                    float nearT = - (uNear + dot(rayOrigin, vec3(0.0, 0.0, 1.0))) / dot(rayDirection, vec3(0.0, 0.0, 1.0));
                    cameraPos = rayDirection * nearT + rayOrigin;
                    modelPos = (uInvView * vec4(cameraPos, 1.0)).xyz;
                }
            #endif
            return true;
        }
    }

    return false;
}

void main(void){
    vec3 cameraNormal;
    float fragmentDepth;

    #ifdef dApproximate
        vec3 pointDir = -vPointViewPosition - vPoint;
        if (dot(pointDir, pointDir) > vRadius * vRadius) discard;
        vec3 vViewPosition = -vPointViewPosition;
        fragmentDepth = gl_FragCoord.z;
        #if !defined(dIgnoreLight) || defined(dXrayShaded) || defined(dRenderVariant_tracing)
            pointDir.z -= cos(length(pointDir)) * vRadius * 0.5;
            cameraNormal = -normalize(pointDir);
        #endif
        interior = false;
    #else
        vec3 modelPos;
        vec3 cameraPos;
        bool hit = SphereImpostor(modelPos, cameraPos, cameraNormal, interior, fragmentDepth);
        if (!hit) discard;

        if (fragmentDepth < 0.0) discard;
        if (fragmentDepth > 1.0) discard;

        gl_FragDepthEXT = fragmentDepth;

        vec3 vModelPosition = modelPos;
        vec3 vViewPosition = cameraPos;
    #endif

    #include fade_lod
    #if !defined(dClipPrimitive) && defined(dClipVariant_pixel) && dClipObjectCount != 0
        #include clip_pixel
    #endif

    #ifdef dNeedsNormal
        vec3 normal = -cameraNormal;
    #endif

    #include assign_material_color

    #if defined(dRenderVariant_color) || defined(dRenderVariant_tracing)
        if (uRenderMask == MaskTransparent && uAlphaThickness > 0.0) {
            material.a *= min(1.0, vRadius / (uAlphaThickness * uModelScale));
        }
    #endif

    #include check_transparency

    #if defined(dRenderVariant_pick)
        #include check_picking_alpha
        #ifdef requiredDrawBuffers
            gl_FragColor = vObject;
            gl_FragData[1] = vInstance;
            gl_FragData[2] = vGroup;
            gl_FragData[3] = packDepthToRGBA(fragmentDepth);
        #else
            gl_FragColor = vColor;
        #endif
    #elif defined(dRenderVariant_depth)
        gl_FragColor = material;
    #elif defined(dRenderVariant_marking)
        gl_FragColor = material;
    #elif defined(dRenderVariant_emissive)
        gl_FragColor = material;
    #elif defined(dRenderVariant_color) || defined(dRenderVariant_tracing)
        #include apply_interior_color
        #include apply_light_color
        #include apply_marker_color

        #if defined(dRenderVariant_color)
            #include apply_fog
            #include wboit_write
            #include dpoit_write
        #elif defined(dRenderVariant_tracing)
            gl_FragData[1] = vec4(normal, emissive);
            gl_FragData[2] = vec4(material.rgb, uDensity);
        #endif
    #endif
}
`;var Mge=`
precision highp float;
precision highp int;

#include common
#include read_from_texture
#include common_vert_params
#include color_vert_params
#include size_vert_params
#include common_clip

uniform mat4 uModelView;

attribute mat4 aTransform;
attribute float aInstance;
attribute float aGroup;

attribute vec3 aMapping;
attribute vec3 aStart;
attribute vec3 aEnd;
attribute float aScale;
attribute float aCap;
attribute float aColorMode;

varying mat4 vTransform;
varying vec3 vStart;
varying vec3 vEnd;
varying float vSize;
varying float vCap;

uniform float uIsOrtho;
uniform vec3 uCameraDir;

void main() {
    int vertexId = VertexID;

    #include assign_group
    #include assign_color_varying
    #include assign_marker_varying
    #include assign_clipping_varying
    #include assign_size

    mat4 modelTransform = uModel * aTransform;

    vTransform = modelTransform;
    vStart = (modelTransform * vec4(aStart, 1.0)).xyz;
    vEnd = (modelTransform * vec4(aEnd, 1.0)).xyz;
    vSize = size * aScale * uModelScale;
    vCap = aCap;

    vModelPosition = (vStart + vEnd) * 0.5;
    vec3 camDir = -mix(normalize(vModelPosition - uCameraPosition), uCameraDir, uIsOrtho);
    vec3 dir = vEnd - vStart;
    float f = aMapping.x > 0.0 ? 1.0 : 0.0;
    // ensure cylinder 'dir' is pointing towards the camera
    if(dot(camDir, dir) < 0.0) {
        dir = -dir;
        f = 1.0 - f;
    }

    vec3 left = cross(camDir, dir);
    vec3 up = cross(left, dir);
    left = vSize * normalize(left);
    up = vSize * normalize(up);

    // move vertex in object-space from center to corner
    vModelPosition += aMapping.x * dir + aMapping.y * left + aMapping.z * up;

    vec4 mvPosition = uView * vec4(vModelPosition, 1.0);
    vViewPosition = mvPosition.xyz;
    gl_Position = uProjection * mvPosition;

    if (gl_Position.z < -gl_Position.w) {
        mvPosition.z -= 2.0 * (length(vEnd - vStart) + vSize); // avoid clipping
        gl_Position.z = (uProjection * mvPosition).z;
    }

    #if defined(dDualColor) && defined(dRenderVariant_color) && (defined(dColorType_group) || defined(dColorType_groupInstance))
        // dual-color mixing
        // - for aColorMode between 0 and 1 use aColorMode to interpolate
        // - for aColorMode == 2 do nothing, i.e., use vColor
        // - for aColorMode == 3 use position on cylinder axis to interpolate
        if (aColorMode <= 1.0){
            vColor.rgb = mix(vColor.rgb, color2.rgb, aColorMode);
        } else if (aColorMode == 3.0) {
            vColor.rgb = mix(vColor.rgb, color2.rgb, mix(-0.25, 1.25, f / 1.5));
        }
    #endif

    #include clip_instance
}
`;var Bge=`
precision highp float;
precision highp int;

#define bumpEnabled

uniform mat4 uView;

varying mat4 vTransform;
varying vec3 vStart;
varying vec3 vEnd;
varying float vSize;
varying float vCap;

uniform vec3 uCameraDir;
uniform vec3 uCameraPosition;
uniform mat4 uInvView;

uniform vec4 uInteriorColor;
uniform vec4 uInteriorSubstance;

#include common
#include common_frag_params
#include color_frag_params
#include light_frag_params
#include common_clip

#ifdef dSolidInterior
    const bool solidInterior = true;
#else
    const bool solidInterior = false;
#endif

// adapted from https://www.shadertoy.com/view/4lcSRn
// The MIT License, Copyright 2016 Inigo Quilez
bool CylinderImpostor(
    in vec3 rayOrigin, in vec3 rayDir,
    in vec3 start, in vec3 end, in float radius,
    out vec3 cameraNormal, out bool interior,
    out vec3 modelPosition, out vec3 viewPosition, out float fragmentDepth
){
    vec3 ba = end - start;
    vec3 oc = rayOrigin - start;

    float baba = dot(ba, ba);
    float bard = dot(ba, rayDir);
    float baoc = dot(ba, oc);

    float k2 = baba - bard * bard;
    float k1 = baba * dot(oc, rayDir) - baoc * bard;
    float k0 = baba * dot(oc, oc) - baoc * baoc - radius * radius * baba;

    float h = k1 * k1 - k2 * k0;
    if (h < 0.0) return false;

    bool topCap = (vCap > 0.9 && vCap < 1.1) || vCap >= 2.9;
    bool bottomCap = (vCap > 1.9 && vCap < 2.1) || vCap >= 2.9;

    #ifdef dSolidInterior
        bool topInterior = !topCap;
        bool bottomInterior = !bottomCap;
        topCap = true;
        bottomCap = true;
    #else
        bool topInterior = false;
        bool bottomInterior = false;
    #endif

    bool clipped = false;
    bool objectClipped = false;

    // body outside
    h = sqrt(h);
    float t = (-k1 - h) / k2;
    float y = baoc + t * bard;
    if (y > 0.0 && y < baba) {
        interior = false;
        cameraNormal = (oc + t * rayDir - ba * y / baba) / radius;
        modelPosition = rayOrigin + t * rayDir;
        viewPosition = (uView * vec4(modelPosition, 1.0)).xyz;
        fragmentDepth = calcDepth(viewPosition);
        #if defined(dClipVariant_pixel) && dClipObjectCount != 0
            if (clipTest(modelPosition)) {
                objectClipped = true;
                fragmentDepth = -1.0;
                #ifdef dSolidInterior
                    topCap = !topInterior;
                    bottomCap = !bottomInterior;
                #endif
            }
        #endif
        if (fragmentDepth > 0.0) return true;
        clipped = true;
    }

    if (!clipped) {
        if (topCap && y < 0.0) {
            // top cap
            t = -baoc / bard;
            if (abs(k1 + k2 * t) < h) {
                interior = topInterior;
                cameraNormal = -ba / baba;
                modelPosition = rayOrigin + t * rayDir;
                viewPosition = (uView * vec4(modelPosition, 1.0)).xyz;
                fragmentDepth = calcDepth(viewPosition);
                #if defined(dClipVariant_pixel) && dClipObjectCount != 0
                    if (clipTest(modelPosition)) {
                        objectClipped = true;
                        fragmentDepth = -1.0;
                        #ifdef dSolidInterior
                            topCap = !topInterior;
                            bottomCap = !bottomInterior;
                        #endif
                    }
                #endif
                if (fragmentDepth > 0.0) {
                    #ifdef dSolidInterior
                        if (interior) cameraNormal = -rayDir;
                    #endif
                    #if defined(dClipVariant_pixel) && dClipObjectCount != 0
                        return true;
                    #else
                        return !interior;
                    #endif
                }
            }
        } else if (bottomCap && y >= 0.0) {
            // bottom cap
            t = (baba - baoc) / bard;
            if (abs(k1 + k2 * t) < h) {
                interior = bottomInterior;
                cameraNormal = ba / baba;
                modelPosition = rayOrigin + t * rayDir;
                viewPosition = (uView * vec4(modelPosition, 1.0)).xyz;
                fragmentDepth = calcDepth(viewPosition);
                #if defined(dClipVariant_pixel) && dClipObjectCount != 0
                    if (clipTest(modelPosition)) {
                        objectClipped = true;
                        fragmentDepth = -1.0;
                        #ifdef dSolidInterior
                            topCap = !topInterior;
                            bottomCap = !bottomInterior;
                        #endif
                    }
                #endif
                if (fragmentDepth > 0.0) {
                    #ifdef dSolidInterior
                        if (interior) cameraNormal = -rayDir;
                    #endif
                    #if defined(dClipVariant_pixel) && dClipObjectCount != 0
                        return true;
                    #else
                        return !interior;
                    #endif
                }
            }
        }
    }

    if (uDoubleSided || solidInterior) {
        // body inside
        h = -h;
        t = (-k1 - h) / k2;
        y = baoc + t * bard;
        if (y > 0.0 && y < baba) {
            interior = true;
            cameraNormal = -(oc + t * rayDir - ba * y / baba) / radius;
            modelPosition = rayOrigin + t * rayDir;
            viewPosition = (uView * vec4(modelPosition, 1.0)).xyz;
            fragmentDepth = calcDepth(viewPosition);
            if (fragmentDepth > 0.0) {
                #ifdef dSolidInterior
                    if (!objectClipped) {
                        fragmentDepth = 0.0 + (0.0000002 / vSize);
                        cameraNormal = -rayDir;

                        // intersection of ray in model space with near plane in camera space
                        vec3 cameraRayOrigin = (uView * vec4(rayOrigin, 1.0)).xyz;
                        vec3 cameraRayDir = (uView * vec4(rayDir, 0.0)).xyz;
                        float nearT = - (uNear + cameraRayOrigin.z) / cameraRayDir.z;
                        viewPosition = cameraRayOrigin + nearT * cameraRayDir;
                        modelPosition = (uInvView * vec4(viewPosition, 1.0)).xyz;
                    }
                #endif
                return true;
            }
        }

        if (topCap && y < 0.0) {
            // top cap
            t = -baoc / bard;
            if (abs(k1 + k2 * t) < -h) {
                interior = true;
                cameraNormal = ba / baba;
                modelPosition = rayOrigin + t * rayDir;
                viewPosition = (uView * vec4(modelPosition, 1.0)).xyz;
                fragmentDepth = calcDepth(viewPosition);
                if (fragmentDepth > 0.0) {
                    #ifdef dSolidInterior
                        if (!objectClipped) {
                            fragmentDepth = 0.0 + (0.0000002 / vSize);
                            cameraNormal = -rayDir;

                            // intersection of ray in model space with near plane in camera space
                            vec3 cameraRayOrigin = (uView * vec4(rayOrigin, 1.0)).xyz;
                            vec3 cameraRayDir = (uView * vec4(rayDir, 0.0)).xyz;
                            float nearT = - (uNear + cameraRayOrigin.z) / cameraRayDir.z;
                            viewPosition = cameraRayOrigin + nearT * cameraRayDir;
                            modelPosition = (uInvView * vec4(viewPosition, 1.0)).xyz;
                        }
                    #endif
                    return true;
                }
            }
        } else if (bottomCap && y >= 0.0) {
            // bottom cap
            t = (baba - baoc) / bard;
            if (abs(k1 + k2 * t) < -h) {
                interior = true;
                cameraNormal = -ba / baba;
                modelPosition = rayOrigin + t * rayDir;
                viewPosition = (uView * vec4(modelPosition, 1.0)).xyz;
                fragmentDepth = calcDepth(viewPosition);
                if (fragmentDepth > 0.0) {
                    #ifdef dSolidInterior
                        if (!objectClipped) {
                            fragmentDepth = 0.0 + (0.0000002 / vSize);
                            cameraNormal = -rayDir;

                            // intersection of ray in model space with near plane in camera space
                            vec3 cameraRayOrigin = (uView * vec4(rayOrigin, 1.0)).xyz;
                            vec3 cameraRayDir = (uView * vec4(rayDir, 0.0)).xyz;
                            float nearT = - (uNear + cameraRayOrigin.z) / cameraRayDir.z;
                            viewPosition = cameraRayOrigin + nearT * cameraRayDir;
                            modelPosition = (uInvView * vec4(viewPosition, 1.0)).xyz;
                        }
                    #endif
                    return true;
                }
            }
        }
    }

    return false;
}

void main() {
    vec3 rayOrigin = vModelPosition;
    vec3 rayDir = mix(normalize(vModelPosition - uCameraPosition), uCameraDir, uIsOrtho);

    vec3 cameraNormal;
    vec3 modelPosition;
    vec3 viewPosition;
    float fragmentDepth;
    bool hit = CylinderImpostor(rayOrigin, rayDir, vStart, vEnd, vSize, cameraNormal, interior, modelPosition, viewPosition, fragmentDepth);
    if (!hit) discard;

    if (fragmentDepth < 0.0) discard;
    if (fragmentDepth > 1.0) discard;

    gl_FragDepthEXT = fragmentDepth;

    vec3 vViewPosition = viewPosition;
    vec3 vModelPosition = modelPosition;

    #include fade_lod
    #include clip_pixel

    #ifdef dNeedsNormal
        mat3 normalMatrix = adjoint(uView);
        vec3 normal = normalize(normalMatrix * -normalize(cameraNormal));
    #endif

    #include assign_material_color
    #include check_transparency

    #if defined(dRenderVariant_pick)
        #include check_picking_alpha
        #ifdef requiredDrawBuffers
            gl_FragColor = vObject;
            gl_FragData[1] = vInstance;
            gl_FragData[2] = vGroup;
            gl_FragData[3] = packDepthToRGBA(fragmentDepth);
        #else
            gl_FragColor = vColor;
        #endif
    #elif defined(dRenderVariant_depth)
        gl_FragColor = material;
    #elif defined(dRenderVariant_marking)
        gl_FragColor = material;
    #elif defined(dRenderVariant_emissive)
        gl_FragColor = material;
    #elif defined(dRenderVariant_color) || defined(dRenderVariant_tracing)
        #include apply_interior_color
        #include apply_light_color
        #include apply_marker_color

        #if defined(dRenderVariant_color)
            #include apply_fog
            #include wboit_write
            #include dpoit_write
        #elif defined(dRenderVariant_tracing)
            gl_FragData[1] = vec4(normal, emissive);
            gl_FragData[2] = vec4(material.rgb, uDensity);
        #endif
    #endif
}
`;var Ege=`
precision highp float;
precision highp int;

#include common
#include read_from_texture
#include common_vert_params
#include color_vert_params
#include size_vert_params
#include common_clip

uniform mat4 uModelView;

attribute vec3 aPosition;
attribute vec2 aMapping;
attribute float aDepth;
attribute vec2 aTexCoord;
attribute mat4 aTransform;
attribute float aInstance;
attribute float aGroup;

uniform float uOffsetX;
uniform float uOffsetY;
uniform float uOffsetZ;

uniform float uIsOrtho;
uniform float uPixelRatio;
uniform vec4 uViewport;
uniform mat4 uInvHeadRotation;
uniform bool uHasHeadRotation;
uniform mat4 uModelViewEye;
uniform mat4 uInvModelViewEye;
uniform bool uHasEyeCamera;

varying vec2 vTexCoord;

void main(void){
    int vertexId = VertexID;

    #include assign_group
    #include assign_color_varying
    #include assign_marker_varying
    #include assign_clipping_varying
    #include assign_size

    vTexCoord = aTexCoord;

    float scale = uModelScale;

    float offsetX = uOffsetX * scale;
    float offsetY = uOffsetY * scale;
    float offsetZ = (uOffsetZ + aDepth * 0.95) * scale;

    vec4 position4 = vec4(aPosition, 1.0);
    vec4 mvPosition = uHasEyeCamera
         ? uModelViewEye * aTransform * position4
         : uModelView * aTransform * position4;

    vModelPosition = (uModel * aTransform * position4).xyz; // for clipping in frag shader

    // TODO
    // #ifdef FIXED_SIZE
    //     if (ortho) {
    //         scale /= pixelRatio * ((uViewport.w / 2.0) / -uCameraPosition.z) * 0.1;
    //     } else {
    //         scale /= pixelRatio * ((uViewport.w / 2.0) / -mvPosition.z) * 0.1;
    //     }
    // #endif

    vec4 mvCorner = vec4(mvPosition.xyz, 1.0);

    if (vTexCoord.x == 10.0) { // indicates background plane
        // move a bit to the back, taking distance to camera into account to avoid z-fighting
        offsetZ -= 0.001 * distance(uCameraPosition, (uProjection * mvCorner).xyz);
    }

    vec3 cornerOffset = vec3(0.0);
    cornerOffset.xy += aMapping * size * scale;
    cornerOffset.x += offsetX;
    cornerOffset.y += offsetY;

    if (uHasHeadRotation) {
        mvCorner.xyz += (uInvHeadRotation * vec4(cornerOffset, 1.0)).xyz;
    } else {
        mvCorner.xyz += cornerOffset;
    }

    if (!uHasEyeCamera) {
        if (uIsOrtho == 1.0) {
            mvCorner.z += offsetZ;
        } else {
            mvCorner.xyz += normalize(-mvCorner.xyz) * offsetZ;
        }
    }

    if (uHasEyeCamera) {
        mvCorner = uModelView * uInvModelViewEye * mvCorner;
    }

    gl_Position = uProjection * mvCorner;

    vViewPosition = -mvCorner.xyz;

    #include clip_instance
}
`;var kge=`
precision highp float;
precision highp int;

#include common
#include common_frag_params
#include color_frag_params
#include common_clip

uniform sampler2D tFont;

uniform vec3 uBorderColor;
uniform float uBorderWidth;
uniform vec3 uBackgroundColor;
uniform float uBackgroundOpacity;

varying vec2 vTexCoord;

void main(){
    #include fade_lod
    #include clip_pixel

    float fragmentDepth = gl_FragCoord.z;
    #include assign_material_color

    if (vTexCoord.x > 1.0) {
        #if defined(dRenderVariant_color) || defined(dRenderVariant_tracing)
            material = vec4(uBackgroundColor, uBackgroundOpacity * material.a);
        #endif
    } else {
        // retrieve signed distance
        float sdf = texture2D(tFont, vTexCoord).a + uBorderWidth;

        if (sdf < 0.5) discard;

        #if defined(dRenderVariant_color) || defined(dRenderVariant_tracing)
            // add border
            float t = 0.5 + uBorderWidth;
            if (uBorderWidth > 0.0 && sdf < t) {
                material.xyz = uBorderColor;
            }
        #endif
    }

    #include check_transparency

    #if defined(dRenderVariant_pick)
        #include check_picking_alpha
        #ifdef requiredDrawBuffers
            gl_FragColor = vObject;
            gl_FragData[1] = vInstance;
            gl_FragData[2] = vGroup;
            gl_FragData[3] = packDepthToRGBA(fragmentDepth);
        #else
            gl_FragColor = vColor;
        #endif
    #elif defined(dRenderVariant_depth)
        gl_FragColor = material;
    #elif defined(dRenderVariant_marking)
        gl_FragColor = material;
    #elif defined(dRenderVariant_emissive)
        gl_FragColor = material;
    #elif defined(dRenderVariant_color) || defined(dRenderVariant_tracing)
        gl_FragColor = material;
        #include apply_marker_color

        #if defined(dRenderVariant_color)
            #include apply_fog
            #include wboit_write
            #include dpoit_write
        #elif defined(dRenderVariant_tracing)
            gl_FragData[1] = vec4(-normalize(vViewPosition), emissive);
            gl_FragData[2] = vec4(material.rgb, uDensity);
        #endif
    #endif
}
`;var Fge=`
precision highp float;
precision highp int;

#include common
#include read_from_texture
#include common_vert_params
#include color_vert_params
#include size_vert_params
#include common_clip

uniform float uPixelRatio;
uniform vec4 uViewport;

attribute mat4 aTransform;
attribute float aInstance;
attribute float aGroup;

attribute vec2 aMapping;
attribute vec3 aStart;
attribute vec3 aEnd;

void trimSegment(const in vec4 start, inout vec4 end) {
    // trim end segment so it terminates between the camera plane and the near plane
    // conservative estimate of the near plane
    float a = uProjection[2][2];  // 3rd entry in 3rd column
    float b = uProjection[3][2];  // 3rd entry in 4th column
    float nearEstimate = -0.5 * b / a;
    float alpha = (nearEstimate - start.z) / (end.z - start.z);
    end.xyz = mix(start.xyz, end.xyz, alpha);
}

void main(){
    float aspect = uViewport.z / uViewport.w;
    int vertexId = VertexID;

    #include assign_group
    #include assign_color_varying
    #include assign_marker_varying
    #include assign_clipping_varying
    #include assign_size

    mat4 modelView = uView * uModel * aTransform;

    // camera space
    vec4 start = modelView * vec4(aStart, 1.0);
    vec4 end = modelView * vec4(aEnd, 1.0);

    // assign position
    vec4 position4 = vec4((aMapping.y < 0.5) ? aStart : aEnd, 1.0);
    vec4 mvPosition = modelView * position4;
    vViewPosition = mvPosition.xyz;

    vModelPosition = (uModel * aTransform * position4).xyz; // for clipping in frag shader

    // special case for perspective projection, and segments that terminate either in, or behind, the camera plane
    // clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
    // but we need to perform ndc-space calculations in the shader, so we must address this issue directly
    // perhaps there is a more elegant solution -- WestLangley
    bool perspective = (uProjection[2][3] == -1.0); // 4th entry in the 3rd column
    if (perspective) {
        if (start.z < 0.0 && end.z >= 0.0) {
            trimSegment(start, end);
        } else if (end.z < 0.0 && start.z >= 0.0) {
            trimSegment(end, start);
        }
    }

    // clip space
    vec4 clipStart = uProjection * start;
    vec4 clipEnd = uProjection * end;

    // ndc space
    vec2 ndcStart = clipStart.xy / clipStart.w;
    vec2 ndcEnd = clipEnd.xy / clipEnd.w;

    // direction
    vec2 dir = ndcEnd - ndcStart;

    // account for clip-space aspect ratio
    dir.x *= aspect;
    dir = normalize(dir);

    // perpendicular to dir
    vec2 offset = vec2(dir.y, - dir.x);

    // undo aspect ratio adjustment
    dir.x /= aspect;
    offset.x /= aspect;

    // sign flip
    if (aMapping.x < 0.0) offset *= -1.0;

    // calculate linewidth
    float linewidth;
    #ifdef dLineSizeAttenuation
        linewidth = size * uPixelRatio * ((uViewport.w / 2.0) / -start.z) * 5.0;
    #else
        linewidth = size * uPixelRatio;
    #endif
    linewidth = max(1.0, linewidth);

    // adjust for linewidth
    offset *= linewidth;

    // adjust for clip-space to screen-space conversion
    offset /= uViewport.w;

    // select end
    vec4 clip = (aMapping.y < 0.5) ? clipStart : clipEnd;

    // back to clip space
    offset *= clip.w;
    clip.xy += offset;
    gl_Position = clip;

    #include clip_instance
}
`;var Lge=`
precision highp float;
precision highp int;

#include common
#include common_frag_params
#include color_frag_params
#include common_clip

void main(){
    #include fade_lod
    #include clip_pixel

    float fragmentDepth = gl_FragCoord.z;
    #include assign_material_color
    #include check_transparency

    #if defined(dRenderVariant_pick)
        #include check_picking_alpha
        #ifdef requiredDrawBuffers
            gl_FragColor = vObject;
            gl_FragData[1] = vInstance;
            gl_FragData[2] = vGroup;
            gl_FragData[3] = packDepthToRGBA(fragmentDepth);
        #else
            gl_FragColor = vColor;
        #endif
    #elif defined(dRenderVariant_depth)
        gl_FragColor = material;
    #elif defined(dRenderVariant_marking)
        gl_FragColor = material;
    #elif defined(dRenderVariant_emissive)
        gl_FragColor = material;
    #elif defined(dRenderVariant_color) || defined(dRenderVariant_tracing)
        gl_FragColor = material;
        #include apply_marker_color

        #if defined(dRenderVariant_color)
            #include apply_fog
            #include wboit_write
            #include dpoit_write
        #elif defined(dRenderVariant_tracing)
            gl_FragData[1] = vec4(normalize(vViewPosition), emissive);
            gl_FragData[2] = vec4(material.rgb, uDensity);
        #endif
    #endif
}
`;var Vge=`
precision highp float;
precision highp int;
precision highp sampler2D;

#include common
#include read_from_texture
#include common_vert_params
#include color_vert_params
#include common_clip
#include texture3d_from_2d_linear

#ifdef dGeometryType_textureMesh
    uniform vec2 uGeoTexDim;
    uniform sampler2D tPosition;
    uniform sampler2D tGroup;
    uniform sampler2D tNormal;
#else
    attribute vec3 aPosition;
    attribute float aGroup;
    attribute vec3 aNormal;
#endif
attribute mat4 aTransform;
attribute float aInstance;

varying vec3 vNormal;

void main(){
    int vertexId = VertexID;

    #include assign_group
    #include assign_marker_varying
    #include assign_clipping_varying
    #include assign_position
    #include assign_color_varying
    #include clip_instance

    #ifdef dGeometryType_textureMesh
        vec3 normal = readFromTexture(tNormal, vertexId, uGeoTexDim).xyz;
    #else
        vec3 normal = aNormal;
    #endif
    mat3 normalMatrix = adjoint(modelView);
    vec3 transformedNormal = normalize(normalMatrix * normalize(normal));
    #if defined(dFlipSided)
        if (!uDoubleSided) { // TODO checking uDoubleSided should not be required, ASR
            transformedNormal = -transformedNormal;
        }
    #endif
    vNormal = transformedNormal;
}
`;var Oge=`
precision highp float;
precision highp int;

#define bumpEnabled

#include common
#include common_frag_params
#include color_frag_params
#include light_frag_params
#include normal_frag_params
#include common_clip

uniform vec4 uInteriorColor;
uniform vec4 uInteriorSubstance;

void main() {
    #include fade_lod
    #include clip_pixel

    interior = !gl_FrontFacing;

    float fragmentDepth = gl_FragCoord.z;

    #ifdef dNeedsNormal
        #if defined(dFlatShaded)
            vec3 fdx = dFdx(vViewPosition);
            vec3 fdy = dFdy(vViewPosition);
            vec3 normal = -normalize(cross(fdx,fdy));
        #else
            vec3 normal = -normalize(vNormal);
            if (uDoubleSided) normal *= float(gl_FrontFacing) * 2.0 - 1.0;
        #endif

        #if defined(dFlipSided)
            normal *= -1.0;
        #endif
    #endif

    #include assign_material_color
    #include check_transparency

    #if defined(dRenderVariant_pick)
        #include check_picking_alpha
        #ifdef requiredDrawBuffers
            gl_FragColor = vObject;
            gl_FragData[1] = vInstance;
            gl_FragData[2] = vGroup;
            gl_FragData[3] = packDepthToRGBA(fragmentDepth);
        #else
            gl_FragColor = vColor;
        #endif
    #elif defined(dRenderVariant_depth)
        gl_FragColor = material;
    #elif defined(dRenderVariant_marking)
        gl_FragColor = material;
    #elif defined(dRenderVariant_emissive)
        gl_FragColor = material;
    #elif defined(dRenderVariant_color) || defined(dRenderVariant_tracing)
        #include apply_interior_color
        #include apply_light_color
        #include apply_marker_color

        #if defined(dRenderVariant_color)
            #include apply_fog
            #include wboit_write
            #include dpoit_write
        #elif defined(dRenderVariant_tracing)
            gl_FragData[1] = vec4(normal, emissive);
            gl_FragData[2] = vec4(material.rgb, uDensity);
        #endif
    #endif
}
`;var Gge=`
precision highp float;

attribute vec3 aPosition;
attribute mat4 aTransform;
attribute float aInstance;

uniform mat4 uModel;
uniform mat4 uModelView;
uniform mat4 uProjection;
uniform vec4 uInvariantBoundingSphere;
uniform float uModelScale;

varying vec3 vModelPosition;
varying float vInstance;
varying vec4 vBoundingSphere;
varying mat4 vTransform;

uniform vec3 uBboxSize;
uniform vec3 uBboxMin;
uniform vec3 uBboxMax;
uniform vec3 uGridDim;
uniform mat4 uTransform;

uniform mat4 uUnitToCartn;

void main() {
    vec4 unitCoord = vec4(aPosition + vec3(0.5), 1.0);
    vec4 mvPosition = uModelView * aTransform * uUnitToCartn * unitCoord;

    vModelPosition = (uModel * aTransform * uUnitToCartn * unitCoord).xyz;
    vInstance = aInstance;
    vBoundingSphere = vec4(
        (uModel * aTransform * vec4(uInvariantBoundingSphere.xyz, 1.0)).xyz,
        uModelScale * uInvariantBoundingSphere.w
    );
    vTransform = aTransform;

    gl_Position = uProjection * mvPosition;

    // move z position to near clip plane (but not too close to get precision issues)
    gl_Position.z = gl_Position.w - 0.01;
}
`;var Uge=`
precision highp float;
precision highp int;

#include common
#include light_frag_params

#if dClipObjectCount != 0
    uniform int uClipObjectType[dClipObjectCount];
    uniform bool uClipObjectInvert[dClipObjectCount];
    uniform vec3 uClipObjectPosition[dClipObjectCount];
    uniform vec4 uClipObjectRotation[dClipObjectCount];
    uniform vec3 uClipObjectScale[dClipObjectCount];
    uniform mat4 uClipObjectTransform[dClipObjectCount];
#endif
#include common_clip

#include read_from_texture
#include texture3d_from_1d_trilinear
#include texture3d_from_2d_nearest
#include texture3d_from_2d_linear

uniform mat4 uProjection, uTransform, uModelView, uModel, uView;
uniform vec3 uCameraDir;
uniform float uModelScale;

uniform sampler2D tDepth;
uniform vec2 uDrawingBufferSize;

varying vec3 vModelPosition;
varying float vInstance;
varying vec4 vBoundingSphere;
varying mat4 vTransform;

uniform mat4 uInvView;
uniform vec3 uGridDim;
uniform vec3 uBboxSize;
uniform sampler2D tTransferTex;
uniform float uTransferScale;
uniform float uStepScale;
uniform float uJumpLength;

uniform int uObjectId;
uniform int uVertexCount;
uniform int uInstanceCount;
uniform int uGroupCount;

#if defined(dColorMarker)
    uniform vec3 uHighlightColor;
    uniform vec3 uSelectColor;
    uniform vec3 uDimColor;
    uniform float uHighlightStrength;
    uniform float uSelectStrength;
    uniform float uDimStrength;
    uniform int uMarkerPriority;
    uniform float uMarkerAverage;

    uniform float uMarker;
    uniform vec2 uMarkerTexDim;
    uniform sampler2D tMarker;
#endif

uniform float uMetalness;
uniform float uRoughness;
uniform float uEmissive;

// Density value to estimate object thickness
uniform float uDensity;

uniform bool uFog;
uniform float uFogNear;
uniform float uFogFar;
uniform vec3 uFogColor;

uniform float uAlpha;
uniform bool uTransparentBackground;
uniform float uXrayEdgeFalloff;
uniform float uCelSteps;
uniform float uExposure;

uniform int uRenderMask;

uniform float uNear;
uniform float uFar;
uniform float uIsOrtho;

uniform vec3 uCellDim;
uniform vec3 uCameraPosition;
uniform mat4 uCartnToUnit;

#if __VERSION__ != 100
    // for webgl1 this is given as a 'define'
    uniform int uMaxSteps;
#endif

#if defined(dGridTexType_2d)
    precision highp sampler2D;
    uniform sampler2D tGridTex;
    uniform vec3 uGridTexDim;
#elif defined(dGridTexType_3d)
    precision highp sampler3D;
    uniform sampler3D tGridTex;
#endif

#if defined(dColorType_uniform)
    uniform vec3 uColor;
#elif defined(dColorType_texture)
    uniform vec2 uColorTexDim;
    uniform sampler2D tColor;
#endif

#ifdef dOverpaint
    #if defined(dOverpaintType_groupInstance) || defined(dOverpaintType_vertexInstance)
        uniform vec2 uOverpaintTexDim;
        uniform sampler2D tOverpaint;
    #endif
#endif

#ifdef dUsePalette
    uniform vec2 uPaletteDomain;
    uniform sampler2D tPalette;
#endif

#if defined(dGridTexType_2d)
    vec4 textureVal(vec3 pos) {
        return texture3dFrom2dLinear(tGridTex, pos + (vec3(0.5, 0.5, 0.0) / uGridDim), uGridDim, uGridTexDim.xy);
    }
    vec4 textureGroup(vec3 pos) {
        return texture3dFrom2dNearest(tGridTex, pos + (vec3(0.5, 0.5, 0.0) / uGridDim), uGridDim, uGridTexDim.xy);
    }
#elif defined(dGridTexType_3d)
    vec4 textureVal(vec3 pos) {
        return texture(tGridTex, pos + (vec3(0.5) / uGridDim));
    }
    vec4 textureGroup(vec3 pos) {
        return texelFetch(tGridTex, ivec3(pos * uGridDim), 0);
    }
#endif

float calcDepth(const in vec3 pos) {
    vec2 clipZW = pos.z * uProjection[2].zw + uProjection[3].zw;
    return 0.5 + 0.5 * clipZW.x / clipZW.y;
}

float transferFunction(float value) {
    return texture2D(tTransferTex, vec2(value, 0.0)).a;
}

float getDepth(const in vec2 coords) {
    #ifdef depthTextureSupport
        return texture2D(tDepth, coords).r;
    #else
        return unpackRGBAToDepth(texture2D(tDepth, coords));
    #endif
}

const float gradOffset = 0.5;

vec3 v3m4(vec3 p, mat4 m) {
    return (m * vec4(p, 1.0)).xyz;
}

float preFogAlphaBlended = 0.0;

vec4 raymarch(vec3 startLoc, vec3 step, vec3 rayDir) {
    mat3 normalMatrix = adjoint(uModelView * vTransform);
    mat4 cartnToUnit = uCartnToUnit * inverse4(vTransform);
    #if defined(dClipVariant_pixel) && dClipObjectCount != 0
        mat4 modelTransform = uModel * vTransform * uTransform;
    #endif
    mat4 modelViewTransform = uModelView * vTransform * uTransform;

    vec3 scaleVol = vec3(1.0) / uGridDim;
    vec3 pos = startLoc;
    vec4 cell;
    float prevValue = -1.0;
    float value = 0.0;
    vec4 src = vec4(0.0);
    vec4 dst = vec4(0.0);
    float fragmentDepth;

    vec3 posMin = vec3(0.0);
    vec3 posMax = vec3(1.0) - vec3(1.0) / uGridDim;

    vec3 unitPos;

    vec3 nextPos;
    float nextValue;

    vec4 material;
    vec4 overpaint;
    float metalness = uMetalness;
    float roughness = uRoughness;
    float emissive = uEmissive;

    vec3 gradient = vec3(1.0);
    vec3 dx = vec3(gradOffset * scaleVol.x, 0.0, 0.0);
    vec3 dy = vec3(0.0, gradOffset * scaleVol.y, 0.0);
    vec3 dz = vec3(0.0, 0.0, gradOffset * scaleVol.z);

    float maxDist = min(vBoundingSphere.w * 2.0, uFar - uNear);
    float maxDistSq = maxDist * maxDist;

    for (int i = 0; i < uMaxSteps; ++i) {
        // break when beyond bounding-sphere or far-plane
        vec3 distVec = startLoc - pos;
        if (dot(distVec, distVec) > maxDistSq) break;

        unitPos = v3m4(pos / uModelScale, cartnToUnit);

        // continue when outside of grid
        if (unitPos.x > posMax.x || unitPos.y > posMax.y || unitPos.z > posMax.z ||
            unitPos.x < posMin.x || unitPos.y < posMin.y || unitPos.z < posMin.z
        ) {
            prevValue = value;
            pos += step;
            continue;
        }

        cell = textureVal(unitPos);
        value = cell.a; // current voxel value

        if (uJumpLength > 0.0 && value < 0.01) {
            nextPos = pos + rayDir * uJumpLength;
            nextValue = textureVal(v3m4(nextPos / uModelScale, cartnToUnit)).a;
            if (nextValue < 0.01) {
                prevValue = nextValue;
                pos = nextPos;
                continue;
            }
        }

        vec4 mvPosition = modelViewTransform * vec4(unitPos * uGridDim, 1.0);
        if (calcDepth(mvPosition.xyz) > getDepth(gl_FragCoord.xy / uDrawingBufferSize))
            break;

        #if defined(dClipVariant_pixel) && dClipObjectCount != 0
            vec3 modelPosition = v3m4(unitPos * uGridDim, modelTransform);
            if (clipTest(modelPosition)) {
                prevValue = value;
                pos += step;
                continue;
            }
        #endif

        vec3 vViewPosition = mvPosition.xyz;
        material.a = transferFunction(value);

        #ifdef dPackedGroup
            float group = unpackRGBToInt(textureGroup(floor(unitPos * uGridDim + 0.5) / uGridDim).rgb);
        #else
            vec3 g = floor(unitPos * uGridDim + 0.5);
            // note that we swap x and z because the texture is flipped around y
            #if defined(dAxisOrder_012)
                float group = g.z + g.y * uGridDim.z + g.x * uGridDim.z * uGridDim.y; // 210
            #elif defined(dAxisOrder_021)
                float group = g.y + g.z * uGridDim.y + g.x * uGridDim.y * uGridDim.z; // 120
            #elif defined(dAxisOrder_102)
                float group = g.z + g.x * uGridDim.z + g.y * uGridDim.z * uGridDim.x; // 201
            #elif defined(dAxisOrder_120)
                float group = g.x + g.z * uGridDim.x + g.y * uGridDim.x * uGridDim.z; // 021
            #elif defined(dAxisOrder_201)
                float group = g.y + g.x * uGridDim.y + g.z * uGridDim.y * uGridDim.x; // 102
            #elif defined(dAxisOrder_210)
                float group = g.x + g.y * uGridDim.x + g.z * uGridDim.x * uGridDim.y; // 012
            #endif
        #endif

        #if defined(dColorType_direct) && defined(dUsePalette)
            float paletteValue = (value - uPaletteDomain[0]) / (uPaletteDomain[1] - uPaletteDomain[0]);
            material.rgb = texture2D(tPalette, vec2(clamp(paletteValue, 0.0, 1.0), 0.0)).rgb;
        #elif defined(dColorType_uniform)
            material.rgb = uColor;
        #elif defined(dColorType_instance)
            material.rgb = readFromTexture(tColor, vInstance, uColorTexDim).rgb;
        #elif defined(dColorType_group)
            material.rgb = readFromTexture(tColor, group, uColorTexDim).rgb;
        #elif defined(dColorType_groupInstance)
            material.rgb = readFromTexture(tColor, vInstance * float(uGroupCount) + group, uColorTexDim).rgb;
        #elif defined(dColorType_vertex)
            material.rgb = texture3dFrom1dTrilinear(tColor, unitPos, uGridDim, uColorTexDim, 0.0).rgb;
        #elif defined(dColorType_vertexInstance)
            material.rgb = texture3dFrom1dTrilinear(tColor, unitPos, uGridDim, uColorTexDim, vInstance * float(uVertexCount)).rgb;
        #endif

        #ifdef dOverpaint
            #if defined(dOverpaintType_groupInstance)
                overpaint = readFromTexture(tOverpaint, vInstance * float(uGroupCount) + group, uOverpaintTexDim);
            #elif defined(dOverpaintType_vertexInstance)
                overpaint = texture3dFrom1dTrilinear(tOverpaint, unitPos, uGridDim, uOverpaintTexDim, vInstance * float(uVertexCount));
            #endif

            material.rgb = mix(material.rgb, overpaint.rgb, overpaint.a);
        #endif

        #if defined(dIgnoreLight)
            gl_FragColor.rgb = material.rgb;
        #else
            if (material.a >= 0.01) {
                #ifdef dPackedGroup
                    // compute gradient by central differences
                    gradient.x = textureVal(unitPos - dx).a - textureVal(unitPos + dx).a;
                    gradient.y = textureVal(unitPos - dy).a - textureVal(unitPos + dy).a;
                    gradient.z = textureVal(unitPos - dz).a - textureVal(unitPos + dz).a;
                #else
                    gradient = cell.xyz * 2.0 - 1.0;
                #endif
                vec3 normal = -normalize(normalMatrix * normalize(gradient));
                #include apply_light_color
            } else {
                gl_FragColor.rgb = material.rgb;
            }
        #endif

        gl_FragColor.a = material.a * uAlpha * uTransferScale;

        #if defined(dColorMarker)
            float marker = uMarker;
            if (uMarker == -1.0) {
                marker = readFromTexture(tMarker, vInstance * float(uGroupCount) + group, uMarkerTexDim).a;
                marker = floor(marker * 255.0 + 0.5); // rounding required to work on some cards on win
            }
        #endif
        #include apply_marker_color

        preFogAlphaBlended = (1.0 - preFogAlphaBlended) * gl_FragColor.a + preFogAlphaBlended;
        fragmentDepth = calcDepth(mvPosition.xyz);
        #include apply_fog

        src = gl_FragColor;

        if (!uTransparentBackground || !uFog) {
            // done in 'apply_fog' otherwise
            src.rgb *= src.a;
        }
        dst = (1.0 - dst.a) * src + dst; // standard blending

        // break if the color is opaque enough
        if (dst.a > 0.95)
            break;

        pos += step;
    }

    return dst;
}

// TODO: support float texture for higher precision values???
// TODO: support clipping exclusion texture support

void main() {
    #if defined(dRenderVariant_tracing) || defined(dRenderVariant_emissive)
        discard;
    #else
        if (gl_FrontFacing)
            discard;

        vec3 rayDir = mix(normalize(vModelPosition - uCameraPosition), uCameraDir, uIsOrtho);
        vec3 step = rayDir * uStepScale * uModelScale;

        float boundingSphereNear = distance(vBoundingSphere.xyz, uCameraPosition) - vBoundingSphere.w;
        float d = max(uNear, boundingSphereNear) - mix(0.0, distance(vModelPosition, uCameraPosition), uIsOrtho);
        vec3 start = mix(uCameraPosition, vModelPosition, uIsOrtho) + (d * rayDir);
        gl_FragColor = raymarch(start, step, rayDir);

        float fragmentDepth = calcDepth((uView * vec4(start, 1.0)).xyz);
        float preFogAlpha = clamp(preFogAlphaBlended, 0.0, 1.0);
        #include wboit_write
    #endif
}
`;var Nge=`
precision highp float;
precision highp int;

#include common
#include common_vert_params

attribute vec3 aPosition;
attribute vec2 aUv;
attribute mat4 aTransform;
attribute float aInstance;

varying vec2 vUv;
varying float vInstance;

void main() {
    int vertexId = VertexID;

    #include assign_position

    vUv = aUv;
    vInstance = aInstance;
}
`;var zge=`
precision highp float;
precision highp int;

#include common
#include read_from_texture
#include common_frag_params
#include common_clip

uniform float uEmissive;

// Density value to estimate object thickness
uniform float uDensity;

#if defined(dRenderVariant_color) || defined(dRenderVariant_tracing)
    #ifdef dOverpaint
        #if defined(dOverpaintType_instance) || defined(dOverpaintType_groupInstance)
            varying vec4 vOverpaint;
            uniform vec2 uOverpaintTexDim;
            uniform sampler2D tOverpaint;
        #endif
        uniform float uOverpaintStrength;
    #endif
#endif

#if defined(dRenderVariant_color) || defined(dRenderVariant_tracing) || defined(dRenderVariant_emissive)
    #ifdef dEmissive
        #if defined(dEmissiveType_instance) || defined(dEmissiveType_groupInstance)
            varying float vEmissive;
            uniform vec2 uEmissiveTexDim;
            uniform sampler2D tEmissive;
        #endif
        uniform float uEmissiveStrength;
    #endif
#endif

#ifdef dTransparency
    #if defined(dTransparencyType_instance) || defined(dTransparencyType_groupInstance)
        varying float vTransparency;
        uniform vec2 uTransparencyTexDim;
        uniform sampler2D tTransparency;
    #endif
    uniform float uTransparencyStrength;
#endif

uniform vec2 uImageTexDim;
uniform sampler2D tImageTex;
uniform sampler2D tGroupTex;
uniform sampler2D tValueTex;

uniform vec2 uMarkerTexDim;
uniform sampler2D tMarker;

varying vec2 vUv;
varying float vInstance;

#ifdef dUsePalette
    uniform sampler2D tPalette;
    uniform vec3 uPaletteDefault;
#endif

uniform int uTrimType;
uniform vec3 uTrimCenter;
uniform vec4 uTrimRotation;
uniform vec3 uTrimScale;
uniform mat4 uTrimTransform;

uniform float uIsoLevel;

#if defined(dInterpolation_catmulrom) || defined(dInterpolation_mitchell) || defined(dInterpolation_bspline)
    #define dInterpolation_cubic
#endif

#if defined(dInterpolation_cubic)
    #if defined(dInterpolation_catmulrom) || defined(dInterpolation_mitchell)
        #if defined(dInterpolation_catmulrom)
            const float B = 0.0;
            const float C = 0.5;
        #elif defined(dInterpolation_mitchell)
            const float B = 0.333;
            const float C = 0.333;
        #endif

        float cubicFilter(float x){
            float f = x;
            if (f < 0.0) {
                f = -f;
            }
            if (f < 1.0) {
                return ((12.0 - 9.0 * B - 6.0 * C) * (f * f * f) +
                    (-18.0 + 12.0 * B + 6.0 * C) * (f * f) +
                    (6.0 - 2.0 * B)) / 6.0;
            }else if (f >= 1.0 && f < 2.0){
                return ((-B - 6.0 * C) * ( f * f * f)
                    + (6.0 * B + 30.0 * C) * (f * f) +
                    (-(12.0 * B) - 48.0 * C) * f +
                    8.0 * B + 24.0 * C) / 6.0;
            }else{
                return 0.0;
            }
        }
    #elif defined(dInterpolation_bspline)
        float cubicFilter(float x) {
            float f = x;
            if (f < 0.0) {
                f = -f;
            }
            if (f >= 0.0 && f <= 1.0){
                return (2.0 / 3.0) + (0.5) * (f * f * f) - (f * f);
            } else if (f > 1.0 && f <= 2.0) {
                return 1.0 / 6.0 * pow((2.0 - f), 3.0);
            }
            return 1.0;
        }
    #endif

    vec4 biCubic(sampler2D tex, vec2 texCoord) {
        vec2 texelSize = 1.0 / uImageTexDim;
        texCoord -= texelSize / 2.0;
        vec4 nSum = vec4(0.0);
        float nDenom = 0.0;
        vec2 cell = fract(texCoord * uImageTexDim);
        for (float m = -1.0; m <= 2.0; ++m) {
            for (float n = -1.0; n <= 2.0; ++n) {
                vec4 vecData = texture2D(tex, texCoord + texelSize * vec2(m, n));
                float c = abs(cubicFilter(m - cell.x) * cubicFilter(-n + cell.y));
                nSum += vecData * c;
                nDenom += c;
            }
        }
        return nSum / nDenom;
    }
#endif

void main() {
    if (uTrimType != 0 && getSignedDistance(vModelPosition, uTrimType, uTrimCenter, uTrimRotation, uTrimScale, uTrimTransform) > 0.0) discard;

    #include fade_lod
    #include clip_pixel

    #if defined(dInterpolation_cubic)
        #ifdef dUsePalette
            vec4 material = texture2D(tImageTex, vUv);
            if (material.rgb != vec3(1.0)) {
                material = biCubic(tImageTex, vUv);
            }
        #else
            vec4 material = biCubic(tImageTex, vUv);
        #endif
    #else
        vec4 material = texture2D(tImageTex, vUv);
    #endif

    if (uIsoLevel >= 0.0) {
        if (texture2D(tValueTex, vUv).r < uIsoLevel) discard;

        material.a = uAlpha;
    } else {
        if (material.a == 0.0) discard;

        material.a *= uAlpha;
    }

    float fragmentDepth = gl_FragCoord.z;

    vec3 packedGroup = texture2D(tGroupTex, vUv).rgb;
    float group = packedGroup == vec3(0.0) ? -1.0 : unpackRGBToInt(packedGroup);

    // apply per-group transparency
    #if defined(dTransparency) && (defined(dRenderVariant_pick) || defined(dRenderVariant_color) || defined(dRenderVariant_emissive) || defined(dRenderVariant_tracing))
        float transparency = 0.0;
        #if defined(dTransparencyType_instance)
            transparency = readFromTexture(tTransparency, vInstance, uTransparencyTexDim).a;
        #elif defined(dTransparencyType_groupInstance)
            transparency = readFromTexture(tTransparency, vInstance * float(uGroupCount) + group, uTransparencyTexDim).a;
        #endif
        transparency *= uTransparencyStrength;

        float ta = 1.0 - transparency;
        if (transparency < 0.09) ta = 1.0; // hard cutoff looks better

        #if defined(dRenderVariant_pick)
            if (ta * uAlpha < uPickingAlphaThreshold)
                discard; // ignore so the element below can be picked
        #elif defined(dRenderVariant_emissive)
            if (ta < 1.0)
                discard; // emissive not supported with transparency
        #elif defined(dRenderVariant_color) || defined(dRenderVariant_tracing)
            material.a *= ta;
        #endif
    #endif

    if ((uRenderMask == MaskOpaque && material.a < 1.0) ||
        (uRenderMask == MaskTransparent && material.a == 1.0)
    ) {
        discard;
    }

    #if defined(dNeedsMarker)
        float marker = uMarker;
        if (group == -1.0) {
            marker = 0.0;
        } else if (uMarker == -1.0) {
            marker = readFromTexture(tMarker, vInstance * float(uGroupCount) + group, uMarkerTexDim).a;
            marker = floor(marker * 255.0 + 0.5); // rounding required to work on some cards on win
        }
    #endif

    #if defined(dRenderVariant_color) || defined(dRenderVariant_tracing) || defined(dRenderVariant_emissive)
        float emissive = uEmissive;
        if (group == -1.0) {
            emissive = 0.0;
        } else {
            #ifdef dEmissive
                #if defined(dEmissiveType_instance)
                    emissive += readFromTexture(tEmissive, vInstance, uEmissiveTexDim).a * uEmissiveStrength;
                #elif defined(dEmissiveType_groupInstance)
                    emissive += readFromTexture(tEmissive, vInstance * float(uGroupCount) + group, uEmissiveTexDim).a * uEmissiveStrength;
                #endif
            #endif
        }
    #endif

    #if defined(dRenderVariant_pick)
        if (group == -1.0) discard;

        #include check_picking_alpha
        #ifdef requiredDrawBuffers
            gl_FragColor = vec4(packIntToRGB(float(uObjectId)), 1.0);
            gl_FragData[1] = vec4(packIntToRGB(vInstance), 1.0);
            gl_FragData[2] = vec4(packIntToRGB(group), 1.0);
            gl_FragData[3] = packDepthToRGBA(fragmentDepth);
        #else
            gl_FragColor = vColor;
            if (uPickType == 1) {
                gl_FragColor = vec4(packIntToRGB(float(uObjectId)), 1.0);
            } else if (uPickType == 2) {
                gl_FragColor = vec4(packIntToRGB(vInstance), 1.0);
            } else {
                gl_FragColor = vec4(packIntToRGB(group), 1.0);
            }
        #endif
    #elif defined(dRenderVariant_depth)
        if (uRenderMask == MaskOpaque) {
            gl_FragColor = packDepthToRGBA(fragmentDepth);
        } else if (uRenderMask == MaskTransparent) {
            gl_FragColor = packDepthWithAlphaToRGBA(fragmentDepth, material.a);
        }
    #elif defined(dRenderVariant_marking)
        if (uMarkingType == 1) {
            if (marker > 0.0)
                discard;
            gl_FragColor = packDepthToRGBA(fragmentDepth);
        } else {
            if (marker == 0.0)
                discard;
            float depthTest = 1.0;
            if (uMarkingDepthTest) {
                depthTest = (fragmentDepth >= getDepthPacked(gl_FragCoord.xy / uDrawingBufferSize)) ? 1.0 : 0.0;
            }
            bool isHighlight = intMod(marker, 2.0) > 0.1;
            float viewZ = depthToViewZ(uIsOrtho, fragmentDepth, uNear, uFar);
            float fogFactor = smoothstep(uFogNear, uFogFar, abs(viewZ));
            if (fogFactor == 1.0)
                discard;
            gl_FragColor = vec4(0.0, depthTest, isHighlight ? 1.0 : 0.0, 1.0 - fogFactor);
        }
    #elif defined(dRenderVariant_emissive)
        gl_FragColor = vec4(emissive);
    #elif defined(dRenderVariant_color) || defined(dRenderVariant_tracing)
        #ifdef dUsePalette
            if (material.rgb == vec3(1.0)) {
                material.rgb = uPaletteDefault;
            } else {
                float v = ((material.r * 256.0 * 256.0 * 255.0 + material.g * 256.0 * 255.0 + material.b * 255.0) - 1.0) / PALETTE_SCALE;
                material.rgb = texture2D(tPalette, vec2(v, 0.0)).rgb;
            }
        #endif

        // mix material with overpaint
        #if defined(dOverpaint)
            vec4 overpaint = vec4(0.0);
            if (group != -1.0) {
                #if defined(dOverpaintType_instance)
                    overpaint = readFromTexture(tOverpaint, vInstance, uOverpaintTexDim);
                #elif defined(dOverpaintType_groupInstance)
                    overpaint = readFromTexture(tOverpaint, vInstance * float(uGroupCount) + group, uOverpaintTexDim);
                #endif
                overpaint *= uOverpaintStrength;
            }
            material.rgb = mix(material.rgb, overpaint.rgb, overpaint.a);
        #endif

        gl_FragColor = material;
        #include apply_marker_color

        #if defined(dRenderVariant_color)
            #include apply_fog
            #include wboit_write
            #include dpoit_write
        #elif defined(dRenderVariant_tracing)
            gl_FragData[1] = vec4(normalize(vViewPosition), emissive);
            gl_FragData[2] = vec4(material.rgb, uDensity);
        #endif
    #endif
}
`;var Xge=gi(),jQe={apply_fog:Zhe,apply_interior_color:qhe,apply_light_color:Yhe,apply_marker_color:Khe,assign_clipping_varying:Jhe,assign_color_varying:$he,assign_group:ege,assign_marker_varying:tge,assign_material_color:rge,assign_position:nge,assign_size:oge,check_picking_alpha:ige,check_transparency:age,clip_instance:sge,clip_pixel:lge,color_frag_params:uge,color_vert_params:cge,common_clip:mge,common_frag_params:dge,common_vert_params:pge,common:fge,fade_lod:hge,float_to_rgba:gge,light_frag_params:yge,normal_frag_params:bge,read_from_texture:xge,rgba_to_float:Cge,size_vert_params:Sge,texture3d_from_1d_trilinear:vge,texture3d_from_2d_linear:Ige,texture3d_from_2d_nearest:Age,wboit_write:Tge,dpoit_write:Pge},WQe=/^(?!\/\/)\s*#include\s+(\S+)/gm,XQe=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*\+\+i\s*\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g,QQe=/[ \t]*\/\/.*\n/g,ZQe=/[ \t]*\/\*[\s\S]*?\*\//g,qQe=/\n{2,}/g;function Hge(e){return e.replace(WQe,(t,r)=>{let n=jQe[r];if(!n)throw new Error(`empty chunk, '${r}'`);return n}).trim().replace(QQe,`
`).replace(ZQe,`
`).replace(qQe,`
`)}function YQe(e){return e.replace(XQe,KQe)}function KQe(e,t,r,n){let o="";for(let i=parseInt(t);i<parseInt(r);++i)o+=n.replace(/\[\s*i\s*\]/g,`[${i}]`).replace(/UNROLLED_LOOP_INDEX/g,`${i}`);return o}function JQe(e,t){return t.dLightCount&&(e=e.replace(/dLightCount/g,`${t.dLightCount.ref.value}`)),t.dClipObjectCount&&(e=e.replace(/dClipObjectCount/g,`${t.dClipObjectCount.ref.value}`)),e}function jge(e,t){return YQe(JQe(e,t))}function zr(e,t,r,n={},o={},i){return{id:Xge(),name:e,vert:Hge(t),frag:Hge(r),extensions:n,outTypes:o,ignoreDefine:i}}function aR(e,t,r){if(t.startsWith("color")||t==="tracing"){if(e==="dLightCount")return!!r.dIgnoreLight?.ref.value}else{let n=["dColorType","dUsePalette","dOverpaintType","dOverpaint","dSubstanceType","dSubstance","dColorMarker","dCelShaded","dLightCount"];return t!=="depth"&&!t.startsWith("pick")&&n.push("dXrayShaded"),t!=="emissive"&&n.push("dEmissiveType","dEmissive"),n.includes(e)}return!1}function Bk(e,t,r){return e==="dLightCount"?!0:aR(e,t,r)}var Qge=zr("points",_ge,Rge,{drawBuffers:"optional"},{},Bk),Zge=zr("spheres",Dge,wge,{fragDepth:"required",drawBuffers:"optional"},{},aR),qge=zr("cylinders",Mge,Bge,{fragDepth:"required",drawBuffers:"optional"},{},aR),Yge=zr("text",Ege,kge,{drawBuffers:"optional"},{},Bk),Kge=zr("lines",Fge,Lge,{drawBuffers:"optional"},{},Bk),Ek=zr("mesh",Vge,Oge,{drawBuffers:"optional"},{},aR),Jge=zr("direct-volume",Gge,Uge,{fragDepth:"optional",drawBuffers:"optional"},{},aR),$ge=zr("image",Nge,zge,{drawBuffers:"optional"},{},Bk);function Wge(e,t){if(e===void 0)return"";let r=e.dRenderVariant?.ref.value||"",n=[];for(let o in e){if(t?.(o,r,e))continue;let a=e[o].ref.value;a!==void 0&&(typeof a=="string"?n.push(`#define ${o}_${a}`):typeof a=="number"?n.push(`#define ${o} ${a}`):typeof a=="boolean"?a&&n.push(`#define ${o}`):Mr(a))}return n.join(`
`)+`
`}function $Qe(e,t){let r=[];if(t.drawBuffers){if(e.drawBuffers)r.push("#define requiredDrawBuffers");else if(t.drawBuffers==="required")throw new Error("required 'GL_EXT_draw_buffers' extension not available")}if(t.multiDraw){if(e.multiDraw)r.push("#extension GL_ANGLE_multi_draw : require"),r.push("#define enabledMultiDraw");else if(t.multiDraw==="required")throw new Error("required 'GL_ANGLE_multi_draw' extension not available")}return r.join(`
`)+`
`}function eZe(e,t){let r=["#extension GL_OES_standard_derivatives : enable"];if(t.fragDepth){if(e.fragDepth)r.push("#extension GL_EXT_frag_depth : enable"),r.push("#define enabledFragDepth");else if(t.fragDepth==="required")throw new Error("required 'GL_EXT_frag_depth' extension not available")}if(t.drawBuffers){if(e.drawBuffers)r.push("#extension GL_EXT_draw_buffers : require"),r.push("#define requiredDrawBuffers"),r.push("#define gl_FragColor gl_FragData[0]");else if(t.drawBuffers==="required")throw new Error("required 'GL_EXT_draw_buffers' extension not available")}if(t.shaderTextureLod){if(e.shaderTextureLod)r.push("#extension GL_EXT_shader_texture_lod : enable"),r.push("#define enabledShaderTextureLod");else if(t.shaderTextureLod==="required")throw new Error("required 'GL_EXT_shader_texture_lod' extension not available")}return e.depthTexture&&r.push("#define depthTextureSupport"),r.join(`
`)+`
`}var tZe=`
#define attribute in
#define varying out
#define texture2D texture
`,rZe=`
#define varying in
#define texture2D texture
#define textureCube texture
#define texture2DLodEXT textureLod
#define textureCubeLodEXT textureLod

#define gl_FragColor out_FragData0
#define gl_FragDepthEXT gl_FragDepth
`;function nZe(e,t){let r=["#version 300 es"];if(t.drawBuffers&&e.drawBuffers&&r.push("#define requiredDrawBuffers"),t.multiDraw){if(e.multiDraw)r.push("#extension GL_ANGLE_multi_draw : require"),r.push("#define enabledMultiDraw");else if(t.multiDraw==="required")throw new Error("required 'GL_ANGLE_multi_draw' extension not available")}if(t.clipCullDistance){if(e.clipCullDistance)r.push("#extension GL_ANGLE_clip_cull_distance : enable"),r.push("#define enabledClipCullDistance");else if(t.clipCullDistance==="required")throw new Error("required 'GL_ANGLE_clip_cull_distance' extension not available")}if(t.conservativeDepth){if(e.conservativeDepth)r.push("#extension GL_EXT_conservative_depth : enable"),r.push("#define enabledConservativeDepth");else if(t.conservativeDepth==="required")throw new Error("required 'GL_EXT_conservative_depth' extension not available")}if(t.multiview2){if(e.multiview2)r.push("#extension GL_OVR_multiview2 : require"),r.push("#define enabledMultiview2");else if(t.multiview2==="required")throw new Error("required 'GL_OVR_multiview2' extension not available")}return e.noNonInstancedActiveAttribs&&r.push("#define noNonInstancedActiveAttribs"),r.push(tZe),r.join(`
`)+`
`}function oZe(e,t,r,n){let o=["#version 300 es",`layout(location = 0) out highp ${n[0]||"vec4"} out_FragData0;`];if(r.fragDepth&&e.fragDepth&&o.push("#define enabledFragDepth"),r.drawBuffers&&e.drawBuffers){o.push("#define requiredDrawBuffers");for(let i=1,a=t.maxDrawBuffers;i<a;++i)o.push(`layout(location = ${i}) out highp ${n[i]||"vec4"} out_FragData${i};`)}return r.shaderTextureLod&&e.shaderTextureLod&&o.push("#define enabledShaderTextureLod"),e.depthTexture&&o.push("#define depthTextureSupport"),o.push(rZe),o.join(`
`)+`
`}function iZe(e){return e.replace(/gl_FragData\[([0-9]+)\]/g,"out_FragData$1")}function eye(e,t,r,n,o){let i=Wge(n,o.ignoreDefine),a=Wge(n,o.ignoreDefine),s=Ht(e)?nZe(t,o.extensions):$Qe(t,o.extensions),l=Ht(e)?oZe(t,r,o.extensions,o.outTypes):eZe(t,o.extensions),u=Ht(e)?iZe(o.frag):o.frag;return{id:Xge(),name:o.name,vert:`${s}${i}${jge(o.vert,n)}`,frag:`${l}${a}${jge(u,n)}`,extensions:o.extensions,outTypes:o.outTypes}}function nye(e,t){switch(t){case"b":case"b[]":return e.BOOL;case"f":case"f[]":return e.FLOAT;case"i":case"i[]":return e.INT;case"v2":case"v2[]":return e.FLOAT_VEC2;case"v3":case"v3[]":return e.FLOAT_VEC3;case"v4":case"v4[]":return e.FLOAT_VEC4;case"q":case"q[]":return e.FLOAT_VEC4;case"iv2":case"iv2[]":return e.INT_VEC2;case"iv3":case"iv3[]":return e.INT_VEC3;case"iv4":case"iv4[]":return e.INT_VEC4;case"m3":case"m3[]":return e.FLOAT_MAT3;case"m4":case"m4[]":return e.FLOAT_MAT4;default:console.error(`unknown uniform kind '${t}'`)}}function oye(e){return e.endsWith("[]")}function aZe(e,t,r){e.uniform1f(t,r)}function sZe(e,t,r){e.uniform1fv(t,r)}function lZe(e,t,r){e.uniform1i(t,r)}function uZe(e,t,r){e.uniform1iv(t,r)}function cZe(e,t,r){e.uniform2fv(t,r)}function mZe(e,t,r){e.uniform3fv(t,r)}function tye(e,t,r){e.uniform4fv(t,r)}function dZe(e,t,r){e.uniform2iv(t,r)}function pZe(e,t,r){e.uniform3iv(t,r)}function fZe(e,t,r){e.uniform4iv(t,r)}function hZe(e,t,r){e.uniformMatrix3fv(t,!1,r)}function gZe(e,t,r){e.uniformMatrix4fv(t,!1,r)}function rye(e){switch(e){case"f":return aZe;case"f[]":return sZe;case"i":case"t":case"b":return lZe;case"i[]":case"t[]":case"b[]":return uZe;case"v2":case"v2[]":return cZe;case"v3":case"v3[]":return mZe;case"v4":case"v4[]":return tye;case"q":case"q[]":return tye;case"iv2":case"iv2[]":return dZe;case"iv3":case"iv3[]":return pZe;case"iv4":case"iv4[]":return fZe;case"m3":case"m3[]":return hZe;case"m4":case"m4[]":return gZe}}function iye(e){let t={};return Object.keys(e).forEach(r=>{let n=e[r];n.type==="uniform"?t[r]=rye(n.kind):n.type==="texture"&&(t[r]=rye("t"))}),t}function aye(e){let t={};return Object.keys(e).forEach(r=>{t[r]=_.create(Wo(e[r].ref.value))}),t}var sye=gi();function yZe(e,t){switch(t){case"static":return e.STATIC_DRAW;case"dynamic":return e.DYNAMIC_DRAW;case"stream":return e.STREAM_DRAW;default:Mr(t)}}function bZe(e,t){if(t instanceof Uint8Array)return e.UNSIGNED_BYTE;if(t instanceof Int8Array)return e.BYTE;if(t instanceof Uint16Array)return e.UNSIGNED_SHORT;if(t instanceof Int16Array)return e.SHORT;if(t instanceof Uint32Array)return e.UNSIGNED_INT;if(t instanceof Int32Array)return e.INT;if(t instanceof Float32Array)return e.FLOAT;Mr(t)}function xZe(e,t){switch(t){case"attribute":return e.ARRAY_BUFFER;case"elements":return e.ELEMENT_ARRAY_BUFFER;case"uniform":if(Ht(e))return e.UNIFORM_BUFFER;throw new Error("WebGL2 is required for uniform buffers");case"pixel-pack":if(Ht(e))return e.PIXEL_PACK_BUFFER;throw new Error("WebGL2 is required for pixel-pack buffers")}}function kk(e){let t=e.createBuffer();if(t===null)throw new Error("Could not create WebGL buffer");return t}function lye(e,t,r,n){let o=kk(e),i=yZe(e,r),a=xZe(e,n),s=bZe(e,t),l=t.BYTES_PER_ELEMENT,u=t.length;function c(d){e.bindBuffer(a,o),e.bufferData(a,d,i)}c(t);let m=!1;return{id:sye(),_usageHint:i,_bufferType:a,_dataType:s,_bpe:l,length:u,getByteCount:()=>l*u,getBuffer:()=>o,updateData:c,updateSubData:(d,p,h)=>{e.bindBuffer(a,o),h-p===d.length?e.bufferSubData(a,0,d):e.bufferSubData(a,p*l,d.subarray(p,p+h))},reset:()=>{o=kk(e),c(t)},destroy:()=>{m||(e.deleteBuffer(o),m=!0)}}}function uye(e,t,r){switch(t){case"float32":switch(r){case 1:return e.FLOAT;case 2:return e.FLOAT_VEC2;case 3:return e.FLOAT_VEC3;case 4:return e.FLOAT_VEC4;case 16:return e.FLOAT_MAT4}default:Mr(t)}}function cye(e,t,r,n,o,i,a="static"){let{instancedArrays:s}=r,l=lye(e,n,a,"attribute"),{_bufferType:u,_dataType:c,_bpe:m}=l;return{...l,divisor:i,bind:d=>{if(e.bindBuffer(u,l.getBuffer()),o===16)for(let p=0;p<4;++p)t.enableVertexAttrib(d+p),e.vertexAttribPointer(d+p,4,c,!1,16*m,p*4*m),s.vertexAttribDivisor(d+p,i);else t.enableVertexAttrib(d),e.vertexAttribPointer(d,o,c,!1,0,0),s.vertexAttribDivisor(d,i)},changeOffset:(d,p)=>{let h=p*m*o;if(e.bindBuffer(u,l.getBuffer()),o===16)for(let f=0;f<4;++f)e.vertexAttribPointer(d+f,4,c,!1,16*m,f*4*m+h);else e.vertexAttribPointer(d,o,c,!1,0,h)}}}function mye(e,t,r){let n=[];return Object.keys(t).forEach(o=>{let i=t[o];i.type==="attribute"&&(n[n.length]=[o,e.resources.attribute(r[o].ref.value,i.itemSize,i.divisor)])}),n}function dye(e,t,r="static"){let n=lye(e,t,r,"elements");return{...n,bind:()=>{e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n.getBuffer())}}}function pye(e,t,r,n){let o=kk(e),i=d7(e,t,n),a=Fk(e,r,n),s=m7(r,n),l=0,u=0;function c(p,h,f,g){l=f,u=g,e.bindBuffer(e.PIXEL_PACK_BUFFER,o),e.bufferData(e.PIXEL_PACK_BUFFER,f*g*s,e.STREAM_READ),e.readPixels(p,h,f,g,a,i,0),e.bindBuffer(e.PIXEL_PACK_BUFFER,null)}function m(p){e.bindBuffer(e.PIXEL_PACK_BUFFER,o),e.getBufferSubData(e.PIXEL_PACK_BUFFER,0,p),e.bindBuffer(e.PIXEL_PACK_BUFFER,null)}let d=!1;return{id:sye(),_type:i,_format:a,_bpe:s,getByteCount:()=>s*l*u,read:c,getSubData:m,reset:()=>{o=kk(e)},destroy:()=>{d||(e.deleteBuffer(o),d=!0)}}}var CZe=gi();function SZe(e,t,r){let n={};return Object.keys(r).forEach(o=>{let i=r[o];if(i.type==="attribute"){let a=e.getAttribLocation(t,o);n[o]=a}else if(i.type==="uniform"){let a=e.getUniformLocation(t,o);a===null&&oye(i.kind)&&(a=e.getUniformLocation(t,o+"[0]")),n[o]=a}else if(i.type==="texture"){let a=e.getUniformLocation(t,o);n[o]=a}}),n}function vZe(e,t,r){let n=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES);for(let o=0;o<n;++o){let i=e.getActiveAttrib(t,o);if(i){let{name:a,type:s}=i;if(a.startsWith("__activeAttribute")||a==="gl_InstanceID"||a==="gl_VertexID"||a==="gl_DrawID"||a==="gl_ViewID_OVR")continue;let l=r[a];if(l===void 0)throw new Error(`missing 'uniform' or 'texture' with name '${a}' in schema`);if(l.type!=="attribute")throw new Error(`'${a}' must be of type 'attribute' but is '${l.type}'`);let u=uye(e,l.kind,l.itemSize);if(u!==s)throw new Error(`unexpected attribute type '${u}' for ${a}, expected '${s}'`)}}}function IZe(e,t,r){let n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let o=0;o<n;++o){let i=e.getActiveUniform(t,o);if(i){let{name:a,type:s}=i;if(a.startsWith("__activeUniform")||a==="gl_InstanceID"||a==="gl_VertexID"||a==="gl_DrawID"||a==="gl_ViewID_OVR")continue;let l=a.replace(/[[0-9]+\]$/,""),u=r[l];if(u===void 0)throw new Error(`missing 'uniform' or 'texture' with name '${a}' in schema`);if(u.type==="uniform"){if(nye(e,u.kind)!==s)throw new Error(`unexpected uniform type for ${a}`)}else if(u.type==="texture"){if(u.kind==="image-float32"||u.kind==="image-uint8"){if(s!==e.SAMPLER_2D)throw new Error(`unexpected sampler type for '${a}'`)}else if(u.kind==="volume-float32"||u.kind==="volume-uint8")if(Ht(e)){if(s!==e.SAMPLER_3D)throw new Error(`unexpected sampler type for '${a}'`)}else throw new Error("WebGL2 is required to use SAMPLER_3D")}else throw new Error(`'${a}' must be of type 'uniform' or 'texture' but is '${u.type}'`)}}}function AZe(e,t){if(!e.getProgramParameter(t,e.LINK_STATUS))throw new Error(`Could not compile WebGL program. 

${e.getProgramInfoLog(t)}`)}function Lk(e){let t=e.createProgram();if(t===null)throw new Error("Could not create WebGL program");return t}function TZe(e){if(typeof e!="string")throw new Error(`unknown program variant: ${e}`);return e.startsWith("color")?"color":e.startsWith("pick")?"pick":e}function fye(e,t,r,n,o,i){let{defineValues:a,shaderCode:s,schema:l}=i,u=Lk(e),c=CZe(),m=TZe(a.dRenderVariant.ref.value),d=eye(e,r,n,a,s),p=o("vert",d.vert),h=o("frag",d.frag),f,g,y=!1,x=!1,S=!1;function I(){p.attach(u),h.attach(u),e.linkProgram(u),Yt&&AZe(e,u),y=!0}m==="compute"&&I();function v(){f=SZe(e,u,l),g=iye(l),Yt&&(vZe(e,u,l),IZe(e,u,l)),x=!0}return{id:c,variant:m,isReady:()=>x,link:()=>{y||I()},finalize(A){return y||I(),!x&&(A||!r.parallelShaderCompile||e.getProgramParameter(u,r.parallelShaderCompile.COMPLETION_STATUS))&&v(),x},use:()=>{if(Yt&&!x)throw new Error(`program not finalized: ${m}`);t.currentProgramId=c,e.useProgram(u)},setUniforms:A=>{for(let P=0,T=A.length;P<T;++P){let[R,w]=A[P];if(w){let E=f[R];E!==null&&g[R](e,E,w.ref.value)}}},uniform:(A,P)=>{let T=f[A];T!==null&&g[A](e,T,P)},bindAttributes:A=>{t.clearVertexAttribsState();for(let P=0,T=A.length;P<T;++P){let[R,w]=A[P],E=f[R];E!==-1&&w.bind(E)}t.disableUnusedVertexAttribs()},offsetAttributes:(A,P)=>{for(let T=0,R=A.length;T<R;++T){let[w,E]=A[T],M=f[w];M!==-1&&E.changeOffset(M,P)}},bindTextures:(A,P)=>{for(let T=0,R=A.length;T<R;++T){let[w,E]=A[T],M=f[w];M!=null&&(E.bind(T+P),g[w](e,M,T+P))}},reset:()=>{u=Lk(e),y&&I(),x&&v()},destroy:()=>{S||(p.destroy(),h.destroy(),e.deleteProgram(u),S=!0)}}}var PZe=gi();function _Ze(e){let t=e.split(`
`);for(let r=0;r<t.length;++r)t[r]=r+1+": "+t[r];return t.join(`
`)}function sR(e,t){let{type:r,source:n}=t,o=e.createShader(r==="vert"?e.VERTEX_SHADER:e.FRAGMENT_SHADER);if(o===null)throw new Error(`Error creating ${r} shader`);if(e.shaderSource(o,n),e.compileShader(o),Yt&&e.getShaderParameter(o,e.COMPILE_STATUS)===!1)throw console.warn(`'${r}' shader info log '${e.getShaderInfoLog(o)}'
${_Ze(n)}`),new Error(`Error compiling ${r} shader`);return o}function hye(e,t){let r=sR(e,t);return{id:PZe(),attach:n=>{e.attachShader(n,r)},reset:()=>{r=sR(e,t)},destroy:()=>{e.deleteShader(r)}}}function RZe(e,t=0){return{value:e,usageCount:t}}function DZe(e){return{free:()=>{e.usageCount-=1},value:e.value}}function p7(e,t,r){let n=new Map,o=[];return{get:i=>{let a=e(i),s=n.get(a);return s||(s=RZe(t(i)),n.set(a,s),o.push(s.value)),s.usageCount+=1,DZe(s)},clear:()=>{n.forEach((i,a)=>{i.usageCount<=0&&(i.usageCount<0&&console.warn("Reference usageCount below zero."),r(i.value),n.delete(a),Sf(o,i.value))})},get count(){return n.size},values:o,dispose:()=>{n.forEach(i=>r(i.value)),n.clear(),o.length=0}}}var wZe=gi();function MZe(e,t){switch(t){case"depth16":return e.DEPTH_COMPONENT16;case"stencil8":return e.STENCIL_INDEX8;case"rgba4":return e.RGBA4;case"depth-stencil":return e.DEPTH_STENCIL;case"depth24":if(Ht(e))return e.DEPTH_COMPONENT24;throw new Error("WebGL2 needed for `depth24` renderbuffer format");case"depth32f":if(Ht(e))return e.DEPTH_COMPONENT32F;throw new Error("WebGL2 needed for `depth32f` renderbuffer format");case"depth24-stencil8":if(Ht(e))return e.DEPTH24_STENCIL8;throw new Error("WebGL2 needed for `depth24-stencil8` renderbuffer format");case"depth32f-stencil8":if(Ht(e))return e.DEPTH32F_STENCIL8;throw new Error("WebGL2 needed for `depth32f-stencil8` renderbuffer format")}}function BZe(e){switch(e){case"depth16":return 4;case"stencil8":return 2;case"rgba4":return 4;case"depth-stencil":return 4;case"depth24":return 3;case"depth32f":return 4;case"depth24-stencil8":return 4;case"depth32f-stencil8":return 5}}function EZe(e,t){switch(t){case"depth":return e.DEPTH_ATTACHMENT;case"stencil":return e.STENCIL_ATTACHMENT;case"depth-stencil":return e.DEPTH_STENCIL_ATTACHMENT;case"color0":return e.COLOR_ATTACHMENT0}}function gye(e){let t=e.createRenderbuffer();if(t===null)throw new Error("Could not create WebGL renderbuffer");return t}function yye(e,t,r,n,o){let i=gye(e),a=()=>e.bindRenderbuffer(e.RENDERBUFFER,i),s=MZe(e,t),l=EZe(e,r);function u(){a(),e.renderbufferStorage(e.RENDERBUFFER,s,n,o)}u();let c=!1;return{id:wZe(),getByteCount:()=>BZe(t)*n*o,bind:a,attachFramebuffer:m=>{m.bind(),a(),e.framebufferRenderbuffer(e.FRAMEBUFFER,l,e.RENDERBUFFER,i),Yt&&eA(e)},detachFramebuffer:m=>{m.bind(),a(),e.framebufferRenderbuffer(e.FRAMEBUFFER,l,e.RENDERBUFFER,null),Yt&&eA(e)},setSize:(m,d)=>{n=m,o=d,u()},reset:()=>{i=gye(e),u()},destroy:()=>{c||(e.deleteRenderbuffer(i),c=!0)}}}var kZe=gi();function bye(e){let{vertexArrayObject:t}=e;if(!t)throw new Error("VertexArrayObject not supported");let r=t.createVertexArray();if(!r)throw new Error("Could not create WebGL vertex array");return r}function xye(e){let{vertexArrayObject:t}=e;if(t===null)throw new Error("VertexArrayObject not supported");return t}function Cye(e,t,r,n,o){let i=kZe(),a=bye(t),s=xye(t);function l(){s.bindVertexArray(a),o&&o.bind(),r.bindAttributes(n),s.bindVertexArray(null),u=!0}let u=!1,c=!1;return{id:i,bind:()=>{u||l(),s.bindVertexArray(a)},update:l,reset:()=>{a=bye(t),s=xye(t),u=!1},destroy:()=>{c||(o&&(s.bindVertexArray(a),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)),s.deleteVertexArray(a),c=!0)}}}function FZe(e){return typeof e=="boolean"?e?1:0:typeof e=="number"?e*1e4:q0(e)}function Sye(e){return{...e.value,destroy:()=>{e.free()}}}function vye(e,t,r,n,o){let i={attribute:new Set,elements:new Set,pixelPack:new Set,framebuffer:new Set,program:new Set,renderbuffer:new Set,shader:new Set,texture:new Set,cubeTexture:new Set,vertexArray:new Set};function a(m,d){return i[m].add(d),r.resourceCounts[m]+=1,{...d,destroy:()=>{d.destroy(),i[m].delete(d),r.resourceCounts[m]-=1}}}let s=p7(m=>JSON.stringify(m),m=>a("shader",hye(e,m)),m=>{m.destroy()});function l(m,d){return Sye(s.get({type:m,source:d}))}let u=new Set,c=p7(m=>{let d=[m.shaderCode.id],p=m.defineValues.dRenderVariant?.ref.value||"";return Object.keys(m.defineValues).forEach(h=>{m.shaderCode.ignoreDefine?.(h,p,m.defineValues)||d.push(q0(h),FZe(m.defineValues[h].ref.value))}),ui(d).toString()},m=>{let d=fye(e,t,n,o,l,m);return d.variant!=="compute"&&u.add(d),a("program",d)},m=>{u.delete(m),m.destroy()});return{attribute:(m,d,p,h)=>a("attribute",cye(e,t,n,m,d,p,h)),elements:(m,d)=>a("elements",dye(e,m,d)),pixelPack:(m,d)=>{if(!Ht(e))throw new Error("WebGL2 is required for pixel-pack buffers");return a("pixelPack",pye(e,n,m,d))},framebuffer:()=>a("framebuffer",che(e)),program:(m,d,p)=>Sye(c.get({defineValues:m,shaderCode:d,schema:p})),renderbuffer:(m,d,p,h)=>a("renderbuffer",yye(e,m,d,p,h)),shader:l,texture:(m,d,p,h)=>a("texture",Iye(e,n,m,d,p,h)),cubeTexture:(m,d,p)=>a("cubeTexture",Aye(e,m,d,p)),vertexArray:(m,d,p)=>a("vertexArray",Cye(e,n,m,d,p)),getByteCounts:()=>{let m=0;i.texture.forEach(y=>{m+=y.getByteCount()});let d=0;i.cubeTexture.forEach(y=>{d+=y.getByteCount()});let p=0;i.attribute.forEach(y=>{p+=y.getByteCount()});let h=0;i.elements.forEach(y=>{h+=y.getByteCount()});let f=0;i.pixelPack.forEach(y=>{f+=y.getByteCount()});let g=0;return i.renderbuffer.forEach(y=>{g+=y.getByteCount()}),{texture:m,cubeTexture:d,attribute:p,elements:h,pixelPack:f,renderbuffer:g}},linkPrograms:m=>{for(let d of u)m&&!m.includes(d.variant)||d.link()},finalizePrograms:(m,d)=>{let p=!0,h=0;for(let x of u)x.isReady()&&u.delete(x),(!m||m.includes(x.variant))&&(p=!1,h+=1);if(p)return!0;let f=!0,g=0,y=En();for(let x of u)if(!(m&&!m.includes(x.variant))&&(x.finalize(d)?(u.delete(x),g+=1):f=!1,!d&&En()-y>16)){f=!1;break}return je&&console.log(`Finalized ${g} of ${h} programs (${m?m.join(", "):"all"}) in ${(En()-y).toFixed(2)} ms`),f},reset:()=>{i.attribute.forEach(m=>m.reset()),i.elements.forEach(m=>m.reset()),i.pixelPack.forEach(m=>m.reset()),i.framebuffer.forEach(m=>m.reset()),i.renderbuffer.forEach(m=>m.reset()),i.shader.forEach(m=>m.reset()),i.program.forEach(m=>m.reset()),i.vertexArray.forEach(m=>m.reset()),i.texture.forEach(m=>m.reset()),i.cubeTexture.forEach(m=>m.reset())},destroy:()=>{i.attribute.forEach(m=>m.destroy()),i.elements.forEach(m=>m.destroy()),i.pixelPack.forEach(m=>m.destroy()),i.framebuffer.forEach(m=>m.destroy()),i.renderbuffer.forEach(m=>m.destroy()),i.shader.forEach(m=>m.destroy()),i.program.forEach(m=>m.destroy()),i.vertexArray.forEach(m=>m.destroy()),i.texture.forEach(m=>m.destroy()),i.cubeTexture.forEach(m=>m.destroy()),s.clear(),c.clear(),u.clear()}}}var LZe=gi();function Tye(e,t,r,n,o=!0,i="uint8",a="nearest",s="rgba"){if(s==="alpha"&&!Ht(e))throw new Error("cannot render to alpha format in webgl1");let l=t.framebuffer(),u=i==="fp16"?t.texture("image-float16",s,"fp16",a):i==="float32"?t.texture("image-float32",s,"float",a):t.texture("image-uint8",s,"ubyte",a),c=o?Ht(e)?t.renderbuffer("depth32f","depth",r,n):t.renderbuffer("depth16","depth",r,n):null;function m(){u.define(r,n),u.attachFramebuffer(l,"color0"),c&&c.attachFramebuffer(l)}m();let d=!1;return{id:LZe(),texture:u,framebuffer:l,depthRenderbuffer:c,getByteCount:()=>u.getByteCount()+(c?c.getByteCount():0),getWidth:()=>r,getHeight:()=>n,bind:()=>{l.bind()},setSize:(p,h)=>{r===p&&n===h||(r=p,n=h,u.define(r,n),c&&c.setSize(r,n))},reset:()=>{m()},destroy:()=>{d||(u.destroy(),l.destroy(),c&&c.destroy(),d=!0)}}}function VZe(e,t,r){return e-=e/r,e+=t/r,e}var Vk=class{constructor(t){this.count=t;this.avgs=new Map}add(t,r){let n=this.avgs.get(t)||r;return n=VZe(n,r,this.count),this.avgs.set(t,n),n}get(t){return this.avgs.get(t)}stats(){return Object.fromEntries(this.avgs.entries())}clear(){this.avgs.clear()}};function OZe(e){e.calls.drawInstanced=0,e.calls.drawInstancedBase=0,e.calls.multiDrawInstancedBase=0,e.calls.counts=0,e.culled.lod=0,e.culled.frustum=0,e.culled.occlusion=0}function GZe(e){return e.disjointTimerQuery?e.disjointTimerQuery.createQuery():null}function Pye(e,t,r,n){let o=t.disjointTimerQuery,i=n?.avgCount??30,a=new Map,s=new Map,l=[],u=new Vk(i),c=new Vk(i),m=[],d=null,p=!1,h=()=>{s.clear(),l.length=0,u.clear(),c.clear(),m=[],d=null,p=!1,o&&a.forEach((g,y)=>{o.deleteQuery(y)}),a.clear()},f=()=>{if(!o)return;let g=GZe(t);g&&(o.beginQuery(o.TIME_ELAPSED,g),s.forEach((y,x)=>{y.queries.push(g)}),a.set(g,{refCount:s.size}),d=g)};return{resolve:()=>{let g=[];if(!o||!m.length||p)return g;a.forEach((x,S)=>{if(x.timeElapsed!==void 0)return;let I=o.getQueryParameter(S,o.QUERY_RESULT_AVAILABLE),v=e.getParameter(o.GPU_DISJOINT);if(I&&!v){let A=o.getQueryParameter(S,o.QUERY_RESULT);x.timeElapsed=A}(I||v)&&o.deleteQuery(S)});let y=[];for(let x of m)if(x.queries.every(S=>a.get(S)?.timeElapsed!==void 0)){let S=0;for(let I of x.queries){let v=a.get(I);S+=v.timeElapsed,v.refCount-=1}if(x.timeElapsed=S,x.root){let I=[],v=(P,T)=>{for(let R of P){let w=R.timeElapsed,E=R.cpu.end-R.cpu.start,M={label:R.label,gpuElapsed:w,gpuAvg:u.add(R.label,w),cpuElapsed:E,cpuAvg:c.add(R.label,E),children:[],calls:R.calls,note:R.note};T.push(M),v(R.children,M.children)}};v(x.children,I);let A=x.cpu.end-x.cpu.start;g.push({label:x.label,gpuElapsed:S,gpuAvg:u.add(x.label,S),cpuElapsed:A,cpuAvg:c.add(x.label,A),children:I,calls:x.calls,note:x.note})}}else y.push(x);return m=y,a.forEach((x,S)=>{x.refCount===0&&a.delete(S)}),g},mark:(g,y)=>{if(!o)return;if(s.has(g))throw new Error(`Timer mark for '${g}' already exists`);let x=y?.captureStats??!1;d!==null&&o.endQuery(o.TIME_ELAPSED);let S={label:g,queries:[],children:[],root:d===null,cpu:{start:En(),end:-1},captureStats:x};if(y?.note&&(S.note=y.note),s.set(g,S),l.length&&l[l.length-1].children.push(S),l.push(S),x){if(p)throw new Error("Already capturing stats");OZe(r),p=!0}f()},markEnd:g=>{if(!o)return;let y=s.get(g);if(!y)throw new Error(`Timer mark for '${g}' does not exist`);if(l.pop()?.label!==g)throw new Error(`Timer mark for '${g}' has pending nested mark`);o.endQuery(o.TIME_ELAPSED),s.delete(g),y.cpu.end=En(),y.captureStats&&(y.calls={...r.calls},p=!1),m.push(y),s.size>0?f():d=null},stats:()=>({gpu:u.stats(),cpu:c.stats()}),formatedStats:()=>{let g={},y=u.stats(),x=c.stats();for(let S of Object.keys(y)){let I=`${(y[S]/1e3/1e3).toFixed(2)}`,v=`${x[S].toFixed(2)}`;g[S]=`${I} ms | CPU: ${v} ms`}return g},clear:h,destroy:()=>{h()}}}function UZe(e){let t=`${(e.gpuElapsed/1e3/1e3).toFixed(2)}`,r=`${(e.gpuAvg/1e3/1e3).toFixed(2)}`,n=`${e.cpuElapsed.toFixed(2)}`,o=`${e.cpuAvg.toFixed(2)}`;return`${e.label} ${t} ms (avg. ${r} ms) | CPU: ${n} ms (avg. ${o} ms)`}function lR(e){e.map(t=>{let r=UZe(t);t.children.length||t.calls||t.note?(console.groupCollapsed(r),t.calls&&console.log(t.calls),t.note&&console.log(t.note),lR(t.children),console.groupEnd()):console.log(r)})}function Dye(e,t){function r(o){try{return e.getContext(o,t)}catch{return null}}let n=(t?.preferWebGl1?null:r("webgl2"))||r("webgl")||r("experimental-webgl");return Yt&&console.log(`isWebgl2: ${Ht(n)}`),n}function h7(e,t){switch(t){case e.NO_ERROR:return"no error";case e.INVALID_ENUM:return"invalid enum";case e.INVALID_VALUE:return"invalid value";case e.INVALID_OPERATION:return"invalid operation";case e.INVALID_FRAMEBUFFER_OPERATION:return"invalid framebuffer operation";case e.OUT_OF_MEMORY:return"out of memory";case e.CONTEXT_LOST_WEBGL:return"context lost"}return"unknown error"}function wye(e,t){let r=e.getError();r!==e.NO_ERROR&&console.log(`WebGL error: '${h7(e,r)}'${t?` (${t})`:""}`)}function NZe(e){let t=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS);for(let o=0;o<t;++o)e.activeTexture(e.TEXTURE0+o),e.bindTexture(e.TEXTURE_2D,null),e.bindTexture(e.TEXTURE_CUBE_MAP,null),Ht(e)&&(e.bindTexture(e.TEXTURE_2D_ARRAY,null),e.bindTexture(e.TEXTURE_3D,null));let r=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,r);let n=e.getParameter(e.MAX_VERTEX_ATTRIBS);for(let o=0;o<n;++o)e.vertexAttribPointer(o,1,e.FLOAT,!1,0,0);e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),e.bindRenderbuffer(e.RENDERBUFFER,null),e.bindFramebuffer(e.FRAMEBUFFER,null),Ht(e)&&(e.bindBuffer(e.UNIFORM_BUFFER,null),e.bindBuffer(e.PIXEL_PACK_BUFFER,null))}var Mye=new Uint8Array(4);function Bye(e,t,r){e.getSyncParameter(t,e.SYNC_STATUS)===e.SIGNALED?(e.deleteSync(t),r()):Vf.setImmediate(Bye,e,t,r)}function zZe(e,t){let r=e.fenceSync(e.SYNC_GPU_COMMANDS_COMPLETE,0);r?Vf.setImmediate(Bye,e,r,t):(console.warn("Could not create a WebGLSync object"),e.readPixels(0,0,1,1,e.RGBA,e.UNSIGNED_BYTE,Mye),t())}var _ye=!1;function HZe(e){return new Promise(t=>{Ht(e)?zZe(e,t):(_ye||(console.info("Sync object not supported in WebGL"),_ye=!0),Eye(e),t())})}function Eye(e){e.bindFramebuffer(e.FRAMEBUFFER,null),e.readPixels(0,0,1,1,e.RGBA,e.UNSIGNED_BYTE,Mye)}function jZe(e,t,r,n,o,i){if(Yt&&eA(e),i instanceof Uint8Array)e.readPixels(t,r,n,o,e.RGBA,e.UNSIGNED_BYTE,i);else if(i instanceof Float32Array)e.readPixels(t,r,n,o,e.RGBA,e.FLOAT,i);else if(i instanceof Int32Array&&Ht(e))e.readPixels(t,r,n,o,e.RGBA_INTEGER,e.INT,i);else throw new Error("unsupported readPixels buffer type");Yt&&wye(e)}function f7(e,t){t?e.bindFramebuffer(e.FRAMEBUFFER,t.framebuffer):e.bindFramebuffer(e.FRAMEBUFFER,null)}function Ok(e,t,r){let n=t?.framebufferWidth??e.drawingBufferWidth;r==="screen-space"&&(n*=2);let o=t?.framebufferHeight??e.drawingBufferHeight;return{width:n,height:o}}function tA(e,t,r,n){let o=t==="vertex"?e.VERTEX_SHADER:e.FRAGMENT_SHADER,i=e[`${r.toUpperCase()}_${n.toUpperCase()}`];return e.getShaderPrecisionFormat(o,i)}function Rye(e,t){return{lowFloat:tA(e,t,"low","float"),mediumFloat:tA(e,t,"medium","float"),highFloat:tA(e,t,"high","float"),lowInt:tA(e,t,"low","int"),mediumInt:tA(e,t,"medium","int"),highInt:tA(e,t,"high","int")}}function WZe(){return{resourceCounts:{attribute:0,elements:0,pixelPack:0,framebuffer:0,program:0,renderbuffer:0,shader:0,texture:0,cubeTexture:0,vertexArray:0},drawCount:0,instanceCount:0,instancedDrawCount:0,calls:{drawInstanced:0,drawInstancedBase:0,multiDrawInstancedBase:0,counts:0},culled:{lod:0,frustum:0,occlusion:0}}}function XZe(e,t){return{maxTextureSize:e.getParameter(e.MAX_TEXTURE_SIZE),max3dTextureSize:Ht(e)?e.getParameter(e.MAX_3D_TEXTURE_SIZE):0,maxRenderbufferSize:e.getParameter(e.MAX_RENDERBUFFER_SIZE),maxDrawBuffers:t.drawBuffers?e.getParameter(t.drawBuffers.MAX_DRAW_BUFFERS):0,maxTextureImageUnits:e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),maxVertexTextureImageUnits:e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS)}}function kye(e,t={}){let r=c7(e),n=Qhe(e,r),o=WZe(),i=XZe(e,r),a=vye(e,n,o,r,i),s=Pye(e,r,o);if(i.maxVertexTextureImageUnits<8)throw new Error('Need "MAX_VERTEX_TEXTURE_IMAGE_UNITS" >= 8');let l={vertex:Rye(e,"vertex"),fragment:Rye(e,"fragment")};Yt&&console.log({parameters:i,shaderPrecisionFormats:l});let u=r.provokingVertex;u?.provokingVertex(u.FIRST_VERTEX_CONVENTION);let c=!1,m=new Pn,d=t.pixelScale||1,p={session:void 0,layer:void 0,changed:new Pn,clear:()=>{p.layer=void 0,p.session=void 0,p.changed.next()}},h=new Set;return{gl:e,isWebGL2:Ht(e),get pixelRatio(){return(typeof window<"u"&&window.devicePixelRatio||1)*(d||1)},extensions:r,state:n,stats:o,resources:a,timer:s,get maxTextureSize(){return i.maxTextureSize},get max3dTextureSize(){return i.max3dTextureSize},get maxRenderbufferSize(){return i.maxRenderbufferSize},get maxDrawBuffers(){return i.maxDrawBuffers},get maxTextureImageUnits(){return i.maxTextureImageUnits},get shaderPrecisionFormats(){return l},namedComputeRenderables:Object.create(null),namedFramebuffers:Object.create(null),namedTextures:Object.create(null),get isContextLost(){return c||e.isContextLost()},contextRestored:m,setContextLost:()=>{c=!0,s.clear()},handleContextRestored:f=>{dhe(e,r),n.reset(),n.currentMaterialId=-1,n.currentProgramId=-1,n.currentRenderItemId=-1,a.reset(),h.forEach(g=>g.reset()),f?.(),c=!1,m.next(En())},xr:{get session(){return p.session},changed:p.changed,set:async(f,g)=>{if(p.session!==f&&(await p.session?.end(),f!==void 0))try{await e.makeXRCompatible(),p.session=f,p.layer=new XRWebGLLayer(p.session,e,{antialias:!0,alpha:!0,depth:!0,framebufferScaleFactor:d*(g?.resolutionScale??1)}),await p.session.updateRenderState({baseLayer:p.layer}),p.session.addEventListener("end",p.clear),p.changed.next()}catch(y){throw f?await f.end():(p.layer=void 0,p.session=void 0),y}},end:async()=>p.session?.end()},setPixelScale:f=>{d=f},createRenderTarget:(f,g,y,x,S,I)=>{let v=Tye(e,a,f,g,y,x,S,I);return h.add(v),{...v,destroy:()=>{v.destroy(),h.delete(v)}}},createDrawTarget:()=>({id:-1,texture:qo(e),framebuffer:mhe(),depthRenderbuffer:null,getByteCount:()=>0,getWidth:()=>Ok(e,p.layer,p.session?.interactionMode).width,getHeight:()=>Ok(e,p.layer,p.session?.interactionMode).height,bind:()=>{f7(e,p.layer)},setSize:()=>{},reset:()=>{},destroy:()=>{}}),bindDrawingBuffer:()=>f7(e,p.layer),getDrawingBufferSize:()=>Ok(e,p.layer,p.session?.interactionMode),readPixels:(f,g,y,x,S)=>{jZe(e,f,g,y,x,S)},waitForGpuCommandsComplete:()=>HZe(e),waitForGpuCommandsCompleteSync:()=>Eye(e),getFenceSync:()=>Ht(e)?e.fenceSync(e.SYNC_GPU_COMMANDS_COMPLETE,0):null,checkSyncStatus:f=>Ht(e)?e.getSyncParameter(f,e.SYNC_STATUS)===e.SIGNALED?(e.deleteSync(f),!0):!1:!0,deleteSync:f=>{Ht(e)&&e.deleteSync(f)},clear:(f,g,y,x)=>{let S=Ok(e,p.layer);f7(e,p.layer),n.enable(e.SCISSOR_TEST),n.depthMask(!0),n.colorMask(!0,!0,!0,!0),n.clearColor(f,g,y,x),n.viewport(0,0,S.width,S.height),n.scissor(0,0,S.width,S.height),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT)},checkError:f=>{wye(e,f)},checkFramebufferStatus:f=>{eA(e,f)},destroy:f=>{a.destroy(),NZe(e),p.session?.removeEventListener("end",p.clear),p.session?.end(),m.complete(),p.changed.complete(),f?.doNotForceWebGLContextLoss||(e.getExtension("WEBGL_lose_context")?.loseContext(),e.getExtension("STACKGL_destroy_context")?.destroy())}}}function Ht(e){return typeof WebGL2RenderingContext<"u"&&e instanceof WebGL2RenderingContext}function phe(e){if(Ht(e))return{drawArraysInstanced:e.drawArraysInstanced.bind(e),drawElementsInstanced:e.drawElementsInstanced.bind(e),vertexAttribDivisor:e.vertexAttribDivisor.bind(e),VERTEX_ATTRIB_ARRAY_DIVISOR:e.VERTEX_ATTRIB_ARRAY_DIVISOR};{let t=e.getExtension("ANGLE_instanced_arrays");return t===null?null:{drawArraysInstanced:t.drawArraysInstancedANGLE.bind(t),drawElementsInstanced:t.drawElementsInstancedANGLE.bind(t),vertexAttribDivisor:t.vertexAttribDivisorANGLE.bind(t),VERTEX_ATTRIB_ARRAY_DIVISOR:t.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE}}}function fhe(e){if(Ht(e))return{FRAGMENT_SHADER_DERIVATIVE_HINT:e.FRAGMENT_SHADER_DERIVATIVE_HINT};{let t=e.getExtension("OES_standard_derivatives");return t===null?null:{FRAGMENT_SHADER_DERIVATIVE_HINT:t.FRAGMENT_SHADER_DERIVATIVE_HINT_OES}}}function hhe(e){return Ht(e)?{}:e.getExtension("OES_element_index_uint")}function ghe(e){if(Ht(e))return{VERTEX_ARRAY_BINDING:e.VERTEX_ARRAY_BINDING,bindVertexArray:e.bindVertexArray.bind(e),createVertexArray:e.createVertexArray.bind(e),deleteVertexArray:e.deleteVertexArray.bind(e),isVertexArray:e.isVertexArray.bind(e)};{let t=e.getExtension("OES_vertex_array_object");return t===null?null:{VERTEX_ARRAY_BINDING:t.VERTEX_ARRAY_BINDING_OES,bindVertexArray:t.bindVertexArrayOES.bind(t),createVertexArray:t.createVertexArrayOES.bind(t),deleteVertexArray:t.deleteVertexArrayOES.bind(t),isVertexArray:t.isVertexArrayOES.bind(t)}}}function yhe(e){return Ht(e)?{}:e.getExtension("OES_texture_float")}function bhe(e){return e.getExtension("OES_texture_float_linear")}function xhe(e){if(Ht(e))return{HALF_FLOAT:e.HALF_FLOAT};{let t=e.getExtension("OES_texture_half_float");return t===null?null:{HALF_FLOAT:t.HALF_FLOAT_OES}}}function Che(e){return e.getExtension("OES_texture_half_float_linear")}function She(e){if(Ht(e))return{MIN:e.MIN,MAX:e.MAX};{let t=e.getExtension("EXT_blend_minmax");return t===null?null:{MIN:t.MIN_EXT,MAX:t.MAX_EXT}}}function vhe(e){return Ht(e)?{}:e.getExtension("EXT_frag_depth")}function Ihe(e){if(Ht(e))return e.getExtension("EXT_color_buffer_float")===null?null:(e.getExtension("EXT_float_blend"),{RGBA32F:e.RGBA32F});{let t=e.getExtension("WEBGL_color_buffer_float");return t===null?(e.getExtension("OES_texture_float"),Fye(e,e.FLOAT)?{RGBA32F:34836}:null):(e.getExtension("EXT_float_blend"),{RGBA32F:t.RGBA32F_EXT})}}function Ahe(e){if(Ht(e))return e.getExtension("EXT_color_buffer_half_float")===null?null:(e.getExtension("EXT_float_blend"),{RGBA16F:e.RGBA16F});{let t=e.getExtension("EXT_color_buffer_half_float");return t===null?(e.getExtension("OES_texture_half_float"),Fye(e,36193)?{RGBA16F:34842}:null):(e.getExtension("EXT_float_blend"),{RGBA16F:t.RGBA16F_EXT})}}function The(e){if(Ht(e))return{drawBuffers:e.drawBuffers.bind(e),COLOR_ATTACHMENT0:e.COLOR_ATTACHMENT0,COLOR_ATTACHMENT1:e.COLOR_ATTACHMENT1,COLOR_ATTACHMENT2:e.COLOR_ATTACHMENT2,COLOR_ATTACHMENT3:e.COLOR_ATTACHMENT3,COLOR_ATTACHMENT4:e.COLOR_ATTACHMENT4,COLOR_ATTACHMENT5:e.COLOR_ATTACHMENT5,COLOR_ATTACHMENT6:e.COLOR_ATTACHMENT6,COLOR_ATTACHMENT7:e.COLOR_ATTACHMENT7,DRAW_BUFFER0:e.DRAW_BUFFER0,DRAW_BUFFER1:e.DRAW_BUFFER1,DRAW_BUFFER2:e.DRAW_BUFFER2,DRAW_BUFFER3:e.DRAW_BUFFER3,DRAW_BUFFER4:e.DRAW_BUFFER4,DRAW_BUFFER5:e.DRAW_BUFFER5,DRAW_BUFFER6:e.DRAW_BUFFER6,DRAW_BUFFER7:e.DRAW_BUFFER7,MAX_COLOR_ATTACHMENTS:e.MAX_COLOR_ATTACHMENTS,MAX_DRAW_BUFFERS:e.MAX_DRAW_BUFFERS};{let t=e.getExtension("WEBGL_draw_buffers");return t===null?null:{drawBuffers:t.drawBuffersWEBGL.bind(t),COLOR_ATTACHMENT0:t.COLOR_ATTACHMENT0_WEBGL,COLOR_ATTACHMENT1:t.COLOR_ATTACHMENT1_WEBGL,COLOR_ATTACHMENT2:t.COLOR_ATTACHMENT2_WEBGL,COLOR_ATTACHMENT3:t.COLOR_ATTACHMENT3_WEBGL,COLOR_ATTACHMENT4:t.COLOR_ATTACHMENT4_WEBGL,COLOR_ATTACHMENT5:t.COLOR_ATTACHMENT5_WEBGL,COLOR_ATTACHMENT6:t.COLOR_ATTACHMENT6_WEBGL,COLOR_ATTACHMENT7:t.COLOR_ATTACHMENT7_WEBGL,DRAW_BUFFER0:t.DRAW_BUFFER0_WEBGL,DRAW_BUFFER1:t.DRAW_BUFFER1_WEBGL,DRAW_BUFFER2:t.DRAW_BUFFER2_WEBGL,DRAW_BUFFER3:t.DRAW_BUFFER3_WEBGL,DRAW_BUFFER4:t.DRAW_BUFFER4_WEBGL,DRAW_BUFFER5:t.DRAW_BUFFER5_WEBGL,DRAW_BUFFER6:t.DRAW_BUFFER6_WEBGL,DRAW_BUFFER7:t.DRAW_BUFFER7_WEBGL,MAX_COLOR_ATTACHMENTS:t.MAX_COLOR_ATTACHMENTS_WEBGL,MAX_DRAW_BUFFERS:t.MAX_DRAW_BUFFERS_WEBGL}}}function Phe(e){let t=e.getExtension("OES_draw_buffers_indexed");return t===null?null:{enablei:t.enableiOES.bind(t),disablei:t.disableiOES.bind(t),blendEquationi:t.blendEquationiOES.bind(t),blendEquationSeparatei:t.blendEquationSeparateiOES.bind(t),blendFunci:t.blendFunciOES.bind(t),blendFuncSeparatei:t.blendFuncSeparateiOES.bind(t),colorMaski:t.colorMaskiOES.bind(t)}}function _he(e){return Ht(e)?{}:e.getExtension("EXT_shader_texture_lod")}function Rhe(e){if(Ht(e))return{UNSIGNED_INT_24_8:e.UNSIGNED_INT_24_8};{let t=e.getExtension("WEBGL_depth_texture");return t===null?null:{UNSIGNED_INT_24_8:t.UNSIGNED_INT_24_8_WEBGL}}}function Dhe(e){if(Ht(e))return{FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING:e.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING,SRGB8_ALPHA8:e.SRGB8_ALPHA8,SRGB8:e.SRGB8,SRGB:e.SRGB};{let t=e.getExtension("EXT_sRGB");return t===null?null:{FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING:t.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT,SRGB8_ALPHA8:t.SRGB8_ALPHA8_EXT,SRGB8:t.SRGB_ALPHA_EXT,SRGB:t.SRGB_EXT}}}function whe(e){if(Ht(e)){let t=e.getExtension("EXT_disjoint_timer_query_webgl2")||e.getExtension("EXT_disjoint_timer_query");return t===null?null:{QUERY_COUNTER_BITS:t.QUERY_COUNTER_BITS_EXT,CURRENT_QUERY:e.CURRENT_QUERY,QUERY_RESULT:e.QUERY_RESULT,QUERY_RESULT_AVAILABLE:e.QUERY_RESULT_AVAILABLE,TIME_ELAPSED:t.TIME_ELAPSED_EXT,TIMESTAMP:t.TIMESTAMP_EXT,GPU_DISJOINT:t.GPU_DISJOINT_EXT,createQuery:e.createQuery.bind(e),deleteQuery:e.deleteQuery.bind(e),isQuery:e.isQuery.bind(e),beginQuery:e.beginQuery.bind(e),endQuery:e.endQuery.bind(e),queryCounter:t.queryCounterEXT.bind(t),getQuery:e.getQuery.bind(e),getQueryParameter:e.getQueryParameter.bind(e)}}else{let t=e.getExtension("EXT_disjoint_timer_query");return t===null?null:{QUERY_COUNTER_BITS:t.QUERY_COUNTER_BITS_EXT,CURRENT_QUERY:t.CURRENT_QUERY_EXT,QUERY_RESULT:t.QUERY_RESULT_EXT,QUERY_RESULT_AVAILABLE:t.QUERY_RESULT_AVAILABLE_EXT,TIME_ELAPSED:t.TIME_ELAPSED_EXT,TIMESTAMP:t.TIMESTAMP_EXT,GPU_DISJOINT:t.GPU_DISJOINT_EXT,createQuery:t.createQueryEXT.bind(t),deleteQuery:t.deleteQueryEXT.bind(t),isQuery:t.isQueryEXT.bind(t),beginQuery:t.beginQueryEXT.bind(t),endQuery:t.endQueryEXT.bind(t),queryCounter:t.queryCounterEXT.bind(t),getQuery:t.getQueryEXT.bind(t),getQueryParameter:t.getQueryObjectEXT.bind(t)}}}function Mhe(e){let t=e.getExtension("WEBGL_multi_draw");return t?{multiDrawArrays:t.multiDrawArraysWEBGL.bind(t),multiDrawElements:t.multiDrawElementsWEBGL.bind(t),multiDrawArraysInstanced:t.multiDrawArraysInstancedWEBGL.bind(t),multiDrawElementsInstanced:t.multiDrawElementsInstancedWEBGL.bind(t)}:null}function Bhe(e){let t=e.getExtension("WEBGL_draw_instanced_base_vertex_base_instance");return t?{drawArraysInstancedBaseInstance:t.drawArraysInstancedBaseInstanceWEBGL.bind(t),drawElementsInstancedBaseVertexBaseInstance:t.drawElementsInstancedBaseVertexBaseInstanceWEBGL.bind(t)}:null}function Ehe(e){let t=e.getExtension("WEBGL_multi_draw_instanced_base_vertex_base_instance");return t?{multiDrawArraysInstancedBaseInstance:t.multiDrawArraysInstancedBaseInstanceWEBGL.bind(t),multiDrawElementsInstancedBaseVertexBaseInstance:t.multiDrawElementsInstancedBaseVertexBaseInstanceWEBGL.bind(t)}:null}function khe(e){let t=e.getExtension("KHR_parallel_shader_compile");return t===null?null:{COMPLETION_STATUS:t.COMPLETION_STATUS_KHR}}function Fhe(e){return Ht(e)?{}:e.getExtension("OES_fbo_render_mipmap")}function Lhe(e){if(Ht(e)){let t=e.getExtension("WEBGL_provoking_vertex");if(t)return{FIRST_VERTEX_CONVENTION:t.FIRST_VERTEX_CONVENTION_WEBGL,LAST_VERTEX_CONVENTION:t.LAST_VERTEX_CONVENTION_WEBGL,PROVOKING_VERTEX:t.PROVOKING_VERTEX_WEBGL,provokingVertex:t.provokingVertexWEBGL.bind(t)}}return null}function Vhe(e){if(Ht(e)){let t=e.getExtension("WEBGL_clip_cull_distance");if(t)return{MAX_CLIP_DISTANCES:t.MAX_CLIP_DISTANCES_WEBGL,MAX_CULL_DISTANCES:t.MAX_CULL_DISTANCES_WEBGL,MAX_COMBINED_CLIP_AND_CULL_DISTANCES:t.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL,CLIP_DISTANCE0:t.CLIP_DISTANCE0_WEBGL,CLIP_DISTANCE1:t.CLIP_DISTANCE1_WEBGL,CLIP_DISTANCE2:t.CLIP_DISTANCE2_WEBGL,CLIP_DISTANCE3:t.CLIP_DISTANCE3_WEBGL,CLIP_DISTANCE4:t.CLIP_DISTANCE4_WEBGL,CLIP_DISTANCE5:t.CLIP_DISTANCE5_WEBGL,CLIP_DISTANCE6:t.CLIP_DISTANCE6_WEBGL,CLIP_DISTANCE7:t.CLIP_DISTANCE7_WEBGL}}return null}function Ohe(e){return Ht(e)&&e.getExtension("EXT_conservative_depth")?{}:null}function Ghe(e){if(Ht(e)){let t=e.getExtension("WEBGL_stencil_texturing");if(t)return{DEPTH_STENCIL_TEXTURE_MODE:t.DEPTH_STENCIL_TEXTURE_MODE_WEBGL,STENCIL_INDEX:t.STENCIL_INDEX_WEBGL}}return null}function Uhe(e){let t=e.getExtension("EXT_clip_control");return t?{LOWER_LEFT:t.LOWER_LEFT_EXT,UPPER_LEFT:t.UPPER_LEFT_EXT,NEGATIVE_ONE_TO_ONE:t.NEGATIVE_ONE_TO_ONE_EXT,ZERO_TO_ONE:t.ZERO_TO_ONE_EXT,CLIP_ORIGIN:t.CLIP_ORIGIN_EXT,CLIP_DEPTH_MODE:t.CLIP_DEPTH_MODE_EXT,clipControl:t.clipControlEXT.bind(t)}:null}function Nhe(e){return Ht(e)&&e.getExtension("EXT_render_snorm")?{}:null}function zhe(e){return Ht(e)&&e.getExtension("WEBGL_render_shared_exponent")?{}:null}function Hhe(e){let t=e.getExtension("EXT_texture_norm16");return t?{R16:t.R16_EXT,RG16:t.RG16_EXT,RGB16:t.RGB16_EXT,RGBA16:t.RGBA16_EXT,R16_SNORM:t.R16_SNORM_EXT,RG16_SNORM:t.RG16_SNORM_EXT,RGB16_SNORM:t.RGB16_SNORM_EXT,RGBA16_SNORM:t.RGBA16_SNORM_EXT}:null}function jhe(e){let t=e.getExtension("EXT_depth_clamp");return t?{DEPTH_CLAMP:t.DEPTH_CLAMP_EXT}:null}function Whe(e){if(Ht(e)){let t=e.getExtension("OVR_multiview2");if(t)return{FRAMEBUFFER_ATTACHMENT_TEXTURE_NUM_VIEWS:t.FRAMEBUFFER_ATTACHMENT_TEXTURE_NUM_VIEWS_OVR,FRAMEBUFFER_ATTACHMENT_TEXTURE_BASE_VIEW_INDEX:t.FRAMEBUFFER_ATTACHMENT_TEXTURE_BASE_VIEW_INDEX_OVR,MAX_VIEWS:t.MAX_VIEWS_OVR,FRAMEBUFFER_INCOMPLETE_VIEW_TARGETS:t.FRAMEBUFFER_INCOMPLETE_VIEW_TARGETS_OVR,framebufferTextureMultiview:t.framebufferTextureMultiviewOVR.bind(t)}}return null}function Xhe(e){if(!Ht(e))return!1;if(typeof navigator<"u"){let t=window.navigator.userAgent.match(/Firefox\/([0-9]+)\./);return t?parseInt(t[1])>=85:!0}return!1}var QZe=`
attribute vec4 aPosition;

void main() {
    gl_Position = aPosition;
}`,ZZe=`
precision mediump float;
uniform vec4 uColor;
uniform sampler2D uTexture;

void main() {
    gl_FragColor = texture2D(uTexture, vec2(0.5, 0.5)) * uColor;
}`,qZe=new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]);function Fye(e,t){let r=sR(e,{type:"vert",source:QZe}),n=sR(e,{type:"frag",source:ZZe});if(!r||!n)return!1;let o=Lk(e);e.attachShader(o,r),e.attachShader(o,n),e.linkProgram(o),e.useProgram(o);let i=e.getAttribLocation(o,"aPosition"),a=e.getUniformLocation(o,"uColor");if(!a)return Yt&&console.log("error getting 'uColor' uniform location"),!1;let s=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,s),e.bufferData(e.ARRAY_BUFFER,qZe,e.STATIC_DRAW),e.enableVertexAttribArray(i),e.vertexAttribPointer(i,2,e.FLOAT,!1,0,0);let l=e.createTexture(),u=new Uint8Array([255,255,255,255]);e.bindTexture(e.TEXTURE_2D,l),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,u);let c=e.createTexture();e.bindTexture(e.TEXTURE_2D,c),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,t,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST);let m=e.createFramebuffer();if(e.bindFramebuffer(e.FRAMEBUFFER,m),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,c,0),e.checkFramebufferStatus(e.FRAMEBUFFER)!==e.FRAMEBUFFER_COMPLETE)return Yt&&console.log(`error creating framebuffer for '${t}'`),!1;e.bindTexture(e.TEXTURE_2D,l),e.uniform4fv(a,[0,10,20,1]),e.drawArrays(e.TRIANGLES,0,6),e.bindTexture(e.TEXTURE_2D,c),e.bindFramebuffer(e.FRAMEBUFFER,null),e.clearColor(1,0,0,1),e.clear(e.COLOR_BUFFER_BIT),e.uniform4fv(a,[0,1/10,1/20,1]),e.drawArrays(e.TRIANGLES,0,6);let p=new Uint8Array(4);if(e.readPixels(0,0,1,1,e.RGBA,e.UNSIGNED_BYTE,p),p[0]!==0||p[1]<248||p[2]<248||p[3]<254)return Yt&&console.log(`not able to actually render to '${t}' texture`),!1;if(t===e.FLOAT){e.bindFramebuffer(e.FRAMEBUFFER,m);let h=new Float32Array(4);e.readPixels(0,0,1,1,e.RGBA,e.FLOAT,h);let f=e.getError();if(f)return Yt&&console.log(`error reading float pixels: '${h7(e,f)}'`),!1}return!0}var y7=gi();function YZe(e,t){switch(t){case"image-uint8":return e.TEXTURE_2D;case"image-float32":return e.TEXTURE_2D;case"image-float16":return e.TEXTURE_2D;case"image-depth":return e.TEXTURE_2D}if(Ht(e))switch(t){case"image-int32":return e.TEXTURE_2D;case"volume-uint8":return e.TEXTURE_3D;case"volume-float32":return e.TEXTURE_3D;case"volume-float16":return e.TEXTURE_3D}throw new Error(`unknown texture kind '${t}'`)}function Fk(e,t,r){switch(t){case"alpha":return Ht(e)&&(r==="float"||r==="fp16")?e.RED:Ht(e)&&r==="int"?e.RED_INTEGER:e.ALPHA;case"rgb":return Ht(e)&&r==="int"?e.RGB_INTEGER:e.RGB;case"rg":if(Ht(e)&&(r==="float"||r==="fp16"))return e.RG;if(Ht(e)&&r==="int")return e.RG_INTEGER;throw new Error('texture format "rg" requires webgl2 and type "float" or int"');case"rgba":return Ht(e)&&r==="int"?e.RGBA_INTEGER:e.RGBA;case"depth":return e.DEPTH_COMPONENT}}function KZe(e,t,r){if(Ht(e))switch(t){case"alpha":switch(r){case"ubyte":return e.ALPHA;case"float":return e.R32F;case"fp16":return e.R16F;case"int":return e.R32I}case"rg":switch(r){case"ubyte":return e.RG;case"float":return e.RG32F;case"fp16":return e.RG16F;case"int":return e.RG32I}case"rgb":switch(r){case"ubyte":return e.RGB;case"float":return e.RGB32F;case"fp16":return e.RGB16F;case"int":return e.RGB32I}case"rgba":switch(r){case"ubyte":return e.RGBA;case"float":return e.RGBA32F;case"fp16":return e.RGBA16F;case"int":return e.RGBA32I}case"depth":switch(r){case"ushort":return e.DEPTH_COMPONENT16;case"float":return e.DEPTH_COMPONENT32F}}return Fk(e,t,r)}function Gye(e,t,r,n,o){return m7(e,t)*r*n*(o||1)}function m7(e,t){return JZe(e)*$Ze(t)}function JZe(e){switch(e){case"alpha":return 1;case"rg":return 2;case"rgb":return 3;case"rgba":return 4;case"depth":return 4}}function $Ze(e){switch(e){case"ubyte":return 1;case"ushort":return 2;case"float":return 4;case"fp16":return 2;case"int":return 4}}function d7(e,t,r){switch(r){case"ubyte":return e.UNSIGNED_BYTE;case"ushort":return e.UNSIGNED_SHORT;case"float":return e.FLOAT;case"fp16":if(t.textureHalfFloat)return t.textureHalfFloat.HALF_FLOAT;throw new Error('extension "texture_half_float" unavailable');case"int":if(Ht(e))return e.INT;throw new Error('texture type "int" requires webgl2')}}function Lye(e,t){switch(t){case"nearest":return e.NEAREST;case"linear":return e.LINEAR}}function Gk(e,t,r){switch(r){case"depth":return e.DEPTH_ATTACHMENT;case"stencil":return e.STENCIL_ATTACHMENT;case"color0":case 0:return e.COLOR_ATTACHMENT0}if(t.drawBuffers)switch(r){case"color1":case 1:return t.drawBuffers.COLOR_ATTACHMENT1;case"color2":case 2:return t.drawBuffers.COLOR_ATTACHMENT2;case"color3":case 3:return t.drawBuffers.COLOR_ATTACHMENT3;case"color4":case 4:return t.drawBuffers.COLOR_ATTACHMENT4;case"color5":case 5:return t.drawBuffers.COLOR_ATTACHMENT5;case"color6":case 6:return t.drawBuffers.COLOR_ATTACHMENT6;case"color7":case 7:return t.drawBuffers.COLOR_ATTACHMENT7}throw new Error("unknown texture attachment")}function Vye(e){return typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement}function eqe(e,t,r){return t===r.TEXTURE_2D}function Oye(e,t,r){return t===r.TEXTURE_3D}function g7(e){let t=e.createTexture();if(t===null)throw new Error("Could not create WebGL texture");return t}function Iye(e,t,r,n,o,i){let a=y7(),s=g7(e);if(r.endsWith("float32")&&o!=="float"||r.endsWith("float16")&&o!=="fp16"||r.endsWith("uint8")&&o!=="ubyte"||r.endsWith("int32")&&o!=="int"||r.endsWith("depth")&&o!=="ushort"&&o!=="float")throw new Error(`texture kind '${r}' and type '${o}' are incompatible`);if(!t.depthTexture&&n==="depth")throw new Error("extension 'WEBGL_depth_texture' needed for 'depth' texture format");let l=YZe(e,r),u=Lye(e,i),c=Fk(e,n,o),m=KZe(e,n,o),d=d7(e,t,o);function p(){e.bindTexture(l,s),e.texParameteri(l,e.TEXTURE_MAG_FILTER,u),e.texParameteri(l,e.TEXTURE_MIN_FILTER,u),e.texParameteri(l,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(l,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(l,null)}p();let h=0,f=0,g=0,y,x=!1,S=!1;function I(T,R,w){if(T===0||R===0||Ht(e)&&l===e.TEXTURE_3D&&w===0)throw new Error("empty textures are not allowed");if(!(h===T&&f===R&&g===(w||0)))if(h=T,f=R,g=w||0,e.bindTexture(l,s),l===e.TEXTURE_2D)e.texImage2D(l,0,m,h,f,0,c,d,null);else if(Ht(e)&&l===e.TEXTURE_3D&&g!==void 0)e.texImage3D(l,0,m,h,f,g,0,c,d,null);else throw new Error("unknown texture target")}I(1,1,Ht(e)&&l===e.TEXTURE_3D?1:0);function v(T,R=!1){if(T.width===0||T.height===0||!Vye(T)&&Ht(e)&&Oye(T,l,e)&&T.depth===0)throw new Error("empty textures are not allowed");if(e.bindTexture(l,s),e.pixelStorei(e.UNPACK_ALIGNMENT,1),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.NONE),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),Vye(T))h=T.width,f=T.height,e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),e.bindTexture(e.TEXTURE_2D,s),e.texImage2D(e.TEXTURE_2D,0,m,c,d,T);else if(eqe(T,l,e)){let w=T.filter?Lye(e,T.filter):u;e.texParameteri(l,e.TEXTURE_MAG_FILTER,w),e.texParameteri(l,e.TEXTURE_MIN_FILTER,w),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!!T.flipY),R?e.texSubImage2D(l,0,0,0,T.width,T.height,c,d,T.array):(h=T.width,f=T.height,e.texImage2D(l,0,m,h,f,0,c,d,T.array))}else if(Ht(e)&&Oye(T,l,e))e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),R?e.texSubImage3D(l,0,0,0,0,T.width,T.height,T.depth,c,d,T.array):(h=T.width,f=T.height,g=T.depth,e.texImage3D(l,0,m,h,f,g,0,c,d,T.array));else throw new Error("unknown texture target");e.bindTexture(l,null),y=T}function A(){if(l!==e.TEXTURE_2D)throw new Error("mipmap only supported for 2d textures");if(Ht(e)||Ix(h)&&Ix(f))e.bindTexture(l,s),e.texParameteri(l,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_LINEAR),e.generateMipmap(l),e.bindTexture(l,null),x=!0;else throw new Error("mipmap unsupported for non-power-of-two textures and webgl1")}function P(T,R,w){if(T.bind(),l===e.TEXTURE_2D)e.framebufferTexture2D(e.FRAMEBUFFER,Gk(e,t,R),e.TEXTURE_2D,s,0);else if(Ht(e)&&l===e.TEXTURE_3D){if(w===void 0)throw new Error("need `layer` to attach 3D texture");e.framebufferTextureLayer(e.FRAMEBUFFER,Gk(e,t,R),s,0,w)}else throw new Error("unknown/unsupported texture target")}return{id:a,target:l,format:c,internalFormat:m,type:d,filter:u,getWidth:()=>h,getHeight:()=>f,getDepth:()=>g,getByteCount:()=>Gye(n,o,h,f,g),define:I,load:v,mipmap:A,bind:T=>{e.activeTexture(e.TEXTURE0+T),e.bindTexture(l,s)},unbind:T=>{e.activeTexture(e.TEXTURE0+T),e.bindTexture(l,null)},attachFramebuffer:P,detachFramebuffer:(T,R)=>{if(T.bind(),l===e.TEXTURE_2D)e.framebufferTexture2D(e.FRAMEBUFFER,Gk(e,t,R),e.TEXTURE_2D,null,0);else if(Ht(e)&&l===e.TEXTURE_3D)e.framebufferTextureLayer(e.FRAMEBUFFER,Gk(e,t,R),null,0,0);else throw new Error("unknown texture target")},reset:()=>{s=g7(e),p();let[T,R,w]=[h,f,g];h=0,f=0,g=0,I(T,R,w),y&&v(y),x&&A()},destroy:()=>{S||(e.deleteTexture(s),S=!0)}}}function b7(e,t,r){let{resources:n}=e,o=[];return Object.keys(t).forEach(i=>{let a=t[i];if(a.type==="texture"){let s=r[i];if(s)if(a.kind==="texture")o[o.length]=[i,s.ref.value];else{let l=n.texture(a.kind,a.format,a.dataType,a.filter);l.load(s.ref.value),o[o.length]=[i,l]}}}),o}function x7(e,t,r){let n=new Image;n.onload=function(){r.load(n),_.update(t,r)},n.src=e}function tqe(e,t){switch(t){case"nx":return e.TEXTURE_CUBE_MAP_NEGATIVE_X;case"ny":return e.TEXTURE_CUBE_MAP_NEGATIVE_Y;case"nz":return e.TEXTURE_CUBE_MAP_NEGATIVE_Z;case"px":return e.TEXTURE_CUBE_MAP_POSITIVE_X;case"py":return e.TEXTURE_CUBE_MAP_POSITIVE_Y;case"pz":return e.TEXTURE_CUBE_MAP_POSITIVE_Z}}function Aye(e,t,r,n){let o=e.TEXTURE_CUBE_MAP,i=e.LINEAR,a=e.RGBA,s=e.RGBA,l=e.UNSIGNED_BYTE,u=0,c=e.createTexture();e.bindTexture(o,c);function m(f,g,y,x){u===0&&(u=y.width),e.bindTexture(o,c),e.texImage2D(f,g,a,u,u,0,s,l,null),e.pixelStorei(e.UNPACK_ALIGNMENT,4),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.NONE),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),e.bindTexture(o,c),e.texImage2D(f,g,a,s,l,y),p+=1,p===6&&(h||(r?(e.texParameteri(o,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_LINEAR),e.generateMipmap(o)):e.texParameteri(o,e.TEXTURE_MIN_FILTER,i),e.texParameteri(o,e.TEXTURE_MAG_FILTER,i)),x||n?.(h))}let d=[],p=0;wi(t,(f,g)=>{if(!f)return;let y=0,x=tqe(e,g),S=new Image;f instanceof File?S.src=URL.createObjectURL(f):jx(f)?f.then(I=>{S.src=URL.createObjectURL(I)}):S.src=f,d.push({cubeTarget:x,level:y,image:S}),S.addEventListener("load",()=>{m(x,y,S,!1)}),S.addEventListener("error",()=>{n?.(!0)})});let h=!1;return{id:y7(),target:o,format:s,internalFormat:a,type:l,filter:i,getWidth:()=>u,getHeight:()=>u,getDepth:()=>0,getByteCount:()=>Gye("rgba","ubyte",u,u,0)*6*(r?2:1),define:()=>{},load:()=>{},mipmap:()=>{},bind:f=>{e.activeTexture(e.TEXTURE0+f),e.bindTexture(o,c)},unbind:f=>{e.activeTexture(e.TEXTURE0+f),e.bindTexture(o,null)},attachFramebuffer:()=>{},detachFramebuffer:()=>{},reset:()=>{c=g7(e),e.bindTexture(o,c),p=0;for(let{cubeTarget:f,level:g,image:y}of d)m(f,g,y,!0)},destroy:()=>{h||(e.deleteTexture(c),h=!0)}}}var Uye=-1;function Nye(e){return e.format===Uye}function qo(e){let t=e?.TEXTURE_2D??3553;return{id:y7(),target:t,format:Uye,internalFormat:0,type:0,filter:0,getWidth:()=>0,getHeight:()=>0,getDepth:()=>0,getByteCount:()=>0,define:()=>{},load:()=>{},mipmap:()=>{},bind:r=>{e&&(e.activeTexture(e.TEXTURE0+r),e.bindTexture(t,null))},unbind:r=>{e&&(e.activeTexture(e.TEXTURE0+r),e.bindTexture(t,null))},attachFramebuffer:()=>{throw new Error("cannot attach null-texture to a framebuffer")},detachFramebuffer:()=>{throw new Error("cannot detach null-texture from a framebuffer")},reset:()=>{},destroy:()=>{}}}function ya(e,t,r,n){let o=rqe(e,t,r,n);if(r.palette){_.updateIfChanged(o.dUsePalette,!0);let[i,a]=r.palette.domain||[0,1];_.update(o.uPaletteDomain,Ce.set(o.uPaletteDomain.ref.value,i,a)),_.update(o.uPaletteDefault,Le.toVec3Normalized(o.uPaletteDefault.ref.value,r.palette.defaultColor??13421772)),nqe(r.palette,o.tPalette)}else _.updateIfChanged(o.dUsePalette,!1);return o}function rqe(e,t,r,n){switch(r.granularity){case"uniform":return iqe(e,r.color,n);case"instance":return e.nonInstanceable?zye(e,r.color,n):aqe(e,r.color,n);case"group":return zye(e,r.color,n);case"groupInstance":return sqe(e,r.color,n);case"vertex":return lqe(t,r.color,n);case"vertexInstance":return uqe(t,r.color,n);case"volume":return Hye(r.grid,"volume",n);case"volumeInstance":return Hye(r.grid,"volumeInstance",n);case"direct":return cqe(n)}}function nqe(e,t){let r=!0,n=t.ref.value;if(e.colors.length!==n.width||n.filter!==e.filter)r=!1;else{let a=n.array,s=0;for(let l of e.colors){let[u,c,m]=Le.toRgb(l);if(a[s++]!==u||a[s++]!==c||a[s++]!==m){r=!1;break}}}if(r)return;let o=new Uint8Array(e.colors.length*3),i=0;for(let a of e.colors){let[s,l,u]=Le.toRgb(a);o[i++]=s,o[i++]=l,o[i++]=u}_.update(t,{array:o,height:1,width:e.colors.length,filter:e.filter})}function oqe(e,t){return t?(_.update(t.uColor,Le.toVec3Normalized(t.uColor.ref.value,e)),_.updateIfChanged(t.dColorType,"uniform"),t):{uColor:_.create(Le.toVec3Normalized(b(),e)),tColor:_.create({array:new Uint8Array(3),width:1,height:1}),tColorGrid:_.create(qo()),uPaletteDomain:_.create(Ce.create(0,1)),uPaletteDefault:_.create(b()),tPalette:_.create({array:new Uint8Array(3),width:1,height:1}),uColorTexDim:_.create(Ce.create(1,1)),uColorGridDim:_.create(b.create(1,1,1)),uColorGridTransform:_.create(Et.create(0,0,0,1)),dColorType:_.create("uniform"),dUsePalette:_.create(!1)}}function iqe(e,t,r){e.reset();let n=e.hasNext?e.move():{location:Vu,isSecondary:!1};return oqe(t(n.location,n.isSecondary),r)}function uR(e,t,r){return r?(_.update(r.tColor,e),_.update(r.uColorTexDim,Ce.create(e.width,e.height)),_.updateIfChanged(r.dColorType,t),r):{uColor:_.create(b()),tColor:_.create(e),tColorGrid:_.create(qo()),uPaletteDomain:_.create(Ce.create(0,1)),uPaletteDefault:_.create(b()),tPalette:_.create({array:new Uint8Array(3),width:1,height:1}),uColorTexDim:_.create(Ce.create(e.width,e.height)),uColorGridDim:_.create(b.create(1,1,1)),uColorGridTransform:_.create(Et.create(0,0,0,1)),dColorType:_.create(t),dUsePalette:_.create(!1)}}function aqe(e,t,r){let{instanceCount:n}=e,o=So(Math.max(1,n),3,Uint8Array,r&&r.tColor.ref.value.array);for(e.reset();e.hasNext;){let{location:i,isSecondary:a,instanceIndex:s}=e.move();Le.toArray(t(i,a),o.array,s*3),e.skipInstance()}return uR(o,"instance",r)}function zye(e,t,r){let{groupCount:n,hasLocation2:o}=e,i=So(Math.max(1,n*(o?2:1)),3,Uint8Array,r&&r.tColor.ref.value.array);e.reset();let a=o?6:3;for(;e.hasNext&&!e.isNextNewInstance;){let{location:s,location2:l,isSecondary:u,groupIndex:c}=e.move();Le.toArray(t(s,u),i.array,c*a),o&&Le.toArray(t(l,u),i.array,c*a+3)}return uR(i,"group",r)}function sqe(e,t,r){let{groupCount:n,instanceCount:o,hasLocation2:i}=e,a=o*n*(i?2:1),s=So(Math.max(1,a),3,Uint8Array,r&&r.tColor.ref.value.array);e.reset();let l=i?6:3;for(;e.hasNext;){let{location:u,location2:c,isSecondary:m,index:d}=e.move();Le.toArray(t(u,m),s.array,d*l),i&&Le.toArray(t(c,m),s.array,d*l+3)}return uR(s,"groupInstance",r)}function lqe(e,t,r){let{groupCount:n,stride:o}=e,i=So(Math.max(1,n),3,Uint8Array,r&&r.tColor.ref.value.array);for(e.reset(),e.voidInstances();e.hasNext&&!e.isNextNewInstance;){let{location:a,isSecondary:s,groupIndex:l}=e.move(),u=t(a,s);for(let c=0;c<o;++c)Le.toArray(u,i.array,(l+c)*3)}return uR(i,"vertex",r)}function uqe(e,t,r){let{groupCount:n,instanceCount:o,stride:i}=e,a=o*n,s=So(Math.max(1,a),3,Uint8Array,r&&r.tColor.ref.value.array);for(e.reset();e.hasNext;){let{location:l,isSecondary:u,index:c}=e.move(),m=t(l,u);for(let d=0;d<i;++d)Le.toArray(m,s.array,(c+d)*3)}return uR(s,"vertexInstance",r)}function Hye(e,t,r){let{colors:n,dimension:o,transform:i}=e,a=n.getWidth(),s=n.getHeight();return r?(_.update(r.tColorGrid,n),_.update(r.uColorTexDim,Ce.create(a,s)),_.update(r.uColorGridDim,b.clone(o)),_.update(r.uColorGridTransform,Et.clone(i)),_.updateIfChanged(r.dColorType,t),r):{uColor:_.create(b()),tColor:_.create({array:new Uint8Array(3),width:1,height:1}),tColorGrid:_.create(n),uPaletteDomain:_.create(Ce.create(0,1)),uPaletteDefault:_.create(b()),tPalette:_.create({array:new Uint8Array(3),width:1,height:1}),uColorTexDim:_.create(Ce.create(a,s)),uColorGridDim:_.create(b.clone(o)),uColorGridTransform:_.create(Et.clone(i)),dColorType:_.create(t),dUsePalette:_.create(!1)}}function cqe(e){return e?(_.updateIfChanged(e.dColorType,"direct"),e):{uColor:_.create(b()),tColor:_.create({array:new Uint8Array(3),width:1,height:1}),tColorGrid:_.create(qo()),uPaletteDomain:_.create(Ce.create(0,1)),uPaletteDefault:_.create(b()),tPalette:_.create({array:new Uint8Array(3),width:1,height:1}),uColorTexDim:_.create(Ce.create(1,1)),uColorGridDim:_.create(b.create(1,1,1)),uColorGridTransform:_.create(Et.create(0,0,0,1)),dColorType:_.create("direct"),dUsePalette:_.create(!1)}}var C7=b.transformMat4Offset,mqe=b.fromArray,Uk=pt.add;function jye(){return{cellSize:0,cellCount:0,cellOffsets:new Uint32Array,cellSpheres:new Float32Array,cellTransform:new Float32Array,cellInstance:new Float32Array,batchSize:0,batchCount:0,batchOffsets:new Uint32Array,batchSpheres:new Float32Array,batchCell:new Uint32Array}}function Wye(e,t,r){let n=dqe(e,t),o=pqe(n,r),i=new Uint32Array(n.cellOffsets.length),a=new Float32Array(n.cellSpheres.length),s=new Float32Array(n.cellInstance.length),l=0;for(let c=0,m=o.batchCell.length;c<m;++c){let d=o.batchCell[c],p=n.cellOffsets[d],f=n.cellOffsets[d+1]-p;i[c+1]=i[c]+f;for(let g=0;g<4;++g)a[c*4+g]=n.cellSpheres[d*4+g];for(let g=0;g<f;++g){let y=p+g,x=n.cellInstance[y];for(let S=0;S<16;++S)n.cellTransform[l*16+S]=e.transform[x*16+S];s[l]=x,l+=1}}return{cellSize:n.cellSize,cellCount:n.cellCount,cellOffsets:i,cellSpheres:a,cellTransform:n.cellTransform,cellInstance:s,batchSize:o.batchSize,batchCount:o.batchCount,batchOffsets:o.batchOffsets,batchSpheres:o.batchSpheres,batchCell:Xa(o.batchCell)}}function dqe(e,t){let{instanceCount:r,instance:n,transform:o,invariantBoundingSphere:i}=e,a=new Float32Array(r),s=new Float32Array(r),l=new Float32Array(r),u=xe.ofBounds(0,r),c=pt.setEmpty(pt()),{center:m,radius:d}=i,p=b.create(d,d,d),h=b();for(let D=0;D<r;++D)C7(h,m,o,0,0,D*16),a[D]=h[0],s[D]=h[1],l[D]=h[2],Uk(c,h);pt.expand(c,c,p);let f={x:a,y:s,z:l,indices:u},g={box:c,sphere:he.fromBox3D(he(),c)},y=zc(f,g,b.create(t,t,t)),{array:x,offset:S,count:I}=y.buckets,v=S.length,A=new Uint32Array(v+1),P=new Float32Array(v*4),T=new Float32Array(r*16),R=new Float32Array(r),w=pt(),E=he(),M=0;for(let D=0;D<v;++D){let B=S[D],k=I[D];A[D]=B;let F=M;for(let z=B,j=B+k;z<j;++z){let Y=x[z];R[M]=n[Y];for(let G=0;G<16;++G)T[M*16+G]=o[Y*16+G];M+=1}if(k===1)C7(P,m,T,D*4,0,F*16),P[D*4+3]=d;else{pt.setEmpty(w);let z=F*16;for(let j=0;j<k;++j)C7(h,m,T,0,0,j*16+z),Uk(w,h);pt.expand(w,w,p),he.fromBox3D(E,w),he.toArray(E,P,D*4)}}return A[v]=S[v-1]+I[v-1],{cellSize:t,cellCount:v,cellOffsets:A,cellSpheres:P,cellTransform:T,cellInstance:R}}function pqe(e,t){let{cellCount:r,cellSpheres:n}=e,o=new Float32Array(r),i=new Float32Array(r),a=new Float32Array(r),s=xe.ofBounds(0,r),l=pt.setEmpty(pt()),u=b(),c=0;for(let R=0;R<r;++R){let w=R*4;mqe(u,n,w),o[R]=u[0],i[R]=u[1],a[R]=u[2],Uk(l,u),c=Math.max(c,n[w+3])}let m=b.create(c,c,c);pt.expand(l,l,m);let d={x:o,y:i,z:a,indices:s},p={box:l,sphere:he.fromBox3D(he(),l)},h=zc(d,p,b.create(t,t,t)),{array:f,offset:g,count:y}=h.buckets,x=g.length,S=new Uint32Array(x+1),I=new Float32Array(x*4),v=new Uint32Array(r),A=pt(),P=he(),T=0;for(let R=0;R<x;++R){let w=g[R],E=y[R];S[R]=w;for(let M=w,D=w+E;M<D;++M)v[T]=f[M],T+=1;if(E===1){let M=f[w];I[R*4]=n[M*4],I[R*4+1]=n[M*4+1],I[R*4+2]=n[M*4+2],I[R*4+3]=n[M*4+3]}else{pt.setEmpty(A),c=0;for(let M=w,D=w+E;M<D;++M){let B=f[M];u[0]=n[B*4],u[1]=n[B*4+1],u[2]=n[B*4+2],Uk(A,u),c=Math.max(c,n[B*4+3])}b.set(m,c,c,c),pt.expand(A,A,m),he.fromBox3D(P,A),he.toArray(P,I,R*4)}}return S[x]=g[x-1]+y[x-1],{batchSize:t,batchCount:x,batchOffsets:S,batchSpheres:I,batchCell:v}}var Xye=Mt(),fqe=H();function hqe(e,t){for(let r=0;r<t;r++)if(Mt.fromMat4(Xye,H.fromArray(fqe,e,r*16)),Mt.determinant(Xye)<0)return!0;return!1}function WS(e,t,r,n,o,i){let a=hqe(e,t);if(i){_.update(i.matrix,i.matrix.ref.value);let s=i.transform.ref.value.length>=t*16?i.transform.ref.value:new Float32Array(t*16);s.set(e),_.update(i.transform,s),_.updateIfChanged(i.uInstanceCount,t),_.updateIfChanged(i.instanceCount,t);let l=i.aTransform.ref.value.length>=t*16?i.aTransform.ref.value:new Float32Array(t*16);_.update(i.aTransform,l);let u=i.extraTransform.ref.value.length>=t*16?i.extraTransform.ref.value:new Float32Array(t*16);_.update(i.extraTransform,rA(u,t));let c=i.aInstance.ref.value.length>=t?i.aInstance.ref.value:new Float32Array(t);_.update(i.aInstance,Xa(c,t)),_.update(i.hasReflection,a)}else i={aTransform:_.create(new Float32Array(t*16)),matrix:_.create(H.identity()),transform:_.create(new Float32Array(e)),extraTransform:_.create(rA(new Float32Array(t*16),t)),uInstanceCount:_.create(t),instanceCount:_.create(t),aInstance:_.create(Xa(new Float32Array(t))),hasReflection:_.create(a),instanceGrid:_.create(jye())};return v7(i,r,n,o),i}var S7=new Float32Array(16);H.toArray(H.identity(),S7,0);function Nk(e){return WS(new Float32Array(S7),1,void 0,0,0,e)}function rA(e,t){for(let r=0;r<t;r++)e.set(S7,r*16);return e}function v7(e,t,r,n){let o=e.aTransform.ref.value,i=e.aInstance.ref.value,a=e.instanceCount.ref.value,s=e.matrix.ref.value,l=e.transform.ref.value,u=e.extraTransform.ref.value;for(let c=0;c<a;c++){let m=c*16;H.mulOffset(o,u,l,m,m,m),H.mulOffset(o,s,o,m,0,m),i[c]=c}if(t&&a>0){let c=Wye({instanceCount:a,instance:i,transform:o,invariantBoundingSphere:t},r,n);_.update(e.instanceGrid,c),_.update(e.aInstance,c.cellInstance),_.update(e.aTransform,c.cellTransform)}else _.update(e.aInstance,i),_.update(e.aTransform,o)}var gqe="Gives everything the same, uniform size.",Qye={value:C.Numeric(1,{min:0,max:20,step:.1})};function yqe(e){return Qye}function zk(e,t){let r=t.value;return{factory:zk,granularity:"uniform",size:()=>r,props:t,description:gqe}}var Zye={name:"uniform",label:"Uniform",category:"",factory:zk,getParams:yqe,defaultValues:C.getDefaultValues(Qye),isApplicable:e=>!0};function Hi(e){return{...Hi.Zero,...e}}(a=>{a.Zero={metalness:0,roughness:0,bumpiness:0};function t(s,l,u){return l[u]=s.metalness*255,l[u+1]=s.roughness*255,l[u+2]=s.bumpiness*255,l}a.toArray=t;function r(s,l,u){return l[u]=s.metalness,l[u+1]=s.roughness,l[u+2]=s.bumpiness,l}a.toArrayNormalized=r;function n(s,l){return s.metalness===l.metalness&&s.roughness===l.roughness&&s.bumpiness===l.bumpiness}a.areEqual=n;function o({metalness:s,roughness:l,bumpiness:u}){return`M ${s.toFixed(2)} | R ${l.toFixed(2)} | B ${u.toFixed(2)}`}a.toString=o;function i(s){return C.Group({metalness:C.Numeric(0,{min:0,max:1,step:.01}),roughness:C.Numeric(1,{min:0,max:1,step:.01}),bumpiness:C.Numeric(0,{min:0,max:1,step:.01})},{...s,presets:[[{metalness:0,roughness:1,bumpiness:0},"Matte"],[{metalness:0,roughness:.2,bumpiness:0},"Plastic"],[{metalness:0,roughness:.6,bumpiness:0},"Glossy"],[{metalness:1,roughness:.6,bumpiness:0},"Metallic"]]})}a.getParam=i})(Hi||={});function Zf(){}(m=>{m.Type={none:0,plane:1,sphere:2,cube:3,cylinder:4,infiniteCone:5},m.Params={variant:C.Select("pixel",C.arrayToOptions(["instance","pixel"])),objects:C.ObjectList({type:C.Select("plane",C.objectToOptions(m.Type,d=>va(d))),invert:C.Boolean(!1),position:C.Vec3(b()),rotation:C.Group({axis:C.Vec3(b.create(1,0,0)),angle:C.Numeric(0,{min:-180,max:180,step:1},{description:"Angle in Degrees"})},{isExpanded:!0}),scale:C.Vec3(b.create(1,1,1)),transform:C.Mat4(H.identity())},d=>va(d.type))};function r(d){return{count:0,type:new Array(d).fill(1),invert:new Array(d).fill(!1),position:new Array(d*3).fill(0),rotation:new Array(d*4).fill(0),scale:new Array(d*3).fill(1),transform:new Array(d*16).fill(0)}}let n=lr(),o=lr(),i=b(),a=b(),s=H(),l=H();function u(d,p){let h=d.objects.length,{type:f,invert:g,position:y,rotation:x,scale:S,transform:I}=p?.objects||r(h);for(let v=0;v<h;++v){let A=d.objects[v];f[v]=m.Type[A.type],g[v]=A.invert,b.toArray(A.position,y,v*3),lr.toArray(lr.setAxisAngle(n,A.rotation.axis,kr(A.rotation.angle)),x,v*4),b.toArray(A.scale,S,v*3),H.toArray(A.transform,I,v*16)}return{variant:d.variant,objects:{count:h,type:f,invert:g,position:y,rotation:x,scale:S,transform:I}}}m.getClip=u;function c(d,p){if(d.variant!==p.variant||d.objects.count!==p.objects.count)return!1;let h=d.objects,f=p.objects;for(let g=0,y=h.count;g<y;++g)if(h.invert[g]!==f.invert[g]||h.type[g]!==f.type[g]||(b.fromArray(i,h.position,g*3),b.fromArray(a,f.position,g*3),!b.equals(i,a))||(b.fromArray(i,h.scale,g*3),b.fromArray(a,f.scale,g*3),!b.equals(i,a))||(lr.fromArray(n,h.rotation,g*4),lr.fromArray(o,f.rotation,g*4),!lr.equals(n,o))||(H.fromArray(s,h.transform,g*16),H.fromArray(l,f.transform,g*16),!H.areEqual(s,l,1e-6)))return!1;return!0}m.areEqual=c})(Zf||={});var bqe={custom:{},auto:{},highest:{},higher:{},high:{},medium:{},low:{},lower:{},lowest:{}},xqe=Object.keys(bqe),cR=C.arrayToOptions(xqe),Hk={smoothColors:C.MappedStatic("auto",{auto:C.Group({}),on:C.Group({resolutionFactor:C.Numeric(2,{min:.5,max:6,step:.1}),sampleStride:C.Numeric(3,{min:1,max:12,step:1})}),off:C.Group({})})};function Om(e){return!!e.smoothColors}function Ou(e,t,r){if((e.name==="on"||e.name==="auto"&&t)&&r&&r<3){let n=3;return e.name==="on"?(r*=e.params.resolutionFactor,n=e.params.sampleStride):(r*=2-uM(0,1.1,r),r=Math.max(.5,r),r>1.2&&(n=2)),{resolution:r,stride:n}}}var Xe;(c=>{c.MaterialCategory={category:"Material"},c.ShadingCategory={category:"Shading"},c.CullingLodCategory={category:"Culling & LOD"},c.CustomQualityParamInfo={category:"Custom Quality",hideIf:m=>typeof m.quality<"u"&&m.quality!=="custom"},c.Params={alpha:C.Numeric(1,{min:0,max:1,step:.01},{label:"Opacity",isEssential:!0,description:"How opaque/transparent the representation is rendered."}),quality:C.Select("auto",cR,{isEssential:!0,description:"Visual/rendering quality of the representation."}),material:Hi.getParam(),clip:C.Group(Zf.Params),emissive:C.Numeric(0,{min:0,max:1,step:.01}),density:C.Numeric(.2,{min:0,max:1,step:.01},{description:"Density value to estimate object thickness."}),instanceGranularity:C.Boolean(!1,{description:"Use instance granularity for marker, transparency, clipping, overpaint, substance data to save memory."}),lod:C.Vec3(b(),void 0,{...c.CullingLodCategory,description:"Level of detail.",fieldLabels:{x:"Min Distance",y:"Max Distance",z:"Overlap (Shader)"}}),cellSize:C.Numeric(200,{min:0,max:5e3,step:100},{...c.CullingLodCategory,description:"Instance grid cell size."}),batchSize:C.Numeric(2e3,{min:0,max:5e4,step:500},{...c.CullingLodCategory,description:"Instance grid batch size."})};function i(m=Lt.grey,d=1,p){p||(p=Nk());let h=un(1,p.instanceCount.ref.value,1,()=>Vu,!1,()=>!1),f={color:Qf({},{value:m,lightness:0,saturation:0}),size:zk({},{value:d})};return{transform:p,locationIterator:h,theme:f}}c.createSimple=i;function a(m,d){let p=Zf.getClip(m.clip);return{alpha:_.create(m.alpha),uAlpha:_.create(m.alpha),uVertexCount:_.create(d.vertexCount),uGroupCount:_.create(d.groupCount),drawCount:_.create(d.drawCount),uMetalness:_.create(m.material.metalness),uRoughness:_.create(m.material.roughness),uBumpiness:_.create(m.material.bumpiness),uEmissive:_.create(m.emissive),uDensity:_.create(m.density),dClipObjectCount:_.create(p.objects.count),dClipVariant:_.create(p.variant),uClipObjectType:_.create(p.objects.type),uClipObjectInvert:_.create(p.objects.invert),uClipObjectPosition:_.create(p.objects.position),uClipObjectRotation:_.create(p.objects.rotation),uClipObjectScale:_.create(p.objects.scale),uClipObjectTransform:_.create(p.objects.transform),instanceGranularity:_.create(m.instanceGranularity),uLod:_.create(Et.create(m.lod[0],m.lod[1],m.lod[2],0))}}c.createValues=a;function s(m,d){_.updateIfChanged(m.alpha,d.alpha),_.updateIfChanged(m.uMetalness,d.material.metalness),_.updateIfChanged(m.uRoughness,d.material.roughness),_.updateIfChanged(m.uBumpiness,d.material.bumpiness),_.updateIfChanged(m.uEmissive,d.emissive),_.updateIfChanged(m.uDensity,d.density);let p=Zf.getClip(d.clip);_.updateIfChanged(m.dClipObjectCount,p.objects.count),_.updateIfChanged(m.dClipVariant,p.variant),_.update(m.uClipObjectType,p.objects.type),_.update(m.uClipObjectInvert,p.objects.invert),_.update(m.uClipObjectPosition,p.objects.position),_.update(m.uClipObjectRotation,p.objects.rotation),_.update(m.uClipObjectScale,p.objects.scale),_.update(m.uClipObjectTransform,p.objects.transform),_.updateIfChanged(m.instanceGranularity,d.instanceGranularity),_.update(m.uLod,Et.set(m.uLod.ref.value,d.lod[0],d.lod[1],d.lod[2],0))}c.updateValues=s;function l(m={}){let d=m.alpha===void 0?!0:m.alpha===1;return{disposed:!1,visible:!0,alphaFactor:1,pickable:!0,colorOnly:!1,opaque:d,writeDepth:d}}c.createRenderableState=l;function u(m,d){m.opaque=d.alpha*m.alphaFactor>=1,m.writeDepth=m.opaque}c.updateRenderableState=u})(Xe||={});function Yye(e,t,r,n){for(let o=t;o<r;++o)Le.toArray(n,e,o*4),e[o*4+3]=255;return!0}function I7(e,t,r){return e.fill(0,t*4,r*4),!0}function Kye(e,t,r){let n=So(Math.max(1,e),4,Uint8Array,r&&r.tOverpaint.ref.value.array);return r?(_.update(r.tOverpaint,n),_.update(r.uOverpaintTexDim,Ce.create(n.width,n.height)),_.updateIfChanged(r.dOverpaint,e>0),_.updateIfChanged(r.dOverpaintType,t),r):{tOverpaint:_.create(n),uOverpaintTexDim:_.create(Ce.create(n.width,n.height)),dOverpaint:_.create(e>0),tOverpaintGrid:_.create(qo()),uOverpaintGridDim:_.create(b.create(1,1,1)),uOverpaintGridTransform:_.create(Et.create(0,0,0,1)),dOverpaintType:_.create(t),uOverpaintStrength:_.create(1)}}var qye={array:new Uint8Array(4),width:1,height:1};function ql(e){return e?(_.update(e.tOverpaint,qye),_.update(e.uOverpaintTexDim,Ce.create(1,1)),e):{tOverpaint:_.create(qye),uOverpaintTexDim:_.create(Ce.create(1,1)),dOverpaint:_.create(!1),tOverpaintGrid:_.create(qo()),uOverpaintGridDim:_.create(b.create(1,1,1)),uOverpaintGridTransform:_.create(Et.create(0,0,0,1)),dOverpaintType:_.create("groupInstance"),uOverpaintStrength:_.create(1)}}function $ye(e,t,r,n){for(let o=t;o<r;++o)e[o]=n*255;return!0}function A7(e,t){if(t===0||e.length<t)return 0;let r=0;for(let n=0;n<t;++n)r+=e[n];return r/(255*t)}function T7(e,t){if(t===0||e.length<t)return 1;let r=255;for(let n=0;n<t;++n)e[n]>0&&e[n]<r&&(r=e[n]);return r/255}function ebe(e,t,r){e.fill(0,t,r)}function tbe(e,t,r){let n=So(Math.max(1,e),1,Uint8Array,r&&r.tTransparency.ref.value.array);return r?(_.update(r.tTransparency,n),_.update(r.uTransparencyTexDim,Ce.create(n.width,n.height)),_.updateIfChanged(r.dTransparency,e>0),_.updateIfChanged(r.transparencyAverage,A7(n.array,e)),_.updateIfChanged(r.transparencyMin,T7(n.array,e)),_.updateIfChanged(r.dTransparencyType,t),r):{tTransparency:_.create(n),uTransparencyTexDim:_.create(Ce.create(n.width,n.height)),dTransparency:_.create(e>0),transparencyAverage:_.create(0),transparencyMin:_.create(1),tTransparencyGrid:_.create(qo()),uTransparencyGridDim:_.create(b.create(1,1,1)),uTransparencyGridTransform:_.create(Et.create(0,0,0,1)),dTransparencyType:_.create(t),uTransparencyStrength:_.create(1)}}var Jye={array:new Uint8Array(1),width:1,height:1};function Yl(e){return e?(_.update(e.tTransparency,Jye),_.update(e.uTransparencyTexDim,Ce.create(1,1)),e):{tTransparency:_.create(Jye),uTransparencyTexDim:_.create(Ce.create(1,1)),dTransparency:_.create(!1),transparencyAverage:_.create(0),transparencyMin:_.create(1),tTransparencyGrid:_.create(qo()),uTransparencyGridDim:_.create(b.create(1,1,1)),uTransparencyGridTransform:_.create(Et.create(0,0,0,1)),dTransparencyType:_.create("groupInstance"),uTransparencyStrength:_.create(1)}}function nbe(e,t,r,n){return e.fill(n,t,r),!0}function obe(e,t,r){e.fill(0,t,r)}function ibe(e,t,r){let n=So(Math.max(1,e),1,Uint8Array,r&&r.tClipping.ref.value.array);return r?(_.update(r.tClipping,n),_.update(r.uClippingTexDim,Ce.create(n.width,n.height)),_.updateIfChanged(r.dClipping,e>0),_.updateIfChanged(r.dClippingType,t),r):{tClipping:_.create(n),uClippingTexDim:_.create(Ce.create(n.width,n.height)),dClipping:_.create(e>0),dClippingType:_.create(t)}}var rbe={array:new Uint8Array(1),width:1,height:1};function Kl(e){return e?(_.update(e.tClipping,rbe),_.update(e.uClippingTexDim,Ce.create(1,1)),_.updateIfChanged(e.dClipping,!1),e):{tClipping:_.create(rbe),uClippingTexDim:_.create(Ce.create(1,1)),dClipping:_.create(!1),dClippingType:_.create("groupInstance")}}function sbe(e,t,r,n){for(let o=t;o<r;++o)Hi.toArray(n,e,o*4),e[o*4+3]=255;return!0}function P7(e,t,r){return e.fill(0,t*4,r*4),!0}function lbe(e,t,r){let n=So(Math.max(1,e),4,Uint8Array,r&&r.tSubstance.ref.value.array);return r?(_.update(r.tSubstance,n),_.update(r.uSubstanceTexDim,Ce.create(n.width,n.height)),_.updateIfChanged(r.dSubstance,e>0),_.updateIfChanged(r.dSubstanceType,t),r):{tSubstance:_.create(n),uSubstanceTexDim:_.create(Ce.create(n.width,n.height)),dSubstance:_.create(e>0),tSubstanceGrid:_.create(qo()),uSubstanceGridDim:_.create(b.create(1,1,1)),uSubstanceGridTransform:_.create(Et.create(0,0,0,1)),dSubstanceType:_.create(t),uSubstanceStrength:_.create(1)}}var abe={array:new Uint8Array(4),width:1,height:1};function Jl(e){return e?(_.update(e.tSubstance,abe),_.update(e.uSubstanceTexDim,Ce.create(1,1)),e):{tSubstance:_.create(abe),uSubstanceTexDim:_.create(Ce.create(1,1)),dSubstance:_.create(!1),tSubstanceGrid:_.create(qo()),uSubstanceGridDim:_.create(b.create(1,1,1)),uSubstanceGridTransform:_.create(Et.create(0,0,0,1)),dSubstanceType:_.create("groupInstance"),uSubstanceStrength:_.create(1)}}function cbe(e,t,r,n){for(let o=t;o<r;++o)e[o]=n*255;return!0}function _7(e,t){if(t===0||e.length<t)return 0;let r=0;for(let n=0;n<t;++n)r+=e[n];return r/(255*t)}function mbe(e,t,r){e.fill(0,t,r)}function dbe(e,t,r){let n=So(Math.max(1,e),1,Uint8Array,r&&r.tEmissive.ref.value.array);return r?(_.update(r.tEmissive,n),_.update(r.uEmissiveTexDim,Ce.create(n.width,n.height)),_.updateIfChanged(r.dEmissive,e>0),_.updateIfChanged(r.emissiveAverage,_7(n.array,e)),_.updateIfChanged(r.dEmissiveType,t),r):{tEmissive:_.create(n),uEmissiveTexDim:_.create(Ce.create(n.width,n.height)),dEmissive:_.create(e>0),emissiveAverage:_.create(0),tEmissiveGrid:_.create(qo()),uEmissiveGridDim:_.create(b.create(1,1,1)),uEmissiveGridTransform:_.create(Et.create(0,0,0,1)),dEmissiveType:_.create(t),uEmissiveStrength:_.create(1)}}var ube={array:new Uint8Array(1),width:1,height:1};function $l(e){return e?(_.update(e.tEmissive,ube),_.update(e.uEmissiveTexDim,Ce.create(1,1)),e):{tEmissive:_.create(ube),uEmissiveTexDim:_.create(Ce.create(1,1)),dEmissive:_.create(!1),emissiveAverage:_.create(0),tEmissiveGrid:_.create(qo()),uEmissiveGridDim:_.create(b.create(1,1,1)),uEmissiveGridTransform:_.create(Et.create(0,0,0,1)),dEmissiveType:_.create("groupInstance"),uEmissiveStrength:_.create(1)}}function vp(){return C.Group({color:C.Color(Le.fromRgb(76,76,76)),colorStrength:C.Numeric(1,{min:0,max:1,step:.01}),substance:Hi.getParam(),substanceStrength:C.Numeric(1,{min:0,max:1,step:.01})})}function pbe(e,t){return e.color===t.color&&e.colorStrength===t.colorStrength&&Hi.areEqual(e.substance,t.substance)&&e.substanceStrength===t.substanceStrength}function Ip(e,t){return Le.toArrayNormalized(e.color,t,0),t[3]=e.colorStrength,t}function Ap(e,t){return Hi.toArrayNormalized(e.substance,t,0),t[3]=e.substanceStrength,t}var ft;(M=>{function e(D,B,k,F,z,j,Y){return Y?o(D,B,k,F,z,j,Y):n(D,B,k,F,z,j)}M.create=e;function t(D){let B=D?D.vertexBuffer.ref.value:new Float32Array(0),k=D?D.indexBuffer.ref.value:new Uint32Array(0),F=D?D.normalBuffer.ref.value:new Float32Array(0),z=D?D.groupBuffer.ref.value:new Float32Array(0);return e(B,k,F,z,0,0,D)}M.createEmpty=t;function r(D){return ui([D.vertexCount,D.triangleCount,D.vertexBuffer.ref.version,D.indexBuffer.ref.version,D.normalBuffer.ref.version,D.groupBuffer.ref.version])}function n(D,B,k,F,z,j){let Y=he(),G,X=-1,U=-1,L={kind:"mesh",vertexCount:z,triangleCount:j,vertexBuffer:_.create(D),indexBuffer:_.create(B),normalBuffer:_.create(k),groupBuffer:_.create(F),varyingGroup:_.create(!1),get boundingSphere(){let q=r(L);if(q!==X){let te=Vm(L.vertexBuffer.ref.value,L.vertexCount,1);he.copy(Y,te),X=q}return Y},get groupMapping(){return L.groupBuffer.ref.version!==U&&(G=Cp(L.groupBuffer.ref.value,L.vertexCount),U=L.groupBuffer.ref.version),G},setBoundingSphere(q){he.copy(Y,q),X=r(L)},meta:{}};return L}function o(D,B,k,F,z,j,Y){return Y.vertexCount=z,Y.triangleCount=j,_.update(Y.vertexBuffer,D),_.update(Y.indexBuffer,B),_.update(Y.normalBuffer,k),_.update(Y.groupBuffer,F),Y}function i(D){let{vertexCount:B,triangleCount:k}=D,F=D.vertexBuffer.ref.value,z=D.indexBuffer.ref.value,j=D.normalBuffer.ref.value.length>=B*3?D.normalBuffer.ref.value:new Float32Array(B*3);j===D.normalBuffer.ref.value&&j.fill(0,0,B*3),Dk(F,z,j,B,k),_.update(D.normalBuffer,j)}M.computeNormals=i;function a(D,B=3){let k=D.vertexBuffer.ref.value,F=new Map,z=(G,X)=>`${G[0].toFixed(X)}|${G[1].toFixed(X)}|${G[2].toFixed(X)}`,j=0,Y=b();for(let G=0,X=D.vertexCount;G<X;++G){b.fromArray(Y,k,G*3);let U=z(Y,B),L=F.get(U);L!==void 0?(j+=1,F.set(U,L+1)):F.set(U,1)}return j}M.checkForDuplicateVertices=a;let s=Mt();function l(D,B){let k=D.vertexBuffer.ref.value;if(Zc(B,k,0,D.vertexCount),!H.isTranslationAndUniformScaling(B)){let F=Mt.directionTransform(s,B);ihe(F,D.normalBuffer.ref.value,0,D.vertexCount)}_.update(D.vertexBuffer,k)}M.transform=l;function u(D){let{originalData:B}="kind"in D?D.meta:D.meta.ref.value;return B}M.getOriginalData=u;function c(D,B=!0){let{indexBuffer:k,vertexBuffer:F,groupBuffer:z,normalBuffer:j,triangleCount:Y,vertexCount:G}=D,X=k.ref.value,U=F.ref.value,L=z.ref.value,q=j.ref.value,te=qe.create(Uint32Array,3,1024,Y),J=qe.create(Float32Array,3,1024,U);J.currentIndex=G*3,J.elementCount=G;let ee=qe.create(Float32Array,3,1024,q);ee.currentIndex=G*3,ee.elementCount=G;let ce=qe.create(Float32Array,1,1024,L);ce.currentIndex=G,ce.elementCount=G;let fe=b(),O=b(),V=b(),Z=b(),pe=b(),$=b();function ae(be){b.fromArray(fe,U,be*3),b.fromArray(Z,q,be*3),qe.add3(J,fe[0],fe[1],fe[2]),qe.add3(ee,Z[0],Z[1],Z[2])}function Se(be,Re){b.fromArray(fe,U,be*3),b.fromArray(O,U,Re*3),b.scale(fe,b.add(fe,fe,O),.5),b.fromArray(Z,q,be*3),b.fromArray(pe,q,Re*3),b.scale(Z,b.add(Z,Z,pe),.5),qe.add3(J,fe[0],fe[1],fe[2]),qe.add3(ee,Z[0],Z[1],Z[2])}function ve(be,Re,Fe){b.fromArray(fe,U,be*3),b.fromArray(O,U,Re*3),b.fromArray(V,U,Fe*3),b.scale(fe,b.add(fe,b.add(fe,fe,O),V),1/3),b.fromArray(Z,q,be*3),b.fromArray(pe,q,Re*3),b.fromArray($,q,Fe*3),b.scale(Z,b.add(Z,b.add(Z,Z,pe),$),1/3),qe.add3(J,fe[0],fe[1],fe[2]),qe.add3(ee,Z[0],Z[1],Z[2])}function K(be,Re,Fe,Ne,ot){++le,ae(be),Se(be,Re),Se(be,Fe),qe.add3(te,re,re+1,re+2);for(let it=0;it<3;++it)qe.add(ce,Ne);re+=3,le+=2,ae(Re),ae(Fe),Se(be,Re),Se(be,Fe),qe.add3(te,re,re+1,re+3),qe.add3(te,re,re+3,re+2);for(let it=0;it<4;++it)qe.add(ce,ot);re+=4}let re=G,le=0;if(B)for(let be=0,Re=Y;be<Re;++be){let Fe=X[be*3],Ne=X[be*3+1],ot=X[be*3+2],it=L[Fe],Xt=L[Ne],$r=L[ot];if(it===Xt&&it===$r)++le,qe.add3(te,Fe,Ne,ot);else if(it===Xt)K(ot,Fe,Ne,$r,it);else if(it===$r)K(Ne,ot,Fe,Xt,$r);else if(Xt===$r)K(Fe,Ne,ot,it,Xt);else{le+=2,ae(Fe),Se(Fe,Ne),Se(Fe,ot),ve(Fe,Ne,ot),qe.add3(te,re,re+1,re+3),qe.add3(te,re,re+3,re+2);for(let bt=0;bt<4;++bt)qe.add(ce,it);re+=4,le+=2,ae(Ne),Se(Ne,ot),Se(Ne,Fe),ve(Fe,Ne,ot),qe.add3(te,re,re+1,re+3),qe.add3(te,re,re+3,re+2);for(let bt=0;bt<4;++bt)qe.add(ce,Xt);re+=4,le+=2,ae(ot),Se(ot,Ne),Se(ot,Fe),ve(Fe,Ne,ot),qe.add3(te,re+3,re+1,re),qe.add3(te,re+2,re+3,re);for(let bt=0;bt<4;++bt)qe.add(ce,$r);re+=4}}else for(let be=0,Re=Y;be<Re;++be){let Fe=X[be*3],Ne=X[be*3+1],ot=X[be*3+2],it=L[Fe],Xt=L[Ne],$r=L[ot];if(it!==Xt||it!==$r){++le,ae(Fe),ae(Ne),ae(ot),qe.add3(te,re,re+1,re+2);let bt=Xt===$r?Xt:it;for(let xr=0;xr<3;++xr)qe.add(ce,bt);re+=3}else++le,qe.add3(te,Fe,Ne,ot)}let ge=qe.compact(te),Ee=qe.compact(J),nt=qe.compact(ee),at=qe.compact(ce);return D.vertexCount=re,D.triangleCount=le,_.update(F,Ee),_.update(z,at),_.update(k,ge),_.update(j,nt),D.meta.originalData={indexBuffer:X,vertexCount:G,triangleCount:Y},D}M.uniformTriangleGroup=c;function m(D){let{vertexCount:B,triangleCount:k}=D,F=D.indexBuffer.ref.value,z=[];for(let j=0;j<B;++j)z[j]=[];for(let j=0;j<k;++j){let Y=F[j*3],G=F[j*3+1],X=F[j*3+2];li(z[Y],G),li(z[Y],X),li(z[G],Y),li(z[G],X),li(z[X],Y),li(z[X],G)}return z}function d(D){let{triangleCount:B}=D,k=D.indexBuffer.ref.value,F=new Map,z=(j,Y)=>{let G=Mc(j,Y),X=F.get(G)||0;F.set(G,X+1)};for(let j=0;j<B;++j){let Y=k[j*3],G=k[j*3+1],X=k[j*3+2];z(Y,G),z(Y,X),z(G,X)}return F}function p(D){let B=new Set,k=[0,0];return D.forEach((F,z)=>{F===1&&(Ov(k,z),B.add(k[0]),B.add(k[1]))}),B}function h(D,B,k){let F=new Map,z=(j,Y)=>{F.has(j)?li(F.get(j),Y):F.set(j,[Y])};return B.forEach(j=>{let Y=D[j];for(let G of Y)B.has(G)&&k.get(Mc(j,G))===1&&z(j,G)}),F}function f(D,B){let{indexBuffer:k,triangleCount:F}=D,z=k.ref.value,j=qe.create(Uint32Array,3,1024,F),Y=0;for(let X=0;X<F;++X){let U=z[X*3],L=z[X*3+1],q=z[X*3+2];B[U].length===2||B[L].length===2||B[q].length===2||(qe.add3(j,U,L,q),Y+=1)}let G=qe.compact(j);return D.triangleCount=Y,_.update(k,G),D}function g(D,B,k,F){let{vertexBuffer:z,indexBuffer:j,normalBuffer:Y,triangleCount:G}=D,X=z.ref.value,U=j.ref.value,L=Y.ref.value,q=qe.create(Uint32Array,3,1024,G),te=0;for(let le=0;le<G;++le)qe.add3(q,U[le*3],U[le*3+1],U[le*3+2]),te+=1;let J=b(),ee=b(),ce=b(),fe=b(),O=b(),V=b(),Z=b(),pe=b(),$=b(),ae=b(),Se=kr(120),ve=new Set,K=Array.from(k.keys()).filter(le=>k.get(le).length<2).map(le=>{let ge=k.get(le);return b.fromArray(J,X,le*3),b.fromArray(ee,X,ge[0]*3),b.fromArray(ce,X,ge[1]*3),b.sub(O,ee,J),b.sub(V,ce,J),[le,b.angle(O,V)]});K.sort(([,le],[,ge])=>le-ge);for(let[le,ge]of K){if(ve.has(le)||ge>Se)continue;let Ee=k.get(le);if(B[Ee[0]].includes(Ee[1])&&!k.get(Ee[0])?.includes(Ee[1])||(b.fromArray(J,X,le*3),b.fromArray(ee,X,Ee[0]*3),b.fromArray(ce,X,Ee[1]*3),b.sub(O,ee,J),b.sub(V,ce,J),b.add(pe,O,V),b.squaredDistance(J,ee)>=F))continue;let nt=!1;for(let at of B[le])if(!Ee.includes(at)&&(b.fromArray(fe,X,at*3),b.sub(Z,fe,J),b.dot(pe,Z)<0)){nt=!0;break}nt&&(b.fromArray($,L,le*3),b.triangleNormal(ae,J,ee,ce),b.dot(ae,$)>0?qe.add3(q,le,Ee[0],Ee[1]):qe.add3(q,Ee[1],Ee[0],le),ve.add(le),ve.add(Ee[0]),ve.add(Ee[1]),te+=1)}let re=qe.compact(q);return D.triangleCount=te,_.update(j,re),D}function y(D,B,k){let{iterations:F,lambda:z}=k,j=b(),Y=b(),G=b(),X=b(),U=-z,L=new Float32Array(D.vertexBuffer.ref.value.length),q=te=>{let J=D.vertexBuffer.ref.value;L.set(J),B.forEach((ce,fe)=>{if(ce.length!==2)return;b.fromArray(j,J,fe*3),b.fromArray(Y,J,ce[0]*3),b.fromArray(G,J,ce[1]*3);let O=1/b.distance(j,Y),V=1/b.distance(j,G);b.scale(Y,Y,O),b.scale(G,G,V),b.add(X,Y,G),b.scale(X,X,1/(O+V)),b.sub(X,X,j),b.scale(X,X,te),b.add(X,j,X),b.toArray(X,L,fe*3)});let ee=D.vertexBuffer.ref.value;_.update(D.vertexBuffer,L),L=ee};for(let te=0;te<F;++te)q(z),q(U)}function x(D,B){f(D,m(D));for(let Y=0;Y<10;++Y){let G=D.triangleCount,X=d(D),U=m(D),L=p(X),q=h(U,L,X);if(g(D,U,q,B.maxNewEdgeLength*B.maxNewEdgeLength),D.triangleCount===G)break}let k=d(D),F=m(D),z=p(k),j=h(F,z,k);return y(D,j,{iterations:B.iterations,lambda:.5}),D}M.smoothEdges=x,M.Params={...Xe.Params,doubleSided:C.Boolean(!1,Xe.CustomQualityParamInfo),flipSided:C.Boolean(!1,Xe.ShadingCategory),flatShaded:C.Boolean(!1,Xe.ShadingCategory),ignoreLight:C.Boolean(!1,Xe.ShadingCategory),celShaded:C.Boolean(!1,Xe.ShadingCategory),xrayShaded:C.Select(!1,[[!1,"Off"],[!0,"On"],["inverted","Inverted"]],Xe.ShadingCategory),transparentBackfaces:C.Select("off",C.arrayToOptions(["off","on","opaque"]),Xe.ShadingCategory),bumpFrequency:C.Numeric(0,{min:0,max:10,step:.1},Xe.ShadingCategory),bumpAmplitude:C.Numeric(1,{min:0,max:5,step:.1},Xe.ShadingCategory),interior:vp()},M.Utils={Params:M.Params,createEmpty:t,createValues:A,createValuesSimple:P,updateValues:T,updateBoundingSphere:R,createRenderableState:w,updateRenderableState:E,createPositionIterator:v};function v(D,B){let k=D.vertexCount,F=B.instanceCount.ref.value,z=zs(),j=z.position,Y=z.normal,G=D.vertexBuffer.ref.value,X=D.normalBuffer.ref.value,U=B.aTransform.ref.value;return un(k,F,1,(q,te)=>(te<0?(b.fromArray(j,G,q*3),b.fromArray(Y,X,q*3)):(b.transformMat4Offset(j,G,U,0,q*3,te*16),b.transformDirectionOffset(Y,X,U,0,q*3,te*16)),z))}function A(D,B,k,F,z){let{instanceCount:j,groupCount:Y}=k,G=v(D,B),X=ya(k,G,F.color),U=z.instanceGranularity?yo(j,"instance"):yo(j*Y,"groupInstance"),L=ql(),q=Yl(),te=$l(),J=Jl(),ee=Kl(),ce={drawCount:D.triangleCount*3,vertexCount:D.vertexCount,groupCount:Y,instanceCount:j},fe=he.clone(D.boundingSphere),O=Li(fe,B.aTransform.ref.value,j,0);return{dGeometryType:_.create("mesh"),aPosition:D.vertexBuffer,aNormal:D.normalBuffer,aGroup:D.groupBuffer,elements:D.indexBuffer,dVaryingGroup:D.varyingGroup,boundingSphere:_.create(O),invariantBoundingSphere:_.create(fe),uInvariantBoundingSphere:_.create(Et.ofSphere(fe)),...X,...U,...L,...q,...te,...J,...ee,...B,...Xe.createValues(z,ce),uDoubleSided:_.create(z.doubleSided),dFlatShaded:_.create(z.flatShaded),dFlipSided:_.create(z.flipSided),dIgnoreLight:_.create(z.ignoreLight),dCelShaded:_.create(z.celShaded),dXrayShaded:_.create(z.xrayShaded==="inverted"?"inverted":z.xrayShaded===!0?"on":"off"),dTransparentBackfaces:_.create(z.transparentBackfaces),uBumpFrequency:_.create(z.bumpFrequency),uBumpAmplitude:_.create(z.bumpAmplitude),uInteriorColor:_.create(Ip(z.interior,Et())),uInteriorSubstance:_.create(Ap(z.interior,Et())),meta:_.create(D.meta)}}function P(D,B,k,F,z){let j=Xe.createSimple(k,F,z),Y={...C.getDefaultValues(M.Params),...B};return A(D,j.transform,j.locationIterator,j.theme,Y)}function T(D,B){Xe.updateValues(D,B),_.updateIfChanged(D.uDoubleSided,B.doubleSided),_.updateIfChanged(D.dFlatShaded,B.flatShaded),_.updateIfChanged(D.dFlipSided,B.flipSided),_.updateIfChanged(D.dIgnoreLight,B.ignoreLight),_.updateIfChanged(D.dCelShaded,B.celShaded),_.updateIfChanged(D.dXrayShaded,B.xrayShaded==="inverted"?"inverted":B.xrayShaded===!0?"on":"off"),_.updateIfChanged(D.dTransparentBackfaces,B.transparentBackfaces),_.updateIfChanged(D.uBumpFrequency,B.bumpFrequency),_.updateIfChanged(D.uBumpAmplitude,B.bumpAmplitude),_.update(D.uInteriorColor,Ip(B.interior,D.uInteriorColor.ref.value)),_.update(D.uInteriorSubstance,Ap(B.interior,D.uInteriorSubstance.ref.value))}function R(D,B){let k=he.clone(B.boundingSphere),F=Li(k,D.aTransform.ref.value,D.instanceCount.ref.value,0);he.equals(F,D.boundingSphere.ref.value)||_.update(D.boundingSphere,F),he.equals(k,D.invariantBoundingSphere.ref.value)||(_.update(D.invariantBoundingSphere,k),_.update(D.uInvariantBoundingSphere,Et.fromSphere(D.uInvariantBoundingSphere.ref.value,k)))}function w(D){let B=Xe.createRenderableState(D);return E(B,D),B}function E(D,B){Xe.updateRenderableState(D,B),D.opaque=D.opaque&&!B.xrayShaded,D.writeDepth=D.opaque}})(ft||={});function qf(e,t,r){return e=_r(Math.round(e),0,16777215)+1,t[r+2]=e%256,e=Math.floor(e/256),t[r+1]=e%256,e=Math.floor(e/256),t[r]=e%256,t}function xC(e,t,r){return Math.floor(e)*256*256+Math.floor(t)*256+Math.floor(r)-1}var jk=255/256,R7=b.create(256*256*256,256*256,256),Cqe=Et.create(jk/R7[0],jk/R7[1],jk/R7[2],jk/1),fbe=Et();function hbe(e,t,r,n){return Et.set(fbe,e/255,t/255,r/255,n/255),Et.dot(fbe,Cqe)}function gbe(e,t){let r=-1/0;for(let n=0,o=e.length;n<o;n+=t){let i=xC(e[n],e[n+1],e[n+2]);i>r&&(r=i)}return r}function eu(e,t,r){switch(ba.getGranularity(e,t.granularity)){case"uniform":return Aqe(e,t.size,r);case"group":return Pqe(e,t.size,r);case"groupInstance":return _qe(e,t.size,r);case"instance":return Tqe(e,t.size,r)}}var Wk=100;function CC(e){switch(e.dSizeType.ref.value){case"uniform":return e.uSize.ref.value;case"instance":case"group":case"groupInstance":let r=0,n=e.tSize.ref.value.array;for(let o=0,i=n.length;o<i;o+=3){let a=xC(n[o],n[o+1],n[o+2]);r<a&&(r=a)}return r/Wk}}var Sqe={array:new Uint8Array(3),width:1,height:1};function vqe(){return{tSize:_.create(Sqe),uSizeTexDim:_.create(Ce.create(1,1))}}function Iqe(e,t){return t?(_.update(t.uSize,e),_.updateIfChanged(t.dSizeType,"uniform"),t):{uSize:_.create(e),...vqe(),dSizeType:_.create("uniform")}}function Aqe(e,t,r){e.reset();let n=e.hasNext?e.move().location:Vu;return Iqe(t(n),r)}function D7(e,t,r){return r?(_.update(r.tSize,e),_.update(r.uSizeTexDim,Ce.create(e.width,e.height)),_.updateIfChanged(r.dSizeType,t),r):{uSize:_.create(0),tSize:_.create(e),uSizeTexDim:_.create(Ce.create(e.width,e.height)),dSizeType:_.create(t)}}function Tqe(e,t,r){let{instanceCount:n}=e,o=So(Math.max(1,n),3,Uint8Array,r&&r.tSize.ref.value.array);for(e.reset();e.hasNext&&!e.isNextNewInstance;){let i=e.move();qf(t(i.location)*Wk,o.array,i.instanceIndex*3),e.skipInstance()}return D7(o,"instance",r)}function Pqe(e,t,r){let{groupCount:n}=e,o=So(Math.max(1,n),3,Uint8Array,r&&r.tSize.ref.value.array);for(e.reset();e.hasNext&&!e.isNextNewInstance;){let i=e.move();qf(t(i.location)*Wk,o.array,i.groupIndex*3)}return D7(o,"group",r)}function _qe(e,t,r){let{groupCount:n,instanceCount:o}=e,i=o*n,a=So(Math.max(1,i),3,Uint8Array,r&&r.tSize.ref.value.array);for(e.reset();e.hasNext;){let s=e.move();qf(t(s.location)*Wk,a.array,s.index*3)}return D7(a,"groupInstance",r)}var Dl;(y=>{function e(x,S,I,v){return v?o(x,S,I,v):n(x,S,I)}y.create=e;function t(x){let S=x?x.centerBuffer.ref.value:new Float32Array(0),I=x?x.groupBuffer.ref.value:new Float32Array(0);return e(S,I,0,x)}y.createEmpty=t;function r(x){return ui([x.pointCount,x.centerBuffer.ref.version,x.groupBuffer.ref.version])}function n(x,S,I){let v=he(),A,P=-1,T=-1,R={kind:"points",pointCount:I,centerBuffer:_.create(x),groupBuffer:_.create(S),get boundingSphere(){let w=r(R);if(w!==P){let E=Vm(R.centerBuffer.ref.value,R.pointCount,1);he.copy(v,E),P=w}return v},get groupMapping(){return R.groupBuffer.ref.version!==T&&(A=Cp(R.groupBuffer.ref.value,R.pointCount),T=R.groupBuffer.ref.version),A},setBoundingSphere(w){he.copy(v,w),P=r(R)}};return R}function o(x,S,I,v){return v.pointCount=I,_.update(v.centerBuffer,x),_.update(v.groupBuffer,S),v}function i(x,S){let I=x.centerBuffer.ref.value;Zc(S,I,0,x.pointCount),_.update(x.centerBuffer,I)}y.transform=i,y.StyleTypes={square:"Square",circle:"Circle",fuzzy:"Fuzzy"},y.StyleTypeNames=Object.keys(y.StyleTypes),y.Params={...Xe.Params,sizeFactor:C.Numeric(3,{min:0,max:10,step:.1}),pointSizeAttenuation:C.Boolean(!1),pointStyle:C.Select("square",C.objectToOptions(y.StyleTypes))},y.Utils={Params:y.Params,createEmpty:t,createValues:m,createValuesSimple:d,updateValues:p,updateBoundingSphere:h,createRenderableState:f,updateRenderableState:g,createPositionIterator:c};function c(x,S){let I=x.pointCount,v=S.instanceCount.ref.value,A=zs(),P=A.position,T=x.centerBuffer.ref.value,R=S.aTransform.ref.value;return un(I,v,1,(E,M)=>(M<0?b.fromArray(P,T,E*3):b.transformMat4Offset(P,T,R,0,E*3,M*16),A))}function m(x,S,I,v,A){let{instanceCount:P,groupCount:T}=I,R=c(x,S),w=ya(I,R,v.color),E=eu(I,v.size),M=A.instanceGranularity?yo(P,"instance"):yo(P*T,"groupInstance"),D=ql(),B=Yl(),k=$l(),F=Jl(),z=Kl(),j={drawCount:x.pointCount,vertexCount:x.pointCount,groupCount:T,instanceCount:P},Y=he.clone(x.boundingSphere),G=Li(Y,S.aTransform.ref.value,P,0);return{dGeometryType:_.create("points"),aPosition:x.centerBuffer,aGroup:x.groupBuffer,boundingSphere:_.create(G),invariantBoundingSphere:_.create(Y),uInvariantBoundingSphere:_.create(Et.ofSphere(Y)),...w,...E,...M,...D,...B,...k,...F,...z,...S,...Xe.createValues(A,j),uSizeFactor:_.create(A.sizeFactor),dPointSizeAttenuation:_.create(A.pointSizeAttenuation),dPointStyle:_.create(A.pointStyle)}}function d(x,S,I,v,A){let P=Xe.createSimple(I,v,A),T={...C.getDefaultValues(y.Params),...S};return m(x,P.transform,P.locationIterator,P.theme,T)}function p(x,S){Xe.updateValues(x,S),_.updateIfChanged(x.uSizeFactor,S.sizeFactor),_.updateIfChanged(x.dPointSizeAttenuation,S.pointSizeAttenuation),_.updateIfChanged(x.dPointStyle,S.pointStyle)}function h(x,S){let I=he.clone(S.boundingSphere),v=Li(I,x.aTransform.ref.value,x.instanceCount.ref.value,0);he.equals(v,x.boundingSphere.ref.value)||_.update(x.boundingSphere,v),he.equals(I,x.invariantBoundingSphere.ref.value)||(_.update(x.invariantBoundingSphere,I),_.update(x.uInvariantBoundingSphere,Et.fromSphere(x.uInvariantBoundingSphere.ref.value,I)))}function f(x){let S=Xe.createRenderableState(x);return g(S,x),S}function g(x,S){Xe.updateRenderableState(x,S),x.opaque=x.opaque&&S.pointStyle!=="fuzzy",x.writeDepth=x.opaque}})(Dl||={});function w7(e,t,r,n,o,i,a){for(let s=0;s<t;s++){for(let l=0;l<r;l++)n[l]=e[l*t+s];ybe(n,o,i,a,r);for(let l=0;l<r;l++)e[l*t+s]=o[l]}for(let s=0;s<r;s++){for(let l=0;l<t;l++)n[l]=e[s*t+l];ybe(n,o,i,a,t);for(let l=0;l<t;l++)e[s*t+l]=Math.sqrt(o[l])}}function ybe(e,t,r,n,o){r[0]=0,n[0]=Number.MIN_SAFE_INTEGER,n[1]=Number.MAX_SAFE_INTEGER;for(let i=1,a=0;i<o;i++){let s=(e[i]+i*i-(e[r[a]]+r[a]*r[a]))/(2*i-2*r[a]);for(;s<=n[a];)a--,s=(e[i]+i*i-(e[r[a]]+r[a]*r[a]))/(2*i-2*r[a]);a++,r[a]=i,n[a]=s,n[a+1]=Number.MAX_SAFE_INTEGER}for(let i=0,a=0;i<o;i++){for(;n[a+1]<i;)a++;t[i]=(i-r[a])*(i-r[a])+e[r[a]]}}var M7={};function xbe(e){let t=JSON.stringify(e);return M7[t]===void 0&&(M7[t]=new B7(e)),M7[t]}var E7={fontFamily:C.Select("sans-serif",[["sans-serif","Sans Serif"],["monospace","Monospace"],["serif","Serif"],["cursive","Cursive"]]),fontQuality:C.Select(3,[[0,"lower"],[1,"low"],[2,"medium"],[3,"high"],[4,"higher"]]),fontStyle:C.Select("normal",[["normal","Normal"],["italic","Italic"],["oblique","Oblique"]]),fontVariant:C.Select("normal",[["normal","Normal"],["small-caps","Small Caps"]]),fontWeight:C.Select("normal",[["normal","Normal"],["bold","Bold"]])},B7=class{constructor(t={}){this.mapped={};this.scratchW=0;this.scratchH=0;this.currentX=0;this.currentY=0;this.cutoff=.5;let r={...C.getDefaultValues(E7),...t};this.props=r;let n=32*(r.fontQuality+1);this.buffer=n/8,this.radius=n/3,this.lineHeight=Math.round(n+2*this.buffer+this.radius),this.maxWidth=Math.round(this.lineHeight*.75),this.texture=So(350*this.lineHeight*this.maxWidth,1,Uint8Array),this.scratchContext=Dqe(this.maxWidth,this.lineHeight,{willReadFrequently:!0}),this.scratchContext.font=`${r.fontStyle} ${r.fontVariant} ${r.fontWeight} ${n}px ${r.fontFamily}`,this.scratchContext.fillStyle="black",this.scratchContext.textBaseline="middle",this.scratchData=new Uint8Array(this.lineHeight*this.maxWidth),this.gridOuter=new Float64Array(this.lineHeight*this.maxWidth),this.gridInner=new Float64Array(this.lineHeight*this.maxWidth),this.f=new Float64Array(Math.max(this.lineHeight,this.maxWidth)),this.d=new Float64Array(Math.max(this.lineHeight,this.maxWidth)),this.z=new Float64Array(Math.max(this.lineHeight,this.maxWidth)+1),this.v=new Int16Array(Math.max(this.lineHeight,this.maxWidth)),this.middle=Math.ceil(this.lineHeight/2),this.placeholder=this.get("\uFFFD")}get(t){if(this.mapped[t]===void 0){this.draw(t);let{array:r,width:n,height:o}=this.texture,i=this.scratchData;if(this.currentX+this.scratchW>n&&(this.currentX=0,this.currentY+=this.scratchH),this.currentY+this.scratchH>o)return console.warn("canvas to small"),this.placeholder;this.mapped[t]={x:this.currentX,y:this.currentY,w:this.scratchW,h:this.scratchH,nw:this.scratchW/this.lineHeight,nh:this.scratchH/this.lineHeight};for(let a=0;a<this.scratchH;++a)for(let s=0;s<this.scratchW;++s)r[n*(this.currentY+a)+this.currentX+s]=i[a*this.scratchW+s];this.currentX+=this.scratchW}return this.mapped[t]}draw(t){let r=this.lineHeight,n=this.scratchContext,o=this.scratchData,i=n.measureText(t),a=Math.min(this.maxWidth,Math.ceil(i.width+2*this.buffer)),s=a*r;n.clearRect(0,0,a,r),n.fillText(t,this.buffer,this.middle);let l=n.getImageData(0,0,a,r);for(let u=0;u<s;u++){let c=l.data[u*4+3]/255;this.gridOuter[u]=c===1?0:c===0?Number.MAX_SAFE_INTEGER:Math.pow(Math.max(0,.5-c),2),this.gridInner[u]=c===1?Number.MAX_SAFE_INTEGER:c===0?0:Math.pow(Math.max(0,c-.5),2)}w7(this.gridOuter,a,r,this.f,this.d,this.v,this.z),w7(this.gridInner,a,r,this.f,this.d,this.v,this.z);for(let u=0;u<s;u++){let c=this.gridOuter[u]-this.gridInner[u];o[u]=Math.max(0,Math.min(255,Math.round(255-255*(c/this.radius+this.cutoff))))}this.scratchW=a,this.scratchH=r}},bbe;function Rqe(){if(!bbe)throw new Error("When running in Node.js and wanting to use Canvas API, call mol-util/data-source's setCanvasModule function first and pass imported `canvas` module to it.");return bbe}function Dqe(e,t,r){if(Of)return Rqe().createCanvas(e,t).getContext("2d",r);{let n=document.createElement("canvas");return n.width=e,n.height=t,n.getContext("2d",r)}}var na;(h=>{function e(f,g,y,x,S,I,v,A,P){return P?o(f,g,y,x,S,I,v,A,P):n(f,g,y,x,S,I,v,A)}h.create=e;function t(f){let g=f?f.fontTexture.ref.value:So(0,1,Uint8Array),y=f?f.centerBuffer.ref.value:new Float32Array(0),x=f?f.mappingBuffer.ref.value:new Float32Array(0),S=f?f.depthBuffer.ref.value:new Float32Array(0),I=f?f.indexBuffer.ref.value:new Uint32Array(0),v=f?f.groupBuffer.ref.value:new Float32Array(0),A=f?f.tcoordBuffer.ref.value:new Float32Array(0);return e(g,y,x,S,I,v,A,0,f)}h.createEmpty=t;function r(f){return ui([f.charCount,f.fontTexture.ref.version,f.centerBuffer.ref.version,f.mappingBuffer.ref.version,f.depthBuffer.ref.version,f.indexBuffer.ref.version,f.groupBuffer.ref.version,f.tcoordBuffer.ref.version])}function n(f,g,y,x,S,I,v,A){let P=he(),T,R=-1,w=-1,E={kind:"text",charCount:A,fontTexture:_.create(f),centerBuffer:_.create(g),mappingBuffer:_.create(y),depthBuffer:_.create(x),indexBuffer:_.create(S),groupBuffer:_.create(I),tcoordBuffer:_.create(v),get boundingSphere(){let M=r(E);if(M!==R){let D=Vm(E.centerBuffer.ref.value,E.charCount*4,4);he.copy(P,D),R=M}return P},get groupMapping(){return E.groupBuffer.ref.version!==w&&(T=Cp(E.groupBuffer.ref.value,E.charCount,4),w=E.groupBuffer.ref.version),T},setBoundingSphere(M){he.copy(P,M),R=r(E)}};return E}function o(f,g,y,x,S,I,v,A,P){return P.charCount=A,_.update(P.fontTexture,f),_.update(P.centerBuffer,g),_.update(P.mappingBuffer,y),_.update(P.depthBuffer,x),_.update(P.indexBuffer,S),_.update(P.groupBuffer,I),_.update(P.tcoordBuffer,v),P}h.Params={...Xe.Params,...E7,sizeFactor:C.Numeric(1,{min:0,max:10,step:.1}),borderWidth:C.Numeric(0,{min:0,max:.5,step:.01}),borderColor:C.Color(Lt.grey),offsetX:C.Numeric(0,{min:0,max:10,step:.1}),offsetY:C.Numeric(0,{min:0,max:10,step:.1}),offsetZ:C.Numeric(0,{min:0,max:10,step:.1}),background:C.Boolean(!1),backgroundMargin:C.Numeric(.2,{min:0,max:1,step:.01}),backgroundColor:C.Color(Lt.grey),backgroundOpacity:C.Numeric(1,{min:0,max:1,step:.01}),tether:C.Boolean(!1),tetherLength:C.Numeric(1,{min:0,max:5,step:.1}),tetherBaseWidth:C.Numeric(.3,{min:0,max:1,step:.01}),attachment:C.Select("middle-center",[["bottom-left","bottom-left"],["bottom-center","bottom-center"],["bottom-right","bottom-right"],["middle-left","middle-left"],["middle-center","middle-center"],["middle-right","middle-right"],["top-left","top-left"],["top-center","top-center"],["top-right","top-right"]])},h.Utils={Params:h.Params,createEmpty:t,createValues:l,createValuesSimple:u,updateValues:c,updateBoundingSphere:m,createRenderableState:d,updateRenderableState:p,createPositionIterator:s};function s(f,g){let y=f.charCount*4,x=g.instanceCount.ref.value,S=zs(),I=S.position,v=f.centerBuffer.ref.value,A=g.aTransform.ref.value;return un(y,x,4,(T,R)=>(R<0?b.fromArray(I,v,T*3):b.transformMat4Offset(I,v,A,0,T*3,R*16),S))}function l(f,g,y,x,S){let{instanceCount:I,groupCount:v}=y,A=s(f,g),P=ya(y,A,x.color),T=eu(y,x.size),R=S.instanceGranularity?yo(I,"instance"):yo(I*v,"groupInstance"),w=ql(),E=Yl(),M=$l(),D=Jl(),B=Kl(),k={drawCount:f.charCount*2*3,vertexCount:f.charCount*4,groupCount:v,instanceCount:I},F=CC(T)*S.sizeFactor,z=Cbe(f.mappingBuffer.ref.value,f.depthBuffer.ref.value,f.charCount,F),j=he.expand(he(),f.boundingSphere,z),Y=Li(j,g.aTransform.ref.value,I,0);return{dGeometryType:_.create("text"),aPosition:f.centerBuffer,aMapping:f.mappingBuffer,aDepth:f.depthBuffer,aGroup:f.groupBuffer,elements:f.indexBuffer,boundingSphere:_.create(Y),invariantBoundingSphere:_.create(j),uInvariantBoundingSphere:_.create(Et.ofSphere(j)),...P,...T,...R,...w,...E,...M,...D,...B,...g,aTexCoord:f.tcoordBuffer,tFont:f.fontTexture,padding:_.create(z),...Xe.createValues(S,k),uSizeFactor:_.create(S.sizeFactor),uBorderWidth:_.create(_r(S.borderWidth,0,.5)),uBorderColor:_.create(Le.toArrayNormalized(S.borderColor,b.zero(),0)),uOffsetX:_.create(S.offsetX),uOffsetY:_.create(S.offsetY),uOffsetZ:_.create(S.offsetZ),uBackgroundColor:_.create(Le.toArrayNormalized(S.backgroundColor,b.zero(),0)),uBackgroundOpacity:_.create(S.backgroundOpacity)}}function u(f,g,y,x,S){let I=Xe.createSimple(y,x,S),v={...C.getDefaultValues(h.Params),...g};return l(f,I.transform,I.locationIterator,I.theme,v)}function c(f,g){Xe.updateValues(f,g),_.updateIfChanged(f.uSizeFactor,g.sizeFactor),_.updateIfChanged(f.uBorderWidth,g.borderWidth),Le.fromNormalizedArray(f.uBorderColor.ref.value,0)!==g.borderColor&&(Le.toArrayNormalized(g.borderColor,f.uBorderColor.ref.value,0),_.update(f.uBorderColor,f.uBorderColor.ref.value)),_.updateIfChanged(f.uOffsetX,g.offsetX),_.updateIfChanged(f.uOffsetY,g.offsetY),_.updateIfChanged(f.uOffsetZ,g.offsetZ),Le.fromNormalizedArray(f.uBackgroundColor.ref.value,0)!==g.backgroundColor&&(Le.toArrayNormalized(g.backgroundColor,f.uBackgroundColor.ref.value,0),_.update(f.uBackgroundColor,f.uBackgroundColor.ref.value)),_.updateIfChanged(f.uBackgroundOpacity,g.backgroundOpacity)}function m(f,g){let y=CC(f)*f.uSizeFactor.ref.value,x=Cbe(f.aMapping.ref.value,f.aDepth.ref.value,g.charCount,y),S=he.expand(he(),g.boundingSphere,x),I=Li(S,f.aTransform.ref.value,f.instanceCount.ref.value,0);he.equals(I,f.boundingSphere.ref.value)||_.update(f.boundingSphere,I),he.equals(S,f.invariantBoundingSphere.ref.value)||(_.update(f.invariantBoundingSphere,S),_.update(f.uInvariantBoundingSphere,Et.fromSphere(f.uInvariantBoundingSphere.ref.value,S))),_.update(f.padding,x)}function d(f){let g=Xe.createRenderableState(f);return p(g,f),g}function p(f,g){Xe.updateRenderableState(f,g),f.pickable=!1,f.opaque=!1,f.writeDepth=!0}})(na||={});function Cbe(e,t,r,n){let o=0,i=0;for(let a=0,s=r*4;a<s;++a){let l=2*a,u=Math.abs(e[l]);u>o&&(o=u);let c=Math.abs(e[l+1]);c>o&&(o=c);let m=Math.abs(t[a]);m>i&&(i=m)}return Math.max(i,n*o)}var qc=b(),Yf=b(),mR=b(),Sbe=qe.add,Xk=qe.add3,ns;(t=>{function e(r=2048,n=1024,o){let i=qe.create(Float32Array,1,n,o?o.groupBuffer.ref.value:r),a=qe.create(Float32Array,3,n,o?o.startBuffer.ref.value:r),s=qe.create(Float32Array,3,n,o?o.endBuffer.ref.value:r),l=(m,d,p,h,f,g,y)=>{for(let x=0;x<4;++x)Xk(a,m,d,p),Xk(s,h,f,g),Sbe(i,y)},u=(m,d,p)=>{for(let h=0;h<4;++h)Xk(a,m[0],m[1],m[2]),Xk(s,d[0],d[1],d[2]),Sbe(i,p)},c=(m,d,p,h)=>{let f=b.distance(m,d),g=p%2!==0,y=Math.floor((p+1)/2),x=f/(p+.5);b.setMagnitude(mR,b.sub(mR,d,m),x),b.copy(qc,m);for(let S=0;S<y;++S)b.add(qc,qc,mR),g&&S===y-1?b.copy(Yf,d):b.add(Yf,qc,mR),l(qc[0],qc[1],qc[2],Yf[0],Yf[1],Yf[2],h),b.add(qc,qc,mR)};return{add:l,addVec:u,addFixedCountDashes:c,addFixedLengthDashes:(m,d,p,h)=>{let f=b.distance(m,d);c(m,d,f/p,h)},addCage:(m,d,p)=>{let{vertices:h,edges:f}=d;for(let g=0,y=f.length;g<y;g+=2)b.fromArray(qc,h,f[g]*3),b.fromArray(Yf,h,f[g+1]*3),b.transformMat4(qc,qc,m),b.transformMat4(Yf,Yf,m),l(qc[0],qc[1],qc[2],Yf[0],Yf[1],Yf[2],p)},getLines:()=>{let m=i.elementCount/4,d=qe.compact(i,!0),p=qe.compact(a,!0),h=qe.compact(s,!0),f=o&&m<=o.lineCount?o.mappingBuffer.ref.value:new Float32Array(m*8),g=o&&m<=o.lineCount?o.indexBuffer.ref.value:new Uint32Array(m*6);return(!o||m>o.lineCount)&&wqe(m,f,g),Cn.create(f,g,d,p,h,m,o)}}}t.create=e})(ns||={});function wqe(e,t,r){for(let n=0;n<e;++n){let o=n*8;t[o]=-1,t[o+1]=-1,t[o+2]=1,t[o+3]=-1,t[o+4]=-1,t[o+5]=1,t[o+6]=1,t[o+7]=1}for(let n=0;n<e;++n){let o=n*4,i=n*6;r[i]=o,r[i+1]=o+1,r[i+2]=o+2,r[i+3]=o+1,r[i+4]=o+3,r[i+5]=o+2}}var Cn;(h=>{function e(f,g,y,x,S,I,v){return v?i(f,g,y,x,S,I,v):o(f,g,y,x,S,I)}h.create=e;function t(f){let g=f?f.mappingBuffer.ref.value:new Float32Array(0),y=f?f.indexBuffer.ref.value:new Uint32Array(0),x=f?f.groupBuffer.ref.value:new Float32Array(0),S=f?f.startBuffer.ref.value:new Float32Array(0),I=f?f.endBuffer.ref.value:new Float32Array(0);return e(g,y,x,S,I,0,f)}h.createEmpty=t;function r(f,g){let y=f.vertexBuffer.ref.value,x=f.indexBuffer.ref.value,S=f.groupBuffer.ref.value,I=ns.create(f.triangleCount*3,f.triangleCount/10,g);for(let v=0,A=f.triangleCount*3;v<A;v+=3){let P=x[v],T=x[v+1],R=x[v+2],w=y[P*3],E=y[P*3+1],M=y[P*3+2],D=y[T*3],B=y[T*3+1],k=y[T*3+2],F=y[R*3],z=y[R*3+1],j=y[R*3+2];I.add(w,E,M,D,B,k,S[P]),I.add(w,E,M,F,z,j,S[P]),I.add(D,B,k,F,z,j,S[T])}return I.getLines()}h.fromMesh=r;function n(f){return ui([f.lineCount,f.mappingBuffer.ref.version,f.indexBuffer.ref.version,f.groupBuffer.ref.version,f.startBuffer.ref.version,f.endBuffer.ref.version])}function o(f,g,y,x,S,I){let v=he(),A,P=-1,T=-1,R={kind:"lines",lineCount:I,mappingBuffer:_.create(f),indexBuffer:_.create(g),groupBuffer:_.create(y),startBuffer:_.create(x),endBuffer:_.create(S),get boundingSphere(){let w=n(R);if(w!==P){let E=Vm(R.startBuffer.ref.value,R.lineCount*4,4),M=Vm(R.endBuffer.ref.value,R.lineCount*4,4);he.expandBySphere(v,E,M),P=w}return v},get groupMapping(){return R.groupBuffer.ref.version!==T&&(A=Cp(R.groupBuffer.ref.value,R.lineCount,4),T=R.groupBuffer.ref.version),A},setBoundingSphere(w){he.copy(v,w),P=n(R)}};return R}function i(f,g,y,x,S,I,v){return I>v.lineCount&&(_.update(v.mappingBuffer,f),_.update(v.indexBuffer,g)),v.lineCount=I,_.update(v.groupBuffer,y),_.update(v.startBuffer,x),_.update(v.endBuffer,S),v}function a(f,g){let y=f.startBuffer.ref.value;Zc(g,y,0,f.lineCount*4),_.update(f.startBuffer,y);let x=f.endBuffer.ref.value;Zc(g,x,0,f.lineCount*4),_.update(f.endBuffer,x)}h.transform=a,h.Params={...Xe.Params,sizeFactor:C.Numeric(2,{min:0,max:10,step:.1}),lineSizeAttenuation:C.Boolean(!1)},h.Utils={Params:h.Params,createEmpty:t,createValues:c,createValuesSimple:m,updateValues:d,updateBoundingSphere:p,createRenderableState:Xe.createRenderableState,updateRenderableState:Xe.updateRenderableState,createPositionIterator:u};function u(f,g){let y=f.lineCount*4,x=g.instanceCount.ref.value,S=zs(),I=S.position,v=f.startBuffer.ref.value,A=f.endBuffer.ref.value,P=g.aTransform.ref.value;return un(y,x,2,(R,w)=>{let E=R%4===0?v:A;return w<0?b.fromArray(I,E,R*3):b.transformMat4Offset(I,E,P,0,R*3,w*16),S})}function c(f,g,y,x,S){let{instanceCount:I,groupCount:v}=y,A=u(f,g),P=ya(y,A,x.color),T=eu(y,x.size),R=S.instanceGranularity?yo(I,"instance"):yo(I*v,"groupInstance"),w=ql(),E=Yl(),M=$l(),D=Jl(),B=Kl(),k={drawCount:f.lineCount*2*3,vertexCount:f.lineCount*4,groupCount:v,instanceCount:I},F=he.clone(f.boundingSphere),z=Li(F,g.aTransform.ref.value,I,0);return{dGeometryType:_.create("lines"),aMapping:f.mappingBuffer,aGroup:f.groupBuffer,aStart:f.startBuffer,aEnd:f.endBuffer,elements:f.indexBuffer,boundingSphere:_.create(z),invariantBoundingSphere:_.create(F),uInvariantBoundingSphere:_.create(Et.ofSphere(F)),...P,...T,...R,...w,...E,...M,...D,...B,...g,...Xe.createValues(S,k),uSizeFactor:_.create(S.sizeFactor),dLineSizeAttenuation:_.create(S.lineSizeAttenuation),uDoubleSided:_.create(!0),dFlipSided:_.create(!1)}}function m(f,g,y,x,S){let I=Xe.createSimple(y,x,S),v={...C.getDefaultValues(h.Params),...g};return c(f,I.transform,I.locationIterator,I.theme,v)}function d(f,g){Xe.updateValues(f,g),_.updateIfChanged(f.uSizeFactor,g.sizeFactor),_.updateIfChanged(f.dLineSizeAttenuation,g.lineSizeAttenuation)}function p(f,g){let y=he.clone(g.boundingSphere),x=Li(y,f.aTransform.ref.value,f.instanceCount.ref.value,0);he.equals(x,f.boundingSphere.ref.value)||_.update(f.boundingSphere,x),he.equals(y,f.invariantBoundingSphere.ref.value)||(_.update(f.invariantBoundingSphere,y),_.update(f.uInvariantBoundingSphere,Et.fromSphere(f.uInvariantBoundingSphere.ref.value,y)))}})(Cn||={});var vbe=b(),Ibe=b(),Abe=b();function XS(e,t){let r=t.length,n=Kf(r/3);for(let o=0;o<r;o+=3)b.fromArray(vbe,e,t[o]*3),b.fromArray(Ibe,e,t[o+1]*3),b.fromArray(Abe,e,t[o+2]*3),n.add(vbe,Ibe,Abe);return n.getPrimitive()}var Qk=b();function Kf(e,t){t===void 0&&(t=e*3);let r=new Float32Array(t*3),n=new Float32Array(t*3),o=new Uint32Array(e*3),i=0,a=0;return{add:(s,l,u)=>{b.toArray(s,r,i),b.toArray(l,r,i+3),b.toArray(u,r,i+6),b.triangleNormal(Qk,s,l,u);for(let c=0;c<3;++c)b.toArray(Qk,n,i+3*c),o[a+c]=i/3+c;i+=9,a+=3},addQuad:(s,l,u,c)=>{b.toArray(s,r,i),b.toArray(l,r,i+3),b.toArray(u,r,i+6),b.toArray(c,r,i+9),b.triangleNormal(Qk,s,l,u);for(let d=0;d<4;++d)b.toArray(Qk,n,i+3*d);let m=i/3;o[a]=m,o[a+1]=m+1,o[a+2]=m+2,o[a+3]=m+2,o[a+4]=m+3,o[a+5]=m,i+=12,a+=6},getPrimitive:()=>({vertices:r,normals:n,indices:o})}}var nA=b(),Mqe=Mt();function oA(e,t){let{vertices:r,normals:n}=e,o=Mt.directionTransform(Mqe,t);for(let i=0,a=r.length;i<a;i+=3)b.transformMat4(nA,b.fromArray(nA,r,i),t),b.toArray(nA,r,i),b.transformMat3(nA,b.fromArray(nA,n,i),o),b.toArray(nA,n,i);return e}function Yc(e,t,r=-1){let n=new Float32Array(e*3),o=r===-1?e<=4?Math.sqrt(2)/2:.6:r,i=t?1:0;for(let a=0,s=e;a<s;++a){let l=(a*2+i)/e*Math.PI;n[a*3]=Math.cos(l)*o,n[a*3+1]=Math.sin(l)*o,n[a*3+2]=0}return n}function Ig(e,t){return{vertices:e,edges:t}}function F7(e){return{vertices:new Float32Array(e.vertices),edges:new Uint32Array(e.edges)}}var k7=b.zero();function L7(e,t){let{vertices:r}=e;for(let n=0,o=r.length;n<o;n+=3)b.transformMat4(k7,b.fromArray(k7,r,n),t),b.toArray(k7,r,n);return e}var ib=b(),ab=b(),sb=b(),iA=b(),ka=Yc(4,!0);function Tbe(e){let n=Kf(12,e?36:24);for(let o=0;o<4;++o){let i=(o+1)%4;b.set(ib,ka[o*3],ka[o*3+1],-.5),b.set(ab,ka[i*3],ka[i*3+1],-.5),b.set(sb,ka[i*3],ka[i*3+1],.5),b.set(iA,ka[o*3],ka[o*3+1],.5),e?n.add(ib,ab,sb):n.addQuad(ib,ab,sb,iA)}return b.set(ib,ka[0],ka[1],-.5),b.set(ab,ka[3],ka[4],-.5),b.set(sb,ka[6],ka[7],-.5),b.set(iA,ka[9],ka[10],-.5),e?n.add(sb,ab,ib):n.addQuad(iA,sb,ab,ib),b.set(ib,ka[0],ka[1],.5),b.set(ab,ka[3],ka[4],.5),b.set(sb,ka[6],ka[7],.5),b.set(iA,ka[9],ka[10],.5),e?n.add(ib,ab,sb):n.addQuad(ib,ab,sb,iA),n.getPrimitive()}var V7;function SC(){return V7||(V7=Tbe(!1)),V7}var O7;function Pbe(){return O7||(O7=Tbe(!0)),O7}var G7;function QS(){return G7||(G7=Ig([.5,.5,-.5,-.5,.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,.5,-.5,.5],[0,4,1,5,2,6,3,7,0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4])),G7}function U7(e){return e.map(t=>({x:t[0],alpha:t[1]}))}function N7(e,t){let r=[{x:0,alpha:0},{x:0,alpha:0},...e,{x:1,alpha:0},{x:1,alpha:0}],n=256,o=t?t.ref.value.array:new Uint8Array(n),i=0,a,s,l,u,c,m,d=e.length+1;for(let h=0;h<d;++h){a=r[h+1].x,s=r[h+2].x,l=r[h].alpha,u=r[h+1].alpha,c=r[h+2].alpha,m=r[h+3].alpha;let f=Math.round((s-a)*n);for(let g=0;g<f;++g){let y=g/f;o[i]=Math.max(0,kv(l,u,c,m,y,.5)*255),++i}}let p={array:o,width:256,height:1};return t?(_.update(t,p),t):_.create(p)}function Rbe(e,t,r){if(r)return _be(e,t,r.min,r.max);{let[n,o]=Qu(e);return _be(e,t,n,o)}}function _be(e,t,r,n){let o=(n-r)/t;o===0&&(o=1);let i=new Int32Array(t);for(let a=0,s=e.length;a<s;a++){let l=Math.floor((e[a]-r)/o);l>=t?l=t-1:l<0&&(l=0),i[l]++}return{min:r,max:n,binWidth:o,counts:i}}var Nn;(u=>{u.One={transform:{kind:"matrix",matrix:H.identity()},cells:Dr.create(Dr.Space([1,1,1],[0,1,2]),Dr.Data1([0])),stats:{min:0,max:0,mean:0,sigma:0}};let t=H(),r=H();function n(c){if(c.transform.kind==="matrix")return H.copy(H(),c.transform.matrix);if(c.transform.kind==="spacegroup"){let{cells:{space:m}}=c,d=H.fromScaling(t,b.div(b(),pt.size(b(),c.transform.fractionalBox),b.ofArray(m.dimensions))),p=H.fromTranslation(r,c.transform.fractionalBox.min);return H.mul3(H(),c.transform.cell.fromFractional,p,d)}return H.identity()}u.getGridToCartesianTransform=n;function o(c,m){return c===m}u.areEquivalent=o;function i(c){return c.cells.data.length===0}u.isEmpty=i;function a(c,m){m||(m=he());let d=c.cells.space.dimensions,p=u.getGridToCartesianTransform(c);return he.fromDimensionsAndTransform(m,d,p)}u.getBoundingSphere=a;function s(c,m){let d=c._historams;return d||(d=c._historams={}),d[m]||(d[m]=Rbe(c.cells.data,m,{min:c.stats.min,max:c.stats.max})),d[m]}u.getHistogram=s;function l(c,m){let d=u.getGridToCartesianTransform(c);H.invert(d,d);let p=b(),{stats:h}=c,{dimensions:f,get:g}=c.cells.space,y=c.cells.data,[x,S,I]=f;return function(A){b.copy(p,A),b.transformMat4(p,p,d);let P=Math.trunc(p[0]),T=Math.trunc(p[1]),R=Math.trunc(p[2]);if(P<0||P>=x||T<0||T>=S||R<0||R>=I)return Number.NaN;let w=p[0]-P,E=p[1]-T,M=p[2]-R,D=Math.min(P+1,x-1),B=Math.min(T+1,S-1),k=Math.min(R+1,I-1),F=g(y,P,T,R),z=g(y,D,T,R),j=g(y,P,B,R),Y=g(y,D,B,R),G=to(to(F,z,w),to(j,Y,w),E);F=g(y,P,T,k),z=g(y,D,T,k),j=g(y,P,B,k),Y=g(y,D,B,k);let X=to(to(F,z,w),to(j,Y,w),E),U=to(G,X,M);return m==="relative"?(U-h.mean)/h.sigma:U}}u.makeGetTrilinearlyInterpolated=l})(Nn||={});function Dbe(e,t){return Ae.create("Create Volume",async()=>{let{header:r,values:n}=e,o=Dr.Space(r.dim,[0,1,2],Float64Array),i;if(r.dataSetIds.length===0)i=n;else{let[u,c,m]=r.dim,d=(t?.dataIndex||0)+1,p=0,h=0;i=new Float64Array(u*c*m);for(let f=0;f<u;f++)for(let g=0;g<c;g++)for(let y=0;y<m;y++)i[p++]=n[h],h+=d}let a=Dr.create(o,Dr.Data1(i)),s=H.fromTranslation(H(),r.origin),l=H.fromBasis(H(),r.basisX,r.basisY,r.basisZ);return H.mul(s,s,l),{label:t?.label,entryId:t?.entryId,grid:{transform:{kind:"matrix",matrix:s},cells:a,stats:{min:Yb(i),max:xl(i),mean:Kb(i),sigma:Jb(i)}},instances:[{transform:H.identity()}],sourceData:Zk.create(e),customProperties:new $a,_propertyData:Object.create(null)}})}var Zk;(r=>{function e(n){return n?.kind==="cube"}r.is=e;function t(n){return{kind:"cube",name:n.name,data:n}}r.create=t})(Zk||={});function qk(e,t){return Ae.create("Create Volume",async r=>{let{volume_data_3d_info:n,volume_data_3d:o}=e,i=ha.create(n.spacegroup_number.value(0)||"P 1",b.ofArray(n.spacegroup_cell_size.value(0)),b.scale(b.zero(),b.ofArray(n.spacegroup_cell_angles.value(0)),Math.PI/180)),a=n.axis_order.value(0),s=Dr.convertToCanonicalAxisIndicesFastToSlow(a),l=s(n.sample_count.value(0)),u=Dr.Space(l,Dr.invertAxisOrder(a),Float32Array),c=Dr.create(u,Dr.Data1(o.values.toArray({array:Float32Array}))),m=b.ofArray(s(n.origin.value(0))),d=b.ofArray(s(n.dimensions.value(0)));return{label:t?.label,entryId:t?.entryId,periodicity:b.isInteger(d)?"xyz":"none",grid:{transform:{kind:"spacegroup",cell:i,fractionalBox:pt.create(m,b.add(b.zero(),m,d))},cells:c,stats:{min:n.min_sampled.value(0),max:n.max_sampled.value(0),mean:n.mean_sampled.value(0),sigma:n.sigma_sampled.value(0)}},instances:[{transform:H.identity()}],sourceData:Yk.create(e),customProperties:new $a,_propertyData:Object.create(null)}})}var Yk;(r=>{function e(n){return n?.kind==="dscif"}r.is=e;function t(n){return{kind:"dscif",name:n._name,data:n}}r.create=t})(Yk||={});var Ge;(v=>{function e(A){return A?.grid?.cells?.space?.dimensions?.length&&A?.sourceData&&A?.customProperties&&A?._propertyData}v.is=e;let t;(B=>{function A(k,F,z){return mo(E(k,z).absoluteValue,E(F,z).absoluteValue,z.sigma/100)}B.areSame=A;function P(k){return{kind:"absolute",absoluteValue:k}}B.absolute=P;function T(k){return{kind:"relative",relativeValue:k}}B.relative=T;function R(k,F){return F*k.sigma+k.mean}B.calcAbsolute=R;function w(k,F){return k.sigma===0?0:(F-k.mean)/k.sigma}B.calcRelative=w;function E(k,F){return k.kind==="absolute"?k:{kind:"absolute",absoluteValue:B.calcAbsolute(F,k.relativeValue)}}B.toAbsolute=E;function M(k,F){return k.kind==="relative"?k:{kind:"relative",relativeValue:B.calcRelative(F,k.absoluteValue)}}B.toRelative=M;function D(k){return k.kind==="relative"?`${k.relativeValue.toFixed(2)} \u03C3`:`${k.absoluteValue.toPrecision(4)}`}B.toString=D})(t=v.IsoValue||={});function r(A,P,T){if(T==="relative")return t.relative(P);let R=t.absolute(P);if(Yk.is(A.sourceData)){let w={min:A.sourceData.data.volume_data_3d_info.min_source.value(0),max:A.sourceData.data.volume_data_3d_info.max_source.value(0),mean:A.sourceData.data.volume_data_3d_info.mean_source.value(0),sigma:A.sourceData.data.volume_data_3d_info.sigma_source.value(0)};return v.IsoValue.toRelative(R,w)}return R}v.adjustedIsoValue=r;let n={min:-1,max:1,mean:0,sigma:.1};function o(A,P){let T=P||n,{min:R,max:w,mean:E,sigma:M}=T,D=(R-E)/M,B=(w-E)/M,k=A;return A.kind==="absolute"?A.absoluteValue<R?k=v.IsoValue.absolute(R):A.absoluteValue>w&&(k=v.IsoValue.absolute(w)):A.relativeValue<D?k=v.IsoValue.relative(D):A.relativeValue>B&&(k=v.IsoValue.relative(B)),C.Conditioned(k,{absolute:C.Converted(F=>v.IsoValue.toAbsolute(F,Nn.One.stats).absoluteValue,F=>v.IsoValue.absolute(F),C.Numeric(E,{min:R,max:w,step:z_(M/100,2)},{immediateUpdate:!0})),relative:C.Converted(F=>v.IsoValue.toRelative(F,Nn.One.stats).relativeValue,F=>v.IsoValue.relative(F),C.Numeric(Math.min(1,B),{min:D,max:B,step:z_(Math.round((w-R)/M)/100,2)},{immediateUpdate:!0}))},F=>F.kind==="absolute"?"absolute":"relative",(F,z)=>z==="absolute"?v.IsoValue.toAbsolute(F,T):v.IsoValue.toRelative(F,T),{isEssential:!0})}v.createIsoValueParam=o,v.IsoValueParam=o(v.IsoValue.relative(2)),v.One={label:"",grid:Nn.One,instances:[],sourceData:{kind:"",name:"",data:{}},customProperties:new $a,_propertyData:Object.create(null)};function s(A,P){return Nn.areEquivalent(A.grid,P.grid)&&l(A,P)}v.areEquivalent=s;function l(A,P){if(A.instances.length!==P.instances.length)return!1;for(let T=0,R=A.instances.length;T<R;++T)if(!H.areEqual(A.instances[T].transform,P.instances[T].transform,1e-6))return!1;return!0}v.areInstanceTransformsEqual=l;function u(A){return Nn.isEmpty(A.grid)||A.instances.length===0}v.isEmpty=u;function c(A){return Zk.is(A.sourceData)?A.sourceData.data.header.orbitals:!1}v.isOrbitals=c;function m(A,P){return{kind:"volume-loci",volume:A,instances:P}}v.Loci=m;function d(A){return!!A&&A.kind==="volume-loci"}v.isLoci=d;function p(A,P){return A.volume===P.volume&&xe.areEqual(A.instances,P.instances)}v.areLociEqual=p;function h(A){return u(A.volume)||xe.isEmpty(A.instances)}v.isLociEmpty=h;function f(A,P){return Nn.getBoundingSphere(A.grid,P)}v.getBoundingSphere=f;let g;(M=>{function A(D,B,k){return{kind:"isosurface-loci",volume:D,isoValue:B,instances:k}}M.Loci=A;function P(D){return!!D&&D.kind==="isosurface-loci"}M.isLoci=P;function T(D,B){return D.volume===B.volume&&v.IsoValue.areSame(D.isoValue,B.isoValue,D.volume.grid.stats)&&xe.areEqual(D.instances,B.instances)}M.areLociEqual=T;function R(D){return u(D.volume)||xe.isEmpty(D.instances)}M.isLociEmpty=R;let w=pt();function E(D,B,k){let F=v.IsoValue.toAbsolute(B,D.grid.stats).absoluteValue,z=F<0,j=[0,0,0],Y=D.grid.cells.space.getCoords,G=D.grid.cells.data,[X,U,L]=D.grid.cells.space.dimensions,q=X-1,te=U-1,J=L-1,ee=0,ce=0,fe=0;for(let V=0,Z=G.length;V<Z;++V)(z&&G[V]<=F||!z&&G[V]>=F)&&(Y(V,j),j[0]<q&&(q=j[0]),j[1]<te&&(te=j[1]),j[2]<J&&(J=j[2]),j[0]>ee&&(ee=j[0]),j[1]>ce&&(ce=j[1]),j[2]>fe&&(fe=j[2]));b.set(w.min,q-1,te-1,J-1),b.set(w.max,ee+1,ce+1,fe+1);let O=Nn.getGridToCartesianTransform(D.grid);return pt.transform(w,w,O),he.fromBox3D(k||he(),w)}M.getBoundingSphere=E})(g=v.Isosurface||={});let y;(z=>{function A(j,Y){return{kind:"cell-loci",volume:j,elements:Y}}z.Loci=A;function P(j){return!!j&&j.kind==="cell-loci"}z.isLoci=P;function T(j,Y){if(j.volume!==Y.volume||j.elements.length!==Y.elements.length)return!1;for(let G=0,X=j.elements.length;G<X;++G){let U=j.elements[G],L=Y.elements[G];if(!xe.areEqual(U.instances,L.instances)||!xe.areEqual(U.indices,L.indices))return!1}return!0}z.areLociEqual=T;function R(j){for(let{indices:Y,instances:G}of j.elements)if(!xe.isEmpty(G)||!xe.isEmpty(Y))return!1;return!0}z.isLociEmpty=R;function w(j){let Y=0;for(let{indices:G,instances:X}of j.elements)Y+=xe.size(G)*xe.size(X);return Y}z.getLociSize=w;function E(j,Y,G){return{kind:"cell-location",volume:j,cell:Y,instance:G}}z.Location=E;function M(j){return!!j&&j.kind==="cell-location"}z.isLocation=M;let D=new Fi("98"),B=b(),k=b();function F(j,Y,G){D.reset();let X=Nn.getGridToCartesianTransform(j.grid),{getCoords:U}=j.grid.cells.space;for(let{indices:q,instances:te}of Y)for(let J=0,ee=xe.size(q);J<ee;J++){let ce=xe.getAt(q,J);U(ce,B),b.transformMat4(B,B,X);for(let fe=0,O=xe.size(te);fe<O;fe++){let V=j.instances[xe.getAt(te,fe)];b.transformMat4(k,B,V.transform),D.includePosition(k)}}D.finishedIncludeStep();for(let{indices:q,instances:te}of Y)for(let J=0,ee=xe.size(q);J<ee;J++){let ce=xe.getAt(q,J);U(ce,B),b.transformMat4(B,B,X);for(let fe=0,O=xe.size(te);fe<O;fe++){let V=j.instances[xe.getAt(te,fe)];b.transformMat4(k,B,V.transform),D.radiusPosition(k)}}let L=D.getSphere(G);return he.expand(L,L,H.getMaxScaleOnAxis(X)*10)}z.getBoundingSphere=F})(y=v.Cell||={});let x;(z=>{function A(j,Y){return{kind:"segment-loci",volume:j,elements:Y}}z.Loci=A;function P(j){return!!j&&j.kind==="segment-loci"}z.isLoci=P;function T(j,Y){if(j.volume!==Y.volume||j.elements.length!==Y.elements.length)return!1;for(let G=0,X=j.elements.length;G<X;++G){let U=j.elements[G],L=Y.elements[G];if(!xe.areEqual(U.instances,L.instances)||!xe.areEqual(U.segments,L.segments))return!1}return!0}z.areLociEqual=T;function R(j){for(let{segments:Y,instances:G}of j.elements)if(!xe.isEmpty(G)||!xe.isEmpty(Y))return!1;return!0}z.isLociEmpty=R;function w(j){let Y=0;for(let{segments:G,instances:X}of j.elements)Y+=xe.size(G)*xe.size(X);return Y}z.getLociSize=w;let E=pt(),M=pt(),D=pt();function B(j,Y,G){let X=v.Segmentation.get(j);if(X){pt.setEmpty(E);let U=Nn.getGridToCartesianTransform(j.grid);for(let{segments:L,instances:q}of Y){pt.setEmpty(M);for(let te=0,J=xe.size(L);te<J;te++){let ee=xe.getAt(L,te),ce=X.bounds[ee];pt.add(M,ce.min),pt.add(M,ce.max)}pt.transform(M,M,U);for(let te=0,J=xe.size(q);te<J;te++){let ee=j.instances[xe.getAt(q,te)];pt.transform(D,M,ee.transform),pt.addBox3D(E,D)}}return he.fromBox3D(G||he(),E)}else return v.getBoundingSphere(j,G)}z.getBoundingSphere=B;function k(j,Y,G){return{kind:"segment-location",volume:j,segment:Y,instance:G}}z.Location=k;function F(j){return!!j&&j.kind==="segment-location"}z.isLocation=F})(x=v.Segment||={}),v.PickingGranularity={set(A,P){A._propertyData.__picking_granularity__=P},get(A){return A._propertyData.__picking_granularity__??"voxel"}},v.Segmentation={set(A,P){A._propertyData.__segmentation__=P},get(A){return A._propertyData.__segmentation__}}})(Ge||={});var z7=SC(),tu;(y=>{function e(x,S,I,v,A,P,T,R,w,E,M){return M?n(x,S,I,v,A,P,T,R,w,E,M):r(x,S,I,v,A,P,T,R,w,E)}y.create=e;function t(x){return ui([x.bboxSize.ref.version,x.gridDimension.ref.version,x.gridTexture.ref.version,x.transform.ref.version,x.gridStats.ref.version])}function r(x,S,I,v,A,P,T,R,w,E){let M=he(),D=-1,B=P.getWidth(),k=P.getHeight(),F=P.getDepth(),z={kind:"direct-volume",gridDimension:_.create(S),gridTexture:_.create(P),gridTextureDim:_.create(b.create(B,k,F)),gridStats:_.create(Et.create(T.min,T.max,T.mean,T.sigma)),bboxMin:_.create(x.min),bboxMax:_.create(x.max),bboxSize:_.create(b.sub(b(),x.max,x.min)),transform:_.create(I),cellDim:_.create(A),unitToCartn:_.create(v),cartnToUnit:_.create(H.invert(H(),v)),get boundingSphere(){let j=t(z);if(j!==D){let Y=Bqe(z.gridDimension.ref.value,z.transform.ref.value);he.copy(M,Y),D=j}return M},packedGroup:_.create(R),axisOrder:_.create(w),dataType:_.create(E),setBoundingSphere(j){he.copy(M,j),D=t(z)},meta:{}};return z}function n(x,S,I,v,A,P,T,R,w,E,M){let D=P.getWidth(),B=P.getHeight(),k=P.getDepth();return _.update(M.gridDimension,S),_.update(M.gridTexture,P),_.update(M.gridTextureDim,b.set(M.gridTextureDim.ref.value,D,B,k)),_.update(M.gridStats,Et.set(M.gridStats.ref.value,T.min,T.max,T.mean,T.sigma)),_.update(M.bboxMin,x.min),_.update(M.bboxMax,x.max),_.update(M.bboxSize,b.sub(M.bboxSize.ref.value,x.max,x.min)),_.update(M.transform,I),_.update(M.cellDim,A),_.update(M.unitToCartn,v),_.update(M.cartnToUnit,H.invert(H(),v)),_.updateIfChanged(M.packedGroup,R),_.updateIfChanged(M.axisOrder,b.fromArray(M.axisOrder.ref.value,w,0)),_.updateIfChanged(M.dataType,E),M}function o(x){let S=pt(),I=b(),v=H.identity(),A=H.identity(),P=b(),T=qo(),R=Nn.One.stats,w=!1,E=b.create(0,1,2);return e(S,I,v,A,P,T,R,w,E,"byte",x)}y.createEmpty=o,y.Params={...Xe.Params,ignoreLight:C.Boolean(!1,Xe.ShadingCategory),celShaded:C.Boolean(!1,Xe.ShadingCategory),xrayShaded:C.Select(!1,[[!1,"Off"],[!0,"On"],["inverted","Inverted"]],Xe.ShadingCategory),controlPoints:C.LineGraph([Ce.create(.19,0),Ce.create(.2,.05),Ce.create(.25,.05),Ce.create(.26,0),Ce.create(.79,0),Ce.create(.8,.05),Ce.create(.85,.05),Ce.create(.86,0)],{isEssential:!0}),stepsPerCell:C.Numeric(3,{min:1,max:10,step:1}),jumpLength:C.Numeric(0,{min:0,max:20,step:.1})},y.Utils={Params:y.Params,createEmpty:o,createValues:m,createValuesSimple:d,updateValues:p,updateBoundingSphere:h,createRenderableState:f,updateRenderableState:g,createPositionIterator:s};function s(x,S){let I=x.transform.ref.value,[v,A,P]=x.gridDimension.ref.value,T=v*A*P,R=S.instanceCount.ref.value,w=zs(),E=w.position,M=S.aTransform.ref.value;return un(T,R,1,(B,k)=>{let F=Math.floor(B/P);return E[0]=Math.floor(F/A),E[1]=F%A,E[2]=B%P,b.transformMat4(E,E,I),k>=0&&b.transformMat4Offset(E,E,M,0,0,k*16),w})}function l(x,S){return Math.ceil(b.magnitude(x)*S)}function u(x,S){return Math.min(...x)*(1/S)}function c(x){return 1/x}function m(x,S,I,v,A){let{gridTexture:P,gridTextureDim:T,gridStats:R}=x,{bboxSize:w,bboxMin:E,bboxMax:M,gridDimension:D,transform:B}=x,{instanceCount:k,groupCount:F}=I,z=s(x,S),j=ya(I,z,v.color),Y=A.instanceGranularity?yo(k,"instance"):yo(k*F,"groupInstance"),G=ql(),X=Yl(),U=$l(),L=Jl(),q=Kl(),[te,J,ee]=D.ref.value,ce={drawCount:z7.indices.length,vertexCount:te*J*ee,groupCount:F,instanceCount:k},fe=he.clone(x.boundingSphere),O=Li(fe,S.aTransform.ref.value,k,0),V=U7(A.controlPoints),Z=N7(V);return{dGeometryType:_.create("directVolume"),...j,...Y,...G,...X,...U,...L,...q,...S,...Xe.createValues(A,ce),aPosition:_.create(z7.vertices),elements:_.create(z7.indices),boundingSphere:_.create(O),invariantBoundingSphere:_.create(fe),uInvariantBoundingSphere:_.create(Et.ofSphere(fe)),uBboxMin:E,uBboxMax:M,uBboxSize:w,uMaxSteps:_.create(l(D.ref.value,A.stepsPerCell)),uStepScale:_.create(u(x.cellDim.ref.value,A.stepsPerCell)),uJumpLength:_.create(A.jumpLength),uTransform:B,uGridDim:D,tTransferTex:Z,uTransferScale:_.create(c(A.stepsPerCell)),dGridTexType:_.create(P.ref.value.getDepth()>0?"3d":"2d"),uGridTexDim:T,tGridTex:P,uGridStats:R,uCellDim:x.cellDim,uCartnToUnit:x.cartnToUnit,uUnitToCartn:x.unitToCartn,dPackedGroup:x.packedGroup,dAxisOrder:_.create(x.axisOrder.ref.value.join("")),dIgnoreLight:_.create(A.ignoreLight),dCelShaded:_.create(A.celShaded),dXrayShaded:_.create(A.xrayShaded==="inverted"?"inverted":A.xrayShaded===!0?"on":"off"),meta:_.create(x.meta)}}function d(x,S,I,v,A){let P=Xe.createSimple(I,v,A),T={...C.getDefaultValues(y.Params),...S};return m(x,P.transform,P.locationIterator,P.theme,T)}function p(x,S){Xe.updateValues(x,S),_.updateIfChanged(x.dIgnoreLight,S.ignoreLight),_.updateIfChanged(x.dCelShaded,S.celShaded),_.updateIfChanged(x.dXrayShaded,S.xrayShaded==="inverted"?"inverted":S.xrayShaded===!0?"on":"off");let I=U7(S.controlPoints);N7(I,x.tTransferTex),_.updateIfChanged(x.uMaxSteps,l(x.uGridDim.ref.value,S.stepsPerCell)),_.updateIfChanged(x.uStepScale,u(x.uCellDim.ref.value,S.stepsPerCell)),_.updateIfChanged(x.uTransferScale,c(S.stepsPerCell)),_.updateIfChanged(x.uJumpLength,S.jumpLength)}function h(x,S){let I=he.clone(S.boundingSphere),v=Li(I,x.aTransform.ref.value,x.instanceCount.ref.value,0);he.equals(v,x.boundingSphere.ref.value)||_.update(x.boundingSphere,v),he.equals(I,x.invariantBoundingSphere.ref.value)||(_.update(x.invariantBoundingSphere,I),_.update(x.uInvariantBoundingSphere,Et.fromSphere(x.uInvariantBoundingSphere.ref.value,I)))}function f(x){let S=Xe.createRenderableState(x);return S.opaque=!1,S.writeDepth=!1,S}function g(x,S){Xe.updateRenderableState(x,S),x.opaque=!1,x.writeDepth=!1}})(tu||={});function Bqe(e,t){return he.fromDimensionsAndTransform(he(),e,t)}var Hs;(I=>{function e(v,A,P,T){return T?o(v,A,P,T):n(v,A,P)}I.create=e;function t(v){let A=v?v.centerBuffer.ref.value:new Float32Array(0),P=v?v.groupBuffer.ref.value:new Float32Array(0);return e(A,P,0,v)}I.createEmpty=t;function r(v){return ui([v.sphereCount,v.centerBuffer.ref.version,v.groupBuffer.ref.version])}function n(v,A,P){let T=he(),R,w=-1,E=-1,M=_.create(So(1,4,Float32Array)),D=_.create(Ce.create(0,0)),B=_.create([]),k=_.create(0),F={kind:"spheres",sphereCount:P,centerBuffer:_.create(v),groupBuffer:_.create(A),get boundingSphere(){let z=r(F);if(z!==w){let j=Vm(F.centerBuffer.ref.value,F.sphereCount,1);he.copy(T,j),w=z}return T},get groupMapping(){return F.groupBuffer.ref.version!==E&&(R=Cp(F.groupBuffer.ref.value,F.sphereCount),E=F.groupBuffer.ref.version),R},setBoundingSphere(z){he.copy(T,z),w=r(F)},shaderData:{positionGroup:M,texDim:D,lodLevels:B,sizeFactor:k,update(z){let j=z?.lodLevels??l(B.ref.value),Y=z?.sizeFactor??k.ref.value,G=c(j,Y),X=So(F.sphereCount,4,Float32Array,M.ref.value.array),U=i(X,F.centerBuffer.ref.value,F.groupBuffer.ref.value,F.sphereCount,G),L=U?s(j,Y,U,F.sphereCount):[];_.update(M,X),_.update(D,Ce.set(D.ref.value,X.width,X.height)),_.update(B,L),_.update(k,Y)}}};return F.shaderData.update(),F}function o(v,A,P,T){return T.sphereCount=P,_.update(T.centerBuffer,v),_.update(T.groupBuffer,A),T.shaderData.update(),T}function i(v,A,P,T,R){let{array:w}=v;if(R.length===0){for(let D=0;D<T;++D)w[D*4+0]=A[D*3+0],w[D*4+1]=A[D*3+1],w[D*4+2]=A[D*3+2],w[D*4+3]=P[D];return}let E=[0],M=0;for(let D=0,B=R.length;D<B;++D){let k=R[D];for(let F=0;F<T;++F){let z=!1;for(let j=0;j<D;++j)if(F%R[j]===0){z=!0;break}!z&&F%k===0&&(w[M*4+0]=A[F*3+0],w[M*4+1]=A[F*3+1],w[M*4+2]=A[F*3+2],w[M*4+3]=P[F],M+=1)}E.push(M*6)}return E}function a(v,A){if(v.length!==A.length)return!1;for(let P=0,T=v.length;P<T;++P)if(v[P].maxDistance!==A[P].maxDistance||v[P].minDistance!==A[P].minDistance||v[P].overlap!==A[P].overlap||v[P].stride!==A[P].stride||v[P].scaleBias!==A[P].scaleBias)return!1;return!0}function s(v,A,P,T){return v.map((R,w)=>{let E=u(R,A);return[R.minDistance,R.maxDistance,R.overlap,P[P.length-1-w],Math.pow(Math.min(T,E),1/R.scaleBias),R.stride,R.scaleBias]})}function l(v){return v.map(A=>({minDistance:A[0],maxDistance:A[1],overlap:A[2],stride:A[5],scaleBias:A[6]}))}function u(v,A){return Math.max(1,Math.round(v.stride/Math.pow(A,v.scaleBias)))}function c(v,A){return v.map(P=>u(P,A)).reverse()}I.Params={...Xe.Params,sizeFactor:C.Numeric(1,{min:0,max:10,step:.1}),doubleSided:C.Boolean(!1,Xe.CustomQualityParamInfo),ignoreLight:C.Boolean(!1,Xe.ShadingCategory),celShaded:C.Boolean(!1,Xe.ShadingCategory),xrayShaded:C.Select(!1,[[!1,"Off"],[!0,"On"],["inverted","Inverted"]],Xe.ShadingCategory),transparentBackfaces:C.Select("off",C.arrayToOptions(["off","on","opaque"]),Xe.ShadingCategory),solidInterior:C.Boolean(!0,Xe.ShadingCategory),clipPrimitive:C.Boolean(!1,{...Xe.ShadingCategory,description:"Clip whole sphere instead of cutting it."}),approximate:C.Boolean(!1,{...Xe.ShadingCategory,description:"Faster rendering, but has artifacts."}),alphaThickness:C.Numeric(0,{min:0,max:20,step:1},{...Xe.ShadingCategory,description:"If not zero, adjusts alpha for radius."}),bumpFrequency:C.Numeric(0,{min:0,max:10,step:.1},Xe.ShadingCategory),bumpAmplitude:C.Numeric(1,{min:0,max:5,step:.1},Xe.ShadingCategory),interior:vp(),lodLevels:C.ObjectList({minDistance:C.Numeric(0),maxDistance:C.Numeric(0),overlap:C.Numeric(0),stride:C.Numeric(0),scaleBias:C.Numeric(3,{min:.1,max:10,step:.1})},v=>`${v.stride}`,{...Xe.CullingLodCategory,defaultValue:[]})},I.Utils={Params:I.Params,createEmpty:t,createValues:h,createValuesSimple:f,updateValues:g,updateBoundingSphere:y,createRenderableState:x,updateRenderableState:S,createPositionIterator:p};function p(v,A){let P=v.sphereCount,T=A.instanceCount.ref.value,R=zs(),w=R.position,E=v.centerBuffer.ref.value,M=A.aTransform.ref.value;return un(P,T,1,(B,k)=>(k<0?b.fromArray(w,E,B*3):b.transformMat4Offset(w,E,M,0,B*3,k*16),R))}function h(v,A,P,T,R){let{instanceCount:w,groupCount:E}=P,M=p(v,A),D=ya(P,M,T.color),B=eu(P,T.size),k=R.instanceGranularity?yo(w,"instance"):yo(w*E,"groupInstance"),F=ql(),z=Yl(),j=$l(),Y=Jl(),G=Kl(),X={drawCount:v.sphereCount*2*3,vertexCount:v.sphereCount*6,groupCount:E,instanceCount:w},U=v.boundingSphere.radius?CC(B)*R.sizeFactor:0,L=he.expand(he(),v.boundingSphere,U),q=Li(L,A.aTransform.ref.value,w,0);return v.shaderData.update({lodLevels:R.lodLevels,sizeFactor:R.sizeFactor}),{dGeometryType:_.create("spheres"),uTexDim:v.shaderData.texDim,tPositionGroup:v.shaderData.positionGroup,boundingSphere:_.create(q),invariantBoundingSphere:_.create(L),uInvariantBoundingSphere:_.create(Et.ofSphere(L)),...D,...B,...k,...F,...z,...j,...Y,...G,...A,padding:_.create(U),...Xe.createValues(R,X),uSizeFactor:v.shaderData.sizeFactor,uDoubleSided:_.create(R.doubleSided),dIgnoreLight:_.create(R.ignoreLight),dCelShaded:_.create(R.celShaded),dXrayShaded:_.create(R.xrayShaded==="inverted"?"inverted":R.xrayShaded===!0?"on":"off"),dTransparentBackfaces:_.create(R.transparentBackfaces),dSolidInterior:_.create(R.solidInterior),dClipPrimitive:_.create(R.clipPrimitive),dApproximate:_.create(R.approximate),uAlphaThickness:_.create(R.alphaThickness),uBumpFrequency:_.create(R.bumpFrequency),uBumpAmplitude:_.create(R.bumpAmplitude),uInteriorColor:_.create(Ip(R.interior,Et())),uInteriorSubstance:_.create(Ap(R.interior,Et())),lodLevels:v.shaderData.lodLevels,centerBuffer:v.centerBuffer,groupBuffer:v.groupBuffer}}function f(v,A,P,T,R){let w=Xe.createSimple(P,T,R),E={...C.getDefaultValues(I.Params),...A};return h(v,w.transform,w.locationIterator,w.theme,E)}function g(v,A){Xe.updateValues(v,A),_.updateIfChanged(v.uSizeFactor,A.sizeFactor),_.updateIfChanged(v.uDoubleSided,A.doubleSided),_.updateIfChanged(v.dIgnoreLight,A.ignoreLight),_.updateIfChanged(v.dCelShaded,A.celShaded),_.updateIfChanged(v.dXrayShaded,A.xrayShaded==="inverted"?"inverted":A.xrayShaded===!0?"on":"off"),_.updateIfChanged(v.dTransparentBackfaces,A.transparentBackfaces),_.updateIfChanged(v.dSolidInterior,A.solidInterior),_.updateIfChanged(v.dClipPrimitive,A.clipPrimitive),_.updateIfChanged(v.dApproximate,A.approximate),_.updateIfChanged(v.uAlphaThickness,A.alphaThickness),_.updateIfChanged(v.uBumpFrequency,A.bumpFrequency),_.updateIfChanged(v.uBumpAmplitude,A.bumpAmplitude),_.update(v.uInteriorColor,Ip(A.interior,v.uInteriorColor.ref.value)),_.update(v.uInteriorSubstance,Ap(A.interior,v.uInteriorSubstance.ref.value));let P=l(v.lodLevels.ref.value);if(!a(A.lodLevels,P)){let T=v.uVertexCount.ref.value/6,R=c(A.lodLevels,A.sizeFactor),w=i(v.tPositionGroup.ref.value,v.centerBuffer.ref.value,v.groupBuffer.ref.value,T,R),E=w?s(A.lodLevels,A.sizeFactor,w,T):[];_.update(v.tPositionGroup,v.tPositionGroup.ref.value),_.update(v.lodLevels,E)}}function y(v,A){let P=A.boundingSphere.radius?CC(v)*v.uSizeFactor.ref.value:0,T=he.expand(he(),A.boundingSphere,P),R=Li(T,v.aTransform.ref.value,v.instanceCount.ref.value,0);he.equals(R,v.boundingSphere.ref.value)||_.update(v.boundingSphere,R),he.equals(T,v.invariantBoundingSphere.ref.value)||(_.update(v.invariantBoundingSphere,T),_.update(v.uInvariantBoundingSphere,Et.fromSphere(v.uInvariantBoundingSphere.ref.value,T))),_.update(v.padding,P)}function x(v){let A=Xe.createRenderableState(v);return S(A,v),A}function S(v,A){Xe.updateRenderableState(v,A),v.opaque=v.opaque&&!A.xrayShaded,v.writeDepth=v.opaque}})(Hs||={});var Ss;(p=>{class e{constructor(){this.index=0;this.textures=[]}get(){return this.textures[this.index]}set(f,g,y){this.textures[this.index]=Object.assign(this.textures[this.index]||{},{vertex:f,group:g,normal:y}),this.index=(this.index+1)%2}destroy(){for(let f of this.textures)f.vertex.destroy(),f.group.destroy(),f.normal.destroy()}}p.DoubleBuffer=e;function t(h,f,g,y,x,S,I){let v=g.getWidth(),A=g.getHeight();return I?(I.vertexCount=h,I.groupCount=f,_.update(I.geoTextureDim,Ce.set(I.geoTextureDim.ref.value,v,A)),_.update(I.vertexTexture,g),_.update(I.groupTexture,y),_.update(I.normalTexture,x),I.doubleBuffer.set(g,y,x),he.copy(I.boundingSphere,S),I):{kind:"texture-mesh",vertexCount:h,groupCount:f,geoTextureDim:_.create(Ce.create(v,A)),vertexTexture:_.create(g),groupTexture:_.create(y),normalTexture:_.create(x),varyingGroup:_.create(!1),doubleBuffer:new e,boundingSphere:he.clone(S),meta:{}}}p.create=t;function r(h){let f=h?h.vertexTexture.ref.value:qo(),g=h?h.groupTexture.ref.value:qo(),y=h?h.normalTexture.ref.value:qo(),x=h?h.boundingSphere:he();return t(0,0,f,g,y,x,h)}p.createEmpty=r,p.Params={...Xe.Params,doubleSided:C.Boolean(!1,Xe.CustomQualityParamInfo),flipSided:C.Boolean(!1,Xe.ShadingCategory),flatShaded:C.Boolean(!1,Xe.ShadingCategory),ignoreLight:C.Boolean(!1,Xe.ShadingCategory),celShaded:C.Boolean(!1,Xe.ShadingCategory),xrayShaded:C.Select(!1,[[!1,"Off"],[!0,"On"],["inverted","Inverted"]],Xe.ShadingCategory),transparentBackfaces:C.Select("off",C.arrayToOptions(["off","on","opaque"]),Xe.ShadingCategory),bumpFrequency:C.Numeric(0,{min:0,max:10,step:.1},Xe.ShadingCategory),bumpAmplitude:C.Numeric(1,{min:0,max:5,step:.1},Xe.ShadingCategory),interior:vp()},p.Utils={Params:p.Params,createEmpty:r,createValues:s,createValuesSimple:l,updateValues:u,updateBoundingSphere:c,createRenderableState:m,updateRenderableState:d,createPositionIterator:a};let i="texture-mesh";function a(h,f){let g=h.meta.webgl;if(!g)return un(1,1,1,()=>Vu);g.namedFramebuffers[i]||(g.namedFramebuffers[i]=g.resources.framebuffer());let y=g.namedFramebuffers[i],[x,S]=h.geoTextureDim.ref.value,I,v=()=>{if(!I){let D=new Float32Array(x*S*4);y.bind(),h.vertexTexture.ref.value.attachFramebuffer(y,0),g.readPixels(0,0,x,S,D);let B=new Float32Array(x*S*4);y.bind(),h.normalTexture.ref.value.attachFramebuffer(y,0),g.readPixels(0,0,x,S,B),I={vertices:D,normals:B}}return I},A=h.vertexCount,P=f.instanceCount.ref.value,T=zs(),R=T.position,w=T.normal,E=f.aTransform.ref.value;return un(A,P,1,(D,B)=>{let{vertices:k,normals:F}=v();return B<0?(b.fromArray(R,k,D*4),b.fromArray(w,F,D*4)):(b.transformMat4Offset(R,k,E,0,D*4,B*16),b.transformDirectionOffset(w,F,E,0,D*4,B*16)),T})}function s(h,f,g,y,x){let{instanceCount:S,groupCount:I}=g,v=p.Utils.createPositionIterator(h,f),A=ya(g,v,y.color),P=x.instanceGranularity?yo(S,"instance"):yo(S*I,"groupInstance"),T=ql(),R=Yl(),w=$l(),E=Jl(),M=Kl(),D={drawCount:h.vertexCount,vertexCount:h.vertexCount,groupCount:I,instanceCount:S},B=he.clone(h.boundingSphere),k=Li(B,f.aTransform.ref.value,S,0);return{dGeometryType:_.create("textureMesh"),uGeoTexDim:h.geoTextureDim,tPosition:h.vertexTexture,tGroup:h.groupTexture,tNormal:h.normalTexture,dVaryingGroup:h.varyingGroup,boundingSphere:_.create(k),invariantBoundingSphere:_.create(B),uInvariantBoundingSphere:_.create(Et.ofSphere(B)),...A,...P,...T,...R,...w,...E,...M,...f,...Xe.createValues(x,D),uDoubleSided:_.create(x.doubleSided),dFlatShaded:_.create(x.flatShaded),dFlipSided:_.create(x.flipSided),dIgnoreLight:_.create(x.ignoreLight),dCelShaded:_.create(x.celShaded),dXrayShaded:_.create(x.xrayShaded==="inverted"?"inverted":x.xrayShaded===!0?"on":"off"),dTransparentBackfaces:_.create(x.transparentBackfaces),uBumpFrequency:_.create(x.bumpFrequency),uBumpAmplitude:_.create(x.bumpAmplitude),uInteriorColor:_.create(Ip(x.interior,Et())),uInteriorSubstance:_.create(Ap(x.interior,Et())),meta:_.create(h.meta)}}function l(h,f,g,y,x){let S=Xe.createSimple(g,y,x),I={...C.getDefaultValues(p.Params),...f};return s(h,S.transform,S.locationIterator,S.theme,I)}function u(h,f){Xe.updateValues(h,f),_.updateIfChanged(h.uDoubleSided,f.doubleSided),_.updateIfChanged(h.dFlatShaded,f.flatShaded),_.updateIfChanged(h.dFlipSided,f.flipSided),_.updateIfChanged(h.dIgnoreLight,f.ignoreLight),_.updateIfChanged(h.dCelShaded,f.celShaded),_.updateIfChanged(h.dXrayShaded,f.xrayShaded==="inverted"?"inverted":f.xrayShaded===!0?"on":"off"),_.updateIfChanged(h.dTransparentBackfaces,f.transparentBackfaces),_.updateIfChanged(h.uBumpFrequency,f.bumpFrequency),_.updateIfChanged(h.uBumpAmplitude,f.bumpAmplitude),_.update(h.uInteriorColor,Ip(f.interior,h.uInteriorColor.ref.value)),_.update(h.uInteriorSubstance,Ap(f.interior,h.uInteriorSubstance.ref.value))}function c(h,f){let g=he.clone(f.boundingSphere),y=Li(g,h.aTransform.ref.value,h.instanceCount.ref.value,0);he.equals(y,h.boundingSphere.ref.value)||_.update(h.boundingSphere,y),he.equals(g,h.invariantBoundingSphere.ref.value)||(_.update(h.invariantBoundingSphere,g),_.update(h.uInvariantBoundingSphere,Et.fromSphere(h.uInvariantBoundingSphere.ref.value,g)))}function m(h){let f=Xe.createRenderableState(h);return d(f,h),f}function d(h,f){Xe.updateRenderableState(h,f),h.opaque=h.opaque&&!f.xrayShaded,h.writeDepth=h.opaque}})(Ss||={});function wbe(e,t){let r={},n={},o={},i={},a={},s={},l={};return Object.keys(e).forEach(u=>{let c=e[u];c.type==="attribute"&&(r[u]=t[u]),c.type==="define"&&(n[u]=t[u]),c.type==="texture"&&t[u]!==void 0&&(c.variant==="material"?i[u]=t[u]:o[u]=t[u]),c.type==="uniform"&&t[u]!==void 0&&(c.variant==="material"?s[u]=t[u]:c.variant==="buffered"?l[u]=t[u]:a[u]=t[u])}),{attributeValues:r,defineValues:n,textureValues:o,materialTextureValues:i,uniformValues:a,materialUniformValues:s,bufferedUniformValues:l}}function Mbe(e){let t={};return Object.keys(e).forEach(r=>{t[r]=e[r].ref.version}),t}function Vn(e,t,r){return{type:"attribute",kind:e,itemSize:t,divisor:r}}function de(e,t){return{type:"uniform",kind:e,variant:t}}function yt(e,t,r,n,o){return{type:"texture",kind:e,format:t,dataType:r,filter:n,variant:o}}function Tp(e){return{type:"elements",kind:e}}function dt(e,t){return{type:"define",kind:e,options:t}}function Qn(e){return{type:"value",kind:e}}var ru={uDrawId:de("i"),uModel:de("m4"),uView:de("m4"),uInvView:de("m4"),uModelView:de("m4"),uInvModelView:de("m4"),uProjection:de("m4"),uInvProjection:de("m4"),uModelViewProjection:de("m4"),uInvModelViewProjection:de("m4"),uHasHeadRotation:de("b"),uInvHeadRotation:de("m4"),uIsAsymmetricProjection:de("b"),uHasEyeCamera:de("b"),uModelViewEye:de("m4"),uInvModelViewEye:de("m4"),uIsOrtho:de("f"),uPixelRatio:de("f"),uViewport:de("v4"),uViewOffset:de("v2"),uModelScale:de("f"),uDrawingBufferSize:de("v2"),uCameraPosition:de("v3"),uCameraDir:de("v3"),uCameraPlane:de("v4"),uNear:de("f"),uFar:de("f"),uFog:de("b"),uFogNear:de("f"),uFogFar:de("f"),uFogColor:de("v3"),uTransparentBackground:de("b"),uLightDirection:de("v3[]"),uLightColor:de("v3[]"),uAmbientColor:de("v3"),uPickingAlphaThreshold:de("f"),uHighlightColor:de("v3"),uSelectColor:de("v3"),uDimColor:de("v3"),uHighlightStrength:de("f"),uSelectStrength:de("f"),uDimStrength:de("f"),uMarkerPriority:de("i"),uMarkerAverage:de("f"),uXrayEdgeFalloff:de("f"),uCelSteps:de("f"),uExposure:de("f"),uRenderMask:de("i"),uMarkingDepthTest:de("b"),uMarkingType:de("i"),uPickType:de("i")},nu={tDepth:yt("texture","depth","ushort","nearest"),tDpoitDepth:yt("texture","rg","float","nearest"),tDpoitFrontColor:yt("texture","rgba","float","nearest"),tDpoitBackColor:yt("texture","rgba","float","nearest")},ou={dLightCount:dt("number"),dColorMarker:dt("boolean")},iu={uObjectId:de("i")},Eqe={uColor:de("v3","material"),uColorTexDim:de("v2"),uColorGridDim:de("v3"),uColorGridTransform:de("v4"),uPaletteDomain:de("v2"),uPaletteDefault:de("v3"),tColor:yt("image-uint8","rgb","ubyte","nearest"),tPalette:yt("image-uint8","rgb","ubyte","nearest"),tColorGrid:yt("texture","rgb","ubyte","linear"),dColorType:dt("string",["uniform","attribute","instance","group","groupInstance","vertex","vertexInstance","volume","volumeInstance","direct"]),dUsePalette:dt("boolean")},Ag={uSize:de("f","material"),uSizeTexDim:de("v2"),tSize:yt("image-uint8","rgb","ubyte","nearest"),dSizeType:dt("string",["uniform","attribute","instance","group","groupInstance"]),uSizeFactor:de("f","material")},kqe={uMarker:de("f"),uMarkerTexDim:de("v2"),tMarker:yt("image-uint8","alpha","ubyte","nearest"),markerAverage:Qn("number"),markerStatus:Qn("number"),dMarkerType:dt("string",["instance","groupInstance"])},Fqe={uOverpaintTexDim:de("v2"),tOverpaint:yt("image-uint8","rgba","ubyte","nearest"),dOverpaint:dt("boolean"),uOverpaintGridDim:de("v3"),uOverpaintGridTransform:de("v4"),tOverpaintGrid:yt("texture","rgba","ubyte","linear"),dOverpaintType:dt("string",["instance","groupInstance","volumeInstance"]),uOverpaintStrength:de("f","material")},Lqe={uTransparencyTexDim:de("v2"),tTransparency:yt("image-uint8","alpha","ubyte","nearest"),dTransparency:dt("boolean"),transparencyAverage:Qn("number"),transparencyMin:Qn("number"),uTransparencyGridDim:de("v3"),uTransparencyGridTransform:de("v4"),tTransparencyGrid:yt("texture","alpha","ubyte","linear"),dTransparencyType:dt("string",["instance","groupInstance","volumeInstance"]),uTransparencyStrength:de("f","material")},Vqe={uEmissiveTexDim:de("v2"),tEmissive:yt("image-uint8","alpha","ubyte","nearest"),dEmissive:dt("boolean"),emissiveAverage:Qn("number"),uEmissiveGridDim:de("v3"),uEmissiveGridTransform:de("v4"),tEmissiveGrid:yt("texture","alpha","ubyte","linear"),dEmissiveType:dt("string",["instance","groupInstance","volumeInstance"]),uEmissiveStrength:de("f","material")},Oqe={uSubstanceTexDim:de("v2"),tSubstance:yt("image-uint8","rgba","ubyte","nearest"),dSubstance:dt("boolean"),uSubstanceGridDim:de("v3"),uSubstanceGridTransform:de("v4"),tSubstanceGrid:yt("texture","rgba","ubyte","linear"),dSubstanceType:dt("string",["instance","groupInstance","volumeInstance"]),uSubstanceStrength:de("f","material")},Gqe={uClippingTexDim:de("v2"),tClipping:yt("image-uint8","alpha","ubyte","nearest"),dClipping:dt("boolean"),dClippingType:dt("string",["instance","groupInstance"])},au={dGeometryType:dt("string",["cylinders","directVolume","image","lines","mesh","points","spheres","text","textureMesh"]),...Eqe,...kqe,...Fqe,...Lqe,...Vqe,...Oqe,...Gqe,dClipObjectCount:dt("number"),dClipVariant:dt("string",["instance","pixel"]),uClipObjectType:de("i[]","material"),uClipObjectInvert:de("b[]","material"),uClipObjectPosition:de("v3[]","material"),uClipObjectRotation:de("v4[]","material"),uClipObjectScale:de("v3[]","material"),uClipObjectTransform:de("m4[]","material"),aInstance:Vn("float32",1,1),aTransform:Vn("float32",16,1),uAlpha:de("f","material"),uMetalness:de("f","material"),uRoughness:de("f","material"),uBumpiness:de("f","material"),uEmissive:de("f","material"),uDensity:de("f","material"),uVertexCount:de("i"),uInstanceCount:de("i"),uGroupCount:de("i"),uInvariantBoundingSphere:de("v4"),uLod:de("v4"),drawCount:Qn("number"),instanceCount:Qn("number"),alpha:Qn("number"),matrix:Qn("m4"),transform:Qn("float32"),extraTransform:Qn("float32"),hasReflection:Qn("boolean"),instanceGranularity:Qn("boolean"),boundingSphere:Qn("sphere"),invariantBoundingSphere:Qn("sphere"),instanceGrid:Qn("instanceGrid")};var Bbe=`
precision highp float;
precision highp sampler2D;

uniform sampler2D tColor;
uniform vec2 uTexSize;

void main() {
    vec2 coords = gl_FragCoord.xy / uTexSize;
    gl_FragColor = texture2D(tColor, coords);
}
`;var Fn=`
precision highp float;

attribute vec2 aPosition;
uniform vec2 uQuadScale;

void main(void) {
    vec2 position = aPosition * uQuadScale - vec2(1.0, 1.0) + uQuadScale;
    gl_Position = vec4(position, 0.0, 1.0);
}
`;var Uqe=3e7,Nqe=gi();function zqe(e,t){let{gl:r}=e;switch(t){case"points":return r.POINTS;case"lines":return r.LINES;case"line-strip":return r.LINE_STRIP;case"line-loop":return r.LINE_LOOP;case"triangles":return r.TRIANGLES;case"triangle-strip":return r.TRIANGLE_STRIP;case"triangle-fan":return r.TRIANGLE_FAN}}var Hqe={color:"",pick:"",depth:"",marking:"",emissive:"",tracing:""},jqe=Object.keys(Hqe),Wqe={compute:""},Xqe=Object.keys(Wqe);function H7(e,t,r,n,o){return r={...r,dRenderVariant:_.create(t)},o.dRenderVariant===void 0&&Object.defineProperty(o,"dRenderVariant",{value:dt("string")}),e.resources.program(r,n,o)}function Qqe(){return{attributes:!1,defines:!1,elements:!1,textures:!1}}function Zqe(e){e.attributes=!1,e.defines=!1,e.elements=!1,e.textures=!1}function j7(e,t){if(e==="color")switch(t){case"blended":return"colorBlended";case"wboit":return"colorWboit";case"dpoit":return"colorDpoit"}return e}function su(e,t,r,n,o,i,a){return Ebe(e,t,r,n,o,i,jqe,a)}function on(e,t,r,n,o,i=-1){return Ebe(e,t,r,n,o,i,Xqe,void 0)}function Ebe(e,t,r,n,o,i,a,s){let l=Nqe(),{stats:u,state:c,resources:m}=e,{instancedArrays:d,vertexArrayObject:p,multiDrawInstancedBaseVertexBaseInstance:h,drawInstancedBaseVertexBaseInstance:f}=e.extensions;if(a=a.filter(ee=>ee==="tracing"?!!e.extensions.drawBuffers:!0),o.uVertexCount&&!e.extensions.noNonInstancedActiveAttribs){let ee=o.uVertexCount.ref.value;o.aVertex=_.create(Xa(new Float32Array(ee))),n.aVertex=Vn("float32",1,0)}let{attributeValues:g,defineValues:y,textureValues:x,materialTextureValues:S,uniformValues:I,materialUniformValues:v,bufferedUniformValues:A}=wbe(n,o),P=Object.entries(I),T=Object.entries(v),R=Object.entries(A),w=Object.entries(aye(A)),E=Object.entries(y),M=Mbe(o),D=zqe(e,t),B={};for(let ee of a)B[ee]=H7(e,j7(ee,s),y,r,n);let k=b7(e,n,x),F=b7(e,n,S),z=mye(e,n,g),j=[];for(let ee=0,ce=z.length;ee<ce;++ee){let fe=z[ee];fe[1].divisor===1&&j.push(fe)}let Y,G=o.elements;G&&G.ref.value&&(Y=m.elements(G.ref.value));let X={};for(let ee of a)X[ee]=p?m.vertexArray(B[ee],z,Y):null;let U=o.drawCount.ref.value,L=o.instanceCount.ref.value;u.drawCount+=U,u.instanceCount+=L,u.instancedDrawCount+=L*U;let q=Qqe(),te=!1,J=-1;return{id:l,materialId:i,getByteCount(){let ee=0;for(let ce=0,fe=z.length;ce<fe;++ce)ee+=z[ce][1].getByteCount();Y&&(ee+=Y.getByteCount());for(let ce=0,fe=k.length;ce<fe;++ce)ee+=k[ce][1].getByteCount();for(let ce=0,fe=F.length;ce<fe;++ce)ee+=F[ce][1].getByteCount();return ee},getProgram:ee=>B[ee],setTransparency:ee=>{if(ee!==s){s=ee;for(let ce of a)B[ce].destroy(),B[ce]=H7(e,j7(ce,s),y,r,n)}},render:(ee,ce,fe)=>{if(U===0||L===0)return;let O=B[ee];if(O.id===J&&c.currentRenderItemId===l)O.setUniforms(P),O.bindTextures(k,ce);else{let V=X[ee];(O.id!==c.currentProgramId||O.id!==J||i===-1||i!==c.currentMaterialId)&&(O.id!==c.currentProgramId&&O.use(),O.setUniforms(T),O.bindTextures(F,ce+k.length),c.currentMaterialId=i,J=O.id),O.setUniforms(P),O.setUniforms(w),O.bindTextures(k,ce),V?(V.bind(),Y&&Y.bind()):(Y&&Y.bind(),O.bindAttributes(z)),c.currentRenderItemId=l}if(Yt&&e.checkFramebufferStatus(`Framebuffer error rendering item id ${l}`),fe){for(let V of fe)if(V.count!==0){if(O.setUniforms(V.uniforms),h)Y?h.multiDrawElementsInstancedBaseVertexBaseInstance(D,V.counts,0,Y._dataType,V.offsets,0,V.instanceCounts,0,V.baseVertices,0,V.baseInstances,0,V.count):h.multiDrawArraysInstancedBaseInstance(D,V.firsts,0,V.counts,0,V.instanceCounts,0,V.baseInstances,0,V.count);else if(f)if(Y)for(let Z=0;Z<V.count;++Z)V.counts[Z]>0&&(O.uniform("uDrawId",Z),f.drawElementsInstancedBaseVertexBaseInstance(D,V.counts[Z],Y._dataType,V.offsets[Z],V.instanceCounts[Z],V.baseVertices[Z],V.baseInstances[Z]));else for(let Z=0;Z<V.count;++Z)V.counts[Z]>0&&(O.uniform("uDrawId",Z),f.drawArraysInstancedBaseInstance(D,V.firsts[Z],V.counts[Z],V.instanceCounts[Z],V.baseInstances[Z]));else if(Y)for(let Z=0;Z<V.count;++Z)V.counts[Z]>0&&(O.uniform("uDrawId",Z),O.offsetAttributes(j,V.baseInstances[Z]),d.drawElementsInstanced(D,V.counts[Z],Y._dataType,V.offsets[Z],V.instanceCounts[Z]));else for(let Z=0;Z<V.count;++Z)V.counts[Z]>0&&(O.uniform("uDrawId",Z),O.offsetAttributes(j,V.baseInstances[Z]),d.drawArraysInstanced(D,0,V.counts[Z],V.instanceCounts[Z]));if(je){h?u.calls.multiDrawInstancedBase+=1:f?u.calls.drawInstancedBase+=V.count:u.calls.drawInstanced+=V.count;for(let Z=0;Z<V.count;++Z)u.calls.counts+=V.instanceCounts[Z]}}}else{let V=0;for(;;){let Z=Math.min(U-V,Uqe);if(Y?d.drawElementsInstanced(D,Z,Y._dataType,V*Y._bpe,L):d.drawArraysInstanced(D,V,Z,L),V+=Z,V>=U)break}je&&(u.calls.drawInstanced+=1,u.calls.counts+=L)}Yt&&e.checkError(`Draw error rendering item id ${l}`)},update:()=>{if(Zqe(q),o.aVertex){let ee=o.uVertexCount.ref.value;o.aVertex.ref.value.length<ee&&_.update(o.aVertex,Xa(new Float32Array(ee)))}for(let ee=0,ce=E.length;ee<ce;++ee){let[fe,O]=E[ee];O.ref.version!==M[fe]&&(q.defines=!0,M[fe]=O.ref.version)}if(q.defines)for(let ee of a)B[ee].destroy(),B[ee]=H7(e,j7(ee,s),y,r,n);o.drawCount.ref.version!==M.drawCount&&(u.drawCount+=o.drawCount.ref.value-U,u.instancedDrawCount+=L*o.drawCount.ref.value-L*U,U=o.drawCount.ref.value,M.drawCount=o.drawCount.ref.version),o.instanceCount.ref.version!==M.instanceCount&&(u.instanceCount+=o.instanceCount.ref.value-L,u.instancedDrawCount+=o.instanceCount.ref.value*U-L*U,L=o.instanceCount.ref.value,M.instanceCount=o.instanceCount.ref.version);for(let ee=0,ce=z.length;ee<ce;++ee){let[fe,O]=z[ee],V=g[fe];if(V.ref.version!==M[fe]){if(O.length>=V.ref.value.length)O.updateSubData(V.ref.value,0,O.length);else{O.destroy();let{itemSize:Z,divisor:pe}=n[fe];z[ee][1]=m.attribute(V.ref.value,Z,pe),q.attributes=!0}M[fe]=V.ref.version}}if(Y&&o.elements.ref.version!==M.elements&&(Y.length>=o.elements.ref.value.length?Y.updateSubData(o.elements.ref.value,0,Y.length):(Y.destroy(),Y=m.elements(o.elements.ref.value),q.elements=!0),M.elements=o.elements.ref.version),q.attributes||q.defines||q.elements)for(let ee of a){let ce=X[ee];ce&&ce.destroy(),X[ee]=p?m.vertexArray(B[ee],z,Y):null}for(let ee=0,ce=k.length;ee<ce;++ee){let[fe,O]=k[ee],V=x[fe];V.ref.version!==M[fe]&&(n[fe].kind!=="texture"?(O.load(V.ref.value),q.textures=!0):k[ee][1]=V.ref.value,M[fe]=V.ref.version)}for(let ee=0,ce=F.length;ee<ce;++ee){let[fe,O]=F[ee],V=S[fe];V.ref.version!==M[fe]&&(n[fe].kind!=="texture"?(O.load(V.ref.value),q.textures=!0):F[ee][1]=V.ref.value,M[fe]=V.ref.version)}for(let ee=0,ce=R.length;ee<ce;++ee){let[fe,O]=R[ee];O.ref.version!==M[fe]&&(_.update(w[ee][1],Wo(O.ref.value)),M[fe]=O.ref.version)}},destroy:()=>{if(!te){for(let ee of a){B[ee].destroy();let ce=X[ee];ce&&ce.destroy()}k.forEach(([ee,ce])=>{n[ee].kind!=="texture"&&ce.destroy()}),F.forEach(([ee,ce])=>{n[ee].kind!=="texture"&&ce.destroy()}),z.forEach(([ee,ce])=>ce.destroy()),Y&&Y.destroy(),u.drawCount-=U,u.instanceCount-=L,u.instancedDrawCount-=L*U,te=!0}}}}function vo(){return vo.create(b.create(1,0,0),0)}(f=>{function e(g,y){return{normal:g,constant:y}}f.create=e;function t(g,y){return b.copy(g.normal,y.normal),g.constant=y.constant,g}f.copy=t;function r(g){return t(f(),g)}f.clone=r;function n(g,y){let x=1/b.magnitude(y.normal);return b.scale(g.normal,y.normal,x),g.constant=y.constant*x,g}f.normalize=n;function o(g,y){return b.negate(g.normal,y.normal),g.constant=-y.constant,g}f.negate=o;function i(g,y,x){return b.toArray(g.normal,y,x),y[x+3]=g.constant,y}f.toArray=i;function a(g,y,x){return b.fromArray(g.normal,y,x),g.constant=y[x+3],g}f.fromArray=a;function s(g,y,x){return b.copy(g.normal,y),g.constant=-b.dot(g.normal,x),g}f.fromNormalAndCoplanarPoint=s;function l(g,y,x,S){let I=b.triangleNormal(b(),y,x,S);return s(g,I,y),g}f.fromCoplanarPoints=l;let u=b();function c(g,y,x,S,I){b.set(u,y,x,S);let v=1/b.magnitude(u);return b.scale(g.normal,u,v),g.constant=I*v,g}f.setUnnormalized=c;function m(g,y){return b.dot(g.normal,y)+g.constant}f.distanceToPoint=m;function d(g,y){return m(g,y.center)-y.radius}f.distanceToSphere3D=d;function p(g,y,x){return b.scaleAndAdd(g,x,y.normal,-m(y,x))}f.projectPoint=p;function h(g,y,x){let S=b.dot(y.normal,x.direction);if(S===0)return!1;let I=-(b.dot(y.normal,x.origin)+y.constant)/S;return I<0?!1:(b.scaleAndAdd(g,x.origin,x.direction,I),!0)}f.intersectRay3D=h})(vo||={});function Tg(){return Tg.create(vo(),vo(),vo(),vo(),vo(),vo())}(u=>{let e;(g=>(g[g.Right=0]="Right",g[g.Left=1]="Left",g[g.Bottom=2]="Bottom",g[g.Top=3]="Top",g[g.Far=4]="Far",g[g.Near=5]="Near"))(e=u.PlaneIndex||={});function t(c,m,d,p,h,f){return[c,m,d,p,h,f]}u.create=t;function r(c,m){for(let d=0;d<6;++d)vo.copy(c[d],m[d]);return c}u.copy=r;function n(c){return r(u(),c)}u.clone=n;function o(c,m){let d=m[0],p=m[1],h=m[2],f=m[3],g=m[4],y=m[5],x=m[6],S=m[7],I=m[8],v=m[9],A=m[10],P=m[11],T=m[12],R=m[13],w=m[14],E=m[15];return vo.setUnnormalized(c[0],f-d,S-g,P-I,E-T),vo.setUnnormalized(c[1],f+d,S+g,P+I,E+T),vo.setUnnormalized(c[2],f+p,S+y,P+v,E+R),vo.setUnnormalized(c[3],f-p,S-y,P-v,E-R),vo.setUnnormalized(c[4],f-h,S-x,P-A,E-w),vo.setUnnormalized(c[5],f+h,S+x,P+A,E+w),c}u.fromProjectionMatrix=o;function i(c,m){let d=m.center,p=-m.radius;for(let h=0;h<6;++h)if(vo.distanceToPoint(c[h],d)<p)return!1;return!0}u.intersectsSphere3D=i;let a=b();function s(c,m){for(let d=0;d<6;++d){let p=c[d];if(a[0]=p.normal[0]>0?m.max[0]:m.min[0],a[1]=p.normal[1]>0?m.max[1]:m.min[1],a[2]=p.normal[2]>0?m.max[2]:m.min[2],vo.distanceToPoint(p,a)<0)return!1}return!0}u.intersectsBox3D=s;function l(c,m){for(let d=0;d<6;++d)if(vo.distanceToPoint(c[d],m)<0)return!1;return!0}u.containsPoint=l})(Tg||={});var Kk=vo.distanceToPoint,Jk=Tg.intersectsSphere3D,$k=he.fromArray,kbe=gi();function W7(e,t){return t&&t.instanceCounts.length>=e?t:{firsts:new Int32Array(e),counts:new Int32Array(e),offsets:new Int32Array(e),instanceCounts:new Int32Array(e),baseVertices:new Int32Array(e),baseInstances:new Uint32Array(e),count:0,uniforms:[]}}function lu(e,t,r){let n=kbe(),o=W7(0),i=[],a=!1,s=-1,l=he(),u=()=>{let c=t.lodLevels?.ref.value;if(c&&c.length>0){let{cellCount:m}=t.instanceGrid.ref.value;i.length=c.length;for(let d=0,p=c.length;d<p;++d)i[d]=W7(m,i[d]),i[d].count=0;if(t.lodLevels.ref.version!==s){for(let d=0,p=c.length;d<p;++d)i[d].uniforms.length!==1&&(i[d].uniforms.length=1,i[d].uniforms[0]=["uLod",_.create(Et())]),_.update(i[d].uniforms[0][1],Et.set(i[d].uniforms[0][1].ref.value,c[d][0],c[d][1],c[d][2],c[d][4]));s=t.lodLevels.ref.version}}};return u(),{id:n,materialId:e.materialId,values:t,state:r,cull:(c,m,d,p)=>{if(a=!1,t.drawCount.ref.value===0||t.instanceCount.ref.value===0||t.instanceGrid.ref.value.cellSize<=1)return;let{cellOffsets:h,cellSpheres:f,cellCount:g,batchOffsets:y,batchSpheres:x,batchCount:S,batchCell:I,batchSize:v}=t.instanceGrid.ref.value,[A,P]=t.uLod.ref.value,T=A!==0||P!==0,R=2*v,w=t.lodLevels?.ref.value;if(w&&w.length>0){if(t.lodLevels?.ref.version!==s)u();else for(let E=0,M=w.length;E<M;++E)i[E].count=0;for(let E=0;E<S;++E){let M=y[E],D=y[E+1];if(D-M===0)continue;$k(l,x,E*4);let k=Kk(c,l.center);if(T&&(k+l.radius<A||k-l.radius>P)){je&&(p.culled.lod+=h[I[D-1]+1]-h[I[M]]);continue}if(!Jk(m,l)){je&&(p.culled.frustum+=h[I[D-1]+1]-h[I[M]]);continue}if(d!==null&&d(l)){je&&(p.culled.occlusion+=h[I[D-1]+1]-h[I[M]]);continue}for(let F=M;F<D;++F){let z=I[F],j=h[z],G=h[z+1]-j;if(G===0)continue;$k(l,f,z*4);let X=Kk(c,l.center);if(T&&(X+l.radius<A||X-l.radius>P)){je&&(p.culled.lod+=G);continue}if(!Jk(m,l)){je&&(p.culled.frustum+=G);continue}if(d!==null&&X-l.radius<R&&d(l)){je&&(p.culled.occlusion+=G);continue}for(let U=0,L=w.length;U<L;++U){if(X+l.radius<w[U][0]||X-l.radius>w[U][1])continue;let q=i[U],te=q.count;te>0&&q.baseInstances[te-1]+q.instanceCounts[te-1]===j&&q.counts[te-1]===w[U][3]?q.instanceCounts[te-1]+=G:(q.counts[te]=w[U][3],q.instanceCounts[te]=G,q.baseInstances[te]=j,q.count+=1)}}}}else{o=W7(g,o);let{baseInstances:E,instanceCounts:M,counts:D}=o,B=0;for(let k=0;k<S;++k){let F=y[k],z=y[k+1];if(z-F!==0){if($k(l,x,k*4),T){let Y=Kk(c,l.center);if(Y+l.radius<A||Y-l.radius>P){je&&(p.culled.lod+=h[I[z-1]+1]-h[I[F]]);continue}}if(!Jk(m,l)){je&&(p.culled.frustum+=h[I[z-1]+1]-h[I[F]]);continue}if(d!==null&&d(l)){je&&(p.culled.occlusion+=h[I[z-1]+1]-h[I[F]]);continue}for(let Y=F;Y<z;++Y){let G=I[Y],X=h[G],L=h[G+1]-X;if(L===0)continue;$k(l,f,G*4);let q=Kk(c,l.center);if(T&&(q+l.radius<A||q-l.radius>P)){je&&(p.culled.lod+=L);continue}if(!Jk(m,l)){je&&(p.culled.frustum+=L);continue}if(d!==null&&q-l.radius<R&&d(l)){je&&(p.culled.occlusion+=L);continue}B>0&&E[B-1]+M[B-1]===X?M[B-1]+=L:(D[B]=t.drawCount.ref.value,M[B]=L,E[B]=X,B+=1)}}}o.count=B,i.length=1,i[0]=o,i[0].uniforms.length=0}a=!0},uncull:()=>{a=!1},cullSimple:(c,m,d)=>{let p=t.lodLevels?.ref.value;if(!(!p||p.length===0)){if(t.lodLevels?.ref.version!==s)u();else for(let h=0,f=p.length;h<f;++h)i[h].count=0;for(let h=0,f=p.length;h<f;++h)if(c+m<p[h][1]*d){let g=i[h],y=g.count;g.counts[y]=p[h][3],g.instanceCounts[y]=t.instanceCount.ref.value,g.baseInstances[y]=0,g.count+=1;break}a=!0}},render:(c,m)=>{t.uAlpha&&t.alpha&&_.updateIfChanged(t.uAlpha,_r(t.alpha.ref.value*r.alphaFactor,0,1)),e.render(c,m,a?i:void 0)},getByteCount:()=>e.getByteCount(),getProgram:c=>e.getProgram(c),setTransparency:c=>e.setTransparency(c),update:()=>{e.update(),u()},dispose:()=>e.destroy()}}function an(e,t){return{id:kbe(),values:t,render:()=>{e.getProgram("compute").finalize(!0),e.render("compute",0)},update:()=>e.update(),dispose:()=>e.destroy()}}var dR=new Float32Array([1,1,-1,1,-1,-1,-1,-1,1,-1,1,1]),Sn={drawCount:Qn("number"),instanceCount:Qn("number"),aPosition:Vn("float32",2,0),uQuadScale:de("v2")},vn={drawCount:_.create(6),instanceCount:_.create(1),aPosition:_.create(dR),uQuadScale:_.create(Ce.create(1,1))},qqe={...Sn,tColor:yt("texture","rgba","ubyte","nearest"),uTexSize:de("v2")},Yqe=zr("copy",Fn,Bbe);function Gm(e,t){let r={...vn,tColor:_.create(t),uTexSize:_.create(Ce.create(t.getWidth(),t.getHeight()))},n={...qqe},o=on(e,"triangles",Yqe,n,r);return an(o,r)}var Fbe=new Uint32Array([0,1,2,1,3,2]),Kqe=new Float32Array([0,1,0,0,1,1,1,0]),eF={nearest:"Nearest",catmulrom:"Catmulrom (Cubic)",mitchell:"Mitchell (Cubic)",bspline:"B-Spline (Cubic)"},byr=Object.keys(eF);var Gu;(f=>{function e(){return{type:0,center:b(),rotation:lr(),scale:b(),transform:H()}}f.createEmptyTrim=e;function t(g,y,x,S,I,v,A){return A?o(g,y,x,S,I,v,A):n(g,y,x,S,I,v)}f.create=t;function r(g){return ui([g.cornerBuffer.ref.version])}function n(g,y,x,S,I,v){let A=he(),P=-1,T=g.width,R=g.height,w={kind:"image",imageTexture:_.create(g),imageTextureDim:_.create(Ce.create(T,R)),cornerBuffer:_.create(y),groupTexture:_.create(x),valueTexture:_.create(S),trimType:_.create(I.type),trimCenter:_.create(I.center),trimRotation:_.create(I.rotation),trimScale:_.create(I.scale),trimTransform:_.create(I.transform),isoLevel:_.create(v),get boundingSphere(){let E=r(w);if(E!==P){let M=Jqe(w.cornerBuffer.ref.value);he.copy(A,M),P=E}return A},setBoundingSphere(E){he.copy(A,E),P=r(w)}};return w}function o(g,y,x,S,I,v,A){let P=g.width,T=g.height;return _.update(A.imageTexture,g),_.update(A.imageTextureDim,Ce.set(A.imageTextureDim.ref.value,P,T)),_.update(A.cornerBuffer,y),_.update(A.groupTexture,x),_.update(A.valueTexture,S),_.updateIfChanged(A.trimType,I.type),_.update(A.trimCenter,b.copy(A.trimCenter.ref.value,I.center)),_.update(A.trimRotation,lr.copy(A.trimRotation.ref.value,I.rotation)),_.update(A.trimScale,b.copy(A.trimScale.ref.value,I.scale)),_.update(A.trimTransform,H.copy(A.trimTransform.ref.value,I.transform)),_.updateIfChanged(A.isoLevel,v),A}function i(g){let y=So(0,4,Uint8Array),x=g?g.cornerBuffer.ref.value:new Float32Array(24),S=So(0,4,Uint8Array),I=So(0,1,Float32Array),v=e();return t(y,x,S,I,v,-1,g)}f.createEmpty=i,f.Params={...Xe.Params,interpolation:C.Select("bspline",C.objectToOptions(eF))},f.Utils={Params:f.Params,createEmpty:i,createValues:u,createValuesSimple:c,updateValues:m,updateBoundingSphere:d,createRenderableState:p,updateRenderableState:h,createPositionIterator:l};function l(g,y){return un(1,1,1,()=>Vu)}function u(g,y,x,S,I){let{instanceCount:v,groupCount:A}=x,P=l(g,y),T=ya(x,P,S.color),R=I.instanceGranularity?yo(v,"instance"):yo(v*A,"groupInstance"),w=ql(),E=Yl(),M=$l(),D=Jl(),B=Kl(),k={drawCount:Fbe.length,vertexCount:dR.length/3,groupCount:A,instanceCount:v},F=he.clone(g.boundingSphere),z=Li(F,y.aTransform.ref.value,v,0);return{dGeometryType:_.create("image"),...T,...R,...w,...E,...M,...D,...B,...y,...Xe.createValues(I,k),aPosition:g.cornerBuffer,aUv:_.create(Kqe),elements:_.create(Fbe),aGroup:_.create(Xa(new Float32Array(4))),boundingSphere:_.create(z),invariantBoundingSphere:_.create(F),uInvariantBoundingSphere:_.create(Et.ofSphere(F)),dInterpolation:_.create(I.interpolation),uImageTexDim:g.imageTextureDim,tImageTex:g.imageTexture,tGroupTex:g.groupTexture,tValueTex:g.valueTexture,uTrimType:g.trimType,uTrimCenter:g.trimCenter,uTrimRotation:g.trimRotation,uTrimScale:g.trimScale,uTrimTransform:g.trimTransform,uIsoLevel:g.isoLevel}}function c(g,y,x,S,I){let v=Xe.createSimple(x,S,I),A={...C.getDefaultValues(f.Params),...y};return u(g,v.transform,v.locationIterator,v.theme,A)}function m(g,y){Xe.updateValues(g,y),_.updateIfChanged(g.dInterpolation,y.interpolation)}function d(g,y){let x=he.clone(y.boundingSphere),S=Li(x,g.aTransform.ref.value,g.instanceCount.ref.value,0);he.equals(S,g.boundingSphere.ref.value)||_.update(g.boundingSphere,S),he.equals(x,g.invariantBoundingSphere.ref.value)||(_.update(g.invariantBoundingSphere,x),_.update(g.uInvariantBoundingSphere,Et.fromSphere(g.uInvariantBoundingSphere.ref.value,x)))}function p(g){let y=Xe.createRenderableState(g);return y.opaque=!1,y}function h(g,y){Xe.updateRenderableState(g,y),g.opaque=!1}})(Gu||={});function Jqe(e){let t=b(),r=[];for(let i=0,a=e.length;i<a;i+=3){let s=b.fromArray(b(),e,i);r.push(s),b.add(t,t,s)}b.scale(t,t,1/(e.length/3));let n=0;for(let i of r){let a=b.distance(t,i);a>n&&(n=a)}let o=he.create(t,n);return he.setExtrema(o,r),o}var ji;(f=>{function e(g,y,x,S,I,v,A,P,T,R){return R?o(g,y,x,S,I,v,A,P,T,R):n(g,y,x,S,I,v,A,P,T)}f.create=e;function t(g){let y=g?g.mappingBuffer.ref.value:new Float32Array(0),x=g?g.indexBuffer.ref.value:new Uint32Array(0),S=g?g.groupBuffer.ref.value:new Float32Array(0),I=g?g.startBuffer.ref.value:new Float32Array(0),v=g?g.endBuffer.ref.value:new Float32Array(0),A=g?g.scaleBuffer.ref.value:new Float32Array(0),P=g?g.capBuffer.ref.value:new Float32Array(0),T=g?g.colorModeBuffer.ref.value:new Float32Array(0);return e(y,x,S,I,v,A,P,T,0,g)}f.createEmpty=t;function r(g){return ui([g.cylinderCount,g.mappingBuffer.ref.version,g.indexBuffer.ref.version,g.groupBuffer.ref.version,g.startBuffer.ref.version,g.endBuffer.ref.version,g.scaleBuffer.ref.version,g.capBuffer.ref.version,g.colorModeBuffer.ref.version])}function n(g,y,x,S,I,v,A,P,T){let R=he(),w,E=-1,M=-1,D={kind:"cylinders",cylinderCount:T,mappingBuffer:_.create(g),indexBuffer:_.create(y),groupBuffer:_.create(x),startBuffer:_.create(S),endBuffer:_.create(I),scaleBuffer:_.create(v),capBuffer:_.create(A),colorModeBuffer:_.create(P),get boundingSphere(){let B=r(D);if(B!==E){let k=Vm(D.startBuffer.ref.value,D.cylinderCount*6,6),F=Vm(D.endBuffer.ref.value,D.cylinderCount*6,6);he.expandBySphere(R,k,F),E=B}return R},get groupMapping(){return D.groupBuffer.ref.version!==M&&(w=Cp(D.groupBuffer.ref.value,D.cylinderCount,6),M=D.groupBuffer.ref.version),w},setBoundingSphere(B){he.copy(R,B),E=r(D)}};return D}function o(g,y,x,S,I,v,A,P,T,R){return T>R.cylinderCount&&(_.update(R.mappingBuffer,g),_.update(R.indexBuffer,y)),R.cylinderCount=T,_.update(R.groupBuffer,x),_.update(R.startBuffer,S),_.update(R.endBuffer,I),_.update(R.scaleBuffer,v),_.update(R.capBuffer,A),_.update(R.colorModeBuffer,P),R}function i(g,y){let x=g.startBuffer.ref.value;Zc(y,x,0,g.cylinderCount*6),_.update(g.startBuffer,x);let S=g.endBuffer.ref.value;Zc(y,S,0,g.cylinderCount*6),_.update(g.endBuffer,S)}f.transform=i,f.Params={...Xe.Params,sizeFactor:C.Numeric(1,{min:0,max:10,step:.1}),sizeAspectRatio:C.Numeric(1,{min:0,max:3,step:.01}),doubleSided:C.Boolean(!1,Xe.CustomQualityParamInfo),ignoreLight:C.Boolean(!1,Xe.ShadingCategory),celShaded:C.Boolean(!1,Xe.ShadingCategory),xrayShaded:C.Select(!1,[[!1,"Off"],[!0,"On"],["inverted","Inverted"]],Xe.ShadingCategory),transparentBackfaces:C.Select("off",C.arrayToOptions(["off","on","opaque"]),Xe.ShadingCategory),solidInterior:C.Boolean(!0,Xe.ShadingCategory),bumpFrequency:C.Numeric(0,{min:0,max:10,step:.1},Xe.ShadingCategory),bumpAmplitude:C.Numeric(1,{min:0,max:5,step:.1},Xe.ShadingCategory),interior:vp(),colorMode:C.Select("default",C.arrayToOptions(["default","interpolate"]),Xe.ShadingCategory)},f.Utils={Params:f.Params,createEmpty:t,createValues:u,createValuesSimple:c,updateValues:m,updateBoundingSphere:d,createRenderableState:p,updateRenderableState:h,createPositionIterator:l};function l(g,y){let x=g.cylinderCount*6,S=y.instanceCount.ref.value,I=zs(),v=I.position,A=g.startBuffer.ref.value,P=g.endBuffer.ref.value,T=y.aTransform.ref.value;return un(x,S,2,(w,E)=>{let M=w%6===0?A:P;return E<0?b.fromArray(v,M,w*3):b.transformMat4Offset(v,M,T,0,w*3,E*16),I})}function u(g,y,x,S,I){let{instanceCount:v,groupCount:A}=x,P=l(g,y),T=ya(x,P,S.color),R=eu(x,S.size),w=I.instanceGranularity?yo(v,"instance"):yo(v*A,"groupInstance"),E=ql(),M=Yl(),D=$l(),B=Jl(),k=Kl(),F={drawCount:g.cylinderCount*4*3,vertexCount:g.cylinderCount*6,groupCount:A,instanceCount:v},z=CC(R)*I.sizeFactor,j=he.clone(g.boundingSphere),Y=Li(j,y.aTransform.ref.value,v,0);return{dGeometryType:_.create("cylinders"),aMapping:g.mappingBuffer,aGroup:g.groupBuffer,aStart:g.startBuffer,aEnd:g.endBuffer,aScale:g.scaleBuffer,aCap:g.capBuffer,aColorMode:g.colorModeBuffer,elements:g.indexBuffer,boundingSphere:_.create(Y),invariantBoundingSphere:_.create(j),uInvariantBoundingSphere:_.create(Et.ofSphere(j)),...T,...R,...w,...E,...M,...D,...B,...k,...y,padding:_.create(z),...Xe.createValues(I,F),uSizeFactor:_.create(I.sizeFactor*I.sizeAspectRatio),uDoubleSided:_.create(I.doubleSided),dIgnoreLight:_.create(I.ignoreLight),dCelShaded:_.create(I.celShaded),dXrayShaded:_.create(I.xrayShaded==="inverted"?"inverted":I.xrayShaded===!0?"on":"off"),dTransparentBackfaces:_.create(I.transparentBackfaces),dSolidInterior:_.create(I.solidInterior),uBumpFrequency:_.create(I.bumpFrequency),uBumpAmplitude:_.create(I.bumpAmplitude),uInteriorColor:_.create(Ip(I.interior,Et())),uInteriorSubstance:_.create(Ap(I.interior,Et())),dDualColor:_.create(I.colorMode==="interpolate")}}function c(g,y,x,S,I){let v=Xe.createSimple(x,S,I),A={...C.getDefaultValues(f.Params),...y};return u(g,v.transform,v.locationIterator,v.theme,A)}function m(g,y){Xe.updateValues(g,y),_.updateIfChanged(g.uSizeFactor,y.sizeFactor*y.sizeAspectRatio),_.updateIfChanged(g.uDoubleSided,y.doubleSided),_.updateIfChanged(g.dIgnoreLight,y.ignoreLight),_.updateIfChanged(g.dCelShaded,y.celShaded),_.updateIfChanged(g.dXrayShaded,y.xrayShaded==="inverted"?"inverted":y.xrayShaded===!0?"on":"off"),_.updateIfChanged(g.dTransparentBackfaces,y.transparentBackfaces),_.updateIfChanged(g.dSolidInterior,y.solidInterior),_.updateIfChanged(g.uBumpFrequency,y.bumpFrequency),_.updateIfChanged(g.uBumpAmplitude,y.bumpAmplitude),_.update(g.uInteriorColor,Ip(y.interior,g.uInteriorColor.ref.value)),_.update(g.uInteriorSubstance,Ap(y.interior,g.uInteriorSubstance.ref.value)),_.updateIfChanged(g.dDualColor,y.colorMode==="interpolate")}function d(g,y){let x=he.clone(y.boundingSphere),S=Li(x,g.aTransform.ref.value,g.instanceCount.ref.value,0);he.equals(S,g.boundingSphere.ref.value)||_.update(g.boundingSphere,S),he.equals(x,g.invariantBoundingSphere.ref.value)||(_.update(g.invariantBoundingSphere,x),_.update(g.uInvariantBoundingSphere,Et.fromSphere(g.uInvariantBoundingSphere.ref.value,x)))}function p(g){let y=Xe.createRenderableState(g);return h(y,g),y}function h(g,y){Xe.updateRenderableState(g,y),g.opaque=g.opaque&&!y.xrayShaded,g.writeDepth=g.opaque}})(ji||={});var ba;(i=>{function e(a){switch(a.kind){case"mesh":return a.triangleCount*3;case"points":return a.pointCount;case"spheres":return a.sphereCount*2*3;case"cylinders":return a.cylinderCount*4*3;case"text":return a.charCount*2*3;case"lines":return a.lineCount*2*3;case"direct-volume":return 36;case"image":return 6;case"texture-mesh":return a.vertexCount}}i.getDrawCount=e;function t(a){switch(a.kind){case"mesh":return a.vertexCount;case"points":return a.pointCount;case"spheres":return a.sphereCount*6;case"cylinders":return a.cylinderCount*6;case"text":return a.charCount*4;case"lines":return a.lineCount*4;case"direct-volume":let[s,l,u]=a.gridDimension.ref.value;return s*l*u;case"image":return 4;case"texture-mesh":return a.vertexCount}}i.getVertexCount=t;function r(a){switch(a.kind){case"mesh":case"points":case"spheres":case"cylinders":case"text":case"lines":return e(a)===0?0:xl(a.groupBuffer.ref.value)+1;case"direct-volume":return 1;case"image":return gbe(a.groupTexture.ref.value.array,4)+1;case"texture-mesh":return a.groupCount}}i.getGroupCount=r;function n(a){switch(a.kind){case"mesh":return ft.Utils;case"points":return Dl.Utils;case"spheres":return Hs.Utils;case"cylinders":return ji.Utils;case"text":return na.Utils;case"lines":return Cn.Utils;case"direct-volume":return tu.Utils;case"image":return Gu.Utils;case"texture-mesh":return Ss.Utils}}i.getUtils=n;function o(a,s){return s==="instance"&&a.nonInstanceable?"group":s}i.getGranularity=o})(ba||={});var $qe=1,eYe="Assigns sizes as defined by the shape object.",Lbe={};function tYe(e){return Lbe}function tF(e,t){return{factory:tF,granularity:"groupInstance",size:r=>al.isLocation(r)?r.shape.getSize(r.group,r.instance):$qe,props:t,description:eYe}}var Vbe={name:"shape-group",label:"Shape Group",category:"",factory:tF,getParams:tYe,defaultValues:C.getDefaultValues(Lbe),isApplicable:e=>!!e.shape};var rYe={...au,aPosition:Vn("float32",3,0),elements:Tp("uint32"),uBboxMin:de("v3"),uBboxMax:de("v3"),uBboxSize:de("v3"),uMaxSteps:de("i"),uStepScale:de("f"),uJumpLength:de("f"),uTransform:de("m4"),uGridDim:de("v3"),tTransferTex:yt("image-uint8","alpha","ubyte","linear"),uTransferScale:de("f","material"),dGridTexType:dt("string",["2d","3d"]),uGridTexDim:de("v3"),tGridTex:yt("texture","rgba","ubyte","linear"),uGridStats:de("v4"),uCellDim:de("v3"),uCartnToUnit:de("m4"),uUnitToCartn:de("m4"),dPackedGroup:dt("boolean"),dAxisOrder:dt("string",["012","021","102","120","201","210"]),dIgnoreLight:dt("boolean"),dCelShaded:dt("boolean"),dXrayShaded:dt("string",["off","on","inverted"]),meta:Qn("unknown")};function Obe(e,t,r,n,o,i,a){let s={...ru,...nu,...ou,...iu,...rYe};e.isWebGL2||(s.uMaxSteps=dt("number"));let l={...r,uObjectId:_.create(t),dLightCount:_.create(a.dLightCount),dColorMarker:_.create(a.dColorMarker)},c=su(e,"triangles",Jge,s,l,o,i);return lu(c,l,n)}var nYe={...au,aGroup:Vn("float32",1,0),aPosition:Vn("float32",3,0),aNormal:Vn("float32",3,0),elements:Tp("uint32"),dVaryingGroup:dt("boolean"),dFlatShaded:dt("boolean"),uDoubleSided:de("b","material"),dFlipSided:dt("boolean"),dIgnoreLight:dt("boolean"),dCelShaded:dt("boolean"),dXrayShaded:dt("string",["off","on","inverted"]),dTransparentBackfaces:dt("string",["off","on","opaque"]),uBumpFrequency:de("f","material"),uBumpAmplitude:de("f","material"),uInteriorColor:de("v4"),uInteriorSubstance:de("v4"),meta:Qn("unknown")};function Gbe(e,t,r,n,o,i,a){let s={...ru,...nu,...ou,...iu,...nYe},l={...r,uObjectId:_.create(t),dLightCount:_.create(a.dLightCount),dColorMarker:_.create(a.dColorMarker)},c=su(e,"triangles",Ek,s,l,o,i);return lu(c,l,n)}var oYe={...au,...Ag,aGroup:Vn("float32",1,0),aPosition:Vn("float32",3,0),dPointSizeAttenuation:dt("boolean"),dPointStyle:dt("string",["square","circle","fuzzy"])};function Ube(e,t,r,n,o,i,a){let s={...ru,...nu,...ou,...iu,...oYe},l={...r,uObjectId:_.create(t),dLightCount:_.create(a.dLightCount),dColorMarker:_.create(a.dColorMarker)},c=su(e,"points",Qge,s,l,o,i);return lu(c,l,n)}var iYe={...au,...Ag,aGroup:Vn("float32",1,0),aMapping:Vn("float32",2,0),aStart:Vn("float32",3,0),aEnd:Vn("float32",3,0),elements:Tp("uint32"),dLineSizeAttenuation:dt("boolean"),uDoubleSided:de("b","material"),dFlipSided:dt("boolean")};function Nbe(e,t,r,n,o,i,a){let s={...ru,...nu,...ou,...iu,...iYe},l={...r,uObjectId:_.create(t),dLightCount:_.create(a.dLightCount),dColorMarker:_.create(a.dColorMarker)},c=su(e,"triangles",Kge,s,l,o,i);return lu(c,l,n)}var aYe={...au,...Ag,uTexDim:de("v2"),tPositionGroup:yt("image-float32","rgba","float","nearest"),padding:Qn("number"),uDoubleSided:de("b","material"),dIgnoreLight:dt("boolean"),dCelShaded:dt("boolean"),dXrayShaded:dt("string",["off","on","inverted"]),dTransparentBackfaces:dt("string",["off","on","opaque"]),dSolidInterior:dt("boolean"),dClipPrimitive:dt("boolean"),dApproximate:dt("boolean"),uAlphaThickness:de("f"),uBumpFrequency:de("f","material"),uBumpAmplitude:de("f","material"),uInteriorColor:de("v4"),uInteriorSubstance:de("v4"),lodLevels:Qn("unknown"),centerBuffer:Qn("float32"),groupBuffer:Qn("float32")};function zbe(e,t,r,n,o,i,a){let s={...ru,...nu,...ou,...iu,...aYe},l={...r,uObjectId:_.create(t),dLightCount:_.create(a.dLightCount),dColorMarker:_.create(a.dColorMarker)},c=su(e,"triangles",Zge,s,l,o,i);return lu(c,l,n)}var sYe={...au,...Ag,aGroup:Vn("float32",1,0),aPosition:Vn("float32",3,0),aMapping:Vn("float32",2,0),aDepth:Vn("float32",1,0),elements:Tp("uint32"),aTexCoord:Vn("float32",2,0),tFont:yt("image-uint8","alpha","ubyte","linear"),padding:Qn("number"),uBorderWidth:de("f","material"),uBorderColor:de("v3","material"),uOffsetX:de("f","material"),uOffsetY:de("f","material"),uOffsetZ:de("f","material"),uBackgroundColor:de("v3","material"),uBackgroundOpacity:de("f","material")};function Hbe(e,t,r,n,o,i,a){let s={...ru,...nu,...ou,...iu,...sYe},l={...r,uObjectId:_.create(t),dLightCount:_.create(a.dLightCount),dColorMarker:_.create(a.dColorMarker)},c=su(e,"triangles",Yge,s,l,o,i);return lu(c,l,n)}var lYe={...au,uGeoTexDim:de("v2","buffered"),tPosition:yt("texture","rgb","float","nearest"),tGroup:yt("texture","alpha","float","nearest"),tNormal:yt("texture","rgb","float","nearest"),dVaryingGroup:dt("boolean"),dFlatShaded:dt("boolean"),uDoubleSided:de("b","material"),dFlipSided:dt("boolean"),dIgnoreLight:dt("boolean"),dCelShaded:dt("boolean"),dXrayShaded:dt("string",["off","on","inverted"]),dTransparentBackfaces:dt("string",["off","on","opaque"]),uBumpFrequency:de("f","material"),uBumpAmplitude:de("f","material"),uInteriorColor:de("v4"),uInteriorSubstance:de("v4"),meta:Qn("unknown")};function jbe(e,t,r,n,o,i,a){let s={...ru,...nu,...ou,...iu,...lYe},l={...r,uObjectId:_.create(t),dLightCount:_.create(a.dLightCount),dColorMarker:_.create(a.dColorMarker)},c=su(e,"triangles",Ek,s,l,o,i);return lu(c,l,n)}var uYe={...au,aGroup:Vn("float32",1,0),aPosition:Vn("float32",3,0),aUv:Vn("float32",2,0),elements:Tp("uint32"),uImageTexDim:de("v2"),tImageTex:yt("image-uint8","rgba","ubyte","nearest"),tGroupTex:yt("image-uint8","rgba","ubyte","nearest"),tValueTex:yt("image-float32","alpha","float","linear"),uTrimType:de("i"),uTrimCenter:de("v3"),uTrimRotation:de("q"),uTrimScale:de("v3"),uTrimTransform:de("m4"),uIsoLevel:de("f"),dInterpolation:dt("string",["nearest","catmulrom","mitchell","bspline"])};function Wbe(e,t,r,n,o,i,a){let s={...ru,...nu,...ou,...iu,...uYe},l={...r,uObjectId:_.create(t),dLightCount:_.create(a.dLightCount),dColorMarker:_.create(a.dColorMarker)},c=su(e,"triangles",$ge,s,l,o,i);return lu(c,l,n)}var cYe={...au,...Ag,aGroup:Vn("float32",1,0),aStart:Vn("float32",3,0),aEnd:Vn("float32",3,0),aMapping:Vn("float32",3,0),aScale:Vn("float32",1,0),aCap:Vn("float32",1,0),aColorMode:Vn("float32",1,0),elements:Tp("uint32"),padding:Qn("number"),uDoubleSided:de("b","material"),dIgnoreLight:dt("boolean"),dCelShaded:dt("boolean"),dXrayShaded:dt("string",["off","on","inverted"]),dTransparentBackfaces:dt("string",["off","on","opaque"]),dSolidInterior:dt("boolean"),uBumpFrequency:de("f","material"),uBumpAmplitude:de("f","material"),uInteriorColor:de("v4"),uInteriorSubstance:de("v4"),dDualColor:dt("boolean")};function Xbe(e,t,r,n,o,i,a){let s={...ru,...nu,...ou,...iu,...cYe},l={...r,uObjectId:_.create(t),dLightCount:_.create(a.dLightCount),dColorMarker:_.create(a.dColorMarker)},c=su(e,"triangles",qge,s,l,o,i);return lu(c,l,n)}var mYe=gi(0,2147483647),Kc=gi(0,2147483647);function Pp(e,t,r,n){return{id:mYe(),type:e,values:t,state:r,materialId:n}}function Qbe(e,t,r,n){switch(t.type){case"mesh":return Gbe(e,t.id,t.values,t.state,t.materialId,r,n);case"points":return Ube(e,t.id,t.values,t.state,t.materialId,r,n);case"spheres":return zbe(e,t.id,t.values,t.state,t.materialId,r,n);case"cylinders":return Xbe(e,t.id,t.values,t.state,t.materialId,r,n);case"text":return Hbe(e,t.id,t.values,t.state,t.materialId,r,n);case"lines":return Nbe(e,t.id,t.values,t.state,t.materialId,r,n);case"direct-volume":return Obe(e,t.id,t.values,t.state,t.materialId,r,n);case"image":return Wbe(e,t.id,t.values,t.state,t.materialId,r,n);case"texture-mesh":return jbe(e,t.id,t.values,t.state,t.materialId,r,n)}Mr(t.type)}var Wr;(u=>{function e(c,m,d,p,h,f,g,y){return{id:fn.create22(),name:c,sourceData:m,geometry:d,transforms:g||[H.identity()],get groupCount(){return y??ba.getGroupCount(d)},getColor:p,getSize:h,getLabel:f}}u.create=e;function t(c){return{color:rF({shape:c},{}),size:tF({shape:c},{})}}u.getTheme=t;function r(c){let m=c.transforms.length,d=al.Location(c),p=(h,f)=>(d.group=h,d.instance=f,d);return un(c.groupCount,m,1,p)}u.groupIterator=r;function n(c,m,d,p,h){let f=h&&h.aTransform.ref.value.length>=c.length*16?h.aTransform.ref.value:new Float32Array(c.length*16);for(let g=0,y=c.length;g<y;++g)H.toArray(c[g],f,g*16);return WS(f,c.length,m,d,p,h)}u.createTransform=n;function o(c,m){let d=t(c),p=ba.getUtils(c.geometry),h=Kc(),f=r(c),g=n(c.transforms,c.geometry.boundingSphere,m.cellSize,m.batchSize),y=p.createValues(c.geometry,g,f,d,m),x=p.createRenderableState(m);return Pp(c.geometry.kind,y,x,h)}u.createRenderObject=o;function i(c){return{kind:"shape-loci",shape:c}}u.Loci=i;function a(c){return!!c&&c.kind==="shape-loci"}u.isLoci=a;function s(c,m){return c.shape===m.shape}u.areLociEqual=s;function l(c){return c.shape.groupCount===0}u.isLociEmpty=l})(Wr||={});var al;(d=>{function e(p,h=0,f=0){return{kind:"group-location",shape:p,group:h,instance:f}}d.Location=e;function t(p){return!!p&&p.kind==="group-location"}d.isLocation=t;function r(p,h){return{kind:"group-loci",shape:p,groups:h}}d.Loci=r;function n(p){return!!p&&p.kind==="group-loci"}d.isLoci=n;function o(p,h){if(p.shape!==h.shape||p.groups.length!==h.groups.length)return!1;for(let f=0,g=p.groups.length;f<g;++f){let{ids:y,instance:x}=p.groups[f],{ids:S,instance:I}=h.groups[f];if(x!==I||!xe.areEqual(y,S))return!1}return!0}d.areLociEqual=o;function i(p){return a(p)===0}d.isLociEmpty=i;function a(p){let h=0;for(let f of p.groups)h+=xe.size(f.ids);return h}d.size=a;let s=new ku,l=b.zero();function u(p,h,f,g){let{indices:y,offsets:x}=h;for(let{ids:S,instance:I}of p)xe.forEach(S,v=>{for(let A=x[v],P=x[v+1];A<P;++A)b.fromArray(l,f,y[A]*3),b.transformMat4(l,l,g[I]),s.includeStep(l)})}function c(p,h,f,g){let{indices:y,offsets:x}=h;for(let{ids:S,instance:I}of p)xe.forEach(S,v=>{for(let A=x[v],P=x[v+1];A<P;++A)b.fromArray(l,f,y[A]*3),b.transformMat4(l,l,g[I]),s.radiusStep(l)})}function m(p,h){h||(h=he()),s.reset();let f=0,{geometry:g,transforms:y}=p.shape;if(g.kind==="mesh"||g.kind==="points"){let x=g.kind==="mesh"?g.vertexBuffer.ref.value:g.centerBuffer.ref.value;u(p.groups,g.groupMapping,x,y),s.finishedIncludeStep(),c(p.groups,g.groupMapping,x,y)}else if(g.kind==="lines"){let x=g.startBuffer.ref.value,S=g.endBuffer.ref.value;u(p.groups,g.groupMapping,x,y),u(p.groups,g.groupMapping,S,y),s.finishedIncludeStep(),c(p.groups,g.groupMapping,x,y),c(p.groups,g.groupMapping,S,y)}else if(g.kind==="spheres"||g.kind==="text"){let x=g.centerBuffer.ref.value;u(p.groups,g.groupMapping,x,y),s.finishedIncludeStep(),c(p.groups,g.groupMapping,x,y);for(let{ids:S,instance:I}of p.groups)xe.forEach(S,v=>{let A=p.shape.getSize(v,I);f<A&&(f=A)})}else return he.copy(h,g.boundingSphere);return b.copy(h.center,s.center),h.radius=Math.sqrt(s.radiusSq),he.expand(h,h,f),h}d.getBoundingSphere=m})(al||={});var dYe=13421772,pYe="Assigns colors as defined by the shape object.",Zbe={};function fYe(e){return Zbe}function rF(e,t){return{factory:rF,granularity:"groupInstance",color:r=>al.isLocation(r)?r.shape.getColor(r.group,r.instance):dYe,props:t,description:pYe}}var qbe={name:"shape-group",label:"Shape Group",category:yr.Misc,factory:rF,getParams:fYe,defaultValues:C.getDefaultValues(Zbe),isApplicable:e=>!!e.shape};var hYe=16777113,gYe="Assigns a color based on the uncertainty or disorder of an element's position, e.g. B-factor or RMSF, depending on the data availability and experimental technique.",nF={domain:C.Interval([0,100]),list:C.ColorList("red-white-blue",{presetKind:"scale"})};function yYe(e){return nF}function Ybe(e,t){return ue.isAtomic(e)?e.model.atomicConformation.B_iso_or_equiv.value(t):ue.isSpheres(e)?e.model.coarseConformation.spheres.rmsf[t]:0}function oF(e,t){let r;t.list.kind==="set"?r=Ja.createDiscrete({reverse:!0,domain:t.domain,listOrName:t.list.colors}):r=Ja.create({reverse:!0,domain:t.domain,listOrName:t.list.colors});function n(o){return Q.Location.is(o)?r.color(Ybe(o.unit,o.element)):It.isLocation(o)?r.color(Ybe(o.aUnit,o.aUnit.elements[o.aIndex])):hYe}return{factory:oF,granularity:"group",preferSmoothing:!0,color:n,props:t,description:gYe,legend:r?r.legend:void 0}}var Kbe={name:"uncertainty",label:"Uncertainty/Disorder",category:yr.Atom,factory:oF,getParams:yYe,defaultValues:C.getDefaultValues(nF),isApplicable:e=>!!e.structure&&e.structure.models.some(t=>t.atomicConformation.B_iso_or_equiv.isDefined||t.coarseHierarchy.isDefined)};var bYe=15658734,xYe="Assigns an illustrative color that gives every chain a color based on the chosen style but with lighter carbons (inspired by David Goodsell's Molecule of the Month style).",Jbe={style:C.MappedStatic("entity-id",{uniform:C.Group(ob),"chain-id":C.Group(mg),"entity-id":C.Group(fg),"entity-source":C.Group(gg),"molecule-type":C.Group(yC),"model-index":C.Group(bg),"structure-index":C.Group(Cg),"trajectory-index":C.Group(hC)}),carbonLightness:C.Numeric(.8,{min:-6,max:6,step:.1})};function CYe(e){return C.clone(Jbe)}function SYe(e,t){switch(t.name){case"uniform":return Qf(e,t.params);case"chain-id":return dg(e,t.params);case"entity-id":return hg(e,t.params);case"entity-source":return yg(e,t.params);case"molecule-type":return bC(e,t.params);case"model-index":return xg(e,t.params);case"structure-index":return Sg(e,t.params);case"trajectory-index":return gC(e,t.params);default:Mr(t)}}function $be(e,t){let{color:r,legend:n,contextHash:o}=SYe(e,t.style);function i(s,l){let u=r(s,!1);return l==="C"?Le.lighten(u,t.carbonLightness):u}function a(s){if(Q.Location.is(s)&&ue.isAtomic(s.unit)){let l=s.unit.model.atomicHierarchy.atoms.type_symbol.value(s.element);return i(s,l)}else if(It.isLocation(s)&&ue.isAtomic(s.aUnit)){let l=s.aUnit.elements[s.aIndex],u=s.aUnit.model.atomicHierarchy.atoms.type_symbol.value(l);return i(s,u)}return bYe}return{factory:$be,granularity:"group",preferSmoothing:!0,color:a,props:t,contextHash:o,description:xYe,legend:n}}var exe={name:"illustrative",label:"Illustrative",category:yr.Misc,factory:$be,getParams:CYe,defaultValues:C.getDefaultValues(Jbe),isApplicable:e=>!!e.structure};var vYe='Assigns a color to every amino acid according to the "Experimentally determined hydrophobicity scale for proteins at membrane interfaces" by Wimely and White (doi:10.1038/nsb1096-842).',iF={list:C.ColorList("red-yellow-green",{presetKind:"scale"}),scale:C.Select("DGwif",[["DGwif","DG water-membrane"],["DGwoct","DG water-octanol"],["Oct-IF","DG difference"]])};function IYe(e){return iF}var AYe={DGwif:0,DGwoct:1,"Oct-IF":2};function TYe(e,t){let r=mE[e];return r===void 0?0:r[t]}function txe(e,t){return e.model.atomicHierarchy.atoms.label_comp_id.value(t)}function rxe(e,t){let r=e.coarseElements.seq_id_begin.value(t),n=e.coarseElements.seq_id_end.value(t);if(r===n){let o=e.coarseElements.entityKey[t];return e.model.sequence.byEntityKey[o].sequence.compId.value(r-1)}}function aF(e,t){let r=AYe[t.scale],n=1/0,o=-1/0;for(let s in mE){let l=mE[s][r];n=Math.min(n,l),o=Math.max(o,l)}let i=Ja.create({listOrName:t.list.colors,domain:[o,n],minLabel:"Hydrophilic",maxLabel:"Hydrophobic"});function a(s){let l;return Q.Location.is(s)?ue.isAtomic(s.unit)?l=txe(s.unit,s.element):l=rxe(s.unit,s.element):It.isLocation(s)&&(ue.isAtomic(s.aUnit)?l=txe(s.aUnit,s.aUnit.elements[s.aIndex]):l=rxe(s.aUnit,s.aUnit.elements[s.aIndex])),i.color(l?TYe(l,r):0)}return{factory:aF,granularity:"group",preferSmoothing:!0,color:a,props:t,description:vYe,legend:i?i.legend:void 0}}var nxe={name:"hydrophobicity",label:"Hydrophobicity",category:yr.Residue,factory:aF,getParams:IYe,defaultValues:C.getDefaultValues(iF),isApplicable:e=>!!e.structure};var PYe=13421772,_Ye="Assigns a color based on the occupancy of an atom.",sF={domain:C.Interval([0,1]),list:C.ColorList("purples",{presetKind:"scale"})};function RYe(e){return sF}function oxe(e,t){return ue.isAtomic(e)?e.model.atomicConformation.occupancy.value(t):0}function lF(e,t){let r=Ja.create({reverse:!1,domain:t.domain,listOrName:t.list.colors});function n(o){return Q.Location.is(o)?r.color(oxe(o.unit,o.element)):It.isLocation(o)?r.color(oxe(o.aUnit,o.aUnit.elements[o.aIndex])):PYe}return{factory:lF,granularity:"group",preferSmoothing:!0,color:n,props:t,description:_Ye,legend:r?r.legend:void 0}}var ixe={name:"occupancy",label:"Occupancy",category:yr.Atom,factory:lF,getParams:RYe,defaultValues:C.getDefaultValues(sF),isApplicable:e=>!!e.structure&&e.structure.models.some(t=>t.atomicConformation.occupancy.isDefined)};var Q7="dark-2",axe=13421772,DYe="Assigns a color based on the operator HKL value of a transformed chain.",sxe={...ni({type:"colors",colorList:Q7})};function wYe(e){let t=C.clone(sxe);return e.structure&&lxe(e.structure.root).map.size>Sr[Q7].list.length&&(t.palette.defaultValue.name="colors",t.palette.defaultValue.params={...t.palette.defaultValue.params,list:{kind:"interpolate",colors:Ka(Q7).list}}),t}var pR=1e4;function Z7(e){return e.map(t=>`${t+pR}`.padStart(5,"0")).join("")}function q7(e){let t=nme(pR,0),r=parseInt(e.substr(0,t)),n=parseInt(e.substr(t,t)),o=parseInt(e.substr(t+t,t));return b.create(r-pR,n-pR,o-pR)}function X7(e){return e.map(t=>t+5).join("")}function lxe(e){let t=new Map,r=new Set;for(let a=0,s=e.units.length;a<s;++a){let l=Z7(e.units[a].conformation.operator.hkl);r.add(l)}let n=Array.from(r.values()).sort();n.forEach(a=>t.set(a,t.size));let o=q7(n[0]),i=q7(n[n.length-1]);return{min:o,max:i,map:t}}function uxe(e,t){let r,n;if(e.structure){let{min:o,max:i,map:a}=lxe(e.structure.root),s=[];a.forEach((c,m)=>{let d=c%a.size,p=X7(q7(m));s[d]===void 0?s[d]=p:s[d]+=`, ${p}`});let l={minLabel:X7(o),maxLabel:X7(i),valueLabel:c=>s[c]},u=di(a.size,t,l);n=u.legend,r=c=>{let m;if(Q.Location.is(c)){let d=Z7(c.unit.conformation.operator.hkl);m=a.get(d)}else if(It.isLocation(c)){let d=Z7(c.aUnit.conformation.operator.hkl);m=a.get(d)}return m===void 0?axe:u.color(m)}}else r=()=>axe;return{factory:uxe,granularity:"instance",color:r,props:t,description:DYe,legend:n}}var cxe={name:"operator-hkl",label:"Operator HKL",category:yr.Symmetry,factory:uxe,getParams:wYe,defaultValues:C.getDefaultValues(sxe),isApplicable:e=>!!e.structure};var Pg;(r=>(r.Descriptor={name:"atom_partial_charge"},r.Provider=_l.create(r.Descriptor)))(Pg||={});var Y7=16777113,MYe="Assigns a color based on the partial charge of an atom.",uF={domain:C.Interval([-1,1]),list:C.ColorList("red-white-blue",{presetKind:"scale"})};function BYe(e){return uF}function mxe(e,t){return Pg.Provider.get(e.model)?.data.value(t)}function cF(e,t){let r=Ja.create({domain:t.domain,listOrName:t.list.colors});function n(o){if(Q.Location.is(o)){let i=mxe(o.unit,o.element);return i!==void 0?r.color(i):Y7}else if(It.isLocation(o)){let i=mxe(o.aUnit,o.aUnit.elements[o.aIndex]);return i!==void 0?r.color(i):Y7}return Y7}return{factory:cF,granularity:"group",preferSmoothing:!0,color:n,props:t,description:MYe,legend:r?r.legend:void 0}}var dxe={name:"partial-charge",label:"Partial Charge",category:yr.Atom,factory:cF,getParams:BYe,defaultValues:C.getDefaultValues(uF),isApplicable:e=>!!e.structure&&e.structure.models.some(t=>Pg.Provider.get(t)!==void 0)};var EYe="many-distinct",pxe=16448250,kYe="Gives every atom a color based on its `label_atom_id` value.",fxe={...ni({type:"colors",colorList:EYe})};function FYe(e){return C.clone(fxe)}function LYe(e){let t=new Map;for(let r of e.models){let{label_atom_id:n}=r.atomicHierarchy.atoms;for(let o=0,i=n.rowCount;o<i;++o){let a=n.value(o);t.has(a)||t.set(a,t.size)}}return t}function hxe(e,t){let r,n;if(e.structure){let o=Q.Location.create(e.structure.root),i=LYe(e.structure.root),a=Array.from(i.keys()),s=u=>a[u],l=di(i.size,t,{valueLabel:s});n=l.legend,r=u=>{let c;if(Q.Location.is(u)){let m=Ke.atom.label_atom_id(u);c=i.get(m)}else if(It.isLocation(u)){o.unit=u.aUnit,o.element=u.aUnit.elements[u.aIndex];let m=Ke.atom.label_atom_id(o);c=i.get(m)}return c===void 0?pxe:l.color(c)}}else r=()=>pxe;return{factory:hxe,granularity:"group",preferSmoothing:!0,color:r,props:t,description:kYe,legend:n}}var gxe={name:"atom-id",label:"Atom Id",category:yr.Atom,factory:hxe,getParams:FYe,defaultValues:C.getDefaultValues(fxe),isApplicable:e=>!!e.structure};var K7="Assign color based on the given value of a volume cell.",yxe={colorList:C.ColorList({kind:"interpolate",colors:[[Lt.white,0],[Lt.red,.25],[Lt.white,.5],[Lt.blue,.75],[Lt.white,1]]},{offsets:!0,isEssential:!0}),domain:C.MappedStatic("auto",{custom:C.Interval([-1,1],{step:.001}),auto:C.Group({symmetric:C.Boolean(!1,{description:"If true the automatic range is determined as [-|max|, |max|]."})})}),isRelative:C.Boolean(!1,{description:"If true the value is treated as relative to the volume mean and sigma."}),defaultColor:C.Color(13421772)};function VYe(e){return yxe}function mF(e,t){if(e.volume){let{min:r,max:n,mean:o,sigma:i}=e.volume.grid.stats,a=t.domain.name==="custom"?t.domain.params:[r,n],{colorList:s,defaultColor:l}=t;if(t.domain.name==="auto"&&t.isRelative&&(a[0]=(a[0]-o)/i,a[1]=(a[1]-o)/i),t.domain.name==="auto"&&t.domain.params.symmetric){let u=Math.max(Math.abs(a[0]),Math.abs(a[1]));a[0]=-u,a[1]=u}if(e.locationKinds?.includes("direct-location")){let u=[wf(a[0],r,n),wf(a[1],r,n)],c=vs.Palette(s.colors,s.kind,u,l);return{factory:mF,granularity:"direct",props:t,description:K7,palette:c}}else{let u=Nn.makeGetTrilinearlyInterpolated(e.volume.grid,"none"),c=d=>{if(!$I(d))return t.defaultColor;let p=u(d.position);return Number.isNaN(p)?t.defaultColor:_r((p-a[0])/(a[1]-a[0]),0,1)*vs.PaletteScale},m=vs.Palette(s.colors,s.kind,void 0,l);return{factory:mF,granularity:"vertex",preferSmoothing:!0,color:c,palette:m,props:t,description:K7}}}else return{factory:mF,granularity:"uniform",color:()=>t.defaultColor,props:t,description:K7}}var bxe={name:"volume-value",label:"Volume Value",category:yr.Misc,factory:mF,getParams:VYe,defaultValues:C.getDefaultValues(yxe),isApplicable:e=>!!e.volume&&!Ge.Segmentation.get(e.volume)};var xxe=13421772,OYe="Gives every volume segment a unique color.",Cxe={...ni({type:"colors",colorList:"many-distinct"})};function GYe(e){return C.clone(Cxe)}function Sxe(e,t){let r,n,o=e.volume&&Ge.Segmentation.get(e.volume);if(o){let i=o.segments.size,a=Array.from(o.segments.keys()),s=di(i,t);n=s.legend,r=l=>Ge.Segment.isLocation(l)?s.color(a.indexOf(l.segment)):xxe}else r=()=>xxe;return{factory:Sxe,granularity:"instance",color:r,props:t,description:OYe,legend:n}}var vxe={name:"volume-segment",label:"Volume Segment",category:yr.Misc,factory:Sxe,getParams:GYe,defaultValues:C.getDefaultValues(Cxe),isApplicable:e=>!!e.volume&&!!Ge.Segmentation.get(e.volume)};var UYe="Assigns a color based on volume value at a given vertex.",Ixe={volume:C.ValueRef(e=>e.state.data.selectQ(r=>r.root.subtree().filter(n=>Ge.is(n.obj?.data))).map(r=>[r.transform.ref,r.obj?.label??"<unknown>"]),(e,t)=>t(e)),coloring:C.MappedStatic("absolute-value",{"absolute-value":C.Group({domain:C.MappedStatic("auto",{custom:C.Interval([-1,1],{step:.001}),auto:C.Group({symmetric:C.Boolean(!1,{description:"If true the automatic range is determined as [-|max|, |max|]."})})}),list:C.ColorList("red-white-blue",{presetKind:"scale"})}),"relative-value":C.Group({domain:C.MappedStatic("auto",{custom:C.Interval([-1,1],{step:.001}),auto:C.Group({symmetric:C.Boolean(!1,{description:"If true the automatic range is determined as [-|max|, |max|]."})})}),list:C.ColorList("red-white-blue",{presetKind:"scale"})})}),defaultColor:C.Color(13421772),normalOffset:C.Numeric(0,{min:0,max:20,step:.1},{description:"Offset vertex position along its normal by given amount."}),usePalette:C.Boolean(!1,{description:"Use a palette to color at the pixel level."})};function Axe(e,t){let r;try{r=t.volume.getValue()}catch{}let n,o,{normalOffset:i,defaultColor:a,usePalette:s}=t;if(r){let l=t.coloring.params,{stats:u}=r.grid,c=l.domain.name==="custom"?l.domain.params:[u.min,u.max],m=t.coloring.name==="relative-value";if(l.domain.name==="auto"&&m&&(c[0]=(c[0]-u.mean)/u.sigma,c[1]=(c[1]-u.mean)/u.sigma),l.domain.name==="auto"&&l.domain.params.symmetric){let f=Math.max(Math.abs(c[0]),Math.abs(c[1]));c[0]=-f,c[1]=f}let d=Ja.create({domain:c,listOrName:l.list.colors}),p=b(),h=Nn.makeGetTrilinearlyInterpolated(r.grid,m?"relative":"none");n=f=>{if(!$I(f))return a;i>0?b.scaleAndAdd(p,f.position,f.normal,i):b.copy(p,f.position);let g=h(p);return Number.isNaN(g)?a:s?_r((g-c[0])/(c[1]-c[0]),0,1)*vs.PaletteScale:d.color(g)},o=s?{colors:l.list.colors.map(f=>Array.isArray(f)?f[0]:f),filter:l.list.kind==="set"?"nearest":"linear"}:void 0}else n=()=>a;return{factory:Axe,granularity:"vertex",preferSmoothing:!0,color:n,palette:o,props:t,description:UYe}}var Txe={name:"external-volume",label:"External Volume",category:yr.Misc,factory:Axe,getParams:()=>Ixe,defaultValues:C.getDefaultValues(Ixe),isApplicable:e=>!0};var NYe="Uses separate themes for coloring mainchain and sidechain visuals.",Pxe={mainchain:C.MappedStatic("molecule-type",{uniform:C.Group(ob),"chain-id":C.Group(mg),"entity-id":C.Group(fg),"entity-source":C.Group(gg),"molecule-type":C.Group(yC),"model-index":C.Group(bg),"structure-index":C.Group(Cg),"secondary-structure":C.Group(Tk),"trajectory-index":C.Group(hC)}),sidechain:C.MappedStatic("residue-name",{uniform:C.Group(ob),"residue-name":C.Group(vk),"element-symbol":C.Group(xk),hydrophobicity:C.Group(iF),uncertainty:C.Group(nF),occupancy:C.Group(sF),"sequence-id":C.Group(_k),"partial-charge":C.Group(uF)})};function zYe(e){return C.clone(Pxe)}function HYe(e,t){switch(t.name){case"uniform":return Qf(e,t.params);case"chain-id":return dg(e,t.params);case"entity-id":return hg(e,t.params);case"entity-source":return yg(e,t.params);case"molecule-type":return bC(e,t.params);case"model-index":return xg(e,t.params);case"structure-index":return Sg(e,t.params);case"secondary-structure":return Pk(e,t.params);case"trajectory-index":return gC(e,t.params);default:Mr(t)}}function jYe(e,t){switch(t.name){case"uniform":return Qf(e,t.params);case"residue-name":return Ik(e,t.params);case"element-symbol":return Ck(e,t.params);case"hydrophobicity":return aF(e,t.params);case"uncertainty":return oF(e,t.params);case"occupancy":return lF(e,t.params);case"sequence-id":return Rk(e,t.params);case"partial-charge":return cF(e,t.params);default:Mr(t)}}function _xe(e,t){let r=HYe(e,t.mainchain),n=jYe(e,t.sidechain),o=$u(r.contextHash??0,n.contextHash??0);function i(s,l){return l?r.color(s,!1):n.color(s,!1)}let a=r.legend;return r.legend?.kind==="table-legend"&&n.legend?.kind==="table-legend"&&(a={kind:"table-legend",table:[...r.legend.table,...n.legend.table]}),{factory:_xe,granularity:"group",preferSmoothing:!1,color:i,props:t,contextHash:o,description:NYe,legend:a}}var Rxe={name:"cartoon",label:"Cartoon",category:yr.Misc,factory:_xe,getParams:zYe,defaultValues:C.getDefaultValues(Pxe),isApplicable:e=>!!e.structure};var J7=16777113,WYe="Assigns a color based on the formal charge of an atom.",wxe={domain:C.Interval([-3,3]),list:C.ColorList({kind:"set",colors:Sr["red-white-blue"].list})};function XYe(e){return wxe}function Dxe(e,t){return ue.isAtomic(e)?e.model.atomicHierarchy.atoms.pdbx_formal_charge.value(t):0}function Mxe(e,t){let r=Ja.create({domain:t.domain,listOrName:t.list.colors});function n(o){if(Q.Location.is(o)){let i=Dxe(o.unit,o.element);return i!==void 0?r.color(i):J7}else if(It.isLocation(o)){let i=Dxe(o.aUnit,o.aUnit.elements[o.aIndex]);return i!==void 0?r.color(i):J7}return J7}return{factory:Mxe,granularity:"group",preferSmoothing:!0,color:n,props:t,description:WYe,legend:r?r.legend:void 0}}var Bxe={name:"formal-charge",label:"Formal Charge",category:yr.Atom,factory:Mxe,getParams:XYe,defaultValues:C.getDefaultValues(wxe),isApplicable:e=>!!e.structure&&e.structure.models.some(t=>t.atomicHierarchy.atoms.pdbx_formal_charge.isDefined)};var Qr=NS.Const,br=NS.Dynamic,QYe=[Qr(Te.core.type.bool,function(t,r){return!!r[0](t)}),Qr(Te.core.type.num,function(t,r){return+r[0](t)}),Qr(Te.core.type.str,function(t,r){return""+r[0](t)}),Qr(Te.core.type.list,function(t,r){return K_.forEachEval(r,t,(n,o,i)=>i[o]=n,[])}),Qr(Te.core.type.set,function(t,r){return K_.forEachEval(r,t,function(o,i,a){return a.add(o)},new Set)}),Qr(Te.core.type.regex,function(t,r){return new RegExp(r[0](t),r[1]&&r[1](t)||"")}),Qr(Te.core.type.bitflags,function(t,r){return+r[0](t)}),Qr(Te.core.type.compositeKey,function(t,r){return K_.forEachEval(r,t,(n,o,i)=>i[o]=""+n,[]).join("-")}),Qr(Te.core.logic.not,(e,t)=>!t[0](e)),Qr(Te.core.logic.and,(e,t)=>{if(typeof t.length=="number"){for(let r=0,n=t.length;r<n;r++)if(!t[r](e))return!1}else for(let r of Object.keys(t))if(!t[r](e))return!1;return!0}),Qr(Te.core.logic.or,(e,t)=>{if(typeof t.length=="number"){for(let r=0,n=t.length;r<n;r++)if(t[r](e))return!0}else for(let r of Object.keys(t))if(t[r](e))return!0;return!1}),Qr(Te.core.rel.eq,(e,t)=>t[0](e)===t[1](e)),Qr(Te.core.rel.neq,(e,t)=>t[0](e)!==t[1](e)),Qr(Te.core.rel.lt,(e,t)=>t[0](e)<t[1](e)),Qr(Te.core.rel.lte,(e,t)=>t[0](e)<=t[1](e)),Qr(Te.core.rel.gr,(e,t)=>t[0](e)>t[1](e)),Qr(Te.core.rel.gre,(e,t)=>t[0](e)>=t[1](e)),Qr(Te.core.rel.inRange,(e,t)=>{let r=t[0](e);return r>=t[1](e)&&r<=t[2](e)}),Qr(Te.core.math.add,(e,t)=>{let r=0;if(typeof t.length=="number")for(let n=0,o=t.length;n<o;n++)r+=t[n](e);else for(let n of Object.keys(t))r+=t[n](e);return r}),Qr(Te.core.math.sub,(e,t)=>{let r=0;if(typeof t.length=="number"){if(t.length===1)return-t[0](e);r=t[0](e)||0;for(let n=1,o=t.length;n<o;n++)r-=t[n](e)}else{let n=Object.keys(t);if(n.length===1)return-t[n[0]](e);r=t[n[0]](e)||0;for(let o=1,i=n.length;o<i;o++)r-=t[n[o]](e)}return r}),Qr(Te.core.math.mult,(e,t)=>{let r=1;if(typeof t.length=="number")for(let n=0,o=t.length;n<o;n++)r*=t[n](e);else for(let n of Object.keys(t))r*=t[n](e);return r}),Qr(Te.core.math.div,(e,t)=>t[0](e)/t[1](e)),Qr(Te.core.math.pow,(e,t)=>Math.pow(t[0](e),t[1](e))),Qr(Te.core.math.mod,(e,t)=>t[0](e)%t[1](e)),Qr(Te.core.math.min,(e,t)=>{let r=Number.POSITIVE_INFINITY;if(typeof t.length=="number")for(let n=0,o=t.length;n<o;n++)r=Math.min(t[n](e),r);else for(let n of Object.keys(t))r=Math.min(t[n](e),r);return r}),Qr(Te.core.math.max,(e,t)=>{let r=Number.NEGATIVE_INFINITY;if(typeof t.length=="number")for(let n=0,o=t.length;n<o;n++)r=Math.max(t[n](e),r);else for(let n of Object.keys(t))r=Math.max(t[n](e),r);return r}),Qr(Te.core.math.cantorPairing,(e,t)=>ca(t[0](e),t[1](e))),Qr(Te.core.math.sortedCantorPairing,(e,t)=>Mc(t[0](e),t[1](e))),Qr(Te.core.math.invertCantorPairing,(e,t)=>Ov([0,0],t[0](e))),Qr(Te.core.math.floor,(e,t)=>Math.floor(t[0](e))),Qr(Te.core.math.ceil,(e,t)=>Math.ceil(t[0](e))),Qr(Te.core.math.roundInt,(e,t)=>Math.round(t[0](e))),Qr(Te.core.math.trunc,(e,t)=>Math.trunc(t[0](e))),Qr(Te.core.math.abs,(e,t)=>Math.abs(t[0](e))),Qr(Te.core.math.sign,(e,t)=>Math.sign(t[0](e))),Qr(Te.core.math.sqrt,(e,t)=>Math.sqrt(t[0](e))),Qr(Te.core.math.cbrt,(e,t)=>Math.cbrt(t[0](e))),Qr(Te.core.math.sin,(e,t)=>Math.sin(t[0](e))),Qr(Te.core.math.cos,(e,t)=>Math.cos(t[0](e))),Qr(Te.core.math.tan,(e,t)=>Math.tan(t[0](e))),Qr(Te.core.math.asin,(e,t)=>Math.asin(t[0](e))),Qr(Te.core.math.acos,(e,t)=>Math.acos(t[0](e))),Qr(Te.core.math.atan,(e,t)=>Math.atan(t[0](e))),Qr(Te.core.math.sinh,(e,t)=>Math.sinh(t[0](e))),Qr(Te.core.math.cosh,(e,t)=>Math.cosh(t[0](e))),Qr(Te.core.math.tanh,(e,t)=>Math.tanh(t[0](e))),Qr(Te.core.math.exp,(e,t)=>Math.exp(t[0](e))),Qr(Te.core.math.log,(e,t)=>Math.log(t[0](e))),Qr(Te.core.math.log10,(e,t)=>Math.log10(t[0](e))),Qr(Te.core.math.atan2,(e,t)=>Math.atan2(t[0](e),t[1](e))),Qr(Te.core.str.match,(e,t)=>t[0](e).test(t[1](e))),Qr(Te.core.str.concat,(e,t)=>{let r=[];if(typeof t.length=="number")for(let n=0,o=t.length;n<o;n++)r.push(t[n](e).toString());else for(let n of Object.keys(t))r.push(t[n](e).toString());return r.join("")}),Qr(Te.core.list.getAt,(e,t)=>t[0](e)[t[1](e)]),Qr(Te.core.list.equal,(e,t)=>w0(t[0](e),t[1](e))),Qr(Te.core.set.has,function(t,r){return r[0](t).has(r[1](t))}),Qr(Te.core.set.isSubset,function(t,r){return go.isSuperset(r[1](t),r[0](t))}),Qr(Te.core.flags.hasAny,(e,t)=>{let r=t[1](e),n=t[0](e);return r?(n&r)!==0:!!n}),Qr(Te.core.flags.hasAll,(e,t)=>{let r=t[1](e),n=t[0](e);return r?(n&r)===r:!n}),Qr(Te.structureQuery.type.elementSymbol,(e,t)=>Nf(t[0](e))),Qr(Te.structureQuery.type.atomName,(e,t)=>Ere(t[0](e))),Qr(Te.structureQuery.type.bondFlags,(e,t)=>{let r=xt.Flag.None;if(typeof t.length=="number")for(let n=0,o=t.length;n<o;n++)r=Exe(r,t[n](e));else for(let n of Object.keys(t))r=Exe(r,t[n](e));return r}),Qr(Te.structureQuery.type.ringFingerprint,(e,t)=>Td.elementFingerprint(ZYe(e,t))),Qr(Te.structureQuery.type.secondaryStructureFlags,(e,t)=>{let r=rr.Flag.None;if(typeof t.length=="number")for(let n=0,o=t.length;n<o;n++)r=kxe(r,t[n](e));else for(let n of Object.keys(t))r=kxe(r,t[n](e));return r}),br(Te.structureQuery.filter.pick,(e,t)=>Xn.filters.pick(t[0],t.test)(e)),br(Te.structureQuery.filter.first,(e,t)=>Xn.filters.first(t[0])(e)),br(Te.structureQuery.filter.withSameAtomProperties,(e,t)=>Xn.filters.withSameAtomProperties(t[0],t.source,t.property)(e)),br(Te.structureQuery.filter.intersectedBy,(e,t)=>Xn.filters.areIntersectedBy(t[0],t.by)(e)),br(Te.structureQuery.filter.within,(e,t)=>Xn.filters.within({query:t[0],target:t.target,minRadius:t["min-radius"]?.(e),maxRadius:t["max-radius"]?.(e),elementRadius:t["atom-radius"],invert:t.invert?.(e)})(e)),br(Te.structureQuery.filter.isConnectedTo,(e,t)=>Xn.filters.isConnectedTo({query:t[0],target:t.target,disjunct:t.disjunct?.(e),invert:t.invert?.(e),bondTest:t["bond-test"]})(e)),br(Te.structureQuery.generator.atomGroups,function(t,r){return Xn.generators.atoms({entityTest:r["entity-test"],chainTest:r["chain-test"],residueTest:r["residue-test"],atomTest:r["atom-test"],groupBy:r["group-by"]})(t)}),br(Te.structureQuery.generator.all,function(t){return Xn.generators.all(t)}),br(Te.structureQuery.generator.empty,function(t){return Xn.generators.none(t)}),br(Te.structureQuery.generator.bondedAtomicPairs,function(t,r){return Xn.generators.bondedAtomicPairs(r&&r[0])(t)}),br(Te.structureQuery.generator.rings,function(t,r){return Xn.generators.rings(r?.fingerprint?.(t),r?.["only-aromatic"]?.(t))(t)}),br(Te.structureQuery.generator.queryInSelection,function(t,r){return Xn.generators.querySelection(r[0],r.query,r["in-complement"]?.(t))(t)}),br(Te.structureQuery.modifier.includeSurroundings,function(t,r){return Xn.modifiers.includeSurroundings(r[0],{radius:r.radius(t),wholeResidues:!!(r["as-whole-residues"]&&r["as-whole-residues"](t)),elementRadius:r["atom-radius"]})(t)}),br(Te.structureQuery.modifier.surroundingLigands,function(t,r){return Xn.modifiers.surroundingLigands({query:r[0],radius:r.radius(t),includeWater:!!(r["include-water"]&&r["include-water"](t))})(t)}),br(Te.structureQuery.modifier.wholeResidues,function(t,r){return Xn.modifiers.wholeResidues(r[0])(t)}),br(Te.structureQuery.modifier.union,function(t,r){return Xn.modifiers.union(r[0])(t)}),br(Te.structureQuery.modifier.expandProperty,function(t,r){return Xn.modifiers.expandProperty(r[0],r.property)(t)}),br(Te.structureQuery.modifier.exceptBy,function(t,r){return Xn.modifiers.exceptBy(r[0],r.by)(t)}),br(Te.structureQuery.modifier.includeConnected,function(t,r){return Xn.modifiers.includeConnected({query:r[0],bondTest:r["bond-test"],wholeResidues:!!(r["as-whole-residues"]&&r["as-whole-residues"](t)),layerCount:r["layer-count"]&&r["layer-count"](t)||1,fixedPoint:r["fixed-point"]?.(t)??!1})(t)}),br(Te.structureQuery.modifier.intersectBy,function(t,r){return Xn.modifiers.intersectBy(r[0],r.by)(t)}),br(Te.structureQuery.combinator.merge,(e,t)=>Xn.combinators.merge(t)(e)),br(Te.structureQuery.atomProperty.core.elementSymbol,Vo(Ke.atom.type_symbol)),br(Te.structureQuery.atomProperty.core.vdw,(e,t)=>Dm(Ke.atom.type_symbol(t&&t[0]&&t[0](e)||e.element))),br(Te.structureQuery.atomProperty.core.mass,(e,t)=>ece(Ke.atom.type_symbol(t&&t[0]&&t[0](e)||e.element))),br(Te.structureQuery.atomProperty.core.atomicNumber,(e,t)=>$x(Ke.atom.type_symbol(t&&t[0]&&t[0](e)||e.element))),br(Te.structureQuery.atomProperty.core.x,Vo(Ke.atom.x)),br(Te.structureQuery.atomProperty.core.y,Vo(Ke.atom.y)),br(Te.structureQuery.atomProperty.core.z,Vo(Ke.atom.z)),br(Te.structureQuery.atomProperty.core.sourceIndex,Vo(Ke.atom.sourceIndex)),br(Te.structureQuery.atomProperty.core.operatorName,Vo(Ke.unit.operator_name)),br(Te.structureQuery.atomProperty.core.instanceId,Vo(Ke.unit.instance_id)),br(Te.structureQuery.atomProperty.core.operatorKey,Vo(Ke.unit.operator_key)),br(Te.structureQuery.atomProperty.core.modelIndex,Vo(Ke.unit.model_index)),br(Te.structureQuery.atomProperty.core.modelLabel,Vo(Ke.unit.model_label)),br(Te.structureQuery.atomProperty.core.modelEntryId,Vo(Ke.unit.model_entry_id)),br(Te.structureQuery.atomProperty.core.atomKey,(e,t)=>{let r=t&&t[0]&&t[0](e)||e.element;return ca(r.unit.id,r.element)}),br(Te.structureQuery.atomProperty.macromolecular.residueKey,(e,t)=>Q.residueIndex(t&&t[0]&&t[0](e)||e.element)),br(Te.structureQuery.atomProperty.macromolecular.chainKey,(e,t)=>Q.chainIndex(t&&t[0]&&t[0](e)||e.element)),br(Te.structureQuery.atomProperty.macromolecular.entityKey,(e,t)=>Q.entityIndex(t&&t[0]&&t[0](e)||e.element)),br(Te.structureQuery.atomProperty.macromolecular.id,Vo(Ke.atom.id)),br(Te.structureQuery.atomProperty.macromolecular.isHet,(e,t)=>Ke.residue.group_PDB(t&&t[0]&&t[0](e)||e.element)!=="ATOM"),br(Te.structureQuery.atomProperty.macromolecular.label_atom_id,Vo(Ke.atom.label_atom_id)),br(Te.structureQuery.atomProperty.macromolecular.label_alt_id,Vo(Ke.atom.label_alt_id)),br(Te.structureQuery.atomProperty.macromolecular.label_comp_id,Vo(Ke.atom.label_comp_id)),br(Te.structureQuery.atomProperty.macromolecular.label_seq_id,Vo(Ke.residue.label_seq_id)),br(Te.structureQuery.atomProperty.macromolecular.label_asym_id,Vo(Ke.chain.label_asym_id)),br(Te.structureQuery.atomProperty.macromolecular.label_entity_id,Vo(Ke.entity.id)),br(Te.structureQuery.atomProperty.macromolecular.auth_atom_id,Vo(Ke.atom.auth_atom_id)),br(Te.structureQuery.atomProperty.macromolecular.auth_comp_id,Vo(Ke.atom.auth_comp_id)),br(Te.structureQuery.atomProperty.macromolecular.auth_seq_id,Vo(Ke.residue.auth_seq_id)),br(Te.structureQuery.atomProperty.macromolecular.auth_asym_id,Vo(Ke.chain.auth_asym_id)),br(Te.structureQuery.atomProperty.macromolecular.pdbx_PDB_ins_code,Vo(Ke.residue.pdbx_PDB_ins_code)),br(Te.structureQuery.atomProperty.macromolecular.pdbx_formal_charge,Vo(Ke.atom.pdbx_formal_charge)),br(Te.structureQuery.atomProperty.macromolecular.occupancy,Vo(Ke.atom.occupancy)),br(Te.structureQuery.atomProperty.macromolecular.B_iso_or_equiv,Vo(Ke.atom.B_iso_or_equiv)),br(Te.structureQuery.atomProperty.macromolecular.entityType,Vo(Ke.entity.type)),br(Te.structureQuery.atomProperty.macromolecular.entitySubtype,Vo(Ke.entity.subtype)),br(Te.structureQuery.atomProperty.macromolecular.entityPrdId,Vo(Ke.entity.prd_id)),br(Te.structureQuery.atomProperty.macromolecular.entityDescription,Vo(Ke.entity.pdbx_description)),br(Te.structureQuery.atomProperty.macromolecular.objectPrimitive,Vo(Ke.unit.object_primitive)),br(Te.structureQuery.atomProperty.macromolecular.isNonStandard,Vo(Ke.residue.isNonStandard)),br(Te.structureQuery.atomProperty.macromolecular.secondaryStructureKey,Vo(Ke.residue.secondary_structure_key)),br(Te.structureQuery.atomProperty.macromolecular.secondaryStructureFlags,Vo(Ke.residue.secondary_structure_type)),br(Te.structureQuery.atomProperty.macromolecular.chemCompType,Vo(Ke.residue.chem_comp_type)),br(Te.structureQuery.atomProperty.macromolecular.residueSourceIndex,Vo(Ke.residue.residueSourceIndex)),br(Te.structureQuery.atomProperty.ihm.hasSeqId,function(t,r){let n=t.element,o=r&&r[0]&&r[0](t);return n.unit.kind===ue.Kind.Atomic?o===Ke.residue.label_seq_id(n):o>=Ke.coarse.seq_id_begin(n)&&o<=Ke.coarse.seq_id_end(n)}),br(Te.structureQuery.atomProperty.ihm.overlapsSeqIdRange,function(t,r){let n=t.element,o=(r&&r.beg&&r.beg(t))??-Number.MAX_VALUE,i=(r&&r.end&&r.end(t))??Number.MAX_VALUE;if(n.unit.kind===ue.Kind.Atomic){let l=Ke.residue.label_seq_id(n);return l>=o&&l<=i}let a=Ke.coarse.seq_id_begin(n),s=Ke.coarse.seq_id_end(n);return a>=o&&a<=i||s>=o&&s<=i||a<=o&&s>=i}),br(Te.structureQuery.atomSet.atomCount,function(t,r){return Xn.atomset.atomCount(t)}),br(Te.structureQuery.atomSet.countQuery,function(t,r){return Xn.atomset.countQuery(r[0])(t)}),br(Te.structureQuery.atomSet.propertySet,function(t,r){return Xn.atomset.propertySet(r[0])(t)}),br(Te.structureQuery.bondProperty.order,(e,t)=>e.atomicBond.order),br(Te.structureQuery.bondProperty.flags,(e,t)=>e.atomicBond.type),br(Te.structureQuery.bondProperty.key,(e,t)=>e.atomicBond.key),br(Te.structureQuery.bondProperty.atomA,(e,t)=>e.atomicBond.a),br(Te.structureQuery.bondProperty.atomB,(e,t)=>e.atomicBond.b),br(Te.structureQuery.bondProperty.length,(e,t)=>e.atomicBond.length),br(Te.internal.generator.bundleElement,function(t,r){return L6(r.groupedUnits(t),r.ranges(t),r.set(t))}),br(Te.internal.generator.bundle,function(t,r){return V6(r.elements(t))(t)}),br(Te.internal.generator.current,function(t,r){return t.tryGetCurrentSelection()})];function Vo(e){return(t,r)=>e(r&&r[0]&&r[0](t)||t.element)}function Exe(e,t){return e|(xt.isName(t)?xt.fromName(t):xt.Flag.None)}function kxe(e,t){switch(t.toLowerCase()){case"helix":return e|rr.Flag.Helix;case"alpha":return e|rr.Flag.Helix|rr.Flag.HelixAlpha;case"pi":return e|rr.Flag.Helix|rr.Flag.HelixPi;case"310":return e|rr.Flag.Helix|rr.Flag.Helix3Ten;case"beta":return e|rr.Flag.Beta;case"strand":return e|rr.Flag.Beta|rr.Flag.BetaStrand;case"sheet":return e|rr.Flag.Beta|rr.Flag.BetaSheet;case"turn":return e|rr.Flag.Turn;case"bend":return e|rr.Flag.Bend;case"coil":return e|rr.Flag.NA;default:return e}}function ZYe(e,t){let r=[];if(!t)return r;if(typeof t.length=="number")for(let n=0,o=t.length;n<o;n++)r.push(t[n](e));else{let n=Object.keys(t);for(let o=1,i=n.length;o<i;o++)r.push(t[n[o]](e))}return r}(function(){for(let e of QYe)zI.addSymbol(e)})();var f8={};Gi(f8,{DeflateData:()=>JKe,Download:()=>ZS,DownloadBlob:()=>i8,ImportJson:()=>oJe,ImportString:()=>nJe,LazyVolume:()=>aJe,ParseBlob:()=>$Ke,ParseCcp4:()=>d8,ParseCif:()=>l8,ParseCube:()=>eJe,ParseDsn6:()=>rJe,ParseDx:()=>p8,ParseJson:()=>iJe,ParsePly:()=>tJe,ParsePrmtop:()=>c8,ParsePsf:()=>u8,ParseTop:()=>m8,RawData:()=>a8,ReadFile:()=>s8});var Um;(s=>{function e(l){let u=new DataView(l.buffer);return Object.assign(l.subarray(0),{readInt8:c=>u.getInt8(c),readUInt8:c=>u.getUint8(c),writeInt8:(c,m)=>u.setInt8(m,c),writeUInt8:(c,m)=>u.setUint8(m,c),readInt16LE:c=>u.getInt16(c,!0),readInt32LE:c=>u.getInt32(c,!0),readUInt16LE:c=>u.getUint16(c,!0),readUInt32LE:c=>u.getUint32(c,!0),readFloatLE:c=>u.getFloat32(c,!0),readDoubleLE:c=>u.getFloat64(c,!0),writeInt16LE:(c,m)=>u.setInt16(m,c,!0),writeInt32LE:(c,m)=>u.setInt32(m,c,!0),writeUInt16LE:(c,m)=>u.setUint16(m,c,!0),writeUInt32LE:(c,m)=>u.setUint32(m,c,!0),writeFloatLE:(c,m)=>u.setFloat32(m,c,!0),writeDoubleLE:(c,m)=>u.setFloat64(m,c,!0),readInt16BE:c=>u.getInt16(c,!1),readInt32BE:c=>u.getInt32(c,!1),readUInt16BE:c=>u.getUint16(c,!1),readUInt32BE:c=>u.getUint32(c,!1),readFloatBE:c=>u.getFloat32(c,!1),readDoubleBE:c=>u.getFloat64(c,!1),writeInt16BE:(c,m)=>u.setInt16(m,c,!1),writeInt32BE:(c,m)=>u.setInt32(m,c,!1),writeUInt16BE:(c,m)=>u.setUint16(m,c,!1),writeUInt32BE:(c,m)=>u.setUint32(m,c,!1),writeFloatBE:(c,m)=>u.setFloat32(m,c,!1),writeDoubleBE:(c,m)=>u.setFloat64(m,c,!1),copy:(c,m,d,p)=>(m=ua(m,0),d=ua(d,0),p=ua(p,l.length),c.set(l.subarray(d,p),m),p-d)})}s.fromUint8Array=e;function t(l){return e(new Uint8Array(l))}s.fromArrayBuffer=t;function r(l){return l}s.fromBuffer=r,s.IsNativeEndianLittle=new Uint16Array(new Uint8Array([18,52]).buffer)[0]===13330;function o(l,u,c,m,d){for(let p=0,h=c;p<h;p+=m)for(let f=0;f<m;f++)u[d+p+m-f-1]=l[d+p+f]}s.flipByteOrder=o;function i(l,u=0,c){let m=new Int16Array(l,u,c);for(let d=0,p=m.length;d<p;++d){let h=m[d];m[d]=(h&255)<<8|h>>8&255}}s.flipByteOrderInPlace2=i;function a(l,u,c,m,d){s.IsNativeEndianLittle||!c||m<=1||o(l,u,c,m,d)}s.ensureLittleEndian=a})(Um||={});var fR;(t=>{function e(r,n){return{name:n,readBuffer:(o,i,a,s)=>{let l,u;if(typeof i=="number"){a=ua(a,i);let c=o,m=Math.min(r.length,c+a);l=m-c,u=Um.fromUint8Array(new Uint8Array(r.buffer,c,m-c))}else{a=ua(a,i.length);let c=o,m=Math.min(r.length,c+a);i.set(r.subarray(c,m),s),l=m-c,u=i}return a!==l&&console.warn(`byteCount ${a} and bytesRead ${l} differ`),Promise.resolve({bytesRead:l,buffer:u})},writeBuffer:(o,i,a)=>(a=ua(a,i.length),console.error(".writeBuffer not implemented for FileHandle.fromBuffer"),Promise.resolve(0)),writeBufferSync:(o,i,a)=>(a=ua(a,i.length),console.error(".writeSync not implemented for FileHandle.fromBuffer"),0),close:vl}}t.fromBuffer=e})(fR||={});var uu;(o=>(o.Float32="float32",o.Int8="int8",o.Int16="int16",o.Uint16="uint16"))(uu||={});function $7(e){return e===uu.Float32?4:e===uu.Int16||e===uu.Uint16?2:1}function qYe(e,t,r=0,n){return e===uu.Float32?new Float32Array(t,r,n):e===uu.Int16?new Int16Array(t,r,n):e===uu.Uint16?new Uint16Array(t,r,n):new Int8Array(t,r,n)}function Fxe(e,t){let r=$7(t),n=new ArrayBuffer(r*e),o=Um.fromArrayBuffer(n),i=Um.IsNativeEndianLittle?n:new ArrayBuffer(r*e);return{type:t,elementByteSize:r,readBuffer:o,valuesBuffer:new Uint8Array(i),values:qYe(t,i)}}async function Lxe(e,t,r,n,o,i){return await t.readBuffer(r,e.readBuffer,n,o),e.elementByteSize>1&&(i!==void 0&&i!==Um.IsNativeEndianLittle||!Um.IsNativeEndianLittle)&&Um.flipByteOrder(e.readBuffer,e.valuesBuffer,n,e.elementByteSize,o),e.values}async function YYe(e){let{buffer:r}=await e.readBuffer(0,1024),n=String.fromCharCode(r.readUInt8(208),r.readUInt8(209),r.readUInt8(210),r.readUInt8(211));if(n!=="MAP ")throw new Error('ccp4 format error, missing "MAP " string');let o=[r.readUInt8(212),r.readUInt8(213)],i=!1;o[0]===68&&o[1]===65?i=!0:o[0]===17&&o[1]===17?i=!1:r.readInt32LE(12)<=16&&(i=!0);let a=i?u=>r.readInt32LE(u*4):u=>r.readInt32BE(u*4),s=i?u=>r.readFloatLE(u*4):u=>r.readFloatBE(u*4);return{header:{NC:a(0),NR:a(1),NS:a(2),MODE:a(3),NCSTART:a(4),NRSTART:a(5),NSSTART:a(6),NX:a(7),NY:a(8),NZ:a(9),xLength:s(10),yLength:s(11),zLength:s(12),alpha:s(13),beta:s(14),gamma:s(15),MAPC:a(16),MAPR:a(17),MAPS:a(18),AMIN:s(19),AMAX:s(20),AMEAN:s(21),ISPG:a(22),NSYMBT:a(23),LSKFLG:a(24),SKWMAT:[],SKWTRN:[],userFlag1:a(39),userFlag2:a(40),originX:s(49),originY:s(50),originZ:s(51),MAP:n,MACHST:o,ARMS:s(54)},littleEndian:i}}async function KYe(e,t,r,n,o,i){if(Oxe(e)){let a=3*o;await r.readBuffer(n,t.readBuffer,o,a);let s=new Int8Array(t.valuesBuffer.buffer,a),l=(e.AMAX-e.AMIN)/255,u=.5*(e.AMIN+e.AMAX+l);for(let c=0,m=o;c<m;++c)t.values[c]=l*s[c]+u}else await Lxe(t,r,n,o,0,i)}function Vxe(e){switch(e){case 0:return uu.Int8;case 1:return uu.Int16;case 2:return uu.Float32;case 3:throw new Error("mode 3 unsupported, complex 16-bit integers");case 4:throw new Error("mode 4 unsupported, complex 32-bit reals");case 6:uu.Uint16;case 16:throw new Error("mode 16 unsupported, unsigned char * 3 (for rgb data, non-standard)")}throw new Error(`unknown mode '${e}'`)}function Oxe(e){return e.userFlag1===-128&&e.userFlag2===127}function e8(e){return Oxe(e)?uu.Float32:Vxe(e.MODE)}function JYe(e){return 256*4+e.NSYMBT}async function $Ye(e,t,r){await r.update({message:"Parsing CCP4/MRC/MAP file..."});let{header:n,littleEndian:o}=await YYe(e),i=JYe(n),a=Vxe(n.MODE),s=e8(n),l=n.NC*n.NR*n.NS,u=$7(a),c=l*u,m=Fxe(l,s);return KYe(n,m,e,i,c,o),{header:n,values:m.values,name:e.name}}function eKe(e,t){return Ae.create("Parse CCP4/MRC/MAP",async r=>{try{return nn.success(await $Ye(e,t,r))}catch(n){return nn.error(n)}})}function Gxe(e,t){return eKe(fR.fromBuffer(Um.fromUint8Array(e),t),e.length)}var t8=512;function rKe(e){return{xStart:parseInt(e.substr(10,5)),yStart:parseInt(e.substr(15,5)),zStart:parseInt(e.substr(20,5)),xExtent:parseInt(e.substr(32,5)),yExtent:parseInt(e.substr(38,5)),zExtent:parseInt(e.substr(42,5)),xRate:parseInt(e.substr(52,5)),yRate:parseInt(e.substr(58,5)),zRate:parseInt(e.substr(62,5)),xlen:parseFloat(e.substr(73,10)),ylen:parseFloat(e.substr(83,10)),zlen:parseFloat(e.substr(93,10)),alpha:parseFloat(e.substr(103,10)),beta:parseFloat(e.substr(113,10)),gamma:parseFloat(e.substr(123,10)),divisor:parseFloat(e.substr(138,12)),summand:parseInt(e.substr(155,8)),sigma:parseFloat(e.substr(170,12))}}function nKe(e,t){let r=t?o=>e.readInt16LE(o*2):o=>e.readInt16BE(o*2),n=1/r(17);return{xStart:r(0),yStart:r(1),zStart:r(2),xExtent:r(3),yExtent:r(4),zExtent:r(5),xRate:r(6),yRate:r(7),zRate:r(8),xlen:r(9)*n,ylen:r(10)*n,zlen:r(11)*n,alpha:r(12)*n,beta:r(13)*n,gamma:r(14)*n,divisor:r(15)/100,summand:r(16),sigma:void 0}}function Uxe(e){let{xExtent:t,yExtent:r,zExtent:n}=e,o=Math.ceil(t/8),i=Math.ceil(r/8),a=Math.ceil(n/8);return{xBlocks:o,yBlocks:i,zBlocks:a}}async function oKe(e){let{buffer:t}=await e.readBuffer(0,t8),r=String.fromCharCode.apply(null,t),n=r.startsWith(":-)"),o=n||t.readInt16LE(36)===100;return{header:n?rKe(r):nKe(t,o),littleEndian:o}}async function iKe(e,t,r,n){n||Um.flipByteOrderInPlace2(t.buffer);let{divisor:o,summand:i,xExtent:a,yExtent:s,zExtent:l}=e,{xBlocks:u,yBlocks:c,zBlocks:m}=Uxe(e),d=0;for(let p=0;p<m;++p)for(let h=0;h<c;++h)for(let f=0;f<u;++f)for(let g=0;g<8;++g){let y=8*p+g;for(let x=0;x<8;++x){let S=8*h+x;for(let I=0;I<8;++I){let v=8*f+I;if(v<a&&S<s&&y<l){let A=(v*s+S)*l+y;r[A]=(t[d]-i)/o,++d}else{d+=8-I;break}}}}}function aKe(e){let{xExtent:t,yExtent:r,zExtent:n}=e,{xBlocks:o,yBlocks:i,zBlocks:a}=Uxe(e),s=t*r*n,l=o*8*i*8*a*8,c=l*1;return{count:l,byteCount:c,valueCount:s}}async function sKe(e,t,r){await r.update({message:"Parsing DSN6/BRIX file..."});let{header:n,littleEndian:o}=await oKe(e),{buffer:i}=await e.readBuffer(t8,t-t8),{valueCount:a}=aKe(n),s=new Float32Array(a);return await iKe(n,i,s,o),{header:n,values:s,name:e.name}}function lKe(e,t){return Ae.create("Parse DSN6/BRIX",async r=>{try{return nn.success(await sKe(e,t,r))}catch(n){return nn.error(n)}})}function Nxe(e,t){return lKe(fR.fromBuffer(Um.fromUint8Array(e),t),e.length)}var cKe={char:1,uchar:1,short:2,ushort:2,int:4,uint:4,float:4,double:8,int8:1,uint8:1,int16:2,uint16:2,int32:4,uint32:4,float32:4,float64:8},mKe=new Set(Object.keys(cKe));function dF(e){if(!mKe.has(e))throw new Error(`unknown ply type '${e}'`);return e}function zxe(e,t,r){let n=new Map;for(let o=0,i=t.length;o<i;++o)n.set(t[o],e[o]);return{comments:r,elementNames:t,getElement:o=>n.get(o)}}function dKe(e,t){let r=St(e);return{data:e,tokenizer:r,runtimeCtx:t,comments:[],elementSpecs:[],elements:[]}}function pKe(e){let t=e.data.indexOf("end_header",e.position);if(t===-1)throw new Error("no 'end_header' record found");e.tokenStart=e.position,e.tokenEnd=t,e.position=t,St.eatLine(e)}function fKe(e){let{tokenizer:t,comments:r,elementSpecs:n}=e;pKe(t);let o=St.getTokenString(t).split(/\r?\n/);if(o[0]!=="ply")throw new Error("data not starting with 'ply'");if(o[1]!=="format ascii 1.0")throw new Error("format not 'ascii 1.0'");let i,a,s;function l(){if(i!==void 0&&a!==void 0&&s!==void 0){let u=!1;for(let c=0,m=s.length;c<m;++c)if(s[c].kind==="list"){u=!0;break}u&&s.length,u?n.push({kind:"list",name:i,count:a,property:s[0]}):n.push({kind:"table",name:i,count:a,properties:s})}}for(let u=2,c=o.length;u<c;++u){let m=o[u],d=m.split(" ");if(m.startsWith("comment"))r.push(m.substr(8));else if(m.startsWith("element"))l(),s=[],i=d[1],a=parseInt(d[2]);else if(m.startsWith("property")){if(s===void 0)throw new Error("properties outside of element");d[1]==="list"?s.push({kind:"list",countType:dF(d[2]),dataType:dF(d[3]),name:d[4]}):s.push({kind:"column",type:dF(d[1]),name:d[2]})}else m.startsWith("end_header")?l():console.warn("unknown header line")}}function hKe(e){let{elementSpecs:t}=e;for(let r=0,n=t.length;r<n;++r){let o=t[r];o.kind==="table"?gKe(e,o):o.kind==="list"&&yKe(e,o)}}function Hxe(e){switch(e){case"char":case"uchar":case"int8":case"uint8":case"short":case"ushort":case"int16":case"uint16":case"int":case"uint":case"int32":case"uint32":return W.Schema.int;case"float":case"double":case"float32":case"float64":return W.Schema.float}}function gKe(e,t){let{elements:r,tokenizer:n}=e,{count:o,properties:i}=t,a=i.length,s=[],l=[],u=[],c=new Map;for(let m=0,d=a;m<d;++m){let p=We.create(n.data,o*2);u.push(p)}for(let m=0,d=o;m<d;++m)for(let p=0,h=a;p<h;++p)St.skipWhitespace(n),St.markStart(n),St.eatValue(n),We.addUnchecked(u[p],n.tokenStart,n.tokenEnd);for(let m=0,d=a;m<d;++m){let{type:p,name:h}=i[m],f=dE(u[m],Hxe(p));s.push(h),l.push(p),c.set(h,f)}r.push({kind:"table",rowCount:o,propertyNames:s,propertyTypes:l,getProperty:m=>c.get(m)})}function yKe(e,t){let{elements:r,tokenizer:n}=e,{count:o,property:i}=t,a=We.create(n.data,o*2*3),s=new Uint32Array(o+1),l=0;for(let m=0,d=o;m<d;++m){for(St.skipWhitespace(n),St.markStart(n);St.skipWhitespace(n)!==10;)++l,St.markStart(n),St.eatValue(n),We.addToken(a,n);s[m+1]=l}let u={entries:[],count:0},c=dE(a,Hxe(i.dataType));r.push({kind:"list",rowCount:o,name:i.name,type:i.dataType,value:m=>{let d=s[m]+1,p=c.value(d-1);for(let h=d,f=d+p;h<f;++h)u.entries[h-d]=c.value(h);return u.count=p,u}})}async function bKe(e,t){let r=dKe(e,t);t.update({message:"Parsing...",current:0,max:e.length}),fKe(r),hKe(r);let{elements:n,elementSpecs:o,comments:i}=r,a=o.map(l=>l.name),s=zxe(n,a,i);return nn.success(s)}function jxe(e){return Ae.create("Parse PLY",async t=>await bKe(e,t))}var{readLine:fF,skipWhitespace:Wxe,eatValue:Xxe,eatLine:CKe,markStart:r8}=St,pF=/\s+/,SKe=/(^\*|REMARK)*/;function vKe(e,t){return{tokenizer:e,runtimeCtx:t}}async function IKe(e,t){let{tokenizer:r}=e,n=We.create(r.data,t*2),o=We.create(r.data,t*2),i=We.create(r.data,t*2),a=We.create(r.data,t*2),s=We.create(r.data,t*2),l=We.create(r.data,t*2),u=We.create(r.data,t*2),c=We.create(r.data,t*2),{position:m}=r,d=fF(r).trim();r.position=m;let p=d.split(pF).length===7,h=p?6:8,{length:f}=r,g=0;return await ys(e.runtimeCtx,1e5,void 0,y=>{let x=Math.min(t-g,y);for(let S=0;S<x;++S){for(let I=0;I<h;++I)if(Wxe(r),r8(r),Xxe(r),p)switch(I){case 0:We.addUnchecked(n,r.tokenStart,r.tokenEnd);break;case 1:We.addUnchecked(i,r.tokenStart,r.tokenEnd);break;case 2:We.addUnchecked(s,r.tokenStart,r.tokenEnd);break;case 3:We.addUnchecked(l,r.tokenStart,r.tokenEnd);break;case 4:We.addUnchecked(u,r.tokenStart,r.tokenEnd);break;case 5:We.addUnchecked(c,r.tokenStart,r.tokenEnd);break}else switch(I){case 0:We.addUnchecked(n,r.tokenStart,r.tokenEnd);break;case 1:We.addUnchecked(o,r.tokenStart,r.tokenEnd);break;case 2:We.addUnchecked(i,r.tokenStart,r.tokenEnd);break;case 3:We.addUnchecked(a,r.tokenStart,r.tokenEnd);break;case 4:We.addUnchecked(s,r.tokenStart,r.tokenEnd);break;case 5:We.addUnchecked(l,r.tokenStart,r.tokenEnd);break;case 6:We.addUnchecked(u,r.tokenStart,r.tokenEnd);break;case 7:We.addUnchecked(c,r.tokenStart,r.tokenEnd);break}CKe(r),r8(r)}return g+=x,x},y=>y.update({message:"Parsing...",current:r.position,max:f})),{count:t,atomId:jt(n)(W.Schema.int),segmentName:p?jt(i)(W.Schema.str):jt(o)(W.Schema.str),residueId:jt(i)(W.Schema.int),residueName:p?jt(i)(W.Schema.str):jt(a)(W.Schema.str),atomName:jt(s)(W.Schema.str),atomType:jt(l)(W.Schema.str),charge:jt(u)(W.Schema.float),mass:jt(c)(W.Schema.float)}}async function AKe(e,t){let{tokenizer:r}=e,n=We.create(r.data,t*2),o=We.create(r.data,t*2),{length:i}=r,a=0;return await ys(e.runtimeCtx,10,void 0,s=>{let l=Math.min(t-a,s);for(let u=0;u<l;++u)for(let c=0;c<2;++c)switch(Wxe(r),r8(r),Xxe(r),c){case 0:We.addUnchecked(n,r.tokenStart,r.tokenEnd);break;case 1:We.addUnchecked(o,r.tokenStart,r.tokenEnd);break}return a+=l,l},s=>s.update({message:"Parsing...",current:r.position,max:i})),{count:t,atomIdA:jt(n)(W.Schema.int),atomIdB:jt(o)(W.Schema.int)}}function TKe(e,t){let r=[];for(let n=0;n<t;++n){let o=fF(e.tokenizer);r.push(o.replace(SKe,"").trim())}return r}async function PKe(e,t){let r=St(e),n=vKe(r,t),o,i,a,s=fF(n.tokenizer).trim();for(;r.tokenEnd<r.length;){let u=fF(n.tokenizer).trim();if(u.includes("!NTITLE")){let c=parseInt(u.split(pF)[0]);o=TKe(n,c)}else if(u.includes("!NATOM")){let c=parseInt(u.split(pF)[0]);i=await IKe(n,c)}else if(u.includes("!NBOND")){let c=parseInt(u.split(pF)[0]);a=await AKe(n,c);break}else u.includes("!NTHETA")||u.includes("!NPHI")||u.includes("!NIMPHI")||u.includes("!NDON")||u.includes("!NACC")||u.includes("!NNB")||u.includes("!NGRP NST2")||u.includes("!MOLNT")||u.includes("!NUMLP NUMLPH")||u.includes("!NCRTERM")}if(o===void 0&&(o=[]),i===void 0)return nn.error("no atoms data");if(a===void 0)return nn.error("no bonds data");let l={id:s,title:o,atoms:i,bonds:a};return nn.success(l)}function Qxe(e){return Ae.create("Parse PSF",async t=>await PKe(e,t))}var Zxe=.529177210859;function _Ke(e){let t=St.readLines(e,6),r=(x,S)=>{let I=+t[x].trim().split(/\s+/g)[S];return Number.isNaN(I)?0:I},n=x=>{let S=r(x+2,0),I=Zxe;return[Math.abs(S),b.create(r(x+2,1)*I,r(x+2,2)*I,r(x+2,3)*I),S]},o=t[0].trim(),i=t[1].trim(),[a,s,l]=n(0),[u,c]=n(1),[m,d]=n(2),[p,h]=n(3),f=RKe(e,a,Zxe),g=[];if(l>=0){let x=r(2,4);x===0&&(x=1);for(let S=0;S<x;S++)g.push(S)}else{let x=St.readLine(e).trim().split(/\s+/g);for(let S=0,I=+x[0];S<I;S++)g.push(+x[S+1])}return{header:{orbitals:l<0,comment1:o,comment2:i,atomCount:a,origin:s,dim:b.create(u,m,p),basisX:c,basisY:d,basisZ:h,dataSetIds:g},atoms:f}}function RKe(e,t,r){let n=new Int32Array(t),o=new Float64Array(t),i=new Float32Array(t),a=new Float32Array(t),s=new Float32Array(t);for(let l=0;l<t;l++){let u=St.readLine(e).trim().split(/\s+/g);n[l]=+u[0],o[l]=+u[1],i[l]=+u[2]*r,a[l]=+u[3]*r,s[l]=+u[4]*r}return{count:t,number:W.ofArray({array:n,schema:W.Schema.int}),nuclearCharge:W.ofArray({array:o,schema:W.Schema.float}),x:W.ofArray({array:i,schema:W.Schema.float}),y:W.ofArray({array:a,schema:W.Schema.float}),z:W.ofArray({array:s,schema:W.Schema.float})}}function DKe(e,t,r){let n=r.dim[0]*r.dim[1]*r.dim[2]*r.dataSetIds.length,o=1e4*100,i=new Float64Array(n),a=0;return ys(e,o,i,(s,l)=>{let u=Math.min(n,a+s);for(let c=a;c<u;c++)St.skipWhitespace(t),t.tokenStart=t.position,St.eatValue(t),l[c]=Nc(t.data,t.tokenStart,t.tokenEnd);return a=u,u===n?0:o},(s,l,u)=>s.update({current:Math.min(u,n),max:n}))}function qxe(e,t){return Ae.create("Parse Cube",async r=>{await r.update("Reading header...");let n=St(e),{header:o,atoms:i}=_Ke(n),a=await DKe(r,n,o);return nn.success({header:o,atoms:i,values:a,name:t})})}function Yxe(e){let t={h:b()},r=0,n=0,o=/\s+/g;for(;;){let i=St.readLine(e),a;if(i.startsWith("object 1"))a=i.split(o),t.dim=b.create(parseInt(a[5]),parseInt(a[6]),parseInt(a[7]));else if(i.startsWith("origin"))a=i.split(o),t.min=b.create(parseFloat(a[1]),parseFloat(a[2]),parseFloat(a[3]));else if(i.startsWith("delta"))a=i.split(o),n===0?t.h[0]=parseFloat(a[1]):n===1?t.h[1]=parseFloat(a[2]):n===2&&(t.h[2]=parseFloat(a[3])),n+=1;else if(i.startsWith("object 3")){r+=i.length+1;break}r+=i.length+1}return{header:t,headerByteCount:r}}function wKe(e,t,r){let n=r.dim[0]*r.dim[1]*r.dim[2],o=1e4*100,i=new Float64Array(n),a=0;return ys(e,o,i,(s,l)=>{let u=Math.min(n,a+s);for(let c=a;c<u;c++)St.skipWhitespace(t),t.tokenStart=t.position,St.eatValue(t),l[c]=Nc(t.data,t.tokenStart,t.tokenEnd);return a=u,u===n?0:o},(s,l,u)=>s.update({current:Math.min(u,n),max:n}))}async function MKe(e,t,r){await e.update("Reading header...");let n=St(t),{header:o}=Yxe(n);await e.update("Reading values...");let i=await wKe(e,n,o);return nn.success({header:o,values:i,name:r})}async function BKe(e,t,r){await e.update("Reading header...");let n=Yh(t,0,1e3),o=St(n),{header:i,headerByteCount:a}=Yxe(o);await e.update("Reading values...");let s=i.dim[0]*i.dim[1]*i.dim[2],l=new DataView(t.buffer,t.byteOffset+a),u=new Float64Array(s);for(let c=0;c<s;c++)u[c]=l.getFloat64(c*8,!0);return nn.success({header:i,values:u,name:r})}function Kxe(e,t){return Ae.create("Parse DX",r=>Tm.is(e)?MKe(r,e,t):BKe(r,e,t))}var EKe={NATOM:"",NTYPES:"",NBONH:"",MBONA:"",NTHETH:"",MTHETA:"",NPHIH:"",MPHIA:"",NHPARM:"",NPARM:"",NNB:"",NRES:"",NBONA:"",NTHETA:"",NPHIA:"",NUMBND:"",NUMANG:"",NPTRA:"",NATYP:"",NPHB:"",IFPERT:"",NBPER:"",NGPER:"",NDPER:"",MBPER:"",MGPER:"",MDPER:"",IFBOX:"",NMXRS:"",IFCAP:"",NUMEXTRA:"",NCOPY:""},Jxe=Object.keys(EKe),{readLine:hR,markLine:$xe,trim:kKe}=St;function FKe(e,t){return{tokenizer:e,runtimeCtx:t}}function LKe(e){let{tokenizer:t}=e,r=[];for(;t.tokenEnd<t.length&&t.data.charAt(t.position)!=="%";){let n=hR(t).trim();n&&r.push(n)}return r}function VKe(e){let{tokenizer:t}=e,r=Object.create(null);Jxe.forEach(o=>{r[o]=0});let n=0;for(;t.tokenEnd<t.length&&t.data.charAt(t.position)!=="%";){let o=hR(t),i=Math.min(n+10,32);for(let a=0;n<i;++a,++n)r[Jxe[n]]=parseInt(o.substring(a*8,a*8+8).trim())}return r}function vC(e,t,r,n){let{tokenizer:o}=e,i=We.create(o.data,t*2),a=0;for(;o.tokenEnd<o.length&&o.data.charAt(o.position)!=="%";){o.tokenStart=o.position;let s=Math.min(a+r,t);for(let l=0;a<s;++l,++a){let u=o.position;kKe(o,o.position,o.position+n),We.addUnchecked(i,o.tokenStart,o.tokenEnd),o.position=u+n}$xe(o)}return i}async function OKe(e,t){let r=St(e),n=FKe(r,t),o=Object.create(null),i=0;for(;r.tokenEnd<r.length;){r.position-i>1e5&&t.shouldUpdate&&(i=r.position,await t.update({current:r.position,max:r.length}));let a=hR(n.tokenizer).trim();if(a.startsWith("%VERSION"))o.version=a.substring(8).trim();else if(a.startsWith("%FLAG")){let s=a.substring(5).trim(),l=hR(n.tokenizer).trim();for(;l.startsWith("%COMMENT");)l=hR(n.tokenizer).trim();if(!l.startsWith("%FORMAT"))throw new Error(`expected %FORMAT got "${l}"`);if(s==="TITLE"||s==="CTITLE")o.title=LKe(n);else if(s==="POINTERS")o.pointers=VKe(n);else if(s==="ATOM_NAME"){let u=vC(n,o.pointers.NATOM,20,4);o.atomName=jt(u)(W.Schema.str)}else if(s==="CHARGE"){let u=vC(n,o.pointers.NATOM,5,16);o.charge=jt(u)(W.Schema.float)}else if(s==="MASS"){let u=vC(n,o.pointers.NATOM,5,16);o.mass=jt(u)(W.Schema.float)}else if(s==="RESIDUE_LABEL"){let u=vC(n,o.pointers.NRES,20,4);o.residueLabel=jt(u)(W.Schema.str)}else if(s==="RESIDUE_POINTER"){let u=vC(n,o.pointers.NRES,10,8);o.residuePointer=jt(u)(W.Schema.int)}else if(s==="BONDS_INC_HYDROGEN"){let u=vC(n,o.pointers.NBONH*3,10,8);o.bondsIncHydrogen=jt(u)(W.Schema.int)}else if(s==="BONDS_WITHOUT_HYDROGEN"){let u=vC(n,o.pointers.NBONA*3,10,8);o.bondsWithoutHydrogen=jt(u)(W.Schema.int)}else if(s==="RADII"){let u=vC(n,o.pointers.NATOM,5,16);o.radii=jt(u)(W.Schema.float)}else for(;r.tokenEnd<r.length&&r.data.charAt(r.position)!=="%";)$xe(r)}}return nn.success(o)}function eCe(e){return Ae.create("Parse PRMTOP",async t=>await OKe(e,t))}var GKe={nr:W.Schema.Int(),type:W.Schema.Str(),resnr:W.Schema.Int(),residu:W.Schema.Str(),atom:W.Schema.Str(),cgnr:W.Schema.Int(),charge:W.Schema.Float(),mass:W.Schema.Float()},UKe={ai:W.Schema.Int(),aj:W.Schema.Int()},NKe={compound:W.Schema.Str(),molCount:W.Schema.Int()},{readLine:n8,markLine:IC,skipWhitespace:AC,markStart:hF,eatValue:o8,eatLine:zKe}=St;function HKe(e,t){return{tokenizer:e,runtimeCtx:t}}var jKe=/\[ (.+) \]/,WKe=/\s+/;function XKe(e){let{tokenizer:t}=e,r;for(;t.tokenEnd<t.length;){AC(t);let n=t.data.charAt(t.position);if(n==="[")break;if(n===";"||n==="*"){IC(t);continue}if(r!==void 0)throw new Error("more than one molName");r=n8(t).split(WKe)[0]}if(r===void 0)throw new Error("missing molName");return r}function QKe(e){let{tokenizer:t}=e,r=We.create(t.data,64),n=We.create(t.data,64),o=We.create(t.data,64),i=We.create(t.data,64),a=We.create(t.data,64),s=We.create(t.data,64),l=We.create(t.data,64),u=We.create(t.data,64);for(;t.tokenEnd<t.length;){AC(t);let c=t.data.charAt(t.position);if(c==="[")break;if(c===";"||c==="*"){IC(t);continue}for(let m=0;m<8;++m)switch(AC(t),hF(t),o8(t),m){case 0:We.add(r,t.tokenStart,t.tokenEnd);break;case 1:We.add(n,t.tokenStart,t.tokenEnd);break;case 2:We.add(o,t.tokenStart,t.tokenEnd);break;case 3:We.add(i,t.tokenStart,t.tokenEnd);break;case 4:We.add(a,t.tokenStart,t.tokenEnd);break;case 5:We.add(s,t.tokenStart,t.tokenEnd);break;case 6:We.add(l,t.tokenStart,t.tokenEnd);break;case 7:We.add(u,t.tokenStart,t.tokenEnd);break}IC(t)}return wr.ofColumns(GKe,{nr:jt(r)(W.Schema.int),type:jt(n)(W.Schema.str),resnr:jt(o)(W.Schema.int),residu:jt(i)(W.Schema.str),atom:jt(a)(W.Schema.str),cgnr:jt(s)(W.Schema.int),charge:jt(l)(W.Schema.float),mass:jt(u)(W.Schema.float)})}function ZKe(e){let{tokenizer:t}=e,r=We.create(t.data,64),n=We.create(t.data,64);for(;t.tokenEnd<t.length;){AC(t);let o=t.data.charAt(t.position);if(o==="[")break;if(o===";"||o==="*"){IC(t);continue}for(let i=0;i<2;++i)switch(AC(t),hF(t),o8(t),i){case 0:We.add(r,t.tokenStart,t.tokenEnd);break;case 1:We.add(n,t.tokenStart,t.tokenEnd);break}IC(t)}return wr.ofColumns(UKe,{ai:jt(r)(W.Schema.int),aj:jt(n)(W.Schema.int)})}function qKe(e){let{tokenizer:t}=e,r;for(;t.tokenEnd<t.length;){AC(t);let n=t.data.charAt(t.position);if(n==="[")break;if(n===";"||n==="*"){IC(t);continue}if(r!==void 0)throw new Error("more than one system");r=n8(t).trim()}if(r===void 0)throw new Error("missing system");return r}function YKe(e){let{tokenizer:t}=e,r=We.create(t.data,64),n=We.create(t.data,64);for(;t.tokenEnd<t.length&&(AC(t),!(t.position>=t.length));){let o=t.data.charAt(t.position);if(o==="[")break;if(o===";"||o==="*"){IC(t);continue}for(let i=0;i<2;++i)switch(AC(t),hF(t),o8(t),i){case 0:We.add(r,t.tokenStart,t.tokenEnd);break;case 1:We.add(n,t.tokenStart,t.tokenEnd);break}zKe(t),hF(t)}return wr.ofColumns(NKe,{compound:jt(r)(W.Schema.str),molCount:jt(n)(W.Schema.int)})}async function KKe(e,t){let r=St(e),n=HKe(r,t),o=Object.create(null),i=0;o.compounds={};let a={},s="";function l(){s&&a.atoms&&(o.compounds[s]=a,a={},s="")}for(;r.tokenEnd<r.length;){r.position-i>1e5&&t.shouldUpdate&&(i=r.position,await t.update({current:r.position,max:r.length}));let u=n8(n.tokenizer).trim();if(!(!u||u[0]==="*"||u[0]===";")){if(u.startsWith("#include"))throw new Error("#include statements not allowed");if(u.startsWith("[")){let c=u.match(jKe);if(c===null)throw new Error("expected field name");let m=c[1];if(m==="moleculetype")l(),s=XKe(n);else if(m==="atoms")a.atoms=QKe(n);else if(m==="bonds")a.bonds=ZKe(n);else if(m==="system")o.system=qKe(n);else if(m==="molecules")l(),o.molecules=YKe(n);else for(;r.tokenEnd<r.length&&r.data.charAt(r.position)!=="[";)IC(r)}}}return nn.success(o)}function tCe(e){return Ae.create("Parse TOP",async t=>await KKe(e,t))}var ZS=Vt.BuiltIn({name:"download",display:{name:"Download",description:"Download string or binary data from the specified URL"},from:[ne.Root],to:[ne.Data.String,ne.Data.Binary],params:{url:C.Url("https://www.ebi.ac.uk/pdbe/static/entry/1cbs_updated.cif",{description:"Resource URL. Must be the same domain or support CORS."}),label:C.Optional(C.Text("")),isBinary:C.Optional(C.Boolean(!1,{description:"If true, download data as binary (string otherwise)"}))}})({apply({params:e,cache:t},r){return Ae.create("Download",async n=>{let o=sn.getUrlAsset(r.managers.asset,e.url),i=await r.managers.asset.resolve(o,e.isBinary?"binary":"string").runInContext(n);return t.asset=i,e.isBinary?new ne.Data.Binary(i.data,{label:e.label?e.label:o.url}):new ne.Data.String(i.data,{label:e.label?e.label:o.url})})},dispose({cache:e}){e?.asset?.dispose()},update({oldParams:e,newParams:t,b:r}){return e.url!==t.url||e.isBinary!==t.isBinary?et.UpdateResult.Recreate:e.label!==t.label?(r.label=t.label||(typeof t.url=="string"?t.url:t.url.url),et.UpdateResult.Updated):et.UpdateResult.Unchanged}}),i8=Vt.BuiltIn({name:"download-blob",display:{name:"Download Blob",description:"Download multiple string or binary data from the specified URLs."},from:ne.Root,to:ne.Data.Blob,params:{sources:C.ObjectList({id:C.Text("",{label:"Unique ID"}),url:C.Url("https://www.ebi.ac.uk/pdbe/static/entry/1cbs_updated.cif",{description:"Resource URL. Must be the same domain or support CORS."}),isBinary:C.Optional(C.Boolean(!1,{description:"If true, download data as binary (string otherwise)"})),canFail:C.Optional(C.Boolean(!1,{description:"Indicate whether the download can fail and not be included in the blob as a result."}))},e=>`${e.id}: ${e.url}`),maxConcurrency:C.Optional(C.Numeric(4,{min:1,max:12,step:1},{description:"The maximum number of concurrent downloads."}))}})({apply({params:e,cache:t},r){return Ae.create("Download Blob",async n=>{let o=[],i=await Xle(n,r.managers.asset,e.sources,e.maxConcurrency||4),a=[];for(let s=0;s<i.length;s++){let l=i[s],u=e.sources[s];l.kind==="error"?r.log.warn(`Download ${l.id} (${u.url}) failed: ${l.error}`):(a.push(l.result),o.push(u.isBinary?{id:l.id,kind:"binary",data:l.result.data}:{id:l.id,kind:"string",data:l.result.data}))}return t.assets=a,new ne.Data.Blob(o,{label:"Data Blob",description:`${o.length} ${o.length===1?"entry":"entries"}`})})},dispose({cache:e},t){let r=e?.assets;if(r)for(let n of r)n.dispose()}}),JKe=Vt.BuiltIn({name:"defalate-data",display:{name:"Deflate",description:"Deflate compressed data"},params:{method:C.Select("gzip",[["gzip","gzip"]]),isString:C.Boolean(!1),stringEncoding:C.Optional(C.Select("utf-8",[["utf-8","UTF8"]])),label:C.Optional(C.Text(""))},from:[ne.Data.Binary],to:[ne.Data.Binary,ne.Data.String]})({apply({a:e,params:t},r){return Ae.create("Gzip",async n=>{let o=await HB(n,e.data),i=t.label?t.label:e.label;if(t.isString){let a=FB(o);return new ne.Data.String(a,{label:i})}return new ne.Data.Binary(o,{label:i})})}}),a8=Vt.BuiltIn({name:"raw-data",display:{name:"Raw Data",description:"Raw data supplied by value."},from:[ne.Root],to:[ne.Data.String,ne.Data.Binary],params:{data:C.Value("",{isHidden:!0}),label:C.Optional(C.Text(""))}})({apply({params:e}){return Ae.create("Raw Data",async()=>{if(typeof e.data=="string")return new ne.Data.String(e.data,{label:e.label?e.label:"String"});if(Array.isArray(e.data))return new ne.Data.Binary(new Uint8Array(e.data),{label:e.label?e.label:"Binary"});if(e.data instanceof ArrayBuffer)return new ne.Data.Binary(new Uint8Array(e.data),{label:e.label?e.label:"Binary"});if(e.data instanceof Uint8Array)return new ne.Data.Binary(e.data,{label:e.label?e.label:"Binary"});Mr(e.data)})},update({oldParams:e,newParams:t,b:r}){return e.data!==t.data?et.UpdateResult.Recreate:e.label!==t.label?(r.label=t.label||r.label,et.UpdateResult.Updated):et.UpdateResult.Unchanged},customSerialization:{toJSON(e){if(typeof e.data=="string"||Array.isArray(e.data))return e;if(e.data instanceof ArrayBuffer){let t=new Uint8Array(e.data),r=new Array(t.length);for(let n=0,o=t.length;n<o;n++)r[n]=t[n];return{data:r,label:e.label}}else if(e.data instanceof Uint8Array){let t=new Array(e.data.length);for(let r=0,n=e.data.length;r<n;r++)t[r]=e.data[r];return{data:t,label:e.label}}},fromJSON(e){return e}}}),s8=Vt.BuiltIn({name:"read-file",display:{name:"Read File",description:"Read string or binary data from the specified file"},from:ne.Root,to:[ne.Data.String,ne.Data.Binary],params:{file:C.File(),label:C.Optional(C.Text("")),isBinary:C.Optional(C.Boolean(!1,{description:"If true, open file as as binary (string otherwise)"}))}})({apply({params:e,cache:t},r){return Ae.create("Open File",async n=>{if(e.file===null)return r.log.error("No file(s) selected"),Gn.Null;let o=await r.managers.asset.resolve(e.file,e.isBinary?"binary":"string").runInContext(n);return t.asset=o,e.isBinary?new ne.Data.Binary(o.data,{label:e.label?e.label:e.file.name}):new ne.Data.String(o.data,{label:e.label?e.label:e.file.name})})},dispose({cache:e}){e?.asset?.dispose()},update({oldParams:e,newParams:t,b:r}){return e.label!==t.label?(r.label=t.label||e.file?.name||"",et.UpdateResult.Updated):et.UpdateResult.Unchanged},isSerializable:()=>({isSerializable:!1,reason:"Cannot serialize user loaded files."})}),$Ke=Vt.BuiltIn({name:"parse-blob",display:{name:"Parse Blob",description:"Parse multiple data enties"},from:ne.Data.Blob,to:ne.Format.Blob,params:{formats:C.ObjectList({id:C.Text("",{label:"Unique ID"}),format:C.Select("cif",[["cif","cif"]])},e=>`${e.id}: ${e.format}`)}})({apply({a:e,params:t},r){return Ae.create("Parse Blob",async n=>{let o=new Map;for(let a of t.formats)o.set(a.id,a.format);let i=[];for(let a of e.data){if(!o.has(a.id))continue;let s=await(a.kind==="string"?Fu.parse(a.data):Fu.parseBinary(a.data)).runInContext(n);if(s.isError)throw new Error(`${a.id}: ${s.message}`);i.push({id:a.id,kind:"cif",data:s.result})}return new ne.Format.Blob(i,{label:"Format Blob",description:`${i.length} ${i.length===1?"entry":"entries"}`})})}}),l8=Vt.BuiltIn({name:"parse-cif",display:{name:"Parse CIF",description:"Parse CIF from String or Binary data"},from:[ne.Data.String,ne.Data.Binary],to:ne.Format.Cif})({apply({a:e}){return Ae.create("Parse CIF",async t=>{let r=await Fu.parse(e.data).runInContext(t);if(r.isError)throw new Error(r.message);return r.result.blocks.length===0?Gn.Null:new ne.Format.Cif(r.result)})}}),eJe=Vt.BuiltIn({name:"parse-cube",display:{name:"Parse Cube",description:"Parse Cube from String data"},from:ne.Data.String,to:ne.Format.Cube})({apply({a:e}){return Ae.create("Parse Cube",async t=>{let r=await qxe(e.data,e.label).runInContext(t);if(r.isError)throw new Error(r.message);return new ne.Format.Cube(r.result)})}}),u8=Vt.BuiltIn({name:"parse-psf",display:{name:"Parse PSF",description:"Parse PSF from String data"},from:[ne.Data.String],to:ne.Format.Psf})({apply({a:e}){return Ae.create("Parse PSF",async t=>{let r=await Qxe(e.data).runInContext(t);if(r.isError)throw new Error(r.message);return new ne.Format.Psf(r.result)})}}),c8=Vt.BuiltIn({name:"parse-prmtop",display:{name:"Parse PRMTOP",description:"Parse PRMTOP from String data"},from:[ne.Data.String],to:ne.Format.Prmtop})({apply({a:e}){return Ae.create("Parse PRMTOP",async t=>{let r=await eCe(e.data).runInContext(t);if(r.isError)throw new Error(r.message);return new ne.Format.Prmtop(r.result)})}}),m8=Vt.BuiltIn({name:"parse-top",display:{name:"Parse TOP",description:"Parse TOP from String data"},from:[ne.Data.String],to:ne.Format.Top})({apply({a:e}){return Ae.create("Parse TOP",async t=>{let r=await tCe(e.data).runInContext(t);if(r.isError)throw new Error(r.message);return new ne.Format.Top(r.result)})}}),tJe=Vt.BuiltIn({name:"parse-ply",display:{name:"Parse PLY",description:"Parse PLY from String data"},from:[ne.Data.String],to:ne.Format.Ply})({apply({a:e}){return Ae.create("Parse PLY",async t=>{let r=await jxe(e.data).runInContext(t);if(r.isError)throw new Error(r.message);return new ne.Format.Ply(r.result,{label:r.result.comments[0]||"PLY Data"})})}}),d8=Vt.BuiltIn({name:"parse-ccp4",display:{name:"Parse CCP4/MRC/MAP",description:"Parse CCP4/MRC/MAP from Binary data"},from:[ne.Data.Binary],to:ne.Format.Ccp4})({apply({a:e}){return Ae.create("Parse CCP4/MRC/MAP",async t=>{let r=await Gxe(e.data,e.label).runInContext(t);if(r.isError)throw new Error(r.message);return new ne.Format.Ccp4(r.result)})}}),rJe=Vt.BuiltIn({name:"parse-dsn6",display:{name:"Parse DSN6/BRIX",description:"Parse CCP4/BRIX from Binary data"},from:[ne.Data.Binary],to:ne.Format.Dsn6})({apply({a:e}){return Ae.create("Parse DSN6/BRIX",async t=>{let r=await Nxe(e.data,e.label).runInContext(t);if(r.isError)throw new Error(r.message);return new ne.Format.Dsn6(r.result)})}}),p8=Vt.BuiltIn({name:"parse-dx",display:{name:"Parse DX",description:"Parse DX from Binary/String data"},from:[ne.Data.Binary,ne.Data.String],to:ne.Format.Dx})({apply({a:e}){return Ae.create("Parse DX",async t=>{let r=await Kxe(e.data,e.label).runInContext(t);if(r.isError)throw new Error(r.message);return new ne.Format.Dx(r.result)})}}),nJe=Vt.BuiltIn({name:"import-string",display:{name:"Import String",description:"Import given data as a string"},from:ne.Root,to:ne.Data.String,params:{data:C.Value(""),label:C.Optional(C.Text(""))}})({apply({params:{data:e,label:t}}){return new ne.Data.String(e,{label:t||""})},update({oldParams:e,newParams:t,b:r}){return e.data!==t.data?et.UpdateResult.Recreate:e.label!==t.label?(r.label=t.label||"",et.UpdateResult.Updated):et.UpdateResult.Unchanged},isSerializable:()=>({isSerializable:!1,reason:"Cannot serialize user imported strings."})}),oJe=Vt.BuiltIn({name:"import-json",display:{name:"Import JSON",description:"Import given data as a JSON"},from:ne.Root,to:ne.Format.Json,params:{data:C.Value({}),label:C.Optional(C.Text(""))}})({apply({params:{data:e,label:t}}){return new ne.Format.Json(e,{label:t||""})},update({oldParams:e,newParams:t,b:r}){return e.data!==t.data?et.UpdateResult.Recreate:e.label!==t.label?(r.label=t.label||"",et.UpdateResult.Updated):et.UpdateResult.Unchanged},isSerializable:()=>({isSerializable:!1,reason:"Cannot serialize user imported JSON."})}),iJe=Vt.BuiltIn({name:"parse-json",display:{name:"Parse JSON",description:"Parse JSON from String data"},from:[ne.Data.String],to:ne.Format.Json})({apply({a:e}){return Ae.create("Parse JSON",async t=>{let r=await new Response(Tm.toString(e.data)).json();return new ne.Format.Json(r)})}}),aJe=Vt.BuiltIn({name:"lazy-volume",display:{name:"Lazy Volume",description:"A placeholder for lazy loaded volume representation"},from:ne.Root,to:ne.Volume.Lazy,params:{url:C.Url(""),isBinary:C.Boolean(!1),format:C.Text("ccp4"),entryId:C.Value("",{isHidden:!0}),isovalues:C.ObjectList({type:C.Text("relative"),value:C.Numeric(0),color:C.Color(Lt.black),alpha:C.Numeric(1,{min:0,max:1,step:.01}),volumeIndex:C.Numeric(0)},e=>`${e.type} ${e.value}`)}})({apply({a:e,params:t}){return Ae.create("Lazy Volume",async r=>{let n=Array.isArray(t.entryId)?t.entryId.join(", "):t.entryId;return new ne.Volume.Lazy(t,{label:`${n||t.url}`,description:"Lazy Volume"})})}});var h8={};Gi(h8,{CreateGroup:()=>sJe});var sJe=Vt.BuiltIn({name:"create-group",display:{name:"Group"},from:[],to:ne.Group,params:{label:C.Text("Group"),description:C.Optional(C.Text(""))}})({apply({params:e}){return new ne.Group({},e)},update({oldParams:e,newParams:t,b:r}){return Gh(e,t)?et.UpdateResult.Unchanged:(r.label=t.label,r.description=t.description,et.UpdateResult.Updated)}});var PW={};Gi(PW,{CoordinatesFromDcd:()=>aW,CoordinatesFromLammpstraj:()=>cW,CoordinatesFromNctraj:()=>uW,CoordinatesFromTrr:()=>lW,CoordinatesFromXtc:()=>sW,CustomModelProperties:()=>RR,CustomStructureProperties:()=>DR,ModelFromTrajectory:()=>_R,ModelWithCoordinates:()=>Bet,MultiStructureSelectionFromBundle:()=>Fet,MultiStructureSelectionFromExpression:()=>ket,ShapeFromPly:()=>Uet,StructureComplexElement:()=>Get,StructureComplexElementTypes:()=>_Se,StructureComponent:()=>TW,StructureFromModel:()=>vW,StructureFromTrajectory:()=>Met,StructureInstances:()=>AW,StructureSelectionFromBundle:()=>Vet,StructureSelectionFromExpression:()=>Eet,StructureSelectionFromScript:()=>Let,TopologyFromPrmtop:()=>dW,TopologyFromPsf:()=>mW,TopologyFromTop:()=>pW,TrajectoryFromBlob:()=>Tet,TrajectoryFromCifCore:()=>Ret,TrajectoryFromCube:()=>_et,TrajectoryFromGRO:()=>gW,TrajectoryFromLammpsData:()=>Pet,TrajectoryFromLammpsTrajData:()=>bW,TrajectoryFromMOL:()=>xW,TrajectoryFromMOL2:()=>SW,TrajectoryFromMmCif:()=>fW,TrajectoryFromModelAndCoordinates:()=>kF,TrajectoryFromPDB:()=>hW,TrajectoryFromSDF:()=>CW,TrajectoryFromXYZ:()=>yW,TransformStructureConformation:()=>IW,getTrajectory:()=>EF});function lJe(e){let t=new DataView(e.buffer),r=Object.create(null),n=[],o=0,i=new Int32Array(e.buffer,0,23),a=i[0]!==t.getInt32(0);if(i[0]!==84){let f=e.byteLength;for(let g=0;g<f;g+=4)t.setFloat32(g,t.getFloat32(g),!0)}if(i[0]!==84)throw new Error("dcd bad format, header block start");if(String.fromCharCode(t.getUint8(4),t.getUint8(5),t.getUint8(6),t.getUint8(7))!=="CORD")throw new Error("dcd bad format, format string");let l=!1,u=!1,c=!1;if(i[22]!==0&&(l=!0,i[12]!==0&&(u=!0),i[13]===1&&(c=!0)),r.NSET=i[2],r.ISTART=i[3],r.NSAVC=i[4],r.NAMNF=i[10],l?r.DELTA=t.getFloat32(44,a):r.DELTA=t.getFloat64(44,a),i[22]!==84)throw new Error("dcd bad format, header block end");o=o+84+8;let m=t.getInt32(o,a),d=o+1;if((m-4)%80!==0)throw new Error("dcd bad format, title block start");if(r.TITLE=eme(e.subarray(d,m)),t.getInt32(d+m+4-1,a)!==m)throw new Error("dcd bad format, title block end");if(o=o+m+8,t.getInt32(o,a)!==4)throw new Error("dcd bad format, natom block start");if(r.NATOM=t.getInt32(o+4,a),t.getInt32(o+8,a)!==4)throw new Error("dcd bad format, natom block end");if(o=o+4+8,r.NAMNF>0)throw new Error("dcd format with fixed atoms unsupported, aborting");let p=r.NATOM,h=p*4;for(let f=0,g=r.NSET;f<g;++f){let y=Object.create(null);y.elementCount=p,u&&(o+=4,y.cell=[t.getFloat64(o,a),t.getFloat64(o+1,a),t.getFloat64(o+16,a),t.getFloat64(o+24,a),t.getFloat64(o+32,a),t.getFloat64(o+40,a)],o+=48,o+=4);for(let x=0;x<3;++x){if(t.getInt32(o,a)!==h)throw new Error(`dcd bad format, coord block start: ${f}, ${x}`);o+=4;let S=new Float32Array(e.buffer,o,p);if(x===0?y.x=S:x===1?y.y=S:y.z=S,o+=h,t.getInt32(o,a)!==h)throw new Error(`dcd bad format, coord block end: ${f}, ${x}`);o+=4}if(c){let x=t.getInt32(o,a);o+=4+x+4}n.push(y)}return{header:r,frames:n}}function rCe(e){return Ae.create("Parse DCD",async t=>{try{let r=lJe(e);return nn.success(r)}catch(r){return nn.error(r)}})}function nCe(e){return function(t,r,n){return uJe(e,t,r,n)}}function uJe(e,t,r,n){let{data:o,indices:i,count:a}=e,{valueType:s}=n,l=s==="str"?u=>{let c=i[2*u]+t,m=i[2*u+1];if(c>=m)return"";let d=c+r;return d>m&&(d=m),Vde(o,c,d)}:s==="int"?u=>{let c=i[2*u]+t;return c>i[2*u+1]?0:Wy(o,c,c+r)}:u=>{let c=i[2*u]+t;return c>i[2*u+1]?0:que(o,c,c+r)};return{schema:n,__array:void 0,isDefined:!0,rowCount:a,value:l,valueKind:u=>W.ValueKinds.Present,toArray:u=>ki.createAndFillArray(a,l,u),areValuesEqual:(u,c)=>l(u)===l(c)}}function cJe(){return{title:"",timeInPs:0,hasVelocities:!1,precision:{position:0,velocity:0},box:[0,0,0]}}function mJe(e,t){return{tokenizer:e,header:cJe(),numberOfAtoms:0,runtimeCtx:t}}function dJe(e){let{tokenizer:t,header:r}=e,n=St.readLine(t);n.trim().length===0&&(n=St.readLine(t));let o=n.lastIndexOf("t=");o>=0?(r.timeInPs=parseFloat(n.substring(o+2)),r.title=n.substring(0,o).trim(),r.title&&r.title[r.title.length-1]===","&&(r.title=r.title.substring(0,r.title.length-1))):r.title=n}function pJe(e){let{tokenizer:t}=e;St.markLine(t);let r=St.getTokenString(t);e.numberOfAtoms=parseInt(r)}async function fJe(e){let{tokenizer:t,numberOfAtoms:r}=e,n=await St.readLinesAsync(t,r,e.runtimeCtx,1e5),i=t.data.substring(n.indices[0],n.indices[1]).substring(20).match(/\.\d+/g),a=i.length===6;e.header.hasVelocities=a,e.header.precision.position=i[0].length-1,e.header.precision.velocity=a?i[3].length-1:0;let s=20,l=e.header.precision.position+5,u=s+3*l,c=e.header.precision.velocity+4,m=nCe(n),d=W.Undefined(e.numberOfAtoms,W.Schema.float);return{count:e.numberOfAtoms,residueNumber:m(0,5,W.Schema.int),residueName:m(5,5,W.Schema.str),atomName:m(10,5,W.Schema.str),atomNumber:m(15,5,W.Schema.int),x:m(s,l,W.Schema.float),y:m(s+l,l,W.Schema.float),z:m(s+2*l,l,W.Schema.float),vx:a?m(u,c,W.Schema.float):d,vy:a?m(u+c,c,W.Schema.float):d,vz:a?m(u+2*c,c,W.Schema.float):d}}function hJe(e){let{tokenizer:t}=e,r=St.readLine(t).trim().split(/\s+/g);e.header.box=[+r[0],+r[1],+r[2]]}async function gJe(e,t){let r=St(e);await t.update({message:"Parsing...",current:0,max:e.length});let n=[];for(;r.position<e.length;){let i=mJe(r,t);dJe(i),pJe(i);let a=await fJe(i);hJe(i),n.push({header:i.header,atoms:a})}let o={structures:n};return nn.success(o)}function oCe(e){return Ae.create("Parse GRO",async t=>await gJe(e,t))}function iCe(e,t,r=!1){return Ae.create("Parse PDB",async n=>nn.success({lines:await St.readAllLinesAsync(e,n),id:t,isPdbqt:r}))}var yJe={radius:1,detail:0};function aCe(e,t,r){let{radius:n,detail:o}={...yJe,...r},i=bJe(),{vertices:a,indices:s}=i;u(o),ahe(a,n);let l=new Float32Array(a.length);return Dk(a,s,l,a.length/3,s.length/3),{vertices:new Float32Array(a),normals:new Float32Array(l),indices:new Uint32Array(s)};function u(m){let d=b(),p=b(),h=b();for(let f=0;f<t.length;f+=3)b.fromArray(d,e,t[f+0]*3),b.fromArray(p,e,t[f+1]*3),b.fromArray(h,e,t[f+2]*3),c(d,p,h,m)}function c(m,d,p,h){let f=Math.pow(2,h),g=[];for(let y=0;y<=f;++y){g[y]=[];let x=b();b.lerp(x,m,p,y/f);let S=b();b.lerp(S,d,p,y/f);let I=f-y;for(let v=0;v<=I;++v)if(v===0&&y===f)g[y][v]=x;else{let A=b();b.lerp(A,x,S,v/I),g[y][v]=A}}for(let y=0;y<f;++y)for(let x=0;x<2*(f-y)-1;++x){let S=Math.floor(x/2);x%2===0?i.add(g[y][S+1],g[y+1][S],g[y][S]):i.add(g[y][S+1],g[y+1][S+1],g[y+1][S])}}}function bJe(){let e=[],t=[],r=new Map;function n(o){let i=`${o[0].toFixed(5)}|${o[1].toFixed(5)}|${o[2].toFixed(5)}`,a=r.get(i);return a===void 0&&(a=e.length/3,r.set(i,a),e.push(...o)),a}return{vertices:e,indices:t,add:(o,i,a)=>{t.push(n(o),n(i),n(a))}}}var _p=(1+Math.sqrt(5))/2,sCe=[-1,_p,0,1,_p,0,-1,-_p,0,1,-_p,0,0,-1,_p,0,1,_p,0,-1,-_p,0,1,-_p,_p,0,-1,_p,0,1,-_p,0,-1,-_p,0,1],xJe=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],CJe=[0,11,5,11,0,5,1,5,0,1,1,7,0,7,7,10,0,10,10,11,5,9,4,11,2,10,6,7,1,8,3,9,4,9,3,4,2,4,2,3,2,6,3,6,6,8,3,8,8,9,4,5,2,11,6,10,7,8,1,9],g8;function lCe(){return g8||(g8=XS(sCe,xJe)),g8}var _Ir=Ig(sCe,CJe);var{vertices:SJe,indices:vJe}=lCe();function Nm(e){return 10*Math.pow(Math.pow(2,e),2)+2}function uCe(e){return aCe(SJe,vJe,{detail:e,radius:1})}var cCe=new Map,IJe=H.identity();function AJe(e,t,r){return H.scaleUniformly(e,H.fromTranslation(e,t),r)}function y8(e){let t=cCe.get(e);return t===void 0&&(t=uCe(e),cCe.set(e,t)),t}function Zr(e,t,r,n){tt.addPrimitive(e,AJe(IJe,t,r),y8(n))}var Jf={radiusTop:1,radiusBottom:1,height:1,radialSegments:8,heightSegments:1,topCap:!1,bottomCap:!1,thetaStart:0,thetaLength:Math.PI*2};function mCe(e){let{radiusTop:t,radiusBottom:r,height:n,radialSegments:o,heightSegments:i,topCap:a,bottomCap:s,thetaStart:l,thetaLength:u}={...Jf,...e},c=[],m=[],d=[],p=0,h=[],f=n/2;return g(),a&&t>0&&y(!0),s&&r>0&&y(!1),{vertices:new Float32Array(m),normals:new Float32Array(d),indices:new Uint32Array(c)};function g(){let x=b.zero(),S=(r-t)/n;for(let I=0;I<=i;++I){let v=[],A=I/i,P=A*(r-t)+t;for(let T=0;T<=o;++T){let w=T/o*u+l,E=Math.sin(w),M=Math.cos(w);m.push(P*E,-A*n+f,P*M),b.normalize(x,b.set(x,E,S,M)),d.push(...x),v.push(p++)}h.push(v)}for(let I=0;I<o;++I)for(let v=0;v<i;++v){let A=h[v][I],P=h[v+1][I],T=h[v+1][I+1],R=h[v][I+1];c.push(A,P,R),c.push(P,T,R)}}function y(x){let S=x===!0?t:r,I=x===!0?1:-1,v=p;for(let P=1;P<=o;++P)m.push(0,f*I,0),d.push(0,I,0),++p;let A=p;for(let P=0;P<=o;++P){let R=P/o*u+l,w=Math.cos(R),E=Math.sin(R);m.push(S*E,f*I,S*w),d.push(0,I,0),++p}for(let P=0;P<o;++P){let T=v+P,R=A+P;x===!0?c.push(R,R+1,T):c.push(R+1,R,T)}}}var dCe=b(),pCe=b(),zm=b(),Hm=b(),_g=b(),aA=b(),TJe={height:1,topCap:!0,bottomCap:!0};function qS(e,t){let r=e.length/3;if(r<3)throw new Error("need at least 3 points to build a prism");let{height:n,topCap:o,bottomCap:i}={...TJe,...t},a=r*2,s=r*4,l=(o?1:0)+(i?1:0);r===3?(a+=l,s+=l*3):r===4?(a+=l*2,s+=l*4):(a+=l*r,s+=l*r*3);let u=Kf(a,s),c=n*.5;b.set(dCe,0,0,-c),b.set(pCe,0,0,c);for(let m=0;m<r;++m){let d=(m+1)%r;b.set(zm,e[m*3],e[m*3+1],-c),b.set(Hm,e[d*3],e[d*3+1],-c),b.set(_g,e[d*3],e[d*3+1],c),b.set(aA,e[m*3],e[m*3+1],c),u.addQuad(zm,Hm,_g,aA)}if(r===3)o&&(b.set(zm,e[0],e[1],-c),b.set(Hm,e[3],e[4],-c),b.set(_g,e[6],e[7],-c),u.add(_g,Hm,zm)),i&&(b.set(zm,e[0],e[1],c),b.set(Hm,e[3],e[4],c),b.set(_g,e[6],e[7],c),u.add(zm,Hm,_g));else if(r===4)o&&(b.set(zm,e[0],e[1],-c),b.set(Hm,e[3],e[4],-c),b.set(_g,e[6],e[7],-c),b.set(aA,e[9],e[10],-c),u.addQuad(aA,_g,Hm,zm)),i&&(b.set(zm,e[0],e[1],c),b.set(Hm,e[3],e[4],c),b.set(_g,e[6],e[7],c),b.set(aA,e[9],e[10],c),u.addQuad(zm,Hm,_g,aA));else for(let m=0;m<r;++m){let d=(m+1)%r;o&&(b.set(zm,e[m*3],e[m*3+1],-c),b.set(Hm,e[d*3],e[d*3+1],-c),u.add(dCe,Hm,zm)),i&&(b.set(zm,e[m*3],e[m*3+1],c),b.set(Hm,e[d*3],e[d*3+1],c),u.add(zm,Hm,pCe))}return u.getPrimitive()}var b8;function fCe(){return b8||(b8=qS(Yc(4,!1))),b8}var x8;function hCe(){return x8||(x8=qS(Yc(5,!1))),x8}var C8;function gCe(){return C8||(C8=qS(Yc(6,!1))),C8}var S8;function yCe(){return S8||(S8=qS(Yc(6,!0))),S8}var v8;function bCe(){return v8||(v8=qS(Yc(7,!1))),v8}var xCe=new Map,CCe=b.create(0,1,0),Rp=b(),gF=b(),SCe=b(),Dp=H(),vCe=H(),ICe=b(),Dg=b(),I8=b();function sA(e,t,r,n,o){return b.setMagnitude(gF,r,n/2),b.add(SCe,t,gF),o?b.matchDirection(I8,CCe,gF):b.copy(I8,CCe),b.set(ICe,1,n,1),b.makeRotation(vCe,I8,gF),H.scale(e,vCe,ICe),H.setTranslation(e,SCe)}var Rg=new Int32Array(9);function PJe(e){return Rg[0]=Math.round(1e3*(e.radiusTop??Jf.radiusTop)),Rg[1]=Math.round(1e3*(e.radiusBottom??Jf.radiusBottom)),Rg[2]=Math.round(1e3*(e.height??Jf.height)),Rg[3]=e.radialSegments??Jf.radialSegments,Rg[4]=e.heightSegments??Jf.heightSegments,Rg[5]=e.topCap??Jf.topCap?1:0,Rg[6]=e.bottomCap??Jf.bottomCap?1:0,Rg[7]=Math.round(1e3*(e.thetaStart??Jf.thetaStart)),Rg[8]=Math.round(1e3*(e.thetaLength??Jf.thetaLength)),ui(Rg)}function lA(e){let t=PJe(e),r=xCe.get(t);if(r===void 0){if(e.radialSegments&&e.radialSegments<=4){let n=Math.max(3,e.radialSegments),o=qS(Yc(n,!0,e.radiusTop),e);r=oA(o,H.rotX90)}else r=mCe(e);xCe.set(t,r)}return r}function gR(e,t,r,n){let o=b.distance(t,r);b.sub(Rp,r,t),sA(Dp,t,Rp,o,!1),tt.addPrimitive(e,Dp,lA(n))}function ACe(e,t,r,n){sA(Dp,t.origin,t.direction,r,!1),tt.addPrimitive(e,Dp,lA(n))}function gn(e,t,r,n,o){let i=b.distance(t,r)*n;b.sub(Rp,r,t),sA(Dp,t,Rp,i,!0),tt.addPrimitive(e,Dp,lA(o))}function TCe(e,t,r,n,o,i){let a=b.distance(t,r)*n,s=lA(i);b.sub(Rp,r,t),b.add(Dg,t,o),sA(Dp,Dg,Rp,a,!0),tt.addPrimitive(e,Dp,s),b.sub(Dg,t,o),sA(Dp,Dg,Rp,a,!0),tt.addPrimitive(e,Dp,s)}function wp(e,t,r,n,o,i,a){let s=b.distance(t,r)*n,l=o%2!==0,u=Math.floor((o+1)/2),c=s/(o+.5),m=lA(a);b.setMagnitude(Rp,b.sub(Rp,r,t),c),b.copy(Dg,t);for(let d=0;d<u;++d)b.add(Dg,Dg,Rp),l&&d===u-1&&(!i&&a.topCap&&(a.topCap=!1,m=lA(a)),c/=2),sA(Dp,Dg,Rp,c,!1),tt.addPrimitive(e,Dp,m),b.add(Dg,Dg,Rp)}var Fa=b(),PCe=Mt(),$f=b(),Mp=b(),lb=b(),yF=b(),uc=b.fromArray,_Je=b.triangleNormal,_Ce=b.copy,bF=b.transformMat4,RCe=b.transformMat3,DCe=Mt.directionTransform,cc=qe.add3,xF=qe.add,tt;(m=>{function e(d=2048,p=1024,h){return{currentGroup:-1,vertices:qe.create(Float32Array,3,p,h?h.vertexBuffer.ref.value:d),normals:qe.create(Float32Array,3,p,h?h.normalBuffer.ref.value:d),indices:qe.create(Uint32Array,3,p*3,h?h.indexBuffer.ref.value:d*3),groups:qe.create(Float32Array,1,p,h?h.groupBuffer.ref.value:d),mesh:h}}m.createState=e;function t(d,p,h,f){let{vertices:g,normals:y,indices:x,groups:S,currentGroup:I}=d,v=g.elementCount;cc(g,p[0],p[1],p[2]),cc(g,h[0],h[1],h[2]),cc(g,f[0],f[1],f[2]),_Je(Fa,p,h,f);for(let A=0;A<3;++A)cc(y,Fa[0],Fa[1],Fa[2]),xF(S,I);cc(x,v,v+1,v+2)}m.addTriangle=t;function r(d,p,h,f,g){let{vertices:y,normals:x,indices:S,groups:I,currentGroup:v}=d,A=y.elementCount;cc(y,p[0],p[1],p[2]),cc(y,h[0],h[1],h[2]),cc(y,f[0],f[1],f[2]);for(let P=0;P<3;++P)cc(x,g[0],g[1],g[2]),xF(I,v);cc(S,A,A+1,A+2)}m.addTriangleWithNormal=r;function n(d,p,h){uc(lb,p,h[0]*3),uc(yF,p,h[1]*3);for(let f=2,g=h.length;f<g;f+=2)_Ce($f,lb),_Ce(Mp,yF),uc(lb,p,h[f]*3),uc(yF,p,h[f+1]*3),t(d,$f,Mp,lb),t(d,Mp,yF,lb)}m.addTriangleStrip=n;function o(d,p,h){uc($f,p,h[0]*3);for(let f=2,g=h.length;f<g;++f)uc(Mp,p,h[f-1]*3),uc(lb,p,h[f]*3),t(d,$f,lb,Mp)}m.addTriangleFan=o;function i(d,p,h,f){uc($f,p,h[0]*3);for(let g=2,y=h.length;g<y;++g)uc(Mp,p,h[g-1]*3),uc(lb,p,h[g]*3),r(d,$f,lb,Mp,f)}m.addTriangleFanWithNormal=i;function a(d,p,h){let{vertices:f,normals:g,indices:y}=h,{vertices:x,normals:S,indices:I,groups:v,currentGroup:A}=d,P=x.elementCount,T=DCe(PCe,p);for(let R=0,w=f.length;R<w;R+=3)bF(Fa,uc(Fa,f,R),p),cc(x,Fa[0],Fa[1],Fa[2]),RCe(Fa,uc(Fa,g,R),T),cc(S,Fa[0],Fa[1],Fa[2]),xF(v,A);for(let R=0,w=y.length;R<w;R+=3)cc(I,y[R]+P,y[R+1]+P,y[R+2]+P)}m.addPrimitive=a;function s(d,p,h){let{vertices:f,normals:g,indices:y}=h,{vertices:x,normals:S,indices:I,groups:v,currentGroup:A}=d,P=x.elementCount,T=DCe(PCe,p);for(let R=0,w=f.length;R<w;R+=3)bF(Fa,uc(Fa,f,R),p),cc(x,Fa[0],Fa[1],Fa[2]),RCe(Fa,uc(Fa,g,R),T),cc(S,-Fa[0],-Fa[1],-Fa[2]),xF(v,A);for(let R=0,w=y.length;R<w;R+=3)cc(I,y[R+2]+P,y[R+1]+P,y[R]+P)}m.addPrimitiveFlipped=s;function l(d,p,h,f,g,y){let{vertices:x,edges:S}=h,I={radiusTop:f,radiusBottom:f,radialSegments:y};for(let v=0,A=S.length;v<A;v+=2)uc($f,x,S[v]*3),uc(Mp,x,S[v+1]*3),bF($f,$f,p),bF(Mp,Mp,p),Zr(d,$f,f,g),Zr(d,Mp,f,g),gn(d,$f,Mp,1,I)}m.addCage=l;function u(d,p,h){a(d,p,{vertices:h.vertexBuffer.ref.value.subarray(0,h.vertexCount*3),normals:h.normalBuffer.ref.value.subarray(0,h.vertexCount*3),indices:h.indexBuffer.ref.value.subarray(0,h.triangleCount*3)})}m.addMesh=u;function c(d){let{vertices:p,normals:h,indices:f,groups:g,mesh:y}=d,x=qe.compact(p,!0),S=qe.compact(f,!0),I=qe.compact(h,!0),v=qe.compact(g,!0);return ft.create(x,S,I,v,d.vertices.elementCount,d.indices.elementCount,y)}m.getMesh=c})(tt||={});function ECe(e){let t=e&&e.getElement("vertex"),r=e&&e.getElement("material"),n={group:"",vRed:"",vGreen:"",vBlue:"",mRed:"",mGreen:"",mBlue:""},o=[["",""]],i=[["",""]];if(t){for(let l=0,u=t.propertyNames.length;l<u;++l){let c=t.propertyNames[l],m=t.propertyTypes[l];(m==="uchar"||m==="uint8"||m==="ushort"||m==="uint16"||m==="uint"||m==="uint32"||m==="int")&&o.push([c,c]),(m==="uchar"||m==="uint8")&&i.push([c,c])}t.propertyNames.includes("atomid")?n.group="atomid":t.propertyNames.includes("material_index")&&(n.group="material_index"),t.propertyNames.includes("red")&&(n.vRed="red"),t.propertyNames.includes("green")&&(n.vGreen="green"),t.propertyNames.includes("blue")&&(n.vBlue="blue")}let a=[["",""]];if(r){for(let l=0,u=r.propertyNames.length;l<u;++l){let c=r.propertyNames[l],m=r.propertyTypes[l];(m==="uchar"||m==="uint8")&&a.push([c,c])}r.propertyNames.includes("red")&&(n.mRed="red"),r.propertyNames.includes("green")&&(n.mGreen="green"),r.propertyNames.includes("blue")&&(n.mBlue="blue")}let s=n.vRed&&n.vGreen&&n.vBlue?"vertex":n.mRed&&n.mGreen&&n.mBlue?"material":"uniform";return{...ft.Params,coloring:C.MappedStatic(s,{vertex:C.Group({red:C.Select(n.vRed,i,{label:"Red Property"}),green:C.Select(n.vGreen,i,{label:"Green Property"}),blue:C.Select(n.vBlue,i,{label:"Blue Property"})},{isFlat:!0}),material:C.Group({red:C.Select(n.mRed,a,{label:"Red Property"}),green:C.Select(n.mGreen,a,{label:"Green Property"}),blue:C.Select(n.mBlue,a,{label:"Blue Property"})},{isFlat:!0}),uniform:C.Group({color:C.Color(Lt.grey),saturation:C.Numeric(0,{min:-6,max:6,step:.1}),lightness:C.Numeric(0,{min:-6,max:6,step:.1})},{isFlat:!0})}),grouping:C.MappedStatic(n.group?"vertex":"none",{vertex:C.Group({group:C.Select(n.group,o,{label:"Group Property"})},{isFlat:!0}),none:C.Group({})})}}var wCe=ECe();function RJe(e,t,r,n,o){let{vertices:i,normals:a,groups:s}=r,l=n.getProperty("x"),u=n.getProperty("y"),c=n.getProperty("z");if(!l||!u||!c)throw new Error("missing coordinate properties");let m=n.getProperty("nx"),d=n.getProperty("ny"),p=n.getProperty("nz"),h=!!m&&!!d&&!!p;for(let f=e;f<t;++f)qe.add3(i,l.value(f),u.value(f),c.value(f)),h&&qe.add3(a,m.value(f),d.value(f),p.value(f)),qe.add(s,o[f])}function DJe(e,t,r,n){let{indices:o}=r;for(let i=e;i<t;++i){let{entries:a,count:s}=n.value(i);s===3?qe.add3(o,a[0],a[1],a[2]):s===4&&(qe.add3(o,a[2],a[1],a[0]),qe.add3(o,a[2],a[0],a[3]))}}async function wJe(e,t,r,n,o){let i=tt.createState(t.rowCount,t.rowCount/4,o),a=t.getProperty("x"),s=t.getProperty("y"),l=t.getProperty("z");if(!a||!s||!l)throw new Error("missing coordinate properties");let u=t.getProperty("nx"),c=t.getProperty("ny"),m=t.getProperty("nz"),d=!!u&&!!c&&!!m,p=1e5;for(let f=0,g=t.rowCount;f<g;f+=p)RJe(f,Math.min(f+p,g),i,t,n),e.shouldUpdate&&await e.update({message:"adding ply mesh vertices",current:f,max:g});for(let f=0,g=r.rowCount;f<g;f+=p)DJe(f,Math.min(f+p,g),i,r),e.shouldUpdate&&await e.update({message:"adding ply mesh faces",current:f,max:g});let h=tt.getMesh(i);return d||ft.computeNormals(h),_.updateIfChanged(h.varyingGroup,!0),h}var ub=W.Schema.int;function MJe(e,t){let{grouping:r}=t,{rowCount:n}=e,o=r.name==="vertex"?e.getProperty(r.params.group):void 0,i=r.name==="vertex"?va(r.params.group):"Vertex",a=o?o.toArray({array:Uint32Array}):Xa(new Uint32Array(n)),s=o?xl(a):n-1,l=new Uint32Array(s+1);for(let u=0,c=a.length;u<c;++u)l[a[u]]=u;return{ids:a,map:l,label:i}}function MCe(e,t,r){let{coloring:n}=r,{rowCount:o}=e,i,a,s;if(n.name==="vertex")i=e.getProperty(n.params.red)||W.ofConst(127,o,ub),a=e.getProperty(n.params.green)||W.ofConst(127,o,ub),s=e.getProperty(n.params.blue)||W.ofConst(127,o,ub);else if(n.name==="material")i=t&&t.getProperty(n.params.red)||W.ofConst(127,o,ub),a=t&&t.getProperty(n.params.green)||W.ofConst(127,o,ub),s=t&&t.getProperty(n.params.blue)||W.ofConst(127,o,ub);else{let l=n.params.color;l=Le.saturate(l,n.params.saturation),l=Le.lighten(l,n.params.lightness);let[u,c,m]=Le.toRgb(l);i=W.ofConst(u,o,ub),a=W.ofConst(c,o,ub),s=W.ofConst(m,o,ub)}return{kind:n.name,red:i,green:a,blue:s}}function BCe(e,t,r,n){let{kind:o,red:i,green:a,blue:s}=r,{ids:l,map:u,label:c}=n,{source:m,transforms:d}=e;return Wr.create("ply-mesh",m,t,p=>{let h=o==="material"?p:u[p];return Le.fromRgb(i.value(h),a.value(h),s.value(h))},()=>1,p=>`${c} ${l[p]}`,d)}function BJe(){let e,t,r,n,o,i;return async(s,l,u,c)=>{let m=l.source.getElement("vertex");if(!m)throw new Error("missing vertex element");let d=l.source.getElement("face");if(!d)throw new Error("missing face element");let p=l.source.getElement("material"),h=!1,f=!1;return(!e||e!==l)&&(h=!0),(!t||!C.isParamEqual(wCe.grouping,t.grouping,u.grouping))&&(h=!0),(!t||!C.isParamEqual(wCe.coloring,t.coloring,u.coloring))&&(f=!0),h?(o=MCe(m,p,u),i=MJe(m,u),n=await wJe(s,m,d,i.ids,c&&c.geometry),r=BCe(l,n,o,i)):f&&(o=MCe(m,p,u),r=BCe(l,n,o,i)),e=l,t=Wo(u),r}}function kCe(e,t){return Ae.create("Shape Provider",async r=>({label:"Mesh",data:{source:e,transforms:t?.transforms},params:ECe(e),getShape:BJe(),geometryUtils:ft.Utils}))}function Rd(){return Rd.empty()}(n=>{function e(o,i){return{size:o,anglesInRadians:i}}n.create=e;function t(){return e(b(),b())}n.empty=t;function r(o,i,a){let s=b.magnitude(o),l=b.magnitude(i),u=b.magnitude(a),c=Math.acos(b.dot(i,a)/(l*u)),m=Math.acos(b.dot(o,a)/(s*u)),d=Math.acos(b.dot(o,i)/(s*l));return s<=0||l<=0||u<=0||c>=Math.PI||m>=Math.PI||d>=Math.PI?t():e(b.create(s,l,u),b.create(c,m,d))}n.fromBasis=r})(Rd||={});var EJe=20.45482949774598;function FCe(e){return Ae.create("Parse DCD",async t=>{await t.update("Converting to coordinates");let{header:r}=e,n=r.DELTA?bs(r.DELTA*EJe,"ps"):bs(1,"step"),o=r.ISTART>=1?bs((r.ISTART-1)*n.value,n.unit):bs(0,n.unit),i=[];for(let a=0,s=e.frames.length;a<s;++a){let l=e.frames[a],u={elementCount:l.elementCount,time:bs(o.value+n.value*a,n.unit),x:l.x,y:l.y,z:l.z,xyzOrdering:{isIdentity:!0}};if(l.cell){let c=l.cell;c[1]>=-1&&c[1]<=1&&c[3]>=-1&&c[3]<=1&&c[4]>=-1&&c[4]<=1?u.cell=Rd.create(b.create(c[0],c[2],c[5]),b.create(kr(90-Math.asin(c[1])*90/X0),kr(90-Math.asin(c[3])*90/X0),kr(90-Math.asin(c[4])*90/X0))):c[0]<0||c[1]<0||c[2]<0||c[3]<0||c[4]<0||c[5]<0||c[3]>180||c[4]>180||c[5]>180?u.cell=Rd.fromBasis(b.create(c[0],c[1],c[3]),b.create(c[1],c[2],c[4]),b.create(c[3],c[4],c[5])):u.cell=Rd.create(b.create(c[0],c[2],c[5]),b.create(kr(mo(c[1],0,1e-6)?90:c[1]),kr(mo(c[3],0,1e-6)?90:c[3]),kr(mo(c[4],0,1e-6)?90:c[4])))}i.push(u)}return vd.create(i,n,o)})}function uA(e,t,r,n){let o=r,i=n-1,a=t.charCodeAt(o);for(;(a===32||a>=48&&a<=57)&&o<=i;)a=t.charCodeAt(++o);for(a=t.charCodeAt(i);(a===32||a>=48&&a<=57)&&i>=o;)a=t.charCodeAt(--i);if(++i,o===i)return We.add(e,o,i);if(o+1===i)return We.add(e,o,i);if(a=t.charCodeAt(o),o+2===i){let s=t.charCodeAt(o+1);if((a===78||a===110)&&(s===65||s===97)||(a===67||a===99)&&(s===76||s===108)||(a===70||a===102)&&(s===69||s===101)||(a===83||a===115)&&(s===73||s===105)||(a===66||a===98)&&(s===82||s===114)||(a===65||a===97)&&(s===83||s===115))return We.add(e,o,o+2)}if(a===67||a===99||a===72||a===104||a===78||a===110||a===79||a===111||a===80||a===112||a===83||a===115)return We.add(e,o,o+1);We.add(e,o,o)}var kJe=new Set(["NA","CL","FE","SI","BR","AS","LI"]),FJe=new Set(["C","H","N","O","P","S","F","B"]),LJe=/^[\s\d]+|[\s\d]+$/g;function Bp(e,t){e=e.replace(LJe,"").toUpperCase();let r=e.length;if(r===0||r===1||kJe.has(e))return e;if(r===3&&t===e){if(e==="SOD")return"NA";if(e==="POT")return"K";if(e==="CES")return"CS";if(e==="CAL")return"CA";if(e==="CLA")return"CL"}return FJe.has(e[0])?e[0]:""}var A8="ABCDEFGHIJKLMNOPQRSTUVWXYZ";function VJe(e){let t=A8.length,r=e,n=0,o=A8[r%t];for(;r>=t;)r=Math.floor(r/t),o+=A8[r%t],n+=1;return n>=5&&console.warn("getChainId overflow"),o}var eh=zf(VJe);function OJe(e,t){let r=e.atomName,n=e.residueName,o=new Array(e.count),i=new Array(e.count),a=new Uint32Array(e.count),s=new Uint32Array(e.count),l=new Array(e.count),u=new Ui,c=new Ni(e.residueNumber,e.atomName),m="",d=0,p="",h=0,f=0,g=-1;for(let S=0,I=e.count;S<I;++S){let v=e.residueNumber.value(S);if(v!==g){let A=e.residueName.value(S),P=Ql(c.add(A,S).type,A);(P!==f||v!==g+1&&!(g===99999&&v===0))&&(p=eh(d),d+=1,h=0),m=u.getEntityId(A,P,p),h+=1,g=v,f=P}o[S]=m,i[S]=p,a[S]=h,s[S]=S,l[S]=Bp(e.atomName.value(S),e.residueName.value(S))}let y=W.ofStringArray(i),x=wr.ofPartialColumns(Lo.atom_site,{auth_asym_id:y,auth_atom_id:r,auth_comp_id:n,auth_seq_id:e.residueNumber,Cartn_x:W.ofFloatArray(W.mapToArray(e.x,S=>S*10,Float32Array)),Cartn_y:W.ofFloatArray(W.mapToArray(e.y,S=>S*10,Float32Array)),Cartn_z:W.ofFloatArray(W.mapToArray(e.z,S=>S*10,Float32Array)),id:W.ofIntArray(s),label_asym_id:y,label_atom_id:r,label_comp_id:n,label_seq_id:W.ofIntArray(a),label_entity_id:W.ofStringArray(o),occupancy:W.ofConst(1,e.count,W.Schema.float),type_symbol:W.ofStringArray(l),pdbx_PDB_model_num:W.ofConst(t,e.count,W.Schema.int)},e.count);return ra({entity:u.getEntityTable(),chem_comp:c.getChemCompTable(),atom_site:x})}var LCe;(r=>{function e(n){return n?.kind==="gro"}r.is=e;function t(n){return{kind:"gro",name:n.structures[0].header.title,data:n}}r.fromGro=t})(LCe||={});function VCe(e){return Ae.create("Parse GRO",async t=>{let r=LCe.fromGro(e),n=[];for(let o=0,i=e.structures.length;o<i;++o){let a=OJe(e.structures[o].atoms,o+1),s=await rs(a,r,t);s.frameCount===1&&n.push(s.representative)}return new Rl(n)})}function GCe(e,t){let r=(i,a)=>(t.substr(i,a)||"").trim(),n={entry_id:Tt.ofString(e),length_a:Tt.ofString(r(6,9)),length_b:Tt.ofString(r(15,9)),length_c:Tt.ofString(r(24,9)),angle_alpha:Tt.ofString(r(33,7)),angle_beta:Tt.ofString(r(40,7)),angle_gamma:Tt.ofString(r(47,7)),Z_PDB:Tt.ofString(r(66,4)),pdbx_unique_axis:Tt.ofString("?")},o={entry_id:Tt.ofString(e),"space_group_name_H-M":Tt.ofString(r(55,11)),Int_Tables_number:Tt.ofString("?"),cell_setting:Tt.ofString("?"),space_group_name_Hall:Tt.ofString("?")};return[fa.ofFields("cell",n),fa.ofFields("symmetry",o)]}function OCe(e,t){return{id:e,details:t,groups:[]}}function UCe(e,t,r){let n=[],o,i,a,s=1,l=1,u=f=>e.data.substring(e.indices[2*f],e.indices[2*f+1]);for(let f=t;f<r;f++){let g=u(f);if(g.substr(11,12)==="BIOMOLECULE:"){let y=g.substr(23).trim(),x=`Biomolecule ${y}`;g=u(f+1),g.substr(11,30)!=="APPLY THE FOLLOWING TO CHAINS:"&&(f++,x=g.substr(11).trim()),o=OCe(y,x),n.push(o)}else if(g.substr(13,5)==="BIOMT"){let y=g.split(/\s+/),x=parseInt(g[18])-1;x===0&&(a=H.identity(),i.operators.push({id:s++,matrix:a})),H.setValue(a,x,0,parseFloat(y[4])),H.setValue(a,x,1,parseFloat(y[5])),H.setValue(a,x,2,parseFloat(y[6])),H.setValue(a,x,3,parseFloat(y[7]))}else if(g.substr(11,30)==="APPLY THE FOLLOWING TO CHAINS:"||g.substr(11,30)==="                   AND CHAINS:"){g.substr(11,5)==="APPLY"&&(i={chains:[],operators:[]},o.groups.push(i));let y=g.substr(41,30).split(",");for(let x=0,S=y.length;x<S;++x){let I=y[x].trim();I&&i.chains.push(I)}}else if(g.substr(11,33)==="APPLYING THE FOLLOWING TO CHAINS:"){o=OCe(`${l}`,`Biomolecule ${l}`),n.push(o),l+=1,i={chains:[],operators:[]},o.groups.push(i),f++,g=u(f);let y=g.substr(11,69).split(",");for(let x=0,S=y.length;x<S;++x){let I=y[x].trim();I&&i.chains.push(I)}}}if(n.length===0)return[];let c={id:Tt.ofStrings(n.map(f=>f.id)),details:Tt.ofStrings(n.map(f=>f.details))},m=[];for(let f of n)for(let g of f.groups)m.push({assembly_id:f.id,oper_expression:g.operators.map(y=>y.id).join(","),asym_id_list:g.chains.join(",")});let d={assembly_id:Tt.ofStrings(m.map(f=>f.assembly_id)),oper_expression:Tt.ofStrings(m.map(f=>f.oper_expression)),asym_id_list:Tt.ofStrings(m.map(f=>f.asym_id_list))},p=[];for(let f of n)for(let g of f.groups)for(let y of g.operators){let x={id:""+y.id,type:"?",name:"?",symmetry_operation:"?"};for(let S=0;S<3;S++){for(let I=0;I<3;I++)x[`matrix[${S+1}][${I+1}]`]=""+H.getValue(y.matrix,S,I);x[`vector[${S+1}]`]=""+H.getValue(y.matrix,S,3)}p.push(x)}let h={id:Tt.ofStrings(p.map(f=>f.id)),type:Tt.ofStrings(p.map(f=>f.type)),name:Tt.ofStrings(p.map(f=>f.name)),symmetry_operation:Tt.ofStrings(p.map(f=>f.symmetry_operation))};for(let f=0;f<3;f++){for(let y=0;y<3;y++){let x=`matrix[${f+1}][${y+1}]`;h[x]=Tt.ofStrings(p.map(S=>S[x]))}let g=`vector[${f+1}]`;h[g]=Tt.ofStrings(p.map(y=>y[g]))}return[fa.ofFields("pdbx_struct_assembly",c),fa.ofFields("pdbx_struct_assembly_gen",d),fa.ofFields("pdbx_struct_oper_list",h)]}function NCe(e,t,r){let n=[],o,i=u=>e.data.substring(e.indices[2*u],e.indices[2*u+1]);for(let u=t;u<r;u++){let c=i(u),m=c.split(/\s+/),d=parseInt(c[5])-1;d===0&&(o=H.identity(),n.push(o)),H.setValue(o,d,0,parseFloat(m[2])),H.setValue(o,d,1,parseFloat(m[3])),H.setValue(o,d,2,parseFloat(m[4])),H.setValue(o,d,3,parseFloat(m[5]))}if(n.length===0)return[];let a=[],s=1;for(let u of n){let c={id:"ncsop"+s++,code:".",details:"."};for(let m=0;m<3;m++){for(let d=0;d<3;d++)c[`matrix[${m+1}][${d+1}]`]=""+H.getValue(u,m,d);c[`vector[${m+1}]`]=""+H.getValue(u,m,3)}a.push(c)}let l={id:Tt.ofStrings(a.map(u=>u.id)),code:Tt.ofStrings(a.map(u=>u.code)),details:Tt.ofStrings(a.map(u=>u.details))};for(let u=0;u<3;u++){for(let m=0;m<3;m++){let d=`matrix[${u+1}][${m+1}]`;l[d]=Tt.ofStrings(a.map(p=>p[d]))}let c=`vector[${u+1}]`;l[c]=Tt.ofStrings(a.map(m=>m[c]))}return[fa.ofFields("struct_ncs_oper",l)]}var GJe={1:"helx_rh_al_p",2:"helx_rh_om_p",3:"helx_rh_pi_p",4:"helx_rh_ga_p",5:"helx_rh_3t_p",6:"helx_lh_al_p",7:"helx_lh_om_p",8:"helx_lh_ga_p",9:"helx_rh_27_p",10:"helx_rh_pp_p"};function UJe(e){return GJe[e]||"helx_p"}function zCe(e,t,r){let n=[],o=c=>e.data.substring(e.indices[2*c],e.indices[2*c+1]);for(let c=t;c<r;c++){let m=o(c);n.push({serNum:m.substring(7,10).trim(),helixID:m.substring(11,14).trim(),initResName:m.substring(15,19).trim(),initChainID:m.substring(19,20).trim(),initSeqNum:m.substring(21,25).trim(),initICode:m.substring(25,26).trim(),endResName:m.substring(27,31).trim(),endChainID:m.substring(31,34).trim(),endSeqNum:m.substring(33,37).trim(),endICode:m.substring(37,38).trim(),helixClass:m.substring(38,40).trim(),comment:m.substring(40,70).trim(),length:m.substring(71,76).trim()})}let i=Tt.ofStrings(n.map(c=>c.initChainID)),a=Tt.ofStrings(n.map(c=>c.initResName)),s=Tt.ofStrings(n.map(c=>c.endChainID)),l=Tt.ofStrings(n.map(c=>c.endResName)),u={beg_label_asym_id:i,beg_label_comp_id:a,beg_label_seq_id:Tt.ofUndefined(n.length,W.Schema.int),beg_auth_asym_id:i,beg_auth_comp_id:a,beg_auth_seq_id:Tt.ofStrings(n.map(c=>c.initSeqNum)),conf_type_id:Tt.ofStrings(n.map(c=>UJe(c.helixClass))),details:Tt.ofStrings(n.map(c=>c.comment)),end_label_asym_id:s,end_label_comp_id:l,end_label_seq_id:Tt.ofUndefined(n.length,W.Schema.int),end_auth_asym_id:s,end_auth_comp_id:l,end_auth_seq_id:Tt.ofStrings(n.map(c=>c.endSeqNum)),id:Tt.ofStrings(n.map(c=>c.serNum)),pdbx_beg_PDB_ins_code:Tt.ofStrings(n.map(c=>c.initICode)),pdbx_end_PDB_ins_code:Tt.ofStrings(n.map(c=>c.endICode)),pdbx_PDB_helix_class:Tt.ofStrings(n.map(c=>c.helixClass)),pdbx_PDB_helix_length:Tt.ofStrings(n.map(c=>c.length)),pdbx_PDB_helix_id:Tt.ofStrings(n.map(c=>c.helixID))};return fa.ofFields("struct_conf",u)}function HCe(e,t,r){let n=[],o=d=>e.data.substring(e.indices[2*d],e.indices[2*d+1]);for(let d=t;d<r;d++){let p=o(d);n.push({strand:p.substring(7,10).trim(),sheetID:p.substring(11,14).trim(),numStrands:p.substring(14,16).trim(),initResName:p.substring(17,21).trim(),initChainID:p.substring(21,22).trim(),initSeqNum:p.substring(22,26).trim(),initICode:p.substring(26,27).trim(),endResName:p.substring(28,32).trim(),endChainID:p.substring(32,33).trim(),endSeqNum:p.substring(33,37).trim(),endICode:p.substring(37,38).trim(),sense:p.substring(38,40).trim(),curAtom:p.substring(41,45).trim(),curResName:p.substring(45,49).trim(),curChainId:p.substring(49,50).trim(),curResSeq:p.substring(50,54).trim(),curICode:p.substring(54,55).trim(),prevAtom:p.substring(56,60).trim(),prevResName:p.substring(60,64).trim(),prevChainId:p.substring(64,65).trim(),prevResSeq:p.substring(65,69).trim(),prevICode:p.substring(69,70).trim()})}let i=Tt.ofStrings(n.map(d=>d.initChainID)),a=Tt.ofStrings(n.map(d=>d.initResName)),s=Tt.ofStrings(n.map(d=>d.initSeqNum)),l=Tt.ofStrings(n.map(d=>d.endChainID)),u=Tt.ofStrings(n.map(d=>d.endResName)),c=Tt.ofStrings(n.map(d=>d.endSeqNum)),m={beg_label_asym_id:i,beg_label_comp_id:a,beg_label_seq_id:s,beg_auth_asym_id:i,beg_auth_comp_id:a,beg_auth_seq_id:s,end_label_asym_id:l,end_label_comp_id:l,end_label_seq_id:c,end_auth_asym_id:l,end_auth_comp_id:u,end_auth_seq_id:c,id:Tt.ofStrings(n.map(d=>d.strand)),sheet_id:Tt.ofStrings(n.map(d=>d.sheetID)),pdbx_beg_PDB_ins_code:Tt.ofStrings(n.map(d=>d.initICode)),pdbx_end_PDB_ins_code:Tt.ofStrings(n.map(d=>d.endICode))};return fa.ofFields("struct_sheet_range",m)}var NJe={MOL_ID:"",MOLECULE:"",CHAIN:"",FRAGMENT:"",SYNONYM:"",EC:"",ENGINEERED:"",MUTATION:"",OTHER_DETAILS:""};function jCe(e,t,r){let n=l=>e.data.substring(e.indices[2*l],e.indices[2*l+1]),o,i={chains:[],description:""},a=[];for(let l=t;l<r;l++){let c=n(l).substr(10,70).trim(),m=c.indexOf(":"),d=c.substring(0,m),p;d in NJe?(o=d,p=c.substring(m+2)):p=c,p=p.replace(/;$/,""),o==="MOL_ID"?(i={chains:[],description:""},a.push(i)):o==="MOLECULE"?(i.description&&(i.description+=" "),i.description+=p):o==="CHAIN"&&Array.prototype.push.apply(i.chains,p.split(/\s*,\s*/))}let s=[];for(let l of a)for(let u of l.chains)s.push({description:l.description,chains:[u]});return s}function WCe(e,t,r){let n=i=>e.data.substring(e.indices[2*i],e.indices[2*i+1]),o=new Map;for(let i=t;i<r;i++){let a=n(i),s=a.substr(11,3).trim(),l=a.substr(15).trim();o.has(s)?o.set(s,`${o.get(s)} ${l}`):o.set(s,l)}return o}function XCe(e,t){let r=()=>[],n=()=>We.create(e,2*t);return{index:0,group_PDB:n(),id:r(),auth_atom_id:n(),label_alt_id:n(),auth_comp_id:n(),auth_asym_id:n(),auth_seq_id:n(),pdbx_PDB_ins_code:n(),Cartn_x:n(),Cartn_y:n(),Cartn_z:n(),occupancy:n(),B_iso_or_equiv:n(),type_symbol:n(),pdbx_PDB_model_num:r(),label_entity_id:r(),partial_charge:n()}}var CF=class{constructor(t,r,n,o){this.asymIds=t;this.modelNums=r;this.terIndices=n;this.hasAssemblies=o;this.asymIdCounts=new Map;this.currModelNum=void 0;this.currAsymId="";this.currLabelAsymId=""}clear(){this.asymIdCounts.clear(),this.currModelNum=void 0}get(t){let r=this.asymIds.value(t);if(this.hasAssemblies)return r;let n=this.modelNums[t];if(n!==this.currModelNum?(this.asymIdCounts.clear(),this.currModelNum=n,this.currLabelAsymId=r):this.currAsymId!==r&&(this.currAsymId=r,this.currLabelAsymId=r),this.asymIdCounts.has(r)){if(this.terIndices.has(t)){let o=this.asymIdCounts.get(r)+1;this.asymIdCounts.set(r,o),this.currLabelAsymId=`${r}_${o}`}}else this.asymIdCounts.set(r,0);return this.currLabelAsymId}};function QCe(e,t,r){t.clear();let n=Tt.ofStrings(e.pdbx_PDB_model_num),o=Tt.ofTokens(e.auth_asym_id),i=Tt.ofTokens(e.auth_seq_id),a=Tt.ofTokens(e.pdbx_PDB_ins_code),s=Tt.ofTokens(e.auth_atom_id),l=Tt.ofTokens(e.auth_comp_id),u=Tt.ofStrings(e.id),c=n.str(0),m=o.str(0),d=i.int(0),p=a.str(0),h=d,f=new Map,g=new Map,y=[],x=[],S=[],I=!1;for(let T=0,R=u.rowCount;T<R;++T)if(a.str(T)!==""){I=!0;break}for(let T=0,R=u.rowCount;T<R;++T){let w=n.str(T),E=o.str(T),M=i.int(T),D=a.str(T),B=s.str(T);if(w!==c?(f.clear(),g.clear(),c=w,m=E,d=M,p=D,h=M):m!==E?(g.clear(),m=E,d=M,p=D,h=M):d!==M?(g.clear(),d===h?h=M:h+=1,d=M,p=D):p!==D&&(g.clear(),p=D,h+=1),y[T]=t.get(T),g.has(B)){let k=g.get(B)+1;g.set(B,k),B=`${B}_${k}`}else g.set(B,0);x[T]=B,I&&(S[T]=h)}let v=W.ofStringArray(y),A=W.ofStringArray(x),P=I?Tt.ofColumn(W.ofIntArray(S)):Tt.ofUndefined(e.index,W.Schema.int);return{auth_asym_id:o,auth_atom_id:s,auth_comp_id:l,auth_seq_id:i,B_iso_or_equiv:Tt.ofTokens(e.B_iso_or_equiv),Cartn_x:Tt.ofTokens(e.Cartn_x),Cartn_y:Tt.ofTokens(e.Cartn_y),Cartn_z:Tt.ofTokens(e.Cartn_z),group_PDB:Tt.ofTokens(e.group_PDB),id:u,label_alt_id:Tt.ofTokens(e.label_alt_id),label_asym_id:Tt.ofColumn(v),label_atom_id:Tt.ofColumn(A),label_comp_id:l,label_seq_id:P,label_entity_id:Tt.ofStrings(e.label_entity_id),occupancy:Dce(e.occupancy)?Tt.ofUndefined(e.index,W.Schema.float):Tt.ofTokens(e.occupancy),type_symbol:Tt.ofTokens(e.type_symbol),pdbx_PDB_ins_code:Tt.ofTokens(e.pdbx_PDB_ins_code),pdbx_PDB_model_num:n,partial_charge:Tt.ofTokens(e.partial_charge)}}function T8(e,t,r,n,o,i){let{data:a}=r,s=o-n;We.addToken(e.group_PDB,St.trim(r,n,n+6)),St.trim(r,n+6,n+11),e.id[e.index]=r.data.substring(r.tokenStart,r.tokenEnd),We.addToken(e.auth_atom_id,St.trim(r,n+12,n+16)),a.charCodeAt(n+16)===32?We.add(e.label_alt_id,0,0):We.add(e.label_alt_id,n+16,n+17),We.addToken(e.auth_comp_id,St.trim(r,n+17,n+21)),We.add(e.auth_asym_id,n+21,n+22),We.addToken(e.auth_seq_id,St.trim(r,n+22,n+26)),a.charCodeAt(n+26)===32?We.add(e.pdbx_PDB_ins_code,0,0):We.add(e.pdbx_PDB_ins_code,n+26,n+27),We.addToken(e.Cartn_x,St.trim(r,n+30,n+38)),We.addToken(e.Cartn_y,St.trim(r,n+38,n+46)),We.addToken(e.Cartn_z,St.trim(r,n+46,n+54)),We.addToken(e.occupancy,St.trim(r,n+54,n+60)),s>=66?We.addToken(e.B_iso_or_equiv,St.trim(r,n+60,n+66)):We.add(e.B_iso_or_equiv,0,0),i&&We.addToken(e.partial_charge,St.trim(r,n+70,n+76)),s>=78&&!i?(St.trim(r,n+76,n+78),r.tokenStart<r.tokenEnd?We.addToken(e.type_symbol,r):uA(e.type_symbol,a,n+12,n+16)):uA(e.type_symbol,a,n+12,n+16),e.pdbx_PDB_model_num[e.index]=t,e.index++}function ZCe(e,t){let r=()=>[],n=()=>new Float32Array(t),o=()=>We.create(e,2*t);return{index:0,count:t,id:r(),type_symbol:o(),pdbx_label_atom_id:o(),pdbx_label_alt_id:o(),pdbx_label_comp_id:o(),pdbx_label_asym_id:o(),pdbx_label_seq_id:o(),pdbx_PDB_ins_code:o(),"U[1][1]":n(),"U[2][2]":n(),"U[3][3]":n(),"U[1][2]":n(),"U[1][3]":n(),"U[2][3]":n(),pdbx_auth_seq_id:o(),pdbx_auth_comp_id:o(),pdbx_auth_asym_id:o(),pdbx_auth_atom_id:o()}}function qCe(e){let t=Tt.ofTokens(e.pdbx_auth_seq_id),r=Tt.ofTokens(e.pdbx_auth_comp_id),n=Tt.ofTokens(e.pdbx_auth_asym_id),o=Tt.ofTokens(e.pdbx_auth_atom_id),i={id:Tt.ofStrings(e.id),type_symbol:Tt.ofTokens(e.type_symbol),pdbx_label_atom_id:o,pdbx_label_alt_id:Tt.ofTokens(e.pdbx_label_alt_id),pdbx_label_comp_id:r,pdbx_label_asym_id:n,pdbx_label_seq_id:t,pdbx_PDB_ins_code:Tt.ofTokens(e.pdbx_PDB_ins_code),pdbx_auth_seq_id:t,pdbx_auth_comp_id:r,pdbx_auth_asym_id:n,pdbx_auth_atom_id:o};return i["U[1][1]"]=Tt.ofNumbers(e["U[1][1]"]),i["U[2][2]"]=Tt.ofNumbers(e["U[2][2]"]),i["U[3][3]"]=Tt.ofNumbers(e["U[3][3]"]),i["U[1][2]"]=Tt.ofNumbers(e["U[1][2]"]),i["U[1][3]"]=Tt.ofNumbers(e["U[1][3]"]),i["U[2][3]"]=Tt.ofNumbers(e["U[2][3]"]),i}function YCe(e,t,r,n,o){let{data:i}=r,a=o-n;St.trim(r,n+6,n+11),e.id[e.index]=i.substring(r.tokenStart,r.tokenEnd),We.addToken(e.pdbx_auth_atom_id,St.trim(r,n+12,n+16)),i.charCodeAt(n+16)===32?We.add(e.pdbx_label_alt_id,0,0):We.add(e.pdbx_label_alt_id,n+16,n+17),We.addToken(e.pdbx_auth_comp_id,St.trim(r,n+17,n+21)),We.add(e.pdbx_auth_asym_id,n+21,n+22),We.addToken(e.pdbx_auth_seq_id,St.trim(r,n+22,n+26)),i.charCodeAt(n+26)===32?We.add(e.pdbx_PDB_ins_code,0,0):We.add(e.pdbx_PDB_ins_code,n+26,n+27),e["U[1][1]"][e.index]=Wy(i,n+28,n+35)/1e4,e["U[2][2]"][e.index]=Wy(i,n+35,n+42)/1e4,e["U[3][3]"][e.index]=Wy(i,n+42,n+49)/1e4,e["U[1][2]"][e.index]=Wy(i,n+49,n+56)/1e4,e["U[1][3]"][e.index]=Wy(i,n+56,n+63)/1e4,e["U[2][3]"][e.index]=Wy(i,n+63,n+70)/1e4,a>=78?(St.trim(r,n+76,n+78),r.tokenStart<r.tokenEnd?We.addToken(e.type_symbol,r):uA(e.type_symbol,i,n+12,n+16)):uA(e.type_symbol,i,n+12,n+16),e.index++}function KCe(e,t,r,n){let o={};for(let E=0,M=n.id.rowCount;E<M;++E)o[n.id.str(E)]=E;let i=E=>e.data.substring(e.indices[2*E],e.indices[2*E+1]),a=[],s=[],l=[],u=[],c=[],m=[],d=[],p=[],h=[],f=[],g=[],y=[],x=[],S=[],I=[],v=[11,16,21,26],A=1,P=-1,T={},R=!1;for(let E=t;E<r;E++){let M=i(E),D=o[parseInt(M.substr(6,5))];if(D!==void 0){P!==D&&(P=D,T={});for(let B=0;B<4;++B){let k=parseInt(M.substr(v[B],5));if(Number.isNaN(k))continue;let F=o[k];if(F!==void 0&&!(D>F)){if(T[F]!==void 0){l[T[F]]+=1,R=!0;continue}T[F]=A-1,a.push(`covale${A}`),s.push("covale"),l.push(1),u.push(n.label_asym_id.str(D)),c.push(n.label_seq_id.int(D)),m.push(n.auth_seq_id.int(D)),d.push(n.label_atom_id.str(D)),p.push(n.label_alt_id.str(D)),h.push(n.pdbx_PDB_ins_code.str(D)),f.push(n.label_asym_id.str(F)),g.push(n.label_seq_id.int(F)),y.push(n.auth_seq_id.int(F)),x.push(n.label_atom_id.str(F)),S.push(n.label_alt_id.str(F)),I.push(n.pdbx_PDB_ins_code.str(F)),A+=1}}}}let w={id:Tt.ofStrings(a),conn_type_id:Tt.ofStrings(s),ptnr1_label_asym_id:Tt.ofStrings(u),ptnr1_label_seq_id:Tt.ofNumbers(c),ptnr1_auth_seq_id:Tt.ofNumbers(m),ptnr1_label_atom_id:Tt.ofStrings(d),pdbx_ptnr1_label_alt_id:Tt.ofStrings(p),pdbx_ptnr1_PDB_ins_code:Tt.ofStrings(h),ptnr2_label_asym_id:Tt.ofStrings(f),ptnr2_label_seq_id:Tt.ofNumbers(g),ptnr2_auth_seq_id:Tt.ofNumbers(y),ptnr2_label_atom_id:Tt.ofStrings(x),pdbx_ptnr2_label_alt_id:Tt.ofStrings(S),pdbx_ptnr2_PDB_ins_code:Tt.ofStrings(I)};if(R){let E=["sing","doub","trpl","quad"];w.pdbx_value_order=Tt.ofStrings(l.map(M=>E[M-1]||"sing"))}return fa.ofFields("struct_conn",w)}function JCe(e,t,r,n){let o=e.substring(t,r);n.id_code=o.substring(62,66).trim()||void 0,n.dep_date=o.substring(50,59).trim()||void 0,n.classification=o.substring(10,50).trim()||void 0}function La(e,t,r,n){let o=n.length;if(o>r-t)return!1;for(let i=0;i<o;i++)if(e.charCodeAt(t+i)!==n.charCodeAt(i))return!1;return!0}async function $Ce(e){let{lines:t}=e,{data:r,indices:n}=t,o=St(r),i=!!e.isPdbqt,a=0,s=0;for(let E=0,M=t.count;E<M;E++){let D=n[2*E],B=n[2*E+1];switch(r.charAt(D)){case"A":La(r,D,B,"ATOM  ")?a++:La(r,D,B,"ANISOU")&&s++;break;case"H":La(r,D,B,"HETATM")&&a++;break}}let l={},u=XCe(r,a),c=ZCe(r,s),m=new Ui,d=[],p=[],h=0,f="",g,y=!1,x=new Set;for(let E=0,M=t.count;E<M;E++){let D=n[2*E],B=n[2*E+1];switch(r.charAt(D)){case"A":La(r,D,B,"ATOM  ")?(h||(h++,f=""+h),T8(u,f,o,D,B,i)):La(r,D,B,"ANISOU")&&YCe(c,f,o,D,B);break;case"C":if(La(r,D,B,"CRYST1"))d.push(...GCe(e.id||"?",r.substring(D,B)));else if(La(r,D,B,"CONECT")){let k=E+1;for(;D=n[2*k],B=n[2*k+1],!!La(r,D,B,"CONECT");)k++;g?Yt&&console.log("only single CONECT block allowed, ignoring others"):g=[E,k],E=k-1}else if(La(r,D,B,"COMPND")){let k=E+1;for(;D=n[2*k],B=n[2*k+1],!!La(r,D,B,"COMPND");)k++;m.setCompounds(jCe(t,E,k)),E=k-1}break;case"H":if(La(r,D,B,"HEADER"))JCe(r,D,B,l);else if(La(r,D,B,"HETATM"))h||(h++,f=""+h),T8(u,f,o,D,B,i);else if(La(r,D,B,"HELIX")){let k=E+1;for(;D=n[2*k],B=n[2*k+1],!!La(r,D,B,"HELIX");)k++;d.push(zCe(t,E,k)),E=k-1}else if(La(r,D,B,"HETNAM")){let k=E+1;for(;D=n[2*k],B=n[2*k+1],!!La(r,D,B,"HETNAM");)k++;p.push(...Array.from(WCe(t,E,k).entries())),E=k-1}break;case"M":if(La(r,D,B,"MODEL ")&&(h++,f=""+h),La(r,D,B,"MTRIX")){let k=E+1;for(;D=n[2*k],B=n[2*k+1],!!La(r,D,B,"MTRIX");)k++;d.push(...NCe(t,E,k)),E=k-1}break;case"O":break;case"R":if(La(r,D,B,"REMARK 350")){let k=E+1;for(;D=n[2*k],B=n[2*k+1],!!La(r,D,B,"REMARK 350");)k++;d.push(...UCe(t,E,k)),E=k-1,y=!0}break;case"S":if(La(r,D,B,"SHEET")){let k=E+1;for(;D=n[2*k],B=n[2*k+1],!!La(r,D,B,"SHEET");)k++;d.push(HCe(t,E,k)),E=k-1}break;case"T":La(r,D,B,"TER")&&x.add(u.index)}}if(l.id_code){let E={id:Tt.ofString(l.id_code)};d.push(fa.ofFields("entry",E))}if(l.classification){let E={pdbx_keywords:Tt.ofString(l.classification)};d.push(fa.ofFields("struct_keywords",E))}if(l.dep_date){let E={recvd_initial_deposition_date:Tt.ofString(l.dep_date)};d.push(fa.ofFields("pdbx_database_status",E))}let S=W.ofIntTokens(u.auth_seq_id),I=W.ofStringTokens(u.auth_atom_id),v=W.ofStringTokens(u.auth_comp_id),A=W.ofStringTokens(u.auth_asym_id),P=new CF(A,u.pdbx_PDB_model_num,x,y),T=new Ni(S,I);T.setNames(p),m.setNames(p);for(let E=0,M=v.rowCount;E<M;++E){let D=v.value(E),B=Ql(T.add(D,E).type,D),k=P.get(E);u.label_entity_id[E]=m.getEntityId(D,B,k)}let R=QCe(u,P,{hasAssemblies:y});i||delete R.partial_charge,g&&d.push(KCe(t,g[0],g[1],R));let w={entity:fa.ofTable("entity",m.getEntityTable()),chem_comp:fa.ofTable("chem_comp",T.getChemCompTable()),atom_site:fa.ofFields("atom_site",R),atom_site_anisotrop:fa.ofFields("atom_site_anisotrop",qCe(c))};for(let E of d)w[E.name]=E;return{header:e.id||"PDB",categoryNames:Object.keys(w),categories:w}}var e0e;(r=>{function e(n){return n?.kind==="pdb"}r.is=e;function t(n){return{kind:"pdb",name:n.id||"",data:n}}r.create=t})(e0e||={});function t0e(e){return Ae.create("Parse PDB",async t=>{await t.update("Converting to mmCIF");let r=await $Ce(e),n=Ln.fromFrame(r,void 0,e0e.create(e)),o=ra(n.data.db,!0),i=await rs(o,n,t),a=r.categories.atom_site?.getField("partial_charge");if(a&&i.frameCount===1){let s=i.representative,l=s.atomicHierarchy.atomSourceIndex,c=W.isIdentity(l)?void 0:l.toArray({array:Int32Array}),m=a.toFloatArray(),d=c?W.ofFloatArray(W.mapToArray(l,p=>m[p],Float32Array)):W.ofFloatArray(m);Pg.Provider.set(s,{data:d,type:"GASTEIGER"})}return i})}function zJe(e){let t=new Array(e.count),r=new Array(e.count),n=new Uint32Array(e.count),o=new Uint32Array(e.count),i=new Array(e.count),a=new Ui,s=new Ni(e.residueId,e.atomName),l="",u=0,c="",m=0,d=e.segmentName.value(0),p=!1,h=0,f=-1;for(let y=0,x=e.count;y<x;++y){let S=e.residueId.value(y),I=e.segmentName.value(y);if(d!==I?(c=eh(u),u+=1,m=0,p=!0,d=I):p=!1,p||S!==f){let v=e.residueName.value(y),A=Ql(s.add(v,y).type,v);!p&&(A!==h||S!==f+1)&&(c=eh(u),u+=1,m=0),l=a.getEntityId(v,A,c),m+=1,f=S,h=A}t[y]=l,r[y]=c,n[y]=m,o[y]=y,i[y]=Bp(e.atomName.value(y),e.residueName.value(y))}let g=wr.ofPartialColumns(Lo.atom_site,{auth_asym_id:e.segmentName,auth_atom_id:e.atomName,auth_comp_id:e.residueName,auth_seq_id:e.residueId,id:W.ofIntArray(o),label_asym_id:W.ofStringArray(r),label_atom_id:e.atomName,label_comp_id:e.residueName,label_seq_id:W.ofIntArray(n),label_entity_id:W.ofStringArray(t),occupancy:W.ofConst(1,e.count,W.Schema.float),type_symbol:W.ofStringArray(i),pdbx_PDB_model_num:W.ofConst(1,e.count,W.Schema.int)},e.count);return ra({entity:a.getEntityTable(),chem_comp:s.getChemCompTable(),atom_site:g})}var r0e;(r=>{function e(n){return n?.kind==="psf"}r.is=e;function t(n){return{kind:"psf",name:n.id,data:n}}r.fromPsf=t})(r0e||={});function n0e(e){return Ae.create("Parse PSF",async t=>{let r=r0e.fromPsf(e),n=zJe(e.atoms),{atomIdA:o,atomIdB:i}=e.bonds,a={indexA:W.ofLambda({value:s=>o.value(s)-1,rowCount:o.rowCount,schema:o.schema}),indexB:W.ofLambda({value:s=>i.value(s)-1,rowCount:i.rowCount,schema:i.schema}),order:W.ofConst(1,e.bonds.count,W.Schema.int)};return RS.create(e.id,n,a,r)})}function o0e(e){return Object.keys(e).filter(t=>!isNaN(t)).map(t=>+t).sort((t,r)=>t-r).map(t=>e[t])}function SF(e,t,r){return e&&e[t]!==void 0?e[t]:r}function mt(e,...t){return{kind:"alias",aliases:t,symbol:e}}function vF(e,t,...r){return e.info.namespace="molscript-macro",e.id=`molscript-macro.${e.info.name}`,{kind:"macro",symbol:e,translate:t,aliases:[e.info.name,...r]}}function HJe(e){return e.kind==="alias"||e.kind==="macro"}var jJe=[["Core symbols",mt(Te.core.type.bool,"bool"),mt(Te.core.type.num,"num"),mt(Te.core.type.str,"str"),mt(Te.core.type.regex,"regex"),mt(Te.core.type.list,"list"),mt(Te.core.type.set,"set"),mt(Te.core.type.compositeKey,"composite-key"),mt(Te.core.logic.not,"not"),mt(Te.core.logic.and,"and"),mt(Te.core.logic.or,"or"),mt(Te.core.ctrl.if,"if"),mt(Te.core.ctrl.fn,"fn"),mt(Te.core.ctrl.eval,"eval"),mt(Te.core.math.add,"add","+"),mt(Te.core.math.sub,"sub","-"),mt(Te.core.math.mult,"mult","*"),mt(Te.core.math.div,"div","/"),mt(Te.core.math.pow,"pow","**"),mt(Te.core.math.mod,"mod"),mt(Te.core.math.min,"min"),mt(Te.core.math.max,"max"),mt(Te.core.math.cantorPairing,"cantor-pairing"),mt(Te.core.math.sortedCantorPairing,"sorted-cantor-pairing"),mt(Te.core.math.invertCantorPairing,"invert-cantor-pairing"),mt(Te.core.math.floor,"floor"),mt(Te.core.math.ceil,"ceil"),mt(Te.core.math.roundInt,"round"),mt(Te.core.math.trunc,"trunc"),mt(Te.core.math.abs,"abs"),mt(Te.core.math.sign,"sign"),mt(Te.core.math.sqrt,"sqrt"),mt(Te.core.math.cbrt,"cbrt"),mt(Te.core.math.sin,"sin"),mt(Te.core.math.cos,"cos"),mt(Te.core.math.tan,"tan"),mt(Te.core.math.asin,"asin"),mt(Te.core.math.acos,"acos"),mt(Te.core.math.atan,"atan"),mt(Te.core.math.sinh,"sinh"),mt(Te.core.math.cosh,"cosh"),mt(Te.core.math.tanh,"tanh"),mt(Te.core.math.exp,"exp"),mt(Te.core.math.log,"log"),mt(Te.core.math.log10,"log10"),mt(Te.core.math.atan2,"atan2"),mt(Te.core.rel.eq,"eq","="),mt(Te.core.rel.neq,"neq","!="),mt(Te.core.rel.lt,"lt","<"),mt(Te.core.rel.lte,"lte","<="),mt(Te.core.rel.gr,"gr",">"),mt(Te.core.rel.gre,"gre",">="),mt(Te.core.rel.inRange,"in-range"),mt(Te.core.str.concat,"concat"),mt(Te.core.str.match,"regex.match"),mt(Te.core.list.getAt,"list.get"),mt(Te.core.set.has,"set.has"),mt(Te.core.set.isSubset,"set.subset")],["Structure",["Types",mt(Te.structureQuery.type.entityType,"ent-type"),mt(Te.structureQuery.type.authResidueId,"auth-resid"),mt(Te.structureQuery.type.labelResidueId,"label-resid"),mt(Te.structureQuery.type.ringFingerprint,"ringfp"),mt(Te.structureQuery.type.bondFlags,"bond-flags")],["Slots",mt(Te.structureQuery.slot.elementSetReduce,"atom.set.reduce.value")],["Generators",mt(Te.structureQuery.generator.atomGroups,"sel.atom.atom-groups"),mt(Te.structureQuery.generator.queryInSelection,"sel.atom.query-in-selection"),mt(Te.structureQuery.generator.rings,"sel.atom.rings"),mt(Te.structureQuery.generator.empty,"sel.atom.empty"),mt(Te.structureQuery.generator.all,"sel.atom.all"),mt(Te.structureQuery.generator.bondedAtomicPairs,"sel.atom.bonded-pairs"),vF(FS("sel.atom.atoms",pr.Dictionary({0:At(Me.Bool,{isOptional:!0,defaultValue:!0,description:"Test applied to each atom."})}),Wt.ElementSelection,"A selection of singleton atom sets."),e=>ie.struct.generator.atomGroups({"atom-test":SF(e,0,!0)})),vF(FS("sel.atom.res",pr.Dictionary({0:At(Me.Bool,{isOptional:!0,defaultValue:!0,description:"Test applied to the 1st atom of each residue."})}),Wt.ElementSelection,"A selection of atom sets grouped by residue."),e=>ie.struct.generator.atomGroups({"residue-test":SF(e,0,!0),"group-by":ie.ammp("residueKey")})),vF(FS("sel.atom.chains",pr.Dictionary({0:At(Me.Bool,{isOptional:!0,defaultValue:!0,description:"Test applied to the 1st atom of each chain."})}),Wt.ElementSelection,"A selection of atom sets grouped by chain."),e=>ie.struct.generator.atomGroups({"chain-test":SF(e,0,!0),"group-by":ie.ammp("chainKey")}))],["Modifiers",mt(Te.structureQuery.modifier.queryEach,"sel.atom.query-each"),mt(Te.structureQuery.modifier.intersectBy,"sel.atom.intersect-by"),mt(Te.structureQuery.modifier.exceptBy,"sel.atom.except-by"),mt(Te.structureQuery.modifier.unionBy,"sel.atom.union-by"),mt(Te.structureQuery.modifier.union,"sel.atom.union"),mt(Te.structureQuery.modifier.cluster,"sel.atom.cluster"),mt(Te.structureQuery.modifier.includeSurroundings,"sel.atom.include-surroundings"),mt(Te.structureQuery.modifier.surroundingLigands,"sel.atom.surrounding-ligands"),mt(Te.structureQuery.modifier.includeConnected,"sel.atom.include-connected"),mt(Te.structureQuery.modifier.expandProperty,"sel.atom.expand-property")],["Filters",mt(Te.structureQuery.filter.pick,"sel.atom.pick"),mt(Te.structureQuery.filter.first,"sel.atom.first"),mt(Te.structureQuery.filter.withSameAtomProperties,"sel.atom.with-same-atom-properties"),mt(Te.structureQuery.filter.intersectedBy,"sel.atom.intersected-by"),mt(Te.structureQuery.filter.within,"sel.atom.within"),mt(Te.structureQuery.filter.isConnectedTo,"sel.atom.is-connected-to")],["Combinators",mt(Te.structureQuery.combinator.intersect,"sel.atom.intersect"),mt(Te.structureQuery.combinator.merge,"sel.atom.merge"),mt(Te.structureQuery.combinator.distanceCluster,"sel.atom.dist-cluster")],["Atom Set Properties",mt(Te.structureQuery.atomSet.atomCount,"atom.set.atom-count"),mt(Te.structureQuery.atomSet.countQuery,"atom.set.count-query"),mt(Te.structureQuery.atomSet.reduce,"atom.set.reduce"),mt(Te.structureQuery.atomSet.propertySet,"atom.set.property")],["Atom Properties",mt(Te.structureQuery.atomProperty.core.elementSymbol,"atom.el"),mt(Te.structureQuery.atomProperty.core.vdw,"atom.vdw"),mt(Te.structureQuery.atomProperty.core.mass,"atom.mass"),mt(Te.structureQuery.atomProperty.core.atomicNumber,"atom.atomic-number"),mt(Te.structureQuery.atomProperty.core.x,"atom.x"),mt(Te.structureQuery.atomProperty.core.y,"atom.y"),mt(Te.structureQuery.atomProperty.core.z,"atom.z"),mt(Te.structureQuery.atomProperty.core.sourceIndex,"atom.src-index"),mt(Te.structureQuery.atomProperty.core.operatorName,"atom.op-name"),mt(Te.structureQuery.atomProperty.core.instanceId,"atom.instance-id"),mt(Te.structureQuery.atomProperty.core.operatorKey,"atom.op-key"),mt(Te.structureQuery.atomProperty.core.modelIndex,"atom.model-index"),mt(Te.structureQuery.atomProperty.core.modelLabel,"atom.model-label"),mt(Te.structureQuery.atomProperty.core.modelEntryId,"atom.model-entry-id"),mt(Te.structureQuery.atomProperty.core.atomKey,"atom.key"),mt(Te.structureQuery.atomProperty.core.bondCount,"atom.bond-count"),mt(Te.structureQuery.atomProperty.topology.connectedComponentKey,"atom.key.molecule"),mt(Te.structureQuery.atomProperty.macromolecular.authResidueId,"atom.auth-resid"),mt(Te.structureQuery.atomProperty.macromolecular.labelResidueId,"atom.label-resid"),mt(Te.structureQuery.atomProperty.macromolecular.residueKey,"atom.key.res"),mt(Te.structureQuery.atomProperty.macromolecular.chainKey,"atom.key.chain"),mt(Te.structureQuery.atomProperty.macromolecular.entityKey,"atom.key.entity"),mt(Te.structureQuery.atomProperty.macromolecular.isHet,"atom.is-het"),mt(Te.structureQuery.atomProperty.macromolecular.id,"atom.id"),mt(Te.structureQuery.atomProperty.macromolecular.label_atom_id,"atom.label_atom_id"),mt(Te.structureQuery.atomProperty.macromolecular.label_alt_id,"atom.label_alt_id","atom.altloc"),mt(Te.structureQuery.atomProperty.macromolecular.label_comp_id,"atom.label_comp_id"),mt(Te.structureQuery.atomProperty.macromolecular.label_asym_id,"atom.label_asym_id"),mt(Te.structureQuery.atomProperty.macromolecular.label_entity_id,"atom.label_entity_id"),mt(Te.structureQuery.atomProperty.macromolecular.label_seq_id,"atom.label_seq_id"),mt(Te.structureQuery.atomProperty.macromolecular.auth_atom_id,"atom.auth_atom_id","atom.name"),mt(Te.structureQuery.atomProperty.macromolecular.auth_comp_id,"atom.auth_comp_id","atom.resname"),mt(Te.structureQuery.atomProperty.macromolecular.auth_asym_id,"atom.auth_asym_id","atom.chain"),mt(Te.structureQuery.atomProperty.macromolecular.auth_seq_id,"atom.auth_seq_id","atom.resno"),mt(Te.structureQuery.atomProperty.macromolecular.pdbx_PDB_ins_code,"atom.pdbx_PDB_ins_code","atom.inscode"),mt(Te.structureQuery.atomProperty.macromolecular.pdbx_formal_charge,"atom.pdbx_formal_charge"),mt(Te.structureQuery.atomProperty.macromolecular.occupancy,"atom.occupancy"),mt(Te.structureQuery.atomProperty.macromolecular.B_iso_or_equiv,"atom.B_iso_or_equiv","atom.bfactor"),mt(Te.structureQuery.atomProperty.macromolecular.entityType,"atom.entity-type"),mt(Te.structureQuery.atomProperty.macromolecular.entitySubtype,"atom.entity-subtype"),mt(Te.structureQuery.atomProperty.macromolecular.entityPrdId,"atom.entity-prd-id"),mt(Te.structureQuery.atomProperty.macromolecular.entityDescription,"atom.entity-description"),mt(Te.structureQuery.atomProperty.macromolecular.objectPrimitive,"atom.object-primitive"),mt(Te.structureQuery.atomProperty.macromolecular.chemCompType,"atom.chem-comp-type"),mt(Te.structureQuery.atomProperty.macromolecular.secondaryStructureKey,"atom.key.sec-struct"),mt(Te.structureQuery.atomProperty.macromolecular.isModified,"atom.is-modified"),mt(Te.structureQuery.atomProperty.macromolecular.modifiedParentName,"atom.modified-parent"),mt(Te.structureQuery.atomProperty.ihm.hasSeqId,"atom.ihm.has-seq-id"),mt(Te.structureQuery.atomProperty.ihm.overlapsSeqIdRange,"atom.ihm.overlaps-seq-id-range")],["Bond Properties",mt(Te.structureQuery.bondProperty.order,"bond.order"),mt(Te.structureQuery.bondProperty.length,"bond.length"),mt(Te.structureQuery.bondProperty.key,"bond.key"),mt(Te.structureQuery.bondProperty.atomA,"bond.atom-a"),mt(Te.structureQuery.bondProperty.atomB,"bond.atom-b"),vF(FS("bond.is",pr.List(Wt.BondFlag),Me.Bool,`Test if the current bond has at least one (or all if partial = false) of the specified flags: ${Me.oneOfValues(Wt.BondFlag).join(", ")}`),e=>ie.core.flags.hasAny([ie.struct.bondProperty.flags(),ie.struct.type.bondFlags(o0e(e))]))]]],i0e=[];function a0e(e){for(let t of e)HJe(t)?i0e.push(t):t instanceof Array&&a0e(t)}a0e(jJe);var IF=(function(){let e=[],t=Object.create(null),r=Un.create(),n=Un.create();for(let o of i0e){for(let a of o.aliases){if(e.push([a,o]),t[a])throw new Error(`Alias '${a}' already in use.`);t[a]=o}let i=o.symbol.args;if(i.kind!=="dictionary"){i.type.kind==="oneof"&&Me.oneOfValues(i.type).forEach(a=>Un.add(n,a,a));continue}for(let a of Object.keys(i.map)){isNaN(a)&&Un.add(r,a,a);let s=i.map[a];s.type.kind==="oneof"&&Me.oneOfValues(s.type).forEach(l=>Un.add(n,l,l))}}return{symbolList:e,symbolMap:t,namedArgs:r.array,constants:n.array}})();var sPr=IF.constants,lPr=IF.namedArgs,cA=IF.symbolMap,uPr=IF.symbolList;function yR(e){if(ts.isLiteral(e))return e;if(ts.isSymbol(e)){if(!cA[e.name])return e;let a=cA[e.name];if(a.kind==="alias")return ts.Symbol(cA[e.name].symbol.id);throw a.translate([])}let t=ts.isSymbol(e.head)&&!!cA[e.head.name]&&cA[e.head.name].kind==="macro",r=t?e.head:yR(e.head),n=r!==e.head;if(!e.args)return t?yR(e.head):n?ts.Apply(r):e;let o=!1,i;if(ts.isArgumentsArray(e.args)){i=[];for(let a=0,s=e.args.length;a<s;a++){let l=e.args[a],u=yR(l);l!==u&&(o=!0),i[i.length]=u}if(o||(i=e.args),!t&&!n&&!o)return e}else{i={};for(let a of Object.keys(e.args)){let s=e.args[a],l=yR(s);s!==l&&(o=!0),i[a]=l}if(!t&&!n&&!o)return e;o||(i=e.args)}if(t){let a=cA[e.head.name];return a.kind!=="macro"?ts.Apply(r,i):a.translate(i)}return ts.Apply(r,i)}function s0e(e){return yR(e)}var Je=class e{constructor(t){this._=t}parse(t){let r=this.skip(e.eof)._(t,0);return r.status?{success:!0,value:r.value}:{success:!1,index:l0e(t,r.furthest),expected:r.expected}}tryParse(t){let r=this.parse(t);if(r.success)return r.value;{let n=QJe(t,r);throw new Error(n)}}or(t){return e.alt(this,t)}trim(t){return this.wrap(t,t)}wrap(t,r){return P8(1,typeof t=="string"?e.string(t):t,this,typeof r=="string"?e.string(r):r)}thru(t){return t(this)}then(t){return P8(1,this,t)}many(){return new e((t,r)=>{let n=[],o;for(;;)if(o=Ep(this._(t,r),o),o.status){if(r===o.index)throw new Error("infinite loop detected in .many() parser --- calling .many() on a parser which can accept zero characters is usually the cause");r=o.index,n.push(o.value)}else return Ep(mc(r,n),o)})}times(t,r){let n=typeof r>"u"?t:r;return new e((o,i)=>{let a=[],s,l,u;for(u=0;u<t;u++)if(s=this._(o,i),l=Ep(s,l),s.status)i=s.index,a.push(s.value);else return l;for(;u<n&&(s=this._(o,i),l=Ep(s,l),s.status);u+=1)i=s.index,a.push(s.value);return Ep(mc(i,a),l)})}result(t){return this.map(()=>t)}atMost(t){return this.times(0,t)}atLeast(t){return e.seq(this.times(t),this.many()).map(r=>[...r[0],...r[1]])}map(t){return new e((r,n)=>{let o=this._(r,n);return o.status?Ep(mc(o.index,t(o.value)),o):o})}skip(t){return P8(0,this,t)}mark(){return e.seq(e.index,this,e.index).map(t=>({start:t[0],value:t[1],end:t[2]}))}node(t){return e.seq(e.index,this,e.index).map(r=>({name:t,start:r[0],value:r[1],end:r[2]}))}sepBy(t){return e.sepBy(this,t)}sepBy1(t){return e.sepBy1(this,t)}lookahead(t){return this.skip(e.lookahead(t))}notFollowedBy(t){return this.skip(e.notFollowedBy(t))}desc(t){return new e((r,n)=>{let o=this._(r,n);return o.status||(o.expected=[t]),o})}fallback(t){return this.or(e.succeed(t))}ap(t){return e.seq(t,this).map(([r,n])=>r(n))}chain(t){return new e((r,n)=>{let o=this._(r,n);if(!o.status)return o;let i=t(o.value);return Ep(i._(r,o.index),o)})}};(U=>{function e(L,q,te){let J=[].slice.call(arguments);if(J.length===0)throw new Error("seqMap needs at least one argument");let ee=J.pop();return YJe(ee),r.apply(null,J).map(function(ce){return ee.apply(null,ce)})}U.seqMap=e;function t(L){let q={};for(let te of Object.keys(L))(function(J){q[J]=S(()=>L[J](q))})(te);return q}U.createLanguage=t;function r(...L){let q=L.length;return new U((te,J)=>{let ee,ce=new Array(q),fe=J;for(let O=0;O<q;O++){if(ee=Ep(L[O]._(te,fe),ee),!ee.status)return ee;ce[O]=ee.value,fe=ee.index}return Ep(mc(fe,ce),ee)})}U.seq=r;function n(...L){return L.length===0?m("zero alternates"):new U((te,J)=>{let ee;for(let ce=0;ce<L.length;ce++)if(ee=Ep(L[ce]._(te,J),ee),ee.status)return ee;return ee})}U.alt=n;function o(L,q){return i(L,q).or(c([]))}U.sepBy=o;function i(L,q){let te=q.then(L).many();return r(L,te).map(J=>[J[0],...J[1]])}U.sepBy1=i;function a(L){let q=`'${L}'`;if(L.length===1){let te=L.charCodeAt(0);return new U((J,ee)=>J.charCodeAt(ee)===te?mc(ee+1,L):cb(ee,q))}return new U((te,J)=>{let ee=J+L.length;return te.slice(J,ee)===L?mc(ee,L):cb(J,q)})}U.string=a;function s(L){let q=""+L;return q.slice(q.lastIndexOf("/")+1)}function l(L){return RegExp("^(?:"+L.source+")",s(L))}function u(L,q=0){let te=l(L),J=""+L;return new U((ee,ce)=>{let fe=te.exec(ee.slice(ce));if(fe){if(0<=q&&q<=fe.length){let V=fe[0],Z=fe[q];return mc(ce+V.length,Z)}let O=`invalid match group (0 to ${fe.length}) in ${J}`;return cb(ce,O)}return cb(ce,J)})}U.regexp=u;function c(L){return new U((q,te)=>mc(te,L))}U.succeed=c;function m(L){return new U((q,te)=>cb(te,L))}U.fail=m;function d(L){if(qJe(L))return new U((q,te)=>{let J=L._(q,te);return J.status&&(J.index=te,J.value=null),J});if(typeof L=="string")return d(a(L));if(L instanceof RegExp)return d(u(L));throw new Error("not a string, regexp, or parser: "+L)}U.lookahead=d;function p(L){return new U((q,te)=>{let J=L._(q,te);return J.status?cb(te,'not "'+q.slice(te,J.index)+'"'):mc(te,null)})}U.notFollowedBy=p;function h(L){return new U((q,te)=>{let J=q.charAt(te);return te<q.length&&L(J)?mc(te+1,J):cb(te,"a character "+L)})}U.test=h;function f(L){return h(q=>L.indexOf(q)>=0)}U.oneOf=f;function g(L){return h(q=>L.indexOf(q)<0)}U.noneOf=g;function y(L,q){return h(te=>L<=te&&te<=q).desc(L+"-"+q)}U.range=y;function x(L){return new U((q,te)=>{let J=te;for(;J<q.length&&L(q.charAt(J));)J++;return mc(J,q.slice(te,J))})}U.takeWhile=x;function S(L){let q=new U((te,J)=>{let ee=L()._;return q._=ee,ee(te,J)});return q}U.lazy=S;function I(){return m("empty")}U.empty=I,U.index=new U(function(L,q){return mc(q,l0e(L,q))}),U.anyChar=new U((L,q)=>q>=L.length?cb(q,"any character"):mc(q+1,L.charAt(q))),U.all=new U(function(L,q){return mc(L.length,L.slice(q))}),U.eof=new U(function(L,q){return q<L.length?cb(q,"EOF"):mc(q,null)}),U.digit=u(/[0-9]/).desc("a digit"),U.digits=u(/[0-9]*/).desc("optional digits"),U.letter=u(/[a-z]/i).desc("a letter"),U.letters=u(/[a-z]*/i).desc("optional letters"),U.optWhitespace=u(/\s*/).desc("optional whitespace"),U.whitespace=u(/\s+/).desc("whitespace"),U.cr=a("\r"),U.lf=a(`
`),U.crlf=a(`\r
`),U.newline=n(U.crlf,U.lf,U.cr).desc("newline"),U.end=n(U.newline,U.eof);function G(L){return c(L)}U.of=G;function X(L){return u(L)}U.regex=X})(Je||={});function P8(e,...t){let r=t.length;return new Je((n,o)=>{let i,a,s=o;for(let l=0;l<r;l++){if(i=Ep(t[l]._(n,s),i),!i.status)return i;e===l&&(a=i.value),s=i.index}return Ep(mc(s,a),i)})}function mc(e,t){return{status:!0,index:e,value:t}}function cb(e,t){return{status:!1,furthest:e,expected:[t]}}function Ep(e,t){if(!t||e.status||t.status||e.furthest>t.furthest)return e;let r=e.furthest===t.furthest?ZJe(e.expected,t.expected):t.expected;return{status:e.status,furthest:t.furthest,expected:r}}function l0e(e,t){let r=e.slice(0,t).split(`
`),n=r.length,o=r[r.length-1].length+1;return{offset:t,line:n,column:o}}function WJe(e){return e.length===1?e[0]:"one of "+e.join(", ")}function XJe(e,t){let r=t.index,n=r.offset;if(n===e.length)return", got the end of the input";let o=n>0?"'...":"'",i=e.length-n>12?"...'":"'";return` at line ${r.line} column ${r.column}, got ${o}${e.slice(n,n+12)}${i}`}function QJe(e,t){return`expected ${WJe(t.expected)}${XJe(e,t)}`}function ZJe(e,t){let r=e.length,n=t.length;if(r===0)return t;if(n===0)return e;let o=new Set,i=[];for(let a=0;a<r;a++)o.has(e[a])||(i[i.length]=e[a],o.add(e[a]));for(let a=0;a<n;a++)o.has(t[a])||(i[i.length]=t[a],o.add(t[a]));return i.sort(),i}function qJe(e){return e instanceof Je}function YJe(e){if(typeof e!="function")throw new Error("not a function: "+e)}function u0e(e){return c0e.parse(e)}var c0e;(S=>{let e;(T=>{function I(R){return{kind:"string",value:R}}T.str=I;function v(R){return{kind:"symbol",value:R}}T.symb=v;function A(R,w){return{kind:"list",bracket:R,nodes:w}}T.list=A;function P(R){return{kind:"comment",value:R}}T.comment=P})(e||={});let t=Je.regexp(/[\n\r\s]*/),r=Je.lazy(()=>Je.alt(n,c,o,i).trim(t)),n=Je.takeWhile(I=>I!=="`").trim("`").map(e.str),o=Je.regexp(/[^()\[\]{};`,\n\r\s]+/).map(e.symb),i=Je.regexp(/\s*;+([^\n\r]*)\n/,1).map(e.comment),a=r.many(),s=a.wrap("(",")").map(I=>e.list("(",I)),l=a.wrap("[","]").map(I=>e.list("[",I)),u=a.wrap("{","}").map(I=>e.list("{",I)),c=Je.alt(s,l,u),m=r.many();function d(I){return m.tryParse(I)}function p(I){switch(I.kind){case"string":return I.value;case"symbol":{let v=I.value;if(v.length>1)switch(v.charAt(0)){case".":return ie.atomName(v.substr(1));case"_":return ie.struct.type.elementSymbol([v.substr(1)])}return v==="true"?!0:v==="false"?!1:y(v)?+v:ts.Symbol(v)}case"list":switch(I.bracket){case"[":return ie.core.type.list(g(I.nodes).map(p));case"{":return ie.core.type.set(g(I.nodes).map(p));case"(":{if(I.nodes[0].kind==="comment")throw new Error("Invalid expression");let v=p(I.nodes[0]);return ts.Apply(v,h(I.nodes))}default:Mr(I.bracket)}default:Mr(I)}}function h(I){if(I.length<=1)return;if(!f(I)){let T=[];for(let R=1,w=I.length;R<w;R++){let E=I[R];E.kind!=="comment"&&(T[T.length]=p(E))}return T}let v={},A=!0,P=0;for(let T=1,R=I.length;T<R;T++){let w=I[T];if(w.kind!=="comment")if(w.kind==="symbol"&&w.value.length>1&&w.value.charAt(0)===":"){let E=w.value.substr(1);for(++T;T<R&&I[T].kind==="comment";)T++;if(T>=R)throw new Error(`There must be a value foolowed a named arg ':${E}'.`);if(I[T].kind==="comment")throw new Error("Invalid expression");v[E]=p(I[T]),isNaN(+E)&&(A=!1)}else v[P++]=p(w)}if(A){let T=Object.keys(v).map(w=>+w).sort((w,E)=>w-E),R=!0;for(let w=0,E=T.length;w<E;w++)if(T[w]!==w){R=!1;break}if(R){let w=[];for(let E=0,M=T.length;E<M;E++)w[E]=v[E];return w}}return v}function f(I){for(let v=1,A=I.length;v<A;v++){let P=I[v];if(P.kind==="symbol"&&P.value.length>1&&P.value.charAt(0)===":")return!0}return!1}function g(I){let v=!1;for(let A=0,P=I.length;A<P;A++)if(I[A].kind==="comment"){v=!0;break}return v?I.filter(A=>A.kind!=="comment"):I}function y(I){return/-?(0|[1-9][0-9]*)([.][0-9]+)?([eE][+-]?[0-9]+)?/.test(I)&&!isNaN(+I)}function x(I){let v=d(I),A=[];for(let P of v)P.kind!=="comment"&&(A[A.length]=p(P));return A}S.parse=x})(c0e||={});var pi=ie;function wl(e,t,r){let n=Je.lazy(()=>Je.seq(e,n).map(o=>r(...o)).or(t));return n}function bR(e,t,r){return Je.seqMap(t,e.many(),(n,o)=>o.reduce((i,a)=>r(a,i),n))}function sl(e,t,r){return Je.seqMap(t,Je.seq(e,t).many(),(n,o)=>o.reduce((i,a)=>{let[s,l]=a;return r(s,i,l)},n))}function TC(e,t){return e.reduce((n,o)=>{let i=o.isUnsupported?mb(`operator '${o.name}' not supported`):o.map;return o.type(o.rule,n,i)},t)}function kp(e,t=0){return Je.optWhitespace.then(Je.regexp(e,t).skip(Je.optWhitespace))}function Jc(e,t=0){return Je.regexp(e,t).skip(Je.optWhitespace)}function xR(e,t=0){return Je.optWhitespace.then(Je.regexp(e,t))}function AF(e,t){let r=t?`${e}|${wy(t)}`:e,n=RegExp(`(${r})\\s+([-+]?[0-9]*\\.?[0-9]+)\\s+OF`,"i");return kp(n,2).map(parseFloat)}function mb(e){return function(){throw new Error(e)}}function CR(e){return e.length===1?e[0]:e.length>1?pi.core.logic.and(e):void 0}function d0e(e){return e.length===1?e[0]:e.length>1?pi.core.logic.or(e):void 0}function _8(e,t){if(t&&t.op!==void 0&&t.val!==void 0){let r=[e,t.val];switch(t.op){case"=":return pi.core.rel.eq(r);case"!=":return pi.core.rel.neq(r);case">":return pi.core.rel.gr(r);case"<":return pi.core.rel.lt(r);case">=":return pi.core.rel.gre(r);case"<=":return pi.core.rel.lte(r);default:throw new Error(`operator '${t.op}' not supported`)}}else return t&&t.flags!==void 0?pi.core.flags.hasAny([e,t.flags]):t&&t.min!==void 0&&t.max!==void 0?pi.core.rel.inRange([e,t.min,t.max]):Array.isArray(t)?t.length>1?pi.core.set.has([pi.core.type.set(t),e]):pi.core.rel.eq([e,t[0]]):pi.core.rel.eq([e,t])}function cu(e){return pi.struct.generator.queryInSelection({0:e,query:pi.struct.generator.all(),"in-complement":!0})}function jm(e,t){return e.length<t.length?1:-1}function R8(e,t){let r=(t?[e].concat(t):[e]).sort(jm).map(wy).join("|");return RegExp(`${r}`,"i")}function p0e(e){let t={};return Object.keys(e).sort(jm).forEach(r=>{let n=e[r],o=mb(`property '${r}' not supported`),i=Je.regexp(n.regex).map(a=>(n.isUnsupported&&o(),_8(n.property,n.map(a))));n.isNumeric||(t[r]=i)}),t}function TF(e){let t=[];return Object.keys(e).sort(jm).forEach(r=>{let n=e[r],o=mb(`property '${r}' not supported`),i=Je.regexp(n.regex).map(l=>(n.isUnsupported&&o(),_8(n.property,n.map(l)))),a=Je.regexp(R8(r,n.abbr)).trim(Je.optWhitespace),s=l=>pi.struct.generator.atomGroups({[n.level]:l});n.isNumeric?t.push(a.then(Je.seq(Je.regexp(/>=|<=|=|!=|>|</).trim(Je.optWhitespace),Je.regexp(n.regex).map(n.map))).map(l=>(n.isUnsupported&&o(),_8(n.property,{op:l[0],val:l[1]}))).map(s)):t.push(a.then(i).map(s))}),t}function mA(e){let t=[];return Object.keys(e).sort(jm).forEach(r=>{let n=e[r],o=n.map?n.map:mb(`keyword '${r}' not supported`),i=Je.regexp(R8(r,n.abbr)).map(o);t.push(i)}),t}function f0e(e,t){let r=[],n=Je.regexp(/\(\s*/),o=Je.regexp(/\s*\)/);return Object.keys(e).sort(jm).forEach(i=>{let a=e[i],s=a.map?a.map:mb(`function '${i}' not supported`),l=Je.regexp(new RegExp(i,"i")).skip(n).then(t).skip(o).map(s);r.push(l)}),r}function SR(e,t){let r=[];return Object.keys(e).sort(jm).forEach(n=>{let o=e[n],i=mb(`property '${n}' not supported`),a=Je.regexp(R8(n,o.abbr)).lookahead(t).map(()=>(o.isUnsupported&&i(),o.property));r.push(a)}),r}function dA(e,t,r,n){let o=[];for(let i in e)o.push(i),e[i].abbr&&o.push(...e[i].abbr);for(let i in t)o.push(i),t[i].abbr&&o.push(...t[i].abbr);return r.forEach(i=>{o.push(i.name),i.abbr&&o.push(...i.abbr)}),o}function Dd(e){return pi.core.type.set(e.map(pi.atomName))}function wd(e){return pi.struct.generator.queryInSelection({0:e,query:pi.struct.generator.all()})}function KS(e,t,r){switch(e.head.name){case"structure-query.atom-property.macromolecular.label_atom_id":return pi.atomName(t);case"structure-query.atom-property.core.element-symbol":return pi.es(t);case"structure-query.atom-property.macromolecular.secondary-structure-flags":return r&&(t=[r[t.toUpperCase()]||"none"]),pi.struct.type.secondaryStructureFlags([t]);default:return t}}var m0e="structure-query.atom-property.macromolecular.",KJe=["entityKey","label_entity_id","entityType"],JJe=["chainKey","label_asym_id","label_entity_id","auth_asym_id","entityType"],$Je=["residueKey","label_comp_id","label_seq_id","auth_comp_id","auth_seq_id","pdbx_formal_charge","secondaryStructureKey","secondaryStructureFlags","isModified","modifiedParentName"];function h0e(e){if(e.head.name.startsWith(m0e)){let t=e.head.name.substr(m0e.length);if(KJe.includes(t))return"entity-test";if(JJe.includes(t))return"chain-test";if($Je.includes(t))return"residue-test"}return"atom-test"}var e$e=["structure-query.atom-property.macromolecular.secondary-structure-flags"];function g0e(e,t){if(e$e.includes(e.head.name)){let r=t[0].head,n=[];return t.forEach(o=>n.push(...o.args[0])),pi.core.flags.hasAny([e,{head:r,args:n}])}else{if(t.length===1)return pi.core.rel.eq([e,t[0]]);if(t.length>1)return pi.core.set.has([pi.core.type.set(t),e])}}function Zn(e){return pi.struct.generator.atomGroups({"residue-test":pi.core.set.has([pi.core.type.set(e),pi.ammp("label_comp_id")])})}var os=ie,Fp=/[-+]?[0-9]*\.?[0-9]+/,vR=/[0-9]+/;function Gr(e){return e}var t$e={none:"none",turn:"turn",sheet:"beta",helix:"helix",dna:"dna",rna:"rna",carbohydrate:"carbohydrate",helix310:"3-10",helixalpha:"alpha",helixpi:"pi",0:"none",1:"turn",2:"beta",3:"helix",4:"dna",5:"rna",6:"carbohydrate",7:"3-10",8:"alpha",9:"pi"};function D8(e){if(e.head){if(e.head.name&&e.head.name==="core.type.regex"&&(e=e.args[0].replace(/^\^|\$$/g,"")),e=t$e[e.toString().toLowerCase()]||"none",["dna","rna","carbohydrate"].indexOf(e)!==-1)throw new Error("values 'dna', 'rna', 'carbohydrate' not yet supported for 'structure' property");return os.struct.type.secondaryStructureFlags([e])}}var w8={adpmax:{"@desc":"the maximum anisotropic displacement parameter for the selected atom","@examples":[""],isUnsupported:!0,regex:Fp,map:e=>parseFloat(e),level:"atom-test"},adpmin:{"@desc":"the minimum anisotropic displacement parameter for the selected atom","@examples":[""],isUnsupported:!0,regex:Fp,map:e=>parseFloat(e),level:"atom-test"},altloc:{"@desc":"PDB alternate location identifier","@examples":["altloc = A"],regex:/[a-zA-Z0-9]/,map:Gr,level:"atom-test",property:os.ammp("label_alt_id")},altname:{"@desc":"an alternative name given to atoms by some file readers (for example, P2N)","@examples":[""],isUnsupported:!0,regex:/[a-zA-Z0-9]/,map:Gr,level:"atom-test"},atomID:{"@desc":"special atom IDs for PDB atoms assigned by Jmol","@examples":[""],isUnsupported:!0,regex:vR,map:e=>parseInt(e),level:"atom-test"},atomIndex:{"@desc":"atom 0-based index; a unique number for each atom regardless of the number of models loaded","@examples":[""],isUnsupported:!0,regex:vR,map:e=>parseInt(e),level:"atom-test"},atomName:{"@desc":"atom name","@examples":["atomName = CA"],regex:/[a-zA-Z0-9]+/,map:e=>os.atomName(e),level:"atom-test",property:os.ammp("label_atom_id")},atomno:{"@desc":'sequential number; you can use "@" instead of "atomno=" -- for example, select @33 or Var x = @33 or @35',"@examples":[""],isUnsupported:!0,regex:vR,map:e=>parseInt(e),level:"atom-test"},atomType:{"@desc":"atom type (mol2, AMBER files) or atom name (other file types)","@examples":["atomType = OH"],regex:/[a-zA-Z0-9]+/,map:e=>os.atomName(e),level:"atom-test",property:os.ammp("label_atom_id")},atomX:{"@desc":"Cartesian X coordinate (or just X)","@examples":["x = 4.2"],abbr:["X"],isNumeric:!0,regex:Fp,map:e=>parseFloat(e),level:"atom-test",property:os.acp("x")},atomY:{"@desc":"Cartesian Y coordinate (or just Y)","@examples":["y < 42"],abbr:["Y"],isNumeric:!0,regex:Fp,map:e=>parseFloat(e),level:"atom-test",property:os.acp("y")},atomZ:{"@desc":"Cartesian Z coordinate (or just Z)","@examples":["Z > 10"],abbr:["Z"],isNumeric:!0,regex:Fp,map:e=>parseFloat(e),level:"atom-test",property:os.acp("z")},bondcount:{"@desc":"covalent bond count","@examples":["bondcount = 0"],isNumeric:!0,regex:vR,map:e=>parseInt(e),level:"atom-test",property:os.acp("bondCount")},bondingRadius:{"@desc":"radius used for auto bonding; synonymous with ionic and ionicRadius","@examples":[""],abbr:["ionic","ionicRadius"],isUnsupported:!0,regex:Fp,map:e=>parseFloat(e),level:"atom-test"},cell:{"@desc":'crystallographic unit cell, expressed either in lattice integer notation (111-999) or as a coordinate in ijk space, where {1 1 1} is the same as 555. ANDing two cells, for example select cell=555 and cell=556, selects the atoms on the common face. (Note: in the specifc case of CELL, only "=" is allowed as a comparator.)',"@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Gr,level:"atom-test"},configuration:{"@desc":'Only in the context {configuration=n}, this option selects the set of atoms with either no ALTLOC specified or those atoms having this index into the array of altlocs within its model. So, for example, if the model has altloc "A" and "B", select configuration=1 is equivalent to select altloc="" or altloc="A", and print {configuration=2} is equivalent to print {altloc="" or altloc="B"}. Configuration 0 is "all atoms in a model having configurations", and an invalid configuration number gives no atoms. (Note: in the specifc case of CONFIGURATION, only "=" is allowed as a comparator.)',"@examples":[""],isUnsupported:!0,regex:vR,map:e=>parseInt(e),level:"atom-test"},chain:{"@desc":'protein chain. For newer CIF files allowing multicharacter chain specifications, use quotations marks: select chain="AA". For these multicharacter desigations, case is not checked unless the CIF file has lower-case chain designations.',"@examples":["chain = A",'chain = "AA"'],regex:/[a-zA-Z0-9]+/,map:Gr,level:"chain-test",property:os.ammp("auth_asym_id")},chainNo:{"@desc":'chain number; sequentially counted from 1 for each model; chainNo == 0 means"no chain" or PDB chain identifier indicated as a blank (Jmol 14.0).',"@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Gr,level:"atom-test"},color:{"@desc":"the atom color","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Gr,level:"atom-test"},covalentRadius:{"@desc":"covalent bonding radius, synonymous with covalent. Not used by Jmol, but could be used, for example, in {*}.spacefill={*}.covalentRadius.all.","@examples":[""],abbr:["covalent"],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Gr,level:"atom-test"},cs:{"@desc":"chemical shift calculated using computational results that include magnetic shielding tensors.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Gr,level:"atom-test"},element:{"@desc":'element symbol. The value of this parameter depends upon the context. Used with select structure=x, x can be either the quoted element symbol, "H", "He", "Li", etc. or atomic number. In all other contexts, the value is the element symbol. When the atom is a specific isotope, the string will contain the isotope number -- "13C", for example.',"@examples":["element=Fe"],regex:/[a-zA-Z]+/,map:e=>os.es(e),level:"atom-test",property:os.acp("elementSymbol")},elemno:{"@desc":"atomic element number","@examples":["elemno=8"],regex:/[0-9\s{}-]+/,map:e=>parseInt(e),level:"atom-test",property:os.acp("atomicNumber")},eta:{"@desc":`Based on Carlos M. Duarte, Leven M. Wadley, and Anna Marie Pyle, RNA structure comparison, motif search and discovery using a reduced representation of RNA conformational space, Nucleic Acids Research, 2003, Vol. 31, No. 16 4755-4761. The parameter eta is the C4'[i-1]-P[i]-C4'[i]-P[i+1] dihedral angle; theta is the P[i]-C4'[i]-P[i+1]-C4'[i+1] dihedral angle. Both are measured on a 0-360 degree scale because they are commonly near 180 degrees. Using the commands plot PROPERTIES eta theta resno; select visible;wireframe only one can create these authors' "RNA worm" graph.`,"@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Gr,level:"atom-test"},theta:{"@desc":`Based on Carlos M. Duarte, Leven M. Wadley, and Anna Marie Pyle, RNA structure comparison, motif search and discovery using a reduced representation of RNA conformational space, Nucleic Acids Research, 2003, Vol. 31, No. 16 4755-4761. The parameter eta is the C4'[i-1]-P[i]-C4'[i]-P[i+1] dihedral angle; theta is the P[i]-C4'[i]-P[i+1]-C4'[i+1] dihedral angle. Both are measured on a 0-360 degree scale because they are commonly near 180 degrees. Using the commands plot PROPERTIES eta theta resno; select visible;wireframe only one can create these authors' "RNA worm" graph.`,"@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Gr,level:"atom-test"},file:{"@desc":"file number containing this atom","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Gr,level:"atom-test"},formalCharge:{"@desc":"formal charge","@examples":["formalCharge=1"],regex:Fp,map:e=>parseFloat(e),level:"atom-test",property:os.ammp("pdbx_formal_charge")},format:{"@desc":"format (label) of the atom.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Gr,level:"atom-test"},fXyz:{"@desc":"fractional XYZ coordinates","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Gr,level:"atom-test"},fX:{"@desc":"fractional X coordinate","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Gr,level:"atom-test"},fY:{"@desc":"fractional Y coordinate","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Gr,level:"atom-test"},fZ:{"@desc":"fractional Z coordinate","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Gr,level:"atom-test"},fuxyz:{"@desc":"fractional XYZ coordinates in the unitcell coordinate system","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Gr,level:"atom-test"},fux:{"@desc":"fractional X coordinate in the unitcell coordinate system","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Gr,level:"atom-test"},fuy:{"@desc":"fractional Y coordinate in the unitcell coordinate system","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Gr,level:"atom-test"},fuz:{"@desc":"fractional Z coordinate in the unit cell coordinate system","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Gr,level:"atom-test"},group:{"@desc":"3-letter residue code","@examples":["group = ALA"],regex:/[a-zA-Z0-9]{1,3}/,map:Gr,level:"residue-test",property:os.ammp("label_comp_id")},group1:{"@desc":"single-letter residue code (amino acids only)","@examples":["group1 = G"],regex:/[a-zA-Z]/,map:Gr,level:"residue-test",property:os.ammp("label_comp_id")},groupID:{"@desc":"group ID number: A unique ID for each amino acid or nucleic acid residue in a PDB file. 0  noGroup 1-5  ALA, ARG, ASN, ASP, CYS 6-10  GLN, GLU, GLY, HIS, ILE 11-15  LEU, LYS, MET, PHE, PRO 16-20  SER, THR, TRP, TYR, VAL 21-23  ASX, GLX, UNK 24-29  A, +A, G, +G, I, +I 30-35  C, +C, T, +T, U, +U Additional unique numbers are assigned arbitrarily by Jmol and cannot be used reproducibly.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Gr,level:"atom-test"},groupindex:{"@desc":"overall group index","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Gr,level:"atom-test"},hydrophobicity:{"@desc":"Aminoacid residue scale of hydrophobicity based on Rose, G. D., Geselowitz, A. R., Lesser, G. J., Lee, R. H., and Zehfus, M. H. (1985). Hydrophobicity of amino acid residues in globular proteins, Science, 229(4716):834-838.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Gr,level:"atom-test"},identify:{"@desc":"for a PDB/mmCIF file, a label such as [ILE]7^1:A.CD1%A/3 #47, which includes the group ([ILE]), residue number with optional insertion code (7^1), chain (:A), atom name (CD1), alternate location if present (%A), PDB model number (/3, for NMR models when one file is loaded; /file.model such as /2.3 if more than one file is loaded), and atom number (#47). For non-PDB data, the information is shorter -- for example, H15/2.1 #6, indicating atom name (H15), full file.model number (/2.1), and atom number (#6). If only a single model is loaded, %[identify] does not include the model number.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Gr,level:"atom-test"},insertion:{"@desc":"protein residue insertion code","@examples":["insertion=A"],regex:/[a-zA-Z0-9]/,map:Gr,level:"atom-test",property:os.ammp("pdbx_PDB_ins_code")},label:{"@desc":"current atom label (same as format)","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Gr,level:"atom-test"},mass:{"@desc":"atomic mass -- especially useful with appended .max or .sum","@examples":["mass > 13"],regex:Fp,map:e=>parseFloat(e),level:"atom-test",property:os.acp("mass")},model:{"@desc":"model number","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Gr,level:"atom-test"},modelindex:{"@desc":"a unique number for each model, starting with 0 and spanning all models in all files","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Gr,level:"atom-test"},modO:{"@desc":"currently calculated occupancy from modulation (0 to 100; NaN if atom has no occupancy modulation)","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Gr,level:"atom-test"},modXYZ:{"@desc":"currently calculated displacement modulation (for incommensurately modulated structures). Also modX, modY, modZ for individual components. For atoms without modultion, {xx}.modXYZ is -1 and {xx}.modX is NaN, and in a label %[modXYZ] and %[modX] are blank.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Gr,level:"atom-test"},molecule:{"@desc":"molecule number","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Gr,level:"atom-test"},monomer:{"@desc":"monomer number (group number) in a polymer (usually a chain), starting with 1, or 0 if not part of a biopolymer -- that is, not a connected carbohydrate, amino acid, or nucleic acid (Jmol 14.3.15)","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Gr,level:"atom-test"},ms:{"@desc":"magnetic shielding calculated from file-loaded tensors.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Gr,level:"atom-test"},occupancy:{"@desc":'CIF file site occupancy. In SELECT command comparisons ("select occupancy < 90"), an integer n implies measurement on a 0-100 scale; also, in the context %[occupancy] or %q for a label, the reported number is a percentage. In all other cases, such as when %Q is used in a label or when a decimal number is used in a comparison, the scale is 0.0 - 1.0.',"@examples":["occupancy < 1"],regex:Fp,map:e=>parseFloat(e),level:"atom-test",property:os.ammp("occupancy")},partialCharge:{"@desc":"partial charge","@examples":[""],isUnsupported:!0,regex:Fp,map:e=>parseFloat(e),level:"atom-test"},phi:{"@desc":"protein group PHI angle for atom's residue","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Gr,level:"atom-test"},polymer:{"@desc":"sequential polymer number in a model, starting with 1.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Gr,level:"atom-test"},polymerLength:{"@desc":"polymer length","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Gr,level:"atom-test"},property_xx:{"@desc":"a property created using the DATA command","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Gr,level:"atom-test"},psi:{"@desc":"protein group PSI angle for the atom's residue","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Gr,level:"atom-test"},radius:{"@desc":'currently displayed radius -- In SELECT command comparisons ("select radius=n"), integer n implies Rasmol units 1/250 Angstroms; in all other cases or when a decimal number is used, the units are Angstroms.',"@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Gr,level:"atom-test"},resno:{"@desc":"PDB residue number, not including insertion code (see also seqcode, below)","@examples":["resno = 100"],regex:/-?[0-9]+/,map:e=>parseInt(e),level:"residue-test",property:os.ammp("auth_seq_id")},selected:{"@desc":"1.0 if atom is selected; 0.0 if not","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Gr,level:"atom-test"},sequence:{"@desc":'PDB one-character sequence code, as a string of characters, with "?" indicated where single-character codes are not available',"@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Gr,level:"atom-test"},seqcode:{"@desc":'PDB residue number, including insertion code (for example, 234^2; "seqcode" option added in Jmol 14.3.16)',"@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Gr,level:"atom-test"},seqid:{"@desc":"(mmCIF only) the value from _atom_site.label_seq_id; a pointer to _entity_poly_seq.num in the ENTITY_POLY_SEQ category specifying the sequence of monomers in a polymer. Allowance is made for the possibility of microheterogeneity in a sample by allowing a given sequence number to be correlated with more than one monomer id. (Jmol 14.2.3)","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Gr,level:"atom-test"},shape:{"@desc":'hybridization geometry such as "tetrahedral"',"@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Gr,level:"atom-test"},site:{"@desc":"crystallographic site number","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Gr,level:"atom-test"},spacefill:{"@desc":"currently displayed radius","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Gr,level:"atom-test"},straightness:{"@desc":'quaternion-derived straightness (second derivative of the quaternion describing the orientation of the residue. This quantity will have different values depending upon the setting of quaternionFrame as "A" (alpha-carbon/phosphorus atom only), "C" (alpha-carbon/pyrimidine or purine base based), "P" (carbonyl-carbon peptide plane/phosphorus tetrahedron based), or "N" (amide-nitrogen based). The default is alpha-carbon based, which corresponds closely to the following combination of Ramachandran angles involving three consecutive residues i-1, i, and i+1: -psii-1 - phii + psii + phii+1.',"@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Gr,level:"atom-test"},strucno:{"@desc":"a unique number for each helix, sheet, or turn in a model, starting with 1.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Gr,level:"atom-test"},structure:{"@desc":'The value of this parameter depends upon the context. Used with select structure=x, x can be either the quoted keyword "none", "turn", "sheet", "helix", "dna", "rna", or "carbohydrate" or a respective number 0-6. In the context {*}.structure, the return value is a number; in the context label %[structure], the return is one of the six keywords.',"@examples":['structure="helix"',"structure=3"],regex:/none|turn|sheet|helix|dna|rna|carbohydrate|[0-6]/i,map:Gr,level:"residue-test",property:"structure"},substructure:{"@desc":'like structure, the value of this parameter depends upon the context. Used with select substructure=x, x can be either the quoted keyword "none", "turn", "sheet", "helix", "dna", "rna", "carbohydrate", "helix310", "helixalpha", or "helixpi", or the respective number 0-9. In the context {*}.substructure, the return value is a number; in the context label %[substructure], the return is one of the nine keywords.',"@examples":['substructure = "alphahelix"',"substructure =9"],regex:/none|turn|sheet|helix|dna|rna|carbohydrate|helix310|helixalpha|helixpi|[0-9]/i,map:Gr,level:"residue-test",property:"structure"},surfacedistance:{"@desc":"A value related to the distance of an atom to a nominal molecular surface. 0 indicates at the surface. Positive numbers are minimum distances in Angstroms from the given atom to the surface.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Gr,level:"atom-test"},symop:{"@desc":'the first symmetry operation code that generated this atom by Jmol; an integer starting with 1. See also symmetry, below. This operator is only present if the file contains space group information and the file was loaded using the {i, j, k} option so as to generate symmetry-based atoms. To select only the original atoms prior to application of symmetry, you can either use "SYMOP=n", where n is the symmetry operator corresponding to "x,y,z", or you can specify instead simply "NOT symmetry" the way you might specify "NOT hydrogen". Note that atoms in special positions will have multiple operator matches. These atoms can be selected using the keyword SPECIALPOSITION. The special form select SYMOP=nijk selects a specific translation of atoms from the given crystallographic symmetry operation. Comparators <, <=, >, >=, and != can be used and only apply to the ijk part of the designation. The ijk are relative, not absolute. Thus, symop=2555 selects for atoms that have been transformed by symop=2 but not subjected to any further translation. select symop=1555 is identical to select not symmetry. All other ijk are relative to these selections for 555. If the model was loaded using load "filename.cif" {444 666 1}, where the 1 indicates that all symmetry-generated atoms are to be packed within cell 555 and then translated to fill the other 26 specified cells, then select symop=3555 is nearly the same as select symop=3 and cell=555. (The difference being that cell=555 selects for all atoms that are on any edge of the cell, while symop=3555 does not.) However, the situation is different if instead the model was loaded using load "filename.cif" {444 666 0}, where the 0 indicates that symmetry-generated atoms are to be placed exactly where their symmetry operator would put them (x,-y,z being different then from x, 1-y, z). In that case, select symop=3555 is for all atoms that have been generated using symmetry operation 3 but have not had any additional translations applied to the x,y,z expression found in the CIF file. If, for example, symmetry operation 3 is -x,-y,-z, then load "filename.cif" {444 666 0} will place an atom originally at {1/2, 1/2, 1/2} at positions {-1/2, -1/2, -1/2} (symop=3555) and {-3/2, -3/2, -3/2} (symop=3444) and 24 other sites.',"@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Gr,level:"atom-test"},symmetry:{"@desc":'as "symmetry" or in a label as lower-case "o" gives list of crystallographic symmetry operators generating this atom with lattice designations,such as 3555; upper-case "%O" in a label gives a list without the lattice designations. See also symop, above.',"@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Gr,level:"atom-test"},temperature:{"@desc":"yes  yes  temperature factor (B-factor)","@examples":["temperature >= 20"],regex:Fp,map:e=>parseFloat(e),level:"atom-test",property:os.ammp("B_iso_or_equiv")},unitXyz:{"@desc":"unit cell XYZ coordinates","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Gr,level:"atom-test"},uX:{"@desc":"unit cell X coordinate normalized to [0,1)","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Gr,level:"atom-test"},uY:{"@desc":"unit cell Y coordinate normalized to [0,1)","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Gr,level:"atom-test"},uZ:{"@desc":"unit cell Z coordinate normalized to [0,1)","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Gr,level:"atom-test"},valence:{"@desc":"the valence of an atom (sum of bonds, where double bond counts as 2 and triple bond counts as 3","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Gr,level:"atom-test"},vanderwaals:{"@desc":"van der Waals radius","@examples":["vanderwaals >2"],regex:Fp,map:e=>parseFloat(e),level:"atom-test",property:os.acp("vdw")},vectorScale:{"@desc":"vibration vector scale","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Gr,level:"atom-test"},volume:{"@desc":"approximate van der Waals volume for this atom. Note, {*}.volume gives an average; use {*}.volume.sum to get total volume.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Gr,level:"atom-test"},vXyz:{"@desc":"vibration vector, or individual components as %vx %vy %vz. For atoms without vibration vectors, {xx}.vXyz is -1; in a label, %[vxyz] is blank.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Gr,level:"atom-test"},vX:{"@desc":"vibration vector X coordinate; for atoms without vibration vector, {xx}.vX is NaN (same for vY and vZ)","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Gr,level:"atom-test"},vY:{"@desc":"vibration vector Y coordinate","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Gr,level:"atom-test"},vZ:{"@desc":"vibration vector Z coordinate","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Gr,level:"atom-test"},xyz:{"@desc":"Cartesian XYZ coordinates; select xyz > 1.0 selects atoms more than one Angstrom from the origin.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Gr,level:"atom-test"}};var y0e=ie,M8=[{"@desc":"Selects atoms that are not included in s1.","@examples":["not ARG"],name:"not",type:wl,rule:Je.alt(Je.regex(/NOT/i).skip(Je.whitespace),Je.string("!").skip(Je.optWhitespace)),map:(e,t)=>cu(t)},{"@desc":"Selects atoms included in both s1 and s2.","@examples":["ASP and .CA"],name:"and",type:sl,rule:kp(/AND|&/i),map:(e,t,r)=>y0e.struct.modifier.intersectBy({0:t,by:r})},{"@desc":"Selects atoms included in either s1 or s2.","@examples":["ASP or GLU"],name:"or",type:sl,rule:kp(/OR|\||,/i),map:(e,t,r)=>y0e.struct.combinator.merge([t,r])}];var He=ie,Wi={acidic:["ASP","GLU"],aliphatic:["ALA","GLY","ILE","LEU","VAL"],amino:["ALA","ARG","ASN","ASP","CYS","GLN","GLU","GLY","HIS","ILE","LEU","LYS","MET","PHE","PRO","SER","THR","TRP","TYR","VAL","ASX","GLX","UNK"],aromatic:["HIS","PHE","TRP","TYR"],basic:["ARG","HIS","LYS"],buried:["ALA","CYS","ILE","LEU","MET","PHE","TRP","VAL"],cg:["CYT","C","GUA","G"],cyclic:["HIS","PHE","PRO","TRP","TYR"],hydrophobic:["ALA","GLY","ILE","LEU","MET","PHE","PRO","TRP","TYR","VAL"],large:["ARG","GLU","GLN","HIS","ILE","LEU","LYS","MET","PHE","TRP","TYR"],medium:["ASN","ASP","CYS","PRO","THR","VAL"],small:["ALA","GLY","SER"],nucleic:["G","C","A","T","U","I","DG","DC","DA","DT","DU","DI","+G","+C","+A","+T","+U","+I"]},b0e={nucleic:["P","O3'","O5'","C5'","C4'","C3'","OP1","OP2","O3*","O5*","C5*","C4*","C3*","C2'","C1'","O4'","O2'"],protein:["C","N","CA"]};function IR(){return He.struct.combinator.merge([He.struct.generator.atomGroups({"residue-test":He.core.set.has([He.set(...Wi.nucleic),He.ammp("label_comp_id")])}),He.struct.filter.pick({0:He.struct.generator.atomGroups({"group-by":He.ammp("residueKey")}),test:He.core.logic.and([He.core.rel.eq([He.struct.atomSet.atomCount(),1]),He.core.rel.eq([He.ammp("label_atom_id"),He.atomName("P")])])}),He.struct.filter.pick({0:He.struct.generator.atomGroups({"group-by":He.ammp("residueKey")}),test:He.core.logic.or([He.core.set.isSubset([Dd(["C1'","C2'","O3'","C3'","C4'","C5'","O5'"]),He.ammpSet("label_atom_id")]),He.core.set.isSubset([Dd(["C1*","C2*","O3*","C3*","C4*","C5*","O5*"]),He.ammpSet("label_atom_id")])])})])}function r$e(){return He.struct.generator.atomGroups({"residue-test":He.core.set.has([He.set(...Wi.amino),He.ammp("label_comp_id")])})}function n$e(){return He.struct.combinator.merge([He.struct.modifier.intersectBy({0:He.struct.generator.atomGroups({"residue-test":He.core.set.has([He.core.type.set(Wi.amino),He.ammp("label_comp_id")])}),by:He.struct.generator.atomGroups({"atom-test":He.core.set.has([He.core.type.set(b0e.protein),He.ammp("label_atom_id")])})}),He.struct.modifier.intersectBy({0:He.struct.generator.atomGroups({"residue-test":He.core.set.has([He.core.type.set(Wi.nucleic),He.ammp("label_comp_id")])}),by:He.struct.generator.atomGroups({"atom-test":He.core.set.has([He.core.type.set(b0e.nucleic),He.ammp("label_atom_id")])})})])}var B8={all:{"@desc":"all atoms; same as *",abbr:["*"],map:()=>He.struct.generator.all()},bonded:{"@desc":"covalently bonded",map:()=>He.struct.generator.atomGroups({"atom-test":He.core.rel.gr([He.struct.atomProperty.core.bondCount({flags:He.struct.type.bondFlags(["covalent","metallic","sulfide"])}),0])})},clickable:{"@desc":"actually visible -- having some visible aspect such as wireframe, spacefill, or a label showing, or the alpha-carbon or phosphorus atom in a biomolecule that is rendered with only cartoon, rocket, or other biomolecule-specific shape."},connected:{"@desc":"bonded in any way, including hydrogen bonds",map:()=>He.struct.generator.atomGroups({"atom-test":He.core.rel.gr([He.struct.atomProperty.core.bondCount({flags:He.struct.type.bondFlags()}),0])})},displayed:{"@desc":"displayed using the display or hide command; not necessarily visible"},hidden:{"@desc":"hidden using the display or hide command"},none:{"@desc":"no atoms",map:()=>He.struct.generator.empty()},selected:{"@desc":"atoms that have been selected; defaults to all when a file is first loaded"},thisModel:{"@desc":'atoms in the current frame set, as defined by frame, model, or animation commands. If more than one model is in this set, "thisModel" refers to all of them, regardless of atom displayed/hidden status.'},visible:{"@desc":"visible in any way, including PDB residue atoms for which a cartoon or other such rendering makes their group visible, even if they themselves are not visible."},subset:{"@desc":"the currently defined subset. Note that if a subset is currently defined, then select/display all is the same as select/display subset, restrict none is the same as restrict not subset. In addition, select not subset selects nothing."},specialPosition:{"@desc":"atoms in crystal structures that are at special positions - that is, for which there is more than one operator that leads to them."},unitcell:{"@desc":"atoms within the current unitcell, which may be offset. This includes atoms on the faces and at the vertices of the unitcell."},polyhedra:{"@desc":"all central atoms for which polyhedra have been created. See also polyhera(n), below. (Jmol 14.4)"},nonmetal:{"@desc":"_H,_He,_B,_C,_N,_O,_F,_Ne,_Si,_P,_S,_Cl,_Ar,_As,_Se,_Br,_Kr,_Te,_I,_Xe,_At,_Rn",map:()=>He.struct.generator.atomGroups({"atom-test":He.core.set.has([He.set(...["H","He","B","C","N","O","F","Ne","Si","P","S","Cl","Ar","As","Se","Br","Kr","Te","I","Xe","At","Rn"].map(He.es)),He.acp("elementSymbol")])})},metal:{"@desc":"!nonmetal",map:()=>He.struct.generator.atomGroups({"atom-test":He.core.logic.not([He.core.set.has([He.set(...["H","He","B","C","N","O","F","Ne","Si","P","S","Cl","Ar","As","Se","Br","Kr","Te","I","Xe","At","Rn"].map(He.es)),He.acp("elementSymbol")])])})},alkaliMetal:{"@desc":"_Li,_Na,_K,_Rb,_Cs,_Fr",map:()=>He.struct.generator.atomGroups({"atom-test":He.core.set.has([He.set(...["Li","Na","K","Rb","Cs","Fr"].map(He.es)),He.acp("elementSymbol")])})},alkalineEarth:{"@desc":"_Be,_Mg,_Ca,_Sr,_Ba,_Ra",map:()=>He.struct.generator.atomGroups({"atom-test":He.core.set.has([He.set(...["Be","Mg","Ca","Sr","Ba","Ra"].map(He.es)),He.acp("elementSymbol")])})},nobleGas:{"@desc":"_He,_Ne,_Ar,_Kr,_Xe,_Rn",map:()=>He.struct.generator.atomGroups({"atom-test":He.core.set.has([He.set(...["He","Ne","Ar","Kr","Xe","Rn"].map(He.es)),He.acp("elementSymbol")])})},metalloid:{"@desc":"_B,_Si,_Ge,_As,_Sb,_Te",map:()=>He.struct.generator.atomGroups({"atom-test":He.core.set.has([He.set(...["B","Si","Ge","As","Sb","Te"].map(He.es)),He.acp("elementSymbol")])})},transitionMetal:{"@desc":"(includes La and Ac) elemno>=21 and elemno<=30, elemno=57, elemno=89, elemno>=39 and elemno<=48, elemno>=72 and elemno<=80, elemno>=104 and elemno<=112",map:()=>He.struct.generator.atomGroups({"atom-test":He.core.logic.or([He.core.rel.inRange([He.acp("atomicNumber"),21,30]),He.core.rel.inRange([He.acp("atomicNumber"),39,48]),He.core.rel.inRange([He.acp("atomicNumber"),72,80]),He.core.rel.inRange([He.acp("atomicNumber"),104,112]),He.core.set.has([He.set(57,89),He.acp("atomicNumber")])])})},lanthanide:{"@desc":"(does not include La) elemno>57 and elemno<=71",map:()=>He.struct.generator.atomGroups({"atom-test":He.core.rel.inRange([He.acp("atomicNumber"),57,71])})},actinide:{"@desc":"(does not include Ac) elemno>89 and elemno<=103",map:()=>He.struct.generator.atomGroups({"atom-test":He.core.rel.inRange([He.acp("atomicNumber"),89,103])})},isaromatic:{"@desc":"atoms connected with the AROMATIC, AROMATICSINGLE, or AROMATICDOUBLE bond types",map:()=>He.struct.generator.atomGroups({"atom-test":He.core.rel.gr([He.struct.atomProperty.core.bondCount({flags:He.struct.type.bondFlags(["aromatic"])}),0])})},carbohydrate:{"@desc":""},ions:{"@desc":'(specifically the PDB designations "PO4" and "SO4")'},ligand:{"@desc":'(originally "hetero and not solvent"; changed to "!(protein,nucleic,water,UREA)" for Jmol 12.2)'},nucleic:{"@desc":`any group that (a) has one of the following group names: G, C, A, T, U, I, DG, DC, DA, DT, DU, DI, +G, +C, +A, +T, +U, +I; or (b) can be identified as a group that is only one atom, with name "P"; or (c) has all of the following atoms (prime, ', can replace * here): C1*, C2*, C3*, O3*, C4*, C5*, and O5*.`,map:()=>IR()},purine:{"@desc":"any nucleic group that (a) has one of the following group names: A, G, I, DA, DG, DI, +A, +G, or +I; or (b) also has atoms N7, C8, and N9.",map:()=>He.struct.modifier.intersectBy({0:IR(),by:He.struct.combinator.merge([He.struct.generator.atomGroups({"residue-test":He.core.set.has([He.set("A","G","I","DA","DG","DI","+A","+G","+I"),He.ammp("label_comp_id")])}),He.struct.filter.pick({0:He.struct.generator.atomGroups({"group-by":He.ammp("residueKey")}),test:He.core.set.isSubset([Dd(["N7","C8","N9"]),He.ammpSet("label_atom_id")])})])})},pyrimidine:{"@desc":"any nucleic group that (a) has one of the following group names: C, T, U, DC, DT, DU, +C, +T, +U; or (b) also has atom O2.",map:()=>He.struct.modifier.intersectBy({0:IR(),by:He.struct.combinator.merge([He.struct.generator.atomGroups({"residue-test":He.core.set.has([He.set("C","T","U","DC","DT","DU","+C","+T","+U"),He.ammp("label_comp_id")])}),He.struct.filter.pick({0:He.struct.generator.atomGroups({"group-by":He.ammp("residueKey")}),test:He.core.logic.or([He.core.set.has([He.ammpSet("label_atom_id"),He.atomName("O2*")]),He.core.set.has([He.ammpSet("label_atom_id"),He.atomName("O2'")])])})])})},dna:{"@desc":"any nucleic group that (a) has one of the following group names: DG, DC, DA, DT, DU, DI, T, +G, +C, +A, +T; or (b) has neither atom O2* or O2'.",map:()=>He.struct.modifier.intersectBy({0:IR(),by:He.struct.combinator.merge([He.struct.generator.atomGroups({"residue-test":He.core.set.has([He.set("DG","DC","DA","DT","DU","DI","T","+G","+C","+A","+T"),He.ammp("label_comp_id")])}),He.struct.filter.pick({0:He.struct.generator.atomGroups({"group-by":He.ammp("residueKey")}),test:He.core.logic.not([He.core.logic.or([He.core.set.has([He.ammpSet("label_atom_id"),He.atomName("O2*")]),He.core.set.has([He.ammpSet("label_atom_id"),He.atomName("O2'")])])])})])})},rna:{"@desc":"any nucleic group that (a) has one of the following group names: G, C, A, U, I, +U, +I; or (b) has atom O2* or O2'.",map:()=>He.struct.modifier.intersectBy({0:IR(),by:He.struct.combinator.merge([He.struct.generator.atomGroups({"residue-test":He.core.set.has([He.set("G","C","A","U","I","+U","+I"),He.ammp("label_comp_id")])}),He.struct.filter.pick({0:He.struct.generator.atomGroups({"group-by":He.ammp("residueKey")}),test:He.core.logic.or([He.core.set.has([He.ammpSet("label_atom_id"),He.atomName("O2*")]),He.core.set.has([He.ammpSet("label_atom_id"),He.atomName("O2'")])])})])})},protein:{"@desc":'defined as a group that (a) has one of the following group names: ALA, ARG, ASN, ASP, CYS, GLN, GLU, GLY, HIS, ILE, LEU, LYS, MET, PHE, PRO, SER, THR, TRP, TYR, VAL, ASX, GLX, or UNK; or (b) contains PDB atom designations [C, O, CA, and N] bonded correctly; or (c) does not contain "O" but contains [C, CA, and N] bonded correctly; or (d) has only one atom, which has name CA and does not have the group name CA (indicating a calcium atom).',map:()=>r$e()},acidic:{"@desc":"ASP GLU",map:()=>Zn(Wi.acidic)},acyclic:{"@desc":"amino and not cyclic",map:()=>He.struct.modifier.intersectBy({0:Zn(Wi.amino),by:cu(Zn(Wi.cyclic))})},aliphatic:{"@desc":"ALA GLY ILE LEU VAL",map:()=>Zn(Wi.aliphatic)},amino:{"@desc":"all twenty standard amino acids, plus ASX, GLX, UNK",map:()=>Zn(Wi.amino)},aromatic:{"@desc":'HIS PHE TRP TYR (see also "isaromatic" for aromatic bonds)',map:()=>Zn(Wi.aromatic)},basic:{"@desc":"ARG HIS LYS",map:()=>Zn(Wi.basic)},buried:{"@desc":"ALA CYS ILE LEU MET PHE TRP VAL",map:()=>Zn(Wi.buried)},charged:{"@desc":"same as acidic or basic -- ASP GLU, ARG HIS LYS",map:()=>Zn(Wi.acidic.concat(Wi.basic))},cyclic:{"@desc":"HIS PHE PRO TRP TYR",map:()=>Zn(Wi.cyclic)},helix:{"@desc":"secondary structure-related.",map:()=>He.struct.generator.atomGroups({"residue-test":He.core.flags.hasAny([He.struct.type.secondaryStructureFlags(["helix"]),He.ammp("secondaryStructureFlags")])})},helixalpha:{"@desc":"secondary structure-related.",map:()=>He.struct.generator.atomGroups({"residue-test":He.core.flags.hasAny([He.struct.type.secondaryStructureFlags(["alpha"]),He.ammp("secondaryStructureFlags")])})},helix310:{"@desc":"secondary structure-related.",map:()=>He.struct.generator.atomGroups({"residue-test":He.core.flags.hasAny([He.struct.type.secondaryStructureFlags(["3-10"]),He.ammp("secondaryStructureFlags")])})},helixpi:{"@desc":"secondary structure-related.",map:()=>He.struct.generator.atomGroups({"residue-test":He.core.flags.hasAny([He.struct.type.secondaryStructureFlags(["pi"]),He.ammp("secondaryStructureFlags")])})},hetero:{"@desc":"PDB atoms designated as HETATM",map:()=>He.struct.generator.atomGroups({"atom-test":He.ammp("isHet")})},hydrophobic:{"@desc":"ALA GLY ILE LEU MET PHE PRO TRP TYR VAL",map:()=>Zn(Wi.hydrophobic)},large:{"@desc":"ARG GLU GLN HIS ILE LEU LYS MET PHE TRP TYR",map:()=>Zn(Wi.large)},medium:{"@desc":"ASN ASP CYS PRO THR VAL",map:()=>Zn(Wi.medium)},negative:{"@desc":"same as acidic -- ASP GLU",map:()=>Zn(Wi.acidic)},neutral:{"@desc":"amino and not (acidic or basic)",map:()=>He.struct.modifier.intersectBy({0:Zn(Wi.amino),by:cu(Zn(Wi.acidic.concat(Wi.basic)))})},polar:{"@desc":"amino and not hydrophobic",map:()=>He.struct.modifier.intersectBy({0:Zn(Wi.amino),by:cu(Zn(Wi.hydrophobic))})},positive:{"@desc":"same as basic -- ARG HIS LYS",map:()=>Zn(Wi.basic)},sheet:{"@desc":"secondary structure-related",map:()=>He.struct.generator.atomGroups({"residue-test":He.core.flags.hasAny([He.struct.type.secondaryStructureFlags(["sheet"]),He.ammp("secondaryStructureFlags")])})},small:{"@desc":"ALA GLY SER",map:()=>Zn(Wi.small)},surface:{"@desc":"amino and not buried",map:()=>He.struct.modifier.intersectBy({0:Zn(Wi.amino),by:cu(Zn(Wi.buried))})},turn:{"@desc":"secondary structure-related",map:()=>He.struct.generator.atomGroups({"residue-test":He.core.flags.hasAny([He.struct.type.secondaryStructureFlags(["turn"]),He.ammp("secondaryStructureFlags")])})},alpha:{"@desc":"(*.CA)",map:()=>He.struct.generator.atomGroups({"atom-test":He.core.rel.eq([He.atomName("CA"),He.ammp("label_atom_id")])})},base:{"@desc":"(nucleic bases)"},backbone:{"@desc":"(*.C, *.CA, *.N, and all nucleic other than the bases themselves)",abbr:["mainchain"],map:()=>n$e()},sidechain:{"@desc":"((protein or nucleic) and not backbone)"},spine:{"@desc":"(*.CA, *.N, *.C for proteins; *.P, *.O3', *.O5', *.C3', *.C4', *.C5 for nucleic acids)"},leadatom:{"@desc":"(*.CA, *.P, and terminal *.O5')"},solvent:{"@desc":'PDB "HOH", water, also the connected set of H-O-H in any model'}};var In=ie,o$e=[{"@desc":"value comparisons","@examples":[],name:"=",abbr:["=="],type:sl,rule:Je.regexp(/\s*(LIKE|>=|<=|=|!=|>|<)\s*/i,1),map:(e,t,r)=>{let n;if(t==="structure"?n=In.core.flags.hasAny([In.ammp("secondaryStructureFlags"),D8(r)]):r==="structure"?n=In.core.flags.hasAny([In.ammp("secondaryStructureFlags"),D8(t)]):t.head!==void 0?t.head.name==="core.type.regex"&&(n=In.core.str.match([t,In.core.type.str([r])])):r.head!==void 0?r.head.name==="core.type.regex"&&(n=In.core.str.match([r,In.core.type.str([t])])):e.toUpperCase()==="LIKE"&&(t.head?n=In.core.str.match([In.core.type.regex([`^${r}$`,"i"]),In.core.type.str([t])]):n=In.core.str.match([In.core.type.regex([`^${t}$`,"i"]),In.core.type.str([r])])),!n)switch(t.head&&(r=KS(t,r)),r.head&&(t=KS(r,t)),e){case"=":n=In.core.rel.eq([t,r]);break;case"!=":n=In.core.rel.neq([t,r]);break;case">":n=In.core.rel.gr([t,r]);break;case"<":n=In.core.rel.lt([t,r]);break;case">=":n=In.core.rel.gre([t,r]);break;case"<=":n=In.core.rel.lte([t,r]);break;default:throw new Error(`value operator '${e}' not supported`)}return In.struct.generator.atomGroups({"atom-test":n})}}];function i$e(e){let[t,r,n,o,i,a,s]=e[1],l={};i&&(l["chain-test"]=In.core.rel.eq([In.ammp("auth_asym_id"),i]));let u=[];t&&u.push(In.core.rel.eq([In.ammp("label_comp_id"),t])),r&&u.push(In.core.logic.and([In.core.rel.gre([In.ammp("auth_seq_id"),r[0]]),In.core.rel.lte([In.ammp("auth_seq_id"),r[1]])])),n&&u.push(In.core.rel.eq([In.ammp("auth_seq_id"),n])),o&&u.push(In.core.rel.eq([In.ammp("pdbx_PDB_ins_code"),o])),u.length&&(l["residue-test"]=CR(u));let c=[];return a&&c.push(In.core.rel.eq([In.ammp("auth_atom_id"),a])),s&&c.push(In.core.rel.eq([In.ammp("label_alt_id"),s])),c.length&&(l["atom-test"]=CR(c)),In.struct.generator.atomGroups(l)}var a$e=Je.createLanguage({Integer:()=>Je.regexp(/-?[0-9]+/).map(Number).desc("integer"),Parens:function(e){return Je.alt(e.Parens,e.Operator,e.Expression).wrap(Je.regexp(/\(\s*/),Je.regexp(/\s*\)/))},Expression:function(e){return Je.alt(e.Keywords,e.AtomExpression.map(i$e),e.Within.map(t=>In.struct.modifier.includeSurroundings({0:t[1],radius:t[0]})),e.ValueQuery,e.Element.map(t=>In.struct.generator.atomGroups({"atom-test":In.core.rel.eq([In.acp("elementSymbol"),In.struct.type.elementSymbol(t)])})),e.Resname.map(t=>In.struct.generator.atomGroups({"residue-test":In.core.rel.eq([In.ammp("label_comp_id"),t])})))},Operator:function(e){return TC(M8,Je.alt(e.Parens,e.Expression))},AtomExpression:function(e){return Je.seq(Je.lookahead(e.AtomPrefix),Je.seq(e.BracketedResname.or(Je.of(null)),e.ResnoRange.or(Je.of(null)),e.Resno.or(Je.of(null)),e.Inscode.or(Je.of(null)),e.Chainname.or(Je.of(null)),e.Atomname.or(Je.of(null)),e.Altloc.or(Je.of(null)),e.Model.or(Je.of(null)))).desc("expression")},AtomPrefix:()=>Je.regexp(/[\[0-9:^%/.-]/).desc("atom-prefix"),Chainname:()=>Je.regexp(/:([A-Za-z]{1,3})/,1).desc("chainname"),Model:()=>Je.regexp(/\/([0-9]+)/,1).map(Number).desc("model"),Element:()=>Je.regexp(/_([A-Za-z]{1,3})/,1).desc("element"),Atomname:()=>Je.regexp(/\.([a-zA-Z0-9]{1,4})/,1).map(In.atomName).desc("atomname"),Resname:()=>Je.regexp(/[a-zA-Z0-9]{1,4}/).desc("resname"),Resno:e=>e.Integer.desc("resno"),Altloc:()=>Je.regexp(/%([a-zA-Z0-9])/,1).desc("altloc"),Inscode:()=>Je.regexp(/\^([a-zA-Z0-9])/,1).desc("inscode"),BracketedResname:()=>Je.regexp(/\[([a-zA-Z0-9]{1,4})\]/,1).desc("bracketed-resname"),ResnoRange:e=>Je.seq(e.Integer.skip(Je.seq(Je.optWhitespace,Je.string("-"),Je.optWhitespace)),e.Integer).desc("resno-range"),Within:e=>Je.regexp(/within/i).skip(Je.regexp(/\s*\(\s*/)).then(Je.seq(e.Integer.skip(Je.regexp(/\s*,\s*/)),e.Query)).skip(Je.regexp(/\)/)),Keywords:()=>Je.alt(...mA(B8)).desc("keyword"),Query:function(e){return Je.alt(e.Operator,e.Parens,e.Expression).trim(Je.optWhitespace)},Number:function(){return Je.regexp(/-?(0|[1-9][0-9]*)([.][0-9]+)?([eE][+-]?[0-9]+)?/).map(Number).desc("number")},String:function(){let e=dA(w8,B8,M8).sort(jm).map(wy).join("|");return Je.alt(Je.regexp(new RegExp(`(?!(${e}))[A-Z0-9_]+`,"i")),Je.regexp(/'((?:[^"\\]|\\.)*)'/,1),Je.regexp(/"((?:[^"\\]|\\.)*)"/,1).map(t=>In.core.type.regex([`^${t}$`,"i"]))).desc("string")},Value:function(e){return Je.alt(e.Number,e.String)},ValueParens:function(e){return Je.alt(e.ValueParens,e.ValueOperator,e.ValueExpressions).wrap(Je.string("("),Je.string(")"))},ValuePropertyNames:function(){return Je.alt(...SR(w8,/LIKE|>=|<=|=|!=|>|<|\)|\s/i))},ValueOperator:function(e){return TC(o$e,Je.alt(e.ValueParens,e.ValueExpressions))},ValueExpressions:function(e){return Je.alt(e.Value,e.ValuePropertyNames)},ValueQuery:function(e){return Je.alt(e.ValueOperator.map(t=>{if(t.head){if(t.head.name.startsWith("structure-query.generator"))return t}else if(typeof t=="string"&&t.length<=4)return In.struct.generator.atomGroups({"residue-test":In.core.rel.eq([In.ammp("label_comp_id"),t])});throw new Error(`values must be part of an comparison, value '${t}'`)}))}}),x0e=e=>a$e.Query.tryParse(e);var mu=ie,PF=/[-+]?[0-9]*\.?[0-9]+/;function s$e(e){return e.split("+").map(mu.atomName)}function pA(e){return e.split("+").map(t=>t.replace(/^["']|["']$/g,""))}function E8(e){if(e.includes("-")&&e.includes("+")){let t=e.split("+").map(n=>n.replace(/^["']|["']$/g,"")),r=[];return t.forEach(n=>{if(n.includes("-")&&!n.startsWith("-")){let[o,i]=n.split("-").map(a=>parseInt(a));for(let a=o;a<=i;a++)r.push(a)}else if(n.includes("-")&&n.startsWith("-")&&n.match(/[0-9]+-[-0-9]+/)){let o=-parseInt(n.split("-")[1]),i;n.includes("--")?i=-parseInt(n.split("-")[3]):i=parseInt(n.split("-")[2]);for(let a=o;a<=i;a++)r.push(a)}else n.includes("-")&&n.startsWith("-")&&n.match(/[0-9]+-[-0-9]+/),r.push(parseInt(n))}),r}else if(e.includes("-")&&!e.includes("+")){let t=[];if(e.startsWith("-"))if(e.startsWith("-")&&e.match(/[0-9]+-[-0-9]+/)){let r=-parseInt(e.split("-")[1]),n;e.includes("--")?n=-parseInt(e.split("-")[3]):n=parseInt(e.split("-")[2]);for(let o=r;o<=n;o++)t.push(o)}else e.startsWith("-")&&e.match(/[0-9]+-[-0-9]+/),t.push(parseInt(e));else{let[r,n]=e.split("-").map(o=>parseInt(o));for(let o=r;o<=n;o++)t.push(o)}return t}else return!e.includes("-")&&e.includes("+")?pA(e).map(t=>parseInt(t)):[parseInt(e)]}function l$e(e){return e.split("+").map(mu.struct.type.elementSymbol)}var u$e={H:"helix",S:"beta",L:"none"};function c$e(e){return{flags:mu.struct.type.secondaryStructureFlags(e.toUpperCase().split("+").map(t=>u$e[t]||"none"))}}var AR={symbol:{"@desc":"chemical-symbol-list: list of 1- or 2-letter chemical symbols from the periodic table","@examples":["symbol O+N"],abbr:["e."],regex:/[a-zA-Z'"+]+/,map:l$e,level:"atom-test",property:mu.acp("elementSymbol")},name:{"@desc":"atom-name-list: list of up to 4-letter codes for atoms in proteins or nucleic acids","@examples":["name CA+CB+CG+CD"],abbr:["n."],regex:/[a-zA-Z0-9'"+]+/,map:s$e,level:"atom-test",property:mu.ammp("label_atom_id")},resn:{"@desc":"residue-name-list: list of 3-letter codes for amino acids or list of up to 2-letter codes for nucleic acids","@examples":["resn ASP+GLU+ASN+GLN","resn A+G"],abbr:["resname","r."],regex:/[a-zA-Z0-9'"+]+/,map:pA,level:"residue-test",property:mu.ammp("label_comp_id")},resi:{"@desc":"residue-identifier-list list of up to 4-digit residue numbers or residue-identifier-range","@examples":["resi 1+10+100+1000","resi 1-10"],abbr:["resident","residue","resid","i."],regex:/[0-9+-]+/,map:E8,level:"residue-test",property:mu.ammp("auth_seq_id")},alt:{"@desc":"alternate-conformation-identifier-list list of single letters","@examples":["alt A+B",'alt ""','alt ""+A'],abbr:[],regex:/[a-zA-Z0-9'"+]+/,map:pA,level:"atom-test",property:mu.ammp("label_alt_id")},chain:{"@desc":"chain-identifier-list list of single letters or sometimes numbers","@examples":["chain A"],abbr:["c."],regex:/[a-zA-Z0-9'"+]+/,map:pA,level:"chain-test",property:mu.ammp("auth_asym_id")},segi:{"@desc":"segment-identifier-list list of up to 4 letter identifiers","@examples":["segi lig"],abbr:["segid","s."],regex:/[a-zA-Z0-9'"+]+/,map:pA,level:"chain-test",property:mu.ammp("label_asym_id")},flag:{"@desc":"flag-number a single integer from 0 to 31","@examples":["flag 0"],isUnsupported:!0,abbr:["f."],regex:/[0-9]+/,map:e=>parseInt(e),level:"atom-test"},numeric_type:{"@desc":"type-number a single integer","@examples":["nt. 5"],isUnsupported:!0,abbr:["nt."],regex:/[0-9]+/,map:e=>parseInt(e),level:"atom-test"},text_type:{"@desc":"type-string a list of up to 4 letter codes","@examples":["text_type HA+HC"],isUnsupported:!0,abbr:["tt."],regex:/[a-zA-Z0-9'"+]+/,map:pA,level:"atom-test"},id:{"@desc":"external-index-number a single integer","@examples":["id 23"],regex:/[0-9+-]+/,map:E8,level:"atom-test",property:mu.ammp("id")},index:{"@desc":"internal-index-number a single integer","@examples":["index 11"],regex:/[0-9+-]+/,map:E8,level:"atom-test",property:mu.ammp("id")},ss:{"@desc":"secondary-structure-type list of single letters. Helical regions should be assigned H and sheet regions S. Loop regions can either be assigned L or be blank.","@examples":["ss H+S+L",'ss S+""'],abbr:[],regex:/[a-zA-Z'"+]+/,map:c$e,level:"residue-test",property:mu.ammp("secondaryStructureFlags")},b:{"@desc":"comparison-operator b-factor-value a real number","@examples":["b > 10"],isNumeric:!0,abbr:[],regex:PF,map:e=>parseFloat(e),level:"atom-test",property:mu.ammp("B_iso_or_equiv")},q:{"@desc":"comparison-operator occupancy-value a real number","@examples":["q <0.50"],isNumeric:!0,abbr:[],regex:PF,map:e=>parseFloat(e),level:"atom-test",property:mu.ammp("occupancy")},formal_charge:{"@desc":"comparison-operator formal charge-value an integer","@examples":["fc. = -1"],isNumeric:!0,abbr:["fc."],regex:PF,map:e=>parseFloat(e),level:"atom-test",property:mu.ammp("pdbx_formal_charge")},partial_charge:{"@desc":"comparison-operator partial charge-value a real number","@examples":["pc. > 1"],isUnsupported:!0,isNumeric:!0,abbr:["pc."],regex:PF,map:e=>parseFloat(e),level:"atom-test"},elem:{"@desc":'str  atomic element symbol string ("X" if undefined)',"@examples":["elem N"],regex:/[a-zA-Z0-9]{1,3}/,map:e=>mu.es(e),level:"atom-test",property:mu.acp("elementSymbol")}};var cn=ie,k8=[{"@desc":"Selects atoms that are not included in s1.","@examples":["NOT resn ALA","not (resi 42 or chain A)","!resi 42 or chain A"],name:"not",type:wl,rule:Je.alt(Je.regexp(/NOT/i).skip(Je.whitespace),Je.string("!").skip(Je.optWhitespace)),map:(e,t)=>cu(t)},{"@desc":"Selects atoms included in both s1 and s2.","@examples":["chain A AND name CA"],name:"and",type:sl,rule:kp(/AND|&/i),map:(e,t,r)=>cn.struct.modifier.intersectBy({0:t,by:r})},{"@desc":"Selects atoms included in either s1 or s2.","@examples":["chain A OR chain B"],name:"or",type:sl,rule:kp(/OR|\|/i),map:(e,t,r)=>cn.struct.combinator.merge([t,r])},{"@desc":"Selects atoms in s1 whose identifiers name, resi, resn, chain and segi all match atoms in s2.","@examples":["chain A IN chain B"],name:"in",type:sl,rule:kp(/IN/i),map:(e,t,r)=>cn.struct.filter.withSameAtomProperties({0:t,source:r,property:cn.core.type.compositeKey([cn.ammp("label_atom_id"),cn.ammp("label_seq_id"),cn.ammp("label_comp_id"),cn.ammp("auth_asym_id"),cn.ammp("label_asym_id")])})},{"@desc":"Selects atoms in s1 whose identifiers name and resi match atoms in s2.","@examples":["chain A LIKE chain B"],name:"like",type:sl,rule:kp(/LIKE|l\./i),map:(e,t,r)=>cn.struct.filter.withSameAtomProperties({0:t,source:r,property:cn.core.type.compositeKey([cn.ammp("label_atom_id"),cn.ammp("label_seq_id")])})},{"@desc":"Selects all atoms whose van der Waals radii are separated from the van der Waals radii of s1 by a minimum of X Angstroms.","@examples":["solvent GAP 2"],name:"gap",type:bR,rule:xR(/GAP\s+([-+]?[0-9]*\.?[0-9]+)/i,1).map(e=>parseFloat(e)),map:(e,t)=>cn.struct.filter.within({0:cn.struct.generator.all(),target:t,"atom-radius":cn.acp("vdw"),"max-radius":e,invert:!0})},{"@desc":"Selects atoms with centers within X Angstroms of the center of any atom in s1.","@examples":["resname LIG AROUND 1"],name:"around",abbr:["a."],type:bR,rule:xR(/(AROUND|a\.)\s+([-+]?[0-9]*\.?[0-9]+)/i,2).map(e=>parseFloat(e)),map:(e,t)=>cn.struct.modifier.exceptBy({0:cn.struct.filter.within({0:cn.struct.generator.all(),target:t,"max-radius":e}),by:t})},{"@desc":"Expands s1 by all atoms within X Angstroms of the center of any atom in s1.","@examples":["chain A EXPAND 3"],name:"expand",abbr:["x."],type:bR,rule:xR(/(EXPAND|x\.)\s+([-+]?[0-9]*\.?[0-9]+)/i,2).map(e=>parseFloat(e)),map:(e,t)=>cn.struct.modifier.includeSurroundings({0:t,radius:e})},{"@desc":"Selects atoms in s1 that are within X Angstroms of any atom in s2.","@examples":["chain A WITHIN 3 OF chain B"],name:"within",abbr:["w."],type:sl,rule:AF("WITHIN","w."),map:(e,t,r)=>cn.struct.filter.within({0:t,target:r,"max-radius":e})},{"@desc":"Same as within, but excludes s2 from the selection (and thus is identical to s1 and s2 around X).","@examples":["chain A NEAR_TO 3 OF chain B"],name:"near_to",abbr:["nto."],type:sl,rule:AF("NEAR_TO","nto."),map:(e,t,r)=>cn.struct.modifier.exceptBy({0:cn.struct.filter.within({0:t,target:r,"max-radius":e}),by:r})},{"@desc":"Selects atoms in s1 that are at least X Anstroms away from s2.","@examples":["solvent BEYOND 2 OF chain A"],name:"beyond",abbr:["be."],type:sl,rule:AF("BEYOND","be."),map:(e,t,r)=>cn.struct.modifier.exceptBy({0:cn.struct.filter.within({0:t,target:r,"max-radius":e,invert:!0}),by:r})},{"@desc":"Expands selection to complete residues.","@examples":["BYRESIDUE name N"],name:"byresidue",abbr:["byresi","byres","br."],type:wl,rule:Jc(/BYRESIDUE|byresi|byres|br\./i),map:(e,t)=>wd(cn.struct.modifier.expandProperty({0:cn.struct.modifier.union({0:t}),property:cn.ammp("residueKey")}))},{"@desc":"Completely selects all alpha carbons in all residues covered by a selection.","@examples":["BYCALPHA chain A"],name:"bycalpha",abbr:["bca."],type:wl,rule:Jc(/BYCALPHA|bca\./i),map:(e,t)=>cn.struct.generator.queryInSelection({0:cn.struct.modifier.expandProperty({0:cn.struct.modifier.union({0:t}),property:cn.ammp("residueKey")}),query:cn.struct.generator.atomGroups({"atom-test":cn.core.rel.eq([cn.atomName("CA"),cn.ammp("label_atom_id")])})})},{"@desc":"Expands selection to complete molecules.","@examples":["BYMOLECULE resi 20-30"],name:"bymolecule",isUnsupported:!0,abbr:["bymol","bm."],type:wl,rule:Jc(/BYMOLECULE|bymol|bm\./i),map:(e,t)=>wd(cn.struct.modifier.expandProperty({0:cn.struct.modifier.union({0:t}),property:cn.atp("connectedComponentKey")}))},{"@desc":"Expands selection to complete fragments.","@examples":["BYFRAGMENT resi 10"],name:"byfragment",abbr:["byfrag","bf."],isUnsupported:!0,type:wl,rule:Jc(/BYFRAGMENT|byfrag|bf\./i),map:(e,t)=>[e,t]},{"@desc":"Expands selection to complete segments.","@examples":["BYSEGMENT resn CYS"],name:"bysegment",abbr:["bysegi","byseg","bs."],type:wl,rule:Jc(/BYSEGMENT|bysegi|byseg|bs\./i),map:(e,t)=>wd(cn.struct.modifier.expandProperty({0:cn.struct.modifier.union({0:t}),property:cn.ammp("chainKey")}))},{"@desc":"Expands selection to complete objects.","@examples":["BYOBJECT chain A"],name:"byobject",abbr:["byobj","bo."],isUnsupported:!0,type:wl,rule:Jc(/BYOBJECT|byobj|bo\./i),map:(e,t)=>[e,t]},{"@desc":"Expands selection to unit cell.","@examples":["BYCELL chain A"],name:"bycell",isUnsupported:!0,type:wl,rule:Jc(/BYCELL/i),map:(e,t)=>[e,t]},{"@desc":"All rings of size \u2264 7 which have at least one atom in s1.","@examples":["BYRING resn HEM"],name:"byring",type:wl,rule:Jc(/BYRING/i),map:(e,t)=>wd(cn.struct.modifier.intersectBy({0:cn.struct.filter.pick({0:cn.struct.generator.rings(),test:cn.core.logic.and([cn.core.rel.lte([cn.struct.atomSet.atomCount(),7]),cn.core.rel.gr([cn.struct.atomSet.countQuery([t]),1])])}),by:t}))},{"@desc":"Selects atoms directly bonded to s1, excludes s1.","@examples":["NEIGHBOR resn CYS"],name:"neighbor",type:wl,abbr:["nbr."],rule:Jc(/NEIGHBOR|nbr\./i),map:(e,t)=>cn.struct.modifier.exceptBy({0:wd(cn.struct.modifier.includeConnected({0:cn.struct.modifier.union({0:t}),"bond-test":!0})),by:t})},{"@desc":"Selects atoms directly bonded to s1, may include s1.","@examples":["BOUND_TO name CA"],name:"bound_to",abbr:["bto."],type:wl,rule:Jc(/BOUND_TO|bto\./i),map:(e,t)=>wd(cn.struct.modifier.includeConnected({0:cn.struct.modifier.union({0:t})}))},{"@desc":"Extends s1 by X bonds connected to atoms in s1.","@examples":["resname LIG EXTEND 3"],name:"extend",abbr:["xt."],type:bR,rule:xR(/(EXTEND|xt\.)\s+([0-9]+)/i,2).map(e=>parseInt(e)),map:(e,t)=>wd(cn.struct.modifier.includeConnected({0:cn.struct.modifier.union({0:t}),"bond-test":!0,"layer-count":e}))}];var Jt=ie,dc={nucleic:["A","C","T","G","U","DA","DC","DT","DG","DU"],protein:["ALA","ARG","ASN","ASP","CYS","CYX","GLN","GLU","GLY","HIS","HID","HIE","HIP","ILE","LEU","LYS","MET","MSE","PHE","PRO","SER","THR","TRP","TYR","VAL"],solvent:["HOH","WAT","H20","TIP","SOL"]},C0e={nucleic:["P","O3'","O5'","C5'","C4'","C3'","OP1","OP2","O3*","O5*","C5*","C4*","C3*","C2'","C1'","O4'","O2'"],protein:["C","N","CA","O"]};function S0e(){return Jt.struct.combinator.merge([Jt.struct.modifier.intersectBy({0:Jt.struct.generator.atomGroups({"residue-test":Jt.core.set.has([Jt.core.type.set(dc.protein),Jt.ammp("label_comp_id")])}),by:Jt.struct.generator.atomGroups({"atom-test":Jt.core.set.has([Jt.core.type.set(C0e.protein),Jt.ammp("label_atom_id")])})}),Jt.struct.modifier.intersectBy({0:Jt.struct.generator.atomGroups({"residue-test":Jt.core.set.has([Jt.core.type.set(dc.nucleic),Jt.ammp("label_comp_id")])}),by:Jt.struct.generator.atomGroups({"atom-test":Jt.core.set.has([Jt.core.type.set(C0e.nucleic),Jt.ammp("label_atom_id")])})})])}var F8={all:{"@desc":"All atoms currently loaded into PyMOL",abbr:["*"],map:()=>Jt.struct.generator.all()},none:{"@desc":"No atoms (empty selection)",map:()=>Jt.struct.generator.empty()},hydrogens:{"@desc":"All hydrogen atoms currently loaded into PyMOL",abbr:["hydro","h."],map:()=>Jt.struct.generator.atomGroups({"atom-test":Jt.core.rel.eq([Jt.acp("elementSymbol"),Jt.es("H")])})},hetatm:{"@desc":"All atoms loaded from Protein Data Bank HETATM records",abbr:["het"],map:()=>Jt.struct.generator.atomGroups({"atom-test":Jt.core.rel.eq([Jt.ammp("isHet"),!0])})},visible:{"@desc":"All atoms in enabled objects with at least one visible representation",abbr:["v."]},polymer:{"@desc":"All atoms on the polymer (not het). Finds atoms with residue identifiers matching a known polymer, such a peptide and DNA.",abbr:["pol."],map:()=>Jt.struct.generator.atomGroups({"residue-test":Jt.core.set.has([Jt.core.type.set(dc.nucleic.concat(dc.protein)),Jt.ammp("label_comp_id")])})},sidechain:{"@desc":"Polymer non-backbone atoms (new in PyMOL 1.6.1)",abbr:["sc."],map:()=>Jt.struct.modifier.exceptBy({0:Jt.struct.generator.atomGroups({"residue-test":Jt.core.set.has([Jt.core.type.set(dc.nucleic.concat(dc.protein)),Jt.ammp("label_comp_id")])}),by:S0e()})},present:{"@desc":"All atoms with defined coordinates in the current state (used in creating movies)",abbr:["pr."]},center:{"@desc":"Pseudo-atom at the center of the scene"},origin:{"@desc":"Pseudo-atom at the origin of rotation"},enabled:{"@desc":"All enabled objects or selections from the object list."},masked:{"@desc":"All masked atoms.",abbr:["msk."]},protected:{"@desc":"All protected atoms.",abbr:["pr."]},bonded:{"@desc":"All bonded atoms",map:()=>Jt.struct.generator.atomGroups({"atom-test":Jt.core.rel.gr([Jt.struct.atomProperty.core.bondCount({flags:Jt.struct.type.bondFlags(["covalent","metallic","sulfide"])}),0])})},donors:{"@desc":"All hydrogen bond donor atoms.",abbr:["don."]},acceptors:{"@desc":"All hydrogen bond acceptor atoms.",abbr:["acc."]},fixed:{"@desc":"All fixed atoms.",abbr:["fxd."]},restrained:{"@desc":"All restrained atoms.",abbr:["rst."]},organic:{"@desc":"All atoms in non-polymer organic compounds (e.g. ligands, buffers). Finds carbon-containing molecules that do not match known polymers.",abbr:["org."],map:()=>wd(Jt.struct.modifier.expandProperty({0:Jt.struct.modifier.union([Jt.struct.generator.queryInSelection({0:Jt.struct.generator.atomGroups({"residue-test":Jt.core.logic.not([Jt.core.set.has([Jt.core.type.set(dc.nucleic.concat(dc.protein)),Jt.ammp("label_comp_id")])])}),query:Jt.struct.generator.atomGroups({"atom-test":Jt.core.rel.eq([Jt.es("C"),Jt.acp("elementSymbol")])})})]),property:Jt.ammp("residueKey")}))},inorganic:{"@desc":"All non-polymer inorganic atoms/ions. Finds atoms in molecules that do not contain carbon and do not match any known solvent residues.",abbr:["ino."],map:()=>wd(Jt.struct.modifier.expandProperty({0:Jt.struct.modifier.union([Jt.struct.filter.pick({0:Jt.struct.generator.atomGroups({"residue-test":Jt.core.logic.not([Jt.core.set.has([Jt.core.type.set(dc.nucleic.concat(dc.protein).concat(dc.solvent)),Jt.ammp("label_comp_id")])]),"group-by":Jt.ammp("residueKey")}),test:Jt.core.logic.not([Jt.core.set.has([Jt.struct.atomSet.propertySet([Jt.acp("elementSymbol")]),Jt.es("C")])])})]),property:Jt.ammp("residueKey")}))},solvent:{"@desc":"All water molecules. The hardcoded solvent residue identifiers are currently: HOH, WAT, H20, TIP, SOL.",abbr:["sol."],map:()=>Jt.struct.generator.atomGroups({"residue-test":Jt.core.set.has([Jt.core.type.set(dc.solvent),Jt.ammp("label_comp_id")])})},guide:{"@desc":"All protein CA and nucleic acid C4*/C4",map:()=>Jt.struct.combinator.merge([Jt.struct.generator.atomGroups({"atom-test":Jt.core.rel.eq([Jt.atomName("CA"),Jt.ammp("label_atom_id")]),"residue-test":Jt.core.set.has([Jt.core.type.set(dc.protein),Jt.ammp("label_comp_id")])}),Jt.struct.generator.atomGroups({"atom-test":Jt.core.set.has([Dd(["C4*","C4'"]),Jt.ammp("label_atom_id")]),"residue-test":Jt.core.set.has([Jt.core.type.set(dc.nucleic),Jt.ammp("label_comp_id")])})])},metals:{"@desc":"All metal atoms (new in PyMOL 1.6.1)"},backbone:{"@desc":"Polymer backbone atoms (new in PyMOL 1.6.1)",abbr:["bb."],map:()=>S0e()},"polymer.protein":{"@desc":"Protein (New in PyMOL 2.1)",abbr:["polymer.protein"],map:()=>Jt.struct.generator.atomGroups({"residue-test":Jt.core.set.has([Jt.core.type.set(dc.protein),Jt.ammp("label_comp_id")])})},"polymer.nucleic":{"@desc":"Nucleic Acid (New in PyMOL 2.1)",abbr:["polymer.nucleic"],map:()=>Jt.struct.generator.atomGroups({"residue-test":Jt.core.set.has([Jt.core.type.set(dc.nucleic),Jt.ammp("label_comp_id")])})}};var m$e=ie,is=p0e(AR),Is=Je.string("/");function Vi(e){return e.or(Je.of(null))}function d$e(e){let t={},r={};for(let n in e){let o=AR[n];if(!o)throw new Error(`property '${n}' not supported, value '${e[n]}'`);e[n]!==null&&(r[o.level]||(r[o.level]=[]),r[o.level].push(e[n]))}for(let n in r)t[n]=CR(r[n]);return m$e.struct.generator.atomGroups(t)}var p$e=Je.createLanguage({Parens:function(e){return Je.alt(e.Parens,e.Operator,e.Expression).wrap(Je.string("("),Je.string(")"))},Expression:function(e){return Je.alt(e.Keywords,e.AtomSelectionMacro.map(d$e),e.NamedAtomProperties,e.Pepseq,e.Rep,e.Object)},AtomSelectionMacro:function(e){return Je.alt(Is.then(Je.alt(Je.seq(Vi(e.ObjectProperty).skip(Is),Vi(is.segi).skip(Is),Vi(is.chain).skip(Is),Vi(is.resi).skip(Is),Vi(is.name)).map(t=>({object:t[0],segi:t[1],chain:t[2],resi:t[3],name:t[4]})),Je.seq(Vi(e.ObjectProperty).skip(Is),Vi(is.segi).skip(Is),Vi(is.chain).skip(Is),Vi(is.resi)).map(t=>({object:t[0],segi:t[1],chain:t[2],resi:t[3]})),Je.seq(Vi(e.ObjectProperty).skip(Is),Vi(is.segi).skip(Is),Vi(is.chain)).map(t=>({object:t[0],segi:t[1],chain:t[2]})),Je.seq(Vi(e.ObjectProperty).skip(Is),Vi(is.segi)).map(t=>({object:t[0],segi:t[1]})),Je.seq(Vi(e.ObjectProperty)).map(t=>({object:t[0]})))),Je.alt(Je.seq(Vi(e.ObjectProperty).skip(Is),Vi(is.segi).skip(Is),Vi(is.chain).skip(Is),Vi(is.resi).skip(Is),Vi(is.name)).map(t=>({object:t[0],segi:t[1],chain:t[2],resi:t[3],name:t[4]})),Je.seq(Vi(is.segi).skip(Is),Vi(is.chain).skip(Is),Vi(is.resi).skip(Is),Vi(is.name)).map(t=>({segi:t[0],chain:t[1],resi:t[2],name:t[3]})),Je.seq(Vi(is.chain).skip(Is),Vi(is.resi).skip(Is),Vi(is.name)).map(t=>({chain:t[0],resi:t[1],name:t[2]})),Je.seq(Vi(is.resi).skip(Is),Vi(is.name)).map(t=>({resi:t[0],name:t[1]}))))},NamedAtomProperties:function(){return Je.alt(...TF(AR))},Keywords:()=>Je.alt(...mA(F8)),ObjectProperty:()=>{let e=dA(AR,F8,k8).sort(jm).map(wy).join("|");return Je.regexp(new RegExp(`(?!(${e}))[A-Z0-9_]+`,"i"))},Object:e=>e.ObjectProperty.notFollowedBy(Is).map(t=>{throw new Error(`property 'object' not supported, value '${t}'`)}),Pepseq:()=>Je.regexp(/(PEPSEQ|ps\.)\s+([a-z]+)/i,2).map(mb("operator 'pepseq' not supported")),Rep:()=>Je.regexp(/REP\s+(lines|spheres|mesh|ribbon|cartoon|sticks|dots|surface|labels|extent|nonbonded|nb_spheres|slice|extent|slice|dashes|angles|dihedrals|cgo|cell|callback|everything)/i,1).map(mb("operator 'rep' not supported")),Operator:function(e){return TC(k8,Je.alt(e.Parens,e.Expression,e.Operator))},Query:function(e){return Je.alt(e.Operator,e.Parens,e.Expression).trim(Je.optWhitespace)}}),v0e=e=>p$e.Query.tryParse(e);var Va=ie,Wm=/[-+]?[0-9]*\.?[0-9]+/,_F=/[+]?[0-9]+/,TR=/[-+]?[0-9]+/;function JS(e){return e}var L8={T:"turn",E:"sheet",B:"strand",H:"alpha",G:"3-10",I:"pi",C:"none"};function RF(e){return Va.struct.type.secondaryStructureFlags([L8[e.toUpperCase()]||"none"])}var pb={name:{"@desc":"str    atom name","@examples":["name CA"],regex:/[a-zA-Z0-9]+/,map:Va.atomName,level:"atom-test",property:Va.ammp("label_atom_id")},type:{"@desc":"str    atom type","@examples":["type C3"],isUnsupported:!0,regex:/[a-zA-Z0-9]+/,map:JS,level:"atom-test"},index:{"@desc":"num    the atom number, starting at 0","@examples":["index 10"],isNumeric:!0,regex:_F,map:e=>parseInt(e)-1,level:"atom-test",property:Va.ammp("id")},serial:{"@desc":"num    the atom number, starting at 1","@examples":["serial 11"],isNumeric:!0,regex:_F,map:e=>parseInt(e),level:"atom-test",property:Va.ammp("id")},atomicnumber:{"@desc":"num    atomic number (0 if undefined)","@examples":["atomicnumber 13"],isNumeric:!0,regex:_F,map:e=>parseInt(e),level:"atom-test",property:Va.acp("atomicNumber")},element:{"@desc":'str  atomic element symbol string ("X" if undefined)',"@examples":["element N"],regex:/[a-zA-Z0-9]{1,3}/,map:e=>Va.es(e),level:"atom-test",property:Va.acp("elementSymbol")},altloc:{"@desc":"str  alternate location/conformation identifier","@examples":["altloc C"],regex:/[a-zA-Z0-9]+/,map:JS,level:"atom-test",property:Va.ammp("label_alt_id")},chain:{"@desc":"str  the one-character chain identifier","@examples":["chain A"],regex:/[a-zA-Z0-9]+/,map:JS,level:"residue-test",property:Va.ammp("auth_asym_id")},residue:{"@desc":"num  a set of connected atoms with the same residue number","@examples":["residue < 11","residue 11"],isNumeric:!0,regex:TR,map:e=>parseInt(e),level:"residue-test",property:Va.ammp("auth_seq_id")},fragment:{"@desc":"num  a set of connected residues","@examples":["fragment 42"],isUnsupported:!0,isNumeric:!0,regex:TR,map:e=>parseInt(e),level:"residue-test"},pfrag:{"@desc":"num  a set of connected protein residues","@examples":["pfrag 42"],isUnsupported:!0,isNumeric:!0,regex:TR,map:e=>parseInt(e),level:"residue-test"},nfrag:{"@desc":"num  a set of connected nucleic residues","@examples":["nfrag 42"],isUnsupported:!0,isNumeric:!0,regex:TR,map:e=>parseInt(e),level:"residue-test"},sequence:{"@desc":"str  a sequence given by one letter names","@examples":["sequence PGATTACA"],isUnsupported:!0,regex:/[a-zA-Z0-9]+/,map:JS,level:"residue-test"},numbonds:{"@desc":"num  number of bonds","@examples":["numbonds = 2","numbonds >= 3"],isNumeric:!0,regex:_F,map:e=>parseInt(e),level:"atom-test",property:Va.acp("bondCount")},resname:{"@desc":"str  residue name","@examples":["resname ALA"],regex:/[a-zA-Z0-9]+/,map:JS,level:"residue-test",property:Va.ammp("auth_comp_id")},resid:{"@desc":"num  residue id","@examples":["resid 42"],isNumeric:!0,regex:TR,map:e=>parseInt(e),level:"residue-test",property:Va.ammp("auth_seq_id")},segname:{"@desc":"str  segment name","@examples":["segname B"],regex:/[a-zA-Z0-9]+/,map:JS,level:"residue-test",property:Va.ammp("label_asym_id")},x:{"@desc":"float  x coordinate","@examples":["x 42"],isNumeric:!0,regex:Wm,map:e=>parseFloat(e),level:"atom-test",property:Va.acp("x")},y:{"@desc":"float  y coordinate","@examples":["y > 1.7"],isNumeric:!0,regex:Wm,map:e=>parseFloat(e),level:"atom-test",property:Va.acp("y")},z:{"@desc":"float  z coordinate","@examples":["z < 11","z > -21"],isNumeric:!0,regex:Wm,map:e=>parseFloat(e),level:"atom-test",property:Va.acp("z")},radius:{"@desc":"float  atomic radius","@examples":["radius > 1.3"],isNumeric:!0,regex:Wm,map:e=>parseFloat(e),level:"atom-test",property:Va.acp("vdw")},mass:{"@desc":"float  atomic mass","@examples":["mass > 2"],isNumeric:!0,regex:Wm,map:e=>parseFloat(e),level:"atom-test",property:Va.acp("mass")},charge:{"@desc":"float  atomic charge","@examples":["charge > 0","charge 1"],isNumeric:!0,regex:Wm,map:e=>parseFloat(e),level:"atom-test",property:Va.ammp("pdbx_formal_charge")},beta:{"@desc":"float  temperature factor","@examples":["beta < 20","beta > 35"],isNumeric:!0,regex:Wm,map:e=>parseFloat(e),level:"atom-test",property:Va.ammp("B_iso_or_equiv")},occupancy:{"@desc":"float  occupancy","@examples":["occupancy 1","occupancy < 1"],isNumeric:!0,regex:Wm,map:e=>parseFloat(e),level:"atom-test",property:Va.ammp("occupancy")},user:{"@desc":"float  time-varying user-specified value","@examples":["user < 0.1"],isUnsupported:!0,isNumeric:!0,regex:Wm,map:e=>parseFloat(e),level:"atom-test"},rasmol:{"@desc":"str  translates Rasmol selection string to VMD","@examples":["rasmol 'all'"],isUnsupported:!0,regex:/[^']*/,map:JS,level:"atom-test"},structure:{"@desc":"str  single letter name for the secondary structure","@examples":["structure H","structure H E"],regex:/T|E|B|H|G|I|C/i,map:RF,level:"atom-test",property:Va.ammp("secondaryStructureFlags")},phi:{"@desc":"float  phi backbone conformational angles","@examples":["phi < 160"],isUnsupported:!0,isNumeric:!0,regex:Wm,map:e=>parseFloat(e),level:"residue-test"},psi:{"@desc":"float  psi backbone conformational angles","@examples":["psi < 160"],isUnsupported:!0,isNumeric:!0,regex:Wm,map:e=>parseFloat(e),level:"residue-test"},ufx:{"@desc":"num  force to apply in the x coordinate","@examples":["ufx 1"],isUnsupported:!0,isNumeric:!0,regex:Wm,map:e=>parseInt(e),level:"atom-test"},ufy:{"@desc":"num  force to apply in the y coordinate","@examples":["ufy 1"],isUnsupported:!0,isNumeric:!0,regex:Wm,map:e=>parseInt(e),level:"atom-test"},ufz:{"@desc":"num  force to apply in the z coordinate","@examples":["ufz 1"],isUnsupported:!0,isNumeric:!0,regex:Wm,map:e=>parseInt(e),level:"atom-test"}};var $S=ie,f$e=Object.keys(pb).sort(jm).filter(e=>!pb[e].isUnsupported).join("|"),V8=[{"@desc":"Selects atoms that are not included in s1.","@examples":["not protein"],name:"not",type:wl,rule:Je.regexp(/NOT/i).skip(Je.whitespace),map:(e,t)=>cu(t)},{"@desc":"Selects atoms within a specified distance of a selection","@examples":["within 5 of name FE"],name:"within",type:wl,rule:Jc(/WITHIN\s+([-+]?[0-9]*\.?[0-9]+)\s+OF/i,1).map(e=>parseFloat(e)),map:(e,t)=>$S.struct.modifier.includeSurroundings({0:t,radius:e})},{"@desc":"Exclusive within, equivalent to (within 3 of X) and not X","@examples":["exwithin 10 of resname HEM"],name:"exwithin",type:wl,rule:Jc(/EXWITHIN\s+([-+]?[0-9]*\.?[0-9]+)\s+OF/i,1).map(e=>parseFloat(e)),map:(e,t)=>$S.struct.modifier.exceptBy({0:$S.struct.modifier.includeSurroundings({0:t,radius:e}),by:t})},{"@desc":"Selects atoms which have the same keyword as the atoms in a given selection","@examples":["same resid as name FE"],name:"same",type:wl,rule:Jc(new RegExp(`SAME\\s+(${f$e})\\s+AS`,"i"),1).map(e=>pb[e].property),map:(e,t)=>$S.struct.filter.withSameAtomProperties({0:$S.struct.generator.all(),source:t,property:e})},{"@desc":"Selects atoms included in both s1 and s2.","@examples":["backbone and protein"],name:"and",type:sl,rule:Je.alt(kp(/AND/i),Je.whitespace),map:(e,t,r)=>$S.struct.modifier.intersectBy({0:t,by:r})},{"@desc":"Selects atoms included in either s1 or s2.","@examples":["water or protein"],name:"or",type:sl,rule:kp(/OR/i),map:(e,t,r)=>$S.struct.combinator.merge([t,r])}];var Mn=ie;function fb(){return Mn.struct.filter.pick({0:Mn.struct.generator.atomGroups({"group-by":Mn.ammp("residueKey")}),test:Mn.core.set.isSubset([Dd(["C","N","CA","O"]),Mn.ammpSet("label_atom_id")])})}function O8(){return Mn.struct.filter.pick({0:Mn.struct.generator.atomGroups({"group-by":Mn.ammp("residueKey")}),test:Mn.core.logic.and([Mn.core.set.isSubset([Dd(["P"]),Mn.ammpSet("label_atom_id")]),Mn.core.logic.or([Mn.core.set.isSubset([Dd(["O3'","C3'","C4'","C5'","O5'"]),Mn.ammpSet("label_atom_id")]),Mn.core.set.isSubset([Dd(["O3*","C3*","C4*","C5*","O5*"]),Mn.ammpSet("label_atom_id")])])])})}function I0e(){return Mn.struct.combinator.merge([Mn.struct.generator.queryInSelection({0:fb(),query:Mn.struct.generator.atomGroups({"atom-test":Mn.core.set.has([Dd(A0e.protein),Mn.ammp("label_atom_id")])})}),Mn.struct.generator.queryInSelection({0:O8(),query:Mn.struct.generator.atomGroups({"atom-test":Mn.core.set.has([Dd(A0e.nucleic),Mn.ammp("label_atom_id")])})})])}function wg(e){return Mn.struct.generator.atomGroups({"residue-test":Mn.core.flags.hasAll([Mn.ammp("secondaryStructureFlags"),Mn.struct.type.secondaryStructureFlags(e)])})}var A0e={nucleic:["P","O3'","O5'","C5'","C4'","C3'","OP1","OP2","O3*","O5*","C5*","C4*","C3*"],protein:["C","N","CA","O"]},As={acidic:["ASP","GLU"],aliphatic:["ALA","GLY","ILE","LEU","VAL"],aromatic:["HIS","PHE","TRP","TYR"],at:["ADA","A","THY","T"],basic:["ARG","HIS","LYS"],buried:["ALA","LEU","VAL","ILE","PHE","CYS","MET","TRP"],cg:["CYT","C","GUA","G"],cyclic:["HIS","PHE","PRO","TRP","TYR"],hydrophobic:["ALA","LEU","VAL","ILE","PRO","PHE","MET","TRP"],medium:["VAL","THR","ASP","ASN","PRO","CYS","ASX","PCA","HYP"],neutral:["VAL","PHE","GLN","TYR","HIS","CYS","MET","TRP","ASX","GLX","PCA","HYP"],purine:["ADE","A","GUA","G"],pyrimidine:["CYT","C","THY","T","URI","U"],small:["ALA","GLY","SER"],water:["H2O","HH0","OHH","HOH","OH2","SOL","WAT","TIP","TIP2","TIP3","TIP4"]},G8={all:{"@desc":"everything",map:()=>Mn.struct.generator.all()},none:{"@desc":"nothing",map:()=>Mn.struct.generator.empty()},protein:{"@desc":"a residue with atoms named C, N, CA, and O",map:()=>fb()},nucleic:{"@desc":"a residue with atoms named P, O1P, O2P and either O3', C3', C4', C5', O5' or O3*, C3*, C4*, C5*, O5*. This definition assumes that the base is phosphorylated, an assumption which will be corrected in the future.",map:()=>O8()},backbone:{"@desc":"the C, N, CA, and O atoms of a protein and the equivalent atoms in a nucleic acid.",map:()=>I0e()},sidechain:{"@desc":"non-backbone atoms and bonds",map:()=>cu(I0e())},water:{"@desc":"all atoms with the resname H2O, HH0, OHH, HOH, OH2, SOL, WAT, TIP, TIP2, TIP3 or TIP4",abbr:["waters"],map:()=>Zn(As.water)},at:{"@desc":"residues named ADA A THY T",map:()=>Zn(As.at)},acidic:{"@desc":"residues named ASP GLU",map:()=>Zn(As.acidic)},acyclic:{"@desc":'"protein and not cyclic"',map:()=>Mn.struct.modifier.intersectBy({0:fb(),by:cu(Zn(As.cyclic))})},aliphatic:{"@desc":"residues named ALA GLY ILE LEU VAL",map:()=>Zn(As.aliphatic)},alpha:{"@desc":"atom's residue is an alpha helix",map:()=>wg(["alpha"])},amino:{"@desc":"a residue with atoms named C, N, CA, and O",map:()=>fb()},aromatic:{"@desc":"residues named HIS PHE TRP TYR",map:()=>Zn(As.aromatic)},basic:{"@desc":"residues named ARG HIS LYS",map:()=>Zn(As.basic)},bonded:{"@desc":"atoms for which numbonds > 0",map:()=>wd(Mn.struct.filter.pick({0:Mn.struct.modifier.includeConnected({0:Mn.struct.generator.all(),"bond-test":Mn.core.flags.hasAny([Mn.struct.bondProperty.flags(),Mn.struct.type.bondFlags(["covalent","metallic","sulfide"])])}),test:Mn.core.rel.gr([Mn.struct.atomSet.atomCount(),1])}))},buried:{"@desc":"residues named ALA LEU VAL ILE PHE CYS MET TRP",map:()=>Zn(As.buried)},cg:{"@desc":"residues named CYT C GUA G",map:()=>Zn(As.cg)},charged:{"@desc":'"basic or acidic"',map:()=>Zn(As.basic.concat(As.acidic))},cyclic:{"@desc":"residues named HIS PHE PRO TRP TYR",map:()=>Zn(As.cyclic)},hetero:{"@desc":'"not (protein or nucleic)"',map:()=>cu(Mn.struct.combinator.merge([fb(),O8()]))},hydrogen:{"@desc":'name "[0-9]?H.*"',map:()=>Mn.struct.generator.atomGroups({"atom-test":Mn.core.str.match([Mn.core.type.regex(["^[0-9]?[H].*$","i"]),Mn.core.type.str([Mn.ammp("label_atom_id")])])})},large:{"@desc":'"protein and not (small or medium)"',map:()=>Mn.struct.modifier.intersectBy({0:fb(),by:cu(Zn(As.small.concat(As.medium)))})},medium:{"@desc":"residues named VAL THR ASP ASN PRO CYS ASX PCA HYP",map:()=>Zn(As.medium)},neutral:{"@desc":"residues named VAL PHE GLN TYR HIS CYS MET TRP ASX GLX PCA HYP",map:()=>Zn(As.neutral)},hydrophobic:{"@desc":"hydrophobic resname ALA LEU VAL ILE PRO PHE MET TRP",map:()=>Zn(As.hydrophobic)},polar:{"@desc":'"protein and not hydrophobic"',map:()=>Mn.struct.modifier.intersectBy({0:fb(),by:cu(Zn(As.hydrophobic))})},purine:{"@desc":"residues named ADE A GUA G",map:()=>Zn(As.purine)},pyrimidine:{"@desc":"residues named CYT C THY T URI U",map:()=>Zn(As.pyrimidine)},small:{"@desc":"residues named ALA GLY SER",map:()=>Zn(As.small)},surface:{"@desc":'"protein and not buried"',map:()=>Mn.struct.modifier.intersectBy({0:fb(),by:cu(Zn(As.buried))})},alpha_helix:{"@desc":"atom's residue is in an alpha helix",map:()=>wg(["alpha"])},pi_helix:{"@desc":"atom's residue is in a pi helix",map:()=>wg(["pi"])},helix_3_10:{"@desc":"atom's residue is in a 3-10 helix",map:()=>wg(["3-10"])},helix:{"@desc":"atom's residue is in an alpha or pi or 3-10 helix",map:()=>wg(["helix"])},extended_beta:{"@desc":"atom's residue is a beta sheet",map:()=>wg(["sheet"])},bridge_beta:{"@desc":"atom's residue is a beta sheet",map:()=>wg(["strand"])},sheet:{"@desc":"atom's residue is a beta sheet",map:()=>wg(["beta"])},turn:{"@desc":"atom's residue is in a turn conformation",map:()=>wg(["turn"])},coil:{"@desc":"atom's residue is in a coil conformation",map:()=>Mn.struct.modifier.intersectBy({0:fb(),by:wg(["none"])})}};var Uu=ie,T0e={sqr:{"@desc":"square of x","@examples":["sqr(2)"],map:e=>Uu.core.math.pow([e,2])},sqrt:{"@desc":"square root of x","@examples":["sqrt(2)"],map:e=>Uu.core.math.sqrt([e])},abs:{"@desc":"absolute value of x","@examples":["abs(2)"],map:e=>Uu.core.math.abs([e])},floor:{"@desc":"largest integer not greater than x","@examples":["floor(2)"],map:e=>Uu.core.math.floor([e])},ceil:{"@desc":"smallest integer not less than x","@examples":["ceil(2)"],map:e=>Uu.core.math.ceil([e])},sin:{"@desc":"sine of x","@examples":["sin(2)"],map:e=>Uu.core.math.sin([e])},cos:{"@desc":"cosine of x","@examples":["cos(2)"],map:e=>Uu.core.math.cos([e])},tan:{"@desc":"tangent of x","@examples":["tan(2)"],map:e=>Uu.core.math.tan([e])},atan:{"@desc":"arctangent of x","@examples":["atan(2)"],map:e=>Uu.core.math.atan([e])},asin:{"@desc":"arcsin of x","@examples":["asin(2)"],map:e=>Uu.core.math.asin([e])},acos:{"@desc":"arccos of x","@examples":["acos(2)"],map:e=>Uu.core.math.acos([e])},sinh:{"@desc":"hyperbolic sine of x","@examples":["sinh(2)"],map:e=>Uu.core.math.sinh([e])},cosh:{"@desc":"hyperbolic cosine of x","@examples":["cosh(2)"],map:e=>Uu.core.math.cosh([e])},tanh:{"@desc":"hyperbolic tangent of x","@examples":["tanh(2)"],map:e=>Uu.core.math.tanh([e])},exp:{"@desc":"e to the power x","@examples":["exp(2)"],map:e=>Uu.core.math.exp([e])},log:{"@desc":"natural log of x","@examples":["log(2)"],map:e=>Uu.core.math.log([e])},log10:{"@desc":"log base 10 of x","@examples":["log10(2)"],map:e=>Uu.core.math.log10([e])}};var oa=ie,h$e=[{"@desc":"multiplication, division","@examples":[],name:"mul-div",type:sl,rule:Je.regexp(/\s*(\*|\/)\s*/,1),map:(e,t,r)=>{switch(e){case"*":return oa.core.math.mult([t,r]);case"/":return oa.core.math.div([t,r]);default:throw new Error(`value operator '${e}' not supported`)}}},{"@desc":"addition, substraction","@examples":[],name:"add-sub",type:sl,rule:Je.regexp(/\s*(-|\+)\s*/,1),map:(e,t,r)=>{switch(e){case"-":return oa.core.math.sub([t,r]);case"+":return oa.core.math.add([t,r]);default:throw new Error(`value operator '${e}' not supported`)}}},{"@desc":"value comparisons","@examples":[],name:"comparison",type:sl,rule:Je.alt(Je.regexp(/\s*(=~|==|>=|<=|=|!=|>|<)\s*/,1),Je.whitespace.result("=")),map:(e,t,r)=>{let n;if(t.head!==void 0?(t.head.name==="structure-query.atom-property.macromolecular.secondary-structure-flags"&&(n=oa.core.flags.hasAny([t,RF(r)])),t.head.name==="core.type.regex"&&(n=oa.core.str.match([t,oa.core.type.str([r])]))):r.head!==void 0?(r.head.name==="structure-query.atom-property.macromolecular.secondary-structure-flags"&&(n=oa.core.flags.hasAny([r,RF(t)])),r.head.name==="core.type.regex"&&(n=oa.core.str.match([r,oa.core.type.str([t])]))):e==="=~"&&(t.head?n=oa.core.str.match([oa.core.type.regex([`^${r}$`,"i"]),oa.core.type.str([t])]):n=oa.core.str.match([oa.core.type.regex([`^${t}$`,"i"]),oa.core.type.str([r])])),!n)switch(t.head&&(r=KS(t,r)),r.head&&(t=KS(r,t)),e){case"=":case"==":n=oa.core.rel.eq([t,r]);break;case"!=":n=oa.core.rel.neq([t,r]);break;case">":n=oa.core.rel.gr([t,r]);break;case"<":n=oa.core.rel.lt([t,r]);break;case">=":n=oa.core.rel.gre([t,r]);break;case"<=":n=oa.core.rel.lte([t,r]);break;default:throw new Error(`value operator '${e}' not supported`)}return oa.struct.generator.atomGroups({"atom-test":n})}}],g$e=Je.createLanguage({Parens:function(e){return Je.alt(e.Parens,e.Operator,e.Expression).wrap(Je.string("("),Je.string(")"))},Expression:function(e){return Je.alt(e.RangeListProperty,e.ValueQuery,e.Keywords)},NamedAtomProperties:function(){return Je.alt(...TF(pb))},Keywords:()=>Je.alt(...mA(G8)),ValueRange:function(e){return Je.seq(e.Value.skip(Je.regexp(/\s+TO\s+/i)),e.Value).map(t=>({range:t}))},RangeListProperty:function(e){return Je.seq(Je.alt(...SR(pb,/\s/)).skip(Je.whitespace),Je.alt(e.ValueRange,e.Value).sepBy1(Je.whitespace)).map(t=>{let[r,n]=t,o=[],i=[];n.forEach(u=>{u.range?i.push(oa.core.rel.inRange([r,u.range[0],u.range[1]])):o.push(KS(r,u,L8))});let a=d0e(i),s=g0e(r,o),l;return a&&s?l=oa.core.logic.or([a,s]):l=a||s,oa.struct.generator.atomGroups({[h0e(r)]:l})})},Operator:function(e){return TC(V8,Je.alt(e.Parens,e.Expression,e.ValueQuery))},Query:function(e){return Je.alt(e.Operator,e.Parens,e.Expression).trim(Je.optWhitespace)},Number:function(){return Je.regexp(/-?(0|[1-9][0-9]*)([.][0-9]+)?([eE][+-]?[0-9]+)?/).map(Number).desc("number")},String:function(){let e=dA(pb,G8,V8).sort(jm).map(wy).join("|");return Je.alt(Je.regexp(new RegExp(`(?!(${e}))[A-Z0-9_]+`,"i")),Je.regexp(/'((?:[^"\\]|\\.)*)'/,1),Je.regexp(/"((?:[^"\\]|\\.)*)"/,1).map(t=>oa.core.type.regex([`^${t}$`,"i"]))).desc("string")},Value:function(e){return Je.alt(e.Number,e.String)},ValueParens:function(e){return Je.alt(e.ValueParens,e.ValueOperator,e.ValueExpressions).wrap(Je.string("("),Je.string(")"))},ValuePropertyNames:function(){return Je.alt(...SR(pb,/=~|==|>=|<=|=|!=|>|<|\)|\s|\+|-|\*|\//i))},ValueOperator:function(e){return TC(h$e,Je.alt(e.ValueParens,e.ValueExpressions))},ValueExpressions:function(e){return Je.alt(e.ValueFunctions,e.Value,e.ValuePropertyNames)},ValueFunctions:function(e){return Je.alt(...f0e(T0e,e.ValueOperator))},ValueQuery:function(e){return Je.alt(e.ValueOperator.map(t=>{if(!t.head.name||!t.head.name.startsWith("structure-query.generator"))throw new Error(`values must be part of an comparison, value '${t}'`);return t}))}}),P0e=e=>g$e.Query.tryParse(e);var _0e={pymol:v0e,vmd:P0e,jmol:x0e};var y$e=_0e;function R0e(e,t){try{return y$e[e](t)}catch(r){throw console.error(r.message),r}}function Mo(e,t){return{expression:e,language:t}}(s=>{s.Info={"mol-script":"Mol-Script",pymol:"PyMOL",vmd:"VMD",jmol:"Jmol"};function t(l){return!!l&&typeof l.expression=="string"&&!!l.language}s.is=t;function r(l,u){return l.language===u.language&&l.expression===u.expression}s.areEqual=r;function n(l){switch(l.language){case"mol-script":let u=u0e(l.expression);if(u.length===0)throw new Error("No query");return s0e(u[0]);case"pymol":case"jmol":case"vmd":return R0e(l.language,l.expression);default:Mr(l.language)}}s.toExpression=n;function o(l){let u=n(l);return Wc(u)}s.toQuery=o;function i(l,u){let m=o(l)(new zo(u));return ut.toLociWithSourceUnits(m)}s.toLoci=i;function a(l,u,c){let m=typeof l=="function"?l(ie):l;return Wc(m)(new zo(u,c))}s.getStructureSelection=a})(Mo||={});var fA={dynamicBonds:C.Optional(C.Boolean(!1,{description:"Ensure bonds are recalculated upon model changes. Also enables calculation of inter-unit bonds in water molecules and ions."}))},hb;(s=>{function e(l,u){let c=l&&Qo.Provider.get(l),m=c?c.assemblies.map(y=>[y.id,`${y.id}: ${va(y.details)}`]):[],d=c?!ha.isZero(c.spacegroup.cell):!0,p=[];if(c){let{operators:y}=c.spacegroup;for(let x=0,S=y.length;x<S;x++)p.push([x,`${x+1}: ${rl.getOperatorXyz(y[x])}`])}let h=[];l&&l.properties.structAsymMap.forEach(y=>{let x=y.id===y.auth_id?y.id:`${y.id} [auth ${y.auth_id}]`;h.push([y.id,x])});let f={auto:C.Group(fA),model:C.Group(fA),assembly:C.Group({id:C.Optional(l?C.Select(m.length?m[0][0]:"",m,{label:"Asm Id",description:"Assembly Id"}):C.Text("",{label:"Asm Id",description:"Assembly Id (use empty for the 1st assembly)"})),...fA},{isFlat:!0}),"symmetry-mates":C.Group({radius:C.Numeric(5,{min:0,max:50,step:1}),...fA},{isFlat:!0}),symmetry:C.Group({ijkMin:C.Vec3(b.create(-1,-1,-1),{step:1},{label:"Min IJK",fieldLabels:{x:"I",y:"J",z:"K"}}),ijkMax:C.Vec3(b.create(1,1,1),{step:1},{label:"Max IJK",fieldLabels:{x:"I",y:"J",z:"K"}}),...fA},{isFlat:!0}),"symmetry-assembly":C.Group({generators:C.ObjectList({operators:C.ObjectList({index:C.Select(0,p),shift:C.Vec3(b(),{step:1},{label:"IJK",fieldLabels:{x:"I",y:"J",z:"K"}})},y=>`${y.index+1}_${y.shift.map(x=>x+5).join("")}`,{defaultValue:[]}),asymIds:C.MultiSelect([],h)},y=>`${y.asymIds.length} asym ids, ${y.operators.length} operators`,{defaultValue:[]}),...fA},{isFlat:!0})},g=[];return u==="auto"&&g.push(["auto","Auto"]),g.push(["model","Model"]),m.length>0&&g.push(["assembly","Assembly"]),d&&(g.push(["symmetry-mates","Symmetry Mates"]),g.push(["symmetry","Symmetry (indices)"]),g.push(["symmetry-assembly","Symmetry (assembly)"])),{type:C.MappedStatic(u||"model",f,{options:g})}}s.getParams=e;function t(l,u){return!(u.name==="symmetry-assembly"||u.name==="symmetry"&&l.name==="symmetry")}s.canAutoUpdate=t;async function r(l,u,c,m,d){let p,h=Qo.Provider.get(c);!m&&h&&h.assemblies.length!==0&&(m=h.assemblies[0].id),!h||h.assemblies.length===0?l.log.warn(`Model '${c.entryId}' has no assembly, returning model structure.`):(p=aC.findAssembly(c,m||""),p||l.log.warn(`Model '${c.entryId}' has no assembly called '${m}', returning model structure.`));let f=De.ofModel(c,d);if(!p){let x={label:"Model",description:De.elementDescription(f)};return new ne.Molecule.Structure(f,x)}m=p.id;let g=await Bm.buildAssembly(f,m).runInContext(u),y={label:`Assembly ${m}`,description:De.elementDescription(g)};return new ne.Molecule.Structure(g,y)}async function n(l,u,c,m,d){let p=De.ofModel(u,d),h=await Bm.buildSymmetryRange(p,c,m).runInContext(l),f={label:`Symmetry [${c}] to [${m}]`,description:De.elementDescription(h)};return new ne.Molecule.Structure(h,f)}async function o(l,u,c,m){let d=De.ofModel(u,m),p=await Bm.builderSymmetryMates(d,c).runInContext(l),h={label:"Symmetry Mates",description:De.elementDescription(p)};return new ne.Molecule.Structure(p,h)}async function i(l,u,c,m,d){let p=De.ofModel(u,d),h=await Bm.buildSymmetryAssembly(p,c,m).runInContext(l),f={label:"Symmetry Assembly",description:De.elementDescription(h)};return new ne.Molecule.Structure(h,f)}async function a(l,u,c,m){let d=m?.params,p=Qo.Provider.get(c);if(!p||!m||m.name==="model"){let h=De.ofModel(c,d);return new ne.Molecule.Structure(h,{label:"Model",description:De.elementDescription(h)})}if(m.name==="auto")if(p.assemblies.length===0){let h=De.ofModel(c,d);return new ne.Molecule.Structure(h,{label:"Model",description:De.elementDescription(h)})}else return r(l,u,c,void 0,d);if(m.name==="assembly")return r(l,u,c,m.params.id,d);if(m.name==="symmetry")return n(u,c,m.params.ijkMin,m.params.ijkMax,d);if(m.name==="symmetry-mates")return o(u,c,m.params.radius,d);if(m.name==="symmetry-assembly")return i(u,c,m.params.generators,p,d);Mr(m)}s.create=a})(hb||={});var js;(a=>{function e(s,l,u){return s.currentStructure!==u?!1:Mo.is(l)?!!s.script&&Mo.areEqual(s.script,l):s.expression===l}a.isUnchanged=e;function t(s,l){let u=Mo.is(l)?l:void 0,c=Mo.is(l)?Mo.toExpression(l):l,m=Wc(c);return{script:u,expression:c,compiled:m,originalStructure:s,currentStructure:s}}a.create=t;function r(s,l){return s.compiled(new zo(l))}a.run=r;function n(s,l){let u=t(s,l);return{entry:u,selection:r(u,s)}}a.createAndRun=n;function o(s,l){return s.currentStructure=l,s.compiled(new zo(l))}a.updateStructure=o;function i(s,l,u){let c=ut.unionStructure(l);s.label=`${u||"Selection"}`,s.description=De.elementDescription(c),s.data=c}a.updateStructureObject=i})(js||={});var D0e=["all","polymer","protein","nucleic","water","ion","lipid","branched","ligand","non-standard","coarse"],w0e=()=>({type:C.MappedStatic("static",{static:C.Text("polymer"),expression:C.Value(ie.struct.generator.all),bundle:C.Value(Q.Bundle.Empty),script:C.Script({language:"mol-script",expression:"(sel.atom.all)"})},{isHidden:!0}),nullIfEmpty:C.Optional(C.Boolean(!0,{isHidden:!0})),label:C.Text("",{isHidden:!0})});function hA(e,t,r){r.source=e;let n=De.Empty,o;switch(t.type.name){case"static":{let a;switch(t.type.params){case"all":a=oi.all.query,o="All";break;case"polymer":a=oi.polymer.query,o="Polymer";break;case"protein":a=oi.protein.query,o="Protein";break;case"nucleic":a=oi.nucleic.query,o="Nucleic";break;case"water":a=Xn.internal.water(),o="Water";break;case"ion":a=oi.ion.query,o="Ion";break;case"lipid":a=oi.lipid.query,o="Lipid";break;case"branched":a=oi.branchedPlusConnected.query,o="Branched";break;case"ligand":a=oi.ligandPlusConnected.query,o="Ligand";break;case"non-standard":a=oi.nonStandardPolymer.query,o="Non-standard";break;case"coarse":a=oi.coarse.query,o="Coarse";break;default:Mr(t.type)}let s=a(new zo(e));n=ut.unionStructure(s);break}case"script":case"expression":{let{selection:a,entry:s}=js.createAndRun(e,t.type.params);r.entry=s,n=ut.unionStructure(a);break}case"bundle":{if(t.type.params.hash!==e.hashCode)break;n=Q.Bundle.toStructure(t.type.params,e);break}}if(t.nullIfEmpty&&n.elementCount===0)return Gn.Null;let i={label:`${t.label||o||"Component"}`,description:De.elementDescription(n)};return new ne.Molecule.Structure(n,i)}function M0e(e,t,r,n,o){if(r.type.name!==n.type.name)return et.UpdateResult.Recreate;let i=!1;switch(n.type.name){case"static":return r.type.params!==n.type.params?et.UpdateResult.Recreate:De.areEquivalent(e,o.source)?t.data.model===e.model?et.UpdateResult.Unchanged:Gt.areHierarchiesEqual(e.model,t.data.model)?(t.data=t.data.remapModel(e.model),et.UpdateResult.Updated):et.UpdateResult.Recreate:et.UpdateResult.Recreate;case"script":if(!Mo.areEqual(r.type.params,n.type.params))return et.UpdateResult.Recreate;case"expression":{if(r.type.params!==n.type.params)return et.UpdateResult.Recreate;if(e===o.source)break;let a=o.entry,s=js.updateStructure(a,e);o.source=e,t.data=ut.unionStructure(s),js.updateStructureObject(t,s,n.label),i=!0;break}case"bundle":{if(e===o.source&&Q.Bundle.areEqual(r.type.params,n.type.params))break;o.source=e,n.type.params.hash!==e.hashCode?(i=t.data.elementCount!==0,t.data=t.data.elementCount===0?t.data:De.Empty):(i=!0,t.data=Q.Bundle.toStructure(n.type.params,e));break}}if(i){if(n.nullIfEmpty&&t.data.elementCount===0)return et.UpdateResult.Null;t.description=De.elementDescription(t.data)}return r.label!==n.label&&(i=!0,t.label=`${n.label||t.label}`),i?et.UpdateResult.Updated:et.UpdateResult.Unchanged}function B0e(e){switch(e){case 7:return-3;case 6:return-2;case 5:return-1;case 0:return 0;case 3:return 1;case 2:return 2;case 1:return 3;case 4:return 0;default:return console.error(`Value ${e} is outside the 0-7 range, defaulting to 0.`),0}}function U8(e,t){let r=We.create(e.data,t*2),n=We.create(e.data,t*2),o=We.create(e.data,t*2),i=We.create(e.data,t*2),a=We.create(e.data,t*2);for(let s=0;s<t;++s){St.markLine(e);let{tokenStart:l,position:u}=e;St.trim(e,l,l+10),We.addUnchecked(r,e.tokenStart,e.tokenEnd),St.trim(e,l+10,l+20),We.addUnchecked(n,e.tokenStart,e.tokenEnd),St.trim(e,l+20,l+30),We.addUnchecked(o,e.tokenStart,e.tokenEnd),St.trim(e,l+31,l+34),We.addUnchecked(i,e.tokenStart,e.tokenEnd),St.trim(e,l+36,l+39),We.addUnchecked(a,e.tokenStart,e.tokenEnd),e.position=u}return{count:t,x:jt(r)(W.Schema.float),y:jt(n)(W.Schema.float),z:jt(o)(W.Schema.float),type_symbol:jt(i)(W.Schema.str),formal_charge:jt(a)(W.Schema.int)}}function N8(e,t){let r=We.create(e.data,t*2),n=We.create(e.data,t*2),o=We.create(e.data,t*2);for(let i=0;i<t;++i){St.markLine(e);let{tokenStart:a,position:s}=e;St.trim(e,a,a+3),We.addUnchecked(r,e.tokenStart,e.tokenEnd),St.trim(e,a+3,a+6),We.addUnchecked(n,e.tokenStart,e.tokenEnd),St.trim(e,a+6,a+9),We.addUnchecked(o,e.tokenStart,e.tokenEnd),e.position=s}return{count:t,atomIdxA:jt(r)(W.Schema.int),atomIdxB:jt(n)(W.Schema.int),order:jt(o)(W.Schema.int)}}function b$e(e,t,r){St.trim(e,t+6,t+9);let n=parseInt(St.getTokenString(e));for(let o=0;o<n;++o){let i=9+o*8;St.trim(e,t+i,t+i+4);let a=St.getTokenString(e);r.atomIdx.push(+a),St.trim(e,t+i+4,t+i+8);let s=St.getTokenString(e);r.charge.push(+s)}St.eatLine(e)}function x$e(e){let t=e.trim().split(/\s+/g),r=[];for(let n=1;n<t.length;n+=2){let o=+t[n],i=+t[n+1]||0;r.push({atomIdx:o,kind:i})}return r}function z8(e){let n={atomIdx:[],charge:[]},o;for(;e.position<e.length;){let{position:a}=e;St.trim(e,a+3,a+6);let s=St.getTokenString(e);if(s==="END")break;switch(St.eatLine(e),s){case"CHG":b$e(e,a,n);break;case"APO":o=x$e(St.getTokenString(e).substring(3));break;default:break}}return{formalCharges:{atomIdx:W.ofIntArray(n.atomIdx),charge:W.ofIntArray(n.charge)},attachmentPoints:o}}function C$e(e){let t=St(e),r=St.readLine(t).trim(),n=St.readLine(t).trim(),o=St.readLine(t).trim(),i=St.readLine(t),a=+i.substr(0,3),s=+i.substr(3,3),l=U8(t,a),u=N8(t,s),c={title:r,program:n,comment:o,atoms:l,bonds:u,...z8(t)};return nn.success(c)}function E0e(e){return Ae.create("Parse Mol",async()=>C$e(e))}async function H8(e,t,r){let{atoms:n,bonds:o,formalCharges:i}=e,a=W.ofConst("MOL",e.atoms.count,W.Schema.str),s=W.ofConst("A",e.atoms.count,W.Schema.str),l=W.asArrayColumn(n.type_symbol),u=W.ofConst(1,n.count,W.Schema.int),c=new Int32Array(e.atoms.count);if(i.atomIdx.rowCount>0)for(let g=0;g<i.atomIdx.rowCount;g++)c[i.atomIdx.value(g)-1]=i.charge.value(g);else for(let g=0;g<e.atoms.count;g++)c[g]=B0e(n.formal_charge.value(g));let m=wr.ofPartialColumns(Lo.atom_site,{auth_asym_id:s,auth_atom_id:l,auth_comp_id:a,auth_seq_id:u,Cartn_x:W.asArrayColumn(n.x,Float32Array),Cartn_y:W.asArrayColumn(n.y,Float32Array),Cartn_z:W.asArrayColumn(n.z,Float32Array),id:W.range(1,n.count),label_asym_id:s,label_atom_id:l,label_comp_id:a,label_seq_id:u,label_entity_id:W.ofConst("1",n.count,W.Schema.str),occupancy:W.ofConst(1,n.count,W.Schema.float),type_symbol:l,pdbx_PDB_model_num:W.ofConst(1,n.count,W.Schema.int),pdbx_formal_charge:W.ofIntArray(c)},n.count),d=new Ui;d.setNames([["MOL","Unknown Entity"]]),d.getEntityId("MOL",0,"A");let p=new Ni(u,l);p.setNames([["MOL","Unknown Molecule"]]),p.add("MOL",0);let h=ra({entity:d.getEntityTable(),chem_comp:p.getChemCompTable(),atom_site:m}),f=await rs(h,t??k0e.create(e),r);if(f.frameCount>0){let g=W.ofIntArray(W.mapToArray(o.atomIdxA,I=>I-1,Int32Array)),y=W.ofIntArray(W.mapToArray(o.atomIdxB,I=>I-1,Int32Array)),x=W.asArrayColumn(o.order,Int32Array),S=Xo.fromData({pairs:{indexA:g,indexB:y,order:x},count:n.count},{maxDistance:1/0});Xo.Provider.set(f.representative,S)}return f}var k0e;(r=>{function e(n){return n?.kind==="mol"}r.is=e;function t(n){return{kind:"mol",name:n.title,data:n}}r.create=t})(k0e||={});function F0e(e){return Ae.create("Parse MOL",t=>H8(e,void 0,t))}function S$e(e){let t=e.it_number.value(0),r=e["name_h-m_full"].value(0).replace("-"," ");return e.it_number.isDefined?(e["name_h-m_full"].isDefined,t):r}function v$e(e){let{cell:t,space_group:r}=e,n=S$e(r),o=ha.create(n,b.create(t.length_a.value(0),t.length_b.value(0),t.length_c.value(0)),b.scale(b(),b.create(t.angle_alpha.value(0),t.angle_beta.value(0),t.angle_gamma.value(0)),Math.PI/180));return{spacegroup:rl.create(o),assemblies:[],isNonStandardCrystalFrame:!1,ncsOperators:[]}}async function I$e(e,t,r){let n=e.atom_site._rowCount,o=W.ofConst("MOL",n,W.Schema.str),i=W.ofConst("A",n,W.Schema.str),a=W.ofConst(1,n,W.Schema.int),s=v$e(e),l=s.spacegroup.cell.fromFractional,{fract_x:u,fract_y:c,fract_z:m}=e.atom_site,d=new Float32Array(n),p=new Float32Array(n),h=new Float32Array(n),f=b();for(let w=0;w<n;++w)b.set(f,u.value(w),c.value(w),m.value(w)),b.transformMat4(f,f,l),d[w]=f[0],p[w]=f[1],h[w]=f[2];let{type_symbol:g,label:y}=e.atom_site,x,S;if(g.isDefined){let w=new Array(n),E=new Int8Array(n);for(let M=0;M<n;++M){let D=g.value(M),B=D.length;D[B-1]==="+"?(w[M]=D.substring(0,B-2),E[M]=parseInt(D[B-2])):D[B-2]==="+"?(w[M]=D.substring(0,B-2),E[M]=parseInt(D[B-1])):D[B-1]==="-"?(w[M]=D.substring(0,B-2),E[M]=-parseInt(D[B-2])):D[B-2]==="-"?(w[M]=D.substring(0,B-2),E[M]=-parseInt(D[B-1])):(w[M]=D,E[M]=0)}x=W.ofStringArray(w),S=W.ofIntArray(E)}else{let w=new Array(n);for(let E=0;E<n;++E)w[E]=Bp(y.value(E),"");x=W.ofStringArray(w),S=W.Undefined(n,W.Schema.int)}let I=wr.ofPartialColumns(Lo.atom_site,{auth_asym_id:i,auth_atom_id:y,auth_comp_id:o,auth_seq_id:a,Cartn_x:W.ofFloatArray(d),Cartn_y:W.ofFloatArray(p),Cartn_z:W.ofFloatArray(h),id:W.range(0,n-1),label_asym_id:i,label_atom_id:y,label_comp_id:o,label_seq_id:a,label_entity_id:W.ofConst("1",n,W.Schema.str),occupancy:e.atom_site.occupancy.isDefined?e.atom_site.occupancy:W.ofConst(1,n,W.Schema.float),type_symbol:x,pdbx_formal_charge:S,pdbx_PDB_model_num:W.ofConst(1,n,W.Schema.int),B_iso_or_equiv:e.atom_site.u_iso_or_equiv},n),v=e.chemical.name_common.value(0)||e.chemical.name_systematic.value(0)||e.chemical_formula.sum.value(0),A=new Ui;A.setNames([["MOL",v||"Unknown Entity"]]),A.getEntityId("MOL",0,"A");let P=new Ni(a,e.atom_site.type_symbol);P.setNames([["MOL",v||"Unknown Molecule"]]),P.add("MOL",0);let T=ra({entity:A.getEntityTable(),chem_comp:P.getChemCompTable(),atom_site:I}),R=await rs(T,t,r);if(R.frameCount>0){let w=R.representative;Qo.Provider.set(w,s);let E=e.geom_bond._rowCount;if(E>0){let M={},{label:D}=e.atom_site;for(let J=0,ee=D.rowCount;J<ee;++J)M[D.value(J)]=J;let B=t.data.frame.categories.ccdc_geom_bond_type?.getField(""),k=[],F=[],z=[],j=[],Y=[],G=new Set,X=0,{atom_site_label_1:U,atom_site_label_2:L,valence:q,distance:te}=e.geom_bond;for(let J=0;J<E;++J){let ee=M[U.value(J)],ce=M[L.value(J)],fe=ee<ce?ca(ee,ce):ca(ce,ee);if(!G.has(fe)){if(G.add(fe),k[X]=ee,F[X]=ce,j[X]=te.value(J)||-1,B){let O=B.str(J);O==="D"?(z[X]=2,Y[X]=xt.Flag.Covalent):O==="A"?(z[X]=1,Y[X]=xt.Flag.Covalent|xt.Flag.Aromatic):O==="S"?(z[X]=1,Y[X]=xt.Flag.Covalent):(z[X]=1,Y[X]=xt.Flag.Covalent)}else Y[X]=xt.Flag.Covalent,z[X]=q.isDefined?q.value(J):1;X+=1}}Xo.Provider.set(w,Xo.fromData({pairs:{indexA:W.ofIntArray(k),indexB:W.ofIntArray(F),order:W.ofIntArray(z),distance:W.ofFloatArray(j),flag:W.ofIntArray(Y)},count:n}))}}return R}function A$e(e){if(!DF.is(e.sourceData))return;let{atom_site:t,atom_site_aniso:r}=e.sourceData.data.db,n=wr.ofPartialColumns(Em.Schema,{U:r.u},r._rowCount),o=Em.getElementToAnsiotropFromLabel(t.label,r.label);return{data:n,elementToAnsiotrop:o}}function T$e(e){return DF.is(e.sourceData)?e.sourceData.data.db.atom_site_aniso.u.isDefined:!1}Em.Provider.formatRegistry.add("cifCore",A$e,T$e);var DF;(r=>{function e(n){return n?.kind==="cifCore"}r.is=e;function t(n,o){return o||(o=Fu.schema.cifCore(n)),{kind:"cifCore",name:o.database_code.depnum_ccdc_archive.value(0)||o.database_code.depnum_ccdc_fiz.value(0)||o.database_code.icsd.value(0)||o.database_code.mdf.value(0)||o.database_code.nbs.value(0)||o.database_code.csd.value(0)||o.database_code.cod.value(0)||o._name,data:{db:o,frame:n}}}r.fromFrame=t})(DF||={});function L0e(e){let t=DF.fromFrame(e);return Ae.create("Parse CIF Core",r=>I$e(t.data.db,t,r))}async function P$e(e,t){let{atoms:r}=e,n=W.ofConst("MOL",e.atoms.count,W.Schema.str),o=W.ofConst("A",e.atoms.count,W.Schema.str),i=W.ofArray({array:W.mapToArray(r.number,m=>pce(m)),schema:W.Schema.Aliased(W.Schema.str)}),a=W.ofConst(1,r.count,W.Schema.int),s=wr.ofPartialColumns(Lo.atom_site,{auth_asym_id:o,auth_atom_id:i,auth_comp_id:n,auth_seq_id:a,Cartn_x:W.asArrayColumn(r.x,Float32Array),Cartn_y:W.asArrayColumn(r.y,Float32Array),Cartn_z:W.asArrayColumn(r.z,Float32Array),id:W.range(0,r.count-1),label_asym_id:o,label_atom_id:i,label_comp_id:n,label_seq_id:a,label_entity_id:W.ofConst("1",r.count,W.Schema.str),occupancy:W.ofConst(1,r.count,W.Schema.float),type_symbol:i,pdbx_PDB_model_num:W.ofConst(1,r.count,W.Schema.int)},r.count),l=new Ui;l.setNames([["MOL","Unknown Entity"]]),l.getEntityId("MOL",0,"A");let u=new Ni(a,i);u.setNames([["MOL","Unknown Molecule"]]),u.add("MOL",0);let c=ra({entity:l.getEntityTable(),chem_comp:u.getChemCompTable(),atom_site:s});return await rs(c,V0e.create(e),t)}var V0e;(r=>{function e(n){return n?.kind==="cube"}r.is=e;function t(n){return{kind:"cube",name:n.header.comment1,data:n}}r.create=t})(V0e||={});function O0e(e){return Ae.create("Parse Cube",t=>P$e(e,t))}var{skipWhitespace:G0e,eatValue:_$e,markLine:Md,getTokenString:Bd,skipStrictWhitespace:R$e}=St;function D$e(){return{mol_name:"",num_atoms:0,num_bonds:0,num_subst:0,num_feat:0,num_sets:0,mol_type:"",charge_type:"",status_bits:"",mol_comment:""}}function w$e(e,t){return{tokenizer:e,molecule:D$e(),runtimeCtx:t}}var U0e=/\s+/g;function M$e(e){let{tokenizer:t,molecule:r}=e;for(;Bd(t)!=="@<TRIPOS>MOLECULE"&&t.position<t.data.length;)Md(t);Md(t),r.mol_name=Bd(t),Md(t);let n=Bd(t).trim().split(U0e);r.num_atoms=parseInt(n[0]),r.num_bonds=parseInt(n[1]),r.num_subst=parseInt(n[2]),r.num_feat=parseInt(n[3]),r.num_sets=parseInt(n[4]),Md(t);let o=Bd(t);if(o.startsWith("@<TRIPOS>"))return;r.mol_type=o,Md(t);let i=Bd(t);if(i.startsWith("@<TRIPOS>"))return;r.charge_type=i,Md(t);let a=Bd(t);if(a.startsWith("@<TRIPOS>"))return;r.status_bits=a,Md(t);let s=Bd(t);s.startsWith("@<TRIPOS>")||(r.mol_comment=s)}function j8(e,t,r){let n=0;for(let o=0;o<e;o++){let i=0;for(G0e(r);R$e(r),r.tokenStart=r.position,_$e(r),r.tokenStart!==r.tokenEnd;){let a=t[i++];a&&We.addUnchecked(a,r.tokenStart,r.tokenEnd)}i>n&&(n=i);for(let a=i;a<t.length;a++)We.addUnchecked(t[a],0,0)}return n+1}async function B$e(e){let{tokenizer:t,molecule:r}=e;for(;Bd(t)!=="@<TRIPOS>ATOM"&&t.position<t.data.length;)Md(t);let n=t.position,o=t.lineNumber,i=We.create(t.data,r.num_atoms*2),a=We.create(t.data,r.num_atoms*2),s=We.create(t.data,r.num_atoms*2),l=We.create(t.data,r.num_atoms*2),u=We.create(t.data,r.num_atoms*2),c=We.create(t.data,r.num_atoms*2),m=We.create(t.data,r.num_atoms*2),d=We.create(t.data,r.num_atoms*2),p=We.create(t.data,r.num_atoms*2),h=We.create(t.data,r.num_atoms*2),f=W.Undefined(r.num_atoms,W.Schema.float),g=W.Undefined(r.num_atoms,W.Schema.int),y=W.Undefined(r.num_atoms,W.Schema.str);t.position=n,t.lineNumber=o;let x=0,S=[i,a,s,l,u,c,m,d,p,h],{length:I}=t,v=0;return await ys(e.runtimeCtx,1e5,void 0,P=>{let T=Math.min(r.num_atoms-v,P);return x=Math.max(x,j8(T,S,t)),v+=T,T},P=>P.update({message:"Parsing...",current:t.position,max:I})),{count:r.num_atoms,atom_id:jt(i)(W.Schema.int),atom_name:jt(a)(W.Schema.str),x:jt(s)(W.Schema.float),y:jt(l)(W.Schema.float),z:jt(u)(W.Schema.float),atom_type:x>5?jt(c)(W.Schema.str):y,subst_id:x>6?jt(m)(W.Schema.int):g,subst_name:x>7?jt(d)(W.Schema.str):y,charge:x>8?jt(p)(W.Schema.float):f,status_bits:x>9?jt(h)(W.Schema.str):y}}async function E$e(e){let{tokenizer:t,molecule:r}=e;for(;Bd(t)!=="@<TRIPOS>BOND"&&t.position<t.data.length;)Md(t);let n=t.position,o=t.lineNumber,i=We.create(t.data,r.num_bonds*2),a=We.create(t.data,r.num_bonds*2),s=We.create(t.data,r.num_bonds*2),l=We.create(t.data,r.num_bonds*2),u=We.create(t.data,r.num_bonds*2),c=W.Undefined(r.num_bonds,W.Schema.str);t.position=n,t.lineNumber=o;let m=0,d=[i,a,s,l,u],{length:p}=t,h=0;return await ys(e.runtimeCtx,1e5,void 0,g=>{let y=Math.min(r.num_bonds-h,g);return m=Math.max(m,j8(y,d,t)),h+=y,y},g=>g.update({message:"Parsing...",current:t.position,max:p})),{count:r.num_bonds,bond_id:jt(i)(W.Schema.int),origin_atom_id:jt(a)(W.Schema.int),target_atom_id:jt(s)(W.Schema.int),bond_type:jt(l)(W.Schema.str),status_bits:m>4?jt(u)(W.Schema.str):c}}async function k$e(e){let{tokenizer:t,molecule:r}=e;if(r.num_subst===0)return;for(;Bd(t)!=="@<TRIPOS>SUBSTRUCTURE"&&t.position<t.data.length;)Md(t);let n=t.position,o=t.lineNumber,i=We.create(t.data,r.num_subst*2),a=We.create(t.data,r.num_subst*2),s=We.create(t.data,r.num_subst*2),l=We.create(t.data,r.num_subst*2),u=We.create(t.data,r.num_subst*2),c=We.create(t.data,r.num_subst*2),m=We.create(t.data,r.num_subst*2),d=We.create(t.data,r.num_subst*2),p=We.create(t.data,r.num_subst*2),h=W.Undefined(r.num_subst,W.Schema.int),f=W.Undefined(r.num_subst,W.Schema.str);t.position=n,t.lineNumber=o;let g=0,y=[i,a,s,l,u,c,m,d,p],{length:x}=t,S=0;return await ys(e.runtimeCtx,1e5,void 0,v=>{let A=Math.min(r.num_subst-S,v);return g=Math.max(g,j8(A,y,t)),S+=A,A},v=>v.update({message:"Parsing...",current:t.position,max:x})),{count:r.num_subst,subst_id:jt(i)(W.Schema.int),subst_name:jt(a)(W.Schema.str),root_atom:jt(s)(W.Schema.int),subst_type:g>3?jt(l)(W.Schema.str):f,dict_type:g>4?jt(u)(W.Schema.str):f,chain:g>5?jt(c)(W.Schema.str):f,sub_type:g>6?jt(m)(W.Schema.str):f,inter_bonds:g>7?jt(d)(W.Schema.int):h,status_bits:g>8?jt(p)(W.Schema.str):f}}function F$e(e){let{tokenizer:t}=e;for(;t.position<t.data.length;){let n=Bd(t);if(n==="@<TRIPOS>MOLECULE")return;if(n==="@<TRIPOS>CRYSIN")break;Md(t)}if(t.position>=t.data.length)return;Md(t);let r=Bd(t).trim().split(U0e);return{a:parseFloat(r[0]),b:parseFloat(r[1]),c:parseFloat(r[2]),alpha:parseFloat(r[3]),beta:parseFloat(r[4]),gamma:parseFloat(r[5]),spaceGroup:parseInt(r[6],10),setting:parseInt(r[7],10)}}async function L$e(e,t,r){let n=St(t);e.update({message:"Parsing...",current:0,max:t.length});let o=[];for(;n.position<t.length;){let a=w$e(n,e);M$e(a);let s=await B$e(a),l=await E$e(a),u=await k$e(a),c=F$e(a);for(o.push({molecule:a.molecule,atoms:s,bonds:l,substructures:u,crysin:c}),G0e(n);Bd(n)!=="@<TRIPOS>MOLECULE"&&n.position<n.data.length;)Md(n)}let i={name:r,structures:o};return nn.success(i)}function N0e(e,t){return Ae.create("Parse MOL2",async r=>await L$e(r,e,t))}async function V$e(e,t){let r=[];for(let n=0,o=e.structures.length;n<o;++n){let{molecule:i,atoms:a,bonds:s,substructures:l,crysin:u}=e.structures[n],c=new Array(a.count),m=new Array(a.count),d=new Array(a.count),p=new Array(a.count),h=new Array(a.count),f=!1;for(let j=0;j<a.count;++j)if(a.atom_type.value(j).includes(".")){f=!0;break}let g=new Map;if(l)for(let j=0;j<l.count;++j){let Y=l.root_atom.value(j),G=l.chain.value(j),X=l.sub_type.value(j);g.set(Y,{chain:G,subType:X})}let y=new Ui,x=new Ni(a.subst_id,a.atom_name),S,I="",v=0,A="",P=0,T=-1;for(let j=0;j<a.count;++j){let Y=a.subst_name.value(j),G=a.subst_id.value(j),X=Y.replace(/\d+$/,"")||"MOL",U=Y.match(/(\d+)$/);h[j]=U?parseInt(U[1]):G;let L=g.get(a.atom_id.value(j));if(L&&(S=L),S&&S.subType&&S.subType!=="UNK"&&(X=S.subType),d[j]=f?a.atom_type.value(j).split(".")[0].toUpperCase():Bp(a.atom_name.value(j),X),p[j]=X,G!==T){let q=Ql(x.add(X,j).type,X);S?.chain?A=S.chain:(q!==P||G!==T+1)&&(A=eh(v),v+=1),I=y.getEntityId(X,q,A),T=G,P=q}c[j]=I,m[j]=A}let R=W.ofStringArray(d),w=W.ofStringArray(p),E=W.ofStringArray(c),M=W.ofStringArray(m),D=W.asArrayColumn(a.atom_name),B=W.ofIntArray(h),k=wr.ofPartialColumns(Lo.atom_site,{auth_asym_id:M,auth_atom_id:D,auth_comp_id:w,auth_seq_id:B,Cartn_x:W.asArrayColumn(a.x,Float32Array),Cartn_y:W.asArrayColumn(a.y,Float32Array),Cartn_z:W.asArrayColumn(a.z,Float32Array),id:W.asArrayColumn(a.atom_id),label_asym_id:M,label_atom_id:D,label_comp_id:w,label_seq_id:a.subst_id,label_entity_id:E,occupancy:W.ofConst(1,a.count,W.Schema.float),type_symbol:R,pdbx_PDB_model_num:W.ofConst(n,a.count,W.Schema.int)},a.count),F=ra({entity:y.getEntityTable(),chem_comp:x.getChemCompTable(),atom_site:k}),z=await rs(F,z0e.create(e),t);if(z.frameCount>0){let j=W.ofIntArray(W.mapToArray(s.origin_atom_id,te=>te-1,Int32Array)),Y=W.ofIntArray(W.mapToArray(s.target_atom_id,te=>te-1,Int32Array)),G=s.bond_id,X=W.ofIntArray(W.mapToArray(s.bond_type,te=>{switch(te){case"ar":case"am":case"un":return 1;case"du":case"nc":return 0;default:return parseInt(te)}},Int8Array)),U=W.ofIntArray(W.mapToArray(s.bond_type,te=>{switch(te){case"ar":case"am":return xt.Flag.Aromatic|xt.Flag.Covalent;case"du":case"nc":return xt.Flag.None;default:return xt.Flag.Covalent}},Int8Array)),L=Xo.fromData({pairs:{key:G,indexA:j,indexB:Y,order:X,flag:U},count:a.count},{maxDistance:u?-1:1/0}),q=z.representative;if(Xo.Provider.set(q,L),Pg.Provider.set(q,{data:a.charge,type:i.charge_type}),u){let te=O$e(u);te&&Qo.Provider.set(q,te)}r.push(q)}}return new Rl(r)}function O$e(e){if(e.setting!==1)return;let t=ha.create(e.spaceGroup,b.create(e.a,e.b,e.c),b.scale(b(),b.create(e.alpha,e.beta,e.gamma),Math.PI/180));return{spacegroup:rl.create(t),assemblies:[],isNonStandardCrystalFrame:!1,ncsOperators:[]}}var z0e;(r=>{function e(n){return n?.kind==="mol2"}r.is=e;function t(n){return{kind:"mol2",name:n.name,data:n}}r.create=t})(z0e||={});function H0e(e){return Ae.create("Parse MOL2",t=>V$e(e,t))}var gA=new Uint32Array([0,0,0,0,0,0,0,0,0,8,10,12,16,20,25,32,40,50,64,80,101,128,161,203,256,322,406,512,645,812,1024,1290,1625,2048,2580,3250,4096,5060,6501,8192,10321,13003,16384,20642,26007,32768,41285,52015,65536,82570,104031,131072,165140,208063,262144,330280,416127,524287,660561,832255,1048576,1321122,1664510,2097152,2642245,3329021,4194304,5284491,6658042,8388607,10568983,13316085,16777216]),W8=9,Ed;(c=>{function e(m){let d=1,p=0;for(;m>=d&&p<32;)p++,d<<=1;return p}c.sizeOfInt=e;let t=new Uint8Array(32);function r(m,d){let p=1,h=0;t[0]=1;for(let g=0;g<m;g++){let y,x=0;for(y=0;y<p;y++)x+=t[y]*d[g],t[y]=x&255,x>>=8;for(;x!==0;)t[y++]=x&255,x>>=8;p=y}let f=1;for(p--;t[p]>=f;)h++,f*=2;return h+p*8}c.sizeOfInts=r;let n=new ArrayBuffer(24);c.buf=new Int32Array(n);let i=new Uint32Array(n);function a(m,d,p){let h=p,f=(1<<h)-1,g=i[1],y=i[2],x=c.buf[0],S=0;for(;h>=8;)y=y<<8|m[d+x++],S|=y>>g<<h-8,h-=8;return h>0&&(g<h&&(g+=8,y=y<<8|m[d+x++]),g-=h,S|=y>>g&(1<<h)-1),S&=f,c.buf[0]=x,c.buf[1]=g,c.buf[2]=y,S}c.decodeBits=a;function s(m,d){let p=i[2],h=c.buf[0];return p=p<<8|m[d+h],c.buf[0]=h+1,c.buf[2]=p,p>>i[1]&255}let l=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];function u(m,d,p,h,f){let g=p,y=0;for(l[0]=0,l[1]=0,l[2]=0,l[3]=0;g>8;)l[y++]=s(m,d),g-=8;g>0&&(l[y++]=a(m,d,g));for(let x=2;x>0;x--){let S=0,I=h[x];for(let v=y-1;v>=0;v--){S=S<<8|l[v];let A=S/I|0;l[v]=A,S=S-A*I}f[x]=S}f[0]=l[0]|l[1]<<8|l[2]<<16|l[3]<<24}c.decodeInts=u})(Ed||={});function G$e(){throw new Error("(xdrfile error) Undefined error.")}async function U$e(e,t){let r=new DataView(t.buffer,t.byteOffset),n={frames:[],boxes:[],times:[],timeOffset:0,deltaTime:0},o=n.frames,i=n.boxes,a=n.times,s=[0,0,0,0,0,0],l=[0,0,0],u=[0,0,0],c=[0,0,0],m=[.1,.1,.1],d=[.1,.1,.1],p=0,h=Ed.buf;for(;;){let f,g=r.getInt32(p+4);p+=12,a.push(r.getFloat32(p)),p+=4;let y=new Float32Array(9);for(let x=0;x<9;++x)y[x]=r.getFloat32(p)*10,p+=4;if(i.push(y),g<=9){f={count:g,x:new Float32Array(g),y:new Float32Array(g),z:new Float32Array(g)},p+=4;for(let x=0;x<g;++x)f.x[x]=r.getFloat32(p),f.y[x]=r.getFloat32(p+4),f.z[x]=r.getFloat32(p+8),p+=12}else{h[0]=h[1]=h[2]=0,l[0]=l[1]=l[2]=0,c[0]=c[1]=c[2]=0,u[0]=u[1]=u[2]=0,m[0]=m[1]=m[2]=0,d[0]=d[1]=d[2]=0,f={count:g,x:new Float32Array(g),y:new Float32Array(g),z:new Float32Array(g)};let x=0,S=r.getInt32(p);p+=4;let I=r.getFloat32(p);p+=4,s[0]=r.getInt32(p),s[1]=r.getInt32(p+4),s[2]=r.getInt32(p+8),s[3]=r.getInt32(p+12),s[4]=r.getInt32(p+16),s[5]=r.getInt32(p+20),l[0]=s[3]-s[0]+1,l[1]=s[4]-s[1]+1,l[2]=s[5]-s[2]+1,p+=24;let v;(l[0]|l[1]|l[2])>16777215?(u[0]=Ed.sizeOfInt(l[0]),u[1]=Ed.sizeOfInt(l[1]),u[2]=Ed.sizeOfInt(l[2]),v=0):v=Ed.sizeOfInts(3,l);let A=r.getInt32(p);p+=4;let P=A-1;P=W8>P?W8:P;let T=gA[P]/2|0,R=gA[A]/2|0;c[0]=c[1]=c[2]=gA[A];let w=Math.ceil(r.getInt32(p)/4)*4;p+=4;let E=1/I,M=0,D=0;for(m[0]=m[1]=m[2]=0;D<S;){v===0?(m[0]=Ed.decodeBits(t,p,u[0]),m[1]=Ed.decodeBits(t,p,u[1]),m[2]=Ed.decodeBits(t,p,u[2])):Ed.decodeInts(t,p,v,l,m),D++,m[0]+=s[0],m[1]+=s[1],m[2]+=s[2],d[0]=m[0],d[1]=m[1],d[2]=m[2];let B=Ed.decodeBits(t,p,1),k=0;if(B===1&&(M=Ed.decodeBits(t,p,5),k=M%3,M-=k,k--),M>0){m[0]=m[1]=m[2]=0;for(let F=0;F<M;F+=3){if(Ed.decodeInts(t,p,A,c,m),D++,m[0]+=d[0]-R,m[1]+=d[1]-R,m[2]+=d[2]-R,F===0){let z=m[0];m[0]=d[0],d[0]=z,z=m[1],m[1]=d[1],d[1]=z,z=m[2],m[2]=d[2],d[2]=z,f.x[x]=d[0]*E,f.y[x]=d[1]*E,f.z[x]=d[2]*E,x++}else d[0]=m[0],d[1]=m[1],d[2]=m[2];f.x[x]=m[0]*E,f.y[x]=m[1]*E,f.z[x]=m[2]*E,x++}}else f.x[x]=m[0]*E,f.y[x]=m[1]*E,f.z[x]=m[2]*E,x++;A+=k,k<0?(R=T,A>W8?T=gA[A-1]/2|0:T=0):k>0&&(T=R,R=gA[A]/2|0),c[0]=c[1]=c[2]=gA[A],(c[0]===0||c[1]===0||c[2]===0)&&G$e()}p+=w}for(let x=0;x<g;x++)f.x[x]*=10,f.y[x]*=10,f.z[x]*=10;if(o.push(f),e.shouldUpdate&&await e.update({current:p,max:t.length}),p>=t.length)break}return a.length>=1&&(n.timeOffset=a[0]),a.length>=2&&(n.deltaTime=a[1]-a[0]),n}function j0e(e){return Ae.create("Parse XTC",async t=>{try{t.update({canAbort:!0,message:"Parsing trajectory..."});let r=await U$e(t,e);return nn.success(r)}catch(r){return nn.error(""+r)}})}function W0e(e){return Ae.create("Parse XTC",async t=>{await t.update("Converting to coordinates");let r=bs(e.deltaTime,"step"),n=bs(e.timeOffset,r.unit),o=[];for(let i=0,a=e.frames.length;i<a;++i){let s=e.boxes[i],l=b.fromArray(b(),s,0),u=b.fromArray(b(),s,3),c=b.fromArray(b(),s,6);o.push({elementCount:e.frames[i].count,cell:Rd.fromBasis(l,u,c),x:e.frames[i].x,y:e.frames[i].y,z:e.frames[i].z,xyzOrdering:{isIdentity:!0},time:bs(n.value+r.value*i,r.unit)})}return vd.create(o,r,n)})}function N$e(e){let t=e.position>=e.data.length-1?0:+St.readLine(e);isNaN(t)&&(t=0);let r=St.readLine(e),n=new Float64Array(t),o=new Float64Array(t),i=new Float64Array(t),a=new Array(t);for(let s=0;s<t;++s){let u=St.readLineTrim(e).split(/\s+/g);a[s]=u[0],n[s]=+u[1],o[s]=+u[2],i[s]=+u[3]}return{count:t,comment:r,x:W.ofFloatArray(n),y:W.ofFloatArray(o),z:W.ofFloatArray(i),type_symbol:W.ofStringArray(a)}}function z$e(e){let t=St(e),r=[];for(;;){let o=N$e(t);if(o.count===0)break;r.push(o)}let n={molecules:r};return nn.success(n)}function X0e(e){return Ae.create("Parse Mol",async()=>z$e(e))}function H$e(e,t){let{molecules:r}=e,n=0;for(let S of r)n+=S.count;let o=new Array(n),i=new Int32Array(n),a=new Float32Array(n),s=new Float32Array(n),l=new Float32Array(n),u=new Int32Array(n),c=0;for(let S=0;S<r.length;S++){let I=r[S];for(let v=0;v<I.count;v++)o[c]=I.type_symbol.value(v),a[c]=I.x.value(v),s[c]=I.y.value(v),l[c]=I.z.value(v),i[c]=v,u[c]=S,c++}let m=W.ofConst("MOL",n,W.Schema.str),d=W.ofConst("A",n,W.Schema.str),p=W.ofConst(1,n,W.Schema.int),h=W.ofStringArray(o),f=wr.ofPartialColumns(Lo.atom_site,{auth_asym_id:d,auth_atom_id:h,auth_comp_id:m,auth_seq_id:p,Cartn_x:W.ofFloatArray(a),Cartn_y:W.ofFloatArray(s),Cartn_z:W.ofFloatArray(l),id:W.ofIntArray(i),label_asym_id:d,label_atom_id:h,label_comp_id:m,label_seq_id:p,label_entity_id:W.ofConst("1",n,W.Schema.str),occupancy:W.ofConst(1,n,W.Schema.float),type_symbol:h,pdbx_PDB_model_num:W.ofIntArray(u)},n),g=new Ui;g.setNames([["MOL","Unknown Entity"]]),g.getEntityId("MOL",0,"A");let y=new Ni(p,h);y.setNames([["MOL","Unknown Molecule"]]),y.add("MOL",0);let x=ra({entity:g.getEntityTable(),chem_comp:y.getChemCompTable(),atom_site:f});return rs(x,Q0e.create(e),t)}var Q0e;(r=>{function e(n){return n?.kind==="xyz"}r.is=e;function t(n){return{kind:"xyz",name:"xyz",data:n}}r.create=t})(Q0e||={});function Z0e(e){return Ae.create("Parse XYZ",t=>H$e(e,t))}var PR={lj:{mass:"unitless",distance:"unitless",time:"unitless",energy:"unitless",velocity:"unitless",force:"unitless",torque:"unitless",temperature:"unitless",pressure:"unitless",viscosity:"unitless",charge:"unitless",density:"unitless",scale:1},real:{mass:"grams/mole",distance:"Angstroms",time:"femtoseconds",energy:"Kcal/mol",velocity:"Angstroms/femtosecond",force:"Kcal/mol-Angstrom",torque:"Kcal/mol",temperature:"Kelvin",pressure:"atmospheres",viscosity:"Poise",charge:"multiple of electron charge",dipole:"charge*Angstroms",electricField:"volts/Angstrom",density:"g/cm^3",scale:1},metal:{mass:"grams/mole",distance:"Angstroms",time:"picoseconds",energy:"eV",velocity:"Angstroms/picosecond",force:"eV/Angstrom",torque:"eV",temperature:"Kelvin",pressure:"bars",viscosity:"Poise",charge:"multiple of electron charge",dipole:"charge*Angstroms",electricField:"volts/Angstrom",density:"g/cm^3",scale:1},si:{mass:"kilograms",distance:"meters",time:"seconds",energy:"Joules",velocity:"meters/second",force:"Newtons",torque:"Newton-meters",temperature:"Kelvin",pressure:"Pascals",viscosity:"Pascal*second",charge:"Coulombs",dipole:"Coulombs*meters",electricField:"volts/meter",density:"kg/m^3",scale:1},cgs:{mass:"grams",distance:"centimeters",time:"seconds",energy:"ergs",velocity:"centimeters/second",force:"dynes",torque:"dyne-centimeters",temperature:"Kelvin",pressure:"dyne/cm^2",viscosity:"Poise",charge:"statcoulombs",dipole:"statcoul-cm",electricField:"statvolt/cm",density:"g/cm^3",scale:1},electron:{mass:"atomic mass units",distance:"Bohr",time:"femtoseconds",energy:"Hartrees",velocity:"Bohr/atomic time units",force:"Hartrees/Bohr",temperature:"Kelvin",pressure:"Pascals",charge:"multiple of electron charge",dipole:"Debye",electricField:"volts/cm",density:"unitless",torque:"",viscosity:"",scale:.529177},micro:{mass:"picograms",distance:"micrometers",time:"microseconds",energy:"picogram-micrometer^2/microsecond^2",velocity:"micrometers/microsecond",force:"picogram-micrometer/microsecond^2",torque:"picogram-micrometer^2/microsecond^2",temperature:"Kelvin",pressure:"picogram/(micrometer-microsecond^2)",viscosity:"picogram/(micrometer-microsecond)",charge:"picocoulombs",dipole:"picocoulomb-micrometer",electricField:"volt/micrometer",density:"pg/\u03BCm^3",scale:1},nano:{mass:"attograms",distance:"nanometers",time:"nanoseconds",energy:"attogram-nanometer^2/nanosecond^2",velocity:"nanometers/nanosecond",force:"attogram-nanometer/nanosecond^2",torque:"attogram-nanometer^2/nanosecond^2",temperature:"Kelvin",pressure:"attogram/(nanometer-nanosecond^2)",viscosity:"attogram/(nanometer-nanosecond)",charge:"multiple of electron charge",dipole:"charge-nanometer",electricField:"volt/nanometer",density:"ag/nm^3",scale:10}},X8=["real","metal","si","cgs","electron","micro","nano","lj"];var{readLine:Y0e,skipWhitespace:K0e,eatValue:J0e,eatLine:j$e,markStart:Q8}=St,q0e=/\s+/;function W$e(e,t){return{tokenizer:e,runtimeCtx:t}}async function X$e(e,t,r){let{tokenizer:n}=e,o=We.create(n.data,t*2),i=We.create(n.data,t*2),a=We.create(n.data,t*2),s=We.create(n.data,t*2),l=We.create(n.data,t*2),u=We.create(n.data,t*2),c=We.create(n.data,t*2),m={full:[o,i,a,s,l,u,c],atomic:[o,a,l,u,c],bond:[o,i,a,l,u,c]},d=m[r].length,{position:p}=n;Y0e(n).trim(),n.position=p;let{length:h}=n,f=0;return await ys(e.runtimeCtx,1e5,void 0,g=>{let y=Math.min(t-f,g);for(let x=0;x<y;++x){for(let S=0;S<d;++S){K0e(n),Q8(n),J0e(n);let I=m[r][S];I&&We.addUnchecked(I,n.tokenStart,n.tokenEnd)}j$e(n),Q8(n)}return f+=y,y},g=>g.update({message:"Parsing...",current:n.position,max:h})),{count:t,atomId:jt(o)(W.Schema.int),moleculeId:jt(i)(W.Schema.int),atomType:jt(a)(W.Schema.int),charge:jt(s)(W.Schema.float),x:jt(l)(W.Schema.float),y:jt(u)(W.Schema.float),z:jt(c)(W.Schema.float)}}async function Q$e(e,t){let{tokenizer:r}=e,n=We.create(r.data,t*2),o=We.create(r.data,t*2),i=We.create(r.data,t*2),a=We.create(r.data,t*2),{length:s}=r,l=0;return await ys(e.runtimeCtx,10,void 0,u=>{let c=Math.min(t-l,u);for(let m=0;m<c;++m)for(let d=0;d<4;++d)switch(K0e(r),Q8(r),J0e(r),d){case 0:We.addUnchecked(n,r.tokenStart,r.tokenEnd);break;case 1:We.addUnchecked(o,r.tokenStart,r.tokenEnd);break;case 2:We.addUnchecked(i,r.tokenStart,r.tokenEnd);break;case 3:We.addUnchecked(a,r.tokenStart,r.tokenEnd);break}return l+=c,c},u=>u.update({message:"Parsing...",current:r.position,max:s})),{count:t,bondId:jt(n)(W.Schema.int),bondType:jt(o)(W.Schema.int),atomIdA:jt(i)(W.Schema.int),atomIdB:jt(a)(W.Schema.int)}}var Z$e=["full","atomic","bond"];async function q$e(e,t){let r=St(e),n=W$e(r,t),o,i,a=0,s=0,l="full";for(;r.tokenEnd<r.length;){let c=Y0e(n.tokenizer).trim();if(c.includes("atoms"))a=parseInt(c.split(q0e)[0]);else if(c.includes("bonds"))s=parseInt(c.split(q0e)[0]);else if(!c.includes("Masses"))if(c.includes("Atoms")){let m=c.split("#");if(m.length>1){let d=m[1].trim();Z$e.includes(d)?l=d:console.warn(`Unknown atom style: ${d}`)}o=await X$e(n,a,l)}else c.includes("Bonds")&&(i=await Q$e(n,s))}if(o===void 0)return nn.error("no atoms data");i===void 0&&(i={count:0,bondId:W.ofIntArray([]),bondType:W.ofIntArray([]),atomIdA:W.ofIntArray([]),atomIdB:W.ofIntArray([])});let u={atoms:o,bonds:i};return nn.success(u)}function $0e(e){return Ae.create("Parse LammpsData",async t=>await q$e(e,t))}async function Y$e(e,t,r="real"){let{atoms:n,bonds:o}=e,i=[],a=n.count,s=PR[r].scale,l=new Array(a),u=new Int32Array(a),c=new Float32Array(a),m=new Float32Array(a),d=new Float32Array(a),p=new Int32Array(a),h=0;for(let T=0;T<a;T++)l[h]=n.atomType.value(T).toString(),c[h]=n.x.value(T)*s,m[h]=n.y.value(T)*s,d[h]=n.z.value(T)*s,u[h]=n.atomId.value(T)-1,p[h]=0,h++;let f=W.ofConst("MOL",a,W.Schema.str),g=W.ofLambda({value:T=>n.moleculeId.value(T).toString(),rowCount:a,schema:W.Schema.str}),y=W.ofConst(1,a,W.Schema.int),x=W.ofStringArray(l),S=wr.ofPartialColumns(Lo.atom_site,{auth_asym_id:g,auth_atom_id:x,auth_comp_id:f,auth_seq_id:y,Cartn_x:W.ofFloatArray(c),Cartn_y:W.ofFloatArray(m),Cartn_z:W.ofFloatArray(d),id:W.ofIntArray(u),label_asym_id:g,label_atom_id:x,label_comp_id:f,label_seq_id:y,label_entity_id:W.ofConst("1",a,W.Schema.str),occupancy:W.ofConst(1,a,W.Schema.float),type_symbol:x,pdbx_PDB_model_num:W.ofIntArray(p)},a),I=new Ui;I.setNames([["MOL","Unknown Entity"]]),I.getEntityId("MOL",0,"A");let v=new Ni(y,x);v.setNames([["MOL","Unknown Molecule"]]),v.add("MOL",0);let A=ra({entity:I.getEntityTable(),chem_comp:v.getChemCompTable(),atom_site:S}),P=await rs(A,eSe.create(e),t);if(P.frameCount>0){let T=P.representative;if(o.count!==0){let R=W.ofIntArray(W.mapToArray(o.atomIdA,k=>k-1,Int32Array)),w=W.ofIntArray(W.mapToArray(o.atomIdB,k=>k-1,Int32Array)),E=o.bondId,M=W.ofConst(1,o.count,W.Schema.int),D=W.ofConst(xt.Flag.Covalent,o.count,W.Schema.int),B=Xo.fromData({pairs:{key:E,indexA:R,indexB:w,order:M,flag:D},count:n.count},{maxDistance:1/0});Xo.Provider.set(T,B)}Pg.Provider.set(T,{data:n.charge,type:"NO_CHARGES"}),i.push(T)}return new Rl(i)}var eSe;(r=>{function e(n){return n?.kind==="data"}r.is=e;function t(n){return{kind:"data",name:"data",data:n}}r.create=t})(eSe||={});function tSe(e,t){return t===void 0&&(t="real"),Ae.create("Parse Lammps Data",r=>Y$e(e,r,t))}var{readLine:yA,skipWhitespace:K$e,eatValue:J$e,eatLine:$$e,markStart:rSe}=St;function eet(e,t){return{tokenizer:e,runtimeCtx:t}}async function tet(e,t,r){let{tokenizer:n}=e,o=Object.fromEntries(r.map((S,I)=>[S,I])),i=r.findIndex(S=>S[0]==="x"),a=r.findIndex(S=>S[0]==="y"),s=r.findIndex(S=>S[0]==="z"),l=r[i],u=We.create(n.data,t*2),c=We.create(n.data,t*2),m=We.create(n.data,t*2),d=We.create(n.data,t*2),p=We.create(n.data,t*2),h=We.create(n.data,t*2),{position:f}=n;n.position=f;let g=r.length,{length:y}=n,x=0;return await ys(e.runtimeCtx,1e5,void 0,S=>{let I=Math.min(t-x,S);for(let v=0;v<I;++v){for(let A=0;A<g;++A)switch(K$e(n),rSe(n),J$e(n),A){case o.id:We.addUnchecked(u,n.tokenStart,n.tokenEnd);break;case o.mol:We.addUnchecked(c,n.tokenStart,n.tokenEnd);break;case o.type:We.addUnchecked(m,n.tokenStart,n.tokenEnd);break;case i:We.addUnchecked(d,n.tokenStart,n.tokenEnd);break;case a:We.addUnchecked(p,n.tokenStart,n.tokenEnd);break;case s:We.addUnchecked(h,n.tokenStart,n.tokenEnd);break}$$e(n),rSe(n)}return x+=I,I},S=>S.update({message:"Parsing...",current:n.position,max:y})),{count:t,atomMode:l,atomId:jt(u)(W.Schema.int),moleculeId:jt(c)(W.Schema.int),atomType:jt(m)(W.Schema.int),x:jt(d)(W.Schema.float),y:jt(p)(W.Schema.float),z:jt(h)(W.Schema.float)}}async function ret(e,t){let r=St(e),n=eet(r,t),o={frames:[],times:[],bounds:[],timeOffset:0,deltaTime:0},i=o.frames,a=0,s=0;for(;r.tokenEnd<r.length;){let l=yA(n.tokenizer).trim();if(l.includes("ITEM: TIMESTEP"))s=parseInt(yA(n.tokenizer).trim()),o.times.push(s);else if(l.includes("ITEM: NUMBER OF ATOMS"))a=parseInt(yA(n.tokenizer).trim());else if(l.includes("ITEM: ATOMS")){let u=l.split(" ").slice(2),c=await tet(n,a,u);i.push(c)}else if(l.includes("ITEM: BOX BOUNDS")){let u=l.split("ITEM: BOX BOUNDS ")[1].split(" "),c=u[0],m=u[1],d=u[2],p=yA(n.tokenizer).trim().split(" "),h=yA(n.tokenizer).trim().split(" "),f=yA(n.tokenizer).trim().split(" "),g=parseFloat(p[0]),y=parseFloat(p[1]),x=parseFloat(h[0]),S=parseFloat(h[1]),I=parseFloat(f[0]),v=parseFloat(f[1]);o.bounds.push({lower:[g,x,I],length:[y-g,S-x,v-I],periodicity:[c,m,d]})}}return o.times.length>=1&&(o.timeOffset=o.times[0]),o.times.length>=2&&(o.deltaTime=o.times[1]-o.times[0]),nn.success(o)}function Z8(e){return Ae.create("Parse Lammp Trajectory",async t=>await ret(e,t))}function q8(e,t="real"){return Ae.create("Parse Lammps Trajectory",async r=>{await r.update("Converting to coordinates");let n=PR[t].scale,o=bs(e.deltaTime,"step"),i=bs(e.timeOffset,o.unit),a={x:0,y:0,z:0},s={x:1,y:1,z:1},u=e.frames[0].atomMode.includes("s"),c=[];for(let m=0,d=e.frames.length;m<d;++m){let p=e.bounds[m];u&&(s.x=p.length[0],s.y=p.length[1],s.z=p.length[2],a.x=p.lower[0],a.y=p.lower[1],a.z=p.lower[2]);let h=e.frames[m].count,f=new Float32Array(h),g=new Float32Array(h),y=new Float32Array(h),x=0;for(let S=0;S<h;S++)f[x]=(e.frames[m].x.value(S)*s.x+a.x)*n,g[x]=(e.frames[m].y.value(S)*s.y+a.y)*n,y[x]=(e.frames[m].z.value(S)*s.z+a.z)*n,x++;c.push({elementCount:e.frames[m].count,x:f,y:g,z:y,xyzOrdering:{isIdentity:!0},time:bs(i.value+o.value*m,o.unit)})}return vd.create(c,o,i)})}async function net(e,t,r="real"){let n=e.frames[0],o=n.count,i=n.atomMode,a=e.bounds[0],s={x:0,y:0,z:0},l={x:1,y:1,z:1},u=PR[r].scale;i.includes("s")&&(l.x=a.length[0],l.y=a.length[1],l.z=a.length[2],s.x=a.lower[0],s.y=a.lower[1],s.z=a.lower[2]);let c=new Array(o),m=new Int32Array(o),d=new Float32Array(o),p=new Float32Array(o),h=new Float32Array(o),f=new Int32Array(o),g=0;for(let M=0;M<o;M++)c[g]=n.atomType.value(M).toString(),d[g]=(n.x.value(M)*l.x+s.x)*u,p[g]=(n.y.value(M)*l.y+s.y)*u,h[g]=(n.z.value(M)*l.z+s.z)*u,m[g]=n.atomId.value(M),f[g]=0,g++;let y=W.ofConst("MOL",o,W.Schema.str),x=W.ofLambda({value:M=>n.moleculeId.value(M).toString(),rowCount:o,schema:W.Schema.str}),S=W.ofConst(1,o,W.Schema.int),I=W.ofStringArray(c),v=wr.ofPartialColumns(Lo.atom_site,{auth_asym_id:x,auth_atom_id:I,auth_comp_id:y,auth_seq_id:S,Cartn_x:W.ofFloatArray(d),Cartn_y:W.ofFloatArray(p),Cartn_z:W.ofFloatArray(h),id:W.ofIntArray(m),label_asym_id:x,label_atom_id:I,label_comp_id:y,label_seq_id:S,label_entity_id:W.ofConst("1",o,W.Schema.str),occupancy:W.ofConst(1,o,W.Schema.float),type_symbol:I,pdbx_PDB_model_num:W.ofIntArray(f)},o),A=new Ui;A.setNames([["MOL","Unknown Entity"]]),A.getEntityId("MOL",0,"A");let P=new Ni(S,I);P.setNames([["MOL","Unknown Molecule"]]),P.add("MOL",0);let T=ra({entity:A.getEntityTable(),chem_comp:P.getChemCompTable(),atom_site:v}),w=(await rs(T,nSe.create(e),t)).representative,E=await q8(e,r).runInContext(t);return Gt.trajectoryFromModelAndCoordinates(w,E)}var nSe;(r=>{function e(n){return n?.kind==="lammpstrj"}r.is=e;function t(n){return{kind:"lammpstrj",name:"lammpstrj",data:n}}r.create=t})(nSe||={});function oSe(e,t){return t===void 0&&(t="real"),Ae.create("Parse Lammps Traj Data",r=>net(e,r,t))}function iSe(e){return e.trim().endsWith("V3000")}function aSe(e){let t=We.create(e.data,1),r=We.create(e.data,1);return St.eatLine(e),yb(e),yb(e),yb(e),gb(e,t),gb(e,r),St.eatLine(e),{atomCount:jt(t)(W.Schema.int).value(0),bondCount:jt(r)(W.Schema.int).value(0)}}function sSe(e,t){let r=We.create(e.data,t*2),n=We.create(e.data,t*2),o=We.create(e.data,t*2),i=We.create(e.data,t*2);for(let a=0;a<t;++a){St.markLine(e),yb(e),yb(e),yb(e);let{position:s}=e;gb(e,i),gb(e,r),gb(e,n),gb(e,o),e.position=s}return St.eatLine(e),St.eatLine(e),{count:t,x:jt(r)(W.Schema.float),y:jt(n)(W.Schema.float),z:jt(o)(W.Schema.float),type_symbol:jt(i)(W.Schema.str),formal_charge:W.ofConst(0,t,W.Schema.int)}}function lSe(e,t){let r=We.create(e.data,t*2),n=We.create(e.data,t*2),o=We.create(e.data,t*2);for(let i=0;i<t;++i){St.markLine(e),yb(e),yb(e),yb(e);let{position:a}=e;gb(e,o),gb(e,r),gb(e,n),e.position=a}return St.eatLine(e),St.eatLine(e),{count:t,atomIdxA:jt(r)(W.Schema.float),atomIdxB:jt(n)(W.Schema.float),order:jt(o)(W.Schema.float)}}function yb(e){St.skipWhitespace(e),St.eatValue(e)}function gb(e,t){let{position:r}=e;St.skipWhitespace(e),St.eatValue(e),St.trim(e,r,e.position),We.addUnchecked(t,e.tokenStart,e.tokenEnd)}var Y8="$$$$";function oet(e){let t=We.create(e.data,32),r=We.create(e.data,32);for(;e.position<e.length;){let n=St.readLine(e);if(n.startsWith(Y8))break;if(n&&n.startsWith("> ")){We.add(t,e.tokenStart+2,e.tokenEnd),St.markLine(e);let o=e.tokenStart,i=e.tokenEnd,a=!1;for(;e.position<e.length;){let s=St.readLine(e);if(!s||s.startsWith(Y8)||s.startsWith("> ")){We.add(r,o,i),a=!0;break}i=e.tokenEnd}a||We.add(r,o,i)}}return{dataHeader:jt(t)(W.Schema.str),data:jt(r)(W.Schema.str)}}function iet(e){return{atomCount:+e.substr(0,3),bondCount:+e.substr(3,3)}}function aet(e){let t=St.readLine(e).trim(),r=St.readLine(e).trim(),n=St.readLine(e).trim(),o=St.readLine(e),i=iSe(o),{atomCount:a,bondCount:s}=i?aSe(e):iet(o);if(Number.isNaN(a)||Number.isNaN(s)){for(;e.position<e.length&&!St.readLine(e).startsWith(Y8););return}let l={atomIdx:W.ofConst(0,a,W.Schema.int),charge:W.ofConst(0,a,W.Schema.int)},u=i?sSe(e,a):U8(e,a),c=i?lSe(e,s):N8(e,s),m=i?{formalCharges:l}:z8(e),d=oet(e);return{molFile:{title:t,program:r,comment:n,atoms:u,bonds:c,...m},dataItems:d}}function set(e){let t=St(e),r=[];for(;t.position<t.length;){let n=aet(t);n&&r.push(n)}return nn.success({compounds:r})}function uSe(e){return Ae.create("Parse Sdf",async()=>set(e))}var cSe;(r=>{function e(n){return n?.kind==="sdf"}r.is=e;function t(n){return{kind:"sdf",name:n.molFile.title,data:n}}r.create=t})(cSe||={});function mSe(e){return Ae.create("Parse SDF",t=>H8(e.molFile,cSe.create(e),t))}async function uet(e){let t=new DataView(e.buffer),r={frames:[],boxes:[],times:[],timeOffset:0,deltaTime:0},n=r.frames,o=r.boxes,i=r.times,a=0;for(;;){a+=8;let s=t.getInt32(a);a+=4,a+=s;let l=t.getInt32(a+8),u=t.getInt32(a+12),c=t.getInt32(a+16),m=t.getInt32(a+28),d=t.getInt32(a+32),p=t.getInt32(a+36),h=t.getInt32(a+40);a+=52;let f=l/9,g=h*3;if(f===8?i.push(t.getFloat64(a)):i.push(t.getFloat32(a)),a+=2*f,l){let y=new Float32Array(9);if(f===8)for(let x=0;x<9;++x)y[x]=t.getFloat64(a)*10,a+=8;else for(let x=0;x<9;++x)y[x]=t.getFloat32(a)*10,a+=4;o.push(y)}if(a+=u,a+=c,m){let y=new Float32Array(h),x=new Float32Array(h),S=new Float32Array(h);if(f===8)for(let I=0;I<h;++I)y[I]=t.getFloat64(a)*10,x[I]=t.getFloat64(a+8)*10,S[I]=t.getFloat64(a+16)*10,a+=24;else{let I=new Uint32Array(e.buffer,a,g);for(let A=0;A<g;++A){let P=I[A];I[A]=(P&255)<<24|(P&65280)<<8|P>>8&65280|P>>24&255}let v=new Float32Array(e.buffer,a,g);for(let A=0;A<h;++A)y[A]=v[A*3]*10,x[A]=v[A*3+1]*10,S[A]=v[A*3+2]*10,a+=12}n.push({count:h,x:y,y:x,z:S})}if(a+=d,a+=p,a>=e.byteLength)break}return i.length>=1&&(r.timeOffset=i[0]),i.length>=2&&(r.deltaTime=i[1]-i[0]),r}function dSe(e){return Ae.create("Parse TRR",async t=>{try{t.update({canAbort:!0,message:"Parsing trajectory..."});let r=await uet(e);return nn.success(r)}catch(r){return nn.error(""+r)}})}function pSe(e){return Ae.create("Parse TRR",async t=>{await t.update("Converting to coordinates");let r=bs(e.deltaTime,"step"),n=bs(e.timeOffset,r.unit),o=[];for(let i=0,a=e.frames.length;i<a;++i){let s=e.boxes[i],l=b.fromArray(b(),s,0),u=b.fromArray(b(),s,3),c=b.fromArray(b(),s,6);o.push({elementCount:e.frames[i].count,cell:Rd.fromBasis(l,u,c),x:e.frames[i].x,y:e.frames[i].y,z:e.frames[i].z,xyzOrdering:{isIdentity:!0},time:bs(n.value+r.value*i,r.unit)})}return vd.create(o,r,n)})}var cet=1024*8,K8=[],wF=class{constructor(t,r={}){this._mark=0;this._marks=[];this.offset=0;this.littleEndian=!0;let n=!1;t===void 0&&(t=cet),typeof t=="number"?t=new ArrayBuffer(t):n=!0;let o=r.offset?r.offset>>>0:0,i=t.byteLength-o,a=o;!(t instanceof ArrayBuffer)&&!(t instanceof SharedArrayBuffer)&&(t.byteLength!==t.buffer.byteLength&&(a=t.byteOffset+o),t=t.buffer),n?this._lastWrittenByte=i:this._lastWrittenByte=0,this.buffer=t,this.length=i,this.byteLength=i,this.byteOffset=a,this._data=new DataView(this.buffer,a,i)}available(t=1){return this.offset+t<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(t){return t===void 0&&(t=1),this.offset+=t,this}seek(t){return this.offset=t,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){let t=this._marks.pop();if(t===void 0)throw new Error("Mark stack empty");return this.seek(t),this}rewind(){return this.offset=0,this}ensureAvailable(t){if(t===void 0&&(t=1),!this.available(t)){let n=(this.offset+t)*2,o=new Uint8Array(n);o.set(new Uint8Array(this.buffer)),this.buffer=o.buffer,this.length=this.byteLength=n,this._data=new DataView(this.buffer)}return this}readBoolean(){return this.readUint8()!==0}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(t){t===void 0&&(t=1);let r=new Uint8Array(t);for(let n=0;n<t;n++)r[n]=this.readByte();return r}readInt16(){let t=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,t}readUint16(){let t=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,t}readInt32(){let t=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,t}readUint32(){let t=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,t}readFloat32(){let t=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,t}readFloat64(){let t=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,t}readChar(){return String.fromCharCode(this.readInt8())}readChars(t=1){K8.length=t;for(let r=0;r<t;r++)K8[r]=this.readChar();return K8.join("")}writeBoolean(t=!1){return this.writeUint8(t?255:0),this}writeInt8(t){return this.ensureAvailable(1),this._data.setInt8(this.offset++,t),this._updateLastWrittenByte(),this}writeUint8(t){return this.ensureAvailable(1),this._data.setUint8(this.offset++,t),this._updateLastWrittenByte(),this}writeByte(t){return this.writeUint8(t)}writeBytes(t){this.ensureAvailable(t.length);for(let r=0;r<t.length;r++)this._data.setUint8(this.offset++,t[r]);return this._updateLastWrittenByte(),this}writeInt16(t){return this.ensureAvailable(2),this._data.setInt16(this.offset,t,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(t){return this.ensureAvailable(2),this._data.setUint16(this.offset,t,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(t){return this.ensureAvailable(4),this._data.setInt32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(t){return this.ensureAvailable(4),this._data.setUint32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(t){return this.ensureAvailable(4),this._data.setFloat32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(t){return this.ensureAvailable(8),this._data.setFloat64(this.offset,t,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(t){return this.writeUint8(t.charCodeAt(0))}writeChars(t){for(let r=0;r<t.length;r++)this.writeUint8(t.charCodeAt(r));return this}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this._lastWrittenByte)}_updateLastWrittenByte(){this.offset>this._lastWrittenByte&&(this._lastWrittenByte=this.offset)}};function Lp(e,t){if(e)throw new TypeError("Not a valid NetCDF v3.x file: "+t)}function fSe(e){e.offset%4!==0&&e.skip(4-e.offset%4)}function J8(e){let t=e.readUint32(),r=e.readChars(t);return fSe(e),r}var Oa={BYTE:1,CHAR:2,SHORT:3,INT:4,FLOAT:5,DOUBLE:6};function hSe(e){switch(Number(e)){case Oa.BYTE:return"byte";case Oa.CHAR:return"char";case Oa.SHORT:return"short";case Oa.INT:return"int";case Oa.FLOAT:return"float";case Oa.DOUBLE:return"double";default:return"undefined"}}function gSe(e){switch(Number(e)){case Oa.BYTE:return 1;case Oa.CHAR:return 1;case Oa.SHORT:return 2;case Oa.INT:return 4;case Oa.FLOAT:return 4;case Oa.DOUBLE:return 8;default:return-1}}function ySe(e){switch(String(e)){case"byte":return Oa.BYTE;case"char":return Oa.CHAR;case"short":return Oa.SHORT;case"int":return Oa.INT;case"float":return Oa.FLOAT;case"double":return Oa.DOUBLE;default:return-1}}function MF(e,t){if(e!==1){let r=new Array(e);for(let n=0;n<e;n++)r[n]=t();return r}else return t()}function $8(e,t,r){switch(t){case Oa.BYTE:return e.readBytes(r);case Oa.CHAR:return met(e.readChars(r));case Oa.SHORT:return MF(r,e.readInt16.bind(e));case Oa.INT:return MF(r,e.readInt32.bind(e));case Oa.FLOAT:return MF(r,e.readFloat32.bind(e));case Oa.DOUBLE:return MF(r,e.readFloat64.bind(e));default:Lp(!0,"non valid type "+t);return}}function met(e){return e.charCodeAt(e.length-1)===0?e.substring(0,e.length-1):e}function det(e,t){let r=ySe(t.type),n=t.size/gSe(r),o=new Array(n);for(let i=0;i<n;i++)o[i]=$8(e,r,1);return o}function pet(e,t,r){let n=ySe(t.type),o=t.size?t.size/gSe(n):1,i=r.length,a=new Array(i),s=r.recordStep;for(let l=0;l<i;l++){let u=e.offset;a[l]=$8(e,n,o),e.seek(u+s)}return a}var bA=0,fet=10,het=11,get=12;function yet(e,t){let r={recordDimension:{length:e.readUint32()}};r.version=t;let n=bet(e);r.recordDimension.id=n.recordId,r.recordDimension.name=n.recordName,r.dimensions=n.dimensions,r.globalAttributes=bSe(e);let o=xet(e,n.recordId,t);return r.variables=o.variables,r.recordDimension.recordStep=o.recordStep,r}function bet(e){let t,r,n,o=e.readUint32();if(o===bA)return Lp(e.readUint32()!==bA,"wrong empty tag for list of dimensions"),[];{Lp(o!==fet,"wrong tag for list of dimensions");let i=e.readUint32();t=new Array(i);for(let a=0;a<i;a++){let s=J8(e),l=e.readUint32();l===0&&(r=a,n=s),t[a]={name:s,size:l}}return{dimensions:t,recordId:r,recordName:n}}}function bSe(e){let t,r=e.readUint32();if(r===bA)return Lp(e.readUint32()!==bA,"wrong empty tag for list of attributes"),[];{Lp(r!==get,"wrong tag for list of attributes");let n=e.readUint32();t=new Array(n);for(let o=0;o<n;o++){let i=J8(e),a=e.readUint32();Lp(a<1||a>6,"non valid type "+a);let s=e.readUint32(),l=$8(e,a,s);fSe(e),t[o]={name:i,type:hSe(a),value:l}}}return t}function xet(e,t,r){let n=e.readUint32(),o=0,i;if(n===bA)return Lp(e.readUint32()!==bA,"wrong empty tag for list of variables"),[];{Lp(n!==het,"wrong tag for list of variables");let a=e.readUint32();i=new Array(a);for(let s=0;s<a;s++){let l=J8(e),u=e.readUint32(),c=new Array(u);for(let f=0;f<u;f++)c[f]=e.readUint32();let m=bSe(e),d=e.readUint32();Lp(d<1&&d>6,"non valid type "+d);let p=e.readUint32(),h=e.readUint32();r===2&&(Lp(h>0,"offsets larger than 4GB not supported"),h=e.readUint32()),c[0]===t&&(o+=p),i[s]={name:l,dimensions:c,attributes:m,type:hSe(d),size:p,offset:h,record:c[0]===t}}}return{variables:i,recordStep:o}}var BF=class{constructor(t){let r=new wF(t);r.setBigEndian(),Lp(r.readChars(3)!=="CDF","should start with CDF");let n=r.readByte();Lp(n>2,"unknown version"),this.header=yet(r,n),this.buffer=r}get version(){return this.header.version===1?"classic format":"64-bit offset format"}get recordDimension(){return this.header.recordDimension}get dimensions(){return this.header.dimensions}get globalAttributes(){return this.header.globalAttributes}get variables(){return this.header.variables}hasDataVariable(t){return this.header.variables&&this.header.variables.findIndex(r=>r.name===t)!==-1}getDataVariable(t){let r;if(typeof t=="string"?r=this.header.variables?.find(n=>n.name===t):r=t,r===void 0)throw new Error("variable not found");return this.buffer.seek(r.offset),r.record?pet(this.buffer,r,this.header.recordDimension):det(this.buffer,r)}};async function Cet(e){let t=new BF(e.buffer),r={coordinates:[],time:[],timeOffset:0,deltaTime:1};for(let n of t.getDataVariable("coordinates"))r.coordinates.push(n);if(t.hasDataVariable("velocities")){let n=[];for(let o of t.getDataVariable("velocities"))n.push(o);r.velocities=n}if(t.hasDataVariable("forces")){let n=[];for(let o of t.getDataVariable("forces"))n.push(o);r.forces=n}if(t.hasDataVariable("cell_lengths")){let n=[];for(let o of t.getDataVariable("cell_lengths"))n.push(o);r.cell_lengths=n}if(t.hasDataVariable("cell_angles")){let n=[];for(let o of t.getDataVariable("cell_angles"))n.push(o);r.cell_angles=n}if(t.hasDataVariable("time")){let n=[];for(let o of t.getDataVariable("time"))n.push(o);r.time=n}return r.time&&(r.time.length>=1&&(r.timeOffset=r.time[0]),r.time.length>=2&&(r.deltaTime=r.time[1]-r.time[0])),r}function xSe(e){return Ae.create("Parse NCTRAJ",async t=>{try{t.update({canAbort:!0,message:"Parsing trajectory..."});let r=await Cet(e);return nn.success(r)}catch(r){return nn.error(""+r)}})}function CSe(e){return Ae.create("Parse NCTRAJ",async t=>{await t.update("Converting to coordinates");let r=bs(e.deltaTime,"step"),n=bs(e.timeOffset,r.unit),o=[];for(let i=0,a=e.coordinates.length;i<a;++i){let s=e.coordinates[i],l=s.length/3,u=new Float32Array(l),c=new Float32Array(l),m=new Float32Array(l);for(let p=0,h=s.length;p<h;p+=3)u[p/3]=s[p],c[p/3]=s[p+1],m[p/3]=s[p+2];let d={elementCount:l,x:u,y:c,z:m,xyzOrdering:{isIdentity:!0},time:bs(n.value+r.value*i,r.unit)};if(e.cell_lengths){let p=e.cell_lengths[i],h=b.scale(b(),b.unitX,p[0]),f=b.scale(b(),b.unitY,p[1]),g=b.scale(b(),b.unitZ,p[2]);d.cell=Rd.fromBasis(h,f,g)}o.push(d)}return vd.create(o,r,n)})}function vet(e){let{pointers:t,residuePointer:r,residueLabel:n,atomName:o}=e,i=t.NATOM,a=t.NRES,s=new Uint32Array(i),l=[],u=(D,B,k)=>{let F=n.value(D);for(let z=B,j=k;z<j;++z)s[z]=D+1,l[z]=F};for(let D=0,B=a-1;D<B;++D)u(D,r.value(D)-1,r.value(D+1)-1);u(a-1,r.value(a-1)-1,i);let c=W.ofIntArray(s),m=W.ofStringArray(l),d=new Array(i),p=new Array(i),h=new Uint32Array(i),f=new Uint32Array(i),g=new Ui,y=new Ni(c,o),x="",S=0,I="",v=0,A=0,P=-1;for(let D=0,B=i;D<B;++D){let k=c.value(D);if(k!==P){let F=m.value(D),z=Ql(y.add(F,D).type,F);z!==A&&(I=eh(S),S+=1,v=0),x=g.getEntityId(F,z,I),v+=1,P=k,A=z}d[D]=x,p[D]=I,h[D]=v,f[D]=D}let T=W.ofIntArray(f),R=W.ofStringArray(p),w=new Array(i);for(let D=0;D<i;++D)w[D]=Bp(o.value(D),m.value(D));let E=wr.ofPartialColumns(Lo.atom_site,{auth_asym_id:R,auth_atom_id:W.asArrayColumn(o),auth_comp_id:m,auth_seq_id:c,id:W.asArrayColumn(T),label_asym_id:R,label_atom_id:W.asArrayColumn(o),label_comp_id:m,label_seq_id:W.ofIntArray(h),label_entity_id:W.ofStringArray(d),occupancy:W.ofConst(1,i,W.Schema.float),type_symbol:W.ofStringArray(w),pdbx_PDB_model_num:W.ofConst(1,i,W.Schema.int)},i);return ra({entity:g.getEntityTable(),chem_comp:y.getChemCompTable(),atom_site:E})}var SSe;(r=>{function e(n){return n?.kind==="prmtop"}r.is=e;function t(n){return{kind:"prmtop",name:n.title.join(" ")||"PRMTOP",data:n}}r.fromPrmtop=t})(SSe||={});function vSe(e){return Ae.create("Parse PRMTOP",async t=>{let r=SSe.fromPrmtop(e),n=vet(e),{pointers:{NBONH:o,NBONA:i},bondsIncHydrogen:a,bondsWithoutHydrogen:s}=e,l=o+i,u={indexA:W.ofLambda({value:c=>c<o?a.value(c*3)/3:s.value((c-o)*3)/3,rowCount:l,schema:W.Schema.int}),indexB:W.ofLambda({value:c=>c<o?a.value(c*3+1)/3:s.value((c-o)*3+1)/3,rowCount:l,schema:W.Schema.int}),order:W.ofConst(1,l,W.Schema.int)};return RS.create(e.title.join(" ")||"PRMTOP",n,u,r)})}function Iet(e){let{molecules:t,compounds:r}=e,n={},o=0;for(let D=0,B=t._rowCount;D<B;++D){let k=t.compound.value(D),F=t.molCount.value(D),{atoms:z}=r[k];W.asArrayColumn(z.atom),W.asArrayColumn(z.resnr),W.asArrayColumn(z.residu),o+=F*z._rowCount;let j=z.resnr.value(0);n[k]=!0;for(let Y=1,G=z._rowCount;Y<G;++Y){let X=z.resnr.value(Y);if(X!==j){n[k]=!1;break}j=X}}let i=new Array(o),a=new Uint32Array(o),s=new Array(o),l=0;for(let D=0,B=t._rowCount;D<B;++D){let k=t.compound.value(D),F=t.molCount.value(D),{atoms:z}=r[k],j=n[k];for(let Y=0;Y<F;++Y)for(let G=0,X=z._rowCount;G<X;++G)i[l]=z.atom.value(G),a[l]=z.resnr.value(G),s[l]=z.residu.value(G),j&&(a[l]+=Y),l+=1}let u=W.ofStringArray(i),c=W.ofIntArray(a),m=W.ofStringArray(s),d=new Array(o),p=new Array(o),h=new Uint32Array(o),f=new Uint32Array(o),g=new Ui,y=new Ni(c,u),x="",S=0,I="",v=0,A=0,P=-1;for(let D=0,B=o;D<B;++D){let k=c.value(D);if(k!==P){let F=m.value(D),z=Ql(y.add(F,D).type,F);z!==A&&(I=eh(S),S+=1,v=0),x=g.getEntityId(F,z,I),v+=1,P=k,A=z}d[D]=x,p[D]=I,h[D]=v,f[D]=D}let T=W.ofIntArray(f),R=W.ofStringArray(p),w=new Array(o);for(let D=0;D<o;++D)w[D]=Bp(u.value(D),m.value(D));let E=wr.ofPartialColumns(Lo.atom_site,{auth_asym_id:R,auth_atom_id:W.asArrayColumn(u),auth_comp_id:m,auth_seq_id:c,id:W.asArrayColumn(T),label_asym_id:R,label_atom_id:W.asArrayColumn(u),label_comp_id:m,label_seq_id:W.ofIntArray(h),label_entity_id:W.ofStringArray(d),occupancy:W.ofConst(1,o,W.Schema.float),type_symbol:W.ofStringArray(w),pdbx_PDB_model_num:W.ofConst(1,o,W.Schema.int)},o);return ra({entity:g.getEntityTable(),chem_comp:y.getChemCompTable(),atom_site:E})}function Aet(e){let{molecules:t,compounds:r}=e,n=[],o=[],i=0;for(let a=0,s=t._rowCount;a<s;++a){let l=t.compound.value(a),u=t.molCount.value(a),{atoms:c,bonds:m}=r[l];if(m)for(let d=0;d<u;++d){for(let p=0,h=m._rowCount;p<h;++p)n.push(m.ai.value(p)-1+i),o.push(m.aj.value(p)-1+i);i+=c._rowCount}else if(l==="TIP3")for(let d=0;d<u;++d)n.push(0+i),o.push(1+i),n.push(0+i),o.push(2+i),i+=c._rowCount;else i+=u*c._rowCount}return{indexA:W.ofIntArray(n),indexB:W.ofIntArray(o),order:W.ofConst(1,n.length,W.Schema.int)}}var ISe;(r=>{function e(n){return n?.kind==="top"}r.is=e;function t(n){return{kind:"top",name:n.system||"TOP",data:n}}r.fromTop=t})(ISe||={});function ASe(e){return Ae.create("Parse TOP",async t=>{let r=ISe.fromTop(e),n=Iet(e),o=Aet(e);return RS.create(e.system||"TOP",n,o,r)})}function eW(e){let t=e[0].loci,r=e[1].loci;return{pairs:[{loci:[t,r]}]}}function tW(e){let t=e[0].loci,r=e[1].loci,n=e[2].loci;return{triples:[{loci:[t,r,n]}]}}function rW(e){let t=e[0].loci,r=e[1].loci,n=e[2].loci,o=e[3].loci;return{quads:[{loci:[t,r,n,o]}]}}function nW(e){return{infos:[{loci:e[0].loci}]}}function oW(e){return{locis:e.map(t=>t.loci)}}function iW(e){return{locis:e.map(t=>t.loci)}}var Xm={center:b(),rotation:H(),translationToCenter:H(),translationFromCenter:H(),translation:H(),local:H()};function xA(e){return e.name==="components"&&e.params.rotationCenter?.name==="centroid"}function CA(e,t){if(e.name==="matrix"){let r=H();return H.copy(r,e.params.data),e.params.transpose&&H.transpose(r,r),r}else{e.params.rotationCenter?.name==="centroid"?b.copy(Xm.center,t):e.params.rotationCenter?.name==="point"?b.copy(Xm.center,e.params.rotationCenter.params.point):b.set(Xm.center,0,0,0),H.fromTranslation(Xm.translationToCenter,Xm.center),H.fromRotation(Xm.rotation,e.params.angle*Math.PI/180,e.params.axis),H.fromTranslation(Xm.translationFromCenter,b.negate(Xm.center,Xm.center));let r=H.mul3(H(),Xm.translationToCenter,Xm.rotation,Xm.translationFromCenter);return H.fromTranslation(Xm.translation,e.params.translation),H.mul(r,Xm.translation,r),r}}var SA=C.MappedStatic("matrix",{matrix:C.Group({data:C.Mat4(H.identity()),transpose:C.Boolean(!1)},{isFlat:!0}),components:C.Group({translation:C.Vec3(b.create(0,0,0)),axis:C.Vec3(b.create(1,0,0)),angle:C.Numeric(0,{min:-360,max:360,step:1},{description:"Angle in Degrees"}),rotationCenter:C.MappedStatic("point",{point:C.Group({point:C.Vec3(b.create(0,0,0))},{isFlat:!0}),centroid:C.Group({})})},{isFlat:!0})},{label:"Kind"});var aW=Vt.BuiltIn({name:"coordinates-from-dcd",display:{name:"Parse DCD",description:"Parse DCD binary data."},from:[ne.Data.Binary],to:ne.Molecule.Coordinates})({apply({a:e}){return Ae.create("Parse DCD",async t=>{let r=await rCe(e.data).runInContext(t);if(r.isError)throw new Error(r.message);let n=await FCe(r.result).runInContext(t);return new ne.Molecule.Coordinates(n,{label:e.label,description:"Coordinates"})})}}),sW=Vt.BuiltIn({name:"coordinates-from-xtc",display:{name:"Parse XTC",description:"Parse XTC binary data."},from:[ne.Data.Binary],to:ne.Molecule.Coordinates})({apply({a:e}){return Ae.create("Parse XTC",async t=>{let r=await j0e(e.data).runInContext(t);if(r.isError)throw new Error(r.message);let n=await W0e(r.result).runInContext(t);return new ne.Molecule.Coordinates(n,{label:e.label,description:"Coordinates"})})}}),lW=Vt.BuiltIn({name:"coordinates-from-trr",display:{name:"Parse TRR",description:"Parse TRR binary data."},from:[ne.Data.Binary],to:ne.Molecule.Coordinates})({apply({a:e}){return Ae.create("Parse TRR",async t=>{let r=await dSe(e.data).runInContext(t);if(r.isError)throw new Error(r.message);let n=await pSe(r.result).runInContext(t);return new ne.Molecule.Coordinates(n,{label:e.label,description:"Coordinates"})})}}),uW=Vt.BuiltIn({name:"coordinates-from-nctraj",display:{name:"Parse NCTRAJ",description:"Parse NCTRAJ binary data."},from:[ne.Data.Binary],to:ne.Molecule.Coordinates})({apply({a:e}){return Ae.create("Parse NCTRAJ",async t=>{let r=await xSe(e.data).runInContext(t);if(r.isError)throw new Error(r.message);let n=await CSe(r.result).runInContext(t);return new ne.Molecule.Coordinates(n,{label:e.label,description:"Coordinates"})})}}),cW=Vt.BuiltIn({name:"coordinates-from-lammpstraj",display:{name:"Parse LAMMPSTRAJ",description:"Parse LAMMPSTRAJ data."},from:[ne.Data.String],to:ne.Molecule.Coordinates})({apply({a:e}){return Ae.create("Parse LAMMPSTRAJ",async t=>{let r=await Z8(e.data).runInContext(t);if(r.isError)throw new Error(r.message);let n=await q8(r.result).runInContext(t);return new ne.Molecule.Coordinates(n,{label:e.label,description:"Coordinates"})})}}),mW=Vt.BuiltIn({name:"topology-from-psf",display:{name:"PSF Topology",description:"Create topology from PSF."},from:[ne.Format.Psf],to:ne.Molecule.Topology})({apply({a:e}){return Ae.create("Create Topology",async t=>{let r=await n0e(e.data).runInContext(t);return new ne.Molecule.Topology(r,{label:r.label||e.label,description:"Topology"})})}}),dW=Vt.BuiltIn({name:"topology-from-prmtop",display:{name:"PRMTOP Topology",description:"Create topology from PRMTOP."},from:[ne.Format.Prmtop],to:ne.Molecule.Topology})({apply({a:e}){return Ae.create("Create Topology",async t=>{let r=await vSe(e.data).runInContext(t);return new ne.Molecule.Topology(r,{label:r.label||e.label,description:"Topology"})})}}),pW=Vt.BuiltIn({name:"topology-from-top",display:{name:"TOP Topology",description:"Create topology from TOP."},from:[ne.Format.Top],to:ne.Molecule.Topology})({apply({a:e}){return Ae.create("Create Topology",async t=>{let r=await ASe(e.data).runInContext(t);return new ne.Molecule.Topology(r,{label:r.label||e.label,description:"Topology"})})}});async function EF(e,t,r){if(t.type===ne.Molecule.Topology.type){let n=t.data;return await Gt.trajectoryFromTopologyAndCoordinates(n,r).runInContext(e)}else if(t.type===ne.Molecule.Model.type){let n=t.data;return Gt.trajectoryFromModelAndCoordinates(n,r)}throw new Error("no model/topology found")}var kF=Vt.BuiltIn({name:"trajectory-from-model-and-coordinates",display:{name:"Trajectory from Topology & Coordinates",description:"Create a trajectory from existing model/topology and coordinates."},from:ne.Root,to:ne.Molecule.Trajectory,params:{modelRef:C.Text("",{isHidden:!0}),coordinatesRef:C.Text("",{isHidden:!0})}})({apply({params:e,dependencies:t}){return Ae.create("Create trajectory from model/topology and coordinates",async r=>{let n=t[e.coordinatesRef].data,o=await EF(r,t[e.modelRef],n),i={label:"Trajectory",description:`${o.frameCount} model${o.frameCount===1?"":"s"}`};return new ne.Molecule.Trajectory(o,i)})}}),Tet=Vt.BuiltIn({name:"trajectory-from-blob",display:{name:"Parse Blob",description:"Parse format blob into a single trajectory."},from:ne.Format.Blob,to:ne.Molecule.Trajectory})({apply({a:e}){return Ae.create("Parse Format Blob",async t=>{let r=[];for(let o of e.data){if(o.kind!=="cif")continue;let i=o.data.blocks[0],a=await tk(i).runInContext(t);if(a.frameCount===0)throw new Error("No models found.");for(let s=0;s<a.frameCount;s++){let l=await Ae.resolveInContext(a.getFrameAtIndex(s),t);r.push(l)}}for(let o=0;o<r.length;o++)Gt.TrajectoryInfo.set(r[o],{index:o,size:r.length});let n={label:"Trajectory",description:`${r.length} model${r.length===1?"":"s"}`};return new ne.Molecule.Trajectory(new Rl(r),n)})}});function th(e){return{label:`${e.representative.entry}`,description:`${e.frameCount} model${e.frameCount===1?"":"s"}`}}var fW=Vt.BuiltIn({name:"trajectory-from-mmcif",display:{name:"Trajectory from mmCIF",description:"Identify and create all separate models in the specified CIF data block"},from:ne.Format.Cif,to:ne.Molecule.Trajectory,params(e){if(!e)return{loadAllBlocks:C.Optional(C.Boolean(!1,{description:"If True, ignore Block Header and Block Index parameters and parse all datablocks into a single trajectory."})),blockHeader:C.Optional(C.Text(void 0,{description:"Header of the block to parse. If not specifed, Block Index parameter applies.",hideIf:n=>n.loadAllBlocks===!0})),blockIndex:C.Optional(C.Numeric(0,{min:0,step:1},{description:"Zero-based index of the block to parse. Only applies when Block Header parameter is not specified.",hideIf:n=>n.loadAllBlocks===!0||n.blockHeader}))};let{blocks:t}=e.data,r=t.map(n=>[n.header,n.header]);return r.push(["","[Use Block Index]"]),{loadAllBlocks:C.Optional(C.Boolean(!1,{description:"If True, ignore Block Header and Block Index parameters and parse all data blocks into a single trajectory."})),blockHeader:C.Optional(C.Select(t[0]&&t[0].header,r,{description:"Header of the block to parse. If not specifed, Block Index parameter applies.",hideIf:n=>n.loadAllBlocks===!0})),blockIndex:C.Optional(C.Numeric(0,{min:0,step:1,max:t.length-1},{description:"Zero-based index of the block to parse. Only applies when Block Header parameter is not specified.",hideIf:n=>n.loadAllBlocks===!0||n.blockHeader}))}}})({isApplicable:e=>e.data.blocks.length>0,apply({a:e,params:t}){return Ae.create("Parse mmCIF",async r=>{let n;if(t.loadAllBlocks){let i=[];for(let a of e.data.blocks){r.shouldUpdate&&await r.update(`Parsing ${a.header}...`);let s=await tk(a).runInContext(r);for(let l=0;l<s.frameCount;l++)i.push(await Ae.resolveInContext(s.getFrameAtIndex(l),r))}n=new Rl(i)}else{let i=t.blockHeader||e.data.blocks[t.blockIndex??0].header,a=e.data.blocks.find(l=>l.header===i);if(!a)throw new Error(`Data block '${[i]}' not found.`);n=a.categoryNames.includes("chem_comp_atom")&&!a.categoryNames.includes("atom_site")&&!a.categoryNames.includes("ihm_sphere_obj_site")&&!a.categoryNames.includes("ihm_gaussian_obj_site")?await lpe(a).runInContext(r):await tk(a,e.data).runInContext(r)}if(n.frameCount===0)throw new Error("No models found.");let o=th(n);return new ne.Molecule.Trajectory(n,o)})}}),hW=Vt.BuiltIn({name:"trajectory-from-pdb",display:{name:"Parse PDB",description:"Parse PDB string and create trajectory."},from:[ne.Data.String],to:ne.Molecule.Trajectory,params:{isPdbqt:C.Boolean(!1)}})({apply({a:e,params:t}){return Ae.create("Parse PDB",async r=>{let n=await iCe(e.data,e.label,t.isPdbqt).runInContext(r);if(n.isError)throw new Error(n.message);let o=await t0e(n.result).runInContext(r),i=th(o);return new ne.Molecule.Trajectory(o,i)})}}),gW=Vt.BuiltIn({name:"trajectory-from-gro",display:{name:"Parse GRO",description:"Parse GRO string and create trajectory."},from:[ne.Data.String],to:ne.Molecule.Trajectory})({apply({a:e}){return Ae.create("Parse GRO",async t=>{let r=await oCe(e.data).runInContext(t);if(r.isError)throw new Error(r.message);let n=await VCe(r.result).runInContext(t),o=th(n);return new ne.Molecule.Trajectory(n,o)})}}),yW=Vt.BuiltIn({name:"trajectory-from-xyz",display:{name:"Parse XYZ",description:"Parse XYZ string and create trajectory."},from:[ne.Data.String],to:ne.Molecule.Trajectory})({apply({a:e}){return Ae.create("Parse XYZ",async t=>{let r=await X0e(e.data).runInContext(t);if(r.isError)throw new Error(r.message);let n=await Z0e(r.result).runInContext(t),o=th(n);return new ne.Molecule.Trajectory(n,o)})}}),Pet=Vt.BuiltIn({name:"trajectory-from-lammps-data",display:{name:"Parse Lammps Data",description:"Parse Lammps Data from string and create trajectory."},from:[ne.Data.String],to:ne.Molecule.Trajectory,params:{unitsStyle:C.Select("real",C.arrayToOptions(X8))}})({apply({a:e,params:t}){return Ae.create("Parse Lammps Data",async r=>{let n=await $0e(e.data).runInContext(r);if(n.isError)throw new Error(n.message);let o=await tSe(n.result,t.unitsStyle).runInContext(r),i=th(o);return new ne.Molecule.Trajectory(o,i)})}}),bW=Vt.BuiltIn({name:"trajectory-from-lammps-traj-data",display:{name:"Parse Lammps traj Data",description:"Parse Lammps Traj Data string and create trajectory."},from:[ne.Data.String],to:ne.Molecule.Trajectory,params:{unitsStyle:C.Select("real",C.arrayToOptions(X8))}})({apply({a:e,params:t}){return Ae.create("Parse Lammps Data",async r=>{let n=await Z8(e.data).runInContext(r);if(n.isError)throw new Error(n.message);let o=await oSe(n.result,t.unitsStyle).runInContext(r),i=th(o);return new ne.Molecule.Trajectory(o,i)})}}),xW=Vt.BuiltIn({name:"trajectory-from-mol",display:{name:"Parse MOL",description:"Parse MOL string and create trajectory."},from:[ne.Data.String],to:ne.Molecule.Trajectory})({apply({a:e}){return Ae.create("Parse MOL",async t=>{let r=await E0e(e.data).runInContext(t);if(r.isError)throw new Error(r.message);let n=await F0e(r.result).runInContext(t),o=th(n);return new ne.Molecule.Trajectory(n,o)})}}),CW=Vt.BuiltIn({name:"trajectory-from-sdf",display:{name:"Parse SDF",description:"Parse SDF string and create trajectory."},from:[ne.Data.String],to:ne.Molecule.Trajectory})({apply({a:e}){return Ae.create("Parse SDF",async t=>{let r=await uSe(e.data).runInContext(t);if(r.isError)throw new Error(r.message);let n=[];for(let a of r.result.compounds){let s=await mSe(a).runInContext(t);for(let l=0;l<s.frameCount;l++)n.push(await Ae.resolveInContext(s.getFrameAtIndex(l),t))}let o=new Rl(n),i=th(o);return new ne.Molecule.Trajectory(o,i)})}}),SW=Vt.BuiltIn({name:"trajectory-from-mol2",display:{name:"Parse MOL2",description:"Parse MOL2 string and create trajectory."},from:[ne.Data.String],to:ne.Molecule.Trajectory})({apply({a:e}){return Ae.create("Parse MOL2",async t=>{let r=await N0e(e.data,e.label).runInContext(t);if(r.isError)throw new Error(r.message);let n=await H0e(r.result).runInContext(t),o=th(n);return new ne.Molecule.Trajectory(n,o)})}}),_et=Vt.BuiltIn({name:"trajectory-from-cube",display:{name:"Parse Cube",description:"Parse Cube file to create a trajectory."},from:ne.Format.Cube,to:ne.Molecule.Trajectory})({apply({a:e}){return Ae.create("Parse MOL",async t=>{let r=await O0e(e.data).runInContext(t),n=th(r);return new ne.Molecule.Trajectory(r,n)})}}),Ret=Vt.BuiltIn({name:"trajectory-from-cif-core",display:{name:"Parse CIF Core",description:"Identify and create all separate models in the specified CIF data block"},from:ne.Format.Cif,to:ne.Molecule.Trajectory,params(e){if(!e)return{blockHeader:C.Optional(C.Text(void 0,{description:"Header of the block to parse. If none is specifed, the 1st data block in the file is used."}))};let{blocks:t}=e.data;return{blockHeader:C.Optional(C.Select(t[0]&&t[0].header,t.map(r=>[r.header,r.header]),{description:"Header of the block to parse"}))}}})({apply({a:e,params:t}){return Ae.create("Parse CIF Core",async r=>{let n=t.blockHeader||e.data.blocks[0].header,o=e.data.blocks.find(s=>s.header===n);if(!o)throw new Error(`Data block '${[n]}' not found.`);let i=await L0e(o).runInContext(r);if(i.frameCount===0)throw new Error("No models found.");let a=th(i);return new ne.Molecule.Trajectory(i,a)})}}),Det=e=>e+1,wet=e=>e-1,_R=Vt.BuiltIn({name:"model-from-trajectory",display:{name:"Molecular Model",description:"Create a molecular model from specified index in a trajectory."},from:ne.Molecule.Trajectory,to:ne.Molecule.Model,params:e=>e?{modelIndex:C.Converted(Det,wet,C.Numeric(1,{min:1,max:e.data.frameCount,step:1},{description:"Model Index",immediateUpdate:!0}))}:{modelIndex:C.Numeric(0,{},{description:"Zero-based index of the model",immediateUpdate:!0})}})({isApplicable:e=>e.data.frameCount>0,apply({a:e,params:t}){return Ae.create("Model from Trajectory",async r=>{let n=Math.round(t.modelIndex)%e.data.frameCount;n<0&&(n+=e.data.frameCount);let o=await Ae.resolveInContext(e.data.getFrameAtIndex(n),r),i=`Model ${n+1}`,a=e.data.frameCount===1?void 0:`of ${e.data.frameCount}`;return new ne.Molecule.Model(o,{label:i,description:a})})},interpolate(e,t,r){return{modelIndex:r>=1?t.modelIndex:e.modelIndex+Math.floor((t.modelIndex-e.modelIndex+1)*r)}},dispose({b:e}){e?.data.customProperties.dispose()}}),Met=Vt.BuiltIn({name:"structure-from-trajectory",display:{name:"Structure from Trajectory",description:"Create a molecular structure from a trajectory."},from:ne.Molecule.Trajectory,to:ne.Molecule.Structure})({apply({a:e}){return Ae.create("Build Structure",async t=>{let r=await De.ofTrajectory(e.data,t),n={label:"Ensemble",description:De.elementDescription(r)};return new ne.Molecule.Structure(r,n)})},dispose({b:e}){e?.data.customPropertyDescriptors.dispose()}}),vW=Vt.BuiltIn({name:"structure-from-model",display:{name:"Structure",description:"Create a molecular structure (model, assembly, or symmetry) from the specified model."},from:ne.Molecule.Model,to:ne.Molecule.Structure,params(e){return hb.getParams(e&&e.data)}})({canAutoUpdate({oldParams:e,newParams:t}){return hb.canAutoUpdate(e.type,t.type)},apply({a:e,params:t},r){return Ae.create("Build Structure",async n=>hb.create(r,n,e.data,t&&t.type))},update:({a:e,b:t,oldParams:r,newParams:n})=>qi(r,n)?t.data.model===e.data?et.UpdateResult.Unchanged:Gt.areHierarchiesEqual(e.data,t.data.model)?(t.data=t.data.remapModel(e.data),et.UpdateResult.Updated):et.UpdateResult.Recreate:et.UpdateResult.Recreate,dispose({b:e}){e?.data.customPropertyDescriptors.dispose()}}),IW=Vt.BuiltIn({name:"transform-structure-conformation",display:{name:"Transform Conformation"},isDecorator:!0,from:ne.Molecule.Structure,to:ne.Molecule.Structure,params:{transform:SA}})({canAutoUpdate({newParams:e}){return e.transform.name!=="matrix"},apply({a:e,params:t}){let r=xA(t.transform)?e.data.boundary.sphere.center:b.unit,n=CA(t.transform,r),o=De.transform(e.data,n);return new ne.Molecule.Structure(o,{label:e.label,description:`${e.description} [Transformed]`})},dispose({b:e}){e?.data.customPropertyDescriptors.dispose()}}),AW=Vt.BuiltIn({name:"structure-instances",display:{name:"Structure Instances"},isDecorator:!0,from:ne.Molecule.Structure,to:ne.Molecule.Structure,params:{transforms:C.ObjectList({transform:SA},()=>"Transform")}})({canAutoUpdate(){return!0},apply({a:e,params:t}){let r=t.transforms.some(i=>xA(i.transform))?e.data.boundary.sphere.center:b.unit,n=t.transforms.map(i=>CA(i.transform,r));if(!n.length)return e;let o=De.instances(e.data,n);return new ne.Molecule.Structure(o,{label:e.label,description:`${e.description} [Instanced]`})},dispose({b:e}){e?.data.customPropertyDescriptors.dispose()}}),Bet=Vt.BuiltIn({name:"model-with-coordinates",display:{name:"Model With Coordinates",description:"Updates the current model with provided coordinate frame"},from:ne.Molecule.Model,to:ne.Molecule.Model,params:{frameIndex:C.Optional(C.Numeric(0,void 0,{isHidden:!0})),frameCount:C.Optional(C.Numeric(1,void 0,{isHidden:!0})),atomicCoordinateFrame:C.Optional(C.Value(void 0,{isHidden:!0}))},isDecorator:!0})({apply({a:e,params:t}){if(!t.atomicCoordinateFrame)return e;let r={...e.data,atomicConformation:Gt.getAtomicConformationFromFrame(e.data,t.atomicCoordinateFrame)};return Gt.TrajectoryInfo.set(r,{index:t.frameIndex??0,size:t.frameCount??1}),new ne.Molecule.Model(r,{label:e.label,description:e.description})},update:({a:e,b:t,oldParams:r,newParams:n})=>r.atomicCoordinateFrame===n.atomicCoordinateFrame?et.UpdateResult.Unchanged:(n.atomicCoordinateFrame?t.data={...t.data,atomicConformation:Gt.getAtomicConformationFromFrame(t.data,n.atomicCoordinateFrame)}:t.data=e.data,Gt.TrajectoryInfo.set(t.data,{index:n.frameIndex??0,size:n.frameCount??1}),et.UpdateResult.Updated)}),Eet=Vt.BuiltIn({name:"structure-selection-from-expression",display:{name:"Selection",description:"Create a molecular structure from the specified expression."},from:ne.Molecule.Structure,to:ne.Molecule.Structure,params:()=>({expression:C.Value(ie.struct.generator.all,{isHidden:!0}),label:C.Optional(C.Text("",{isHidden:!0}))})})({apply({a:e,params:t,cache:r}){let{selection:n,entry:o}=js.createAndRun(e.data,t.expression);if(r.entry=o,ut.isEmpty(n))return Gn.Null;let i=ut.unionStructure(n),a={label:`${t.label||"Selection"}`,description:De.elementDescription(i)};return new ne.Molecule.Structure(i,a)},update:({a:e,b:t,oldParams:r,newParams:n,cache:o})=>{if(r.expression!==n.expression)return et.UpdateResult.Recreate;let i=o.entry;if(i.currentStructure===e.data)return et.UpdateResult.Unchanged;let a=js.updateStructure(i,e.data);return ut.isEmpty(a)?et.UpdateResult.Null:(js.updateStructureObject(t,a,n.label),et.UpdateResult.Updated)},dispose({b:e}){e?.data.customPropertyDescriptors.dispose()}}),ket=Vt.BuiltIn({name:"structure-multi-selection-from-expression",display:{name:"Multi-structure Measurement Selection",description:"Create selection object from multiple structures."},from:ne.Root,to:ne.Molecule.Structure.Selections,params:()=>({selections:C.ObjectList({key:C.Text(void 0,{description:"A unique key."}),ref:C.Text(),groupId:C.Optional(C.Text()),expression:C.Value(ie.struct.generator.empty)},e=>e.ref,{isHidden:!0}),isTransitive:C.Optional(C.Boolean(!1,{isHidden:!0,description:"Remap the selections from the original structure if structurally equivalent."})),label:C.Optional(C.Text("",{isHidden:!0}))})})({apply({params:e,cache:t,dependencies:r}){let n=new Map,o=[],i=0;for(let s of e.selections){let{selection:l,entry:u}=js.createAndRun(r[s.ref].data,s.expression);n.set(s.key,u);let c=ut.toLociWithSourceUnits(l);o.push({key:s.key,structureRef:s.ref,loci:c,groupId:s.groupId}),i+=Q.Loci.size(c)}t.entries=n;let a={label:`${e.label||"Multi-selection"}`,description:`${e.selections.length} source(s), ${i} element(s) total`};return new ne.Molecule.Structure.Selections(o,a)},update:({b:e,oldParams:t,newParams:r,cache:n,dependencies:o})=>{if(!!t.isTransitive!=!!r.isTransitive)return et.UpdateResult.Recreate;let i=n.entries,a=new Map,s=new Map;for(let m of e.data)s.set(m.key,m);let l=!1,u=0,c=[];for(let m of r.selections){let d=o[m.ref].data,p=!1;if(i.has(m.key)){let h=i.get(m.key);if(js.isUnchanged(h,m.expression,d)&&s.has(m.key)){let f=s.get(m.key);f.groupId!==m.groupId&&(f.groupId=m.groupId,l=!0),a.set(m.key,h),c.push(f),u+=Q.Loci.size(f.loci);continue}if(h.expression!==m.expression)p=!0;else{let f=!1;if(r.isTransitive)if(De.areUnitIdsAndIndicesEqual(h.originalStructure,d)){let g=js.run(h,h.originalStructure);h.currentStructure=d,a.set(m.key,h);let y=Q.Loci.remap(ut.toLociWithSourceUnits(g),d);c.push({key:m.key,structureRef:m.ref,loci:y,groupId:m.groupId}),u+=Q.Loci.size(y),l=!0}else f=!0;else f=!0;if(f){l=!0;let g=js.updateStructure(h,d);a.set(m.key,h);let y=ut.toLociWithSourceUnits(g);c.push({key:m.key,structureRef:m.ref,loci:y,groupId:m.groupId}),u+=Q.Loci.size(y)}}}else p=!0;if(p){l=!0;let{selection:h,entry:f}=js.createAndRun(d,m.expression);a.set(m.key,f);let g=ut.toLociWithSourceUnits(h);c.push({key:m.key,structureRef:m.ref,loci:g,groupId:m.groupId}),u+=Q.Loci.size(g)}}return l?(n.entries=a,e.data=c,e.label=`${r.label||"Multi-selection"}`,e.description=`${c.length} source(s), ${u} element(s) total`,et.UpdateResult.Updated):et.UpdateResult.Unchanged}}),Fet=Vt.BuiltIn({name:"structure-multi-selection-from-bundle",display:{name:"Multi-structure Measurement Selection",description:"Create selection object from multiple structures."},from:ne.Root,to:ne.Molecule.Structure.Selections,params:()=>({selections:C.ObjectList({key:C.Text(void 0,{description:"A unique key."}),ref:C.Text(),groupId:C.Optional(C.Text()),bundle:C.Value(Q.Bundle.Empty)},e=>e.ref,{isHidden:!0}),isTransitive:C.Optional(C.Boolean(!1,{isHidden:!0,description:"Remap the selections from the original structure if structurally equivalent."})),label:C.Optional(C.Text("",{isHidden:!0}))})})({apply({params:e,cache:t,dependencies:r}){let n=new Map,o=[],i=0;for(let s of e.selections){let l=r[s.ref].data,u=Q.Bundle.toLoci(s.bundle,l);o.push({key:s.key,structureRef:s.ref,loci:u,groupId:s.groupId}),i+=Q.Loci.size(u),n.set(s.key,{source:l})}t.entries=n;let a={label:`${e.label||"Multi-selection"}`,description:`${e.selections.length} source(s), ${i} element(s) total`};return new ne.Molecule.Structure.Selections(o,a)},update:({b:e,oldParams:t,newParams:r,cache:n,dependencies:o})=>{if(!!t.isTransitive!=!!r.isTransitive)return et.UpdateResult.Recreate;let i=n.entries,a=new Map,s=new Map;for(let d of t.selections)s.set(d.key,d.bundle);let l=new Map;for(let d of e.data)l.set(d.key,d);let u=!1,c=0,m=[];for(let d of r.selections){let p=!1;if(i.has(d.key)){let h=o[d.ref].data,f=i.get(d.key),g=s.get(d.key);if(g&&h===f.source&&d.bundle.hash===f.source.hashCode&&Q.Bundle.areEqual(d.bundle,g)){let y=l.get(d.key);y.groupId!==d.groupId&&(y.groupId=d.groupId,u=!0),a.set(d.key,f),m.push(y),c+=Q.Loci.size(y.loci);continue}p=!0}else p=!0;if(p){u=!0;let h=o[d.ref].data,f=Q.Bundle.toLoci(d.bundle,h);m.push({key:d.key,structureRef:d.ref,loci:f,groupId:d.groupId}),c+=Q.Loci.size(f),a.set(d.key,{source:h})}}return u?(n.entries=a,e.data=m,e.label=`${r.label||"Multi-selection"}`,e.description=`${m.length} source(s), ${c} element(s) total`,et.UpdateResult.Updated):et.UpdateResult.Unchanged}}),Let=Vt.BuiltIn({name:"structure-selection-from-script",display:{name:"Selection",description:"Create a molecular structure from the specified script."},from:ne.Molecule.Structure,to:ne.Molecule.Structure,params:()=>({script:C.Script({language:"mol-script",expression:"(sel.atom.atom-groups :residue-test (= atom.resname ALA))"}),label:C.Optional(C.Text(""))})})({apply({a:e,params:t,cache:r}){let{selection:n,entry:o}=js.createAndRun(e.data,t.script);r.entry=o;let i=ut.unionStructure(n),a={label:`${t.label||"Selection"}`,description:De.elementDescription(i)};return new ne.Molecule.Structure(i,a)},update:({a:e,b:t,oldParams:r,newParams:n,cache:o})=>{if(!Mo.areEqual(r.script,n.script))return et.UpdateResult.Recreate;let i=o.entry;if(i.currentStructure===e.data)return et.UpdateResult.Unchanged;let a=js.updateStructure(i,e.data);return js.updateStructureObject(t,a,n.label),et.UpdateResult.Updated},dispose({b:e}){e?.data.customPropertyDescriptors.dispose()}}),Vet=Vt.BuiltIn({name:"structure-selection-from-bundle",display:{name:"Selection",description:"Create a molecular structure from the specified structure-element bundle."},from:ne.Molecule.Structure,to:ne.Molecule.Structure,params:()=>({bundle:C.Value(Q.Bundle.Empty,{isHidden:!0}),label:C.Optional(C.Text("",{isHidden:!0}))})})({apply({a:e,params:t,cache:r}){if(t.bundle.hash!==e.data.hashCode)return Gn.Null;r.source=e.data;let n=Q.Bundle.toStructure(t.bundle,e.data);if(n.elementCount===0)return Gn.Null;let o={label:`${t.label||"Selection"}`,description:De.elementDescription(n)};return new ne.Molecule.Structure(n,o)},update:({a:e,b:t,oldParams:r,newParams:n,cache:o})=>{if(!Q.Bundle.areEqual(r.bundle,n.bundle))return et.UpdateResult.Recreate;if(n.bundle.hash!==e.data.hashCode)return et.UpdateResult.Null;if(o.source===e.data)return et.UpdateResult.Unchanged;o.source=e.data;let i=Q.Bundle.toStructure(n.bundle,e.data);return i.elementCount===0?et.UpdateResult.Null:(t.label=`${n.label||"Selection"}`,t.description=De.elementDescription(i),t.data=i,et.UpdateResult.Updated)},dispose({b:e}){e?.data.customPropertyDescriptors.dispose()}}),_Se={polymer:"polymer",protein:"protein",nucleic:"nucleic",water:"water",branched:"branched",ligand:"ligand","non-standard":"non-standard",coarse:"coarse","atomic-sequence":"atomic-sequence","atomic-het":"atomic-het",spheres:"spheres"},Oet=C.objectToOptions(_Se),Get=Vt.BuiltIn({name:"structure-complex-element",display:{name:"Complex Element",description:"Create a molecular structure from the specified model."},from:ne.Molecule.Structure,to:ne.Molecule.Structure,params:{type:C.Select("atomic-sequence",Oet,{isHidden:!0})}})({apply({a:e,params:t}){let r,n;switch(t.type){case"polymer":r=oi.polymer.query,n="Polymer";break;case"protein":r=oi.protein.query,n="Protein";break;case"nucleic":r=oi.nucleic.query,n="Nucleic";break;case"water":r=Xn.internal.water(),n="Water";break;case"branched":r=oi.branchedPlusConnected.query,n="Branched";break;case"ligand":r=oi.ligandPlusConnected.query,n="Ligand";break;case"non-standard":r=oi.nonStandardPolymer.query,n="Non-standard";break;case"coarse":r=oi.coarse.query,n="Coarse";break;case"atomic-sequence":r=Xn.internal.atomicSequence(),n="Sequence";break;case"atomic-het":r=Xn.internal.atomicHet(),n="HET Groups/Ligands";break;case"spheres":r=Xn.internal.spheres(),n="Coarse Spheres";break;default:Mr(t.type)}let o=r(new zo(e.data)),i=ut.unionStructure(o);return i.elementCount===0?Gn.Null:new ne.Molecule.Structure(i,{label:n,description:De.elementDescription(i)})},dispose({b:e}){e?.data.customPropertyDescriptors.dispose()}}),TW=Vt.BuiltIn({name:"structure-component",display:{name:"Component",description:"A molecular structure component."},from:ne.Molecule.Structure,to:ne.Molecule.Structure,params:w0e})({apply({a:e,params:t,cache:r}){return hA(e.data,t,r)},update:({a:e,b:t,oldParams:r,newParams:n,cache:o})=>M0e(e.data,t,r,n,o),dispose({b:e}){e?.data.customPropertyDescriptors.dispose()}}),RR=Vt.BuiltIn({name:"custom-model-properties",display:{name:"Custom Model Properties"},isDecorator:!0,from:ne.Molecule.Model,to:ne.Molecule.Model,params:(e,t)=>t.customModelProperties.getParams(e?.data)})({apply({a:e,params:t},r){return Ae.create("Custom Props",async n=>(await TSe(e.data,r,n,t),new ne.Molecule.Model(e.data,{label:e.label,description:e.description})))},update({a:e,b:t,oldParams:r,newParams:n},o){return Ae.create("Custom Props",async i=>{t.data=e.data,t.label=e.label,t.description=e.description;for(let a of r.autoAttach){let s=o.customModelProperties.get(a);s&&e.data.customProperties.reference(s.descriptor,!1)}return await TSe(e.data,o,i,n),et.UpdateResult.Updated})},dispose({b:e}){e?.data.customProperties.dispose()}});async function TSe(e,t,r,n){let o={runtime:r,assetManager:t.managers.asset,errorContext:t.errorContext},{autoAttach:i,properties:a}=n;for(let s of Object.keys(a)){let l=t.customModelProperties.get(s),u=a[s];if(i.includes(s)||l.isHidden)try{await l.attach(o,e,u,!0)}catch(c){t.log.warn(`Error attaching model prop '${s}': ${c}`)}else l.set(e,u)}}var DR=Vt.BuiltIn({name:"custom-structure-properties",display:{name:"Custom Structure Properties"},isDecorator:!0,from:ne.Molecule.Structure,to:ne.Molecule.Structure,params:(e,t)=>t.customStructureProperties.getParams(e?.data.root)})({apply({a:e,params:t},r){return Ae.create("Custom Props",async n=>(await PSe(e.data.root,r,n,t),new ne.Molecule.Structure(e.data,{label:e.label,description:e.description})))},update({a:e,b:t,oldParams:r,newParams:n},o){return e.data!==t.data?et.UpdateResult.Recreate:Ae.create("Custom Props",async i=>{t.data=e.data,t.label=e.label,t.description=e.description;for(let a of r.autoAttach){let s=o.customStructureProperties.get(a);s&&e.data.customPropertyDescriptors.reference(s.descriptor,!1)}return await PSe(e.data.root,o,i,n),et.UpdateResult.Updated})},dispose({b:e}){e?.data.customPropertyDescriptors.dispose()}});async function PSe(e,t,r,n){let o={runtime:r,assetManager:t.managers.asset,errorContext:t.errorContext},{autoAttach:i,properties:a}=n;for(let s of Object.keys(a)){let l=t.customStructureProperties.get(s),u=a[s];if(i.includes(s)||l.isHidden)try{await l.attach(o,e,u,!0)}catch(c){t.log.warn(`Error attaching structure prop '${s}': ${c}`)}else l.set(e,u)}}var Uet=Vt.BuiltIn({name:"shape-from-ply",display:{name:"Shape from PLY",description:"Create Shape from PLY data"},from:ne.Format.Ply,to:ne.Shape.Provider,params(e){return{transforms:C.Optional(C.Value([],{isHidden:!0})),label:C.Optional(C.Text("",{isHidden:!0}))}}})({apply({a:e,params:t}){return Ae.create("Create shape from PLY",async r=>{let n=await kCe(e.data,t).runInContext(r),o={label:t.label||"Shape"};return new ne.Shape.Provider(n,o)})}});var BW={};Gi(BW,{AssignColorVolume:()=>Xet,VolumeFromCcp4:()=>_W,VolumeFromCube:()=>jet,VolumeFromDensityServerCif:()=>DW,VolumeFromDsn6:()=>Het,VolumeFromDx:()=>RW,VolumeFromSegmentationCif:()=>Wet,VolumeInstances:()=>MW,VolumeTransform:()=>wW});function Net(e){return e.originX===0&&e.originY===0&&e.originZ===0?b.create(e.NCSTART,e.NRSTART,e.NSSTART):b.create(e.originX/(e.xLength/e.NX),e.originY/(e.yLength/e.NY),e.originZ/(e.zLength/e.NZ))}function zet(e){let t=e8(e);switch(t){case uu.Float32:return Float32Array;case uu.Int8:return Int8Array;case uu.Int16:return Int16Array;case uu.Uint16:return Uint16Array}throw Error(`${t} is not a supported value format.`)}function RSe(e,t){return Ae.create("Create Volume",async r=>{let{header:n,values:o}=e,i=b.create(n.xLength,n.yLength,n.zLength);t&&t.voxelSize&&b.mul(i,i,t.voxelSize);let a=b.create(kr(n.alpha),kr(n.beta),kr(n.gamma)),s=n.ISPG>65536?0:n.ISPG,l=ha.create(s||"P 1",i,a),u=b.create(n.MAPC-1,n.MAPR-1,n.MAPS-1),c=Dr.convertToCanonicalAxisIndicesFastToSlow(u),m=[n.NX,n.NY,n.NZ],d=c([n.NC,n.NR,n.NS]),p=Net(n);t?.offset&&b.add(p,p,t.offset);let h=c(p),f=b.create(h[0]/m[0],h[1]/m[1],h[2]/m[2]),g=b.create(d[0]/m[0],d[1]/m[1],d[2]/m[2]),y=Dr.Space(d,Dr.invertAxisOrder(u),zet(n)),x=Dr.create(y,Dr.Data1(o)),S=n.AMIN===0&&n.AMAX===0&&n.AMEAN===0&&n.ARMS===0,I={transform:{kind:"spacegroup",cell:l,fractionalBox:pt.create(f,b.add(b(),f,g))},cells:x,stats:{min:Number.isNaN(n.AMIN)||S?Yb(o):n.AMIN,max:Number.isNaN(n.AMAX)||S?xl(o):n.AMAX,mean:Number.isNaN(n.AMEAN)||S?Kb(o):n.AMEAN,sigma:Number.isNaN(n.ARMS)||n.ARMS===0?Jb(o):n.ARMS}};return{label:t?.label,entryId:t?.entryId,periodicity:b.isInteger(g)?"xyz":"none",grid:I,instances:[{transform:H.identity()}],sourceData:DSe.create(e),customProperties:new $a,_propertyData:Object.create(null)}})}var DSe;(r=>{function e(n){return n?.kind==="ccp4"}r.is=e;function t(n){return{kind:"ccp4",name:n.name,data:n}}r.create=t})(DSe||={});function wSe(e,t){return Ae.create("Create Volume",async r=>{let{header:n,values:o}=e,i=b.create(n.xlen,n.ylen,n.zlen);t&&t.voxelSize&&b.mul(i,i,t.voxelSize);let a=b.create(kr(n.alpha),kr(n.beta),kr(n.gamma)),s=ha.create("P 1",i,a),l=[n.xRate,n.yRate,n.zRate],u=[n.xExtent,n.yExtent,n.zExtent],c=[n.xStart,n.yStart,n.zStart],m=b.create(c[0]/l[0],c[1]/l[1],c[2]/l[2]),d=b.create(u[0]/l[0],u[1]/l[1],u[2]/l[2]),p=Dr.Space(u,[0,1,2],Float32Array),h=Dr.create(p,Dr.Data1(o));return{label:t?.label,entryId:t?.entryId,periodicity:b.isInteger(d)?"xyz":"none",grid:{transform:{kind:"spacegroup",cell:s,fractionalBox:pt.create(m,b.add(b.zero(),m,d))},cells:h,stats:{min:Yb(o),max:xl(o),mean:Kb(o),sigma:n.sigma!==void 0?n.sigma:Jb(o)}},instances:[{transform:H.identity()}],sourceData:MSe.create(e),customProperties:new $a,_propertyData:Object.create(null)}})}var MSe;(r=>{function e(n){return n?.kind==="dsn6"}r.is=e;function t(n){return{kind:"dsn6",name:n.name,data:n}}r.create=t})(MSe||={});function BSe(e,t){return Ae.create("Create Volume",async()=>{let{header:r,values:n}=e,o=Dr.Space(r.dim,[0,1,2],Float64Array),i=Dr.create(o,Dr.Data1(n)),a=H.fromTranslation(H(),r.min),s=H.fromScaling(H(),r.h);return H.mul(a,a,s),{label:t?.label,entryId:t?.entryId,grid:{transform:{kind:"matrix",matrix:a},cells:i,stats:{min:Yb(n),max:xl(n),mean:Kb(n),sigma:Jb(n)}},instances:[{transform:H.identity()}],sourceData:ESe.create(e),customProperties:new $a,_propertyData:Object.create(null)}})}var ESe;(r=>{function e(n){return n?.kind==="dx"}r.is=e;function t(n){return{kind:"dx",name:n.name,data:n}}r.create=t})(ESe||={});function kSe(e,t){return Ae.create("Create Segmentation Volume",async r=>{let{volume_data_3d_info:n,segmentation_data_3d:o}=e,i=ha.create(n.spacegroup_number.value(0)||"P 1",b.ofArray(n.spacegroup_cell_size.value(0)),b.scale(b(),b.ofArray(n.spacegroup_cell_angles.value(0)),Math.PI/180)),a=n.axis_order.value(0),s=Dr.convertToCanonicalAxisIndicesFastToSlow(a),l=s(n.sample_count.value(0)),u=Dr.Space(l,Dr.invertAxisOrder(a),Float32Array),c=Dr.create(u,Dr.Data1(o.values.toArray({array:Float32Array}))),m=b.ofArray(s(n.origin.value(0))),d=b.ofArray(s(n.dimensions.value(0))),p={label:t?.label,entryId:void 0,grid:{transform:{kind:"spacegroup",cell:i,fractionalBox:pt.create(m,b.add(b(),m,d))},cells:c,stats:{min:0,max:1,mean:0,sigma:1}},instances:[{transform:H.identity()}],sourceData:FSe.create(e),customProperties:new $a,_propertyData:{ownerId:t?.ownerId}};Ge.PickingGranularity.set(p,"object");let h=new Map,f=new Map,{segment_id:g,set_id:y}=e.segmentation_data_table;for(let D=0,B=g.rowCount;D<B;++D){let k=g.value(D),F=y.value(D);F===0||k===0||(f.has(F)||f.set(F,new Set),f.get(F).add(k))}f.forEach((D,B)=>{D.forEach(k=>{h.has(k)||h.set(k,new Set),h.get(k).add(B)})});let x=[0,0,0],S=c.space.getCoords,I=c.data,[v,A,P]=p.grid.cells.space.dimensions,T=v-1,R=A-1,w=P-1,E={};f.forEach((D,B)=>{E[B]=[T,R,w,-1,-1,-1]});for(let D=0,B=I.length;D<B;++D){let k=I[D];if(k===0)continue;S(D,x);let F=E[k];x[0]<F[0]&&(F[0]=x[0]),x[1]<F[1]&&(F[1]=x[1]),x[2]<F[2]&&(F[2]=x[2]),x[0]>F[3]&&(F[3]=x[0]),x[1]>F[4]&&(F[4]=x[1]),x[2]>F[5]&&(F[5]=x[2])}let M={};return h.forEach((D,B)=>{M[B]=pt.create(b.create(T,R,w),b.create(-1,-1,-1))}),wi(E,(D,B)=>{f.get(parseInt(B)).forEach(k=>{let F=M[k];D[0]<F.min[0]&&(F.min[0]=D[0]),D[1]<F.min[1]&&(F.min[1]=D[1]),D[2]<F.min[2]&&(F.min[2]=D[2]),D[3]>F.max[0]&&(F.max[0]=D[3]),D[4]>F.max[1]&&(F.max[1]=D[4]),D[5]>F.max[2]&&(F.max[2]=D[5])})}),Ge.Segmentation.set(p,{segments:h,sets:f,bounds:M,labels:t?.segmentLabels??{}}),p})}var FSe;(r=>{function e(n){return n?.kind==="segcif"}r.is=e;function t(n){return{kind:"segcif",name:n._name,data:n}}r.create=t})(FSe||={});var _W=Vt.BuiltIn({name:"volume-from-ccp4",display:{name:"Volume from CCP4/MRC/MAP",description:"Create Volume from CCP4/MRC/MAP data"},from:ne.Format.Ccp4,to:ne.Volume.Data,params(e){return{voxelSize:C.Vec3(b.create(1,1,1)),offset:C.Vec3(b.create(0,0,0)),entryId:C.Text("")}}})({apply({a:e,params:t}){return Ae.create("Create volume from CCP4/MRC/MAP",async r=>{let n=await RSe(e.data,{...t,label:e.data.name||e.label}).runInContext(r),o={label:n.label||"Volume",description:`Volume ${e.data.header.NX}\xD7${e.data.header.NX}\xD7${e.data.header.NX}`};return new ne.Volume.Data(n,o)})},dispose({b:e}){e?.data.customProperties.dispose()}}),Het=Vt.BuiltIn({name:"volume-from-dsn6",display:{name:"Volume from DSN6/BRIX",description:"Create Volume from DSN6/BRIX data"},from:ne.Format.Dsn6,to:ne.Volume.Data,params(e){return{voxelSize:C.Vec3(b.create(1,1,1)),entryId:C.Text("")}}})({apply({a:e,params:t}){return Ae.create("Create volume from DSN6/BRIX",async r=>{let n=await wSe(e.data,{...t,label:e.data.name||e.label}).runInContext(r),o={label:n.label||"Volume",description:`Volume ${e.data.header.xExtent}\xD7${e.data.header.yExtent}\xD7${e.data.header.zExtent}`};return new ne.Volume.Data(n,o)})},dispose({b:e}){e?.data.customProperties.dispose()}}),jet=Vt.BuiltIn({name:"volume-from-cube",display:{name:"Volume from Cube",description:"Create Volume from Cube data"},from:ne.Format.Cube,to:ne.Volume.Data,params(e){return{dataIndex:e?C.Select(0,e.data.header.dataSetIds.map((r,n)=>[n,`${r}`])):C.Numeric(0),entryId:C.Text("")}}})({apply({a:e,params:t}){return Ae.create("Create volume from Cube",async r=>{let n=await Dbe(e.data,{...t,label:e.data.name||e.label}).runInContext(r),o={label:n.label||"Volume",description:`Volume ${e.data.header.dim[0]}\xD7${e.data.header.dim[1]}\xD7${e.data.header.dim[2]}`};return new ne.Volume.Data(n,o)})},dispose({b:e}){e?.data.customProperties.dispose()}}),RW=Vt.BuiltIn({name:"volume-from-dx",display:{name:"Parse DX",description:"Create volume from DX data."},from:ne.Format.Dx,to:ne.Volume.Data})({apply({a:e}){return Ae.create("Parse DX",async t=>{let r=await BSe(e.data,{label:e.data.name||e.label}).runInContext(t),n={label:r.label||"Volume",description:`Volume ${e.data.header.dim[0]}\xD7${e.data.header.dim[1]}\xD7${e.data.header.dim[2]}`};return new ne.Volume.Data(r,n)})},dispose({b:e}){e?.data.customProperties.dispose()}}),DW=Vt.BuiltIn({name:"volume-from-density-server-cif",display:{name:"Volume from density-server CIF",description:"Identify and create all separate models in the specified CIF data block"},from:ne.Format.Cif,to:ne.Volume.Data,params(e){if(!e)return{blockHeader:C.Optional(C.Text(void 0,{description:"Header of the block to parse. If none is specifed, the 1st data block in the file is used."})),entryId:C.Text("")};let t=e.data.blocks.slice(1);return{blockHeader:C.Optional(C.Select(t[0]&&t[0].header,t.map(r=>[r.header,r.header]),{description:"Header of the block to parse"})),entryId:C.Text("")}}})({isApplicable:e=>e.data.blocks.length>0,apply({a:e,params:t}){return Ae.create("Parse density-server CIF",async r=>{let n=t.blockHeader||e.data.blocks[1].header,o=e.data.blocks.find(m=>m.header===n);if(!o)throw new Error(`Data block '${[n]}' not found.`);let i=Fu.schema.densityServer(o),a=await qk(i,{entryId:t.entryId}).runInContext(r),[s,l,u]=a.grid.cells.space.dimensions,c={label:t.entryId??i.volume_data_3d_info.name.value(0),description:`Volume ${s}\xD7${l}\xD7${u}`};return new ne.Volume.Data(a,c)})},dispose({b:e}){e?.data.customProperties.dispose()}}),Wet=Vt.BuiltIn({name:"volume-from-segmentation-cif",display:{name:"Volume from Segmentation CIF"},from:ne.Format.Cif,to:ne.Volume.Data,params(e){let t=e?.data.blocks.slice(1);return{blockHeader:t?C.Optional(C.Select(t[0]&&t[0].header,t.map(n=>[n.header,n.header]),{description:"Header of the block to parse"})):C.Optional(C.Text(void 0,{description:"Header of the block to parse. If none is specifed, the 1st data block in the file is used."})),segmentLabels:C.ObjectList({id:C.Numeric(-1),label:C.Text("")},n=>`${n.id} = ${n.label}`,{description:"Mapping of segment IDs to segment labels"}),ownerId:C.Text("",{isHidden:!0,description:"Reference to the object which manages this volume"})}}})({isApplicable:e=>e.data.blocks.length>0,apply({a:e,params:t}){return Ae.create("Parse segmentation CIF",async r=>{let n=t.blockHeader||e.data.blocks[1].header,o=e.data.blocks.find(d=>d.header===n);if(!o)throw new Error(`Data block '${[n]}' not found.`);let i=Fu.schema.segmentation(o),a={};for(let d of t.segmentLabels)a[d.id]=d.label;let s=await kSe(i,{segmentLabels:a,ownerId:t.ownerId}).runInContext(r),[l,u,c]=s.grid.cells.space.dimensions,m={label:i.volume_data_3d_info.name.value(0),description:`Segmentation ${l}\xD7${u}\xD7${c}`};return new ne.Volume.Data(s,m)})},dispose({b:e}){e?.data.customProperties.dispose()}}),Xet=Vt.BuiltIn({name:"assign-color-volume",display:{name:"Assign Color Volume",description:"Assigns another volume to be available for coloring."},from:ne.Volume.Data,to:ne.Volume.Data,isDecorator:!0,params(e,t){if(!e)return{ref:C.Text()};let r=t.state.data.select(tr.Generators.root.subtree().ofType(ne.Volume.Data).filter(n=>!!n.obj&&!n.obj?.data.colorVolume&&n.obj!==e));return r.length===0?{ref:C.Text("",{isHidden:!0})}:{ref:C.Select(r[0].transform.ref,r.map(n=>[n.transform.ref,n.obj.label]))}}})({apply({a:e,params:t,dependencies:r}){return Ae.create("Assign Color Volume",async n=>{if(!r||!r[t.ref])throw new Error("Dependency not available.");let o=r[t.ref].data,i={...e.data,colorVolume:o},a={label:e.label,description:"Volume + Colors"};return new ne.Volume.Data(i,a)})}}),wW=Vt.BuiltIn({name:"volume-transform",display:{name:"Transform Volume"},isDecorator:!0,from:ne.Volume.Data,to:ne.Volume.Data,params:{transform:SA}})({canAutoUpdate(){return!1},apply({a:e,params:t}){let r=xA(t.transform)?Nn.getBoundingSphere(e.data.grid).center:b.unit,n=CA(t.transform,r),o={kind:"matrix",matrix:H.mul(H(),n,Nn.getGridToCartesianTransform(e.data.grid))};return new ne.Volume.Data({...e.data,grid:{...e.data.grid,transform:o}},{label:e.label,description:`${e.description} [Transformed]`})}}),MW=Vt.BuiltIn({name:"volume-instances",display:{name:"Volume Instances"},isDecorator:!0,from:ne.Volume.Data,to:ne.Volume.Data,params:{transforms:C.ObjectList({transform:SA},()=>"Transform")}})({canAutoUpdate(){return!0},apply({a:e,params:t}){let r=t.transforms.some(o=>xA(o.transform))?Nn.getBoundingSphere(e.data.grid).center:b.unit,n=t.transforms.map(o=>({transform:CA(o.transform,r)}));return n.length?new ne.Volume.Data({...e.data,instances:n},{label:e.label,description:`${e.description} [Instanced]`}):e}});var rX={};Gi(rX,{ClippingStructureRepresentation3DFromBundle:()=>lnt,ClippingStructureRepresentation3DFromScript:()=>snt,EmissiveStructureRepresentation3DFromBundle:()=>ont,EmissiveStructureRepresentation3DFromScript:()=>nnt,ExplodeStructureRepresentation3D:()=>Krt,ModelUnitcell3D:()=>mnt,OverpaintStructureRepresentation3DFromBundle:()=>ent,OverpaintStructureRepresentation3DFromScript:()=>$rt,ShapeRepresentation3D:()=>cnt,SpinStructureRepresentation3D:()=>Jrt,StructureBoundingBox3D:()=>dnt,StructureRepresentation3D:()=>Od,StructureSelectionsAngle3D:()=>fnt,StructureSelectionsDihedral3D:()=>hnt,StructureSelectionsDistance3D:()=>pnt,StructureSelectionsLabel3D:()=>gnt,StructureSelectionsOrientation3D:()=>ynt,StructureSelectionsPlane3D:()=>bnt,SubstanceStructureRepresentation3DFromBundle:()=>ant,SubstanceStructureRepresentation3DFromScript:()=>int,ThemeStrengthRepresentation3D:()=>unt,TransparencyStructureRepresentation3DFromBundle:()=>rnt,TransparencyStructureRepresentation3DFromScript:()=>tnt,UnwindStructureAssemblyRepresentation3D:()=>Yrt,VolumeRepresentation3D:()=>tX,VolumeRepresentation3DHelpers:()=>nh});function LSe(){if(typeof navigator>"u"||typeof window>"u")return!1;let e=!1;return(function(t){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(e=!0)})(navigator.userAgent||navigator.vendor||window.opera),e}function EW(){if(typeof navigator>"u"||typeof window>"u")return!1;let e=/iPad|iPhone|iPod/.test(navigator.userAgent),t=navigator.userAgent.includes("Macintosh"),r=navigator.maxTouchPoints>=4;return!window.MSStream&&(e||t&&r)}function VSe(){if(typeof navigator>"u"||!("xr"in navigator))return!1;let e=navigator.userAgent||"";return/OculusBrowser\//.test(e)||/PicoBrowser\//.test(e)}var kd;(r=>{function e(){return{updateTransform:!1,updateMatrix:!1,updateColor:!1,updateSize:!1,createGeometry:!1,createNew:!1,info:{}}}r.create=e;function t(n){n.updateTransform=!1,n.updateMatrix=!1,n.updateColor=!1,n.updateSize=!1,n.createGeometry=!1,n.createNew=!1}r.reset=t})(kd||={});var Qet={lowestElementCount:1e6,lowerElementCount:5e5,lowElementCount:1e5,mediumElementCount:2e4,highElementCount:2e3,coarseGrainedFactor:10,elementCountFactor:1};function Zet(e){switch(e){case"lowest":return 0;case"lower":return 1;case"low":return 2;case"medium":return 3;case"high":return 4;case"higher":return 5;case"highest":return 6}}function kW(e,t={}){let r={...Qet,...t},n=e.elementCount*r.elementCountFactor;return(e.isCoarseGrained||e.isCoarse)&&(n*=r.coarseGrainedFactor),n>r.lowestElementCount?"lowest":n>r.lowerElementCount?"lower":n>r.lowElementCount?"low":n>r.mediumElementCount?"medium":n>r.highElementCount?"high":"higher"}function qet(e){if(e.root.models.length===1){let t=Qo.Provider.get(e.root.model);if(t&&t.spacegroup.name==="P 1"&&!ha.isZero(t.spacegroup.cell))return t.spacegroup.cell.volume}return pt.volume(e.root.boundary.box)}function wR(e,t){let r=ua(e.quality,"auto"),n=ua(e.detail,1),o=ua(e.radialSegments,12),i=ua(e.linearSegments,8),a=ua(e.resolution,2),s=ua(e.imageResolution,1),l=ua(e.probePositions,12),u=ua(e.doubleSided,!0),c=0;if(r==="auto"){if(t instanceof De)r=kW(t.root),c=qet(t);else if(Ge.is(t)){let[m,d,p]=t.grid.cells.space.dimensions;c=m*d*p,r=c<1e7?"medium":"low"}}if(r!=="custom"&&r!=="auto"){let m=Zet(r);switch(VSe()&&(m=Math.max(m-1,0)),m){case 6:n=3,o=36,i=18,a=.1,s=.01,l=72,u=!0;break;case 5:n=3,o=28,i=14,a=.3,s=.05,l=48,u=!0;break;case 4:n=2,o=20,i=10,a=.5,s=.1,l=36,u=!0;break;case 3:n=1,o=12,i=8,a=.8,s=.2,l=24,u=!0;break;case 2:n=0,o=8,i=3,a=1.3,s=.4,l=24,u=!1;break;case 1:n=0,o=4,i=2,a=3,s=.7,l=12,u=!1;break;case 0:n=0,o=2,i=1,a=8,s=1,l=12,u=!1;break}}return c>0&&(a=Math.max(a,c/3e8),a=Math.min(a,20)),e.transparentBackfaces==="off"&&(e.alpha!==void 0&&e.alpha<1||e.xrayShaded)&&(u=!1),{detail:n,radialSegments:o,linearSegments:i,resolution:a,imageResolution:s,probePositions:l,doubleSided:u}}var ii;(i=>{i.is=Ia.has,i.All=63,i.Highlighting=35,i.Selecting=60;function o(a,s){return a===1&&s===2||a===2&&s===1||a===4&&s===8||a===8&&s===4||a===16&&s===16}i.isReverse=o})(ii||={});function OSe(e,t,r){e.fill(t,0,r)}function FW(e,t,r){switch(r){case 1:e[t]|=1;break;case 2:e[t]&=-2;break;case 4:e[t]|=2;break;case 8:e[t]&=-3;break;case 16:e[t]^=2;break;case 32:e[t]=0;break}}function PC(e,t,r){if(r===0)return!1;if(ye.is(t)){let n=ye.start(t),o=ye.end(t),i=n+3>>2,a=i+(o-4*i>>2);if(a<=i){for(let d=n;d<o;++d)FW(e,d,r);return!0}let s=new Uint32Array(e.buffer,0,e.buffer.byteLength>>2),l=n,u=Math.min(4*i,o),c=Math.max(n,4*a),m=o;switch(r){case 1:for(let d=i;d<a;++d)s[d]|=16843009;break;case 2:for(let d=i;d<a;++d)s[d]&=-16843010;break;case 4:for(let d=i;d<a;++d)s[d]|=33686018;break;case 8:for(let d=i;d<a;++d)s[d]&=-33686019;break;case 16:for(let d=i;d<a;++d)s[d]^=33686018;break;case 32:for(let d=i;d<a;++d)s[d]=0;break;default:Mr(r)}for(let d=l;d<u;++d)FW(e,d,r);for(let d=c;d<m;++d)FW(e,d,r)}else switch(r){case 1:for(let n=0,o=t.length;n<o;++n)e[t[n]]|=1;break;case 2:for(let n=0,o=t.length;n<o;++n)e[t[n]]&=-2;break;case 4:for(let n=0,o=t.length;n<o;++n)e[t[n]]|=2;break;case 8:for(let n=0,o=t.length;n<o;++n)e[t[n]]&=-3;break;case 16:for(let n=0,o=t.length;n<o;++n)e[t[n]]^=2;break;case 32:for(let n=0,o=t.length;n<o;++n)e[t[n]]=0;break;default:Mr(r)}return!0}function GSe(e,t){let r=-1,n=-1;switch(e){case 1:t===0||t===1?(r=1,n=1):t===2||t===3?(r=1,n=3):r=1;break;case 2:t===0||t===1?(r=0,n=0):(t===2||t===3)&&(r=1,n=2);break;case 4:t===1||t===3?(r=1,n=3):t===0||t===2?(r=1,n=2):r=1;break;case 8:t===1||t===3?(r=1,n=1):(t===0||t===2)&&(r=0,n=0);break;case 16:t===1?(r=1,n=3):t===2?(r=0,n=0):t===3?(r=1,n=1):t===0&&(r=1,n=2);break;case 32:r=0,n=0;break}return{average:r,status:n}}function USe(e,t){switch(e){case 1:return .5;case 2:return t===0?0:t===2||t===3?.5:-1;case 4:return .5;case 8:return t===1||t===3?.5:t===0?0:-1;case 16:return t===-1?-1:.5;case 32:return t===-1?-1:t===0?0:.5;case 0:return-1;default:Mr(e)}}var Mg={kind:"every-loci"};function xa(e){return!!e&&e.kind==="every-loci"}var vr={kind:"empty-loci"};function Oi(e){return!!e&&e.kind==="empty-loci"}function e1(e){return!!e&&e.kind==="data-loci"}function Yet(e,t){if(!Z0(e.data,t.data)||e.tag!==t.tag||e.elements.length!==t.elements.length)return!1;for(let r=0,n=e.elements.length;r<n;++r)if(!Z0(e.elements[r],t.elements[r]))return!1;return!0}function Ket(e){return e.elements.length===0}function _C(e,t,r,n,o){return{kind:"data-loci",tag:e,data:t,elements:r,getBoundingSphere:n,getLabel:o}}var nr;(f=>{let e=new Fi("98");function t(g){let y=g.loci.map(x=>a(x)).filter(x=>!!x);e.reset();for(let x of y)e.includePositionRadius(x.center,x.radius);e.finishedIncludeStep();for(let x of y)e.radiusPositionRadius(x.center,x.radius);return e.getSphere()}f.getBundleBoundingSphere=t;function r(g,y){return xa(g)&&xa(y)||Oi(g)&&Oi(y)?!0:e1(g)&&e1(y)?Yet(g,y):De.isLoci(g)&&De.isLoci(y)?De.areLociEqual(g,y):Q.Loci.is(g)&&Q.Loci.is(y)?Q.Loci.areEqual(g,y):It.isLoci(g)&&It.isLoci(y)?It.areLociEqual(g,y):Wr.isLoci(g)&&Wr.isLoci(y)?Wr.areLociEqual(g,y):al.isLoci(g)&&al.isLoci(y)?al.areLociEqual(g,y):Ge.isLoci(g)&&Ge.isLoci(y)?Ge.areLociEqual(g,y):Ge.Isosurface.isLoci(g)&&Ge.Isosurface.isLoci(y)?Ge.Isosurface.areLociEqual(g,y):Ge.Cell.isLoci(g)&&Ge.Cell.isLoci(y)?Ge.Cell.areLociEqual(g,y):Ge.Segment.isLoci(g)&&Ge.Segment.isLoci(y)?Ge.Segment.areLociEqual(g,y):!1}f.areEqual=r;function n(g){return!!g&&g.kind==="every-loci"}f.isEvery=n;function o(g){return xa(g)?!1:Oi(g)?!0:e1(g)?Ket(g):De.isLoci(g)?De.isLociEmpty(g):Q.Loci.is(g)?Q.Loci.isEmpty(g):It.isLoci(g)?It.isLociEmpty(g):Wr.isLoci(g)?Wr.isLociEmpty(g):al.isLoci(g)?al.isLociEmpty(g):Ge.isLoci(g)?Ge.isLociEmpty(g):Ge.Isosurface.isLoci(g)?Ge.Isosurface.isLociEmpty(g):Ge.Cell.isLoci(g)?Ge.Cell.isLociEmpty(g):Ge.Segment.isLoci(g)?Ge.Segment.isLociEmpty(g):!1}f.isEmpty=o;function i(g,y){return y instanceof De&&(Q.Loci.is(g)?g=Q.Loci.remap(g,y):De.isLoci(g)?g=De.remapLoci(g,y):It.isLoci(g)&&(g=It.remapLoci(g,y))),g}f.remap=i;function a(g,y){if(!(g.kind==="every-loci"||g.kind==="empty-loci")){if(y||(y=he()),g.kind==="structure-loci")return he.copy(y,g.structure.boundary.sphere);if(g.kind==="element-loci")return he.copy(y,Q.Loci.getBoundary(g).sphere);if(g.kind==="bond-loci")return It.getBoundingSphere(g,y);if(g.kind==="shape-loci")return he.copy(y,g.shape.geometry.boundingSphere);if(g.kind==="group-loci")return al.getBoundingSphere(g,y);if(g.kind==="data-loci")return g.getBoundingSphere?.(y);if(g.kind==="volume-loci")return Ge.getBoundingSphere(g.volume,y);if(g.kind==="isosurface-loci")return Ge.Isosurface.getBoundingSphere(g.volume,g.isoValue,y);if(g.kind==="cell-loci")return Ge.Cell.getBoundingSphere(g.volume,g.elements,y);if(g.kind==="segment-loci")return Ge.Segment.getBoundingSphere(g.volume,g.elements,y)}}f.getBoundingSphere=a;let s=he.zero();function l(g,y){let x=a(g,s);return x?b.copy(y||b(),x.center):void 0}f.getCenter=l;function u(g){if(!(g.kind==="every-loci"||g.kind==="empty-loci")){if(g.kind==="structure-loci")return Q.Loci.getPrincipalAxes(De.toStructureElementLoci(g.structure));if(g.kind==="element-loci")return Q.Loci.getPrincipalAxes(g);if(g.kind==="bond-loci")return;if(g.kind==="shape-loci")return;if(g.kind==="group-loci")return;if(g.kind==="data-loci")return;if(g.kind==="volume-loci")return;if(g.kind==="isosurface-loci")return;if(g.kind==="cell-loci")return;if(g.kind==="segment-loci")return}}f.getPrincipalAxes=u;let c={element:g=>g,residue:g=>Q.Loci.is(g)?Q.Loci.extendToWholeResidues(g,!0):g,chain:g=>Q.Loci.is(g)?Q.Loci.extendToWholeChains(g):g,entity:g=>Q.Loci.is(g)?Q.Loci.extendToWholeEntities(g):g,model:g=>Q.Loci.is(g)?Q.Loci.extendToWholeModels(g):g,operator:g=>Q.Loci.is(g)?Q.Loci.extendToWholeOperators(g):g,structure:g=>Q.Loci.is(g)?De.toStructureElementLoci(g.structure):al.isLoci(g)?Wr.Loci(g.shape):Ge.Cell.isLoci(g)?Ge.Loci(g.volume,ye.ofLength(g.volume.instances.length)):Ge.Isosurface.isLoci(g)?Ge.Loci(g.volume,ye.ofLength(g.volume.instances.length)):g,elementInstances:g=>Q.Loci.is(g)?Q.Loci.extendToAllInstances(g):g,residueInstances:g=>Q.Loci.is(g)?Q.Loci.extendToAllInstances(Q.Loci.extendToWholeResidues(g,!0)):g,chainInstances:g=>Q.Loci.is(g)?Q.Loci.extendToAllInstances(Q.Loci.extendToWholeChains(g)):g};f.GranularityOptions=C.objectToOptions(c,g=>{switch(g){case"element":return"Atom/Coarse Element";case"elementInstances":return["Atom/Coarse Element Instances","With Symmetry"];case"structure":return"Structure/Shape";default:return g.indexOf("Instances")?[va(g),"With Symmetry"]:va(g)}});function d(g){return g.replace("Instances","")}f.simpleGranularity=d;function p(g,y){return c[y](g)}f.applyGranularity=p;function h(g,y,x=!1){return(y!=="element"||x)&&It.isLoci(g)&&(g=It.toStructureElementLoci(g)),De.isLoci(g)&&(g=De.toStructureElementLoci(g.structure)),Q.Loci.is(g)&&(g=Q.Loci.remap(g,g.structure.root)),y&&(g=p(g,y)),g}f.normalize=h})(nr||={});var vi;(r=>{r.Null=16777214;function t(n,o){return n.objectId===o.objectId&&n.instanceId===o.instanceId&&n.groupId===o.groupId}r.areSame=t})(vi||={});var FF=Jet();function Jet(){let e=new ArrayBuffer(4),t=new Float32Array(e),r=new Uint32Array(e),n=new Uint32Array(512),o=new Uint32Array(512);for(let l=0;l<256;++l){let u=l-127;u<-27?(n[l]=0,n[l|256]=32768,o[l]=24,o[l|256]=24):u<-14?(n[l]=1024>>-u-14,n[l|256]=1024>>-u-14|32768,o[l]=-u-1,o[l|256]=-u-1):u<=15?(n[l]=u+15<<10,n[l|256]=u+15<<10|32768,o[l]=13,o[l|256]=13):u<128?(n[l]=31744,n[l|256]=64512,o[l]=24,o[l|256]=24):(n[l]=31744,n[l|256]=64512,o[l]=13,o[l|256]=13)}let i=new Uint32Array(2048),a=new Uint32Array(64),s=new Uint32Array(64);for(let l=1;l<1024;++l){let u=l<<13,c=0;for(;(u&8388608)===0;)u<<=1,c-=8388608;u&=-8388609,c+=947912704,i[l]=u|c}for(let l=1024;l<2048;++l)i[l]=939524096+(l-1024<<13);for(let l=1;l<31;++l)a[l]=l<<23;a[31]=1199570944,a[32]=2147483648;for(let l=33;l<63;++l)a[l]=2147483648+(l-32<<23);a[63]=3347054592;for(let l=1;l<64;++l)l!==32&&(s[l]=1024);return{floatView:t,uint32View:r,baseTable:n,shiftTable:o,mantissaTable:i,exponentTable:a,offsetTable:s}}function Vp(e){e=_r(e,-65504,65504),FF.floatView[0]=e;let t=FF.uint32View[0],r=t>>23&511;return FF.baseTable[r]+((t&8388607)>>FF.shiftTable[r])}var LF=b.set,NSe=b.normalize,zSe=b.sub,HSe=b.addScalar,VF=b.scale,OF=b.toArray;function Bg(e,t,r,n){let o=!1,i=t.grid.cells.data.length;if(Ge.isLoci(e)){if(!Ge.areEquivalent(e.volume,t))return!1;if(ye.is(e.instances)){let a=ye.start(e.instances)*i,s=ye.end(e.instances)*i;n(ye.ofBounds(a,s))&&(o=!0)}else for(let a=0,s=e.instances.length;a<s;++a){let l=e.instances[a]*i;n(ye.ofBounds(l,l+i))&&(o=!0)}}else if(Ge.Isosurface.isLoci(e)){if(!Ge.areEquivalent(e.volume,t))return!1;if(r?.isoValue){if(!Ge.IsoValue.areSame(e.isoValue,r.isoValue,t.grid.stats))return!1;if(ye.is(e.instances)){let a=ye.start(e.instances)*i,s=ye.end(e.instances)*i;n(ye.ofBounds(a,s))&&(o=!0)}else for(let a=0,s=e.instances.length;a<s;++a){let l=e.instances[a]*i;n(ye.ofBounds(l,l+i))&&(o=!0)}}else{let{stats:a,cells:{data:s}}=t.grid,l=a.sigma,u=Ge.IsoValue.toAbsolute(e.isoValue,a).absoluteValue;for(let c=0,m=s.length;c<m;++c)mo(u,s[c],l)&&xe.forEach(e.instances,d=>{let p=d*i;n(ye.ofSingleton(p+c))&&(o=!0)})}}else if(Ge.Cell.isLoci(e)){if(!Ge.areEquivalent(e.volume,t))return!1;for(let{indices:a,instances:s}of e.elements)ye.is(a)?xe.forEach(s,l=>{let u=l*i;n(ye.offset(a,u))&&(o=!0)}):xe.forEach(a,l=>{xe.forEach(s,u=>{let c=u*i;n(ye.ofSingleton(c+l))&&(o=!0)})})}else if(Ge.Segment.isLoci(e)){if(!Ge.areEquivalent(e.volume,t))return!1;if(r?.segments)for(let{segments:a,instances:s}of e.elements)xe.areIntersecting(a,r.segments)&&xe.forEach(s,l=>{let u=l*i;n(ye.ofBounds(u,u+i))&&(o=!0)});else{let a=Ge.Segmentation.get(t);if(a){let s=new Set;for(let{segments:l,instances:u}of e.elements){for(let d=0,p=xe.size(l);d<p;d++){let h=xe.getAt(l,d);go.add(s,a.segments.get(h))}let c=Array.from(s.values()),m=t.grid.cells.data;for(let d=0,p=m.length;d<p;++d)if(c.includes(m[d]))for(let h=0,f=xe.size(u);h<f;h++){let g=h*i;n(ye.ofSingleton(d+g))&&(o=!0)}}}}}return o}function Op(e){let[t,r,n]=e.grid.cells.space.dimensions,o=t*r*n,i=e.instances.length,a=Ge.Cell.Location(e);return un(o,i,1,(l,u)=>(a.cell=l,a.instance=u,a))}function Gp(e,t=0){let r=e[0]*e[1]*e[2],n=Math.sqrt(r),o=Math.pow(2,Math.ceil(Math.log(n)/Math.log(2))),i=e[0]+t,a=e[1]+t,s=1,l=i;return o<i*e[2]?(l=Math.floor(o/i),s=Math.ceil(e[2]/l),i*=l,a*=s):i*=e[2],{width:i,height:a,columns:l,rows:s,powerOfTwoSize:a<o?o:o*2}}function GF(e,t,r=0,n="byte"){let{cells:{space:o,data:i},stats:{max:a,min:s}}=e.grid,l=o.dimensions,{dataOffset:u}=o,{width:c,height:m}=Gp(l,r),d=t==="data"?1:4,p=n==="byte"?new Uint8Array(c*m*d):n==="halfFloat"?new Uint16Array(c*m*d):new Float32Array(c*m*d),h={array:p,width:c,height:m},f=a-s,[g,y,x]=l,S=g+r,I=y+r,v=b(),A=b(),P=g-1,T=y-1,R=x-1;for(let w=0;w<x;++w)for(let E=0;E<y;++E)for(let M=0;M<g;++M){let D=Math.floor(w*S%c/S),B=Math.floor(w*S/c),k=D*S+M,F=d*(B*I*c+E*c+k),z=u(M,E,w),j;if(n==="byte"?j=Math.round((i[z]-s)/f*255):n==="halfFloat"?j=Vp((i[z]-s)/f):j=(i[z]-s)/f,t==="data")p[F]=j;else{if(t==="groups")if(n==="halfFloat"){let Y=_r(Math.round(z),0,16777215)+1;p[F+2]=Vp(Y%256),Y=Math.floor(Y/256),p[F+1]=Vp(Y%256),Y=Math.floor(Y/256),p[F]=Vp(Y%256)}else qf(z,p,F);else LF(v,i[u(Math.max(0,M-1),E,w)],i[u(M,Math.max(0,E-1),w)],i[u(M,E,Math.max(0,w-1))]),LF(A,i[u(Math.min(P,M+1),E,w)],i[u(M,Math.min(T,E+1),w)],i[u(M,E,Math.min(R,w+1))]),NSe(v,zSe(v,v,A)),HSe(v,VF(v,v,.5),.5),n==="byte"?OF(VF(v,v,255),p,F):n==="halfFloat"?(p[F]=Vp(v[0]),p[F+1]=Vp(v[1]),p[F+2]=Vp(v[2])):OF(v,p,F);p[F+3]=j}}return h}function jSe(e,t="byte"){let{cells:{space:r,data:n},stats:{max:o,min:i}}=e.grid,[a,s,l]=r.dimensions,{dataOffset:u}=r,c=t==="byte"?new Uint8Array(a*s*l*4):t==="halfFloat"?new Uint16Array(a*s*l*4):new Float32Array(a*s*l*4),m={array:c,width:a,height:s,depth:l},d=o-i,p=b(),h=b(),f=a-1,g=s-1,y=l-1,x=0;for(let S=0;S<l;++S)for(let I=0;I<s;++I)for(let v=0;v<a;++v){let A=u(v,I,S);LF(p,n[u(Math.max(0,v-1),I,S)],n[u(v,Math.max(0,I-1),S)],n[u(v,I,Math.max(0,S-1))]),LF(h,n[u(Math.min(f,v+1),I,S)],n[u(v,Math.min(g,I+1),S)],n[u(v,I,Math.min(y,S+1))]),NSe(p,zSe(p,p,h)),HSe(p,VF(p,p,.5),.5),t==="byte"?(OF(VF(p,p,255),c,x),c[x+3]=Math.round((n[A]-i)/d*255)):t==="halfFloat"?(c[x]=Vp(p[0]),c[x+1]=Vp(p[1]),c[x+2]=Vp(p[2]),c[x+3]=Vp((n[A]-i)/d)):(OF(p,c,x),c[x+3]=(n[A]-i)/d),x+=4}return m}function WSe(e,t,r,n=0){let o=e.grid.cells.data,i=pt.size(b(),r),a=e.grid.cells.space.dataOffset,{width:s,height:l}=Gp(i,n),u=1,c=new Uint8Array(s*l*u),m={array:c,width:s,height:l},[d,p,h]=i,f=d-1,g=p-1,y=h-1,x=d+n,S=p+n,[I,v,A]=r.min,[P,T,R]=r.max;for(let w=0;w<h;++w)for(let E=0;E<p;++E)for(let M=0;M<d;++M){let D=Math.floor(w*x%s/x),B=Math.floor(w*x/s),k=D*x+M,F=u*(B*S*s+E*s+k),z=t.includes(o[a(M+I,E+v,w+A)])?255:0,j=t.includes(o[a(Math.min(f+P,M+1+I),E+v,w+A)])?255:0,Y=t.includes(o[a(Math.max(0,M-1+I),E+v,w+A)])?255:0,G=t.includes(o[a(M+I,Math.min(g+T,E+1+v),w+A)])?255:0,X=t.includes(o[a(M+I,Math.max(0,E-1+v),w+A)])?255:0,U=t.includes(o[a(M+I,E+v,Math.min(y+R,w+1+A))])?255:0,L=t.includes(o[a(M+I,E+v,Math.max(0,w-1+A))])?255:0;c[F]=Math.round((z+z+j+Y+G+X+U+L)/8)}return m}function UF(e){let{grid:t}=e,{space:r}=t.cells,{get:n,set:o,add:i,dataOffset:a}=r,[s,l,u]=r.dimensions,c=b.create(s+1,l+1,u+1),f={...r,dimensions:c,get:(S,I,v,A)=>n(S,I%s,v%l,A%u),set:(S,I,v,A,P)=>o(S,I%s,v%l,A%u,P),add:(S,I,v,A,P)=>i(S,I%s,v%l,A%u,P),dataOffset:(S,I,v)=>a(S%s,I%l,v%u)},y={kind:"matrix",matrix:Nn.getGridToCartesianTransform(e.grid)},x={...t,transform:y,cells:{...t.cells,space:f}};return{...e,grid:x}}function MR(e,t,r,n,o){let{colorType:i,vertexCount:a,groupCount:s,positionBuffer:l,instanceBuffer:u,transformBuffer:c,groupBuffer:m,itemSize:d}=e,p=i.endsWith("Instance"),h=pt.fromSphere3D(pt(),p?e.boundingSphere:e.invariantBoundingSphere),f=1+t,g=pt.expand(pt(),h,b.create(f,f,f)),y=1/t,x=pt.scale(pt(),g,y),S=pt.size(b(),x);b.ceil(S,S),b.add(S,S,b.create(2,2,2));let{min:I}=g,[v,A]=S,{width:P,height:T}=Gp(S),R=new Float32Array(P*T*d),w=new Float32Array(P*T),E=new Uint8Array(P*T*d),M={array:E,width:P,height:T,filter:"linear"},D=p?e.instanceCount:1,B=e.colorData.array;function k(q,te,J){let ee=Math.floor(J*v%P/v),ce=Math.floor(J*v/P),fe=ee*v+q;return d*(ce*A*P+te*P+fe)}let F=2,[z,j,Y]=S,G=b();for(let q=0;q<D;++q){let te=n?u[q]:q;for(let J=0;J<a;J+=r){b.fromArray(G,l,J*3),p&&b.transformMat4Offset(G,G,c,0,0,q*16),b.sub(G,G,I),b.scale(G,G,y);let[ee,ce,fe]=G,O=Math.floor(ee),V=Math.floor(ce),Z=Math.floor(fe),pe=(te*s+m[J])*d,$=Math.max(0,O-F),ae=Math.max(0,V-F),Se=Math.max(0,Z-F),ve=Math.min(z,O+F+2),K=Math.min(j,V+F+2),re=Math.min(Y,Z+F+2);for(let le=$;le<ve;++le){let ge=le-ee;for(let Ee=ae;Ee<K;++Ee){let nt=Ee-ce;for(let at=Se;at<re;++at){let be=at-fe,Re=Math.sqrt(ge*ge+nt*nt+be*be);if(Re>F)continue;let Fe=F-Re,Ne=k(le,Ee,at);for(let ot=0;ot<d;++ot)R[Ne+ot]+=B[pe+ot]*Fe;w[Ne/d]+=Fe}}}}}for(let q=0,te=w.length;q<te;++q){let J=q*d,ee=w[q];for(let ce=0;ce<d;++ce)E[J+ce]=Math.round(R[J+ce]/ee)}let X=Ce.create(P,T),U=Et.create(I[0],I[1],I[2],y),L=p?"volumeInstance":"volume";if(n){if(!o){let q=d===4?"rgba":d===3?"rgb":"alpha";o=n.resources.texture("image-uint8",q,"ubyte","linear")}return o.load(M),{kind:"volume",texture:o,gridTexDim:X,gridDim:S,gridTransform:U,type:L}}else{let q=$et({vertexCount:a,instanceCount:D,transformBuffer:c,positionBuffer:l,colorType:L,grid:E,gridDim:S,gridTexDim:X,gridTransform:U,vertexStride:3,colorStride:d,outputStride:d});return{kind:"vertex",texture:q,texDim:Ce.create(q.width,q.height),type:p?"vertexInstance":"vertex"}}}function $et(e){let{vertexCount:t,positionBuffer:r,transformBuffer:n,grid:o,gridDim:i,gridTexDim:a,gridTransform:s,vertexStride:l,colorStride:u}=e,c=e.itemOffset||0,m=e.outputStride;if(m+c>u)throw new Error("outputStride + itemOffset must NOT be larger than colorStride");let d=e.colorType.endsWith("Instance"),p=d?e.instanceCount:1,h=So(Math.max(1,p*t),m,Uint8Array),{array:f}=h,[g,y]=i,x=a[0],S=b.fromArray(b(),s,0),I=s[3];function v(w,E,M){let D=Math.floor(M*g%x/g),B=Math.floor(M*g/x),k=D*g+w;return u*(B*y*x+E*x+k)}let A=b(),P=b(),T=b(),R=b();for(let w=0;w<p;++w)for(let E=0;E<t;++E){b.fromArray(A,r,E*l),d&&b.transformMat4Offset(A,A,n,0,0,w*16),b.sub(A,A,S),b.scale(A,A,I),b.floor(P,A),b.ceil(T,A),b.sub(R,A,P),b.sub(A,T,P),b.div(R,R,A);let[M,D,B]=P,[k,F,z]=T,[j,Y,G]=R,X=v(M,D,B)+c,U=v(k,D,B)+c,L=v(M,D,z)+c,q=v(k,D,z)+c,te=v(M,F,B)+c,J=v(k,F,B)+c,ee=v(M,F,z)+c,ce=v(k,F,z)+c,fe=(w*t+E)*m;for(let O=0;O<m;++O){let V=o[X+O],Z=o[U+O],pe=o[L+O],$=o[q+O],ae=o[te+O],Se=o[J+O],ve=o[ee+O],K=o[ce+O],re=to(V,Z,j),le=to(pe,$,j),ge=to(ae,Se,j),Ee=to(ve,K,j),nt=to(re,ge,Y),at=to(le,Ee,Y);f[fe+O]=to(nt,at,G)}}return h}function ett(e){return e==="group"||e==="groupInstance"}function vA(e,t,r,n,o){if(!ett(e.dColorType.ref.value))return;let i=MR({vertexCount:e.uVertexCount.ref.value,instanceCount:e.uInstanceCount.ref.value,groupCount:e.uGroupCount.ref.value,transformBuffer:e.aTransform.ref.value,instanceBuffer:e.aInstance.ref.value,positionBuffer:e.aPosition.ref.value,groupBuffer:e.aGroup.ref.value,colorData:e.tColor.ref.value,colorType:e.dColorType.ref.value,boundingSphere:e.boundingSphere.ref.value,invariantBoundingSphere:e.invariantBoundingSphere.ref.value,itemSize:3},t,r,n,o);i.kind==="volume"?(_.updateIfChanged(e.dColorType,i.type),_.update(e.tColorGrid,i.texture),_.update(e.uColorTexDim,i.gridTexDim),_.update(e.uColorGridDim,i.gridDim),_.update(e.uColorGridTransform,i.gridTransform)):i.kind==="vertex"&&(_.updateIfChanged(e.dColorType,i.type),_.update(e.tColor,i.texture),_.update(e.uColorTexDim,i.texDim))}function ttt(e){return e==="groupInstance"}function XSe(e,t,r,n,o){if(!ttt(e.dOverpaintType.ref.value))return;let i=MR({vertexCount:e.uVertexCount.ref.value,instanceCount:e.uInstanceCount.ref.value,groupCount:e.uGroupCount.ref.value,transformBuffer:e.aTransform.ref.value,instanceBuffer:e.aInstance.ref.value,positionBuffer:e.aPosition.ref.value,groupBuffer:e.aGroup.ref.value,colorData:e.tOverpaint.ref.value,colorType:e.dOverpaintType.ref.value,boundingSphere:e.boundingSphere.ref.value,invariantBoundingSphere:e.invariantBoundingSphere.ref.value,itemSize:4},t,r,n,o);i.kind==="volume"?(_.updateIfChanged(e.dOverpaintType,i.type),_.update(e.tOverpaintGrid,i.texture),_.update(e.uOverpaintTexDim,i.gridTexDim),_.update(e.uOverpaintGridDim,i.gridDim),_.update(e.uOverpaintGridTransform,i.gridTransform)):i.kind==="vertex"&&(_.updateIfChanged(e.dOverpaintType,i.type),_.update(e.tOverpaint,i.texture),_.update(e.uOverpaintTexDim,i.texDim))}function rtt(e){return e==="groupInstance"}function QSe(e,t,r,n,o){if(!rtt(e.dTransparencyType.ref.value))return;let i=MR({vertexCount:e.uVertexCount.ref.value,instanceCount:e.uInstanceCount.ref.value,groupCount:e.uGroupCount.ref.value,transformBuffer:e.aTransform.ref.value,instanceBuffer:e.aInstance.ref.value,positionBuffer:e.aPosition.ref.value,groupBuffer:e.aGroup.ref.value,colorData:e.tTransparency.ref.value,colorType:e.dTransparencyType.ref.value,boundingSphere:e.boundingSphere.ref.value,invariantBoundingSphere:e.invariantBoundingSphere.ref.value,itemSize:1},t,r,n,o);i.kind==="volume"?(_.updateIfChanged(e.dTransparencyType,i.type),_.update(e.tTransparencyGrid,i.texture),_.update(e.uTransparencyTexDim,i.gridTexDim),_.update(e.uTransparencyGridDim,i.gridDim),_.update(e.uTransparencyGridTransform,i.gridTransform)):i.kind==="vertex"&&(_.updateIfChanged(e.dTransparencyType,i.type),_.update(e.tTransparency,i.texture),_.update(e.uTransparencyTexDim,i.texDim))}function ntt(e){return e==="groupInstance"}function ZSe(e,t,r,n,o){if(!ntt(e.dEmissiveType.ref.value))return;let i=MR({vertexCount:e.uVertexCount.ref.value,instanceCount:e.uInstanceCount.ref.value,groupCount:e.uGroupCount.ref.value,transformBuffer:e.aTransform.ref.value,instanceBuffer:e.aInstance.ref.value,positionBuffer:e.aPosition.ref.value,groupBuffer:e.aGroup.ref.value,colorData:e.tEmissive.ref.value,colorType:e.dEmissiveType.ref.value,boundingSphere:e.boundingSphere.ref.value,invariantBoundingSphere:e.invariantBoundingSphere.ref.value,itemSize:1},t,r,n,o);i.kind==="volume"?(_.updateIfChanged(e.dEmissiveType,i.type),_.update(e.tEmissiveGrid,i.texture),_.update(e.uEmissiveTexDim,i.gridTexDim),_.update(e.uEmissiveGridDim,i.gridDim),_.update(e.uEmissiveGridTransform,i.gridTransform)):i.kind==="vertex"&&(_.updateIfChanged(e.dEmissiveType,i.type),_.update(e.tEmissive,i.texture),_.update(e.uEmissiveTexDim,i.texDim))}function ott(e){return e==="groupInstance"}function qSe(e,t,r,n,o){if(!ott(e.dSubstanceType.ref.value))return;let i=MR({vertexCount:e.uVertexCount.ref.value,instanceCount:e.uInstanceCount.ref.value,groupCount:e.uGroupCount.ref.value,transformBuffer:e.aTransform.ref.value,instanceBuffer:e.aInstance.ref.value,positionBuffer:e.aPosition.ref.value,groupBuffer:e.aGroup.ref.value,colorData:e.tSubstance.ref.value,colorType:e.dSubstanceType.ref.value,boundingSphere:e.boundingSphere.ref.value,invariantBoundingSphere:e.invariantBoundingSphere.ref.value,itemSize:4},t,r,n,o);i.kind==="volume"?(_.updateIfChanged(e.dSubstanceType,i.type),_.update(e.tSubstanceGrid,i.texture),_.update(e.uSubstanceTexDim,i.gridTexDim),_.update(e.uSubstanceGridDim,i.gridDim),_.update(e.uSubstanceGridTransform,i.gridTransform)):i.kind==="vertex"&&(_.updateIfChanged(e.dSubstanceType,i.type),_.update(e.tSubstance,i.texture),_.update(e.uSubstanceTexDim,i.texDim))}var YSe=`
precision highp float;
precision highp sampler2D;

uniform sampler2D tColor;
uniform sampler2D tCount;
uniform vec2 uTexSize;

void main(void) {
    vec2 coords = gl_FragCoord.xy / uTexSize;
    vec4 color = texture2D(tColor, coords);
    float count = texture2D(tCount, coords).r;

    gl_FragColor = color / count;
}
`;var KSe=`
precision highp float;

varying vec3 vPosition;
varying vec4 vColor;

uniform float uCurrentSlice;
uniform float uCurrentX;
uniform float uCurrentY;
uniform float uResolution;

const float p = 2.0;

void main() {
    vec2 v = gl_FragCoord.xy - vec2(uCurrentX, uCurrentY) - 0.5;
    vec3 fragPos = vec3(v.x, v.y, uCurrentSlice);
    float dist = distance(fragPos, vPosition);
    if (dist > p) discard;

    float f = p - dist;
    gl_FragColor = vColor * f;
    gl_FragData[1] = vec4(f);
}
`;var JSe=`
precision highp float;

#include common
#include read_from_texture

uniform int uGroupCount;

attribute float aSample;
#define SampleID int(aSample)

attribute mat4 aTransform;
attribute float aInstance;

uniform vec2 uGeoTexDim;
uniform sampler2D tPosition;
uniform sampler2D tGroup;

uniform vec2 uColorTexDim;
uniform sampler2D tColor;

varying vec3 vPosition;
varying vec4 vColor;

uniform vec3 uBboxSize;
uniform vec3 uBboxMin;
uniform float uResolution;

void main() {
    vec3 position = readFromTexture(tPosition, SampleID, uGeoTexDim).xyz;
    float group = unpackRGBToInt(readFromTexture(tGroup, SampleID, uGeoTexDim).rgb);

    position = (aTransform * vec4(position, 1.0)).xyz;
    gl_PointSize = 7.0;
    vPosition = (position - uBboxMin) / uResolution;
    gl_Position = vec4(((position - uBboxMin) / uBboxSize) * 2.0 - 1.0, 1.0);

    #if defined(dColorType_group)
        vColor = readFromTexture(tColor, group, uColorTexDim);
    #elif defined(dColorType_groupInstance)
        vColor = readFromTexture(tColor, aInstance * float(uGroupCount) + group, uColorTexDim);
    #endif
}
`;var itt={drawCount:Qn("number"),instanceCount:Qn("number"),stride:Qn("number"),uGroupCount:de("i","material"),aTransform:Vn("float32",16,1),aInstance:Vn("float32",1,1),aSample:Vn("float32",1,0),uGeoTexDim:de("v2","material"),tPosition:yt("texture","rgba","float","nearest","material"),tGroup:yt("texture","rgba","float","nearest","material"),uColorTexDim:de("v2","material"),tColor:yt("texture","rgba","ubyte","nearest","material"),dColorType:dt("string",["group","groupInstance","vertex","vertexInstance"]),uCurrentSlice:de("f"),uCurrentX:de("f"),uCurrentY:de("f"),uBboxMin:de("v3","material"),uBboxSize:de("v3","material"),uResolution:de("f","material")},Fd="color-accumulate",BR="color-count";function $Se(e,t){let r=new Float32Array(e);for(let n=0;n<e;++n)r[n]=n*t;return r}function att(e,t,r,n,o){if(e.namedComputeRenderables[Fd]){let i=b.sub(b(),r.max,r.min),a=e.namedComputeRenderables[Fd].values,s=Math.round(t.vertexCount/o);(s>a.drawCount.ref.value||o!==a.stride.ref.value)&&_.update(a.aSample,$Se(s,o)),_.updateIfChanged(a.drawCount,s),_.updateIfChanged(a.instanceCount,t.instanceCount),_.updateIfChanged(a.stride,o),_.updateIfChanged(a.uGroupCount,t.groupCount),_.update(a.aTransform,t.transformBuffer),_.update(a.aInstance,t.instanceBuffer),_.update(a.uGeoTexDim,Ce.set(a.uGeoTexDim.ref.value,t.positionTexture.getWidth(),t.positionTexture.getHeight())),_.update(a.tPosition,t.positionTexture),_.update(a.tGroup,t.groupTexture),_.update(a.uColorTexDim,Ce.set(a.uColorTexDim.ref.value,t.colorData.getWidth(),t.colorData.getHeight())),_.update(a.tColor,t.colorData),_.updateIfChanged(a.dColorType,t.colorType),_.updateIfChanged(a.uCurrentSlice,0),_.updateIfChanged(a.uCurrentX,0),_.updateIfChanged(a.uCurrentY,0),_.update(a.uBboxMin,r.min),_.update(a.uBboxSize,i),_.updateIfChanged(a.uResolution,n),e.namedComputeRenderables[Fd].update()}else e.namedComputeRenderables[Fd]=stt(e,t,r,n,o);return e.namedComputeRenderables[Fd]}function stt(e,t,r,n,o){let i=b.sub(b(),r.max,r.min),a=Math.round(t.vertexCount/o),s={drawCount:_.create(a),instanceCount:_.create(t.instanceCount),stride:_.create(o),uGroupCount:_.create(t.groupCount),aTransform:_.create(t.transformBuffer),aInstance:_.create(t.instanceBuffer),aSample:_.create($Se(a,o)),uGeoTexDim:_.create(Ce.create(t.positionTexture.getWidth(),t.positionTexture.getHeight())),tPosition:_.create(t.positionTexture),tGroup:_.create(t.groupTexture),uColorTexDim:_.create(Ce.create(t.colorData.getWidth(),t.colorData.getHeight())),tColor:_.create(t.colorData),dColorType:_.create(t.colorType),uCurrentSlice:_.create(0),uCurrentX:_.create(0),uCurrentY:_.create(0),uBboxMin:_.create(r.min),uBboxSize:_.create(i),uResolution:_.create(n)},l={...itt},u=zr("accumulate",JSe,KSe,{drawBuffers:"required"}),c=on(e,"points",u,l,s);return an(c,s)}function ltt(e){let{gl:t,state:r}=e;r.disable(t.CULL_FACE),r.enable(t.BLEND),r.disable(t.DEPTH_TEST),r.enable(t.SCISSOR_TEST),r.depthMask(!1),r.clearColor(0,0,0,0),r.blendFunc(t.ONE,t.ONE),r.blendEquation(t.FUNC_ADD)}var utt={...Sn,tColor:yt("texture","rgba","float","nearest"),tCount:yt("texture","alpha","float","nearest"),uTexSize:de("v2")},ER="color-normalize";function ctt(e,t,r){if(e.namedComputeRenderables[ER]){let n=e.namedComputeRenderables[ER].values;_.update(n.tColor,t),_.update(n.tCount,r),_.update(n.uTexSize,Ce.set(n.uTexSize.ref.value,t.getWidth(),t.getHeight())),e.namedComputeRenderables[ER].update()}else e.namedComputeRenderables[ER]=mtt(e,t,r);return e.namedComputeRenderables[ER]}function mtt(e,t,r){let n={...vn,tColor:_.create(t),tCount:_.create(r),uTexSize:_.create(Ce.create(t.getWidth(),t.getHeight()))},o={...utt},i=zr("normalize",Fn,YSe),a=on(e,"triangles",i,o,n);return an(a,n)}function dtt(e){let{gl:t,state:r}=e;r.disable(t.CULL_FACE),r.enable(t.BLEND),r.disable(t.DEPTH_TEST),r.enable(t.SCISSOR_TEST),r.depthMask(!1),r.clearColor(0,0,0,0),r.blendFunc(t.ONE,t.ONE),r.blendEquation(t.FUNC_ADD)}function ptt(e){let t=e[0]*e[1]*e[2],r=Math.sqrt(t),n=Math.pow(2,Math.ceil(Math.log(r)/Math.log(2))),o=0,i=e[1],a=1,s=e[2];return n<e[0]*e[2]?(s=Math.floor(n/e[0]),a=Math.ceil(e[2]/s),o=s*e[0],i*=a):o=e[0]*e[2],{texDimX:o,texDimY:i,texRows:a,texCols:s,powerOfTwoSize:i<n?n:n*2}}function kR(e,t,r,n,o){let{drawBuffers:i}=n.extensions;if(!i)throw new Error("need WebGL draw buffers");je&&n.timer.mark("calcTextureMeshColorSmoothing");let{gl:a,resources:s,state:l,extensions:{colorBufferHalfFloat:u,textureHalfFloat:c}}=n,m=e.colorType.endsWith("Instance"),d=pt.fromSphere3D(pt(),m?e.boundingSphere:e.invariantBoundingSphere),p=1+t,h=pt.expand(pt(),d,b.create(p,p,p)),f=1/t,g=pt.scale(pt(),h,f),y=pt.size(b(),g);b.ceil(y,y),b.add(y,y,b.create(2,2,2));let{min:x}=h,[S,I,v]=y,{texDimX:A,texDimY:P,texCols:T}=ptt(y);n.namedFramebuffers[Fd]||(n.namedFramebuffers[Fd]=n.resources.framebuffer());let R=n.namedFramebuffers[Fd];Ht(a)?(n.namedTextures[Fd]||(n.namedTextures[Fd]=u&&c?s.texture("image-float16","rgba","fp16","nearest"):s.texture("image-float32","rgba","float","nearest")),n.namedTextures[BR]||(n.namedTextures[BR]=s.texture("image-float32","alpha","float","nearest"))):(n.namedTextures[Fd]||(n.namedTextures[Fd]=s.texture("image-float32","rgba","float","nearest")),n.namedTextures[BR]||(n.namedTextures[BR]=s.texture("image-float32","rgba","float","nearest")));let w=n.namedTextures[Fd],E=n.namedTextures[BR];w.define(A,P),E.define(A,P),w.attachFramebuffer(R,0),E.attachFramebuffer(R,1);let M=att(n,e,h,t,r);l.currentRenderItemId=-1,R.bind(),i.drawBuffers([i.COLOR_ATTACHMENT0,i.COLOR_ATTACHMENT1]);let{uCurrentSlice:D,uCurrentX:B,uCurrentY:k}=M.values;je&&n.timer.mark("ColorAccumulate.render"),ltt(n),l.viewport(0,0,A,P),l.scissor(0,0,A,P),a.clear(a.COLOR_BUFFER_BIT),_.update(k,0);let F=0,z=0,j=0;for(let U=0;U<v;++U)F>=T&&(F-=T,z+=I,j=0,_.update(k,z)),_.update(B,j),_.update(D,U),l.viewport(j,z,S,I),l.scissor(j,z,S,I),M.render(),++F,j+=S;w.detachFramebuffer(R,0),E.detachFramebuffer(R,1),i.drawBuffers([a.COLOR_ATTACHMENT0,a.NONE]),je&&n.timer.markEnd("ColorAccumulate.render"),je&&n.timer.mark("ColorNormalize.render"),(!o||Nye(o))&&(o=s.texture("image-uint8","rgba","ubyte","linear")),o.define(A,P);let Y=ctt(n,w,E);l.currentRenderItemId=-1,dtt(n),o.attachFramebuffer(R,0),l.viewport(0,0,A,P),l.scissor(0,0,A,P),a.clear(a.COLOR_BUFFER_BIT),Y.render(),je&&n.timer.markEnd("ColorNormalize.render");let G=Et.create(x[0],x[1],x[2],f),X=m?"volumeInstance":"volume";return je&&n.timer.markEnd("calcTextureMeshColorSmoothing"),{texture:o,gridDim:y,gridTexDim:Ce.create(A,P),gridTransform:G,type:X}}var LW="color-smoothing-rgb",IA="color-smoothing-rgba",AA="color-smoothing-alpha";function ftt(e){return e==="group"||e==="groupInstance"}function VW(e,t,r,n,o){if(!ftt(e.dColorType.ref.value))return;r*=3,n.namedTextures[LW]||(n.namedTextures[LW]=n.resources.texture("image-uint8","rgb","ubyte","nearest"));let i=n.namedTextures[LW];i.load(e.tColor.ref.value);let a=kR({vertexCount:e.uVertexCount.ref.value,instanceCount:e.uInstanceCount.ref.value,groupCount:e.uGroupCount.ref.value,transformBuffer:e.aTransform.ref.value,instanceBuffer:e.aInstance.ref.value,positionTexture:e.tPosition.ref.value,groupTexture:e.tGroup.ref.value,colorData:i,colorType:e.dColorType.ref.value,boundingSphere:e.boundingSphere.ref.value,invariantBoundingSphere:e.invariantBoundingSphere.ref.value},t,r,n,o);_.updateIfChanged(e.dColorType,a.type),_.update(e.tColorGrid,a.texture),_.update(e.uColorTexDim,a.gridTexDim),_.update(e.uColorGridDim,a.gridDim),_.update(e.uColorGridTransform,a.gridTransform)}function htt(e){return e==="groupInstance"}function e1e(e,t,r,n,o){if(!htt(e.dOverpaintType.ref.value))return;r*=3,n.namedTextures[IA]||(n.namedTextures[IA]=n.resources.texture("image-uint8","rgba","ubyte","nearest"));let i=n.namedTextures[IA];i.load(e.tOverpaint.ref.value);let a=kR({vertexCount:e.uVertexCount.ref.value,instanceCount:e.uInstanceCount.ref.value,groupCount:e.uGroupCount.ref.value,transformBuffer:e.aTransform.ref.value,instanceBuffer:e.aInstance.ref.value,positionTexture:e.tPosition.ref.value,groupTexture:e.tGroup.ref.value,colorData:i,colorType:e.dOverpaintType.ref.value,boundingSphere:e.boundingSphere.ref.value,invariantBoundingSphere:e.invariantBoundingSphere.ref.value},t,r,n,o);_.updateIfChanged(e.dOverpaintType,a.type),_.update(e.tOverpaintGrid,a.texture),_.update(e.uOverpaintTexDim,a.gridTexDim),_.update(e.uOverpaintGridDim,a.gridDim),_.update(e.uOverpaintGridTransform,a.gridTransform)}function gtt(e){return e==="groupInstance"}function t1e(e,t,r,n,o){if(!gtt(e.dTransparencyType.ref.value))return;r*=3,n.namedTextures[AA]||(n.namedTextures[AA]=n.resources.texture("image-uint8","alpha","ubyte","nearest"));let i=n.namedTextures[AA];i.load(e.tTransparency.ref.value);let a=kR({vertexCount:e.uVertexCount.ref.value,instanceCount:e.uInstanceCount.ref.value,groupCount:e.uGroupCount.ref.value,transformBuffer:e.aTransform.ref.value,instanceBuffer:e.aInstance.ref.value,positionTexture:e.tPosition.ref.value,groupTexture:e.tGroup.ref.value,colorData:i,colorType:e.dTransparencyType.ref.value,boundingSphere:e.boundingSphere.ref.value,invariantBoundingSphere:e.invariantBoundingSphere.ref.value},t,r,n,o);_.updateIfChanged(e.dTransparencyType,a.type),_.update(e.tTransparencyGrid,a.texture),_.update(e.uTransparencyTexDim,a.gridTexDim),_.update(e.uTransparencyGridDim,a.gridDim),_.update(e.uTransparencyGridTransform,a.gridTransform)}function ytt(e){return e==="groupInstance"}function r1e(e,t,r,n,o){if(!ytt(e.dEmissiveType.ref.value))return;r*=3,n.namedTextures[AA]||(n.namedTextures[AA]=n.resources.texture("image-uint8","alpha","ubyte","nearest"));let i=n.namedTextures[AA];i.load(e.tEmissive.ref.value);let a=kR({vertexCount:e.uVertexCount.ref.value,instanceCount:e.uInstanceCount.ref.value,groupCount:e.uGroupCount.ref.value,transformBuffer:e.aTransform.ref.value,instanceBuffer:e.aInstance.ref.value,positionTexture:e.tPosition.ref.value,groupTexture:e.tGroup.ref.value,colorData:i,colorType:e.dEmissiveType.ref.value,boundingSphere:e.boundingSphere.ref.value,invariantBoundingSphere:e.invariantBoundingSphere.ref.value},t,r,n,o);_.updateIfChanged(e.dEmissiveType,a.type),_.update(e.tEmissiveGrid,a.texture),_.update(e.uEmissiveTexDim,a.gridTexDim),_.update(e.uEmissiveGridDim,a.gridDim),_.update(e.uEmissiveGridTransform,a.gridTransform)}function btt(e){return e==="groupInstance"}function n1e(e,t,r,n,o){if(!btt(e.dSubstanceType.ref.value))return;r*=3,n.namedTextures[IA]||(n.namedTextures[IA]=n.resources.texture("image-uint8","rgba","ubyte","nearest"));let i=n.namedTextures[IA];i.load(e.tSubstance.ref.value);let a=kR({vertexCount:e.uVertexCount.ref.value,instanceCount:e.uInstanceCount.ref.value,groupCount:e.uGroupCount.ref.value,transformBuffer:e.aTransform.ref.value,instanceBuffer:e.aInstance.ref.value,positionTexture:e.tPosition.ref.value,groupTexture:e.tGroup.ref.value,colorData:i,colorType:e.dSubstanceType.ref.value,boundingSphere:e.boundingSphere.ref.value,invariantBoundingSphere:e.invariantBoundingSphere.ref.value},t,r,n,o);_.updateIfChanged(e.dSubstanceType,a.type),_.update(e.tSubstanceGrid,a.texture),_.update(e.uSubstanceTexDim,a.gridTexDim),_.update(e.uSubstanceGridDim,a.gridDim),_.update(e.uSubstanceGridTransform,a.gridTransform)}var qr;(d=>{function e(p,h){p&&(p.state.visible=h)}d.setVisibility=e;function t(p,h){p&&(p.state.alphaFactor=h)}d.setAlphaFactor=t;function r(p,h){p&&(p.state.pickable=h)}d.setPickable=r;function n(p,h){p&&(p.state.colorOnly=h)}d.setColorOnly=n;function o(p,h,f,g,y){if(!p||Oi(h))return!1;let{tMarker:x,uMarker:S,markerAverage:I,markerStatus:v,uGroupCount:A,instanceCount:P,instanceGranularity:T}=p.values,R=T.ref.value?P.ref.value:A.ref.value*P.ref.value,{array:w}=x.ref.value,E=v.ref.value;if(!xa(h)){let k=0;if(g(h,F=>(k+=ye.size(F),!0),!0),k===0)return!1;k===R&&(h=Mg)}let M=!1,D=-1,B=-1;if(xa(h)){let k=GSe(f,E);k.status!==-1?(M=E!==k.status,M&&OSe(w,k.status,R)):M=PC(w,ye.ofLength(R),f),D=k.average,B=k.status}else M=g(h,k=>PC(w,k,f),!0),M&&(D=USe(f,E),y&&y.status!==-1&&D===-1&&ii.isReverse(y.action,f)&&nr.areEqual(h,y.loci)&&(B=y.status,D=B===0?0:.5));return M&&(D===-1&&(D=u7(w,R),D===0&&(B=0)),y&&(y.action=f,y.loci=h,y.status=E),_.updateIfChanged(S,B),B===-1&&_.update(x,x.ref.value),_.updateIfChanged(I,D),_.updateIfChanged(v,B)),M}d.mark=o;function i(p,h,f,g,y){if(!p)return;let{tOverpaint:x,dOverpaintType:S,dOverpaint:I,uGroupCount:v,instanceCount:A,instanceGranularity:P}=p.values,T=P.ref.value?A.ref.value:v.ref.value*A.ref.value,R=P.ref.value?"instance":"groupInstance";Kye(h.layers.length?T:0,R,p.values);let{array:w}=x.ref.value;g&&I7(w,0,T);for(let E=0,M=h.layers.length;E<M;++E){let{loci:D,color:B,clear:k}=h.layers[E];f(D,z=>{let j=ye.start(z),Y=ye.end(z);return k?I7(w,j,Y):Yye(w,j,Y,B)},!1)}if(_.update(x,x.ref.value),_.updateIfChanged(S,R),_.updateIfChanged(I,h.layers.length>0),h.layers.length!==0&&R!=="instance"&&y&&Om(y.props)){let{geometry:E,props:M,webgl:D}=y;if(E.kind==="mesh"){let{resolution:B,overpaintTexture:k}=E.meta,F=Ou(M.smoothColors,!0,B);F&&(XSe(p.values,F.resolution,F.stride,D,k),E.meta.overpaintTexture=p.values.tOverpaintGrid.ref.value)}else if(D&&E.kind==="texture-mesh"){let{resolution:B,overpaintTexture:k}=E.meta,F=Ou(M.smoothColors,!0,B);F&&(e1e(p.values,F.resolution,F.stride,D,k),E.meta.overpaintTexture=p.values.tOverpaintGrid.ref.value)}}}d.setOverpaint=i;function a(p,h,f,g,y){if(!p)return;let{tTransparency:x,dTransparencyType:S,transparencyAverage:I,transparencyMin:v,dTransparency:A,uGroupCount:P,instanceCount:T,instanceGranularity:R}=p.values,w=R.ref.value?T.ref.value:P.ref.value*T.ref.value,E=R.ref.value?"instance":"groupInstance";tbe(h.layers.length?w:0,E,p.values);let{array:M}=x.ref.value;g&&ebe(M,0,w);for(let D=0,B=h.layers.length;D<B;++D){let{loci:k,value:F}=h.layers[D];f(k,j=>{let Y=ye.start(j),G=ye.end(j);return $ye(M,Y,G,F)},!1)}if(_.update(x,x.ref.value),_.updateIfChanged(I,A7(M,w)),_.updateIfChanged(v,T7(M,w)),_.updateIfChanged(S,E),_.updateIfChanged(A,h.layers.length>0),h.layers.length!==0&&E!=="instance"&&y&&Om(y.props)){let{geometry:D,props:B,webgl:k}=y;if(D.kind==="mesh"){let{resolution:F,transparencyTexture:z}=D.meta,j=Ou(B.smoothColors,!0,F);j&&(QSe(p.values,j.resolution,j.stride,k,z),D.meta.transparencyTexture=p.values.tTransparencyGrid.ref.value)}else if(k&&D.kind==="texture-mesh"){let{resolution:F,transparencyTexture:z}=D.meta,j=Ou(B.smoothColors,!0,F);j&&(t1e(p.values,j.resolution,j.stride,k,z),D.meta.transparencyTexture=p.values.tTransparencyGrid.ref.value)}}}d.setTransparency=a;function s(p,h,f,g,y){if(!p)return;let{tEmissive:x,dEmissiveType:S,emissiveAverage:I,dEmissive:v,uGroupCount:A,instanceCount:P,instanceGranularity:T}=p.values,R=T.ref.value?P.ref.value:A.ref.value*P.ref.value,w=T.ref.value?"instance":"groupInstance";dbe(h.layers.length?R:0,w,p.values);let{array:E}=x.ref.value;g&&mbe(E,0,R);for(let M=0,D=h.layers.length;M<D;++M){let{loci:B,value:k}=h.layers[M];f(B,z=>{let j=ye.start(z),Y=ye.end(z);return cbe(E,j,Y,k)},!1)}if(_.update(x,x.ref.value),_.updateIfChanged(I,_7(E,R)),_.updateIfChanged(S,w),_.updateIfChanged(v,h.layers.length>0),h.layers.length!==0&&w!=="instance"&&y&&Om(y.props)){let{geometry:M,props:D,webgl:B}=y;if(M.kind==="mesh"){let{resolution:k,emissiveTexture:F}=M.meta,z=Ou(D.smoothColors,!0,k);z&&(ZSe(p.values,z.resolution,z.stride,B,F),M.meta.emissiveTexture=p.values.tEmissiveGrid.ref.value)}else if(B&&M.kind==="texture-mesh"){let{resolution:k,emissiveTexture:F}=M.meta,z=Ou(D.smoothColors,!0,k);z&&(r1e(p.values,z.resolution,z.stride,B,F),M.meta.emissiveTexture=p.values.tEmissiveGrid.ref.value)}}}d.setEmissive=s;function l(p,h,f,g,y){if(!p)return;let{tSubstance:x,dSubstanceType:S,dSubstance:I,uGroupCount:v,instanceCount:A,instanceGranularity:P}=p.values,T=P.ref.value?A.ref.value:v.ref.value*A.ref.value,R=P.ref.value?"instance":"groupInstance";lbe(h.layers.length?T:0,R,p.values);let{array:w}=x.ref.value;g&&P7(w,0,T);for(let E=0,M=h.layers.length;E<M;++E){let{loci:D,material:B,clear:k}=h.layers[E];f(D,z=>{let j=ye.start(z),Y=ye.end(z);return k?P7(w,j,Y):sbe(w,j,Y,B)},!1)}if(_.update(x,x.ref.value),_.updateIfChanged(S,R),_.updateIfChanged(I,h.layers.length>0),h.layers.length!==0&&R!=="instance"&&y&&Om(y.props)){let{geometry:E,props:M,webgl:D}=y;if(E.kind==="mesh"){let{resolution:B,substanceTexture:k}=E.meta,F=Ou(M.smoothColors,!0,B);F&&(qSe(p.values,F.resolution,F.stride,D,k),E.meta.substanceTexture=p.values.tSubstanceGrid.ref.value)}else if(D&&E.kind==="texture-mesh"){let{resolution:B,substanceTexture:k}=E.meta,F=Ou(M.smoothColors,!0,B);F&&(n1e(p.values,F.resolution,F.stride,D,k),E.meta.substanceTexture=p.values.tSubstanceGrid.ref.value)}}}d.setSubstance=l;function u(p,h,f,g){if(!p)return;let{tClipping:y,dClippingType:x,dClipping:S,uGroupCount:I,instanceCount:v,instanceGranularity:A}=p.values,P=A.ref.value?v.ref.value:I.ref.value*v.ref.value,{layers:T}=h,R=A.ref.value?"instance":"groupInstance";ibe(T.length?P:0,R,p.values);let{array:w}=y.ref.value;g&&obe(w,0,P);for(let E=0,M=h.layers.length;E<M;++E){let{loci:D,groups:B}=h.layers[E];f(D,F=>{let z=ye.start(F),j=ye.end(F);return nbe(w,z,j,B)},!1)}_.update(y,y.ref.value),_.updateIfChanged(x,R),_.updateIfChanged(S,h.layers.length>0)}d.setClipping=u;function c(p,h){p&&(_.updateIfChanged(p.values.uOverpaintStrength,h.overpaint),_.updateIfChanged(p.values.uTransparencyStrength,h.transparency),_.updateIfChanged(p.values.uEmissiveStrength,h.emissive),_.updateIfChanged(p.values.uSubstanceStrength,h.substance))}d.setThemeStrength=c;function m(p,h,f){if(!p||!h&&!f)return;let{values:g}=p;h&&(H.copy(g.matrix.ref.value,h),_.update(g.matrix,g.matrix.ref.value)),f?(g.extraTransform.ref.value.set(f),_.update(g.extraTransform,g.extraTransform.ref.value)):f===null&&(rA(g.extraTransform.ref.value,g.instanceCount.ref.value),_.update(g.extraTransform,g.extraTransform.ref.value)),v7(g,g.invariantBoundingSphere.ref.value,g.instanceGrid.ref.value.cellSize,g.instanceGrid.ref.value.batchSize);let y=Li(g.invariantBoundingSphere.ref.value,g.transform.ref.value,g.instanceCount.ref.value,0);_.update(g.boundingSphere,y)}d.setTransform=m})(qr||={});function Ci(e,t,r={}){let n=0,o=new Pn,i=Ut.createState(),a=Kc(),s=[],l,u,c=-1,m=Ii.createEmpty(),d=t.Params,p=C.getDefaultValues(d),h,f;r.modifyState&&Ut.updateState(i,r.modifyState(i));let g=kd.create();function y(v={},A){kd.reset(g),!(!A&&!u)&&(A&&!u?g.createNew=!0:A&&u&&A.id===u.id||(A&&u&&A.id!==u.id?(g.updateTransform=!0,g.createGeometry=!0):A&&console.warn("unexpected state")),v.instanceGranularity!==p.instanceGranularity&&(g.updateTransform=!0),g.updateTransform&&(g.updateColor=!0,g.updateSize=!0,g.updateMatrix=!0),g.createGeometry&&(g.updateColor=!0,g.updateSize=!0))}function x(v={},A){return r.modifyProps&&(v=r.modifyProps(v)),Ae.create("ShapeRepresentation.create",async P=>{let T=Object.assign(p,v),R=A?await e(P,A,T,u):void 0;if(y(v,R),R&&(u=R,Object.assign(m,Wr.getTheme(u))),g.createNew){s.length=0,h=Wr.groupIterator(u);let w=Wr.createTransform(u.transforms,u.geometry.boundingSphere,T.cellSize,T.batchSize),E=t.createValues(u.geometry,w,h,m,T),M=t.createRenderableState(T);r.modifyState&&Object.assign(M,r.modifyState(M)),Ut.updateState(i,M),l=Pp(u.geometry.kind,E,M,a),l&&s.push(l),f=t.createPositionIterator(u.geometry,l.values)}else{if(!l)throw new Error("expected renderObject to be available");if(g.updateTransform){h=Wr.groupIterator(u);let{instanceCount:w,groupCount:E}=h;v.instanceGranularity?yo(w,"instance",l.values):yo(w*E,"groupInstance",l.values)}g.updateMatrix&&(Wr.createTransform(u.transforms,u.geometry.boundingSphere,T.cellSize,T.batchSize,l.values),"lodLevels"in l.values&&_.update(l.values.lodLevels,l.values.lodLevels.ref.value)),g.createGeometry&&(_.updateIfChanged(l.values.drawCount,ba.getDrawCount(u.geometry)),_.updateIfChanged(l.values.uVertexCount,ba.getVertexCount(u.geometry)),_.updateIfChanged(l.values.uGroupCount,h.groupCount)),g.updateColor&&ya(h,f,m.color,l.values),g.updateSize&&"uSize"in l.values&&eu(h,m.size,l.values),t.updateValues(l.values,T),t.updateRenderableState(l.state,T),(g.updateTransform||g.createGeometry)&&(t.updateBoundingSphere(l.values,u.geometry),f=t.createPositionIterator(u.geometry,l.values))}p=T,(g.createGeometry||g.createNew)&&(c+=1),o.next(n++)})}function S(v,A,P){let T=!1;if(!al.isLoci(v)||al.isLociEmpty(v)||v.shape!==A)return!1;for(let R of v.groups)P(ye.ofSingleton(R.instance))&&(T=!0);return T}function I(v,A){return xa(v)||Wr.isLoci(v)&&v.shape===u?p.instanceGranularity?A(ye.ofBounds(0,u.transforms.length)):A(ye.ofBounds(0,u.groupCount*u.transforms.length)):p.instanceGranularity?S(v,u,A):xtt(v,u,A)}return{label:"Shape geometry",get groupCount(){return h?h.count:0},get props(){return p},get params(){return d},get state(){return i},get theme(){return m},renderObjects:s,get geometryVersion(){return c},updated:o,createOrUpdate:x,getLoci(v){let{objectId:A,groupId:P,instanceId:T}=v;return l&&l.id===A?P===vi.Null?Wr.Loci(u):al.Loci(u,[{ids:xe.ofSingleton(P),instance:T}]):vr},getAllLoci(){return[Wr.Loci(u)]},eachLocation:v=>{for(h.reset();h.hasNext;){let{location:A,isSecondary:P}=h.move();v(A,P)}},mark(v,A){if(!ii.is(i.markerActions,A))return!1;if(al.isLoci(v)||Wr.isLoci(v)){if(v.shape!==u)return!1}else if(!xa(v))return!1;return qr.mark(l,v,A,I)},setState(v){r.modifyState&&(v=r.modifyState(v)),l&&(v.visible!==void 0&&qr.setVisibility(l,v.visible),v.alphaFactor!==void 0&&qr.setAlphaFactor(l,v.alphaFactor),v.pickable!==void 0&&qr.setPickable(l,v.pickable),v.colorOnly!==void 0&&qr.setColorOnly(l,v.colorOnly),v.overpaint!==void 0&&qr.setOverpaint(l,v.overpaint,I,!0),v.transparency!==void 0&&qr.setTransparency(l,v.transparency,I,!0),v.substance!==void 0&&qr.setSubstance(l,v.substance,I,!0),v.transform!==void 0&&qr.setTransform(l,v.transform)),Ut.updateState(i,v)},setTheme(v){Yt&&console.warn("The `ShapeRepresentation` theme is fixed to `ShapeGroupColorTheme` and `ShapeGroupSizeTheme`. Colors are taken from `Shape.getColor` and sizes from `Shape.getSize`")},destroy(){s.length=0,l&&(l.state.disposed=!0,l=void 0)}}}function xtt(e,t,r){if(!al.isLoci(e)||e.shape!==t)return!1;let n=!1,{groupCount:o}=t,{groups:i}=e;for(let{ids:a,instance:s}of i)if(ye.is(a)){let l=s*o+ye.start(a),u=s*o+ye.end(a);r(ye.ofBounds(l,u))&&(n=!0)}else for(let l=0,u=a.length;l<u;l++){let c=s*o+a[l];r(ye.ofSingleton(c))&&(n=!0)}return n}var o1e=H(),bb=class{constructor(t){this.structure=t;this.groupUnitTransforms=[];this.unitOffsetMap=Mu.Mutable();this.groupIndexMap=new Map;this._isIdentity=void 0;this.version=0;this.unitTransforms=new Float32Array(t.units.length*16),this.size=t.units.length,this.reset();let r=0;for(let n=0,o=t.unitSymmetryGroups.length;n<o;++n){let i=t.unitSymmetryGroups[n];this.groupIndexMap.set(i,n);let a=this.unitTransforms.subarray(r,r+i.units.length*16);this.groupUnitTransforms.push(a);for(let s=0,l=i.units.length;s<l;++s)this.unitOffsetMap.set(i.units[s].id,r+s*16);r+=i.units.length*16}}reset(){this.version=0,rA(this.unitTransforms,this.size),this._isIdentity=!0}get isIdentity(){if(this._isIdentity===void 0){this._isIdentity=!0;for(let t=0,r=this.size*16;t<r;t+=16)if(H.fromArray(o1e,this.unitTransforms,t),!H.isIdentity(o1e)){this._isIdentity=!1;break}}return this._isIdentity}setTransform(t,r){this.version=(this.version+1)%2147483647,H.toArray(t,this.unitTransforms,this.unitOffsetMap.get(r.id)),this._isIdentity=void 0}getTransform(t,r){return H.fromArray(t,this.unitTransforms,this.unitOffsetMap.get(r.id))}getSymmetryGroupTransforms(t){return this.groupUnitTransforms[this.groupIndexMap.get(t)]}};var i1e=H();function OW(e,t,r){for(let n=0,o=e.units.length;n<o;n++){let i=e.units[n];Jn.lerpFromIdentity(i1e,i.conformation.operator,r),t.setTransform(i1e,i)}}var a1e=b(),TA=b(),zF=H();function GW(e,t,r,n){let o=n.radius*r;for(let i=0,a=e.units.length;i<a;i++){let s=e.units[i];b.transformMat4(a1e,s.lookup3d.boundary.sphere.center,s.conformation.operator.matrix),b.sub(TA,a1e,n.center),b.setMagnitude(TA,TA,o),H.fromTranslation(zF,TA),t.setTransform(zF,s)}}var u1e={axis:C.MappedStatic("custom",{structure:C.Group({principalAxis:C.Select("dirA",[["dirA","A"],["dirB","B"],["dirC","C"]])}),custom:C.Group({vector:C.Vec3(b.create(0,0,1))})}),origin:C.MappedStatic("structure",{structure:C.Group({}),custom:C.Group({vector:C.Vec3(b.create(0,0,0))})})};function UW(e,t){let r,n;return t.axis.name==="custom"?r=t.axis.params.vector:r=De.getPrincipalAxes(e).momentsAxes[t.axis.params.principalAxis],t.origin.name==="custom"?n=t.origin.params.vector:n=De.getPrincipalAxes(e).momentsAxes.origin,{axis:r,origin:n}}var s1e=H(),l1e=H(),NF=H();function NW(e,t,r,n,o){for(let i=0,a=e.units.length;i<a;i++){let s=e.units[i];b.negate(TA,o),H.fromTranslation(zF,TA),H.fromRotation(s1e,Math.PI*r*2,n),H.fromTranslation(l1e,o),H.mul(NF,s1e,zF),H.mul(NF,l1e,NF),t.setTransform(NF,s)}}function as(e,t){return{kind:e,layers:t}}(u=>{u.Empty={kind:"empty-loci",layers:[]};function t(c,m){if(c.layers.length===0&&m.layers.length===0)return!0;if(c.layers.length!==m.layers.length)return!1;for(let d=0,p=c.layers.length;d<p;++d)if(c.layers[d].clear!==m.layers[d].clear||c.layers[d].color!==m.layers[d].color||!nr.areEqual(c.layers[d].loci,m.layers[d].loci))return!1;return!0}u.areEqual=t;function r(c){return c.layers.length===0}u.isEmpty=r;function n(c,m){if(c.kind==="element-loci"){let d=[];for(let p of c.layers){let{loci:h,color:f,clear:g}=p;h=Q.Loci.remap(h,m),Q.Loci.isEmpty(h)||d.push({loci:h,color:f,clear:g})}return{kind:"element-loci",layers:d}}else return c}u.remap=n;function o(c){if(r(c))return c;if(c.kind==="element-loci"){let{structure:m}=c.layers[0].loci,d=new Map,p=Q.Loci.none(m);for(let f=0,g=c.layers.length;f<g;++f){let{loci:y,color:x,clear:S}=c.layers[g-f-1];if(y=Q.Loci.subtract(y,p),p=Q.Loci.union(y,p),!Q.Loci.isEmpty(y)){let I=S?-1:x;d.has(I)&&(y=Q.Loci.union(y,d.get(I))),d.set(I,y)}}let h=[];return d.forEach((f,g)=>{let y=g===-1,x=y?0:g;h.push({loci:f,color:x,clear:y})}),{kind:"element-loci",layers:h}}else return c}u.merge=o;function i(c,m){if(r(c))return c;if(c.kind==="element-loci"){let{structure:d}=c.layers[0].loci,p=[];for(let h of c.layers){let{loci:f,color:g,clear:y}=h,x=Q.Loci.remap(f,m);f=Q.Loci.remap(x,d),Q.Loci.isEmpty(f)||p.push({loci:f,color:g,clear:y})}return{kind:"element-loci",layers:p}}else return c}u.filter=i;function a(c,m){let d=[];for(let p=0,h=c.length;p<h;++p){let{script:f,color:g,clear:y}=c[p],x=Mo.toLoci(f,m);Q.Loci.isEmpty(x)||d.push({loci:x,color:g,clear:y})}return{kind:"element-loci",layers:d}}u.ofScript=a;function s(c,m){let d=[];for(let p=0,h=c.length;p<h;++p){let{bundle:f,color:g,clear:y}=c[p],x=Q.Bundle.toLoci(f,m.root);d.push({loci:x,color:g,clear:y})}return{kind:"element-loci",layers:d}}u.ofBundle=s;function l(c){let m=[];for(let d=0,p=c.layers.length;d<p;++d){let{loci:h,color:f,clear:g}=c.layers[d],y=Q.Bundle.fromLoci(h);m.push({bundle:y,color:f,clear:g})}return{kind:"element-loci",layers:m}}u.toBundle=l})(as||={});function ss(e,t){return{kind:e,layers:t}}(u=>{u.Empty={kind:"empty-loci",layers:[]};function t(c,m){if(c.layers.length===0&&m.layers.length===0)return!0;if(c.layers.length!==m.layers.length)return!1;for(let d=0,p=c.layers.length;d<p;++d)if(c.layers[d].value!==m.layers[d].value||!nr.areEqual(c.layers[d].loci,m.layers[d].loci))return!1;return!0}u.areEqual=t;function r(c){return c.layers.length===0}u.isEmpty=r;function n(c,m){if(c.kind==="element-loci"){let d=[];for(let p of c.layers){let h=Q.Loci.remap(p.loci,m);Q.Loci.isEmpty(h)||d.push({loci:h,value:p.value})}return{kind:"element-loci",layers:d}}else return c}u.remap=n;function o(c){if(r(c))return c;if(c.kind==="element-loci"){let{structure:m}=c.layers[0].loci,d=new Map,p=Q.Loci.none(m);for(let f=0,g=c.layers.length;f<g;++f){let{loci:y,value:x}=c.layers[g-f-1];y=Q.Loci.subtract(y,p),p=Q.Loci.union(y,p),Q.Loci.isEmpty(y)||(d.has(x)&&(y=Q.Loci.union(y,d.get(x))),d.set(x,y))}let h=[];return d.forEach((f,g)=>{h.push({loci:f,value:g})}),{kind:"element-loci",layers:h}}else return c}u.merge=o;function i(c,m){if(r(c))return c;if(c.kind==="element-loci"){let{structure:d}=c.layers[0].loci,p=[];for(let h of c.layers){let{loci:f,value:g}=h,y=Q.Loci.remap(f,m);f=Q.Loci.remap(y,d),Q.Loci.isEmpty(f)||p.push({loci:f,value:g})}return{kind:"element-loci",layers:p}}else return c}u.filter=i;function a(c,m){let d=[];for(let p=0,h=c.length;p<h;++p){let{script:f,value:g}=c[p],y=Mo.toLoci(f,m);Q.Loci.isEmpty(y)||d.push({loci:y,value:g})}return{kind:"element-loci",layers:d}}u.ofScript=a;function s(c,m){let d=[];for(let p=0,h=c.length;p<h;++p){let{bundle:f,value:g}=c[p],y=Q.Bundle.toLoci(f,m.root);d.push({loci:y,value:g})}return{kind:"element-loci",layers:d}}u.ofBundle=s;function l(c){let m=[];for(let d=0,p=c.layers.length;d<p;++d){let{loci:h,value:f}=c.layers[d],g=Q.Bundle.fromLoci(h);m.push({bundle:g,value:f})}return{kind:"element-loci",layers:m}}u.toBundle=l})(ss||={});var Ctt=H.fromTranslation(H(),b.create(.5,.5,.5)),Stt=L7(F7(QS()),Ctt),rh=b(),c1e=H(),vtt={origin:"Origin",model:"Model"},Itt={corner:"Corner",center:"Center"},Att={...ft.Params,cellColor:C.Color(Lt.orange),cellScale:C.Numeric(2,{min:.1,max:5,step:.1}),ref:C.Select("model",C.objectToOptions(vtt),{isEssential:!0}),attachment:C.Select("corner",C.objectToOptions(Itt),{isEssential:!0})},Ttt={mesh:(e,t)=>Ci(_tt,ft.Utils)},zW={...Att};function Ptt(e,t,r){let n=tt.createState(256,128,r),{fromFractional:o}=e.symmetry.spacegroup.cell;b.copy(rh,e.ref),t.attachment==="center"?(b.trunc(rh,rh),b.subScalar(rh,rh,.5)):b.floor(rh,rh),H.fromTranslation(c1e,rh);let i=L7(F7(Stt),c1e),a=Math.cbrt(e.symmetry.spacegroup.cell.volume)/300*t.cellScale;n.currentGroup=1,tt.addCage(n,o,i,a,2,20);let s=he.fromDimensionsAndTransform(he(),b.unit,o);b.transformMat4(rh,rh,o),he.translate(s,s,rh),he.expand(s,s,a);let l=tt.getMesh(n);return l.setBoundingSphere(s),l}function _tt(e,t,r,n){let o=Ptt(t,r,n&&n.geometry),i=aC.getUnitcellLabel(t.symmetry);return Wr.create(i,t,o,()=>r.cellColor,()=>1,()=>i)}function HW(e,t,r){let n=b();return r.ref==="model"&&b.transformMat4(n,Gt.getCenter(e),t.spacegroup.cell.toFractional),{symmetry:t,ref:n}}function m1e(e,t){return Ut.createMulti("Unit Cell",e,t,Ut.StateBuilder,Ttt)}var Up=new Uint16Array([0,1,2,1,3,2]),t1=qe.add3,du=qe.add2,d1e=qe.add,Ws;(t=>{function e(r={},n=2048,o=1024,i){n*=2,o*=2;let a=qe.create(Float32Array,3,o,i?i.centerBuffer.ref.value:n),s=qe.create(Float32Array,2,o,i?i.mappingBuffer.ref.value:n),l=qe.create(Float32Array,1,o,i?i.depthBuffer.ref.value:n),u=qe.create(Uint32Array,3,o,i?i.indexBuffer.ref.value:n),c=qe.create(Float32Array,1,o,i?i.groupBuffer.ref.value:n),m=qe.create(Float32Array,2,o,i?i.tcoordBuffer.ref.value:n),d={...C.getDefaultValues(na.Params),...r},{attachment:p,background:h,backgroundMargin:f,tether:g,tetherLength:y,tetherBaseWidth:x}=d,S=xbe(d),I=1/2.5*f,v=S.buffer/S.lineHeight,A=(P,T,R,w,E)=>{t1(a,P,T,R),d1e(l,w),d1e(c,E)};return{add:(P,T,R,w,E,M,D)=>{let B=0,k=P.length;for(let q=0;q<k;++q){let te=S.get(P[q]);B+=te.nw-2*v}let F=1/1.25,z,j;if(p.startsWith("top")?z=F:p.startsWith("middle")?z=F/2:z=0,p.endsWith("right")?j=B:p.endsWith("center")?j=B/2:j=0,g)switch(p){case"bottom-left":j-=y/2+I+.1,z-=y/2+I;break;case"bottom-center":z-=y+I;break;case"bottom-right":j+=y/2+I+.1,z-=y/2+I;break;case"middle-left":j-=y+I+.1;break;case"middle-center":break;case"middle-right":j+=y+I+.1;break;case"top-left":j-=y/2+I+.1,z+=y/2+I;break;case"top-center":z+=y+I;break;case"top-right":j+=y/2+I+.1,z+=y/2+I;break}let Y=(-j-I-.1)*M,G=(B-j+I+.1)*M,X=(F-z+I)*M,U=(-z-I)*M;if(h){du(s,Y,X),du(s,Y,U),du(s,G,X),du(s,G,U);let q=a.elementCount;for(let te=0;te<4;++te)du(m,10,10),A(T,R,w,E,D);t1(u,q+Up[0],q+Up[1],q+Up[2]),t1(u,q+Up[3],q+Up[4],q+Up[5])}if(g){let q,te,J,ee,ce,fe,O,V,Z=y*M,pe=x*M;switch(p){case"bottom-left":q=Y-Z/2,J=Y+pe/2,ce=Y,O=Y,te=U-Z/2,ee=U,fe=U+pe/2,V=U;break;case"bottom-center":q=0,J=pe/2,ce=-pe/2,O=0,te=U-Z,ee=U,fe=U,V=U;break;case"bottom-right":q=G+Z/2,J=G,ce=G-pe/2,O=G,te=U-Z/2,ee=U+pe/2,fe=U,V=U;break;case"middle-left":q=Y-Z,J=Y,ce=Y,O=Y,te=0,ee=-pe/2,fe=pe/2,V=0;break;case"middle-center":q=0,J=0,ce=0,O=0,te=0,ee=0,fe=0,V=0;break;case"middle-right":q=G+Z,J=G,ce=G,O=G,te=0,ee=pe/2,fe=-pe/2,V=0;break;case"top-left":q=Y-Z/2,J=Y+pe/2,ce=Y,O=Y,te=X+Z/2,ee=X,fe=X-pe/2,V=X;break;case"top-center":q=0,J=pe/2,ce=-pe/2,O=0,te=X+Z,ee=X,fe=X,V=X;break;case"top-right":q=G+Z/2,J=G,ce=G-pe/2,O=G,te=X+Z/2,ee=X-pe/2,fe=X,V=X;break;default:Mr(p)}du(s,q,te),du(s,J,ee),du(s,ce,fe),du(s,O,V);let $=a.elementCount;for(let ae=0;ae<4;++ae)du(m,10,10),A(T,R,w,E,D);t1(u,$,$+1,$+3),t1(u,$,$+3,$+2)}j+=v,z+=v;let L=0;for(let q=0;q<k;++q){let te=S.get(P[q]),J=(L-j)*M,ee=(L+te.nw-j)*M,ce=(te.nh-z)*M,fe=-z*M;du(s,J,ce),du(s,J,fe),du(s,ee,ce),du(s,ee,fe);let O=S.texture.width,V=S.texture.height;du(m,te.x/O,te.y/V),du(m,te.x/O,(te.y+te.h)/V),du(m,(te.x+te.w)/O,te.y/V),du(m,(te.x+te.w)/O,(te.y+te.h)/V),L+=te.nw-2*v;let Z=a.elementCount;for(let pe=0;pe<4;++pe)A(T,R,w,E,D);t1(u,Z+Up[0],Z+Up[1],Z+Up[2]),t1(u,Z+Up[3],Z+Up[4],Z+Up[5])}},getText:()=>{let P=S.texture,T=qe.compact(a,!0),R=qe.compact(s,!0),w=qe.compact(l,!0),E=qe.compact(u,!0),M=qe.compact(c,!0),D=qe.compact(m,!0);return na.create(P,T,R,w,E,M,D,u.elementCount/2,i)}}}t.create=e})(Ws||={});var _A={granularity:"element",condensed:!1,reverse:!1,countsOnly:!1,hidePrefix:!1,htmlStyling:!0};function Np(e,t={}){switch(e.kind){case"structure-loci":return e.structure.models.map(d=>d.entry).filter(d=>!!d).join(", ");case"element-loci":return r1(Q.Stats.ofLoci(e),t);case"bond-loci":let r=e.bonds[0];return r?LR(r,t):"";case"shape-loci":return e.shape.name;case"group-loci":let n=e.groups[0];return n?e.shape.getLabel(xe.start(n.ids),n.instance):"";case"every-loci":return"Everything";case"empty-loci":return"Nothing";case"data-loci":return e.getLabel();case"volume-loci":return e.volume.label||"Volume";case"isosurface-loci":return[`${e.volume.label||"Volume"}`,`Isosurface at ${Ge.IsoValue.toString(e.isoValue)}`].join(" | ");case"cell-loci":let o=Ge.Cell.getLociSize(e),i=xe.start(e.elements[0].indices),a=Ge.IsoValue.absolute(e.volume.grid.cells.data[i]),s=Ge.IsoValue.toRelative(a,e.volume.grid.stats),l=[`${e.volume.label||"Volume"}`,`${o===1?`Cell #${i}`:`${o} Cells`}`];return o===1&&(e.volume.instances.length>1&&l.push(`Instance #${xe.start(e.elements[0].instances)+1}`),l.push(`${Ge.IsoValue.toString(a)} (${Ge.IsoValue.toString(s)})`)),l.join(" | ");case"segment-loci":let u=Ge.Segment.getLociSize(e),c=Ge.Segmentation.get(e.volume)?.labels,m=xe.start(e.elements[0].segments);if(c&&u===1){let d=c[m];if(d)return d}return[`${e.volume.label||"Volume"}`,`${u===1?`Segment ${m}`:`${u} Segments`}`].join(" | ")}}function PA(e,t){return e===1?`1 ${t}`:`${e} ${t}s`}function FR(e,t,r,n,o,i){return`${Ld(t,{granularity:r,hidePrefix:n,reverse:o,condensed:i})} <small>[+ ${PA(e-1,`other ${Sm(r)}`)}]</small>`}function Rtt(e){let{elements:t,model:r}=e,{chainAtomSegments:n,residueAtomSegments:o}=r.atomicHierarchy,i=n.offsets[n.index[t[0]]],a=n.offsets[n.index[t[t.length-1]]+1]-1;return o.index[a]-o.index[i]+1}function r1(e,t={}){let r={..._A,...t},n=Dtt(e,r.countsOnly,r.hidePrefix,r.condensed,r.reverse);return r.htmlStyling?n:ud(n)}function RC(e,t={}){let r=Q.Stats.create();for(let n of e)Q.Stats.add(r,r,Q.Stats.ofLoci(n));return r1(r,t)}function Dtt(e,t=!1,r=!1,n=!1,o=!1){let{structureCount:i,chainCount:a,residueCount:s,conformationCount:l,elementCount:u}=e;if(!t&&u===1&&s===0&&a===0)return Ld(e.firstElementLoc,{hidePrefix:r,condensed:n,granularity:"element",reverse:o});if(!t&&u===0&&s===1&&a===0)return Ld(e.firstResidueLoc,{hidePrefix:r,condensed:n,granularity:"residue",reverse:o});if(!t&&u===0&&s===0&&a===1){let{unit:c}=e.firstChainLoc,m=ue.isAtomic(c)&&Rtt(c)===1||ue.Traits.is(c.traits,ue.Trait.MultiChain)?"residue":"chain";return Ld(e.firstChainLoc,{hidePrefix:r,condensed:n,granularity:m,reverse:o})}else if(t){let c=[];return i>0&&c.push(PA(i,"Structure")),a>0&&c.push(PA(a,"Chain")),s>0&&c.push(PA(s,"Residue")),l>0&&c.push(PA(l,"Conformation")),u>0&&c.push(PA(u,"Element")),c.join("<small> + </small>")}else{let c=[];return i>0&&c.push(i===1?Ld(e.firstStructureLoc,{hidePrefix:r,condensed:n,granularity:"structure",reverse:o}):FR(i,e.firstStructureLoc,"structure",r,o,n)),a>0&&(c.push(a===1?Ld(e.firstChainLoc,{condensed:n,granularity:"chain",hidePrefix:r,reverse:o}):FR(a,e.firstChainLoc,"chain",r,o,n)),r=!0),s>0&&(c.push(s===1?Ld(e.firstResidueLoc,{condensed:n,granularity:"residue",hidePrefix:r,reverse:o}):FR(s,e.firstResidueLoc,"residue",r,o,n)),r=!0),l>0&&(c.push(l===1?Ld(e.firstConformationLoc,{condensed:n,granularity:"conformation",hidePrefix:r,reverse:o}):FR(l,e.firstConformationLoc,"conformation",r,o,n)),r=!0),u>0&&c.push(u===1?Ld(e.firstElementLoc,{condensed:n,granularity:"element",hidePrefix:r,reverse:o}):FR(u,e.firstElementLoc,"element",r,o,n)),c.join("<small> + </small>")}}function LR(e,t={}){return HF({loci:[Q.Loci(e.aStructure,[{unit:e.aUnit,indices:xe.ofSingleton(e.aIndex)}]),Q.Loci(e.bStructure,[{unit:e.bUnit,indices:xe.ofSingleton(e.bIndex)}])]},t)}function HF(e,t={}){let r={..._A,...t},n=wtt(e,r);return r.htmlStyling?n:ud(n)}function wtt(e,t){let{granularity:r,hidePrefix:n,reverse:o,condensed:i}=t,a=!0;for(let s of e.loci)if(!Q.Loci.is(s)||Q.Loci.size(s)!==1){a=!1;break}if(a){let l=e.loci.map(c=>{let{unit:m,indices:d}=c.elements[0];return Q.Location.create(c.structure,m,m.elements[xe.start(d)])}).map(c=>p1e(c,r,n,o||i));if(i)return l.map(c=>c[0].replace(/\[.*\]/g,"").trim()).filter(c=>!!c).join(" \u2014 ");let u=0;for(let c=0,m=Math.min(...l.map(d=>d.length))-1;c<m;++c){let d=!0;for(let p=1,h=l.length;p<h;++p)if(l[0][c]!==l[p][c]){d=!1;break}if(d)u+=1;else break}if(u>0){let c=[l[0].join(" | ")];for(let m=1,d=l.length;m<d;++m)c.push(l[m].slice(u).filter(p=>!!p).join(" | "));return c.join(" \u2014 ")}else return l.map(c=>c.filter(m=>!!m).join(" | ")).filter(c=>!!c).join("</br>")}else return e.loci.map(l=>Np(l,t)).filter(l=>!!l).join(i?" \u2014 ":"</br>")}function Ld(e,t={}){let r={..._A,...t},n=p1e(e,r.granularity,r.hidePrefix,r.reverse||r.condensed),o=r.condensed?n[0]?.replace(/\[.*\]/g,"").trim()??"":n.filter(i=>!!i).join(" | ");return r.htmlStyling?o:ud(o)}function p1e(e,t="element",r=!1,n=!1){let o=[];if(!r){let i=e.unit.model.entry;i.length>30&&(i=i.substr(0,27)+"\u2026"),o.push(`<small>${i}</small>`),t!=="structure"&&(o.push(`<small>Model ${e.unit.model.modelNum}</small>`),o.push(`<small>Instance ${e.unit.conformation.operator.instanceId}</small>`))}return ue.isAtomic(e.unit)?o.push(...Mtt(e,t,n)):ue.isCoarse(e.unit)?o.push(...Btt(e,t)):o.push("Unknown"),n?o.reverse():o}function Mtt(e,t,r=!1){let n=Q.Location.residueIndex(e),o=Ke.chain.label_asym_id(e),i=Ke.chain.auth_asym_id(e),a=e.unit.model.atomicHierarchy.residues.label_seq_id.valueKind(n)===W.ValueKinds.Present,s=Ke.residue.label_seq_id(e),l=Ke.residue.auth_seq_id(e),u=Ke.residue.pdbx_PDB_ins_code(e),c=Ke.atom.label_comp_id(e),m=Ke.atom.label_atom_id(e),d=Ke.atom.label_alt_id(e),p=Ke.atom.occupancy(e),h=Ke.atom.sourceIndex(e),f=Ke.residue.microheterogeneityCompIds(e),g=t==="residue"&&f.length>1?`(${f.join("|")})`:c,y=[];switch(t){case"element":{let S=`<b>${m}</b>${d?`%${d}`:""}`,I=`<small style='margin-left: 4px'>[idx <b>${h+1}</b>]</small>`;y.push(`${S}${I}`)}case"conformation":t==="conformation"&&d&&y.push(`<small>Conformation</small> <b>${d}</b>`);case"residue":let x=s===l||!a?l:s;y.push(`<b>${g} ${x}</b>${x!==l?` <small>[auth</small> <b>${l}</b><small>]</small>`:""}<b>${u||""}</b>`);case"chain":o===i?y.push(`<b>${o}</b>`):t==="chain"&&ue.Traits.is(e.unit.traits,ue.Trait.MultiChain)?y.push(`<small>[auth</small> <b>${i}</b><small>]</small>`):y.push(`<b>${o}</b> <small>[auth</small> <b>${i}</b><small>]</small>`)}return y.length>0&&p!==1&&!r&&(y[0]=`${y[0]} <small>[occupancy</small> <b>${Math.round(100*p)/100}</b><small>]</small>`),y.reverse()}function Btt(e,t){let r=Ke.coarse.asym_id(e),n=Ke.coarse.seq_id_begin(e),o=Ke.coarse.seq_id_end(e),i=[];switch(t){case"element":case"conformation":case"residue":if(n===o){let a=Ke.coarse.entityKey(e),l=e.unit.model.sequence.byEntityKey[a].sequence.compId.value(n-1);i.push(`<b>${l} ${n}</b>`)}else i.push(`<b>${n}-${o}</b>`);case"chain":i.push(`<b>${r}</b>`)}return i.reverse()}function RA(e,t={}){let r={..._A,measureOnly:!1,unitLabel:"\u212B",...t},[n,o]=e.loci.map(s=>nr.getCenter(s)),i=`${b.distance(n,o).toFixed(2)} ${r.unitLabel}`;if(r.measureOnly)return i;let a=HF(e,r);return r.condensed?`${i} | ${a}`:`Distance ${i}</br>${a}`}function DA(e,t={}){let r={..._A,measureOnly:!1,...t},[n,o,i]=e.loci.map(c=>nr.getCenter(c)),a=b.sub(b(),n,o),s=b.sub(b(),i,o),l=`${Ya(b.angle(a,s)).toFixed(2)}\xB0`;if(r.measureOnly)return l;let u=HF(e,r);return r.condensed?`${l} | ${u}`:`Angle ${l}</br>${u}`}function wA(e,t={}){let r={..._A,measureOnly:!1,...t},[n,o,i,a]=e.loci.map(u=>nr.getCenter(u)),s=`${Ya(b.dihedralAngle(n,o,i,a)).toFixed(2)}\xB0`;if(r.measureOnly)return s;let l=HF(e,r);return r.condensed?`${s} | ${l}`:`Dihedral ${s}</br>${l}`}var jW={customText:C.Text("",{label:"Text",description:"Override the label with custom value.",isEssential:!0}),textColor:C.Color(Lt.black,{isEssential:!0}),textSize:C.Numeric(.5,{min:.1,max:10,step:.1},{isEssential:!0})},DC={...na.Params,...jW,borderWidth:C.Numeric(.2,{min:0,max:.5,step:.01})};var f1e={unitLabel:C.Text("\u212B",{isEssential:!0})},Ett={...Cn.Params,...f1e,lineSizeAttenuation:C.Boolean(!0),linesColor:C.Color(Lt.lightgreen,{isEssential:!0}),linesSize:C.Numeric(.075,{min:.01,max:5,step:.01}),dashLength:C.Numeric(.2,{min:.01,max:.2,step:.01})},ktt={...DC,...f1e},h1e={lines:(e,t)=>Ci(Vtt,Cn.Utils,{modifyState:r=>({...r,markerActions:ii.Highlighting})}),text:(e,t)=>Ci(Gtt,na.Utils,{modifyState:r=>({...r,markerActions:0})})},WW={...Ett,...ktt,visuals:C.MultiSelect(["lines","text"],C.objectToOptions(h1e))};function Ftt(){return{sphereA:he(),sphereB:he(),center:b(),distance:0}}function g1e(e,t){let{sphereA:r,sphereB:n,center:o}=t,[i,a]=e.loci;return nr.getBoundingSphere(i,r),nr.getBoundingSphere(a,n),b.add(o,r.center,n.center),b.scale(o,o,.5),t.distance=b.distance(r.center,n.center),t}var VR=Ftt();function y1e(e,t){return e.pairs.length===1?`Distance ${RA(e.pairs[0],{unitLabel:t,measureOnly:!0})}`:`${e.pairs.length} Distances`}function Ltt(e,t,r){let n=ns.create(128,64,r);for(let o=0,i=e.pairs.length;o<i;++o)g1e(e.pairs[o],VR),n.addFixedLengthDashes(VR.sphereA.center,VR.sphereB.center,t.dashLength,o);return n.getLines()}function Vtt(e,t,r,n){let o=Ltt(t,r,n&&n.geometry),i=y1e(t,r.unitLabel),a=s=>RA(t.pairs[s],r);return Wr.create(i,t,o,()=>r.linesColor,()=>r.linesSize,a)}function Ott(e,t,r){let n=Ws.create(t,128,64,r);for(let o=0,i=e.pairs.length;o<i;++o){g1e(e.pairs[o],VR);let{center:a,distance:s,sphereA:l,sphereB:u}=VR,c=t.customText||`${s.toFixed(2)} ${t.unitLabel}`,d=Math.max(2,l.radius,u.radius)/2;n.add(c,a[0],a[1],a[2],1,d,o)}return n.getText()}function Gtt(e,t,r,n){let o=Ott(t,r,n&&n.geometry),i=y1e(t,r.unitLabel),a=s=>RA(t.pairs[s],r);return Wr.create(i,t,o,()=>r.textColor,()=>r.textSize,a)}function b1e(e,t){return Ut.createMulti("Distance",e,t,Ut.StateBuilder,h1e)}var Utt={...DC},x1e={text:(e,t)=>Ci(jtt,na.Utils)},XW={...Utt,scaleByRadius:C.Boolean(!0),visuals:C.MultiSelect(["text"],C.objectToOptions(x1e)),snapshotKey:C.Text("",{isEssential:!0,disableInteractiveUpdates:!0,description:"Activate the snapshot with the provided key when clicking on the label"}),tooltip:C.Text("",{isEssential:!0,multiline:!0,disableInteractiveUpdates:!0,placeholder:"Tooltip",description:"Tooltip text to be displayed when hovering over the label"})},Ntt=he();function QW(e,t=!1){return e.label||Np(e.loci,{hidePrefix:!0,htmlStyling:!1,condensed:t})}function ztt(e){return e.infos.length===1?QW(e.infos[0]):`${e.infos.length} Labels`}function Htt(e,t,r){let n=Ws.create(t,128,64,r),o=t.customText.trim();for(let i=0,a=e.infos.length;i<a;++i){let s=e.infos[i],l=nr.getBoundingSphere(s.loci,Ntt);if(!l)continue;let{center:u,radius:c}=l,m=o||QW(s,!0);n.add(m,u[0],u[1],u[2],t.scaleByRadius?c/.9:0,t.scaleByRadius?Math.max(1,c):1,i)}return n.getText()}function jtt(e,t,r,n){let o=Htt(t,r,n&&n.geometry),i=ztt(t),a=r.tooltip?.trim()??"",s=r.customText.trim(),l;return a?l=u=>a:s?l=u=>s:l=u=>QW(t.infos[u]),Wr.create(i,t,o,()=>r.textColor,()=>r.textSize,l)}function C1e(e,t){return Ut.createMulti("Label",e,t,Ut.StateBuilder,x1e)}var n1=b(),Wtt=H.identity(),o1=new Float32Array(18),Xtt=new Uint8Array([0,1,2,3,4,5]);function S1e(e,t,r,n,o){let{origin:i,dirA:a,dirB:s,dirC:l}=t;b.add(n1,i,a),b.toArray(b.add(n1,i,a),o1,0),b.toArray(b.sub(n1,i,a),o1,3),b.toArray(b.add(n1,i,s),o1,6),b.toArray(b.sub(n1,i,s),o1,9),b.toArray(b.add(n1,i,l),o1,12),b.toArray(b.sub(n1,i,l),o1,15);let u=Ig(o1,Xtt),c=ea.volume(t),m=Math.cbrt(c)/300*r;tt.addCage(e,Wtt,u,m,n,o)}var TFr=b.zero(),PFr=b.zero();var wC=b(),Qtt=b(),Ztt=b(),qtt=b(),Ytt=H.identity(),v1e=new Float32Array(24),Ktt=new Uint8Array([0,1,0,3,0,6,1,2,1,7,2,3,2,4,3,5,4,5,4,7,5,6,6,7]);function I1e(e,t,r,n,o){let{origin:i,dirA:a,dirB:s,dirC:l}=t,u=b.negate(Qtt,a),c=b.negate(Ztt,s),m=b.negate(qtt,l),d=0,p=function(y,x,S){b.copy(wC,i),b.add(wC,wC,y),b.add(wC,wC,x),b.add(wC,wC,S),b.toArray(wC,v1e,d),d+=3};p(a,s,l),p(a,s,m),p(a,c,m),p(a,c,l),p(u,c,m),p(u,c,l),p(u,s,l),p(u,s,m);let h=Ig(v1e,Ktt),f=ea.volume(t),g=Math.cbrt(f)/300*r;tt.addCage(e,Ytt,h,g,n,o)}var Jtt=H.identity(),A1e=b();function $tt(e,t,r,n,o){return b.add(A1e,t,r),H.targetTo(e,t,A1e,n),H.setTranslation(e,t),H.scale(e,e,o)}function xb(e,t,r,n,o,i){tt.addPrimitive(e,$tt(Jtt,t,r,n,o),y8(i))}var ZW={color:C.Color(Lt.orange),scaleFactor:C.Numeric(1,{min:.1,max:10,step:.1}),radiusScale:C.Numeric(2,{min:.1,max:10,step:.1})},ert={...ft.Params,...ZW},trt={...ft.Params,...ZW},rrt={...ft.Params,...ZW},T1e={axes:(e,t)=>Ci(irt,ft.Utils),box:(e,t)=>Ci(lrt,ft.Utils),ellipsoid:(e,t)=>Ci(mrt,ft.Utils)},qW={...ert,...trt,...rrt,visuals:C.MultiSelect(["box"],C.objectToOptions(T1e))};function nrt(e){return`Principal Axes of ${RC(e,{countsOnly:!0})}`}function ort(e,t,r){let n=tt.createState(256,128,r),o=Q.Loci.getPrincipalAxesMany(e.locis);return ea.scale(o.momentsAxes,o.momentsAxes,t.scaleFactor),n.currentGroup=0,S1e(n,o.momentsAxes,t.radiusScale,2,20),tt.getMesh(n)}function irt(e,t,r,n){let o=ort(t,r,n&&n.geometry),i=nrt(t.locis);return Wr.create(i,t,o,()=>r.color,()=>1,()=>i)}function art(e){return`Oriented Box of ${RC(e,{countsOnly:!0})}`}function srt(e,t,r){let n=tt.createState(256,128,r),o=Q.Loci.getPrincipalAxesMany(e.locis);return ea.scale(o.boxAxes,o.boxAxes,t.scaleFactor),n.currentGroup=0,I1e(n,o.boxAxes,t.radiusScale,2,20),tt.getMesh(n)}function lrt(e,t,r,n){let o=srt(t,r,n&&n.geometry),i=art(t.locis);return Wr.create(i,t,o,()=>r.color,()=>1,()=>i)}function urt(e){return`Oriented Ellipsoid of ${RC(e,{countsOnly:!0})}`}function crt(e,t,r){let n=tt.createState(256,128,r),i=Q.Loci.getPrincipalAxesMany(e.locis).boxAxes,{origin:a,dirA:s,dirB:l}=i,u=ea.size(b(),i);b.scale(u,u,.5*t.scaleFactor);let c=b.create(u[2],u[1],u[0]);return n.currentGroup=0,xb(n,a,s,l,c,2),tt.getMesh(n)}function mrt(e,t,r,n){let o=crt(t,r,n&&n.geometry),i=urt(t.locis);return Wr.create(i,t,o,()=>r.color,()=>1,()=>i)}function P1e(e,t){let r=Ut.createMulti("Orientation",e,t,Ut.StateBuilder,T1e);return r.setState({markerActions:ii.Highlighting}),r}var drt={radius:1,segments:36,thetaStart:0,thetaLength:Math.PI*2};function MA(e){let{radius:t,segments:r,thetaStart:n,thetaLength:o}={...drt,...e},i=o===Math.PI*2,a=i?r+1:r+2,s=new Float32Array(a*3),l=new Float32Array(a*3),u=new Uint32Array(r*3);s[0]=0,s[1]=0,s[2]=0,l[0]=0,l[1]=1,l[2]=0;for(let c=0,m=3;c<r;++c,m+=3){let d=n+c/r*o;s[m]=t*Math.sin(d),s[m+1]=0,s[m+2]=t*Math.cos(d),l[m]=0,l[m+1]=1,l[m+2]=0}for(let c=1,m=0;c<r;++c,m+=3)u[m]=c,u[m+1]=c+1,u[m+2]=0;if(i){let c=(r-1)*3;u[c]=r,u[c+1]=1,u[c+2]=0}else{let c=n+o,m=(r+1)*3;s[m]=t*Math.sin(c),s[m+1]=0,s[m+2]=t*Math.cos(c),l[m]=0,l[m+1]=1,l[m+2]=0;let d=(r-1)*3;u[d]=r,u[d+1]=r+1,u[d+2]=0}return{vertices:s,normals:l,indices:u}}var _1e={color:C.Color(Lt.lightgreen),arcScale:C.Numeric(.7,{min:.01,max:1,step:.01})},R1e={...Cn.Params,..._1e,lineSizeAttenuation:C.Boolean(!0),linesSize:C.Numeric(.04,{min:.01,max:5,step:.01}),dashLength:C.Numeric(.04,{min:.01,max:.2,step:.01})},prt={...R1e},frt={...R1e},hrt={...ft.Params,..._1e,ignoreLight:C.Boolean(!0),sectorOpacity:C.Numeric(.75,{min:0,max:1,step:.01})},D1e={vectors:(e,t)=>Ci(brt,Cn.Utils,{modifyState:r=>({...r,pickable:!1})}),arc:(e,t)=>Ci(Crt,Cn.Utils,{modifyState:r=>({...r,pickable:!1})}),sector:(e,t)=>Ci(vrt,ft.Utils,{modifyProps:r=>({...r,alpha:r.sectorOpacity}),modifyState:r=>({...r,markerActions:ii.Highlighting})}),text:(e,t)=>Ci(Art,na.Utils,{modifyState:r=>({...r,markerActions:0})})},YW={...prt,...frt,...hrt,...DC,visuals:C.MultiSelect(["vectors","sector","text"],C.objectToOptions(D1e))};function grt(){return{sphereA:he(),sphereB:he(),sphereC:he(),arcDirA:b(),arcDirC:b(),arcNormal:b(),radius:0,angle:0}}var MC=b(),OR=H();function jF(e,t,r){let{sphereA:n,sphereB:o,sphereC:i}=t,{arcDirA:a,arcDirC:s,arcNormal:l}=t,[u,c,m]=e.loci;nr.getBoundingSphere(u,n),nr.getBoundingSphere(c,o),nr.getBoundingSphere(m,i),b.sub(a,n.center,o.center),b.sub(s,i.center,o.center),b.cross(l,a,s);let p=Math.min(b.magnitude(a),b.magnitude(s))*r;return t.radius=p,t.angle=b.angle(a,s),t}function w1e(e,t){let{radius:r,angle:n}=e,o=t?aM(n,r)/t:32;H.targetTo(OR,e.sphereB.center,e.sphereA.center,e.arcNormal),H.setTranslation(OR,e.sphereB.center),H.mul(OR,OR,H.rotY180);let i=MA({radius:r,thetaLength:n,segments:o});return oA(i,OR)}var pu=grt();function WF(e){return e.triples.length===1?`Angle ${DA(e.triples[0],{measureOnly:!0})}`:`${e.triples.length} Angles`}function yrt(e,t,r){let n=ns.create(128,64,r);for(let o=0,i=e.triples.length;o<i;++o)jF(e.triples[o],pu,t.arcScale),n.addFixedLengthDashes(pu.sphereB.center,pu.sphereA.center,t.dashLength,o),n.addFixedLengthDashes(pu.sphereB.center,pu.sphereC.center,t.dashLength,o);return n.getLines()}function brt(e,t,r,n){let o=yrt(t,r,n&&n.geometry),i=WF(t);return Wr.create(i,t,o,()=>r.color,()=>r.linesSize,()=>"")}function xrt(e,t,r){let n=ns.create(128,64,r);for(let o=0,i=e.triples.length;o<i;++o){jF(e.triples[o],pu,t.arcScale);let a=w1e(pu,t.dashLength),{indices:s,vertices:l}=a;for(let u=0,c=s.length;u<c;u+=3){if(u%2===1)continue;let m=s[u]*3,d=s[u+1]*3,p=l[m],h=l[m+1],f=l[m+2],g=l[d],y=l[d+1],x=l[d+2];n.add(p,h,f,g,y,x,o)}}return n.getLines()}function Crt(e,t,r,n){let o=xrt(t,r,n&&n.geometry),i=WF(t);return Wr.create(i,t,o,()=>r.color,()=>r.linesSize,()=>"")}function Srt(e,t,r){let n=tt.createState(128,64,r);for(let o=0,i=e.triples.length;o<i;++o){jF(e.triples[o],pu,t.arcScale);let a=w1e(pu);n.currentGroup=o,tt.addPrimitive(n,H.id,a),tt.addPrimitiveFlipped(n,H.id,a)}return tt.getMesh(n)}function vrt(e,t,r,n){let o=Srt(t,r,n&&n.geometry),i=WF(t),a=s=>DA(t.triples[s]);return Wr.create(i,t,o,()=>r.color,()=>1,a)}function Irt(e,t,r){let n=Ws.create(t,128,64,r);for(let o=0,i=e.triples.length;o<i;++o){jF(e.triples[o],pu,t.arcScale),b.add(MC,pu.arcDirA,pu.arcDirC),b.setMagnitude(MC,MC,pu.radius),b.add(MC,pu.sphereB.center,MC);let a=Ya(pu.angle).toFixed(2),s=t.customText||`${a}\xB0`,u=Math.max(2,pu.sphereA.radius,pu.sphereB.radius,pu.sphereC.radius)/2;n.add(s,MC[0],MC[1],MC[2],.1,u,o)}return n.getText()}function Art(e,t,r,n){let o=Irt(t,r,n&&n.geometry),i=WF(t),a=s=>DA(t.triples[s]);return Wr.create(i,t,o,()=>r.textColor,()=>r.textSize,a)}function M1e(e,t){return Ut.createMulti("Angle",e,t,Ut.StateBuilder,D1e)}var B1e={color:C.Color(Lt.lightgreen),arcScale:C.Numeric(.7,{min:.01,max:1,step:.01})},XF={...Cn.Params,...B1e,lineSizeAttenuation:C.Boolean(!0),linesSize:C.Numeric(.04,{min:.01,max:5,step:.01}),dashLength:C.Numeric(.04,{min:.01,max:.2,step:.01})},Trt={...XF},Prt={...XF},_rt={...XF},Rrt={...XF},Drt={...ft.Params,...B1e,ignoreLight:C.Boolean(!0),sectorOpacity:C.Numeric(.75,{min:0,max:1,step:.01})},E1e={vectors:(e,t)=>Ci(Brt,Cn.Utils,{modifyState:r=>({...r,pickable:!1})}),extenders:(e,t)=>Ci(Ort,Cn.Utils,{modifyState:r=>({...r,pickable:!1})}),connector:(e,t)=>Ci(krt,Cn.Utils,{modifyState:r=>({...r,pickable:!1})}),arms:(e,t)=>Ci(Lrt,Cn.Utils,{modifyState:r=>({...r,pickable:!1})}),arc:(e,t)=>Ci(Urt,Cn.Utils,{modifyState:r=>({...r,pickable:!1})}),sector:(e,t)=>Ci(zrt,ft.Utils,{modifyProps:r=>({...r,alpha:r.sectorOpacity}),modifyState:r=>({...r,markerActions:ii.Highlighting})}),text:(e,t)=>Ci(jrt,na.Utils,{modifyState:r=>({...r,markerActions:0})})},KW={...Trt,...Prt,..._rt,...Rrt,...Drt,...DC,visuals:C.MultiSelect(["extenders","arms","sector","text"],C.objectToOptions(E1e))};function wrt(){return{sphereA:he(),sphereB:he(),sphereC:he(),sphereD:he(),dirBA:b(),dirCD:b(),projA:b(),projD:b(),arcPointA:b(),arcPointD:b(),arcDirA:b(),arcDirD:b(),arcCenter:b(),arcNormal:b(),radius:0,angle:0}}var pc=b(),GR=H();function i1(e,t,r){let{sphereA:n,sphereB:o,sphereC:i,sphereD:a,dirBA:s,dirCD:l,projA:u,projD:c}=t,{arcPointA:m,arcPointD:d,arcDirA:p,arcDirD:h,arcCenter:f,arcNormal:g}=t,[y,x,S,I]=e.loci;nr.getBoundingSphere(y,n),nr.getBoundingSphere(x,o),nr.getBoundingSphere(S,i),nr.getBoundingSphere(I,a),b.add(f,o.center,i.center),b.scale(f,f,.5),b.sub(s,n.center,o.center),b.sub(l,a.center,i.center),b.add(m,f,s),b.add(d,f,l),b.sub(g,i.center,o.center),b.orthogonalize(p,g,s),b.orthogonalize(h,g,l),b.projectPointOnVector(u,m,p,f),b.projectPointOnVector(c,d,h,f);let A=Math.min(b.distance(u,f),b.distance(c,f))*r;b.setMagnitude(p,p,A),b.setMagnitude(h,h,A),b.add(m,f,p),b.add(d,f,h),t.radius=A,t.angle=b.dihedralAngle(n.center,o.center,i.center,a.center),b.matchDirection(pc,g,b.sub(pc,m,n.center));let P=b.angle(s,pc),T=A/Math.cos(P-X0);b.add(u,o.center,b.setMagnitude(pc,s,T)),b.matchDirection(pc,g,b.sub(pc,d,a.center));let R=b.angle(l,pc),w=A/Math.cos(R-X0);return b.add(c,i.center,b.setMagnitude(pc,l,w)),t}function k1e(e,t){let{radius:r,angle:n}=e,o=t?aM(n,r)/t:32;H.targetTo(GR,e.arcCenter,n<0?e.arcPointD:e.arcPointA,e.arcNormal),H.setTranslation(GR,e.arcCenter),H.mul(GR,GR,H.rotY180);let i=MA({radius:r,thetaLength:Math.abs(n),segments:o});return oA(i,GR)}var fi=wrt();function a1(e){return e.quads.length===1?`Dihedral ${wA(e.quads[0],{measureOnly:!0})}`:`${e.quads.length} Dihedrals`}function Mrt(e,t,r){let n=ns.create(128,64,r);for(let o=0,i=e.quads.length;o<i;++o)i1(e.quads[o],fi,t.arcScale),n.addFixedLengthDashes(fi.arcCenter,fi.arcPointA,t.dashLength,o),n.addFixedLengthDashes(fi.arcCenter,fi.arcPointD,t.dashLength,o);return n.getLines()}function Brt(e,t,r,n){let o=Mrt(t,r,n&&n.geometry),i=a1(t);return Wr.create(i,t,o,()=>r.color,()=>r.linesSize,()=>"")}function Ert(e,t,r){let n=ns.create(128,64,r);for(let o=0,i=e.quads.length;o<i;++o)i1(e.quads[o],fi,t.arcScale),n.addFixedLengthDashes(fi.sphereB.center,fi.sphereC.center,t.dashLength,o);return n.getLines()}function krt(e,t,r,n){let o=Ert(t,r,n&&n.geometry),i=a1(t);return Wr.create(i,t,o,()=>r.color,()=>r.linesSize,()=>"")}function Frt(e,t,r){let n=ns.create(128,64,r);for(let o=0,i=e.quads.length;o<i;++o)i1(e.quads[o],fi,t.arcScale),n.addFixedLengthDashes(fi.sphereB.center,fi.sphereA.center,t.dashLength,o),n.addFixedLengthDashes(fi.sphereC.center,fi.sphereD.center,t.dashLength,o);return n.getLines()}function Lrt(e,t,r,n){let o=Frt(t,r,n&&n.geometry),i=a1(t);return Wr.create(i,t,o,()=>r.color,()=>r.linesSize,()=>"")}function Vrt(e,t,r){let n=ns.create(128,64,r);for(let o=0,i=e.quads.length;o<i;++o)i1(e.quads[o],fi,t.arcScale),n.addFixedLengthDashes(fi.arcPointA,fi.projA,t.dashLength,o),n.addFixedLengthDashes(fi.arcPointD,fi.projD,t.dashLength,o);return n.getLines()}function Ort(e,t,r,n){let o=Vrt(t,r,n&&n.geometry),i=a1(t);return Wr.create(i,t,o,()=>r.color,()=>r.linesSize,()=>"")}function Grt(e,t,r){let n=ns.create(128,64,r);for(let o=0,i=e.quads.length;o<i;++o){i1(e.quads[o],fi,t.arcScale);let a=k1e(fi,t.dashLength),{indices:s,vertices:l}=a;for(let u=0,c=s.length;u<c;u+=3){if(u%2===1)continue;let m=s[u]*3,d=s[u+1]*3,p=l[m],h=l[m+1],f=l[m+2],g=l[d],y=l[d+1],x=l[d+2];n.add(p,h,f,g,y,x,o)}}return n.getLines()}function Urt(e,t,r,n){let o=Grt(t,r,n&&n.geometry),i=a1(t);return Wr.create(i,t,o,()=>r.color,()=>r.linesSize,()=>"")}function Nrt(e,t,r){let n=tt.createState(128,64,r);for(let o=0,i=e.quads.length;o<i;++o){i1(e.quads[o],fi,t.arcScale);let a=k1e(fi);n.currentGroup=o,tt.addPrimitive(n,H.id,a),tt.addPrimitiveFlipped(n,H.id,a)}return tt.getMesh(n)}function zrt(e,t,r,n){let o=Nrt(t,r,n&&n.geometry),i=a1(t),a=s=>wA(t.quads[s]);return Wr.create(i,t,o,()=>r.color,()=>1,a)}function Hrt(e,t,r){let n=Ws.create(t,128,64,r);for(let o=0,i=e.quads.length;o<i;++o){i1(e.quads[o],fi,t.arcScale),b.add(pc,fi.arcDirA,fi.arcDirD),b.setMagnitude(pc,pc,fi.radius),b.add(pc,fi.arcCenter,pc);let a=Ya(fi.angle).toFixed(2);a==="-0.00"&&(a="0.00");let s=t.customText||`${a}\xB0`,u=Math.max(2,fi.sphereA.radius,fi.sphereB.radius,fi.sphereC.radius,fi.sphereD.radius)/2;n.add(s,pc[0],pc[1],pc[2],.1,u,o)}return n.getText()}function jrt(e,t,r,n){let o=Hrt(t,r,n&&n.geometry),i=a1(t),a=s=>wA(t.quads[s]);return Wr.create(i,t,o,()=>r.textColor,()=>r.textSize,a)}function F1e(e,t){return Ut.createMulti("Dihedral",e,t,Ut.StateBuilder,E1e)}function Io(e,t){return{kind:e,layers:t}}(c=>{c.Empty={kind:"empty-loci",layers:[]};let t;(S=>{S.is=Ia.has;let d;(E=>(E[E.None=0]="None",E[E.One=1]="One",E[E.Two=2]="Two",E[E.Three=4]="Three",E[E.Four=8]="Four",E[E.Five=16]="Five",E[E.Six=32]="Six"))(d=S.Flag||={});function p(I){return Ia.create(I)}S.create=p,S.Names={one:1,two:2,three:4,four:8,five:16,six:32};function f(I){return I in S.Names}S.isName=f;function g(I){switch(I){case"one":return 1;case"two":return 2;case"three":return 4;case"four":return 8;case"five":return 16;case"six":return 32}}S.fromName=g;function y(I){let v=0;for(let A=0,P=I.length;A<P;++A)v|=g(I[A]);return v}S.fromNames=y;function x(I){let v=[];return(0,S.is)(I,1)&&v.push("one"),(0,S.is)(I,2)&&v.push("two"),(0,S.is)(I,4)&&v.push("three"),(0,S.is)(I,8)&&v.push("four"),(0,S.is)(I,16)&&v.push("five"),(0,S.is)(I,32)&&v.push("six"),v}S.toNames=x})(t=c.Groups||={});function r(m,d){if(m.layers.length!==d.layers.length)return!1;for(let p=0,h=m.layers.length;p<h;++p)if(m.layers[p].groups!==d.layers[p].groups||!nr.areEqual(m.layers[p].loci,d.layers[p].loci))return!1;return!0}c.areEqual=r;function n(m){return m.layers.length===0}c.isEmpty=n;function o(m,d){if(m.kind==="element-loci"){let p=[];for(let h of m.layers){let{loci:f,groups:g}=h;f=Q.Loci.remap(f,d),Q.Loci.isEmpty(f)||p.push({loci:f,groups:g})}return{kind:"element-loci",layers:p}}else return m}c.remap=o;function i(m){if(n(m))return m;if(m.kind==="element-loci"){let{structure:d}=m.layers[0].loci,p=new Map,h=Q.Loci.none(d);for(let g=0,y=m.layers.length;g<y;++g){let{loci:x,groups:S}=m.layers[y-g-1];x=Q.Loci.subtract(x,h),h=Q.Loci.union(x,h),Q.Loci.isEmpty(x)||(p.has(S)&&(x=Q.Loci.union(x,p.get(S))),p.set(S,x))}let f=[];return p.forEach((g,y)=>{f.push({loci:g,groups:y})}),{kind:"element-loci",layers:f}}else return m}c.merge=i;function a(m,d){if(n(m))return m;if(m.kind==="element-loci"){let{structure:p}=m.layers[0].loci,h=[];for(let f of m.layers){let{loci:g,groups:y}=f,x=Q.Loci.remap(g,d);g=Q.Loci.remap(x,p),Q.Loci.isEmpty(g)||h.push({loci:g,groups:y})}return{kind:"element-loci",layers:h}}else return m}c.filter=a;function s(m,d){let p=[];for(let h=0,f=m.length;h<f;++h){let{script:g,groups:y}=m[h],x=Mo.toLoci(g,d);Q.Loci.isEmpty(x)||p.push({loci:x,groups:y})}return{kind:"element-loci",layers:p}}c.ofScript=s;function l(m,d){let p=[];for(let h=0,f=m.length;h<f;++h){let{bundle:g,groups:y}=m[h],x=Q.Bundle.toLoci(g,d.root);p.push({loci:x,groups:y})}return{kind:"element-loci",layers:p}}c.ofBundle=l;function u(m){let d=[];for(let p=0,h=m.layers.length;p<h;++p){let{loci:f,groups:g}=m.layers[p],y=Q.Bundle.fromLoci(f);d.push({bundle:y,groups:g})}return{kind:"element-loci",layers:d}}c.toBundle=u})(Io||={});var JW={};Gi(JW,{BoxShape3D:()=>Wrt,getBoxMesh:()=>QF});var Wrt=Vt.BuiltIn({name:"box-shape-3d",display:"Box Shape",from:ne.Root,to:ne.Shape.Provider,params:{bottomLeft:C.Vec3(b()),topRight:C.Vec3(b.create(1,1,1)),radius:C.Numeric(.15,{min:.01,max:4,step:.01}),color:C.Color(Lt.red)}})({canAutoUpdate(){return!0},apply({params:e}){return Ae.create("Shape Representation",async t=>new ne.Shape.Provider({label:"Box",data:e,params:ft.Params,getShape:(r,n)=>{let o=QF(pt.create(e.bottomLeft,e.topRight),e.radius);return Wr.create("Box",n,o,()=>n.color,()=>1,()=>"Box")},geometryUtils:ft.Utils},{label:"Box"}))}});function QF(e,t,r){let n=b.sub(b(),e.max,e.min),o=H.fromTranslation(H(),b.create(.5,.5,.5)),i=H.fromScaling(H(),n),a=H.fromTranslation(H(),e.min),s=H.mul3(H(),a,i,o),l=tt.createState(256,128,r);l.currentGroup=1,tt.addCage(l,s,QS(),t,2,20);let u=tt.getMesh(l),c=b.scaleAndAdd(b(),e.min,n,.5),m=b.distance(e.min,c);return u.setBoundingSphere(he.create(c,m)),u}var L1e={vertices:new Float32Array([-.5,.5,0,.5,.5,0,-.5,-.5,0,.5,-.5,0]),normals:new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1]),indices:new Uint32Array([0,2,1,1,2,3])},iVr={vertices:L1e.vertices,edges:new Uint32Array([0,1,2,3,3,1,2,0])};function V1e(){return L1e}var Xrt={...ft.Params,color:C.Color(Lt.orange),scaleFactor:C.Numeric(1,{min:.1,max:10,step:.1})},O1e={plane:(e,t)=>Ci(qrt,ft.Utils)},eX={...Xrt,visuals:C.MultiSelect(["plane"],C.objectToOptions(O1e))};function Qrt(e){return`Best Fit Plane of ${RC(e,{countsOnly:!0})}`}var BC=H(),$W=b();function Zrt(e,t,r){let n=tt.createState(256,128,r),i=Q.Loci.getPrincipalAxesMany(e.locis).boxAxes,a=V1e();return b.add($W,i.origin,i.dirC),H.targetTo(BC,$W,i.origin,i.dirB),H.scale(BC,BC,ea.size($W,i)),H.scaleUniformly(BC,BC,t.scaleFactor),H.setTranslation(BC,i.origin),n.currentGroup=0,tt.addPrimitive(n,BC,a),tt.addPrimitiveFlipped(n,BC,a),tt.getMesh(n)}function qrt(e,t,r,n){let o=Zrt(t,r,n&&n.geometry),i=Qrt(t.locis);return Wr.create(i,t,o,()=>r.color,()=>1,()=>i)}function G1e(e,t){let r=Ut.createMulti("Plane",e,t,Ut.StateBuilder,O1e);return r.setState({markerActions:ii.Highlighting}),r}function ls(e,t){return{kind:e,layers:t}}(u=>{u.Empty={kind:"empty-loci",layers:[]};function t(c,m){if(c.layers.length===0&&m.layers.length===0)return!0;if(c.layers.length!==m.layers.length)return!1;for(let d=0,p=c.layers.length;d<p;++d)if(c.layers[d].clear!==m.layers[d].clear||!qb(c.layers[d].material,m.layers[d].material)||!nr.areEqual(c.layers[d].loci,m.layers[d].loci))return!1;return!0}u.areEqual=t;function r(c){return c.layers.length===0}u.isEmpty=r;function n(c,m){if(c.kind==="element-loci"){let d=[];for(let p of c.layers){let{loci:h,material:f,clear:g}=p;h=Q.Loci.remap(h,m),Q.Loci.isEmpty(h)||d.push({loci:h,material:f,clear:g})}return{kind:"element-loci",layers:d}}else return c}u.remap=n;function o(c){if(r(c))return c;if(c.kind==="element-loci"){let{structure:m}=c.layers[0].loci,d,p=new Map,h=Q.Loci.none(m);for(let g=0,y=c.layers.length;g<y;++g){let{loci:x,material:S,clear:I}=c.layers[y-g-1];x=Q.Loci.subtract(x,h),h=Q.Loci.union(x,h),Q.Loci.isEmpty(x)||(I?d=d?Q.Loci.union(x,d):x:(p.has(S)&&(x=Q.Loci.union(x,p.get(S))),p.set(S,x)))}let f=[];return d&&f.push({loci:d,material:Hi(),clear:!0}),p.forEach((g,y)=>{f.push({loci:g,material:y,clear:!1})}),{kind:"element-loci",layers:f}}else return c}u.merge=o;function i(c,m){if(r(c))return c;if(c.kind==="element-loci"){let{structure:d}=c.layers[0].loci,p=[];for(let h of c.layers){let{loci:f,material:g,clear:y}=h,x=Q.Loci.remap(f,m);f=Q.Loci.remap(x,d),Q.Loci.isEmpty(f)||p.push({loci:f,material:g,clear:y})}return{kind:"element-loci",layers:p}}else return c}u.filter=i;function a(c,m){let d=[];for(let p=0,h=c.length;p<h;++p){let{script:f,material:g,clear:y}=c[p],x=Mo.toLoci(f,m);Q.Loci.isEmpty(x)||d.push({loci:x,material:g,clear:y})}return{kind:"element-loci",layers:d}}u.ofScript=a;function s(c,m){let d=[];for(let p=0,h=c.length;p<h;++p){let{bundle:f,material:g,clear:y}=c[p],x=Q.Bundle.toLoci(f,m.root);d.push({loci:x,material:g,clear:y})}return{kind:"element-loci",layers:d}}u.ofBundle=s;function l(c){let m=[];for(let d=0,p=c.layers.length;d<p;++d){let{loci:h,material:f,clear:g}=c.layers[d],y=Q.Bundle.fromLoci(h);m.push({bundle:y,material:f,clear:g})}return{kind:"element-loci",layers:m}}u.toBundle=l})(ls||={});function us(e,t){return{kind:e,layers:t}}(u=>{u.Empty={kind:"empty-loci",layers:[]};function t(c,m){if(c.layers.length===0&&m.layers.length===0)return!0;if(c.layers.length!==m.layers.length)return!1;for(let d=0,p=c.layers.length;d<p;++d)if(c.layers[d].value!==m.layers[d].value||!nr.areEqual(c.layers[d].loci,m.layers[d].loci))return!1;return!0}u.areEqual=t;function r(c){return c.layers.length===0}u.isEmpty=r;function n(c,m){if(c.kind==="element-loci"){let d=[];for(let p of c.layers){let{loci:h,value:f}=p;h=Q.Loci.remap(h,m),Q.Loci.isEmpty(h)||d.push({loci:h,value:f})}return{kind:"element-loci",layers:d}}else return c}u.remap=n;function o(c){if(r(c))return c;if(c.kind==="element-loci"){let{structure:m}=c.layers[0].loci,d=new Map,p=Q.Loci.none(m);for(let f=0,g=c.layers.length;f<g;++f){let{loci:y,value:x}=c.layers[g-f-1];y=Q.Loci.subtract(y,p),p=Q.Loci.union(y,p),Q.Loci.isEmpty(y)||(d.has(x)&&(y=Q.Loci.union(y,d.get(x))),d.set(x,y))}let h=[];return d.forEach((f,g)=>{h.push({loci:f,value:g})}),{kind:"element-loci",layers:h}}else return c}u.merge=o;function i(c,m){if(r(c))return c;if(c.kind==="element-loci"){let{structure:d}=c.layers[0].loci,p=[];for(let h of c.layers){let{loci:f,value:g}=h,y=Q.Loci.remap(f,m);f=Q.Loci.remap(y,d),Q.Loci.isEmpty(f)||p.push({loci:f,value:g})}return{kind:"element-loci",layers:p}}else return c}u.filter=i;function a(c,m){let d=[];for(let p=0,h=c.length;p<h;++p){let{script:f,value:g}=c[p],y=Mo.toLoci(f,m);Q.Loci.isEmpty(y)||d.push({loci:y,value:g})}return{kind:"element-loci",layers:d}}u.ofScript=a;function s(c,m){let d=[];for(let p=0,h=c.length;p<h;++p){let{bundle:f,value:g}=c[p],y=Q.Bundle.toLoci(f,m.root);d.push({loci:y,value:g})}return{kind:"element-loci",layers:d}}u.ofBundle=s;function l(c){let m=[];for(let d=0,p=c.layers.length;d<p;++d){let{loci:h,value:f}=c.layers[d],g=Q.Bundle.fromLoci(h);m.push({bundle:g,value:f})}return{kind:"element-loci",layers:m}}u.toBundle=l})(us||={});var Od=Vt.BuiltIn({name:"structure-representation-3d",display:"3D Representation",from:ne.Molecule.Structure,to:ne.Molecule.Structure.Representation3D,params:(e,t)=>{let{registry:r,themes:n}=t.representation.structure,o=r.get(r.default.name);if(!e){let s={help:l=>{let{name:u,params:c}=l,d=n.colorThemeRegistry.get(u).factory({},c);return{description:d.description,legend:d.legend}}};return{type:C.Mapped(r.default.name,r.types,l=>C.Group(r.get(l).getParams(n,De.Empty))),colorTheme:C.Mapped(o.defaultColorTheme.name,n.colorThemeRegistry.types,l=>C.Group(n.colorThemeRegistry.get(l).getParams({structure:De.Empty})),s),sizeTheme:C.Mapped(o.defaultSizeTheme.name,n.sizeThemeRegistry.types,l=>C.Group(n.sizeThemeRegistry.get(l).getParams({structure:De.Empty})))}}let i={structure:e.data},a={help:s=>{let{name:l,params:u}=s,m=n.colorThemeRegistry.get(l).factory(i,u);return{description:m.description,legend:m.legend}}};return{type:C.Mapped(r.default.name,r.getApplicableTypes(e.data),s=>C.Group(r.get(s).getParams(n,e.data))),colorTheme:C.Mapped(o.defaultColorTheme.name,n.colorThemeRegistry.getApplicableTypes(i),s=>C.Group(n.colorThemeRegistry.get(s).getParams(i)),a),sizeTheme:C.Mapped(o.defaultSizeTheme.name,n.sizeThemeRegistry.getApplicableTypes(i),s=>C.Group(n.sizeThemeRegistry.get(s).getParams(i)))}}})({canAutoUpdate({a:e,oldParams:t,newParams:r}){return e.data.elementCount<1e4||t.type.name===r.type.name&&r.type.params.quality!=="custom"},apply({a:e,params:t,cache:r},n){return Ae.create("Structure Representation",async o=>{let i={runtime:o,assetManager:n.managers.asset,errorContext:n.errorContext},a=n.representation.structure.registry.get(t.type.name),s=a.getData?.(e.data,t.type.params)||e.data;a.ensureCustomProperties&&await a.ensureCustomProperties.attach(i,s);let l=a.factory({webgl:n.canvas3d?.webgl,...n.representation.structure.themes},a.getParams);await Ii.ensureDependencies(i,n.representation.structure.themes,{structure:s},t),l.setTheme(Ii.create(n.representation.structure.themes,{structure:s},t));let u=t.type.params||{};return await l.createOrUpdate(u,s).runInContext(o),new ne.Molecule.Structure.Representation3D({repr:l,sourceData:e.data},{label:a.label})})},update({a:e,b:t,oldParams:r,newParams:n,cache:o},i){return Ae.create("Structure Representation",async a=>{if(n.type.name!==r.type.name)return et.UpdateResult.Recreate;let s=i.representation.structure.registry.get(n.type.name);if(s.mustRecreate?.(r.type.params,n.type.params))return et.UpdateResult.Recreate;let l=s.getData?.(e.data,n.type.params)||e.data,u={runtime:a,assetManager:i.managers.asset,errorContext:i.errorContext};s.ensureCustomProperties&&await s.ensureCustomProperties.attach(u,l),Ii.releaseDependencies(i.representation.structure.themes,{structure:t.data.sourceData},r),await Ii.ensureDependencies(u,i.representation.structure.themes,{structure:l},n),t.data.repr.setTheme(Ii.create(i.representation.structure.themes,{structure:l},n));let c={...t.data.repr.props,...n.type.params};return await t.data.repr.createOrUpdate(c,l).runInContext(a),t.data.sourceData=e.data,et.UpdateResult.Updated})},dispose({b:e,params:t},r){if(!e||!t)return;let n=e.data.sourceData,o=r.representation.structure.registry.get(t.type.name);o.ensureCustomProperties&&o.ensureCustomProperties.detach(n),Ii.releaseDependencies(r.representation.structure.themes,{structure:n},t)},interpolate(e,t,r){if(e.colorTheme.name!=="uniform"||t.colorTheme.name!=="uniform")return r<=.5?e:t;let n=e.colorTheme.params.value,o=t.colorTheme.params.value,i=Le.interpolate(n,o,r);return{type:r<=.5?e.type:t.type,colorTheme:{name:"uniform",params:{value:i}},sizeTheme:r<=.5?e.sizeTheme:t.sizeTheme}}}),Yrt=Vt.BuiltIn({name:"unwind-structure-assembly-representation-3d",display:"Unwind Assembly 3D Representation",from:ne.Molecule.Structure.Representation3D,to:ne.Molecule.Structure.Representation3DState,params:{t:C.Numeric(0,{min:0,max:1,step:.01})}})({canAutoUpdate(){return!0},apply({a:e,params:t}){let r=e.data.sourceData,n=new bb(r);return OW(r,n,t.t),new ne.Molecule.Structure.Representation3DState({state:{unitTransforms:n},initialState:{unitTransforms:new bb(r)},info:r,repr:e.data.repr},{label:`Unwind T = ${t.t.toFixed(2)}`})},update({a:e,b:t,newParams:r,oldParams:n}){let o=t.data.info;if(e.data.sourceData!==o)return et.UpdateResult.Recreate;if(e.data.repr!==t.data.repr)return et.UpdateResult.Recreate;if(n.t===r.t)return et.UpdateResult.Unchanged;let i=t.data.state.unitTransforms;return OW(o,i,r.t),t.label=`Unwind T = ${r.t.toFixed(2)}`,t.data.repr=e.data.repr,et.UpdateResult.Updated}}),Krt=Vt.BuiltIn({name:"explode-structure-representation-3d",display:"Explode 3D Representation",from:ne.Molecule.Structure.Representation3D,to:ne.Molecule.Structure.Representation3DState,params:{t:C.Numeric(0,{min:0,max:1,step:.01})}})({canAutoUpdate(){return!0},apply({a:e,params:t}){let r=e.data.sourceData,n=new bb(r);return GW(r,n,t.t,r.root.boundary.sphere),new ne.Molecule.Structure.Representation3DState({state:{unitTransforms:n},initialState:{unitTransforms:new bb(r)},info:r,repr:e.data.repr},{label:`Explode T = ${t.t.toFixed(2)}`})},update({a:e,b:t,newParams:r,oldParams:n}){let o=e.data.sourceData;if(t.data.info!==o)return et.UpdateResult.Recreate;if(e.data.repr!==t.data.repr)return et.UpdateResult.Recreate;if(n.t===r.t)return et.UpdateResult.Unchanged;let i=t.data.state.unitTransforms;return GW(o,i,r.t,o.root.boundary.sphere),t.label=`Explode T = ${r.t.toFixed(2)}`,t.data.repr=e.data.repr,et.UpdateResult.Updated}}),Jrt=Vt.BuiltIn({name:"spin-structure-representation-3d",display:"Spin 3D Representation",from:ne.Molecule.Structure.Representation3D,to:ne.Molecule.Structure.Representation3DState,params:{t:C.Numeric(0,{min:0,max:1,step:.01}),...u1e}})({canAutoUpdate(){return!0},apply({a:e,params:t}){let r=e.data.sourceData,n=new bb(r),{axis:o,origin:i}=UW(r.root,t);return NW(r,n,t.t,o,i),new ne.Molecule.Structure.Representation3DState({state:{unitTransforms:n},initialState:{unitTransforms:new bb(r)},info:r,repr:e.data.repr},{label:`Spin T = ${t.t.toFixed(2)}`})},update({a:e,b:t,newParams:r,oldParams:n}){let o=e.data.sourceData;if(t.data.info!==o)return et.UpdateResult.Recreate;if(e.data.repr!==t.data.repr)return et.UpdateResult.Recreate;if(n.t===r.t&&n.axis===r.axis&&n.origin===r.origin)return et.UpdateResult.Unchanged;let i=t.data.state.unitTransforms,{axis:a,origin:s}=UW(o.root,r);return NW(o,i,r.t,a,s),t.label=`Spin T = ${r.t.toFixed(2)}`,t.data.repr=e.data.repr,et.UpdateResult.Updated}}),$rt=Vt.BuiltIn({name:"overpaint-structure-representation-3d-from-script",display:"Overpaint 3D Representation",from:ne.Molecule.Structure.Representation3D,to:ne.Molecule.Structure.Representation3DState,params:()=>({layers:C.ObjectList({script:C.Script(Mo("(sel.atom.all)","mol-script")),color:C.Color(Lt.blueviolet),clear:C.Boolean(!1)},e=>`${e.clear?"Clear":Le.toRgbString(e.color)}`,{defaultValue:[{script:Mo("(sel.atom.all)","mol-script"),color:Lt.blueviolet,clear:!1}]})})})({canAutoUpdate(){return!0},apply({a:e,params:t}){let r=e.data.sourceData,n=e.data.repr.geometryVersion,o=as.ofScript(t.layers,r);return new ne.Molecule.Structure.Representation3DState({state:{overpaint:o},initialState:{overpaint:as.Empty},info:{structure:r,geometryVersion:n},repr:e.data.repr},{label:`Overpaint (${o.layers.length} Layers)`})},update({a:e,b:t,newParams:r,oldParams:n}){let o=t.data.info,i=e.data.sourceData;if(i!==o.structure)return et.UpdateResult.Recreate;if(e.data.repr!==t.data.repr)return et.UpdateResult.Recreate;let a=e.data.repr.geometryVersion;if(a!==o.geometryVersion&&Om(e.data.repr.props))return et.UpdateResult.Recreate;let s=t.data.state.overpaint,l=as.ofScript(r.layers,i);return as.areEqual(s,l)?et.UpdateResult.Unchanged:(o.geometryVersion=a,t.data.state.overpaint=l,t.data.repr=e.data.repr,t.label=`Overpaint (${l.layers.length} Layers)`,et.UpdateResult.Updated)}}),ent=Vt.BuiltIn({name:"overpaint-structure-representation-3d-from-bundle",display:"Overpaint 3D Representation",from:ne.Molecule.Structure.Representation3D,to:ne.Molecule.Structure.Representation3DState,params:()=>({layers:C.ObjectList({bundle:C.Value(Q.Bundle.Empty),color:C.Color(Lt.blueviolet),clear:C.Boolean(!1)},e=>`${e.clear?"Clear":Le.toRgbString(e.color)}`,{defaultValue:[{bundle:Q.Bundle.Empty,color:Lt.blueviolet,clear:!1}],isHidden:!0})})})({canAutoUpdate(){return!0},apply({a:e,params:t}){let r=e.data.sourceData,n=e.data.repr.geometryVersion,o=as.ofBundle(t.layers,r);return new ne.Molecule.Structure.Representation3DState({state:{overpaint:o},initialState:{overpaint:as.Empty},info:{structure:r,geometryVersion:n},repr:e.data.repr},{label:`Overpaint (${o.layers.length} Layers)`})},update({a:e,b:t,newParams:r,oldParams:n}){let o=t.data.info,i=e.data.sourceData;if(i!==o.structure)return et.UpdateResult.Recreate;if(e.data.repr!==t.data.repr)return et.UpdateResult.Recreate;let a=e.data.repr.geometryVersion;if(a!==o.geometryVersion&&Om(e.data.repr.props))return et.UpdateResult.Recreate;let s=t.data.state.overpaint,l=as.ofBundle(r.layers,i);return as.areEqual(s,l)?et.UpdateResult.Unchanged:(o.geometryVersion=a,t.data.state.overpaint=l,t.data.repr=e.data.repr,t.label=`Overpaint (${l.layers.length} Layers)`,et.UpdateResult.Updated)}}),tnt=Vt.BuiltIn({name:"transparency-structure-representation-3d-from-script",display:"Transparency 3D Representation",from:ne.Molecule.Structure.Representation3D,to:ne.Molecule.Structure.Representation3DState,params:()=>({layers:C.ObjectList({script:C.Script(Mo("(sel.atom.all)","mol-script")),value:C.Numeric(.5,{min:0,max:1,step:.01},{label:"Transparency"})},e=>`Transparency (${e.value})`,{defaultValue:[{script:Mo("(sel.atom.all)","mol-script"),value:.5}]})})})({canAutoUpdate(){return!0},apply({a:e,params:t}){let r=e.data.sourceData,n=e.data.repr.geometryVersion,o=ss.ofScript(t.layers,r);return new ne.Molecule.Structure.Representation3DState({state:{transparency:o},initialState:{transparency:ss.Empty},info:{structure:r,geometryVersion:n},repr:e.data.repr},{label:`Transparency (${o.layers.length} Layers)`})},update({a:e,b:t,newParams:r,oldParams:n}){let o=t.data.info,i=e.data.sourceData;if(i!==o.structure)return et.UpdateResult.Recreate;if(e.data.repr!==t.data.repr)return et.UpdateResult.Recreate;let a=e.data.repr.geometryVersion;if(a!==o.geometryVersion&&Om(e.data.repr.props))return et.UpdateResult.Recreate;let s=t.data.state.transparency,l=ss.ofScript(r.layers,i);return ss.areEqual(s,l)?et.UpdateResult.Unchanged:(o.geometryVersion=a,t.data.state.transparency=l,t.data.repr=e.data.repr,t.label=`Transparency (${l.layers.length} Layers)`,et.UpdateResult.Updated)}}),rnt=Vt.BuiltIn({name:"transparency-structure-representation-3d-from-bundle",display:"Transparency 3D Representation",from:ne.Molecule.Structure.Representation3D,to:ne.Molecule.Structure.Representation3DState,params:()=>({layers:C.ObjectList({bundle:C.Value(Q.Bundle.Empty),value:C.Numeric(.5,{min:0,max:1,step:.01},{label:"Transparency"})},e=>`Transparency (${e.value})`,{defaultValue:[{bundle:Q.Bundle.Empty,value:.5}],isHidden:!0})})})({canAutoUpdate(){return!0},apply({a:e,params:t}){let r=e.data.sourceData,n=e.data.repr.geometryVersion,o=ss.ofBundle(t.layers,r);return new ne.Molecule.Structure.Representation3DState({state:{transparency:o},initialState:{transparency:ss.Empty},info:{structure:r,geometryVersion:n},repr:e.data.repr},{label:`Transparency (${o.layers.length} Layers)`})},update({a:e,b:t,newParams:r,oldParams:n}){let o=t.data.info,i=e.data.sourceData;if(i!==o.structure)return et.UpdateResult.Recreate;if(e.data.repr!==t.data.repr)return et.UpdateResult.Recreate;let a=e.data.repr.geometryVersion;if(a!==o.geometryVersion&&Om(e.data.repr.props))return et.UpdateResult.Recreate;let s=t.data.state.transparency,l=ss.ofBundle(r.layers,i);return ss.areEqual(s,l)?et.UpdateResult.Unchanged:(o.geometryVersion=a,t.data.state.transparency=l,t.data.repr=e.data.repr,t.label=`Transparency (${l.layers.length} Layers)`,et.UpdateResult.Updated)}}),nnt=Vt.BuiltIn({name:"emissive-structure-representation-3d-from-script",display:"Emissive 3D Representation",from:ne.Molecule.Structure.Representation3D,to:ne.Molecule.Structure.Representation3DState,params:()=>({layers:C.ObjectList({script:C.Script(Mo("(sel.atom.all)","mol-script")),value:C.Numeric(.5,{min:0,max:1,step:.01},{label:"Emissive"})},e=>`Emissive (${e.value})`,{defaultValue:[{script:Mo("(sel.atom.all)","mol-script"),value:.5}]})})})({canAutoUpdate(){return!0},apply({a:e,params:t}){let r=e.data.sourceData,n=e.data.repr.geometryVersion,o=us.ofScript(t.layers,r);return new ne.Molecule.Structure.Representation3DState({state:{emissive:o},initialState:{emissive:us.Empty},info:{structure:r,geometryVersion:n},repr:e.data.repr},{label:`Emissive (${o.layers.length} Layers)`})},update({a:e,b:t,newParams:r,oldParams:n}){let o=t.data.info,i=e.data.sourceData;if(i!==o.structure)return et.UpdateResult.Recreate;if(e.data.repr!==t.data.repr)return et.UpdateResult.Recreate;let a=e.data.repr.geometryVersion;if(a!==o.geometryVersion&&Om(e.data.repr.props))return et.UpdateResult.Recreate;let s=t.data.state.emissive,l=us.ofScript(r.layers,i);return us.areEqual(s,l)?et.UpdateResult.Unchanged:(o.geometryVersion=a,t.data.state.emissive=l,t.data.repr=e.data.repr,t.label=`Emissive (${l.layers.length} Layers)`,et.UpdateResult.Updated)}}),ont=Vt.BuiltIn({name:"emissive-structure-representation-3d-from-bundle",display:"Emissive 3D Representation",from:ne.Molecule.Structure.Representation3D,to:ne.Molecule.Structure.Representation3DState,params:()=>({layers:C.ObjectList({bundle:C.Value(Q.Bundle.Empty),value:C.Numeric(.5,{min:0,max:1,step:.01},{label:"Emissive"})},e=>`Emissive (${e.value})`,{defaultValue:[{bundle:Q.Bundle.Empty,value:.5}],isHidden:!0})})})({canAutoUpdate(){return!0},apply({a:e,params:t}){let r=e.data.sourceData,n=e.data.repr.geometryVersion,o=us.ofBundle(t.layers,r);return new ne.Molecule.Structure.Representation3DState({state:{emissive:o},initialState:{emissive:us.Empty},info:{structure:r,geometryVersion:n},repr:e.data.repr},{label:`Emissive (${o.layers.length} Layers)`})},update({a:e,b:t,newParams:r,oldParams:n}){let o=t.data.info,i=e.data.sourceData;if(i!==o.structure)return et.UpdateResult.Recreate;if(e.data.repr!==t.data.repr)return et.UpdateResult.Recreate;let a=e.data.repr.geometryVersion;if(a!==o.geometryVersion&&Om(e.data.repr.props))return et.UpdateResult.Recreate;let s=t.data.state.emissive,l=us.ofBundle(r.layers,i);return us.areEqual(s,l)?et.UpdateResult.Unchanged:(o.geometryVersion=a,t.data.state.emissive=l,t.data.repr=e.data.repr,t.label=`Emissive (${l.layers.length} Layers)`,et.UpdateResult.Updated)}}),int=Vt.BuiltIn({name:"substance-structure-representation-3d-from-script",display:"Substance 3D Representation",from:ne.Molecule.Structure.Representation3D,to:ne.Molecule.Structure.Representation3DState,params:()=>({layers:C.ObjectList({script:C.Script(Mo("(sel.atom.all)","mol-script")),material:Hi.getParam(),clear:C.Boolean(!1)},e=>`${e.clear?"Clear":Hi.toString(e.material)}`,{defaultValue:[{script:Mo("(sel.atom.all)","mol-script"),material:Hi({roughness:1}),clear:!1}]})})})({canAutoUpdate(){return!0},apply({a:e,params:t}){let r=e.data.sourceData,n=e.data.repr.geometryVersion,o=ls.ofScript(t.layers,r);return new ne.Molecule.Structure.Representation3DState({state:{substance:o},initialState:{substance:ls.Empty},info:{structure:r,geometryVersion:n},repr:e.data.repr},{label:`Substance (${o.layers.length} Layers)`})},update({a:e,b:t,newParams:r,oldParams:n}){let o=t.data.info,i=e.data.sourceData;if(i!==o.structure)return et.UpdateResult.Recreate;if(e.data.repr!==t.data.repr)return et.UpdateResult.Recreate;let a=e.data.repr.geometryVersion;if(a!==o.geometryVersion&&Om(e.data.repr.props))return et.UpdateResult.Recreate;let s=t.data.state.substance,l=ls.ofScript(r.layers,i);return ls.areEqual(s,l)?et.UpdateResult.Unchanged:(o.geometryVersion=a,t.data.state.substance=l,t.data.repr=e.data.repr,t.label=`Substance (${l.layers.length} Layers)`,et.UpdateResult.Updated)}}),ant=Vt.BuiltIn({name:"substance-structure-representation-3d-from-bundle",display:"Substance 3D Representation",from:ne.Molecule.Structure.Representation3D,to:ne.Molecule.Structure.Representation3DState,params:()=>({layers:C.ObjectList({bundle:C.Value(Q.Bundle.Empty),material:Hi.getParam(),clear:C.Boolean(!1)},e=>`${e.clear?"Clear":Hi.toString(e.material)}`,{defaultValue:[{bundle:Q.Bundle.Empty,material:Hi({roughness:1}),clear:!1}],isHidden:!0})})})({canAutoUpdate(){return!0},apply({a:e,params:t}){let r=e.data.sourceData,n=e.data.repr.geometryVersion,o=ls.ofBundle(t.layers,r);return new ne.Molecule.Structure.Representation3DState({state:{substance:o},initialState:{substance:ls.Empty},info:{structure:r,geometryVersion:n},repr:e.data.repr},{label:`Substance (${o.layers.length} Layers)`})},update({a:e,b:t,newParams:r,oldParams:n}){let o=t.data.info,i=e.data.sourceData;if(i!==o.structure)return et.UpdateResult.Recreate;if(e.data.repr!==t.data.repr)return et.UpdateResult.Recreate;let a=e.data.repr.geometryVersion;if(a!==o.geometryVersion&&Om(e.data.repr.props))return et.UpdateResult.Recreate;let s=t.data.state.substance,l=ls.ofBundle(r.layers,i);return ls.areEqual(s,l)?et.UpdateResult.Unchanged:(o.geometryVersion=a,t.data.state.substance=l,t.data.repr=e.data.repr,t.label=`Substance (${l.layers.length} Layers)`,et.UpdateResult.Updated)}}),snt=Vt.BuiltIn({name:"clipping-structure-representation-3d-from-script",display:"Clipping 3D Representation",from:ne.Molecule.Structure.Representation3D,to:ne.Molecule.Structure.Representation3DState,params:()=>({layers:C.ObjectList({script:C.Script(Mo("(sel.atom.all)","mol-script")),groups:C.Converted(e=>Io.Groups.toNames(e),e=>Io.Groups.fromNames(e),C.MultiSelect(bS(Io.Groups.Names),C.objectToOptions(Io.Groups.Names)))},e=>`${Io.Groups.toNames(e.groups).length} group(s)`,{defaultValue:[{script:Mo("(sel.atom.all)","mol-script"),groups:Io.Groups.Flag.None}]})})})({canAutoUpdate(){return!0},apply({a:e,params:t}){let r=e.data.sourceData,n=Io.ofScript(t.layers,r);return new ne.Molecule.Structure.Representation3DState({state:{clipping:n},initialState:{clipping:Io.Empty},info:r,repr:e.data.repr},{label:`Clipping (${n.layers.length} Layers)`})},update({a:e,b:t,newParams:r,oldParams:n}){let o=t.data.info;if(e.data.sourceData!==o)return et.UpdateResult.Recreate;if(e.data.repr!==t.data.repr)return et.UpdateResult.Recreate;let i=t.data.state.clipping,a=Io.ofScript(r.layers,o);return Io.areEqual(i,a)?et.UpdateResult.Unchanged:(t.data.state.clipping=a,t.data.repr=e.data.repr,t.label=`Clipping (${a.layers.length} Layers)`,et.UpdateResult.Updated)}}),lnt=Vt.BuiltIn({name:"clipping-structure-representation-3d-from-bundle",display:"Clipping 3D Representation",from:ne.Molecule.Structure.Representation3D,to:ne.Molecule.Structure.Representation3DState,params:()=>({layers:C.ObjectList({bundle:C.Value(Q.Bundle.Empty),groups:C.Converted(e=>Io.Groups.toNames(e),e=>Io.Groups.fromNames(e),C.MultiSelect(bS(Io.Groups.Names),C.objectToOptions(Io.Groups.Names)))},e=>`${Io.Groups.toNames(e.groups).length} group(s)`,{defaultValue:[{bundle:Q.Bundle.Empty,groups:Io.Groups.Flag.None}],isHidden:!0})})})({canAutoUpdate(){return!0},apply({a:e,params:t}){let r=e.data.sourceData,n=Io.ofBundle(t.layers,r);return new ne.Molecule.Structure.Representation3DState({state:{clipping:n},initialState:{clipping:Io.Empty},info:r,repr:e.data.repr},{label:`Clipping (${n.layers.length} Layers)`})},update({a:e,b:t,newParams:r,oldParams:n}){let o=t.data.info;if(e.data.sourceData!==o)return et.UpdateResult.Recreate;if(e.data.repr!==t.data.repr)return et.UpdateResult.Recreate;let i=t.data.state.clipping,a=Io.ofBundle(r.layers,o);return Io.areEqual(i,a)?et.UpdateResult.Unchanged:(t.data.state.clipping=a,t.data.repr=e.data.repr,t.label=`Clipping (${a.layers.length} Layers)`,et.UpdateResult.Updated)}}),unt=Vt.BuiltIn({name:"theme-strength-representation-3d",display:"Theme Strength 3D Representation",from:ne.Molecule.Structure.Representation3D,to:ne.Molecule.Structure.Representation3DState,params:()=>({overpaintStrength:C.Numeric(1,{min:0,max:1,step:.01}),transparencyStrength:C.Numeric(1,{min:0,max:1,step:.01}),emissiveStrength:C.Numeric(1,{min:0,max:1,step:.01}),substanceStrength:C.Numeric(1,{min:0,max:1,step:.01})})})({canAutoUpdate(){return!0},apply({a:e,params:t}){return new ne.Molecule.Structure.Representation3DState({state:{themeStrength:{overpaint:t.overpaintStrength,transparency:t.transparencyStrength,emissive:t.emissiveStrength,substance:t.substanceStrength}},initialState:{themeStrength:{overpaint:1,transparency:1,emissive:1,substance:1}},info:{},repr:e.data.repr},{label:"Theme Strength",description:`${t.overpaintStrength.toFixed(2)}, ${t.transparencyStrength.toFixed(2)}, ${t.emissiveStrength.toFixed(2)}, ${t.substanceStrength.toFixed(2)}`})},update({a:e,b:t,newParams:r,oldParams:n}){return r.overpaintStrength===t.data.state.themeStrength?.overpaint&&r.transparencyStrength===t.data.state.themeStrength?.transparency&&r.emissiveStrength===t.data.state.themeStrength?.emissive&&r.substanceStrength===t.data.state.themeStrength?.substance?et.UpdateResult.Unchanged:(t.data.state.themeStrength={overpaint:r.overpaintStrength,transparency:r.transparencyStrength,emissive:r.emissiveStrength,substance:r.substanceStrength},t.data.repr=e.data.repr,t.label="Theme Strength",t.description=`${r.overpaintStrength.toFixed(2)}, ${r.transparencyStrength.toFixed(2)}, ${r.emissiveStrength.toFixed(2)}, ${r.substanceStrength.toFixed(2)}`,et.UpdateResult.Updated)},interpolate(e,t,r){return{overpaintStrength:to(e.overpaintStrength,t.overpaintStrength,r),transparencyStrength:to(e.transparencyStrength,t.transparencyStrength,r),emissiveStrength:to(e.emissiveStrength,t.emissiveStrength,r),substanceStrength:to(e.substanceStrength,t.substanceStrength,r)}}}),nh;(n=>{function e(o,i,a,s,l,u,c,m){let d=o.representation.volume.registry.get(i),p=o.representation.volume.themes.colorThemeRegistry.get(l||d.defaultColorTheme.name),h=o.representation.volume.themes.sizeThemeRegistry.get(c||d.defaultSizeTheme.name),f=C.getDefaultValues(d.getParams(o.representation.volume.themes,a));return{type:{name:i,params:s?{...f,...s}:f},colorTheme:{name:p.name,params:u?{...p.defaultValues,...u}:p.defaultValues},sizeTheme:{name:h.name,params:m?{...h.defaultValues,...m}:h.defaultValues}}}n.getDefaultParams=e;function t(o,i,a,s,l,u,c){let m=o.representation.volume.registry.get(i),d=o.representation.volume.themes.colorThemeRegistry.get(s||m.defaultColorTheme.name),p=o.representation.volume.themes.sizeThemeRegistry.get(u||m.defaultSizeTheme.name);return{type:{name:i,params:a?{...m.defaultValues,...a}:m.defaultValues},colorTheme:{name:m.defaultColorTheme.name,params:l?{...d.defaultValues,...l}:d.defaultValues},sizeTheme:{name:m.defaultSizeTheme.name,params:c?{...p.defaultValues,...c}:p.defaultValues}}}n.getDefaultParamsStatic=t;function r(o){if(o.isoValue)return Ge.IsoValue.toString(o.isoValue);if(o.renderMode?.params?.isoValue)return Ge.IsoValue.toString(o.renderMode?.params?.isoValue)}n.getDescription=r})(nh||={});var tX=Vt.BuiltIn({name:"volume-representation-3d",display:"3D Representation",from:ne.Volume.Data,to:ne.Volume.Representation3D,params:(e,t)=>{let{registry:r,themes:n}=t.representation.volume,o=r.get(r.default.name);if(!e)return{type:C.Mapped(r.default.name,r.types,a=>C.Group(r.get(a).getParams(n,Ge.One))),colorTheme:C.Mapped(o.defaultColorTheme.name,n.colorThemeRegistry.types,a=>C.Group(n.colorThemeRegistry.get(a).getParams({volume:Ge.One}))),sizeTheme:C.Mapped(o.defaultSizeTheme.name,n.sizeThemeRegistry.types,a=>C.Group(n.sizeThemeRegistry.get(a).getParams({volume:Ge.One})))};let i={volume:e.data};return{type:C.Mapped(r.default.name,r.types,a=>C.Group(r.get(a).getParams(n,e.data))),colorTheme:C.Mapped(o.defaultColorTheme.name,n.colorThemeRegistry.getApplicableTypes(i),a=>C.Group(n.colorThemeRegistry.get(a).getParams(i))),sizeTheme:C.Mapped(o.defaultSizeTheme.name,n.sizeThemeRegistry.getApplicableTypes(i),a=>C.Group(n.sizeThemeRegistry.get(a).getParams(i)))}}})({canAutoUpdate({oldParams:e,newParams:t}){return e.type.name===t.type.name},apply({a:e,params:t},r){return Ae.create("Volume Representation",async n=>{let o={runtime:n,assetManager:r.managers.asset,errorContext:r.errorContext},i=r.representation.volume.registry.get(t.type.name);i.ensureCustomProperties&&await i.ensureCustomProperties.attach(o,e.data);let a=i.factory({webgl:r.canvas3d?.webgl,...r.representation.volume.themes},i.getParams);a.setTheme(Ii.create(r.representation.volume.themes,{volume:e.data,locationKinds:i.locationKinds},t));let s=t.type.params||{};return await a.createOrUpdate(s,e.data).runInContext(n),new ne.Volume.Representation3D({repr:a,sourceData:e.data},{label:i.label,description:nh.getDescription(s)})})},update({a:e,b:t,oldParams:r,newParams:n},o){return Ae.create("Volume Representation",async i=>{let a=o.representation.volume.registry.get(r.type.name);if(n.type.name!==r.type.name)return a.ensureCustomProperties?.detach(e.data),et.UpdateResult.Recreate;let s={...t.data.repr.props,...n.type.params};return t.data.repr.setTheme(Ii.create(o.representation.volume.themes,{volume:e.data,locationKinds:a.locationKinds},n)),await t.data.repr.createOrUpdate(s,e.data).runInContext(i),t.data.sourceData=e.data,t.description=nh.getDescription(s),et.UpdateResult.Updated})}});var cnt=Vt.BuiltIn({name:"shape-representation-3d",display:"3D Representation",from:ne.Shape.Provider,to:ne.Shape.Representation3D,params:(e,t)=>e?e.data.params:Xe.Params})({canAutoUpdate(){return!0},apply({a:e,params:t}){return Ae.create("Shape Representation",async r=>{let n={...C.getDefaultValues(e.data.params),...t},o=Ci(e.data.getShape,e.data.geometryUtils);return await o.createOrUpdate(n,e.data.data).runInContext(r),new ne.Shape.Representation3D({repr:o,sourceData:e.data},{label:e.data.label})})},update({a:e,b:t,newParams:r}){return Ae.create("Shape Representation",async n=>{let o={...t.data.repr.props,...r};return await t.data.repr.createOrUpdate(o,e.data.data).runInContext(n),t.data.sourceData=e.data,et.UpdateResult.Updated})}});var mnt=Vt.BuiltIn({name:"model-unitcell-3d",display:"Model Unit Cell",from:ne.Molecule.Model,to:ne.Shape.Representation3D,params:()=>({...zW})})({isApplicable:e=>!!Qo.Provider.get(e.data),canAutoUpdate({oldParams:e,newParams:t}){return!0},apply({a:e,params:t},r){return Ae.create("Model Unit Cell",async n=>{let o=Qo.Provider.get(e.data);if(!o)return Gn.Null;let i=HW(e.data,o,t),a=m1e({webgl:r.canvas3d?.webgl,...r.representation.structure.themes},()=>zW);return await a.createOrUpdate(t,i).runInContext(n),new ne.Shape.Representation3D({repr:a,sourceData:i},{label:"Unit Cell",description:o.spacegroup.name})})},update({a:e,b:t,newParams:r}){return Ae.create("Model Unit Cell",async n=>{let o=Qo.Provider.get(e.data);if(!o)return et.UpdateResult.Null;let i={...t.data.repr.props,...r},a=HW(e.data,o,i);return await t.data.repr.createOrUpdate(i,a).runInContext(n),t.data.sourceData=a,et.UpdateResult.Updated})}});var dnt=Vt.BuiltIn({name:"structure-bounding-box-3d",display:"Bounding Box",from:ne.Molecule.Structure,to:ne.Shape.Representation3D,params:{radius:C.Numeric(.05,{min:.01,max:4,step:.01},{isEssential:!0}),color:C.Color(Lt.red,{isEssential:!0}),...ft.Params}})({canAutoUpdate(){return!0},apply({a:e,params:t},r){return Ae.create("Bounding Box",async n=>{let o=Ci((i,a,s,l)=>{let u=QF(a.box,a.radius,l?.geometry);return Wr.create("Bouding Box",a,u,()=>a.color,()=>1,()=>"Bounding Box")},ft.Utils);return await o.createOrUpdate(t,{box:e.data.boundary.box,radius:t.radius,color:t.color}).runInContext(n),new ne.Shape.Representation3D({repr:o,sourceData:e.data},{label:"Bounding Box"})})},update({a:e,b:t,oldParams:r,newParams:n},o){return Ae.create("Bounding Box",async i=>(await t.data.repr.createOrUpdate(n,{box:e.data.boundary.box,radius:n.radius,color:n.color}).runInContext(i),t.data.sourceData=e.data,et.UpdateResult.Updated))}});var pnt=Vt.BuiltIn({name:"structure-selections-distance-3d",display:"3D Distance",from:ne.Molecule.Structure.Selections,to:ne.Shape.Representation3D,params:()=>({...WW})})({canAutoUpdate({oldParams:e,newParams:t}){return!0},apply({a:e,params:t},r){return Ae.create("Structure Distance",async n=>{let o=eW(e.data),i=b1e({webgl:r.canvas3d?.webgl,...r.representation.structure.themes},()=>WW);return await i.createOrUpdate(t,o).runInContext(n),new ne.Shape.Representation3D({repr:i,sourceData:o},{label:"Distance"})})},update({a:e,b:t,oldParams:r,newParams:n},o){return Ae.create("Structure Distance",async i=>{let a={...t.data.repr.props,...n},s=eW(e.data);return await t.data.repr.createOrUpdate(a,s).runInContext(i),t.data.sourceData=s,et.UpdateResult.Updated})}});var fnt=Vt.BuiltIn({name:"structure-selections-angle-3d",display:"3D Angle",from:ne.Molecule.Structure.Selections,to:ne.Shape.Representation3D,params:()=>({...YW})})({canAutoUpdate({oldParams:e,newParams:t}){return!0},apply({a:e,params:t},r){return Ae.create("Structure Angle",async n=>{let o=tW(e.data),i=M1e({webgl:r.canvas3d?.webgl,...r.representation.structure.themes},()=>YW);return await i.createOrUpdate(t,o).runInContext(n),new ne.Shape.Representation3D({repr:i,sourceData:o},{label:"Angle"})})},update({a:e,b:t,oldParams:r,newParams:n},o){return Ae.create("Structure Angle",async i=>{let a={...t.data.repr.props,...n},s=tW(e.data);return await t.data.repr.createOrUpdate(a,s).runInContext(i),t.data.sourceData=s,et.UpdateResult.Updated})}});var hnt=Vt.BuiltIn({name:"structure-selections-dihedral-3d",display:"3D Dihedral",from:ne.Molecule.Structure.Selections,to:ne.Shape.Representation3D,params:()=>({...KW})})({canAutoUpdate({oldParams:e,newParams:t}){return!0},apply({a:e,params:t},r){return Ae.create("Structure Dihedral",async n=>{let o=rW(e.data),i=F1e({webgl:r.canvas3d?.webgl,...r.representation.structure.themes},()=>KW);return await i.createOrUpdate(t,o).runInContext(n),new ne.Shape.Representation3D({repr:i,sourceData:o},{label:"Dihedral"})})},update({a:e,b:t,oldParams:r,newParams:n},o){return Ae.create("Structure Dihedral",async i=>{let a={...t.data.repr.props,...n},s=rW(e.data);return await t.data.repr.createOrUpdate(a,s).runInContext(i),t.data.sourceData=s,et.UpdateResult.Updated})}});var gnt=Vt.BuiltIn({name:"structure-selections-label-3d",display:"3D Label",from:ne.Molecule.Structure.Selections,to:ne.Shape.Representation3D,params:()=>({...XW})})({canAutoUpdate({oldParams:e,newParams:t}){return!0},apply({a:e,params:t},r){return Ae.create("Structure Label",async n=>{let o=nW(e.data),i=C1e({webgl:r.canvas3d?.webgl,...r.representation.structure.themes},()=>XW);await i.createOrUpdate(t,o).runInContext(n);let a=!!(t.snapshotKey?.trim()||t.tooltip?.trim());return i.setState({pickable:a,markerActions:a?ii.Highlighting:0}),new ne.Shape.Representation3D({repr:i,sourceData:o},{label:"Label"})})},update({a:e,b:t,oldParams:r,newParams:n},o){return Ae.create("Structure Label",async i=>{let a={...t.data.repr.props,...n},s=nW(e.data);await t.data.repr.createOrUpdate(a,s).runInContext(i),t.data.sourceData=s;let l=!!(n.snapshotKey?.trim()||n.tooltip?.trim());return t.data.repr.setState({pickable:l,markerActions:l?ii.Highlighting:0}),et.UpdateResult.Updated})}});var ynt=Vt.BuiltIn({name:"structure-selections-orientation-3d",display:"3D Orientation",from:ne.Molecule.Structure.Selections,to:ne.Shape.Representation3D,params:()=>({...qW})})({canAutoUpdate({oldParams:e,newParams:t}){return!0},apply({a:e,params:t},r){return Ae.create("Structure Orientation",async n=>{let o=oW(e.data),i=P1e({webgl:r.canvas3d?.webgl,...r.representation.structure.themes},()=>qW);return await i.createOrUpdate(t,o).runInContext(n),new ne.Shape.Representation3D({repr:i,sourceData:o},{label:"Orientation"})})},update({a:e,b:t,oldParams:r,newParams:n},o){return Ae.create("Structure Orientation",async i=>{let a={...t.data.repr.props,...n},s=oW(e.data);return await t.data.repr.createOrUpdate(a,s).runInContext(i),t.data.sourceData=s,et.UpdateResult.Updated})}});var bnt=Vt.BuiltIn({name:"structure-selections-plane-3d",display:"3D Plane",from:ne.Molecule.Structure.Selections,to:ne.Shape.Representation3D,params:()=>({...eX})})({canAutoUpdate({oldParams:e,newParams:t}){return!0},apply({a:e,params:t},r){return Ae.create("Structure Plane",async n=>{let o=iW(e.data),i=G1e({webgl:r.canvas3d?.webgl,...r.representation.structure.themes},()=>eX);return await i.createOrUpdate(t,o).runInContext(n),new ne.Shape.Representation3D({repr:i,sourceData:o},{label:"Plane"})})},update({a:e,b:t,oldParams:r,newParams:n},o){return Ae.create("Structure Plane",async i=>{let a={...t.data.repr.props,...n},s=iW(e.data);return await t.data.repr.createOrUpdate(a,s).runInContext(i),t.data.sourceData=s,et.UpdateResult.Updated})}});var Qe={Data:f8,Misc:h8,Model:PW,Volume:BW,Representation:rX,Shape:JW};function so(e,t,r={}){let n;return{label:e,expression:t,description:r.description||"",category:r.category??"Miscellaneous",isHidden:!!r.isHidden,priority:r.priority||0,referencesCurrent:!!r.referencesCurrent,get query(){return n||(n=Wc(t)),n},ensureCustomProperties:r.ensureCustomProperties,async getSelection(o,i,a){let s=o.managers.structure.selection.getStructure(a),l=s?ut.Sequence(a,[s]):ut.Empty(a);return r.ensureCustomProperties&&await r.ensureCustomProperties({runtime:i,assetManager:o.managers.asset},a),n||(n=Wc(t)),n(new zo(a,{currentSelection:l}))}}}var xnt=so("All",ie.struct.generator.all(),{category:"",priority:1e3}),Cnt=so("Current Selection",ie.internal.generator.current(),{category:"",referencesCurrent:!0}),Snt=so("Polymer",ie.struct.modifier.union([ie.struct.generator.atomGroups({"entity-test":ie.core.logic.and([ie.core.rel.eq([ie.ammp("entityType"),"polymer"]),ie.core.str.match([ie.re("(polypeptide|cyclic-pseudo-peptide|peptide-like|nucleotide|peptide nucleic acid)","i"),ie.ammp("entitySubtype")])])})]),{category:"Type"}),vnt=so("Trace",ie.struct.modifier.union([ie.struct.combinator.merge([ie.struct.modifier.union([ie.struct.generator.atomGroups({"entity-test":ie.core.rel.eq([ie.ammp("entityType"),"polymer"]),"chain-test":ie.core.set.has([ie.set("sphere","gaussian"),ie.ammp("objectPrimitive")])})]),ie.struct.modifier.union([ie.struct.generator.atomGroups({"entity-test":ie.core.rel.eq([ie.ammp("entityType"),"polymer"]),"chain-test":ie.core.rel.eq([ie.ammp("objectPrimitive"),"atomistic"]),"atom-test":ie.core.set.has([ie.set("CA","P"),ie.ammp("label_atom_id")])})])])]),{category:"Structure Property"}),BA=ie.core.logic.and([ie.core.rel.eq([ie.ammp("entityType"),"polymer"]),ie.core.str.match([ie.re("(polypeptide|cyclic-pseudo-peptide|peptide-like)","i"),ie.ammp("entitySubtype")])]),qF=ie.core.logic.and([ie.core.rel.eq([ie.ammp("entityType"),"polymer"]),ie.core.str.match([ie.re("(nucleotide|peptide nucleic acid)","i"),ie.ammp("entitySubtype")])]),s1=ie.core.str.match([ie.re("non-polymer|(amino|carboxy) terminus|peptide-like","i"),ie.ammp("chemCompType")]),Int=so("Backbone",ie.struct.modifier.union([ie.struct.combinator.merge([ie.struct.modifier.union([ie.struct.generator.atomGroups({"entity-test":BA,"chain-test":ie.core.rel.eq([ie.ammp("objectPrimitive"),"atomistic"]),"residue-test":ie.core.logic.not([s1]),"atom-test":ie.core.set.has([ie.set(...go.toArray(Id)),ie.ammp("label_atom_id")])})]),ie.struct.modifier.union([ie.struct.generator.atomGroups({"entity-test":qF,"chain-test":ie.core.rel.eq([ie.ammp("objectPrimitive"),"atomistic"]),"residue-test":ie.core.logic.not([s1]),"atom-test":ie.core.set.has([ie.set(...go.toArray(CI)),ie.ammp("label_atom_id")])})])])]),{category:"Structure Property"}),Ant=so("Sidechain",ie.struct.modifier.union([ie.struct.combinator.merge([ie.struct.modifier.union([ie.struct.generator.atomGroups({"entity-test":BA,"chain-test":ie.core.rel.eq([ie.ammp("objectPrimitive"),"atomistic"]),"residue-test":ie.core.logic.not([s1]),"atom-test":ie.core.logic.or([ie.core.logic.not([ie.core.set.has([ie.set(...go.toArray(Id)),ie.ammp("label_atom_id")])])])})]),ie.struct.modifier.union([ie.struct.generator.atomGroups({"entity-test":qF,"chain-test":ie.core.rel.eq([ie.ammp("objectPrimitive"),"atomistic"]),"residue-test":ie.core.logic.not([s1]),"atom-test":ie.core.logic.or([ie.core.logic.not([ie.core.set.has([ie.set(...go.toArray(CI)),ie.ammp("label_atom_id")])])])})])])]),{category:"Structure Property"}),Tnt=so("Sidechain with Trace",ie.struct.modifier.union([ie.struct.combinator.merge([ie.struct.modifier.union([ie.struct.generator.atomGroups({"entity-test":BA,"chain-test":ie.core.rel.eq([ie.ammp("objectPrimitive"),"atomistic"]),"residue-test":ie.core.logic.not([s1]),"atom-test":ie.core.logic.or([ie.core.logic.not([ie.core.set.has([ie.set(...go.toArray(Id)),ie.ammp("label_atom_id")])]),ie.core.rel.eq([ie.ammp("label_atom_id"),"CA"]),ie.core.logic.and([ie.core.rel.eq([ie.ammp("auth_comp_id"),"PRO"]),ie.core.rel.eq([ie.ammp("label_atom_id"),"N"])])])})]),ie.struct.modifier.union([ie.struct.generator.atomGroups({"entity-test":qF,"chain-test":ie.core.rel.eq([ie.ammp("objectPrimitive"),"atomistic"]),"residue-test":ie.core.logic.not([s1]),"atom-test":ie.core.logic.or([ie.core.logic.not([ie.core.set.has([ie.set(...go.toArray(CI)),ie.ammp("label_atom_id")])]),ie.core.rel.eq([ie.ammp("label_atom_id"),"P"])])})])])]),{category:"Structure Property"}),Pnt=so("Protein",ie.struct.modifier.union([ie.struct.generator.atomGroups({"entity-test":BA})]),{category:"Type"}),_nt=so("Nucleic",ie.struct.modifier.union([ie.struct.generator.atomGroups({"entity-test":qF})]),{category:"Type"}),Rnt=so("Helix",ie.struct.modifier.union([ie.struct.generator.atomGroups({"entity-test":BA,"residue-test":ie.core.flags.hasAny([ie.ammp("secondaryStructureFlags"),ie.core.type.bitflags([rr.Flag.Helix])])})]),{category:"Structure Property",ensureCustomProperties:(e,t)=>ol.attach(e,t)}),Dnt=so("Beta Strand/Sheet",ie.struct.modifier.union([ie.struct.generator.atomGroups({"entity-test":BA,"residue-test":ie.core.flags.hasAny([ie.ammp("secondaryStructureFlags"),ie.core.type.bitflags([rr.Flag.Beta])])})]),{category:"Structure Property",ensureCustomProperties:(e,t)=>ol.attach(e,t)}),wnt=so("Water",ie.struct.modifier.union([ie.struct.generator.atomGroups({"entity-test":ie.core.rel.eq([ie.ammp("entityType"),"water"])})]),{category:"Type"}),Mnt=so("Ion",ie.struct.modifier.union([ie.struct.generator.atomGroups({"entity-test":ie.core.rel.eq([ie.ammp("entitySubtype"),"ion"])})]),{category:"Type"}),Bnt=so("Lipid",ie.struct.modifier.union([ie.struct.generator.atomGroups({"entity-test":ie.core.rel.eq([ie.ammp("entitySubtype"),"lipid"])})]),{category:"Type"}),YF=so("Carbohydrate",ie.struct.modifier.union([ie.struct.generator.atomGroups({"entity-test":ie.core.logic.or([ie.core.rel.eq([ie.ammp("entityType"),"branched"]),ie.core.logic.and([ie.core.rel.eq([ie.ammp("entityType"),"non-polymer"]),ie.core.str.match([ie.re("oligosaccharide","i"),ie.ammp("entitySubtype")])])])})]),{category:"Type"}),U1e=so("Carbohydrate with Connected",ie.struct.modifier.union([ie.struct.modifier.includeConnected({0:YF.expression,"layer-count":1,"as-whole-residues":!0})]),{category:"Internal",isHidden:!0}),N1e=so("Connected to Carbohydrate",ie.struct.modifier.union([ie.struct.modifier.exceptBy({0:U1e.expression,by:YF.expression})]),{category:"Internal",isHidden:!0}),oX=so("Ligand",ie.struct.modifier.union([ie.struct.modifier.exceptBy({0:ie.struct.modifier.union([ie.struct.combinator.merge([ie.struct.modifier.union([ie.struct.generator.atomGroups({"entity-test":ie.core.logic.and([ie.core.logic.or([ie.core.rel.eq([ie.ammp("entityType"),"non-polymer"]),ie.core.rel.neq([ie.ammp("entityPrdId"),""])]),ie.core.logic.not([ie.core.str.match([ie.re("(oligosaccharide|lipid|ion)","i"),ie.ammp("entitySubtype")])])]),"chain-test":ie.core.rel.eq([ie.ammp("objectPrimitive"),"atomistic"]),"residue-test":ie.core.logic.not([ie.core.str.match([ie.re("saccharide","i"),ie.ammp("chemCompType")])])})]),ie.struct.modifier.union([ie.struct.generator.atomGroups({"entity-test":ie.core.rel.eq([ie.ammp("entityType"),"polymer"]),"chain-test":ie.core.rel.eq([ie.ammp("objectPrimitive"),"atomistic"]),"residue-test":s1})])])]),by:ie.struct.combinator.merge([ie.struct.modifier.union([ie.struct.generator.atomGroups({"entity-test":ie.core.rel.eq([ie.ammp("entityType"),"polymer"]),"chain-test":ie.core.rel.eq([ie.ammp("objectPrimitive"),"atomistic"]),"residue-test":ie.core.set.has([ie.set(...go.toArray(Zy)),ie.ammp("label_comp_id")])})]),ie.struct.generator.atomGroups({"chain-test":ie.core.rel.eq([ie.ammp("objectPrimitive"),"atomistic"]),"residue-test":ie.core.set.has([ie.set(...go.toArray(vce)),ie.ammp("label_comp_id")])})])})]),{category:"Type"}),z1e=so("Ligand with Connected",ie.struct.modifier.union([ie.struct.modifier.exceptBy({0:ie.struct.modifier.union([ie.struct.modifier.includeConnected({0:oX.expression,"layer-count":1,"as-whole-residues":!0,"bond-test":ie.core.flags.hasAny([ie.struct.bondProperty.flags(),ie.core.type.bitflags([xt.Flag.Covalent|xt.Flag.MetallicCoordination])])})]),by:YF.expression})]),{category:"Internal",isHidden:!0}),H1e=so("Connected to Ligand",ie.struct.modifier.union([ie.struct.modifier.exceptBy({0:z1e.expression,by:oX.expression})]),{category:"Internal",isHidden:!0}),Ent=so("Connected to Ligand or Carbohydrate",ie.struct.modifier.union([ie.struct.combinator.merge([N1e.expression,H1e.expression])]),{category:"Internal",isHidden:!0}),knt=so("Disulfide Bridges",ie.struct.modifier.union([ie.struct.combinator.merge([ie.struct.modifier.union([ie.struct.modifier.wholeResidues([ie.struct.filter.isConnectedTo({0:ie.struct.generator.atomGroups({"residue-test":ie.core.set.has([ie.set("CYS"),ie.ammp("auth_comp_id")]),"atom-test":ie.core.set.has([ie.set("SG"),ie.ammp("label_atom_id")])}),target:ie.struct.generator.atomGroups({"residue-test":ie.core.set.has([ie.set("CYS"),ie.ammp("auth_comp_id")]),"atom-test":ie.core.set.has([ie.set("SG"),ie.ammp("label_atom_id")])}),"bond-test":!0})])]),ie.struct.modifier.union([ie.struct.modifier.wholeResidues([ie.struct.modifier.union([ie.struct.generator.bondedAtomicPairs({0:ie.core.flags.hasAny([ie.struct.bondProperty.flags(),ie.core.type.bitflags([xt.Flag.Disulfide])])})])])])])]),{category:"Bond Property"}),Fnt=so("NOS Bridges",ie.struct.modifier.union([ie.struct.modifier.wholeResidues([ie.struct.filter.isConnectedTo({0:ie.struct.generator.atomGroups({"residue-test":ie.core.set.has([ie.set("CSO","LYS"),ie.ammp("auth_comp_id")]),"atom-test":ie.core.set.has([ie.set("OD","NZ"),ie.ammp("label_atom_id")])}),target:ie.struct.generator.atomGroups({"residue-test":ie.core.set.has([ie.set("CSO","LYS"),ie.ammp("auth_comp_id")]),"atom-test":ie.core.set.has([ie.set("OD","NZ"),ie.ammp("label_atom_id")])}),"bond-test":!0})])]),{category:"Bond Property"}),Lnt=so("Non-standard Residues in Polymers",ie.struct.modifier.union([ie.struct.generator.atomGroups({"entity-test":ie.core.rel.eq([ie.ammp("entityType"),"polymer"]),"chain-test":ie.core.rel.eq([ie.ammp("objectPrimitive"),"atomistic"]),"residue-test":ie.ammp("isNonStandard")})]),{category:"Residue Property"}),Vnt=so("Coarse Elements",ie.struct.modifier.union([ie.struct.generator.atomGroups({"chain-test":ie.core.set.has([ie.set("sphere","gaussian"),ie.ammp("objectPrimitive")])})]),{category:"Type"}),Ont=so("Rings in Residues",ie.struct.modifier.union([ie.struct.generator.rings()]),{category:"Residue Property"}),Gnt=so("Aromatic Rings in Residues",ie.struct.modifier.union([ie.struct.generator.rings({"only-aromatic":!0})]),{category:"Residue Property"}),Unt=so("Surrounding Residues (5 \u212B) of Selection",ie.struct.modifier.union([ie.struct.modifier.exceptBy({0:ie.struct.modifier.includeSurroundings({0:ie.internal.generator.current(),radius:5,"as-whole-residues":!0}),by:ie.internal.generator.current()})]),{description:"Select residues within 5 \u212B of the current selection.",category:"Manipulate Selection",referencesCurrent:!0}),Nnt=so("Surrounding Ligands (5 \u212B) of Selection",ie.struct.modifier.union([ie.struct.modifier.surroundingLigands({0:ie.internal.generator.current(),radius:5,"include-water":!0})]),{description:"Select ligand components within 5 \u212B of the current selection.",category:"Manipulate Selection",referencesCurrent:!0}),znt=so("Surrounding Atoms (5 \u212B) of Selection",ie.struct.modifier.union([ie.struct.modifier.exceptBy({0:ie.struct.modifier.includeSurroundings({0:ie.internal.generator.current(),radius:5,"as-whole-residues":!1}),by:ie.internal.generator.current()})]),{description:"Select atoms within 5 \u212B of the current selection.",category:"Manipulate Selection",referencesCurrent:!0}),Hnt=so("Inverse / Complement of Selection",ie.struct.modifier.union([ie.struct.modifier.exceptBy({0:ie.struct.generator.all(),by:ie.internal.generator.current()})]),{description:"Select everything not in the current selection.",category:"Manipulate Selection",referencesCurrent:!0}),jnt=so("Residues Covalently Bonded to Selection",ie.struct.modifier.union([ie.struct.modifier.includeConnected({0:ie.internal.generator.current(),"layer-count":1,"as-whole-residues":!0})]),{description:"Select residues covalently bonded to current selection.",category:"Manipulate Selection",referencesCurrent:!0}),Wnt=so("Covalently Bonded Component",ie.struct.modifier.union([ie.struct.modifier.includeConnected({0:ie.internal.generator.current(),"fixed-point":!0})]),{description:"Select covalently bonded component based on current selection.",category:"Manipulate Selection",referencesCurrent:!0}),Xnt=so("Residues with Cov. or Metallic Bond to Selection",ie.struct.modifier.union([ie.struct.modifier.includeConnected({0:ie.internal.generator.current(),"layer-count":1,"as-whole-residues":!0,"bond-test":ie.core.flags.hasAny([ie.struct.bondProperty.flags(),ie.core.type.bitflags([xt.Flag.Covalent|xt.Flag.MetallicCoordination])])})]),{description:"Select residues with covalent or metallic bond to current selection.",category:"Manipulate Selection",referencesCurrent:!0}),Qnt=so("Whole Residues of Selection",ie.struct.modifier.union([ie.struct.modifier.wholeResidues({0:ie.internal.generator.current()})]),{description:"Expand current selection to whole residues.",category:"Manipulate Selection",referencesCurrent:!0}),Znt=[[["HIS"],"Histidine"],[["ARG"],"Arginine"],[["LYS"],"Lysine"],[["ILE"],"Isoleucine"],[["PHE"],"Phenylalanine"],[["LEU"],"Leucine"],[["TRP"],"Tryptophan"],[["ALA"],"Alanine"],[["MET"],"Methionine"],[["PRO"],"Proline"],[["CYS"],"Cysteine"],[["ASN"],"Asparagine"],[["VAL"],"Valine"],[["GLY"],"Glycine"],[["SER"],"Serine"],[["GLN"],"Glutamine"],[["TYR"],"Tyrosine"],[["ASP"],"Aspartic Acid"],[["GLU"],"Glutamic Acid"],[["THR"],"Threonine"],[["SEC"],"Selenocysteine"],[["PYL"],"Pyrrolysine"],[["UNK"],"Unknown"]].sort((e,t)=>e[1]<t[1]?-1:e[1]>t[1]?1:0),qnt=[[["A","DA"],"Adenosine"],[["C","DC"],"Cytidine"],[["T","DT"],"Thymidine"],[["G","DG"],"Guanosine"],[["I","DI"],"Inosine"],[["U","DU"],"Uridine"],[["N","DN"],"Unknown"]].sort((e,t)=>e[1]<t[1]?-1:e[1]>t[1]?1:0);function nX([e,t],r,n=0){let o=e.length===1&&!j1e.has(e[0])?`[${e[0]}] ${t}`:`${t} (${e.join(", ")})`;return so(o,ie.struct.modifier.union([ie.struct.generator.atomGroups({"residue-test":ie.core.set.has([ie.set(...e),ie.ammp("auth_comp_id")])})]),{category:r,priority:n,description:o})}function Ynt([e,t],r,n){let o=`${t} (${e.join(", ")})`;return so(o,ie.struct.modifier.union([ie.struct.generator.atomGroups({"atom-test":ie.core.set.has([ie.set(...e),ie.acp("elementSymbol")])})]),{category:r,priority:n,description:o})}function Knt([e,t],r,n){let o=`${t}`;return so(`${t}`,ie.struct.modifier.union([ie.struct.generator.atomGroups({"entity-test":ie.core.list.equal([ie.list(...e),ie.ammp("entityDescription")])})]),{category:r,priority:n,description:o})}var j1e=go.unionMany(cE,vI,II,SI);function W1e(e){let t=new Set;for(let n of e)n.uniqueElementSymbols.forEach(o=>t.add(o));let r=[];return t.forEach(n=>{let o=Mme[n]||n;r.push(Ynt([[n],o],"Element Symbol",0))}),r}function X1e(e){let t=new Map,r=new Set;for(let o of e){o.uniqueResidueNames.forEach(i=>r.add(i));for(let i of o.models)o.uniqueResidueNames.forEach(a=>{let s=i.properties.chemicalComponentMap.get(a);s&&t.set(a,s.name)})}let n=[];return go.difference(r,j1e).forEach(o=>{let i=t.get(o)||o;n.push(nX([[o],i],"Ligand/Non-standard Residue",200))}),n}function Q1e(e){let t=new Map,r=Q.Location.create();for(let o of e){r.structure=o;for(let i of o.unitSymmetryGroups){r.unit=i.units[0],r.element=i.elements[0];let a=Ke.entity.type(r);if(a==="polymer"||a==="branched"){let s=Ke.entity.pdbx_description(r);t.set(s.join(", "),s)}}}let n=[];return t.forEach((o,i)=>{n.push(Knt([o,i],"Polymer/Carbohydrate Entities",300))}),n}var oi={all:xnt,current:Cnt,polymer:Snt,trace:vnt,backbone:Int,sidechain:Ant,sidechainWithTrace:Tnt,protein:Pnt,nucleic:_nt,helix:Rnt,beta:Dnt,water:wnt,ion:Mnt,lipid:Bnt,branched:YF,branchedPlusConnected:U1e,branchedConnectedOnly:N1e,ligand:oX,ligandPlusConnected:z1e,ligandConnectedOnly:H1e,connectedOnly:Ent,disulfideBridges:knt,nosBridges:Fnt,nonStandardPolymer:Lnt,coarse:Vnt,ring:Ont,aromaticRing:Gnt,surroundings:Unt,surroundingLigands:Nnt,surroundingAtoms:znt,complement:Hnt,covalentlyBonded:jnt,covalentlyOrMetallicBonded:Xnt,covalentlyBondedComponent:Wnt,wholeResidues:Qnt},ZF=class{constructor(){this.list=[];this.options=[];this.version=1;this.list.push(...Object.values(oi),...Znt.map(t=>nX(t,"Amino Acid")),...qnt.map(t=>nX(t,"Nucleic Base"))),this.options.push(...this.list.map(t=>[t,t.label,t.category]))}add(t){this.list.push(t),this.options.push([t,t.label,t.category]),this.version+=1}remove(t){let r=this.list.indexOf(t);r!==-1&&(this.list.splice(r,1),this.options.splice(r,1),this.version+=1)}};var Jnt="Assigns a color based on structure property at a given vertex.",Z1e={structure:C.ValueRef(e=>e.state.data.select(tr.Generators.rootsOfType(ne.Molecule.Structure)).filter(r=>r.obj?.data).map(r=>[r.transform.ref,r.obj?.label??"<unknown>"]),(e,t)=>t(e)),style:C.MappedStatic("chain-id",{"chain-id":C.Group(mg),"entity-id":C.Group(fg),"entity-source":C.Group(gg),"molecule-type":C.Group(yC),"model-index":C.Group(bg),"structure-index":C.Group(Cg)}),defaultColor:C.Color(13421772),maxDistance:C.Numeric(8,{min:.1,max:24,step:.1},{description:"Maximum distance to search for the nearest structure element. This is done only if the approximate search fails."}),approxMaxDistance:C.Numeric(4,{min:0,max:12,step:.1},{description:"Maximum distance to search for an approximately nearest structure element. This is done before the extact search."}),normalOffset:C.Numeric(0,{min:-10,max:20,step:.1},{description:"Offset vertex position along its normal by given amount."}),backboneOnly:C.Boolean(!1)};function $nt(e,t){switch(t.name){case"chain-id":return dg(e,t.params);case"entity-id":return hg(e,t.params);case"entity-source":return yg(e,t.params);case"molecule-type":return bC(e,t.params);case"model-index":return xg(e,t.params);case"structure-index":return Sg(e,t.params);default:Mr(t)}}function q1e(e,t){let r;try{r=t.structure.getValue()}catch{}let n,o,i,{maxDistance:a,approxMaxDistance:s,normalOffset:l,defaultColor:u,backboneOnly:c}=t;if(r){let m=$nt({...e,structure:r},t.style),d=kI(),p=kI(),h=r;c&&(h=ut.unionStructure(oi.backbone.query(new zo(r))));let f=b(),g=Q.Location.create(h);n=(y,x)=>{if(!$I(y))return u;l!==0?b.scaleAndAdd(f,y.position,y.normal,l):b.copy(f,y.position);let[S,I,v]=f;if(s>0){let P=h.lookup3d.approxNearest(S,I,v,s,d);if(P.count>0)return g.unit=P.units[0],g.element=g.unit.elements[P.indices[0]],m.color(g,x)}let A=h.lookup3d.find(S,I,v,a,p);if(A.count>0){let P=0,T=A.squaredDistances[0];for(let R=1;R<A.count;++R)A.squaredDistances[R]<T&&(T=A.squaredDistances[R],P=R);return g.unit=A.units[P],g.element=g.unit.elements[A.indices[P]],m.color(g,x)}return u},o=m.contextHash,i=m.legend}else n=()=>u;return{factory:q1e,granularity:"vertex",preferSmoothing:!0,color:n,props:t,contextHash:o,description:Jnt,legend:i}}var Y1e={name:"external-structure",label:"External Structure",category:yr.Misc,factory:q1e,getParams:()=>Z1e,defaultValues:C.getDefaultValues(Z1e),isApplicable:e=>!0};var iX="dark-2",K1e=13421772,eot="Gives every volume instance a unique color based on the position (index) of the instance in the list of instances of the volume.",J1e={...ni({type:"colors",colorList:iX})};function tot(e){let t=C.clone(J1e);return e.volume&&e.volume.instances.length>Sr[iX].list.length&&(t.palette.defaultValue.name="colors",t.palette.defaultValue.params={...t.palette.defaultValue.params,list:{kind:"interpolate",colors:Ka(iX).list}}),t}function $1e(e,t){let r,n;if(e.volume){let o=di(e.volume.instances.length,t);n=o.legend;let i=Ge.Cell.isLocation;r=a=>i(a)?o.color(a.instance):K1e}else r=()=>K1e;return{factory:$1e,granularity:"instance",color:r,props:t,description:eot,legend:n}}var eve={name:"volume-instance",label:"Volume Instance",category:yr.Misc,factory:$1e,getParams:tot,defaultValues:C.getDefaultValues(J1e),isApplicable:e=>!!e.volume};var vs;(c=>{c.Category=yr;function t(m,d,p,h){let f=[];if(m.every(y=>Array.isArray(y))){let y=0;for(let T of m)if(Array.isArray(T)){let R=LS(T[1]);R>y&&(y=R)}let x=Math.pow(10,y),S=[...m];S.sort((T,R)=>T[1]-R[1]);let I=S.map(T=>T[0]),v=Be.ofSortedArray(S.map(T=>T[1])),A=[];for(let T=0,R=v.length-1;T<R;++T)A.push(v[T]+(v[T+1]-v[T])/2);A.push(v[v.length-1]);let P=Be.ofSortedArray(A);for(let T=0,R=Math.max(x,m.length);T<R;++T){let w=wf(T,0,x-1),E=Be.findPredecessorIndex(P,w);f[T]=I[E]}}else for(let y of m)Array.isArray(y)?f.push(y[0]):f.push(y);return{colors:f,filter:d==="set"?"nearest":"linear",domain:p,defaultColor:h}}c.Palette=t,c.PaletteScale=(1<<24)-2,c.EmptyFactory=()=>c.Empty;let o=13421772;c.Empty={factory:c.EmptyFactory,granularity:"uniform",color:()=>o,props:{}};function a(m,d){return m.contextHash===d.contextHash&&m.factory===d.factory&&qi(m.props,d.props)}c.areEqual=a,c.EmptyProvider={name:"",label:"",category:"",factory:c.EmptyFactory,getParams:()=>({}),defaultValues:{},isApplicable:()=>!0};function l(){return new EA(c.BuiltIn,c.EmptyProvider)}c.createRegistry=l,c.BuiltIn={"atom-id":gxe,"carbohydrate-symbol":$pe,cartoon:Rxe,"chain-id":mk,"element-index":dfe,"element-symbol":_fe,"entity-id":ffe,"entity-source":yfe,"external-structure":Y1e,"external-volume":Txe,"formal-charge":Bxe,hydrophobicity:nxe,illustrative:exe,"model-index":xfe,"molecule-type":wfe,occupancy:ixe,"operator-hkl":cxe,"operator-name":JI,"partial-charge":dxe,"polymer-id":Lfe,"polymer-index":Nfe,"residue-charge":Yfe,"residue-name":jfe,"secondary-structure":Jfe,"sequence-id":the,"shape-group":qbe,"structure-index":Sfe,"trajectory-index":Tfe,uncertainty:Kbe,"unit-index":Ife,uniform:tfe,"volume-instance":eve,"volume-segment":vxe,"volume-value":bxe}})(vs||={});var rot=1,not="Assigns a physical size, i.e. vdW radius for atoms or given radius for coarse spheres.",tve={scale:C.Numeric(1,{min:.1,max:5,step:.1})};function oot(e){return tve}function UR(e,t){return ue.isAtomic(e)?Dm(e.model.atomicHierarchy.atoms.type_symbol.value(t)):ue.isSpheres(e)?e.model.coarseConformation.spheres.radius[t]:0}function rve(e,t){let r=t.scale===void 0?1:t.scale;function n(o){let i;return Q.Location.is(o)?i=r*UR(o.unit,o.element):It.isLocation(o)?i=r*Math.min(UR(o.aUnit,o.aUnit.elements[o.aIndex]),UR(o.bUnit,o.bUnit.elements[o.bIndex])):i=r*rot,i}return{factory:rve,granularity:"group",size:n,props:t,description:not}}var nve={name:"physical",label:"Physical",category:"",factory:rve,getParams:oot,defaultValues:C.getDefaultValues(tve),isApplicable:e=>!!e.structure};var iot="Assigns a size reflecting the uncertainty or disorder of an element's position, e.g. B-factor or RMSF, depending on the data availability and experimental technique.",ive={bfactorFactor:C.Numeric(.1,{min:0,max:1,step:.01}),rmsfFactor:C.Numeric(.05,{min:0,max:1,step:.01}),baseSize:C.Numeric(.2,{min:0,max:2,step:.1})};function aot(e){return ive}function ove(e,t,r){return ue.isAtomic(e)?e.model.atomicConformation.B_iso_or_equiv.value(t)*r.bfactorFactor:ue.isSpheres(e)?e.model.coarseConformation.spheres.rmsf[t]*r.rmsfFactor:0}function ave(e,t){function r(n){let o=t.baseSize;return Q.Location.is(n)?o+=ove(n.unit,n.element,t):It.isLocation(n)&&(o+=ove(n.aUnit,n.aUnit.elements[n.aIndex],t)),o}return{factory:ave,granularity:"group",size:r,props:t,description:iot}}var sve={name:"uncertainty",label:"Uncertainty/Disorder",category:"",factory:ave,getParams:aot,defaultValues:C.getDefaultValues(ive),isApplicable:e=>!!e.structure&&e.structure.models.some(t=>t.atomicConformation.B_iso_or_equiv.isDefined||t.coarseHierarchy.isDefined)};var lve="Assign size based on the given value of a volume cell. Negative values are made positive.",uve={scale:C.Numeric(1,{min:.1,max:5,step:.1})};function sot(e){return uve}function aX(e,t){if(e.volume){let{data:r}=e.volume.grid.cells,n=Ge.Cell.isLocation;return{factory:aX,granularity:"group",size:i=>n(i)?Math.abs(r[i.cell])*t.scale:0,props:t,description:lve}}else return{factory:aX,granularity:"uniform",size:()=>t.scale,props:t,description:lve}}var cve={name:"volume-value",label:"Volume Value",category:"",factory:aX,getParams:sot,defaultValues:C.getDefaultValues(uve),isApplicable:e=>!!e.volume&&!Ge.Segmentation.get(e.volume)};var Bo;(a=>{a.EmptyFactory=()=>a.Empty,a.Empty={factory:a.EmptyFactory,granularity:"uniform",size:()=>1,props:{}};function r(s,l){return s.contextHash===l.contextHash&&s.factory===l.factory&&qi(s.props,l.props)}a.areEqual=r,a.EmptyProvider={name:"",label:"",category:"",factory:a.EmptyFactory,getParams:()=>({}),defaultValues:{},isApplicable:()=>!0};function o(){return new EA(a.BuiltIn,a.EmptyProvider)}a.createRegistry=o,a.BuiltIn={physical:nve,"shape-group":Vbe,uncertainty:sve,uniform:Zye,"volume-value":cve}})(Bo||={});var Ii;(o=>{function e(i,a,s,l){l=l||t();let u=s.colorTheme,c=s.sizeTheme;return l.color=i.colorThemeRegistry.create(u.name,a,u.params),l.size=i.sizeThemeRegistry.create(c.name,a,c.params),l}o.create=e;function t(){return{color:vs.Empty,size:Bo.Empty}}o.createEmpty=t;async function r(i,a,s,l){await a.colorThemeRegistry.get(l.colorTheme.name).ensureCustomProperties?.attach(i,s),await a.sizeThemeRegistry.get(l.sizeTheme.name).ensureCustomProperties?.attach(i,s)}o.ensureDependencies=r;function n(i,a,s){i.colorThemeRegistry.get(s.colorTheme.name).ensureCustomProperties?.detach(a),i.sizeThemeRegistry.get(s.sizeTheme.name).ensureCustomProperties?.detach(a)}o.releaseDependencies=n})(Ii||={});function mve(e){return e.map(t=>[t.name,t.provider.label,t.provider.category])}var EA=class{constructor(t,r){this.emptyProvider=r;this._list=[];this._map=new Map;this._name=new Map;wi(t,(n,o)=>{if(n.name!==o)throw new Error(`Fix build in themes to have matching names. ${n.name} ${o}`);this.add(n)})}get default(){return this._list[0]}get list(){return this._list}get types(){return mve(this._list)}sort(){this._list.sort((t,r)=>t.provider.category===r.provider.category?t.provider.label<r.provider.label?-1:t.provider.label>r.provider.label?1:0:t.provider.category<r.provider.category?-1:1)}add(t){if(this._map.has(t.name))throw new Error(`${t.name} already registered.`);let r=t.name;this._list.push({name:r,provider:t}),this._map.set(r,t),this._name.set(t,r),this.sort()}remove(t){this._list.splice(this._list.findIndex(n=>n.name===t.name),1);let r=this._map.get(t.name);r&&(this._map.delete(t.name),this._name.delete(r))}has(t){return this._map.has(t.name)}get(t){return this._map.get(t)||this.emptyProvider}getName(t){if(!this._name.has(t))throw new Error(`'${t.label}' is not a registered theme provider.`);return this._name.get(t)}create(t,r,n={}){let o=this.get(t);return o.factory(r,{...C.getDefaultValues(o.getParams(r)),...n})}getApplicableList(t){return this._list.filter(r=>r.provider.isApplicable(t))}getApplicableTypes(t){return mve(this.getApplicableList(t))}clear(){this._list.length=0,this._map.clear(),this._name.clear()}};var lot;(t=>{function e(r,n,o){return C.getDefaultValues(r.getParams(n,o))}t.getDefaultParams=e})(lot||={});var uot={name:"",label:"",description:"",factory:()=>Ut.Empty,getParams:()=>({}),defaultValues:{},defaultColorTheme:{name:""},defaultSizeTheme:{name:""},isApplicable:()=>!0};function dve(e){return e.map(t=>[t.name,t.provider.label])}var kA=class{constructor(){this._list=[];this._map=new Map;this._name=new Map}get default(){return this._list[0]}get types(){return dve(this._list)}add(t){if(this._map.has(t.name))throw new Error(`${t.name} already registered.`);this._list.push({name:t.name,provider:t}),this._map.set(t.name,t),this._name.set(t,t.name)}getName(t){if(!this._name.has(t))throw new Error(`'${t.label}' is not a registered represenatation provider.`);return this._name.get(t)}remove(t){let r=t.name;this._list.splice(this._list.findIndex(o=>o.name===r),1);let n=this._map.get(r);n&&(this._map.delete(r),this._name.delete(n))}get(t){return this._map.get(t)||uot}get list(){return this._list}getApplicableList(t){return this._list.filter(r=>r.provider.isApplicable(t))}getApplicableTypes(t){return dve(this.getApplicableList(t))}clear(){this._list.length=0,this._map.clear(),this._name.clear()}};var Ut;(u=>{let e;(p=>{function c(h,f){return h.repr===f.repr&&nr.areEqual(h.loci,f.loci)}p.areEqual=c;function m(h){return nr.isEmpty(h.loci)}p.isEmpty=m,p.Empty={loci:vr}})(e=u.Loci||={});function t(){return{visible:!0,alphaFactor:1,pickable:!0,colorOnly:!1,syncManually:!1,transform:H.identity(),overpaint:as.Empty,transparency:ss.Empty,emissive:us.Empty,substance:ls.Empty,clipping:Io.Empty,themeStrength:{overpaint:1,transparency:1,emissive:1,substance:1},markerActions:ii.All}}u.createState=t;function r(c,m){m.visible!==void 0&&(c.visible=m.visible),m.alphaFactor!==void 0&&(c.alphaFactor=m.alphaFactor),m.pickable!==void 0&&(c.pickable=m.pickable),m.colorOnly!==void 0&&(c.colorOnly=m.colorOnly),m.overpaint!==void 0&&(c.overpaint=m.overpaint),m.transparency!==void 0&&(c.transparency=m.transparency),m.emissive!==void 0&&(c.emissive=m.emissive),m.substance!==void 0&&(c.substance=m.substance),m.clipping!==void 0&&(c.clipping=m.clipping),m.themeStrength!==void 0&&(c.themeStrength=m.themeStrength),m.syncManually!==void 0&&(c.syncManually=m.syncManually),m.transform!==void 0&&H.copy(c.transform,m.transform),m.markerActions!==void 0&&(c.markerActions=m.markerActions)}u.updateState=r,u.StateBuilder={create:t,update:r};function i(){return{label:"",groupCount:0,renderObjects:[],geometryVersion:-1,props:{},params:{},updated:new Pn,state:t(),theme:Ii.createEmpty(),createOrUpdate:()=>Ae.constant("",void 0),setState:()=>{},setTheme:()=>{},getLoci:()=>vr,getAllLoci:()=>[],eachLocation:()=>{},mark:()=>!1,destroy:()=>{}}}u.createEmpty=i;class a{constructor(){this.curr=new Set;this.next=new Set;this._version=-1}get version(){return this._version}add(m,d){this.next.add(ca(m,d))}snapshot(){go.areEqual(this.curr,this.next)||(this._version+=1),[this.curr,this.next]=[this.next,this.curr],this.next.clear()}}u.GeometryState=a;function s(c,m,d,p,h){let f=0,g=new Pn,y=new a,x=p.create(),S=Ii.createEmpty(),I,v,A,P={},T=Object.keys(h).map((R,w)=>{P[w]=R;let E=h[R](m,d);return E.setState(x),E});return{label:c,updated:g,get groupCount(){let R=0;if(v){let{visuals:w}=v;for(let E=0,M=T.length;E<M;++E)(!w||w.includes(P[E]))&&(R+=T[E].groupCount)}return R},get renderObjects(){let R=[];if(v){let{visuals:w}=v;for(let E=0,M=T.length;E<M;++E)(!w||w.includes(P[E]))&&R.push(...T[E].renderObjects)}return R},get geometryVersion(){return y.version},get props(){return v},get params(){return I},createOrUpdate:(R={},w)=>{w&&w!==A&&(I=d(m,w),A=w,v||(v=C.getDefaultValues(I)));let E=wR(Object.assign({},v,R),A);Object.assign(v,R,E);let{visuals:M}=v;return Ae.create(`Creating or updating '${c}' representation`,async D=>{for(let B=0,k=T.length;B<k;++B)(!M||M.includes(P[B]))&&await T[B].createOrUpdate(v,A).runInContext(D),y.add(B,T[B].geometryVersion);y.snapshot(),g.next(f++)})},get state(){return x},get theme(){return S},getLoci:R=>{let{visuals:w}=v;for(let E=0,M=T.length;E<M;++E)if(!w||w.includes(P[E])){let D=T[E].getLoci(R);if(!Oi(D))return D}return vr},getAllLoci:()=>{let R=[],{visuals:w}=v;for(let E=0,M=T.length;E<M;++E)(!w||w.includes(P[E]))&&R.push(...T[E].getAllLoci());return R},eachLocation:R=>{let{visuals:w}=v;for(let E=0,M=T.length;E<M;++E)(!w||w.includes(P[E]))&&T[E].eachLocation(R)},mark:(R,w)=>{let E=!1;for(let M=0,D=T.length;M<D;++M)E=T[M].mark(R,w)||E;return E},setState:R=>{p.update(x,R);for(let w=0,E=T.length;w<E;++w)T[w].setState(R)},setTheme:R=>{S=R;for(let w=0,E=T.length;w<E;++w)T[w].setTheme(R)},destroy(){for(let R=0,w=T.length;R<w;++R)T[R].destroy()}}}u.createMulti=s;function l(c,m){let d=0,p=new Pn,h=new a,f=u.createState(),g=Ii.createEmpty(),y=C.clone(Xe.Params),x=C.getDefaultValues(Xe.Params);return{label:c,updated:p,get groupCount(){return m.values.uGroupCount.ref.value},get renderObjects(){return[m]},get geometryVersion(){return h.version},get props(){return x},get params(){return y},createOrUpdate:(S={})=>{let I=wR(Object.assign({},x,S));return Object.assign(x,S,I),Ae.create(`Updating '${c}' representation`,async v=>{h.add(0,m.id),h.snapshot(),p.next(d++)})},get state(){return f},get theme(){return g},getLoci:()=>vr,getAllLoci:()=>[],eachLocation:()=>{},mark:(S,I)=>!1,setState:S=>{S.visible!==void 0&&qr.setVisibility(m,S.visible),S.alphaFactor!==void 0&&qr.setAlphaFactor(m,S.alphaFactor),S.pickable!==void 0&&qr.setPickable(m,S.pickable),S.colorOnly!==void 0&&qr.setColorOnly(m,S.colorOnly),S.overpaint,S.transparency,S.emissive,S.substance,S.clipping,S.themeStrength!==void 0&&qr.setThemeStrength(m,S.themeStrength),S.transform!==void 0&&qr.setTransform(m,S.transform),u.updateState(f,S)},setTheme:()=>{},destroy(){}}}u.fromRenderObject=l})(Ut||={});var cot;Object.defineProperty(Ut,"Empty",{get:()=>cot??=Ut.createEmpty()});function po(e,t,r,n){let o=0,{webgl:i}=t,a=new Pn,s=new Ut.GeometryState,l=Kc(),u=[],c=qn.create(),m,d,p,h,f=Ii.createEmpty();function g(T={},R){return R&&R!==d&&(p=r(t,R),d=R,h||(h=C.getDefaultValues(p))),h=Object.assign({},h,T),Ae.create("Creating or updating ComplexRepresentation",async w=>{let E=!1;m?m.mustRecreate?.(d,h,i)&&(m.destroy(),m=n(l,d,h,i),E=!0):(m=n(l,d,h,i),E=!0);let M=m.createOrUpdate({webgl:i,runtime:w},f,h,R);M&&await M,E&&v(c),u.length=0,m&&m.renderObject&&(u.push(m.renderObject),s.add(m.renderObject.id,m.geometryVersion)),s.snapshot(),o+=1,a.next(o)})}function y(T){return m?m.getLoci(T):vr}function x(){return[De.Loci(d.child??d)]}function S(T){m?.eachLocation(T)}function I(T,R){if(!d||!ii.is(c.markerActions,R))return!1;if(De.isLoci(T)||Q.Loci.is(T)||It.isLoci(T)){if(!De.areRootsEquivalent(T.structure,d))return!1;T=nr.remap(T,d),(De.isLoci(T)||Q.Loci.is(T)&&Q.Loci.isWholeStructure(T))&&(T=Mg)}else if(!xa(T)&&!e1(T))return!1;return nr.isEmpty(T)?!1:m?m.mark(T,R):!1}function v(T){if(qn.update(c,T),T.visible!==void 0&&m&&m.setVisibility(T.visible&&(c.unitTransforms===null||c.unitTransforms.isIdentity)),T.alphaFactor!==void 0&&m&&m.setAlphaFactor(T.alphaFactor),T.pickable!==void 0&&m&&m.setPickable(T.pickable),T.overpaint!==void 0&&m){let R=as.remap(T.overpaint,d);m.setOverpaint(R,i)}if(T.transparency!==void 0&&m){let R=ss.remap(T.transparency,d);m.setTransparency(R,i)}if(T.emissive!==void 0&&m){let R=us.remap(T.emissive,d);m.setEmissive(R,i)}if(T.substance!==void 0&&m){let R=ls.remap(T.substance,d);m.setSubstance(R,i)}if(T.clipping!==void 0&&m){let R=Io.remap(T.clipping,d);m.setClipping(R)}T.themeStrength!==void 0&&m&&m.setThemeStrength(T.themeStrength),T.transform!==void 0&&m&&m.setTransform(T.transform),T.unitTransforms!==void 0&&m&&m.setVisibility(c.visible&&(T.unitTransforms===null||T.unitTransforms.isIdentity))}function A(T){f=T}function P(){m&&m.destroy()}return{label:e,get groupCount(){return m?m.groupCount:0},get props(){return h},get params(){return p},get state(){return c},get theme(){return f},get geometryVersion(){return s.version},renderObjects:u,updated:a,createOrUpdate:g,setState:v,setTheme:A,getLoci:y,getAllLoci:x,eachLocation:S,mark:I,destroy:P}}function An(e,t){return e.model.atomicHierarchy.atoms.type_symbol.value(e.elements[t])}function KF(e,t){return e.model.atomicHierarchy.atoms.pdbx_formal_charge.value(e.elements[t])}function EC(e,t){return e.model.atomicHierarchy.atoms.label_atom_id.value(e.elements[t])}function NR(e,t){return e.model.atomicHierarchy.atoms.label_alt_id.value(e.elements[t])}function zR(e,t){return e.model.atomicHierarchy.atoms.label_comp_id.value(e.elements[t])}function mot(e,t,r){let n=0,o=e.interUnitBonds.getEdgeIndices(r,t.id);for(let i=0,a=o.length;i<a;++i){let s=e.interUnitBonds.edges[o[i]];xt.isCovalent(s.props.flag)&&(n+=1)}return n}function dot(e,t){let r=0,{offset:n,edgeProps:{flags:o}}=e.bonds;for(let i=n[t],a=n[t+1];i<a;++i)xt.isCovalent(o[i])&&(r+=1);return r}function $c(e,t,r){return mot(e,t,r)+dot(t,r)}function fu(e,t,r,n){let o=0;return Ts(e,t,r,(i,a)=>{An(i,a)===n&&(o+=1)}),o}function pot(e,t,r){let{offset:n,b:o,edgeProps:{flags:i}}=e.bonds;xt.is;for(let a=n[t],s=n[t+1];a<s;++a)if(o[a]===r&&xt.isCovalent(i[a]))return!0;return!1}function fot(e,t,r,n,o){let i=e.interUnitBonds.getEdge(r,t.id,o,n.id);return i&&xt.isCovalent(i.props.flag)}function pve(e,t,r,n,o){return t===n?pot(t,r,o):fot(e,t,r,n,o)}function hot(e,t,r,n){let o=e.interUnitBonds.getEdgeIndices(r,t.id);for(let i=0,a=o.length;i<a;++i){let s=e.interUnitBonds.edges[o[i]],l=e.unitMap.get(s.unitB);xt.isCovalent(s.props.flag)&&n(l,s.indexB)}}function JF(e,t,r){let{offset:n,b:o,edgeProps:{flags:i}}=e.bonds;for(let a=n[t],s=n[t+1];a<s;++a)xt.isCovalent(i[a])&&r(e,o[a])}function Ts(e,t,r,n){hot(e,t,r,n),JF(t,r,n)}function fve(e,t,r){return An(t,r)==="S"&&fu(e,t,r,"O")===3}function hve(e,t,r){return An(t,r)==="S"&&fu(e,t,r,"O")===4}function sX(e,t,r){return An(t,r)==="P"&&fu(e,t,r,"O")===$c(e,t,r)}function gve(e,t,r){let n=0;return An(t,r)==="C"&&fu(e,t,r,"O")===2&&fu(e,t,r,"C")===1&&Ts(e,t,r,(o,i)=>{An(o,i)==="O"&&$c(e,o,i)-fu(e,o,i,"H")===1&&(n+=1)}),n===2}function yve(e,t,r){let n=0;return An(t,r)==="C"&&$c(e,t,r)===3&&fu(e,t,r,"N")===3&&Ts(e,t,r,(o,i)=>{$c(e,o,i)-fu(e,o,i,"H")===1&&(n+=1)}),n===2}function bve(e,t,r){let n=0;return An(t,r)==="C"&&$c(e,t,r)===3&&fu(e,t,r,"N")===2&&fu(e,t,r,"C")===1&&Ts(e,t,r,(o,i)=>{$c(e,o,i)-fu(e,o,i,"H")===1&&(n+=1)}),n===2}var got=new Set(["N","O","S","F","CL","BR","I"]);function yot(e){return got.has(e)}function xve(e,t,r){let n=!1;return Ts(e,t,r,(o,i)=>{yot(An(o,i))&&(n=!0)}),n}var bot=H.toArray,$F=!1;function FA(e){if(!e)Yt&&!$F&&(console.warn('WebGL required for "sphere impostors". Falling back to "sphere mesh".'),$F=!0);else if(!e.extensions.fragDepth||!e.extensions.textureFloat){if(Yt&&!$F){let t=[];e.extensions.fragDepth||t.push("fragDepth"),e.extensions.textureFloat||t.push("textureFloat"),console.warn(`Missing "${t.join('", "')}" extensions required for "sphere impostors". Falling back to "sphere mesh".`),$F=!0}}else return!0;return!1}var eL=!1;function kC(e){if(!e)Yt&&!eL&&(console.warn('WebGL required for "cylinder impostors". Falling back to "cylinder mesh".'),eL=!0);else{if(e.extensions.fragDepth)return!0;if(Yt&&!eL){let t=[];e.extensions.fragDepth||t.push("fragDepth"),console.warn(`Missing "${t.join('", "')}" extensions required for "cylinder impostors". Falling back to "cylinder mesh".`),eL=!0}}return!1}function tL(e,t,r){let{elements:n,model:o}=t;if(xe.indexOf(n,r)!==-1){let{index:i,offsets:a}=o.atomicHierarchy.residueAtomSegments,s=i[r],l=[];for(let c=a[s],m=a[s+1];c<m;++c){let d=xe.indexOf(n,c);d!==-1&&l.push(d)}let u=xe.ofSortedArray(Be.ofSortedArray(l));return Q.Loci(e,[{unit:t,indices:u}])}return vr}function Cve(e,t,r){let{elements:n,model:o}=t,{label_alt_id:i}=o.atomicHierarchy.atoms,a=i.value(r);if(xe.indexOf(n,r)!==-1){let{index:s}=o.atomicHierarchy.residueAtomSegments,l=s[r];return FC(e,t,l,a)}return Q.Loci(e,[])}function FC(e,t,r,n){let{elements:o,model:i}=t,{label_alt_id:a}=i.atomicHierarchy.atoms,{offsets:s}=i.atomicHierarchy.residueAtomSegments,l=[];for(let c=s[r],m=s[r+1];c<m;++c){let d=xe.indexOf(o,c);if(d!==-1){let p=a.value(c);(n===p||p==="")&&l.push(d)}}let u=xe.ofSortedArray(Be.ofSortedArray(l));return Q.Loci(e,[{unit:t,indices:u}])}function lX(e,t,r,n,o,i){let{child:a}=e.structure,s=t&&a?e.group.units.filter(m=>a.unitMap.has(m.id)):e.group.units,l=s.length,u=l*16,c=i&&i.aTransform.ref.value.length>=u?i.aTransform.ref.value:new Float32Array(u);for(let m=0;m<l;m++)bot(s[m].conformation.operator.matrix,c,m*16);return WS(c,l,r,n,o,i)}var xot={atomic:{},spheres:{},gaussians:{}},Sve=C.objectToOptions(xot);function vve(e,t){for(let r=0,n=e.length;r<n;++r)if(ue.isAtomic(t)&&e[r]==="atomic"||ue.isSpheres(t)&&e[r]==="spheres"||ue.isGaussians(t)&&e[r]==="gaussians")return!0;return!1}var Ive=5e8;function uX(e,t,r=Ive){let n=pt.size(b(),e);b.ceil(n,n),n.sort((s,l)=>l-s);let o=Math.floor(Math.cbrt(r)*Math.cbrt(r)),i=n[0]*n[1],a=Math.ceil(i/(t*t));return{area:i,areaCells:a,maxAreaCells:o}}function Eg(e,t,r=Ive){let{area:n,areaCells:o,maxAreaCells:i}=uX(e,t.resolution,r),a=o>i?Math.sqrt(n/i):t.resolution;return{...t,resolution:a}}function Cot(e){switch(e.kind){case ue.Kind.Atomic:return e.model.atomicConformation;case ue.Kind.Spheres:return e.model.coarseConformation.spheres;case ue.Kind.Gaussians:return e.model.coarseConformation.gaussians}}var l1={ignoreHydrogens:C.Boolean(!1,{description:"Whether or not to include hydrogen atoms in the surface calculation."}),ignoreHydrogensVariant:C.Select("all",C.arrayToOptions(["all","non-polar"])),traceOnly:C.Boolean(!1,{description:"Whether or not to only use trace atoms in the surface calculation."}),includeParent:C.Boolean(!1,{description:"Include elements of the parent structure in surface calculation to get a surface patch of the current structure."})},kUr=C.getDefaultValues(l1),Sot=b();function Ave(e,t,r,n){return b.squaredDistance(b.set(Sot,e,t,r),n)}function vot(e,t,r){let n=0,o=t.length;for(let i=0,a=r.length;i<a;++i){let s=Be.indexOfInRange(t,r[i],n,o);s===-1?e[i]=-2:(e[i]=s,n=s)}}function LA(e,t,r,n){let{ignoreHydrogens:o,ignoreHydrogensVariant:i,traceOnly:a,includeParent:s}=n,l=s?e.root.unitMap.get(t.id):t,u=s&&l!==t,{x:c,y:m,z:d}=Cot(l),{elements:p}=l,{center:h,radius:f}=t.boundary.sphere,g=(4+1.5)*2,y=(f+g)*(f+g),x,S;if(o||a||u){let T=[],R=[];for(let w=0,E=p.length;w<E;++w){let M=p[w];o&&em(e,l,M,i)||a&&!rL(l,M)||u&&Ave(c[M],m[M],d[M],h)>y||(T.push(M),R.push(w))}x=Be.ofSortedArray(T),S=R}else x=p,S=Xa(new Int32Array(x.length));s&&l!==t&&vot(S,t.elements,x);let I={indices:x,x:c,y:m,z:d,id:S},v=u?Hf(I):t.boundary,A=Q.Location.create(e,l);return{position:I,boundary:v,radius:T=>(A.element=T,r.size(A))}}function VA(e,t,r){let{ignoreHydrogens:n,ignoreHydrogensVariant:o,traceOnly:i,includeParent:a}=r,s=a&&!!e.parent,l=Q.Location.create(e.root),{center:u,radius:c}=e.boundary.sphere,m=(4+1.5)*2,d=(c+m)*(c+m),p,h,f,g,y,x;if(n||i||s){let{getSerialIndex:A}=e.serialMapping,P=s?e.root.units:e.units,T=[],R=[],w=[],E=[],M=[];for(let D=0,B=P.length;D<B;++D){let k=P[D],{elements:F,conformation:z}=k,j=e.unitMap.get(k.id);l.unit=k;for(let Y=0,G=F.length;Y<G;++Y){let X=F[Y];if(n&&em(e,k,X,o)||i&&!rL(k,X))continue;let U=z.x(X),L=z.y(X),q=z.z(X);s&&Ave(U,L,q,u)>d||(T.push(U),R.push(L),w.push(q),l.element=X,E.push(t.size(l)),s?(j?Be.indexOf(j.elements,X):-1)===-1?M.push(-2):M.push(A(j,X)):M.push(A(k,X)))}}p=T,h=R,f=w,g=E,y=M,x=xe.ofRange(0,y.length)}else{let{elementCount:A}=e,P=new Float32Array(A),T=new Float32Array(A),R=new Float32Array(A),w=new Float32Array(A);for(let E=0,M=0,D=e.units.length;E<D;++E){let B=e.units[E],{elements:k,conformation:F}=B;l.unit=B;for(let z=0,j=k.length;z<j;++z){let Y=k[z],G=M+z;P[G]=F.x(Y),T[G]=F.y(Y),R[G]=F.z(Y),l.element=Y,w[G]=t.size(l)}M+=k.length}p=P,h=T,f=R,g=w,y=Xa(new Uint32Array(A)),x=xe.ofRange(0,y.length)}let S={indices:x,x:p,y:h,z:f,id:y},I=s?Hf(S):e.boundary;return{position:S,boundary:I,radius:A=>g[A]}}var Iot=F_.H;function em(e,t,r,n){if(ue.isCoarse(t)||t.model.atomicHierarchy.derived.atom.atomicNumber[r]!==Iot)return!1;if(n==="all")return!0;let o=xve(e,t,Be.indexOf(t.elements,r));return!!(o&&n==="polar"||!o&&n==="non-polar")}function rL(e,t){if(ue.isCoarse(e))return!0;let r=e.model.atomicHierarchy.atoms.label_atom_id.value(t);return r==="CA"||r==="BB"||r==="P"}function Cb(e){return C.MultiSelect(e,Sve,{description:"For which kinds of units/chains to show the representation visuals."})}var ll={unitKinds:Cb(["atomic","spheres"]),includeParent:C.Boolean(!1,{isHidden:!0})},nL={...ft.Params},oL={...Hs.Params},iL={...ji.Params},aL={...Dl.Params},sL={...Cn.Params},lL={...na.Params},uL={...tu.Params},cL={...Ss.Params},mL={...Gu.Params};function Aot(e,t,r,n,o,i){let{createValues:a,createRenderableState:s}=ba.getUtils(t),l=Nk(),u=a(t,l,r,n,o),c=s(o);return Pp(t.kind,u,c,i)}function kg(e,t){let{defaultProps:r,createGeometry:n,createLocationIterator:o,getLoci:i,eachLocation:a,setUpdateState:s,mustRecreate:l,processValues:u,dispose:c}=e,{updateValues:m,updateBoundingSphere:d,updateRenderableState:p,createPositionIterator:h}=e.geometryUtils,f=kd.create(),g={loci:vr,action:0,status:-1},y,x,S,I,v=Object.assign({},r),A=Ii.createEmpty(),P,T,R=-1,w,E;function M(j,Y,G){if(!G&&!P)throw new Error("missing structure");if(x=Object.assign({},v,Y),S=j,I=G,kd.reset(f),!y||!P){f.createNew=!0,f.createGeometry=!0;return}s(f,x,v,S,A,I,P),De.areEquivalent(I,P)||(f.createGeometry=!0),De.areHierarchiesEqual(I,P)||(f.updateTransform=!0,f.createGeometry=!0),vs.areEqual(j.color,A.color)||(f.updateColor=!0),Bo.areEqual(j.size,A.size)||(f.updateSize=!0),qi(x.unitKinds,v.unitKinds)||(f.createGeometry=!0),P.child!==I.child&&(f.createGeometry=!0,f.updateTransform=!0),x.instanceGranularity!==v.instanceGranularity&&(f.updateTransform=!0),f.updateSize&&!("uSize"in y.values)&&(f.createGeometry=!0),f.createGeometry&&(f.updateColor=!0,f.updateSize=!0)}function D(j){if(f.createNew)if(w=o(I,x),j)y=Aot(I,j,w,S,x,t),E=h(j,y.values);else throw new Error("expected geometry to be given");else{if(!y)throw new Error("expected renderObject to be available");if((f.updateColor||f.updateSize||f.updateTransform)&&(w=o(I,x)),f.updateTransform){let{instanceCount:Y,groupCount:G}=w;x.instanceGranularity?yo(Y,"instance",y.values):yo(Y*G,"groupInstance",y.values)}if(f.createGeometry)if(j)_.updateIfChanged(y.values.drawCount,ba.getDrawCount(j)),_.updateIfChanged(y.values.uVertexCount,ba.getVertexCount(j)),_.updateIfChanged(y.values.uGroupCount,w.groupCount);else throw new Error("expected geometry to be given");(f.updateTransform||f.createGeometry)&&(d(y.values,j||T),E=h(T,y.values)),f.updateSize&&"uSize"in y.values&&eu(w,S.size,y.values),f.updateColor&&ya(w,E,S.color,y.values),m(y.values,x),p(y.state,x)}v=x,A=S,P=I,j&&(T=j,R+=1)}function B(j){return!!(xa(j)||De.isLoci(j)&&De.areRootsEquivalent(j.structure,P)||Q.Loci.is(j)&&De.areRootsEquivalent(j.structure,P)&&Q.Loci.isWholeStructure(j))}function k(j,Y,G){let X=!1;return!Q.Loci.is(j)&&!It.isLoci(j)||!De.areEquivalent(j.structure,Y)?!1:(G(ye.ofSingleton(0))&&(X=!0),X)}function F(j,Y,G){return B(j)?v.instanceGranularity?Y(ye.ofBounds(0,w.instanceCount)):Y(ye.ofBounds(0,w.groupCount*w.instanceCount)):v.instanceGranularity?k(j,P,Y):a(j,P,Y,G)}function z(j){y&&u?.(y.values,T,v,A,j.webgl)}return{get groupCount(){return w?w.count:0},get renderObject(){return w&&w.count?y:void 0},get geometryVersion(){return R},createOrUpdate(j,Y,G={},X){if(M(Y,G,X||P),f.createGeometry){let U=n(j,I,S,x,T);if(jx(U))return U.then(L=>{D(L),z(j)});D(U)}else D();z(j)},getLoci(j){return y?i(j,P,y.id):vr},eachLocation(j){for(w.reset();w.hasNext;){let{location:Y,isSecondary:G}=w.move();j(Y,G)}},mark(j,Y){return qr.mark(y,j,Y,F,g)},setVisibility(j){qr.setVisibility(y,j)},setAlphaFactor(j){qr.setAlphaFactor(y,j)},setPickable(j){qr.setPickable(y,j)},setColorOnly(j){qr.setColorOnly(y,j)},setTransform(j,Y){qr.setTransform(y,j,Y)},setOverpaint(j,Y){let G={geometry:T,props:v,webgl:Y};qr.setOverpaint(y,j,F,!0,G)},setTransparency(j,Y){let G={geometry:T,props:v,webgl:Y};qr.setTransparency(y,j,F,!0,G)},setEmissive(j,Y){let G={geometry:T,props:v,webgl:Y};qr.setEmissive(y,j,F,!0,G)},setSubstance(j,Y){let G={geometry:T,props:v,webgl:Y};qr.setSubstance(y,j,F,!0,G)},setClipping(j){qr.setClipping(y,j,F,!0)},setThemeStrength(j){qr.setThemeStrength(y,j)},destroy(){c?.(T),y&&(y.state.disposed=!0,y=void 0)},mustRecreate:l}}var fc={...nL,...ll};function Ps(e,t){return kg({...e,setUpdateState:(r,n,o,i,a,s,l)=>{e.setUpdateState(r,n,o,i,a,s,l),Bo.areEqual(i.size,a.size)||(r.createGeometry=!0)},geometryUtils:ft.Utils},t)}var Tve={...oL,...ll};function Pve(e,t){return kg({...e,setUpdateState:(r,n,o,i,a,s,l)=>{e.setUpdateState(r,n,o,i,a,s,l),Bo.areEqual(i.size,a.size)||(r.updateSize=!0)},geometryUtils:Hs.Utils},t)}var dL={...iL,...ll};function pL(e,t){return kg({...e,setUpdateState:(r,n,o,i,a,s,l)=>{e.setUpdateState(r,n,o,i,a,s,l),Bo.areEqual(i.size,a.size)||(r.updateSize=!0)},geometryUtils:ji.Utils},t)}var _ve={...aL,...ll};function Rve(e,t){return kg({...e,setUpdateState:(r,n,o,i,a,s,l)=>{e.setUpdateState(r,n,o,i,a,s,l),Bo.areEqual(i.size,a.size)||(r.updateSize=!0)},geometryUtils:Dl.Utils},t)}var OA={...sL,...ll};function GA(e,t){return kg({...e,setUpdateState:(r,n,o,i,a,s,l)=>{e.setUpdateState(r,n,o,i,a,s,l),Bo.areEqual(i.size,a.size)||(r.updateSize=!0)},geometryUtils:Cn.Utils},t)}var Dve={...lL,...ll};function UA(e,t){return kg({...e,setUpdateState:(r,n,o,i,a,s,l)=>{e.setUpdateState(r,n,o,i,a,s,l),Bo.areEqual(i.size,a.size)||(r.updateSize=!0),n.background!==o.background&&(r.createGeometry=!0),n.backgroundMargin!==o.backgroundMargin&&(r.createGeometry=!0),n.tether!==o.tether&&(r.createGeometry=!0),n.tetherLength!==o.tetherLength&&(r.createGeometry=!0),n.tetherBaseWidth!==o.tetherBaseWidth&&(r.createGeometry=!0),n.attachment!==o.attachment&&(r.createGeometry=!0),n.fontFamily!==o.fontFamily&&(r.createGeometry=!0),n.fontQuality!==o.fontQuality&&(r.createGeometry=!0),n.fontStyle!==o.fontStyle&&(r.createGeometry=!0),n.fontVariant!==o.fontVariant&&(r.createGeometry=!0),n.fontWeight!==o.fontWeight&&(r.createGeometry=!0)},geometryUtils:na.Utils},t)}var wve={...uL,...ll};function Mve(e,t){return kg({...e,setUpdateState:(r,n,o,i,a,s,l)=>{e.setUpdateState(r,n,o,i,a,s,l),Bo.areEqual(i.size,a.size)||(r.createGeometry=!0)},geometryUtils:tu.Utils},t)}var Bve={...cL,...ll};function Eve(e,t){return kg({...e,setUpdateState:(r,n,o,i,a,s,l)=>{e.setUpdateState(r,n,o,i,a,s,l),Bo.areEqual(i.size,a.size)||(r.createGeometry=!0)},geometryUtils:Ss.Utils},t)}var kve={...mL,...ll};function Fve(e,t){return kg({...e,setUpdateState:(r,n,o,i,a,s,l)=>{e.setUpdateState(r,n,o,i,a,s,l),Bo.areEqual(i.size,a.size)||(r.createGeometry=!0)},geometryUtils:Gu.Utils},t)}var fL=class{constructor(t,r){this.hashCode=t;this.areEqual=r;this.buckets=new Map}set(t,r){let n=this.hashCode(t),o=this.buckets.get(n);o||(o=[],this.buckets.set(n,o));for(let i=0;i<o.length;i++)if(this.areEqual(o[i].key,t)){o[i].value=r;return}o.push({key:t,value:r})}get(t){let r=this.hashCode(t),n=this.buckets.get(r);if(n){for(let o of n)if(this.areEqual(o.key,t))return o.value}}delete(t){let r=this.hashCode(t),n=this.buckets.get(r);if(!n)return!1;for(let o=0;o<n.length;o++)if(this.areEqual(n[o].key,t))return n.splice(o,1),n.length===0&&this.buckets.delete(r),!0;return!1}forEach(t){for(let r of this.buckets.values())for(let n of r)t(n.value,n.key)}clear(){this.buckets.clear()}};function Lve(){return new fL(e=>e.hashCode,ue.SymmetryGroup.areInvariantElementsEqual)}function eo(e,t,r,n){let o=0,{webgl:i}=t,a=new Pn,s=Kc(),l=[],u=new Ut.GeometryState,c=qn.create(),m=Lve(),d,p,h,f,g=Ii.createEmpty();function y(w={},E){return E&&E!==d&&(h=r(t,E),f||(f=C.getDefaultValues(h))),f=Object.assign({},f,w),Ae.create("Creating or updating UnitsRepresentation",async M=>{if(!d&&!E)throw new Error("missing structure");if(E&&!d){p=E.unitSymmetryGroups;for(let D=0;D<p.length;D++){let B=p[D],k=n(s,E,f,i),F=k.createOrUpdate({webgl:i,runtime:M},g,f,{group:B,structure:E});F&&await F,A(k,B,c),m.set(B,{visual:k,group:B}),M.shouldUpdate&&await M.update({message:"Creating or updating UnitsVisual",current:D,max:p.length})}}else if(E&&(!De.areUnitIdsAndIndicesEqual(E,d)||E.child!==d.child)){p=E.unitSymmetryGroups;let D=m;m=Lve();for(let B=0;B<p.length;B++){let k=p[B],F=D.get(k);if(F){let{visual:z}=F;if(z.mustRecreate?.({group:k,structure:E},f,i)){z.destroy(),z=n(s,E,f,i);let j=z.createOrUpdate({webgl:i,runtime:M},g,f,{group:k,structure:E});j&&await j,A(z,k,c)}else{let j=z.createOrUpdate({webgl:i,runtime:M},g,f,{group:k,structure:E});j&&await j}if(m.set(k,{visual:z,group:k}),D.delete(k),z.renderObject){let j=z.renderObject.values.tMarker.ref.value.array;PC(j,ye.ofBounds(0,j.length),2)}}else{let z=n(s,E,f,i),j=z.createOrUpdate({webgl:i,runtime:M},g,f,{group:k,structure:E});j&&await j,A(z,k,c),m.set(k,{visual:z,group:k})}M.shouldUpdate&&await M.update({message:"Creating or updating UnitsVisual",current:B,max:p.length})}D.forEach(({visual:B})=>{B.destroy()})}else if(E&&E!==d&&De.areUnitIdsAndIndicesEqual(E,d)){p=E.unitSymmetryGroups;for(let D=0;D<p.length;D++){let B=p[D],k=m.get(B);if(k){let{visual:F}=k;if(F.mustRecreate?.({group:B,structure:E},f,t.webgl)){F.destroy(),F=n(s,E,f,t.webgl),k.visual=F;let z=F.createOrUpdate({webgl:i,runtime:M},g,f,{group:B,structure:E});z&&await z,A(F,B,c)}else{let z=F.createOrUpdate({webgl:i,runtime:M},g,f,{group:B,structure:E});z&&await z}k.group=B}else throw new Error(`expected to find visual for hashCode ${B.hashCode}`);M.shouldUpdate&&await M.update({message:"Creating or updating UnitsVisual",current:D,max:p.length})}}else{let D=[];m.forEach(B=>D.push(B));for(let B=0,k=D.length;B<k;++B){let{visual:F,group:z}=D[B];if(F.mustRecreate?.({group:z,structure:d},f,t.webgl)){F.destroy(),F=n(s,d,f,i),D[B].visual=F;let j=F.createOrUpdate({webgl:i,runtime:M},g,f,{group:z,structure:d});j&&await j,A(F,z,c)}else{let j=F.createOrUpdate({webgl:i,runtime:M},g,f);j&&await j}M.shouldUpdate&&await M.update({message:"Creating or updating UnitsVisual",current:B,max:k})}}l.length=0,m.forEach(({visual:D})=>{D.renderObject&&(l.push(D.renderObject),u.add(D.renderObject.id,D.geometryVersion))}),u.snapshot(),E&&(d=E),a.next(o++)})}function x(w){let E=vr;return m.forEach(({visual:M})=>{let D=M.getLoci(w);Oi(D)||(E=D)}),E}function S(w){m.forEach(({visual:E})=>{E.eachLocation(w)})}function I(){return[De.Loci(d.child??d)]}function v(w,E){if(!d||!ii.is(c.markerActions,E))return!1;if(De.isLoci(w)||Q.Loci.is(w)||It.isLoci(w)){if(!De.areRootsEquivalent(w.structure,d))return!1;w=nr.remap(w,d),(De.isLoci(w)||Q.Loci.is(w)&&Q.Loci.isWholeStructure(w))&&(w=Mg)}else if(!xa(w)&&!e1(w))return!1;if(nr.isEmpty(w))return!1;let M=!1;return m.forEach(({visual:D})=>{M=D.mark(w,E)||M}),M}function A(w,E,M){let{visible:D,alphaFactor:B,pickable:k,overpaint:F,transparency:z,emissive:j,substance:Y,clipping:G,themeStrength:X,transform:U,unitTransforms:L}=M;D!==void 0&&w.setVisibility(D),B!==void 0&&w.setAlphaFactor(B),k!==void 0&&w.setPickable(k),F!==void 0&&w.setOverpaint(F,i),z!==void 0&&w.setTransparency(z,i),j!==void 0&&w.setEmissive(j,i),Y!==void 0&&w.setSubstance(Y,i),G!==void 0&&w.setClipping(G),X!==void 0&&w.setThemeStrength(X),U!==void 0&&(U!==c.transform||!H.areEqual(U,c.transform,1e-6))&&w.setTransform(U),L!==void 0&&(L?w.setTransform(void 0,L.getSymmetryGroupTransforms(E)):L!==c.unitTransforms&&w.setTransform(void 0,null))}function P(w){let{visible:E,alphaFactor:M,pickable:D,overpaint:B,transparency:k,emissive:F,substance:z,clipping:j,themeStrength:Y,transform:G,unitTransforms:X,syncManually:U,markerActions:L}=w,q={};E!==void 0&&(q.visible=E),M!==void 0&&(q.alphaFactor=M),D!==void 0&&(q.pickable=D),B!==void 0&&d&&(q.overpaint=as.remap(B,d)),k!==void 0&&d&&(q.transparency=ss.remap(k,d)),F!==void 0&&d&&(q.emissive=us.remap(F,d)),z!==void 0&&d&&(q.substance=ls.remap(z,d)),j!==void 0&&d&&(q.clipping=Io.remap(j,d)),Y!==void 0&&(q.themeStrength=Y),G!==void 0&&!H.areEqual(G,c.transform,1e-6)&&(q.transform=G),(X!==c.unitTransforms||X?.version!==c.unitTransformsVersion)&&(q.unitTransforms=X,c.unitTransformsVersion=X?X?.version:-1),U!==void 0&&(q.syncManually=U),L!==void 0&&(q.markerActions=L),m.forEach(({visual:te,group:J})=>A(te,J,q)),qn.update(c,q)}function T(w){g=w}function R(){m.forEach(({visual:w})=>w.destroy()),m.clear()}return{label:e,get groupCount(){let w=0;return m.forEach(({visual:E})=>{E.renderObject&&(w+=E.groupCount)}),w},get geometryVersion(){return u.version},get props(){return f},get params(){return h},get state(){return c},get theme(){return g},renderObjects:l,updated:a,createOrUpdate:y,setState:P,setTheme:T,getLoci:x,getAllLoci:I,eachLocation:S,mark:v,destroy:R}}function Tot(e,t,r,n,o,i){let{createValues:a,createRenderableState:s}=ba.getUtils(t),l=lX(e,o.includeParent,t.boundingSphere,o.cellSize,o.batchSize),u=a(t,l,r,n,o),c=s(o);return Pp(t.kind,u,c,i)}function LC(e,t){let{defaultProps:r,createGeometry:n,createLocationIterator:o,getLoci:i,eachLocation:a,setUpdateState:s,initUpdateState:l,mustRecreate:u,processValues:c,dispose:m}=e,{createEmpty:d,updateValues:p,updateBoundingSphere:h,updateRenderableState:f,createPositionIterator:g}=e.geometryUtils,y=kd.create(),x={loci:vr,action:0,status:-1},S,I=Object.assign({},r),v=Ii.createEmpty(),A,P,T,R,w,E=-1,M,D;function B(X,U,L){if(!L&&!R)throw new Error("missing structureGroup");if(I=U,v=X,A=L,kd.reset(y),!S||!R){l?.(y,I,v,A),y.createNew=!0,y.createGeometry=!0;return}s(y,I,P,v,T,A,R),De.areHierarchiesEqual(R.structure,A.structure)||(y.updateTransform=!0,y.updateColor=!0,y.updateSize=!0),vs.areEqual(v.color,T.color)||(y.updateColor=!0),Bo.areEqual(v.size,T.size)||(y.updateSize=!0),R.structure.child!==A.structure.child&&(y.createGeometry=!0,y.updateTransform=!0),(I.instanceGranularity!==P.instanceGranularity||I.cellSize!==P.cellSize||I.batchSize!==P.batchSize)&&(y.updateTransform=!0),qi(I.unitKinds,P.unitKinds)||(y.createGeometry=!0),A.group.transformHash!==R.group.transformHash&&(A.group.units.length!==R.group.units.length||y.updateColor?y.updateTransform=!0:y.updateMatrix=!0);let q=A.group.units[0],te=R.group.units[0];ue.areOperatorsEqual(q,te)||(y.updateTransform=!0),ue.areConformationsEqual(q,te)||(y.createGeometry=!0),y.updateTransform&&(y.updateMatrix=!0),y.updateSize&&!("uSize"in S.values)&&(y.createGeometry=!0),(y.createGeometry||y.updateTransform)&&(R.structure.hashCode!==A.structure.hashCode&&(y.updateColor=!0,y.updateSize=!0),(v.color.granularity.startsWith("vertex")||S.values.dColorType.ref.value.startsWith("vertex")||v.color.granularity.startsWith("volume")||S.values.dColorType.ref.value.startsWith("volume"))&&(y.updateColor=!0))}function k(X){if(y.createNew)if(M=o(A,I),X)S=Tot(A,X,M,v,I,t),D=g(X,S.values);else throw new Error("expected geometry to be given");else{if(!S)throw new Error("expected renderObject to be available");if((y.updateColor||y.updateSize||y.updateTransform)&&(M=o(A,I)),y.updateTransform){let{instanceCount:U,groupCount:L}=M;I.instanceGranularity?yo(U,"instance",S.values):yo(U*L,"groupInstance",S.values)}if(y.updateMatrix&&(lX(A,I.includeParent,X?.boundingSphere||S.values.invariantBoundingSphere.ref.value,I.cellSize,I.batchSize,S.values),"lodLevels"in S.values&&_.update(S.values.lodLevels,S.values.lodLevels.ref.value)),y.createGeometry)if(X)_.updateIfChanged(S.values.drawCount,ba.getDrawCount(X)),_.updateIfChanged(S.values.uVertexCount,ba.getVertexCount(X)),_.updateIfChanged(S.values.uGroupCount,M.groupCount);else throw new Error("expected geometry to be given");(y.updateTransform||y.createGeometry)&&(h(S.values,X||w),D=g(X||w,S.values)),y.updateSize&&"uSize"in S.values&&eu(M,v.size,S.values),y.updateColor&&ya(M,D,v.color,S.values),p(S.values,I),f(S.state,I)}P=I,T=v,R=A,X&&(w=X,E+=1)}function F(X,U,L,q,te,J){return vve(te.unitKinds,U)?n(X,U,L,q,te,J):d(J)}function z(X){return!!(xa(X)||De.isLoci(X)&&De.areRootsEquivalent(X.structure,R.structure)||Q.Loci.is(X)&&De.areRootsEquivalent(X.structure,R.structure)&&Q.Loci.isWholeStructure(X))}function j(X,U,L){let q=!1;if(It.isLoci(X)){let{structure:te,group:J}=U;if(!De.areEquivalent(X.structure,te))return!1;for(let ee of X.bonds){if(ee.aUnit!==ee.bUnit)continue;let ce=J.unitIndexMap.get(ee.aUnit.id);ce!==void 0&&L(ye.ofSingleton(ce))&&(q=!0)}}else if(Q.Loci.is(X)){let{structure:te,group:J}=U;if(!De.areEquivalent(X.structure,te))return!1;for(let ee of X.elements){let ce=J.unitIndexMap.get(ee.unit.id);ce!==void 0&&L(ye.ofSingleton(ce))&&(q=!0)}}return q}function Y(X,U,L){return z(X)?P.instanceGranularity?U(ye.ofBounds(0,M.instanceCount)):U(ye.ofBounds(0,M.groupCount*M.instanceCount)):P.instanceGranularity?j(X,R,U):a(X,R,U,L)}function G(X){S&&c?.(S.values,w,P,T,X.webgl)}return{get groupCount(){return M?M.count:0},get renderObject(){return M&&M.count?S:void 0},get geometryVersion(){return E},createOrUpdate(X,U,L,q){if(B(U,L,q||R),y.createGeometry){let te=F(X,A.group.units[0],A.structure,v,I,w);if(jx(te))return te.then(J=>{k(J),G(X)});k(te)}else k();G(X)},getLoci(X){return S?i(X,R,S.id):vr},eachLocation(X){for(M.reset();M.hasNext;){let{location:U,isSecondary:L}=M.move();X(U,L)}},mark(X,U){let L=!0;if(Q.Loci.is(X)){L=!1;let{invariantId:q}=R.group.units[0];for(let te of X.elements)if(te.unit.invariantId===q){L=!0;break}}return L?qr.mark(S,X,U,Y,x):!1},setVisibility(X){qr.setVisibility(S,X)},setAlphaFactor(X){qr.setAlphaFactor(S,X)},setPickable(X){qr.setPickable(S,X)},setColorOnly(X){qr.setColorOnly(S,X)},setTransform(X,U){qr.setTransform(S,X,U)},setOverpaint(X,U){let L={geometry:w,props:P,webgl:U};qr.setOverpaint(S,X,Y,!0,L)},setTransparency(X,U){let L={geometry:w,props:P,webgl:U};qr.setTransparency(S,X,Y,!0,L)},setEmissive(X,U){let L={geometry:w,props:P,webgl:U};qr.setEmissive(S,X,Y,!0,L)},setSubstance(X,U){let L={geometry:w,props:P,webgl:U};qr.setSubstance(S,X,Y,!0,L)},setClipping(X){qr.setClipping(S,X,Y,!0)},setThemeStrength(X){qr.setThemeStrength(S,X)},destroy(){m?.(w),S&&(S.state.disposed=!0,S=void 0)},mustRecreate:u}}var fo={...nL,...ll};function Oo(e,t){return LC({...e,setUpdateState:(r,n,o,i,a,s,l)=>{e.setUpdateState(r,n,o,i,a,s,l),Bo.areEqual(i.size,a.size)||(r.createGeometry=!0)},geometryUtils:ft.Utils},t)}var NA={...oL,...ll};function zA(e,t){return LC({...e,setUpdateState:(r,n,o,i,a,s,l)=>{e.setUpdateState(r,n,o,i,a,s,l),Bo.areEqual(i.size,a.size)||(r.updateSize=!0)},geometryUtils:Hs.Utils},t)}var HA={...iL,...ll};function jA(e,t){return LC({...e,setUpdateState:(r,n,o,i,a,s,l)=>{e.setUpdateState(r,n,o,i,a,s,l),Bo.areEqual(i.size,a.size)||(r.updateSize=!0)},geometryUtils:ji.Utils},t)}var Vve={...aL,...ll};function Ove(e,t){return LC({...e,setUpdateState:(r,n,o,i,a,s,l)=>{e.setUpdateState(r,n,o,i,a,s,l),Bo.areEqual(i.size,a.size)||(r.updateSize=!0)},geometryUtils:Dl.Utils},t)}var VC={...sL,...ll};function OC(e,t){return LC({...e,setUpdateState:(r,n,o,i,a,s,l)=>{e.setUpdateState(r,n,o,i,a,s,l),Bo.areEqual(i.size,a.size)||(r.updateSize=!0)},geometryUtils:Cn.Utils},t)}var F5r={...lL,...ll};var Gve={...uL,...ll};function Uve(e,t){return LC({...e,setUpdateState:(r,n,o,i,a,s,l)=>{e.setUpdateState(r,n,o,i,a,s,l),Bo.areEqual(i.size,a.size)||(r.createGeometry=!0)},geometryUtils:tu.Utils},t)}var Nve={...cL,...ll};function zve(e,t){return LC({...e,setUpdateState:(r,n,o,i,a,s,l)=>{e.setUpdateState(r,n,o,i,a,s,l),Bo.areEqual(i.size,a.size)||(r.createGeometry=!0)},geometryUtils:Ss.Utils},t)}var L5r={...mL,...ll};var qn={create:()=>({...Ut.createState(),unitTransforms:null,unitTransformsVersion:-1}),update:(e,t)=>{Ut.updateState(e,t),t.unitTransforms!==void 0&&(e.unitTransforms=t.unitTransforms)}};var Pot=qe.add3,_ot=qe.add,Fg;(t=>{function e(r=2048,n=1024,o){let i=qe.create(Float32Array,3,n,o?o.centerBuffer.ref.value:r),a=qe.create(Float32Array,1,n,o?o.groupBuffer.ref.value:r);return{add:(s,l,u,c)=>{Pot(i,s,l,u),_ot(a,c)},getSpheres:()=>{let s=qe.compact(i,!0),l=qe.compact(a,!0);return Hs.create(s,l,i.elementCount,o)}}}t.create=e})(Fg||={});var WA=b.add;function tm(e,t,r){let{ignoreHydrogens:n,ignoreHydrogensVariant:o,traceOnly:i}=r,a=ue.isCoarse(t),{child:s}=e,l=s?.unitMap.get(t.id);if(s&&!l)throw new Error("expected childUnit to exist if child exists");if(!(!s&&!n&&!i))return u=>!!l&&!Be.has(l.elements,u)||!a&&n&&em(e,t,u,o)||i&&!rL(t,u)}function Hve(e,t,r,n,o,i){let{child:a}=r,s=a?.unitMap.get(t.id);if(a&&!s)return ft.createEmpty(i);let{detail:l,sizeFactor:u,stride:c}=o,{elements:m,conformation:d}=t,p=m.length,h=p*Nm(l),f=tt.createState(h,h/2,i),g=b(),y=tm(r,t,o),x=Q.Location.create(r,t),S=n.size.size,I=b(),v=0,A=0;for(let w=0;w<p;w++){if(c&&w%c!==0||y&&y(m[w]))continue;d.invariantPosition(m[w],g),WA(I,I,g),A+=1,x.element=m[w];let E=S(x);E>v&&(v=E),f.currentGroup=w,Zr(f,g,E*u,l)}let P=tt.getMesh(f);if(A===0)return P;let T;b.scale(I,I,1/A);let R=i?he.clone(i.boundingSphere):void 0;return R&&b.distance(I,R.center)/R.radius<.1?T=R:T=he.expand(he(),(s??t).boundary.sphere,v*u+.05),P.setBoundingSphere(T),P}function jve(e,t,r,n,o,i){let{child:a}=r,s=a?.unitMap.get(t.id);if(a&&!s)return Hs.createEmpty(i);let{sizeFactor:l,stride:u}=o,{elements:c,conformation:m}=t,d=c.length,p=Fg.create(d,d/2,i),h=b(),f=tm(r,t,o),g=Q.Location.create(r,t),y=n.size.size,x=b(),S=0,I=0;if(u&&u>1||f||n.size.granularity!=="uniform")for(let T=0;T<d;T++){if(u&&T%u!==0||f&&f(c[T]))continue;m.invariantPosition(c[T],h),p.add(h[0],h[1],h[2],T),WA(x,x,h),I+=1,g.element=c[T];let R=y(g);R>S&&(S=R)}else{for(let T=0;T<d;T++)m.invariantPosition(c[T],h),p.add(h[0],h[1],h[2],T),WA(x,x,h);I=d,S=y(g)}let v=p.getSpheres();if(I===0)return v;let A;b.scale(x,x,1/I);let P=i?he.clone(i.boundingSphere):void 0;return P&&b.distance(x,P.center)/P.radius<.1?A=P:A=he.expand(he(),(s??t).boundary.sphere,S*l+.05),v.setBoundingSphere(A),v}function ul(e,t,r){let n=!1;if(!Q.Loci.is(e))return!1;let{structure:o,group:i}=t;if(!De.areEquivalent(e.structure,o))return!1;let a=i.elements.length,{unitIndexMap:s}=i;for(let l of e.elements){let u=s.get(l.unit.id);if(u!==void 0){let c=u*a;if(ye.is(l.indices)){let m=c+ye.start(l.indices),d=c+ye.end(l.indices);r(ye.ofBounds(m,d))&&(n=!0)}else for(let m=0,d=l.indices.length;m<d;m++){let p=l.indices[m],h=m+1;for(;h<d&&l.indices[h]===p;)h++;m=h-1;let f=l.indices[m];n=r(ye.ofRange(c+p,c+f))||n}}}return n}function cl(e,t,r){let{objectId:n,instanceId:o,groupId:i}=e;if(r===n){let{structure:a,group:s}=t,l=s.units[o],u=i===vi.Null?xe.ofRange(0,l.elements.length):xe.ofSingleton(i);return Q.Loci(a.target,[{unit:l,indices:u}])}return vr}function Wve(e,t,r,n,o){let{child:i}=t,{detail:a,sizeFactor:s,stride:l}=n,{getSerialIndex:u}=t.serialMapping,m=t.elementCount*Nm(a),d=tt.createState(m,m/2,o),p=r.size.size,h=b(),f=0,g=0;for(let I of t.units){let v=i?.unitMap.get(I.id);if(i&&!v)continue;let{elements:A,conformation:P}=I,T=A.length,R=b(),w=tm(t,I,n),E=Q.Location.create(t,I);for(let M=0;M<T;M++){let D=A[M];if(l&&M%l!==0||w&&w(D))continue;P.position(D,R),WA(h,h,R),g+=1,E.element=D;let B=p(E);B>f&&(f=B),d.currentGroup=u(I,D),Zr(d,R,B*s,a)}}let y=tt.getMesh(d);if(g===0)return y;let x;b.scale(h,h,1/g);let S=o?he.clone(o.boundingSphere):void 0;return S&&b.distance(h,S.center)/S.radius<1?x=S:x=he.expand(he(),(i??t).boundary.sphere,f*s+.05),y.setBoundingSphere(x),y}function Xve(e,t,r,n,o){let{child:i}=t,{sizeFactor:a,stride:s}=n,{getSerialIndex:l}=t.serialMapping,u=t.elementCount,c=Fg.create(u,u/2,o),m=r.size.size,d=b(),p=0,h=0;for(let x of t.units){let S=i?.unitMap.get(x.id);if(i&&!S)continue;let{elements:I,conformation:v}=x,A=I.length,P=b(),T=tm(t,x,n),R=Q.Location.create(t,x);if(s&&s>1||T||r.size.granularity!=="uniform")for(let w=0;w<A;w++){let E=I[w];if(s&&w%s!==0||T&&T(E))continue;v.position(E,P),c.add(P[0],P[1],P[2],l(x,E)),WA(d,d,P),h+=1,R.element=E;let M=m(R);M>p&&(p=M)}else{for(let w=0;w<A;w++){let E=I[w];v.position(E,P),c.add(P[0],P[1],P[2],l(x,E)),WA(d,d,P)}h+=A,p=m(R)}}let f=c.getSpheres();if(h===0)return f;let g;b.scale(d,d,1/h);let y=o?he.clone(o.boundingSphere):void 0;return y&&b.distance(d,y.center)/y.radius<1?g=y:g=he.expand(he(),(i??t).boundary.sphere,p*a+.05),f.setBoundingSphere(g),f}function Ga(e,t,r){let n=!1;if(!Q.Loci.is(e)||!De.areEquivalent(e.structure,t))return!1;let{cumulativeUnitElementCount:o}=t.serialMapping;for(let i of e.elements){let a=t.unitIndexMap.get(i.unit.id);if(a!==void 0)if(ye.is(i.indices)){let s=o[a]+ye.start(i.indices),l=o[a]+ye.end(i.indices);r(ye.ofBounds(s,l))&&(n=!0)}else for(let s=0,l=i.indices.length;s<l;s++){let u=o[a]+i.indices[s];r(ye.ofSingleton(u))&&(n=!0)}}return n}function Ua(e,t,r){let{objectId:n,groupId:o}=e;if(r===n){if(o===vi.Null)return De.Loci(t);{let{unitIndices:i,cumulativeUnitElementCount:a}=t.serialMapping,s=i[o],l=t.units[s],u=o-a[s],c=xe.ofSingleton(u);return Q.Loci(t,[{unit:l,indices:c}])}}return vr}var Ao;(r=>{function e(n){let{group:o,structure:i}=n,a=o.elements.length,s=o.units.length,l=Q.Location.create(i);return un(a,s,1,(c,m)=>{let d=o.units[m];return l.unit=d,l.element=d.elements[c],l})}r.fromGroup=e;function t(n){let{units:o,elementCount:i}=n,a=i,s=1,{unitIndices:l,elementIndices:u}=n.serialMapping,c=Q.Location.create(n);return un(a,s,1,d=>(c.unit=o[l[d]],c.element=u[d],c),!0)}r.fromStructure=t})(Ao||={});var Sb={...Dve,background:C.Boolean(!1),backgroundMargin:C.Numeric(0,{min:0,max:1,step:.01}),backgroundColor:C.Color(Lt.black),backgroundOpacity:C.Numeric(.5,{min:0,max:1,step:.01}),borderWidth:C.Numeric(.25,{min:0,max:.5,step:.01}),level:C.Select("residue",[["chain","Chain"],["residue","Residue"],["element","Element"]],{isEssential:!0}),ignoreHydrogens:C.Boolean(!1),ignoreHydrogensVariant:C.Select("all",C.arrayToOptions(["all","non-polar"])),chainScale:C.Numeric(10,{min:0,max:20,step:.1}),residueScale:C.Numeric(1,{min:0,max:20,step:.1}),elementScale:C.Numeric(.5,{min:0,max:20,step:.1})};function Qve(e){return UA({defaultProps:C.getDefaultValues(Sb),createGeometry:Rot,createLocationIterator:Ao.fromStructure,getLoci:Ua,eachLocation:Ga,setUpdateState:(t,r,n)=>{t.createGeometry=r.level!==n.level||r.level==="chain"&&r.chainScale!==n.chainScale||r.level==="residue"&&r.residueScale!==n.residueScale||r.level==="element"&&r.elementScale!==n.elementScale||r.ignoreHydrogens!==n.ignoreHydrogens||r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant}},e)}function Rot(e,t,r,n,o){switch(n.level){case"chain":return Dot(e,t,r,n,o);case"residue":return wot(e,t,r,n,o);case"element":return Mot(e,t,r,n,o)}}var zp=b(),HR=new Fi("98");function Dot(e,t,r,n,o){let i=Q.Location.create(t),{units:a,serialMapping:s}=t,{auth_asym_id:l,label_asym_id:u}=Ke.chain,{cumulativeUnitElementCount:c}=s,m=a.length,{chainScale:d}=n,p=Ws.create(n,m,m/2,o);for(let h=0,f=a.length;h<f;++h){let g=a[h];i.unit=g,i.element=g.elements[0];let{center:y,radius:x}=g.lookup3d.boundary.sphere;b.transformMat4(zp,y,g.conformation.operator.matrix);let S=l(i),I=u(i),v=S===I?I:`${I} [${S}]`;p.add(v,zp[0],zp[1],zp[2],x,d,c[h])}return p.getText()}function wot(e,t,r,n,o){let i=Q.Location.create(t),{units:a,serialMapping:s}=t,{label_comp_id:l}=Ke.atom,{auth_seq_id:u}=Ke.residue,{cumulativeUnitElementCount:c}=s,m=t.polymerResidueCount*2,{residueScale:d}=n,p=Ws.create(n,m,m/2,o);for(let h=0,f=a.length;h<f;++h){let g=a[h],y=g.conformation,{elements:x}=g;i.unit=g,i.element=g.elements[0];let S=g.model.atomicHierarchy.residueAtomSegments.index,I=c[h],v=0,A=x.length;for(;v<A;){let P=v,T=S[x[v]];for(v++;v<A&&S[x[v]]===T;)v++;HR.reset();for(let B=P;B<v;B++)y.position(x[B],zp),HR.includePosition(zp);HR.finishedIncludeStep();for(let B=P;B<v;B++)y.position(x[B],zp),HR.radiusPosition(zp);i.element=x[P];let{center:R,radius:w}=HR.getSphere(),E=u(i),D=`${l(i)} ${E}`;p.add(D,R[0],R[1],R[2],w,d,I+P)}}return p.getText()}function Mot(e,t,r,n,o){let i=Q.Location.create(t),{units:a,serialMapping:s}=t,{label_atom_id:l,label_alt_id:u}=Ke.atom,{cumulativeUnitElementCount:c}=s,m=r.size,d=t.elementCount,{elementScale:p}=n,h=Ws.create(n,d,d/2,o);for(let f=0,g=a.length;f<g;++f){let y=a[f],x=y.conformation,{elements:S}=y;i.unit=y;let I=c[f],v=tm(t,y,{...n,traceOnly:!1});for(let A=0,P=S.length;A<P;A++){if(v&&v(S[A]))continue;i.element=S[A],x.position(i.element,zp);let T=l(i),R=u(i),w=R?`${T}%${R}`:T;h.add(w,zp[0],zp[1],zp[2],m.size(i),p,I+A)}}return h.getText()}var WR=b(),hL=[],jR=new Fi("98"),qve=[],Yve={},cX=class{constructor(t){this.rows=t;this.cache={};this.hasOperators=t.some(r=>en(r.instance_id))}get(t){let r=t.conformation.operator.instanceId,n=`${t.model.id}:${t.kind}:${this.hasOperators?r:"*"}`;return this.cache[n]??=this.compute(t)}compute(t){let r=t.conformation.operator.instanceId,n=ak.get(t.model);switch(t.kind){case ue.Kind.Atomic:return Upe(this.rows,t.model,r,n);case ue.Kind.Spheres:return Npe(this.rows,t.model,r,n);case ue.Kind.Gaussians:return zpe(this.rows,t.model,r,n)}}},Bot=8;function gL(e,t,r){let n=Q.Location.create(e),{units:o}=e,{type_symbol:i}=Ke.atom;hL.length=0;let a=0,s=0,l,u,c=new cX(t);for(let m=0,d=o.length;m<d;m++){let p=o[m];if(r&&p.model.id!==r.id)continue;let h=p.kind===ue.Kind.Spheres?p.model.coarseHierarchy.spheres:p.kind===ue.Kind.Gaussians?p.model.coarseHierarchy.gaussians:void 0,f=c.get(p);zi.selectElementsInRanges(p.elements,f,qve,Yve),n.unit=p;for(let g of qve){if(n.element=g,ex(hL,p.conformation.position(g,WR)),l??=e.serialMapping.cumulativeUnitElementCount[m]+Yve.value,u??=UR(p,g)*1.2,h){let y=h.seq_id_end.value(g)-h.seq_id_begin.value(g)+1;s+=y*Bot}else i(n)!=="H"&&s++;a++}}if(a>0){let{center:m,radius:d}=a>1?Eot(hL):{center:b.fromArray(b(),hL,0),radius:u},p=(s||a)**(1/3);return{center:m,depth:d,scale:p,group:l}}}function Eot(e){let t=e.length;jR.reset();for(let r=0;r<t;r+=3)b.fromArray(WR,e,r),jR.includePosition(WR);jR.finishedIncludeStep();for(let r=0;r<t;r+=3)b.fromArray(WR,e,r),jR.radiusPosition(WR);return jR.getSphere()}var mX={annotationId:C.Text("",{description:'Reference to "Annotation" custom model property',isEssential:!0}),fieldName:C.Text("label",{description:"Annotation field (column) from which to take label contents",isEssential:!0}),...Tu(Sb,["level","chainScale","residueScale","elementScale"]),borderColor:{...Sb.borderColor,defaultValue:Lt.black}};function Kve(e){return UA({defaultProps:C.getDefaultValues(mX),createGeometry:kot,createLocationIterator:Ao.fromStructure,getLoci:Ua,eachLocation:Ga,setUpdateState:(t,r,n)=>{t.createGeometry=r.annotationId!==n.annotationId||r.fieldName!==n.fieldName}},e)}function kot(e,t,r,n,o){let{annotation:i,model:a}=qI(t,n.annotationId),s=i?.getRows()??[],{count:l,offsets:u,grouped:c}=jpe(s),m=Ws.create(n,l,l/2,o);for(let d=0;d<l;d++){let p=c[u[d]],h=i.getValueForRow(p,n.fieldName);if(!h)continue;let f=c.slice(u[d],u[d+1]).map(y=>s[y]),g=gL(t,f,a);g&&m.add(h,g.center[0],g.center[1],g.center[2],g.depth,g.scale,g.group)}return m.getText()}var $ve={"label-text":(e,t)=>po("Label text",e,t,Kve)},Jve={...mX,visuals:C.MultiSelect(["label-text"],C.objectToOptions($ve))};function Fot(e,t){let r=Ut.createMulti("Label",e,t,qn,$ve);return r.setState({pickable:!1,markerActions:0}),r}var yL={name:"mvs-annotation-label",label:"MVS Annotation Label",description:"Displays labels based on annotation custom model property",factory:Fot,getParams:()=>Jve,defaultValues:C.getDefaultValues(Jve),defaultColorTheme:{name:"uniform"},defaultSizeTheme:{name:"physical"},isApplicable:e=>e.elementCount>0&&fC(e)};var dX={tooltips:C.ObjectList({annotationId:C.Text("",{description:'Reference to "MVS Annotation" custom model property'}),fieldName:C.Text("tooltip",{description:"Annotation field (column) from which to take color values"})},e=>`${e.annotationId}:${e.fieldName}`)},u1=Zl.createProvider({label:"MVS Annotation Tooltips",descriptor:{name:"mvs-annotation-tooltips"},type:"local",defaultParams:dX,getParams:e=>dX,isApplicable:e=>e.root===e,obtain:async(e,t,r)=>({value:{...C.getDefaultValues(dX),...r}})}),eIe={label:e=>{switch(e.kind){case"element-loci":if(!e.structure.customPropertyDescriptors.hasReference(u1.descriptor))return;let t=Q.Loci.getFirstLocation(e);if(!t)return;let r=u1.get(t.structure).value;if(!r||r.tooltips.length===0)return;let n=nb.get(t.unit.model).value,o=r.tooltips.map(i=>n?.getAnnotation(i.annotationId)?.getValueForLocation(t,i.fieldName));return ok(o).join(" | ");default:return}}};var pX={annotationId:C.Text("",{description:'Reference to "Annotation" custom model property'}),fieldName:C.Text("component",{description:"Annotation field (column) from which to take component identifier"}),fieldValues:C.MappedStatic("all",{all:C.EmptyGroup(),selected:C.ObjectList({value:C.Text()},e=>e.value)}),nullIfEmpty:C.Optional(C.Boolean(!0,{isHidden:!1})),label:C.Text("",{isHidden:!1})},oh=et.builderFactory("mvs"),fX=oh({name:"mvs-structure-component-from-annotation",display:{name:"MVS Annotation Component",description:"A molecular structure component defined by MVS annotation data."},from:ne.Molecule.Structure,to:ne.Molecule.Structure,params:pX})({apply({a:e,params:t}){return hX(e.data,t)},update:({a:e,b:t,oldParams:r,newParams:n})=>Vot(e.data,t,r,n),dispose({b:e}){e?.data.customPropertyDescriptors.dispose()}});function Lot(e,t){let{annotation:r}=qI(e,t.annotationId);if(r){let n=r.getRows();if(t.fieldValues.name==="selected"){let a=new Set(t.fieldValues.params.map(s=>s.value));n=n.filter((s,l)=>a.has(r.getValueForRow(l,t.fieldName)))}let o=ZI(n),{selection:i}=js.createAndRun(e,o);return ut.unionStructure(i)}else return De.Empty}function hX(e,t){let r=Lot(e,t);if(t.nullIfEmpty&&r.elementCount===0)return Gn.Null;let n=t.label;if(n===void 0||n==="")if(t.fieldValues.name==="selected"&&t.fieldValues.params.length>0){let i=t.fieldValues.params,a=`"${i[0].value}"`;i.length===2?a+=` + "${i[1].value}"`:i.length>2&&(a+=` + ${i.length-1} more values`),n=`MVS Annotation Component (${t.fieldName}: ${a})`}else n="MVS Annotation Component";let o={label:n,description:De.elementDescription(r)};return new ne.Molecule.Structure(r,o)}function Vot(e,t,r,n){let o=!qi(n,r),i=!qi(Tu(n,["label"]),Tu(r,["label"]));return o?i?et.UpdateResult.Recreate:(t.label=n.label||t.label,et.UpdateResult.Updated):et.UpdateResult.Unchanged}var Oot=new dC(QJ(D0e,e=>Sm(e)),"all"),XA=C.MappedStatic("static",{static:Oot.PDSelect(),expression:C.Value(ie.struct.generator.all),bundle:C.Value(Q.Bundle.Empty),script:C.Script({language:"mol-script",expression:"(sel.atom.all)"}),annotation:C.Group(Ll(pX,["annotationId","fieldName","fieldValues"]))},{description:"Define a part of the structure where this layer applies (use Static:all to apply to the whole structure)"}),tIe={name:"static",params:"all"};function rIe(e){return e.name==="static"&&e.params==="all"}var QA={fromStructure(e){if(!e)return{};let t={};for(let r of e.units)t[r.id]=r.elements;return t},fromSelector(e,t){if(!e)return{};let r=XR(e,t);return this.fromStructure(r)},has(e,t){let r=e[t.unit.id];return r?Be.has(r,t.element):!1}};function XR(e,t){let r=t.name==="annotation"?hX(e,{...t.params,label:"",nullIfEmpty:!1}):hA(e,{type:t,label:"",nullIfEmpty:!1},{source:e});return ne.Molecule.Structure.is(r)?r.data:De.Empty}var gX={items:C.ObjectList({text:C.Text("\xAF\\_(\u30C4)_/\xAF"),position:C.MappedStatic("selection",{x_y_z:C.Group({x:C.Numeric(0),y:C.Numeric(0),z:C.Numeric(0),scale:C.Numeric(1,{min:0,max:20,step:.1})}),selection:C.Group({selector:XA})})},e=>e.text,{isEssential:!0}),...Tu(Sb,["level","chainScale","residueScale","elementScale"]),borderColor:{...Sb.borderColor,defaultValue:Lt.black}};function nIe(e){return UA({defaultProps:C.getDefaultValues(gX),createGeometry:Got,createLocationIterator:Ao.fromStructure,getLoci:Ua,eachLocation:Ga,setUpdateState:(t,r,n)=>{t.createGeometry=!qi(r.items,n.items)}},e)}function Got(e,t,r,n,o){let i=n.items.length,a=Ws.create(n,i,i/2,o);for(let s of n.items)switch(s.position.name){case"x_y_z":let l=s.position.params.scale;a.add(s.text,s.position.params.x,s.position.params.y,s.position.params.z,l,l,0);break;case"selection":let u=XR(t,s.position.params.selector),c=gL(u,[{}]),m=Uot(t,u)??0;c&&a.add(s.text,c.center[0],c.center[1],c.center[2],c.depth,c.scale,m);break}return a.getText()}function Uot(e,t){if(t.isEmpty)return;let r=t.units[0],n=r.elements[0];for(let o of e.units)if(o.model.id===r.model.id&&Be.has(o.elements,n))return e.serialMapping.getSerialIndex(o,n)}var iIe={"label-text":(e,t)=>po("Label text",e,t,nIe)},oIe={...gX,visuals:C.MultiSelect(["label-text"],C.objectToOptions(iIe))};function Not(e,t){let r=Ut.createMulti("Label",e,t,qn,iIe);return r.setState({pickable:!1,markerActions:0}),r}var bL={name:"mvs-custom-label",label:"MVS Custom Label",description:"Displays labels with custom text",factory:Not,getParams:()=>oIe,defaultValues:C.getDefaultValues(oIe),defaultColorTheme:{name:"uniform"},defaultSizeTheme:{name:"physical"},isApplicable:e=>e.elementCount>0&&fC(e)};var yX={tooltips:C.ObjectList({text:C.Text("",{description:"Text of the tooltip"}),selector:XA},e=>e.text)},c1=Zl.createProvider({label:"MVS Custom Tooltips",descriptor:{name:"mvs-custom-tooltips"},type:"local",defaultParams:yX,getParams:e=>yX,isApplicable:e=>e.root===e,obtain:async(e,t,r)=>({value:{...C.getDefaultValues(yX),...r}.tooltips.map(i=>({selector:i.selector,text:i.text}))})}),aIe={label:e=>{switch(e.kind){case"element-loci":if(!e.structure.customPropertyDescriptors.hasReference(c1.descriptor))return;let t=Q.Loci.getFirstLocation(e);if(!t)return;let r=c1.get(t.structure).value;if(!r||r.length===0)return;let n=[];for(let o of r){let i=o.elementSet??=QA.fromSelector(t.structure,o.selector);QA.has(i,t)&&n.push(o.text)}return ok(n).join(" | ");default:return}}};function ZA(e,t){if(e.ext==="bcif")try{let r=qE(t);if(r.encoder.startsWith("VolumeServer"))return"dscif";if(r.encoder.startsWith("volseg-volume-server"))return"segcif";if(xX(r,"volume_data_3d_info")){if(xX(r,"volume_data_3d"))return"dscif";if(xX(r,"segmentation_data_3d"))return"segcif"}}catch(r){console.error(r)}else if(e.ext==="cif"){let r=t;if(r.startsWith(`data_SERVER
#
_density_server_result`))return"dscif";if(r.startsWith(`data_SERVER
#
data_SEGMENTATION_DATA`))return"segcif";if(bX(r,"volume_data_3d_info")){if(bX(r,"volume_data_3d"))return"dscif";if(bX(r,"segmentation_data_3d"))return"segcif"}if(r.includes("atom_site_fract_x")||r.includes("atom_site.fract_x"))return"coreCif"}return-1}function bX(e,t){return e.includes(`_${t}.`)}function xX(e,t){for(let r of e.dataBlocks)for(let n of r.categories)if(n.name===t)return!0;return!1}function lo(){return lo.zero()}(s=>{function e(){return{x:0,y:0,width:0,height:0}}s.zero=e;function t(l,u,c,m){return{x:l,y:u,width:c,height:m}}s.create=t;function r(l){return{...l}}s.clone=r;function n(l,u){return Object.assign(l,u)}s.copy=n;function o(l,u,c,m,d){return l.x=u,l.y=c,l.width=m,l.height=d,l}s.set=o;function i(l,u){return l[0]=u.x,l[1]=u.y,l[2]=u.width,l[3]=u.height,l}s.toVec4=i;function a(l,u){return l.x===u.x&&l.y===u.y&&l.width===u.width&&l.height===u.height}s.equals=a})(lo||={});var Lg=Et();function xL(e,t,r,n){let{x:o,y:i,width:a,height:s}=r;Et.set(Lg,t[0],t[1],t[2],1),Et.transformMat4(Lg,Lg,n);let l=Lg[3];return l!==0&&(Lg[0]/=l,Lg[1]/=l,Lg[2]/=l),e[0]=(Lg[0]+1)*a*.5+o,e[1]=(Lg[1]+1)*s*.5+i,e[2]=(Lg[2]+1)*.5,e[3]=l===0?0:1/l,e}function Vg(e,t,r,n){let{x:o,y:i,width:a,height:s}=r,l=t[0]-o,u=t[1]-i,c=t[2];return e[0]=2*l/a-1,e[1]=2*u/s-1,e[2]=2*c-1,b.transformMat4(e,e,n)}function m1(e){if(typeof e=="object"){if("buttons"in e)return e.buttons;if("which"in e){let t=e.which;if(t===2)return 4;if(t===3)return 2;if(t>0)return 1<<t-1}}return 0}function qA(e){if(typeof e=="object"&&"button"in e){let t=e.button;if(t===1)return 4;if(t===2)return 2;if(t>=0)return 1<<t}return 0}function CL(e){return{alt:"altKey"in e?e.altKey:!1,shift:"shiftKey"in e?e.shiftKey:!1,control:"ctrlKey"in e?e.ctrlKey:!1,meta:"metaKey"in e?e.metaKey:!1}}var sIe={noScroll:!0,noMiddleClickScroll:!0,noContextMenu:!0,noPinchZoom:!0,noTextSelect:!0,preventGestures:!1,mask:(e,t)=>!0,pixelScale:1},cs;(i=>{i.None=o();function t(a,s){return a.shift===s.shift&&a.alt===s.alt&&a.control===s.control&&a.meta===s.meta}i.areEqual=t;function r(a){return t(a,i.None)}i.areNone=r;function n(a){if(!a)return 0;let s=0;return a.shift&&s++,a.alt&&s++,a.control&&s++,a.meta&&s++,s}i.size=n;function o(a={}){return{shift:!!a.shift,alt:!!a.alt,control:!!a.control,meta:!!a.meta}}i.create=o})(cs||={});var Ai;(n=>{n.has=Ia.has,n.create=Ia.create;let r;(d=>(d[d.None=0]="None",d[d.Primary=1]="Primary",d[d.Secondary=2]="Secondary",d[d.Auxilary=4]="Auxilary",d[d.Forth=8]="Forth",d[d.Five=16]="Five",d[d.Trigger=32]="Trigger",d[d.Squeeze=48]="Squeeze"))(r=n.Flag||={})})(Ai||={});var CX={key:"",code:"",modifiers:cs.None,x:-1,y:-1,pageX:-1,pageY:-1,preventDefault:vl};function lIe(){return{drag:new Pn,interactionEnd:new Pn,click:new Pn,move:new Pn,wheel:new Pn,pinch:new Pn,gesture:new Pn,resize:new Pn,leave:new Pn,enter:new Pn,modifiers:new Pn,key:new Pn,keyUp:new Pn,keyDown:new Pn,lock:new Pn,trackedPointers:new Pn}}var zot=["Backspace","Delete"],SX;(r=>{function e(n={}){let{noScroll:o,noContextMenu:i}={...sIe,...n};return{noScroll:o,noContextMenu:i,pointerLock:!1,width:0,height:0,pixelRatio:1,...lIe(),setPixelScale:vl,updateTrackedPointers:vl,updateScreenTouches:vl,requestPointerLock:vl,exitPointerLock:vl,dispose:vl}}r.create=e;function t(n,o={}){let{noScroll:i,noMiddleClickScroll:a,noContextMenu:s,noPinchZoom:l,noTextSelect:u,mask:c,pixelScale:m,preventGestures:d}={...sIe,...o},p=n.clientWidth*T(),h=n.clientHeight*T(),f=!1,g=lo(),y=Ce(),x=Ce(),S=Ce(),I=Ce(),v=Ce(),A={shift:!1,alt:!1,control:!1,meta:!1},P={x:-1,y:-1,pageX:-1,pageY:-1};function T(){return window.devicePixelRatio*m}function R(){return{...A}}function w(we){return we.target===document.body||we.target===n}let E=0,M=!1,D=Ai.create(0),B=0,k=!1,F=!1,z;typeof window.ResizeObserver<"u"&&(z=new window.ResizeObserver(Ze));let j=lIe(),{drag:Y,interactionEnd:G,wheel:X,pinch:U,gesture:L,click:q,move:te,leave:J,enter:ee,resize:ce,modifiers:fe,key:O,keyUp:V,keyDown:Z,lock:pe,trackedPointers:$}=j;ae();function ae(){n.addEventListener("contextmenu",re,!1),n.addEventListener("wheel",zt,!1),n.addEventListener("mousedown",Pt,!1),window.addEventListener("mousemove",Ot,!1),window.addEventListener("mouseup",Ft,!1),n.addEventListener("touchstart",$e,!1),n.addEventListener("touchmove",vt,!1),n.addEventListener("touchend",ct,!1),n.addEventListener("gesturechange",Pe,!1),n.addEventListener("gesturestart",me,!1),n.addEventListener("gestureend",_e,!1),window.addEventListener("blur",ge),window.addEventListener("keyup",nt,!1),window.addEventListener("keydown",Ee,!1),window.addEventListener("keypress",at,!1),document.addEventListener("pointerlockchange",ve,!1),document.addEventListener("pointerlockerror",K,!1),z!=null?z.observe(n.parentElement):window.addEventListener("resize",Ze,!1)}function Se(){M||(M=!0,n.removeEventListener("contextmenu",re,!1),n.removeEventListener("wheel",zt,!1),n.removeEventListener("mousedown",Pt,!1),window.removeEventListener("mousemove",Ot,!1),window.removeEventListener("mouseup",Ft,!1),n.removeEventListener("touchstart",$e,!1),n.removeEventListener("touchmove",vt,!1),n.removeEventListener("touchend",ct,!1),n.removeEventListener("gesturechange",Pe,!1),n.removeEventListener("gesturestart",me,!1),n.removeEventListener("gestureend",_e,!1),window.removeEventListener("blur",ge),window.removeEventListener("keyup",nt,!1),window.removeEventListener("keydown",Ee,!1),window.removeEventListener("keypress",at,!1),document.removeEventListener("pointerlockchange",ve,!1),document.removeEventListener("pointerlockerror",K,!1),Ye.remove(),z!=null?(z.unobserve(n.parentElement),z.disconnect()):window.removeEventListener("resize",Ze,!1))}function ve(){n.ownerDocument.pointerLockElement===n?f=!0:f=!1,Xr(f),pe.next(f)}function K(){console.error("Unable to use Pointer Lock API"),f=!1,Xr(f),pe.next(f)}function re(we){c(we.clientX,we.clientY)&&s&&we.preventDefault()}function le(we){A.alt=we.altKey,A.shift=we.shiftKey,A.control=we.ctrlKey,A.meta=we.metaKey}function ge(){(D||A.shift||A.alt||A.meta||A.control)&&(D=0,A.shift=A.alt=A.control=A.meta=!1)}function Ee(we){let qt=!1;!A.alt&&we.altKey&&(qt=!0,A.alt=!0),!A.shift&&we.shiftKey&&(qt=!0,A.shift=!0),!A.control&&we.ctrlKey&&(qt=!0,A.control=!0),!A.meta&&we.metaKey&&(qt=!0,A.meta=!0),qt&&k&&fe.next(R()),w(we)&&k&&Z.next({key:we.key,code:we.code,modifiers:R(),...P,preventDefault:()=>we.preventDefault()})}function nt(we){let qt=!1;A.alt&&!we.altKey&&(qt=!0,A.alt=!1),A.shift&&!we.shiftKey&&(qt=!0,A.shift=!1),A.control&&!we.ctrlKey&&(qt=!0,A.control=!1),A.meta&&!we.metaKey&&(qt=!0,A.meta=!1),qt&&k&&fe.next(R()),zot.includes(we.key)&&at(we),w(we)&&k&&V.next({key:we.key,code:we.code,modifiers:R(),...P,preventDefault:()=>we.preventDefault()})}function at(we){!w(we)||!k||O.next({key:we.key,code:we.code,modifiers:R(),...P,preventDefault:()=>we.preventDefault()})}let be={primary:{prev:void 0,down:Ce(),end:Ce(),axes:[]},secondary:{prev:void 0,down:Ce(),end:Ce(),axes:[]},distance:-1};function Re(we,qt,Cr){let Rn=Ai.has(qt,we);return(Cr?Ai.has(Cr,we):!1)&&!Rn}function Fe(we,qt){let{x:Cr,y:Rn,dx:Ri,dy:Da,ray:zu,buttons:Hu,axes:Au}=we,[Th,Ph]=[Cr,Rn],Y1=cs.create(),jG=!0,dm=qt?be.secondary:be.primary,{prev:hy}=dm;Hu===2?te.next({x:Cr,y:Rn,pageX:Th,pageY:Ph,buttons:0,button:0,modifiers:Y1,inside:!0,onElement:!0,ray:zu}):hy?.buttons===2&&J.next(void 0);let Wb=Ai.has(Hu,1),Xb=hy?Ai.has(hy.buttons,1):!1;if(Xb&&!Wb&&(Ce.set(dm.end,Cr,Rn),Ce.distance(dm.end,dm.down)<20&&q.next({x:Cr,y:Rn,pageX:Th,pageY:Ph,buttons:32,button:32,modifiers:Y1,ray:zu}),G.next(void 0)),Wb){let _h=!Xb;Y.next({x:Cr,y:Rn,dx:Ri,dy:Da,pageX:Th,pageY:Ph,buttons:32,button:32,modifiers:Y1,isStart:_h,useDelta:jG}),_h&&Ce.set(dm.down,Cr,Rn)}let El={x:0,y:0,pageX:0,pageY:0,modifiers:Y1,preventDefault:()=>{}};if(Re(8,Hu,hy?.buttons)){let _h=qt?"GamepadX":"GamepadA";V.next({...El,code:_h,key:_h})}if(Re(16,Hu,hy?.buttons)){let _h=qt?"GamepadY":"GamepadB";V.next({...El,code:_h,key:_h})}Au&&(Au[2]<0?(Z.next({...El,code:"GamepadLeft",key:"GamepadLeft"}),V.next({...El,code:"GamepadRight",key:"GamepadRight"})):Au[2]>0?(Z.next({...El,code:"GamepadRight",key:"GamepadRight"}),V.next({...El,code:"GamepadLeft",key:"GamepadLeft"})):Au[2]!==dm.axes[2]&&(V.next({...El,code:"GamepadLeft",key:"GamepadLeft"}),V.next({...El,code:"GamepadRight",key:"GamepadRight"})),Au[3]<0?(Z.next({...El,code:"GamepadUp",key:"GamepadUp"}),V.next({...El,code:"GamepadDown",key:"GamepadDown"})):Au[3]>0?(Z.next({...El,code:"GamepadDown",key:"GamepadDown"}),V.next({...El,code:"GamepadUp",key:"GamepadUp"})):Au[3]!==dm.axes[3]&&(V.next({...El,code:"GamepadUp",key:"GamepadUp"}),V.next({...El,code:"GamepadDown",key:"GamepadDown"}))),dm.axes=Au||[],dm.prev=we}function Ne(we,qt,Cr){let Rn=b.distance(we.ray.origin,qt.ray.origin);if(be.distance>0){let Ri=Rn/be.distance;L.next({scale:Ri,rotation:0,deltaScale:0,deltaRotation:0,buttons:Cr,button:Cr,modifiers:R()})}be.distance=Rn}function ot(we){let qt,Cr;for(let Rn of we)Rn.handedness==="right"?qt=Rn:Rn.handedness==="left"&&(Cr=Rn);!qt&&Cr&&(qt=Cr,Cr=void 0),qt?.buttons===1&&Cr?.buttons===1?Ne(qt,Cr,32):qt?.buttons===2&&Cr?.buttons===2?Ne(qt,Cr,48):(be.distance===-1&&(qt&&Fe(qt,!1),Cr&&Fe(Cr,!0)),!qt?.buttons&&!Cr?.buttons&&(be.distance=-1))}let it,Xt,$r=-1;function bt(we){if(we.length===2){let dm=Ce.fromObj(we[0]),hy=Ce.fromObj(we[1]),Wb=Ce.distance(dm,hy),Xb=32;if($r>0){let El=Wb/$r;L.next({scale:El,rotation:0,deltaScale:0,deltaRotation:0,buttons:Xb,button:Xb,modifiers:R()})}$r=Wb,it=void 0;return}$r=-1;let qt=we[0];if(!qt){if(Xt&&it){let dm=Ce.fromObj(Xt),hy=Ce.fromObj(it);if(Ce.distance(dm,hy)<10){let[Wb,Xb]=dm,[El,_h]=[Wb,Xb],KBe=cs.create(),mJ=32,{ray:JBe}=Xt;q.next({x:Wb,y:Xb,pageX:El,pageY:_h,buttons:mJ,button:mJ,modifiers:KBe,ray:JBe})}G.next(void 0)}it=void 0,Xt=void 0;return}let Cr=Ce.fromObj(qt),[Rn,Ri]=Cr,[Da,zu]=[Rn,Ri],Hu=cs.create(),Au=32,Th=!0,Ph=it===void 0,Y1=it?Rn-it.x:0,jG=it?Ri-it.y:0;it=qt,Ph&&(Xt=qt),Y.next({x:Rn,y:Ri,dx:Y1,dy:jG,pageX:Da,pageY:zu,buttons:Au,button:Au,modifiers:Hu,isStart:Ph,useDelta:Th})}function xr(we){let qt=we.touches[0],Cr=we.touches[1];return{clientX:(qt.clientX+Cr.clientX)/2,clientY:(qt.clientY+Cr.clientY)/2,pageX:(qt.pageX+Cr.pageX)/2,pageY:(qt.pageY+Cr.pageY)/2,target:we.target}}function tn(we){let qt=we.touches[0].pageX-we.touches[1].pageX,Cr=we.touches[0].pageY-we.touches[1].pageY;return Math.sqrt(qt*qt+Cr*Cr)}let pn=-1,io,Hn=Ce(),Zi=Ce();function mm(we){pn<0||(Ce.set(Zi,we.touches[0].pageX,we.touches[0].pageY),pn+=Ce.distance(Hn,Zi),Ce.copy(Hn,Zi))}let ao=Ce(),N=!1,oe=0,Ve=1;function $e(we){if(we.preventDefault(),io=void 0,pn=-1,we.touches.length===1)D=B=1,pn=0,Ce.set(Hn,we.touches[0].pageX,we.touches[0].pageY),io=we.touches[0],wt(we.touches[0]),Ce.copy(ao,x),N=!0;else if(we.touches.length===2){D=6,B=2,le(we),Ve=1,oe=tn(we);let{pageX:qt,pageY:Cr}=Oe(xr(we));N||(ir(ao,xr(we)),N=!0),U.next({isStart:!0,distance:oe,delta:0,fraction:Ve,fractionDelta:0,startX:ao[0],startY:ao[1],centerPageX:qt,centerPageY:Cr,buttons:D,button:B,modifiers:R()})}else we.touches.length===3&&(D=B=8,wt(xr(we)))}function ct(we){if(Dt(),io&&pn<=4){let qt=io;if(!c(qt.clientX,qt.clientY))return;ir(Zi,qt);let{pageX:Cr,pageY:Rn}=Oe(qt),[Ri,Da]=Zi;q.next({x:Ri,y:Da,pageX:Cr,pageY:Rn,buttons:D,button:B,modifiers:R()})}io=void 0,N=!1}function vt(we){if(B=0,l&&(we.preventDefault(),we.stopPropagation(),we.originalEvent&&(we.originalEvent.preventDefault(),we.originalEvent.stopPropagation())),io=void 0,we.touches.length===1)D=1,io=we.touches[0],mm(we),Zt(we.touches[0]);else if(we.touches.length===2){D=6,B=2,le(we);let{pageX:qt,pageY:Cr}=Oe(xr(we)),Rn=tn(we),Ri=oe-Rn,Da=oe/Rn,zu=Da-Ve;Ve=Da,U.next({isStart:!1,distance:Rn,delta:Ri,fraction:Da,fractionDelta:zu,startX:ao[0],startY:ao[1],centerPageX:qt,centerPageY:Cr,buttons:D,button:B,modifiers:R()})}else we.touches.length===3&&(D=8,Zt(xr(we)))}function Pt(we){le(we),D=m1(we),B=qA(we),a&&D===4&&we.preventDefault,wt(we)}function Ot(we){le(we),D=m1(we),B=0,Zt(we)}function Ft(we){le(we),D=m1(we),B=qA(we),Nt(we),Dt()}function Dt(){G.next(void 0)}function wt(we){c(we.clientX,we.clientY)&&(ir(x,we),Ce.copy(y,x),ze(x)&&(E=1))}function Nt(we){if(E=0,!!c(we.clientX,we.clientY)){if(ir(S,we),!F&&Ce.distance(S,y)<4){let{pageX:qt,pageY:Cr}=Oe(we),[Rn,Ri]=S;q.next({x:Rn,y:Ri,pageX:qt,pageY:Cr,buttons:D,button:B,modifiers:R()})}F=!1}}function Zt(we){ir(S,we);let{pageX:qt,pageY:Cr}=Oe(we),[Rn,Ri]=S,{movementX:Da,movementY:zu}=we,Hu=ze(S)&&c(we.clientX,we.clientY);if(k&&!Hu?J.next(void 0):!k&&Hu&&ee.next(void 0),k=Hu,P.x=Rn,P.y=Ri,P.pageX=qt,P.pageY=Cr,te.next({x:Rn,y:Ri,pageX:qt,pageY:Cr,movementX:Da,movementY:zu,buttons:D,button:B,modifiers:R(),inside:Hu,onElement:we.target===n}),E===0||(u&&we.preventDefault?.(),Ce.div(I,Ce.sub(I,S,x),Rt(v)),Ce.magnitude(I)<1e-6))return;let Au=E===1;if(Au&&!c(we.clientX,we.clientY))return;Ce.distance(S,y)>=4&&(F=!0);let[Th,Ph]=I;Y.next({x:Rn,y:Ri,dx:Th,dy:Ph,pageX:qt,pageY:Cr,buttons:D,button:B,modifiers:R(),isStart:Au}),Ce.copy(x,S),E=2}function zt(we){if(!c(we.clientX,we.clientY))return;ir(S,we);let{pageX:qt,pageY:Cr}=Oe(we),[Rn,Ri]=S;i&&we.preventDefault();let Da=vX(we);D=B=4,(Da.dx||Da.dy||Da.dz)&&X.next({x:Rn,y:Ri,pageX:qt,pageY:Cr,...Da,buttons:D,button:B,modifiers:R()})}function hr(we){d&&(we.preventDefault(),we.stopImmediatePropagation?.(),we.stopPropagation?.())}let ar=0,fr=0;function me(we){hr(we),ar=we.scale,fr=we.rotation,L.next({scale:we.scale,rotation:we.rotation,deltaRotation:0,deltaScale:0,isStart:!0,buttons:D,button:B,modifiers:R()})}function Ie(we,qt){L.next({scale:we.scale,rotation:we.rotation,deltaRotation:fr-we.rotation,deltaScale:ar-we.scale,isEnd:qt,buttons:D,button:B,modifiers:R()}),fr=we.rotation,ar=we.scale}function Pe(we){hr(we),Ie(we)}function _e(we){hr(we),Ie(we,!0)}function Ze(){p=n.clientWidth*T(),h=n.clientHeight*T(),ce.next({})}function ze(we){if(n instanceof Window||n instanceof Document||n===document.body)return!0;{let qt=n.getBoundingClientRect();return we[0]>=0&&we[1]>=0&&we[0]<qt.width&&we[1]<qt.height}}function Rt(we){return we[0]=n.clientWidth,we[1]=n.clientHeight,we}function ir(we,qt){if(p=n.clientWidth*T(),h=n.clientHeight*T(),f){let Cr=T();we[0]=(g.x+g.width/2)/Cr,we[1]=(h-(g.y+g.height/2))/Cr}else{let Cr=n.getBoundingClientRect();we[0]=(qt.clientX||0)-Cr.left,we[1]=(qt.clientY||0)-Cr.top}return we}function Oe(we){return f?{pageX:Math.round(window.innerWidth/2)+g.x,pageY:Math.round(window.innerHeight/2)+g.y}:{pageX:we.pageX,pageY:we.pageY}}let ht=30,Ye=dr();function dr(){let we=document.createElement("div"),qt="30%",Cr="10%",Rn=`#000 ${qt}, #0000 0 calc(100% - ${qt}), #000 0`,Ri=`linear-gradient(0deg, ${Rn}) 50%/${Cr} 100% no-repeat`,Da=`linear-gradient(90deg, ${Rn}) 50%/100% ${Cr} no-repeat`;return Object.assign(we.style,{width:`${ht}px`,aspectRatio:1,background:`${Ri}, ${Da}, radial-gradient(circle at 50%, #000 5%, #0000 5%)`,display:"none",zIndex:1e3,position:"absolute",mixBlendMode:"difference",filter:"invert(1)"}),n.parentElement?.appendChild(we),we}function Xr(we){if(Ye.style.display=we?"block":"none",we){let qt=T(),Cr=(g.x+g.width/2)/qt,Rn=(g.y+g.height/2)/qt;Ye.style.width=`${ht}px`,Ye.style.left=`calc(${Cr}px - ${ht/2}px)`,Ye.style.bottom=`calc(${Rn}px - ${ht/2}px)`}}return{get noScroll(){return i},set noScroll(we){i=we},get noContextMenu(){return s},set noContextMenu(we){s=we},get width(){return p},get height(){return h},get pixelRatio(){return T()},get pointerLock(){return f},...j,setPixelScale:we=>{m=we,p=n.clientWidth*T(),h=n.clientHeight*T()},updateTrackedPointers:we=>{ot(we),$.next(we)},updateScreenTouches:we=>{bt(we)},requestPointerLock:we=>{g=we,f||n.requestPointerLock()},exitPointerLock:()=>{f&&n.ownerDocument.exitPointerLock()},dispose:Se}}r.fromElement=t})(SX||={});function vX(e){let o=0,i=0,a=0,s=0,l=0;return"detail"in e&&(i=e.detail),"wheelDelta"in e&&(i=-e.wheelDelta/120),"wheelDeltaY"in e&&(i=-e.wheelDeltaY/120),"wheelDeltaX"in e&&(o=-e.wheelDeltaX/120),"axis"in e&&e.axis===e.HORIZONTAL_AXIS&&(o=i,i=0),a=o*10,s=i*10,"deltaY"in e&&(s=e.deltaY),"deltaX"in e&&(a=e.deltaX),"deltaZ"in e&&(l=e.deltaZ),(a||s||l)&&e.deltaMode&&(e.deltaMode===1?(a*=40,s*=40,l*=40):(a*=800,s*=800,l*=800)),a&&!o&&(o=a<0?-1:1),s&&!i&&(i=s<0?-1:1),{spinX:o,spinY:i,dx:a,dy:s,dz:l}}var KA={backgroundColor:C.Color(0,{description:"Background color of the 3D canvas"}),pickingAlphaThreshold:C.Numeric(.5,{min:0,max:1,step:.01},{description:"The minimum opacity value needed for an object to be pickable."}),colorMarker:C.Boolean(!0,{description:"Enable color marker"}),highlightColor:C.Color(Le.fromNormalizedRgb(1,.4,.6)),selectColor:C.Color(Le.fromNormalizedRgb(.2,1,.1)),dimColor:C.Color(Le.fromNormalizedRgb(1,1,1)),highlightStrength:C.Numeric(.3,{min:0,max:1,step:.1}),selectStrength:C.Numeric(.3,{min:0,max:1,step:.1}),dimStrength:C.Numeric(0,{min:0,max:1,step:.1}),markerPriority:C.Select(1,[[1,"Highlight"],[2,"Select"]]),xrayEdgeFalloff:C.Numeric(1,{min:0,max:3,step:.1}),celSteps:C.Numeric(5,{min:2,max:16,step:1}),exposure:C.Numeric(1,{min:0,max:3,step:.01}),light:C.ObjectList({inclination:C.Numeric(150,{min:0,max:180,step:1}),azimuth:C.Numeric(320,{min:0,max:360,step:1}),color:C.Color(Le.fromNormalizedRgb(1,1,1)),intensity:C.Numeric(.6,{min:0,max:5,step:.01})},e=>Le.toHexString(e.color),{defaultValue:[{inclination:150,azimuth:320,color:Le.fromNormalizedRgb(1,1,1),intensity:.6}]}),ambientColor:C.Color(Le.fromNormalizedRgb(1,1,1)),ambientIntensity:C.Numeric(.4,{min:0,max:2,step:.01})},YA=b(),IX=b();function uIe(e,t){let r=e.length,{direction:n,color:o}=t||{direction:new Array(r*3).fill(0),color:new Array(r*3).fill(0)};for(let i=0;i<r;++i){let a=e[i];b.directionFromSpherical(YA,kr(a.inclination),kr(a.azimuth),1),b.toArray(YA,n,i*3),b.scale(IX,Le.toVec3Normalized(IX,a.color),a.intensity),b.toArray(IX,o,i*3)}return{count:r,direction:n,color:o}}function AX(e,t){let r=new Array(e.count*3);for(let n=0,o=e.count;n<o;++n)b.fromArray(YA,e.direction,n*3),b.transformDirection(YA,YA,t),b.toArray(YA,r,n*3);return r}var TX;(n=>{let e;(s=>(s[s.None=0]="None",s[s.BlendedFront=1]="BlendedFront",s[s.BlendedBack=2]="BlendedBack"))(e||={});let t;(s=>(s[s.All=0]="All",s[s.Opaque=1]="Opaque",s[s.Transparent=2]="Transparent"))(t||={});function r(o,i={}){let{gl:a,state:s,stats:l}=o,u=C.merge(KA,C.getDefaultValues(KA),i),c=uIe(u.light),m=lo(),d=Ce.create(a.drawingBufferWidth,a.drawingBufferHeight),p=Le.toVec3Normalized(b(),u.backgroundColor),h=!1,f=null,g=o.resources.texture("image-uint8","rgba","ubyte","nearest");g.define(1,1),g.load({array:new Uint8Array([255,255,255,255]),width:1,height:1});let y=[["tDepth",g]],x=H(),S=H(),I=H(),v=H(),A=H(),P=H(),T=H(),R=H(),w=H(),E=H(),M=H(),D=b(),B=b(),k=b(),F=vo(),z=Ce(),j=Tg(),Y=1,G=he(),X=b();b.scale(X,Le.toArrayNormalized(u.ambientColor,X,0),u.ambientIntensity);let U={uDrawId:_.create(0),uModel:_.create(H.identity()),uView:_.create(S),uInvView:_.create(I),uModelView:_.create(v),uInvModelView:_.create(A),uInvProjection:_.create(P),uProjection:_.create(H()),uModelViewProjection:_.create(T),uInvModelViewProjection:_.create(R),uHasHeadRotation:_.create(!1),uInvHeadRotation:_.create(w),uHasEyeCamera:_.create(!1),uModelViewEye:_.create(E),uInvModelViewEye:_.create(M),uIsAsymmetricProjection:_.create(!1),uIsOrtho:_.create(1),uViewOffset:_.create(z),uModelScale:_.create(1),uPixelRatio:_.create(o.pixelRatio),uViewport:_.create(lo.toVec4(Et(),m)),uDrawingBufferSize:_.create(d),uCameraPosition:_.create(B),uCameraDir:_.create(D),uCameraPlane:_.create(vo.toArray(F,Et(),0)),uNear:_.create(1),uFar:_.create(1e4),uFog:_.create(!0),uFogNear:_.create(1),uFogFar:_.create(1e4),uFogColor:_.create(p),uRenderMask:_.create(0),uMarkingDepthTest:_.create(!1),uPickType:_.create(0),uMarkingType:_.create(0),uTransparentBackground:_.create(!1),uLightDirection:_.create(c.direction),uLightColor:_.create(c.color),uAmbientColor:_.create(X),uPickingAlphaThreshold:_.create(u.pickingAlphaThreshold),uHighlightColor:_.create(Le.toVec3Normalized(b(),u.highlightColor)),uSelectColor:_.create(Le.toVec3Normalized(b(),u.selectColor)),uDimColor:_.create(Le.toVec3Normalized(b(),u.dimColor)),uHighlightStrength:_.create(u.highlightStrength),uSelectStrength:_.create(u.selectStrength),uDimStrength:_.create(u.dimStrength),uMarkerPriority:_.create(u.markerPriority),uMarkerAverage:_.create(0),uXrayEdgeFalloff:_.create(u.xrayEdgeFalloff),uCelSteps:_.create(u.celSteps),uExposure:_.create(u.exposure)},L=Object.entries(U),q=!0,te=(be,Re,Fe)=>{if(be.state.disposed||!be.state.visible||!be.state.pickable&&Re==="pick"||!be.values.drawCount.ref.value||(he.scaleNX(G,be.values.boundingSphere.ref.value,Y),!Tg.intersectsSphere3D(j,G)))return;let[Ne,ot]=be.values.uLod.ref.value;if(Ne!==0||ot!==0){let{center:$r,radius:bt}=G,xr=vo.distanceToPoint(F,$r);if(xr+bt<Ne*Y||xr-bt>ot*Y)return}if(Y===1){if(f!==null&&f(G))return;let $r=be.values.instanceGrid.ref.value.cellSize>0,bt=be.values.uInstanceCount.ref.value>1;$r&&(bt||be.values.lodLevels)?be.cull(F,j,f,o.stats):be.uncull()}else if(be.values.lodLevels){let{center:$r,radius:bt}=G,xr=vo.distanceToPoint(F,$r);be.cullSimple(xr,bt,Y)}else be.uncull();let Xt=be.getProgram(Re);if(s.currentProgramId!==Xt.id&&(q=!0,Xt.use()),q&&(Xt.setUniforms(L),Xt.bindTextures(y,0),q=!1),be.values.dGeometryType.ref.value==="directVolume"){if(Re!=="color")return;s.disable(a.CULL_FACE),s.frontFace(a.CCW)}else Fe===1?(s.enable(a.CULL_FACE),be.values.dFlipSided?.ref.value?(s.frontFace(a.CW),s.cullFace(a.FRONT)):(s.frontFace(a.CCW),s.cullFace(a.BACK))):Fe===2?(s.enable(a.CULL_FACE),be.values.dFlipSided?.ref.value?(s.frontFace(a.CW),s.cullFace(a.BACK)):(s.frontFace(a.CCW),s.cullFace(a.FRONT))):(be.values.uDoubleSided?be.values.uDoubleSided.ref.value||be.values.hasReflection.ref.value?s.disable(a.CULL_FACE):s.enable(a.CULL_FACE):s.disable(a.CULL_FACE),be.values.dFlipSided?.ref.value?(s.frontFace(a.CW),s.cullFace(a.FRONT)):(s.frontFace(a.CCW),s.cullFace(a.BACK)));be.render(Re,y.length)},J=(be,Re)=>{_.update(U.uView,be.view),_.update(U.uInvView,H.invert(I,be.view)),_.update(U.uProjection,be.projection),_.update(U.uInvProjection,H.invert(P,be.projection)),_.updateIfChanged(U.uIsOrtho,be.state.mode==="orthographic"?1:0),_.update(U.uViewOffset,be.viewOffset.enabled?Ce.set(z,be.viewOffset.offsetX*16,be.viewOffset.offsetY*16):Ce.set(z,0,0)),_.updateIfChanged(U.uModelScale,be.scale),_.update(U.uCameraPosition,H.getTranslation(B,I)),b.scale(k,be.state.target,be.scale),b.normalize(D,b.sub(D,k,B)),_.update(U.uCameraDir,D),_.updateIfChanged(U.uFar,be.far),_.updateIfChanged(U.uNear,be.near),_.updateIfChanged(U.uFog,be.state.fog>0),_.updateIfChanged(U.uFogFar,be.fogFar),_.updateIfChanged(U.uFogNear,be.fogNear),_.updateIfChanged(U.uTransparentBackground,h),Tg.fromProjectionMatrix(j,be.projectionView),vo.copy(F,j[Tg.PlaneIndex.Near]),F.constant-=vo.distanceToPoint(F,B),_.update(U.uCameraPlane,vo.toArray(F,U.uCameraPlane.ref.value,0)),_.updateIfChanged(U.uMarkerAverage,Re.markerAverage),!H.isZero(be.headRotation)?(_.updateIfChanged(U.uHasHeadRotation,!0),_.update(U.uInvHeadRotation,H.invert(w,be.headRotation)),_.update(U.uLightDirection,AX(c,w))):(_.updateIfChanged(U.uHasHeadRotation,!1),_.updateIfChanged(U.uInvHeadRotation,H.id),_.update(U.uLightDirection,c.direction)),_.update(U.uIsAsymmetricProjection,be.isAsymmetricProjection)},ee=(be,Re,Fe,Ne,ot)=>{OP(y,"tDepth",Fe||g),Y=Re.scale,_.update(U.uModel,H.scaleUniformly(x,be.view,Y)),_.update(U.uModelView,H.mul(v,Re.view,x)),_.update(U.uInvModelView,H.invert(A,v)),_.update(U.uModelViewProjection,H.mul(T,v,Re.projection)),_.update(U.uInvModelViewProjection,H.invert(R,T)),_.updateIfChanged(U.uRenderMask,Ne),_.updateIfChanged(U.uMarkingDepthTest,ot),!H.isZero(Re.viewEye)?(_.updateIfChanged(U.uHasEyeCamera,!0),_.update(U.uModelViewEye,H.mul(E,Re.viewEye,x)),_.update(U.uInvModelViewEye,H.invert(M,E))):(_.updateIfChanged(U.uHasEyeCamera,!1),_.updateIfChanged(U.uModelViewEye,H.id),_.updateIfChanged(U.uInvModelViewEye,H.id)),s.enable(a.SCISSOR_TEST),s.colorMask(!0,!0,!0,!0);let{x:Xt,y:$r,width:bt,height:xr}=m;s.viewport(Xt,$r,bt,xr),s.scissor(Xt,$r,bt,xr),q=!0,s.currentRenderItemId=-1},ce=function(be){let Re=_r(be.values.alpha.ref.value*be.state.alphaFactor,0,1),Fe=be.values.dXrayShaded?.ref.value==="on"||be.values.dXrayShaded?.ref.value==="inverted";return Re===1&&be.values.transparencyAverage.ref.value!==1&&be.values.dGeometryType.ref.value!=="directVolume"&&be.values.dPointStyle?.ref.value!=="fuzzy"&&!Fe||be.values.dTransparentBackfaces?.ref.value==="opaque"},fe=function(be){let Re=_r(be.values.alpha.ref.value*be.state.alphaFactor,0,1),Fe=be.values.dXrayShaded?.ref.value==="on"||be.values.dXrayShaded?.ref.value==="inverted";return Re!==0&&(Re<1||be.values.transparencyAverage.ref.value>0||be.values.dGeometryType.ref.value==="directVolume"||be.values.dPointStyle?.ref.value==="fuzzy"||be.values.dGeometryType.ref.value==="text"||be.values.dGeometryType.ref.value==="image"||Fe)},O=(be,Re,Fe,Ne)=>{je&&o.timer.mark("Renderer.renderPick"),s.disable(a.BLEND),s.enable(a.DEPTH_TEST),s.depthMask(!0),ee(be,Re,null,0,!1),_.updateIfChanged(U.uPickType,Ne);let{renderables:ot}=be;for(let it=0,Xt=ot.length;it<Xt;++it)ot[it].state.colorOnly||te(ot[it],Fe,0);je&&o.timer.markEnd("Renderer.renderPick")},V=(be,Re)=>{je&&o.timer.mark("Renderer.renderDepth"),s.disable(a.BLEND),s.enable(a.DEPTH_TEST),s.depthMask(!0),ee(be,Re,null,0,!1);let{renderables:Fe}=be;for(let Ne=0,ot=Fe.length;Ne<ot;++Ne)te(Fe[Ne],"depth",0);je&&o.timer.markEnd("Renderer.renderDepth")},Z=(be,Re)=>{je&&o.timer.mark("Renderer.renderDepthOpaque"),s.disable(a.BLEND),s.enable(a.DEPTH_TEST),s.depthMask(!0),ee(be,Re,null,1,!1);let{renderables:Fe}=be;for(let Ne=0,ot=Fe.length;Ne<ot;++Ne){let it=Fe[Ne];ce(it)&&te(it,"depth",0)}je&&o.timer.markEnd("Renderer.renderDepthOpaque")},pe=(be,Re)=>{je&&o.timer.mark("Renderer.renderDepthOpaqueBack"),s.disable(a.BLEND),s.enable(a.DEPTH_TEST),s.depthMask(!0),s.depthFunc(a.GREATER),ee(be,Re,null,1,!1);let{renderables:Fe}=be;for(let Ne=0,ot=Fe.length;Ne<ot;++Ne){let it=Fe[Ne];ce(it)&&te(it,"depth",2)}s.depthFunc(a.LESS),je&&o.timer.markEnd("Renderer.renderDepthOpaqueBack")},$=(be,Re,Fe)=>{je&&o.timer.mark("Renderer.renderDepthTransparent"),s.disable(a.BLEND),s.enable(a.DEPTH_TEST),s.depthMask(!0),ee(be,Re,Fe,2,!1);let{renderables:Ne}=be;for(let ot=0,it=Ne.length;ot<it;++ot){let Xt=Ne[ot];fe(Xt)&&te(Xt,"depth",0)}je&&o.timer.markEnd("Renderer.renderDepthTransparent")},ae=(be,Re)=>{je&&o.timer.mark("Renderer.renderMarkingDepth"),s.disable(a.BLEND),s.enable(a.DEPTH_TEST),s.depthMask(!0),ee(be,Re,null,0,!1),_.updateIfChanged(U.uMarkingType,1);let{renderables:Fe}=be;for(let Ne=0,ot=Fe.length;Ne<ot;++Ne){let it=Fe[Ne];_r(it.values.alpha.ref.value*it.state.alphaFactor,0,1)!==0&&it.values.transparencyAverage.ref.value!==1&&it.values.markerAverage.ref.value!==1&&te(Fe[Ne],"marking",0)}je&&o.timer.markEnd("Renderer.renderMarkingDepth")},Se=(be,Re,Fe)=>{je&&o.timer.mark("Renderer.renderMarkingMask"),s.disable(a.BLEND),s.enable(a.DEPTH_TEST),s.depthMask(!0),ee(be,Re,Fe,0,!!Fe),_.updateIfChanged(U.uMarkingType,2);let{renderables:Ne}=be;for(let ot=0,it=Ne.length;ot<it;++ot)Ne[ot].values.markerAverage.ref.value>0&&te(Ne[ot],"marking",0);je&&o.timer.markEnd("Renderer.renderMarkingMask")},ve=(be,Re)=>{je&&o.timer.mark("Renderer.renderEmissive"),s.disable(a.BLEND),s.enable(a.DEPTH_TEST),s.depthMask(!0),ee(be,Re,null,1,!1);let{renderables:Fe}=be;for(let Ne=0,ot=Fe.length;Ne<ot;++Ne){let it=Fe[Ne];ce(it)&&te(it,"emissive",0)}je&&o.timer.markEnd("Renderer.renderEmissive")},K=(be,Re)=>{je&&o.timer.mark("Renderer.renderTracing"),s.disable(a.BLEND),s.enable(a.DEPTH_TEST),s.depthMask(!0),ee(be,Re,null,1,!1);let{renderables:Fe}=be;for(let Ne=0,ot=Fe.length;Ne<ot;++Ne){let it=Fe[Ne];ce(it)&&te(it,"tracing",0)}je&&o.timer.markEnd("Renderer.renderTracing")},re=(be,Re)=>{be.hasOpaque&&le(be,Re),be.opacityAverage<1&&ge(be,Re)},le=(be,Re)=>{je&&o.timer.mark("Renderer.renderOpaque"),s.disable(a.BLEND),s.enable(a.DEPTH_TEST),s.depthMask(!0),ee(be,Re,null,1,!1);let{renderables:Fe}=be;for(let Ne=0,ot=Fe.length;Ne<ot;++Ne){let it=Fe[Ne];ce(it)&&te(it,"color",0)}je&&o.timer.markEnd("Renderer.renderOpaque")},ge=(be,Re)=>{je&&o.timer.mark("Renderer.renderBlendedTransparent"),h?s.blendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA):s.blendFuncSeparate(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA,a.ONE,a.ONE_MINUS_SRC_ALPHA),s.enable(a.BLEND),s.enable(a.DEPTH_TEST),s.depthMask(!1),ee(be,Re,null,2,!1);let{renderables:Fe}=be;for(let Ne=0,ot=Fe.length;Ne<ot;++Ne){let it=Fe[Ne];fe(it)&&(it.values.uDoubleSided?.ref.value?(it.values.dTransparentBackfaces?.ref.value!=="opaque"&&te(it,"color",2),te(it,"color",1)):te(it,"color",0))}je&&o.timer.markEnd("Renderer.renderBlendedTransparent")};return{clear:(be,Re,Fe)=>{s.enable(a.SCISSOR_TEST),s.enable(a.DEPTH_TEST),s.colorMask(!0,!0,!0,!0),s.depthMask(!0),Fe||h&&!Re?s.clearColor(0,0,0,0):be?s.clearColor(p[0],p[1],p[2],1):s.clearColor(1,1,1,1),a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT)},clearDepth:(be=!1)=>{s.enable(a.SCISSOR_TEST),s.enable(a.DEPTH_TEST),s.depthMask(!0),be?(s.colorMask(!0,!0,!0,!0),s.clearColor(1,1,1,1),a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT)):a.clear(a.DEPTH_BUFFER_BIT)},update:J,renderPick:O,renderDepth:V,renderDepthOpaque:Z,renderDepthOpaqueBack:pe,renderDepthTransparent:$,renderMarkingDepth:ae,renderMarkingMask:Se,renderEmissive:ve,renderTracing:K,renderBlended:re,renderOpaque:le,renderBlendedTransparent:ge,renderVolume:(be,Re,Fe)=>{je&&o.timer.mark("Renderer.renderVolume"),s.blendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA),s.enable(a.BLEND),s.disable(a.DEPTH_TEST),s.depthMask(!1),ee(be,Re,Fe,2,!1);let{renderables:Ne}=be;for(let ot=0,it=Ne.length;ot<it;++ot){let Xt=Ne[ot];Xt.values.dGeometryType.ref.value==="directVolume"&&te(Xt,"color",0)}je&&o.timer.markEnd("Renderer.renderVolume")},renderWboitTransparent:(be,Re,Fe)=>{je&&o.timer.mark("Renderer.renderWboitTransparent"),ee(be,Re,Fe,2,!1);let{renderables:Ne}=be;for(let ot=0,it=Ne.length;ot<it;++ot){let Xt=Ne[ot];fe(Xt)&&te(Xt,"color",0)}je&&o.timer.markEnd("Renderer.renderWboitTransparent")},renderDpoitTransparent:(be,Re,Fe,Ne)=>{je&&o.timer.mark("Renderer.renderDpoitTransparent"),s.enable(a.BLEND),OP(y,"tDpoitDepth",Ne.depth),OP(y,"tDpoitFrontColor",Ne.frontColor),OP(y,"tDpoitBackColor",Ne.backColor),ee(be,Re,Fe,2,!1);let{renderables:ot}=be;for(let it=0,Xt=ot.length;it<Xt;++it){let $r=ot[it];fe($r)&&te($r,"color",0)}je&&o.timer.markEnd("Renderer.renderDpoitTransparent")},setProps:be=>{be.backgroundColor!==void 0&&be.backgroundColor!==u.backgroundColor&&(u.backgroundColor=be.backgroundColor,Le.toVec3Normalized(p,u.backgroundColor),_.update(U.uFogColor,b.copy(U.uFogColor.ref.value,p))),be.pickingAlphaThreshold!==void 0&&be.pickingAlphaThreshold!==u.pickingAlphaThreshold&&(u.pickingAlphaThreshold=be.pickingAlphaThreshold,_.update(U.uPickingAlphaThreshold,u.pickingAlphaThreshold)),be.colorMarker!==void 0&&be.colorMarker!==u.colorMarker&&(u.colorMarker=be.colorMarker),be.highlightColor!==void 0&&be.highlightColor!==u.highlightColor&&(u.highlightColor=be.highlightColor,_.update(U.uHighlightColor,Le.toVec3Normalized(U.uHighlightColor.ref.value,u.highlightColor))),be.selectColor!==void 0&&be.selectColor!==u.selectColor&&(u.selectColor=be.selectColor,_.update(U.uSelectColor,Le.toVec3Normalized(U.uSelectColor.ref.value,u.selectColor))),be.dimColor!==void 0&&be.dimColor!==u.dimColor&&(u.dimColor=be.dimColor,_.update(U.uDimColor,Le.toVec3Normalized(U.uDimColor.ref.value,u.dimColor))),be.highlightStrength!==void 0&&be.highlightStrength!==u.highlightStrength&&(u.highlightStrength=be.highlightStrength,_.update(U.uHighlightStrength,u.highlightStrength)),be.selectStrength!==void 0&&be.selectStrength!==u.selectStrength&&(u.selectStrength=be.selectStrength,_.update(U.uSelectStrength,u.selectStrength)),be.dimStrength!==void 0&&be.dimStrength!==u.dimStrength&&(u.dimStrength=be.dimStrength,_.update(U.uDimStrength,u.dimStrength)),be.markerPriority!==void 0&&be.markerPriority!==u.markerPriority&&(u.markerPriority=be.markerPriority,_.update(U.uMarkerPriority,u.markerPriority)),be.xrayEdgeFalloff!==void 0&&be.xrayEdgeFalloff!==u.xrayEdgeFalloff&&(u.xrayEdgeFalloff=be.xrayEdgeFalloff,_.update(U.uXrayEdgeFalloff,u.xrayEdgeFalloff)),be.celSteps!==void 0&&be.celSteps!==u.celSteps&&(u.celSteps=be.celSteps,_.update(U.uCelSteps,u.celSteps)),be.exposure!==void 0&&be.exposure!==u.exposure&&(u.exposure=be.exposure,_.update(U.uExposure,u.exposure)),be.light!==void 0&&!qi(be.light,u.light)&&(u.light=be.light,Object.assign(c,uIe(be.light,c)),_.update(U.uLightDirection,c.direction),_.update(U.uLightColor,c.color)),be.ambientColor!==void 0&&be.ambientColor!==u.ambientColor&&(u.ambientColor=be.ambientColor,b.scale(X,Le.toArrayNormalized(u.ambientColor,X,0),u.ambientIntensity),_.update(U.uAmbientColor,X)),be.ambientIntensity!==void 0&&be.ambientIntensity!==u.ambientIntensity&&(u.ambientIntensity=be.ambientIntensity,b.scale(X,Le.toArrayNormalized(u.ambientColor,X,0),u.ambientIntensity),_.update(U.uAmbientColor,X))},setViewport:(be,Re,Fe,Ne)=>{s.viewport(be,Re,Fe,Ne),s.scissor(be,Re,Fe,Ne),(be!==m.x||Re!==m.y||Fe!==m.width||Ne!==m.height)&&(lo.set(m,be,Re,Fe,Ne),_.update(U.uViewport,Et.set(U.uViewport.ref.value,be,Re,Fe,Ne)))},setTransparentBackground:be=>{h=be},setDrawingBufferSize:(be,Re)=>{(be!==d[0]||Re!==d[1])&&_.update(U.uDrawingBufferSize,Ce.set(d,be,Re))},setPixelRatio:be=>{_.update(U.uPixelRatio,be)},setOcclusionTest:be=>{f=be},props:u,get stats(){return{programCount:o.stats.resourceCounts.program,shaderCount:o.stats.resourceCounts.shader,attributeCount:o.stats.resourceCounts.attribute,elementsCount:o.stats.resourceCounts.elements,framebufferCount:o.stats.resourceCounts.framebuffer,renderbufferCount:o.stats.resourceCounts.renderbuffer,textureCount:o.stats.resourceCounts.texture,vertexArrayCount:o.stats.resourceCounts.vertexArray,drawCount:l.drawCount,instanceCount:l.instanceCount,instancedDrawCount:l.instancedDrawCount}},get light(){return c},get ambientColor(){return U.uAmbientColor.ref.value},dispose:()=>{}}}n.create=r})(TX||={});function Ct(e,t="",r=""){return Ct.create(e,t,r)}(c=>{function e(m,d="",p=""){return{triggers:m,action:d,description:p}}c.create=e;function t(m){return!!m&&Array.isArray(m.triggers)&&typeof m.action=="string"}c.isBinding=t,c.Empty={triggers:[],action:"",description:""};function n(m){return m.triggers.length===0||m.triggers.every(d=>d.buttons===void 0&&d.modifiers===void 0&&!d.code)}c.isEmpty=n;function o(m,d,p){return m.triggers.some(h=>l.match(h,d,p))}c.match=o;function i(m,d,p,h){return m.triggers.some(f=>l.matchKey(f,d,p,h))}c.matchKey=i;function a(m){return m.triggers.map(l.format).join(" or ")}c.formatTriggers=a;function s(m,d=""){let p=m.description||va(d);return kre(p,{triggers:"<i>"+a(m)+"</i>"})}c.format=s;function l(m,d){return l.create(m,d)}c.Trigger=l;function u(m,d){return l.create(void 0,d,m)}c.TriggerKey=u,(g=>{function m(y,x,S){return{buttons:y,modifiers:x,code:S}}g.create=m,g.Empty={};function p(y,x,S){let{buttons:I,modifiers:v}=y;return I!==void 0&&(I===x||Ai.has(I,x))&&(!v||cs.areEqual(v,S))}g.match=p;function h(y,x,S,I){let{modifiers:v,code:A}=y;return A!==void 0&&(A===x||A.length===1&&x.length===4&&x.startsWith("Key")&&!!I&&I.length===1&&I.toUpperCase()===A.toUpperCase())&&(!v||cs.areEqual(v,S))}g.matchKey=h;function f(y){let x=[],S=Hot(y.buttons,y.code);S&&x.push(S);let I=Wot(y.code);I&&x.push(I);let v=jot(y.modifiers);return v&&x.push(v),x.join(" + ")}g.format=f})(l=c.Trigger||={})})(Ct||={});var GC=Ai;function Hot(e,t){let r=[];return e===void 0&&!t?r.push("any mouse button"):e===0?r.push("mouse hover"):e!==void 0&&(GC.has(e,GC.Flag.Primary)&&r.push("left mouse button"),GC.has(e,GC.Flag.Secondary)&&r.push("right mouse button"),GC.has(e,GC.Flag.Auxilary)&&r.push("wheel/middle mouse button"),GC.has(e,GC.Flag.Forth)&&r.push("three fingers")),r.join(" + ")}function jot(e,t){let r=[];return e?(e.alt&&r.push("alt key"),e.control&&r.push("control key"),e.meta&&r.push("meta/command key"),e.shift&&r.push("shift key"),t&&r.length===0&&r.push("no key")):t&&r.push("any key"),r.join(" + ")}function Wot(e){return e?.startsWith("Key")&&(e=e.substring(3)),e&&Ks(e).toLowerCase()}var vb=Ai,Gd=cs,Ib=Ct.Trigger,hc=Ct.TriggerKey,Xot={dragRotate:Ct([Ib(vb.Flag.Primary,Gd.create()),Ib(vb.Flag.Trigger)],"Rotate","Drag using ${triggers}"),dragRotateZ:Ct([Ib(vb.Flag.Primary,Gd.create({shift:!0,control:!0}))],"Rotate around z-axis (roll)","Drag using ${triggers}"),dragPan:Ct([Ib(vb.Flag.Secondary,Gd.create()),Ib(vb.Flag.Primary,Gd.create({control:!0}))],"Pan","Drag using ${triggers}"),dragZoom:Ct.Empty,dragFocus:Ct([Ib(vb.Flag.Forth,Gd.create())],"Focus","Drag using ${triggers}"),dragFocusZoom:Ct([Ib(vb.Flag.Auxilary,Gd.create())],"Focus and zoom","Drag using ${triggers}"),scrollZoom:Ct([Ib(vb.Flag.Auxilary,Gd.create())],"Zoom","Scroll using ${triggers}"),scrollFocus:Ct([Ib(vb.Flag.Auxilary,Gd.create({shift:!0}))],"Clip","Scroll using ${triggers}"),scrollFocusZoom:Ct.Empty,keyMoveForward:Ct([hc("KeyW"),hc("GamepadUp")],"Move forward","Press ${triggers}"),keyMoveBack:Ct([hc("KeyS"),hc("GamepadDown")],"Move back","Press ${triggers}"),keyMoveLeft:Ct([hc("KeyA")],"Move left","Press ${triggers}"),keyMoveRight:Ct([hc("KeyD")],"Move right","Press ${triggers}"),keyMoveUp:Ct([hc("KeyR")],"Move up","Press ${triggers}"),keyMoveDown:Ct([hc("KeyF")],"Move down","Press ${triggers}"),keyRollLeft:Ct([hc("KeyQ")],"Roll left","Press ${triggers}"),keyRollRight:Ct([hc("KeyE")],"Roll right","Press ${triggers}"),keyPitchUp:Ct([hc("ArrowUp",Gd.create({shift:!0}))],"Pitch up","Press ${triggers}"),keyPitchDown:Ct([hc("ArrowDown",Gd.create({shift:!0}))],"Pitch down","Press ${triggers}"),keyYawLeft:Ct([hc("ArrowLeft",Gd.create({shift:!0}))],"Yaw left","Press ${triggers}"),keyYawRight:Ct([hc("ArrowRight",Gd.create({shift:!0}))],"Yaw right","Press ${triggers}"),boostMove:Ct([hc("ShiftLeft")],"Boost move","Press ${triggers}"),enablePointerLock:Ct([hc("Space",Gd.create({control:!0}))],"Enable pointer lock","Press ${triggers}")},QR={rotateSpeed:C.Numeric(5,{min:1,max:10,step:1}),zoomSpeed:C.Numeric(7,{min:1,max:15,step:1}),panSpeed:C.Numeric(1,{min:.1,max:5,step:.1}),moveSpeed:C.Numeric(.75,{min:.1,max:3,step:.1}),boostMoveFactor:C.Numeric(5,{min:.1,max:10,step:.1}),flyMode:C.Boolean(!1),animate:C.MappedStatic("off",{off:C.EmptyGroup(),spin:C.Group({speed:C.Numeric(.1,{min:-2,max:2,step:.01},{description:"Number of rotations per second"})},{description:"Spin the 3D scene around the x-axis in view space"}),rock:C.Group({speed:C.Numeric(.3,{min:-5,max:5,step:.1},{description:"Number of oscilations per second"}),angle:C.Numeric(10,{min:0,max:90,step:1},{description:"How many degrees to rotate in each direction."})},{description:"Rock the 3D scene around the x-axis in view space"})}),staticMoving:C.Boolean(!0,{isHidden:!0}),dynamicDampingFactor:C.Numeric(.2,{},{isHidden:!0}),minDistance:C.Numeric(.01,{},{isHidden:!0}),maxDistance:C.Numeric(1e150,{},{isHidden:!0}),gestureScaleFactor:C.Numeric(1,{},{isHidden:!0}),maxWheelDelta:C.Numeric(.02,{},{isHidden:!0}),autoAdjustMinMaxDistance:C.MappedStatic("on",{off:C.EmptyGroup(),on:C.Group({minDistanceFactor:C.Numeric(0),minDistancePadding:C.Numeric(5),maxDistanceFactor:C.Numeric(10),maxDistanceMin:C.Numeric(20)})},{isHidden:!0})},PX={bindings:Xot};var _X;(t=>{function e(r,n,o,i={},a={}){let s={...C.getDefaultValues(QR),...i},l={...PX,...a},u=l.bindings,c=lo.clone(n.viewport),m=!1,d=r.drag.subscribe(N),p=r.interactionEnd.subscribe(oe),h=r.wheel.subscribe(Ve),f=r.pinch.subscribe($e),g=r.keyDown.subscribe(vt),y=r.keyUp.subscribe(Pt),x=r.move.subscribe(ct),S=r.lock.subscribe(Dt),I=r.leave.subscribe(Nt),v=!1,A=b(),P=b(),T=Ce(),R=Ce(),w=b(),E=0,M=Ce(),D=Ce(),B=0,k=0,F=0,z=Ce(),j=Ce(),Y=Ce(),G=Ce(),X=Ce(),U=Ce(),L=b.clone(n.target),q=b.clone(n.position),te=b.clone(n.up),J=Ce();function ee(_e,Ze){return Ce.set(J,(_e-c.x)/c.width,(Ze-c.y)/c.height)}let ce=Ce();function fe(_e,Ze){return Ce.set(ce,(_e-c.width*.5-c.x)/(c.width*.5),(c.height+2*(c.y-Ze))/c.width)}function O(){let _e=r.width/r.height||1;return s.rotateSpeed*r.pixelRatio*_e}let V=b(),Z=lr(),pe=b(),$=b(),ae=b(),Se=b();function ve(){let _e=R[0]-T[0],Ze=R[1]-T[1];b.set(Se,_e,Ze,0);let ze=b.magnitude(Se)*O();ze?(b.sub(P,n.position,n.target),b.normalize(pe,P),b.normalize($,n.up),b.normalize(ae,b.cross(ae,$,pe)),b.setMagnitude($,$,Ze),b.setMagnitude(ae,ae,_e),b.add(Se,$,ae),b.normalize(V,b.cross(V,Se,P)),lr.setAxisAngle(Z,V,ze),b.transformQuat(P,P,Z),b.transformQuat(n.up,n.up,Z),b.copy(w,V),E=ze):!s.staticMoving&&E&&(E*=Math.sqrt(1-s.dynamicDampingFactor),b.sub(P,n.position,n.target),lr.setAxisAngle(Z,w,E),b.transformQuat(P,P,Z),b.transformQuat(n.up,n.up,Z)),Ce.copy(T,R)}let K=lr(),re=b();function le(){let _e=(bt.rollRight-bt.rollLeft)/45,Ze=(D[0]-M[0])*-Math.sign(D[1]),ze=(D[1]-M[1])*-Math.sign(D[0]),Rt=-s.rotateSpeed*(-Ze+ze)+_e;Rt?(b.normalize(re,P),lr.setAxisAngle(K,re,Rt),b.transformQuat(n.up,n.up,K),B=Rt):!s.staticMoving&&B&&(B*=Math.sqrt(1-s.dynamicDampingFactor),b.normalize(re,P),lr.setAxisAngle(K,re,B),b.transformQuat(n.up,n.up,K)),Ce.copy(M,D)}let ge=lr(),Ee=b();function nt(){let _e=(bt.pitchUp-bt.pitchDown)/(s.flyMode?360:90),Ze=-s.rotateSpeed*_e;Ze?(b.cross(Ee,P,n.up),b.normalize(Ee,Ee),lr.setAxisAngle(ge,Ee,Ze),b.transformQuat(P,P,ge),b.transformQuat(n.up,n.up,ge),k=Ze):!s.staticMoving&&k&&(k*=Math.sqrt(1-s.dynamicDampingFactor),b.cross(Ee,P,n.up),b.normalize(Ee,Ee),lr.setAxisAngle(ge,Ee,k),b.transformQuat(P,P,ge),b.transformQuat(n.up,n.up,ge))}let at=lr(),be=b();function Re(){let _e=(bt.yawRight-bt.yawLeft)/(s.flyMode?360:90),Ze=-s.rotateSpeed*_e;Ze?(b.normalize(be,n.up),lr.setAxisAngle(at,be,Ze),b.transformQuat(P,P,at),b.transformQuat(n.up,n.up,at),F=Ze):!s.staticMoving&&F&&(F*=Math.sqrt(1-s.dynamicDampingFactor),b.normalize(be,n.up),lr.setAxisAngle(at,be,F),b.transformQuat(P,P,at),b.transformQuat(n.up,n.up,at))}function Fe(){let _e=1+(j[1]-z[1])*s.zoomSpeed;_e!==1&&_e>0&&b.scale(P,P,_e),s.staticMoving?Ce.copy(z,j):z[1]+=(j[1]-z[1])*s.dynamicDampingFactor}function Ne(){let _e=(G[1]-Y[1])*s.zoomSpeed;if(_e!==0){let Ze=Math.max(1,n.state.radius+n.state.radius*_e);n.setState({radius:Ze})}s.staticMoving?Ce.copy(Y,G):Y[1]+=(G[1]-Y[1])*s.dynamicDampingFactor}let ot=Ce(),it=b(),Xt=b();function $r(){if(Ce.sub(ot,Ce.copy(ot,U),X),Ce.squaredMagnitude(ot)){let _e=r.pixelRatio*s.panSpeed;ot[0]*=1/n.zoom*n.viewport.width*_e,ot[1]*=1/n.zoom*n.viewport.height*_e,b.cross(Xt,b.copy(Xt,P),n.up),b.setMagnitude(Xt,Xt,ot[0]),b.setMagnitude(it,n.up,ot[1]),b.add(Xt,Xt,it),b.add(n.position,n.position,Xt),b.add(n.target,n.target,Xt),s.staticMoving?Ce.copy(X,U):(Ce.sub(ot,U,X),Ce.scale(ot,ot,s.dynamicDampingFactor),Ce.add(X,X,ot))}}let bt={moveUp:0,moveDown:0,moveLeft:0,moveRight:0,moveForward:0,moveBack:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0,boostMove:0},xr=b(),tn=b();function pn(_e){b.sub(tn,n.position,n.target);let Ze=Math.max(n.state.minNear,s.minDistance);b.setMagnitude(tn,tn,Ze);let ze=s.flyMode||r.pointerLock,Rt=_e*(60/1e3)*s.moveSpeed*(bt.boostMove===1?s.boostMoveFactor:1);if(bt.moveForward===1&&(b.distance(n.position,o.boundingSphereVisible.center)<o.boundingSphereVisible.radius&&ze?(b.normalize(xr,tn),b.scaleAndSub(n.position,n.position,xr,Rt)):(b.sub(xr,n.position,n.target),b.scale(xr,xr,1-Rt/100),b.add(n.position,n.target,xr)),ze&&b.sub(n.target,n.position,tn)),bt.moveBack===1&&(b.distance(n.position,o.boundingSphereVisible.center)<o.boundingSphereVisible.radius&&ze?(b.normalize(xr,tn),b.scaleAndAdd(n.position,n.position,xr,Rt)):(b.sub(xr,n.position,n.target),b.scale(xr,xr,1+Rt/100),b.add(n.position,n.target,xr)),ze&&b.sub(n.target,n.position,tn)),bt.moveLeft===1&&(b.cross(xr,tn,n.up),b.normalize(xr,xr),ze?(b.scaleAndAdd(n.position,n.position,xr,Rt),b.sub(n.target,n.position,tn)):(b.scaleAndSub(n.position,n.position,xr,Rt),b.sub(n.target,n.position,P))),bt.moveRight===1&&(b.cross(xr,tn,n.up),b.normalize(xr,xr),ze?(b.scaleAndSub(n.position,n.position,xr,Rt),b.sub(n.target,n.position,tn)):(b.scaleAndAdd(n.position,n.position,xr,Rt),b.sub(n.target,n.position,P))),bt.moveUp===1&&(b.normalize(xr,n.up),ze?(b.scaleAndAdd(n.position,n.position,xr,Rt),b.sub(n.target,n.position,tn)):(b.scaleAndSub(n.position,n.position,xr,Rt),b.sub(n.target,n.position,P))),bt.moveDown===1&&(b.normalize(xr,n.up),ze?(b.scaleAndSub(n.position,n.position,xr,Rt),b.sub(n.target,n.position,tn)):(b.scaleAndAdd(n.position,n.position,xr,Rt),b.sub(n.target,n.position,P))),ze){let ir=b.distance(n.position,o.boundingSphereVisible.center);n.setState({minFar:ir+o.boundingSphereVisible.radius})}}function io(){let _e=Math.min(Math.max(n.state.radiusMax*1e3,.01),s.maxDistance);b.squaredMagnitude(P)>_e*_e&&(b.setMagnitude(P,P,_e),b.add(n.position,n.target,P),Ce.copy(z,j),Ce.copy(Y,G)),b.squaredMagnitude(P)<s.minDistance*s.minDistance&&(b.setMagnitude(P,P,s.minDistance),b.add(n.position,n.target,P),Ce.copy(z,j),Ce.copy(Y,G))}function Hn(_e,Ze){return _e*=r.pixelRatio,Ze*=r.pixelRatio,_e>c.x+c.width||r.height-Ze>c.y+c.height||_e<c.x||r.height-Ze<c.y}let Zi=-1;function mm(_e){if(Zi===_e)return;let Ze=_e-Zi;Zi>0&&(s.animate.name==="spin"?hr(Ze):s.animate.name==="rock"&&me(Ze)),b.sub(P,n.position,n.target),ve(),le(),nt(),Re(),Fe(),Ne(),$r(),b.add(n.position,n.target,P),io(),Zi>0&&pn(Math.min(Ze,15*1e3/60)),b.sub(P,n.position,n.target),io(),b.squaredDistance(A,n.position)>1e-6&&b.copy(A,n.position),Zi=_e}function ao(){b.copy(n.target,L),b.copy(n.position,q),b.copy(n.up,te),b.sub(P,n.position,n.target),b.copy(A,n.position)}function N({x:_e,y:Ze,dx:ze,dy:Rt,pageX:ir,pageY:Oe,buttons:ht,modifiers:Ye,isStart:dr,useDelta:Xr}){let we=!Xr&&Hn(_e,Ze);if(dr&&we||!dr&&!v)return;v=!0,Ie();let qt=Ct.match(u.dragRotate,ht,Ye),Cr=Ct.match(u.dragRotateZ,ht,Ye),Rn=Ct.match(u.dragPan,ht,Ye),Ri=Ct.match(u.dragZoom,ht,Ye),Da=Ct.match(u.dragFocus,ht,Ye),zu=Ct.match(u.dragFocusZoom,ht,Ye);Xr&&qt&&Ce.copy(T,fe(ir-ze,Oe-Rt)),fe(ir,Oe),ee(ir,Oe);let Hu=r.pixelRatio,Au=(_e*Hu-c.width/2-c.x)/c.width,Th=-(r.height-Ze*Hu-c.height/2-c.y)/c.height;if(dr&&(qt&&(Ce.copy(R,ce),Ce.copy(T,R)),Cr&&(Ce.set(D,Au,Th),Ce.copy(M,D)),(Ri||zu)&&(Ce.copy(z,J),Ce.copy(j,z)),Da&&(Ce.copy(Y,J),Ce.copy(G,Y)),Rn&&(Ce.copy(X,J),Ce.copy(U,X))),qt&&Ce.copy(R,ce),Cr&&Ce.set(D,Au,Th),(Ri||zu)&&Ce.copy(j,J),Da&&Ce.copy(G,J),zu){let Ph=b.distance(n.state.position,n.state.target);n.setState({radius:Ph/5})}Rn&&Ce.copy(U,J)}function oe(){v=!1}function Ve({x:_e,y:Ze,spinX:ze,spinY:Rt,dz:ir,buttons:Oe,modifiers:ht}){if(Hn(_e,Ze))return;let Ye=Mre(ze*.075,Rt*.075,ir*1e-4);Ye<-s.maxWheelDelta?Ye=-s.maxWheelDelta:Ye>s.maxWheelDelta&&(Ye=s.maxWheelDelta),Ct.match(u.scrollZoom,Oe,ht)&&(j[1]+=Ye),Ct.match(u.scrollFocus,Oe,ht)&&(G[1]+=Ye)}function $e({isStart:_e,startX:Ze,startY:ze,centerPageX:Rt,centerPageY:ir,fractionDelta:Oe,buttons:ht,modifiers:Ye}){if(Hn(Ze,ze))return;let dr=Ct.match(u.dragPan,ht,Ye),Xr=Ct.match(u.scrollZoom,ht,Ye);v=dr||Xr,dr&&(ee(Rt,ir),_e?(Ce.copy(X,J),Ce.copy(U,X)):Ce.copy(U,J)),Xr&&(j[1]+=s.gestureScaleFactor*Oe)}function ct({movementX:_e,movementY:Ze}){if(!r.pointerLock||_e===void 0||Ze===void 0)return;let ze=c.width*.5-c.x,Rt=c.height*.5-c.y;Ce.copy(T,fe(ze,Rt)),Ce.copy(R,fe(_e+ze,Ze+Rt))}function vt({modifiers:_e,code:Ze,key:ze,x:Rt,y:ir}){Hn(Rt,ir)||(Ct.matchKey(u.keyMoveForward,Ze,_e,ze)?bt.moveForward=1:Ct.matchKey(u.keyMoveBack,Ze,_e,ze)?bt.moveBack=1:Ct.matchKey(u.keyMoveLeft,Ze,_e,ze)?bt.moveLeft=1:Ct.matchKey(u.keyMoveRight,Ze,_e,ze)?bt.moveRight=1:Ct.matchKey(u.keyMoveUp,Ze,_e,ze)?bt.moveUp=1:Ct.matchKey(u.keyMoveDown,Ze,_e,ze)?bt.moveDown=1:Ct.matchKey(u.keyRollLeft,Ze,_e,ze)?bt.rollLeft=1:Ct.matchKey(u.keyRollRight,Ze,_e,ze)?bt.rollRight=1:Ct.matchKey(u.keyPitchUp,Ze,_e,ze)?bt.pitchUp=1:Ct.matchKey(u.keyPitchDown,Ze,_e,ze)?bt.pitchDown=1:Ct.matchKey(u.keyYawLeft,Ze,_e,ze)?bt.yawLeft=1:Ct.matchKey(u.keyYawRight,Ze,_e,ze)&&(bt.yawRight=1),Ct.matchKey(u.boostMove,Ze,_e,ze)&&(bt.boostMove=1),Ct.matchKey(u.enablePointerLock,Ze,_e,ze)&&r.requestPointerLock(c))}function Pt({modifiers:_e,code:Ze,key:ze,x:Rt,y:ir}){if(Hn(Rt,ir))return;let Oe=!1;Ze.startsWith("Alt")?(Oe=!0,_e.alt=!0):Ze.startsWith("Shift")?(Oe=!0,_e.shift=!0):Ze.startsWith("Control")?(Oe=!0,_e.control=!0):Ze.startsWith("Meta")&&(Oe=!0,_e.meta=!0);let ht=[];Oe?(bt.moveForward&&ht.push(u.keyMoveForward.triggers[0]?.code||""),bt.moveBack&&ht.push(u.keyMoveBack.triggers[0]?.code||""),bt.moveLeft&&ht.push(u.keyMoveLeft.triggers[0]?.code||""),bt.moveRight&&ht.push(u.keyMoveRight.triggers[0]?.code||""),bt.moveUp&&ht.push(u.keyMoveUp.triggers[0]?.code||""),bt.moveDown&&ht.push(u.keyMoveDown.triggers[0]?.code||""),bt.rollLeft&&ht.push(u.keyRollLeft.triggers[0]?.code||""),bt.rollRight&&ht.push(u.keyRollRight.triggers[0]?.code||""),bt.pitchUp&&ht.push(u.keyPitchUp.triggers[0]?.code||""),bt.pitchDown&&ht.push(u.keyPitchDown.triggers[0]?.code||""),bt.yawLeft&&ht.push(u.keyYawLeft.triggers[0]?.code||""),bt.yawRight&&ht.push(u.keyYawRight.triggers[0]?.code||"")):ht.push(Ze);for(let Ye of ht)Ct.matchKey(u.keyMoveForward,Ye,_e,ze)?bt.moveForward=0:Ct.matchKey(u.keyMoveBack,Ye,_e,ze)?bt.moveBack=0:Ct.matchKey(u.keyMoveLeft,Ye,_e,ze)?bt.moveLeft=0:Ct.matchKey(u.keyMoveRight,Ye,_e,ze)?bt.moveRight=0:Ct.matchKey(u.keyMoveUp,Ye,_e,ze)?bt.moveUp=0:Ct.matchKey(u.keyMoveDown,Ye,_e,ze)?bt.moveDown=0:Ct.matchKey(u.keyRollLeft,Ye,_e,ze)?bt.rollLeft=0:Ct.matchKey(u.keyRollRight,Ye,_e,ze)?bt.rollRight=0:Ct.matchKey(u.keyPitchUp,Ye,_e,ze)?bt.pitchUp=0:Ct.matchKey(u.keyPitchDown,Ye,_e,ze)?bt.pitchDown=0:Ct.matchKey(u.keyYawLeft,Ye,_e,ze)?bt.yawLeft=0:Ct.matchKey(u.keyYawRight,Ye,_e,ze)&&(bt.yawRight=0);Ct.matchKey(u.boostMove,Ze,_e,ze)&&(bt.boostMove=0)}function Ot(){b.sub(tn,n.position,n.target);let _e=Math.max(n.state.minNear,s.minDistance);b.setMagnitude(tn,tn,_e),b.sub(n.target,n.position,tn);let Ze=b.distance(n.position,o.boundingSphereVisible.center);n.setState({minFar:Ze+o.boundingSphereVisible.radius})}function Ft(){let{center:_e,radius:Ze}=o.boundingSphereVisible;if(b.distance(n.position,_e)>Ze){let Rt=n.getFocus(_e,Ze);n.setState({...Rt,minFar:0})}else n.setState({minFar:0,radius:o.boundingSphereVisible.radius})}function Dt(_e){_e?Ot():Ft()}function wt(){bt.moveForward=0,bt.moveBack=0,bt.moveLeft=0,bt.moveRight=0,bt.moveUp=0,bt.moveDown=0,bt.rollLeft=0,bt.rollRight=0,bt.pitchUp=0,bt.pitchDown=0,bt.yawLeft=0,bt.yawRight=0,bt.boostMove=0}function Nt(){wt()}function Zt(){m||(m=!0,d.unsubscribe(),h.unsubscribe(),f.unsubscribe(),p.unsubscribe(),g.unsubscribe(),y.unsubscribe(),x.unsubscribe(),S.unsubscribe(),I.unsubscribe())}let zt=Ce.create(.005,0);function hr(_e){if(s.animate.name!=="spin"||s.animate.params.speed===0||v)return;let Ze=2*Math.PI*s.animate.params.speed/1e3;zt[0]=_e*Ze/O(),Ce.add(R,T,zt)}let ar=0,fr=Ce.create(.005,0);function me(_e){if(s.animate.name!=="rock"||s.animate.params.speed===0||v)return;let Ze=_e/1e3*s.animate.params.speed,ze=kr(s.animate.params.angle)/O(),Rt=Math.sin(ar*Math.PI*2)*ze,ir=Math.sin((ar+Ze)*Math.PI*2)*ze;fr[0]=ir-Rt,Ce.add(R,T,fr),ar+=Ze,ar>=1&&(ar=0)}function Ie(){ar=0}function Pe(_e){Zi=-1,mm(_e)}return{viewport:c,get isAnimating(){return s.animate.name!=="off"},get isMoving(){return bt.moveForward===1||bt.moveBack===1||bt.moveLeft===1||bt.moveRight===1||bt.moveUp===1||bt.moveDown===1||bt.rollLeft===1||bt.rollRight===1||bt.pitchUp===1||bt.pitchDown===1||bt.yawLeft===1||bt.yawRight===1},get props(){return s},setProps:_e=>{_e.animate?.name==="rock"&&s.animate.name!=="rock"&&Ie(),_e.flyMode!==void 0&&_e.flyMode!==s.flyMode&&(_e.flyMode?Ot():Ft()),Object.assign(s,_e)},get attribs(){return l},setAttribs:_e=>{Object.assign(l,_e),Object.assign(u,l.bindings)},start:Pe,update:mm,reset:ao,dispose:Zt}}t.create=e})(_X||={});var RX;(t=>{function e(){return{view:H.identity(),position:b.create(0,0,0),direction:b.create(0,0,-1),up:b.create(0,1,0)}}t.create=e})(RX||={});var SL=class{constructor(){this.removeList=G_();this.removeMap=new Map;this.addList=G_();this.addMap=new Map}get isEmpty(){return this.removeList.count===0&&this.addList.count===0}get size(){return this.removeMap.size+this.addMap.size}add(t){if(this.removeMap.has(t)){let n=this.removeMap.get(t);this.removeMap.delete(t),this.removeList.remove(n)}if(this.addMap.has(t))return;let r=this.addList.addLast(t);this.addMap.set(t,r)}remove(t){if(this.addMap.has(t)){let n=this.addMap.get(t);this.addMap.delete(t),this.addList.remove(n)}if(this.removeMap.has(t))return;let r=this.removeList.addLast(t);this.removeMap.set(t,r)}tryGetRemove(){let t=this.removeList.removeFirst();return t&&this.removeMap.delete(t),t}tryGetAdd(){let t=this.addList.removeFirst();return t&&this.addMap.delete(t),t}};var ZR=new Fi("98");function cIe(e,t,r){ZR.reset();for(let n=0,o=e.length;n<o;++n){if(r&&!e[n].state.visible||!e[n].values.drawCount.ref.value)continue;let i=e[n].values.boundingSphere.ref.value;i.radius&&ZR.includeSphere(i)}ZR.finishedIncludeStep();for(let n=0,o=e.length;n<o;++n){if(r&&!e[n].state.visible||!e[n].values.drawCount.ref.value)continue;let i=e[n].values.boundingSphere.ref.value;i.radius&&ZR.radiusSphere(i)}return ZR.getSphere(t)}function Qot(e,t){let r=e.getProgram("color").id,n=t.getProgram("color").id,o=e.materialId,i=t.materialId;return r!==n?r-n:o!==i?o-i:e.id-t.id}var ih;(t=>{function e(r,n="blended",o={dColorMarker:!0,dLightCount:1}){let i=new Map,a=[],s=he(),l=he(),u=[],c=[],m=!0,d=!0,p=!0,h=!0,f=!0,g=!0,y=!0,x=0,S=0,I=0,v=0,A=!1,P=RX.create(),{view:T,position:R,direction:w,up:E}=P;function M(te){if(i.has(te))console.warn(`RenderObject with id '${te.id}' already present`);else{let J=Qbe(r,te,n,o);a.push(J),te.type==="direct-volume"?c.push(J):u.push(J),i.set(te,J),m=!0,d=!0}}function D(te){let J=i.get(te);J&&(J.dispose(),Jd(a,J),Jd(u,J),Jd(c,J),i.delete(te),m=!0,d=!0)}let B=100;function k(te){let J=En(),ee=0;for(;;){let ce=F.tryGetRemove();if(!ce)break;if(D(ce),++ee%B===0&&En()-J>te)return!1}for(;;){let ce=F.tryGetAdd();if(!ce)break;if(M(ce),++ee%B===0&&En()-J>te)return!1}return a.sort(Qot),p=!0,h=!0,f=!0,g=!0,y=!0,!0}let F=new SL,z=-1;function j(){let te=23;for(let J=0,ee=a.length;J<ee;++J)a[J].state.visible&&(te=31*te+a[J].id|0);return te=dM(te),te===-1&&(te=0),te}function Y(){let te=j();return te!==z?(d=!0,p=!0,h=!0,f=!0,g=!0,y=!0,z=te,!0):!1}function G(){if(u.length===0)return 0;let te=0,J=0;for(let ee=0,ce=u.length;ee<ce;++ee)u[ee].state.visible&&(J+=u[ee].values.markerAverage.ref.value,te+=1);return te>0?J/te:0}function X(){if(u.length===0)return 0;let te=0,J=0;for(let ee=0,ce=u.length;ee<ce;++ee)u[ee].state.visible&&(J+=u[ee].values.emissiveAverage.ref.value+u[ee].values.uEmissive.ref.value,te+=1);return te>0?J/te:0}function U(){if(u.length===0)return 0;let te=0,J=0;for(let ee=0,ce=u.length;ee<ce;++ee){let fe=u[ee];if(!fe.state.visible)continue;let O=_r(fe.values.alpha.ref.value*fe.state.alphaFactor,0,1),V=fe.values.dXrayShaded?.ref.value==="on"||fe.values.dXrayShaded?.ref.value==="inverted"?.5:1,Z=fe.values.dPointStyle?.ref.value==="fuzzy"?.5:1,pe=fe.values.dGeometryType.ref.value==="text"?.5:1,$=fe.values.dGeometryType.ref.value==="image"?.5:1;J+=(1-fe.values.transparencyAverage.ref.value)*O*V*Z*pe*$,te+=1}return te>0?J/te:0}function L(){if(u.length===0)return 1;let te=1,J=[];for(let ee=0,ce=u.length;ee<ce;++ee){let fe=u[ee];if(!fe.state.visible)continue;J.length=0;let O=_r(fe.values.alpha.ref.value*fe.state.alphaFactor,0,1);O<1&&J.push(1-O),(fe.values.dXrayShaded?.ref.value==="on"||fe.values.dXrayShaded?.ref.value==="inverted"||fe.values.dPointStyle?.ref.value==="fuzzy"||fe.values.dGeometryType.ref.value==="text"||fe.values.dGeometryType.ref.value==="image")&&J.push(.5),fe.values.transparencyMin.ref.value>0&&J.push(fe.values.transparencyMin.ref.value),te=Math.min(te,...J)}return te}function q(){if(u.length===0)return!1;for(let te=0,J=u.length;te<J;++te){let ee=u[te];if(ee.state.visible&&(ee.state.opaque||ee.state.alphaFactor===1&&ee.values.alpha.ref.value===1&&ee.values.transparencyAverage.ref.value!==1||ee.values.dTransparentBackfaces?.ref.value==="opaque"))return!0}return!1}return{view:T,position:R,direction:w,up:E,renderables:a,primitives:{view:T,position:R,direction:w,up:E,renderables:u},volumes:{view:T,position:R,direction:w,up:E,renderables:c},syncVisibility:Y,setTransparency:te=>{n=te;for(let J=0,ee=a.length;J<ee;++J)a[J].setTransparency(te)},setGlobals:te=>{o=te;for(let J of a)_.updateIfChanged(J.values.dColorMarker,te.dColorMarker),_.updateIfChanged(J.values.dLightCount,te.dLightCount),J.update()},update(te,J){if(te)for(let ee=0,ce=te.length;ee<ce;++ee)i.get(te[ee])?.update();else for(let ee=0,ce=a.length;ee<ce;++ee)a[ee].update();J?Y():(m=!0,d=!0),p=!0,h=!0,f=!0,g=!0,y=!0},add:te=>F.add(te),remove:te=>F.remove(te),commit:(te=Number.MAX_VALUE)=>k(te),get commitQueueSize(){return F.size},get needsCommit(){return!F.isEmpty},has:te=>i.has(te),clear:()=>{for(let te=0,J=a.length;te<J;++te)a[te].dispose();a.length=0,u.length=0,c.length=0,i.clear(),m=!0,d=!0},forEach:te=>{i.forEach(te)},get count(){return a.length},get boundingSphere(){return m&&(cIe(a,s,!1),m=!1),s},get boundingSphereVisible(){return d&&(cIe(a,l,!0),d=!1),l},get transparency(){return n},get markerAverage(){return p&&(x=G(),p=!1),x},get emissiveAverage(){return h&&(S=X(),h=!1),S},get opacityAverage(){return f&&(I=U(),f=!1),I},get transparencyMin(){return g&&(v=L(),g=!1),v},get hasOpaque(){return y&&(A=q(),y=!1),A}}}t.create=e})(ih||={});var JA=class e{constructor(t){this.camera=t;this.t=0;this.func=e.defaultTransition;this.start=0;this.inTransition=!1;this.durationMs=0;this._source=ro.createDefaultSnapshot();this._target=ro.createDefaultSnapshot();this._current=ro.createDefaultSnapshot()}get source(){return this._source}get target(){return this._target}apply(t,r=0,n){if((!this.inTransition||r>0)&&ro.copySnapshot(this._source,this.camera.state),this.inTransition||ro.copySnapshot(this._target,this.camera.state),ro.copySnapshot(this._target,t),this._target.radius>this._target.radiusMax&&(this._target.radius=this._target.radiusMax),this._target.radius<.01&&(this._target.radius=.01),this._target.radiusMax<.01&&(this._target.radiusMax=.01),!this.inTransition&&r<=0||typeof t.mode<"u"&&t.mode!==this.camera.state.mode){this.finish(this._target);return}this.inTransition=!0,this.func=n||e.defaultTransition,(!this.inTransition||r>0)&&(this.start=this.t,this.durationMs=r)}tick(t){this.t=t,this.update()}finish(t){ro.copySnapshot(this.camera.state,t),this.inTransition=!1}update(){if(!this.inTransition)return;let t=Math.min((this.t-this.start)/this.durationMs,1);if(t===1){this.finish(this._target);return}this.func(this._current,t,this._source,this._target),ro.copySnapshot(this.camera.state,this._current)}};(i=>{let e=lr.identity(),t=lr.identity(),r=b(),n=b();function o(a,s,l,u){ro.copySnapshot(a,u),lr.slerp(e,lr.Identity,lr.rotationTo(e,l.up,u.up),s),b.transformQuat(a.up,l.up,e),b.lerp(a.target,l.target,u.target,s);let c=b.distance(l.target,l.position),m=b.distance(u.target,u.position),d=to(c,m,s);b.sub(r,l.position,l.target),b.normalize(r,r),b.sub(n,u.position,u.target),b.normalize(n,n),lr.rotationTo(t,r,n),lr.slerp(t,lr.Identity,t,s),b.transformQuat(r,r,t),b.scale(r,r,d),b.add(a.position,a.target,r),a.radius=to(l.radius,u.radius,s),a.radiusMax=to(l.radiusMax,u.radiusMax,s),a.fov=to(l.fov,u.fov,s),a.fog=to(l.fog,u.fog,s)}i.defaultTransition=o})(JA||={});var mIe=Et(),ro=class e{constructor(t,r=lo.create(0,0,128,128)){this.view=H.identity();this.projection=H.identity();this.projectionView=H.identity();this.inverseProjectionView=H.identity();this.headRotation=H.zero();this.viewEye=H.zero();this.isAsymmetricProjection=!1;this.state=e.createDefaultSnapshot();this.viewOffset=e.ViewOffset();this.disabled=!1;this.near=1;this.far=1e4;this.fogNear=5e3;this.fogFar=1e4;this.zoom=1;this.forceFull=!1;this.scale=1;this.minTargetDistance=0;this.transition=new JA(this);this.stateChanged=new Di(this.state);this.prevProjection=H.identity();this.prevView=H.identity();this.deltaDirection=b();this.newPosition=b();this.viewport=r,e.copySnapshot(this.state,t)}get position(){return this.state.position}set position(t){b.copy(this.state.position,t)}get up(){return this.state.up}set up(t){b.copy(this.state.up,t)}get target(){return this.state.target}set target(t){b.copy(this.state.target,t)}update(){let t=this.state;if(t.radiusMax===0)return!1;let r=b.distance(t.position,t.target),n=this.minTargetDistance/this.scale;r<n&&(b.sub(this.deltaDirection,t.target,t.position),b.setMagnitude(this.deltaDirection,this.deltaDirection,n),b.sub(t.position,t.target,this.deltaDirection));let o=2*Math.tan(t.fov/2)*b.distance(t.position,t.target)*this.scale;switch(this.zoom=this.viewport.height/o,Yot(this),this.state.mode){case"orthographic":Zot(this);break;case"perspective":qot(this);break;default:Mr(this.state.mode)}let i=!H.areEqual(this.projection,this.prevProjection,1e-6)||!H.areEqual(this.view,this.prevView,1e-6);if(i){if(H.mul(this.projectionView,this.projection,this.view),!H.tryInvert(this.inverseProjectionView,this.projectionView))return H.copy(this.view,this.prevView),H.copy(this.projection,this.prevProjection),H.mul(this.projectionView,this.projection,this.view),!1;H.copy(this.prevView,this.view),H.copy(this.prevProjection,this.projection)}return i}setState(t,r){this.transition.apply(t,r),this.stateChanged.next(t)}getSnapshot(){return e.copySnapshot(e.createDefaultSnapshot(),this.state)}getTargetDistance(t){return Math.max(this.minTargetDistance/this.scale,e.targetDistance(t,this.state.mode,this.state.fov,this.viewport.width,this.viewport.height))}getFocus(t,r,n,o,i){let a=Math.max(r,.01),s=this.getTargetDistance(a);b.sub(this.deltaDirection,i?.target??this.target,i?.position??this.position),o&&b.matchDirection(this.deltaDirection,o,this.deltaDirection),b.setMagnitude(this.deltaDirection,this.deltaDirection,s),b.sub(this.newPosition,t,this.deltaDirection);let l=e.copySnapshot(e.createDefaultSnapshot(),this.state);return l.target=b.clone(t),l.radius=a,l.position=b.clone(this.newPosition),n&&b.matchDirection(l.up,n,l.up),l}getCenter(t,r){b.sub(this.deltaDirection,this.target,this.position),b.sub(this.newPosition,t,this.deltaDirection);let n=e.copySnapshot(e.createDefaultSnapshot(),this.state);return n.target=b.clone(t),n.position=b.clone(this.newPosition),r&&(n.radius=Math.max(r,.01)),n}getInvariantFocus(t,r,n,o){let i=Math.max(r,.01),a=this.getTargetDistance(i);b.copy(this.deltaDirection,o),b.setMagnitude(this.deltaDirection,this.deltaDirection,a),b.sub(this.newPosition,t,this.deltaDirection);let s=e.copySnapshot(e.createDefaultSnapshot(),this.state);return s.target=b.clone(t),s.radius=i,s.position=b.clone(this.newPosition),b.copy(s.up,n),s}focus(t,r,n,o,i){r>0&&this.setState(this.getFocus(t,r,o,i),n)}center(t,r){this.setState(this.getCenter(t),r)}project(t,r){return xL(t,r,this.viewport,this.projectionView)}unproject(t,r){return Vg(t,r,this.viewport,this.inverseProjectionView)}getPixelSize(t){this.project(mIe,t);let r=mIe[3],n=this.viewport.width,o=this.projection[0];return 2/r/(n*Math.abs(o))}getRay(t,r,n){return this.state.mode==="orthographic"?(b.set(t.origin,r,n,0),this.unproject(t.origin,t.origin),b.normalize(t.direction,b.sub(t.direction,this.target,this.position)),b.scaleAndAdd(t.origin,t.origin,t.direction,-this.near)):(b.copy(t.origin,this.state.position),b.scale(t.origin,t.origin,this.scale),b.set(t.direction,r,n,.5),this.unproject(t.direction,t.direction),b.normalize(t.direction,b.sub(t.direction,t.direction,t.origin))),t}};(s=>{function e(){return{enabled:!1,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}}s.ViewOffset=e;function t(l,u,c,m,d,p,h){l.fullWidth=u,l.fullHeight=c,l.offsetX=m,l.offsetY=d,l.width=p,l.height=h}s.setViewOffset=t;function r(l,u){l.enabled=u.enabled,l.fullWidth=u.fullWidth,l.fullHeight=u.fullHeight,l.offsetX=u.offsetX,l.offsetY=u.offsetY,l.width=u.width,l.height=u.height}s.copyViewOffset=r;function n(l,u,c,m,d){let p=Math.max(l,.01),h=m/d,f=d<m?1:h;return Math.abs(u==="orthographic"?p/f/Math.tan(c/2):p/f/Math.sin(c/2))}s.targetDistance=n;function o(){return{mode:"perspective",fov:Math.PI/4,position:b.create(0,0,100),up:b.create(0,1,0),target:b.create(0,0,0),radius:0,radiusMax:10,fog:50,clipFar:!0,minNear:5,minFar:0}}s.createDefaultSnapshot=o;function i(l,u){return u&&(typeof u.mode<"u"&&(l.mode=u.mode),typeof u.fov<"u"&&(l.fov=u.fov),typeof u.position<"u"&&b.copy(l.position,u.position),typeof u.up<"u"&&b.copy(l.up,u.up),typeof u.target<"u"&&b.copy(l.target,u.target),typeof u.radius<"u"&&(l.radius=u.radius),typeof u.radiusMax<"u"&&(l.radiusMax=u.radiusMax),typeof u.fog<"u"&&(l.fog=u.fog),typeof u.clipFar<"u"&&(l.clipFar=u.clipFar),typeof u.minNear<"u"&&(l.minNear=u.minNear),typeof u.minFar<"u"&&(l.minFar=u.minFar)),l}s.copySnapshot=i;function a(l,u){return l.mode===u.mode&&l.fov===u.fov&&l.radius===u.radius&&l.radiusMax===u.radiusMax&&l.fog===u.fog&&l.clipFar===u.clipFar&&l.minNear===u.minNear&&l.minFar===u.minFar&&b.exactEquals(l.position,u.position)&&b.exactEquals(l.up,u.up)&&b.exactEquals(l.target,u.target)}s.areSnapshotsEqual=a})(ro||={});var vL=b(),IL=b();function dIe(e){e.scale===1?H.lookAt(e.view,e.state.position,e.state.target,e.state.up):(b.scale(vL,e.state.position,e.scale),b.scale(IL,e.state.target,e.scale),H.lookAt(e.view,vL,IL,e.state.up))}function Zot(e){let{viewport:t,zoom:r,near:n,far:o,viewOffset:i}=e,a=-t.width/2,s=t.width/2,l=t.height/2,u=-t.height/2,c=(s-a)/(2*r),m=(l-u)/(2*r),d=(s+a)/2,p=(l+u)/2,h=d-c,f=d+c,g=p+m,y=p-m;if(i.enabled){let x=r/(i.width/i.fullWidth),S=r/(i.height/i.fullHeight),I=(s-a)/i.width,v=(l-u)/i.height;h+=I*(i.offsetX/x),f=h+I*(i.width/x),g-=v*(i.offsetY/S),y=g-v*(i.height/S)}H.ortho(e.projection,h,f,g,y,n,o),dIe(e)}function qot(e){let t=e.viewport.width/e.viewport.height,{near:r,far:n,viewOffset:o}=e,i=r*Math.tan(.5*e.state.fov),a=2*i,s=t*a,l=-.5*s;o.enabled&&(l+=o.offsetX*s/o.fullWidth,i-=o.offsetY*a/o.fullHeight,s*=o.width/o.fullWidth,a*=o.height/o.fullHeight),H.perspective(e.projection,l,l+s,i,i-a,r,n),dIe(e)}function Yot(e){let{forceFull:t,scale:r}=e,{radius:n,radiusMax:o,mode:i,fog:a,clipFar:s,minNear:l,minFar:u}=e.state;o*=r,u*=r,l*=r,n*=r,t&&(n=o);let c=.01*r;n<c&&(n=c);let m=Math.max(s?n:o,u);b.scale(IL,e.state.target,r),b.scale(vL,e.state.position,r);let d=b.distance(vL,IL),p=t?.01:d-n,h=d+m;t&&(l=p),p=Math.max(Math.min(o,l),p),h=Math.max(l,h),p===h&&(h=p+.01*r);let f=-(50-a)/50,g=d-m*f,y=h;e.near=p,e.far=h,e.fogNear=g,e.fogFar=y}var qR={sceneBoundingSpheres:C.Boolean(!1,{description:"Show full scene bounding spheres."}),visibleSceneBoundingSpheres:C.Boolean(!1,{description:"Show visible scene bounding spheres."}),objectBoundingSpheres:C.Boolean(!1,{description:"Show bounding spheres of visible render objects."}),instanceBoundingSpheres:C.Boolean(!1,{description:"Show bounding spheres of visible instances."})},TL=class{constructor(t,r,n){this.objectsData=new Map;this.instancesData=new Map;this.scene=ih.create(t,"blended"),this.parent=r,this._props={...C.getDefaultValues(qR),...n}}update(){let t=AL(this.scene,this.parent.boundingSphere,this.sceneData,Lt.lightgrey,Jot);t&&(this.sceneData=t);let r=AL(this.scene,this.parent.boundingSphereVisible,this.visibleSceneData,Lt.black,$ot);r&&(this.visibleSceneData=r),this.parent.forEach((n,o)=>{let i=this.objectsData.get(o),a=AL(this.scene,n.values.boundingSphere.ref.value,i,Lt.tomato,eit);a&&this.objectsData.set(o,a);let s=this.instancesData.get(o),l=AL(this.scene,n.values.invariantBoundingSphere.ref.value,s,Lt.skyblue,tit,{aTransform:o.values.aTransform,matrix:o.values.matrix,transform:o.values.transform,extraTransform:o.values.extraTransform,uInstanceCount:o.values.uInstanceCount,instanceCount:o.values.instanceCount,aInstance:o.values.aInstance,hasReflection:o.values.hasReflection,instanceGrid:o.values.instanceGrid});l&&this.instancesData.set(o,l)}),this.objectsData.forEach((n,o)=>{this.parent.has(o)||(this.scene.remove(n.renderObject),this.objectsData.delete(o))}),this.instancesData.forEach((n,o)=>{this.parent.has(o)||(this.scene.remove(n.renderObject),this.instancesData.delete(o))}),this.scene.update(void 0,!1),this.scene.commit()}syncVisibility(){this.sceneData&&(this.sceneData.renderObject.state.visible=this._props.sceneBoundingSpheres),this.visibleSceneData&&(this.visibleSceneData.renderObject.state.visible=this._props.visibleSceneBoundingSpheres),this.parent.forEach((t,r)=>{let n=this.objectsData.get(r);n&&(n.renderObject.state.visible=r.state.visible&&this._props.objectBoundingSpheres);let o=this.instancesData.get(r);o&&(o.renderObject.state.visible=r.state.visible&&this._props.instanceBoundingSpheres)})}clear(){this.sceneData=void 0,this.objectsData.clear(),this.scene.clear()}get isEnabled(){return this._props.sceneBoundingSpheres||this._props.visibleSceneBoundingSpheres||this._props.objectBoundingSpheres||this._props.instanceBoundingSpheres}get props(){return this._props}setProps(t){Object.assign(this._props,t),this.isEnabled&&this.update()}};function AL(e,t,r,n,o,i){if(!r||!he.equals(r.boundingSphere,t)){let a=Kot(t,r&&r.mesh),s=r?r.renderObject:rit(a,n,o,i);return r?_.updateIfChanged(s.values.drawCount,ba.getDrawCount(a)):e.add(s),{boundingSphere:he.clone(t),renderObject:s,mesh:a}}}function Kot(e,t){let n=Nm(2),o=tt.createState(n,n/2,t);if(e.radius&&(Zr(o,e.center,e.radius,2),he.hasExtrema(e)))for(let i of e.extrema)Zr(o,i,1,0);return tt.getMesh(o)}var Jot=Kc(),$ot=Kc(),eit=Kc(),tit=Kc();function rit(e,t,r,n){let o=ft.Utils.createValuesSimple(e,{alpha:.1,doubleSided:!1,cellSize:0,batchSize:0},t,1,n);return Pp("mesh",o,{disposed:!1,visible:!0,alphaFactor:1,pickable:!1,colorOnly:!1,opaque:!1,writeDepth:!1},r)}var DX=b(),wX=b(),pIe=b(),MX={maxFps:C.Numeric(30,{min:10,max:60,step:10}),preferAtomPixelPadding:C.Numeric(3,{min:0,max:20,step:1},{description:"Number of extra pixels at which to prefer atoms over bonds."}),convertCoordsToRay:C.Boolean(!1,{description:"Convert screen coordinates to ray for picking."})},PL=class{constructor(t,r,n,o,i,a,s={}){this.canvasIdentify=t;this.canvasAsyncIdentify=r;this.lociGetter=n;this.input=o;this.camera=i;this.controls=a;this.ev=Tc.create();this.events={hover:this.ev(),drag:this.ev(),click:this.ev()};this.startX=-1;this.startY=-1;this.endX=-1;this.endY=-1;this.ray=void 0;this.pickData=void 0;this.position=void 0;this.isInteracting=!1;this.prevLoci=Ut.Loci.Empty;this.prevT=0;this.inside=!1;this.buttons=Ai.create(0);this.button=Ai.create(0);this.modifiers=cs.None;this.props={...C.getDefaultValues(MX),...s},o.drag.subscribe(({x:l,y:u,buttons:c,button:m,modifiers:d})=>{this.isInteracting=!0,this.drag(l,u,c,m,d)}),o.move.subscribe(({x:l,y:u,inside:c,buttons:m,button:d,modifiers:p,onElement:h,ray:f})=>{if(!(!c||this.isInteracting)){if(!h){this.leave();return}this.move(l,u,m,d,p,f)}}),o.leave.subscribe(()=>{this.leave()}),o.click.subscribe(({x:l,y:u,buttons:c,button:m,modifiers:d,ray:p})=>{this.outsideViewport(l,u,p)||this.click(l,u,c,m,d,p)}),o.interactionEnd.subscribe(()=>{this.isInteracting=!1}),o.modifiers.subscribe(l=>{this.modify(l)})}setProps(t){Object.assign(this.props,t)}getTarget(){return this.ray?this.ray:this.props.convertCoordsToRay?this.camera.getRay(Eu(),this.endX,this.input.height-this.endY):Ce.create(this.endX,this.endY)}handleMove(){(this.startX!==this.endX||this.startY!==this.endY||this.input.pointerLock&&!this.controls.isMoving)&&(this.pickData=this.canvasAsyncIdentify(this.getTarget()),this.startX=this.endX,this.startY=this.endY)}handleClick(){let t=this.canvasIdentify(this.getTarget()),r=this.getLoci(t?.id,t?.position);this.events.click.next({current:r,buttons:this.buttons,button:this.button,modifiers:this.modifiers,page:Ce.create(this.endX,this.endY),position:t?.position}),this.prevLoci=r}handleDrag(){(this.startX!==this.endX||this.startY!==this.endY||this.input.pointerLock&&!this.controls.isMoving)&&!this.outsideViewport(this.startX,this.startY,this.ray)&&(this.events.drag.next({current:this.prevLoci,buttons:this.buttons,button:this.button,modifiers:this.modifiers,pageStart:Ce.create(this.startX,this.startY),pageEnd:Ce.create(this.endX,this.endY)}),this.startX=this.endX,this.startY=this.endY)}tick(t){if(this.inside){if(this.pickData){let r=this.pickData.tryGet();if(r!=="pending"){if(this.position=r?.position,this.inside){let n=this.getLoci(r?.id,r?.position);this.events.hover.next({current:n,buttons:this.buttons,button:this.button,modifiers:this.modifiers,page:Ce.create(this.endX,this.endY),position:r?.position}),this.prevLoci=n}this.pickData=void 0}}t-this.prevT>1e3/this.props.maxFps&&(this.prevT=t,this.isInteracting?this.handleDrag():this.handleMove())}}leave(){this.inside=!1,Ut.Loci.isEmpty(this.prevLoci)||(this.prevLoci=Ut.Loci.Empty,this.events.hover.next({current:this.prevLoci,buttons:this.buttons,button:this.button,modifiers:this.modifiers}))}move(t,r,n,o,i,a){this.inside=!0,this.buttons=n,this.button=o,this.modifiers=i,this.ray=a,this.endX=t,this.endY=r}click(t,r,n,o,i,a){this.endX=t,this.endY=r,this.buttons=n,this.button=o,this.modifiers=i,this.ray=a,this.handleClick()}drag(t,r,n,o,i){this.endX=t,this.endY=r,this.buttons=n,this.button=o,this.modifiers=i,this.handleDrag()}modify(t){cs.areEqual(t,this.modifiers)||(this.modifiers=t,this.events.hover.next({current:this.prevLoci,buttons:this.buttons,button:this.button,modifiers:this.modifiers,page:Ce.create(this.endX,this.endY),position:this.position}))}outsideViewport(t,r,n){if(n)return!1;let{input:o,camera:{viewport:i}}=this;return t*=o.pixelRatio,r*=o.pixelRatio,t>i.x+i.width||o.height-r>i.y+i.height||t<i.x||o.height-r<i.y}getLoci(t,r){let{repr:n,loci:o}=this.lociGetter(t);if(r&&n&&It.isLoci(o)&&o.bonds.length===2){let{aUnit:i,aIndex:a}=o.bonds[0];i.conformation.position(i.elements[a],DX),b.sub(pIe,this.camera.state.position,this.camera.state.target),b.projectPointOnPlane(wX,r,pIe,DX);let s=this.camera.getPixelSize(wX),l=n.theme.size.size(o.bonds[0])*(n.props.sizeFactor??1);if(n.props.lineSizeAttenuation===!1&&(l*=s/2),l+=this.props.preferAtomPixelPadding*s,b.distance(wX,DX)<l)return{repr:n,loci:It.toFirstStructureElementLoci(o)}}return{repr:n,loci:o}}dispose(){this.ev.dispose()}};var fIe=`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tSsaoDepth;
uniform sampler2D tSsaoDepthTransparent;
uniform sampler2D tColor;
uniform sampler2D tTransparentColor;
uniform sampler2D tDepthOpaque;
uniform sampler2D tDepthTransparent;
uniform sampler2D tShadows;
uniform sampler2D tOutlines;
uniform vec2 uTexSize;

uniform float uNear;
uniform float uFar;
uniform float uFogNear;
uniform float uFogFar;
uniform vec3 uFogColor;
uniform vec3 uOutlineColor;
uniform vec3 uOcclusionColor;
uniform bool uTransparentBackground;
uniform vec2 uOcclusionOffset;

#include common

float getViewZ(const in float depth) {
    #if dOrthographic == 1
        return orthographicDepthToViewZ(depth, uNear, uFar);
    #else
        return perspectiveDepthToViewZ(depth, uNear, uFar);
    #endif
}

float getDepthOpaque(const in vec2 coords) {
    #ifdef depthTextureSupport
        return texture2D(tDepthOpaque, coords).r;
    #else
        return unpackRGBAToDepth(texture2D(tDepthOpaque, coords));
    #endif
}

float getDepthTransparent(const in vec2 coords) {
    return unpackRGBAToDepthWithAlpha(texture2D(tDepthTransparent, coords)).x;
}

bool isBackground(const in float depth) {
    return depth == 1.0;
}

int squaredOutlineScale = dOutlineScale * dOutlineScale;
void getOutline(const in vec2 coords, out bool hasOpaque, out bool hasTransparent, out float opaqueDepth, out float transparentDepth, out float alpha) {
    vec2 invTexSize = 1.0 / uTexSize;

    hasOpaque = false;
    hasTransparent = false;
    opaqueDepth = 1.0;
    transparentDepth = 1.0;
    alpha = 0.0;
    for (int y = -dOutlineScale; y <= dOutlineScale; y++) {
        for (int x = -dOutlineScale; x <= dOutlineScale; x++) {
            if (x * x + y * y > squaredOutlineScale) {
                continue;
            }

            vec2 sampleCoords = coords + vec2(float(x), float(y)) * invTexSize;

            vec4 sampleOutlineCombined = texture2D(tOutlines, sampleCoords);
            float sampleOpaqueDepth = unpackRGToUnitInterval(sampleOutlineCombined.gb);
            float sampleTransparentDepth = sampleOutlineCombined.a;
            vec2 sampleFlagWithAlpha = unpack2x4(sampleOutlineCombined.r);

            float sampleFlag = sampleFlagWithAlpha.x;
            float sampleAlpha = clamp(sampleFlagWithAlpha.y * 0.5, 0.01, 1.0);

            if ((sampleFlag > 0.20 && sampleFlag < 0.30) || (sampleFlag > 0.70 && sampleFlag < 0.80)) { // transparent || both
                if (sampleOpaqueDepth < opaqueDepth) {
                    hasOpaque = true;
                    opaqueDepth = sampleOpaqueDepth;
                }
            }

            if ((((sampleFlag > 0.45 && sampleFlag < 0.55) || (sampleFlag > 0.70 && sampleFlag < 0.80))) && sampleTransparentDepth < transparentDepth) { // transparent || both
                hasTransparent = true;
                transparentDepth = sampleTransparentDepth;
                alpha = sampleAlpha;
            }
        }
    }
}

float getSsao(vec2 coords) {
    float rawSsao = unpackRGToUnitInterval(texture2D(tSsaoDepth, coords).xy);
    if (rawSsao > 0.999) {
        return 1.0;
    } else if (rawSsao > 0.001) {
        return rawSsao;
    }
    // treat values close to 0.0 as errors and return no occlusion
    return 1.0;
}

float getSsaoTransparent(vec2 coords) {
    float rawSsao = unpackRGToUnitInterval(texture2D(tSsaoDepthTransparent, coords).xy);
    if (rawSsao > 0.999) {
        return 1.0;
    } else if (rawSsao > 0.001) {
        return rawSsao;
    }
    // treat values close to 0.0 as errors and return no occlusion
    return 1.0;
}

void main(void) {
    vec2 coords = gl_FragCoord.xy / uTexSize;
    vec4 color = texture2D(tColor, coords);

    float opaqueDepth = getDepthOpaque(coords);
    float transparentDepth = 1.0;
    #ifdef dBlendTransparency
        bool blendTransparency = true;
        vec4 transparentColor = texture2D(tTransparentColor, coords);

        #if defined(dOutlineEnable) || defined(dOcclusionEnable) && defined(dOcclusionIncludeTransparency)
            transparentDepth = getDepthTransparent(coords);
        #endif
    #endif

    #if defined(dOcclusionEnable) || defined(dShadowEnable)
        bool isOpaqueBackground = isBackground(opaqueDepth);
        float viewDist = abs(getViewZ(opaqueDepth));
        float fogFactor = smoothstep(uFogNear, uFogFar, viewDist);
    #endif

    #if defined(dOcclusionEnable)
        if (!isOpaqueBackground) {
            float occlusionFactor = getSsao(coords + uOcclusionOffset);

            if (!uTransparentBackground) {
                color.rgb = mix(mix(uOcclusionColor, uFogColor, fogFactor), color.rgb, occlusionFactor);
            } else {
                color.rgb = mix(uOcclusionColor * (1.0 - fogFactor), color.rgb, occlusionFactor);
            }
        }
        #if defined(dBlendTransparency) && defined(dOcclusionIncludeTransparency)
            if (!isBackground(transparentDepth)) {
                float viewDist = abs(getViewZ(transparentDepth));
                float fogFactor = smoothstep(uFogNear, uFogFar, viewDist);
                float occlusionFactor = getSsaoTransparent(coords + uOcclusionOffset);
                transparentColor.rgb = mix(uOcclusionColor * (1.0 - fogFactor), transparentColor.rgb, occlusionFactor);
            }
        #endif
    #endif

    #ifdef dShadowEnable
        if (!isOpaqueBackground) {
            vec4 shadow = texture2D(tShadows, coords);
            if (!uTransparentBackground) {
                color.rgb = mix(mix(vec3(0), uFogColor, fogFactor), color.rgb, shadow.a);
            } else {
                color.rgb = mix(vec3(0) * (1.0 - fogFactor), color.rgb, shadow.a);
            }
        }
    #endif

    // outline needs to be handled after occlusion and shadow to keep them clean
    #ifdef dOutlineEnable
        bool hasOpaque;
        bool hasTransparent;
        float outlineOpaqueDepth;
        float outlineTransparentDepth;
        float outlineAlpha;
        getOutline(coords, hasOpaque, hasTransparent, outlineOpaqueDepth, outlineTransparentDepth, outlineAlpha);

        if (hasOpaque) {
            float viewDist = abs(getViewZ(outlineOpaqueDepth));
            float fogFactor = smoothstep(uFogNear, uFogFar, viewDist);
            if (!uTransparentBackground) {
                color.rgb = mix(uOutlineColor, uFogColor, fogFactor);
            } else {
                color.a = 1.0 - fogFactor;
                color.rgb = mix(uOutlineColor, vec3(0.0), fogFactor);
            }
        }

        #ifdef dBlendTransparency
            if (hasTransparent) {
                if (hasOpaque && outlineOpaqueDepth < outlineTransparentDepth) {
                    blendTransparency = false;
                } else {
                    float finalOutlineAlpha = clamp(outlineAlpha * 2.0, 0.0, 1.0);
                    float viewDist = abs(getViewZ(outlineTransparentDepth));
                    float fogFactor = smoothstep(uFogNear, uFogFar, viewDist);
                    float finalAlpha = max(transparentColor.a, finalOutlineAlpha * (1.0 - fogFactor));
                    transparentColor.a = finalAlpha;
                    transparentColor.rgb = uOutlineColor * finalAlpha;
                }
            }
        #endif
    #endif

    #ifdef dBlendTransparency
        if (blendTransparency) {
            float alpha = transparentColor.a;
            if (alpha != 0.0) {
                // blending
                color = transparentColor + color * (1.0 - alpha);
            }
        }
    #endif

    gl_FragColor = color;
}
`;var hIe=`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tColor;
uniform vec2 uTexSizeInv;

// adapted from https://github.com/kosua20/Rendu
// MIT License Copyright (c) 2017 Simon Rodriguez

#define QUALITY(q) ((q) < 5 ? 1.0 : ((q) > 5 ? ((q) < 10 ? 2.0 : ((q) < 11 ? 4.0 : 8.0)) : 1.5))

float rgb2luma(vec3 rgb){
    return sqrt(dot(rgb, vec3(0.299, 0.587, 0.114)));
}

float sampleLuma(vec2 uv) {
    return rgb2luma(texture2D(tColor, uv).rgb);
}

float sampleLuma(vec2 uv, float uOffset, float vOffset) {
    uv += uTexSizeInv * vec2(uOffset, vOffset);
    return sampleLuma(uv);
}

void main(void) {
    vec2 coords = gl_FragCoord.xy * uTexSizeInv;
    vec2 inverseScreenSize = uTexSizeInv;

    vec4 colorCenter = texture2D(tColor, coords);

    // Luma at the current fragment
    float lumaCenter = rgb2luma(colorCenter.rgb);

    // Luma at the four direct neighbours of the current fragment.
    float lumaDown = sampleLuma(coords, 0.0, -1.0);
    float lumaUp = sampleLuma(coords, 0.0, 1.0);
    float lumaLeft = sampleLuma(coords, -1.0, 0.0);
    float lumaRight = sampleLuma(coords, 1.0, 0.0);

    // Find the maximum and minimum luma around the current fragment.
    float lumaMin = min(lumaCenter, min(min(lumaDown, lumaUp), min(lumaLeft, lumaRight)));
    float lumaMax = max(lumaCenter, max(max(lumaDown, lumaUp), max(lumaLeft, lumaRight)));

    // Compute the delta.
    float lumaRange = lumaMax - lumaMin;

    // If the luma variation is lower that a threshold (or if we are in a really dark area),
    // we are not on an edge, don't perform any AA.
    if (lumaRange < max(dEdgeThresholdMin, lumaMax * dEdgeThresholdMax)) {
        gl_FragColor = colorCenter;
        return;
    }

    // Query the 4 remaining corners lumas.
    float lumaDownLeft = sampleLuma(coords, -1.0, -1.0);
    float lumaUpRight = sampleLuma(coords, 1.0, 1.0);
    float lumaUpLeft = sampleLuma(coords, -1.0, 1.0);
    float lumaDownRight = sampleLuma(coords, 1.0, -1.0);

    // Combine the four edges lumas (using intermediary variables for future computations
    // with the same values).
    float lumaDownUp = lumaDown + lumaUp;
    float lumaLeftRight = lumaLeft + lumaRight;

    // Same for corners
    float lumaLeftCorners = lumaDownLeft + lumaUpLeft;
    float lumaDownCorners = lumaDownLeft + lumaDownRight;
    float lumaRightCorners = lumaDownRight + lumaUpRight;
    float lumaUpCorners = lumaUpRight + lumaUpLeft;

    // Compute an estimation of the gradient along the horizontal and vertical axis.
    float edgeHorizontal = abs(-2.0 * lumaLeft + lumaLeftCorners) + abs(-2.0 * lumaCenter + lumaDownUp) * 2.0 + abs(-2.0 * lumaRight + lumaRightCorners);
    float edgeVertical = abs(-2.0 * lumaUp + lumaUpCorners) + abs(-2.0 * lumaCenter + lumaLeftRight) * 2.0 + abs(-2.0 * lumaDown + lumaDownCorners);

    // Is the local edge horizontal or vertical ?
    bool isHorizontal = (edgeHorizontal >= edgeVertical);

    // Choose the step size (one pixel) accordingly.
    float stepLength = isHorizontal ? inverseScreenSize.y : inverseScreenSize.x;

    // Select the two neighboring texels lumas in the opposite direction to the local edge.
    float luma1 = isHorizontal ? lumaDown : lumaLeft;
    float luma2 = isHorizontal ? lumaUp : lumaRight;
    // Compute gradients in this direction.
    float gradient1 = luma1 - lumaCenter;
    float gradient2 = luma2 - lumaCenter;

    // Which direction is the steepest ?
    bool is1Steepest = abs(gradient1) >= abs(gradient2);

    // Gradient in the corresponding direction, normalized.
    float gradientScaled = 0.25 * max(abs(gradient1), abs(gradient2));

    // Average luma in the correct direction.
    float lumaLocalAverage = 0.0;
    if(is1Steepest){
        // Switch the direction
        stepLength = -stepLength;
        lumaLocalAverage = 0.5 * (luma1 + lumaCenter);
    } else {
        lumaLocalAverage = 0.5 * (luma2 + lumaCenter);
    }

    // Shift UV in the correct direction by half a pixel.
    vec2 currentUv = coords;
    if(isHorizontal){
        currentUv.y += stepLength * 0.5;
    } else {
        currentUv.x += stepLength * 0.5;
    }

    // Compute offset (for each iteration step) in the right direction.
    vec2 offset = isHorizontal ? vec2(inverseScreenSize.x, 0.0) : vec2(0.0, inverseScreenSize.y);
    // Compute UVs to explore on each side of the edge, orthogonally.
    // The QUALITY allows us to step faster.
    vec2 uv1 = currentUv - offset * QUALITY(0);
    vec2 uv2 = currentUv + offset * QUALITY(0);

    // Read the lumas at both current extremities of the exploration segment,
    // and compute the delta wrt to the local average luma.
    float lumaEnd1 = sampleLuma(uv1);
    float lumaEnd2 = sampleLuma(uv2);
    lumaEnd1 -= lumaLocalAverage;
    lumaEnd2 -= lumaLocalAverage;

    // If the luma deltas at the current extremities is larger than the local gradient,
    // we have reached the side of the edge.
    bool reached1 = abs(lumaEnd1) >= gradientScaled;
    bool reached2 = abs(lumaEnd2) >= gradientScaled;
    bool reachedBoth = reached1 && reached2;

    // If the side is not reached, we continue to explore in this direction.
    if(!reached1){
        uv1 -= offset * QUALITY(1);
    }
    if(!reached2){
        uv2 += offset * QUALITY(1);
    }

    // If both sides have not been reached, continue to explore.
    if(!reachedBoth){
        for(int i = 2; i < dIterations; i++){
            // If needed, read luma in 1st direction, compute delta.
            if(!reached1){
                lumaEnd1 = sampleLuma(uv1);
                lumaEnd1 = lumaEnd1 - lumaLocalAverage;
            }
            // If needed, read luma in opposite direction, compute delta.
            if(!reached2){
                lumaEnd2 = sampleLuma(uv2);
                lumaEnd2 = lumaEnd2 - lumaLocalAverage;
            }
            // If the luma deltas at the current extremities is larger than the local gradient,
            // we have reached the side of the edge.
            reached1 = abs(lumaEnd1) >= gradientScaled;
            reached2 = abs(lumaEnd2) >= gradientScaled;
            reachedBoth = reached1 && reached2;

            // If the side is not reached, we continue to explore in this direction,
            // with a variable quality.
            if(!reached1){
                uv1 -= offset * QUALITY(i);
            }
            if(!reached2){
                uv2 += offset * QUALITY(i);
            }

            // If both sides have been reached, stop the exploration.
            if(reachedBoth){
                break;
            }
        }
    }

    // Compute the distances to each side edge of the edge (!).
    float distance1 = isHorizontal ? (coords.x - uv1.x) : (coords.y - uv1.y);
    float distance2 = isHorizontal ? (uv2.x - coords.x) : (uv2.y - coords.y);

    // In which direction is the side of the edge closer ?
    bool isDirection1 = distance1 < distance2;
    float distanceFinal = min(distance1, distance2);

    // Thickness of the edge.
    float edgeThickness = (distance1 + distance2);

    // Is the luma at center smaller than the local average ?
    bool isLumaCenterSmaller = lumaCenter < lumaLocalAverage;

    // If the luma at center is smaller than at its neighbour,
    // the delta luma at each end should be positive (same variation).
    bool correctVariation1 = (lumaEnd1 < 0.0) != isLumaCenterSmaller;
    bool correctVariation2 = (lumaEnd2 < 0.0) != isLumaCenterSmaller;

    // Only keep the result in the direction of the closer side of the edge.
    bool correctVariation = isDirection1 ? correctVariation1 : correctVariation2;

    // UV offset: read in the direction of the closest side of the edge.
    float pixelOffset = - distanceFinal / edgeThickness + 0.5;

    // If the luma variation is incorrect, do not offset.
    float finalOffset = correctVariation ? pixelOffset : 0.0;

    // Sub-pixel shifting
    // Full weighted average of the luma over the 3x3 neighborhood.
    float lumaAverage = (1.0 / 12.0) * (2.0 * (lumaDownUp + lumaLeftRight) + lumaLeftCorners + lumaRightCorners);
    // Ratio of the delta between the global average and the center luma,
    // over the luma range in the 3x3 neighborhood.
    float subPixelOffset1 = clamp(abs(lumaAverage - lumaCenter) / lumaRange, 0.0, 1.0);
    float subPixelOffset2 = (-2.0 * subPixelOffset1 + 3.0) * subPixelOffset1 * subPixelOffset1;
    // Compute a sub-pixel offset based on this delta.
    float subPixelOffsetFinal = subPixelOffset2 * subPixelOffset2 * float(dSubpixelQuality);

    // Pick the biggest of the two offsets.
    finalOffset = max(finalOffset, subPixelOffsetFinal);

    // Compute the final UV coordinates.
    vec2 finalUv = coords;
    if(isHorizontal){
        finalUv.y += finalOffset * stepLength;
    } else {
        finalUv.x += finalOffset * stepLength;
    }

    // Read the color at the new UV coordinates, and use it.
    gl_FragColor = texture2D(tColor, finalUv);
}
`;var gIe={edgeThresholdMin:C.Numeric(.0312,{min:.0312,max:.0833,step:1e-4},{description:"Trims the algorithm from processing darks."}),edgeThresholdMax:C.Numeric(.063,{min:.063,max:.333,step:.001},{description:"The minimum amount of local contrast required to apply algorithm."}),iterations:C.Numeric(12,{min:0,max:16,step:1},{description:"Number of edge exploration steps."}),subpixelQuality:C.Numeric(.3,{min:0,max:1,step:.01},{description:"Choose the amount of sub-pixel aliasing removal."})},_L=class{constructor(t,r){this.webgl=t;this.renderable=iit(t,r)}updateState(t){let{gl:r,state:n}=this.webgl;n.enable(r.SCISSOR_TEST),n.disable(r.BLEND),n.disable(r.DEPTH_TEST),n.depthMask(!1);let{x:o,y:i,width:a,height:s}=t;n.viewport(o,i,a,s),n.scissor(o,i,a,s),n.clearColor(0,0,0,1),r.clear(r.COLOR_BUFFER_BIT)}setSize(t,r){_.update(this.renderable.values.uTexSizeInv,Ce.set(this.renderable.values.uTexSizeInv.ref.value,1/t,1/r))}update(t,r){let{values:n}=this.renderable,{edgeThresholdMin:o,edgeThresholdMax:i,iterations:a,subpixelQuality:s}=r,l=!1;n.tColor.ref.value!==t&&(_.update(this.renderable.values.tColor,t),l=!0),n.dEdgeThresholdMin.ref.value!==o&&(l=!0),_.updateIfChanged(n.dEdgeThresholdMin,o),n.dEdgeThresholdMax.ref.value!==i&&(l=!0),_.updateIfChanged(n.dEdgeThresholdMax,i),n.dIterations.ref.value!==a&&(l=!0),_.updateIfChanged(n.dIterations,a),n.dSubpixelQuality.ref.value!==s&&(l=!0),_.updateIfChanged(n.dSubpixelQuality,s),l&&this.renderable.update()}render(t,r){je&&this.webgl.timer.mark("FxaaPass.render"),r?r.bind():this.webgl.bindDrawingBuffer(),this.updateState(t),this.renderable.render(),je&&this.webgl.timer.markEnd("FxaaPass.render")}},nit={...Sn,tColor:yt("texture","rgba","ubyte","linear"),uTexSizeInv:de("v2"),dEdgeThresholdMin:dt("number"),dEdgeThresholdMax:dt("number"),dIterations:dt("number"),dSubpixelQuality:dt("number")},oit=zr("fxaa",Fn,hIe);function iit(e,t){let r=t.getWidth(),n=t.getHeight(),o={...vn,tColor:_.create(t),uTexSizeInv:_.create(Ce.create(1/r,1/n)),dEdgeThresholdMin:_.create(.0312),dEdgeThresholdMax:_.create(.125),dIterations:_.create(12),dSubpixelQuality:_.create(.3)},i={...nit},a=on(e,"triangles",oit,i,o);return an(a,o)}var yIe=`
precision highp float;

attribute vec2 aPosition;
uniform vec2 uQuadScale;

uniform vec2 uTexSizeInv;
uniform vec4 uViewport;

varying vec2 vUv;
varying vec4 vOffset[2];

void SMAANeighborhoodBlendingVS(vec2 texCoord) {
    vOffset[0] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(-1.0, 0.0, 0.0, 1.0); // WebGL port note: Changed sign in W component
    vOffset[1] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(1.0, 0.0, 0.0, -1.0); // WebGL port note: Changed sign in W component
}

void main() {
    vec2 scale = uViewport.zw * uTexSizeInv;
    vec2 shift = uViewport.xy * uTexSizeInv;
    vUv = (aPosition + 1.0) * 0.5 * scale + shift;
    SMAANeighborhoodBlendingVS(vUv);
    vec2 position = aPosition * uQuadScale - vec2(1.0, 1.0) + uQuadScale;
    gl_Position = vec4(position, 0.0, 1.0);
}
`;var bIe=`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tWeights;
uniform sampler2D tColor;
uniform vec2 uTexSizeInv;

varying vec2 vUv;
varying vec4 vOffset[2];

vec4 SMAANeighborhoodBlendingPS(vec2 texCoord, vec4 offset[2], sampler2D colorTex, sampler2D blendTex) {
    // Fetch the blending weights for current pixel:
    vec4 a;
    a.xz = texture2D(blendTex, texCoord).xz;
    a.y = texture2D(blendTex, offset[1].zw).g;
    a.w = texture2D(blendTex, offset[1].xy).a;

    // Is there any blending weight with a value greater than 0.0?
    if (dot(a, vec4(1.0, 1.0, 1.0, 1.0)) < 1e-5) {
        return texture2D(colorTex, texCoord, 0.0);
    } else {
        // Up to 4 lines can be crossing a pixel (one through each edge). We
        // favor blending by choosing the line with the maximum weight for each
        // direction:
        vec2 offset;
        offset.x = a.a > a.b ? a.a : -a.b; // left vs. right
        offset.y = a.g > a.r ? -a.g : a.r; // top vs. bottom // WebGL port note: Changed signs

        // Then we go in the direction that has the maximum weight:
        if (abs(offset.x) > abs(offset.y)) { // horizontal vs. vertical
            offset.y = 0.0;
        } else {
            offset.x = 0.0;
        }

        // Fetch the opposite color and lerp by hand:
        vec4 C = texture2D(colorTex, texCoord, 0.0);
        texCoord += sign(offset) * uTexSizeInv;
        vec4 Cop = texture2D(colorTex, texCoord, 0.0);
        float s = abs(offset.x) > abs(offset.y) ? abs(offset.x) : abs(offset.y);

        // WebGL port note: Added gamma correction
        C.xyz = pow(C.xyz, vec3(2.2));
        Cop.xyz = pow(Cop.xyz, vec3(2.2));
        vec4 mixed = mix(C, Cop, s);
        mixed.xyz = pow(mixed.xyz, vec3(1.0 / 2.2));

        return mixed;
    }
}

void main() {
    gl_FragColor = SMAANeighborhoodBlendingPS(vUv, vOffset, tColor, tWeights);
}
`;var xIe=`
precision highp float;

attribute vec2 aPosition;
uniform vec2 uQuadScale;

uniform vec2 uTexSizeInv;
uniform vec4 uViewport;

varying vec2 vUv;
varying vec4 vOffset[3];
varying vec2 vPixCoord;

void SMAABlendingWeightCalculationVS(vec2 texCoord) {
    vPixCoord = texCoord / uTexSizeInv;

    // We will use these offsets for the searches later on (see @PSEUDO_GATHER4):
    vOffset[0] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(-0.25, 0.125, 1.25, 0.125); // WebGL port note: Changed sign in Y and W components
    vOffset[1] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(-0.125, 0.25, -0.125, -1.25); // WebGL port note: Changed sign in Y and W components

    // And these for the searches, they indicate the ends of the loops:
    vOffset[2] = vec4(vOffset[0].xz, vOffset[1].yw) + vec4(-2.0, 2.0, -2.0, 2.0) * uTexSizeInv.xxyy * float(dMaxSearchSteps);
}

void main() {
    vec2 scale = uViewport.zw * uTexSizeInv;
    vec2 shift = uViewport.xy * uTexSizeInv;
    vUv = (aPosition + 1.0) * 0.5 * scale + shift;
    SMAABlendingWeightCalculationVS(vUv);
    vec2 position = aPosition * uQuadScale - vec2(1.0, 1.0) + uQuadScale;
    gl_Position = vec4(position, 0.0, 1.0);
}
`;var CIe=`
precision highp float;
precision highp int;
precision highp sampler2D;

#define SMAASampleLevelZeroOffset(tex, coord, offset) texture2D(tex, coord + float(offset) * uTexSizeInv, 0.0)

#define SMAA_AREATEX_MAX_DISTANCE 16
#define SMAA_AREATEX_PIXEL_SIZE (1.0 / vec2(160.0, 560.0))
#define SMAA_AREATEX_SUBTEX_SIZE (1.0 / 7.0)

uniform sampler2D tEdges;
uniform sampler2D tArea;
uniform sampler2D tSearch;
uniform vec2 uTexSizeInv;

varying vec2 vUv;
varying vec4 vOffset[3];
varying vec2 vPixCoord;

#if __VERSION__ == 100
    vec2 round(vec2 x) {
        return sign(x) * floor(abs(x) + 0.5);
    }
#endif

float SMAASearchLength(sampler2D searchTex, vec2 e, float bias, float scale) {
    // Not required if searchTex accesses are set to point:
    // float2 SEARCH_TEX_PIXEL_SIZE = 1.0 / float2(66.0, 33.0);
    // e = float2(bias, 0.0) + 0.5 * SEARCH_TEX_PIXEL_SIZE +
    //     e * float2(scale, 1.0) * float2(64.0, 32.0) * SEARCH_TEX_PIXEL_SIZE;
    e.r = bias + e.r * scale;
    return 255.0 * texture2D(searchTex, e, 0.0).r;
}

float SMAASearchXLeft(sampler2D edgesTex, sampler2D searchTex, vec2 texCoord, float end) {
    /**
     * @PSEUDO_GATHER4
     * This texCoord has been offset by (-0.25, -0.125) in the vertex shader to
     * sample between edge, thus fetching four edges in a row.
     * Sampling with different offsets in each direction allows to disambiguate
     * which edges are active from the four fetched ones.
     */
    vec2 e = vec2(0.0, 1.0);

    for (int i = 0; i < dMaxSearchSteps; i++) { // WebGL port note: Changed while to for
        e = texture2D( edgesTex, texCoord, 0.0).rg;
        texCoord -= vec2(2.0, 0.0) * uTexSizeInv;
        if (!(texCoord.x > end && e.g > 0.8281 && e.r == 0.0)) break;
    }

    // We correct the previous (-0.25, -0.125) offset we applied:
    texCoord.x += 0.25 * uTexSizeInv.x;

    // The searches are bias by 1, so adjust the coords accordingly:
    texCoord.x += uTexSizeInv.x;

    // Disambiguate the length added by the last step:
    texCoord.x += 2.0 * uTexSizeInv.x; // Undo last step
    texCoord.x -= uTexSizeInv.x * SMAASearchLength(searchTex, e, 0.0, 0.5);

    return texCoord.x;
}

float SMAASearchXRight(sampler2D edgesTex, sampler2D searchTex, vec2 texCoord, float end) {
    vec2 e = vec2( 0.0, 1.0 );

    for (int i = 0; i < dMaxSearchSteps; i++) { // WebGL port note: Changed while to for
        e = texture2D(edgesTex, texCoord, 0.0).rg;
        texCoord += vec2(2.0, 0.0) * uTexSizeInv;
        if (!(texCoord.x < end && e.g > 0.8281 && e.r == 0.0)) break;
    }

    texCoord.x -= 0.25 * uTexSizeInv.x;
    texCoord.x -= uTexSizeInv.x;
    texCoord.x -= 2.0 * uTexSizeInv.x;
    texCoord.x += uTexSizeInv.x * SMAASearchLength( searchTex, e, 0.5, 0.5 );

    return texCoord.x;
}

float SMAASearchYUp(sampler2D edgesTex, sampler2D searchTex, vec2 texCoord, float end) {
    vec2 e = vec2( 1.0, 0.0 );

    for (int i = 0; i < dMaxSearchSteps; i++) { // WebGL port note: Changed while to for
        e = texture2D(edgesTex, texCoord, 0.0).rg;
        texCoord += vec2(0.0, 2.0) * uTexSizeInv; // WebGL port note: Changed sign
        if (!(texCoord.y > end && e.r > 0.8281 && e.g == 0.0)) break;
    }

    texCoord.y -= 0.25 * uTexSizeInv.y; // WebGL port note: Changed sign
    texCoord.y -= uTexSizeInv.y; // WebGL port note: Changed sign
    texCoord.y -= 2.0 * uTexSizeInv.y; // WebGL port note: Changed sign
    texCoord.y += uTexSizeInv.y * SMAASearchLength(searchTex, e.gr, 0.0, 0.5); // WebGL port note: Changed sign

    return texCoord.y;
}

float SMAASearchYDown(sampler2D edgesTex, sampler2D searchTex, vec2 texCoord, float end) {
    vec2 e = vec2( 1.0, 0.0 );

    for (int i = 0; i < dMaxSearchSteps; i++) { // WebGL port note: Changed while to for
        e = texture2D(edgesTex, texCoord, 0.0).rg;
        texCoord -= vec2( 0.0, 2.0 ) * uTexSizeInv; // WebGL port note: Changed sign
        if (!(texCoord.y < end && e.r > 0.8281 && e.g == 0.0)) break;
    }

    texCoord.y += 0.25 * uTexSizeInv.y; // WebGL port note: Changed sign
    texCoord.y += uTexSizeInv.y; // WebGL port note: Changed sign
    texCoord.y += 2.0 * uTexSizeInv.y; // WebGL port note: Changed sign
    texCoord.y -= uTexSizeInv.y * SMAASearchLength(searchTex, e.gr, 0.5, 0.5); // WebGL port note: Changed sign

    return texCoord.y;
}

vec2 SMAAArea(sampler2D areaTex, vec2 dist, float e1, float e2, float offset) {
    // Rounding prevents precision errors of bilinear filtering:
    vec2 texCoord = float(SMAA_AREATEX_MAX_DISTANCE) * round(4.0 * vec2(e1, e2)) + dist;

    // We do a scale and bias for mapping to texel space:
    texCoord = SMAA_AREATEX_PIXEL_SIZE * texCoord + (0.5 * SMAA_AREATEX_PIXEL_SIZE);

    // Move to proper place, according to the subpixel offset:
    texCoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;

    return texture2D(areaTex, texCoord, 0.0).rg;
}

vec4 SMAABlendingWeightCalculationPS(vec2 texCoord, vec2 pixCoord, vec4 offset[3], sampler2D edgesTex, sampler2D areaTex, sampler2D searchTex, ivec4 subsampleIndices) {
    vec4 weights = vec4(0.0, 0.0, 0.0, 0.0);

    vec2 e = texture2D(edgesTex, texCoord).rg;

    if (e.g > 0.0) { // Edge at north
        vec2 d;

        // Find the distance to the left:
        vec2 coords;
        coords.x = SMAASearchXLeft(edgesTex, searchTex, offset[0].xy, offset[2].x );
        coords.y = offset[1].y; // offset[1].y = texCoord.y - 0.25 * uTexSizeInv.y (@CROSSING_OFFSET)
        d.x = coords.x;

        // Now fetch the left crossing edges, two at a time using bilinear
        // filtering. Sampling at -0.25 (see @CROSSING_OFFSET) enables to
        // discern what value each edge has:
        float e1 = texture2D(edgesTex, coords, 0.0).r;

        // Find the distance to the right:
        coords.x = SMAASearchXRight(edgesTex, searchTex, offset[0].zw, offset[2].y);
        d.y = coords.x;

        // We want the distances to be in pixel units (doing this here allow to
        // better interleave arithmetic and memory accesses):
        d = d / uTexSizeInv.x - pixCoord.x;

        // SMAAArea below needs a sqrt, as the areas texture is compressed
        // quadratically:
        vec2 sqrt_d = sqrt(abs(d));

        // Fetch the right crossing edges:
        coords.y -= 1.0 * uTexSizeInv.y; // WebGL port note: Added
        float e2 = SMAASampleLevelZeroOffset(edgesTex, coords, ivec2(1, 0)).r;

        // Ok, we know how this pattern looks like, now it is time for getting
        // the actual area:
        weights.rg = SMAAArea(areaTex, sqrt_d, e1, e2, float(subsampleIndices.y));
    }

    if (e.r > 0.0) { // Edge at west
        vec2 d;

        // Find the distance to the top:
        vec2 coords;

        coords.y = SMAASearchYUp(edgesTex, searchTex, offset[1].xy, offset[2].z );
        coords.x = offset[0].x; // offset[1].x = texCoord.x - 0.25 * uTexSizeInv.x;
        d.x = coords.y;

        // Fetch the top crossing edges:
        float e1 = texture2D(edgesTex, coords, 0.0).g;

        // Find the distance to the bottom:
        coords.y = SMAASearchYDown(edgesTex, searchTex, offset[1].zw, offset[2].w);
        d.y = coords.y;

        // We want the distances to be in pixel units:
        d = d / uTexSizeInv.y - pixCoord.y;

        // SMAAArea below needs a sqrt, as the areas texture is compressed
        // quadratically:
        vec2 sqrt_d = sqrt(abs(d));

        // Fetch the bottom crossing edges:
        coords.y -= 1.0 * uTexSizeInv.y; // WebGL port note: Added
        float e2 = SMAASampleLevelZeroOffset(edgesTex, coords, ivec2(0, 1)).g;

        // Get the area for this direction:
        weights.ba = SMAAArea(areaTex, sqrt_d, e1, e2, float(subsampleIndices.x));
    }

    return weights;
}

void main() {
    gl_FragColor = SMAABlendingWeightCalculationPS(vUv, vPixCoord, vOffset, tEdges, tArea, tSearch, ivec4(0.0));
}
`;var SIe=`
precision highp float;

attribute vec2 aPosition;
uniform vec2 uQuadScale;

uniform vec2 uTexSizeInv;
uniform vec4 uViewport;

varying vec2 vUv;
varying vec4 vOffset[3];

void SMAAEdgeDetectionVS(vec2 texCoord) {
    vOffset[0] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(-1.0, 0.0, 0.0, 1.0); // WebGL port note: Changed sign in W component
    vOffset[1] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(1.0, 0.0, 0.0, -1.0); // WebGL port note: Changed sign in W component
    vOffset[2] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(-2.0, 0.0, 0.0, 2.0); // WebGL port note: Changed sign in W component
}

void main() {
    vec2 scale = uViewport.zw * uTexSizeInv;
    vec2 shift = uViewport.xy * uTexSizeInv;
    vUv = (aPosition + 1.0) * 0.5 * scale + shift;
    SMAAEdgeDetectionVS(vUv);
    vec2 position = aPosition * uQuadScale - vec2(1.0, 1.0) + uQuadScale;
    gl_Position = vec4(position, 0.0, 1.0);
}
`;var vIe=`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tColor;
uniform vec2 uTexSizeInv;

varying vec2 vUv;
varying vec4 vOffset[3];

vec4 SMAAColorEdgeDetectionPS(vec2 texcoord, vec4 offset[3], sampler2D colorTex) {
    vec2 threshold = vec2(dEdgeThreshold, dEdgeThreshold);

    // Calculate color deltas:
    vec4 delta;
    vec3 C = texture2D(colorTex, texcoord).rgb;

    vec3 Cleft = texture2D(colorTex, offset[0].xy).rgb;
    vec3 t = abs(C - Cleft);
    delta.x = max(max(t.r, t.g), t.b);

    vec3 Ctop = texture2D(colorTex, offset[0].zw).rgb;
    t = abs(C - Ctop);
    delta.y = max(max(t.r, t.g), t.b);

    // We do the usual threshold:
    vec2 edges = step(threshold, delta.xy);

    // Then discard if there is no edge:
    if (dot(edges, vec2(1.0, 1.0 )) == 0.0)
        discard;

    // Calculate right and bottom deltas:
    vec3 Cright = texture2D(colorTex, offset[1].xy).rgb;
    t = abs( C - Cright );
    delta.z = max(max(t.r, t.g), t.b);

    vec3 Cbottom  = texture2D(colorTex, offset[1].zw).rgb;
    t = abs(C - Cbottom);
    delta.w = max(max(t.r, t.g), t.b);

    // Calculate the maximum delta in the direct neighborhood:
    float maxDelta = max(max(max(delta.x, delta.y), delta.z), delta.w );

    // Calculate left-left and top-top deltas:
    vec3 Cleftleft  = texture2D(colorTex, offset[2].xy).rgb;
    t = abs( C - Cleftleft );
    delta.z = max(max(t.r, t.g), t.b);

    vec3 Ctoptop = texture2D(colorTex, offset[2].zw).rgb;
    t = abs(C - Ctoptop);
    delta.w = max(max(t.r, t.g), t.b);

    // Calculate the final maximum delta:
    maxDelta = max(max(maxDelta, delta.z), delta.w);

    // Local contrast adaptation in action:
    edges.xy *= step(0.5 * maxDelta, delta.xy);

    return vec4(edges, 0.0, 0.0);
}

void main() {
    gl_FragColor = SMAAColorEdgeDetectionPS(vUv, vOffset, tColor);
}
`;var IIe={edgeThreshold:C.Numeric(.1,{min:.05,max:.15,step:.01}),maxSearchSteps:C.Numeric(16,{min:0,max:32,step:1})},RL=class{constructor(t,r){this.webgl=t;this._supported=!1;if(typeof HTMLImageElement>"u"){Yt&&console.log('Missing "HTMLImageElement" required for "SMAA"');return}let n=r.getWidth(),o=r.getHeight();this.edgesTarget=t.createRenderTarget(n,o,!1,"uint8","linear"),this.weightsTarget=t.createRenderTarget(n,o,!1,"uint8","linear"),this.edgesRenderable=lit(t,r),this.weightsRenderable=mit(t,this.edgesTarget.texture),this.blendRenderable=fit(t,r,this.weightsTarget.texture),this._supported=!0}get supported(){return this._supported}getByteCount(){return this.supported?this.edgesTarget.getByteCount()+this.weightsTarget.getByteCount():0}updateState(t){let{gl:r,state:n}=this.webgl;n.enable(r.SCISSOR_TEST),n.disable(r.BLEND),n.disable(r.DEPTH_TEST),n.depthMask(!1);let{x:o,y:i,width:a,height:s}=t;n.viewport(o,i,a,s),n.scissor(o,i,a,s),n.colorMask(!0,!0,!0,!0),n.clearColor(0,0,0,1),r.clear(r.COLOR_BUFFER_BIT),_.update(this.edgesRenderable.values.uViewport,lo.toVec4(this.edgesRenderable.values.uViewport.ref.value,t)),_.update(this.weightsRenderable.values.uViewport,lo.toVec4(this.weightsRenderable.values.uViewport.ref.value,t)),_.update(this.blendRenderable.values.uViewport,lo.toVec4(this.blendRenderable.values.uViewport.ref.value,t))}setSize(t,r){let n=this.edgesTarget.getWidth(),o=this.edgesTarget.getHeight();(t!==n||r!==o)&&(this.edgesTarget.setSize(t,r),this.weightsTarget.setSize(t,r),_.update(this.edgesRenderable.values.uTexSizeInv,Ce.set(this.edgesRenderable.values.uTexSizeInv.ref.value,1/t,1/r)),_.update(this.weightsRenderable.values.uTexSizeInv,Ce.set(this.weightsRenderable.values.uTexSizeInv.ref.value,1/t,1/r)),_.update(this.blendRenderable.values.uTexSizeInv,Ce.set(this.blendRenderable.values.uTexSizeInv.ref.value,1/t,1/r)))}update(t,r){let n=!1;this.edgesRenderable.values.tColor.ref.value!==t&&(_.update(this.edgesRenderable.values.tColor,t),n=!0),this.edgesRenderable.values.dEdgeThreshold.ref.value!==r.edgeThreshold&&(_.update(this.edgesRenderable.values.dEdgeThreshold,r.edgeThreshold),n=!0),n&&this.edgesRenderable.update(),this.weightsRenderable.values.dMaxSearchSteps.ref.value!==r.maxSearchSteps&&(_.update(this.weightsRenderable.values.dMaxSearchSteps,r.maxSearchSteps),this.weightsRenderable.update()),this.blendRenderable.values.tColor.ref.value!==t&&(_.update(this.blendRenderable.values.tColor,t),this.blendRenderable.update())}render(t,r){je&&this.webgl.timer.mark("SmaaPass.render"),this.edgesTarget.bind(),this.updateState(t),this.edgesRenderable.render(),this.weightsTarget.bind(),this.updateState(t),this.weightsRenderable.render(),r?r.bind():this.webgl.bindDrawingBuffer(),this.updateState(t),this.blendRenderable.render(),je&&this.webgl.timer.markEnd("SmaaPass.render")}},ait={...Sn,tColor:yt("texture","rgba","ubyte","linear"),uTexSizeInv:de("v2"),uViewport:de("v4"),dEdgeThreshold:dt("number")},sit=zr("smaa-edges",SIe,vIe);function lit(e,t){let r=t.getWidth(),n=t.getHeight(),o={...vn,tColor:_.create(t),uTexSizeInv:_.create(Ce.create(1/r,1/n)),uViewport:_.create(Et()),dEdgeThreshold:_.create(.1)},i={...ait},a=on(e,"triangles",sit,i,o);return an(a,o)}var uit={...Sn,tEdges:yt("texture","rgba","ubyte","linear"),tArea:yt("texture","rgb","ubyte","linear"),tSearch:yt("texture","rgba","ubyte","nearest"),uTexSizeInv:de("v2"),uViewport:de("v4"),dMaxSearchSteps:dt("number")},cit=zr("smaa-weights",xIe,CIe);function mit(e,t){let r=t.getWidth(),n=t.getHeight(),o=e.resources.texture("image-uint8","rgb","ubyte","linear"),i=e.resources.texture("image-uint8","rgba","ubyte","nearest"),a={...vn,tEdges:_.create(t),tArea:_.create(o),tSearch:_.create(i),uTexSizeInv:_.create(Ce.create(1/r,1/n)),uViewport:_.create(Et()),dMaxSearchSteps:_.create(16)};x7(hit(),a.tArea,o),x7(git(),a.tSearch,i);let s={...uit},l=on(e,"triangles",cit,s,a);return an(l,a)}var dit={...Sn,tColor:yt("texture","rgba","ubyte","linear"),tWeights:yt("texture","rgba","ubyte","linear"),uTexSizeInv:de("v2"),uViewport:de("v4")},pit=zr("smaa-blend",yIe,bIe);function fit(e,t,r){let n=t.getWidth(),o=t.getHeight(),i={...vn,tColor:_.create(t),tWeights:_.create(r),uTexSizeInv:_.create(Ce.create(1/n,1/o)),uViewport:_.create(Et())},a={...dit},s=on(e,"triangles",pit,a,i);return an(s,i)}function hit(){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKAAAAIwCAIAAACOVPcQAACBeklEQVR42u39W4xlWXrnh/3WWvuciIzMrKxrV8/0rWbY0+SQFKcb4owIkSIFCjY9AC1BT/LYBozRi+EX+cV+8IMsYAaCwRcBwjzMiw2jAWtgwC8WR5Q8mDFHZLNHTarZGrLJJllt1W2qKrsumZWZcTvn7L3W54e1vrXX3vuciLPPORFR1XE2EomorB0nVuz//r71re/y/1eMvb4Cb3N11xV/PP/2v4UBAwJG/7H8urx6/25/Gf8O5hypMQ0EEEQwAqLfoN/Z+97f/SW+/NvcgQk4sGBJK6H7N4PFVL+K+e0N11yNfkKvwUdwdlUAXPHHL38oa15f/i/46Ih6SuMSPmLAYAwyRKn7dfMGH97jaMFBYCJUgotIC2YAdu+LyW9vvubxAP8kAL8H/koAuOKP3+q6+xGnd5kdYCeECnGIJViwGJMAkQKfDvB3WZxjLKGh8VSCCzhwEWBpMc5/kBbjawT4HnwJfhr+pPBIu7uu+OOTo9vsmtQcniMBGkKFd4jDWMSCRUpLjJYNJkM+IRzQ+PQvIeAMTrBS2LEiaiR9b/5PuT6Ap/AcfAFO4Y3dA3DFH7/VS+M8k4baEAQfMI4QfbVDDGIRg7GKaIY52qAjTAgTvGBAPGIIghOCYAUrGFNgzA7Q3QhgCwfwAnwe5vDejgG44o/fbm1C5ZlYQvQDARPAIQGxCWBM+wWl37ZQESb4gImexGMDouhGLx1Cst0Saa4b4AqO4Hk4gxo+3DHAV/nx27p3JziPM2pVgoiia5MdEzCGULprIN7gEEeQ5IQxEBBBQnxhsDb5auGmAAYcHMA9eAAz8PBol8/xij9+C4Djlim4gJjWcwZBhCBgMIIYxGAVIkH3ZtcBuLdtRFMWsPGoY9rN+HoBji9VBYdwD2ZQg4cnO7OSq/z4rU5KKdwVbFAjNojCQzTlCLPFSxtamwh2jMUcEgg2Wm/6XgErIBhBckQtGN3CzbVacERgCnfgLswhnvqf7QyAq/z4rRZm1YglYE3affGITaZsdIe2FmMIpnOCap25I6jt2kCwCW0D1uAD9sZctNGXcQIHCkINDQgc78aCr+zjtw3BU/ijdpw3zhCwcaONwBvdeS2YZKkJNJsMPf2JKEvC28RXxxI0ASJyzQCjCEQrO4Q7sFArEzjZhaFc4cdv+/JFdKULM4px0DfUBI2hIsy06BqLhGTQEVdbfAIZXYMPesq6VoCHICzUyjwInO4Y411//LYLs6TDa9wvg2CC2rElgAnpTBziThxaL22MYhzfkghz6GAs2VHbbdM91VZu1MEEpupMMwKyVTb5ij9+u4VJG/5EgEMMmFF01cFai3isRbKbzb+YaU/MQbAm2XSMoUPAmvZzbuKYRIFApbtlrfFuUGd6vq2hXNnH78ZLh/iFhsQG3T4D1ib7k5CC6vY0DCbtrohgLEIClXiGtl10zc0CnEGIhhatLBva7NP58Tvw0qE8yWhARLQ8h4+AhQSP+I4F5xoU+VilGRJs6wnS7ruti/4KvAY/CfdgqjsMy4pf8fodQO8/gnuX3f/3xi3om1/h7THr+co3x93PP9+FBUfbNUjcjEmhcrkT+8K7ml7V10Jo05mpIEFy1NmCJWx9SIKKt+EjAL4Ez8EBVOB6havuT/rByPvHXK+9zUcfcbb254+9fydJknYnRr1oGfdaiAgpxu1Rx/Rek8KISftx3L+DfsLWAANn8Hvw0/AFeAGO9DFV3c6D+CcWbL8Dj9e7f+T1k8AZv/d7+PXWM/Z+VvdCrIvuAKO09RpEEQJM0Ci6+B4xhTWr4cZNOvhktabw0ta0rSJmqz3Yw5/AKXwenod7cAhTmBSPKf6JBdvH8IP17h95pXqw50/+BFnj88fev4NchyaK47OPhhtI8RFSvAfDSNh0Ck0p2gLxGkib5NJj/JWCr90EWQJvwBzO4AHcgztwAFN1evHPUVGwfXON+0debT1YeGON9Yy9/63X+OguiwmhIhQhD7l4sMqlG3D86Suc3qWZ4rWjI1X7u0Ytw6x3rIMeIOPDprfe2XzNgyj6PahhBjO4C3e6puDgXrdg+/5l948vF3bqwZetZ+z9Rx9zdIY5pInPK4Nk0t+l52xdK2B45Qd87nM8fsD5EfUhIcJcERw4RdqqH7Yde5V7m1vhNmtedkz6EDzUMF/2jJYWbC+4fzzA/Y+/8PPH3j9dcBAPIRP8JLXd5BpAu03aziOL3VVHZzz3CXWDPWd+SH2AnxIqQoTZpo9Ckc6HIrFbAbzNmlcg8Ag8NFDDAhbJvTBZXbC94P7t68EXfv6o+21gUtPETU7bbkLxvNKRFG2+KXzvtObonPP4rBvsgmaKj404DlshFole1Glfh02fE7bYR7dZ82oTewIBGn1Md6CG6YUF26X376oevOLzx95vhUmgblI6LBZwTCDY7vMq0op5WVXgsObOXJ+1x3qaBl9j1FeLxbhU9w1F+Wiba6s1X/TBz1LnUfuYDi4r2C69f1f14BWfP+p+W2GFKuC9phcELMYRRLur9DEZTUdEH+iEqWdaM7X4WOoPGI+ZYD2+wcQ+y+ioHUZ9dTDbArzxmi/bJI9BND0Ynd6lBdve/butBw8+f/T9D3ABa3AG8W3VPX4hBin+bj8dMMmSpp5pg7fJ6xrBFE2WQQEWnV8Qg3FbAWzYfM1rREEnmvkN2o1+acG2d/9u68GDzx91v3mAjb1zkpqT21OipPKO0b9TO5W0nTdOmAQm0TObts3aBKgwARtoPDiCT0gHgwnbArzxmtcLc08HgF1asN0C4Ms/fvD5I+7PhfqyXE/b7RbbrGyRQRT9ARZcwAUmgdoz0ehJ9Fn7QAhUjhDAQSw0bV3T3WbNa59jzmiP6GsWbGXDX2ytjy8+f9T97fiBPq9YeLdBmyuizZHaqXITnXiMUEEVcJ7K4j3BFPurtB4bixW8wTpweL8DC95szWMOqucFYGsWbGU7p3TxxxefP+r+oTVktxY0v5hbq3KiOKYnY8ddJVSBxuMMVffNbxwIOERShst73HZ78DZrHpmJmH3K6sGz0fe3UUj0eyRrSCGTTc+rjVNoGzNSv05srAxUBh8IhqChiQgVNIIBH3AVPnrsnXQZbLTm8ammv8eVXn/vWpaTem5IXRlt+U/LA21zhSb9cye6jcOfCnOwhIAYXAMVTUNV0QhVha9xjgA27ODJbLbmitt3tRN80lqG6N/khgot4ZVlOyO4WNg3OIMzhIZQpUEHieg2im6F91hB3I2tubql6BYNN9Hj5S7G0G2tahslBWKDnOiIvuAEDzakDQKDNFQT6gbn8E2y4BBubM230YIpBnDbMa+y3dx0n1S0BtuG62lCCXwcY0F72T1VRR3t2ONcsmDjbmzNt9RFs2LO2hQNyb022JisaI8rAWuw4HI3FuAIhZdOGIcdjLJvvObqlpqvWTJnnQbyi/1M9O8UxWhBs//H42I0q1Yb/XPGONzcmm+ri172mHKvZBpHkJaNJz6v9jxqiklDj3U4CA2ugpAaYMWqNXsdXbmJNd9egCnJEsphXNM+MnK3m0FCJ5S1kmJpa3DgPVbnQnPGWIDspW9ozbcO4K/9LkfaQO2KHuqlfFXSbdNzcEcwoqNEFE9zcIXu9/6n/ym/BC/C3aJLzEKPuYVlbFnfhZ8kcWxV3dbv4bKl28566wD+8C53aw49lTABp9PWbsB+knfc/Li3eVizf5vv/xmvnPKg5ihwKEwlrcHqucuVcVOxEv8aH37E3ZqpZypUulrHEtIWKUr+txHg+ojZDGlwnqmkGlzcVi1dLiNSJiHjfbRNOPwKpx9TVdTn3K05DBx4psIk4Ei8aCkJahRgffk4YnEXe07T4H2RR1u27E6wfQsBDofUgjFUFnwC2AiVtA+05J2zpiDK2Oa0c5fmAecN1iJzmpqFZxqYBCYhFTCsUNEmUnIcZ6aEA5rQVhEywG6w7HSW02XfOoBlQmjwulOFQAg66SvJblrTEX1YtJ3uG15T/BH1OfOQeuR8g/c0gdpT5fx2SKbs9EfHTKdM8A1GaJRHLVIwhcGyydZsbifAFVKl5EMKNU2Hryo+06BeTgqnxzYjThVySDikbtJPieco75lYfKAJOMEZBTjoITuWHXXZVhcUDIS2hpiXHV9Ku4u44bN5OYLDOkJo8w+xJSMbhBRHEdEs9JZUCkQrPMAvaHyLkxgkEHxiNkx/x2YB0mGsQ8EUWj/stW5YLhtS5SMu+/YBbNPDCkGTUybN8krRLBGPlZkVOA0j+a1+rkyQKWGaPHPLZOkJhioQYnVZ2hS3zVxMtgC46KuRwbJNd9nV2PHgb36F194ecf/Yeu2vAFe5nm/bRBFrnY4BauE8ERmZRFUn0k8hbftiVYSKMEme2dJCJSCGYAlNqh87bXOPdUkGy24P6d1ll21MBqqx48Fvv8ZHH8HZFY7j/uAq1xMJUFqCSUlJPmNbIiNsmwuMs/q9CMtsZsFO6SprzCS1Z7QL8xCQClEelpjTduDMsmWD8S1PT152BtvmIGvUeDA/yRn83u/x0/4qxoPHjx+PXY9pqX9bgMvh/Nz9kpP4pOe1/fYf3axUiMdHLlPpZCNjgtNFAhcHEDxTumNONhHrBduW+vOyY++70WWnPXj98eA4kOt/mj/5E05l9+O4o8ePx67HFqyC+qSSnyselqjZGaVK2TadbFLPWAQ4NBhHqDCCV7OTpo34AlSSylPtIdd2AJZlyzYQrDJ5lcWGNceD80CunPLGGzsfD+7wRb95NevJI5docQ3tgCyr5bGnyaPRlmwNsFELViOOx9loebGNq2moDOKpHLVP5al2cymWHbkfzGXL7kfRl44H9wZy33tvt+PB/Xnf93e+nh5ZlU18wCiRUa9m7kib9LYuOk+hudQNbxwm0AQqbfloimaB2lM5fChex+ylMwuTbfmXQtmWlenZljbdXTLuOxjI/fDDHY4Hjx8/Hrse0zXfPFxbUN1kKqSCCSk50m0Ajtx3ub9XHBKHXESb8iO6E+qGytF4nO0OG3SXzbJlhxBnKtKyl0NwybjvYCD30aMdjgePHz8eu56SVTBbgxJMliQ3Oauwg0QHxXE2Ez/EIReLdQj42Gzb4CLS0YJD9xUx7bsi0vJi5mUbW1QzL0h0PFk17rtiIPfJk52MB48fPx67npJJwyrBa2RCCQRTbGZSPCxTPOiND4G2pYyOQ4h4jINIJh5wFU1NFZt+IsZ59LSnDqBjZ2awbOku+yInunLcd8VA7rNnOxkPHj9+PGY9B0MWJJNozOJmlglvDMXDEozdhQWbgs/U6oBanGzLrdSNNnZFjOkmbi5bNt1lX7JLLhn3vXAg9/h4y/Hg8ePHI9dzQMEkWCgdRfYykYKnkP7D4rIujsujaKPBsB54vE2TS00ccvFY/Tth7JXeq1hz+qgVy04sAJawTsvOknHfCwdyT062HA8eP348Zj0vdoXF4pilKa2BROed+9fyw9rWRXeTFXESMOanvDZfJuJaSXouQdMdDJZtekZcLLvEeK04d8m474UDuaenW44Hjx8/Xns9YYqZpszGWB3AN/4VHw+k7WSFtJ3Qicuqb/NlVmgXWsxh570xg2UwxUw3WfO6B5nOuO8aA7lnZxuPB48fPx6znm1i4bsfcbaptF3zNT78eFPtwi1OaCNOqp1x3zUGcs/PN++AGD1+fMXrSVm2baTtPhPahbPhA71wIHd2bXzRa69nG+3CraTtPivahV/55tXWg8fyRY/9AdsY8VbSdp8V7cKrrgdfM//z6ILQFtJ2nxHtwmuoB4/kf74+gLeRtvvMaBdeSz34+vifx0YG20jbfTa0C6+tHrwe//NmOG0L8EbSdp8R7cLrrQe/996O+ai3ujQOskpTNULa7jOjXXj99eCd8lHvoFiwsbTdZ0a78PrrwTvlo966pLuRtB2fFe3Cm6oHP9kNH/W2FryxtN1nTLvwRurBO+Kj3pWXHidtx2dFu/Bm68Fb81HvykuPlrb7LGkX3mw9eGs+6h1Y8MbSdjegXcguQLjmevDpTQLMxtJ2N6NdyBZu9AbrwVvwUW+LbteULUpCdqm0HTelXbhNPe8G68Gb8lFvVfYfSNuxvrTdTWoXbozAzdaDZzfkorOj1oxVxlIMlpSIlpLrt8D4hrQL17z+c3h6hU/wv4Q/utps4+bm+6P/hIcf0JwQ5oQGPBL0eKPTYEXTW+eL/2DKn73J9BTXYANG57hz1cEMviVf/4tf5b/6C5pTQkMIWoAq7hTpOJjtAM4pxKu5vg5vXeUrtI09/Mo/5H+4z+Mp5xULh7cEm2QbRP2tFIKR7WM3fPf/jZ3SWCqLM2l4NxID5zB72HQXv3jj/8mLR5xXNA5v8EbFQEz7PpRfl1+MB/hlAN65qgDn3wTgH13hK7T59bmP+NIx1SHHU84nLOITt3iVz8mNO+lPrjGAnBFqmioNn1mTyk1ta47R6d4MrX7tjrnjYUpdUbv2rVr6YpVfsGG58AG8Ah9eyUN8CX4WfgV+G8LVWPDGb+Zd4cU584CtqSbMKxauxTg+dyn/LkVgA+IR8KHtejeFKRtTmLLpxN6mYVLjYxwXf5x2VofiZcp/lwKk4wGOpYDnoIZPdg/AAbwMfx0+ge9dgZvYjuqKe4HnGnykYo5TvJbG0Vj12JagRhwKa44H95ShkZa5RyLGGdfYvG7aw1TsF6iapPAS29mNS3NmsTQZCmgTzFwgL3upCTgtBTRwvGMAKrgLn4evwin8+afJRcff+8izUGUM63GOOuAs3tJkw7J4kyoNreqrpO6cYLQeFUd7TTpr5YOTLc9RUUogUOVJQ1GYJaFLAW0oTmKyYS46ZooP4S4EON3xQ5zC8/CX4CnM4c1PE8ApexpoYuzqlP3d4S3OJP8ZDK7cKWNaTlqmgDiiHwl1YsE41w1zT4iRTm3DBqxvOUsbMKKDa/EHxagtnta072ejc3DOIh5ojvh8l3tk1JF/AV6FU6jh3U8HwEazLgdCLYSQ+MYiAI2ltomkzttUb0gGHdSUUgsIYjTzLG3mObX4FBRaYtpDVNZrih9TgTeYOBxsEnN1gOCTM8Bsw/ieMc75w9kuAT6A+/AiHGvN/+Gn4KRkiuzpNNDYhDGFndWRpE6SVfm8U5bxnSgVV2jrg6JCKmneqey8VMFgq2+AM/i4L4RUbfSi27lNXZ7R7W9RTcq/q9fk4Xw3AMQd4I5ifAZz8FcVtm9SAom/dyN4lczJQW/kC42ZrHgcCoIf1oVMKkVItmMBi9cOeNHGLqOZk+QqQmrbc5YmYgxELUUN35z2iohstgfLIFmcMV7s4CFmI74L9+EFmGsi+tGnAOD4Yk9gIpo01Y4cA43BWGygMdr4YZekG3OBIUXXNukvJS8tqa06e+lSDCtnqqMFu6hWHXCF+WaYt64m9QBmNxi7Ioy7D+fa1yHw+FMAcPt7SysFLtoG4PXAk7JOA3aAxBRqUiAdU9Yp5lK3HLSRFtOim0sa8euEt08xvKjYjzeJ2GU7YawexrnKI9tmobInjFXCewpwriY9+RR4aaezFhMhGCppKwom0ChrgFlKzyPKkGlTW1YQrE9HJqu8hKGgMc6hVi5QRq0PZxNfrYNgE64utmRv6KKHRpxf6VDUaOvNP5jCEx5q185My/7RKz69UQu2im5k4/eownpxZxNLwiZ1AZTO2ZjWjkU9uaB2HFn6Q3u0JcsSx/qV9hTEApRzeBLDJQXxYmTnq7bdLa3+uqFrxLJ5w1TehnNHx5ECvCh2g2c3hHH5YsfdaSKddztfjQ6imKFGSyFwlLzxEGPp6r5IevVjk1AMx3wMqi1NxDVjLBiPs9tbsCkIY5we5/ML22zrCScFxnNtzsr9Wcc3CnD+pYO+4VXXiDE0oc/vQQ/fDK3oPESJMYXNmJa/DuloJZkcTpcYE8lIH8Dz8DJMiynNC86Mb2lNaaqP/+L7f2fcE/yP7/Lde8xfgSOdMxvOixZf/9p3+M4hT1+F+zApxg9XfUvYjc8qX2lfOOpK2gNRtB4flpFu9FTKCp2XJRgXnX6olp1zyYjTKJSkGmLE2NjUr1bxFM4AeAAHBUFIeSLqXR+NvH/M9fOnfHzOD2vCSyQJKzfgsCh+yi/Mmc35F2fUrw7miW33W9hBD1vpuUojFphIyvg7aTeoymDkIkeW3XLHmguMzbIAJejN6B5MDrhipE2y6SoFRO/AK/AcHHZHNIfiWrEe/C6cr3f/yOvrQKB+zMM55/GQdLDsR+ifr5Fiuu+/y+M78LzOE5dsNuXC3PYvYWd8NXvphLSkJIasrlD2/HOqQ+RjcRdjKTGWYhhVUm4yxlyiGPuMsZR7sMCHUBeTuNWA7if+ifXgc/hovftHXs/DV+Fvwe+f8shzMiMcweFgBly3//vwJfg5AN4450fn1Hd1Rm1aBLu22Dy3y3H2+OqMemkbGZ4jozcDjJf6596xOLpC0eMTHbKnxLxH27uZ/bMTGs2jOaMOY4m87CfQwF0dw53oa1k80JRuz/XgS+8fX3N9Af4qPIMfzKgCp4H5TDGe9GGeFPzSsZz80SlPTxXjgwJmC45njzgt2vbQ4b4OAdUK4/vWhO8d8v6EE8fMUsfakXbPpFJeLs2ubM/qdm/la3WP91uWhxXHjoWhyRUq2iJ/+5mA73zwIIo+LoZ/SgvIRjAd1IMvvn98PfgOvAJfhhm8scAKVWDuaRaK8aQ9f7vuPDH6Bj47ZXau7rqYJ66mTDwEDU6lLbCjCK0qTXyl5mnDoeNRxanj3FJbaksTk0faXxHxLrssgPkWB9LnA/MFleXcJozzjwsUvUG0X/QCve51qkMDXp9mtcyOy3rwBfdvVJK7D6/ACSzg3RoruIq5UDeESfEmVclDxnniU82vxMLtceD0hGZWzBNPMM/jSPne2OVatiTKUpY5vY7gc0LdUAWeWM5tH+O2I66AOWw9xT2BuyRVLGdoDHUsVRXOo/c+ZdRXvFfnxWyIV4upFLCl9eAL7h8Zv0QH8Ry8pA2cHzQpGesctVA37ZtklBTgHjyvdSeKY/RZw/kJMk0Y25cSNRWSigQtlULPTw+kzuJPeYEkXjQRpoGZobYsLF79pyd1dMRHInbgFTZqNLhDqiIsTNpoex2WLcy0/X6rHcdMMQvFSd5dWA++4P7xv89deACnmr36uGlL69bRCL6BSZsS6c0TU2TKK5gtWCzgAOOwQcurqk9j8whvziZSMLcq5hbuwBEsYjopUBkqw1yYBGpLA97SRElEmx5MCInBY5vgLk94iKqSWmhIGmkJ4Bi9m4L645J68LyY4wsFYBfUg5feP/6gWWm58IEmKQM89hq7KsZNaKtP5TxxrUZZVkNmMJtjbKrGxLNEbHPJxhqy7lAmbC32ZqeF6lTaknRWcYaFpfLUBh/rwaQycCCJmW15Kstv6jRHyJFry2C1ahkkIW0LO75s61+owxK1y3XqweX9m5YLM2DPFeOjn/iiqCKJ+yKXF8t5Yl/kNsqaSCryxPq5xWTFIaP8KSW0RYxqupaUf0RcTNSSdJZGcKYdYA6kdtrtmyBckfKXwqk0pHpUHlwWaffjNRBYFPUDWa8e3Lt/o0R0CdisKDM89cX0pvRHEfM8ca4t0s2Xx4kgo91MPQJ/0c9MQYq0co8MBh7bz1fio0UUHLR4aAIOvOmoYO6kwlEVODSSTliWtOtH6sPkrtctF9ZtJ9GIerBskvhdVS5cFNv9s1BU0AbdUgdK4FG+dRnjFmDTzniRMdZO1QhzMK355vigbdkpz9P6qjUGE5J2qAcXmwJ20cZUiAD0z+pGMx6xkzJkmEf40Hr4qZfVg2XzF9YOyoV5BjzVkUJngKf8lgNYwKECEHrCNDrWZzMlflS3yBhr/InyoUgBc/lKT4pxVrrC6g1YwcceK3BmNxZcAtz3j5EIpqguh9H6wc011YN75cKDLpFDxuwkrPQmUwW4KTbj9mZTwBwLq4aQMUZbHm1rylJ46dzR0dua2n3RYCWZsiHROeywyJGR7mXKlpryyCiouY56sFkBWEnkEB/raeh/Sw4162KeuAxMQpEkzy5alMY5wamMsWKKrtW2WpEWNnReZWONKWjrdsKZarpFjqCslq773PLmEhM448Pc3+FKr1+94vv/rfw4tEcu+lKTBe4kZSdijBrykwv9vbCMPcLQTygBjzVckSLPRVGslqdunwJ4oegtFOYb4SwxNgWLCmD7T9kVjTv5YDgpo0XBmN34Z/rEHp0sgyz7lngsrm4lvMm2Mr1zNOJYJ5cuxuQxwMGJq/TP5emlb8fsQBZviK4t8hFL+zbhtlpwaRSxQRWfeETjuauPsdGxsBVdO7nmP4xvzSoT29pRl7kGqz+k26B3Oy0YNV+SXbbQas1ctC/GarskRdFpKczVAF1ZXnLcpaMuzVe6lZ2g/1ndcvOVgRG3sdUAY1bKD6achijMPdMxV4muKVorSpiDHituH7rSTs7n/4y5DhRXo4FVBN4vO/zbAcxhENzGbHCzU/98Mcx5e7a31kWjw9FCe/zNeYyQjZsWb1uc7U33pN4Mji6hCLhivqfa9Ss6xLg031AgfesA/l99m9fgvnaF9JoE6bYKmkGNK3aPbHB96w3+DnxFm4hs0drLsk7U8kf/N/CvwQNtllna0rjq61sH8L80HAuvwH1tvBy2ChqWSCaYTaGN19sTvlfzFD6n+iKTbvtayfrfe9ueWh6GJFoxLdr7V72a5ZpvHcCPDzma0wTO4EgbLyedxstO81n57LYBOBzyfsOhUKsW1J1BB5vr/tz8RyqOFylQP9Tvst2JALsC5lsH8PyQ40DV4ANzYa4dedNiKNR1s+x2wwbR7q4/4cTxqEk4LWDebfisuo36JXLiWFjOtLrlNWh3K1rRS4xvHcDNlFnNmWBBAl5SWaL3oPOfnvbr5pdjVnEaeBJSYjuLEkyLLsWhKccadmOphZkOPgVdalj2QpSmfOsADhMWE2ZBu4+EEJI4wKTAuCoC4xwQbWXBltpxbjkXJtKxxabo9e7tyhlgb6gNlSbUpMh+l/FaqzVwewGu8BW1Zx7pTpQDJUjb8tsUTW6+GDXbMn3mLbXlXJiGdggxFAoUrtPS3wE4Nk02UZG2OOzlk7fRs7i95QCLo3E0jtrjnM7SR3uS1p4qtS2nJ5OwtQVHgOvArLBFijZUV9QtSl8dAY5d0E0hM0w3HS2DpIeB6m/A1+HfhJcGUq4sOxH+x3f5+VO+Ds9rYNI7zPXOYWPrtf8bYMx6fuOAX5jzNR0PdsuON+X1f7EERxMJJoU6GkTEWBvVolVlb5lh3tKCg6Wx1IbaMDdJ+9sUCc5KC46hKGCk3IVOS4TCqdBNfUs7Kd4iXf2RjnT/LLysJy3XDcHLh/vde3x8DoGvwgsa67vBk91G5Pe/HbOe7xwym0NXbtiuuDkGO2IJDh9oQvJ4cY4vdoqLDuoH9Zl2F/ofsekn8lkuhIlhQcffUtSjytFyp++p6NiE7Rqx/lodgKVoceEp/CP4FfjrquZaTtj2AvH5K/ywpn7M34K/SsoYDAdIN448I1/0/wveW289T1/lX5xBzc8N5IaHr0XMOQdHsIkDuJFifj20pBm5jzwUv9e2FhwRsvhAbalCIuIw3bhJihY3p6nTFFIZgiSYjfTf3aXuOjmeGn4bPoGvwl+CFzTRczBIuHBEeImHc37/lGfwZR0cXzVDOvaKfNHvwe+suZ771K/y/XcBlsoN996JpBhoE2toYxOznNEOS5TJc6Id5GEXLjrWo+LEWGNpPDU4WAwsIRROu+1vM+0oW37z/MBN9kqHnSArwPfgFJ7Cq/Ai3Ie7g7ncmI09v8sjzw9mzOAEXoIHxURueaAce5V80f/DOuuZwHM8vsMb5wBzOFWM7wymTXPAEvm4vcFpZ2ut0VZRjkiP2MlmLd6DIpbGSiHOjdnUHN90hRYmhTnmvhzp1iKDNj+b7t5hi79lWGwQ+HN9RsfFMy0FXbEwhfuczKgCbyxYwBmcFhhvo/7a44v+i3XWcwDP86PzpGQYdWh7csP5dBvZ1jNzdxC8pBGuxqSW5vw40nBpj5JhMwvOzN0RWqERHMr4Lv1kWX84xLR830G3j6yqZ1a8UstTlW+qJPOZ+sZ7xZPKTJLhiNOAFd6tk+jrTH31ncLOxid8+nzRb128HhUcru/y0Wn6iT254YPC6FtVSIMoW2sk727AhvTtrWKZTvgsmckfXYZWeNRXx/3YQ2OUxLDrbHtN11IwrgXT6c8dATDwLniYwxzO4RzuQqTKSC5gAofMZ1QBK3zQ4JWobFbcvJm87FK+6JXrKahLn54m3p+McXzzYtP8VF/QpJuh1OwieElEoI1pRxPS09FBrkq2tWCU59+HdhNtTIqKm8EBrw2RTOEDpG3IKo2Y7mFdLm3ZeVjYwVw11o/oznceMve4CgMfNym/utA/d/ILMR7gpXzRy9eDsgLcgbs8O2Va1L0zzIdwGGemTBuwROHeoMShkUc7P+ISY3KH5ZZeWqO8mFTxQYeXTNuzvvK5FGPdQfuu00DwYFY9dyhctEt+OJDdnucfpmyhzUJzfsJjr29l8S0bXBfwRS9ZT26tmMIdZucch5ZboMz3Nio3nIOsYHCGoDT4kUA9MiXEp9Xsui1S8th/kbWIrMBxDGLodWUQIWcvnXy+9M23xPiSMOiRPqM+YMXkUN3gXFrZJwXGzUaMpJfyRS9ZT0lPe8TpScuRlbMHeUmlaKDoNuy62iWNTWNFYjoxFzuJs8oR+RhRx7O4SVNSXpa0ZJQ0K1LAHDQ+D9IepkMXpcsq5EVCvClBUIzDhDoyKwDw1Lc59GbTeORivugw1IcuaEOaGWdNm+Ps5fQ7/tm0DjMegq3yM3vb5j12qUId5UZD2oxDSEWOZMSqFl/W+5oynWDa/aI04tJRQ2eTXusg86SQVu/nwSYwpW6wLjlqIzwLuxGIvoAvul0PS+ZNz0/akp/pniO/8JDnGyaCkzbhl6YcqmK/69prxPqtpx2+Km9al9sjL+rwMgHw4jE/C8/HQ3m1vBuL1fldbzd8mOueVJ92syqdEY4KJjSCde3mcRw2TA6szxedn+zwhZMps0XrqEsiUjnC1hw0TELC2Ek7uAAdzcheXv1BYLagspxpzSAoZZUsIzIq35MnFQ9DOrlNB30jq3L4pkhccKUAA8/ocvN1Rzx9QyOtERs4CVsJRK/DF71kPYrxYsGsm6RMh4cps5g1DOmM54Ly1ii0Hd3Y/BMk8VWFgBVmhqrkJCPBHAolwZaWzLR9Vb7bcWdX9NyUYE+uB2BKfuaeBUcjDljbYVY4DdtsVWvzRZdWnyUzDpjNl1Du3aloAjVJTNDpcIOVVhrHFF66lLfJL1zJr9PQ2nFJSBaKoDe+sAvLufZVHVzYh7W0h/c6AAZ+7Tvj6q9j68G/cTCS/3n1vLKHZwNi+P+pS0WkZNMBMUl+LDLuiE4omZy71r3UFMwNJV+VJ/GC5ixVUkBStsT4gGKh0Gm4Oy3qvq7Lbmq24nPdDuDR9deR11XzP4vFu3TYzfnIyiSVmgizUYGqkIXNdKTY9pgb9D2Ix5t0+NHkVzCdU03suWkkVZAoCONCn0T35gAeW38de43mf97sMOpSvj4aa1KYUm58USI7Wxxes03bAZdRzk6UtbzMaCQ6IxO0dy7X+XsjoD16hpsBeGz9dfzHj+R/Hp8nCxZRqkEDTaCKCSywjiaoMJ1TITE9eg7Jqnq8HL6gDwiZb0u0V0Rr/rmvqjxKuaLCX7ZWXTvAY+uvm3z8CP7nzVpngqrJpZKwWnCUjIviYVlirlGOzPLI3SMVyp/elvBUjjDkNhrtufFFErQ8pmdSlbK16toBHlt/HV8uHMX/vEGALkV3RJREiSlopxwdMXOZPLZ+ix+kAHpMKIk8UtE1ygtquttwxNhphrIZ1IBzjGF3IIGxGcBj6q8bHJBG8T9vdsoWrTFEuebEZuVxhhClH6P5Zo89OG9fwHNjtNQTpD0TG9PJLEYqvEY6Rlxy+ZZGfL0Aj62/bnQCXp//eeM4KzfQVJbgMQbUjlMFIm6TpcfWlZje7NBSV6IsEVmumWIbjiloUzQX9OzYdo8L1wjw2PrrpimONfmfNyzKklrgnEkSzT5QWYQW40YShyzqsRmMXbvVxKtGuYyMKaU1ugenLDm5Ily4iT14fP11Mx+xJv+zZ3MvnfdFqxU3a1W/FTB4m3Qfsyc1XUcdVhDeUDZXSFHHLQj/Y5jtC7ZqM0CXGwB4bP11i3LhOvzPGygYtiUBiwQV/4wFO0majijGsafHyRLu0yG6q35cL1rOpVxr2s5cM2jJYMCdc10Aj6q/blRpWJ//+dmm5psMl0KA2+AFRx9jMe2WbC4jQxnikd4DU8TwUjRVacgdlhmr3bpddzuJ9zXqr2xnxJfzP29RexdtjDVZqzkqa6PyvcojGrfkXiJ8SEtml/nYskicv0ivlxbqjemwUjMw5evdg8fUX9nOiC/lf94Q2i7MURk9nW1MSj5j8eAyV6y5CN2S6qbnw3vdA1Iwq+XOSCl663udN3IzLnrt+us25cI1+Z83SXQUldqQq0b5XOT17bGpLd6ssN1VMPf8c+jG8L3NeCnMdF+Ra3fRa9dft39/LuZ/3vwHoHrqGmQFafmiQw6eyzMxS05K4bL9uA+SKUQzCnSDkqOGokXyJvbgJ/BHI+qvY69//4rl20NsmK2ou2dTsyIALv/91/8n3P2Aao71WFGi8KKv1fRC5+J67Q/507/E/SOshqN5TsmYIjVt+kcjAx98iz/4SaojbIV1rexE7/C29HcYD/DX4a0rBOF5VTu7omsb11L/AWcVlcVZHSsqGuXLLp9ha8I//w3Mv+T4Ew7nTBsmgapoCrNFObIcN4pf/Ob/mrvHTGqqgAupL8qWjWPS9m/31jAe4DjA+4+uCoQoT/zOzlrNd3qd4SdphFxsUvYwGWbTWtISc3wNOWH+kHBMfc6kpmpwPgHWwqaSUG2ZWWheYOGQGaHB+eQ/kn6b3pOgLV+ODSn94wDvr8Bvb70/LLuiPPEr8OGVWfDmr45PZyccEmsVXZGe1pRNX9SU5+AVQkNTIVPCHF/jGmyDC9j4R9LfWcQvfiETmgMMUCMN1uNCakkweZsowdYobiMSlnKA93u7NzTXlSfe+SVbfnPQXmg9LpYAQxpwEtONyEyaueWM4FPjjyjG3uOaFmBTWDNgBXGEiQpsaWhnAqIijB07Dlsy3fUGeP989xbWkyf+FF2SNEtT1E0f4DYYVlxFlbaSMPIRMk/3iMU5pME2SIWJvjckciebkQuIRRyhUvkHg/iUljG5kzVog5hV7vIlCuBrmlhvgPfNHQM8lCf+FEGsYbMIBC0qC9a0uuy2wLXVbLBaP5kjHokCRxapkQyzI4QEcwgYHRZBp+XEFTqXFuNVzMtjXLJgX4gAid24Hjwc4N3dtVSe+NNiwTrzH4WVUOlDobUqr1FuAgYllc8pmzoVrELRHSIW8ViPxNy4xwjBpyR55I6J220qQTZYR4guvUICJiSpr9gFFle4RcF/OMB7BRiX8sSfhpNSO3lvEZCQfLUVTKT78Ek1LRLhWN+yLyTnp8qWUZ46b6vxdRGXfHVqx3eI75YaLa4iNNiK4NOW7wPW6lhbSOF9/M9qw8e/aoB3d156qTzxp8pXx5BKAsYSTOIIiPkp68GmTq7sZtvyzBQaRLNxIZ+paozHWoLFeExIhRBrWitHCAHrCF7/thhD8JhYz84wg93QRV88wLuLY8zF8sQ36qF1J455bOlgnELfshKVxYOXKVuKx0jaj22sczTQqPqtV/XDgpswmGTWWMSDw3ssyUunLLrVPGjYRsH5ggHeHSWiV8kT33ycFSfMgkoOK8apCye0J6VW6GOYvffgU9RWsukEi2kUV2nl4dOYUzRik9p7bcA4ggdJ53LxKcEe17B1R8eqAd7dOepV8sTXf5lhejoL85hUdhDdknPtKHFhljOT+bdq0hxbm35p2nc8+Ja1Iw+tJykgp0EWuAAZYwMVwac5KzYMslhvgHdHRrxKnvhTYcfKsxTxtTETkjHO7rr3zjoV25lAQHrqpV7bTiy2aXMmUhTBnKS91jhtR3GEoF0oLnWhWNnYgtcc4N0FxlcgT7yz3TgNIKkscx9jtV1ZKpWW+Ub1tc1eOv5ucdgpx+FJy9pgbLE7xDyXb/f+hLHVGeitHOi6A7ybo3sF8sS7w7cgdk0nJaOn3hLj3uyD0Zp5pazFIUXUpuTTU18d1EPkDoX8SkmWTnVIozEdbTcZjoqxhNHf1JrSS/AcvHjZ/SMHhL/7i5z+POsTUh/8BvNfYMTA8n+yU/MlTZxSJDRStqvEuLQKWwDctMTQogUDyQRoTQG5Kc6oQRE1yV1jCA7ri7jdZyK0sYTRjCR0Hnnd+y7nHxNgTULqw+8wj0mQKxpYvhjm9uSUxg+TTy7s2GtLUGcywhXSKZN275GsqlclX90J6bRI1aouxmgL7Q0Nen5ziM80SqMIo8cSOo+8XplT/5DHNWsSUr/6lLN/QQ3rDyzLruEW5enpf7KqZoShEduuSFOV7DLX7Ye+GmXb6/hnNNqKsVXuMDFpb9Y9eH3C6NGEzuOuI3gpMH/I6e+zDiH1fXi15t3vA1czsLws0TGEtmPEJdiiFPwlwKbgLHAFk4P6ZyPdymYYHGE0dutsChQBl2JcBFlrEkY/N5bQeXQ18gjunuMfMfsBlxJSx3niO485fwO4fGD5T/+3fPQqkneWVdwnw/3bMPkW9Wbqg+iC765Zk+xcT98ibKZc2EdgHcLoF8cSOo/Oc8fS+OyEULF4g4sJqXVcmfMfsc7A8v1/yfGXmL9I6Fn5pRwZhsPv0TxFNlAfZCvG+Oohi82UC5f/2IsJo0cTOm9YrDoKhFPEUr/LBYTUNht9zelHXDqwfPCIw4owp3mOcIQcLttWXFe3VZ/j5H3cIc0G6oPbCR+6Y2xF2EC5cGUm6wKC5tGEzhsWqw5hNidUiKX5gFWE1GXh4/Qplw4sVzOmx9QxU78g3EF6wnZlEN4FzJ1QPSLEZz1KfXC7vd8ssGdIbNUYpVx4UapyFUHzJoTOo1McSkeNn1M5MDQfs4qQuhhX5vQZFw8suwWTcyYTgioISk2YdmkhehG4PkE7w51inyAGGaU+uCXADabGzJR1fn3lwkty0asIo8cROm9Vy1g0yDxxtPvHDAmpu+PKnM8Ix1wwsGw91YJqhteaWgjYBmmQiebmSpwKKzE19hx7jkzSWOm66oPbzZ8Yj6kxVSpYjVAuvLzYMCRo3oTQecOOjjgi3NQ4l9K5/hOGhNTdcWVOTrlgYNkEXINbpCkBRyqhp+LdRB3g0OU6rMfW2HPCFFMV9nSp+uB2woepdbLBuJQyaw/ZFysXrlXwHxI0b0LovEkiOpXGA1Ijagf+KUNC6rKNa9bQnLFqYNkEnMc1uJrg2u64ELPBHpkgWbmwKpJoDhMwNbbGzAp7Yg31wS2T5rGtzit59PrKhesWG550CZpHEzpv2NGRaxlNjbMqpmEIzygJqQfjypycs2pg2cS2RY9r8HUqkqdEgKTWtWTKoRvOBPDYBltja2SO0RGjy9UHtxwRjA11ujbKF+ti5cIR9eCnxUg6owidtyoU5tK4NLji5Q3HCtiyF2IqLGYsHViOXTXOYxucDqG0HyttqYAKqYo3KTY1ekyDXRAm2AWh9JmsVh/ccg9WJ2E8YjG201sPq5ULxxX8n3XLXuMInbft2mk80rRGjCGctJ8/GFdmEQ9Ug4FlE1ll1Y7jtiraqm5Fe04VV8lvSVBL8hiPrfFVd8+7QH3Qbu2ipTVi8cvSGivc9cj8yvH11YMHdNSERtuOslM97feYFOPKzGcsI4zW0YGAbTAOaxCnxdfiYUmVWslxiIblCeAYr9VYR1gM7GmoPrilunSxxeT3DN/2eBQ9H11+nk1adn6VK71+5+Jfct4/el10/7KBZfNryUunWSCPxPECk1rdOv1WVSrQmpC+Tl46YD3ikQYcpunSQgzVB2VHFhxHVGKDgMEY5GLlQnP7FMDzw7IacAWnO6sBr12u+XanW2AO0wQ8pknnFhsL7KYIqhkEPmEXFkwaN5KQphbkUmG72wgw7WSm9RiL9QT925hkjiVIIhphFS9HKI6/8QAjlpXqg9W2C0apyaVDwKQwrwLY3j6ADR13ZyUNByQXHQu6RY09Hu6zMqXRaNZGS/KEJs0cJEe9VH1QdvBSJv9h09eiRmy0V2uJcqHcShcdvbSNg5fxkenkVprXM9rDVnX24/y9MVtncvbKY706anNl3ASll9a43UiacVquXGhvq4s2FP62NGKfQLIQYu9q1WmdMfmUrDGt8eDS0cXozH/fjmUH6Jruvm50hBDSaEU/2Ru2LEN/dl006TSc/g7tfJERxGMsgDUEr104pfWH9lQaN+M4KWQjwZbVc2rZVNHsyHal23wZtIs2JJqtIc/WLXXRFCpJkfE9jvWlfFbsNQ9pP5ZBS0zKh4R0aMFj1IjTcTnvi0Zz2rt7NdvQb2mgbju1plsH8MmbnEk7KbK0b+wC2iy3aX3szW8xeZvDwET6hWZYwqTXSSG+wMETKum0Dq/q+x62gt2ua2ppAo309TRk9TPazfV3qL9H8z7uhGqGqxNVg/FKx0HBl9OVUORn8Q8Jx9gFttGQUDr3tzcXX9xGgN0EpzN9mdZ3GATtPhL+CjxFDmkeEU6x56kqZRusLzALXVqkCN7zMEcqwjmywDQ6OhyUe0Xao1Qpyncrg6wKp9XfWDsaZplElvQ/b3sdweeghorwBDlHzgk1JmMc/wiERICVy2VJFdMjFuLQSp3S0W3+sngt2njwNgLssFGVQdJ0tu0KH4ky1LW4yrbkuaA6Iy9oz/qEMMXMMDWyIHhsAyFZc2peV9hc7kiKvfULxCl9iddfRK1f8kk9qvbdOoBtOg7ZkOZ5MsGrSHsokgLXUp9y88smniwWyuFSIRVmjplga3yD8Uij5QS1ZiM4U3Qw5QlSm2bXjFe6jzzBFtpg+/YBbLAWG7OPynNjlCw65fukGNdkJRf7yM1fOxVzbxOJVocFoYIaGwH22mIQkrvu1E2nGuebxIgW9U9TSiukPGU+Lt++c3DJPKhyhEEbXCQLUpae2exiKy6tMPe9mDRBFCEMTWrtwxN8qvuGnt6MoihKWS5NSyBhbH8StXoAz8PLOrRgLtOT/+4vcu+7vDLnqNvztOq7fmd8sMmY9Xzn1zj8Dq8+XVdu2Nv0IIySgEdQo3xVHps3Q5i3fLFsV4aiqzAiBhbgMDEd1uh8qZZ+lwhjkgokkOIv4xNJmyncdfUUzgB4oFMBtiu71Xumpz/P+cfUP+SlwFExwWW62r7b+LSPxqxn/gvMZ5z9C16t15UbNlq+jbGJtco7p8wbYlL4alSyfWdeuu0j7JA3JFNuVAwtst7F7FhWBbPFNKIUORndWtLraFLmMu7KFVDDOzqkeaiN33YAW/r76wR4XDN/yN1z7hejPau06EddkS/6XThfcz1fI/4K736fO48vlxt2PXJYFaeUkFS8U15XE3428xdtn2kc8GQlf1vkIaNRRnOMvLTWrZbElEHeLWi1o0dlKPAh1MVgbbVquPJ5+Cr8LU5/H/+I2QlHIU2ClXM9G8v7Rr7oc/hozfUUgsPnb3D+I+7WF8kNO92GY0SNvuxiE+2Bt8prVJTkzE64sfOstxuwfxUUoyk8VjcTlsqe2qITSFoSj6Epd4KsT6BZOWmtgE3hBfir8IzZDwgV4ZTZvD8VvPHERo8v+vL1DASHTz/i9OlKueHDjK5Rnx/JB1Vb1ioXdBra16dmt7dgik10yA/FwJSVY6XjA3oy4SqM2frqDPPSRMex9qs3XQtoWxMj7/Er8GWYsXgjaVz4OYumP2+9kbxvny/6kvWsEBw+fcb5bInc8APdhpOSs01tEqIkoiZjbAqKMruLbJYddHuHFRIyJcbdEdbl2sVLaySygunutBg96Y2/JjKRCdyHV+AEFtTvIpbKIXOamknYSiB6KV/0JetZITgcjjk5ZdaskBtWO86UF0ap6ozGXJk2WNiRUlCPFir66lzdm/SLSuK7EUdPz8f1z29Skq6F1fXg8+5UVR6bszncP4Tn4KUkkdJ8UFCY1zR1i8RmL/qQL3rlei4THG7OODlnKko4oI01kd3CaM08Ia18kC3GNoVaO9iDh+hWxSyTXFABXoau7Q6q9OxYg/OVEMw6jdbtSrJ9cBcewGmaZmg+bvkUnUUaGr+ZfnMH45Ivevl61hMcXsxYLFTu1hTm2zViCp7u0o5l+2PSUh9bDj6FgYypufBDhqK2+oXkiuHFHR3zfj+9PtA8oR0xnqX8qn+sx3bFODSbbF0X8EUvWQ8jBIcjo5bRmLOljDNtcqNtOe756h3l0VhKa9hDd2l1eqmsnh0MNMT/Cqnx6BInumhLT8luljzQ53RiJeA/0dxe5NK0o2fA1+GLXr6eNQWHNUOJssQaTRlGpLHKL9fD+IrQzTOMZS9fNQD4AnRNVxvTdjC+fJdcDDWQcyB00B0t9BDwTxXgaAfzDZ/DBXzRnfWMFRwuNqocOmX6OKNkY63h5n/fFcB28McVHqnXZVI27K0i4rDLNE9lDKV/rT+udVbD8dFFu2GGZ8mOt0kAXcoX3ZkIWVtw+MNf5NjR2FbivROHmhV1/pj2egv/fMGIOWTIWrV3Av8N9imV9IWml36H6cUjqEWNv9aNc+veb2sH46PRaHSuMBxvtW+twxctq0z+QsHhux8Q7rCY4Ct8lqsx7c6Sy0dl5T89rIeEuZKoVctIk1hNpfavER6yyH1Vvm3MbsUHy4ab4hWr/OZPcsRBphnaV65/ZcdYPNNwsjN/djlf9NqCw9U5ExCPcdhKxUgLSmfROpLp4WSUr8ojdwbncbvCf+a/YzRaEc6QOvXcGO256TXc5Lab9POvB+AWY7PigWYjzhifbovuunzRawsO24ZqQQAqguBtmpmPB7ysXJfyDDaV/aPGillgz1MdQg4u5MYaEtBNNHFjkRlSpd65lp4hd2AVPTfbV7FGpyIOfmNc/XVsPfg7vzaS/3nkvLL593ANLvMuRMGpQIhiF7kUEW9QDpAUbTWYBcbp4WpacHHY1aacqQyjGZS9HI3yCBT9kUZJhVOD+zUDvEH9ddR11fzPcTDQ5TlgB0KwqdXSavk9BC0pKp0WmcuowSw07VXmXC5guzSa4p0UvRw2lbDiYUx0ExJJRzWzi6Gm8cnEkfXXsdcG/M/jAJa0+bmCgdmQ9CYlNlSYZOKixmRsgiFxkrmW4l3KdFKv1DM8tk6WxPYJZhUUzcd8Kdtgrw/gkfXXDT7+avmfVak32qhtkg6NVdUS5wgkru1YzIkSduTW1FDwVWV3JQVJVuieTc0y4iDpFwc7/BvSalvKdQM8sv662cevz/+8sQVnjVAT0W2wLllw1JiMhJRxgDjCjLQsOzSFSgZqx7lAW1JW0e03yAD3asC+GD3NbQhbe+mN5GXH1F83KDOM4n/e5JIuH4NpdQARrFPBVptUNcjj4cVMcFSRTE2NpR1LEYbYMmfWpXgP9KejaPsLUhuvLCsVXznAG9dfx9SR1ud/3hZdCLHb1GMdPqRJgqDmm76mHbvOXDtiO2QPUcKo/TWkQ0i2JFXpBoo7vij1i1Lp3ADAo+qvG3V0rM//vFnnTE4hxd5Ka/Cor5YEdsLVJyKtDgVoHgtW11pWSjolPNMnrlrVj9Fv2Qn60twMwKPqr+N/wvr8z5tZcDsDrv06tkqyzESM85Ycv6XBWA2birlNCXrI6VbD2lx2L0vQO0QVTVVLH4SE67fgsfVXv8n7sz7/85Z7cMtbE6f088wSaR4kCkCm10s6pKbJhfqiUNGLq+0gLWC6eUAZFPnLjwqtKd8EwGvWX59t7iPW4X/eAN1svgRVSY990YZg06BD1ohLMtyFTI4pKTJsS9xREq9EOaPWiO2gpms7397x6nQJkbh+Fz2q/rqRROX6/M8bJrqlVW4l6JEptKeUFuMYUbtCQ7CIttpGc6MY93x1r1vgAnRXvY5cvwWPqb9uWQm+lP95QxdNMeWhOq1x0Db55C7GcUv2ZUuN6n8iKzsvOxibC//Yfs9Na8r2Rlz02vXXDT57FP/zJi66/EJSmsJKa8QxnoqW3VLQ+jZVUtJwJ8PNX1NQCwfNgdhhHD9on7PdRdrdGPF28rJr1F+3LBdeyv+8yYfLoMYet1vX4upNAjVvwOUWnlNXJXlkzk5Il6kqeoiL0C07qno+/CYBXq/+utlnsz7/Mzvy0tmI4zm4ag23PRN3t/CWryoUVJGm+5+K8RJ0V8Hc88/XHUX/HfiAq7t+BH+x6v8t438enWmdJwFA6ZINriLGKv/95f8lT9/FnyA1NMVEvQyaXuu+gz36f/DD73E4pwqpLcvm/o0Vle78n//+L/NPvoefp1pTJye6e4A/D082FERa5/opeH9zpvh13cNm19/4v/LDe5xMWTi8I0Ta0qKlK27AS/v3/r+/x/2GO9K2c7kVMonDpq7//jc5PKCxeNPpFVzaRr01wF8C4Pu76hXuX18H4LduTr79guuFD3n5BHfI+ZRFhY8w29TYhbbLi/bvBdqKE4fUgg1pBKnV3FEaCWOWyA+m3WpORZr/j+9TKJtW8yBTF2/ZEODI9/QavHkVdGFp/Pjn4Q+u5hXapsP5sOH+OXXA1LiKuqJxiMNbhTkbdJTCy4llEt6NnqRT4dhg1V3nbdrm6dYMecA1yTOL4PWTE9L5VzPFlLBCvlG58AhehnN4uHsAYinyJ+AZ/NkVvELbfOBUuOO5syBIEtiqHU1k9XeISX5bsimrkUUhnGDxourN8SgUsCZVtKyGbyGzHXdjOhsAvOAswSRyIBddRdEZWP6GZhNK/yjwew9ehBo+3jEADu7Ay2n8mDc+TS7awUHg0OMzR0LABhqLD4hJEh/BEGyBdGlSJoXYXtr+3HS4ijzVpgi0paWXtdruGTknXBz+11qT1Q2inxaTzQCO46P3lfLpyS4fou2PH/PupwZgCxNhGlj4IvUuWEsTkqMWm6i4xCSMc9N1RDQoCVcuGItJ/MRWefais+3synowi/dESgJjkilnWnBTGvRWmaw8oR15257t7CHmCf8HOn7cwI8+NQBXMBEmAa8PMRemrNCEhLGEhDQKcGZWS319BX9PFBEwGTbRBhLbDcaV3drFcDqk5kCTd2JF1Wp0HraqBx8U0wwBTnbpCadwBA/gTH/CDrcCs93LV8E0YlmmcyQRQnjBa8JESmGUfIjK/7fkaDJpmD2QptFNVJU1bbtIAjjWQizepOKptRjbzR9Kag6xZmMLLjHOtcLT3Tx9o/0EcTT1XN3E45u24AiwEypDJXihKjQxjLprEwcmRKclaDNZCVqr/V8mYWyFADbusiY5hvgFoU2vio49RgJLn5OsReRFN6tabeetiiy0V7KFHT3HyZLx491u95sn4K1QQSPKM9hNT0wMVvAWbzDSVdrKw4zRjZMyJIHkfq1VAVCDl/bUhNKlGq0zGr05+YAceXVPCttVk0oqjVwMPt+BBefx4yPtGVkUsqY3CHDPiCM5ngupUwCdbkpd8kbPrCWHhkmtIKLEetF2499eS1jZlIPGYnlcPXeM2KD9vLS0bW3ktYNqUllpKLn5ZrsxlIzxvDu5eHxzGLctkZLEY4PgSOg2IUVVcUONzUDBEpRaMoXNmUc0tFZrTZquiLyKxrSm3DvIW9Fil+AkhXu5PhEPx9mUNwqypDvZWdKlhIJQY7vn2OsnmBeOWnYZ0m1iwbbw1U60by5om47iHRV6fOgzjMf/DAZrlP40Z7syxpLK0lJ0gqaAK1c2KQKu7tabTXkLFz0sCftuwX++MyNeNn68k5Buq23YQhUh0SNTJa1ioQ0p4nUG2y0XilF1JqODqdImloPS4Bp111DEWT0jJjVv95uX9BBV7eB3bUWcu0acSVM23YZdd8R8UbQUxJ9wdu3oMuhdt929ME+mh6JXJ8di2RxbTi6TbrDquqV4aUKR2iwT6aZbyOwEXN3DUsWr8Hn4EhwNyHuXHh7/pdaUjtR7vnDh/d8c9xD/s5f501eQ1+CuDiCvGhk1AN/4Tf74RfxPwD3toLarR0zNtsnPzmS64KIRk861dMWCU8ArasG9T9H0ZBpsDGnjtAOM2+/LuIb2iIUGXNgl5ZmKD/Tw8TlaAuihaFP5yrw18v4x1898zIdP+DDAX1bM3GAMvPgRP/cJn3zCW013nrhHkrITyvYuwOUkcHuKlRSW5C6rzIdY4ppnF7J8aAJbQepgbJYBjCY9usGXDKQxq7RZfh9eg5d1UHMVATRaD/4BHK93/1iAgYZ/+jqPn8Dn4UExmWrpa3+ZOK6MvM3bjwfzxNWA2dhs8+51XHSPJiaAhGSpWevEs5xHLXcEGFXYiCONySH3fPWq93JIsBiSWvWyc3CAN+EcXoT7rCSANloPPoa31rt/5PUA/gp8Q/jDD3hyrjzlR8VkanfOvB1XPubt17vzxAfdSVbD1pzAnfgyF3ycadOTOTXhpEUoLC1HZyNGW3dtmjeXgr2r56JNmRwdNNWaQVBddd6rh4MhviEB9EFRD/7RGvePvCbwAL4Mx/D6M541hHO4D3e7g6PafdcZVw689z7NGTwo5om7A8sPhccT6qKcl9NJl9aM/9kX+e59Hh1yPqGuCCZxuITcsmNaJ5F7d0q6J3H48TO1/+M57085q2icdu2U+W36Ldllz9Agiv4YGljoEN908EzvDOrBF98/vtJwCC/BF2AG75xxEmjmMIcjxbjoaxqOK3/4hPOZzhMPBpYPG44CM0dTVm1LjLtUWWVz1Bcf8tEx0zs8O2A2YVHRxKYOiy/aOVoAaMu0i7ubu43njjmd4ibMHU1sIDHaQNKrZND/FZYdk54oCXetjq7E7IVl9eAL7t+oHnwXXtLx44czzoRFHBztYVwtH1d+NOMkupZ5MTM+gUmq90X+Bh9zjRlmaQ+m7YMqUL/veemcecAtOJ0yq1JnVlN27di2E0+Klp1tAJ4KRw1eMI7aJjsO3R8kPSI3fUFXnIOfdQe86sIIVtWDL7h//Ok6vj8vwDk08NEcI8zz7OhBy+WwalzZeZ4+0XniRfst9pAJqQHDGLzVQ2pheZnnv1OWhwO43/AgcvAEXEVVpa4db9sGvNK8wjaENHkfFQ4Ci5i7dqnQlPoLQrHXZDvO3BIXZbJOBrOaEbML6sFL798I4FhKihjHMsPjBUZYCMFr6nvaArxqXPn4lCa+cHfSa2cP27g3Z3ziYTRrcbQNGLQmGF3F3cBdzzzX7AILx0IB9rbwn9kx2G1FW3Inic+ZLIsVvKR8Zwfj0l1fkqo8LWY1M3IX14OX3r9RKTIO+d9XzAI8qRPGPn/4NC2n6o4rN8XJ82TOIvuVA8zLKUHRFgBCetlDZlqR1gLKjS39xoE7Bt8UvA6BxuEDjU3tFsEijgA+615tmZkXKqiEENrh41iLDDZNq4pKTWR3LZfnos81LOuNa15cD956vLMsJd1rqYp51gDUQqMYm2XsxnUhD2jg1DM7SeuJxxgrmpfISSXVIJIS5qJJSvJPEQ49DQTVIbYWJ9QWa/E2+c/oPK1drmC7WSfJRNKBO5Yjvcp7Gc3dmmI/Xh1kDTEuiSnWqQf37h+fTMhGnDf6dsS8SQfQWlqqwXXGlc/PEZ/SC5mtzIV0nAshlQdM/LvUtYutrEZ/Y+EAFtq1k28zQhOwLr1AIeANzhF8t9qzTdZf2qRKO6MWE9ohBYwibbOmrFtNmg3mcS+tB28xv2uKd/agYCvOP+GkSc+0lr7RXzyufL7QbkUpjLjEWFLqOIkAGu2B0tNlO9Eau2W1qcOUvVRgKzypKIQZ5KI3q0MLzqTNRYqiZOqmtqloIRlmkBHVpHmRYV6/HixbO6UC47KOFJnoMrVyr7wYz+SlW6GUaghYbY1I6kkxA2W1fSJokUdSh2LQ1GAimRGm0MT+uu57H5l7QgOWxERpO9moLRPgTtquWCfFlGlIjQaRly9odmzMOWY+IBO5tB4sW/0+VWGUh32qYk79EidWKrjWuiLpiVNGFWFRJVktyeXWmbgBBzVl8anPuXyNJlBJOlKLTgAbi/EYHVHxWiDaVR06GnHQNpJcWcK2jJtiCfG2sEHLzuI66sGrMK47nPIInPnu799935aOK2cvmvubrE38ZzZjrELCmXM2hM7UcpXD2oC3+ECVp7xtIuxptJ0jUr3sBmBS47TVxlvJ1Sqb/E0uLdvLj0lLr29ypdd/eMX3f6lrxGlKwKQxEGvw0qHbkbwrF3uHKwVENbIV2wZ13kNEF6zD+x24aLNMfDTCbDPnEikZFyTNttxWBXDaBuM8KtI2rmaMdUY7cXcUPstqTGvBGSrFWIpNMfbdea990bvAOC1YX0qbc6smDS1mPxSJoW4fwEXvjMmhlijDRq6qale6aJEuFGoppYDoBELQzLBuh/mZNx7jkinv0EtnUp50lO9hbNK57lZaMAWuWR5Yo9/kYwcYI0t4gWM47Umnl3YmpeBPqSyNp3K7s2DSAS/39KRuEN2bS4xvowV3dFRMx/VFcp2Yp8w2nTO9hCXtHG1kF1L4KlrJr2wKfyq77R7MKpFKzWlY9UkhYxyHWW6nBWPaudvEAl3CGcNpSXPZ6R9BbBtIl6cHL3gIBi+42CYXqCx1gfGWe7Ap0h3luyXdt1MKy4YUT9xSF01G16YEdWsouW9mgDHd3veyA97H+Ya47ZmEbqMY72oPztCGvK0onL44AvgC49saZKkWRz4veWljE1FHjbRJaWv6ZKKtl875h4CziFCZhG5rx7tefsl0aRT1bMHZjm8dwL/6u7wCRysaQblQoG5yAQN5zpatMNY/+yf8z+GLcH/Qn0iX2W2oEfXP4GvwQHuIL9AYGnaO3zqAX6946nkgqZNnUhx43DIdQtMFeOPrgy/y3Yd85HlJWwjLFkU3kFwq28xPnuPhMWeS+tDLV9Otllq7pQCf3uXJDN9wFDiUTgefHaiYbdfi3b3u8+iY6TnzhgehI1LTe8lcd7s1wJSzKbahCRxKKztTLXstGAiu3a6rPuQs5pk9TWAan5f0BZmGf7Ylxzzk/A7PAs4QPPPAHeFQ2hbFHszlgZuKZsJcUmbDC40sEU403cEjczstOEypa+YxevL4QBC8oRYqWdK6b7sK25tfE+oDZgtOQ2Jg8T41HGcBE6fTWHn4JtHcu9S7uYgU5KSCkl/mcnq+5/YBXOEr6lCUCwOTOM1taOI8mSxx1NsCXBEmLKbMAg5MkwbLmpBaFOPrNSlO2HnLiEqW3tHEwd8AeiQLmn+2gxjC3k6AxREqvKcJbTEzlpLiw4rNZK6oJdidbMMGX9FULKr0AkW+2qDEPBNNm5QAt2Ik2nftNWHetubosHLo2nG4vQA7GkcVCgVCgaDixHqo9UUn1A6OshapaNR/LPRYFV8siT1cCtJE0k/3WtaNSuUZYKPnsVIW0xXWnMUxq5+En4Kvw/MqQmVXnAXj9Z+9zM98zM/Agy7F/qqj2Nh67b8HjFnPP3iBn/tkpdzwEJX/whIcQUXOaikeliCRGUk7tiwF0rItwMEhjkZ309hikFoRAmLTpEXWuHS6y+am/KB/fM50aLEhGnSMwkpxzOov4H0AvgovwJ1iGzDLtJn/9BU+fAINfwUe6FHSLhu83viV/+/HrOePX+STT2B9uWGbrMHHLldRBlhS/CJQmcRxJFqZica01XixAZsYiH1uolZxLrR/SgxVIJjkpQP4PE9sE59LKLr7kltSBogS5tyszzH8Fvw8/AS8rNOg0xUS9fIaHwb+6et8Q/gyvKRjf5OusOzGx8evA/BP4IP11uN/grca5O0lcsPLJ5YjwI4QkJBOHa0WdMZYGxPbh2W2nR9v3WxEWqgp/G3+6VZbRLSAAZ3BhdhAaUL33VUSw9yjEsvbaQ9u4A/gGXwZXoEHOuU1GSj2chf+Mo+f8IcfcAxfIKVmyunRbYQVnoevwgfw3TXXcw++xNuP4fhyueEUNttEduRVaDttddoP0eSxLe2LENk6itYxlrxBNBYrNNKSQmeaLcm9c8UsaB5WyO6675yyQIAWSDpBVoA/gxmcwEvwoDv0m58UE7gHn+fJOa8/Ywan8EKRfjsopF83eCglX/Sfr7OeaRoQfvt1CGvIDccH5BCvw1sWIzRGC/66t0VTcLZQZtm6PlAasbOJ9iwWtUo7biktTSIPxnR24jxP1ZKaqq+2RcXM9OrBAm/AAs7hDJ5bNmGb+KIfwCs8a3jnjBrOFeMjHSCdbKr+2uOLfnOd9eiA8Hvvwwq54VbP2OqwkB48Ytc4YEOiH2vTXqodabfWEOzso4qxdbqD5L6tbtNPECqbhnA708DZH4QOJUXqScmUlks7Ot6FBuZw3n2mEbaUX7kDzxHOOQk8nKWMzAzu6ZZ8sOFw4RK+6PcuXo9tB4SbMz58ApfKDXf3szjNIIbGpD5TKTRxGkEMLjLl+K3wlWXBsCUxIDU+jbOiysESqAy1MGUJpXgwbTWzNOVEziIXZrJ+VIztl1PUBxTSo0dwn2bOmfDRPD3TRTGlfbCJvO9KvuhL1hMHhB9wPuPRLGHcdOWG2xc0U+5bQtAJT0nRTewXL1pgk2+rZAdeWmz3jxAqfNQQdzTlbF8uJ5ecEIWvTkevAHpwz7w78QujlD/Lr491bD8/1vhM2yrUQRrWXNQY4fGilfctMWYjL72UL/qS9eiA8EmN88nbNdour+PBbbAjOjIa4iBhfFg6rxeKdEGcL6p3EWR1Qq2Qkhs2DrnkRnmN9tG2EAqmgPw6hoL7Oza7B+3SCrR9tRftko+Lsf2F/mkTndN2LmzuMcKTuj/mX2+4Va3ki16+nnJY+S7MefpkidxwnV+4wkXH8TKnX0tsYzYp29DOOoSW1nf7nTh2akYiWmcJOuTidSaqESrTYpwjJJNVGQr+rLI7WsqerHW6Kp/oM2pKuV7T1QY9gjqlZp41/WfKpl56FV/0kvXQFRyeQ83xaTu5E8p5dNP3dUF34ihyI3GSpeCsywSh22ZJdWto9winhqifb7VRvgktxp13vyjrS0EjvrRfZ62uyqddSWaWYlwTPAtJZ2oZ3j/Sgi/mi+6vpzesfAcWNA0n8xVyw90GVFGuZjTXEQy+6GfLGLMLL523f5E0OmxVjDoOuRiH91RKU+vtoCtH7TgmvBLvtFXWLW15H9GTdVw8ow4IlRLeHECN9ym1e9K0I+Cbnhgv4Yu+aD2HaQJ80XDqOzSGAV4+4yCqBxrsJAX6ZTIoX36QnvzhhzzMfFW2dZVLOJfo0zbce5OvwXMFaZ81mOnlTVXpDZsQNuoYWveketKb5+6JOOsgX+NTm7H49fUTlx+WLuWL7qxnOFh4BxpmJx0p2gDzA/BUARuS6phR+pUsY7MMboAHx5xNsSVfVZcYSwqCKrqon7zM+8ecCkeS4nm3rINuaWvVNnMRI1IRpxTqx8PZUZ0Br/UEduo3B3hNvmgZfs9gQPj8vIOxd2kndir3awvJ6BLvoUuOfFWNYB0LR1OQJoUySKb9IlOBx74q1+ADC2G6rOdmFdJcD8BkfualA+BdjOOzP9uUhGUEX/TwhZsUduwRr8wNuXKurCixLBgpQI0mDbJr9dIqUuV+92ngkJZ7xduCk2yZKbfWrH1VBiTg9VdzsgRjW3CVXCvAwDd+c1z9dWw9+B+8MJL/eY15ZQ/HqvTwVdsZn5WQsgRRnMaWaecu3jFvMBEmgg+FJFZsnSl0zjB9OqPYaBD7qmoVyImFvzi41usesV0julaAR9dfR15Xzv9sEruRDyk1nb+QaLU67T885GTls6YgcY+UiMa25M/pwGrbCfzkvR3e0jjtuaFtnwuagHTSb5y7boBH119HXhvwP487jJLsLJ4XnUkHX5sLbS61dpiAXRoZSCrFJ+EjpeU3puVfitngYNo6PJrAigKktmwjyQdZpfq30mmtulaAx9Zfx15Xzv+cyeuiBFUs9zq8Kq+XB9a4PVvph3GV4E3y8HENJrN55H1X2p8VyqSKwVusJDKzXOZzplWdzBUFK9e+B4+uv468xvI/b5xtSAkBHQaPvtqWzllVvEOxPbuiE6+j2pvjcKsbvI7txnRErgfH7LdXqjq0IokKzga14GzQ23SSbCQvO6r+Or7SMIr/efOkkqSdMnj9mBx2DRsiY29Uj6+qK9ZrssCKaptR6HKURdwUYeUWA2kPzVKQO8ku2nU3Anhs/XWkBx3F/7wJtCTTTIKftthue1ty9xvNYLY/zo5KSbIuKbXpbEdSyeRyYdAIwKY2neyoc3+k1XUaufYga3T9daMUx/r8z1s10ITknIO0kuoMt+TB8jK0lpayqqjsJ2qtXAYwBU932zinimgmd6mTRDnQfr88q36NAI+tv24E8Pr8zxtasBqx0+xHH9HhlrwsxxNUfKOHQaZBITNf0uccj8GXiVmXAuPEAKSdN/4GLHhs/XWj92dN/uetNuBMnVR+XWDc25JLjo5Mg5IZIq226tmCsip2zZliL213YrTlL2hcFjpCduyim3M7/eB16q/blQsv5X/esDRbtJeabLIosWy3ycavwLhtxdWzbMmHiBTiVjJo6lCLjXZsi7p9PEPnsq6X6wd4bP11i0rD5fzPm/0A6brrIsllenZs0lCJlU4abakR59enZKrKe3BZihbTxlyZ2zl1+g0wvgmA166/bhwDrcn/7Ddz0eWZuJvfSESug6NzZsox3Z04FIxz0mUjMwVOOVTq1CQ0AhdbBGVdjG/CgsfUX7esJl3K/7ytWHRv683praW/8iDOCqWLLhpljDY1ZpzK75QiaZoOTpLKl60auHS/97oBXrv+umU9+FL+5+NtLFgjqVLCdbmj7pY5zPCPLOHNCwXGOcLquOhi8CmCWvbcuO73XmMUPab+ug3A6/A/78Bwe0bcS2+tgHn4J5pyS2WbOck0F51Vq3LcjhLvZ67p1ABbaL2H67bg78BfjKi/jr3+T/ABV3ilLmNXTI2SpvxWBtt6/Z//D0z/FXaGbSBgylzlsEGp+5//xrd4/ae4d8DUUjlslfIYS3t06HZpvfQtvv0N7AHWqtjP2pW08QD/FLy//da38vo8PNlKHf5y37Dxdfe/oj4kVIgFq3koLReSR76W/bx//n9k8jonZxzWTANVwEniDsg87sOSd/z7//PvMp3jQiptGVWFX2caezzAXwfgtzYUvbr0iozs32c3Uge7varH+CNE6cvEYmzbPZ9hMaYDdjK4V2iecf6EcEbdUDVUARda2KzO/JtCuDbNQB/iTeL0EG1JSO1jbXS+nLxtPMDPw1fh5+EPrgSEKE/8Gry5A73ui87AmxwdatyMEBCPNOCSKUeRZ2P6Myb5MRvgCHmA9ywsMifU+AYXcB6Xa5GibUC5TSyerxyh0j6QgLVpdyhfArRTTLqQjwe4HOD9s92D4Ap54odXAPBWLAwB02igG5Kkc+piN4lvODIFGAZgT+EO4Si1s7fjSR7vcQETUkRm9O+MXyo9OYhfe4xt9STQ2pcZRLayCV90b4D3jR0DYAfyxJ+eywg2IL7NTMXna7S/RpQ63JhWEM8U41ZyQGjwsVS0QBrEKLu8xwZsbi4wLcCT+OGidPIOCe1PiSc9Qt+go+vYqB7cG+B9d8cAD+WJPz0Am2gxXgU9IneOqDpAAXOsOltVuMzpdakJXrdPCzXiNVUpCeOos5cxnpQT39G+XVLhs1osQVvJKPZyNq8HDwd4d7pNDuWJPxVX7MSzqUDU6gfadKiNlUFTzLeFHHDlzO4kpa7aiKhBPGKwOqxsBAmYkOIpipyXcQSPlRTf+Tii0U3EJGaZsDER2qoB3h2hu0qe+NNwUooYU8y5mILbJe6OuX+2FTKy7bieTDAemaQyQ0CPthljSWO+xmFDIYiESjM5xKd6Ik5lvLq5GrQ3aCMLvmCA9wowLuWJb9xF59hVVP6O0CrBi3ZjZSNOvRy+I6klNVRJYRBaEzdN+imiUXQ8iVF8fsp+W4JXw7WISW7fDh7lptWkCwZ4d7QTXyBPfJMYK7SijjFppGnlIVJBJBYj7eUwtiP1IBXGI1XCsjNpbjENVpSAJ2hq2LTywEly3hUYazt31J8w2+aiLx3g3fohXixPfOMYm6zCGs9LVo9MoW3MCJE7R5u/WsOIjrqBoHUO0bJE9vxBpbhsd3+Nb4/vtPCZ4oZYCitNeYuC/8UDvDvy0qvkiW/cgqNqRyzqSZa/s0mqNGjtKOoTm14zZpUauiQgVfqtQiZjq7Q27JNaSK5ExRcrGCXO1FJYh6jR6CFqK7bZdQZ4t8g0rSlPfP1RdBtqaa9diqtzJkQ9duSryi2brQXbxDwbRUpFMBHjRj8+Nt7GDKgvph9okW7LX47gu0SpGnnFQ1S1lYldOsC7hYteR574ZuKs7Ei1lBsfdz7IZoxzzCVmmVqaSySzQbBVAWDek+N4jh9E/4VqZrJjPwiv9BC1XcvOWgO8275CVyBPvAtTVlDJfZkaZGU7NpqBogAj/xEHkeAuJihWYCxGN6e8+9JtSegFXF1TrhhLGP1fak3pebgPz192/8gB4d/6WT7+GdYnpH7hH/DJzzFiYPn/vjW0SgNpTNuPIZoAEZv8tlGw4+RLxy+ZjnKa5NdFoC7UaW0aduoYse6+bXg1DLg6UfRYwmhGEjqPvF75U558SANrElK/+MdpXvmqBpaXOa/MTZaa1DOcSiLaw9j0NNNst3c+63c7EKTpkvKHzu6bPbP0RkuHAVcbRY8ijP46MIbQeeT1mhA+5PV/inyDdQipf8LTvMXbwvoDy7IruDNVZKTfV4CTSRUYdybUCnGU7KUTDxLgCknqUm5aAW6/1p6eMsOYsphLzsHrE0Y/P5bQedx1F/4yPHnMB3/IOoTU9+BL8PhtjuFKBpZXnYNJxTuv+2XqolKR2UQgHhS5novuxVySJhBNRF3SoKK1XZbbXjVwWNyOjlqWJjrWJIy+P5bQedyldNScP+HZ61xKSK3jyrz+NiHG1hcOLL/+P+PDF2gOkekKGiNWKgJ+8Z/x8Iv4DdQHzcpZyF4v19I27w9/yPGDFQvmEpKtqv/TLiWMfn4sofMm9eAH8Ao0zzh7h4sJqYtxZd5/D7hkYPneDzl5idlzNHcIB0jVlQ+8ULzw/nc5/ojzl2juE0apD7LRnJxe04dMz2iOCFNtGFpTuXA5AhcTRo8mdN4kz30nVjEC4YTZQy4gpC7GlTlrePKhGsKKgeXpCYeO0MAd/GH7yKQUlXPLOasOH3FnSphjHuDvEu4gB8g66oNbtr6eMbFIA4fIBJkgayoXriw2XEDQPJrQeROAlY6aeYOcMf+IVYTU3XFlZufMHinGywaW3YLpObVBAsbjF4QJMsVUSayjk4voPsHJOQfPWDhCgDnmDl6XIRerD24HsGtw86RMHOLvVSHrKBdeVE26gKB5NKHzaIwLOmrqBWJYZDLhASG16c0Tn+CdRhWDgWXnqRZUTnPIHuMJTfLVpkoYy5CzylHVTGZMTwkGAo2HBlkQplrJX6U+uF1wZz2uwS1SQ12IqWaPuO4baZaEFBdukksJmkcTOm+YJSvoqPFzxFA/YUhIvWxcmSdPWTWwbAKVp6rxTtPFUZfKIwpzm4IoMfaYQLWgmlG5FME2gdBgm+J7J+rtS/XBbaVLsR7bpPQnpMFlo2doWaVceHk9+MkyguZNCJ1He+kuHTWyQAzNM5YSUg/GlTk9ZunAsg1qELVOhUSAK0LABIJHLKbqaEbHZLL1VA3VgqoiOKXYiS+HRyaEKgsfIqX64HYWbLRXy/qWoylIV9gudL1OWBNgBgTNmxA6b4txDT4gi3Ri7xFSLxtXpmmYnzAcWDZgY8d503LFogz5sbonDgkKcxGsWsE1OI+rcQtlgBBCSOKD1mtqYpIU8cTvBmAT0yZe+zUzeY92fYjTtGipXLhuR0ePoHk0ofNWBX+lo8Z7pAZDk8mEw5L7dVyZZoE/pTewbI6SNbiAL5xeygW4xPRuLCGbhcO4RIeTMFYHEJkYyEO9HmJfXMDEj/LaH781wHHZEtqSQ/69UnGpzH7LKIAZEDSPJnTesJTUa+rwTepI9dLJEawYV+ZkRn9g+QirD8vF8Mq0jFQ29js6kCS3E1+jZIhgPNanHdHFqFvPJLHqFwQqbIA4jhDxcNsOCCQLDomaL/dr5lyJaJU6FxPFjO3JOh3kVMcROo8u+C+jo05GjMF3P3/FuDLn5x2M04xXULPwaS6hBYki+MrMdZJSgPHlcB7nCR5bJ9Kr5ACUn9jk5kivdd8tk95SOGrtqu9lr2IhK65ZtEl7ZKrp7DrqwZfRUSN1el7+7NJxZbywOC8neNKTch5vsTEMNsoCCqHBCqIPRjIPkm0BjvFODGtto99rCl+d3wmHkW0FPdpZtC7MMcVtGFQjJLX5bdQ2+x9ypdc313uj8xlsrfuLgWXz1cRhZvJYX0iNVBRcVcmCXZs6aEf3RQF2WI/TcCbKmGU3IOoDJGDdDub0+hYckt6PlGu2BcxmhbTdj/klhccLGJMcqRjMJP1jW2ETqLSWJ/29MAoORluJ+6LPffBZbi5gqi5h6catQpmOT7/OFf5UorRpLzCqcMltBLhwd1are3kztrSzXO0LUbXRQcdLh/RdSZ+swRm819REDrtqzC4es6Gw4JCKlSnjYVpo0xeq33PrADbFLL3RuCmObVmPN+24kfa+AojDuM4umKe2QwCf6EN906HwjujaitDs5o0s1y+k3lgbT2W2i7FJdnwbLXhJUBq/9liTctSmFC/0OqUinb0QddTWamtjbHRFuWJJ6NpqZ8vO3fZJ37Db+2GkaPYLGHs7XTTdiFQJ68SkVJFVmY6McR5UycflNCsccHFaV9FNbR4NttLxw4pQ7wJd066Z0ohVbzihaxHVExd/ay04oxUKWt+AsdiQ9OUyZ2krzN19IZIwafSTFgIBnMV73ADj7V/K8u1MaY2sJp2HWm0f41tqwajEvdHWOJs510MaAqN4aoSiPCXtN2KSi46dUxHdaMquar82O1x5jqhDGvqmoE9LfxcY3zqA7/x3HA67r9ZG4O6Cuxu12/+TP+eLP+I+HErqDDCDVmBDO4larujNe7x8om2rMug0MX0rL1+IWwdwfR+p1TNTyNmVJ85ljWzbWuGv8/C7HD/izjkHNZNYlhZcUOKVzKFUxsxxN/kax+8zPWPSFKw80rJr9Tizyj3o1gEsdwgWGoxPezDdZ1TSENE1dLdNvuKL+I84nxKesZgxXVA1VA1OcL49dFlpFV5yJMhzyCmNQ+a4BqusPJ2bB+xo8V9u3x48VVIEPS/mc3DvAbXyoYr6VgDfh5do5hhHOCXMqBZUPhWYbWZECwVJljLgMUWOCB4MUuMaxGNUQDVI50TQ+S3kFgIcu2qKkNSHVoM0SHsgoZxP2d5HH8B9woOk4x5bPkKtAHucZsdykjxuIpbUrSILgrT8G7G5oCW+K0990o7E3T6AdW4TilH5kDjds+H64kS0mz24grtwlzDHBJqI8YJQExotPvoC4JBq0lEjjQkyBZ8oH2LnRsQ4Hu1QsgDTJbO8fQDnllitkxuVskoiKbRF9VwzMDvxHAdwB7mD9yCplhHFEyUWHx3WtwCbSMMTCUCcEmSGlg4gTXkHpZXWQ7kpznK3EmCHiXInqndkQjunG5kxTKEeGye7jWz9cyMR2mGiFQ15ENRBTbCp+Gh86vAyASdgmJq2MC6hoADQ3GosP0QHbnMHjyBQvQqfhy/BUbeHd5WY/G/9LK/8Ka8Jd7UFeNWEZvzPb458Dn8DGLOe3/wGL/4xP+HXlRt+M1PE2iLhR8t+lfgxsuh7AfO2AOf+owWhSZRYQbd622hbpKWKuU+XuvNzP0OseRDa+mObgDHJUSc/pKx31QdKffQ5OIJpt8GWjlgTwMc/w5MPCR/yl1XC2a2Yut54SvOtMev55Of45BOat9aWG27p2ZVORRvnEk1hqWMVUmqa7S2YtvlIpspuF1pt0syuZS2NV14mUidCSfzQzg+KqvIYCMljIx2YK2AO34fX4GWdu5xcIAb8MzTw+j/lyWM+Dw/gjs4GD6ehNgA48kX/AI7XXM/XAN4WHr+9ntywqoCakCqmKP0rmQrJJEErG2Upg1JObr01lKQy4jskWalKYfJ/EDLMpjNSHFEUAde2fltaDgmrNaWQ9+AAb8I5vKjz3L1n1LriB/BXkG/wwR9y/oRX4LlioHA4LzP2inzRx/DWmutRweFjeP3tNeSGlaE1Fde0OS11yOpmbIp2u/jF1n2RRZviJM0yBT3IZl2HWImKjQOxIyeU325b/qWyU9Moj1o07tS0G7qJDoGHg5m8yeCxMoEH8GU45tnrNM84D2l297DQ9t1YP7jki/7RmutRweEA77/HWXOh3HCxkRgldDQkAjNTMl2Iloc1qN5JfJeeTlyTRzxURTdn1Ixv2uKjs12AbdEWlBtmVdk2k7FFwj07PCZ9XAwW3dG+8xKzNFr4EnwBZpy9Qzhh3jDXebBpYcpuo4fQ44u+fD1dweEnHzI7v0xuuOALRUV8rXpFyfSTQYkhd7IHm07jpyhlkCmI0ALYqPTpUxXS+z4jgDj1Pflvmz5ecuItpIBxyTHpSTGWd9g1ApfD/bvwUhL4nT1EzqgX7cxfCcNmb3mPL/qi9SwTHJ49oj5ZLjccbTG3pRmlYi6JCG0mQrAt1+i2UXTZ2dv9IlQpN5naMYtviaXlTrFpoMsl3bOAFEa8sqPj2WCMrx3Yjx99qFwO59Aw/wgx+HlqNz8oZvA3exRDvuhL1jMQHPaOJ0+XyA3fp1OfM3qObEVdhxjvynxNMXQV4+GJyvOEFqeQBaIbbO7i63rpxCltdZShPFxkjM2FPVkn3TG+Rp9pO3l2RzFegGfxGDHIAh8SteR0C4HopXzRF61nheDw6TFN05Ebvq8M3VKKpGjjO6r7nhudTEGMtYM92HTDaR1FDMXJ1eThsbKfywyoWwrzRSXkc51flG3vIid62h29bIcFbTGhfV+faaB+ohj7dPN0C2e2lC96+XouFByen9AsunLDJZ9z7NExiUc0OuoYW6UZkIyx2YUR2z6/TiRjyKMx5GbbjLHvHuf7YmtKghf34LJfx63Yg8vrvN2zC7lY0x0tvKezo4HmGYDU+Gab6dFL+KI761lDcNifcjLrrr9LWZJctG1FfU1uwhoQE22ObjdfkSzY63CbU5hzs21WeTddH2BaL11Gi7lVdlxP1nkxqhnKhVY6knS3EPgVGg1JpN5cP/hivujOelhXcPj8HC/LyI6MkteVjlolBdMmF3a3DbsuAYhL44dxzthWSN065xxUd55Lmf0wRbOYOqH09/o9WbO2VtFdaMb4qBgtFJoT1SqoN8wPXMoXLb3p1PUEhxfnnLzGzBI0Ku7FxrKsNJj/8bn/H8fPIVOd3rfrklUB/DOeO+nkghgSPzrlPxluCMtOnDL4Yml6dK1r3vsgMxgtPOrMFUZbEUbTdIzii5beq72G4PD0DKnwjmBULUVFmy8t+k7fZ3pKc0Q4UC6jpVRqS9Umv8bxw35flZVOU1X7qkjnhZlsMbk24qQ6Hz7QcuL6sDC0iHHki96Uh2UdvmgZnjIvExy2TeJdMDZNSbdZyAHe/Yd1xsQhHiKzjh7GxQ4yqMPaywPkjMamvqrYpmO7Knad+ZQC5msCuAPWUoxrxVhrGv7a+KLXFhyONdTMrZ7ke23qiO40ZJUyzgYyX5XyL0mV7NiUzEs9mjtbMN0dERqwyAJpigad0B3/zRV7s4PIfXSu6YV/MK7+OrYe/JvfGMn/PHJe2fyUdtnFrKRNpXV0Y2559aWPt/G4BlvjTMtXlVIWCnNyA3YQBDmYIodFz41PvXPSa6rq9lWZawZ4dP115HXV/M/tnFkkrBOdzg6aP4pID+MZnTJ1SuuB6iZlyiox4HT2y3YBtkUKWooacBQUDTpjwaDt5poBHl1/HXltwP887lKKXxNUEyPqpGTyA699UqY/lt9yGdlUKra0fFWS+36iylVWrAyd7Uw0CZM0z7xKTOduznLIjG2Hx8cDPLb+OvK6Bv7n1DYci4CxUuRxrjBc0bb4vD3rN5Zz36ntLb83eVJIB8LiIzCmn6SMPjlX+yNlTjvIGjs+QzHPf60Aj62/jrzG8j9vYMFtm1VoRWCJdmw7z9N0t+c8cxZpPeK4aTRicS25QhrVtUp7U578chk4q04Wx4YoQSjFryUlpcQ1AbxZ/XVMknIU//OGl7Q6z9Zpxi0+3yFhSkjUDpnCIUhLWVX23KQ+L9vKvFKI0ZWFQgkDLvBoylrHNVmaw10zwCPrr5tlodfnf94EWnQ0lFRWy8pW9LbkLsyUVDc2NSTHGDtnD1uMtchjbCeb1mpxFP0YbcClhzdLu6lfO8Bj6q+bdT2sz/+8SZCV7VIxtt0DUn9L7r4cLYWDSXnseEpOGFuty0qbOVlS7NNzs5FOGJUqQpl2Q64/yBpZf90sxbE+//PGdZ02HSipCbmD6NItmQ4Lk5XUrGpDMkhbMm2ZVheNYV+VbUWTcv99+2NyX1VoafSuC+AN6q9bFIMv5X/eagNWXZxEa9JjlMwNWb00akGUkSoepp1/yRuuqHGbUn3UdBSTxBU6SEVklzWRUkPndVvw2PrrpjvxOvzPmwHc0hpmq82npi7GRro8dXp0KXnUQmhZbRL7NEVp1uuZmO45vuzKsHrktS3GLWXODVjw+vXXLYx4Hf7njRPd0i3aoAGX6W29GnaV5YdyDj9TFkakje7GHYzDoObfddHtOSpoi2SmzJHrB3hM/XUDDEbxP2/oosszcRlehWXUvzHv4TpBVktHqwenFo8uLVmy4DKLa5d3RtLrmrM3aMFr1183E4sewf+85VWeg1c5ag276NZrM9IJVNcmLEvDNaV62aq+14IAOGFsBt973Ra8Xv11YzXwNfmft7Jg2oS+XOyoC8/cwzi66Dhmgk38kUmP1CUiYWOX1bpD2zWXt2FCp7uq8703APAa9dfNdscR/M/bZLIyouVxqJfeWvG9Je+JVckHQ9+CI9NWxz+blX/KYYvO5n2tAP/vrlZ7+8/h9y+9qeB/Hnt967e5mevX10rALDWK//FaAT5MXdBXdP0C/BAes792c40H+AiAp1e1oH8HgH94g/Lttx1gp63op1eyoM/Bvw5/G/7xFbqJPcCXnmBiwDPb/YKO4FX4OjyCb289db2/Noqicw4i7N6TVtoz8tNwDH+8x/i6Ae7lmaQVENzJFb3Di/BFeAwz+Is9SjeQySpPqbLFlNmyz47z5a/AF+AYFvDmHqibSXTEzoT4Gc3OALaqAP4KPFUJ6n+1x+rGAM6Zd78bgJ0a8QN4GU614vxwD9e1Amy6CcskNrczLx1JIp6HE5UZD/DBHrFr2oNlgG4Odv226BodoryjGJ9q2T/AR3vQrsOCS0ctXZi3ruLlhpFDJYl4HmYtjQCP9rhdn4suySLKDt6wLcC52h8xPlcjju1fn+yhuw4LZsAGUuo2b4Fx2UwQu77uqRHXGtg92aN3tQCbFexc0uk93vhTXbct6y7MulLycoUljx8ngDMBg1tvJjAazpEmOtxlzclvj1vQf1Tx7QlPDpGpqgtdSKz/d9/hdy1vTfFHSmC9dGDZbLiezz7Ac801HirGZsWjydfZyPvHXL/Y8Mjzg8BxTZiuwKz4Eb8sBE9zznszmjvFwHKPIWUnwhqfVRcd4Ck0K6ate48m1oOfrX3/yOtvAsJ8zsPAM89sjnddmuLuDPjX9Bu/L7x7xpMzFk6nWtyQfPg278Gn4Aekz2ZgOmU9eJ37R14vwE/BL8G3aibCiWMWWDQ0ZtkPMnlcGeAu/Ag+8ZyecU5BPuy2ILD+sQqyZhAKmn7XZd+jIMTN9eBL7x95xVLSX4On8EcNlXDqmBlqS13jG4LpmGbkF/0CnOi3H8ETOIXzmnmtb0a16Tzxj1sUvQCBiXZGDtmB3KAefPH94xcUa/6vwRn80GOFyjEXFpba4A1e8KQfFF+259tx5XS4egYn8fQsLGrqGrHbztr+uByTahWuL1NUGbDpsnrwBfePPwHHIf9X4RnM4Z2ABWdxUBlqQ2PwhuDxoS0vvqB1JzS0P4h2nA/QgTrsJFn+Y3AOjs9JFC07CGWX1oNX3T/yHOzgDjwPn1PM3g9Jk9lZrMEpxnlPmBbjyo2+KFXRU52TJM/2ALcY57RUzjObbjqxVw++4P6RAOf58pcVsw9Daje3htriYrpDOonre3CudSe6bfkTEgHBHuDiyu5MCsc7BHhYDx7ePxLjqigXZsw+ijMHFhuwBmtoTPtOxOrTvYJDnC75dnUbhfwu/ZW9AgYd+peL68HD+0emKquiXHhWjJg/UrkJYzuiaL3E9aI/ytrCvAd4GcYZMCkSQxfUg3v3j8c4e90j5ZTPdvmJJGHnOCI2nHS8081X013pHuBlV1gB2MX1YNmWLHqqGN/TWmG0y6clJWthxNUl48q38Bi8vtMKyzzpFdSDhxZ5WBA5ZLt8Jv3895DduBlgbPYAj8C4B8hO68FDkoh5lydC4FiWvBOVqjYdqjiLv92t8yPDjrDaiHdUD15qkSURSGmXJwOMSxWAXYwr3zaAufJ66l+94vv3AO+vPcD7aw/w/toDvL/2AO+vPcD7aw/wHuD9tQd4f+0B3l97gPfXHuD9tQd4f+0B3l97gG8LwP8G/AL8O/A5OCq0Ys2KIdv/qOIXG/4mvFAMF16gZD+2Xvu/B8as5+8bfllWyg0zaNO5bfXj6vfhhwD86/Aq3NfRS9t9WPnhfnvCIw/CT8GLcFTMnpntdF/z9V+PWc/vWoIH+FL3Znv57PitcdGP4R/C34avw5fgRVUInCwbsn1yyA8C8zm/BH8NXoXnVE6wVPjdeCI38kX/3+Ct9dbz1pTmHFRu+Hm4O9Ch3clr99negxfwj+ER/DR8EV6B5+DuQOnTgUw5rnkY+FbNU3gNXh0o/JYTuWOvyBf9FvzX663HH/HejO8LwAl8Hl5YLTd8q7sqA3wbjuExfAFegQdwfyDoSkWY8swzEf6o4Qyewefg+cHNbqMQruSL/u/WWc+E5g7vnnEXgDmcDeSGb/F4cBcCgT+GGRzDU3hZYburAt9TEtHgbM6JoxJ+6NMzzTcf6c2bycv2+KK/f+l6LBzw5IwfqZJhA3M472pWT/ajKxnjv4AFnMEpnBTPND6s2J7qHbPAqcMK74T2mZ4VGB9uJA465It+/eL1WKhYOD7xHOkr1ajK7d0C4+ke4Hy9qXZwpgLr+Znm/uNFw8xQOSy8H9IzjUrd9+BIfenYaylf9FsXr8fBAadnPIEDna8IBcwlxnuA0/Wv6GAWPd7dDIKjMdSWueAsBj4M7TOd06qBbwDwKr7oleuxMOEcTuEZTHWvDYUO7aHqAe0Bbq+HEFRzOz7WVoTDQkVds7A4sIIxfCQdCefFRoIOF/NFL1mPab/nvOakSL/Q1aFtNpUb/nFOVX6gzyg/1nISyDfUhsokIzaBR9Kxm80s5mK+6P56il1jXic7nhQxsxSm3OwBHl4fFdLqi64nDQZvqE2at7cWAp/IVvrN6/BFL1mPhYrGMBfOi4PyjuSGf6wBBh7p/FZTghCNWGgMzlBbrNJoPJX2mW5mwZfyRffXo7OFi5pZcS4qZUrlViptrXtw+GQoyhDPS+ANjcGBNRiLCQDPZPMHuiZfdFpPSTcQwwKYdRNqpkjm7AFeeT0pJzALgo7g8YYGrMHS0iocy+YTm2vyRUvvpXCIpQ5pe666TJrcygnScUf/p0NDs/iAI/nqDHC8TmQT8x3NF91l76oDdQGwu61Z6E0ABv7uO1dbf/37Zlv+Zw/Pbh8f1s4Avur6657/+YYBvur6657/+YYBvur6657/+YYBvur6657/+aYBvuL6657/+VMA8FXWX/f8zzcN8BXXX/f8zzcNMFdbf93zP38KLPiK6697/uebtuArrr/u+Z9vGmCusP6653/+1FjwVdZf9/zPN7oHX339dc//fNMu+irrr3v+50+Bi+Zq6697/uebA/jz8Pudf9ht/fWv517J/XUzAP8C/BAeX9WCDrUpZ3/dEMBxgPcfbtTVvsYV5Yn32u03B3Ac4P3b8I+vxNBKeeL9dRMAlwO83959qGO78sT769oB7g3w/vGVYFzKE++v6wV4OMD7F7tckFkmT7y/rhHgpQO8b+4Y46XyxPvrugBeNcB7BRiX8sT767oAvmCA9woAHsoT76+rBJjLBnh3txOvkifeX1dswZcO8G6N7sXyxPvr6i340gHe3TnqVfLE++uKAb50gHcXLnrX8sR7gNdPRqwzwLu7Y/FO5Yn3AK9jXCMGeHdgxDuVJ75VAI8ljP7PAb3/RfjcZfePHBB+79dpfpH1CanN30d+mT1h9GqAxxJGM5LQeeQ1+Tb+EQJrElLb38VHQ94TRq900aMIo8cSOo+8Dp8QfsB8zpqE1NO3OI9Zrj1h9EV78PqE0WMJnUdeU6E+Jjyk/hbrEFIfeWbvId8H9oTRFwdZaxJGvziW0Hn0gqYB/wyZ0PwRlxJST+BOw9m77Amj14ii1yGM/txYQudN0qDzGe4EqfA/5GJCagsHcPaEPWH0esekSwmjRxM6b5JEcZ4ww50ilvAOFxBSx4yLW+A/YU8YvfY5+ALC6NGEzhtmyZoFZoarwBLeZxUhtY4rc3bKnjB6TKJjFUHzJoTOozF2YBpsjcyxDgzhQ1YRUse8+J4wenwmaylB82hC5w0zoRXUNXaRBmSMQUqiWSWkLsaVqc/ZE0aPTFUuJWgeTei8SfLZQeMxNaZSIzbII4aE1Nmr13P2hNHjc9E9guYNCZ032YlNwESMLcZiLQHkE4aE1BFg0yAR4z1h9AiAGRA0jyZ03tyIxWMajMPWBIsxYJCnlITU5ShiHYdZ94TR4wCmSxg9jtB5KyPGYzymAYexWEMwAPIsAdYdV6aObmNPGD0aYLoEzaMJnTc0Ygs+YDw0GAtqxBjkuP38bMRWCHn73xNGjz75P73WenCEJnhwyVe3AEe8TtKdJcYhBl97wuhNAObK66lvD/9J9NS75v17wuitAN5fe4D31x7g/bUHeH/tAd5fe4D3AO+vPcD7aw/w/toDvL/2AO+vPcD7aw/w/toDvAd4f/24ABzZ8o+KLsSLS+Pv/TqTb3P4hKlQrTGh+fbIBT0Axqznnb+L/V2mb3HkN5Mb/nEHeK7d4IcDld6lmDW/iH9E+AH1MdOw/Jlu2T1xNmY98sv4wHnD7D3uNHu54WUuOsBTbQuvBsPT/UfzNxGYzwkP8c+Yz3C+r/i6DcyRL/rZ+utRwWH5PmfvcvYEt9jLDS/bg0/B64DWKrQM8AL8FPwS9beQCe6EMKNZYJol37jBMy35otdaz0Bw2H/C2Smc7+WGB0HWDELBmOByA3r5QONo4V+DpzR/hFS4U8wMW1PXNB4TOqYz9urxRV++ntWCw/U59Ty9ebdWbrgfRS9AYKKN63ZokZVygr8GZ/gfIhZXIXPsAlNjPOLBby5c1eOLvmQ9lwkOy5x6QV1j5TYqpS05JtUgUHUp5toHGsVfn4NX4RnMCe+AxTpwmApTYxqMxwfCeJGjpXzRF61nbcHhUBPqWze9svwcHJ+S6NPscKrEjug78Dx8Lj3T8D4YxGIdxmJcwhi34fzZUr7olevZCw5vkOhoClq5zBPZAnygD/Tl9EzDh6kl3VhsHYcDEb+hCtJSvuiV69kLDm+WycrOTArHmB5/VYyP6jOVjwgGawk2zQOaTcc1L+aLXrKeveDwZqlKrw8U9Y1p66uK8dEzdYwBeUQAY7DbyYNezBfdWQ97weEtAKYQg2xJIkuveAT3dYeLGH+ShrWNwZgN0b2YL7qznr3g8JYAo5bQBziPjx7BPZ0d9RCQp4UZbnFdzBddor4XHN4KYMrB2qHFRIzzcLAHQZ5the5ovui94PCWAPefaYnxIdzRwdHCbuR4B+tbiy96Lzi8E4D7z7S0mEPd+eqO3cT53Z0Y8SV80XvB4Z0ADJi/f7X113f+7p7/+UYBvur6657/+YYBvur6657/+aYBvuL6657/+aYBvuL6657/+aYBvuL6657/+aYBvuL6657/+VMA8FXWX/f8z58OgK+y/rrnf75RgLna+uue//lTA/CV1V/3/M837aKvvv6653++UQvmauuve/7nTwfAV1N/3fM/fzr24Cuuv+75nz8FFnxl9dc9//MOr/8/glixwRuUfM4AAAAASUVORK5CYII="}function git(){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAAAhCAAAAABIXyLAAAAAOElEQVRIx2NgGAWjYBSMglEwEICREYRgFBZBqDCSLA2MGPUIVQETE9iNUAqLR5gIeoQKRgwXjwAAGn4AtaFeYLEAAAAASUVORK5CYII="}var AIe=`
precision mediump float;
precision mediump samplerCube;
precision mediump sampler2D;

#if defined(dVariant_skybox)
    uniform samplerCube tSkybox;
    uniform mat4 uViewDirectionProjectionInverse;
    uniform float uBlur;
    uniform float uOpacity;
    uniform float uSaturation;
    uniform float uLightness;
    uniform mat3 uRotation;
#elif defined(dVariant_image)
    uniform sampler2D tImage;
    uniform vec2 uImageScale;
    uniform vec2 uImageOffset;
    uniform float uBlur;
    uniform float uOpacity;
    uniform float uSaturation;
    uniform float uLightness;
#elif defined(dVariant_horizontalGradient) || defined(dVariant_radialGradient)
    uniform vec3 uGradientColorA;
    uniform vec3 uGradientColorB;
    uniform float uGradientRatio;
#endif

uniform vec2 uTexSize;
uniform vec4 uViewport;
uniform bool uViewportAdjusted;
varying vec4 vPosition;

// TODO: add as general pp option to remove banding?
// Iestyn's RGB dither from http://alex.vlachos.com/graphics/Alex_Vlachos_Advanced_VR_Rendering_GDC2015.pdf
vec3 ScreenSpaceDither(vec2 vScreenPos) {
    vec3 vDither = vec3(dot(vec2(171.0, 231.0), vScreenPos.xy));
    vDither.rgb = fract(vDither.rgb / vec3(103.0, 71.0, 97.0));
    return vDither.rgb / 255.0;
}

vec3 saturateColor(vec3 c, float amount) {
    // https://www.w3.org/TR/WCAG21/#dfn-relative-luminance
    const vec3 W = vec3(0.2125, 0.7154, 0.0721);
    vec3 intensity = vec3(dot(c, W));
    return mix(intensity, c, 1.0 + amount);
}

vec3 lightenColor(vec3 c, float amount) {
    return c + amount;
}

void main() {
    #if defined(dVariant_skybox)
        vec4 t = uViewDirectionProjectionInverse * vPosition;
        #ifdef enabledShaderTextureLod
            gl_FragColor = textureCubeLodEXT(tSkybox, uRotation * normalize(t.xyz / t.w), uBlur * 8.0);
        #else
            gl_FragColor = textureCube(tSkybox, uRotation * normalize(t.xyz / t.w));
        #endif
        gl_FragColor.a = uOpacity;
        gl_FragColor.rgb = lightenColor(saturateColor(gl_FragColor.rgb, uSaturation), uLightness);
    #elif defined(dVariant_image)
        vec2 coords;
        if (uViewportAdjusted) {
            coords = ((gl_FragCoord.xy - uViewport.xy) * (uTexSize / uViewport.zw) / uImageScale) + uImageOffset;
        } else {
            coords = (gl_FragCoord.xy / uImageScale) + uImageOffset;
        }
        #ifdef enabledShaderTextureLod
            gl_FragColor = texture2DLodEXT(tImage, vec2(coords.x, 1.0 - coords.y), uBlur * 8.0);
        #else
            gl_FragColor = texture2D(tImage, vec2(coords.x, 1.0 - coords.y));
        #endif
        gl_FragColor.a = uOpacity;
        gl_FragColor.rgb = lightenColor(saturateColor(gl_FragColor.rgb, uSaturation), uLightness);
    #elif defined(dVariant_horizontalGradient)
        float d;
        if (uViewportAdjusted) {
            d = ((gl_FragCoord.y - uViewport.y) * (uTexSize.y / uViewport.w) / uTexSize.y) + 1.0 - (uGradientRatio * 2.0);
        } else {
            d = (gl_FragCoord.y / uTexSize.y) + 1.0 - (uGradientRatio * 2.0);
        }
        gl_FragColor = vec4(mix(uGradientColorB, uGradientColorA, clamp(d, 0.0, 1.0)), 1.0);
        gl_FragColor.rgb += ScreenSpaceDither(gl_FragCoord.xy);
    #elif defined(dVariant_radialGradient)
        float d;
        if (uViewportAdjusted) {
            d = distance(vec2(0.5), (gl_FragCoord.xy - uViewport.xy) * (uTexSize / uViewport.zw) / uTexSize) + uGradientRatio - 0.5;
        } else {
            d = distance(vec2(0.5), gl_FragCoord.xy / uTexSize) + uGradientRatio - 0.5;
        }
        gl_FragColor = vec4(mix(uGradientColorB, uGradientColorA, 1.0 - clamp(d, 0.0, 1.0)), 1.0);
        gl_FragColor.rgb += ScreenSpaceDither(gl_FragCoord.xy);
    #endif
}
`;var TIe=`
precision mediump float;

attribute vec2 aPosition;

varying vec4 vPosition;

void main() {
    vPosition = vec4(aPosition, 1.0, 1.0);
    gl_Position = vec4(aPosition, 1.0, 1.0);
}
`;function YR(){return YR.zero()}(d=>{function e(){let p=[.1,0,0];return p[0]=0,p}d.zero=e;function t(p,h,f){let g=e();return g[0]=p,g[1]=h,g[2]=f,g}d.create=t;function r(p,h,f,g){return p[0]=h,p[0]=f,p[0]=g,p}d.set=r;function n(p){let h=e();return h[0]=p[0],h[1]=p[1],h[2]=p[2],h}d.clone=n;function o(p,h){return p[0]=h[0],p[1]=h[1],p[2]=h[2],p}d.copy=o;function i(p,h,f){let g=h[0],y=h[4],x=h[8],S=h[1],I=h[5],v=h[9],A=h[2],P=h[6],T=h[10];switch(f){case"XYZ":p[1]=Math.asin(_r(x,-1,1)),Math.abs(x)<.9999999?(p[0]=Math.atan2(-v,T),p[2]=Math.atan2(-y,g)):(p[0]=Math.atan2(P,I),p[2]=0);break;case"YXZ":p[0]=Math.asin(-_r(v,-1,1)),Math.abs(v)<.9999999?(p[1]=Math.atan2(x,T),p[2]=Math.atan2(S,I)):(p[1]=Math.atan2(-A,g),p[2]=0);break;case"ZXY":p[0]=Math.asin(_r(P,-1,1)),Math.abs(P)<.9999999?(p[1]=Math.atan2(-A,T),p[2]=Math.atan2(-y,I)):(p[1]=0,p[2]=Math.atan2(S,g));break;case"ZYX":p[1]=Math.asin(-_r(A,-1,1)),Math.abs(A)<.9999999?(p[0]=Math.atan2(P,T),p[2]=Math.atan2(S,g)):(p[0]=0,p[2]=Math.atan2(-y,I));break;case"YZX":p[2]=Math.asin(_r(S,-1,1)),Math.abs(S)<.9999999?(p[0]=Math.atan2(-v,I),p[1]=Math.atan2(-A,g)):(p[0]=0,p[1]=Math.atan2(x,T));break;case"XZY":p[2]=Math.asin(-_r(y,-1,1)),Math.abs(y)<.9999999?(p[0]=Math.atan2(P,I),p[1]=Math.atan2(x,g)):(p[0]=Math.atan2(-v,T),p[1]=0);break;default:Mr(f)}return p}d.fromMat4=i;let a=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];function s(p,h,f){return H.fromQuat(a,h),i(p,a,f)}d.fromQuat=s;function l(p,h){return r(p,h[0],h[1],h[2])}d.fromVec3=l;function u(p,h){return p[0]===h[0]&&p[1]===h[1]&&p[2]===h[2]}d.exactEquals=u;function c(p,h,f){return p[0]=h[f+0],p[1]=h[f+1],p[2]=h[f+2],p}d.fromArray=c;function m(p,h,f){return h[f+0]=p[0],h[f+1]=p[1],h[f+2]=p[2],h}d.toArray=m})(YR||={});var wIe={opacity:C.Numeric(1,{min:0,max:1,step:.01}),saturation:C.Numeric(0,{min:-1,max:1,step:.01}),lightness:C.Numeric(0,{min:-1,max:1,step:.01})},yit={faces:C.MappedStatic("urls",{urls:C.Group({nx:C.Text("",{label:"Negative X / Left"}),ny:C.Text("",{label:"Negative Y / Bottom"}),nz:C.Text("",{label:"Negative Z / Back"}),px:C.Text("",{label:"Positive X / Right"}),py:C.Text("",{label:"Positive Y / Top"}),pz:C.Text("",{label:"Positive Z / Front"})},{isExpanded:!0,label:"URLs"}),files:C.Group({nx:C.File({label:"Negative X / Left",accept:"image/*"}),ny:C.File({label:"Negative Y / Bottom",accept:"image/*"}),nz:C.File({label:"Negative Z / Back",accept:"image/*"}),px:C.File({label:"Positive X / Right",accept:"image/*"}),py:C.File({label:"Positive Y / Top",accept:"image/*"}),pz:C.File({label:"Positive Z / Front",accept:"image/*"})},{isExpanded:!0,label:"Files"})}),blur:C.Numeric(0,{min:0,max:1,step:.01},{description:'Note, this only works in WebGL2 or when "EXT_shader_texture_lod" is available.'}),rotation:C.Group({x:C.Numeric(0,{min:0,max:360,step:1},{immediateUpdate:!0}),y:C.Numeric(0,{min:0,max:360,step:1},{immediateUpdate:!0}),z:C.Numeric(0,{min:0,max:360,step:1},{immediateUpdate:!0})}),...wIe},bit={source:C.MappedStatic("url",{url:C.Text(""),file:C.File({accept:"image/*"})}),blur:C.Numeric(0,{min:0,max:1,step:.01},{description:'Note, this only works in WebGL2 or with power-of-two images and when "EXT_shader_texture_lod" is available.'}),...wIe,coverage:C.Select("viewport",C.arrayToOptions(["viewport","canvas"]))},xit={topColor:C.Color(14540253),bottomColor:C.Color(15658734),ratio:C.Numeric(.5,{min:0,max:1,step:.01}),coverage:C.Select("viewport",C.arrayToOptions(["viewport","canvas"]))},Cit={centerColor:C.Color(14540253),edgeColor:C.Color(15658734),ratio:C.Numeric(.5,{min:0,max:1,step:.01}),coverage:C.Select("viewport",C.arrayToOptions(["viewport","canvas"]))},wL={variant:C.MappedStatic("off",{off:C.EmptyGroup(),skybox:C.Group(yit,{isExpanded:!0}),image:C.Group(bit,{isExpanded:!0}),horizontalGradient:C.Group(xit,{isExpanded:!0}),radialGradient:C.Group(Cit,{isExpanded:!0})},{label:"Environment"})},DL=class{constructor(t,r,n,o){this.webgl=t;this.assetManager=r;this.camera=new ro;this.target=b();this.position=b();this.dir=b();this.bgColor=b();this.renderable=Dit(t,n,o)}setSize(t,r){let[n,o]=this.renderable.values.uTexSize.ref.value;(t!==n||r!==o)&&_.update(this.renderable.values.uTexSize,Ce.set(this.renderable.values.uTexSize.ref.value,t,r))}clearSkybox(){this.skybox!==void 0&&(this.skybox.texture.destroy(),this.skybox.assets.forEach(t=>this.assetManager.release(t)),this.skybox=void 0)}updateSkybox(t,r,n){let o=this.skybox?.props.faces,i=r.faces.params;if(!i.nx||!i.ny||!i.nz||!i.px||!i.py||!i.pz){this.clearSkybox(),n?.(!1);return}if(!this.skybox||!o||!Iit(r.faces,this.skybox.props.faces)){this.clearSkybox();let{texture:u,assets:c}=Ait(this.webgl,this.assetManager,r.faces,m=>{this.skybox&&(this.skybox.loaded=!m),n?.(!0)});this.skybox={texture:u,props:{...r},assets:c,loaded:!1},_.update(this.renderable.values.tSkybox,u),this.renderable.update()}else n?.(!1);if(!this.skybox)return;let a=t;t.state.mode==="orthographic"&&(this.camera.setState({...t.state,mode:"perspective"}),this.camera.update(),a=this.camera);let s=this.renderable.values.uViewDirectionProjectionInverse.ref.value;H.isZero(t.headRotation)?(b.sub(this.dir,a.state.position,a.state.target),b.setMagnitude(this.dir,this.dir,.1),b.copy(this.position,this.dir),H.lookAt(s,this.position,this.target,a.state.up)):H.invert(s,t.headRotation),H.mul(s,a.projection,s),H.invert(s,s),_.update(this.renderable.values.uViewDirectionProjectionInverse,s);let l=this.renderable.values.uRotation.ref.value;Mt.fromEuler(l,YR.create(kr(r.rotation.x),kr(r.rotation.y),kr(r.rotation.z)),"XYZ"),_.update(this.renderable.values.uRotation,l),_.updateIfChanged(this.renderable.values.uBlur,r.blur),_.updateIfChanged(this.renderable.values.uOpacity,r.opacity),_.updateIfChanged(this.renderable.values.uSaturation,r.saturation),_.updateIfChanged(this.renderable.values.uLightness,r.lightness),_.updateIfChanged(this.renderable.values.dVariant,"skybox"),this.renderable.update()}clearImage(){this.image!==void 0&&(this.image.texture.destroy(),this.assetManager.release(this.image.asset),this.image=void 0)}updateImage(t,r){if(!t.source.params){this.clearImage(),r?.(!1);return}if(!this.image||!this.image.props.source.params||!Tit(t.source,this.image.props.source)){this.clearImage();let{texture:n,asset:o}=Pit(this.webgl,this.assetManager,t.source,i=>{this.image&&(this.image.loaded=!i),r?.(!0)});this.image={texture:n,props:{...t},asset:o,loaded:!1},_.update(this.renderable.values.tImage,n),this.renderable.update()}else r?.(!1);this.image&&(_.updateIfChanged(this.renderable.values.uBlur,t.blur),_.updateIfChanged(this.renderable.values.uOpacity,t.opacity),_.updateIfChanged(this.renderable.values.uSaturation,t.saturation),_.updateIfChanged(this.renderable.values.uLightness,t.lightness),_.updateIfChanged(this.renderable.values.uViewportAdjusted,t.coverage==="viewport"),_.updateIfChanged(this.renderable.values.dVariant,"image"),this.renderable.update())}updateImageScaling(){let t=this.renderable.values,[r,n]=t.uTexSize.ref.value,o=this.image?.texture.getWidth()||0,i=this.image?.texture.getHeight()||0,a=r/n,s=o/i;a<s?_.update(t.uImageScale,Ce.set(t.uImageScale.ref.value,o*n/i,n)):_.update(t.uImageScale,Ce.set(t.uImageScale.ref.value,r,i*r/o));let[l,u]=t.uImageScale.ref.value,c=l/u;c>a?_.update(t.uImageOffset,Ce.set(t.uImageOffset.ref.value,(1-a/c)/2,0)):_.update(t.uImageOffset,Ce.set(t.uImageOffset.ref.value,0,(1-c/a)/2))}updateGradient(t,r,n,o,i){_.update(this.renderable.values.uGradientColorA,Le.toVec3Normalized(this.renderable.values.uGradientColorA.ref.value,t)),_.update(this.renderable.values.uGradientColorB,Le.toVec3Normalized(this.renderable.values.uGradientColorB.ref.value,r)),_.updateIfChanged(this.renderable.values.uGradientRatio,n),_.updateIfChanged(this.renderable.values.uViewportAdjusted,i),_.updateIfChanged(this.renderable.values.dVariant,o),this.renderable.update()}update(t,r,n){if(r.variant.name==="off"){this.clearSkybox(),this.clearImage(),n?.(!1);return}else r.variant.name==="skybox"?(this.clearImage(),this.updateSkybox(t,r.variant.params,n)):r.variant.name==="image"?(this.clearSkybox(),this.updateImage(r.variant.params,n)):r.variant.name==="horizontalGradient"?(this.clearSkybox(),this.clearImage(),this.updateGradient(r.variant.params.topColor,r.variant.params.bottomColor,r.variant.params.ratio,r.variant.name,r.variant.params.coverage==="viewport"),n?.(!1)):r.variant.name==="radialGradient"&&(this.clearSkybox(),this.clearImage(),this.updateGradient(r.variant.params.centerColor,r.variant.params.edgeColor,r.variant.params.ratio,r.variant.name,r.variant.params.coverage==="viewport"),n?.(!1));let{x:o,y:i,width:a,height:s}=t.viewport;_.update(this.renderable.values.uViewport,Et.set(this.renderable.values.uViewport.ref.value,o,i,a,s))}_isEnabled(t){return!!(this.skybox&&this.skybox.loaded||this.image&&this.image.loaded||t.variant.name==="horizontalGradient"||t.variant.name==="radialGradient")}isEnabled(t){return t.enabled&&this._isEnabled(t.background)}isReady(){return!!(this.skybox&&this.skybox.loaded||this.image&&this.image.loaded||this.renderable.values.dVariant.ref.value==="horizontalGradient"||this.renderable.values.dVariant.ref.value==="radialGradient")}clear(t,r,n){let{gl:o,state:i}=this.webgl;this._isEnabled(t)?(r?i.clearColor(0,0,0,0):(Le.toVec3Normalized(this.bgColor,n),i.clearColor(this.bgColor[0],this.bgColor[1],this.bgColor[2],1)),o.clear(o.COLOR_BUFFER_BIT),i.enable(o.BLEND),i.blendFuncSeparate(o.SRC_ALPHA,o.ONE_MINUS_SRC_ALPHA,o.ONE,o.ONE_MINUS_SRC_ALPHA)):(i.clearColor(0,0,0,1),o.clear(o.COLOR_BUFFER_BIT))}render(t){!this._isEnabled(t)||!this.isReady()||(this.renderable.values.dVariant.ref.value==="image"&&this.updateImageScaling(),je&&this.webgl.timer.mark("BackgroundPass.render"),this.renderable.render(),je&&this.webgl.timer.markEnd("BackgroundPass.render"))}dispose(){this.clearSkybox(),this.clearImage()}},PIe="background-skybox";function Sit(e,t){return t.name==="urls"?{nx:sn.getUrlAsset(e,t.params.nx),ny:sn.getUrlAsset(e,t.params.ny),nz:sn.getUrlAsset(e,t.params.nz),px:sn.getUrlAsset(e,t.params.px),py:sn.getUrlAsset(e,t.params.py),pz:sn.getUrlAsset(e,t.params.pz)}:{nx:t.params.nx,ny:t.params.ny,nz:t.params.nz,px:t.params.px,py:t.params.py,pz:t.params.pz}}function vit(e,t){let r=n=>e.resolve(n,"binary").run().then(o=>new Blob([o.data]));return{nx:r(t.nx),ny:r(t.ny),nz:r(t.nz),px:r(t.px),py:r(t.py),pz:r(t.pz)}}function _Ie(e){return e.name==="urls"?`${PIe}_${e.params.nx}|${e.params.ny}|${e.params.nz}|${e.params.px}|${e.params.py}|${e.params.pz}`:`${PIe}_${e.params.nx?.id}|${e.params.ny?.id}|${e.params.nz?.id}|${e.params.px?.id}|${e.params.py?.id}|${e.params.pz?.id}`}function Iit(e,t){return _Ie(e)===_Ie(t)}function Ait(e,t,r,n){let o=Sit(t,r),i=vit(t,o),a=[o.nx,o.ny,o.nz,o.px,o.py,o.pz];return typeof HTMLImageElement>"u"?(console.error('Missing "HTMLImageElement" required for background skybox'),n?.(!0),{texture:qo(),assets:a}):{texture:e.resources.cubeTexture(i,!0,n),assets:a}}var RIe="background-image";function DIe(e){return e.name==="url"?`${RIe}_${e.params}`:`${RIe}_${e.params?.id}`}function Tit(e,t){return DIe(e)===DIe(t)}function Pit(e,t,r,n){let o=r.name==="url"?t.tryFindFilename(r.params)??sn.getUrlAsset(t,r.params):r.params;if(typeof HTMLImageElement>"u")return console.error('Missing "HTMLImageElement" required for background image'),n?.(!0),{texture:qo(),asset:o};let i=e.resources.texture("image-uint8","rgba","ubyte","linear"),a=new Image;return a.onload=()=>{i.load(a),(e.isWebGL2||Ix(a.width)&&Ix(a.height))&&i.mipmap(),n?.()},a.onerror=()=>{n?.(!0)},t.resolve(o,"binary").run().then(s=>{let l=new Blob([s.data]);a.src=URL.createObjectURL(l)}),{texture:i,asset:o}}var _it={drawCount:Qn("number"),instanceCount:Qn("number"),aPosition:Vn("float32",2,0),tSkybox:yt("texture","rgba","ubyte","linear"),tImage:yt("texture","rgba","ubyte","linear"),uImageScale:de("v2"),uImageOffset:de("v2"),uTexSize:de("v2"),uViewport:de("v4"),uViewportAdjusted:de("b"),uViewDirectionProjectionInverse:de("m4"),uGradientColorA:de("v3"),uGradientColorB:de("v3"),uGradientRatio:de("f"),uBlur:de("f"),uOpacity:de("f"),uSaturation:de("f"),uLightness:de("f"),uRotation:de("m3"),dVariant:dt("string",["skybox","image","verticalGradient","horizontalGradient","radialGradient"])},Rit=zr("background",TIe,AIe,{shaderTextureLod:"optional"});function Dit(e,t,r){let n={drawCount:_.create(6),instanceCount:_.create(1),aPosition:_.create(dR),tSkybox:_.create(qo()),tImage:_.create(qo()),uImageScale:_.create(Ce()),uImageOffset:_.create(Ce()),uTexSize:_.create(Ce.create(t,r)),uViewport:_.create(Et()),uViewportAdjusted:_.create(!0),uViewDirectionProjectionInverse:_.create(H()),uGradientColorA:_.create(b()),uGradientColorB:_.create(b()),uGradientRatio:_.create(.5),uBlur:_.create(0),uOpacity:_.create(1),uSaturation:_.create(0),uLightness:_.create(0),uRotation:_.create(Mt.identity()),dVariant:_.create("skybox")},o={..._it},i=on(e,"triangles",Rit,o,n);return an(i,n)}var MIe=`
precision mediump float;
precision mediump sampler2D;

uniform sampler2D tColor;
uniform vec2 uTexSizeInv;

uniform float uSharpness;

// adapted from https://www.shadertoy.com/view/stXSWB

/*
* FidelityFX Super Resolution scales up a low resolution
* image, while adding fine detail.
*
* MIT Open License
*
* https://gpuopen.com/fsr
*
* Left: FSR processed
* Right: Original texture, bilinear interpolation
*
* Mouse at top: Sharpness 0 stops (maximum)
* Mouse at bottom: Sharpness 2 stops (minimum)
*
* It works in two passes-
*   EASU upsamples the image with a clamped Lanczos kernel.
*   RCAS sharpens the image at the target resolution.
*
* I needed to make a few changes to improve readability and
* WebGL compatibility in an algorithm I don't fully understand.
* Expect bugs.
*
* Shader not currently running for WebGL1 targets (eg. mobile Safari)
*
* There is kind of no point to using FSR in Shadertoy, as it renders buffers
* at full target resolution. But this might be useful for WebGL based demos
* running smaller-than-target render buffers.
*
* For sharpening with a full resolution render buffer,
* FidelityFX CAS is a better option.
* https://www.shadertoy.com/view/ftsXzM
*
* For readability and compatibility, these optimisations have been removed:
*   * Fast approximate inverse and inversesqrt
*   * textureGather fetches (not WebGL compatible)
*   * Multiplying by reciprocal instead of division
*
* Apologies to AMD for the numerous slowdowns and errors I have introduced.
*
*/

/***** RCAS *****/
#define FSR_RCAS_LIMIT (0.25-(1.0/16.0))

// Input callback prototypes that need to be implemented by calling shader
vec4 FsrRcasLoadF(vec2 p);
//------------------------------------------------------------------------------------------------------------------------------
void FsrRcasCon(
    out float con,
    // The scale is {0.0 := maximum, to N>0, where N is the number of stops (halving) of the reduction of sharpness}.
    float sharpness
) {
    // Transform from stops to linear value.
    con = exp2(-sharpness);
}

vec3 FsrRcasF(
    vec2 ip, // Integer pixel position in output.
    float con
) {
    // Constant generated by RcasSetup().
    // Algorithm uses minimal 3x3 pixel neighborhood.
    //    b
    //  d e f
    //    h
    vec2 sp = vec2(ip);
    vec3 b = FsrRcasLoadF(sp + vec2( 0,-1)).rgb;
    vec3 d = FsrRcasLoadF(sp + vec2(-1, 0)).rgb;
    vec3 e = FsrRcasLoadF(sp).rgb;
    vec3 f = FsrRcasLoadF(sp + vec2( 1, 0)).rgb;
    vec3 h = FsrRcasLoadF(sp + vec2( 0, 1)).rgb;

    // Luma times 2.
    float bL = b.g + .5 * (b.b + b.r);
    float dL = d.g + .5 * (d.b + d.r);
    float eL = e.g + .5 * (e.b + e.r);
    float fL = f.g + .5 * (f.b + f.r);
    float hL = h.g + .5 * (h.b + h.r);

    // Noise detection.
    #ifdef dDenoise
        float nz = .25 * (bL + dL + fL + hL) - eL;
        nz=clamp(
            abs(nz)
            /(
                max(max(bL,dL),max(eL,max(fL,hL)))
                -min(min(bL,dL),min(eL,min(fL,hL)))
            ),
            0., 1.
        );
        nz=1.-.5*nz;
    #endif

    // Min and max of ring.
    vec3 mn4 = min(b, min(f, h));
    vec3 mx4 = max(b, max(f, h));

    // Immediate constants for peak range.
    vec2 peakC = vec2(1., -4.);

    // Limiters, these need to be high precision RCPs.
    vec3 hitMin = mn4 / (4. * mx4);
    vec3 hitMax = (peakC.x - mx4) / (4.* mn4 + peakC.y);
    vec3 lobeRGB = max(-hitMin, hitMax);
    float lobe = max(
        -FSR_RCAS_LIMIT,
        min(max(lobeRGB.r, max(lobeRGB.g, lobeRGB.b)), 0.)
    )*con;

    // Apply noise removal.
    #ifdef dDenoise
        lobe *= nz;
    #endif

    // Resolve, which needs the medium precision rcp approximation to avoid visible tonality changes.
    return (lobe * (b + d + h + f) + e) / (4. * lobe + 1.);
}


vec4 FsrRcasLoadF(vec2 p) {
    return texture2D(tColor, p * uTexSizeInv);
}

void main() {
    // Set up constants
    float con;
    FsrRcasCon(con, uSharpness);

    // Perform RCAS pass
    vec3 col = FsrRcasF(gl_FragCoord.xy, con);

    gl_FragColor = vec4(col, FsrRcasLoadF(gl_FragCoord.xy).a);
}
`;var BIe={sharpness:C.Numeric(.5,{min:0,max:1,step:.05}),denoise:C.Boolean(!0)},ML=class{constructor(t,r){this.webgl=t;this.renderable=Bit(t,r)}updateState(t){let{gl:r,state:n}=this.webgl;n.enable(r.SCISSOR_TEST),n.disable(r.BLEND),n.disable(r.DEPTH_TEST),n.depthMask(!1);let{x:o,y:i,width:a,height:s}=t;n.viewport(o,i,a,s),n.scissor(o,i,a,s),n.clearColor(0,0,0,1),r.clear(r.COLOR_BUFFER_BIT)}setSize(t,r){_.update(this.renderable.values.uTexSizeInv,Ce.set(this.renderable.values.uTexSizeInv.ref.value,1/t,1/r))}update(t,r){let{values:n}=this.renderable,{sharpness:o,denoise:i}=r,a=!1;n.tColor.ref.value!==t&&(_.update(this.renderable.values.tColor,t),a=!0),_.updateIfChanged(n.uSharpness,2-2*Math.pow(o,.25)),n.dDenoise.ref.value!==i&&(a=!0),_.updateIfChanged(n.dDenoise,i),a&&this.renderable.update()}render(t,r){je&&this.webgl.timer.mark("CasPass.render"),r?r.bind():this.webgl.bindDrawingBuffer(),this.updateState(t),this.renderable.render(),je&&this.webgl.timer.markEnd("CasPass.render")}},wit={...Sn,tColor:yt("texture","rgba","ubyte","linear"),uTexSizeInv:de("v2"),uSharpness:de("f"),dDenoise:dt("boolean")},Mit=zr("cas",Fn,MIe);function Bit(e,t){let r=t.getWidth(),n=t.getHeight(),o={...vn,tColor:_.create(t),uTexSizeInv:_.create(Ce.create(1/r,1/n)),uSharpness:_.create(.5),dDenoise:_.create(!0)},i={...wit},a=on(e,"triangles",Mit,i,o);return an(a,o)}var EIe=`
precision highp float;
precision highp int;
precision highp sampler2D;

#include common

uniform sampler2D tColor;
uniform sampler2D tDepthOpaque;
uniform sampler2D tDepthTransparent;

uniform vec2 uTexSize;
uniform vec4 uBounds;

uniform float uBlurSpread;
uniform float uInFocus;
uniform float uPPM;

uniform float uNear; // Near plane
uniform float uFar;  // Far plane

uniform mat4 uInvProjection; // Inverse projection
uniform mat4 uProjection; // projection

uniform int uMode; // 0-planar, 1-spherical
uniform vec3 uCenter; // Center of focus sphere in view space

// Function to convert depth value from depth buffer to view space Z
float getViewZ(const in float depth) {
    #if dOrthographic == 1
        return orthographicDepthToViewZ(depth, uNear, uFar);
    #else
        return perspectiveDepthToViewZ(depth, uNear, uFar);
    #endif
}

// Retrieve depth from opaque depth texture
float getDepthOpaque(const in vec2 coords) {
    #ifdef depthTextureSupport
        return texture2D(tDepthOpaque, coords).r;
    #else
        return unpackRGBAToDepth(texture2D(tDepthOpaque, coords));
    #endif
}

// Retrieve depth from transparent depth texture
float getDepthTransparent(const in vec2 coords) {
    return unpackRGBAToDepthWithAlpha(texture2D(tDepthTransparent, coords)).x;
}

bool isBackground(const in float depth) {
    return depth == 1.0;
}

float getDepth(const in vec2 coords) {
    return min(getDepthOpaque(coords), getDepthTransparent(coords));
}

float getCOC(vec2 uv) {
    float depth = getDepth(uv);
    float viewDist = getViewZ(depth);
    vec3 aposition = screenSpaceToViewSpace(vec3(uv.xy, depth), uInvProjection);
    float focusDist = length(aposition - uCenter);
    float coc = 0.0;  // Circle of Confusion
    if (uMode == 0) { // planar Depth of field
        coc = (abs(viewDist) - uInFocus) / uPPM;  //focus distance, focus range
    } else if(uMode == 1) { // spherical Depth of field
        coc = focusDist / uPPM ;
    }
    coc = clamp(coc, -1.0, 1.0);
    return coc;
}

// Simple box blur for blurring the image
vec3 getBlurredImage(vec2 coords) {
    vec4 blurColor = vec4(0);
    vec2 texelSize = vec2(1.0 / uTexSize.x, 1.0 / uTexSize.y);
    float count = 0.0;
    for (int x = 0; x < int(dBlurSize); x++) {
        for (int y = 0; y < int(dBlurSize); y++) {
            vec2 offset = vec2(float(x) - float(dBlurSize) / 2.0, float(y) - float(dBlurSize) / 2.0);
            vec2 uvPixel = coords.xy + offset * texelSize * uBlurSpread;
            float coc = getCOC(uvPixel);
            coc = smoothstep(0.0, 1.0, abs(coc));
            // mix blurColor with new color with weight coc
            blurColor.rgb = blurColor.rgb + texture2D(tColor, uvPixel).xyz * coc;
            count+=coc;
        }
    }
    blurColor = blurColor / count;
    return blurColor.rgb;
}

// simplification from https://catlikecoding.com/unity/tutorials/advanced-rendering/depth-of-field/
void main() {
    vec2 uv = gl_FragCoord.xy / uTexSize;
    vec4 color = texture2D(tColor, uv);
    float depth = getDepth(uv);

    float viewDist = getViewZ(depth);

    vec3 aposition = screenSpaceToViewSpace(vec3(uv.xy, depth), uInvProjection);
    float focusDist = length(aposition - uCenter);
    vec3 blurColor = getBlurredImage(uv);

    float coc = getCOC(uv); // Circle of Confusion

    // for debugging the coc
    // color.rgb = (coc < 0.0) ? (1.0 - abs(coc)) * vec3(1.0,0.0,0.0) : vec3(0.0, 1.0 - coc, 0.0) ;//mix(color.rgb, blurColor.rgb, abs(coc));
    color.rgb = mix(color.rgb, blurColor, smoothstep(0.0, 1.0, abs(coc))); // Smooth blending based on CoC
    gl_FragColor = color;
}
`;var BL={blurSize:C.Numeric(9,{min:1,max:32,step:1}),blurSpread:C.Numeric(1,{min:0,max:10,step:.1}),inFocus:C.Numeric(0,{min:-5e3,max:5e3,step:1},{description:"Distance from the scene center that will be in focus"}),PPM:C.Numeric(20,{min:0,max:5e3,step:.1},{description:"Size of the area that will be in focus"}),center:C.Select("camera-target",C.arrayToOptions(["scene-center","camera-target"])),mode:C.Select("plane",C.arrayToOptions(["plane","sphere"]))},Hp=class{constructor(t,r,n){this.webgl=t;this.target=t.createRenderTarget(r,n,!1);let o=qo();this.renderable=Fit(t,o,o,o)}static isEnabled(t){return t.enabled&&t.dof.name!=="off"}getByteCount(){return this.target.getByteCount()}updateState(t){let{gl:r,state:n}=this.webgl;n.enable(r.SCISSOR_TEST),n.disable(r.BLEND),n.disable(r.DEPTH_TEST),n.depthMask(!1);let{x:o,y:i,width:a,height:s}=t;n.viewport(o,i,a,s),n.scissor(o,i,a,s),n.clearColor(0,0,0,1),r.clear(r.COLOR_BUFFER_BIT)}setSize(t,r){let n=this.target.texture.getWidth(),o=this.target.texture.getHeight();(t!==n||r!==o)&&(this.target.setSize(t,r),_.update(this.renderable.values.uTexSize,Ce.set(this.renderable.values.uTexSize.ref.value,t,r)))}update(t,r,n,o,i,a){let s=!1;this.renderable.values.tColor.ref.value!==r&&(_.update(this.renderable.values.tColor,r),s=!0),this.renderable.values.tDepthOpaque.ref.value!==n&&(_.update(this.renderable.values.tDepthOpaque,n),s=!0),this.renderable.values.tDepthTransparent.ref.value!==o&&(_.update(this.renderable.values.tDepthTransparent,o),s=!0);let l=t.state.mode==="orthographic"?1:0,u=this.renderable.values.uInvProjection.ref.value;H.invert(u,t.projection);let[c,m]=this.renderable.values.uTexSize.ref.value,d=t.viewport;_.update(this.renderable.values.uProjection,t.projection),_.update(this.renderable.values.uInvProjection,u),_.update(this.renderable.values.uMode,i.mode==="sphere"?1:0),Et.set(this.renderable.values.uBounds.ref.value,d.x/c,d.y/m,(d.x+d.width)/c,(d.y+d.height)/m),_.update(this.renderable.values.uBounds,this.renderable.values.uBounds.ref.value),_.updateIfChanged(this.renderable.values.uNear,t.near),_.updateIfChanged(this.renderable.values.uFar,t.far),_.updateIfChanged(this.renderable.values.dOrthographic,l);let p=Math.round(i.blurSize*this.webgl.pixelRatio);this.renderable.values.dBlurSize.ref.value!==p&&(_.update(this.renderable.values.dBlurSize,p),s=!0);let h=i.center==="scene-center"?a.center:t.state.target,g=b.distance(t.state.position,h)+i.inFocus;_.updateIfChanged(this.renderable.values.uInFocus,g*t.scale);let y=this.renderable.values.uCenter.ref.value;b.transformMat4(y,h,t.view),_.update(this.renderable.values.uCenter,y),_.updateIfChanged(this.renderable.values.uBlurSpread,i.blurSpread),_.updateIfChanged(this.renderable.values.uPPM,i.PPM*t.scale),s&&this.renderable.update()}render(t,r){je&&this.webgl.timer.mark("DofPass.render"),r?r.bind():this.webgl.bindDrawingBuffer(),this.updateState(t),this.renderable.render(),je&&this.webgl.timer.markEnd("DofPass.render")}},Eit={...Sn,tDepthOpaque:yt("texture","rgba","ubyte","nearest"),tDepthTransparent:yt("texture","rgba","ubyte","nearest"),tColor:yt("texture","rgba","ubyte","nearest"),uTexSize:de("v2"),uProjection:de("m4"),uInvProjection:de("m4"),uBounds:de("v4"),uCenter:de("v3"),uMode:de("i"),dOrthographic:dt("number"),uNear:de("f"),uFar:de("f"),dBlurSize:dt("number"),uBlurSpread:de("f"),uInFocus:de("f"),uPPM:de("f")},kit=zr("dof",Fn,EIe);function Fit(e,t,r,n){let o=t.getWidth(),i=t.getHeight(),a={...vn,tDepthOpaque:_.create(r),tDepthTransparent:_.create(n),tColor:_.create(t),uTexSize:_.create(Ce.create(o,i)),uProjection:_.create(H.identity()),uInvProjection:_.create(H.identity()),uBounds:_.create(Et()),uCenter:_.create(b()),uMode:_.create(0),dOrthographic:_.create(0),uNear:_.create(1),uFar:_.create(1e4),dBlurSize:_.create(5),uBlurSpread:_.create(300),uInFocus:_.create(20),uPPM:_.create(20)},s={...Eit},l=on(e,"triangles",kit,s,a);return an(l,a)}var kIe=`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform vec2 uTexSizeInv;

uniform sampler2D tBlur1;
uniform sampler2D tBlur2;
uniform sampler2D tBlur3;
uniform sampler2D tBlur4;
uniform sampler2D tBlur5;
uniform float uBloomStrength;
uniform float uBloomRadius;
uniform float uBloomFactors[5];
uniform vec3 uBloomTints[5];

float lerpBloomFactor(const in float factor) {
    float mirrorFactor = 1.2 - factor;
    return mix(factor, mirrorFactor, uBloomRadius);
}

void main(void) {
    vec2 coords = gl_FragCoord.xy * uTexSizeInv;

    gl_FragColor = uBloomStrength * (
        lerpBloomFactor(uBloomFactors[0]) * vec4(uBloomTints[0], 1.0) * texture2D(tBlur1, coords) +
        lerpBloomFactor(uBloomFactors[1]) * vec4(uBloomTints[1], 1.0) * texture2D(tBlur2, coords) +
        lerpBloomFactor(uBloomFactors[2]) * vec4(uBloomTints[2], 1.0) * texture2D(tBlur3, coords) +
        lerpBloomFactor(uBloomFactors[3]) * vec4(uBloomTints[3], 1.0) * texture2D(tBlur4, coords) +
        lerpBloomFactor(uBloomFactors[4]) * vec4(uBloomTints[4], 1.0) * texture2D(tBlur5, coords)
    );
}
`;var FIe=`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tColor;
uniform sampler2D tEmissive;
uniform sampler2D tDepth;
uniform vec2 uTexSizeInv;

uniform vec3 uDefaultColor;
uniform float uDefaultOpacity;
uniform float uLuminosityThreshold;
uniform float uSmoothWidth;

#include common

float getDepth(const in vec2 coords) {
    #ifdef depthTextureSupport
        return texture2D(tDepth, coords).r;
    #else
        return unpackRGBAToDepth(texture2D(tDepth, coords));
    #endif
}

bool isBackground(const in float depth) {
    return depth == 1.0;
}

void main(void) {
    vec2 coords = gl_FragCoord.xy * uTexSizeInv;
    vec4 texel = texture2D(tColor, coords);
    float emissive = texture2D(tEmissive, coords).a;
    float depth = getDepth(coords);

    if (isBackground(depth)) {
        gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        return;
    }

    vec4 outputColor = vec4(uDefaultColor.rgb, uDefaultOpacity);

    #if defined(dMode_luminosity)
        vec3 luma = vec3(0.299, 0.587, 0.114);
        float v = dot(texel.xyz, luma);
        float alpha = smoothstep(uLuminosityThreshold, uLuminosityThreshold + uSmoothWidth, v);

        gl_FragColor = mix(outputColor, texel, alpha);
    #elif defined(dMode_emissive)
        gl_FragColor = mix(outputColor, texel, emissive);
    #endif
}
`;var LIe=`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tInput;
uniform vec2 uTexSizeInv;

uniform vec2 uDirection;
uniform float uGaussianCoefficients[dKernelRadius];

void main(void) {
    vec2 coords = gl_FragCoord.xy * uTexSizeInv;
    float weightSum = uGaussianCoefficients[0];
    vec4 diffuseSum = texture2D(tInput, coords) * weightSum;

    for(int i = 1; i < dKernelRadius; ++i) {
        float x = float(i);
        float w = uGaussianCoefficients[i];
        vec2 offset = uDirection * uTexSizeInv * x;
        vec4 sample1 = texture2D(tInput, coords + offset);
        vec4 sample2 = texture2D(tInput, coords - offset);
        diffuseSum += (sample1 + sample2) * w;
        weightSum += 2.0 * w;
    }

    gl_FragColor = diffuseSum / weightSum;
}
`;var BX=5,EL={strength:C.Numeric(1,{min:0,max:3,step:.1}),radius:C.Numeric(0,{min:0,max:1,step:.01}),threshold:C.Numeric(0,{min:0,max:1,step:.01},{description:"Luminosity threshold",hideIf:e=>e.mode==="emissive"}),mode:C.Select("emissive",[["luminosity","Luminosity"],["emissive","Emissive"]])},Ab=class{constructor(t,r,n){this.webgl=t;this.horizontalBlurTargets=[];this.verticalBlurTargets=[];this.emissiveTarget=t.createRenderTarget(r,n,!0,"uint8","linear","rgba"),this.luminosityTarget=t.createRenderTarget(r,n,!1,"uint8","linear"),this.compositeTarget=t.createRenderTarget(r,n,!1,"uint8","linear");let o=Math.round(r/2),i=Math.round(n/2);for(let s=0;s<BX;++s)this.horizontalBlurTargets[s]=t.createRenderTarget(o,i,!1,"uint8","linear"),this.verticalBlurTargets[s]=t.createRenderTarget(o,i,!1,"uint8","linear"),o=Math.round(o/2),i=Math.round(i/2);let a=qo();this.luminosityRenderable=Oit(t,a,a,a),this.blurRenderable=Wit(t,a),this.compositeRenderable=Zit(t,r,n,this.verticalBlurTargets[0].texture,this.verticalBlurTargets[1].texture,this.verticalBlurTargets[2].texture,this.verticalBlurTargets[3].texture,this.verticalBlurTargets[4].texture),this.copyRenderable=Gm(t,this.compositeTarget.texture)}static isEnabled(t){return t.enabled&&t.bloom.name==="on"}getByteCount(){return this.emissiveTarget.getByteCount()+this.luminosityTarget.getByteCount()+this.compositeTarget.getByteCount()+this.horizontalBlurTargets.reduce((t,r)=>t+r.getByteCount(),0)+this.verticalBlurTargets.reduce((t,r)=>t+r.getByteCount(),0)}setSize(t,r){let n=this.luminosityTarget.getWidth(),o=this.luminosityTarget.getHeight();if(t!==n||r!==o){this.emissiveTarget.setSize(t,r),this.luminosityTarget.setSize(t,r),this.compositeTarget.setSize(t,r);let i=Math.round(t/2),a=Math.round(r/2);for(let s=0;s<BX;++s)this.horizontalBlurTargets[s].setSize(i,a),this.verticalBlurTargets[s].setSize(i,a),i=Math.round(i/2),a=Math.round(a/2);_.update(this.luminosityRenderable.values.uTexSizeInv,Ce.set(this.compositeRenderable.values.uTexSizeInv.ref.value,1/t,1/r)),_.update(this.compositeRenderable.values.uTexSizeInv,Ce.set(this.compositeRenderable.values.uTexSizeInv.ref.value,1/t,1/r)),_.update(this.copyRenderable.values.uTexSize,Ce.set(this.copyRenderable.values.uTexSize.ref.value,t,r))}}update(t,r,n,o){let i=!1;this.luminosityRenderable.values.tColor.ref.value!==t&&(_.update(this.luminosityRenderable.values.tColor,t),i=!0),this.luminosityRenderable.values.tEmissive.ref.value!==r&&(_.update(this.luminosityRenderable.values.tEmissive,r),i=!0),this.luminosityRenderable.values.tDepth.ref.value!==n&&(_.update(this.luminosityRenderable.values.tDepth,n),i=!0),this.luminosityRenderable.values.dMode.ref.value!==o.mode&&(_.update(this.luminosityRenderable.values.dMode,o.mode),i=!0),_.updateIfChanged(this.luminosityRenderable.values.uLuminosityThreshold,o.threshold),i&&this.luminosityRenderable.update();let a=!1;this.blurRenderable.values.tInput.ref.value!==t&&(_.update(this.blurRenderable.values.tInput,t),a=!0),a&&this.blurRenderable.update(),_.update(this.compositeRenderable.values.uBloomRadius,o.radius),_.update(this.compositeRenderable.values.uBloomStrength,o.strength)}render(t,r){je&&this.webgl.timer.mark("BloomPass.render");let{gl:n,state:o}=this.webgl,{x:i,y:a,width:s,height:l}=t;o.viewport(i,a,s,l),o.scissor(i,a,s,l),o.enable(n.SCISSOR_TEST),o.disable(n.BLEND),o.disable(n.DEPTH_TEST),o.depthMask(!1),this.luminosityTarget.bind(),this.luminosityRenderable.render();for(let u=0;u<BX;++u){let c=this.horizontalBlurTargets[u].getWidth(),m=this.horizontalBlurTargets[u].getHeight();o.viewport(0,0,c,m),o.scissor(0,0,c,m),_.update(this.blurRenderable.values.dKernelRadius,EX[u]),_.update(this.blurRenderable.values.uGaussianCoefficients,Uit(EX[u])),_.update(this.blurRenderable.values.uTexSizeInv,Ce.set(this.blurRenderable.values.uTexSizeInv.ref.value,1/c,1/m)),this.horizontalBlurTargets[u].bind(),_.update(this.blurRenderable.values.tInput,u===0?this.luminosityTarget.texture:this.verticalBlurTargets[u-1].texture),_.update(this.blurRenderable.values.uDirection,Nit),this.blurRenderable.update(),this.blurRenderable.render(),this.verticalBlurTargets[u].bind(),_.update(this.blurRenderable.values.tInput,this.horizontalBlurTargets[u].texture),_.update(this.blurRenderable.values.uDirection,zit),this.blurRenderable.update(),this.blurRenderable.render()}o.viewport(i,a,s,l),o.scissor(i,a,s,l),this.compositeTarget.bind(),this.compositeRenderable.update(),this.compositeRenderable.render(),r?r.bind():this.webgl.bindDrawingBuffer(),o.enable(n.BLEND),o.blendFunc(n.ONE,n.ONE),this.copyRenderable.render(),je&&this.webgl.timer.markEnd("BloomPass.render")}},Lit={...Sn,tColor:yt("texture","rgba","ubyte","linear"),tEmissive:yt("texture","rgba","ubyte","linear"),tDepth:yt("texture","rgba","ubyte","nearest"),uTexSizeInv:de("v2"),uDefaultColor:de("v3"),uDefaultOpacity:de("f"),uLuminosityThreshold:de("f"),uSmoothWidth:de("f"),dMode:dt("string",["luminosity","emissive"])},Vit=zr("Bloom Luminosity",Fn,FIe);function Oit(e,t,r,n){let o=t.getWidth(),i=t.getHeight(),a={...vn,tColor:_.create(t),tEmissive:_.create(r),tDepth:_.create(n),uTexSizeInv:_.create(Ce.create(1/o,1/i)),uDefaultColor:_.create(b()),uDefaultOpacity:_.create(0),uLuminosityThreshold:_.create(0),uSmoothWidth:_.create(1),dMode:_.create("emissive")},s={...Lit},l=on(e,"triangles",Vit,s,a);return an(l,a)}function Git(e){let t=[];for(let r=0;r<e;++r)t.push(.39894*Math.exp(-.5*r*r/(e*e))/e);return t}var Uit=zf(Git),EX=[3,5,7,9,11],Nit=Ce.create(1,0),zit=Ce.create(0,1),Hit={...Sn,tInput:yt("texture","rgba","ubyte","linear"),uTexSizeInv:de("v2"),uDirection:de("v2"),uGaussianCoefficients:de("f[]"),dKernelRadius:dt("number")},jit=zr("Bloom Blur",Fn,LIe);function Wit(e,t){let r=t.getWidth(),n=t.getHeight(),o={...vn,tInput:_.create(t),uTexSizeInv:_.create(Ce.create(1/r,1/n)),uDirection:_.create(Ce()),uGaussianCoefficients:_.create([]),dKernelRadius:_.create(EX[0])},i={...Hit},a=on(e,"triangles",jit,i,o);return an(a,o)}var Xit={...Sn,tBlur1:yt("texture","rgba","ubyte","linear"),tBlur2:yt("texture","rgba","ubyte","linear"),tBlur3:yt("texture","rgba","ubyte","linear"),tBlur4:yt("texture","rgba","ubyte","linear"),tBlur5:yt("texture","rgba","ubyte","linear"),uTexSizeInv:de("v2"),uBloomStrength:de("f"),uBloomRadius:de("f"),uBloomFactors:de("f[]"),uBloomTints:de("v3[]")},Qit=zr("Bloom Composite",Fn,kIe);function Zit(e,t,r,n,o,i,a,s){let l={...vn,uTexSizeInv:_.create(Ce.create(t,r)),tBlur1:_.create(n),tBlur2:_.create(o),tBlur3:_.create(i),tBlur4:_.create(a),tBlur5:_.create(s),uBloomStrength:_.create(1),uBloomRadius:_.create(0),uBloomFactors:_.create([1,.8,.6,.4,.2]),uBloomTints:_.create(new Array(15).fill(1))},u={...Xit},c=on(e,"triangles",Qit,u,l);return an(c,l)}var VIe=`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tDepthOpaque;
uniform sampler2D tDepthTransparent;
uniform vec2 uTexSize;

uniform float uNear;
uniform float uFar;
uniform mat4 uInvProjection;

uniform float uOutlineThreshold;

#include common

float getViewZ(const in float depth) {
    #if dOrthographic == 1
        return orthographicDepthToViewZ(depth, uNear, uFar);
    #else
        return perspectiveDepthToViewZ(depth, uNear, uFar);
    #endif
}

float getDepthOpaque(const in vec2 coords) {
    #ifdef depthTextureSupport
        return texture2D(tDepthOpaque, coords).r;
    #else
        return unpackRGBAToDepth(texture2D(tDepthOpaque, coords));
    #endif
}

vec2 getDepthTransparentWithAlpha(const in vec2 coords) {
    #ifdef dTransparentOutline
        return unpackRGBAToDepthWithAlpha(texture2D(tDepthTransparent, coords));
    #else
        return vec2(1.0, 0.0);
    #endif
}

bool isBackground(const in float depth) {
    return depth == 1.0;
}

float getPixelSize(const in vec2 coords, const in float depth) {
    vec3 viewPos0 = screenSpaceToViewSpace(vec3(coords, depth), uInvProjection);
    vec3 viewPos1 = screenSpaceToViewSpace(vec3(coords + vec2(1.0, 0.0) / uTexSize, depth), uInvProjection);
    return distance(viewPos0, viewPos1);
}

void main(void) {
    float backgroundViewZ = 2.0 * uFar;

    vec2 coords = gl_FragCoord.xy / uTexSize;
    vec2 invTexSize = 1.0 / uTexSize;

    float selfDepthOpaque = getDepthOpaque(coords);
    float selfViewZOpaque = isBackground(selfDepthOpaque) ? backgroundViewZ : getViewZ(selfDepthOpaque);
    float pixelSizeOpaque = getPixelSize(coords, selfDepthOpaque) * uOutlineThreshold;

    vec2 selfDepthTransparentWithAlpha = getDepthTransparentWithAlpha(coords);
    float selfDepthTransparent = selfDepthTransparentWithAlpha.x;
    float selfViewZTransparent = isBackground(selfDepthTransparent) ? backgroundViewZ : getViewZ(selfDepthTransparent);
    float pixelSizeTransparent = getPixelSize(coords, selfDepthTransparent) * uOutlineThreshold;

    float bestOpaqueDepth = 1.0;
    float bestTransparentDepth = 1.0;
    float bestTransparentAlpha = 0.0;

    float opaqueOutlineFlag = 0.0;
    float transparentOutlineFlag = 0.0;

    for (int y = -1; y <= 1; y++) {
        for (int x = -1; x <= 1; x++) {
            vec2 sampleCoords = coords + vec2(float(x), float(y)) * invTexSize;

            // Opaque
            float sampleDepthOpaque = getDepthOpaque(sampleCoords);
            float sampleViewZOpaque = isBackground(sampleDepthOpaque) ? backgroundViewZ : getViewZ(sampleDepthOpaque);
            if (abs(selfViewZOpaque - sampleViewZOpaque) > pixelSizeOpaque && selfDepthOpaque > sampleDepthOpaque && sampleDepthOpaque <= bestOpaqueDepth) {
                bestOpaqueDepth = sampleDepthOpaque;
                opaqueOutlineFlag = 1.0;
            }

            // Transparent
            vec2 sampleDepthTransparentWithAlpha = getDepthTransparentWithAlpha(sampleCoords);
            float sampleDepthTransparent = sampleDepthTransparentWithAlpha.x;
            float sampleAlphaTransparent = sampleDepthTransparentWithAlpha.y;
            float sampleViewZTransparent = isBackground(sampleDepthTransparent) ? backgroundViewZ : getViewZ(sampleDepthTransparent);
            if (abs(selfViewZTransparent - sampleViewZTransparent) > pixelSizeTransparent && selfDepthTransparent > sampleDepthTransparent && sampleDepthTransparent <= bestTransparentDepth) {
                bestTransparentDepth = sampleDepthTransparent;
                bestTransparentAlpha = sampleAlphaTransparent;
                transparentOutlineFlag = 1.0;
            }
        }
    }

    if (transparentOutlineFlag > 0.0 && bestOpaqueDepth < 1.0 && bestTransparentDepth > bestOpaqueDepth) {
        transparentOutlineFlag = 0.0;
        bestTransparentAlpha = 0.0;
    }

    vec2 depthPacked; // Pack depth in G/B channels
    float outlineTypeFlag = 0.0;
    if (opaqueOutlineFlag > 0.0 && transparentOutlineFlag > 0.0) {
        outlineTypeFlag = 0.75; // Both
        depthPacked = packUnitIntervalToRG(bestOpaqueDepth);
    } else if (transparentOutlineFlag > 0.0) {
        outlineTypeFlag = 0.5;  // Transparent only
        depthPacked = packUnitIntervalToRG(bestTransparentDepth);
    } else if (opaqueOutlineFlag > 0.0) {
        outlineTypeFlag = 0.25; // Opaque only
        depthPacked = packUnitIntervalToRG(bestOpaqueDepth);
    }

    float alpha = clamp(bestTransparentAlpha, 0.0, 0.5) * 2.0; // limiting to range [0.0, 0.5] to improve alpha precision since we don't need a wider range
    float packedFlagWithAlpha = pack2x4(vec2(outlineTypeFlag, alpha)); // pack outlineType with alpha
    gl_FragColor = vec4(packedFlagWithAlpha, depthPacked.x, depthPacked.y, bestTransparentDepth);
}
`;var kL={scale:C.Numeric(1,{min:1,max:5,step:1}),threshold:C.Numeric(.33,{min:.01,max:1,step:.01}),color:C.Color(0),includeTransparent:C.Boolean(!0,{description:"Whether to show outline for transparent objects"})},Og=class{constructor(t,r,n,o,i){this.webgl=t;this.target=t.createRenderTarget(r,n,!1),this.renderable=Yit(t,i,o,!0)}static isEnabled(t){return t.enabled&&t.outline.name!=="off"}getByteCount(){return this.target.getByteCount()}setSize(t,r){let[n,o]=this.renderable.values.uTexSize.ref.value;(t!==n||r!==o)&&(this.target.setSize(t,r),_.update(this.renderable.values.uTexSize,Ce.set(this.renderable.values.uTexSize.ref.value,t,r)))}update(t,r,n,o){let i=!1,a=t.state.mode==="orthographic"?1:0,s=this.renderable.values.uInvProjection.ref.value;H.invert(s,t.projection);let l=r.includeTransparent??!0,u=Math.max(1,Math.round(r.scale*this.webgl.pixelRatio))-1,c=50*r.threshold*this.webgl.pixelRatio;return _.updateIfChanged(this.renderable.values.uNear,t.near),_.updateIfChanged(this.renderable.values.uFar,t.far),_.update(this.renderable.values.uInvProjection,s),this.renderable.values.dTransparentOutline.ref.value!==l&&(i=!0,_.update(this.renderable.values.dTransparentOutline,l)),this.renderable.values.dOrthographic.ref.value!==a&&(i=!0,_.update(this.renderable.values.dOrthographic,a)),_.updateIfChanged(this.renderable.values.uOutlineThreshold,c),this.renderable.values.tDepthTransparent.ref.value!==n&&(i=!0,_.update(this.renderable.values.tDepthTransparent,n)),this.renderable.values.tDepthOpaque.ref.value!==o&&(i=!0,_.update(this.renderable.values.tDepthOpaque,o)),i&&this.renderable.update(),{transparentOutline:l,outlineScale:u}}render(){je&&this.webgl.timer.mark("OutlinePass.render"),this.target.bind(),this.renderable.render(),je&&this.webgl.timer.markEnd("OutlinePass.render")}},qit={...Sn,tDepthOpaque:yt("texture","rgba","ubyte","nearest"),tDepthTransparent:yt("texture","rgba","ubyte","nearest"),uTexSize:de("v2"),dOrthographic:dt("number"),uNear:de("f"),uFar:de("f"),uInvProjection:de("m4"),uOutlineThreshold:de("f"),dTransparentOutline:dt("boolean")};function Yit(e,t,r,n){let o=t.getWidth(),i=t.getHeight(),a={...vn,tDepthOpaque:_.create(t),tDepthTransparent:_.create(r),uTexSize:_.create(Ce.create(o,i)),dOrthographic:_.create(0),uNear:_.create(1),uFar:_.create(1e4),uInvProjection:_.create(H.identity()),uOutlineThreshold:_.create(.33),dTransparentOutline:_.create(n)},s={...qit},l=zr("outlines",Fn,VIe),u=on(e,"triangles",l,s,a);return an(u,a)}var OIe=`
precision highp float;
precision highp int;
precision highp sampler2D;

#include common

uniform sampler2D tDepth;
uniform vec2 uTexSize;
uniform vec4 uBounds;

uniform float uNear;
uniform float uFar;

#if dLightCount != 0
    uniform vec3 uLightDirection[dLightCount];
    uniform vec3 uLightColor[dLightCount];
#endif

uniform vec3 uAmbientColor;

uniform mat4 uProjection;
uniform mat4 uInvProjection;

uniform float uMaxDistance;
uniform float uTolerance;

// Map full [0,1] coords -> bounds [0,1] coords
vec2 fullCoordsToBoundsCoords(vec2 fullCoords) {
    return (fullCoords - uBounds.xy) / (uBounds.zw - uBounds.xy);
}

// Map bounds [0,1] coords -> full [0,1] coords
vec2 boundsCoordsToFullCoords(vec2 boundsCoords) {
    return uBounds.xy + (uBounds.zw - uBounds.xy) * boundsCoords;
}

bool isBackground(const in float depth) {
    return depth == 1.0;
}

bool outsideBounds(const in vec2 p) {
    return p.x < uBounds.x || p.y < uBounds.y || p.x > uBounds.z || p.y > uBounds.w;
}

float getViewZ(const in float depth) {
    #if dOrthographic == 1
        return orthographicDepthToViewZ(depth, uNear, uFar);
    #else
        return perspectiveDepthToViewZ(depth, uNear, uFar);
    #endif
}

float getDepth(const in vec2 coords) {
    #ifdef depthTextureSupport
        return texture2D(tDepth, coords).r;
    #else
        return unpackRGBAToDepth(texture2D(tDepth, coords));
    #endif
}

float screenFade(const in vec2 coords) {
    vec2 c = (coords - uBounds.xy) / (uBounds.zw - uBounds.xy);
    vec2 fade = max(12.0 * abs(c - 0.5) - 5.0, vec2(0.0));
    return saturate(1.0 - dot(fade, fade));
}

// based on https://panoskarabelas.com/posts/screen_space_shadows/
vec3 screenSpaceShadow(const in vec3 position, const in vec3 lightDirection, const in vec3 lightColor, const in float stepLength) {
    // Ray position and direction (in view-space)
    vec3 rayPos = position;
    vec3 rayDir = -lightDirection;

    // Compute ray step
    vec3 rayStep = rayDir * stepLength;

    // Ray march towards the light
    vec4 rayCoords = vec4(0.0);
    for (int i = 0; i < dSteps; ++i) {
        // Step the ray
        rayPos += rayStep;

        rayCoords = uProjection * vec4(rayPos, 1.0);
        rayCoords.xyz = (rayCoords.xyz / rayCoords.w) * 0.5 + 0.5;
        rayCoords.xy = boundsCoordsToFullCoords(rayCoords.xy);

        if (outsideBounds(rayCoords.xy)) {
            return lightColor;
        }

        // Compute the difference between the ray's and the camera's depth
        float depth = getDepth(rayCoords.xy);
        float viewZ = getViewZ(depth);
        float zDelta = rayPos.z - viewZ;

        if (zDelta < uTolerance) {
            // Fade out as we approach the edges of the screen
            return mix(vec3(0.0), lightColor, 1.0 - screenFade(rayCoords.xy));
        }
    }

    return lightColor;
}

void main(void) {
    vec2 invTexSize = 1.0 / uTexSize;
    vec2 selfCoords = gl_FragCoord.xy * invTexSize;
    float selfDepth = getDepth(selfCoords);

    if (isBackground(selfDepth)) {
        gl_FragColor = vec4(0.0);
        return;
    }

    vec2 selfBoundsCoords = fullCoordsToBoundsCoords(selfCoords);
    if (any(lessThan(selfBoundsCoords, vec2(0.0))) || any(greaterThan(selfBoundsCoords, vec2(1.0)))) {
        gl_FragColor = vec4(0.0);
        return;
    }

    vec3 selfViewPos = screenSpaceToViewSpace(vec3(selfBoundsCoords, selfDepth), uInvProjection);
    float stepLength = uMaxDistance / float(dSteps);

    float l = length(uAmbientColor);
    float a = l;
    #if dLightCount != 0
        vec3 s;
        #pragma unroll_loop_start
        for (int i = 0; i < dLightCount; ++i) {
            s = screenSpaceShadow(selfViewPos, uLightDirection[i], uLightColor[i], stepLength);
            l += length(s);
            a += length(uLightColor[i]);
        }
        #pragma unroll_loop_end
    #endif

    gl_FragColor = vec4(l / a);
}
`;var FL={steps:C.Numeric(1,{min:1,max:64,step:1}),maxDistance:C.Numeric(3,{min:0,max:256,step:1}),tolerance:C.Numeric(1,{min:0,max:10,step:.1})},$A=class{constructor(t,r,n,o){this.webgl=t;this.invProjection=H.identity();this.invHeadRotation=H.identity();this.target=t.createRenderTarget(r,n,!1),this.renderable=Jit(t,o)}static isEnabled(t){return t.enabled&&t.shadow.name!=="off"}getByteCount(){return this.target.getByteCount()}setSize(t,r){let[n,o]=this.renderable.values.uTexSize.ref.value;(t!==n||r!==o)&&(this.target.setSize(t,r),_.update(this.renderable.values.uTexSize,Ce.set(this.renderable.values.uTexSize.ref.value,t,r)))}update(t,r,n,o){let i=!1,a=t.state.mode==="orthographic"?1:0,[s,l]=this.renderable.values.uTexSize.ref.value,u=t.viewport;_.update(this.renderable.values.uProjection,t.projection),_.update(this.renderable.values.uInvProjection,H.invert(this.invProjection,t.projection)),Et.set(this.renderable.values.uBounds.ref.value,u.x/s,u.y/l,(u.x+u.width)/s,(u.y+u.height)/l),_.update(this.renderable.values.uBounds,this.renderable.values.uBounds.ref.value),_.updateIfChanged(this.renderable.values.uNear,t.near),_.updateIfChanged(this.renderable.values.uFar,t.far),this.renderable.values.dOrthographic.ref.value!==a&&(_.update(this.renderable.values.dOrthographic,a),i=!0),_.updateIfChanged(this.renderable.values.uMaxDistance,o.maxDistance*t.scale),_.updateIfChanged(this.renderable.values.uTolerance,o.tolerance*t.scale),this.renderable.values.dSteps.ref.value!==o.steps&&(_.update(this.renderable.values.dSteps,o.steps),i=!0),!H.isZero(t.headRotation)?_.update(this.renderable.values.uLightDirection,AX(r,H.invert(this.invHeadRotation,t.headRotation))):_.update(this.renderable.values.uLightDirection,r.direction),_.update(this.renderable.values.uLightColor,r.color),this.renderable.values.dLightCount.ref.value!==r.count&&(_.update(this.renderable.values.dLightCount,r.count),i=!0),_.update(this.renderable.values.uAmbientColor,n),i&&this.renderable.update()}render(){je&&this.webgl.timer.mark("ShadowPass.render"),this.target.bind(),this.renderable.render(),je&&this.webgl.timer.markEnd("ShadowPass.render")}},Kit={...Sn,tDepth:yt("texture","rgba","ubyte","nearest"),uTexSize:de("v2"),uProjection:de("m4"),uInvProjection:de("m4"),uBounds:de("v4"),dOrthographic:dt("number"),uNear:de("f"),uFar:de("f"),dSteps:dt("number"),uMaxDistance:de("f"),uTolerance:de("f"),uLightDirection:de("v3[]"),uLightColor:de("v3[]"),dLightCount:dt("number"),uAmbientColor:de("v3")};function Jit(e,t){let r=t.getWidth(),n=t.getHeight(),o={...vn,tDepth:_.create(t),uTexSize:_.create(Ce.create(r,n)),uProjection:_.create(H.identity()),uInvProjection:_.create(H.identity()),uBounds:_.create(Et()),dOrthographic:_.create(0),uNear:_.create(1),uFar:_.create(1e4),dSteps:_.create(1),uMaxDistance:_.create(3),uTolerance:_.create(1),uLightDirection:_.create([]),uLightColor:_.create([]),dLightCount:_.create(0),uAmbientColor:_.create(b())},i={...Kit},a=zr("shadows",Fn,OIe),s=on(e,"triangles",a,i,o);return an(s,o)}var GIe=`
precision highp float;
precision highp int;
precision highp sampler2D;

#include common


uniform sampler2D tDepth;
uniform sampler2D tDepthHalf;
uniform sampler2D tDepthQuarter;

#if defined(dIncludeTransparent)
    uniform sampler2D tDepthTransparent;
    uniform sampler2D tDepthHalfTransparent;
    uniform sampler2D tDepthQuarterTransparent;
#endif

uniform int uTransparencyFlag;

uniform vec2 uTexSize;
uniform vec4 uBounds;

uniform vec3 uSamples[dNSamples];

uniform mat4 uProjection;
uniform mat4 uInvProjection;

#ifdef dMultiScale
    uniform float uLevelRadius[dLevels];
    uniform float uLevelBias[dLevels];
    uniform float uNearThreshold;
    uniform float uFarThreshold;
#else
    uniform float uRadius;
#endif
uniform float uBias;

float smootherstep(float edge0, float edge1, float x) {
    x = clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);
    return x * x * x * (x * (x * 6.0 - 15.0) + 10.0);
}

float noise(const in vec2 coords) {
    float a = 12.9898;
    float b = 78.233;
    float c = 43758.5453;
    float dt = dot(coords, vec2(a,b));
    float sn = mod(dt, PI);
    return abs(fract(sin(sn) * c)); // is abs necessary?
}

vec2 getNoiseVec2(const in vec2 coords) {
    return vec2(noise(coords), noise(coords + vec2(PI, 2.71828)));
}

bool isBackground(const in float depth) {
    return depth == 1.0;
}

float getDepth(const in vec2 coords, const in int transparentFlag) {
    vec2 c = vec2(clamp(coords.x, uBounds.x, uBounds.z), clamp(coords.y, uBounds.y, uBounds.w));
    if (transparentFlag == 1){
        #if defined(dIncludeTransparent)
            return unpackRGBAToDepthWithAlpha(texture2D(tDepthTransparent, c)).x;
        #else
            return 1.0;
        #endif
    } else {
        #ifdef depthTextureSupport
            return texture2D(tDepth, c).r;
        #else
            return unpackRGBAToDepth(texture2D(tDepth, c));
        #endif
    }
}

#if defined(dIncludeTransparent)
    vec2 getDepthTransparentWithAlpha(const in vec2 coords){
        vec2 c = vec2(clamp(coords.x, uBounds.x, uBounds.z), clamp(coords.y, uBounds.y, uBounds.w));
        return unpackRGBAToDepthWithAlpha(texture2D(tDepthTransparent, c));
    }
#endif

#define dQuarterThreshold 0.1
#define dHalfThreshold 0.05

float getMappedDepth(const in vec2 coords, const in vec2 selfCoords) {
    vec2 c = vec2(clamp(coords.x, uBounds.x, uBounds.z), clamp(coords.y, uBounds.y, uBounds.w));
    float d = distance(coords, selfCoords);
    #ifdef depthTextureSupport
        if (d > dQuarterThreshold) {
            return texture2D(tDepthQuarter, c).r;
        } else if (d > dHalfThreshold) {
            return texture2D(tDepthHalf, c).r;
        } else {
            return texture2D(tDepth, c).r;
        }
    #else
        if (d > dQuarterThreshold) {
            return unpackRGBAToDepth(texture2D(tDepthQuarter, c));
        } else if (d > dHalfThreshold) {
            return unpackRGBAToDepth(texture2D(tDepthHalf, c));
        } else {
            return unpackRGBAToDepth(texture2D(tDepth, c));
        }
    #endif
}

#if defined(dIncludeTransparent)
    vec2 getMappedDepthTransparentWithAlpha(const in vec2 coords, const in vec2 selfCoords) {
        vec2 c = vec2(clamp(coords.x, uBounds.x, uBounds.z), clamp(coords.y, uBounds.y, uBounds.w));
        float d = distance(coords, selfCoords);
        if (d > dQuarterThreshold) {
            return unpackRGBAToDepthWithAlpha(texture2D(tDepthQuarterTransparent, c));
        } else if (d > dHalfThreshold) {
            return unpackRGBAToDepthWithAlpha(texture2D(tDepthHalfTransparent, c));
        } else {
            return unpackRGBAToDepthWithAlpha(texture2D(tDepthTransparent, c));
        }
    }
#endif

// adapted from https://gist.github.com/bgolus/a07ed65602c009d5e2f753826e8078a0
vec3 viewNormalAtPixelPositionAccurate(const in vec2 vpos, const in int transparentFlag) {
    // current pixel's depth
    float c = getDepth(vpos, transparentFlag);

    // get current pixel's view space position
    vec3 viewSpacePos_c = screenSpaceToViewSpace(vec3(vpos, c), uInvProjection);

    // get view space position at 1 pixel offsets in each major direction
    vec3 viewSpacePos_l = screenSpaceToViewSpace(vec3(vpos + vec2(-1.0, 0.0) / uTexSize, getDepth(vpos + vec2(-1.0, 0.0) / uTexSize, transparentFlag)), uInvProjection);
    vec3 viewSpacePos_r = screenSpaceToViewSpace(vec3(vpos + vec2( 1.0, 0.0) / uTexSize, getDepth(vpos + vec2( 1.0, 0.0) / uTexSize, transparentFlag)), uInvProjection);
    vec3 viewSpacePos_d = screenSpaceToViewSpace(vec3(vpos + vec2( 0.0,-1.0) / uTexSize, getDepth(vpos + vec2( 0.0,-1.0) / uTexSize, transparentFlag)), uInvProjection);
    vec3 viewSpacePos_u = screenSpaceToViewSpace(vec3(vpos + vec2( 0.0, 1.0) / uTexSize, getDepth(vpos + vec2( 0.0, 1.0) / uTexSize, transparentFlag)), uInvProjection);

    // get the difference between the current and each offset position
    vec3 l = viewSpacePos_c - viewSpacePos_l;
    vec3 r = viewSpacePos_r - viewSpacePos_c;
    vec3 d = viewSpacePos_c - viewSpacePos_d;
    vec3 u = viewSpacePos_u - viewSpacePos_c;

    // get depth values at 1 & 2 pixels offsets from current along the horizontal axis
    vec4 H = vec4(
        getDepth(vpos + vec2(-1.0, 0.0) / uTexSize, transparentFlag),
        getDepth(vpos + vec2( 1.0, 0.0) / uTexSize, transparentFlag),
        getDepth(vpos + vec2(-2.0, 0.0) / uTexSize, transparentFlag),
        getDepth(vpos + vec2( 2.0, 0.0) / uTexSize, transparentFlag)
    );

    // get depth values at 1 & 2 pixels offsets from current along the vertical axis
    vec4 V = vec4(
        getDepth(vpos + vec2(0.0,-1.0) / uTexSize, transparentFlag),
        getDepth(vpos + vec2(0.0, 1.0) / uTexSize, transparentFlag),
        getDepth(vpos + vec2(0.0,-2.0) / uTexSize, transparentFlag),
        getDepth(vpos + vec2(0.0, 2.0) / uTexSize, transparentFlag)
    );

    // current pixel's depth difference from slope of offset depth samples
    // differs from original article because we're using non-linear depth values
    // see article's comments
    vec2 he = abs((2.0 * H.xy - H.zw) - c);
    vec2 ve = abs((2.0 * V.xy - V.zw) - c);

    // pick horizontal and vertical diff with the smallest depth difference from slopes
    vec3 hDeriv = he.x < he.y ? l : r;
    vec3 vDeriv = ve.x < ve.y ? d : u;

    // get view space normal from the cross product of the best derivatives
    vec3 viewNormal = normalize(cross(hDeriv, vDeriv));

    return viewNormal;
}

float getPixelSize(const in vec2 coords, const in float depth) {
    vec3 viewPos0 = screenSpaceToViewSpace(vec3(coords, depth), uInvProjection);
    vec3 viewPos1 = screenSpaceToViewSpace(vec3(coords + vec2(1.0, 0.0) / uTexSize, depth), uInvProjection);
    return distance(viewPos0, viewPos1);
}

// StarCraft II Ambient Occlusion by [Filion and McNaughton 2008]
void main(void) {
    vec2 invTexSize = 1.0 / uTexSize;
    vec2 selfCoords = gl_FragCoord.xy * invTexSize;
    float selfDepth = getDepth(selfCoords, uTransparencyFlag);
    vec2 selfPackedDepth = packUnitIntervalToRG(selfDepth);

    if (isBackground(selfDepth)) {
        gl_FragColor = vec4(packUnitIntervalToRG(1.0), selfPackedDepth);
        return;
    }

    vec3 selfViewNormal = viewNormalAtPixelPositionAccurate(selfCoords, uTransparencyFlag);
    vec3 selfViewPos = screenSpaceToViewSpace(vec3(selfCoords, selfDepth), uInvProjection);

    vec3 randomVec = normalize(vec3(getNoiseVec2(selfCoords) * 2.0 - 1.0, 0.0));
    vec3 tangent = normalize(randomVec - selfViewNormal * dot(randomVec, selfViewNormal));
    vec3 bitangent = cross(selfViewNormal, tangent);
    mat3 TBN = mat3(tangent, bitangent, selfViewNormal);

    float occlusion = 0.0;
    #ifdef dMultiScale
        float pixelSize = getPixelSize(selfCoords, selfDepth);

        for(int l = 0; l < dLevels; l++) {
            // TODO: smooth transition
            if (pixelSize * uNearThreshold > uLevelRadius[l]) continue;
            if (pixelSize * uFarThreshold < uLevelRadius[l]) continue;

            float levelOcclusion = 0.0;
            for(int i = 0; i < dNSamples; i++) {
                // get sample position:
                vec3 sampleViewPos = TBN * uSamples[i];
                sampleViewPos = selfViewPos + sampleViewPos * uLevelRadius[l];

                // project sample position:
                vec4 offset = vec4(sampleViewPos, 1.0);
                offset = uProjection * offset;
                offset.xyz = (offset.xyz / offset.w) * 0.5 + 0.5;

                // get sample depth:
                float sampleOcc = 0.0;
                #ifdef dIllumination
                    if (uTransparencyFlag == 1) {
                #endif
                    float sampleDepth = getMappedDepth(offset.xy, selfCoords);
                    float sampleViewZ = screenSpaceToViewSpace(vec3(offset.xy, sampleDepth), uInvProjection).z;

                    sampleOcc = step(sampleViewPos.z + 0.025, sampleViewZ) * smootherstep(0.0, 1.0, uLevelRadius[l] / abs(selfViewPos.z - sampleViewZ)) * uLevelBias[l];
                #ifdef dIllumination
                    }
                #endif
                #if defined(dIncludeTransparent)
                    vec2 sampleDepthWithAlpha = getMappedDepthTransparentWithAlpha(offset.xy, selfCoords);
                    if (!isBackground(sampleDepthWithAlpha.x)) {
                        float sampleViewZ = screenSpaceToViewSpace(vec3(offset.xy, sampleDepthWithAlpha.x), uInvProjection).z;
                        sampleOcc = max(sampleOcc, step(sampleViewPos.z + 0.025, sampleViewZ) * smootherstep(0.0, 1.0, uLevelRadius[l] / abs(selfViewPos.z - sampleViewZ)) * uLevelBias[l] * sampleDepthWithAlpha.y);
                    }
                #endif

                levelOcclusion += sampleOcc;
            }
            occlusion = max(occlusion, levelOcclusion);
        }
    #else
        for(int i = 0; i < dNSamples; i++) {
            vec3 sampleViewPos = TBN * uSamples[i];
            sampleViewPos = selfViewPos + sampleViewPos * uRadius;

            vec4 offset = vec4(sampleViewPos, 1.0);
            offset = uProjection * offset;
            offset.xyz = (offset.xyz / offset.w) * 0.5 + 0.5;

            float sampleOcc = 0.0;
            #ifdef dIllumination
                if (uTransparencyFlag == 1) {
            #endif
                    // NOTE: using getMappedDepth here causes issues on some mobile devices
                    float sampleDepth = getDepth(offset.xy, 0);
                    float sampleViewZ = screenSpaceToViewSpace(vec3(offset.xy, sampleDepth), uInvProjection).z;

                    sampleOcc = step(sampleViewPos.z + 0.025, sampleViewZ) * smootherstep(0.0, 1.0, uRadius / abs(selfViewPos.z - sampleViewZ));
            #ifdef dIllumination
                }
            #endif
            #if defined(dIncludeTransparent)
                vec2 sampleDepthWithAlpha = getDepthTransparentWithAlpha(offset.xy);
                if (!isBackground(sampleDepthWithAlpha.x)) {
                    float sampleViewZ = screenSpaceToViewSpace(vec3(offset.xy, sampleDepthWithAlpha.x), uInvProjection).z;
                    sampleOcc = max(sampleOcc, step(sampleViewPos.z + 0.025, sampleViewZ) * smootherstep(0.0, 1.0, uRadius / abs(selfViewPos.z - sampleViewZ)) * sampleDepthWithAlpha.y);
                }
            #endif

            occlusion += sampleOcc;
        }
    #endif
    occlusion = 1.0 - (uBias * occlusion / float(dNSamples));

    vec2 packedOcclusion = packUnitIntervalToRG(clamp(occlusion, 0.01, 1.0));

    gl_FragColor = vec4(packedOcclusion, selfPackedDepth);
}
`;var UIe=`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tSsaoDepth;
uniform vec2 uTexSize;
uniform vec4 uBounds;

uniform float uKernel[dOcclusionKernelSize];
uniform float uBlurDepthBias;

uniform float uBlurDirectionX;
uniform float uBlurDirectionY;

uniform mat4 uInvProjection;
uniform float uNear;
uniform float uFar;

#include common

float getViewZ(const in float depth) {
    #if dOrthographic == 1
        return orthographicDepthToViewZ(depth, uNear, uFar);
    #else
        return perspectiveDepthToViewZ(depth, uNear, uFar);
    #endif
}

bool isBackground(const in float depth) {
    return depth == 1.0;
}

bool isNearClip(const in float depth) {
    return depth == 0.0;
}

bool outsideBounds(const in vec2 p) {
    return p.x < uBounds.x || p.y < uBounds.y || p.x > uBounds.z || p.y > uBounds.w;
}

float getPixelSize(const in vec2 coords, const in float depth) {
    vec3 viewPos0 = screenSpaceToViewSpace(vec3(coords, depth), uInvProjection);
    vec3 viewPos1 = screenSpaceToViewSpace(vec3(coords + vec2(1.0, 0.0) / uTexSize, depth), uInvProjection);
    return distance(viewPos0, viewPos1);
}

void main(void) {
    vec2 coords = gl_FragCoord.xy / uTexSize;

    vec2 packedDepth = texture2D(tSsaoDepth, coords).zw;

    if (outsideBounds(coords)) {
        gl_FragColor = vec4(packUnitIntervalToRG(1.0), packedDepth);
        return;
    }

    float selfDepth = unpackRGToUnitInterval(packedDepth);
    // (if background and if second pass) or if near clip
    if ((isBackground(selfDepth) && uBlurDirectionY != 0.0) || isNearClip(selfDepth)) {
        gl_FragColor = vec4(packUnitIntervalToRG(1.0), packedDepth);
        return;
    }

    float selfViewZ = getViewZ(selfDepth);
    float pixelSize = getPixelSize(coords, selfDepth);

    vec2 offset = vec2(uBlurDirectionX, uBlurDirectionY) / uTexSize;

    float sum = 0.0;
    float kernelSum = 0.0;
    const int halfKernelSize = dOcclusionKernelSize / 2;
    // only if kernelSize is odd
    for (int i = -halfKernelSize; i <= halfKernelSize; i++) {
        if (abs(float(i)) > 1.0 && abs(float(i)) * pixelSize > 0.8) continue;

        vec2 sampleCoords = coords + float(i) * offset;
        if (outsideBounds(sampleCoords)) {
            continue;
        }

        vec4 sampleSsaoDepth = texture2D(tSsaoDepth, sampleCoords);

        float sampleDepth = unpackRGToUnitInterval(sampleSsaoDepth.zw);
        if (isBackground(sampleDepth) || isNearClip(sampleDepth)) {
            continue;
        }

        float sampleViewZ = getViewZ(sampleDepth);
        if (abs(selfViewZ - sampleViewZ) >= uBlurDepthBias) {
            continue;
        }

        float kernel = uKernel[int(abs(float(i)))]; // abs is not defined for int in webgl1
        float sampleValue = unpackRGToUnitInterval(sampleSsaoDepth.xy);

        sum += kernel * sampleValue;
        kernelSum += kernel;
    }
    gl_FragColor = vec4(packUnitIntervalToRG(sum / kernelSum), packedDepth);
}
`;var VL={samples:C.Numeric(32,{min:1,max:256,step:1}),multiScale:C.MappedStatic("off",{on:C.Group({levels:C.ObjectList({radius:C.Numeric(5,{min:0,max:20,step:.1},{description:"Final occlusion radius is 2^x"}),bias:C.Numeric(1,{min:0,max:3,step:.1})},e=>`${e.radius}, ${e.bias}`,{defaultValue:[{radius:2,bias:1},{radius:5,bias:1},{radius:8,bias:1},{radius:11,bias:1}]}),nearThreshold:C.Numeric(10,{min:0,max:50,step:1}),farThreshold:C.Numeric(1500,{min:0,max:1e4,step:100})}),off:C.Group({})},{cycle:!0}),radius:C.Numeric(5,{min:0,max:20,step:.1},{description:"Final occlusion radius is 2^x",hideIf:e=>e?.multiScale.name==="on"}),bias:C.Numeric(.8,{min:0,max:3,step:.1}),blurKernelSize:C.Numeric(15,{min:1,max:25,step:2}),blurDepthBias:C.Numeric(.5,{min:0,max:1,step:.01}),resolutionScale:C.Numeric(1,{min:.1,max:1,step:.05},{description:"Adjust resolution of occlusion calculation"}),color:C.Color(0),transparentThreshold:C.Numeric(.4,{min:0,max:1,step:.05})};function $it(e,t,r){let n=e.length,{radius:o,bias:i}=r||{radius:new Array(n*3).fill(0),bias:new Array(n*3).fill(0)};e=e.slice().sort((a,s)=>a.radius-s.radius);for(let a=0;a<n;++a){let s=e[a];o[a]=Math.pow(2,s.radius)*t,i[a]=s.bias}return{count:n,radius:o,bias:i}}var ah=class e{constructor(t,r,n,o,i,a){this.webgl=t;this.invProjection=H.identity();this.levelsCameraScale=-1;let{textureFloatLinear:s}=t.extensions;this.depthTextureOpaque=i,this.depthTextureTransparent=a,this.nSamples=1,this.blurKernelSize=1,this.ssaoScale=this.calcSsaoScale(1),this.texSize=[r,n],this.levels=[],this.framebuffer=t.resources.framebuffer(),this.blurFirstPassFramebuffer=t.resources.framebuffer(),this.blurSecondPassFramebuffer=t.resources.framebuffer();let l=Math.floor(r*this.ssaoScale),u=Math.floor(n*this.ssaoScale),c=Math.max(1,Math.floor(l*.5)),m=Math.max(1,Math.floor(u*.5)),d=Math.max(1,Math.floor(l*.25)),p=Math.max(1,Math.floor(u*.25)),h=s?"linear":"nearest";this.downsampledDepthTargetOpaque=o?t.createRenderTarget(l,u,!1,"uint8","linear","rgba"):t.createRenderTarget(l,u,!1,"float32",h,t.isWebGL2?"alpha":"rgba"),this.downsampleDepthRenderableOpaque=Gm(t,i);let f=this.getDepthTexture();this.depthHalfTargetOpaque=o?t.createRenderTarget(c,m,!1,"uint8","linear","rgba"):t.createRenderTarget(c,m,!1,"float32",h,t.isWebGL2?"alpha":"rgba"),this.depthHalfRenderableOpaque=Gm(t,f),this.depthQuarterTargetOpaque=o?t.createRenderTarget(d,p,!1,"uint8","linear","rgba"):t.createRenderTarget(d,p,!1,"float32",h,t.isWebGL2?"alpha":"rgba"),this.depthQuarterRenderableOpaque=Gm(t,this.depthHalfTargetOpaque.texture),this.downsampledDepthTargetTransparent=t.createRenderTarget(l,u,!1,"uint8","linear","rgba"),this.downsampleDepthRenderableTransparent=Gm(t,a);let g=this.getTransparentDepthTexture();this.depthHalfTargetTransparent=t.createRenderTarget(c,m,!1,"uint8","linear","rgba"),this.depthHalfRenderableTransparent=Gm(t,g),this.depthQuarterTargetTransparent=t.createRenderTarget(d,p,!1,"uint8","linear","rgba"),this.depthQuarterRenderableTransparent=Gm(t,this.depthHalfTargetTransparent.texture),this.ssaoDepthTexture=t.resources.texture("image-uint8","rgba","ubyte","linear"),this.ssaoDepthTexture.define(l,u),this.ssaoDepthTexture.attachFramebuffer(this.framebuffer,"color0"),this.ssaoDepthTransparentTexture=t.resources.texture("image-uint8","rgba","ubyte","linear"),this.ssaoDepthTransparentTexture.define(l,u),this.depthBlurProxyTexture=t.resources.texture("image-uint8","rgba","ubyte","linear"),this.depthBlurProxyTexture.define(l,u),this.depthBlurProxyTexture.attachFramebuffer(this.blurFirstPassFramebuffer,"color0"),this.renderable=tat(t,f,this.depthHalfTargetOpaque.texture,this.depthQuarterTargetOpaque.texture,g,this.depthHalfTargetTransparent.texture,this.depthQuarterTargetTransparent.texture),this.blurFirstPassRenderable=NIe(t,this.ssaoDepthTransparentTexture,"horizontal"),this.blurSecondPassRenderable=NIe(t,this.depthBlurProxyTexture,"vertical")}static isEnabled(t){return t.enabled&&t.occlusion.name!=="off"}static isTransparentEnabled(t,r){return t.opacityAverage<1&&t.transparencyMin<r.transparentThreshold}calcSsaoScale(t){return Math.min(1,1/this.webgl.pixelRatio)*t}getDepthTexture(){return this.ssaoScale===1?this.depthTextureOpaque:this.downsampledDepthTargetOpaque.texture}getTransparentDepthTexture(){return this.ssaoScale===1?this.depthTextureTransparent:this.downsampledDepthTargetTransparent.texture}getByteCount(){return this.downsampledDepthTargetOpaque.getByteCount()+this.depthHalfTargetOpaque.getByteCount()+this.depthQuarterTargetOpaque.getByteCount()+this.downsampledDepthTargetTransparent.getByteCount()+this.depthHalfTargetTransparent.getByteCount()+this.depthQuarterTargetTransparent.getByteCount()+this.ssaoDepthTexture.getByteCount()+this.ssaoDepthTransparentTexture.getByteCount()+this.depthBlurProxyTexture.getByteCount()}setSize(t,r){let[n,o]=this.texSize,i=this.calcSsaoScale(1);if(t!==n||r!==o||this.ssaoScale!==i){this.texSize.splice(0,2,t,r);let a=Math.floor(t*this.ssaoScale),s=Math.floor(r*this.ssaoScale);this.ssaoDepthTexture.define(a,s),this.ssaoDepthTransparentTexture.define(a,s),this.depthBlurProxyTexture.define(a,s);let l=Math.max(1,Math.floor(a*.5)),u=Math.max(1,Math.floor(s*.5)),c=Math.max(1,Math.floor(a*.25)),m=Math.max(1,Math.floor(s*.25));this.downsampledDepthTargetOpaque.setSize(a,s),this.depthHalfTargetOpaque.setSize(l,u),this.depthQuarterTargetOpaque.setSize(c,m),_.update(this.downsampleDepthRenderableOpaque.values.uTexSize,Ce.set(this.downsampleDepthRenderableOpaque.values.uTexSize.ref.value,a,s)),_.update(this.depthHalfRenderableOpaque.values.uTexSize,Ce.set(this.depthHalfRenderableOpaque.values.uTexSize.ref.value,l,u)),_.update(this.depthQuarterRenderableOpaque.values.uTexSize,Ce.set(this.depthQuarterRenderableOpaque.values.uTexSize.ref.value,c,m)),this.downsampledDepthTargetTransparent.setSize(a,s),this.depthHalfTargetTransparent.setSize(l,u),this.depthQuarterTargetTransparent.setSize(c,m),_.update(this.downsampleDepthRenderableTransparent.values.uTexSize,Ce.set(this.downsampleDepthRenderableTransparent.values.uTexSize.ref.value,a,s)),_.update(this.depthHalfRenderableTransparent.values.uTexSize,Ce.set(this.depthHalfRenderableTransparent.values.uTexSize.ref.value,l,u)),_.update(this.depthQuarterRenderableTransparent.values.uTexSize,Ce.set(this.depthQuarterRenderableTransparent.values.uTexSize.ref.value,c,m)),_.update(this.renderable.values.uTexSize,Ce.set(this.renderable.values.uTexSize.ref.value,a,s)),_.update(this.blurFirstPassRenderable.values.uTexSize,Ce.set(this.blurFirstPassRenderable.values.uTexSize.ref.value,a,s)),_.update(this.blurSecondPassRenderable.values.uTexSize,Ce.set(this.blurSecondPassRenderable.values.uTexSize.ref.value,a,s));let d=this.getDepthTexture(),p=this.getTransparentDepthTexture();_.update(this.depthHalfRenderableOpaque.values.tColor,d),_.update(this.depthHalfRenderableTransparent.values.tColor,p),_.update(this.renderable.values.tDepth,d),_.update(this.renderable.values.tDepthTransparent,p),this.depthHalfRenderableOpaque.update(),this.depthHalfRenderableTransparent.update(),this.renderable.update()}}reset(){this.ssaoDepthTexture.attachFramebuffer(this.framebuffer,"color0"),this.depthBlurProxyTexture.attachFramebuffer(this.blurFirstPassFramebuffer,"color0")}update(t,r,n,o=!1){let i=!1,a=!1,s=!1,l=t.state.mode==="orthographic"?1:0,u=H.invert(this.invProjection,t.projection),[c,m]=this.texSize,d=t.viewport;_.update(this.renderable.values.uProjection,t.projection),_.update(this.renderable.values.uInvProjection,u);let p=this.renderable.values.uBounds,h=this.ssaoScale;Et.set(p.ref.value,Math.floor(d.x*h)/(c*h),Math.floor(d.y*h)/(m*h),Math.ceil((d.x+d.width)*h)/(c*h),Math.ceil((d.y+d.height)*h)/(m*h)),_.update(p,p.ref.value),_.update(this.blurFirstPassRenderable.values.uBounds,p.ref.value),_.update(this.blurSecondPassRenderable.values.uBounds,p.ref.value),_.updateIfChanged(this.blurFirstPassRenderable.values.uNear,t.near),_.updateIfChanged(this.blurSecondPassRenderable.values.uNear,t.near),_.updateIfChanged(this.blurFirstPassRenderable.values.uFar,t.far),_.updateIfChanged(this.blurSecondPassRenderable.values.uFar,t.far),_.update(this.blurFirstPassRenderable.values.uInvProjection,u),_.update(this.blurSecondPassRenderable.values.uInvProjection,u),_.update(this.blurFirstPassRenderable.values.uBlurDepthBias,n.blurDepthBias*t.scale),_.update(this.blurSecondPassRenderable.values.uBlurDepthBias,n.blurDepthBias*t.scale),this.blurFirstPassRenderable.values.dOrthographic.ref.value!==l&&(a=!0,_.update(this.blurFirstPassRenderable.values.dOrthographic,l),_.update(this.blurSecondPassRenderable.values.dOrthographic,l));let f=e.isTransparentEnabled(r,n);this.renderable.values.dIncludeTransparent.ref.value!==f&&(i=!0,_.update(this.renderable.values.dIncludeTransparent,f)),this.renderable.values.dIllumination.ref.value!==o&&(i=!0,_.update(this.renderable.values.dIllumination,o)),this.nSamples!==n.samples&&(i=!0,this.nSamples=n.samples,_.update(this.renderable.values.uSamples,HIe(this.nSamples)),_.updateIfChanged(this.renderable.values.dNSamples,this.nSamples));let g=n.multiScale.name==="on";if(this.renderable.values.dMultiScale.ref.value!==g&&(i=!0,_.update(this.renderable.values.dMultiScale,g)),n.multiScale.name==="on"){let x=n.multiScale.params;if(this.levelsCameraScale!==t.scale||!qi(this.levels,x.levels)){i=!0,this.levelsCameraScale=t.scale,this.levels=x.levels;let S=$it(x.levels,t.scale);_.updateIfChanged(this.renderable.values.dLevels,S.count),_.update(this.renderable.values.uLevelRadius,S.radius),_.update(this.renderable.values.uLevelBias,S.bias)}_.updateIfChanged(this.renderable.values.uNearThreshold,x.nearThreshold),_.updateIfChanged(this.renderable.values.uFarThreshold,x.farThreshold)}else _.updateIfChanged(this.renderable.values.uRadius,Math.pow(2,n.radius)*t.scale);if(_.updateIfChanged(this.renderable.values.uBias,n.bias),this.blurKernelSize!==n.blurKernelSize){a=!0,this.blurKernelSize=n.blurKernelSize;let x=zIe(this.blurKernelSize);_.update(this.blurFirstPassRenderable.values.uKernel,x),_.update(this.blurSecondPassRenderable.values.uKernel,x),_.update(this.blurFirstPassRenderable.values.dOcclusionKernelSize,this.blurKernelSize),_.update(this.blurSecondPassRenderable.values.dOcclusionKernelSize,this.blurKernelSize)}let y=this.calcSsaoScale(n.resolutionScale);if(this.ssaoScale!==y){i=!0,s=!0,this.ssaoScale=y;let x=Math.floor(c*this.ssaoScale),S=Math.floor(m*this.ssaoScale);this.ssaoDepthTexture.define(x,S),this.ssaoDepthTransparentTexture.define(x,S),this.depthBlurProxyTexture.define(x,S);let I=Math.floor(x*.5),v=Math.floor(S*.5),A=Math.floor(x*.25),P=Math.floor(S*.25);this.downsampledDepthTargetOpaque.setSize(x,S),this.depthHalfTargetOpaque.setSize(I,v),this.depthQuarterTargetOpaque.setSize(A,P);let T=this.getDepthTexture();_.update(this.depthHalfRenderableOpaque.values.tColor,T),_.update(this.renderable.values.tDepth,T),_.update(this.renderable.values.tDepthHalf,this.depthHalfTargetOpaque.texture),_.update(this.renderable.values.tDepthQuarter,this.depthQuarterTargetOpaque.texture),_.update(this.downsampleDepthRenderableOpaque.values.uTexSize,Ce.set(this.downsampleDepthRenderableOpaque.values.uTexSize.ref.value,x,S)),_.update(this.depthHalfRenderableOpaque.values.uTexSize,Ce.set(this.depthHalfRenderableOpaque.values.uTexSize.ref.value,I,v)),_.update(this.depthQuarterRenderableOpaque.values.uTexSize,Ce.set(this.depthQuarterRenderableOpaque.values.uTexSize.ref.value,A,P)),this.downsampledDepthTargetTransparent.setSize(x,S),this.depthHalfTargetTransparent.setSize(I,v),this.depthQuarterTargetTransparent.setSize(A,P);let R=this.getTransparentDepthTexture();_.update(this.depthHalfRenderableTransparent.values.tColor,R),_.update(this.renderable.values.tDepthTransparent,R),_.update(this.renderable.values.tDepthHalfTransparent,this.depthHalfTargetTransparent.texture),_.update(this.renderable.values.tDepthQuarterTransparent,this.depthQuarterTargetTransparent.texture),_.update(this.downsampleDepthRenderableTransparent.values.uTexSize,Ce.set(this.downsampleDepthRenderableTransparent.values.uTexSize.ref.value,x,S)),_.update(this.depthHalfRenderableTransparent.values.uTexSize,Ce.set(this.depthHalfRenderableTransparent.values.uTexSize.ref.value,I,v)),_.update(this.depthQuarterRenderableTransparent.values.uTexSize,Ce.set(this.depthQuarterRenderableTransparent.values.uTexSize.ref.value,A,P)),_.update(this.renderable.values.uTexSize,Ce.set(this.renderable.values.uTexSize.ref.value,x,S)),_.update(this.blurFirstPassRenderable.values.uTexSize,Ce.set(this.blurFirstPassRenderable.values.uTexSize.ref.value,x,S)),_.update(this.blurSecondPassRenderable.values.uTexSize,Ce.set(this.blurSecondPassRenderable.values.uTexSize.ref.value,x,S))}i&&this.renderable.update(),a&&(this.blurFirstPassRenderable.update(),this.blurSecondPassRenderable.update()),s&&(this.depthHalfRenderableOpaque.update(),this.depthHalfRenderableTransparent.update())}render(t){je&&this.webgl.timer.mark("SSAO.render");let{state:r}=this.webgl,{x:n,y:o,width:i,height:a}=t.viewport,s=this.renderable.values.dIncludeTransparent.ref.value,l=this.renderable.values.dMultiScale.ref.value,u=Math.floor(n*this.ssaoScale),c=Math.floor(o*this.ssaoScale),m=Math.ceil(i*this.ssaoScale),d=Math.ceil(a*this.ssaoScale);r.viewport(u,c,m,d),r.scissor(u,c,m,d),this.ssaoScale<1&&(je&&this.webgl.timer.mark("SSAO.downsample"),this.downsampledDepthTargetOpaque.bind(),this.downsampleDepthRenderableOpaque.render(),s&&(this.downsampledDepthTargetTransparent.bind(),this.downsampleDepthRenderableTransparent.render()),je&&this.webgl.timer.markEnd("SSAO.downsample")),je&&this.webgl.timer.mark("SSAO.half"),l&&(this.depthHalfTargetOpaque.bind(),this.depthHalfRenderableOpaque.render()),l&&s&&(this.depthHalfTargetTransparent.bind(),this.depthHalfRenderableTransparent.render()),je&&this.webgl.timer.markEnd("SSAO.half"),je&&this.webgl.timer.mark("SSAO.quarter"),l&&(this.depthQuarterTargetOpaque.bind(),this.depthQuarterRenderableOpaque.render()),l&&s&&(this.depthQuarterTargetTransparent.bind(),this.depthQuarterRenderableTransparent.render()),je&&this.webgl.timer.markEnd("SSAO.quarter"),je&&this.webgl.timer.mark("SSAO.opaque"),this.ssaoDepthTexture.attachFramebuffer(this.framebuffer,"color0"),_.update(this.renderable.values.uTransparencyFlag,0),this.framebuffer.bind(),this.renderable.render(),je&&this.webgl.timer.markEnd("SSAO.opaque"),je&&this.webgl.timer.mark("SSAO.blurOpaque"),_.update(this.blurFirstPassRenderable.values.tSsaoDepth,this.ssaoDepthTexture),this.blurFirstPassRenderable.update(),this.blurFirstPassFramebuffer.bind(),this.blurFirstPassRenderable.render(),this.ssaoDepthTexture.attachFramebuffer(this.blurSecondPassFramebuffer,"color0"),this.blurSecondPassFramebuffer.bind(),this.blurSecondPassRenderable.render(),je&&this.webgl.timer.markEnd("SSAO.blurOpaque"),s&&(je&&this.webgl.timer.mark("SSAO.transparent "),this.ssaoDepthTransparentTexture.attachFramebuffer(this.framebuffer,"color0"),_.update(this.renderable.values.uTransparencyFlag,1),this.framebuffer.bind(),this.renderable.render(),je&&this.webgl.timer.markEnd("SSAO.transparent "),je&&this.webgl.timer.mark("SSAO.blurTransparent "),_.update(this.blurFirstPassRenderable.values.tSsaoDepth,this.ssaoDepthTransparentTexture),this.blurFirstPassRenderable.update(),this.blurFirstPassFramebuffer.bind(),this.blurFirstPassRenderable.render(),this.ssaoDepthTransparentTexture.attachFramebuffer(this.blurSecondPassFramebuffer,"color0"),this.blurSecondPassFramebuffer.bind(),this.blurSecondPassRenderable.render(),je&&this.webgl.timer.markEnd("SSAO.blurTransparent ")),je&&this.webgl.timer.markEnd("SSAO.render")}},eat={...Sn,tDepth:yt("texture","rgba","ubyte","linear"),tDepthHalf:yt("texture","rgba","ubyte","linear"),tDepthQuarter:yt("texture","rgba","ubyte","linear"),dIllumination:dt("boolean"),uTransparencyFlag:de("i"),dIncludeTransparent:dt("boolean"),tDepthTransparent:yt("texture","rgba","ubyte","linear"),tDepthHalfTransparent:yt("texture","rgba","ubyte","linear"),tDepthQuarterTransparent:yt("texture","rgba","ubyte","linear"),uSamples:de("v3[]"),dNSamples:dt("number"),uProjection:de("m4"),uInvProjection:de("m4"),uBounds:de("v4"),uTexSize:de("v2"),uRadius:de("f"),uBias:de("f"),dMultiScale:dt("boolean"),dLevels:dt("number"),uLevelRadius:de("f[]"),uLevelBias:de("f[]"),uNearThreshold:de("f"),uFarThreshold:de("f")};function tat(e,t,r,n,o,i,a){let s={...vn,tDepth:_.create(t),tDepthHalf:_.create(r),tDepthQuarter:_.create(n),dIllumination:_.create(!1),dIncludeTransparent:_.create(!0),uTransparencyFlag:_.create(0),tDepthTransparent:_.create(o),tDepthHalfTransparent:_.create(i),tDepthQuarterTransparent:_.create(a),uSamples:_.create(HIe(32)),dNSamples:_.create(32),uProjection:_.create(H.identity()),uInvProjection:_.create(H.identity()),uBounds:_.create(Et()),uTexSize:_.create(Ce.create(e.gl.drawingBufferWidth,e.gl.drawingBufferHeight)),uRadius:_.create(Math.pow(2,5)),uBias:_.create(.8),dMultiScale:_.create(!1),dLevels:_.create(3),uLevelRadius:_.create([Math.pow(2,2),Math.pow(2,5),Math.pow(2,8)]),uLevelBias:_.create([.8,.8,.8]),uNearThreshold:_.create(10),uFarThreshold:_.create(1500)},l={...eat},u=zr("ssao",Fn,GIe),c=on(e,"triangles",u,l,s);return an(c,s)}var rat={...Sn,tSsaoDepth:yt("texture","rgba","ubyte","nearest"),uTexSize:de("v2"),uKernel:de("f[]"),dOcclusionKernelSize:dt("number"),uBlurDepthBias:de("f"),uBlurDirectionX:de("f"),uBlurDirectionY:de("f"),uInvProjection:de("m4"),uNear:de("f"),uFar:de("f"),uBounds:de("v4"),dOrthographic:dt("number")};function NIe(e,t,r){let n={...vn,tSsaoDepth:_.create(t),uTexSize:_.create(Ce.create(t.getWidth(),t.getHeight())),uKernel:_.create(zIe(15)),dOcclusionKernelSize:_.create(15),uBlurDepthBias:_.create(.5),uBlurDirectionX:_.create(r==="horizontal"?1:0),uBlurDirectionY:_.create(r==="vertical"?1:0),uInvProjection:_.create(H.identity()),uNear:_.create(0),uFar:_.create(1e4),uBounds:_.create(Et()),dOrthographic:_.create(0)},o={...rat},i=zr("ssao_blur",Fn,UIe),a=on(e,"triangles",i,o,n);return an(a,n)}function zIe(e){let t=e/3,r=Math.floor((e+1)/2),n=[];for(let o=0;o<r;o++)n.push(1/(Math.sqrt(2*Math.PI)*t)*Math.exp(-o*o/(2*t*t)));return n}var LL=[];for(let e=0;e<256;e++){let t=b();t[0]=Math.random()*2-1,t[1]=Math.random()*2-1,t[2]=Math.random(),b.normalize(t,t),b.scale(t,t,Math.random()),LL.push(t)}function HIe(e){let t=[];for(let r=0;r<e;r++){let n=(r*r+2*r+1)/(e*e);n=.1+n*(1-.1),t.push(LL[r][0]*n),t.push(LL[r][1]*n),t.push(LL[r][2]*n)}return t}var nat={...Sn,tSsaoDepth:yt("texture","rgba","ubyte","nearest"),tSsaoDepthTransparent:yt("texture","rgba","ubyte","nearest"),tColor:yt("texture","rgba","ubyte","nearest"),tTransparentColor:yt("texture","rgba","ubyte","nearest"),dBlendTransparency:dt("boolean"),tDepthOpaque:yt("texture","rgba","ubyte","nearest"),tDepthTransparent:yt("texture","rgba","ubyte","nearest"),tShadows:yt("texture","rgba","ubyte","nearest"),tOutlines:yt("texture","rgba","ubyte","nearest"),uTexSize:de("v2"),dOrthographic:dt("number"),uNear:de("f"),uFar:de("f"),uFogNear:de("f"),uFogFar:de("f"),uFogColor:de("v3"),uOutlineColor:de("v3"),uOcclusionColor:de("v3"),uTransparentBackground:de("b"),dOcclusionEnable:dt("boolean"),dOcclusionSingleDepth:dt("boolean"),dOcclusionIncludeOpacity:dt("boolean"),dOcclusionIncludeTransparency:dt("boolean"),uOcclusionOffset:de("v2"),dShadowEnable:dt("boolean"),dOutlineEnable:dt("boolean"),dOutlineScale:dt("number"),dTransparentOutline:dt("boolean")};function oat(e,t,r,n,o,i,a,s,l,u){let c={...vn,tSsaoDepth:_.create(s),tSsaoDepthTransparent:_.create(l),tColor:_.create(t),tTransparentColor:_.create(r),dBlendTransparency:_.create(!0),tDepthOpaque:_.create(n),tDepthTransparent:_.create(o),tShadows:_.create(i),tOutlines:_.create(a),uTexSize:_.create(Ce.create(t.getWidth(),t.getHeight())),dOrthographic:_.create(0),uNear:_.create(1),uFar:_.create(1e4),uFogNear:_.create(1e4),uFogFar:_.create(1e4),uFogColor:_.create(b.create(1,1,1)),uOutlineColor:_.create(b.create(0,0,0)),uOcclusionColor:_.create(b.create(0,0,0)),uTransparentBackground:_.create(!1),dOcclusionEnable:_.create(!0),dOcclusionSingleDepth:_.create(!1),dOcclusionIncludeOpacity:_.create(!0),dOcclusionIncludeTransparency:_.create(!1),uOcclusionOffset:_.create(Ce.create(0,0)),dShadowEnable:_.create(!1),dOutlineEnable:_.create(!1),dOutlineScale:_.create(1),dTransparentOutline:_.create(u)},m={...nat},d=zr("postprocessing",Fn,fIe),p=on(e,"triangles",d,m,c);return an(p,c)}var eT={enabled:C.Boolean(!0),occlusion:C.MappedStatic("on",{on:C.Group(VL),off:C.Group({})},{cycle:!0,description:"Darken occluded crevices with the ambient occlusion effect",hideIf:e=>e.enabled===!1}),shadow:C.MappedStatic("off",{on:C.Group(FL),off:C.Group({})},{cycle:!0,description:"Simplistic shadows",hideIf:e=>e.enabled===!1}),outline:C.MappedStatic("off",{on:C.Group(kL),off:C.Group({})},{cycle:!0,description:"Draw outline around 3D objects",hideIf:e=>e.enabled===!1}),dof:C.MappedStatic("off",{on:C.Group(BL),off:C.Group({})},{cycle:!0,description:"DOF",hideIf:e=>e.enabled===!1}),antialiasing:C.MappedStatic("smaa",{fxaa:C.Group(gIe),smaa:C.Group(IIe),off:C.Group({})},{options:[["fxaa","FXAA"],["smaa","SMAA"],["off","Off"]],description:"Smooth pixel edges",hideIf:e=>e.enabled===!1}),sharpening:C.MappedStatic("off",{on:C.Group(BIe),off:C.Group({})},{cycle:!0,description:"Contrast Adaptive Sharpening",hideIf:e=>e.enabled===!1}),background:C.Group(wL,{isFlat:!0,hideIf:e=>e.enabled===!1}),bloom:C.MappedStatic("on",{on:C.Group(EL),off:C.Group({})},{cycle:!0,description:"Bloom",hideIf:e=>e.enabled===!1})},ms=class e{constructor(t,r,n){this.webgl=t;this.drawPass=n;this.occlusionOffset=[0,0];this.transparentBackground=!1;let{colorTarget:o,transparentColorTarget:i,depthTextureOpaque:a,depthTextureTransparent:s,packedDepth:l}=n,u=o.getWidth(),c=o.getHeight();this.target=t.createRenderTarget(u,c,!1,"uint8","linear"),this.ssao=new ah(t,u,c,l,a,s),this.shadow=new $A(t,u,c,a),this.outline=new Og(t,u,c,s,a),this.renderable=oat(t,o.texture,i.texture,a,s,this.shadow.target.texture,this.outline.target.texture,this.ssao.ssaoDepthTexture,this.ssao.ssaoDepthTransparentTexture,!0),this.background=new DL(t,r,u,c)}static isEnabled(t){return t.enabled&&(ah.isEnabled(t)||$A.isEnabled(t)||Og.isEnabled(t)||t.background.variant.name!=="off")}static isTransparentDepthRequired(t,r){return r.enabled&&(Hp.isEnabled(r)||Og.isEnabled(r)&&e.isTransparentOutlineEnabled(r)||ah.isEnabled(r)&&e.isTransparentSsaoEnabled(t,r))&&t.opacityAverage<1}static isTransparentOutlineEnabled(t){return t.enabled&&Og.isEnabled(t)&&(t.outline.params.includeTransparent??!0)}static isTransparentSsaoEnabled(t,r){return r.enabled&&ah.isEnabled(r)&&ah.isTransparentEnabled(t,r.occlusion.params)}static isSsaoEnabled(t){return t.enabled&&ah.isEnabled(t)}getByteCount(){return this.target.getByteCount()+this.ssao.getByteCount()+this.shadow.getByteCount()+this.outline.getByteCount()}setSize(t,r){let[n,o]=this.renderable.values.uTexSize.ref.value;(t!==n||r!==o)&&(this.target.setSize(t,r),_.update(this.renderable.values.uTexSize,Ce.set(this.renderable.values.uTexSize.ref.value,t,r))),this.ssao.setSize(t,r),this.shadow.setSize(t,r),this.outline.setSize(t,r),this.background.setSize(t,r)}reset(){this.ssao.reset()}updateState(t,r,n,o,i,a,s){let l=!1,u=t.state.mode==="orthographic"?1:0,c=Og.isEnabled(i),m=$A.isEnabled(i),d=ah.isEnabled(i);if(d){let g=i.occlusion.params;this.ssao.update(t,r,g);let y=ah.isTransparentEnabled(r,g);this.renderable.values.dOcclusionIncludeTransparency.ref.value!==y&&(l=!0,_.update(this.renderable.values.dOcclusionIncludeTransparency,y)),_.update(this.renderable.values.uOcclusionColor,Le.toVec3Normalized(this.renderable.values.uOcclusionColor.ref.value,g.color))}if(m&&this.shadow.update(t,a,s,i.shadow.params),c){let g=i.outline.params,{transparentOutline:y,outlineScale:x}=this.outline.update(t,g,this.drawPass.depthTextureTransparent,this.drawPass.depthTextureOpaque);_.update(this.renderable.values.uOutlineColor,Le.toVec3Normalized(this.renderable.values.uOutlineColor.ref.value,g.color)),this.renderable.values.dOutlineScale.ref.value!==x&&(l=!0,_.update(this.renderable.values.dOutlineScale,x)),this.renderable.values.dTransparentOutline.ref.value!==y&&(l=!0,_.update(this.renderable.values.dTransparentOutline,y))}_.updateIfChanged(this.renderable.values.uFar,t.far),_.updateIfChanged(this.renderable.values.uNear,t.near),_.updateIfChanged(this.renderable.values.uFogFar,t.fogFar),_.updateIfChanged(this.renderable.values.uFogNear,t.fogNear),_.update(this.renderable.values.uFogColor,Le.toVec3Normalized(this.renderable.values.uFogColor.ref.value,o)),_.updateIfChanged(this.renderable.values.uTransparentBackground,n),this.renderable.values.dOrthographic.ref.value!==u&&(l=!0,_.update(this.renderable.values.dOrthographic,u)),this.renderable.values.dOutlineEnable.ref.value!==c&&(l=!0,_.update(this.renderable.values.dOutlineEnable,c)),this.renderable.values.dShadowEnable.ref.value!==m&&(l=!0,_.update(this.renderable.values.dShadowEnable,m)),this.renderable.values.dOcclusionEnable.ref.value!==d&&(l=!0,_.update(this.renderable.values.dOcclusionEnable,d));let p=r.opacityAverage<1;this.renderable.values.dBlendTransparency.ref.value!==p&&(l=!0,_.update(this.renderable.values.dBlendTransparency,p)),l&&this.renderable.update();let{gl:h,state:f}=this.webgl;f.enable(h.SCISSOR_TEST),f.disable(h.BLEND),f.disable(h.DEPTH_TEST),f.depthMask(!1)}setOcclusionOffset(t,r){this.occlusionOffset[0]=t,this.occlusionOffset[1]=r,_.update(this.renderable.values.uOcclusionOffset,Ce.set(this.renderable.values.uOcclusionOffset.ref.value,t,r))}setTransparentBackground(t){this.transparentBackground=t}render(t,r,n,o,i,a,s,l){je&&this.webgl.timer.mark("PostprocessingPass.render"),this.updateState(t,r,o,i,a,s,l);let{state:u}=this.webgl,{x:c,y:m,width:d,height:p}=t.viewport;a.occlusion.name==="on"&&this.occlusionOffset[0]===0&&this.occlusionOffset[1]===0&&this.ssao.render(t),u.viewport(c,m,d,p),u.scissor(c,m,d,p),a.outline.name==="on"&&this.outline.render(),a.shadow.name==="on"&&this.shadow.render(),n?this.webgl.bindDrawingBuffer():this.target.bind(),this.background.update(t,a.background),this.background.clear(a.background,this.transparentBackground,i),this.background.render(a.background),this.renderable.render(),je&&this.webgl.timer.markEnd("PostprocessingPass.render")}},Gg=class{static isEnabled(t){return t.enabled&&(t.antialiasing.name!=="off"||t.sharpening.name!=="off")}constructor(t,r,n){this.target=t.createRenderTarget(r,n,!1),this.internalTarget=t.createRenderTarget(r,n,!1),this.fxaa=new _L(t,this.target.texture),this.smaa=new RL(t,this.target.texture),this.cas=new ML(t,this.target.texture)}getByteCount(){return this.target.getByteCount()+this.internalTarget.getByteCount()+this.smaa.getByteCount()}setSize(t,r){let n=this.target.texture.getWidth(),o=this.target.texture.getHeight();(t!==n||r!==o)&&(this.target.setSize(t,r),this.internalTarget.setSize(t,r),this.fxaa.setSize(t,r),this.smaa.supported&&this.smaa.setSize(t,r),this.cas.setSize(t,r))}_renderFxaa(t,r,n,o){o.antialiasing.name==="fxaa"&&(this.fxaa.update(r,o.antialiasing.params),this.fxaa.render(t.viewport,n))}_renderSmaa(t,r,n,o){o.antialiasing.name==="smaa"&&(this.smaa.update(r,o.antialiasing.params),this.smaa.render(t.viewport,n))}_renderAntialiasing(t,r,n,o){o.antialiasing.name==="fxaa"?this._renderFxaa(t,r,n,o):o.antialiasing.name==="smaa"&&this._renderSmaa(t,r,n,o)}_renderCas(t,r,n,o){o.sharpening.name==="on"&&(o.antialiasing.name!=="off"&&(r=this.internalTarget.texture),this.cas.update(r,o.sharpening.params),this.cas.render(t.viewport,n))}render(t,r,n,o){if(o.antialiasing.name==="off"&&o.sharpening.name==="off")return;if(o.antialiasing.name==="smaa"&&!this.smaa.supported){console.error('SMAA not supported, missing "HTMLImageElement"');return}let i=n===!0?void 0:n===!1?this.target:n;o.sharpening.name==="off"?this._renderAntialiasing(t,r,i,o):o.antialiasing.name==="off"?this._renderCas(t,r,i,o):(this._renderAntialiasing(t,r,this.internalTarget,o),this._renderCas(t,r,i,o))}};var OL=`
precision highp float;
precision highp sampler2D;

uniform sampler2D tColor;
uniform vec2 uTexSize;
uniform float uWeight;

void main() {
    vec2 coords = gl_FragCoord.xy / uTexSize;
    gl_FragColor = texture2D(tColor, coords) * uWeight;
}
`;var iat={...Sn,tColor:yt("texture","rgba","ubyte","nearest"),uTexSize:de("v2"),uWeight:de("f")},aat=zr("compose",Fn,OL);function sat(e,t){let r={...vn,tColor:_.create(t),uTexSize:_.create(Ce.create(t.getWidth(),t.getHeight())),uWeight:_.create(1)},n={...iat},o=on(e,"triangles",aat,n,r);return an(o,r)}var GL={mode:C.Select("temporal",[["off","Off"],["on","On"],["temporal","Temporal"]]),sampleLevel:C.Numeric(2,{min:0,max:5,step:1},{description:"Take level^2 samples."}),reduceFlicker:C.Boolean(!0,{description:'Reduce flicker in "temporal" mode.'}),reuseOcclusion:C.Boolean(!0,{description:"Reuse occlusion data. It is faster but has some artefacts."})},Tb=class{constructor(t,r){this.webgl=t;this.drawPass=r;let{colorBufferFloat:n,textureFloat:o,colorBufferHalfFloat:i,textureHalfFloat:a}=t.extensions,s=r.colorTarget.getWidth(),l=r.colorTarget.getHeight();this.colorTarget=t.createRenderTarget(s,l,!1);let u=i&&a?"fp16":n&&o?"float32":"uint8";this.composeTarget=t.createRenderTarget(s,l,!1,u),this.holdTarget=t.createRenderTarget(s,l,!1),this.compose=sat(t,r.colorTarget.texture)}static isEnabled(t){return t.mode!=="off"}getByteCount(){return this.colorTarget.getByteCount()+this.composeTarget.getByteCount()+this.holdTarget.getByteCount()}syncSize(){let t=this.drawPass.colorTarget.getWidth(),r=this.drawPass.colorTarget.getHeight(),[n,o]=this.compose.values.uTexSize.ref.value;(t!==n||r!==o)&&(this.colorTarget.setSize(t,r),this.composeTarget.setSize(t,r),this.holdTarget.setSize(t,r),_.update(this.compose.values.uTexSize,Ce.set(this.compose.values.uTexSize.ref.value,t,r)))}render(t,r,n,o,i){return n.multiSample.mode==="temporal"&&!i?this.renderTemporalMultiSample(t,r,n,o):(this.renderMultiSample(r,o,n),-2)}bindOutputTarget(t){t?this.webgl.bindDrawingBuffer():this.colorTarget.bind()}renderMultiSample(t,r,n){let{camera:o}=t,{compose:i,composeTarget:a,drawPass:s,webgl:l}=this,{gl:u,state:c}=l;je&&l.timer.mark("MultiSamplePass.renderMultiSample");let m=KR[Math.max(0,Math.min(n.multiSample.sampleLevel,5))],{x:d,y:p,width:h,height:f}=o.viewport,g=1/m.length,y=1/32;o.viewOffset.enabled=!0,_.update(i.values.tColor,s.getColorTarget(n.postprocessing).texture),i.update();for(let x=0;x<m.length;++x){let S=m[x];ro.setViewOffset(o.viewOffset,h,f,S[0],S[1],h,f),o.update();let I=-.5+(x+.5)/m.length,v=g+y*I;_.update(i.values.uWeight,v),x===0||!n.multiSample.reuseOcclusion?s.postprocessing.setOcclusionOffset(0,0):s.postprocessing.setOcclusionOffset(S[0]/h,S[1]/f),s.render(t,n,!1),a.bind(),c.enable(u.BLEND),c.blendEquationSeparate(u.FUNC_ADD,u.FUNC_ADD),c.blendFuncSeparate(u.ONE,u.ONE,u.ONE,u.ONE),c.disable(u.DEPTH_TEST),c.depthMask(!1),c.viewport(d,p,h,f),c.scissor(d,p,h,f),x===0&&(c.clearColor(0,0,0,0),u.clear(u.COLOR_BUFFER_BIT)),i.render()}s.postprocessing.setOcclusionOffset(0,0),_.update(i.values.uWeight,1),_.update(i.values.tColor,a.texture),i.update(),this.bindOutputTarget(r),c.viewport(d,p,h,f),c.scissor(d,p,h,f),c.disable(u.BLEND),i.render(),o.viewOffset.enabled=!1,o.update(),je&&l.timer.markEnd("MultiSamplePass.renderMultiSample")}renderTemporalMultiSample(t,r,n,o){let{camera:i}=r,{compose:a,composeTarget:s,holdTarget:l,drawPass:u,webgl:c}=this,{gl:m,state:d}=c;je&&c.timer.mark("MultiSamplePass.renderTemporalMultiSample");let p=KR[Math.max(0,Math.min(n.multiSample.sampleLevel,5))];if(t===-2||t>=p.length)return-2;let{x:h,y:f,width:g,height:y}=i.viewport,x=1/p.length;if(t===-1)u.render(r,n,!1),_.update(a.values.uWeight,1),_.update(a.values.tColor,u.getColorTarget(n.postprocessing).texture),a.update(),l.bind(),d.disable(m.BLEND),d.disable(m.DEPTH_TEST),d.depthMask(!1),d.viewport(h,f,g,y),d.scissor(h,f,g,y),a.render(),t+=1;else{i.viewOffset.enabled=!0,_.update(a.values.tColor,u.getColorTarget(n.postprocessing).texture),_.update(a.values.uWeight,x),a.update();let I=Math.pow(2,Math.max(0,n.multiSample.sampleLevel-2));for(let v=0;v<I;++v){let A=p[t];if(ro.setViewOffset(i.viewOffset,g,y,A[0],A[1],g,y),i.update(),t===0||!n.multiSample.reuseOcclusion?u.postprocessing.setOcclusionOffset(0,0):u.postprocessing.setOcclusionOffset(A[0]/g,A[1]/y),u.render(r,n,!1),s.bind(),d.enable(m.BLEND),d.blendEquationSeparate(m.FUNC_ADD,m.FUNC_ADD),d.blendFuncSeparate(m.ONE,m.ONE,m.ONE,m.ONE),d.disable(m.DEPTH_TEST),d.depthMask(!1),d.viewport(h,f,g,y),d.scissor(h,f,g,y),t===0&&(d.clearColor(0,0,0,0),m.clear(m.COLOR_BUFFER_BIT)),a.render(),t+=1,t>=p.length)break}}u.postprocessing.setOcclusionOffset(0,0),this.bindOutputTarget(o),d.viewport(h,f,g,y),d.scissor(h,f,g,y);let S=t*x;return S>0&&(_.update(a.values.uWeight,1),_.update(a.values.tColor,s.texture),a.update(),d.disable(m.BLEND),a.render()),S<1&&(_.update(a.values.uWeight,1-S),_.update(a.values.tColor,l.texture),a.update(),S===0?d.disable(m.BLEND):d.enable(m.BLEND),a.render()),i.viewOffset.enabled=!1,i.update(),je&&c.timer.markEnd("MultiSamplePass.renderTemporalMultiSample"),t>=p.length?-2:t}},KR=[[[0,0]],[[0,0],[-4,-4]],[[0,0],[6,-2],[-6,2],[2,6]],[[0,0],[-1,3],[5,1],[-3,-5],[-5,5],[-7,-1],[3,7],[7,-7]],[[0,0],[-1,-3],[-3,2],[4,-1],[-5,-2],[2,5],[5,3],[3,-5],[-2,6],[0,-7],[-4,-6],[-6,4],[-8,0],[7,-4],[6,7],[-7,-8]],[[0,0],[-7,-5],[-3,-5],[-5,-4],[-1,-4],[-2,-2],[-6,-1],[-4,0],[-7,1],[-1,2],[-6,3],[-3,3],[-7,6],[-3,6],[-5,7],[-1,7],[5,-7],[1,-6],[6,-5],[4,-4],[2,-3],[7,-2],[1,-1],[4,-1],[2,1],[6,2],[0,4],[4,4],[2,5],[7,5],[5,6],[3,7]]];KR.forEach(e=>{e.forEach(t=>{t[0]*=.0625,t[1]*=.0625})});var tT=class{constructor(t){this.multiSamplePass=t;this.sampleIndex=-2}update(t,r){return t&&(this.sampleIndex=-1),r.mode==="temporal"?this.sampleIndex!==-2:!1}render(t,r,n,o){return this.sampleIndex=this.multiSamplePass.render(this.sampleIndex,t,r,n,!!o),this.sampleIndex<0}};var WIe={pickPadding:1,maxAsyncReadLag:5},rT=class{constructor(t,r,n,o){this.webgl=t;this.width=r;this.height=n;this.pickScale=o;let i=o/t.pixelRatio;this.pickWidth=Math.ceil(r*i),this.pickHeight=Math.ceil(n*i);let{resources:a,extensions:{drawBuffers:s},gl:l}=t;s?(this.objectPickTexture=a.texture("image-uint8","rgba","ubyte","nearest"),this.objectPickTexture.define(this.pickWidth,this.pickHeight),this.instancePickTexture=a.texture("image-uint8","rgba","ubyte","nearest"),this.instancePickTexture.define(this.pickWidth,this.pickHeight),this.groupPickTexture=a.texture("image-uint8","rgba","ubyte","nearest"),this.groupPickTexture.define(this.pickWidth,this.pickHeight),this.depthPickTexture=a.texture("image-uint8","rgba","ubyte","nearest"),this.depthPickTexture.define(this.pickWidth,this.pickHeight),this.framebuffer=a.framebuffer(),this.objectPickFramebuffer=a.framebuffer(),this.instancePickFramebuffer=a.framebuffer(),this.groupPickFramebuffer=a.framebuffer(),this.depthPickFramebuffer=a.framebuffer(),this.framebuffer.bind(),s.drawBuffers([s.COLOR_ATTACHMENT0,s.COLOR_ATTACHMENT1,s.COLOR_ATTACHMENT2,s.COLOR_ATTACHMENT3]),this.objectPickTexture.attachFramebuffer(this.framebuffer,"color0"),this.instancePickTexture.attachFramebuffer(this.framebuffer,"color1"),this.groupPickTexture.attachFramebuffer(this.framebuffer,"color2"),this.depthPickTexture.attachFramebuffer(this.framebuffer,"color3"),this.depthRenderbuffer=Ht(l)?a.renderbuffer("depth32f","depth",this.pickWidth,this.pickHeight):a.renderbuffer("depth16","depth",this.pickWidth,this.pickHeight),this.depthRenderbuffer.attachFramebuffer(this.framebuffer),this.objectPickTexture.attachFramebuffer(this.objectPickFramebuffer,"color0"),this.instancePickTexture.attachFramebuffer(this.instancePickFramebuffer,"color0"),this.groupPickTexture.attachFramebuffer(this.groupPickFramebuffer,"color0"),this.depthPickTexture.attachFramebuffer(this.depthPickFramebuffer,"color0")):(this.objectPickTarget=t.createRenderTarget(this.pickWidth,this.pickHeight),this.instancePickTarget=t.createRenderTarget(this.pickWidth,this.pickHeight),this.groupPickTarget=t.createRenderTarget(this.pickWidth,this.pickHeight),this.depthPickTarget=t.createRenderTarget(this.pickWidth,this.pickHeight))}getByteCount(){return this.webgl.extensions.drawBuffers?this.objectPickTexture.getByteCount()+this.instancePickTexture.getByteCount()+this.groupPickTexture.getByteCount()+this.depthPickTexture.getByteCount()+this.depthRenderbuffer.getByteCount():this.objectPickTarget.getByteCount()+this.instancePickTarget.getByteCount()+this.groupPickTarget.getByteCount()+this.depthPickTarget.getByteCount()}dispose(){this.webgl.extensions.drawBuffers?(this.framebuffer.destroy(),this.objectPickTexture.destroy(),this.instancePickTexture.destroy(),this.groupPickTexture.destroy(),this.depthPickTexture.destroy(),this.objectPickFramebuffer.destroy(),this.instancePickFramebuffer.destroy(),this.groupPickFramebuffer.destroy(),this.depthPickFramebuffer.destroy(),this.depthRenderbuffer.destroy()):(this.objectPickTarget.destroy(),this.instancePickTarget.destroy(),this.groupPickTarget.destroy(),this.depthPickTarget.destroy())}get pickRatio(){return this.pickScale/this.webgl.pixelRatio}setPickScale(t){this.pickScale=t,this.setSize(this.width,this.height)}bindObject(){this.webgl.extensions.drawBuffers?this.objectPickFramebuffer.bind():this.objectPickTarget.bind()}bindInstance(){this.webgl.extensions.drawBuffers?this.instancePickFramebuffer.bind():this.instancePickTarget.bind()}bindGroup(){this.webgl.extensions.drawBuffers?this.groupPickFramebuffer.bind():this.groupPickTarget.bind()}bindDepth(){this.webgl.extensions.drawBuffers?this.depthPickFramebuffer.bind():this.depthPickTarget.bind()}get drawingBufferHeight(){return this.height}setSize(t,r){this.width=t,this.height=r;let n=this.pickScale/this.webgl.pixelRatio,o=Math.ceil(this.width*n),i=Math.ceil(this.height*n);(o!==this.pickWidth||i!==this.pickHeight)&&(this.pickWidth=o,this.pickHeight=i,this.webgl.extensions.drawBuffers?(this.objectPickTexture.define(this.pickWidth,this.pickHeight),this.instancePickTexture.define(this.pickWidth,this.pickHeight),this.groupPickTexture.define(this.pickWidth,this.pickHeight),this.depthPickTexture.define(this.pickWidth,this.pickHeight),this.depthRenderbuffer.setSize(this.pickWidth,this.pickHeight)):(this.objectPickTarget.setSize(this.pickWidth,this.pickHeight),this.instancePickTarget.setSize(this.pickWidth,this.pickHeight),this.groupPickTarget.setSize(this.pickWidth,this.pickHeight),this.depthPickTarget.setSize(this.pickWidth,this.pickHeight)))}reset(){let{drawBuffers:t}=this.webgl.extensions;t&&(this.framebuffer.bind(),t.drawBuffers([t.COLOR_ATTACHMENT0,t.COLOR_ATTACHMENT1,t.COLOR_ATTACHMENT2,t.COLOR_ATTACHMENT3]),this.objectPickTexture.attachFramebuffer(this.framebuffer,"color0"),this.instancePickTexture.attachFramebuffer(this.framebuffer,"color1"),this.groupPickTexture.attachFramebuffer(this.framebuffer,"color2"),this.depthPickTexture.attachFramebuffer(this.framebuffer,"color3"),this.depthRenderbuffer.attachFramebuffer(this.framebuffer),this.objectPickTexture.attachFramebuffer(this.objectPickFramebuffer,"color0"),this.instancePickTexture.attachFramebuffer(this.instancePickFramebuffer,"color0"),this.groupPickTexture.attachFramebuffer(this.groupPickFramebuffer,"color0"),this.depthPickTexture.attachFramebuffer(this.depthPickFramebuffer,"color0"))}renderVariant(t,r,n,o,i,a){t.clear(!1),t.update(r,n),t.renderPick(n.primitives,r,i,a),o.handle.isEnabled&&t.renderPick(o.handle.scene,r,i,a),o.camera.isEnabled&&(o.camera.update(r),t.update(o.camera.camera,o.camera.scene),t.renderPick(o.camera.scene,o.camera.camera,i,a))}render(t,r,n,o){this.webgl.extensions.drawBuffers?(this.framebuffer.bind(),this.renderVariant(t,r,n,o,"pick",0)):(this.objectPickTarget.bind(),this.renderVariant(t,r,n,o,"pick",1),this.instancePickTarget.bind(),this.renderVariant(t,r,n,o,"pick",2),this.groupPickTarget.bind(),this.renderVariant(t,r,n,o,"pick",3),this.depthPickTarget.bind(),this.renderVariant(t,r,n,o,"depth",0))}},jIe=!1;function UL(e){return e.isWebGL2?!0:(Yt&&!jIe&&(console.log("WebGL2 required for async picking. Falling back to synchronous picking."),jIe=!0),!1)}var nT=class{constructor(t,r,n=5){this.webgl=t;this.pickPass=r;this.maxAsyncReadLag=n;this.viewport=lo.create(0,0,0,0);this.fenceSync=null;this.fenceTimestamp=0;this.ready=!1;this.lag=0;t.isWebGL2&&(this.objectBuffer=t.resources.pixelPack("rgba","ubyte"),this.instanceBuffer=t.resources.pixelPack("rgba","ubyte"),this.groupBuffer=t.resources.pixelPack("rgba","ubyte"),this.depthBuffer=t.resources.pixelPack("rgba","ubyte")),this.setup()}setup(){let t=this.viewport.width*this.viewport.height*4;(!this.object||this.object.length!==t)&&(this.object=new Uint8Array(t),this.instance=new Uint8Array(t),this.group=new Uint8Array(t),this.depth=new Uint8Array(t))}setViewport(t,r,n,o){lo.set(this.viewport,t,r,n,o),this.setup()}read(){je&&this.webgl.timer.mark("PickBuffers.read");let{x:t,y:r,width:n,height:o}=this.viewport;this.pickPass.bindObject(),this.webgl.readPixels(t,r,n,o,this.object),this.pickPass.bindInstance(),this.webgl.readPixels(t,r,n,o,this.instance),this.pickPass.bindGroup(),this.webgl.readPixels(t,r,n,o,this.group),this.pickPass.bindDepth(),this.webgl.readPixels(t,r,n,o,this.depth),this.ready=!0,je&&this.webgl.timer.markEnd("PickBuffers.read")}asyncRead(){let{gl:t}=this.webgl;if(!Ht(t))return;je&&this.webgl.timer.mark("PickBuffers.asyncRead"),this.fenceSync!==null&&t.deleteSync(this.fenceSync);let{x:r,y:n,width:o,height:i}=this.viewport;this.pickPass.bindObject(),this.objectBuffer.read(r,n,o,i),this.pickPass.bindInstance(),this.instanceBuffer.read(r,n,o,i),this.pickPass.bindGroup(),this.groupBuffer.read(r,n,o,i),this.pickPass.bindDepth(),this.depthBuffer.read(r,n,o,i),this.fenceTimestamp=En(),this.fenceSync=t.fenceSync(t.SYNC_GPU_COMMANDS_COMPLETE,0),t.flush(),this.ready=!1,je&&this.webgl.timer.markEnd("PickBuffers.asyncRead")}check(){if(this.ready)return 1;if(this.fenceSync===null)return 2;let{gl:t}=this.webgl;if(!Ht(t))return 2;let r=t.clientWaitSync(this.fenceSync,0,0);return r===t.WAIT_FAILED||this.lag>=this.maxAsyncReadLag?r!==t.WAIT_FAILED&&En()-this.fenceTimestamp<1e3/60?(this.lag+=1,0):(t.deleteSync(this.fenceSync),this.fenceSync=null,this.lag=0,this.ready=!1,2):r===t.TIMEOUT_EXPIRED?(this.lag+=1,0):(this.objectBuffer.getSubData(this.object),this.instanceBuffer.getSubData(this.instance),this.groupBuffer.getSubData(this.group),this.depthBuffer.getSubData(this.depth),t.deleteSync(this.fenceSync),this.fenceSync=null,this.lag=0,this.ready=!0,1)}getIdx(t,r){return(r*this.viewport.width+t)*4}getDepth(t,r){if(!this.ready)return-1;let n=this.getIdx(t,r),o=this.depth;return hbe(o[n],o[n+1],o[n+2],o[n+3])}getId(t,r,n){if(!this.ready)return-1;let o=this.getIdx(t,r);return xC(n[o],n[o+1],n[o+2])}getObjectId(t,r){return this.getId(t,r,this.object)}getInstanceId(t,r){return this.getId(t,r,this.instance)}getGroupId(t,r){return this.getId(t,r,this.group)}getPickingId(t,r){let n=this.getObjectId(t,r);if(n===-1||n===vi.Null)return;let o=this.getInstanceId(t,r);if(o===-1||o===vi.Null)return;let i=this.getGroupId(t,r);if(i!==-1)return{objectId:n,instanceId:o,groupId:i}}reset(){this.fenceSync=null,this.ready=!1,this.lag=0,this.fenceTimestamp=0}dispose(){let{gl:t}=this.webgl;Ht(t)&&(this.objectBuffer.destroy(),this.instanceBuffer.destroy(),this.groupBuffer.destroy(),this.depthBuffer.destroy(),this.fenceSync!==null&&(t.deleteSync(this.fenceSync),this.fenceSync=null))}};var FX={eyeSeparation:C.Numeric(.062,{min:.02,max:.1,step:.001},{description:"Distance between left and right camera."}),focus:C.Numeric(10,{min:1,max:20,step:.1},{description:"Apparent object distance."})},lat=C.getDefaultValues(FX);var sh=class{constructor(t,r={}){this.parent=t;this.left=new NL;this.right=new NL;this.props={...lat,...r}}get viewport(){return this.parent.viewport}get viewOffset(){return this.parent.viewOffset}setProps(t){Object.assign(this.props,t)}update(t){this.parent.update(),t?cat(this.parent,this.left,this.right,t):uat(this.parent,this.props,this.left,this.right)}};(t=>{function e(r){return"left"in r&&"right"in r}t.is=e})(sh||={});var NL=class{constructor(){this.viewport=lo.create(0,0,0,0);this.view=H();this.projection=H();this.projectionView=H();this.inverseProjectionView=H();this.headRotation=H();this.viewEye=H();this.isAsymmetricProjection=!0;this.state=ro.createDefaultSnapshot();this.viewOffset=ro.ViewOffset();this.far=0;this.near=0;this.fogFar=0;this.fogNear=0;this.forceFull=!1;this.scale=0;this.minTargetDistance=0;this.disabled=!1}getRay(t,r,n){return H.getTranslation(t.origin,H.invert(H(),this.view)),b.set(t.direction,r,n,.5),Vg(t.direction,t.direction,this.viewport,this.inverseProjectionView),b.normalize(t.direction,b.sub(t.direction,t.direction,t.origin)),t}},XIe=H.identity(),QIe=H.identity();function kX(e,t){lo.copy(t.viewport,e.viewport),H.copy(t.view,e.view),H.copy(t.projection,e.projection),H.copy(t.headRotation,e.headRotation),ro.copySnapshot(t.state,e.state),ro.copyViewOffset(t.viewOffset,e.viewOffset),t.far=e.far,t.near=e.near,t.fogFar=e.fogFar,t.fogNear=e.fogNear,t.forceFull=e.forceFull,t.scale=e.scale,t.minTargetDistance=e.minTargetDistance}function uat(e,t,r,n){kX(e,r),kX(e,n);let o=Math.floor(e.viewport.width/2),i=o/e.viewport.height;r.viewport.width=o,n.viewport.x+=o,n.viewport.width-=o;let a=t.eyeSeparation/2,s=a*e.near/t.focus,l=e.near*Math.tan(e.state.fov*.5),u,c;XIe[12]=-a,QIe[12]=a,u=-l*i+s,c=l*i+s,r.projection[0]=2*e.near/(c-u),r.projection[8]=(c+u)/(c-u),H.mul(r.view,r.view,XIe),H.mul(r.projectionView,r.projection,r.view),H.invert(r.inverseProjectionView,r.projectionView),u=-l*i-s,c=l*i-s,n.projection[0]=2*e.near/(c-u),n.projection[8]=(c+u)/(c-u),H.mul(n.view,n.view,QIe),H.mul(n.projectionView,n.projection,n.view),H.invert(n.inverseProjectionView,n.projectionView),r.disabled=!1,n.disabled=!1}function cat(e,t,r,n){ZIe(e,t,n.pose.views[0],n.layer),n.pose.views.length===1?r.disabled=!0:ZIe(e,r,n.pose.views[1],n.layer)}function ZIe(e,t,r,n){kX(e,t);let o=n.getViewport(r);lo.set(t.viewport,o.x,o.y,o.width,o.height),H.fromArray(t.projection,r.projectionMatrix,0),H.fromArray(t.view,r.transform.inverse.matrix,0),H.mul(t.projectionView,t.projection,t.view),H.invert(t.inverseProjectionView,t.projectionView),t.disabled=!1}var zL=class{constructor(t,r,n,o,i,a,s){this.webgl=t;this.renderer=r;this.scene=n;this.helper=o;this.pickPass=i;this.dirty=!0;this.buffers=new nT(this.webgl,this.pickPass);this.viewport=lo();this.setViewport(a.x,a.y,a.width,a.height),this.pickPadding=s.pickPadding,UL(t)||(this.asyncIdentify=(l,u,c)=>({tryGet:()=>this.identify(l,u,c)}))}setViewport(t,r,n,o){lo.set(this.viewport,t,r,n,o),this.update()}setPickPadding(t){this.pickPadding!==t&&(this.pickPadding=t,this.update())}update(){let{x:t,y:r,width:n,height:o}=this.viewport;this.pickRatio=this.pickPass.pickRatio,this.pickX=Math.ceil(t*this.pickRatio),this.pickY=Math.ceil(r*this.pickRatio);let i=Math.floor(n*this.pickRatio),a=Math.floor(o*this.pickRatio);(i!==this.pickWidth||a!==this.pickHeight)&&(this.pickWidth=i,this.pickHeight=a,this.halfPickWidth=Math.floor(this.pickWidth/2),this.buffers.setViewport(this.pickX,this.pickY,this.pickWidth,this.pickHeight)),this.spiral=sM(Math.ceil(this.pickRatio*this.pickPadding)),this.dirty=!0}render(t){je&&this.webgl.timer.mark("PickHelper.render",{captureStats:!0});let{pickX:r,pickY:n,pickWidth:o,pickHeight:i,halfPickWidth:a}=this,{renderer:s,scene:l,helper:u}=this;s.setTransparentBackground(!1),s.setDrawingBufferSize(o,i),s.setPixelRatio(this.pickRatio),sh.is(t)?(s.setViewport(r,n,a,i),this.pickPass.render(s,t.left,l,u),s.setViewport(r+a,n,o-a,i),this.pickPass.render(s,t.right,l,u)):(s.setViewport(r,n,o,i),this.pickPass.render(s,t,l,u)),this.dirty=!1,je&&this.webgl.timer.markEnd("PickHelper.render")}identifyInternal(t,r,n){if(this.webgl.isContextLost)return;let{webgl:o,pickRatio:i}=this;if(o.isContextLost)return;t*=o.pixelRatio,r*=o.pixelRatio,r=this.pickPass.drawingBufferHeight-r;let{viewport:a}=this;if(t<a.x||r<a.y||t>a.x+a.width||r>a.y+a.height)return;let s=t-a.x,l=r-a.y,u=Math.floor(s*i),c=Math.floor(l*i),m=this.buffers.getPickingId(u,c);if(m===void 0)return;let d=this.buffers.getDepth(u,c),p=b.create(t,r,d);if(sh.is(n)){let h=Math.floor(a.width/2);t>a.x+h?(p[0]=a.x+(s-h)*2,Vg(p,p,a,n.right.inverseProjectionView)):(p[0]=a.x+s*2,Vg(p,p,a,n.left.inverseProjectionView))}else Vg(p,p,a,n.inverseProjectionView);return{id:m,position:p}}prepare(){this.pickRatio!==this.pickPass.pickRatio&&this.update()}getPickData(t,r,n){for(let o of this.spiral){let i=this.identifyInternal(t+o[0],r+o[1],n);if(i)return i}}identify(t,r,n){return this.prepare(),this.dirty&&(je&&this.webgl.timer.mark("PickHelper.identify"),this.webgl.resources.finalizePrograms(["pick"],!0),this.render(n),this.buffers.read(),je&&this.webgl.timer.markEnd("PickHelper.identify")),this.getPickData(t,r,n)}asyncIdentify(t,r,n){return this.prepare(),this.dirty&&(je&&this.webgl.timer.mark("PickHelper.asyncIdentify"),this.render(n),this.buffers.asyncRead(),je&&this.webgl.timer.markEnd("PickHelper.asyncIdentify")),{tryGet:()=>{let o=this.buffers.check();if(o===1)return this.getPickData(t,r,n);if(o===0)return"pending";o===2&&(this.dirty=!0)}}}reset(){this.buffers.reset(),this.dirty=!0}dispose(){this.buffers.dispose()}};var qIe=`
precision highp float;

uniform sampler2D tWboitA;
uniform sampler2D tWboitB;
uniform vec2 uTexSize;

void main() {
    vec2 coords = gl_FragCoord.xy / uTexSize;

    vec4 accum = texture2D(tWboitA, coords);
    float r = 1.0 - accum.a;

    accum.a = texture2D(tWboitB, coords).r;
    // divisor needs to allow very small values for nice fading
    gl_FragColor = vec4(accum.rgb / clamp(accum.a, 0.00000001, 50000.0), r);
}
`;var dat={...Sn,tWboitA:yt("texture","rgba","float","nearest"),tWboitB:yt("texture","rgba","float","nearest"),uTexSize:de("v2")},pat=zr("evaluate-wboit",Fn,qIe);function fat(e,t,r){let n={...vn,tWboitA:_.create(t),tWboitB:_.create(r),uTexSize:_.create(Ce.create(t.getWidth(),t.getHeight()))},o={...dat},i=on(e,"triangles",pat,o,n);return an(i,n)}var HL=class e{constructor(t,r,n){this.webgl=t;this._supported=!1;if(!e.isSupported(t))return;let{resources:o,gl:i}=t;this.textureA=o.texture("image-float32","rgba","float","nearest"),this.textureA.define(r,n),this.textureB=o.texture("image-float32","rgba","float","nearest"),this.textureB.define(r,n),this.depthRenderbuffer=Ht(i)?o.renderbuffer("depth32f","depth",r,n):o.renderbuffer("depth16","depth",r,n),this.renderable=fat(t,this.textureA,this.textureB),this.framebuffer=o.framebuffer(),this._supported=!0,this._init()}get supported(){return this._supported}getByteCount(){return this._supported?this.textureA.getByteCount()+this.textureB.getByteCount()+this.depthRenderbuffer.getByteCount():0}bind(){let{state:t,gl:r}=this.webgl;this.framebuffer.bind(),t.clearColor(0,0,0,1),r.clear(r.COLOR_BUFFER_BIT),t.disable(r.DEPTH_TEST),t.blendFuncSeparate(r.ONE,r.ONE,r.ZERO,r.ONE_MINUS_SRC_ALPHA),t.enable(r.BLEND)}render(){je&&this.webgl.timer.mark("WboitPass.render");let{state:t,gl:r}=this.webgl;t.blendFuncSeparate(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA),t.enable(r.BLEND),this.renderable.update(),this.renderable.render(),je&&this.webgl.timer.markEnd("WboitPass.render")}setSize(t,r){let[n,o]=this.renderable.values.uTexSize.ref.value;(t!==n||r!==o)&&(this.textureA.define(t,r),this.textureB.define(t,r),this.depthRenderbuffer.setSize(t,r),_.update(this.renderable.values.uTexSize,Ce.set(this.renderable.values.uTexSize.ref.value,t,r)))}reset(){this._supported&&this._init()}_init(){let{extensions:{drawBuffers:t}}=this.webgl;this.framebuffer.bind(),t.drawBuffers([t.COLOR_ATTACHMENT0,t.COLOR_ATTACHMENT1]),this.textureA.attachFramebuffer(this.framebuffer,"color0"),this.textureB.attachFramebuffer(this.framebuffer,"color1"),this.depthRenderbuffer.attachFramebuffer(this.framebuffer)}static isSupported(t){let{extensions:{drawBuffers:r,textureFloat:n,colorBufferFloat:o,depthTexture:i}}=t;if(!n||!o||!i||!r){if(Yt){let a=[];n||a.push("textureFloat"),o||a.push("colorBufferFloat"),i||a.push("depthTexture"),r||a.push("drawBuffers"),console.log(`Missing "${a.join('", "')}" extensions required for "wboit"`)}return!1}else return!0}};var YIe=`
precision highp float;

uniform sampler2D tDpoitFrontColor;
uniform vec2 uTexSize;

void main() {
    vec2 coords = gl_FragCoord.xy / uTexSize;
    gl_FragColor = texture2D(tDpoitFrontColor, coords);
}
`;var KIe=`
    precision highp float;

    uniform sampler2D tDpoitBackColor;
    uniform vec2 uTexSize;

    void main() {
        vec2 coords = gl_FragCoord.xy / uTexSize;
        gl_FragColor = texture2D(tDpoitBackColor, coords);
        if (gl_FragColor.a == 0.0) {
            discard;
        }
    }
`;var hat={...Sn,tDpoitBackColor:yt("texture","rgba","float","nearest"),uTexSize:de("v2")},gat=zr("blend-back-dpoit",Fn,KIe);function yat(e,t){let r={...vn,tDpoitBackColor:_.create(t),uTexSize:_.create(Ce.create(t.getWidth(),t.getHeight()))},n={...hat},o=on(e,"triangles",gat,n,r);return an(o,r)}var bat={...Sn,tDpoitFrontColor:yt("texture","rgba","float","nearest"),uTexSize:de("v2")},xat=zr("evaluate-dpoit",Fn,YIe);function Cat(e,t){let r={...vn,tDpoitFrontColor:_.create(t),uTexSize:_.create(Ce.create(t.getWidth(),t.getHeight()))},n={...bat},o=on(e,"triangles",xat,n,r);return an(o,r)}var jL=class e{constructor(t,r,n){this.webgl=t;this.DEPTH_CLEAR_VALUE=-99999;this.MAX_DEPTH=1;this.MIN_DEPTH=0;this.passCount=0;this._supported=!1;if(!e.isSupported(t))return;let{resources:o,extensions:{colorBufferHalfFloat:i,textureHalfFloat:a}}=t;Ht(t.gl)?(this.depthTextures=[o.texture("image-float32","rg","float","nearest"),o.texture("image-float32","rg","float","nearest")],this.colorFrontTextures=i&&a?[o.texture("image-float16","rgba","fp16","nearest"),o.texture("image-float16","rgba","fp16","nearest")]:[o.texture("image-float32","rgba","float","nearest"),o.texture("image-float32","rgba","float","nearest")],this.colorBackTextures=i&&a?[o.texture("image-float16","rgba","fp16","nearest"),o.texture("image-float16","rgba","fp16","nearest")]:[o.texture("image-float32","rgba","float","nearest"),o.texture("image-float32","rgba","float","nearest")]):(this.depthTextures=[o.texture("image-float32","rgba","float","nearest"),o.texture("image-float32","rgba","float","nearest")],this.colorFrontTextures=[o.texture("image-float32","rgba","float","nearest"),o.texture("image-float32","rgba","float","nearest")],this.colorBackTextures=[o.texture("image-float32","rgba","float","nearest"),o.texture("image-float32","rgba","float","nearest")]),this.depthTextures[0].define(r,n),this.depthTextures[1].define(r,n),this.colorFrontTextures[0].define(r,n),this.colorFrontTextures[1].define(r,n),this.colorBackTextures[0].define(r,n),this.colorBackTextures[1].define(r,n),this.depthFramebuffers=[o.framebuffer(),o.framebuffer()],this.colorFramebuffers=[o.framebuffer(),o.framebuffer()],this.blendBackRenderable=yat(t,this.colorBackTextures[0]),this.renderable=Cat(t,this.colorFrontTextures[0]),this._supported=!0,this._init()}get supported(){return this._supported}getByteCount(){return this._supported?this.depthTextures[0].getByteCount()+this.depthTextures[1].getByteCount()+this.colorFrontTextures[0].getByteCount()+this.colorFrontTextures[1].getByteCount()+this.colorBackTextures[0].getByteCount()+this.colorBackTextures[1].getByteCount():0}bind(){let{state:t,gl:r,extensions:{blendMinMax:n}}=this.webgl;return this.passCount=0,this.depthFramebuffers[0].bind(),t.clearColor(this.DEPTH_CLEAR_VALUE,this.DEPTH_CLEAR_VALUE,0,0),r.clear(r.COLOR_BUFFER_BIT),this.depthFramebuffers[1].bind(),t.clearColor(-this.MIN_DEPTH,this.MAX_DEPTH,0,0),r.clear(r.COLOR_BUFFER_BIT),this.colorFramebuffers[0].bind(),t.clearColor(0,0,0,0),r.clear(r.COLOR_BUFFER_BIT),this.colorFramebuffers[1].bind(),t.clearColor(0,0,0,0),r.clear(r.COLOR_BUFFER_BIT),this.depthFramebuffers[0].bind(),t.blendEquation(n.MAX),t.depthMask(!1),{depth:this.depthTextures[1],frontColor:this.colorFrontTextures[1],backColor:this.colorBackTextures[1]}}bindDualDepthPeeling(){let{state:t,gl:r,extensions:{blendMinMax:n}}=this.webgl;return this.readId=this.passCount%2,this.writeId=1-this.readId,this.passCount+=1,this.depthFramebuffers[this.writeId].bind(),t.clearColor(this.DEPTH_CLEAR_VALUE,this.DEPTH_CLEAR_VALUE,0,0),r.clear(r.COLOR_BUFFER_BIT),this.colorFramebuffers[this.writeId].bind(),t.clearColor(0,0,0,0),r.clear(r.COLOR_BUFFER_BIT),this.depthFramebuffers[this.writeId].bind(),t.blendEquation(n.MAX),t.depthMask(!1),{depth:this.depthTextures[this.readId],frontColor:this.colorFrontTextures[this.readId],backColor:this.colorBackTextures[this.readId]}}renderBlendBack(){je&&this.webgl.timer.mark("DpoitPass.renderBlendBack");let{state:t,gl:r}=this.webgl;t.blendEquation(r.FUNC_ADD),t.blendFuncSeparate(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA),_.update(this.blendBackRenderable.values.tDpoitBackColor,this.colorBackTextures[this.writeId]),this.blendBackRenderable.update(),this.blendBackRenderable.render(),je&&this.webgl.timer.markEnd("DpoitPass.renderBlendBack")}render(){je&&this.webgl.timer.mark("DpoitPass.render");let{state:t,gl:r}=this.webgl;t.blendEquation(r.FUNC_ADD),t.blendFunc(r.ONE,r.ONE_MINUS_SRC_ALPHA),_.update(this.renderable.values.tDpoitFrontColor,this.colorFrontTextures[this.writeId]),this.renderable.update(),this.renderable.render(),je&&this.webgl.timer.markEnd("DpoitPass.render")}setSize(t,r){let[n,o]=this.renderable.values.uTexSize.ref.value;if(t!==n||r!==o){for(let i=0;i<2;i++)this.depthTextures[i].define(t,r),this.colorFrontTextures[i].define(t,r),this.colorBackTextures[i].define(t,r);_.update(this.renderable.values.uTexSize,Ce.set(this.renderable.values.uTexSize.ref.value,t,r)),_.update(this.blendBackRenderable.values.uTexSize,Ce.set(this.blendBackRenderable.values.uTexSize.ref.value,t,r))}}reset(){this._supported&&this._init()}_init(){let{extensions:{drawBuffers:t}}=this.webgl;for(let r=0;r<2;r++)this.depthFramebuffers[r].bind(),t.drawBuffers([t.COLOR_ATTACHMENT0,t.COLOR_ATTACHMENT1,t.COLOR_ATTACHMENT2]),this.colorFrontTextures[r].attachFramebuffer(this.depthFramebuffers[r],"color0"),this.colorBackTextures[r].attachFramebuffer(this.depthFramebuffers[r],"color1"),this.depthTextures[r].attachFramebuffer(this.depthFramebuffers[r],"color2"),this.colorFramebuffers[r].bind(),t.drawBuffers([t.COLOR_ATTACHMENT0,t.COLOR_ATTACHMENT1]),this.colorFrontTextures[r].attachFramebuffer(this.colorFramebuffers[r],"color0"),this.colorBackTextures[r].attachFramebuffer(this.colorFramebuffers[r],"color1")}static isSupported(t){let{extensions:{drawBuffers:r,textureFloat:n,colorBufferFloat:o,depthTexture:i,blendMinMax:a}}=t;if(!n||!o||!i||!r||!a){if(Yt){let s=[];n||s.push("textureFloat"),o||s.push("colorBufferFloat"),i||s.push("depthTexture"),r||s.push("drawBuffers"),a||s.push("blendMinMax"),console.log(`Missing "${s.join('", "')}" extensions required for "dpoit"`)}return!1}else return!0}};var JIe=`
precision highp float;
precision highp sampler2D;

uniform vec2 uTexSizeInv;
uniform sampler2D tEdgeTexture;
uniform vec3 uHighlightEdgeColor;
uniform vec3 uSelectEdgeColor;
uniform float uHighlightEdgeStrength;
uniform float uSelectEdgeStrength;
uniform float uGhostEdgeStrength;
uniform float uInnerEdgeFactor;

void main() {
    vec2 coords = gl_FragCoord.xy * uTexSizeInv;
    vec4 edgeValue = texture2D(tEdgeTexture, coords);
    if (edgeValue.a > 0.0) {
        vec3 edgeColor = edgeValue.b == 1.0 ? uHighlightEdgeColor : uSelectEdgeColor;
        gl_FragColor.rgb = edgeValue.g > 0.0 ? edgeColor : edgeColor * uInnerEdgeFactor;
        gl_FragColor.a = (edgeValue.r == 1.0 ? uGhostEdgeStrength : 1.0) * edgeValue.a;
        float edgeStrength = edgeValue.b == 1.0 ? uHighlightEdgeStrength : uSelectEdgeStrength;
        gl_FragColor.a *= edgeStrength;
    } else {
        gl_FragColor = vec4(0.0);
    }
}
`;var $Ie=`
precision highp float;
precision highp sampler2D;

uniform sampler2D tMaskTexture;
uniform vec2 uTexSizeInv;

void main() {
    vec2 coords = gl_FragCoord.xy * uTexSizeInv;
    vec4 offset = vec4(float(dEdgeScale), 0.0, 0.0, float(dEdgeScale)) * vec4(uTexSizeInv, uTexSizeInv);
    vec4 c0 = texture2D(tMaskTexture, coords);
    vec4 c1 = texture2D(tMaskTexture, coords + offset.xy);
    vec4 c2 = texture2D(tMaskTexture, coords - offset.xy);
    vec4 c3 = texture2D(tMaskTexture, coords + offset.yw);
    vec4 c4 = texture2D(tMaskTexture, coords - offset.yw);
    float diff1 = (c1.r - c2.r) * 0.5;
    float diff2 = (c3.r - c4.r) * 0.5;
    float d = length(vec2(diff1, diff2));
    if (d <= 0.0)
        discard;
    float a1 = min(c1.g, c2.g);
    float a2 = min(c3.g, c4.g);
    float visibility = min(a1, a2) > 0.001 ? 1.0 : 0.0;
    float mask = c0.r;
    float marker = min(c1.b, min(c2.b, min(c3.b, c4.b)));
    float fogAlpha = min(c1.a, min(c2.a, min(c3.a, c4.a)));
    gl_FragColor = vec4(visibility, mask, marker, fogAlpha);
}
`;var WL={enabled:C.Boolean(!0),highlightEdgeColor:C.Color(Le.darken(Le.fromNormalizedRgb(1,.4,.6),1)),selectEdgeColor:C.Color(Le.darken(Le.fromNormalizedRgb(.2,1,.1),1)),edgeScale:C.Numeric(1,{min:1,max:3,step:1},{description:"Thickness of the edge."}),highlightEdgeStrength:C.Numeric(1,{min:0,max:1,step:.1}),selectEdgeStrength:C.Numeric(1,{min:0,max:1,step:.1}),ghostEdgeStrength:C.Numeric(.3,{min:0,max:1,step:.1},{description:"Opacity of the hidden edges that are covered by other geometry. When set to 1, one less geometry render pass is done."}),innerEdgeFactor:C.Numeric(1.5,{min:0,max:3,step:.1},{description:"Factor to multiply the inner edge color with - for added contrast."})},Ug=class{constructor(t,r,n){this.webgl=t;this.depthTarget=t.createRenderTarget(r,n),this.maskTarget=t.createRenderTarget(r,n),this.edgesTarget=t.createRenderTarget(r,n),this.edge=Iat(t,this.maskTarget.texture),this.overlay=Pat(t,this.edgesTarget.texture)}static isEnabled(t){return t.enabled}getByteCount(){return this.depthTarget.getByteCount()+this.maskTarget.getByteCount()+this.edgesTarget.getByteCount()}setEdgeState(t){let{gl:r,state:n}=this.webgl;n.enable(r.SCISSOR_TEST),n.enable(r.BLEND),n.blendFunc(r.ONE,r.ONE),n.blendEquation(r.FUNC_ADD),n.disable(r.DEPTH_TEST),n.depthMask(!1);let{x:o,y:i,width:a,height:s}=t;n.viewport(o,i,a,s),n.scissor(o,i,a,s),n.clearColor(0,0,0,0),r.clear(r.COLOR_BUFFER_BIT)}setOverlayState(t){let{gl:r,state:n}=this.webgl;n.enable(r.SCISSOR_TEST),n.enable(r.BLEND),n.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA),n.blendEquation(r.FUNC_ADD),n.disable(r.DEPTH_TEST),n.depthMask(!1);let{x:o,y:i,width:a,height:s}=t;n.viewport(o,i,a,s),n.scissor(o,i,a,s)}setSize(t,r){let n=this.depthTarget.getWidth(),o=this.depthTarget.getHeight();(t!==n||r!==o)&&(this.depthTarget.setSize(t,r),this.maskTarget.setSize(t,r),this.edgesTarget.setSize(t,r),_.update(this.edge.values.uTexSizeInv,Ce.set(this.edge.values.uTexSizeInv.ref.value,1/t,1/r)),_.update(this.overlay.values.uTexSizeInv,Ce.set(this.overlay.values.uTexSizeInv.ref.value,1/t,1/r)))}update(t){let{highlightEdgeColor:r,selectEdgeColor:n,edgeScale:o,innerEdgeFactor:i,ghostEdgeStrength:a,highlightEdgeStrength:s,selectEdgeStrength:l}=t,{values:u}=this.edge,c=Math.max(1,Math.round(o*this.webgl.pixelRatio));u.dEdgeScale.ref.value!==c&&(_.update(u.dEdgeScale,c),this.edge.update());let{values:m}=this.overlay;_.update(m.uHighlightEdgeColor,Le.toVec3Normalized(m.uHighlightEdgeColor.ref.value,r)),_.update(m.uSelectEdgeColor,Le.toVec3Normalized(m.uSelectEdgeColor.ref.value,n)),_.updateIfChanged(m.uInnerEdgeFactor,i),_.updateIfChanged(m.uGhostEdgeStrength,a),_.updateIfChanged(m.uHighlightEdgeStrength,s),_.updateIfChanged(m.uSelectEdgeStrength,l)}render(t,r){je&&this.webgl.timer.mark("MarkingPass.render"),this.edgesTarget.bind(),this.setEdgeState(t),this.edge.render(),r.bind(),this.setOverlayState(t),this.overlay.render(),je&&this.webgl.timer.markEnd("MarkingPass.render")}},Sat={...Sn,tMaskTexture:yt("texture","rgba","ubyte","linear"),uTexSizeInv:de("v2"),dEdgeScale:dt("number")},vat=zr("edge",Fn,$Ie);function Iat(e,t){let r=t.getWidth(),n=t.getHeight(),o={...vn,tMaskTexture:_.create(t),uTexSizeInv:_.create(Ce.create(1/r,1/n)),dEdgeScale:_.create(1)},i={...Sat},a=on(e,"triangles",vat,i,o);return an(a,o)}var Aat={...Sn,tEdgeTexture:yt("texture","rgba","ubyte","linear"),uTexSizeInv:de("v2"),uHighlightEdgeColor:de("v3"),uSelectEdgeColor:de("v3"),uHighlightEdgeStrength:de("f"),uSelectEdgeStrength:de("f"),uGhostEdgeStrength:de("f"),uInnerEdgeFactor:de("f")},Tat=zr("overlay",Fn,JIe);function Pat(e,t){let r=t.getWidth(),n=t.getHeight(),o={...vn,tEdgeTexture:_.create(t),uTexSizeInv:_.create(Ce.create(1/r,1/n)),uHighlightEdgeColor:_.create(b()),uSelectEdgeColor:_.create(b()),uHighlightEdgeStrength:_.create(1),uSelectEdgeStrength:_.create(1),uGhostEdgeStrength:_.create(0),uInnerEdgeFactor:_.create(0)},i={...Aat},a=on(e,"triangles",Tat,i,o);return an(a,o)}var oT=class{constructor(t,r,n,o,i){this.webgl=t;this.transparencyMode="blended";let{extensions:a,resources:s,isWebGL2:l}=t;this.drawTarget=t.createDrawTarget(),this.colorTarget=t.createRenderTarget(n,o,!0,"uint8","linear"),this.transparentColorTarget=t.createRenderTarget(n,o,!1,"uint8","linear"),this.packedDepth=!a.depthTexture,this.depthTargetTransparent=t.createRenderTarget(n,o),this.depthTextureTransparent=this.depthTargetTransparent.texture,this.depthTargetOpaque=this.packedDepth?t.createRenderTarget(n,o):null,this.depthTextureOpaque=this.depthTargetOpaque?this.depthTargetOpaque.texture:s.texture("image-depth","depth",l?"float":"ushort","nearest"),this.packedDepth||this.depthTextureOpaque.define(n,o),this.wboit=new HL(t,n,o),this.dpoit=new jL(t,n,o),this.marking=new Ug(t,n,o),this.postprocessing=new ms(t,r,this),this.antialiasing=new Gg(t,n,o),this.bloom=new Ab(t,n,o),this.dof=new Hp(t,n,o),this.copyFboTarget=Gm(t,this.colorTarget.texture),this.copyFboPostprocessing=Gm(t,this.postprocessing.target.texture),this.setTransparency(i)}setTransparency(t){t==="wboit"?(this.transparencyMode=this.wboit.supported?"wboit":"blended",Yt&&!this.wboit.supported&&console.log('Missing "wboit" support, falling back to "blended".')):t==="dpoit"?(this.transparencyMode=this.dpoit.supported?"dpoit":"blended",Yt&&!this.dpoit.supported&&console.log('Missing "dpoit" support, falling back to "blended".')):this.transparencyMode="blended",this.depthTextureOpaque.detachFramebuffer(this.postprocessing.target.framebuffer,"depth")}get transparency(){return this.transparencyMode}getByteCount(){return this.drawTarget.getByteCount()+this.colorTarget.getByteCount()+this.transparentColorTarget.getByteCount()+this.depthTargetTransparent.getByteCount()+(this.depthTargetOpaque?this.depthTargetOpaque.getByteCount():this.depthTextureOpaque.getByteCount())+this.wboit.getByteCount()+this.dpoit.getByteCount()+this.marking.getByteCount()+this.postprocessing.getByteCount()+this.antialiasing.getByteCount()+this.bloom.getByteCount()+this.dof.getByteCount()}reset(){this.wboit.reset(),this.dpoit.reset(),this.postprocessing.reset()}setSize(t,r){let n=this.colorTarget.getWidth(),o=this.colorTarget.getHeight();(t!==n||r!==o)&&(this.colorTarget.setSize(t,r),this.depthTargetTransparent.setSize(t,r),this.transparentColorTarget.setSize(t,r),this.depthTargetOpaque?this.depthTargetOpaque.setSize(t,r):this.depthTextureOpaque.define(t,r),_.update(this.copyFboTarget.values.uTexSize,Ce.set(this.copyFboTarget.values.uTexSize.ref.value,t,r)),_.update(this.copyFboPostprocessing.values.uTexSize,Ce.set(this.copyFboPostprocessing.values.uTexSize.ref.value,t,r))),this.wboit.supported&&this.wboit.setSize(t,r),this.dpoit.supported&&this.dpoit.setSize(t,r),this.marking.setSize(t,r),this.postprocessing.setSize(t,r),this.antialiasing.setSize(t,r),this.dof.setSize(t,r),this.bloom.setSize(t,r)}_renderDpoit(t,r,n,o,i,a){if(!this.dpoit.supported)throw new Error("expected dpoit to be supported");this.depthTextureOpaque.attachFramebuffer(this.colorTarget.framebuffer,"depth"),t.clear(!0),n.hasOpaque&&t.renderOpaque(n.primitives,r),this.depthTextureOpaque.detachFramebuffer(this.colorTarget.framebuffer,"depth"),ms.isTransparentDepthRequired(n,a)&&(this.depthTargetTransparent.bind(),t.clearDepth(!0),n.opacityAverage<1&&t.renderDepthTransparent(n.primitives,r,this.depthTextureOpaque));let s=ms.isEnabled(a);if(n.opacityAverage<1){let l=s?this.transparentColorTarget:this.colorTarget;s&&(l.bind(),t.clear(!1,!1,!0));let u=this.dpoit.bind();t.renderDpoitTransparent(n.primitives,r,this.depthTextureOpaque,u);for(let c=0;c<o;c++){je&&this.webgl.timer.mark("DpoitPass.layer");let m=this.dpoit.bindDualDepthPeeling();t.renderDpoitTransparent(n.primitives,r,this.depthTextureOpaque,m),o>1&&(l.bind(),this.dpoit.renderBlendBack()),je&&this.webgl.timer.markEnd("DpoitPass.layer")}l.bind(),this.dpoit.render()}ms.isEnabled(a)&&this.postprocessing.render(r,n,!1,i,t.props.backgroundColor,a,t.light,t.ambientColor),n.volumes.renderables.length>0&&t.renderVolume(n.volumes,r,this.depthTextureOpaque)}_renderWboit(t,r,n,o,i){if(!this.wboit.supported)throw new Error("expected wboit to be supported");this.depthTextureOpaque.attachFramebuffer(this.colorTarget.framebuffer,"depth"),t.clear(!0),n.hasOpaque&&t.renderOpaque(n.primitives,r),ms.isTransparentDepthRequired(n,i)&&(this.depthTargetTransparent.bind(),t.clearDepth(!0),n.opacityAverage<1&&t.renderDepthTransparent(n.primitives,r,this.depthTextureOpaque));let a=ms.isEnabled(i);if(n.opacityAverage<1){let s=a?this.transparentColorTarget:this.colorTarget;a&&(s.bind(),t.clear(!1,!1,!0)),this.wboit.bind(),t.renderWboitTransparent(n.primitives,r,this.depthTextureOpaque),s.bind(),this.wboit.render()}ms.isEnabled(i)&&this.postprocessing.render(r,n,!1,o,t.props.backgroundColor,i,t.light,t.ambientColor),n.volumes.renderables.length>0&&(this.wboit.bind(),t.renderWboitTransparent(n.volumes,r,this.depthTextureOpaque),(a?this.postprocessing.target:this.colorTarget).bind(),this.wboit.render())}_renderBlended(t,r,n,o,i,a){if(o?this.drawTarget.bind():this.packedDepth?this.colorTarget.bind():this.depthTextureOpaque.attachFramebuffer(this.colorTarget.framebuffer,"depth"),t.clear(!0),n.hasOpaque&&t.renderOpaque(n.primitives,r),o)n.opacityAverage<1&&t.renderBlendedTransparent(n.primitives,r);else{this.depthTargetOpaque&&(this.depthTargetOpaque.bind(),t.clearDepth(!0),t.renderDepthOpaque(n.primitives,r),this.colorTarget.bind()),ms.isTransparentDepthRequired(n,a)&&(this.depthTargetTransparent.bind(),t.clearDepth(!0),n.opacityAverage<1&&t.renderDepthTransparent(n.primitives,r,this.depthTextureOpaque));let s=ms.isEnabled(a);if(n.opacityAverage<1&&(s&&(this.transparentColorTarget.bind(),t.clear(!1,!1,!0),this.packedDepth?this.colorTarget.depthRenderbuffer?.attachFramebuffer(this.transparentColorTarget.framebuffer):this.depthTextureOpaque.attachFramebuffer(this.transparentColorTarget.framebuffer,"depth")),t.renderBlendedTransparent(n.primitives,r),s&&(this.packedDepth?this.colorTarget.depthRenderbuffer?.detachFramebuffer(this.transparentColorTarget.framebuffer):this.depthTextureOpaque.detachFramebuffer(this.transparentColorTarget.framebuffer,"depth"))),s&&(this.packedDepth?this.colorTarget.depthRenderbuffer?.detachFramebuffer(this.postprocessing.target.framebuffer):this.depthTextureOpaque.detachFramebuffer(this.postprocessing.target.framebuffer,"depth"),this.postprocessing.render(r,n,!1,i,t.props.backgroundColor,a,t.light,t.ambientColor),this.packedDepth?this.colorTarget.depthRenderbuffer?.attachFramebuffer(this.postprocessing.target.framebuffer):this.depthTextureOpaque.attachFramebuffer(this.postprocessing.target.framebuffer,"depth")),n.volumes.renderables.length>0){let l=ms.isEnabled(a)?this.postprocessing.target:this.colorTarget;this.packedDepth?this.colorTarget.depthRenderbuffer?.detachFramebuffer(l.framebuffer):this.depthTextureOpaque.detachFramebuffer(l.framebuffer,"depth"),l.bind(),t.renderVolume(n.volumes,r,this.depthTextureOpaque),this.packedDepth?this.colorTarget.depthRenderbuffer?.attachFramebuffer(l.framebuffer):this.depthTextureOpaque.attachFramebuffer(l.framebuffer,"depth"),l.bind()}}}_render(t,r,n,o,i,a,s){if(r.disabled)return;let l=n.volumes.renderables.length>0,u=ms.isEnabled(s.postprocessing),c=Gg.isEnabled(s.postprocessing),m=Ug.isEnabled(s.marking),d=Hp.isEnabled(s.postprocessing),p=Ab.isEnabled(s.postprocessing),{x:h,y:f,width:g,height:y}=r.viewport;t.setViewport(h,f,g,y),t.update(r,n),a&&!c&&i&&(this.drawTarget.bind(),t.clear(!1));let x=!1;this.transparencyMode==="wboit"&&this.wboit.supported?(this._renderWboit(t,r,n,a,s.postprocessing),x=!0):this.transparencyMode==="dpoit"&&this.dpoit.supported?(this._renderDpoit(t,r,n,s.dpoitIterations,a,s.postprocessing),x=!0):this._renderBlended(t,r,n,!l&&!u&&!c&&i,a,s.postprocessing);let S=u?this.postprocessing.target:!i||l||x?this.colorTarget:this.drawTarget;if(m&&n.markerAverage>0){let v=s.marking.ghostEdgeStrength<1;v&&n.markerAverage!==1&&(this.marking.depthTarget.bind(),t.clear(!1,!0),t.renderMarkingDepth(n.primitives,r)),this.marking.maskTarget.bind(),t.clear(!1,!0),t.renderMarkingMask(n.primitives,r,v?this.marking.depthTarget.texture:null),this.marking.update(s.marking),this.marking.render(r.viewport,S)}else S.bind();o.debug.isEnabled&&(o.debug.syncVisibility(),t.renderBlended(o.debug.scene,r)),o.handle.isEnabled&&t.renderBlended(o.handle.scene,r),o.pointer.isEnabled&&(o.pointer.setCamera(r),t.update(o.pointer.camera,o.pointer.scene),t.renderBlended(o.pointer.scene,o.pointer.camera)),o.camera.isEnabled&&(o.camera.update(r),t.update(o.camera.camera,o.camera.scene),t.renderBlended(o.camera.scene,o.camera.camera));let I=!1;if(c){let v=ms.isEnabled(s.postprocessing)?this.postprocessing.target.texture:this.colorTarget.texture;this.antialiasing.render(r,v,i&&!d,s.postprocessing)}else i&&!Hp.isEnabled(s.postprocessing)&&(I=!0);if(d&&s.postprocessing.dof.name==="on"){let v=Gg.isEnabled(s.postprocessing)?this.antialiasing.target.texture:ms.isEnabled(s.postprocessing)?this.postprocessing.target.texture:this.colorTarget.texture;this.dof.update(r,v,this.depthTargetOpaque?.texture||this.depthTextureOpaque,this.depthTextureTransparent,s.postprocessing.dof.params,n.boundingSphereVisible),this.dof.render(r.viewport,i?void 0:this.getColorTarget(s.postprocessing))}else i&&!Gg.isEnabled(s.postprocessing)&&(I=!0);if(I&&(this.drawTarget.bind(),this.webgl.state.disable(this.webgl.gl.DEPTH_TEST),u?this.copyFboPostprocessing.render():(l||x)&&this.copyFboTarget.render()),p&&s.postprocessing.bloom.name==="on"){let v=s.postprocessing.bloom.params.mode==="emissive";v&&n.emissiveAverage>0&&(this.bloom.emissiveTarget.bind(),t.clear(!1,!0),t.update(r,n),t.renderEmissive(n.primitives,r)),(!v||n.emissiveAverage>0)&&(this.bloom.update(this.colorTarget.texture,this.bloom.emissiveTarget.texture,this.depthTargetOpaque?.texture||this.depthTextureOpaque,s.postprocessing.bloom.params),this.bloom.render(r.viewport,i?void 0:this.getColorTarget(s.postprocessing)))}this.webgl.gl.flush()}render(t,r,n){je&&this.webgl.timer.mark("DrawPass.render");let{renderer:o,camera:i,scene:a,helper:s}=t;this.postprocessing.setTransparentBackground(r.transparentBackground);let l=r.transparentBackground||this.postprocessing.background.isEnabled(r.postprocessing);o.setTransparentBackground(l),o.setDrawingBufferSize(this.colorTarget.getWidth(),this.colorTarget.getHeight()),o.setPixelRatio(this.webgl.pixelRatio),sh.is(i)?(je&&this.webgl.timer.mark("StereoCamera.left"),this._render(o,i.left,a,s,n,l,r),je&&this.webgl.timer.markEnd("StereoCamera.left"),je&&this.webgl.timer.mark("StereoCamera.right"),this._render(o,i.right,a,s,n,l,r),je&&this.webgl.timer.markEnd("StereoCamera.right")):this._render(o,i,a,s,n,l,r),je&&this.webgl.timer.markEnd("DrawPass.render")}getColorTarget(t){return Hp.isEnabled(t)?this.dof.target:Gg.isEnabled(t)?this.antialiasing.target:ms.isEnabled(t)?this.postprocessing.target:this.colorTarget}};var JR;(n=>{function e(o,i,a){return{array:o,width:i,height:a}}n.create=e;function t(o){let{array:i,width:a,height:s}=o,l=i.length/(a*s),u=a*l;for(let c=0,m=s/2;c<m;++c)for(let d=0,p=u;d<p;++d){let h=c*u+d,f=(s-c-1)*u+d,g=i[h];i[h]=i[f],i[f]=g}return o}n.flipY=t;function r(o){let{array:i}=o,a=i instanceof Uint8Array?255:1;for(let s=0,l=i.length;s<l;s+=4){let u=i[s+3]/a;i[s]/=u,i[s+1]/=u,i[s+2]/=u}return o}n.divideByAlpha=r})(JR||={});var _at={alpha:C.Numeric(.51,{min:0,max:1,step:.01},{isEssential:!0,label:"Opacity"}),colorX:C.Color(Lt.red,{isEssential:!0}),colorY:C.Color(Lt.green,{isEssential:!0}),colorZ:C.Color(Lt.blue,{isEssential:!0}),scale:C.Numeric(.33,{min:.1,max:2,step:.1},{isEssential:!0}),location:C.Select("bottom-left",C.arrayToOptions(["bottom-left","bottom-right","top-left","top-right"])),locationOffsetX:C.Numeric(0),locationOffsetY:C.Numeric(0),originColor:C.Color(Lt.grey),radiusScale:C.Numeric(.075,{min:.01,max:.3,step:.001}),showPlanes:C.Boolean(!0),planeColorXY:C.Color(Lt.grey,{label:"Plane Color XY"}),planeColorXZ:C.Color(Lt.grey,{label:"Plane Color XZ"}),planeColorYZ:C.Color(Lt.grey,{label:"Plane Color YZ"}),showLabels:C.Boolean(!1),labelX:C.Text("X"),labelY:C.Text("Y"),labelZ:C.Text("Z"),labelColorX:C.Color(Lt.grey),labelColorY:C.Color(Lt.grey),labelColorZ:C.Color(Lt.grey),labelOpacity:C.Numeric(1,{min:0,max:1,step:.01}),labelScale:C.Numeric(.25,{min:.1,max:1,step:.01})},UC={axes:C.MappedStatic("on",{on:C.Group(_at),off:C.Group({})},{cycle:!0,description:"Show camera orientation axes"})},iT=class{constructor(t,r={}){this.webgl=t;this.props={axes:{name:"off",params:{}}};this.pixelRatio=1;this.eachGroup=(t,r)=>{if(!XL(t))return!1;let n=!1;if(this.meshRenderObject){let o=this.meshRenderObject.values.uGroupCount.ref.value;for(let{groupId:i,instanceId:a}of t.elements){let s=a*o+i;r(ye.ofSingleton(s))&&(n=!0)}}if(this.textRenderObject){let o=this.textRenderObject.values.uGroupCount.ref.value;for(let{groupId:i,instanceId:a}of t.elements){let s=a*o+i;r(ye.ofSingleton(s))&&(n=!0)}}return n};this.scene=ih.create(t,"blended"),this.camera=new ro,b.set(this.camera.up,0,1,0),b.set(this.camera.target,0,0,0),this.setProps(r)}setProps(t){this.props=Pl(this.props,r=>{if(t.axes!==void 0&&(r.axes.name=t.axes.name,t.axes.name==="on")){this.scene.clear(),this.pixelRatio=this.webgl.pixelRatio;let n={...t.axes.params,scale:t.axes.params.scale*this.pixelRatio,labelScale:t.axes.params.labelScale*this.pixelRatio};this.meshRenderObject=Eat(n),this.scene.add(this.meshRenderObject),t.axes.params.showLabels?(this.textRenderObject=Lat(n),this.scene.add(this.textRenderObject)):this.textRenderObject=void 0,this.scene.commit(),b.set(this.camera.position,0,0,n.scale*200),H.lookAt(this.camera.view,this.camera.position,this.camera.target,this.camera.up),r.axes.params={...t.axes.params}}})}get isEnabled(){return this.props.axes.name==="on"}getLoci(t){let{objectId:r,groupId:n,instanceId:o}=t;return(!this.meshRenderObject||r!==this.meshRenderObject.id)&&(!this.textRenderObject||r!==this.textRenderObject.id)||n===0?vr:Dat(this,n,o)}mark(t,r){return!ii.is(ii.Highlighting,r)||!xa(t)&&(!XL(t)||t.data!==this)?!1:qr.mark(this.meshRenderObject,t,r,this.eachGroup)||qr.mark(this.textRenderObject,t,r,this.eachGroup)}update(t){if(!this.meshRenderObject||this.props.axes.name==="off")return;this.pixelRatio!==this.webgl.pixelRatio&&this.setProps(this.props),wat(this.camera,t.viewport,t.viewOffset),H.extractRotation(this.scene.view,t.view);let r=this.textRenderObject?this.textRenderObject.values.boundingSphere.ref.value.radius:this.meshRenderObject.values.boundingSphere.ref.value.radius,n=this.props.axes.params.location,o=this.props.axes.params.locationOffsetX*this.pixelRatio,i=this.props.axes.params.locationOffsetY*this.pixelRatio;n==="bottom-left"?H.setTranslation(this.scene.view,b.create(-t.viewport.width/2+r+o,-t.viewport.height/2+r+i,0)):n==="bottom-right"?H.setTranslation(this.scene.view,b.create(t.viewport.width/2-r-o,-t.viewport.height/2+r+i,0)):n==="top-left"?H.setTranslation(this.scene.view,b.create(-t.viewport.width/2+r+o,t.viewport.height/2-r-i,0)):n==="top-right"?H.setTranslation(this.scene.view,b.create(t.viewport.width/2-r-o,t.viewport.height/2-r-i,0)):Mr(n)}};function Rat(e,t){let r=t.props.axes,n=r.name==="on"?r.params.labelX:"X",o=r.name==="on"?r.params.labelY:"Y",i=r.name==="on"?r.params.labelZ:"Z";switch(e){case 1:return`${n} Axis`;case 2:return`${o} Axis`;case 3:return`${i} Axis`;case 4:return`${n}${o} Plane`;case 5:return`${n}${i} Plane`;case 6:return`${o}${i} Plane`;case 7:return"Origin";default:return"Axes"}}function Dat(e,t,r){return _C("camera-axes",e,[{groupId:t,instanceId:r}],void 0,()=>Rat(t,e))}function XL(e){return e.kind==="data-loci"&&e.tag==="camera-axes"}function wat(e,t,r){let{near:n,far:o}=e,i=-t.width/2,a=t.width/2,s=t.height/2,l=-t.height/2,u=(a-i)/2,c=(s-l)/2,m=(a+i)/2,d=(s+l)/2,p=m-u,h=m+u,f=d+c,g=d-c;if(r.enabled){let y=(a-i)/r.width,x=(s-l)/r.height;p+=y*r.offsetX,h=p+y*r.width,f-=x*r.offsetY,g=f-x*r.height}H.ortho(e.projection,p,h,f,g,n,o)}function Mat(e,t){let r=tt.createState(512,256,t),n=100*e.scale,o=e.radiusScale*n,i=e.showLabels?100*e.labelScale/3:0,a=b.scale(b(),b.unitX,n-i),s=b.scale(b(),b.unitY,n-i),l=b.scale(b(),b.unitZ,n-i),u={radiusTop:o,radiusBottom:o,radialSegments:32};if(r.currentGroup=7,Zr(r,b.origin,o,2),r.currentGroup=1,Zr(r,a,o,2),gn(r,b.origin,a,1,u),r.currentGroup=2,Zr(r,s,o,2),gn(r,b.origin,s,1,u),r.currentGroup=3,Zr(r,l,o,2),gn(r,b.origin,l,1,u),e.showPlanes){b.scale(a,a,.5),b.scale(s,s,.5),b.scale(l,l,.5),r.currentGroup=4,tt.addTriangle(r,b.origin,a,s),tt.addTriangle(r,b.origin,s,a);let c=b.add(b(),a,s);tt.addTriangle(r,c,a,s),tt.addTriangle(r,c,s,a),r.currentGroup=5,tt.addTriangle(r,b.origin,a,l),tt.addTriangle(r,b.origin,l,a);let m=b.add(b(),a,l);tt.addTriangle(r,m,a,l),tt.addTriangle(r,m,l,a),r.currentGroup=6,tt.addTriangle(r,b.origin,s,l),tt.addTriangle(r,b.origin,l,s);let d=b.add(b(),s,l);tt.addTriangle(r,d,s,l),tt.addTriangle(r,d,l,s)}return tt.getMesh(r)}function Bat(e,t){let r=100*e.scale,n=Mat(e,t?.geometry);n.setBoundingSphere(he.create(b.create(r/2,r/2,r/2),r+r/4));let o=i=>{switch(i){case 1:return e.colorX;case 2:return e.colorY;case 3:return e.colorZ;case 4:return e.planeColorXY;case 5:return e.planeColorXZ;case 6:return e.planeColorYZ;case 7:return e.originColor;default:return Lt.grey}};return Wr.create("axes-mesh",{},n,o,()=>1,()=>"")}function Eat(e){let t=Bat(e);return Wr.createRenderObject(t,{...C.getDefaultValues(ft.Params),...e,ignoreLight:!0,cellSize:0})}function kat(e,t){let r=Ws.create(e,8,8,t),n=100*e.scale,o=b.scale(b(),b.unitX,n),i=b.scale(b(),b.unitY,n),a=b.scale(b(),b.unitZ,n),s=100*e.labelScale;return r.add(e.labelX,o[0],o[1],o[2],0,s,1),r.add(e.labelY,i[0],i[1],i[2],0,s,2),r.add(e.labelZ,a[0],a[1],a[2],0,s,3),r.getText()}function Fat(e,t){let r=100*e.scale,n=kat(e,t?.geometry);n.setBoundingSphere(he.create(b.create(r/2,r/2,r/2),r));let o=i=>{switch(i){case 1:return e.labelColorX;case 2:return e.labelColorY;case 3:return e.labelColorZ;default:return Lt.grey}};return Wr.create("axes-text",{},n,o,()=>1,()=>"")}function Lat(e){let t=Fat(e);return Wr.createRenderObject(t,{...C.getDefaultValues(na.Params),...e,alpha:e.labelOpacity,cellSize:0})}var eAe=`
precision highp float;
precision highp sampler2D;

uniform sampler2D tShaded;
uniform sampler2D tColor;
uniform sampler2D tNormal;
uniform sampler2D tTransparentColor;
uniform sampler2D tSsaoDepth;
uniform sampler2D tSsaoDepthTransparent;
uniform sampler2D tDepthOpaque;
uniform sampler2D tDepthTransparent;
uniform sampler2D tOutlines;
uniform vec2 uTexSize;

uniform float uNear;
uniform float uFar;
uniform float uFogNear;
uniform float uFogFar;
uniform vec3 uFogColor;
uniform vec3 uOutlineColor;
uniform vec3 uOcclusionColor;
uniform bool uTransparentBackground;

uniform float uDenoiseThreshold;

#include common

float getViewZ(const in float depth) {
    #if dOrthographic == 1
        return orthographicDepthToViewZ(depth, uNear, uFar);
    #else
        return perspectiveDepthToViewZ(depth, uNear, uFar);
    #endif
}

float getDepthOpaque(const in vec2 coords) {
    #ifdef depthTextureSupport
        return texture2D(tDepthOpaque, coords).r;
    #else
        return unpackRGBAToDepth(texture2D(tDepthOpaque, coords));
    #endif
}

float getDepthTransparent(const in vec2 coords) {
    #if defined(dTransparentOutline) || defined(dOcclusionEnable)
        return unpackRGBAToDepthWithAlpha(texture2D(tDepthTransparent, coords)).x;
    #else
        return 1.0;
    #endif
}

bool isBackground(const in float depth) {
    return depth == 1.0;
}

float getSsao(vec2 coords) {
    float rawSsao = unpackRGToUnitInterval(texture2D(tSsaoDepth, coords).xy);
    if (rawSsao > 0.999) {
        return 1.0;
    } else if (rawSsao > 0.001) {
        return rawSsao;
    }
    // treat values close to 0.0 as errors and return no occlusion
    return 1.0;
}

float getSsaoTransparent(vec2 coords) {
    float rawSsao = unpackRGToUnitInterval(texture2D(tSsaoDepthTransparent, coords).xy);
    if (rawSsao > 0.999) {
        return 1.0;
    } else if (rawSsao > 0.001) {
        return rawSsao;
    }
    // treat values close to 0.0 as errors and return no occlusion
    return 1.0;
}

//

// TODO: investigate
// https://interplayoflight.wordpress.com/2022/03/26/raytraced-global-illumination-denoising/

//

#define INV_SQRT_OF_2PI 0.39894228040143267793994605993439  // 1.0/SQRT_OF_2PI
#define INV_PI 0.31830988618379067153776752674503

// https://github.com/BrutPitt/glslSmartDeNoise
//
//  smartDeNoise - parameters
//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
//
//  sampler2D tex     - sampler image / texture
//  vec2 uv           - actual fragment coord
//  float sigma  >  0 - sigma Standard Deviation
//  float kSigma >= 0 - sigma coefficient
//      kSigma * sigma  -->  radius of the circular kernel
//  float threshold   - edge sharpening threshold

float NormalWeightStrength = 6.0;

vec4 smartDeNoise(sampler2D tex, vec2 uv) {
    float sigma = 3.0;
    float kSigma = 2.0;
    float threshold = uDenoiseThreshold;

    vec4 centrPx = texture2D(tex, uv);
    if (threshold == 0.0) return centrPx;

    float invSigmaQx2 = 0.5 / (sigma * sigma);      // 1.0 / (sigma^2 * 2.0)
    float invSigmaQx2PI = INV_PI * invSigmaQx2;    // 1.0 / (sqrt(PI) * sigma)

    float invThresholdSqx2 = 0.5 / (threshold * threshold);     // 1.0 / (sigma^2 * 2.0)
    float invThresholdSqrt2PI = INV_SQRT_OF_2PI / threshold;   // 1.0 / (sqrt(2*PI) * sigma)

    float zBuff = 0.0;
    vec4 aBuff = vec4(0.0);

    vec3 normal = texture2D(tNormal, uv).xyz;

    for (int x = -6; x <= 6; ++x) {
        for (int y = -6; y <= 6; ++y) {
            vec2 d = vec2(float(x), float(y));

            float blurFactor = exp(-dot(d , d) * invSigmaQx2) * invSigmaQx2PI;
            vec2 uvSample = uv + d / uTexSize;

            vec3 normalSample = texture2D(tNormal, uvSample).xyz;
            float normalW = saturate(dot(normal, normalSample));
            normalW = pow(normalW, NormalWeightStrength);
            blurFactor *= normalW;

            vec4 walkPx = texture2D(tex, uvSample);

            vec4 dC = walkPx - centrPx;
            float deltaFactor = exp(-dot(dC, dC) * invThresholdSqx2) * invThresholdSqrt2PI * blurFactor;

            zBuff += deltaFactor;
            aBuff += deltaFactor * walkPx;
        }
    }

    if (zBuff <= EPSILON) {
        return centrPx;
    }

    return aBuff / zBuff;
}

int squaredOutlineScale = dOutlineScale * dOutlineScale;
void getOutline(const in vec2 coords, out bool hasOpaque, out bool hasTransparent, out float opaqueDepth, out float transparentDepth, out float alpha) {
    vec2 invTexSize = 1.0 / uTexSize;
    
    hasOpaque = false;
    hasTransparent = false;
    opaqueDepth = 1.0;
    transparentDepth = 1.0;
    alpha = 0.0;
    for (int y = -dOutlineScale; y <= dOutlineScale; y++) {
        for (int x = -dOutlineScale; x <= dOutlineScale; x++) {
            if (x * x + y * y > squaredOutlineScale) {
                continue;
            }

            vec2 sampleCoords = coords + vec2(float(x), float(y)) * invTexSize;

            vec4 sampleOutlineCombined = texture2D(tOutlines, sampleCoords);
            float sampleOpaqueDepth = unpackRGToUnitInterval(sampleOutlineCombined.gb);
            float sampleTransparentDepth = sampleOutlineCombined.a;
            vec2 sampleFlagWithAlpha = unpack2x4(sampleOutlineCombined.r);

            float sampleFlag = sampleFlagWithAlpha.x;
            float sampleAlpha = clamp(sampleFlagWithAlpha.y * 0.5, 0.01, 1.0);
            
            if ((sampleFlag > 0.20 && sampleFlag < 0.30) || (sampleFlag > 0.70 && sampleFlag < 0.80)) { // transparent || both
                if (sampleOpaqueDepth < opaqueDepth) {
                    hasOpaque = true;
                    opaqueDepth = sampleOpaqueDepth;
                }
            }
            
            if ((((sampleFlag > 0.45 && sampleFlag < 0.55) || (sampleFlag > 0.70 && sampleFlag < 0.80))) && sampleTransparentDepth < transparentDepth) { // transparent || both
                hasTransparent = true;
                transparentDepth = sampleTransparentDepth;
                alpha = sampleAlpha;
            }
        }
    }
}

void main() {
    vec2 coords = gl_FragCoord.xy / uTexSize;

    #ifdef dDenoise
        vec4 color = smartDeNoise(tColor, coords);
    #else
        vec4 color = texture2D(tColor, coords);
    #endif

    float opaqueDepth = getDepthOpaque(coords);
    float backgroundViewZ = 2.0 * uFar;
    float opaqueSelfViewZ = isBackground(opaqueDepth) ? backgroundViewZ : getViewZ(opaqueDepth);
    float fogFactor = smoothstep(uFogNear, uFogFar, abs(opaqueSelfViewZ));
    float fogAlpha = 1.0 - fogFactor;

    float transparentDepth = 1.0;
    #ifdef dBlendTransparency
        bool blendTransparency = true;
        vec4 transparentColor = texture2D(tTransparentColor, coords);

        transparentDepth = getDepthTransparent(coords);
    #endif

    float alpha = 1.0;
    if (!uTransparentBackground) {
        // mix opaque objects with background color
        color.rgb = mix(color.rgb, uFogColor, fogFactor);
    } else {
        // pre-multiplied alpha expected for transparent background
        alpha = fogAlpha;
        color.rgb *= fogAlpha;
    }

    #if defined(dOcclusionEnable)
        if (!isBackground(opaqueDepth)) {
            float occlusionFactor = getSsao(coords);

            if (!uTransparentBackground) {
                color.rgb = mix(mix(uOcclusionColor, uFogColor, fogFactor), color.rgb, occlusionFactor);
            } else {
                color.rgb = mix(uOcclusionColor * (1.0 - fogFactor), color.rgb, occlusionFactor);
            }
        }
        #ifdef dBlendTransparency
            if (!isBackground(transparentDepth)) {
                float viewDist = abs(getViewZ(transparentDepth));
                float fogFactor = smoothstep(uFogNear, uFogFar, viewDist);
                float occlusionFactor = getSsaoTransparent(coords);
                transparentColor.rgb = mix(uOcclusionColor * (1.0 - fogFactor), transparentColor.rgb, occlusionFactor);
            }
        #endif
    #endif

    #ifdef dOutlineEnable
        bool hasOpaque;
        bool hasTransparent;
        float outlineOpaqueDepth;
        float outlineTransparentDepth;
        float outlineAlpha;
        getOutline(coords, hasOpaque, hasTransparent, outlineOpaqueDepth, outlineTransparentDepth, outlineAlpha);

        if (hasOpaque) {
            float viewDist = abs(getViewZ(outlineOpaqueDepth));
            float fogFactor = smoothstep(uFogNear, uFogFar, viewDist);
            if (!uTransparentBackground) {                    
                color.rgb = mix(uOutlineColor, uFogColor, fogFactor);
            } else {
                alpha = 1.0 - fogFactor;
                color.rgb = mix(uOutlineColor, vec3(0.0), fogFactor);
            }
        }  

        #ifdef dBlendTransparency            
            if (hasTransparent) {
                if (hasOpaque && outlineOpaqueDepth < outlineTransparentDepth) {
                    blendTransparency = false;
                } else {
                    float finalOutlineAlpha = clamp(outlineAlpha * 2.0, 0.0, 1.0);
                    float viewDist = abs(getViewZ(outlineTransparentDepth));
                    float fogFactor = smoothstep(uFogNear, uFogFar, viewDist);
                    float finalAlpha = max(transparentColor.a, finalOutlineAlpha * (1.0 - fogFactor));
                    transparentColor.a = finalAlpha;
                    transparentColor.rgb = uOutlineColor * finalAlpha;
                }
            }
        #endif
    #endif

    #ifdef dBlendTransparency
        if (blendTransparency) {
            if (transparentColor.a != 0.0) {
                // blending
                color = transparentColor + color * (1.0 - transparentColor.a);
                alpha = transparentColor.a + alpha * (1.0 - transparentColor.a);
            }
        }
    #endif

    gl_FragColor = vec4(color.rgb, alpha);
}
`;var tAe=`
precision highp int;
precision highp float;
precision highp sampler2D;

uniform sampler2D tColor;
uniform sampler2D tNormal;
uniform sampler2D tShaded;
uniform sampler2D tThickness;
uniform sampler2D tAccumulate;
uniform sampler2D tDepth;
uniform vec2 uTexSize;
uniform vec4 uBounds;

uniform float uNear;
uniform float uFar;
uniform float uFogNear;
uniform float uFogFar;
uniform vec3 uFogColor;

#if dLightCount != 0
    uniform vec3 uLightDirection[dLightCount];
    uniform vec3 uLightColor[dLightCount];
#endif
uniform vec3 uAmbientColor;
uniform vec3 uLightStrength;

uniform int uFrameNo;

uniform float uRayDistance;
uniform float uMinThickness;
uniform float uThicknessFactor;
uniform float uThickness;

uniform float uShadowSoftness;
uniform float uShadowThickness;

uniform mat4 uProjection;
uniform mat4 uInvProjection;

#include common

// parts adapted from
// - https://blog.demofox.org/2020/05/25/casual-shadertoy-path-tracing-1-basic-camera-diffuse-emissive/
// - https://github.com/0beqz/realism-effects/blob/v2-debug/src/ssgi/shader/ssgi.frag

//

// after a hit, it moves the ray this far along the normal away from a surface.
// Helps prevent incorrect intersections when rays bounce off of objects.
#define RayPosNormalNudge 0.0001

#if __VERSION__ == 100
    #define StateType float

    // from https://www.shadertoy.com/view/4djSRW
    float hash14(vec4 p4) {
        p4 = fract(p4  * vec4(0.1031, 0.1030, 0.0973, 0.1099));
        p4 += dot(p4, p4.wzxy + 33.33);
        return fract((p4.x + p4.y) * (p4.z + p4.w));
    }

    float randomFloat(inout float state) {
        state += 0.06711056;
        return 1.0 - hash14(vec4(gl_FragCoord.xy, float(uFrameNo), state));
    }
#else
    #define StateType uint

    // https://www.pcg-random.org/
    // https://jcgt.org/published/0009/03/02/
    uint pcg(inout uint seed) {
        seed = seed * 747796405u + 2891336453u;
        uint word = ((seed >> ((seed >> 28u) + 4u)) ^ seed) * 277803737u;
        return (word >> 22u) ^ word;
    }

    float randomFloat(inout uint state) {
        return float(pcg(state)) / 4294967296.0;
    }
#endif

vec3 randomUnitVector(inout StateType state) {
    float z = randomFloat(state) * 2.0 - 1.0;
    float a = randomFloat(state) * TWO_PI;
    float r = sqrt(1.0 - z * z);
    float x = r * cos(a);
    float y = r * sin(a);
    return vec3(x, y, z);
}

struct RayHitInfo {
    bool missed;
    vec3 position;
    vec3 normal;
    vec3 color;
    vec3 emissive;
};

//

float getDepth(const in vec2 coords) {
    vec2 c = vec2(clamp(coords.x, uBounds.x, uBounds.z), clamp(coords.y, uBounds.y, uBounds.w));
    return texture2D(tDepth, c).r;
}

float getThickness(const in vec2 coords) {
    vec2 c = vec2(clamp(coords.x, uBounds.x, uBounds.z), clamp(coords.y, uBounds.y, uBounds.w));
    return unpackRGBAToDepth(texture2D(tThickness, c));
}

bool isBackground(const in float depth) {
    return depth == 1.0;
}

float getViewZ(const in float depth) {
    #if dOrthographic == 1
        return orthographicDepthToViewZ(depth, uNear, uFar);
    #else
        return perspectiveDepthToViewZ(depth, uNear, uFar);
    #endif
}

vec2 viewSpaceToScreenSpace(const vec3 position) {
    vec4 projectedCoord = uProjection * vec4(position, 1.0);
    projectedCoord.xy /= projectedCoord.w;
    // [-1, 1] --> [0, 1] (NDC to screen position)
    projectedCoord.xy = projectedCoord.xy * 0.5 + 0.5;
    return projectedCoord.xy;
}

vec2 binarySearch(inout vec3 dir, inout vec3 hitPos) {
    float rayHitDepthDifference;
    vec2 coords;

    dir *= 0.5;
    hitPos -= dir;

    for (int i = 0; i < dRefineSteps; i++) {
        coords = viewSpaceToScreenSpace(hitPos);
        float depth = getDepth(coords);
        float z = getViewZ(depth);
        rayHitDepthDifference = z - hitPos.z;

        dir *= 0.5;
        if (rayHitDepthDifference >= 0.0) {
            hitPos -= dir;
        } else {
            hitPos += dir;
        }
    }

    coords = viewSpaceToScreenSpace(hitPos);

    return coords;
}

float calculateGrowthFactor(float begin, float end, float steps) {
    return pow(end / begin, 1.0 / steps);
}

vec2 rayMarch(in vec3 dir, in float thickness, inout vec3 hitPos, out bool missed) {
    float rayHitDepthDifference;
    vec2 coords;

    float begin = float(dFirstStepSize);
    dir *= begin;
    missed = false;
    float gf = calculateGrowthFactor(begin, uRayDistance, float(dSteps));

    for (int i = 1; i < dSteps; i++) {
        hitPos += dir;
        dir *= gf;

        coords = viewSpaceToScreenSpace(hitPos);
        float depth = getDepth(coords);
        float z = getViewZ(depth);
        rayHitDepthDifference = z - hitPos.z;

        if (thickness == 0.0) {
            #ifdef dThicknessMode_auto
                thickness = max(uMinThickness, (getViewZ(getThickness(coords)) - z) * uThicknessFactor * texture2D(tColor, coords).a);
            #else
                thickness = uThickness;
            #endif
        }

        if (rayHitDepthDifference >= 0.0 && rayHitDepthDifference < thickness) {
            if (dRefineSteps == 0) {
                return coords;
            } else {
                return binarySearch(dir, hitPos);
            }
        }
    }

    missed = true;

    return coords;
}

//

void trace(in vec3 rayPos, in vec3 rayDir, inout RayHitInfo hitInfo) {
    vec3 hitPos = vec3(rayPos);
    bool missed;
    vec2 coords;
    coords = rayMarch(rayDir, 0.0, hitPos, missed);

    hitInfo.missed = missed;
    hitInfo.position = hitPos;
    hitInfo.normal = -texture2D(tNormal, coords).rgb;
    hitInfo.color = texture2D(tColor, coords).rgb;
    hitInfo.emissive = texture2D(tColor, coords).rgb * texture2D(tNormal, coords).a * 2.0;

    float depth = getDepth(coords);
    if (isBackground(depth)) {
        hitInfo.emissive = vec3(0.0);
    }
}

vec3 viewPos;

vec3 colorForRay(in vec3 startRayPos, in vec3 startRayDir, inout StateType rngState) {
    vec3 ret = vec3(0.0, 0.0, 0.0);

    vec3 throughput = vec3(1.0, 1.0, 1.0);
    vec3 rayPos = startRayPos;
    vec3 rayDir = startRayDir;

    RayHitInfo hitInfo;
    RayHitInfo prevHitInfo;

    for (int bounceIndex = 0; bounceIndex <= dBounces; ++bounceIndex) {
        // shoot a ray out into the world
        if (bounceIndex == 0) {
            vec2 coords = gl_FragCoord.xy / uTexSize;
            float depth = getDepth(coords);

            hitInfo.missed = false;
            hitInfo.position = screenSpaceToViewSpace(vec3(coords, depth), uInvProjection);
            hitInfo.normal = -texture2D(tNormal, coords).rgb;
            hitInfo.color = texture2D(tShaded, coords).rgb;
            hitInfo.emissive = texture2D(tColor, coords).rgb * texture2D(tNormal, coords).a;

            // shadow
            #ifdef dShadowEnable
                #if dLightCount != 0
                    vec3 directLight = vec3(uAmbientColor);
                    #pragma unroll_loop_start
                    bool missed;
                    vec3 hitPos;
                    for (int i = 0; i < dLightCount; ++i) {
                        missed = false;
                        hitPos = viewPos + hitInfo.normal * RayPosNormalNudge;
                        hitPos += -uLightDirection[i] * (randomFloat(rngState));
                        rayMarch(-uLightDirection[i] + randomUnitVector(rngState) * uShadowSoftness, uShadowThickness, hitPos, missed);
                        if (missed) directLight += uLightColor[i];
                    }
                    #pragma unroll_loop_end
                    hitInfo.color *= directLight / uLightStrength;
                #endif
            #endif

            if (hitInfo.normal == vec3(0.0)) {
                hitInfo.missed = true;
            }
        } else {
            prevHitInfo = hitInfo;
            trace(rayPos, rayDir, hitInfo);
        }

        // if the ray missed, we are done
        if (hitInfo.missed) {
            vec3 accIrradiance = vec3(1.0);
            #ifdef dGlow
                if (bounceIndex > 1) {
                    accIrradiance = uLightStrength;
                }
            #else
                if (bounceIndex > 1) {
                    accIrradiance = uAmbientColor;
                    #if dLightCount != 0
                        #pragma unroll_loop_start
                        float dotNL;
                        vec3 irradiance;
                        for (int i = 0; i < dLightCount; ++i) {
                            dotNL = saturate(dot(prevHitInfo.normal, -uLightDirection[i]));
                            irradiance = dotNL * uLightColor[i];
                            accIrradiance += irradiance;
                        }
                        #pragma unroll_loop_end
                    #endif
                }
            #endif
            ret += prevHitInfo.color * accIrradiance * throughput;
            break;
        }

        // add emissive light
        ret += hitInfo.emissive * throughput;

        // update the ray position
        rayPos = hitInfo.position + hitInfo.normal * RayPosNormalNudge;

        // new ray direction from normal oriented cosine weighted hemisphere sample
        rayDir = normalize(hitInfo.normal + randomUnitVector(rngState));

        if (bounceIndex == 0) {
            continue;
        }

        // update the colorMultiplier.
        throughput *= hitInfo.color;

        // Russian Roulette
        // As the throughput gets smaller, the ray is more likely to get terminated early.
        // Survivors have their value boosted to make up for fewer samples being in the average.
        {
            float p = max(throughput.r, max(throughput.g, throughput.b));
            if (randomFloat(rngState) > p)
                break;

            // Add the energy we 'lose' by randomly terminating paths
            throughput *= 1.0 / p;
        }
    }

    // return pixel color
    return ret;
}

void main() {
    vec2 coords = gl_FragCoord.xy / uTexSize;
    float depth = getDepth(coords);

    if (isBackground(depth)) {
        gl_FragColor = texture2D(tColor, coords);
        return;
    }

    #if __VERSION__ == 100
        float rngState = 26699.0;
    #else
        // initialize a random number state based on gl_FragCoord and uFrameNo
        uint rngState = uint(uint(gl_FragCoord.x) * 1973u + uint(gl_FragCoord.y) * 9277u + uint(uFrameNo) * 26699u) | 1u;
    #endif

    vec3 cameraPos = vec3(0.0, 0.0, 0.0);
    viewPos = screenSpaceToViewSpace(vec3(coords, depth), uInvProjection);
    vec3 rayDir = normalize(viewPos);

    // raytrace for this pixel
    vec3 color = vec3(0.0, 0.0, 0.0);
    for (int index = 0; index < int(dRendersPerFrame); ++index) {
        color += colorForRay(cameraPos, rayDir, rngState) / float(dRendersPerFrame);
    }

    // average the frames together
    vec4 lastFrameColor = texture2D(tAccumulate, coords);
    float blend = (uFrameNo < 1 || lastFrameColor.a == 0.0) ? 1.0 : 1.0 / (1.0 + (1.0 / lastFrameColor.a));
    color = mix(lastFrameColor.rgb, color, blend);

    // show the result
    gl_FragColor = vec4(color, blend);
}
`;var rAe=`
precision highp float;
precision highp sampler2D;

uniform sampler2D tColor;
uniform vec2 uTexSize;
uniform float uWeight;

void main() {
    vec2 coords = gl_FragCoord.xy / uTexSize;
    gl_FragColor = texture2D(tColor, coords) * uWeight;
}
`;var nAe={rendersPerFrame:C.Interval([1,16],{min:1,max:64,step:1},{description:"Number of rays per pixel each frame. May be adjusted to reach targetFps but will stay within given interval."}),targetFps:C.Numeric(30,{min:0,max:120,step:.1},{description:"Target FPS per frame. If observed FPS is lower or higher, some parameters may get adjusted."}),steps:C.Numeric(32,{min:1,max:1024,step:1}),firstStepSize:C.Numeric(.01,{min:.001,max:1,step:.001}),refineSteps:C.Numeric(4,{min:0,max:8,step:1},{description:"Number of refine steps per ray hit. May be lower to reach targetFps."}),rayDistance:C.Numeric(256,{min:1,max:8192,step:1},{description:"Maximum distance a ray can travel (in world units)."}),thicknessMode:C.Select("auto",C.arrayToOptions(["auto","fixed"])),minThickness:C.Numeric(.5,{min:.1,max:16,step:.1},{hideIf:e=>e.thicknessMode==="fixed"}),thicknessFactor:C.Numeric(1,{min:.1,max:2,step:.05},{hideIf:e=>e.thicknessMode==="fixed"}),thickness:C.Numeric(4,{min:.1,max:512,step:.1},{hideIf:e=>e.thicknessMode==="auto"}),bounces:C.Numeric(4,{min:1,max:32,step:1},{description:"Number of bounces for each ray."}),glow:C.Boolean(!0,{description:"Bounced rays always get the full light. This produces a slight glowing effect."}),shadowEnable:C.Boolean(!1),shadowSoftness:C.Numeric(.1,{min:.01,max:1,step:.01}),shadowThickness:C.Numeric(.5,{min:.1,max:32,step:.1})},QL=class{constructor(t,r){this.webgl=t;this.drawPass=r;this.clearAdjustedProps=!0;this.prevTime=0;this.currTime=0;this.rendersPerFrame=1;this.refineSteps=1;this.steps=16;let{extensions:{drawBuffers:n,colorBufferHalfFloat:o,textureHalfFloat:i},resources:a,isWebGL2:s}=t,{depthTextureOpaque:l}=r,u=l.getWidth(),c=l.getHeight();s?(this.shadedTextureOpaque=a.texture("image-uint8","rgba","ubyte","nearest"),this.shadedTextureOpaque.define(u,c),this.normalTextureOpaque=o&&i?a.texture("image-float16","rgba","fp16","nearest"):a.texture("image-float32","rgba","float","nearest"),this.normalTextureOpaque.define(u,c),this.colorTextureOpaque=a.texture("image-uint8","rgba","ubyte","nearest"),this.colorTextureOpaque.define(u,c)):(this.shadedTextureOpaque=a.texture("image-float32","rgba","float","nearest"),this.shadedTextureOpaque.define(u,c),this.normalTextureOpaque=a.texture("image-float32","rgba","float","nearest"),this.normalTextureOpaque.define(u,c),this.colorTextureOpaque=a.texture("image-float32","rgba","float","nearest"),this.colorTextureOpaque.define(u,c)),this.framebuffer=a.framebuffer(),this.framebuffer.bind(),n.drawBuffers([n.COLOR_ATTACHMENT0,n.COLOR_ATTACHMENT1,n.COLOR_ATTACHMENT2]),this.shadedTextureOpaque.attachFramebuffer(this.framebuffer,"color0"),this.normalTextureOpaque.attachFramebuffer(this.framebuffer,"color1"),this.colorTextureOpaque.attachFramebuffer(this.framebuffer,"color2"),this.thicknessTarget=t.createRenderTarget(u,c,!0,"uint8","nearest"),this.holdTarget=t.createRenderTarget(u,c,!1,"float32"),this.accumulateTarget=t.createRenderTarget(u,c,!1,"float32"),this.composeTarget=t.createRenderTarget(u,c,!1,"uint8","linear"),this.traceRenderable=Gat(t,this.colorTextureOpaque,this.normalTextureOpaque,this.shadedTextureOpaque,this.thicknessTarget.texture,this.accumulateTarget.texture,this.drawPass.depthTextureOpaque),this.accumulateRenderable=zat(t,this.holdTarget.texture)}getByteCount(){return this.thicknessTarget.getByteCount()+this.holdTarget.getByteCount()+this.accumulateTarget.getByteCount()+this.composeTarget.getByteCount()+this.colorTextureOpaque.getByteCount()+this.normalTextureOpaque.getByteCount()+this.shadedTextureOpaque.getByteCount()}renderInput(t,r,n,o){je&&this.webgl.timer.mark("TracePass.renderInput");let{gl:i,state:a}=this.webgl;this.framebuffer.bind(),this.drawPass.depthTextureOpaque.attachFramebuffer(this.framebuffer,"depth"),t.clear(!0),t.renderTracing(n.primitives,r),o.thicknessMode==="auto"&&(this.thicknessTarget.bind(),a.clearColor(0,0,0,0),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT),t.renderDepthOpaqueBack(n.primitives,r)),je&&this.webgl.timer.markEnd("TracePass.renderInput")}setSize(t,r){let n=this.composeTarget.getWidth(),o=this.composeTarget.getHeight();(t!==n||r!==o)&&(this.thicknessTarget.setSize(t,r),this.holdTarget.setSize(t,r),this.accumulateTarget.setSize(t,r),this.composeTarget.setSize(t,r),this.colorTextureOpaque.define(t,r),this.normalTextureOpaque.define(t,r),this.shadedTextureOpaque.define(t,r),_.update(this.traceRenderable.values.uTexSize,Ce.set(this.traceRenderable.values.uTexSize.ref.value,t,r)),_.update(this.accumulateRenderable.values.uTexSize,Ce.set(this.accumulateRenderable.values.uTexSize.ref.value,t,r)))}reset(){let{drawBuffers:t}=this.webgl.extensions;this.framebuffer.bind(),t.drawBuffers([t.COLOR_ATTACHMENT0,t.COLOR_ATTACHMENT1,t.COLOR_ATTACHMENT2]),this.shadedTextureOpaque.attachFramebuffer(this.framebuffer,"color0"),this.normalTextureOpaque.attachFramebuffer(this.framebuffer,"color1"),this.colorTextureOpaque.attachFramebuffer(this.framebuffer,"color2"),this.restart(!0)}restart(t=!1){let{gl:r,state:n}=this.webgl;this.accumulateTarget.bind(),n.clearColor(0,0,0,0),r.clear(r.COLOR_BUFFER_BIT),this.composeTarget.bind(),n.clearColor(0,0,0,0),r.clear(r.COLOR_BUFFER_BIT),t&&(this.prevTime=0,this.currTime=0,this.clearAdjustedProps=!0)}increaseAdjustedProps(t){this.steps+=1,this.steps>t.steps&&(this.refineSteps+=1),this.refineSteps>t.refineSteps&&(this.rendersPerFrame+=1)}decreaseAdjustedProps(t){let r=Math.min(1,t.refineSteps);this.rendersPerFrame-=1,this.rendersPerFrame<1&&(this.refineSteps-=1),this.refineSteps<r&&(this.steps-=1)}getAdjustedProps(t,r){this.currTime=En();let n=Math.min(1,t.refineSteps),o=Math.round(t.steps/2);if(this.clearAdjustedProps&&(this.rendersPerFrame=t.rendersPerFrame[0],this.refineSteps=n,this.steps=o,this.clearAdjustedProps=!1),r>0){let i=1e3/t.targetFps,a=this.currTime-this.prevTime,s=Math.round(a/i);if(s>=2)for(;s>0;)this.decreaseAdjustedProps(t),s-=1;else a<i?this.increaseAdjustedProps(t):a>i+.5&&this.decreaseAdjustedProps(t)}return this.prevTime=this.currTime,this.rendersPerFrame=_r(this.rendersPerFrame,t.rendersPerFrame[0],t.rendersPerFrame[1]),this.refineSteps=_r(this.refineSteps,n,t.refineSteps),this.steps=_r(this.steps,o,t.steps),{rendersPerFrame:r===0?Math.ceil(this.rendersPerFrame/2):this.rendersPerFrame,refineSteps:r===0?n:this.refineSteps,steps:r===0?o:this.steps}}render(t,r,n,o,i){let{rendersPerFrame:a,refineSteps:s,steps:l}=this.getAdjustedProps(n,o);je&&this.webgl.timer.mark("TracePass.render",{note:`${a} rendersPerFrame, ${s} refineSteps, ${l} steps`});let{renderer:u,camera:c,scene:m}=t,{gl:d,state:p}=this.webgl,{x:h,y:f,width:g,height:y}=c.viewport;(o===0||i)&&(u.setTransparentBackground(r),u.setDrawingBufferSize(this.composeTarget.getWidth(),this.composeTarget.getHeight()),u.setPixelRatio(this.webgl.pixelRatio),u.setViewport(h,f,g,y),u.update(c,m),this.renderInput(u,c,m,n)),p.disable(d.BLEND),p.disable(d.DEPTH_TEST),p.disable(d.CULL_FACE),p.depthMask(!1),p.viewport(h,f,g,y),p.scissor(h,f,g,y);let x=H.identity();H.invert(x,c.projection);let S=c.state.mode==="orthographic"?1:0,[I,v]=this.traceRenderable.values.uTexSize.ref.value,A=c.viewport,P=b();b.scale(P,Le.toArrayNormalized(u.props.ambientColor,P,0),u.props.ambientIntensity);let T=b.clone(P);for(let w=0,E=u.light.count;w<E;++w){let M=b.fromArray(b(),u.light.color,w*3);b.add(T,T,M)}this.holdTarget.bind();let R=!1;_.update(this.traceRenderable.values.uFrameNo,o),this.traceRenderable.values.dRendersPerFrame.ref.value!==a&&(_.update(this.traceRenderable.values.dRendersPerFrame,a),R=!0),_.update(this.traceRenderable.values.uProjection,c.projection),_.update(this.traceRenderable.values.uInvProjection,x),Et.set(this.traceRenderable.values.uBounds.ref.value,A.x/I,A.y/v,(A.x+A.width)/I,(A.y+A.height)/v),_.update(this.traceRenderable.values.uBounds,this.traceRenderable.values.uBounds.ref.value),_.updateIfChanged(this.traceRenderable.values.uNear,c.near),_.updateIfChanged(this.traceRenderable.values.uFar,c.far),_.updateIfChanged(this.traceRenderable.values.uFogFar,c.fogFar),_.updateIfChanged(this.traceRenderable.values.uFogNear,c.fogNear),_.update(this.traceRenderable.values.uFogColor,Le.toVec3Normalized(this.traceRenderable.values.uFogColor.ref.value,u.props.backgroundColor)),this.traceRenderable.values.dOrthographic.ref.value!==S&&(_.update(this.traceRenderable.values.dOrthographic,S),R=!0),_.update(this.traceRenderable.values.uLightDirection,u.light.direction),_.update(this.traceRenderable.values.uLightColor,u.light.color),this.traceRenderable.values.dLightCount.ref.value!==u.light.count&&(_.update(this.traceRenderable.values.dLightCount,u.light.count),R=!0),_.update(this.traceRenderable.values.uAmbientColor,P),_.update(this.traceRenderable.values.uLightStrength,T),this.traceRenderable.values.dGlow.ref.value!==n.glow&&(_.update(this.traceRenderable.values.dGlow,n.glow),R=!0),this.traceRenderable.values.dBounces.ref.value!==n.bounces&&(_.update(this.traceRenderable.values.dBounces,n.bounces),R=!0),this.traceRenderable.values.dSteps.ref.value!==l&&(_.update(this.traceRenderable.values.dSteps,l),R=!0),this.traceRenderable.values.dFirstStepSize.ref.value!==n.firstStepSize&&(_.update(this.traceRenderable.values.dFirstStepSize,n.firstStepSize),R=!0),this.traceRenderable.values.dRefineSteps.ref.value!==s&&(_.update(this.traceRenderable.values.dRefineSteps,s),R=!0),_.updateIfChanged(this.traceRenderable.values.uRayDistance,n.rayDistance),this.traceRenderable.values.dThicknessMode.ref.value!==n.thicknessMode&&(_.update(this.traceRenderable.values.dThicknessMode,n.thicknessMode),R=!0),_.updateIfChanged(this.traceRenderable.values.uMinThickness,n.minThickness),_.updateIfChanged(this.traceRenderable.values.uThicknessFactor,n.thicknessFactor),_.updateIfChanged(this.traceRenderable.values.uThickness,n.thickness),this.traceRenderable.values.dShadowEnable.ref.value!==n.shadowEnable&&(_.update(this.traceRenderable.values.dShadowEnable,n.shadowEnable),R=!0),_.updateIfChanged(this.traceRenderable.values.uShadowSoftness,n.shadowSoftness),_.updateIfChanged(this.traceRenderable.values.uShadowThickness,n.shadowThickness),R&&this.traceRenderable.update(),je&&this.webgl.timer.mark("TracePass.renderTrace"),this.traceRenderable.render(),je&&this.webgl.timer.markEnd("TracePass.renderTrace"),this.accumulateTarget.bind(),this.accumulateRenderable.render(),je&&this.webgl.timer.markEnd("TracePass.render")}},Vat={...Sn,tColor:yt("texture","rgba","ubyte","nearest"),tNormal:yt("texture","rgba","ubyte","nearest"),tShaded:yt("texture","rgba","ubyte","nearest"),tThickness:yt("texture","rgba","ubyte","nearest"),tAccumulate:yt("texture","rgba","ubyte","nearest"),tDepth:yt("texture","rgba","ubyte","nearest"),uTexSize:de("v2"),dOrthographic:dt("number"),uNear:de("f"),uFar:de("f"),uFogNear:de("f"),uFogFar:de("f"),uFogColor:de("v3"),uProjection:de("m4"),uInvProjection:de("m4"),uBounds:de("v4"),uLightDirection:de("v3[]"),uLightColor:de("v3[]"),dLightCount:dt("number"),uAmbientColor:de("v3"),uLightStrength:de("v3"),uFrameNo:de("i"),dRendersPerFrame:dt("number"),dGlow:dt("boolean"),dBounces:dt("number"),dSteps:dt("number"),dFirstStepSize:dt("number"),dRefineSteps:dt("number"),uRayDistance:de("f"),dThicknessMode:dt("string"),uMinThickness:de("f"),uThicknessFactor:de("f"),uThickness:de("f"),dShadowEnable:dt("boolean"),uShadowSoftness:de("f"),uShadowThickness:de("f")},Oat=zr("trace",Fn,tAe);function Gat(e,t,r,n,o,i,a){let s={...vn,tColor:_.create(t),tNormal:_.create(r),tShaded:_.create(n),tThickness:_.create(o),tAccumulate:_.create(i),tDepth:_.create(a),uTexSize:_.create(Ce.create(t.getWidth(),t.getHeight())),dOrthographic:_.create(0),uNear:_.create(1),uFar:_.create(1e4),uFogNear:_.create(1e4),uFogFar:_.create(1e4),uFogColor:_.create(b.create(1,1,1)),uProjection:_.create(H.identity()),uInvProjection:_.create(H.identity()),uBounds:_.create(Et()),uLightDirection:_.create([]),uLightColor:_.create([]),dLightCount:_.create(0),uAmbientColor:_.create(b()),uLightStrength:_.create(b.create(1,1,1)),uFrameNo:_.create(0),dRendersPerFrame:_.create(1),dGlow:_.create(!0),dBounces:_.create(4),dSteps:_.create(32),dFirstStepSize:_.create(.01),dRefineSteps:_.create(4),uRayDistance:_.create(256),dThicknessMode:_.create("auto"),uMinThickness:_.create(.5),uThicknessFactor:_.create(1),uThickness:_.create(4),dShadowEnable:_.create(!1),uShadowSoftness:_.create(.1),uShadowThickness:_.create(.1)},l={...Vat},u=on(e,"triangles",Oat,l,s);return an(u,s)}var Uat={...Sn,tColor:yt("texture","rgba","ubyte","nearest"),uTexSize:de("v2"),uWeight:de("f")},Nat=zr("accumulate",Fn,rAe);function zat(e,t){let r={...vn,tColor:_.create(t),uTexSize:_.create(Ce.create(t.getWidth(),t.getHeight())),uWeight:_.create(1)},n={...Uat},o=on(e,"triangles",Nat,n,r);return an(o,r)}var oAe=!1;function iAe(e){let{drawBuffers:t,textureFloat:r,colorBufferFloat:n,depthTexture:o}=e.extensions;if(!r||!n||!o||!t){if(Yt&&!oAe){let i=[];r||i.push("textureFloat"),n||i.push("colorBufferFloat"),o||i.push("depthTexture"),t||i.push("drawBuffers"),console.log(`Missing "${i.join('", "')}" extensions required for "illumination"`),oAe=!0}return!1}else return!0}var ZL={enabled:C.Boolean(!1),maxIterations:C.Numeric(5,{min:0,max:16,step:1},{description:"Maximum number of tracing iterations. Final iteration count is 2^x."}),denoise:C.Boolean(!0),denoiseThreshold:C.Interval([.15,1],{min:0,max:4,step:.01},{description:"Threshold for denoising. Automatically adjusted within given interval based on current iteration."}),ignoreOutline:C.Boolean(!0,{description:"Ignore outline in illumination pass where it is generally not needed for visual clarity. Useful when illumination is often toggled on/off."}),...nAe},Pb=class e{constructor(t,r){this.webgl=t;this.drawPass=r;this._iteration=0;this._supported=!1;this.prevSampleIndex=-1;if(!e.isSupported(t))return;let{colorTarget:n}=r,o=n.getWidth(),i=n.getHeight();this.tracing=new QL(t,this.drawPass),this.transparentTarget=t.createRenderTarget(o,i,!1,"uint8","nearest"),this.outputTarget=t.createRenderTarget(o,i,!1,"uint8","linear"),this.copyRenderable=Gm(t,this.transparentTarget.texture),this.composeRenderable=Wat(t,this.tracing.accumulateTarget.texture,this.tracing.normalTextureOpaque,this.tracing.colorTextureOpaque,this.drawPass.depthTextureOpaque,this.drawPass.depthTargetTransparent.texture,this.drawPass.postprocessing.outline.target.texture,this.transparentTarget.texture,this.drawPass.postprocessing.ssao.ssaoDepthTexture,this.drawPass.postprocessing.ssao.ssaoDepthTransparentTexture,!1),this.multiSampleComposeTarget=t.createRenderTarget(o,i,!1,"float32"),this.multiSampleHoldTarget=t.createRenderTarget(o,i,!1),this.multiSampleAccumulateTarget=t.createRenderTarget(o,i,!1,"float32"),this.multiSampleCompose=Zat(t,this.outputTarget.texture),this._supported=!0}get iteration(){return this._iteration}get colorTarget(){return this._colorTarget}get supported(){return this._supported}getByteCount(){return this._supported?this.tracing.getByteCount()+this.transparentTarget.getByteCount()+this.outputTarget.getByteCount()+this.multiSampleComposeTarget.getByteCount()+this.multiSampleHoldTarget.getByteCount()+this.multiSampleAccumulateTarget.getByteCount():0}getMaxIterations(t){return Math.pow(2,t.maxIterations)}static isSupported(t){return iAe(t)}static isEnabled(t,r){return r.enabled&&iAe(t)}renderInput(t,r,n,o){je&&this.webgl.timer.mark("IlluminationPass.renderInput");let{gl:i,state:a}=this.webgl,s=Ug.isEnabled(o.marking),l=n.opacityAverage<1||n.volumes.renderables.length>0,u=s&&n.markerAverage>0;this.transparentTarget.bind(),a.clearColor(0,0,0,0),i.clear(i.COLOR_BUFFER_BIT);let c=ms.isTransparentOutlineEnabled(o.postprocessing)&&!o.illumination.ignoreOutline,m=Hp.isEnabled(o.postprocessing),d=ms.isTransparentSsaoEnabled(n,o.postprocessing);if((c||m||d)&&(this.drawPass.depthTargetTransparent.bind(),t.clearDepth(!0)),l){if(this.drawPass.transparency==="wboit")this.drawPass.wboit.bind(),t.renderWboitTransparent(n.primitives,r,this.drawPass.depthTextureOpaque),n.volumes.renderables.length>0&&t.renderWboitTransparent(n.volumes,r,this.drawPass.depthTextureOpaque),this.transparentTarget.bind(),this.drawPass.wboit.render();else if(this.drawPass.transparency==="dpoit"){let p=this.drawPass.dpoit.bind();t.renderDpoitTransparent(n.primitives,r,this.drawPass.depthTextureOpaque,p);for(let h=0,f=o.dpoitIterations;h<f;h++){je&&this.webgl.timer.mark("DpoitPass.layer");let g=this.drawPass.dpoit.bindDualDepthPeeling();t.renderDpoitTransparent(n.primitives,r,this.drawPass.depthTextureOpaque,g),f>1&&(this.transparentTarget.bind(),this.drawPass.dpoit.renderBlendBack()),je&&this.webgl.timer.markEnd("DpoitPass.layer")}this.transparentTarget.bind(),this.drawPass.dpoit.render(),n.volumes.renderables.length>0&&t.renderVolume(n.volumes,r,this.drawPass.depthTextureOpaque)}else this.transparentTarget.bind(),this.drawPass.depthTextureOpaque.attachFramebuffer(this.transparentTarget.framebuffer,"depth"),t.renderBlendedTransparent(n.primitives,r),this.drawPass.depthTextureOpaque.detachFramebuffer(this.transparentTarget.framebuffer,"depth"),n.volumes.renderables.length>0&&t.renderVolume(n.volumes,r,this.drawPass.depthTextureOpaque);(c||m||d)&&(this.drawPass.depthTargetTransparent.bind(),n.opacityAverage<1&&t.renderDepthTransparent(n.primitives,r,this.drawPass.depthTextureOpaque)),d&&(this.drawPass.postprocessing.ssao.update(r,n,o.postprocessing.occlusion.params,!0),this.drawPass.postprocessing.ssao.render(r))}if(u){let p=o.marking.ghostEdgeStrength<1;p&&n.markerAverage!==1&&(this.drawPass.marking.depthTarget.bind(),t.clear(!1,!0),t.renderMarkingDepth(n.primitives,r)),this.drawPass.marking.maskTarget.bind(),t.clear(!1,!0),t.renderMarkingMask(n.primitives,r,p?this.drawPass.marking.depthTarget.texture:null),this.drawPass.marking.update(o.marking),this.drawPass.marking.render(r.viewport,this.transparentTarget)}this.tracing.composeTarget.bind(),a.clearColor(0,0,0,0),i.clear(i.COLOR_BUFFER_BIT),je&&this.webgl.timer.markEnd("IlluminationPass.renderInput")}shouldRender(t){return this._supported&&t.enabled&&this._iteration<this.getMaxIterations(t)}setSize(t,r){if(!this._supported)return;let n=this.outputTarget.getWidth(),o=this.outputTarget.getHeight();(t!==n||r!==o)&&(this.tracing.setSize(t,r),this.transparentTarget.setSize(t,r),this.outputTarget.setSize(t,r),_.update(this.copyRenderable.values.uTexSize,Ce.set(this.copyRenderable.values.uTexSize.ref.value,t,r)),_.update(this.composeRenderable.values.uTexSize,Ce.set(this.composeRenderable.values.uTexSize.ref.value,t,r)),this.multiSampleComposeTarget.setSize(t,r),this.multiSampleHoldTarget.setSize(t,r),this.multiSampleAccumulateTarget.setSize(t,r),_.update(this.multiSampleCompose.values.uTexSize,Ce.set(this.multiSampleCompose.values.uTexSize.ref.value,t,r))),this.drawPass.setSize(t,r)}reset(){this._supported&&(this.tracing.reset(),this._iteration=0,this.prevSampleIndex=-1)}restart(t=!1){this._supported&&(this.tracing.restart(t),this._iteration=0,this.prevSampleIndex=-1)}renderInternal(t,r,n,o){if(!this.shouldRender(r.illumination))return;je&&this.webgl.timer.mark("IlluminationPass.render",{note:`iteration ${this._iteration+1} of ${this.getMaxIterations(r.illumination)}`}),this.tracing.render(t,r.transparentBackground,r.illumination,this._iteration,o);let{renderer:i,camera:a,scene:s,helper:l}=t,{gl:u,state:c}=this.webgl,{x:m,y:d,width:p,height:h}=a.viewport;(this._iteration===0||o)&&(i.setTransparentBackground(r.transparentBackground),i.setDrawingBufferSize(this.tracing.composeTarget.getWidth(),this.tracing.composeTarget.getHeight()),i.setPixelRatio(this.webgl.pixelRatio),i.setViewport(m,d,p,h),i.update(a,s),this.renderInput(i,a,s,r)),c.disable(u.BLEND),c.disable(u.DEPTH_TEST),c.disable(u.CULL_FACE),c.depthMask(!1),c.viewport(m,d,p,h),c.scissor(m,d,p,h);let f=a.state.mode==="orthographic"?1:0,g=Gg.isEnabled(r.postprocessing),y=Og.isEnabled(r.postprocessing)&&!r.illumination.ignoreOutline,x=ms.isTransparentSsaoEnabled(s,r.postprocessing),S=Ab.isEnabled(r.postprocessing),I=Hp.isEnabled(r.postprocessing),v=Ug.isEnabled(r.marking),A=s.opacityAverage<1||s.volumes.renderables.length>0,P=v&&s.markerAverage>0,T=!1;if(this.composeRenderable.values.dOutlineEnable.ref.value!==y&&(T=!0,_.update(this.composeRenderable.values.dOutlineEnable,y)),y&&r.postprocessing.outline.name==="on"){let{transparentOutline:B,outlineScale:k}=this.drawPass.postprocessing.outline.update(a,r.postprocessing.outline.params,this.drawPass.depthTargetTransparent.texture,this.drawPass.depthTextureOpaque);this.drawPass.postprocessing.outline.render(),_.update(this.composeRenderable.values.uOutlineColor,Le.toVec3Normalized(this.composeRenderable.values.uOutlineColor.ref.value,r.postprocessing.outline.params.color)),this.composeRenderable.values.dOutlineScale.ref.value!==k&&(T=!0,_.update(this.composeRenderable.values.dOutlineScale,k)),this.composeRenderable.values.dTransparentOutline.ref.value!==B&&(T=!0,_.update(this.composeRenderable.values.dTransparentOutline,B))}this.composeRenderable.values.dOcclusionEnable.ref.value!==x&&(T=!0,_.update(this.composeRenderable.values.dOcclusionEnable,x)),x&&r.postprocessing.occlusion.name==="on"&&_.update(this.composeRenderable.values.uOcclusionColor,Le.toVec3Normalized(this.composeRenderable.values.uOcclusionColor.ref.value,r.postprocessing.occlusion.params.color));let R=A||P;this.composeRenderable.values.dBlendTransparency.ref.value!==R&&(T=!0,_.update(this.composeRenderable.values.dBlendTransparency,R)),_.updateIfChanged(this.composeRenderable.values.uNear,a.near),_.updateIfChanged(this.composeRenderable.values.uFar,a.far),_.updateIfChanged(this.composeRenderable.values.uFogFar,a.fogFar),_.updateIfChanged(this.composeRenderable.values.uFogNear,a.fogNear),_.update(this.composeRenderable.values.uFogColor,Le.toVec3Normalized(this.composeRenderable.values.uFogColor.ref.value,i.props.backgroundColor)),this.composeRenderable.values.dOrthographic.ref.value!==f&&(_.update(this.composeRenderable.values.dOrthographic,f),T=!0),n&&!g&&!I?this.webgl.bindDrawingBuffer():this.tracing.composeTarget.bind(),this._colorTarget=this.tracing.composeTarget,this.drawPass.postprocessing.background.update(a,r.postprocessing.background),this.drawPass.postprocessing.background.clear(r.postprocessing.background,r.transparentBackground,i.props.backgroundColor),this.drawPass.postprocessing.background.render(r.postprocessing.background),_.updateIfChanged(this.composeRenderable.values.uTransparentBackground,r.transparentBackground||this.drawPass.postprocessing.background.isEnabled(r.postprocessing)),this.composeRenderable.values.dDenoise.ref.value!==r.illumination.denoise&&(_.update(this.composeRenderable.values.dDenoise,r.illumination.denoise),T=!0);let E=r.multiSample.mode==="on"?r.illumination.denoiseThreshold[0]:to(r.illumination.denoiseThreshold[1],r.illumination.denoiseThreshold[0],_r(this.iteration/(this.getMaxIterations(r.illumination)/2),0,1));_.updateIfChanged(this.composeRenderable.values.uDenoiseThreshold,E),T&&this.composeRenderable.update(),this.composeRenderable.render(),i.setDrawingBufferSize(this.tracing.composeTarget.getWidth(),this.tracing.composeTarget.getHeight()),i.setPixelRatio(this.webgl.pixelRatio),i.setViewport(m,d,p,h),i.update(a,s),l.debug.isEnabled&&(l.debug.syncVisibility(),i.renderBlended(l.debug.scene,a)),l.handle.isEnabled&&i.renderBlended(l.handle.scene,a),l.camera.isEnabled&&(l.camera.update(a),i.update(l.camera.camera,l.camera.scene),i.renderBlended(l.camera.scene,l.camera.camera));let M=!1,D=this.outputTarget;if(g){let B=n&&!I;this.drawPass.antialiasing.render(a,this.tracing.composeTarget.texture,B?!0:this.outputTarget,r.postprocessing),B?M=!0:(this._colorTarget=this.outputTarget,D=this.tracing.composeTarget)}if(S&&r.postprocessing.bloom.name==="on"){let B=n&&!I||M;this.drawPass.bloom.update(this.tracing.colorTextureOpaque,this.tracing.normalTextureOpaque,this.drawPass.depthTextureOpaque,r.postprocessing.bloom.params),this.drawPass.bloom.render(a.viewport,B?void 0:this._colorTarget)}if(I&&r.postprocessing.dof.name==="on"){let B=n||M;this.drawPass.dof.update(a,this._colorTarget.texture,this.drawPass.depthTextureOpaque,this.drawPass.depthTargetTransparent.texture,r.postprocessing.dof.params,s.boundingSphereVisible),this.drawPass.dof.render(a.viewport,B?void 0:D),B||(this._colorTarget=D)}this._iteration+=1,je&&this.webgl.timer.markEnd("IlluminationPass.render"),this.webgl.gl.flush()}renderMultiSample(t,r,n){let{camera:o}=t,{multiSampleCompose:i,multiSampleComposeTarget:a,multiSampleHoldTarget:s,webgl:l}=this,{gl:u,state:c}=l,m=KR[Math.max(0,Math.min(r.multiSample.sampleLevel,5))],d=this.getMaxIterations(r.illumination),p=Math.min(this._iteration,d),h=Math.floor(p/d*m.length);je&&l.timer.mark("IlluminationPass.renderMultiSample",{note:`sampleIndex ${h+1} of ${m.length}`});let{x:f,y:g,width:y,height:x}=o.viewport,S=1/d;if(p===0)this.renderInternal(t,r,!1,!0),_.update(i.values.uWeight,1),_.update(i.values.tColor,this._colorTarget.texture),i.update(),s.bind(),c.disable(u.BLEND),c.disable(u.DEPTH_TEST),c.depthMask(!1),c.viewport(f,g,y,x),c.scissor(f,g,y,x),i.render();else{o.viewOffset.enabled=!0,_.update(i.values.tColor,this._colorTarget.texture),_.update(i.values.uWeight,S),i.update();let v=m[h];ro.setViewOffset(o.viewOffset,y,x,v[0],v[1],y,x),o.update(),this.renderInternal(t,r,!1,this.prevSampleIndex!==h),a.bind(),c.enable(u.BLEND),c.blendEquationSeparate(u.FUNC_ADD,u.FUNC_ADD),c.blendFuncSeparate(u.ONE,u.ONE,u.ONE,u.ONE),c.disable(u.DEPTH_TEST),c.depthMask(!1),c.viewport(f,g,y,x),c.scissor(f,g,y,x),p===1&&(c.clearColor(0,0,0,0),u.clear(u.COLOR_BUFFER_BIT)),i.render()}this.prevSampleIndex=h,n?this.webgl.bindDrawingBuffer():this.multiSampleAccumulateTarget.bind(),c.viewport(f,g,y,x),c.scissor(f,g,y,x);let I=p*S;I>0&&(_.update(i.values.uWeight,1),_.update(i.values.tColor,a.texture),i.update(),c.disable(u.BLEND),i.render()),I<1&&(_.update(i.values.uWeight,1-I),_.update(i.values.tColor,s.texture),i.update(),I===0?c.disable(u.BLEND):c.enable(u.BLEND),i.render()),n||(c.disable(u.BLEND),this.colorTarget.bind(),this.copyRenderable.values.tColor.ref.value!==this.multiSampleAccumulateTarget.texture&&(_.update(this.copyRenderable.values.tColor,this.multiSampleAccumulateTarget.texture),this.copyRenderable.update()),this.copyRenderable.render()),o.viewOffset.enabled=!1,o.update(),je&&l.timer.markEnd("IlluminationPass.renderMultiSample")}render(t,r,n){this._supported&&(r.multiSample.mode==="on"?this.renderMultiSample(t,r,n):this.renderInternal(t,r,n,!1))}},Hat={...Sn,tColor:yt("texture","rgba","ubyte","nearest"),tNormal:yt("texture","rgba","ubyte","nearest"),tShaded:yt("texture","rgba","ubyte","nearest"),tTransparentColor:yt("texture","rgba","ubyte","nearest"),dBlendTransparency:dt("boolean"),tSsaoDepth:yt("texture","rgba","ubyte","nearest"),tSsaoDepthTransparent:yt("texture","rgba","ubyte","nearest"),tDepthOpaque:yt("texture","rgba","ubyte","nearest"),tDepthTransparent:yt("texture","rgba","ubyte","nearest"),tOutlines:yt("texture","rgba","ubyte","nearest"),uTexSize:de("v2"),dDenoise:dt("boolean"),uDenoiseThreshold:de("f"),dOrthographic:dt("number"),uNear:de("f"),uFar:de("f"),uFogNear:de("f"),uFogFar:de("f"),uFogColor:de("v3"),uOutlineColor:de("v3"),uOcclusionColor:de("v3"),uTransparentBackground:de("b"),dOcclusionEnable:dt("boolean"),dOutlineEnable:dt("boolean"),dOutlineScale:dt("number"),dTransparentOutline:dt("boolean")},jat=zr("compose",Fn,eAe);function Wat(e,t,r,n,o,i,a,s,l,u,c){let m={...vn,tColor:_.create(t),tNormal:_.create(r),tShaded:_.create(n),tTransparentColor:_.create(s),dBlendTransparency:_.create(!0),tSsaoDepth:_.create(l),tSsaoDepthTransparent:_.create(u),tDepthOpaque:_.create(o),tDepthTransparent:_.create(i),tOutlines:_.create(a),uTexSize:_.create(Ce.create(t.getWidth(),t.getHeight())),dDenoise:_.create(!0),uDenoiseThreshold:_.create(.1),dOrthographic:_.create(0),uNear:_.create(1),uFar:_.create(1e4),uFogNear:_.create(1e4),uFogFar:_.create(1e4),uFogColor:_.create(b.create(1,1,1)),uOutlineColor:_.create(b.create(0,0,0)),uOcclusionColor:_.create(b.create(0,0,0)),uTransparentBackground:_.create(!1),dOcclusionEnable:_.create(!1),dOutlineEnable:_.create(!1),dOutlineScale:_.create(1),dTransparentOutline:_.create(c)},d={...Hat},p=on(e,"triangles",jat,d,m);return an(p,m)}var Xat={...Sn,tColor:yt("texture","rgba","ubyte","nearest"),uTexSize:de("v2"),uWeight:de("f")},Qat=zr("compose",Fn,OL);function Zat(e,t){let r={...vn,tColor:_.create(t),uTexSize:_.create(Ce.create(t.getWidth(),t.getHeight())),uWeight:_.create(1)},n={...Xat},o=on(e,"triangles",Qat,n,r);return an(o,r)}var aT=class e{constructor(t,r){this.webgl=t;this.scene=r;this.required=[]}static ensureRequired(t,r,n){let o=new e(t,r);o.updateRequired(n),o.finalizeRequired(!0)}updateRequired(t){this.required.length=0,this.required.push("color"),Pb.isEnabled(this.webgl,t.illumination)&&this.required.push("tracing"),Ug.isEnabled(t.marking)&&this.scene.markerAverage>0&&this.required.push("marking"),Ab.isEnabled(t.postprocessing)&&this.scene.emissiveAverage>0&&this.required.push("emissive"),(ms.isTransparentDepthRequired(this.scene,t.postprocessing)||!this.webgl.extensions.drawBuffers||!this.webgl.extensions.depthTexture||Pb.isEnabled(this.webgl,t.illumination))&&this.required.push("depth"),this.webgl.resources.linkPrograms(this.required)}finalizeRequired(t){return this.finalize(this.required,t)}finalize(t,r){return this.webgl.resources.finalizePrograms(t,r)}};var qat={transparentBackground:C.Boolean(!1),dpoitIterations:C.Numeric(2,{min:1,max:10,step:1}),multiSample:C.Group(GL),postprocessing:C.Group(eT),marking:C.Group(WL),illumination:C.Group(ZL),cameraHelper:C.Group(UC),renderer:C.Group(KA)},qL=class{constructor(t,r,n,o,i,a,s){this.webgl=t;this.renderer=n;this.scene=o;this.camera=i;this._width=0;this._height=0;this._camera=new ro;this.props={...C.getDefaultValues(qat),...s},this.drawPass=new oT(t,r,128,128,o.transparency),this.illuminationPass=new Pb(t,this.drawPass),this.multiSamplePass=new Tb(t,this.drawPass),this.multiSampleHelper=new tT(this.multiSamplePass),this.helper={camera:new iT(t,this.props.cameraHelper),debug:a.debug,handle:a.handle,pointer:a.pointer},this.setSize(1024,768)}get colorTarget(){return this._colorTarget}get width(){return this._width}get height(){return this._height}getByteCount(){return this.drawPass.getByteCount()+this.illuminationPass.getByteCount()+this.multiSamplePass.getByteCount()}updateBackground(){return new Promise(t=>{this.drawPass.postprocessing.background.update(this.camera,this.props.postprocessing.background,()=>{t()})})}setSize(t,r){t===this._width&&r===this._height||(this._width=t,this._height=r,this.drawPass.setSize(t,r),this.illuminationPass.setSize(t,r),this.multiSamplePass.syncSize())}setProps(t={}){Object.assign(this.props,t),t.cameraHelper&&this.helper.camera.setProps(t.cameraHelper)}async render(t){this.drawPass.setTransparency(this.scene.transparency),aT.ensureRequired(this.webgl,this.scene,this.props),ro.copySnapshot(this._camera.state,this.camera.state),lo.set(this._camera.viewport,0,0,this._width,this._height),this._camera.update();let r={renderer:this.renderer,camera:this._camera,scene:this.scene,helper:this.helper};if(this.illuminationPass.supported&&this.props.illumination.enabled){for(await t.update({message:"Tracing...",current:1,max:this.illuminationPass.getMaxIterations(this.props.illumination)}),this.illuminationPass.restart(!0);this.illuminationPass.shouldRender(this.props.illumination);)je&&this.webgl.timer.mark("ImagePass.render",{captureStats:!0}),this.illuminationPass.render(r,this.props,!1),je&&this.webgl.timer.markEnd("ImagePass.render"),t.shouldUpdate&&await t.update({current:this.illuminationPass.iteration}),await this.webgl.waitForGpuCommandsComplete();this._colorTarget=this.illuminationPass.colorTarget}else je&&this.webgl.timer.mark("ImagePass.render",{captureStats:!0}),Tb.isEnabled(this.props.multiSample)?(this.multiSampleHelper.render(r,this.props,!1),this._colorTarget=this.multiSamplePass.colorTarget):(this.drawPass.render(r,this.props,!1),this._colorTarget=this.drawPass.getColorTarget(this.props.postprocessing)),je&&this.webgl.timer.markEnd("ImagePass.render");if(je){let n=this.webgl.timer.resolve();if(n)for(let o of n)lR([o])}Yt&&console.log(`image pass byte count ${(this.getByteCount()/1024/1024).toFixed(3)} MiB`)}async getImageData(t,r,n,o){this.setSize(r,n),await this.render(t),this.colorTarget.bind();let i=o?.width??r,a=o?.height??n,s=new Uint8Array(i*a*4);o?this.webgl.readPixels(o.x,n-o.y-o.height,i,a,s):this.webgl.readPixels(0,0,i,a,s);let l=JR.create(s,i,a);return JR.flipY(l),JR.divideByAlpha(l),new ImageData(new Uint8ClampedArray(s),i,a)}};var Yat={...ft.Params,alpha:{...ft.Params.alpha,defaultValue:1},ignoreLight:{...ft.Params.ignoreLight,defaultValue:!0},colorX:C.Color(Lt.red,{isEssential:!0}),colorY:C.Color(Lt.green,{isEssential:!0}),colorZ:C.Color(Lt.blue,{isEssential:!0}),scale:C.Numeric(.33,{min:.1,max:2,step:.1},{isEssential:!0})},KL={handle:C.MappedStatic("off",{on:C.Group(Yat),off:C.Group({})},{cycle:!0,description:"Show handle tool"})},YL=class{constructor(t,r={}){this.webgl=t;this.props={handle:{name:"off",params:{}}};this.pixelRatio=1;this._transform=H();this.eachGroup=(t,r)=>{if(!this.renderObject||!aAe(t))return!1;let n=!1,o=this.renderObject.values.uGroupCount.ref.value,{elements:i}=t;for(let{groupId:a,instanceId:s}of i){let l=s*o+a;r(ye.ofSingleton(l))&&(n=!0)}return n};this.scene=ih.create(t,"blended"),this.setProps(r)}getBoundingSphere(t,r){return this.renderObject&&(he.copy(t,this.renderObject.values.invariantBoundingSphere.ref.value),H.fromArray(this._transform,this.renderObject.values.aTransform.ref.value,r*16),he.transform(t,t,this._transform)),t}setProps(t){this.props=Pl(this.props,r=>{if(t.handle!==void 0&&(r.handle.name=t.handle.name,t.handle.name==="on")){this.scene.clear(),this.pixelRatio=this.webgl.pixelRatio;let n={...t.handle.params,scale:t.handle.params.scale*this.webgl.pixelRatio,cellSize:0};this.renderObject=est(n),this.scene.add(this.renderObject),this.scene.commit(),r.handle.params={...t.handle.params}}})}get isEnabled(){return this.props.handle.name==="on"}update(t,r,n){this.renderObject&&(this.pixelRatio!==this.webgl.pixelRatio&&this.setProps(this.props),H.setTranslation(this.renderObject.values.aTransform.ref.value,r),H.fromMat3(this.renderObject.values.aTransform.ref.value,n),_.update(this.renderObject.values.aTransform,this.renderObject.values.aTransform.ref.value),this.scene.update([this.renderObject],!0))}getLoci(t){let{objectId:r,groupId:n,instanceId:o}=t;return!this.renderObject||r!==this.renderObject.id?vr:Jat(this,n,o)}mark(t,r){return!ii.is(ii.Highlighting,r)||!xa(t)&&(!aAe(t)||t.data!==this)?!1:qr.mark(this.renderObject,t,r,this.eachGroup)}};function Kat(e,t){let r=tt.createState(512,256,t),n=.05*e,o=b.scale(b(),b.unitX,e),i=b.scale(b(),b.unitY,e),a=b.scale(b(),b.unitZ,e),s={radiusTop:n,radiusBottom:n,radialSegments:32};return r.currentGroup=d1.TranslateScreenXY,Zr(r,b.origin,n*3,2),r.currentGroup=d1.TranslateObjectX,Zr(r,o,n,2),gn(r,b.origin,o,1,s),r.currentGroup=d1.TranslateObjectY,Zr(r,i,n,2),gn(r,b.origin,i,1,s),r.currentGroup=d1.TranslateObjectZ,Zr(r,a,n,2),gn(r,b.origin,a,1,s),tt.getMesh(r)}var d1={None:0,TranslateScreenXY:1,TranslateObjectX:3,TranslateObjectY:4,TranslateObjectZ:5};function Jat(e,t,r){return _C("handle",e,[{groupId:t,instanceId:r}],n=>e.getBoundingSphere(n,r),()=>`Handle Helper | Group Id ${t} | Instance Id ${r}`)}function aAe(e){return e.kind==="data-loci"&&e.tag==="handle"}function $at(e,t){let r=10*e.scale,n=Kat(r,t?.geometry);n.setBoundingSphere(he.create(b.create(r/2,r/2,r/2),r+r/4));let o=i=>{switch(i){case d1.TranslateObjectX:return e.colorX;case d1.TranslateObjectY:return e.colorY;case d1.TranslateObjectZ:return e.colorZ;default:return Lt.grey}};return Wr.create("handle",{},n,o,()=>1,()=>"")}function est(e){let t=$at(e);return Wr.createRenderObject(t,e)}var $R={...ft.Params,enabled:C.Select("off",C.arrayToOptions(["on","off"]),{isEssential:!0}),ignoreLight:{...ft.Params.ignoreLight,defaultValue:!0},color:C.Color(Lt.grey,{isEssential:!0}),hitColor:C.Color(Lt.pink,{isEssential:!0})},JL=class{constructor(t,r={}){this.pixelScale=1;this.modelScale=1;this.pointers=[];this.points=[];this.hit=void 0;this.scene=ih.create(t,"blended"),this.props={...C.getDefaultValues($R),...r},this.camera=new ro,this.shape=sAe(this.getData(),this.props,this.shape),this.renderObject=nst(this.shape,this.props),this.scene.add(this.renderObject)}setProps(t){Object.assign(this.props,t),this.isEnabled&&this.update(this.pointers,this.points,this.hit)}ensureEnabled(){this.props.enabled!=="on"&&(this.props.enabled="on")}get isEnabled(){return this.props.enabled==="on"}setCamera(t){ro.copySnapshot(this.camera.state,t.state),lo.copy(this.camera.viewport,t.viewport),H.copy(this.camera.view,t.view),H.copy(this.camera.projection,t.projection),H.copy(this.camera.projectionView,t.projectionView),H.copy(this.camera.headRotation,t.headRotation),ro.copyViewOffset(this.camera.viewOffset,t.viewOffset),this.camera.far=t.far,this.camera.near=t.near,this.camera.fogFar=t.fogFar,this.camera.fogNear=t.fogNear,this.camera.forceFull=t.forceFull,this.camera.scale=1,this.modelScale=t.scale}update(t,r,n){if(this.pointers=t,this.points=r,this.hit=n,this.props.enabled!=="on"){this.renderObject&&(this.renderObject.state.visible=!1);return}this.shape=sAe(this.getData(),this.props,this.shape),_.updateIfChanged(this.renderObject.values.drawCount,ba.getDrawCount(this.shape.geometry)),_.updateIfChanged(this.renderObject.values.uVertexCount,ba.getVertexCount(this.shape.geometry)),_.updateIfChanged(this.renderObject.values.uGroupCount,2),ft.Utils.updateBoundingSphere(this.renderObject.values,this.shape.geometry),ft.Utils.updateValues(this.renderObject.values,this.props),ft.Utils.updateRenderableState(this.renderObject.state,this.props),this.renderObject.state.visible=!0,this.scene.update(void 0,!1),this.scene.commit()}getData(){return{pointers:this.pointers,points:this.points,hit:this.hit,modelScale:this.modelScale,camera:this.camera,pixels:12}}};var tst=b();function LX(e,t,r,n){let o=b.scale(tst,r.state.position,n),i=b.distance(e,o);return 2*Math.tan(r.state.fov/2)*i/r.viewport.height*t}function rst(e,t){let r=tt.createState(512,256,t),n=5e-4,o={radiusTop:n,radiusBottom:n,radialSegments:32},{modelScale:i,camera:a,pixels:s}=e;r.currentGroup=0;for(let l of e.pointers){ACe(r,l,.2,o);let u=LX(l.origin,s,a,i);Zr(r,l.origin,u,1)}for(let l of e.points){let u=LX(l,s,a,i);Zr(r,l,u,1)}if(e.hit){r.currentGroup=1;let l=LX(e.hit,s,a,i);Zr(r,e.hit,l,1)}return tt.getMesh(r)}function sAe(e,t,r){let n=rst(e,r?.geometry),o=i=>i===1?t.hitColor:t.color;return Wr.create("pointer-mesh",e,n,o,()=>1,()=>"",void 0,2)}function nst(e,t){return Wr.createRenderObject(e,{...C.getDefaultValues(ft.Params),...t,ignoreLight:t.ignoreLight,cellSize:0})}var ost={debug:C.Group(qR),camera:C.Group({helper:C.Group(UC)}),handle:C.Group(KL),pointer:C.Group($R)},ist=C.getDefaultValues(ost),$L=class{constructor(t,r,n={}){let o={...ist,...n};this.debug=new TL(t,r,o.debug),this.camera=new iT(t,o.camera.helper),this.handle=new YL(t,o.handle),this.pointer=new JL(t,o.pointer)}};var eV=class{constructor(t,r,n={}){this.webgl=t;let o=this.webgl.getDrawingBufferSize();this.draw=new oT(t,r,o.width,o.height,n.transparency||"blended"),this.pick=new rT(t,o.width,o.height,n.pickScale||.25),this.multiSample=new Tb(t,this.draw),this.illumination=new Pb(t,this.draw)}getByteCount(){return this.draw.getByteCount()+this.pick.getByteCount()+this.multiSample.getByteCount()+this.illumination.getByteCount()}setPickScale(t){this.pick.setPickScale(t)}setTransparency(t){this.draw.setTransparency(t)}updateSize(){let t=this.webgl.getDrawingBufferSize(),r=Math.max(t.width,2),n=Math.max(t.height,2);this.draw.setSize(r,n),this.pick.setSize(r,n),this.multiSample.syncSize(),this.illumination.setSize(r,n)}};var lAe=`
precision highp float;
precision highp sampler2D;

uniform sampler2D tPreviousLevel;
uniform vec2 uInvSize;
uniform vec2 uOffset;

void main(void) {
    vec2 position = gl_FragCoord.xy * uInvSize + uOffset;

    float x = texture(tPreviousLevel, position).r;
    float y = textureOffset(tPreviousLevel, position, ivec2(-1, 0)).r;
    float z = textureOffset(tPreviousLevel, position, ivec2(-1, -1)).r;
    float w = textureOffset(tPreviousLevel, position, ivec2(0, -1)).r;

    gl_FragColor = vec4(max(max(x, y), max(z, w)));
}
`;var ast={...Sn,tPreviousLevel:yt("texture","alpha","float","nearest"),uInvSize:de("v2"),uOffset:de("v2")},sst=zr("hi-z",Fn,lAe);function uAe(e,t){let r={...vn,tPreviousLevel:_.create(t),uInvSize:_.create(Ce()),uOffset:_.create(Ce())},n={...ast},o=on(e,"triangles",sst,n,r);return an(o,r)}var cAe=new ArrayBuffer(4),YYr=new Int32Array(cAe),KYr=new Float32Array(cAe);var mAe=new ArrayBuffer(4),lst=new Int32Array(mAe),ust=new Float32Array(mAe);function cst(e){let t=e<-126?-126:e;return lst[0]=(1<<23)*(t+126.94269504),ust[0]}function dAe(e){return cst(1.44269504*e)}var pAe=new ArrayBuffer(8),JYr=new Int32Array(pAe),$Yr=new Float32Array(pAe);var fAe=new ArrayBuffer(4),mst=new Int32Array(fAe),dst=new Float32Array(fAe);function hAe(e){return dst[0]=e,mst[0]*11920928955078125e-23-126.94269504}var eKr=Math.PI/2,tKr=2*Math.PI,rKr=1/(2*Math.PI),nKr=2/Math.PI,oKr=4/Math.PI,iKr=4/(Math.PI*Math.PI),aKr=Math.PI/2-2*Math.PI;var gAe=new ArrayBuffer(16),sKr=new Int32Array(gAe),lKr=new Float32Array(gAe);var yAe=new ArrayBuffer(8),uKr=new Int32Array(yAe),cKr=new Float32Array(yAe);var bAe=new ArrayBuffer(4),mKr=new Int32Array(bAe),dKr=new Float32Array(bAe);var pKr=Math.PI/4;var pst=b.transformMat4,xAe=Et.set,fst=hAe;function hst(e,t,r){return t*r/((r-t)*e-r)}function gst(e,t,r){return e*(t-r)-t}function tV(e,t,r,n){return n[11]===-1?hst(e,t,r):gst(e,t,r)}function yst(e,t,r,n){let o=t[0]*r,i=t[1]*r,a=t[2]*r,s=t[2]*t[2]-r*r,l=Math.sqrt(t[0]*t[0]+s),u=(l*t[0]-a)/(l*t[2]+o)*n[0],c=(l*t[0]+a)/(l*t[2]-o)*n[0],m=Math.sqrt(t[1]*t[1]+s),d=(m*t[1]-a)/(m*t[2]+i)*n[5],p=(m*t[1]+a)/(m*t[2]-i)*n[5];return xAe(e,c*-.5+.5,d*.5+.5,u*-.5+.5,p*.5+.5)}function bst(e,t,r,n){let o=n[0],i=n[5],a=(t[0]+r)*o,s=(t[0]-r)*o,l=(t[1]+r)*i,u=(t[1]-r)*i;return xAe(e,s*.5+.5,l*-.5+.5,a*.5+.5,u*-.5+.5)}function xst(e,t,r,n){return n[11]===-1?yst(e,t,r,n):bst(e,t,r,n)}var VX={enabled:C.Boolean(!1,{description:"Hierarchical Z-buffer occlusion culling. Only available for WebGL2."}),maxFrameLag:C.Numeric(10,{min:1,max:30,step:1},{description:"Maximum number of frames to wait for Z-buffer data."}),minLevel:C.Numeric(3,{min:1,max:10,step:1})},rV=class{constructor(t,r,n,o){this.webgl=t;this.drawPass=r;this.viewport=lo();this.near=0;this.far=0;this.view=H();this.projection=H();this.nextNear=0;this.nextFar=0;this.nextView=H();this.nextProjection=H();this.aabb=Et();this.vp=b();this.levelData=[];this.sync=null;this.buffer=new Float32Array(0);this.frameLag=0;this.ready=!1;this.isOccluded=t=>{if(!this.supported||!this.props.enabled||!this.ready)return!1;let{vp:r,r:n}=this.transform(t),{near:o,far:i,projection:a}=this,s=r[2]+n;if(-s<o)return!1;let{aabb:l,w:u,h:c,lod:m}=this.project(r,n);if(m>=this.levelData.length||m<this.props.minLevel)return!1;let{offset:d,size:p}=this.levelData[m],h=l[0]+u/2,f=l[1]+c/2,g=p[0],y=h*g,x=f*g,S=Math.floor(y),I=Math.ceil(x),v=this.tex.getWidth();if(S+1>=g||I+1>=g)return!1;let A=(g-I-1)*v+S+d;if(s>tV(this.buffer[A],o,i,a)||s>tV(this.buffer[A+1],o,i,a))return!1;let P=(g-I+1-1)*v+S+d;return!(s>tV(this.buffer[P],o,i,a)||s>tV(this.buffer[P+1],o,i,a))};this.props={...C.getDefaultValues(VX),...o};let{gl:i,extensions:a}=t;if(!Ht(i)||!a.colorBufferFloat){Yt&&console.log('Missing webgl2 and/or colorBufferFloat support required for "Hi-Z"'),this.supported=!1;return}this.fb=t.resources.framebuffer(),this.tex=t.resources.texture("image-float32","alpha","float","nearest"),this.tex.attachFramebuffer(this.fb,0);let s=i.getParameter(i.IMPLEMENTATION_COLOR_READ_FORMAT),l=i.getParameter(i.IMPLEMENTATION_COLOR_READ_TYPE);if(s!==i.RED||l!==i.FLOAT){Yt&&console.log('Missing red/float reading support required for "Hi-Z"'),this.supported=!1;return}this.supported=!0,this.buf=t.resources.pixelPack("alpha","float"),this.renderable=uAe(t,this.drawPass.depthTextureOpaque),Yt&&n&&this.initDebug(n)}getByteCount(){return this.supported?this.tex.getByteCount()+this.buf.getByteCount()+this.levelData.reduce((t,r)=>t+r.texture.getByteCount(),0):0}clear(){if(!this.supported)return;let{gl:t}=this.webgl;Ht(t)&&(this.sync!==null&&(t.deleteSync(this.sync),this.sync=null),this.frameLag=0,this.ready=!1,this.debug&&(this.debug.rect.style.display="none",this.debug.container.style.display="none"))}render(t){if(!this.supported||!this.props.enabled)return;let{gl:r,state:n}=this.webgl;if(!Ht(r)||this.sync!==null)return;this.nextNear=t.near,this.nextFar=t.far,H.copy(this.nextView,t.view),H.copy(this.nextProjection,t.projection),je&&this.webgl.timer.mark("hi-Z"),n.disable(r.CULL_FACE),n.disable(r.BLEND),n.disable(r.DEPTH_TEST),n.disable(r.SCISSOR_TEST),n.depthMask(!1),n.colorMask(!0,!0,!0,!0),n.clearColor(0,0,0,0);let o=this.renderable.values,i=Math.pow(2,Math.ceil(Math.log(Math.max(r.drawingBufferWidth,r.drawingBufferHeight))/Math.log(2))-1);for(let l=0,u=this.levelData.length;l<u;++l){let c=this.levelData[l];c.framebuffer.bind(),l>0?(_.update(o.uInvSize,c.invSize),_.update(o.uOffset,Ce.set(o.uOffset.ref.value,0,0)),_.update(o.tPreviousLevel,this.levelData[l-1].texture)):(_.update(o.uInvSize,Ce.set(o.uInvSize.ref.value,1/i,1/i)),_.update(o.uOffset,Ce.set(o.uOffset.ref.value,this.viewport.x/r.drawingBufferWidth,this.viewport.y/r.drawingBufferHeight)),_.update(o.tPreviousLevel,this.drawPass.depthTextureOpaque)),n.currentRenderItemId=-1,n.viewport(0,0,c.size[0],c.size[1]),r.clear(r.COLOR_BUFFER_BIT),this.renderable.update(),this.renderable.render(),l>=this.props.minLevel&&(this.tex.bind(0),r.copyTexSubImage2D(r.TEXTURE_2D,0,c.offset,0,0,0,c.size[0],c.size[1]),this.tex.unbind(0))}this.tex.attachFramebuffer(this.fb,0);let a=this.tex.getWidth(),s=this.tex.getHeight();this.buf.read(0,0,a,s),this.sync=r.fenceSync(r.SYNC_GPU_COMMANDS_COMPLETE,0),r.flush(),je&&this.webgl.timer.markEnd("hi-Z")}tick(){if(!this.supported||!this.props.enabled||this.sync===null)return;let{gl:t}=this.webgl;if(!Ht(t))return;let r=t.clientWaitSync(this.sync,0,0);r===t.WAIT_FAILED||this.frameLag>=this.props.maxFrameLag?(t.deleteSync(this.sync),this.sync=null,this.frameLag=0,this.ready=!1):r===t.TIMEOUT_EXPIRED?this.frameLag+=1:(this.buf.getSubData(this.buffer),t.deleteSync(this.sync),this.sync=null,this.frameLag=0,this.ready=!0,this.near=this.nextNear,this.far=this.nextFar,H.copy(this.view,this.nextView),H.copy(this.projection,this.nextProjection))}transform(t){let{view:r,vp:n}=this;pst(n,t.center,r);let o=t.radius*1.2+1.52;return{vp:n,r:o}}project(t,r){let{projection:n,aabb:o,viewport:i}=this;xst(o,t,r,n);let a=o[2]-o[0],s=o[3]-o[1],l=Math.max(a*i.width,s*i.height),u=Math.ceil(fst(l/2));return{aabb:o,w:a,h:s,pr:l,lod:u}}setViewport(t,r,n,o){if(!this.supported)return;n=Math.max(n,2),o=Math.max(o,2),lo.set(this.viewport,t,r,n,o);let i=Math.ceil(Math.log(Math.max(n,o))/Math.log(2));if(i===this.levelData.length)return;let{minLevel:a}=this.props;this.buffer=new Float32Array(Math.pow(2,i-a)*Math.pow(2,i-1-a)),this.tex.define(Math.pow(2,i-a),Math.pow(2,i-1-a));for(let l of this.levelData)l.framebuffer.destroy(),l.texture.destroy();this.levelData.length=0;for(let l=0;l<i;++l){let u=this.webgl.resources.framebuffer(),c=Math.pow(2,i-l-1),m=Ce.create(c,c),d=Ce.create(1/c,1/c),p=this.webgl.resources.texture("image-float32","alpha","float","nearest");p.define(c,c),p.attachFramebuffer(u,0),this.levelData.push({texture:p,framebuffer:u,size:m,invSize:d,offset:0})}let s=0;for(let l=0,u=i;l<u;++l){let c=this.levelData[l];l>=a&&(this.levelData[l].offset=s,s+=c.size[0])}this.clear()}setProps(t){if(this.supported)if(this.props.minLevel!==t.minLevel){Object.assign(this.props,t);let{x:r,y:n,width:o,height:i}=this.viewport;this.setViewport(r,n,o,i)}else Object.assign(this.props,t),this.props.enabled||this.clear()}initDebug(t){if(!t.parentElement)return;let r=document.createElement("div");Object.assign(r.style,{display:"block",position:"absolute",pointerEvents:"none"}),t.parentElement.appendChild(r);let n=document.createElement("canvas"),o=n.getContext("2d");if(!o)throw new Error("Could not create canvas 2d context");Object.assign(n.style,{width:"100%",height:"100%",imageRendering:"pixelated",position:"relative",pointerEvents:"none"}),r.appendChild(n);let i=document.createElement("div");Object.assign(i.style,{display:"none",position:"absolute",pointerEvents:"none"}),t.parentElement.appendChild(i),this.debug={container:r,canvas:n,ctx:o,rect:i}}canDebug(t){return this.supported&&this.props.enabled&&this.ready&&!!this.debug}showRect(t,r){if(!this.canDebug(this.debug))return;let{gl:{drawingBufferHeight:n},pixelRatio:o}=this.webgl,{viewport:{x:i,y:a,width:s,height:l}}=this,u=(t[0]*s+i)/o,c=(t[1]*l-a)/o,m=(t[2]*s+i)/o,d=(t[3]*l-a)/o,p=(n-l)/o;Object.assign(this.debug.rect.style,{border:r?"solid red":"solid green",display:"block",left:`${u}px`,top:`${c+p}px`,width:`${m-u}px`,height:`${d-c}px`})}showBuffer(t){if(!this.canDebug(this.debug))return;if(t>=this.levelData.length||t<this.props.minLevel){this.debug.container.style.display="none";return}let{offset:r,size:[n,o]}=this.levelData[t],i=this.tex.getWidth(),a=new Uint8ClampedArray(n*o*4);a.fill(255);for(let p=0;p<o;++p)for(let h=0;h<n;++h){let f=(o-p-1)*n+h,g=this.buffer[p*i+h+r]*255;a[f*4+0]=g,a[f*4+3]=255-g}let s=new ImageData(a,n,o);this.debug.canvas.width=s.width,this.debug.canvas.height=s.height,this.debug.ctx.putImageData(s,0,0);let{viewport:{x:l,y:u,width:c,height:m},webgl:{pixelRatio:d}}=this;Object.assign(this.debug.container.style,{display:"block",bottom:`${u/d}px`,left:`${l/d}px`,width:`${c/d}px`,height:`${m/d}px`})}debugOcclusion(t){if(!this.canDebug(this.debug))return;if(!t){this.debug.rect.style.display="none",this.debug.container.style.display="none";return}let r=this.isOccluded(t),{vp:n,r:o}=this.transform(t),{aabb:i,lod:a}=this.project(n,o);this.showRect(i,r),this.showBuffer(a)}reset(){this.sync=null,this.ready=!1,this.frameLag=0,this.levelData.length=0;let{x:t,y:r,width:n,height:o}=this.viewport;this.setViewport(t,r,n,o)}dispose(){if(this.supported){this.clear(),this.fb.destroy(),this.tex.destroy(),this.buf.destroy(),this.renderable.dispose();for(let t of this.levelData)t.framebuffer.destroy(),t.texture.destroy()}}};var Cst=Ai,Sst=Ct.Trigger,CAe=Ct.TriggerKey;function vst(e){let t=H.getDecomposition(e);return new XRRigidTransform(b.toObj(t.position),lr.toObj(t.quaternion))}function SAe(e,t){let r=b.fromObj(e.transform.position),n=H.fromArray(H(),e.transform.matrix,0),o=H.getDecomposition(n),i=H.fromQuat(H(),o.quaternion),a=b.transformMat4(b(),b.negUnitZ,i),s=Eu.create(r,a);return t&&Eu.transform(s,s,H.invert(H(),t)),s}var Ist={exit:Ct([CAe("GamepadB")]),togglePassthrough:Ct([CAe("GamepadA")]),gestureScale:Ct([Sst(Cst.Flag.Trigger)])},OX={bindings:Ist},GX={minTargetDistance:C.Numeric(.4,{min:.001,max:1,step:.001}),disablePostprocessing:C.Boolean(!0),resolutionScale:C.Numeric(1,{min:.1,max:2,step:.1}),sceneRadiusInMeters:C.Numeric(.25,{min:.01,max:2,step:.01},{description:"The radius of the scene bounding sphere in meters, used to set the initial camera scale."})},nV=class{constructor(t,r,n,o,i,a,s,l={},u={}){this.webgl=t;this.input=r;this.scene=n;this.camera=o;this.stereoCamera=i;this.pointerHelper=a;this.interactionHelper=s;this.togglePassthrough=new Pn;this.sessionChanged=new Pn;this.isSupported=new Di(!1);this.xrSession=void 0;this.xrRefSpace=void 0;this.scaleFactor=1;this.prevScale=0;this.prevInput={};this.hit=void 0;this.checkSupported=async()=>{if(!navigator.xr)return!1;let[t,r]=await Promise.all([navigator.xr.isSessionSupported("immersive-ar"),navigator.xr.isSessionSupported("immersive-vr")]);this.isSupported.next(t||r)};this.props={...C.getDefaultValues(GX),...l},this.attribs={...OX,...u},this.hoverSub=this.interactionHelper.events.hover.subscribe(({position:c})=>{this.hit=c}),this.sessionChangedSub=t.xr.changed.subscribe(async()=>{await this.setSession(t.xr.session),this.sessionChanged.next()}),this.checkSupported(),navigator.xr?.addEventListener("devicechange",this.checkSupported),this.keyUpSub=r.keyUp.subscribe(({code:c,modifiers:m,key:d})=>{let p=this.attribs.bindings;Ct.matchKey(p.exit,c,m,d)&&this.end(),Ct.matchKey(p.togglePassthrough,c,m,d)&&this.togglePassthrough.next()}),this.gestureSub=r.gesture.subscribe(({scale:c,button:m,modifiers:d})=>{let p=this.attribs.bindings;Ct.match(p.gestureScale,m,d)&&this.setScaleFactor(c)})}get session(){return this.xrSession}setProps(t){Object.assign(this.props,t)}setAttribs(t){Object.assign(this.attribs,t)}intersect(t,r,n,o){let i=b(),a=SAe(o,r);if(vo.intersectRay3D(i,n,a)){let{height:s}=t.viewport,l=xL(Et(),i,t.viewport,t.projectionView),u=Ce.create(Math.floor(l[0]),s-Math.floor(l[1]));return{point:i,screen:u}}}setScaleFactor(t){this.scaleFactor=t}resetScale(){this.scaleFactor=1,this.prevScale=0}update(t){let{xrSession:r,xrRefSpace:n,input:o,camera:i,stereoCamera:a,pointerHelper:s}=this;if(!t||!r||!n)return!1;i.scale=i.scale*this.scaleFactor,this.prevScale=i.scale;let l=b.sub(b(),i.position,i.target);b.scaleAndAdd(i.position,i.position,l,1-this.scaleFactor),this.scaleFactor=1;let u=vst(i.view),c=n.getOffsetReferenceSpace(u),m=t.getViewerPose(c);if(!m)return!1;let d=t.getViewerPose(n);if(d){let R=lr.fromObj(d.transform.orientation);H.fromQuat(i.headRotation,R)}let{depthFar:p,depthNear:h,baseLayer:f}=r.renderState;if(!f)return!1;(p!==i.far||h!==i.near)&&r.updateRenderState({depthNear:i.near,depthFar:i.far}),a.update({pose:m,layer:f});let g=a.left,y=b.scale(b(),g.state.target,g.scale),x=H.getTranslation(b(),H.invert(H(),g.view)),S=b.sub(b(),x,y),I=vo.fromNormalAndCoplanarPoint(vo(),S,y),v=[],A=[],P=[],T=[];if(r.inputSources)for(let R of r.inputSources){if(R.targetRayMode==="screen"){if(R.gamepad){let{axes:ce}=R.gamepad,{width:fe,height:O}=g.viewport,V=(ce[0]+1)/2*fe,Z=(ce[1]+1)/2*O,pe=g.getRay(Eu(),V,O-Z);T.push({x:V,y:Z,ray:pe})}continue}if(R.targetRayMode!=="tracked-pointer")continue;let{handedness:w,targetRaySpace:E,gamepad:M}=R;if(!w)continue;let D=t.getPose(E,n);if(!D)continue;let B=SAe(D,i.view);v.push(B);let k=he.scaleNX(he(),this.scene.boundingSphereVisible,g.scale),F=b();Eu.intersectSphere3D(F,B,k)&&A.push(F);let z=Ai.create(Ai.Flag.None);M?.buttons[0]?.pressed&&(z|=Ai.Flag.Primary),M?.buttons[1]?.pressed&&(z|=Ai.Flag.Secondary),M?.buttons[3]?.pressed&&(z|=Ai.Flag.Auxilary),M?.buttons[4]?.pressed&&(z|=Ai.Flag.Forth),M?.buttons[5]?.pressed&&(z|=Ai.Flag.Five);let j=w==="left"?this.prevInput.left:this.prevInput.right,Y=this.intersect(g,i.view,I,D),G=j?this.intersect(g,i.view,I,j.targetRayPose):void 0,[X,U]=Y?.screen??[0,0],[L,q]=G?.screen??[X,U],te=Ce.set(Ce(),X-L,U-q);Ce.setMagnitude(te,te,Math.min(100,Ce.magnitude(te)));let[J,ee]=Ce.round(te,te);P.push({handedness:w,buttons:z,x:X,y:U,dx:J,dy:ee,ray:B,axes:M?.axes}),w==="left"?this.prevInput.left={targetRayPose:D}:this.prevInput.right={targetRayPose:D}}else this.prevInput.left=void 0,this.prevInput.right=void 0;return o.updateTrackedPointers(P),o.updateScreenTouches(T),s.ensureEnabled(),s.update(v,A,this.hit),!0}async setSession(t){if(this.xrSession!==t)if(await this.webgl.xr.set(t,{resolutionScale:this.props.resolutionScale}),this.xrSession=this.webgl.xr.session,this.prevInput={},this.hit=void 0,this.xrSession){this.xrRefSpace=await this.xrSession.requestReferenceSpace("local"),this.pointerHelper.setProps({enabled:"on"});let r=this.prevScale;if(r===0){let{radius:n}=this.scene.boundingSphereVisible;r=n?1/n*this.props.sceneRadiusInMeters:.01}this.camera.forceFull=!0,this.camera.scale=r,this.camera.minTargetDistance=this.props.minTargetDistance,this.prevScale=r}else this.xrRefSpace=void 0,H.setZero(this.camera.headRotation),this.pointerHelper.setProps({enabled:"off"}),this.camera.forceFull=!1,this.camera.scale=1,this.camera.minTargetDistance=0}async end(){await this.webgl.xr.end()}async request(){if(!navigator.xr)return;let t=await navigator.xr.isSessionSupported("immersive-ar")?await navigator.xr.requestSession("immersive-ar"):await navigator.xr.requestSession("immersive-vr");await this.setSession(t)}dispose(){this.hoverSub.unsubscribe(),this.keyUpSub.unsubscribe(),this.gestureSub.unsubscribe(),this.sessionChangedSub.unsubscribe(),this.togglePassthrough.complete(),this.sessionChanged.complete(),this.isSupported.complete(),navigator.xr?.removeEventListener("devicechange",this.checkSupported)}};var oV=class{constructor(t,r,n,o,i){this.webgl=t;this.renderer=r;this.scene=n;this.helper=o;this.viewport=lo();this.sphere=he();let a=i.pickPadding*2+1;this.camera=new ro,this.pickPass=new rT(t,a,a,1),this.buffers=new nT(this.webgl,this.pickPass,i.maxAsyncReadLag),this.pickPadding=i.pickPadding,this.update(),UL(t)||(this.asyncIdentify=(s,l)=>({tryGet:()=>this.identify(s,l)}))}setPickPadding(t){this.pickPadding!==t&&(this.pickPadding=t,this.update())}update(){let t=this.pickPadding*2+1;lo.set(this.viewport,0,0,t,t),this.buffers.setViewport(0,0,t,t),this.spiral=sM(this.pickPadding),this.size=t,this.pickPass.setSize(t,t)}render(t){je&&this.webgl.timer.mark("RayHelper.render",{captureStats:!0});let{renderer:r,scene:n,helper:o}=this;r.setTransparentBackground(!1),r.setDrawingBufferSize(this.size,this.size),r.setPixelRatio(1),r.setViewport(0,0,this.size,this.size),this.pickPass.render(r,t,n,o),je&&this.webgl.timer.markEnd("RayHelper.render")}identifyInternal(t,r){if(this.webgl.isContextLost)return;let{viewport:n}=this,o=this.buffers.getPickingId(t,r);if(o===void 0)return;let i=this.buffers.getDepth(t,r),a=b.create(t,r,i);return Vg(a,a,n,this.camera.inverseProjectionView),{id:o,position:a}}prepare(t,r){this.camera.far=r.far,this.camera.near=r.near,this.camera.fogFar=r.fogFar,this.camera.fogNear=r.fogNear,this.camera.forceFull=r.forceFull,this.camera.scale=r.scale,lo.copy(this.camera.viewport,this.viewport),ro.copySnapshot(this.camera.state,{...r.state,mode:"orthographic"}),Ast(this.camera,t,r.up),H.mul(this.camera.projectionView,this.camera.projection,this.camera.view),H.tryInvert(this.camera.inverseProjectionView,this.camera.projectionView),H.copy(this.camera.viewEye,r.view)}getPickData(){let t=this.pickPadding;for(let r of this.spiral){let n=this.identifyInternal(t+r[0],t+r[1]);if(n)return n}}intersectsScene(t,r){return he.scaleNX(this.sphere,this.scene.boundingSphereVisible,r),Eu.isInsideSphere3D(t,this.sphere)||Eu.isIntersectingSphere3D(t,this.sphere)}identify(t,r){if(this.intersectsScene(t,r.scale))return this.prepare(t,r),je&&this.webgl.timer.mark("RayHelper.identify"),this.render(this.camera),this.buffers.read(),je&&this.webgl.timer.markEnd("RayHelper.identify"),this.getPickData()}asyncIdentify(t,r){if(this.intersectsScene(t,r.scale))return this.prepare(t,r),je&&this.webgl.timer.mark("RayHelper.asyncIdentify"),this.render(this.camera),this.buffers.asyncRead(),je&&this.webgl.timer.markEnd("RayHelper.asyncIdentify"),{tryGet:()=>{let n=this.buffers.check();if(n===1)return this.getPickData();if(n===0)return"pending"}}}reset(){this.buffers.reset(),this.pickPass.reset()}dispose(){this.buffers.dispose(),this.pickPass.dispose()}};function Ast(e,t,r){let{near:n,far:o,viewport:i}=e,a=2*Math.tan(kr(.1)/2)*b.distance(e.position,e.target)*e.scale,s=i.height/a,l=-i.width/2,u=i.width/2,c=i.height/2,m=-i.height/2,d=(u-l)/(2*s),p=(c-m)/(2*s),h=(u+l)/2,f=(c+m)/2,g=h-d,y=h+d,x=f+p,S=f-p;H.ortho(e.projection,g,y,x,S,n,o);let I=b.normalize(b(),t.direction),v=lr.fromUnitVec3(lr(),I,b.negUnitZ);lr.invert(v,v);let A=b.clone(t.origin),P=b.add(b(),A,I);H.lookAt(e.view,A,P,r)}var UX={intensity:C.Numeric(15,{min:1,max:100,step:1})},Na={camera:C.Group({mode:C.Select("perspective",C.arrayToOptions(["perspective","orthographic"]),{label:"Camera"}),helper:C.Group(UC,{isFlat:!0}),stereo:C.MappedStatic("off",{on:C.Group(FX),off:C.Group({})},{cycle:!0,hideIf:e=>e?.mode!=="perspective"}),fov:C.Numeric(45,{min:10,max:130,step:1},{label:"Field of View"}),manualReset:C.Boolean(!1,{isHidden:!0})},{pivot:"mode"}),cameraFog:C.MappedStatic("on",{on:C.Group(UX),off:C.Group({})},{cycle:!0,description:"Show fog in the distance"}),cameraClipping:C.Group({radius:C.Numeric(100,{min:0,max:99,step:1},{label:"Clipping",description:"How much of the scene to show."}),far:C.Boolean(!0,{description:"Hide scene in the distance"}),minNear:C.Numeric(1,{min:.1,max:100,step:.1},{description:"Minimal allowed distance of near clipping plane from the camera. Note, may cause performance issues rendering impostors when set too small and cause issues with outline rendering when too close to 0."})},{pivot:"radius"}),viewport:C.MappedStatic("canvas",{canvas:C.Group({}),"static-frame":C.Group({x:C.Numeric(0),y:C.Numeric(0),width:C.Numeric(128),height:C.Numeric(128)}),"relative-frame":C.Group({x:C.Numeric(.33,{min:0,max:1,step:.01}),y:C.Numeric(.33,{min:0,max:1,step:.01}),width:C.Numeric(.5,{min:.01,max:1,step:.01}),height:C.Numeric(.5,{min:.01,max:1,step:.01})})}),cameraResetDurationMs:C.Numeric(250,{min:0,max:1e3,step:1},{description:"The time it takes to reset the camera."}),sceneRadiusFactor:C.Numeric(1,{min:1,max:10,step:.1}),transparentBackground:C.Boolean(!1),checkeredTransparentBackground:C.Boolean(!1),dpoitIterations:C.Numeric(2,{min:1,max:10,step:1}),pickPadding:C.Numeric(3,{min:0,max:10,step:1},{description:"Extra pixels to around target to check in case target is empty."}),userInteractionReleaseMs:C.Numeric(250,{min:0,max:1e3,step:1},{description:"The time before the user is not considered interacting anymore."}),multiSample:C.Group(GL),postprocessing:C.Group(eT),marking:C.Group(WL),illumination:C.Group(ZL),hiZ:C.Group(VX),renderer:C.Group(KA),trackball:C.Group(QR),interaction:C.Group(MX),debug:C.Group(qR),handle:C.Group(KL),pointer:C.Group($R),xr:C.Group(GX,{label:"XR"})},Ud=C.getDefaultValues(Na),Tst={trackball:PX,xr:OX};var lh;(o=>{o.DefaultAttribs={powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,antialias:!0,preserveDrawingBuffer:!0,preferWebGl1:!1,handleResize:()=>{}},o.Params={resolutionMode:C.Select("auto",C.arrayToOptions(["auto","scaled","native"])),pixelScale:C.Numeric(1,{min:.1,max:2,step:.05}),pickScale:C.Numeric(.25,{min:.1,max:1,step:.05}),transparency:C.Select("wboit",[["blended","Blended"],["wboit","Weighted, Blended"],["dpoit","Depth Peeling"]])},o.DefaultProps=C.getDefaultValues(o.Params);function n(i,a,s={},l={}){let u={...o.DefaultAttribs,...s},c={...o.DefaultProps,...l},{powerPreference:m,failIfMajorPerformanceCaveat:d,antialias:p,preserveDrawingBuffer:h,preferWebGl1:f}=u,g=Dye(i,{powerPreference:m,failIfMajorPerformanceCaveat:d,antialias:p,preserveDrawingBuffer:h,alpha:!0,depth:!0,premultipliedAlpha:!0,preferWebGl1:f});if(g===null)throw new Error("Could not create a WebGL rendering context");let y=()=>{let D=c.pixelScale/(typeof window<"u"&&window?.devicePixelRatio||1);return c.resolutionMode==="auto"?LSe()?D:c.pixelScale:c.resolutionMode==="native"?c.pixelScale:D},x=()=>{let D=y();A.setPixelScale(D),P.setPixelScale(D)},{pickScale:S,transparency:I}=c,v=y(),A=SX.fromElement(i,{pixelScale:v,preventGestures:!0}),P=kye(g,{pixelScale:v}),T=new eV(P,a,{pickScale:S,transparency:I});if(Yt){let D=g.getExtension("WEBGL_lose_context");D&&i.addEventListener("mousedown",B=>{P.isContextLost||!B.shiftKey||!B.ctrlKey||!B.altKey||(Yt&&console.log("lose context"),D.loseContext(),setTimeout(()=>{P.isContextLost&&(Yt&&console.log("restore context"),D.restoreContext())},1e3))},!1)}let R=new Pn,w=D=>{P.setContextLost(),D.preventDefault(),Yt&&console.log("context lost"),R.next(En())},E=()=>{P.isContextLost&&(P.handleContextRestored(()=>{T.draw.reset(),T.pick.reset(),T.illumination.reset()}),Yt&&console.log("context restored"))};i.addEventListener("webglcontextlost",w,!1),i.addEventListener("webglcontextrestored",E,!1);let M=new Di(void 0);return{canvas:i,webgl:P,input:A,passes:T,attribs:u,get props(){return{...c}},contextLost:R,contextRestored:P.contextRestored,assetManager:a,changed:M,get pixelScale(){return y()},syncPixelScale:x,setProps:D=>{if(!D)return;let B=!1,k=!1;D.resolutionMode!==void 0&&D.resolutionMode!==c.resolutionMode&&(c.resolutionMode=D.resolutionMode,k=!0),D.pixelScale!==void 0&&D.pixelScale!==c.pixelScale&&(c.pixelScale=D.pixelScale,k=!0),k&&(x(),u.handleResize(),B=!0),D.pickScale!==void 0&&D.pickScale!==c.pickScale&&(c.pickScale=D.pickScale,T.setPickScale(D.pickScale),B=!0),D.transparency!==void 0&&D.transparency!==c.transparency&&(c.transparency=D.transparency,T.setTransparency(D.transparency),B=!0),B&&M.next(void 0)},dispose:D=>{A.dispose(),i.removeEventListener("webglcontextlost",w,!1),i.removeEventListener("webglcontextrestored",E,!1),P.destroy(D),R.complete(),M.complete()}}}o.fromCanvas=n})(lh||={});var Pst=typeof window<"u"?window.requestAnimationFrame:e=>setImmediate(()=>e(Date.now())),vAe=typeof window<"u"?window.cancelAnimationFrame:e=>clearImmediate(e);function IAe(e,t){t.transparentBackground&&t.checkeredTransparentBackground?Object.assign(e.style,{"background-image":"linear-gradient(45deg, lightgrey 25%, transparent 25%, transparent 75%, lightgrey 75%, lightgrey), linear-gradient(45deg, lightgrey 25%, transparent 25%, transparent 75%, lightgrey 75%, lightgrey)","background-size":"60px 60px","background-position":"0 0, 30px 30px"}):Object.assign(e.style,{"background-image":"","background-size":"","background-position":""})}var NX;(t=>{function e(r,n={},o={}){let{webgl:i,input:a,passes:s,assetManager:l,canvas:u,contextLost:c}=r,m={...Wo(Ud),...Wo(n)},d={...Wo(Tst),...Wo(o)},p=new Map,h=new Map,f=new Di(0),g=new Pn,y=En(),x=new Di(0),S=new Di(0),I=new Di(0),{contextRestored:v}=i,A=0,P=0,T=128,R=128,w=!1,E=0;IAe(u,m),Rt();let M=ih.create(i,s.draw.transparency,{dColorMarker:m.renderer.colorMarker,dLightCount:m.renderer.light?.length});function D(){return M.boundingSphere.radius*m.sceneRadiusFactor}let B=new ro({position:b.create(0,0,100),mode:m.camera.mode,fog:m.cameraFog.name==="on"?m.cameraFog.params.intensity:0,clipFar:m.cameraClipping.far,minNear:m.cameraClipping.minNear,fov:kr(m.camera.fov)},{x:A,y:P,width:T,height:R}),k=new sh(B,m.camera.stereo.params),F=_X.create(a,B,M,m.trackball,d.trackball),z=new $L(i,M,m),j=new rV(i,s.draw,u,m.hiZ),Y=TX.create(i,m.renderer);Y.setOcclusionTest(j.isOccluded);let G=new aT(i,M);G.updateRequired(m);let X={pickPadding:m.pickPadding,maxAsyncReadLag:WIe.maxAsyncReadLag},U=new zL(i,Y,M,z,s.pick,{x:A,y:P,width:T,height:R},X),L=new oV(i,Y,M,z,X),q=new PL(N,oe,le,a,B,F,m.interaction),te=new tT(s.multiSample);s.draw.postprocessing.background.update(B,m.postprocessing.background,Oe=>{Oe&&Xt()});let J=!1,ee,ce,fe=!1;function O(){return{transparency:r.props.transparency,transparentBackground:m.transparentBackground,hiZ:j.props.enabled,postprocessing:m.postprocessing.enabled,axes:Wo(z.camera.props.axes)}}let V=O();function Z(){Object.assign(V,O())}function pe(){m.postprocessing.enabled=V.postprocessing,m.transparentBackground=V.transparentBackground,r.setProps({transparency:V.transparency}),j.setProps({enabled:V.hiZ}),z.camera.setProps({axes:V.axes})}function $(){m.postprocessing.enabled=!ae.props.disablePostprocessing,r.setProps({transparency:"blended"}),j.setProps({enabled:!1}),z.camera.setProps({axes:{name:"off",params:{}}}),ae.session?.environmentBlendMode==="alpha-blend"&&(m.transparentBackground=ve)}let ae=new nV(i,a,M,B,k,z.pointer,q,m.xr,d.xr),Se={request:async()=>{try{await ae.request()}catch(Oe){console.error(Oe),Se.requestFailed.next(Oe)}},end:()=>ae.end(),isSupported:new Di(!1),isPresenting:new Di(!1),requestFailed:new Pn},ve=!1,K=[ae.isSupported.subscribe(Oe=>Se.isSupported.next(Oe)),ae.togglePassthrough.subscribe(()=>{ae.session?.environmentBlendMode==="alpha-blend"&&(ve=!m.transparentBackground)}),ae.sessionChanged.subscribe(()=>{be=null,fe=!0,ae.session?(Z(),ve=ae.session?.environmentBlendMode==="alpha-blend",$()):pe(),ao(),Se.isPresenting.next(!!ae.session)})],re=!0;function le(Oe){let ht=vr,Ye=Ut.Empty;if(Oe){let dr=z.camera.getLoci(Oe);if(dr!==vr)return{loci:dr,repr:Ye};ht=z.handle.getLoci(Oe),p.forEach((Xr,we)=>{let qt=we.getLoci(Oe);Oi(qt)||(Oi(ht)||console.warn("found another loci, this should not happen"),ht=qt,Ye=we)})}return{loci:ht,repr:Ye}}let ge=[];function Ee(Oe,ht){ge.push([Oe,ht])}function nt(){let Oe=!1;for(let[ht,Ye]of ge)Oe=at(ht,Ye)||Oe;return ge=[],Oe&&(M.update(void 0,!0),z.handle.scene.update(void 0,!0),z.camera.scene.update(void 0,!0),G.updateRequired(m),G.finalizeRequired(!0),g.next()),Oe}function at(Oe,ht){let{repr:Ye,loci:dr}=Oe,Xr=!1;return Ye?Xr=Ye.mark(dr,ht)||Xr:p.forEach((we,qt)=>{Xr=qt.mark(dr,ht)||Xr}),Xr=z.handle.mark(dr,ht)||Xr,Xr=z.camera.mark(dr,ht)||Xr,Xr}let be=null;function Re(Oe,ht){if(i.isContextLost||i.xr.session&&!ht)return!1;let Ye=!1;fe&&(Ie(!1),fe=!1,Ye=!0);let dr=i.getDrawingBufferSize();if(A>dr.width||A+T<0||P>dr.height||P+R<0)return!1;if(be!==null&&!ht)if(i.checkSyncStatus(be))be=null;else return!1;ht&&($(),m.transparentBackground=ve);let Xr=nt()&&(Y.props.colorMarker||m.marking.enabled),we=!1;F.update(E);let qt=B.update(),Cr=ae.update(ht);if(!Cr&&ht)return!1;let Rn=Oe||qt||Ye||w||Cr;if(w=!1,s.illumination.supported&&m.illumination.enabled&&!ht){if((Rn||Xr)&&(Y.setOcclusionTest(null),s.illumination.restart()),s.illumination.shouldRender(m.illumination)&&(!Ze&&M.count>0||s.illumination.iteration===0||m.userInteractionReleaseMs===0)){je&&i.timer.mark("Canvas3D.render",{captureStats:!0});let Ri={renderer:Y,camera:B,scene:M,helper:z};s.illumination.render(Ri,m,!0),je&&i.timer.markEnd("Canvas3D.render"),U.dirty=U.dirty||Rn,we=!0}}else{let Ri=te.update(Xr||Rn,m.multiSample)&&!ht;if(Rn||Ri||Xr){Y.setOcclusionTest(j.isOccluded);let Da=B;(m.camera.stereo.name==="on"||Cr)&&(Cr||k.update(),Da=k),je&&i.timer.mark("Canvas3D.render",{captureStats:!0});let zu={renderer:Y,camera:Da,scene:M,helper:z};if(Tb.isEnabled(m.multiSample)&&!ht){let Hu=m.multiSample.reduceFlicker&&!qt&&Xr&&!F.isAnimating;te.render(zu,m,!0,Hu)}else s.draw.render(zu,m,!0);j.render(B),je&&i.timer.markEnd("Canvas3D.render"),U.dirty=U.dirty||Rn,we=!0}}return we&&!ht&&(be=i.getFenceSync()),we}let Fe=!1,Ne=!1,ot=!1;function it(Oe){if(!(Ne||ot)){if(!G.finalizeRequired(Oe?.isSynchronous)){w=!0;return}Re(!!Oe?.force,Oe?.xrFrame)&&re&&x.next(En()-y)}}function Xt(){w=!0}let $r=0;function bt(Oe,ht){ot||i.xr.session&&!ht?.xrFrame||(E=Oe,Ve(ht?.isSynchronous),ht?.updateControls&&F.update(E),B.transition.tick(E),j.tick(),!ht?.manualDraw&&(it({isSynchronous:ht?.isSynchronous,xrFrame:ht?.xrFrame}),!B.transition.inTransition&&!i.isContextLost&&q.tick(E)))}let xr;function tn(Oe){return xr=Oe,i.xr.session?i.xr.session.requestAnimationFrame(Oe):Pst(Oe)}function pn(Oe){xr=void 0,i.xr.session?i.xr.session.cancelAnimationFrame(Oe):vAe(Oe)}function io(Oe,ht){bt(En(),{xrFrame:ht}),$r=tn(io)}function Hn(Oe){y=Oe,F.start(Oe)}function Zi(){Ne=!1,F.start(En()),$r===0&&io(0)}function mm(Oe=!1){Ne=Oe,$r!==0&&(pn($r),$r=0)}function ao(){Ne=!1,xr&&tn(xr)}function N(Oe){if(!i.isContextLost){if(G.finalize(["pick"],!0),"origin"in Oe)return L.identify(Oe,B);{let ht=m.camera.stereo.name==="on"?k:B;return U.identify(Oe[0],Oe[1],ht)}}}function oe(Oe){if(!i.isContextLost){if(G.finalize(["pick"],!0),"origin"in Oe)return L.asyncIdentify(Oe,B);{let ht=m.camera.stereo.name==="on"?k:B;return U.asyncIdentify(Oe[0],Oe[1],ht)}}}function Ve(Oe=!1){let ht=Ft(Oe);G.updateRequired(m),ht&&($e(),Fe&&(z.debug.isEnabled&&z.debug.update(),it({force:!0}),Fe=!1),S.next(En()))}function $e(){if(!J)return;Se.isPresenting.value||ae.resetScale();let Oe=M.boundingSphereVisible,{center:ht,radius:Ye}=Oe,dr=F.props.autoAdjustMinMaxDistance;if(dr.name==="on"){let Xr=dr.params.minDistanceFactor*Ye+dr.params.minDistancePadding,we=Math.max(dr.params.maxDistanceFactor*Ye,dr.params.maxDistanceMin);F.setProps({minDistance:Xr,maxDistance:we})}if(Ye>0){let Xr=ee===void 0?m.cameraResetDurationMs:ee,we=B.getFocus(ht,Ye),qt=typeof ce=="function"?ce(M,B):ce,Cr=qt?{...we,...qt}:we;B.setState({...Cr,radiusMax:D()},Xr)}ee=void 0,ce=void 0,J=!1}let ct=he(),vt=he();function Pt(){if(B.state.radiusMax===0)return!0;if(B.transition.inTransition||ce)return!1;let Oe=!0,ht=!0;he.set(vt,B.state.target,B.state.radius);for(let Ye of M.renderables){if(!Ye.state.visible)continue;let dr=Ye.values.boundingSphere.ref.value;if(!dr.radius)continue;ht=!1;let Xr=b.distance(vt.center,dr.center);if((Xr>vt.radius||Xr>dr.radius||dr.radius>B.state.radiusMax)&&!he.includes(ct,dr))return!0;he.overlaps(vt,dr)&&(Oe=!1)}return Oe||!ht&&vt.radius<=.1}let Ot=250;function Ft(Oe){return M.needsCommit?(he.copy(ct,M.boundingSphereVisible),j.clear(),M.commit(Oe?void 0:Ot)?(I.next(0),z.debug.isEnabled&&z.debug.update(),!m.camera.manualReset&&(f.value===0||Pt())&&(J=!0),ct.radius===0&&(ee=0),m.camera.manualReset||B.setState({radiusMax:D()},0),f.next(p.size),Yt&&Dt(),!0):(I.next(M.commitQueueSize),!1)):!0}function Dt(){let Oe=M.renderables.map(Cr=>({drawCount:Cr.values.drawCount.ref.value,instanceCount:Cr.values.instanceCount.ref.value,materialId:Cr.materialId,renderItemId:Cr.id,geometryType:Cr.values.dGeometryType.ref.value,"byteCount [MiB]":ame(Cr.getByteCount()/1024/1024,3)}));console.groupCollapsed(`${Oe.length} RenderItems`),Oe.length<=64?console.table(Oe):console.log(Oe),console.log(JSON.stringify(i.stats,void 0,4));let{texture:ht,cubeTexture:Ye,attribute:dr,elements:Xr,pixelPack:we,renderbuffer:qt}=i.resources.getByteCounts();console.log(JSON.stringify({texture:`${(ht/1024/1024).toFixed(3)} MiB`,cubeTexture:`${(Ye/1024/1024).toFixed(3)} MiB`,attribute:`${(dr/1024/1024).toFixed(3)} MiB`,elements:`${(Xr/1024/1024).toFixed(3)} MiB`,pixelPack:`${(we/1024/1024).toFixed(3)} MiB`,renderbuffer:`${(qt/1024/1024).toFixed(3)} MiB`},void 0,4)),console.log(JSON.stringify({renderables:`${(M.renderables.reduce((Cr,Rn)=>Cr+Rn.getByteCount(),0)/1024/1024).toFixed(3)} MiB`,passes:{draw:`${(s.draw.getByteCount()/1024/1024).toFixed(3)} MiB`,illumination:`${(s.illumination.getByteCount()/1024/1024).toFixed(3)} MiB`,pick:`${(s.pick.getByteCount()/1024/1024).toFixed(3)} MiB`,hiZ:`${(j.getByteCount()/1024/1024).toFixed(3)} MiB`}},void 0,4)),je&&console.log(JSON.stringify(i.timer.formatedStats(),void 0,4)),console.groupEnd()}function wt(Oe){Zt(Oe);let ht=p.get(Oe),Ye=new Set;Oe.renderObjects.forEach(dr=>Ye.add(dr)),ht?go.areEqual(Ye,ht)||(Ye.forEach(dr=>{ht.has(dr)||M.add(dr)}),ht.forEach(dr=>{Ye.has(dr)||M.remove(dr)})):Oe.renderObjects.forEach(dr=>M.add(dr)),p.set(Oe,Ye),M.update(Oe.renderObjects,!1),Fe=!0,Yt&&Dt()}function Nt(Oe){zt(Oe);let ht=p.get(Oe);ht&&(ht.forEach(Ye=>M.remove(Ye)),p.delete(Oe),Fe=!0,Yt&&Dt())}function Zt(Oe){h.has(Oe)||h.set(Oe,Oe.updated.subscribe(ht=>{Oe.state.syncManually||wt(Oe)}))}function zt(Oe){let ht=h.get(Oe);ht&&(ht.unsubscribe(),h.delete(Oe))}function hr(){let Oe=M.boundingSphere.radius>0?100-Math.round(B.transition.target.radius/D()*100):0;return{camera:{mode:B.state.mode,helper:{...z.camera.props},stereo:{...m.camera.stereo},fov:Math.round(Ya(B.state.fov)),manualReset:!!m.camera.manualReset},cameraFog:B.state.fog>0?{name:"on",params:{intensity:B.state.fog}}:{name:"off",params:{}},cameraClipping:{far:B.state.clipFar,radius:Oe,minNear:B.state.minNear},cameraResetDurationMs:m.cameraResetDurationMs,sceneRadiusFactor:m.sceneRadiusFactor,transparentBackground:m.transparentBackground,checkeredTransparentBackground:m.checkeredTransparentBackground,dpoitIterations:m.dpoitIterations,pickPadding:m.pickPadding,userInteractionReleaseMs:m.userInteractionReleaseMs,viewport:m.viewport,postprocessing:{...m.postprocessing},marking:{...m.marking},multiSample:{...m.multiSample},illumination:{...m.illumination},hiZ:{...j.props},renderer:{...Y.props},trackball:{...F.props},interaction:{...q.props},debug:{...z.debug.props},handle:{...z.handle.props},pointer:{...z.pointer.props},xr:{...ae.props}}}let ar=c?.subscribe(()=>{ot=!0,be=null,U.dirty=!0}),fr=v.subscribe(()=>{U.reset(),L.reset(),j.reset(),M.forEach(Oe=>{Oe.values.meta?.ref.value.reset&&(Oe.values.meta.ref.value.reset(),Oe.update())}),ot=!1,it({force:!0}),it({force:!0})}),me=new Di(0);function Ie(Oe=!0){s.updateSize(),Rt(),ir(),Oe&&Xt(),me.next(+new Date)}mle(Dt);let Pe=r.changed?.subscribe(()=>{M.setTransparency(s.draw.transparency),Xt()}),_e=!1,Ze=!1,ze=[a.drag.subscribe(()=>{_e=!0}),a.interactionEnd.subscribe(()=>{_e=!1}),fm(a.drag,a.pinch,a.wheel,a.interactionEnd).subscribe(()=>{g.next()}),g.subscribe(()=>{Ze=!0}),g.pipe(Zb(m.userInteractionReleaseMs)).subscribe(()=>{Ze=_e,!_e&&s.illumination.supported&&m.illumination.enabled&&Xt()})];if(Yt&&u){let Oe,ht=Ye=>{let dr=Ye&&nr.getBoundingSphere(nr.normalize(Ye,"residue"));j.debugOcclusion(dr)};a.click.subscribe(Ye=>{if(!Ye.modifiers.control||Ye.button!==2)return;let dr=N(Ce.create(Ye.x,Ye.y));if(!dr){Oe=void 0,ht(Oe);return}Oe=le(dr.id).loci,ht(Oe)}),x.subscribe(()=>{setTimeout(()=>{ht(Oe)},100)})}return{webgl:i,add:wt,remove:Nt,commit:Ve,update:(Oe,ht)=>{if(Oe){if(!p.has(Oe))return;M.update(Oe.renderObjects,!!ht)}else M.update(void 0,!!ht);Fe=!0},clear:()=>{h.forEach(Oe=>Oe.unsubscribe()),h.clear(),p.clear(),M.clear(),z.debug.clear(),be!==null&&(i.deleteSync(be),be=null),Xt(),f.next(p.size)},syncVisibility:()=>{B.state.radiusMax===0&&(J=!0,ee=0),M.syncVisibility()&&z.debug.isEnabled&&z.debug.update(),Xt()},requestDraw:Xt,tick:bt,animate:Zi,resetTime:Hn,pause:mm,resume:ao,requestAnimationFrame:tn,cancelAnimationFrame:pn,identify:N,asyncIdentify:oe,mark:Ee,getLoci:le,handleResize:Ie,requestResize:()=>{fe=!0},requestCameraReset:Oe=>{ee=Oe?.durationMs,ce=Oe?.snapshot,J=!0},camera:B,boundingSphere:M.boundingSphere,boundingSphereVisible:M.boundingSphereVisible,get notifyDidDraw(){return re},set notifyDidDraw(Oe){re=Oe},didDraw:x,commited:S,commitQueueSize:I,reprCount:f,resized:me,setProps:(Oe,ht=!1)=>{let Ye=typeof Oe=="function"?Pl(hr(),Oe):Oe;Ye.sceneRadiusFactor!==void 0&&(m.sceneRadiusFactor=Ye.sceneRadiusFactor,B.setState({radiusMax:D()},0));let dr=Object.create(null);Ye.camera&&Ye.camera.mode!==void 0&&Ye.camera.mode!==B.state.mode&&(dr.mode=Ye.camera.mode);let Xr=Math.round(Ya(B.state.fov));if(Ye.camera&&Ye.camera.fov!==void 0&&Ye.camera.fov!==Xr&&(dr.fov=kr(Ye.camera.fov)),Ye.cameraFog!==void 0&&Ye.cameraFog.params){let we=Ye.cameraFog.name==="on"?Ye.cameraFog.params.intensity:0;we!==B.state.fog&&(dr.fog=we)}if(Ye.cameraClipping!==void 0&&(Ye.cameraClipping.far!==void 0&&Ye.cameraClipping.far!==B.state.clipFar&&(dr.clipFar=Ye.cameraClipping.far),Ye.cameraClipping.minNear!==void 0&&Ye.cameraClipping.minNear!==B.state.minNear&&(dr.minNear=Ye.cameraClipping.minNear),Ye.cameraClipping.radius!==void 0)){let we=D()/100*(100-Ye.cameraClipping.radius);we>0&&we!==dr.radius&&(dr.radius=Math.max(we,.01))}Object.keys(dr).length>0&&B.setState(dr),Ye.camera?.helper&&z.camera.setProps(Ye.camera.helper),Ye.camera?.manualReset!==void 0&&(m.camera.manualReset=Ye.camera.manualReset),Ye.camera?.stereo!==void 0&&(Object.assign(m.camera.stereo,Ye.camera.stereo),k.setProps(m.camera.stereo.params)),Ye.cameraResetDurationMs!==void 0&&(m.cameraResetDurationMs=Ye.cameraResetDurationMs),Ye.transparentBackground!==void 0&&(m.transparentBackground=Ye.transparentBackground),Ye.checkeredTransparentBackground!==void 0&&(m.checkeredTransparentBackground=Ye.checkeredTransparentBackground),Ye.dpoitIterations!==void 0&&(m.dpoitIterations=Ye.dpoitIterations),Ye.pickPadding!==void 0&&(m.pickPadding=Ye.pickPadding,U.setPickPadding(m.pickPadding)),Ye.userInteractionReleaseMs!==void 0&&(m.userInteractionReleaseMs=Ye.userInteractionReleaseMs),Ye.viewport!==void 0&&(m.viewport===Ye.viewport||m.viewport.name===Ye.viewport.name&&Z0(m.viewport.params,Ye.viewport.params)||(m.viewport=Ye.viewport,Rt(),ir())),Ye.postprocessing?.background&&(Object.assign(m.postprocessing.background,Ye.postprocessing.background),s.draw.postprocessing.background.update(B,m.postprocessing.background,we=>{we&&!ht&&Xt()})),Ye.postprocessing&&Object.assign(m.postprocessing,Ye.postprocessing),Ye.marking&&Object.assign(m.marking,Ye.marking),Ye.illumination&&Object.assign(m.illumination,Ye.illumination),Ye.multiSample&&Object.assign(m.multiSample,Ye.multiSample),Ye.hiZ&&j.setProps(Ye.hiZ),Ye.renderer&&(M.setGlobals({dColorMarker:Ye.renderer.colorMarker??Y.props.colorMarker,dLightCount:Ye.renderer.light?.length??Y.props.light.length}),Y.setProps(Ye.renderer)),Ye.trackball&&F.setProps(Ye.trackball),Ye.interaction&&q.setProps(Ye.interaction),Ye.debug&&z.debug.setProps(Ye.debug),Ye.handle&&z.handle.setProps(Ye.handle),Ye.pointer&&z.pointer.setProps(Ye.pointer),Ye.xr&&ae.setProps(Ye.xr),dr.mode==="orthographic"&&(m.camera.stereo.name="off"),("transparentBackground"in Ye||"checkeredTransparentBackground"in Ye||Ye.renderer&&"backgroundColor"in Ye.renderer)&&IAe(u,m),G.updateRequired(m),ht||Xt()},setAttribs:Oe=>{Oe.trackball&&F.setAttribs(Oe.trackball),Oe.xr&&ae.setAttribs(Oe.xr)},getImagePass:(Oe={})=>new qL(i,l,Y,M,B,z,Oe),getRenderObjects(){let Oe=[];return M.forEach((ht,Ye)=>Oe.push(Ye)),Oe},get props(){return hr()},get attribs(){return{trackball:F.attribs,xr:ae.attribs}},get input(){return a},get stats(){return Y.stats},get interaction(){return q.events},xr:Se,dispose:()=>{ar?.unsubscribe(),fr.unsubscribe(),Pe?.unsubscribe();for(let Oe of K)Oe.unsubscribe();K.length=0;for(let Oe of ze)Oe.unsubscribe();ze.length=0,vAe($r),xr=void 0,ge=[],M.clear(),z.debug.clear(),F.dispose(),Y.dispose(),q.dispose(),j.dispose(),U.dispose(),L.dispose(),ae.dispose(),be!==null&&(i.deleteSync(be),be=null),f.complete(),g.complete(),x.complete(),me.complete(),S.complete(),I.complete(),Se.isPresenting.complete(),Se.isSupported.complete(),Se.requestFailed.complete(),dle(Dt)}};function Rt(){let Oe=A,ht=P,Ye=T,dr=R,Xr=i.getDrawingBufferSize();m.viewport.name==="canvas"?(A=0,P=0,T=Xr.width,R=Xr.height):m.viewport.name==="static-frame"?(A=m.viewport.params.x*i.pixelRatio,R=m.viewport.params.height*i.pixelRatio,P=Xr.height-R-m.viewport.params.y*i.pixelRatio,T=m.viewport.params.width*i.pixelRatio):m.viewport.name==="relative-frame"&&(A=Math.round(m.viewport.params.x*Xr.width),R=Math.round(m.viewport.params.height*Xr.height),P=Math.round(Xr.height-R-m.viewport.params.y*Xr.height),T=Math.round(m.viewport.params.width*Xr.width)),(Oe!==A||ht!==P||Ye!==T||dr!==R)&&(w=!0)}function ir(){U.setViewport(A,P,T,R),Y.setViewport(A,P,T,R),lo.set(B.viewport,A,P,T,R),lo.set(F.viewport,A,P,T,R),j.setViewport(A,P,T,R)}}t.create=e})(NX||={});var jX={};Gi(jX,{ApplyAction:()=>DAe,ClearHighlights:()=>kAe,Highlight:()=>EAe,RemoveObject:()=>wAe,SetCurrentObject:()=>_Ae,Snapshots:()=>FAe,SyncBehaviors:()=>PAe,ToggleExpanded:()=>MAe,ToggleVisibility:()=>BAe,Update:()=>RAe,registerDefault:()=>Rst,setSubtreeVisibility:()=>uh});function AAe(){let e=new Date,t=e.getFullYear(),r=e.getMonth()+1,n=e.getDate(),o=e.getHours(),i=e.getMinutes(),a=e.getSeconds();return t+"-"+r+"-"+n+"-"+o+"-"+i+"-"+a}function _st(e){window.open(e,"_blank")||(window.location.href=e)}function TAe(e){try{e.dispatchEvent(new MouseEvent("click"))}catch{let r=document.createEvent("MouseEvents");r.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(r)}}function sT(e,t="download"){if(e)if("download"in HTMLAnchorElement.prototype){let r=document.createElement("a");r.download=t,r.rel="noopener",typeof e=="string"?(r.href=e,TAe(r)):(r.href=URL.createObjectURL(e),setTimeout(()=>URL.revokeObjectURL(r.href),4e4),setTimeout(()=>TAe(r)))}else if(typeof navigator<"u"&&navigator.msSaveOrOpenBlob)navigator.msSaveOrOpenBlob(e,t);else{let r=window.navigator.userAgent,n=/Safari/i.test(r),o=/CriOS\/[\d]+/.test(r),i=a=>{_st(o?a:a.replace(/^data:[^;]*;/,"data:attachment/file;"))};if((n||o)&&FileReader)if(e instanceof Blob){let a=new FileReader;a.onloadend=()=>i(a.result),a.readAsDataURL(e)}else i(e);else{let a=URL.createObjectURL(typeof e=="string"?new Blob([e]):e);location.href=a,setTimeout(()=>URL.revokeObjectURL(a),4e4)}}}function NC(e,t){return`${e}${e[e.length-1]==="/"||t[0]==="/"?"":"/"}${t}`}function ai(){let e=((t,r)=>t.commands.dispatch(e,r||{}));return e.subscribe=(t,r)=>t.commands.subscribe(e,r),e.id=fn.create22(),e}var iV=class{constructor(){this.subs=new Map;this.disposing=!1}subscribe(t,r){let n=this.subs.get(t.id);return n||(n=[],this.subs.set(t.id,n)),n.push(r),{unsubscribe:()=>{let o=this.subs.get(t.id);if(!o)return;let i=o.indexOf(r);if(!(i<0)){for(let a=i+1;a<o.length;a++)o[a-1]=o[a];o.pop()}}}}dispatch(t,r){return new Promise((n,o)=>{if(this.disposing){o("disposed");return}if(!this.subs.get(t.id)){n();return}this.resolve({cmd:t,params:r,resolve:n,reject:o})})}dispose(){this.subs.clear()}async resolve(t){let r=this.subs.get(t.cmd.id);if(!r){t.resolve();return}try{for(let n of r)await n(t.params);t.resolve()}catch(n){t.reject(n)}}};var lt={State:{SetCurrentObject:ai(),ApplyAction:ai(),Update:ai(),RemoveObject:ai(),ToggleExpanded:ai(),ToggleVisibility:ai(),Snapshots:{Add:ai(),Replace:ai(),Move:ai(),Remove:ai(),Apply:ai(),Clear:ai(),Upload:ai(),Fetch:ai(),DownloadToFile:ai(),OpenFile:ai(),OpenUrl:ai()}},Interactivity:{Object:{Highlight:ai()},Structure:{Highlight:ai(),Select:ai()},ClearHighlights:ai()},Layout:{Update:ai()},Toast:{Show:ai(),Hide:ai()},Camera:{Reset:ai(),SetSnapshot:ai(),Focus:ai(),FocusObject:ai(),OrientAxes:ai(),ResetAxes:ai()},Canvas3D:{SetSettings:ai(),ResetSettings:ai()}};var zX={get defaultTransparency(){return EW()?"blended":"wboit"},get preferWebGl1(){return typeof navigator>"u"||typeof window>"u"?!1:["Version/15.1 Safari","Version/15.2 Safari","Version/15.3 Safari"].some(t=>navigator.userAgent.indexOf(t)>0)?!0:EW()}};var HX=class{constructor(t,r){this.key=t;this.defaultValue=r}toString(){return this.key}valueOf(){return this.key}};function Go(e,t){return new HX(e,t)}var Lr={item:Go,General:{IsBusyTimeoutMs:Go("plugin-config.is-busy-timeout",750),DisableAntialiasing:Go("plugin-config.disable-antialiasing",!1),DisablePreserveDrawingBuffer:Go("plugin-config.disable-preserve-drawing-buffer",!1),PixelScale:Go("plugin-config.pixel-scale",1),PickScale:Go("plugin-config.pick-scale",.25),Transparency:Go("plugin-config.transparency",zX.defaultTransparency),PreferWebGl1:Go("plugin-config.prefer-webgl1",zX.preferWebGl1),AllowMajorPerformanceCaveat:Go("plugin-config.allow-major-performance-caveat",!1),PowerPreference:Go("plugin-config.power-preference","high-performance"),ResolutionMode:Go("plugin-config.resolution-mode","auto")},State:{DefaultServer:Go("plugin-state.server","https://webchem.ncbr.muni.cz/molstar-state"),CurrentServer:Go("plugin-state.server","https://webchem.ncbr.muni.cz/molstar-state"),HistoryCapacity:Go("history-capacity.server",5)},VolumeStreaming:{Enabled:Go("volume-streaming.enabled",!0),DefaultServer:Go("volume-streaming.server","https://ds.litemol.org"),CanStream:Go("volume-streaming.can-stream",(e,t)=>e.models.length===1&&Gt.probablyHasDensityMap(e.models[0])),EmdbHeaderServer:Go("volume-streaming.emdb-header-server","https://files.wwpdb.org/pub/emdb/structures")},Viewport:{ShowReset:Go("viewer.show-reset-button",!0),ShowExpand:Go("viewer.show-expand-button",!0),ShowToggleFullscreen:Go("viewer.show-toggle-fullscreen-button",!0),ShowControls:Go("viewer.show-controls-button",!0),ShowSettings:Go("viewer.show-settings-button",!0),ShowSelectionMode:Go("viewer.show-selection-model-button",!0),ShowAnimation:Go("viewer.show-animation-button",!0),ShowTrajectoryControls:Go("viewer.show-trajectory-controls",!0),ShowScreenshotControls:Go("viewer.show-screenshot-controls",!0),ShowIllumination:Go("viewer.show-illumination-button",!0),ShowXR:Go("viewer.show-xr","always")},Download:{DefaultPdbProvider:Go("download.default-pdb-provider","pdbe"),DefaultEmdbProvider:Go("download.default-emdb-provider","pdbe")},Structure:{SizeThresholds:Go("structure.size-thresholds",De.DefaultSizeThresholds),DefaultRepresentationPreset:Go("structure.default-representation-preset","auto"),DefaultRepresentationPresetParams:Go("structure.default-representation-preset-params",{}),SaccharideCompIdMapType:Go("structure.saccharide-comp-id-map-type","default")},Background:{Styles:Go("background.styles",[])}},aV=class{constructor(t){this._config=new Map;t&&t.forEach(([r,n])=>this._config.set(r,n))}get(t){return this._config.has(t)?this._config.get(t):t.defaultValue}set(t,r){this._config.set(t,r)}delete(t){this._config.delete(t)}};function Rst(e){PAe(e),_Ae(e),RAe(e),DAe(e),wAe(e),MAe(e),BAe(e),EAe(e),kAe(e),FAe(e)}function PAe(e){e.state.events.object.created.subscribe(t=>{ne.isBehavior(t.obj)&&t.obj.data.register(t.ref)}),e.state.events.object.removed.subscribe(t=>{ne.isBehavior(t.obj)&&(t.obj.data.unregister?.(),t.obj.data.dispose?.())}),e.state.events.object.updated.subscribe(t=>{t.action==="recreate"&&(t.oldObj&&ne.isBehavior(t.oldObj)&&(t.oldObj.data.unregister?.(),t.oldObj.data.dispose?.()),t.obj&&ne.isBehavior(t.obj)&&t.obj.data.register(t.ref))})}function _Ae(e){lt.State.SetCurrentObject.subscribe(e,({state:t,ref:r})=>t.setCurrent(r))}function RAe(e){lt.State.Update.subscribe(e,({state:t,tree:r,options:n})=>e.runTask(t.updateTree(r,n)))}function DAe(e){lt.State.ApplyAction.subscribe(e,({state:t,action:r,ref:n})=>e.runTask(t.applyAction(r.action,r.params,n)))}function wAe(e){function t(r,n){let o=r.build().delete(n);return e.runTask(r.updateTree(o))}lt.State.RemoveObject.subscribe(e,({state:r,ref:n,removeParentGhosts:o})=>{if(o){let i=r.tree,a=i.transforms.get(n);if(a.parent===n)return t(r,n);for(;;){let s=i.children.get(a.parent);if(a.parent===a.ref||s.size>1)return t(r,a.ref);let l=i.transforms.get(a.parent);if(!l.state.isGhost)return t(r,a.ref);a=l}}else return t(r,n)})}function MAe(e){lt.State.ToggleExpanded.subscribe(e,({state:t,ref:r})=>t.updateCellState(r,({isCollapsed:n})=>({isCollapsed:!n})))}function BAe(e){lt.State.ToggleVisibility.subscribe(e,({state:t,ref:r})=>uh(t,r,!t.cells.get(r).state.isHidden))}function uh(e,t,r){Co.doPreOrder(e.tree,e.transforms.get(t),{state:e,value:r},Dst)}function Dst(e,t,r){r.state.updateCellState(e.ref,{isHidden:r.value})}function EAe(e){lt.Interactivity.Object.Highlight.subscribe(e,({state:t,ref:r})=>{if(!e.canvas3d||e.isBusy)return;e.managers.interactivity.lociHighlights.clearHighlights();let n=typeof r=="string"?[r]:r;for(let o of n){let i=t.cells.get(o);if(i){if(ne.Molecule.Structure.is(i.obj))e.managers.interactivity.lociHighlights.highlight({loci:De.Loci(i.obj.data)},!1);else if(i&&ne.isRepresentation3D(i.obj)){let{repr:a}=i.obj.data;for(let s of a.getAllLoci())e.managers.interactivity.lociHighlights.highlight({loci:s,repr:a},!1)}else if(ne.Molecule.Structure.Selections.is(i.obj))for(let a of i.obj.data)e.managers.interactivity.lociHighlights.highlight({loci:a.loci},!1)}}})}function kAe(e){lt.Interactivity.ClearHighlights.subscribe(e,()=>{e.managers.interactivity.lociHighlights.clearHighlights()})}function FAe(e){e.config.set(Lr.State.CurrentServer,e.config.get(Lr.State.DefaultServer)),lt.State.Snapshots.Clear.subscribe(e,()=>{e.managers.snapshot.clear()}),lt.State.Snapshots.Remove.subscribe(e,({id:t})=>{e.managers.snapshot.remove(t)}),lt.State.Snapshots.Add.subscribe(e,async({key:t,name:r,description:n,descriptionFormat:o,params:i})=>{let a=e.state.getSnapshot(i),s=i?.image??e.state.snapshotParams.value.image?await jp.getCanvasImageAsset(e,`${a.id}-image.png`):void 0,l=jp.Entry(a,{key:t,name:r,description:n,descriptionFormat:o,image:s});e.managers.snapshot.add(l)}),lt.State.Snapshots.Replace.subscribe(e,async({id:t,params:r})=>{let n=e.state.getSnapshot(r),o=r?.image??e.state.snapshotParams.value.image?await jp.getCanvasImageAsset(e,`${n.id}-image.png`):void 0;e.managers.snapshot.replace(t,e.state.getSnapshot(r),{image:o})}),lt.State.Snapshots.Move.subscribe(e,({id:t,dir:r})=>{e.managers.snapshot.move(t,r)}),lt.State.Snapshots.Apply.subscribe(e,({id:t})=>{let r=e.managers.snapshot.setCurrent(t);if(r)return e.state.setSnapshot(r)}),lt.State.Snapshots.Upload.subscribe(e,async({name:t,description:r,playOnLoad:n,serverUrl:o,params:i})=>fetch(NC(o,`set?name=${encodeURIComponent(t||"")}&description=${encodeURIComponent(r||"")}`),{method:"POST",mode:"cors",referrer:"no-referrer",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify(await e.managers.snapshot.getStateSnapshot({name:t,description:r,playOnLoad:n}))})),lt.State.Snapshots.Fetch.subscribe(e,async({url:t})=>{let r=await e.runTask(e.fetch({url:t,type:"json"}));await e.managers.snapshot.setStateSnapshot(r.data)}),lt.State.Snapshots.DownloadToFile.subscribe(e,async({name:t,type:r,params:n})=>{let o=`mol-star_state_${t||AAe()}.${r==="json"?"molj":"molx"}`,i=await e.managers.snapshot.serialize({type:r,params:n});sT(i,`${o}`)}),lt.State.Snapshots.OpenFile.subscribe(e,({file:t})=>e.managers.snapshot.open(t)),lt.State.Snapshots.OpenUrl.subscribe(e,async({url:t,type:r})=>{let n=await e.runTask(e.fetch({url:t,type:"binary"}));return e.managers.snapshot.open(new File([n],`state.${r}`))})}var XX={};Gi(XX,{SyncRepresentationToCanvas:()=>LAe,SyncStructureRepresentation3DState:()=>VAe,UpdateRepresentationVisibility:()=>OAe,registerDefault:()=>wst});function wst(e){LAe(e),VAe(e),OAe(e)}function LAe(e){let t=e.state.data.events;t.object.created.subscribe(r=>{ne.isRepresentation3D(r.obj)&&(WX(r.state.cells.get(r.ref),r.obj.data.repr),r.obj.data.repr.setState({syncManually:!0}),e.canvas3d?.add(r.obj.data.repr))}),t.object.updated.subscribe(r=>{r.oldObj&&ne.isRepresentation3D(r.oldObj)&&(e.canvas3d?.remove(r.oldObj.data.repr),r.oldObj.data.repr.destroy()),ne.isRepresentation3D(r.obj)&&(WX(r.state.cells.get(r.ref),r.obj.data.repr),r.action==="recreate"&&r.obj.data.repr.setState({syncManually:!0}),e.canvas3d?.add(r.obj.data.repr))}),t.object.removed.subscribe(r=>{ne.isRepresentation3D(r.obj)&&(e.canvas3d?.remove(r.obj.data.repr),r.obj.data.repr.destroy())})}function VAe(e){let t=e.state.data.events;t.object.created.subscribe(r=>{if(!ne.Molecule.Structure.Representation3DState.is(r.obj))return;let n=r.obj.data;n.repr.setState(n.state),e.canvas3d?.update(n.repr)}),t.object.updated.subscribe(r=>{if(!ne.Molecule.Structure.Representation3DState.is(r.obj))return;let n=r.obj.data;n.repr.setState(n.state),e.canvas3d?.update(n.repr)}),t.object.removed.subscribe(r=>{if(!ne.Molecule.Structure.Representation3DState.is(r.obj))return;let n=r.obj.data;n.repr.setState(n.initialState),e.canvas3d?.update(n.repr)})}function OAe(e){e.state.data.events.cell.stateUpdated.subscribe(t=>{let r=t.state.cells.get(t.ref);ne.isRepresentation3D(r.obj)&&WX(r,r.obj.data.repr)&&e.canvas3d?.syncVisibility()})}function WX(e,t){return t.state.visible===!!e.state.isHidden?(t.setState({visible:!e.state.isHidden}),!0):!1}var QX={};Gi(QX,{Focus:()=>NAe,FocusObject:()=>zAe,OrientAxes:()=>HAe,Reset:()=>GAe,ResetAxes:()=>jAe,SetSnapshot:()=>UAe,registerDefault:()=>Mst});function Mst(e){GAe(e),NAe(e),zAe(e),UAe(e),HAe(e),jAe(e)}function GAe(e){lt.Camera.Reset.subscribe(e,t=>{e.managers.camera.reset(t?.snapshot,t?.durationMs)})}function UAe(e){lt.Camera.SetSnapshot.subscribe(e,({snapshot:t,durationMs:r})=>{e.managers.camera.setSnapshot(t,r)})}function NAe(e){lt.Camera.Focus.subscribe(e,({center:t,radius:r,durationMs:n})=>{e.managers.camera.focusSphere({center:t,radius:r},{durationMs:n}),e.events.canvas3d.settingsUpdated.next(void 0)})}function zAe(e){lt.Camera.FocusObject.subscribe(e,async t=>{e.managers.camera.focusObject(t)})}function HAe(e){lt.Camera.OrientAxes.subscribe(e,({structures:t,durationMs:r})=>{e.managers.camera.orientAxes(t,r)})}function jAe(e){lt.Camera.ResetAxes.subscribe(e,({durationMs:t})=>{e.managers.camera.resetAxes(t)})}var ZX={};Gi(ZX,{Canvas3DSetSettings:()=>WAe,registerDefault:()=>Bst});function Bst(e){WAe(e)}function WAe(e){lt.Canvas3D.ResetSettings.subscribe(e,()=>{e.canvas3d?.setProps(Ud),e.events.canvas3d.settingsUpdated.next(void 0)}),lt.Canvas3D.SetSettings.subscribe(e,t=>{e.canvas3d&&(e.canvas3d?.setProps(t.settings),e.events.canvas3d.settingsUpdated.next(void 0))})}var YX={};Gi(YX,{DefaultFocusLociBindings:()=>QAe,DefaultLociLabelProvider:()=>Vst,DefaultSelectLociBindings:()=>XAe,FocusLoci:()=>p1,HighlightLoci:()=>Fst,SelectLoci:()=>qX});var Ng=Ai,Hg=cs,zg=Ct.Trigger,Est={hoverHighlightOnly:Ct([zg(Ng.Flag.None)],"Highlight","Hover element using ${triggers}"),hoverHighlightOnlyExtend:Ct([zg(Ng.Flag.None,Hg.create({shift:!0}))],"Extend highlight","From selected to hovered element along polymer using ${triggers}")},kst={bindings:C.Value(Est,{isHidden:!0}),ignore:C.Value([],{isHidden:!0}),preferAtoms:C.Boolean(!1,{description:"Always prefer atoms over bonds"}),mark:C.Boolean(!0)},Fst=Kr.create({name:"representation-highlight-loci",category:"interaction",ctor:class extends Kr.Handler{constructor(){super(...arguments);this.lociMarkProvider=(t,r)=>{!this.ctx.canvas3d||!this.params.mark||this.ctx.canvas3d.mark(t,r)}}getLoci(t){return this.params.preferAtoms&&It.isLoci(t)&&t.bonds.length===2?It.toFirstStructureElementLoci(t):t}register(){this.subscribeObservable(this.ctx.behaviors.interaction.hover,({current:t,buttons:r,modifiers:n})=>{if(!this.ctx.canvas3d||this.ctx.isBusy)return;let o=this.getLoci(t.loci);if(this.params.ignore.includes(o.kind)){this.ctx.managers.interactivity.lociHighlights.highlightOnly({repr:t.repr,loci:vr});return}let i=!1;Ct.match(this.params.bindings.hoverHighlightOnly,r,n)&&(this.ctx.managers.interactivity.lociHighlights.highlightOnly({loci:o}),i=!0),Ct.match(this.params.bindings.hoverHighlightOnlyExtend,r,n)&&(this.ctx.managers.interactivity.lociHighlights.highlightOnlyExtend({loci:o}),i=!0),i||this.ctx.managers.interactivity.lociHighlights.highlightOnly({repr:t.repr,loci:vr})}),this.ctx.managers.interactivity.lociHighlights.addProvider(this.lociMarkProvider)}unregister(){this.ctx.managers.interactivity.lociHighlights.removeProvider(this.lociMarkProvider)}},params:()=>kst,display:{name:"Highlight Loci on Canvas"}}),XAe={clickSelect:Ct.Empty,clickSelectOnly:Ct.Empty,clickToggle:Ct([zg(Ng.Flag.Primary,Hg.create())],"Toggle selection","Click on element using ${triggers}"),clickToggleExtend:Ct([zg(Ng.Flag.Primary,Hg.create({shift:!0}))],"Toggle extended selection","Click on element using ${triggers} to extend selection along polymer"),clickDeselect:Ct.Empty,clickDeselectAllOnEmpty:Ct([zg(Ng.Flag.Primary,Hg.create())],"Deselect all","Click on nothing using ${triggers}")},Lst={bindings:C.Value(XAe,{isHidden:!0}),ignore:C.Value([],{isHidden:!0}),preferAtoms:C.Boolean(!1,{description:"Always prefer atoms over bonds"}),mark:C.Boolean(!0)},qX=Kr.create({name:"representation-select-loci",category:"interaction",ctor:class extends Kr.Handler{constructor(t,r){super(t,r);this.lociMarkProvider=(t,r)=>{!this.ctx.canvas3d||!this.params.mark||this.ctx.canvas3d.mark({loci:t.loci},r)};this.spine=new IS.Impl(t.state.data.cells)}getLoci(t){return this.params.preferAtoms&&It.isLoci(t)&&t.bonds.length===2?It.toFirstStructureElementLoci(t):t}applySelectMark(t,r){let n=this.ctx.state.data.cells.get(t);if(n&&ne.isRepresentation3D(n.obj)){this.spine.current=n;let o=this.spine.getRootOfType(ne.Molecule.Structure);if(o){r&&this.lociMarkProvider({loci:De.Loci(o.data)},8);let i=this.ctx.managers.structure.selection.getLoci(o.data);this.lociMarkProvider({loci:i},4)}}}register(){let t=o=>nr.isEmpty(o),r=o=>!nr.isEmpty(o),n=[["clickSelect",o=>this.ctx.managers.interactivity.lociSelects.select(o),r],["clickToggle",o=>this.ctx.managers.interactivity.lociSelects.toggle(o),r],["clickToggleExtend",o=>this.ctx.managers.interactivity.lociSelects.toggleExtend(o),r],["clickSelectOnly",o=>this.ctx.managers.interactivity.lociSelects.selectOnly(o),r],["clickDeselect",o=>this.ctx.managers.interactivity.lociSelects.deselect(o),r],["clickDeselectAllOnEmpty",()=>this.ctx.managers.interactivity.lociSelects.deselectAll(),t]];n.sort((o,i)=>{let a=this.params.bindings[o[0]],s=this.params.bindings[i[0]],l=a.triggers.length===0?0:xl(a.triggers.map(c=>Hg.size(c.modifiers)));return(s.triggers.length===0?0:xl(s.triggers.map(c=>Hg.size(c.modifiers))))-l}),this.subscribeObservable(this.ctx.behaviors.interaction.click,({current:o,button:i,modifiers:a})=>{if(!this.ctx.canvas3d||this.ctx.isBusy||!this.ctx.selectionMode)return;let s=this.getLoci(o.loci);if(!this.params.ignore.includes(s.kind)){for(let[l,u,c]of n)if(Ct.match(this.params.bindings[l],i,a)&&(!c||c(s))){u({repr:o.repr,loci:s});break}}}),this.ctx.managers.interactivity.lociSelects.addProvider(this.lociMarkProvider),this.subscribeObservable(this.ctx.state.events.object.created,({ref:o})=>this.applySelectMark(o)),this.subscribeObservable(this.ctx.state.events.object.updated,({ref:o,obj:i,oldObj:a,oldData:s,action:l})=>{let u=this.ctx.state.data.cells.get(o);if(u&&ne.Molecule.Structure.is(u.obj)){let c=i.data,m=l==="recreate"?a?.data:l==="in-place"?s:void 0;if(m&&De.areEquivalent(c,m)&&De.areHierarchiesEqual(c,m))return;let d=this.ctx.state.data.select(tr.children(o).ofType(ne.Molecule.Structure.Representation3D));for(let p of d)this.applySelectMark(p.transform.ref,!0)}})}unregister(){this.ctx.managers.interactivity.lociSelects.removeProvider(this.lociMarkProvider)}},params:()=>Lst,display:{name:"Select Loci on Canvas"}}),Vst=Kr.create({name:"default-loci-label-provider",category:"interaction",ctor:class{constructor(e){this.ctx=e;this.f={label:e=>{let t=[];if(Q.Loci.is(e)){let r=new Set;for(let{unit:n}of e.elements){let o=Q.Location.create(e.structure,n,n.elements[0]),i=Ke.entity.pdbx_description(o).join(", ");r.add(i)}r.size===1&&r.forEach(n=>t.push(n))}return t.push(Np(e)),t.filter(r=>!!r).join("</br>")},group:e=>e.toString().replace(/Model [0-9]+/g,"Models"),priority:100}}register(){this.ctx.managers.lociLabels.addProvider(this.f)}unregister(){this.ctx.managers.lociLabels.removeProvider(this.f)}},display:{name:"Provide Default Loci Label"}}),QAe={clickFocus:Ct([zg(Ng.Flag.Primary,Hg.create()),zg(Ng.Flag.Trigger)],"Representation Focus","Click element using ${triggers}"),clickFocusAdd:Ct([zg(Ng.Flag.Primary,Hg.create({control:!0})),zg(Ng.Flag.Primary,Hg.create({meta:!0}))],"Representation Focus Add","Click element using ${triggers}"),clickFocusExtend:Ct([zg(Ng.Flag.Primary,Hg.create({shift:!0}))],"Representation Focus Extend","Click on element using ${triggers}"),clickFocusSelectMode:Ct([],"Representation Focus (Selection Mode)","Click element using ${triggers}"),clickFocusAddSelectMode:Ct([],"Representation Focus Add (Selection Mode)","Click element using ${triggers}"),clickFocusExtendSelectMode:Ct([],"Representation Focus Extend (Selection Mode)","Click on element using ${triggers}")},Ost={bindings:C.Value(QAe,{isHidden:!0})},p1=Kr.create({name:"representation-focus-loci",category:"interaction",ctor:class extends Kr.Handler{register(){this.subscribeObservable(this.ctx.behaviors.interaction.click,({current:e,button:t,modifiers:r})=>{let{clickFocus:n,clickFocusAdd:o,clickFocusExtend:i,clickFocusSelectMode:a,clickFocusAddSelectMode:s,clickFocusExtendSelectMode:l}=this.params.bindings,u=this.ctx.selectionMode?a:n,c=Ct.match(u,t,r),m=this.ctx.selectionMode?s:o,d=Ct.match(m,t,r),p=this.ctx.selectionMode?l:i,h=Ct.match(p,t,r);if(!c&&!d&&!h)return;let f=e.repr?.props?.snapshotKey?.trim()??"";if(!this.ctx.selectionMode&&c&&f){this.ctx.managers.snapshot.applyKey(f);return}let g=e.repr?.props?.markdownCommands;if(!this.ctx.selectionMode&&c&&typeof g=="object"&&Object.keys(g).length>0){this.ctx.managers.markdownExtensions.tryExecute("click",g);return}let{granularity:y}=this.ctx.managers.interactivity.props;if(y!=="residue"&&y!=="element")return;let x=nr.normalize(e.loci,"residue"),S=this.ctx.managers.structure.focus.current;if(S&&nr.areEqual(S.loci,x))this.ctx.managers.structure.focus.clear();else if(c)this.ctx.managers.structure.focus.setFromLoci(x);else{h?this.ctx.managers.structure.focus.extendFromLoci(x):this.ctx.managers.structure.focus.toggleFromLoci(x);let I=this.ctx.managers.structure.focus.current?.loci;I&&this.ctx.managers.camera.focusLoci(I)}})}},params:()=>Ost,display:{name:"Representation Focus Loci on Canvas"}});var $X={};Gi($X,{CameraAxisHelper:()=>Nst,CameraControls:()=>Hst,DefaultClickResetCameraOnEmpty:()=>KX,DefaultClickResetCameraOnEmptySelectMode:()=>JX,DefaultFocusLociBindings:()=>ZAe,FocusLoci:()=>Ust});var Wp=Ai,ch=cs,Xp=Ct.Trigger,eD=Ct.TriggerKey,KX=Ct([Xp(Wp.Flag.Primary,ch.create()),Xp(Wp.Flag.Secondary,ch.create()),Xp(Wp.Flag.Primary,ch.create({control:!0})),Xp(Wp.Flag.Trigger)],"Reset camera focus","Click on nothing using ${triggers}"),JX=Ct([Xp(Wp.Flag.Secondary,ch.create()),Xp(Wp.Flag.Primary,ch.create({control:!0}))],"Reset camera focus (Selection Mode)","Click on nothing using ${triggers}"),ZAe={clickCenterFocus:Ct([Xp(Wp.Flag.Primary,ch.create()),Xp(Wp.Flag.Secondary,ch.create()),Xp(Wp.Flag.Primary,ch.create({control:!0})),Xp(Wp.Flag.Trigger)],"Camera center and focus","Click element using ${triggers}"),clickCenterFocusSelectMode:Ct([Xp(Wp.Flag.Secondary,ch.create()),Xp(Wp.Flag.Primary,ch.create({control:!0}))],"Camera center and focus (Selection Mode)","Click element using ${triggers}"),clickResetCameraOnEmpty:KX,clickResetCameraOnEmptySelectMode:JX},Gst={minRadius:C.Numeric(8,{min:1,max:50,step:1}),extraRadius:C.Numeric(4,{min:1,max:50,step:1},{description:"Value added to the bounding-sphere radius of the Loci"}),durationMs:C.Numeric(250,{min:0,max:1e3,step:1},{description:"Camera transition duration"}),bindings:C.Value(ZAe,{isHidden:!0})},Ust=Kr.create({name:"camera-focus-loci",category:"interaction",ctor:class extends Kr.Handler{register(){this.subscribeObservable(this.ctx.behaviors.interaction.click,({current:e,button:t,modifiers:r})=>{if(!this.ctx.canvas3d)return;let n=this.ctx.selectionMode?this.params.bindings.clickCenterFocusSelectMode:this.params.bindings.clickCenterFocus,o=this.ctx.selectionMode?this.params.bindings.clickResetCameraOnEmptySelectMode??JX:this.params.bindings.clickResetCameraOnEmpty??KX;if(nr.isEmpty(e.loci)&&Ct.match(o,t,r)){lt.Camera.Reset(this.ctx,{});return}let i=e.repr?.props?.snapshotKey?.trim()??"",a=e.repr?.props?.markdownCommands;if(!(i||typeof a=="object"&&Object.keys(a).length>0)&&Ct.match(n,t,r)){let s=nr.normalize(e.loci,this.ctx.managers.interactivity.props.granularity);this.ctx.managers.camera.focusLoci(s,this.params)}})}},params:()=>Gst,display:{name:"Camera Focus Loci on Canvas"}}),Nst=Kr.create({name:"camera-axis-helper",category:"interaction",ctor:class extends Kr.Handler{register(){let e=0,t=0;this.subscribeObservable(this.ctx.behaviors.interaction.click,({current:r})=>{if(!this.ctx.canvas3d||!XL(r.loci))return;let n=r.loci.elements[0].groupId;if(n===0){e=0,t=0;return}let{camera:o}=this.ctx.canvas3d,i,a;if(n>=1&&n<=3){e=0,t=0;let s=b.sub(b(),o.target,o.position),l=b.cross(b(),s,o.up);a=b(),a[n-1]=1,i=b.cross(b(),a,l),b.magnitude(i)===0&&(i=s)}else e===n?t=(t+1)%2:(e=n,t=0),n===4?(a=t?b.unitX:b.unitY,i=b.negUnitZ):n===5?(a=t?b.unitX:b.unitZ,i=b.negUnitY):(a=t?b.unitY:b.unitZ,i=b.negUnitX);this.ctx.canvas3d.requestCameraReset({snapshot:(s,l)=>l.getInvariantFocus(s.boundingSphereVisible.center,s.boundingSphereVisible.radius,a,i)})})}},params:()=>({}),display:{name:"Camera Axis Helper"}}),qAe={keySpinAnimation:Ct([eD("I")],"Spin Animation","Press ${triggers}"),keyRockAnimation:Ct([eD("O")],"Rock Animation","Press ${triggers}"),keyToggleFlyMode:Ct([eD("Space",ch.create({shift:!0}))],"Toggle Fly Mode","Press ${triggers}"),keyResetView:Ct([eD("T")],"Reset View","Press ${triggers}"),keyGlobalIllumination:Ct([eD("G")],"Global Illumination","Press ${triggers}")},zst={bindings:C.Value(qAe,{isHidden:!0})},Hst=Kr.create({name:"camera-controls",category:"interaction",ctor:class extends Kr.Handler{register(){this.subscribeObservable(this.ctx.behaviors.interaction.key,({code:e,key:t,modifiers:r})=>{if(!this.ctx.canvas3d)return;let n={...qAe,...this.params.bindings},o=this.ctx.canvas3d.props.trackball,i=this.ctx.canvas3d.props.illumination;if(Ct.matchKey(n.keySpinAnimation,e,r,t)){let a=o.animate.name!=="spin"?"spin":"off";a==="off"?lt.Canvas3D.SetSettings(this.ctx,{settings:{trackball:{...o,animate:{name:a,params:{}}}}}):lt.Canvas3D.SetSettings(this.ctx,{settings:{trackball:{...o,animate:{name:a,params:{speed:.1}}}}})}if(Ct.matchKey(n.keyRockAnimation,e,r,t)){let a=o.animate.name!=="rock"?"rock":"off";a==="off"?lt.Canvas3D.SetSettings(this.ctx,{settings:{trackball:{...o,animate:{name:a,params:{}}}}}):lt.Canvas3D.SetSettings(this.ctx,{settings:{trackball:{...o,animate:{name:a,params:{speed:.3,angle:10}}}}})}if(Ct.matchKey(n.keyToggleFlyMode,e,r,t)){let a=!o.flyMode;lt.Canvas3D.SetSettings(this.ctx,{settings:{trackball:{...o,flyMode:a}}}),this.ctx.canvas3dContext?.canvas&&(this.ctx.canvas3dContext.canvas.style.cursor=a?"crosshair":"unset")}Ct.matchKey(n.keyResetView,e,r,t)&&lt.Camera.Reset(this.ctx,{}),Ct.matchKey(n.keyGlobalIllumination,e,r,t)&&lt.Canvas3D.SetSettings(this.ctx,{settings:{illumination:{...i,enabled:!i.enabled}}})})}},params:()=>zst,display:{name:"Camera Controls on Canvas"}});var eQ={};Gi(eQ,{SnapshotControls:()=>Xst});var sV=cs,lT=Ct.TriggerKey,jst={next:Ct([lT("ArrowRight",sV.create({control:!0})),lT("GamepadY")]),previous:Ct([lT("ArrowLeft",sV.create({control:!0})),lT("GamepadX")]),first:Ct([lT("ArrowUp",sV.create({control:!0}))]),last:Ct([lT("ArrowDown",sV.create({control:!0}))])},Wst={bindings:C.Value(jst,{isHidden:!0})},Xst=Kr.create({name:"snapshot-controls",category:"interaction",ctor:class extends Kr.Handler{register(){this.subscribeObservable(this.ctx.behaviors.interaction.keyReleased,({code:e,modifiers:t,key:r})=>{if(!this.ctx.canvas3d||this.ctx.isBusy)return;let n=this.params.bindings,{snapshot:o}=this.ctx.managers;if(Ct.matchKey(n.next,e,t,r)&&o.applyNext(1),Ct.matchKey(n.previous,e,t,r)&&o.applyNext(-1),Ct.matchKey(n.first,e,t,r)){let i=o.state.entries.get(0),a=o.setCurrent(i.snapshot.id);if(a)return this.ctx.state.setSnapshot(a)}if(Ct.matchKey(n.last,e,t,r)){let i=o.state.entries.get(o.state.entries.size-1),a=o.setCurrent(i.snapshot.id);if(a)return this.ctx.state.setSnapshot(a)}})}},params:()=>Wst,display:{name:"Snapshot Controls"}});var UQ={};Gi(UQ,{AccessibleSurfaceArea:()=>iTe,BestDatabaseSequenceMapping:()=>mPe,CrossLinkRestraint:()=>xPe,Interactions:()=>aPe,SecondaryStructure:()=>sPe,StructureInfo:()=>YAe,ValenceModel:()=>lPe});var YAe=Kr.create({name:"structure-info-prop",category:"custom-props",display:{name:"Structure Info"},ctor:class extends Kr.Handler{get maxModelIndex(){let e=-1,t=this.ctx.state.data.select(tr.Generators.rootsOfType(ne.Molecule.Model));for(let r of t){let n=r.obj?.data&&Gt.Index.get(r.obj?.data).value;n!==void 0&&n>e&&(e=n)}return e}get maxStructureIndex(){let e=-1,t=this.ctx.state.data.select(tr.Generators.rootsOfType(ne.Molecule.Structure));for(let r of t){let n=r.obj?.data&&De.Index.get(r.obj?.data).value;n!==void 0&&n>e&&(e=n)}return e}get asymIdOffset(){let e=0,t=0,r=this.ctx.state.data.select(tr.Generators.rootsOfType(ne.Molecule.Model));for(let n of r){let o=n.obj?.data;if(o){let i=Gt.AsymIdCount.get(o),a=Gt.AsymIdOffset.get(o).value;i!==void 0&&a!==void 0&&(e=Math.max(e,a.auth+i.auth),t=Math.max(t,a.label+i.label))}}return{auth:e,label:t}}setModelMaxIndex(){let e=this.maxModelIndex,t=this.ctx.state.data.select(tr.Generators.rootsOfType(ne.Molecule.Model));for(let r of t){let n=r.obj?.data;n&&Gt.MaxIndex.get(n).value!==e&&Gt.MaxIndex.set(n,{value:e},e)}}setStructureMaxIndex(){let e=this.maxModelIndex,t=this.ctx.state.data.select(tr.Generators.rootsOfType(ne.Molecule.Structure));for(let r of t){let n=r.obj?.data;n&&De.MaxIndex.get(n).value!==e&&De.MaxIndex.set(n,{value:e},e)}}handleModel(e,t){if(Gt.Index.get(e).value===void 0){let n=(t&&Gt.Index.get(t).value)??this.maxModelIndex+1;Gt.Index.set(e,{value:n},n)}if(Gt.AsymIdOffset.get(e).value===void 0){let n=(t&&Gt.AsymIdOffset.get(t).value)??{...this.asymIdOffset};Gt.AsymIdOffset.set(e,{value:n},n)}}handleStructure(e,t){if(e.parent!==void 0||De.Index.get(e).value!==void 0)return;let n=(t&&De.Index.get(t).value)??this.maxStructureIndex+1;De.Index.set(e,{value:n},n)}handle(e,t,r){ne.Molecule.Structure.is(t)?!this.ctx.state.data.tree.transforms.get(e).transformer.definition.isDecorator&&t.data.parent===void 0&&this.handleStructure(t.data,r?.data):ne.Molecule.Model.is(t)&&(this.ctx.state.data.tree.transforms.get(e).transformer.definition.isDecorator||this.handleModel(t.data,r?.data))}register(){this.ctx.customModelProperties.register(Gt.AsymIdOffset,!0),this.ctx.customModelProperties.register(Gt.Index,!0),this.ctx.customModelProperties.register(Gt.MaxIndex,!0),this.ctx.customStructureProperties.register(De.Index,!0),this.ctx.customStructureProperties.register(De.MaxIndex,!0),this.subscribeObservable(this.ctx.state.data.events.object.created,e=>{this.handle(e.ref,e.obj),this.setModelMaxIndex(),this.setStructureMaxIndex()}),this.subscribeObservable(this.ctx.state.data.events.object.updated,e=>{this.handle(e.ref,e.obj,e.oldObj)})}unregister(){this.ctx.customModelProperties.unregister(Gt.AsymIdOffset.descriptor.name),this.ctx.customModelProperties.unregister(Gt.Index.descriptor.name),this.ctx.customModelProperties.unregister(Gt.MaxIndex.descriptor.name),this.ctx.customStructureProperties.unregister(De.Index.descriptor.name),this.ctx.customStructureProperties.unregister(De.MaxIndex.descriptor.name)}}});var mh=[-1,1.76,1.87,1.65,1.5,1.4,1.85,1.8,1.6,1.4],lV={ALA:121,ARG:265,ASN:187,ASP:187,CYS:148,GLU:214,GLN:214,GLY:97,HIS:216,ILE:195,LEU:191,LYS:230,MET:203,PHE:228,PRO:154,SER:143,THR:163,TRP:264,TYR:255,VAL:165},KAe=121;function JAe(e){let{key:t}=Ke.residue,{type_symbol:r,label_atom_id:n,label_comp_id:o}=Ke.atom,{structure:i,atomRadiusType:a,serialResidueIndex:s}=e,l=Q.Location.create(i),u=0,c=0,m=-1;l.structure=i;for(let d=0,p=0,h=i.units.length;d<h;++d){let f=i.units[d],{elements:g}=f;l.unit=f,u=-1;for(let y=0,x=g.length;y<x;++y){let S=g[y],I=p+y;l.element=S,c=t(l),u!==c&&++m,u=c;let v=r(l),A=Mm(v);if(gp(A)){a[I]=0,s[I]=-1;continue}let P=n(l),T=MI(f,S);if(T===2||!e.nonPolymer&&!eC(T)){a[I]=0,s[I]=-1;continue}let R=o(l);if(e.traceOnly&&(P!=="CA"&&P!=="BB"||!lV[R])){a[I]=0,s[I]=m;continue}pa(T)?a[I]=Zst(P,v,R):T===5?a[I]=Qst(P,v,R):a[I]=tQ(v),s[I]=m}p+=g.length}}function Qst(e,t,r){switch(t){case"O":return 5;case"S":return 6;case"N":return e==="NZ"?4:3;case"C":switch(e){case"C":case"CE1":case"CE2":case"CE3":case"CH2":case"CZ":case"CZ2":case"CZ3":return 1;case"CA":case"CB":case"CE":case"CG1":case"CG2":return 2;default:switch(r){case"PHE":case"TRP":case"TYR":case"HIS":case"ASP":case"ASN":return 1;case"PRO":case"LYS":case"ARG":case"MET":case"ILE":case"LEU":return 2;case"GLU":case"GLN":return e==="CD"?1:2}}}return tQ(t)}function Zst(e,t,r){switch(t){case"C":return 7;case"N":return 8;case"P":return 9;case"O":return 5}return tQ(t)}function tQ(e){let t=Dm(e),r=mh.indexOf(t);return r===-1&&(r=mh.length,mh[r]=t),r}var $Ae=5e3;async function eTe(e,t){let{atomRadiusType:r}=t;for(let n=0;n<r.length;n+=$Ae)e.shouldUpdate&&await e.update({message:"Computing per residue surface accessibility...",current:n,max:r.length}),qst(t,n,Math.min(n+$Ae,r.length))}function qst(e,t,r){let{structure:n,atomRadiusType:o,serialResidueIndex:i,area:a,spherePoints:s,scalingConstant:l,maxLookupRadius:u,probeSize:c}=e,{lookup3d:m,serialMapping:d,unitIndexMap:p,units:h}=n,{cumulativeUnitElementCount:f,elementIndices:g,unitIndices:y}=d;for(let x=t;x<r;++x){let S=mh[o[x]];if(S===mh[0])continue;let I=h[y[x]],v=g[x],A=I.conformation.x(v),P=I.conformation.y(v),T=I.conformation.z(v),{count:R,units:w,indices:E,squaredDistances:M}=m.find(A,P,T,u),D=c+S,B=c+D,k=[];for(let z=0;z<R;++z){let j=w[z],Y=f[p.get(j.id)]+E[z],G=g[Y],X=mh[o[Y]];if(I===j&&v===G||X===mh[0])continue;let U=c+X;if(M[z]<(B+X)*(B+X)){let L=g[Y];k[k.length]=[M[z],(M[z]+D*D-U*U)/(2*D),j.conformation.x(L)-A,j.conformation.y(L)-P,j.conformation.z(L)-T]}}k.sort((z,j)=>z[0]-j[0]);let F=0;e:for(let z=0;z<s.length;++z){let[j,Y,G]=s[z];for(let X=0;X<k.length;++X){let[,U,L,q,te]=k[X];if(j*L+Y*q+G*te>U)continue e}++F}a[i[x]]+=l*F*D*D}}var rQ={numberOfSpherePoints:C.Numeric(92,{min:12,max:360,step:1},{description:"Number of sphere points to sample per atom: 92 (original paper), 960 (BioJava), 3000 (EPPIC) - see Shrake A, Rupley JA: Environment and exposure to solvent of protein atoms. Lysozyme and insulin. J Mol Biol 1973."}),probeSize:C.Numeric(1.4,{min:.1,max:4,step:.01},{description:"Corresponds to the size of a water molecule: 1.4 (original paper), 1.5 (occassionally used)"}),nonPolymer:C.Boolean(!1,{description:"Include non-polymer atoms as occluders."}),traceOnly:C.Boolean(!1,{description:"Compute only using alpha-carbons, if true increase probeSize accordingly (e.g., 4 A). Considers only canonical amino acids."})};var _b;(c=>{function e(m,d={}){let p={...C.getDefaultValues(rQ),...d};return Ae.create("Compute Accessible Surface Area",async h=>await t(h,m,p))}c.compute=e;async function t(m,d,p){let h=r(d,p);JAe(h),await eTe(m,h);let{area:f,serialResidueIndex:g}=h;return{area:f,serialResidueIndex:g}}function r(m,d){let{elementCount:p,atomicResidueCount:h}=m,{probeSize:f,nonPolymer:g,traceOnly:y,numberOfSpherePoints:x}=d;return{structure:m,probeSize:f,nonPolymer:g,traceOnly:y,spherePoints:n(x),scalingConstant:4*Math.PI/x,maxLookupRadius:2*d.probeSize+2*mh[2],atomRadiusType:new Int8Array(p),serialResidueIndex:new Int32Array(p),area:new Float32Array(h)}}function n(m){let d=[],p=Math.PI*(3-Math.sqrt(5)),h=2/m;for(let f=0;f<m;++f){let g=f*h-1+h/2,y=Math.sqrt(1-g*g),x=f*p;d[d.length]=b.create(Math.cos(x)*y,g,Math.sin(x)*y)}return d}let o;(h=>(h[h.NA=0]="NA",h[h.Buried=1]="Buried",h[h.Accessible=2]="Accessible"))(o=c.Flags||={}),c.Flag={NA:0,Buried:1,Accessible:2};function a(m,d){let p=lV[m]||KAe;return d/p}c.normalize=a;function s(m,d){let{area:p,serialResidueIndex:h}=d,f=h[Be.indexOf(Be.ofSortedArray(m.structure.root.serialMapping.elementIndices),m.element)];return f===-1?-1:p[f]}c.getValue=s;function l(m,d){let p=s(m,d);return p===-1?-1:a(Ke.atom.label_comp_id(m),p)}c.getNormalizedValue=l;function u(m,d){let p=l(m,d);return p===-1?0:p<.16?1:2}c.getFlag=u})(_b||={});var nQ={...rQ},uV={isBuried:NS.Dynamic(T6("computed","accessible-surface-area.is-buried",Me.Bool),e=>{if(!ue.isAtomic(e.element.unit))return!1;let t=Qm.get(e.element.structure).value;return t?_b.getFlag(e.element,t)===_b.Flags.Buried:!1}),isAccessible:NS.Dynamic(T6("computed","accessible-surface-area.is-accessible",Me.Bool),e=>{if(!ue.isAtomic(e.element.unit))return!1;let t=Qm.get(e.element.structure).value;return t?_b.getFlag(e.element,t)===_b.Flags.Accessible:!1})},Qm=Zl.createProvider({label:"Accessible Surface Area",descriptor:{name:"molstar_accessible_surface_area",symbols:uV},type:"root",defaultParams:nQ,getParams:e=>nQ,isApplicable:e=>!0,obtain:async(e,t,r)=>{let n={...C.getDefaultValues(nQ),...r};return{value:await _b.compute(t,n).runInContext(e.runtime)}}});var oQ=16448250,Yst="Assigns a color based on the relative accessible surface area of a residue.",tTe={list:C.ColorList("yellow-green-blue",{presetKind:"scale"})};function Kst(e){return tTe}function rTe(e,t){let r,n=Ja.create({listOrName:t.list.colors,minLabel:"buried",maxLabel:"exposed",domain:[0,1]}),o=e.structure&&Qm.get(e.structure),i=o?$u(o.id,o.version):-1;if(o?.value&&e.structure){let a=Q.Location.create(e.structure),s=o.value,l=u=>{let c=_b.getNormalizedValue(u,s);return c===-1?oQ:n.color(c)};r=u=>Q.Location.is(u)&&ue.isAtomic(u.unit)?l(u):It.isLocation(u)?(a.unit=u.aUnit,a.element=u.aUnit.elements[u.aIndex],l(a)):oQ}else r=()=>oQ;return{factory:rTe,granularity:"group",preferSmoothing:!0,color:r,props:t,contextHash:i,description:Yst,legend:n?n.legend:void 0}}var iQ={name:"accessible-surface-area",label:"Accessible Surface Area",category:yr.Residue,factory:rTe,getParams:Kst,defaultValues:C.getDefaultValues(tTe),isApplicable:e=>!!e.structure,ensureCustomProperties:{attach:(e,t)=>t.structure?Qm.attach(e,t.structure,void 0,!0):Promise.resolve(),detach:e=>e.structure&&Qm.ref(e.structure,!1)}};var iTe=Kr.create({name:"computed-accessible-surface-area-prop",category:"custom-props",display:{name:"Accessible Surface Area"},ctor:class extends Kr.Handler{constructor(){super(...arguments);this.provider=Qm;this.labelProvider={label:t=>{if(this.params.showTooltip)return Jst(t)}}}update(t){let r=this.params.autoAttach!==t.autoAttach||this.params.showTooltip!==t.showTooltip;return this.params.autoAttach=t.autoAttach,this.params.showTooltip=t.showTooltip,this.ctx.customStructureProperties.setDefaultAutoAttach(this.provider.descriptor.name,this.params.autoAttach),r}register(){zI.addCustomProp(this.provider.descriptor),this.ctx.customStructureProperties.register(this.provider,this.params.autoAttach),this.ctx.representation.structure.themes.colorThemeRegistry.add(iQ),this.ctx.managers.lociLabels.addProvider(this.labelProvider),this.ctx.query.structure.registry.add(nTe),this.ctx.query.structure.registry.add(oTe)}unregister(){zI.removeCustomProp(this.provider.descriptor),this.ctx.customStructureProperties.unregister(this.provider.descriptor.name),this.ctx.representation.structure.themes.colorThemeRegistry.remove(iQ),this.ctx.managers.lociLabels.removeProvider(this.labelProvider),this.ctx.query.structure.registry.remove(nTe),this.ctx.query.structure.registry.remove(oTe)}},params:()=>({autoAttach:C.Boolean(!1),showTooltip:C.Boolean(!0)})});function Jst(e){if(e.kind==="element-loci"){if(e.elements.length===0)return;let t=Qm.get(e.structure).value;if(!t||e.structure.customPropertyDescriptors.hasReference(Qm.descriptor))return;let{getSerialIndex:r}=e.structure.root.serialMapping,{area:n,serialResidueIndex:o}=t,i=new Set,a=0;for(let{indices:l,unit:u}of e.elements){let{elements:c}=u;xe.forEach(l,m=>{let d=o[r(u,c[m])];d!==-1&&!i.has(d)&&(a+=n[d],i.add(d))})}return i.size===0?void 0:`Accessible Surface Area ${`<small>(${i.size} ${i.size>1?"Residues sum":"Residue"})</small>`}: ${a.toFixed(2)} \u212B<sup>2</sup>`}else if(e.kind==="structure-loci"){let t=Qm.get(e.structure).value;return!t||e.structure.customPropertyDescriptors.hasReference(Qm.descriptor)?void 0:`Accessible Surface Area <small>(Whole Structure)</small>: ${iU(t.area).toFixed(2)} \u212B<sup>2</sup>`}}var nTe=so("Buried Protein Residues",ie.struct.modifier.union([ie.struct.modifier.wholeResidues([ie.struct.modifier.union([ie.struct.generator.atomGroups({"chain-test":ie.core.rel.eq([ie.ammp("objectPrimitive"),"atomistic"]),"residue-test":uV.isBuried.symbol()})])])]),{description:"Select buried protein residues.",category:"Residue Property",ensureCustomProperties:(e,t)=>Qm.attach(e,t)}),oTe=so("Accessible Protein Residues",ie.struct.modifier.union([ie.struct.modifier.wholeResidues([ie.struct.modifier.union([ie.struct.generator.atomGroups({"chain-test":ie.core.rel.eq([ie.ammp("objectPrimitive"),"atomistic"]),"residue-test":uV.isAccessible.symbol()})])])]),{description:"Select accessible protein residues.",category:"Residue Property",ensureCustomProperties:(e,t)=>Qm.attach(e,t)});function aTe(e){switch(e){case 0:return"Spherical";case 1:return"Terminal";case 2:return"Linear";case 3:return"Trigonal";case 4:return"Tetrahedral";case 5:return"Trigonal Bi-Pyramidal";case 6:return"Octahedral";case 7:return"Square Planar";case 8:return"Unknown"}}function f1(e){switch(e){case 0:return 0;case 1:return 1;case 2:return 2;case 3:return 3;case 4:return 4;default:return 8}}var aQ=new Map([[2,kr(180)],[3,kr(120)],[4,kr(109.4721)],[6,kr(90)]]),cT=b(),uT=b(),dh=b(),zC=b(),jg=b();function mT(e,t,r,n,o,i=!0){let a=[],s=[];return t.conformation.position(t.elements[r],dh),n.conformation.position(n.elements[o],zC),b.sub(cT,zC,dh),Ts(e,t,r,(l,u)=>{An(l,u)!=="H"?(l.conformation.position(l.elements[u],jg),b.sub(uT,jg,dh),a.push(b.angle(cT,uT))):i||(l.conformation.position(l.elements[u],jg),b.sub(uT,jg,dh),s.push(b.angle(cT,uT)))}),[a,s]}function sQ(e,t,r,n,o){t.conformation.position(t.elements[r],dh),n.conformation.position(n.elements[o],zC),b.sub(cT,zC,dh);let i=[b(),b()],a=0,s,l;if(Ts(e,t,r,(u,c)=>{a>1||An(u,c)!=="H"&&(s=u,l=c,u.conformation.position(u.elements[c],jg),b.sub(i[a++],jg,dh))}),a===1&&s&&l&&Ts(e,s,l,(u,c)=>{a>1||u===t&&c===r||An(u,c)!=="H"&&(u.conformation.position(u.elements[c],jg),b.sub(i[a++],jg,dh))}),a===2)return b.cross(uT,i[0],i[1]),Math.abs(Math.PI/2-b.angle(uT,cT))}function sTe(e,t,r,n,o){let i=r;t.conformation.position(t.elements[r],dh),n.conformation.position(n.elements[o],zC),b.sub(cT,zC,dh);let a=b.squaredDistance(dh,zC);return Ts(e,t,r,(s,l)=>{if(An(s,l)==="H"){s.conformation.position(s.elements[l],jg);let u=b.squaredDistance(jg,zC);u<a&&(a=u,i=l)}}),i}var lQ=new It.ElementBondIterator,uQ=new It.ElementBondIterator;function elt(e,t,r){let n=An(t,r),o=n==="O"||n==="N";if(o&&$c(e,t,r)===4)return!1;for(lQ.setElement(e,t,r);lQ.hasNext;){let i=lQ.move();if(i.order>1)return!0;if(o){let a=An(i.otherUnit,i.otherIndex);for(uQ.setElement(e,i.otherUnit,i.otherIndex);uQ.hasNext;){let s=uQ.move();if(s.order>1){if((a==="P"||a==="S")&&An(s.otherUnit,s.otherIndex)==="O")continue;return!0}}}}return!1}function tlt(e,t,r){let n=0,{offset:o,edgeProps:{flags:i,order:a}}=t.bonds;for(let s=o[r],l=o[r+1];s<l;++s)xt.isCovalent(i[s])&&(n+=a[s]);return e.interUnitBonds.getEdgeIndices(r,t.id).forEach(s=>{let l=e.interUnitBonds.edges[s];xt.isCovalent(l.props.flag)&&(n+=l.props.order)}),n}var dT=new It.ElementBondIterator,cQ=new It.ElementBondIterator;function rlt(e,t,r,n,o){let i=fu(e,t,r,"H"),a=An(t,r),s=KF(t,r),l=n.assignCharge==="always"||n.assignCharge==="auto"&&s===0,u=n.assignH==="always"||n.assignH==="auto"&&!o&&i===0,c=$c(e,t,r),m=tlt(e,t,r),d=elt(e,t,r),p=m-c>0,h=0,f=8;switch(a){case"H":l&&(c===0?(s=1,f=0):c===1&&(s=0,f=1));break;case"C":l&&(s=0),u&&(h=Math.max(0,4-m-Math.abs(s))),f=f1(c+h+Math.max(0,-s));break;case"N":if(l)if(!u)s=m-3;else if(d&&m<4)c-i===1&&m-i===2?s=1:s=0;else for(dT.setElement(e,t,r);dT.hasNext;){let g=dT.move(),y=An(g.otherUnit,g.otherIndex);if(y==="S"||Bme(y)){s=0;break}else s=1}u&&(h=Math.max(0,3-m+s)),d&&!p?f=f1(c+h-s):f=f1(c+h+1-s);break;case"O":if(l&&(u||(s=m-2),m===1)){dT.setElement(e,t,r);e:for(;dT.hasNext;){let g=dT.move();for(cQ.setElement(e,g.otherUnit,g.otherIndex);cQ.hasNext;){let y=cQ.move();if(!(y.otherUnit===t&&y.otherIndex===r)&&An(y.otherUnit,y.otherIndex)==="O"&&y.order===2){s=-1;break e}}}}u&&(h=Math.max(0,2-m+s)),d&&!p?f=f1(c+h-s+1):f=f1(c+h-s+2);break;case"S":l&&(u||(m<=3&&fu(e,t,r,"O")===0?s=m-2:s=0)),u&&m<2&&(h=Math.max(0,2-m+s)),m<=3&&(f=f1(c+h-s+2));break;case"F":case"CL":case"BR":case"I":case"AT":l&&(s=m-1);break;case"LI":case"NA":case"K":case"RB":case"CS":case"FR":l&&(s=1-m);break;case"BE":case"MG":case"CA":case"SR":case"BA":case"RA":l&&(s=2-m);break;default:Yt&&console.warn("Requested charge, protonation for an unhandled element",a)}return[s,h,h+i,f]}function nlt(e,t,r){let n=t.elements.length,o=new Int8Array(n),i=new Int8Array(n),a=new Int8Array(n),s=new Int8Array(n),l=!!e.parent,u;if(l){let m=e.root.unitMap.get(t.id);if(u=Be.indicesOf(m.elements,t.elements),u.length!==t.elements.length)throw new Error("expected to find an index for every element");t=m,e=e.root}let c=!1;for(let m=0;m<n;++m){let d=l?u[m]:m;if(An(t,d)==="H"){c=!0;break}}for(let m=0;m<n;++m){let d=l?u[m]:m,[p,h,f,g]=rlt(e,t,d,r,c);o[m]=p,i[m]=h,a[m]=f,s[m]=g}return{charge:o,implicitH:i,totalH:a,idealGeometry:s}}var mQ={assignCharge:C.Select("auto",[["always","always"],["auto","auto"],["never","never"]]),assignH:C.Select("auto",[["always","always"],["auto","auto"],["never","never"]])};async function lTe(e,t,r){let n={...C.getDefaultValues(mQ),...r},o=new Map,i=`valence-model-${JSON.stringify(n)}`;for(let a=0,s=t.units.length;a<s;++a){let l=t.units[a];if(ue.isAtomic(l)){let u;l.transientCache.has(i)?u=l.transientCache.get(i):(u=nlt(t,l,n),l.transientCache.set(i,u)),o.set(l.id,u)}}return o}var dQ={...mQ},Wg=Zl.createProvider({label:"Valence Model",descriptor:{name:"molstar_computed_valence_model"},type:"local",defaultParams:dQ,getParams:e=>dQ,isApplicable:e=>!0,obtain:async(e,t,r)=>{let n={...C.getDefaultValues(dQ),...r};return{value:await lTe(e.runtime,t,n)}}});var Ho;(c=>{function e(m,d,p,h){return b.set(m,h.x[p],h.y[p],h.z[p]),b.transformMat4(m,m,d.conformation.operator.matrix),m}c.setPosition=e;function t(m,d){let p=new Int32Array(d+1),h=new Int32Array(d),f=new Int32Array(d),{members:g,count:y,offsets:x}=m;for(let v=0,A=x[y];v<A;++v)++f[g[v]];let S=0;for(let v=0;v<d;v++)p[v]=S,S+=f[v];p[d]=S;let I=new Int32Array(S);for(let v=0;v<y;++v)for(let A=x[v],P=x[v+1];A<P;++A){let T=g[A],R=p[T]+h[T];I[R]=v,++h[T]}return{indices:I,offsets:p}}c.createElementsIndex=t;function r(m,d){let p,h;return{...d,get lookup3d(){if(!p){let f={x:d.x,y:d.y,z:d.z,indices:xe.ofBounds(0,d.count)};p=zc(f,Hf(f))}return p},get elementsIndex(){return h||(h=t(d,m))},subset:f=>n(d,f)}}c.create=r;function n(m,d){let p,{count:h,types:f}=m,g=[];for(let x=0;x<h;++x)d.has(f[x])&&g.push(x);let y=Be.ofSortedArray(g);return{indices:y,get lookup3d(){if(!p){let x={x:m.x,y:m.y,z:m.z,indices:y};p=zc(x,Hf(x))}return p}}}c.createSubset=n;function o(m,d,p){let h=Wg.get(m).value;if(!h||!h.has(d.id))throw new Error("valence model required");return{unit:d,types:p.types,feature:-1,x:p.x,y:p.y,z:p.z,members:p.members,offsets:p.offsets,idealGeometry:h.get(d.id).idealGeometry}}c.Info=o;function i(m,d){return b.set(m,d.x[d.feature],d.y[d.feature],d.z[d.feature]),b.transformMat4(m,m,d.unit.conformation.operator.matrix),m}c.position=i;let a=b(),s=b();function l(m,d){let p=m.members[m.offsets[m.feature]],h=d.members[d.offsets[d.feature]];return m.unit.conformation.position(m.unit.elements[p],a),d.unit.conformation.position(d.unit.elements[h],s),b.distance(a,s)}c.distance=l;function u(m,d){return{types:new Set(m),add:d}}c.Provider=u})(Ho||={});var pQ;(t=>{function e(r=2048,n=1024,o){let i=qe.create(Float32Array,1,n,o?o.x:r),a=qe.create(Float32Array,1,n,o?o.y:r),s=qe.create(Float32Array,1,n,o?o.z:r),l=qe.create(Uint8Array,1,n,o?o.types:r),u=qe.create(Uint8Array,1,n,o?o.groups:r),c=qe.create(Uint32Array,1,n,o?o.offsets:r),m=qe.create(Uint32Array,1,n,o?o.members:r),d={x:0,y:0,z:0,offset:0,count:0};return{startState:()=>{d.x=0,d.y=0,d.z=0,d.offset=m.elementCount,d.count=0},pushMember:(p,h,f,g)=>{qe.add(m,g),d.x+=p,d.y+=h,d.z+=f,d.count+=1},finishState:(p,h)=>{let{count:f}=d;f!==0&&(qe.add(l,p),qe.add(u,h),qe.add(i,d.x/f),qe.add(a,d.y/f),qe.add(s,d.z/f),qe.add(c,d.offset))},add:(p,h,f,g,y,x)=>{qe.add(l,p),qe.add(u,h),qe.add(i,f),qe.add(a,g),qe.add(s,y),qe.add(c,m.elementCount),qe.add(m,x)},getFeatures:p=>{qe.add(c,m.elementCount);let h=qe.compact(i,!0),f=qe.compact(a,!0),g=qe.compact(s,!0),y=i.elementCount;return Ho.create(p,{x:h,y:f,z:g,count:y,types:qe.compact(l,!0),groups:qe.compact(u,!0),offsets:qe.compact(c,!0),members:qe.compact(m,!0)})}}}t.create=e})(pQ||={});var fQ;(t=>{function e(r,n,o){let i=new Int32Array(o+1),a=new Int32Array(o),s=new Int32Array(o),{members:l,offsets:u}=n;for(let d=0,p=r.edgeCount*2;d<p;++d){let h=r.a[d],f=r.b[d];if(!(h>f)){for(let g=u[h],y=u[h+1];g<y;++g)++s[l[g]];for(let g=u[f],y=u[f+1];g<y;++g)++s[l[g]]}}let c=0;for(let d=0;d<o;d++)i[d]=c,c+=s[d];i[o]=c;let m=new Int32Array(c);for(let d=0,p=r.edgeCount*2;d<p;++d){let h=r.a[d],f=r.b[d];if(!(h>f)){for(let g=u[h],y=u[h+1];g<y;++g){let x=l[g],S=i[x]+a[x];m[S]=d,++a[x]}for(let g=u[f],y=u[f+1];g<y;++g){let x=l[g],S=i[x]+a[x];m[S]=d,++a[x]}}}return{indices:m,offsets:i}}t.createElementsIndex=e})(fQ||={});var cV=class extends Ad{getContactIndicesForElement(t,r){return this.elementKeyIndex.get(this.getElementKey(t,r.id))||[]}getElementKey(t,r){return`${t}|${r}`}constructor(t,r){super(t),this.elementKeyIndex=new Map;for(let n=0,o=this.edges.length;n<o;++n){let{unitA:i,indexA:a}=this.edges[n],{offsets:s,members:l}=r.get(i);for(let u=s[a],c=s[a+1];u<c;++u){let m=this.getElementKey(l[u],i),d=this.elementKeyIndex.get(m);d===void 0?this.elementKeyIndex.set(m,[n]):d.push(n)}}}};function hQ(e){switch(e){case 4:return"Hydrogen Bond";case 6:return"Hydrophobic Contact";case 5:return"Halogen Bond";case 1:return"Ionic Interaction";case 7:return"Metal Coordination";case 2:return"Cation-Pi Interaction";case 3:return"Pi Stacking";case 8:return"Weak Hydrogen Bond";case 0:return"Unknown Interaction"}}function uTe(e){switch(e){case 0:return"None";case 1:return"Positive Charge";case 2:return"Negative Charge";case 3:return"Aromatic Ring";case 4:return"Hydrogen Donor";case 5:return"Hydrogen Acceptor";case 6:return"Halogen Donor";case 7:return"Halogen Acceptor";case 8:return"HydrophobicAtom";case 9:return"Weak Hydrogen Donor";case 10:return"Ionic Type Partner";case 11:return"Dative Bond Partner";case 12:return"Transition Metal";case 13:return"Ionic Type Metal"}}function cTe(e){switch(e){case 0:return"None";case 1:return"Quaternary Amine";case 2:return"Tertiary Amine";case 3:return"Sulfonium";case 4:return"Sulfonic Acid";case 5:return"Sulfate";case 6:return"Phosphate";case 7:return"Halocarbon";case 8:return"Guanidine";case 9:return"Acetamidine";case 10:return"Carboxylate"}}var yQ;(t=>{function e(r,n){let o=[],i=[],a=[];return{add(s,l,u){o[o.length]=s,i[i.length]=l,a[a.length]=u},getContacts(){let s=new xs.EdgeBuilder(r.count,o,i),l=new Int8Array(s.slotCount),u=new Int8Array(s.slotCount);for(let p=0,h=s.edgeCount;p<h;p++)s.addNextEdge(),s.assignProperty(l,a[p]);let c=s.createGraph({type:l,flag:u}),m;return Object.defineProperty(c,"elementsIndex",{get:()=>m||(m=fQ.createElementsIndex(c,r,n))})}}}t.create=e})(yQ||={});var bQ;(t=>{function e(){let r=new Ad.Builder;return{startUnitPair(n,o){r.startUnitPair(n.id,o.id)},finishUnitPair(){r.finishUnitPair()},add(n,o,i){r.add(n,o,{type:i,flag:0})},getContacts(n){return new cV(r.getMap(),n)}}}t.create=e})(bQ||={});var pTe={lineOfSightDistFactor:C.Numeric(1,{min:0,max:3,step:.1})},olt=3;function fTe(e,t,r){let n=t.members[t.offsets[t.feature]],o=r.members[r.offsets[r.feature]];if(n===o&&t.unit===r.unit)return!1;let i=NR(t.unit,n),a=NR(r.unit,o);return!(i&&a&&i!==a||t.unit===r.unit&&t.unit.model.atomicHierarchy.residueAtomSegments.count>1&&t.unit.residueIndex[t.unit.elements[n]]===r.unit.residueIndex[r.unit.elements[o]]||pve(e,t.unit,n,r.unit,o))}function mTe(e,t,r,n){let o=NR(e,t),i=NR(r,n);return o&&i&&o!==i}function dTe(e,t){let{feature:r,offsets:n,members:o}=t;for(let i=n[r],a=n[r+1];i<a;++i)if(o[i]===e)return!0;return!1}var HC=b(),xQ=b(),CQ=b(),ilt=kI();function hTe(e,t,r,n){let o=t.feature,i=r.feature,a=t.members[t.offsets[o]],s=r.members[r.offsets[i]];Ho.position(xQ,t),Ho.position(CQ,r),b.scale(HC,b.add(HC,xQ,CQ),.5);let l=n*olt,{count:u,indices:c,units:m,squaredDistances:d}=e.lookup3d.find(HC[0],HC[1],HC[2],l,ilt);if(u===0)return!0;for(let p=0;p<u;++p){let h=c[p],f=m[p];if(!ue.isAtomic(f))continue;let g=An(f,h);if(g==="H")continue;let y=Dm(g);if(!(y*y*n*n<=d[p])&&!(mTe(f,h,t.unit,a)||mTe(f,h,r.unit,s))&&!(t.unit===f&&dTe(h,t)||r.unit===f&&dTe(h,r))&&(f.conformation.position(f.elements[h],HC),!(b.squaredDistance(HC,xQ)<1||b.squaredDistance(HC,CQ)<1)))return!1}return!0}function gTe(e,t,r,n,o,i){for(let a of o)alt(e,t,r,n,a,i)}function alt(e,t,r,n,o,i){let{x:a,y:s,z:l}=r,{lookup3d:u,indices:c}=r.subset(o.requiredFeatures),m=Ho.Info(e,t,r),d={...m},p=i.lineOfSightDistFactor;for(let h=0,f=xe.size(c);h<f;++h){let g=xe.getAt(c,h),{count:y,indices:x,squaredDistances:S}=u.find(a[g],s[g],l[g],o.maxDistance);if(y!==0){m.feature=g;for(let I=0;I<y;++I){let v=xe.getAt(c,x[I]);if(v<=g||(d.feature=v,!fTe(e,m,d)))continue;let A=o.getType(e,m,d,S[I]);A&&hTe(e,m,d,p)&&n.add(g,v,A)}}}}var slt=H();function yTe(e,t,r,n,o,i,a,s){let{count:l,x:u,y:c,z:m}=r,{lookup3d:d}=o,p=H.mul(slt,n.conformation.operator.inverse,t.conformation.operator.matrix),h=!H.isIdentity(p),f=b(),g=Math.max(...a.map(P=>P.maxDistance)),{center:y,radius:x}=d.boundary.sphere,S=(x+g)*(x+g),I=s.lineOfSightDistFactor,v=Ho.Info(e,t,r),A=Ho.Info(e,n,o);i.startUnitPair(t,n);for(let P=0;P<l;++P){if(b.set(f,u[P],c[P],m[P]),h&&b.transformMat4(f,f,p),b.squaredDistance(f,y)>S)continue;let{indices:T,count:R,squaredDistances:w}=d.find(f[0],f[1],f[2],g);if(R!==0){v.feature=P;for(let E=0;E<R;++E){let M=T[E];if(A.feature=M,!fTe(e,v,A))continue;let D=w[E];for(let B of a)if(D<B.maxDistance*B.maxDistance){let k=B.getType(e,v,A,D);if(k&&hTe(e,v,A,I)){i.add(P,M,k);break}}}}}i.finishUnitPair()}var llt={distanceMax:C.Numeric(4,{min:1,max:5,step:.1}),angleMax:C.Numeric(30,{min:0,max:60,step:1})},ult=["CL","BR","I","AT"];function clt(e,t,r){let{elements:n}=t,{x:o,y:i,z:a}=t.model.atomicConformation;for(let s=0,l=n.length;s<l;++s){let u=An(t,s);ult.includes(u)&&r.add(6,0,o[n[s]],i[n[s]],a[n[s]],s)}}var mlt=["N","O","S"],dlt=["C","N","P","S"];function plt(e,t,r){let{elements:n}=t,{x:o,y:i,z:a}=t.model.atomicConformation;for(let s=0,l=n.length;s<l;++s){let u=An(t,s);if(mlt.includes(u)){let c=!1;Ts(e,t,s,(m,d)=>{dlt.includes(An(m,d))&&(c=!0)}),c&&r.add(7,0,o[n[s]],i[n[s]],a[n[s]],s)}}}function flt(e,t){return e===7&&t===6||e===6&&t===7}var hlt=kr(180),glt=kr(120);function ylt(e){return{angleMax:kr(e.angleMax)}}function blt(e,t,r,n){let o=t.types[t.feature],i=r.types[r.feature];if(!flt(o,i))return;let[a,s]=o===6?[t,r]:[r,t],l=a.members[a.offsets[a.feature]],u=s.members[s.offsets[s.feature]],[c]=mT(e,a.unit,l,s.unit,u);if(c.length!==1||hlt-c[0]>n.angleMax)return;let[m]=mT(e,s.unit,u,a.unit,l);if(m.length!==0&&!m.some(d=>glt-d>n.angleMax))return 5}var bTe=Ho.Provider([6],clt),xTe=Ho.Provider([7],plt),CTe={name:"halogen-bonds",params:llt,createTester:e=>{let t=ylt(e);return{maxDistance:e.distanceMax,requiredFeatures:new Set([6,7]),getType:(r,n,o)=>blt(r,n,o,t)}}};var ATe={distanceMax:C.Numeric(3.5,{min:1,max:5,step:.1}),backbone:C.Boolean(!0,{description:"Include backbone-to-backbone hydrogen bonds"}),accAngleDevMax:C.Numeric(45,{min:0,max:180,step:1},{description:"Max deviation from ideal acceptor angle"}),ignoreHydrogens:C.Boolean(!1,{description:"Ignore explicit hydrogens in geometric constraints"}),donAngleDevMax:C.Numeric(45,{min:0,max:180,step:1},{description:"Max deviation from ideal donor angle"}),accOutOfPlaneAngleMax:C.Numeric(90,{min:0,max:180,step:1}),donOutOfPlaneAngleMax:C.Numeric(45,{min:0,max:180,step:1})},xlt={...ATe,water:C.Boolean(!1,{description:"Include water-to-water hydrogen bonds"}),sulfurDistanceMax:C.Numeric(4.1,{min:1,max:5,step:.1})},Clt={...ATe};function SQ(e,t){let r=Wg.get(e).value;if(!r)throw Error("expected valence model to be available");let n=r.get(t.id);if(!n)throw Error("expected valence model for unit to be available");return n}function Slt(e,t,r){let{totalH:n}=SQ(e,t),{elements:o}=t,{x:i,y:a,z:s}=t.model.atomicConformation;for(let l=0,u=o.length;l<u;++l){let c=An(t,l);(TTe(t,l)||n[l]>0&&(c==="N"||c==="O"||c==="S"))&&r.add(4,0,i[o[l]],a[o[l]],s[o[l]],l)}}function vlt(e,t,r){let{totalH:n}=SQ(e,t),{elements:o}=t,{x:i,y:a,z:s}=t.model.atomicConformation;for(let l=0,u=o.length;l<u;++l)An(t,l)==="C"&&n[l]>0&&(fu(e,t,l,"N")>0||fu(e,t,l,"O")>0||Ilt(t,l))&&r.add(9,0,i[o[l]],a[o[l]],s[o[l]],l)}function Ilt(e,t){let{elementAromaticRingIndices:r,all:n}=e.rings,o=r.get(t);if(o===void 0)return!1;for(let i=0,a=o.length;i<a;++i){let s=n[o[i]];for(let l=0,u=s.length;l<u;++l){let c=An(e,s[l]);if(c==="N"||c==="O")return!0}}return!1}function Alt(e,t,r){let{charge:n,implicitH:o,idealGeometry:i}=SQ(e,t),{elements:a}=t,{x:s,y:l,z:u}=t.model.atomicConformation,c=m=>{r.add(5,0,s[a[m]],l[a[m]],u[a[m]],m)};for(let m=0,d=a.length;m<d;++m){let p=An(t,m);if(p==="O")c(m);else if(p==="N"){if(TTe(t,m))c(m);else if(n[m]<1){let h=$c(e,t,m)+o[m],f=i[m];(f===4&&h<4||f===3&&h<3||f===2&&h<2)&&c(m)}}else if(p==="S"){let h=zR(t,m);(h==="CYS"||h==="MET"||KF(t,m)===-1)&&c(m)}}}function STe(e,t){return e.model.atomicHierarchy.derived.residue.moleculeType[e.residueIndex[e.elements[t]]]===2}function vTe(e,t){return Id.has(EC(e,t))}function Tlt(e,t){return e.rings.elementRingIndices.has(t)}function TTe(e,t){return zR(e,t)==="HIS"&&An(e,t)==="N"&&Tlt(e,t)}function Plt(e,t,r,n){return vTe(e,t)&&vTe(r,n)}function _lt(e,t,r,n){return STe(e,t)&&STe(r,n)}function Rlt(e,t){return e===5&&t===4||e===4&&t===5}function Dlt(e,t){return e===9&&t===5||e===5&&t===9}function PTe(e){return{ignoreHydrogens:e.ignoreHydrogens,includeBackbone:e.backbone,maxAccAngleDev:kr(e.accAngleDevMax),maxDonAngleDev:kr(e.donAngleDevMax),maxAccOutOfPlaneAngle:kr(e.accOutOfPlaneAngleMax),maxDonOutOfPlaneAngle:kr(e.donOutOfPlaneAngleMax)}}function wlt(e){return{...PTe(e),includeWater:e.water,maxSulfurDistSq:e.sulfurDistanceMax*e.sulfurDistanceMax,maxDistSq:e.distanceMax*e.distanceMax}}var ITe=kr(120);function _Te(e,t,r,n){let o=t.members[t.offsets[t.feature]],i=r.members[r.offsets[r.feature]];if(!n.includeBackbone&&Plt(t.unit,o,r.unit,i))return;let[a,s]=mT(e,t.unit,o,r.unit,i,n.ignoreHydrogens),l=aQ.get(t.idealGeometry[o])||ITe;if(a.some(p=>Math.abs(l-p)>n.maxDonAngleDev)||s.length&&!s.some(p=>p<n.maxDonAngleDev))return;if(t.idealGeometry[o]===3){let p=sQ(e,t.unit,o,r.unit,i);if(p!==void 0&&p>n.maxDonOutOfPlaneAngle)return}let u=o;!n.ignoreHydrogens&&s.length>0&&(u=sTe(e,t.unit,o,r.unit,i));let[c,m]=mT(e,r.unit,i,t.unit,u,n.ignoreHydrogens),d=aQ.get(r.idealGeometry[i])||ITe;if(!c.some(p=>d-p>n.maxAccAngleDev)&&!m.some(p=>d-p>n.maxAccAngleDev)){if(r.idealGeometry[i]===3){let p=sQ(e,r.unit,i,t.unit,o);if(p!==void 0&&p>n.maxAccOutOfPlaneAngle)return}return!0}}function Mlt(e,t,r,n,o){let i=t.types[t.feature],a=r.types[r.feature];if(!Rlt(i,a))return;let[s,l]=a===5?[t,r]:[r,t],u=s.members[s.offsets[s.feature]],c=l.members[l.offsets[l.feature]],m=An(s.unit,u)==="S"||An(l.unit,c)==="S"?o.maxSulfurDistSq:o.maxDistSq;if(!(n>m)&&!(!o.includeWater&&_lt(s.unit,u,l.unit,c))&&_Te(e,s,l,o))return 4}function Blt(e,t,r,n,o){let i=t.types[t.feature],a=r.types[r.feature];if(!Dlt(i,a))return;let[s,l]=a===5?[t,r]:[r,t];if(_Te(e,s,l,o))return 8}var RTe=Ho.Provider([4],Slt),DTe=Ho.Provider([9],vlt),wTe=Ho.Provider([5],Alt),MTe={name:"hydrogen-bonds",params:xlt,createTester:e=>{let t=Math.max(e.distanceMax,e.sulfurDistanceMax),r=wlt(e);return{maxDistance:t,requiredFeatures:new Set([4,5]),getType:(n,o,i,a)=>Mlt(n,o,i,a,r)}}},BTe={name:"weak-hydrogen-bonds",params:Clt,createTester:e=>{let t=PTe(e);return{maxDistance:e.distanceMax,requiredFeatures:new Set([9,5]),getType:(r,n,o,i)=>Blt(r,n,o,i,t)}}};var Elt={distanceMax:C.Numeric(5,{min:0,max:8,step:.1})},klt={distanceMax:C.Numeric(5.5,{min:1,max:8,step:.1}),offsetMax:C.Numeric(2,{min:0,max:4,step:.1}),angleDevMax:C.Numeric(30,{min:0,max:180,step:1})},Flt={distanceMax:C.Numeric(6,{min:1,max:8,step:.1}),offsetMax:C.Numeric(2,{min:0,max:4,step:.1})},Llt=["ARG","HIS","LYS"],Vlt=["GLU","ASP"];function LTe(e,t){let r=Wg.get(e).value;if(!r)throw Error("expected valence model to be available");let n=r.get(t.id);if(!n)throw Error("expected valence model for unit to be available");return n}function Olt(e,t,r){let{charge:n}=LTe(e,t),{elements:o}=t,{x:i,y:a,z:s}=t.model.atomicConformation,l=new Set,{label_comp_id:u}=t.model.atomicHierarchy.atoms,c=Kt.transientSegments(t.model.atomicHierarchy.residueAtomSegments,o);for(;c.hasNext;){let{index:m,start:d,end:p}=c.move(),h=u.value(t.model.atomicHierarchy.residueAtomSegments.offsets[m]);if(Llt.includes(h)){r.startState();for(let f=d;f<p;++f)An(t,f)==="N"&&!Id.has(EC(t,f))&&r.pushMember(i[o[f]],a[o[f]],s[o[f]],f);r.finishState(1,0)}else if(!Zy.has(h)){l.clear();for(let f=d;f<p;++f){let g=0;yve(e,t,f)?g=8:bve(e,t,f)&&(g=9),g&&(r.startState(),Ts(e,t,f,(y,x)=>{An(t,x)==="N"&&(l.add(x),r.pushMember(i[o[x]],a[o[x]],s[o[x]],x))}),r.finishState(1,g))}for(let f=d;f<p;++f)n[f]>0&&!l.has(f)&&r.add(1,0,i[o[f]],a[o[f]],s[o[f]],f)}}}function Glt(e,t,r){let{charge:n}=LTe(e,t),{elements:o}=t,{x:i,y:a,z:s}=t.model.atomicConformation,l=new Set,{label_comp_id:u}=t.model.atomicHierarchy.atoms,c=Kt.transientSegments(t.model.atomicHierarchy.residueAtomSegments,o);for(;c.hasNext;){let{index:m,start:d,end:p}=c.move(),h=u.value(t.model.atomicHierarchy.residueAtomSegments.offsets[m]);if(Vlt.includes(h)){r.startState();for(let f=d;f<p;++f)An(t,f)==="O"&&!Id.has(EC(t,f))&&r.pushMember(i[o[f]],a[o[f]],s[o[f]],f);r.finishState(2,0)}else if(BS.has(h))for(let f=d;f<p;++f)sX(e,t,f)&&(r.startState(),Ts(e,t,f,(g,y)=>{An(t,y)==="O"&&r.pushMember(i[o[y]],a[o[y]],s[o[y]],y)}),r.finishState(2,6));else if(!Zy.has(h)){for(let f=d;f<p;++f){r.startState(),An(t,f)==="N"&&!Id.has(EC(t,f))&&r.pushMember(i[o[f]],a[o[f]],s[o[f]],f),r.finishState(2,0);let g=0;fve(e,t,f)?g=4:sX(e,t,f)?g=6:hve(e,t,f)?g=5:gve(e,t,f)&&(g=10),g&&(r.startState(),Ts(e,t,f,(y,x)=>{An(t,x)==="O"&&(l.add(x),r.pushMember(i[o[x]],a[o[x]],s[o[x]],x))}),r.finishState(2,g))}for(let f=d;f<p;++f)n[f]<0&&!l.has(f)&&r.add(2,0,i[o[f]],a[o[f]],s[o[f]],f)}}}function Ult(e,t,r){let{elements:n}=t,{x:o,y:i,z:a}=t.model.atomicConformation;for(let s of t.rings.aromaticRings){let l=t.rings.all[s];r.startState();for(let u=0,c=l.length;u<c;++u){let m=l[u];r.pushMember(o[n[m]],i[n[m]],a[n[m]],m)}r.finishState(3,0)}}function Nlt(e,t){return e===2&&t===1||e===1&&t===2}function zlt(e,t){return e===3&&t===3}function Hlt(e,t){return e===3&&t===1||e===1&&t===3}var ETe=b(),kTe=b();function jlt(e,t,r){let{feature:n,offsets:o,members:i}=e,{feature:a,offsets:s,members:l}=t;for(let u=o[n],c=o[n+1];u<c;++u){let m=i[u];e.unit.conformation.position(e.unit.elements[m],ETe);for(let d=s[a],p=s[a+1];d<p;++d){let h=l[d];if(t.unit.conformation.position(t.unit.elements[h],kTe),b.squaredDistance(ETe,kTe)<r)return!0}}return!1}var pV=b(),pT=b(),fV=b(),dV=b();function IQ(e,t){let{unit:r,feature:n,offsets:o,members:i}=t,{elements:a}=r,s=o[n];return t.unit.conformation.position(a[i[s]],pV),t.unit.conformation.position(a[i[s+1]],pT),t.unit.conformation.position(a[i[s+2]],fV),b.triangleNormal(e,pV,pT,fV)}var AQ=function(e,t,r){return Ho.position(pV,e),Ho.position(pT,t),b.sub(fV,pV,pT),b.projectOnPlane(dV,fV,r),b.add(dV,dV,pT),b.distance(dV,pT)};function Wlt(e){return{distanceMaxSq:e.distanceMax*e.distanceMax}}function Xlt(e){return{offsetMax:e.offsetMax,angleDevMax:kr(e.angleDevMax)}}function Qlt(e){return{offsetMax:e.offsetMax}}var Zlt=kr(180),FTe=kr(90),tD=b(),vQ=b();function qlt(e,t,r,n,o){let i=t.types[t.feature],a=r.types[r.feature];if(Nlt(i,a)&&jlt(t,r,o.distanceMaxSq))return 1}function Ylt(e,t,r,n,o){let i=t.types[t.feature],a=r.types[r.feature];if(zlt(i,a)){IQ(tD,t),IQ(vQ,r);let s=b.angle(tD,vQ);if(Math.min(AQ(t,r,vQ),AQ(r,t,tD))<=o.offsetMax){if(s<=o.angleDevMax||s>=Zlt-o.angleDevMax)return 3;if(s<=o.angleDevMax+FTe&&s>=FTe-o.angleDevMax)return 3}}}function Klt(e,t,r,n,o){let i=t.types[t.feature],a=r.types[r.feature];if(Hlt(i,a)){let[s,l]=i===3?[t,r]:[r,t];if(IQ(tD,s),AQ(l,s,tD)<=o.offsetMax)return 2}}var VTe=Ho.Provider([2],Glt),OTe=Ho.Provider([1],Olt),GTe=Ho.Provider([3],Ult),UTe={name:"ionic",params:Elt,createTester:e=>{let t=Wlt(e);return{maxDistance:e.distanceMax,requiredFeatures:new Set([2,1]),getType:(r,n,o,i)=>qlt(r,n,o,i,t)}}},NTe={name:"pi-stacking",params:klt,createTester:e=>{let t=Xlt(e);return{maxDistance:e.distanceMax,requiredFeatures:new Set([3]),getType:(r,n,o,i)=>Ylt(r,n,o,i,t)}}},zTe={name:"cation-pi",params:Flt,createTester:e=>{let t=Qlt(e);return{maxDistance:e.distanceMax,requiredFeatures:new Set([3,1]),getType:(r,n,o,i)=>Klt(r,n,o,i,t)}}};var Jlt={distanceMax:C.Numeric(4,{min:1,max:5,step:.1})};function $lt(e,t,r){let{elements:n}=t,{x:o,y:i,z:a}=t.model.atomicConformation;for(let s=0,l=n.length;s<l;++s){let u=An(t,s),c=!1;u==="C"?(c=!0,Ts(e,t,s,(m,d)=>{let p=An(m,d);p!=="C"&&p!=="H"&&(c=!1)})):u==="F"&&(c=!0),c&&r.add(8,0,o[n[s]],i[n[s]],a[n[s]],s)}}function eut(e,t){return e===8&&t===8}function tut(e,t,r,n){let o=t.types[t.feature],i=r.types[r.feature];if(!eut(o,i))return;let a=t.members[t.offsets[t.feature]],s=r.members[r.offsets[r.feature]];if(!(An(t.unit,a)==="F"&&An(r.unit,s)==="F"))return 6}var HTe=Ho.Provider([8],$lt),jTe={name:"hydrophobic",params:Jlt,createTester:e=>({maxDistance:e.distanceMax,requiredFeatures:new Set([8]),getType:(t,r,n,o)=>tut(t,r,n,o)})};var rut={distanceMax:C.Numeric(3,{min:1,max:5,step:.1})},nut=["LI","NA","K","RB","CS","MG","CA","SR","BA","AL","GA","IN","TL","SC","SN","PB","BI","SB","HG"];function out(e,t,r){let{elements:n}=t,{x:o,y:i,z:a}=t.model.atomicConformation;for(let s=0,l=n.length;s<l;++s){let u=An(t,s),c=0;nut.includes(u)?c=13:(E6(u)||u==="ZN"||u==="CD")&&(c=12),c&&r.add(c,0,o[n[s]],i[n[s]],a[n[s]],s)}}function WTe(e){return!Id.has(e)}function iut(e){return Id.has(e)}function aut(e){return CI.has(e)}function sut(e,t,r){let{elements:n}=t,{x:o,y:i,z:a}=t.model.atomicConformation;for(let s=0,l=n.length;s<l;++s){let u=An(t,s),c=zR(t,s),m=EC(t,s),d=!1,p=!1,h=MS.has(c),f=BS.has(c);!h&&!f?B6(u)||u==="O"||u==="S"?(d=!0,p=!0):u==="N"&&(d=!0):h?u==="O"?(["ASP","GLU","SER","THR","TYR","ASN","GLN"].includes(c)&&WTe(m)||iut(m))&&(d=!0,p=!0):u==="S"&&(c==="CYS"||c==="MET")?(d=!0,p=!0):u==="N"&&c==="HIS"&&WTe(m)&&(d=!0):f&&(u==="O"&&aut(m)?(d=!0,p=!0):["N3","N4","N7"].includes(m)?d=!0:["O2","O4","O6"].includes(m)&&(d=!0,p=!0)),d&&r.add(11,0,o[n[s]],i[n[s]],a[n[s]],s),p&&r.add(10,0,o[n[s]],i[n[s]],a[n[s]],s)}}function XTe(e,t){if(e===12)return t===11||t===12;if(e===13)return t===10}function lut(e,t,r,n){let o=t.types[t.feature],i=r.types[r.feature];if(!(!XTe(o,i)&&!XTe(i,o)))return 7}var QTe=Ho.Provider([13,12],out),ZTe=Ho.Provider([10,11],sut),qTe={name:"metal-coordination",params:rut,createTester:e=>({maxDistance:e.distanceMax,requiredFeatures:new Set([13,12,10,11]),getType:(t,r,n,o)=>lut(t,r,n,o)})};function YTe(e,t){let{contacts:r,unitsContacts:n,unitsFeatures:o}=t,i=[uut(e,t),cut(e,t),mut(e,t),dut(e,t),put(e,t)];for(let s=0,l=r.edgeCount;s<l;++s){let u=r.edges[s],c=e.unitMap.get(u.unitA),m=e.unitMap.get(u.unitB),d=Ho.Info(e,c,o.get(u.unitA));d.feature=u.indexA;let p=Ho.Info(e,m,o.get(u.unitB));p.feature=u.indexB;for(let h of i)h.isApplicable(u.props.type)&&h.handleInterContact(s,d,p)}let a=n.keys();for(;;){let{done:s,value:l}=a.next();if(s)break;let u=n.get(l),c=o.get(l),m=e.unitMap.get(l);if(!ue.isAtomic(m))continue;let d=Ho.Info(e,m,c),p=Ho.Info(e,m,c);for(let h of i)h.startUnit(m,u,c);for(let h=0,f=u.edgeCount*2;h<f;++h){d.feature=u.a[h],p.feature=u.b[h];for(let g of i)g.isApplicable(u.edgeProps.type[h])&&g.handleIntraContact(h,d,p)}}}function uut(e,t){let{contacts:r}=t,n=function(u,c,m,d,p){let[h,f]=d.get(m)||[1/0,-1];u<h?(f!==-1&&p(f),d.set(m,[u,c])):p(c)};function o(u,c,m,d,p){let h=c.members[c.offsets[c.feature]],f=m.members[m.offsets[m.feature]],g=c.unit.getResidueIndex(h),y=m.unit.getResidueIndex(f),x=`${h}|${c.unit.id}|${y}|${m.unit.id}|A`,S=`${f}|${m.unit.id}|${g}|${c.unit.id}|B`,I=Ho.distance(c,m);n(I,u,x,d,p),n(I,u,S,d,p)}let i=new Map,a=u=>r.edges[u].props.flag=1,s,l;return{isApplicable:u=>u===6,handleInterContact:(u,c,m)=>{o(u,c,m,i,a)},startUnit:(u,c,m)=>{s=new Map,l=d=>c.edgeProps.flag[d]=1},handleIntraContact:(u,c,m)=>{o(u,c,m,s,l)}}}function cut(e,t){let{contacts:r}=t,n=(o,i)=>{let a=o.types[o.feature]===9?i:o,s=a.members[a.offsets[a.feature]],{edgeProps:{type:l},elementsIndex:{offsets:u,indices:c}}=t.unitsContacts.get(a.unit.id);for(let d=u[s],p=u[s+1];d<p;++d)if(l[c[d]]===4)return!0;let m=r.getEdgeIndices(a.feature,a.unit.id);for(let d=0,p=m.length;d<p;++d)if(r.edges[m[d]].props.type===4)return!0;return!1};return{isApplicable:o=>o===8,handleInterContact:(o,i,a)=>{n(i,a)&&(r.edges[o].props.flag=1)},startUnit:()=>{},handleIntraContact:(o,i,a)=>{if(n(i,a)){let{flag:s}=t.unitsContacts.get(i.unit.id).edgeProps;s[o]=1}}}}function TQ(e,t,r,n,o){let{offsets:i,feature:a}=r,{offsets:s,feature:l}=n;for(let u=i[a],c=i[a+1];u<c;++u){let m=r.members[u],d=o.getContactIndicesForElement(m,r.unit);for(let p=0,h=d.length;p<h;++p){let f=d[p];if(e.includes(o.edges[f].props.type))for(let g=s[l],y=s[l+1];g<y;++g){let x=n.members[g];if(o.getContactIndicesForElement(x,n.unit).includes(f)){o.edges[t].props.flag=1;return}}}}}function PQ(e,t,r,n,o){let{edgeProps:{type:i,flag:a},elementsIndex:{offsets:s,indices:l}}=o,{offsets:u,feature:c}=r,{offsets:m,feature:d}=n;for(let p=u[c],h=u[c+1];p<h;++p){let f=r.members[p];for(let g=s[f],y=s[f+1];g<y;++g){let x=l[g];if(e.includes(i[x]))for(let S=m[d],I=m[d+1];S<I;++S){let v=n.members[S];for(let A=s[v],P=s[v+1];A<P;++A)if(x===l[A]){a[t]=1;return}}}}}function mut(e,t){let{contacts:r}=t;return{isApplicable:n=>n===1,handleInterContact:(n,o,i)=>{TQ([4,8],n,o,i,r)},startUnit:()=>{},handleIntraContact:(n,o,i)=>{PQ([4,8],n,o,i,t.unitsContacts.get(o.unit.id))}}}function dut(e,t){let{contacts:r}=t;return{isApplicable:n=>n===6||n===2,handleInterContact:(n,o,i)=>{TQ([3],n,o,i,r)},startUnit:()=>{},handleIntraContact:(n,o,i)=>{PQ([3],n,o,i,t.unitsContacts.get(o.unit.id))}}}function put(e,t){let{contacts:r}=t;return{isApplicable:n=>n===1,handleInterContact:(n,o,i)=>{TQ([7],n,o,i,r)},startUnit:()=>{},handleIntraContact:(n,o,i)=>{PQ([7],n,o,i,t.unitsContacts.get(o.unit.id))}}}var ph;(u=>{function e(c,m,d,p,h,f){return Mk("interactions",{structure:m,interactions:c},{unitA:d,indexA:p,unitB:h,indexB:f})}u.Location=e;function t(c){return!!c&&c.kind==="data-location"&&c.tag==="interactions"}u.isLocation=t;function r(c,m){return c.data.structure===m.data.structure&&c.data.interactions===m.data.interactions&&c.element.indexA===m.element.indexA&&c.element.indexB===m.element.indexB&&c.element.unitA===m.element.unitA&&c.element.unitB===m.element.unitB}u.areLocationsEqual=r;function n(c,m){let{unitA:d,indexA:p,unitB:h,indexB:f}=m,{contacts:g,unitsContacts:y}=c;if(d===h){let x=y.get(d.id),S=x.getDirectedEdgeIndex(p,f);return hQ(x.edgeProps.type[S])}else{let x=g.getEdgeIndex(p,d.id,f,h.id);return hQ(g.edges[x].props.type)}}function o(c){return n(c.data.interactions,c.element)}u.locationLabel=o;function i(c,m,d){return _C("interactions",{structure:c,interactions:m},d,p=>s(m,d,p),()=>l(c,m,d))}u.Loci=i;function a(c){return!!c&&c.kind==="data-loci"&&c.tag==="interactions"}u.isLoci=a;function s(c,m,d){let{unitsFeatures:p}=c;return ku.fromPairProvider(m.length,(h,f,g)=>{let y=m[h];Ho.setPosition(f,y.unitA,y.indexA,p.get(y.unitA.id)),Ho.setPosition(g,y.unitB,y.indexB,p.get(y.unitB.id))},d)}u.getBoundingSphere=s;function l(c,m,d){let p=d[0];if(p===void 0)return"";let{unitA:h,indexA:f,unitB:g,indexB:y}=p,{unitsFeatures:x}=m,{members:S,offsets:I}=x.get(h.id),{members:v,offsets:A}=x.get(g.id),P={granularity:"element"};return(I[f+1]-I[f]>1||A[y+1]-A[y]>1)&&(P.granularity="residue"),[n(m,p),LR(It.Location(c,h,S[I[f]],c,g,v[A[y]]),P)].join("</br>")}u.getLabel=l})(ph||={});var fut=[RTe,DTe,wTe,VTe,OTe,GTe,bTe,xTe,HTe,QTe,ZTe],hV={ionic:UTe,"pi-stacking":NTe,"cation-pi":zTe,"halogen-bonds":CTe,"hydrogen-bonds":MTe,"weak-hydrogen-bonds":BTe,hydrophobic:jTe,"metal-coordination":qTe};function hut(e=[]){let t=Object.create(null);return Object.keys(hV).forEach(r=>{t[r]=C.MappedStatic(e.includes(r)?"on":"off",{on:C.Group(hV[r].params),off:C.Group({})},{cycle:!0})}),t}var gut=hut(["cation-pi","pi-stacking","hydrogen-bonds","halogen-bonds","metal-coordination"]),_Q={providers:C.Group(gut,{isFlat:!0}),contacts:C.Group(pTe,{label:"Advanced Options"})};async function KTe(e,t,r,n){let o={...C.getDefaultValues(_Q),...r},i=JSON.stringify(o);await Wg.attach(e,t);let a=[];bS(hV).forEach(p=>{let{name:h,params:f}=o.providers[p];h==="on"&&a.push(hV[p].createTester(f))});let s=new Set;a.forEach(p=>go.add(s,p.requiredFeatures));let l=fut.filter(p=>go.areIntersecting(s,p.types)),u=Mu.Mutable(),c=Mu.Mutable();for(let p=0,h=t.unitSymmetryGroups.length;p<h;++p){let f=t.unitSymmetryGroups[p];e.runtime.shouldUpdate&&await e.runtime.update({message:"computing interactions",current:p,max:h});let g=yut(t,f.units[0],l,i);for(let x=0,S=f.units.length;x<S;++x){let I=f.units[x];u.set(I.id,g)}if(n?.skipIntraContacts)continue;let y=but(t,f.units[0],g,a,o.contacts);for(let x=0,S=f.units.length;x<S;++x){let I=f.units[x];c.set(I.id,y)}}let m=xut(t,u,a,o.contacts,n),d={unitsFeatures:u,unitsContacts:c,contacts:m};return YTe(t,d),d}function yut(e,t,r,n){let o=`features-${n}`;if(t.transientCache.has(o))return t.transientCache.get(o);let i=t.elements.length,a=pQ.create(i,i/2);if(ue.isAtomic(t))for(let l of r)l.add(e,t,a);let s=a.getFeatures(i);return t.transientCache.set(o,s),s}function but(e,t,r,n,o){let i=yQ.create(r,t.elements.length);return ue.isAtomic(t)&&gTe(e,t,r,i,n,o),i.getContacts()}function xut(e,t,r,n,o){let i=bQ.create();return De.eachUnitPair(e,(a,s)=>{let l=t.get(a.id),u=t.get(s.id);yTe(e,a,l,s,u,i,r,n)},{maxRadius:Math.max(...r.map(a=>a.maxDistance)),validUnit:a=>ue.isAtomic(a),validUnitPair:(a,s)=>o?.unitPairTest?o.unitPairTest(a,s):De.validUnitPair(e,a,s)}),i.getContacts(t)}var RQ={..._Q},Si=Zl.createProvider({label:"Interactions",descriptor:{name:"molstar_computed_interactions"},type:"local",defaultParams:RQ,getParams:e=>RQ,isApplicable:e=>!e.isCoarseGrained,obtain:async(e,t,r)=>{let n={...C.getDefaultValues(RQ),...r};return{value:await KTe(e,t,n)}}});var DQ=13421772,Cut="Assigns colors according the interaction type of a link.",gc={HydrogenBond:2851770,Hydrophobic:8421504,HalogenBond:4259775,Ionic:15779860,MetalCoordination:9191577,CationPi:16744448,PiStacking:9220966,WeakHydrogenBond:12967404},Sut=[["Hydrogen Bond",gc.HydrogenBond],["Hydrophobic",gc.Hydrophobic],["Halogen Bond",gc.HalogenBond],["Ionic",gc.Ionic],["Metal Coordination",gc.MetalCoordination],["Cation Pi",gc.CationPi],["Pi Stacking",gc.PiStacking],["Weak HydrogenBond",gc.WeakHydrogenBond]];function JTe(e){switch(e){case 4:return gc.HydrogenBond;case 6:return gc.Hydrophobic;case 5:return gc.HalogenBond;case 1:return gc.Ionic;case 7:return gc.MetalCoordination;case 2:return gc.CationPi;case 3:return gc.PiStacking;case 8:return gc.WeakHydrogenBond;case 0:return DQ}}var $Te={};function vut(e){return $Te}function ePe(e,t){let r,n=e.structure?Si.get(e.structure):void 0,o=n?$u(n.id,n.version):-1;return n&&n.value?r=i=>{if(ph.isLocation(i)){let{unitsContacts:a,contacts:s}=i.data.interactions,{unitA:l,unitB:u,indexA:c,indexB:m}=i.element;if(l===u){let d=a.get(l.id),p=d.getDirectedEdgeIndex(c,m);return JTe(d.edgeProps.type[p])}else{let d=s.getEdgeIndex(c,l.id,m,u.id);return JTe(s.edges[d].props.type)}}return DQ}:r=()=>DQ,{factory:ePe,granularity:"group",color:r,props:t,contextHash:o,description:Cut,legend:Nl(Sut)}}var rD={name:"interaction-type",label:"Interaction Type",category:yr.Misc,factory:ePe,getParams:vut,defaultValues:C.getDefaultValues($Te),isApplicable:e=>!!e.structure,ensureCustomProperties:{attach:(e,t)=>t.structure?Si.attach(e,t.structure,void 0,!0):Promise.resolve(),detach:e=>e.structure&&Si.ref(e.structure,!1)}};var Rb=b(),fT=b(),nD=b(),gV=qe.add,tPe=qe.add3,g1;(t=>{function e(r=2048,n=1024,o){let i=qe.create(Float32Array,1,n,o?o.groupBuffer.ref.value:r),a=qe.create(Float32Array,3,n,o?o.startBuffer.ref.value:r),s=qe.create(Float32Array,3,n,o?o.endBuffer.ref.value:r),l=qe.create(Float32Array,1,n,o?o.scaleBuffer.ref.value:r),u=qe.create(Float32Array,1,n,o?o.capBuffer.ref.value:r),c=qe.create(Float32Array,1,n,o?o.colorModeBuffer.ref.value:r),m=(p,h,f,g,y,x,S,I,v,A,P)=>{for(let T=0;T<6;++T)tPe(a,p,h,f),tPe(s,g,y,x),gV(i,P),gV(l,S),gV(u,(I?1:0)+(v?2:0)),gV(c,A)},d=(p,h,f,g,y,x,S,I,v)=>{let A=b.distance(p,h),P=f%2!==0,T=Math.floor((f+1)/2),R=A/(f+.5),w=2;b.setMagnitude(nD,b.sub(nD,h,p),R),b.copy(Rb,p);for(let E=0;E<T;++E)b.add(Rb,Rb,nD),P&&E===T-1?(b.copy(fT,h),S||(x=!1)):b.add(fT,Rb,nD),I&&(w=b.distance(p,fT)/(A*2)),m(Rb[0],Rb[1],Rb[2],fT[0],fT[1],fT[2],g,y,x,w,v),b.add(Rb,Rb,nD)};return{add:m,addFixedCountDashes:d,addFixedLengthDashes:(p,h,f,g,y,x,S,I)=>{let v=b.distance(p,h);d(p,h,v/f,g,y,x,!0,S,I)},getCylinders:()=>{let p=i.elementCount/6,h=qe.compact(i,!0),f=qe.compact(a,!0),g=qe.compact(s,!0),y=qe.compact(l,!0),x=qe.compact(u,!0),S=qe.compact(c,!0),I=o&&p<=o.cylinderCount?o.mappingBuffer.ref.value:new Float32Array(p*18),v=o&&p<=o.cylinderCount?o.indexBuffer.ref.value:new Uint32Array(p*12);return(!o||p>o.cylinderCount)&&Iut(p,I,v),ji.create(I,v,h,f,g,y,x,S,p,o)}}}t.create=e})(g1||={});function Iut(e,t,r){for(let n=0;n<e;++n){let o=n*18;t[o]=-1,t[o+1]=1,t[o+2]=-1,t[o+3]=-1,t[o+4]=-1,t[o+5]=-1,t[o+6]=1,t[o+7]=1,t[o+8]=-1,t[o+9]=1,t[o+10]=1,t[o+11]=1,t[o+12]=1,t[o+13]=-1,t[o+14]=-1,t[o+15]=1,t[o+16]=-1,t[o+17]=1}for(let n=0;n<e;++n){let o=n*6,i=n*12;r[i]=o,r[i+1]=o+1,r[i+2]=o+2,r[i+3]=o+1,r[i+4]=o+4,r[i+5]=o+2,r[i+6]=o+2,r[i+7]=o+4,r[i+8]=o+3,r[i+9]=o+4,r[i+10]=o+5,r[i+11]=o+3}}var Nd={linkScale:C.Numeric(.45,{min:0,max:1,step:.01}),linkSpacing:C.Numeric(1,{min:0,max:2,step:.01}),linkCap:C.Boolean(!1),aromaticScale:C.Numeric(.3,{min:0,max:1,step:.01}),aromaticSpacing:C.Numeric(1.5,{min:0,max:3,step:.01}),aromaticDashCount:C.Numeric(2,{min:1,max:6,step:1}),dashCount:C.Numeric(4,{min:0,max:10,step:1}),dashScale:C.Numeric(.8,{min:0,max:2,step:.1}),dashCap:C.Boolean(!0),stubCap:C.Boolean(!0),radialSegments:C.Numeric(16,{min:2,max:56,step:2},Xe.CustomQualityParamInfo),colorMode:C.Select("default",C.arrayToOptions(["default","interpolate"]),Xe.ShadingCategory)},fon=C.getDefaultValues(Nd),wQ={linkScale:C.Numeric(.5,{min:0,max:1,step:.1}),linkSpacing:C.Numeric(.1,{min:0,max:2,step:.01}),aromaticDashCount:C.Numeric(2,{min:1,max:6,step:1}),dashCount:C.Numeric(4,{min:0,max:10,step:1})},hon=C.getDefaultValues(wQ),Yo=b(),WC=b(),Qp=b(),Aut=b.create(0,1,0);function MQ(e,t,r,n){b.normalize(WC,b.sub(WC,t,r)),n!==null?b.sub(Qp,t,n):b.copy(Qp,t),b.normalize(Qp,Qp);let o=b.dot(WC,Qp);return 1-Math.abs(o)<1e-5&&(b.set(Qp,1,0,0),o=b.dot(WC,Qp),1-Math.abs(o)<1e-5&&(b.set(Qp,0,1,0),o=b.dot(WC,Qp))),b.setMagnitude(WC,WC,o),b.sub(Qp,Qp,WC),b.normalize(e,Qp)}var yV={linkCount:0,position:()=>{},radius:()=>0};var fh=b.scale,ia=b.add,ds=b.sub,gu=b.setMagnitude,Tut=b.dot;function rm(e,t,r,n){let{linkCount:o,referencePosition:i,position:a,style:s,radius:l,ignore:u,stub:c}=t;if(!o)return{mesh:ft.createEmpty(n)};let{radialSegments:m,stubCap:d}=r,p=m*2*o*2,h=tt.createState(p,p/4,n),f=b(),g=0,y=0,x={builderState:h,props:r,assignNonAdjustedPosition:(A,P)=>{a(A,P,y,!1)},referencePosition:i?()=>i(y):void 0},S={a:b(),b:b(),group:0,linkStub:!1,linkStyle:0,linkRadius:0};for(let A=o;y<A;++y)u&&u(y)||(a(S.a,S.b,y,!0),ia(f,f,S.a),ia(f,f,S.b),g+=2,S.group=y,S.linkStub=d&&(c?c(y):!1),S.linkRadius=l(y),S.linkStyle=s?s(y):0,_ut(x,S));let I=tt.getMesh(h);if(g===0)return{mesh:I};b.scale(f,f,1/g);let v=n?he.clone(n.boundingSphere):void 0;return v&&b.distance(f,v.center)/v.radius<.1?{mesh:I,boundingSphere:v}:{mesh:I}}var Put={cylinderProps:{radiusTop:1,radiusBottom:1,radialSegments:8,topCap:!1,bottomCap:!1},vShift:b(),va:b(),vb:b()};function _ut(e,t){let{builderState:r,props:n,assignNonAdjustedPosition:o,referencePosition:i}=e,{linkRadius:a,linkStub:s,linkStyle:l,a:u,b:c}=t,{linkScale:m,linkSpacing:d,radialSegments:p,linkCap:h,aromaticScale:f,aromaticSpacing:g,aromaticDashCount:y,dashCount:x,dashScale:S,dashCap:I}=n,{cylinderProps:v,vShift:A,va:P,vb:T}=Put;v.radialSegments=p,b.copy(P,u),b.copy(T,c),ds(Yo,T,P);let R=Tut(Yo,Aut)>0,[w,E]=R?[s,h]:[h,s];if(r.currentGroup=t.group,l===0)v.radiusTop=v.radiusBottom=a,v.topCap=w,v.bottomCap=E,gn(r,P,T,.5,v);else if(l===1)v.radiusTop=v.radiusBottom=a*S,v.topCap=v.bottomCap=I,wp(r,P,T,.5,x,s,v);else if(l===2||l===3||l===4||l===5||l===7||l===8){let M=l===2||l===3?2:l===4||l===5?3:1.5,D=a*(m/(.5*M)),B=(a-D)*d;if(MQ(A,P,T,i?i():null),v.topCap=w,v.bottomCap=E,l===7||l===8){v.radiusTop=v.radiusBottom=a,gn(r,P,T,.5,v);let k=a+f*a+f*a*g;o&&o(P,T),gu(Yo,ds(Yo,T,P),a*.5),ia(P,P,Yo),ds(T,T,Yo),v.radiusTop=v.radiusBottom=a*f,v.topCap=v.bottomCap=I,gu(A,A,k),ds(P,P,A),ds(T,T,A),wp(r,P,T,.5,y,s,v),l===8&&(gu(A,A,k*2),ia(P,P,A),ia(T,T,A),wp(r,P,T,.5,y,s,v))}else if(l===3||l===5){let k=a+D+m*a*d;gu(A,A,k),v.radiusTop=v.radiusBottom=a,gn(r,P,T,.5,v),fh(Yo,Yo,d*m*.2),ia(P,P,Yo),ds(T,T,Yo),v.radiusTop=v.radiusBottom=D,v.topCap=R?s:I,v.bottomCap=R?I:s,gu(A,A,k),ds(P,P,A),ds(T,T,A),gn(r,P,T,.5,v),M===3&&(gu(A,A,k*2),ia(P,P,A),ia(T,T,A),gn(r,P,T,.5,v))}else gu(A,A,B),v.radiusTop=v.radiusBottom=D,M===3&&gn(r,P,T,.5,v),TCe(r,P,T,.5,A,v)}else l===6&&(fh(Yo,Yo,.475),ia(P,P,Yo),ds(T,T,Yo),v.radiusTop=v.radiusBottom=a,v.topCap=w,v.bottomCap=E,gn(r,P,T,.5,v))}function oD(e,t,r,n){let{linkCount:o,referencePosition:i,position:a,style:s,radius:l,ignore:u,stub:c}=t;if(!o)return{cylinders:ji.createEmpty(n)};let{linkScale:m,linkSpacing:d,linkCap:p,aromaticScale:h,aromaticSpacing:f,aromaticDashCount:g,dashCount:y,dashScale:x,dashCap:S,stubCap:I,colorMode:v}=r,A=v==="interpolate",P=A===!0?3:2,T=o*2,R=g1.create(T,T/4,n),w=b(),E=b(),M=b(),D=b(),B=b(),k=0;for(let j=0,Y=o;j<Y;++j){if(u&&u(j))continue;a(w,E,j,!0),ia(B,B,w),ia(B,B,E),k+=2;let G=l(j),X=s?s(j):0,U=I&&(c?c(j):!1);if(X===0)fh(M,ia(M,w,E),.5),R.add(w[0],w[1],w[2],M[0],M[1],M[2],1,p,U,P,j);else if(X===1)fh(M,ia(M,w,E),.5),R.addFixedCountDashes(w,M,y,x,S,S,U,A,j);else if(X===2||X===3||X===4||X===5||X===7||X===8){let L=X===2||X===3?2:X===4||X===5?3:1.5,q=m/(.5*L),te=(G-q*G)*d;if(fh(M,ia(M,w,E),.5),MQ(D,w,E,i?i(j):null),X===7||X===8){R.add(w[0],w[1],w[2],M[0],M[1],M[2],1,p,U,P,j);let J=G+h*G+h*G*f;a(w,E,j,!1),gu(Yo,ds(Yo,E,w),G*.5),ia(w,w,Yo),gu(D,D,J),ds(w,w,D),ds(M,M,D),R.addFixedCountDashes(w,M,g,h,S,S,U,A,j),X===8&&(gu(D,D,J*2),ia(w,w,D),ia(M,M,D),R.addFixedCountDashes(w,M,g,h,S,S,U,A,j))}else if(X===3||X===5){let J=G+q*G+m*G*d;gu(D,D,J),R.add(w[0],w[1],w[2],M[0],M[1],M[2],1,p,U,P,j),gu(Yo,ds(Yo,w,M),G/1.5),ds(w,w,Yo),L===3&&R.add(w[0]+D[0],w[1]+D[1],w[2]+D[2],M[0]+D[0],M[1]+D[1],M[2]+D[2],q,p,U,P,j),R.add(w[0]-D[0],w[1]-D[1],w[2]-D[2],M[0]-D[0],M[1]-D[1],M[2]-D[2],q,S,U,P,j)}else gu(D,D,te),L===3&&R.add(w[0],w[1],w[2],M[0],M[1],M[2],q,p,U,P,j),R.add(w[0]+D[0],w[1]+D[1],w[2]+D[2],M[0]+D[0],M[1]+D[1],M[2]+D[2],q,p,U,P,j),R.add(w[0]-D[0],w[1]-D[1],w[2]-D[2],M[0]-D[0],M[1]-D[1],M[2]-D[2],q,p,U,P,j)}else X===6&&(fh(Yo,ds(Yo,M,w),.475),ia(w,w,Yo),ds(M,M,Yo),R.add(w[0],w[1],w[2],M[0],M[1],M[2],1,p,U,P,j))}let F=R.getCylinders();if(k===0)return{cylinders:F};b.scale(B,B,1/k);let z=n?he.clone(n.boundingSphere):void 0;return z&&b.distance(B,z.center)/z.radius<.1?{cylinders:F,boundingSphere:z}:{cylinders:F}}function iD(e,t,r,n){let{linkCount:o,referencePosition:i,position:a,style:s,ignore:l}=t;if(!o)return{lines:Cn.createEmpty(n)};let{linkScale:u,linkSpacing:c,aromaticDashCount:m,dashCount:d}=r,p=o*2,h=ns.create(p,p/4,n),f=b(),g=b(),y=b(),x=b(),S=b(),I=0,v=4.5,A=3;for(let R=0,w=o;R<w;++R){if(l&&l(R))continue;a(f,g,R,!0),ia(S,S,f),ia(S,S,g),I+=2;let E=s?s(R):0;if(E===0)fh(y,ia(y,f,g),.5),h.add(f[0],f[1],f[2],y[0],y[1],y[2],R);else if(E===1)fh(y,ia(y,f,g),.5),h.addFixedCountDashes(f,y,d,R);else if(E===2||E===3||E===4||E===5||E===7||E===8){let M=E===2||E===3?2:E===4||E===5?3:1.5,B=(1-1*(u/(.5*M)))*c;if(fh(y,ia(y,f,g),.5),MQ(x,f,g,i?i(R):null),E===7||E===8){h.add(f[0],f[1],f[2],y[0],y[1],y[2],R);let k=B*v;gu(Yo,ds(Yo,g,f),k*.5),ia(f,f,Yo),gu(x,x,k),ds(f,f,x),ds(y,y,x),h.addFixedCountDashes(f,y,m,R),E===8&&(gu(x,x,k*2),ia(f,f,x),ia(y,y,x),h.addFixedCountDashes(f,y,m,R))}else E===3||E===5?(gu(x,x,B*A),h.add(f[0],f[1],f[2],y[0],y[1],y[2],R),fh(Yo,ds(Yo,f,y),c*u),ds(f,f,Yo),M===3&&h.add(f[0]+x[0],f[1]+x[1],f[2]+x[2],y[0]+x[0],y[1]+x[1],y[2]+x[2],R),h.add(f[0]-x[0],f[1]-x[1],f[2]-x[2],y[0]-x[0],y[1]-x[1],y[2]-x[2],R)):(gu(x,x,B*1.5),M===3&&h.add(f[0],f[1],f[2],y[0],y[1],y[2],R),h.add(f[0]+x[0],f[1]+x[1],f[2]+x[2],y[0]+x[0],y[1]+x[1],y[2]+x[2],R),h.add(f[0]-x[0],f[1]-x[1],f[2]-x[2],y[0]-x[0],y[1]-x[1],y[2]-x[2],R))}else E===6&&(fh(Yo,ds(Yo,y,f),.475),ia(f,f,Yo),ds(y,y,Yo),h.add(f[0],f[1],f[2],y[0],y[1],y[2],R))}let P=h.getLines();if(I===0)return{lines:P};b.scale(S,S,1/I);let T=n?he.clone(n.boundingSphere):void 0;return T&&b.distance(S,T.center)/T.radius<.1?{lines:P,boundingSphere:T}:{lines:P}}var bV={sizeFactor:C.Numeric(.3,{min:0,max:10,step:.01}),dashCount:C.Numeric(6,{min:1,max:10,step:1}),dashScale:C.Numeric(.4,{min:0,max:2,step:.1}),ignoreHydrogens:C.Boolean(!1),ignoreHydrogensVariant:C.Select("all",C.arrayToOptions(["all","non-polar"])),includeParent:C.Boolean(!1),parentDisplay:C.Select("stub",C.arrayToOptions(["stub","full","between"]),{description:'Only has an effect when "includeParent" is enabled. "Stub" shows just the child side of interactions to the parent. "Full" shows both sides of interactions to the parent. "Between" shows only interactions to the parent.'})};async function Rut(e,t,r,n,o,i){if(!ue.isAtomic(t))return ft.createEmpty(i);let{child:a}=r,s=a?.unitMap.get(t.id);if(a&&!s)return ft.createEmpty(i);let l=Q.Location.create(r,t),u=Si.get(r).value,c=u.unitsFeatures.get(t.id),m=u.unitsContacts.get(t.id),{x:d,y:p,z:h,members:f,offsets:g,types:y}=c,{edgeCount:x,a:S,b:I,edgeProps:{flag:v,type:A}}=m,{sizeFactor:P,ignoreHydrogens:T,ignoreHydrogensVariant:R,parentDisplay:w}=o;if(!x)return ft.createEmpty(i);let{elements:E,conformation:M}=t,D=b(),B=b(),k=b(),F={linkCount:x*2,position:(Y,G,X)=>{let U=A[X];if((!T||R!=="all")&&(U===4||U===8&&R!=="non-polar")){let L=f[g[S[X]]],q=f[g[I[X]]];M.invariantPosition(E[L],B),M.invariantPosition(E[q],k);let te=b.distance(B,k),J=te;b.copy(Y,B),b.copy(G,k);let ee=U===4?4:9;y[g[S[X]]]===ee?JF(t,L,(fe,O)=>{if(em(r,t,E[O],"all")){M.invariantPosition(E[O],D);let V=b.distance(D,k);V<te&&(te=V,b.copy(Y,D))}}):JF(t,q,(fe,O)=>{if(em(r,t,E[O],"all")){M.invariantPosition(E[O],D);let V=b.distance(D,B);V<J&&(J=V,b.copy(G,D))}})}else b.set(Y,d[S[X]],p[S[X]],h[S[X]]),b.set(G,d[I[X]],p[I[X]],h[I[X]])},style:Y=>1,radius:Y=>{l.element=E[f[g[S[Y]]]];let G=n.size.size(l);l.element=E[f[g[I[Y]]]];let X=n.size.size(l);return Math.min(G,X)*P},ignore:Y=>{if(v[Y]===1)return!0;if(s)if(w==="stub"){let G=S[Y];for(let X=g[G],U=g[G+1];X<U;++X){let L=E[f[g[X]]];if(!Be.has(s.elements,L))return!0}}else if(w==="full"||w==="between"){let G=!1,X=!1,U=S[Y];for(let q=g[U],te=g[U+1];q<te;++q){let J=E[f[g[q]]];Be.has(s.elements,J)||(G=!0)}let L=I[Y];for(let q=g[L],te=g[L+1];q<te;++q){let J=E[f[g[q]]];Be.has(s.elements,J)||(X=!0)}return w==="full"?G&&X:G===X}else Mr(w);return!1}},{mesh:z,boundingSphere:j}=rm(e,F,o,i);if(j)z.setBoundingSphere(j);else if(z.triangleCount>0){let Y=he.expand(he(),(s??t).boundary.sphere,1*P);z.setBoundingSphere(Y)}return z}var EQ={...fo,...Nd,...bV};function rPe(e){return Oo({defaultProps:C.getDefaultValues(EQ),createGeometry:Rut,createLocationIterator:Mut,getLoci:Dut,eachLocation:wut,setUpdateState:(t,r,n,o,i,a,s)=>{t.createGeometry=r.sizeFactor!==n.sizeFactor||r.dashCount!==n.dashCount||r.dashScale!==n.dashScale||r.dashCap!==n.dashCap||r.radialSegments!==n.radialSegments||r.ignoreHydrogens!==n.ignoreHydrogens||r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||r.parentDisplay!==n.parentDisplay;let l=Si.get(a.structure).version;t.info.interactionsHash!==l&&(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0,t.info.interactionsHash=l)}},e)}function Dut(e,t,r){let{objectId:n,instanceId:o,groupId:i}=e;if(r===n){let{structure:a,group:s}=t,l=a.unitMap.get(s.units[o].id),u=Si.get(a).value,{a:c,b:m}=u.unitsContacts.get(l.id);return ph.Loci(a,u,[{unitA:l,indexA:c[i],unitB:l,indexB:m[i]},{unitA:l,indexA:m[i],unitB:l,indexB:c[i]}])}return vr}var BQ=new Set;function wut(e,t,r,n){let o=!1;if(ph.isLoci(e)){let{structure:i,group:a}=t;if(!De.areEquivalent(e.data.structure,i))return!1;let s=Si.get(i).value;if(e.data.interactions!==s)return!1;let l=a.units[0],u=s.unitsContacts.get(l.id),c=u.edgeCount*2;for(let m of e.elements){if(m.unitA!==m.unitB)continue;let d=a.unitIndexMap.get(m.unitA.id);if(d!==void 0){let p=u.getDirectedEdgeIndex(m.indexA,m.indexB);p!==-1&&r(ye.ofSingleton(d*c+p))&&(o=!0)}}}else if(Q.Loci.is(e)){let{structure:i,group:a}=t;if(!De.areEquivalent(e.structure,i))return!1;let s=Si.get(i).value;if(!s)return!1;let l=a.units[0],u=s.unitsContacts.get(l.id),c=s.unitsFeatures.get(l.id),m=u.edgeCount*2,{offset:d}=u,{offsets:p,indices:h}=c.elementsIndex,{members:f,offsets:g}=c;for(let y of e.elements){let x=a.unitIndexMap.get(y.unit.id);x!==void 0&&(xe.forEach(y.indices,S=>{for(let I=p[S],v=p[S+1];I<v;++I){let A=h[I];for(let P=d[A],T=d[A+1];P<T;++P)BQ.add(P)}}),BQ.forEach(S=>{if(n){let I=u.a[S];for(let A=g[I],P=g[I+1];A<P;++A)if(!xe.has(y.indices,f[A]))return;let v=u.b[S];for(let A=g[v],P=g[v+1];A<P;++A)if(!xe.has(y.indices,f[A]))return}r(ye.ofSingleton(x*m+S))&&(o=!0)}),BQ.clear())}}return o}function Mut(e){let{structure:t,group:r}=e,n=r.units[0],o=Si.get(t).value,i=o.unitsContacts.get(n.id),a=i.edgeCount*2,s=r.units.length,l=ph.Location(o,t),{element:u}=l;return un(a,s,1,(m,d)=>{let p=r.units[d];return u.unitA=p,u.indexA=i.a[m],u.unitB=p,u.indexB=i.b[m],l})}function But(e,t,r,n,o){if(!t.hasAtomic)return ft.createEmpty(o);let i=Q.Location.create(t),a=Si.get(t).value,{contacts:s,unitsFeatures:l}=a,{edgeCount:u,edges:c}=s,{sizeFactor:m,ignoreHydrogens:d,ignoreHydrogensVariant:p,parentDisplay:h}=n;if(!u)return ft.createEmpty(o);let{child:f}=t,g=b(),y=b(),x=b(),S={linkCount:u,position:(A,P,T)=>{let{unitA:R,indexA:w,unitB:E,indexB:M,props:{type:D}}=c[T],B=l.get(R),k=l.get(E),F=t.unitMap.get(R),z=t.unitMap.get(E);if((!d||p!=="all")&&(D===4||D===8&&p!=="non-polar")){let j=B.members[B.offsets[w]],Y=k.members[k.offsets[M]];F.conformation.position(F.elements[j],y),z.conformation.position(z.elements[Y],x);let G=b.distance(y,x),X=G;b.copy(A,y),b.copy(P,x);let U=D===4?4:9;B.types[B.offsets[w]]===U?Ts(t,F,j,(q,te)=>{let J=q.elements[te];if(em(t,q,J,"all")){q.conformation.position(J,g);let ee=b.distance(g,x);ee<G&&(G=ee,b.copy(A,g))}}):Ts(t,z,Y,(q,te)=>{let J=q.elements[te];if(em(t,q,J,"all")){q.conformation.position(J,g);let ee=b.distance(g,y);ee<X&&(X=ee,b.copy(P,g))}})}else b.set(A,B.x[w],B.y[w],B.z[w]),b.transformMat4(A,A,F.conformation.operator.matrix),b.set(P,k.x[M],k.y[M],k.z[M]),b.transformMat4(P,P,z.conformation.operator.matrix)},style:A=>1,radius:A=>{let P=c[A],T=l.get(P.unitA);i.unit=t.unitMap.get(P.unitA),i.element=i.unit.elements[T.members[T.offsets[P.indexA]]];let R=r.size.size(i),w=l.get(P.unitB);i.unit=t.unitMap.get(P.unitB),i.element=i.unit.elements[w.members[w.offsets[P.indexB]]];let E=r.size.size(i);return Math.min(R,E)*m},ignore:A=>{if(c[A].props.flag===1)return!0;if(f){let P=c[A];if(h==="stub"){let T=f.unitMap.get(P.unitA);if(!T)return!0;let R=t.unitMap.get(P.unitA),{offsets:w,members:E}=l.get(P.unitA);for(let M=w[P.indexA],D=w[P.indexA+1];M<D;++M){let B=R.elements[E[M]];if(!Be.has(T.elements,B))return!0}}else if(h==="full"||h==="between"){let T=!1,R=!1,w=f.unitMap.get(P.unitA);if(!w)T=!0;else{let M=t.unitMap.get(P.unitA),{offsets:D,members:B}=l.get(P.unitA);for(let k=D[P.indexA],F=D[P.indexA+1];k<F;++k){let z=M.elements[B[k]];Be.has(w.elements,z)||(T=!0)}}let E=f.unitMap.get(P.unitB);if(!E)R=!0;else{let M=t.unitMap.get(P.unitB),{offsets:D,members:B}=l.get(P.unitB);for(let k=D[P.indexB],F=D[P.indexB+1];k<F;++k){let z=M.elements[B[k]];Be.has(E.elements,z)||(R=!0)}}return h==="full"?T&&R:T===R}else Mr(h)}return!1}},{mesh:I,boundingSphere:v}=rm(e,S,n,o);if(v)I.setBoundingSphere(v);else if(I.triangleCount>0){let{child:A}=t,P=he.expand(he(),(A??t).boundary.sphere,1*m);I.setBoundingSphere(P)}return I}var FQ={...fc,...Nd,...bV};function nPe(e){return Ps({defaultProps:C.getDefaultValues(FQ),createGeometry:But,createLocationIterator:Fut,getLoci:Eut,eachLocation:kut,setUpdateState:(t,r,n,o,i,a,s)=>{t.createGeometry=r.sizeFactor!==n.sizeFactor||r.dashCount!==n.dashCount||r.dashScale!==n.dashScale||r.dashCap!==n.dashCap||r.radialSegments!==n.radialSegments||r.ignoreHydrogens!==n.ignoreHydrogens||r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||r.parentDisplay!==n.parentDisplay;let l=Si.get(a).version;t.info.interactionsHash!==l&&(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0,t.info.interactionsHash=l)}},e)}function Eut(e,t,r){let{objectId:n,groupId:o}=e;if(r===n){let i=Si.get(t).value,a=i.contacts.edges[o],s=t.unitMap.get(a.unitA),l=t.unitMap.get(a.unitB);return ph.Loci(t,i,[{unitA:s,indexA:a.indexA,unitB:l,indexB:a.indexB},{unitA:l,indexA:a.indexB,unitB:s,indexB:a.indexA}])}return vr}var xV=new Map,kQ=new Set;function kut(e,t,r,n){let o=!1;if(ph.isLoci(e)){if(!De.areEquivalent(e.data.structure,t))return!1;let i=Si.get(t).value;if(e.data.interactions!==i)return!1;let{contacts:a}=i;for(let s of e.elements){let l=a.getEdgeIndex(s.indexA,s.unitA.id,s.indexB,s.unitB.id);l!==-1&&r(ye.ofSingleton(l))&&(o=!0)}}else if(Q.Loci.is(e)){if(!De.areEquivalent(e.structure,t)||n&&e.elements.length===1)return!1;let i=Si.get(t).value;if(!i)return!1;let{contacts:a,unitsFeatures:s}=i;for(let l of e.elements)xV.set(l.unit.id,l.indices);for(let l of e.elements){let{unit:u}=l;ue.isAtomic(u)&&xe.forEach(l.indices,c=>{for(let m of a.getContactIndicesForElement(c,u))kQ.add(m)})}kQ.forEach(l=>{if(n){let{indexA:u,unitA:c,indexB:m,unitB:d}=a.edges[l],p=xV.get(c),h=xV.get(d);if(!p||!h)return;let{offsets:f,members:g}=s.get(c);for(let S=f[u],I=f[u+1];S<I;++S)if(!xe.has(p,g[S]))return;let{offsets:y,members:x}=s.get(d);for(let S=y[m],I=y[m+1];S<I;++S)if(!xe.has(h,x[S]))return}r(ye.ofSingleton(l))&&(o=!0)}),xV.clear(),kQ.clear()}return o}function Fut(e){let t=Si.get(e).value,{contacts:r}=t,n=r.edgeCount,o=1,i=ph.Location(t,e),{element:a}=i;return un(n,o,1,l=>{let u=r.edges[l];return a.unitA=e.unitMap.get(u.unitA),a.indexA=u.indexA,a.unitB=e.unitMap.get(u.unitB),a.indexB=u.indexB,i},!0)}var oPe={"intra-unit":(e,t)=>eo("Intra-unit interactions cylinder",e,t,rPe),"inter-unit":(e,t)=>po("Inter-unit interactions cylinder",e,t,nPe)},iPe={...EQ,...FQ,unitKinds:Cb(["atomic"]),sizeFactor:C.Numeric(.2,{min:.01,max:1,step:.01}),visuals:C.MultiSelect(["intra-unit","inter-unit"],C.objectToOptions(oPe))};function Lut(e,t){return C.clone(iPe)}function Vut(e,t){return Ut.createMulti("Interactions",e,t,qn,oPe)}var gT={name:"interactions",label:"Non-covalent Interactions",description:"Displays non-covalent interactions as dashed cylinders.",factory:Vut,getParams:Lut,defaultValues:C.getDefaultValues(iPe),defaultColorTheme:{name:"interaction-type"},defaultSizeTheme:{name:"uniform"},isApplicable:e=>e.elementCount>0&&Si.isApplicable(e),ensureCustomProperties:{attach:(e,t)=>Si.attach(e,t,void 0,!0),detach:e=>Si.ref(e,!1)},getData:(e,t)=>t.includeParent?e.asParent():e,mustRecreate:(e,t)=>e.includeParent!==t.includeParent};var aPe=Kr.create({name:"computed-interactions-prop",category:"custom-props",display:{name:"Interactions"},ctor:class extends Kr.Handler{constructor(){super(...arguments);this.provider=Si;this.labelProvider={label:t=>{if(this.params.showTooltip)switch(t.kind){case"element-loci":if(t.elements.length===0)return;let r=[],n=this.getStructures(t.structure);for(let o of n){let i=this.provider.get(o).value;if(!i)continue;let a=Q.Loci.remap(t,o);if(a.elements.length!==1)continue;let s=a.elements[0];if(xe.size(s.indices)!==1)continue;let l=i.unitsFeatures.get(s.unit.id);if(!l)continue;let u=[],c=[],m=[],d=xe.start(s.indices),{types:p,groups:h,elementsIndex:{indices:f,offsets:g}}=l;for(let y=g[d],x=g[d+1];y<x;++y){let S=f[y],I=p[S],v=h[S];I&&u.push(uTe(I)),v&&c.push(cTe(v))}u.length&&m.push(`<small>Types</small> ${u.join(", ")}`),c.length&&m.push(`<small>Groups</small> ${c.join(", ")}`),m.length&&r.push(`Interaction Feature: ${m.join(" | ")}`)}return r.length?r.join("<br/>"):void 0;default:return}}}}getStructures(t){let r=[],n=this.ctx.helpers.substructureParent.get(t);if(n){let i=this.ctx.state.data.select(tr.Generators.ofType(ne.Molecule.Structure,n.transform.ref));for(let a of i)a.obj&&li(r,a.obj.data)}return r}update(t){let r=this.params.autoAttach!==t.autoAttach||this.params.showTooltip!==t.showTooltip;return this.params.autoAttach=t.autoAttach,this.params.showTooltip=t.showTooltip,this.ctx.customStructureProperties.setDefaultAutoAttach(this.provider.descriptor.name,this.params.autoAttach),r}register(){this.ctx.customStructureProperties.register(this.provider,this.params.autoAttach),this.ctx.representation.structure.themes.colorThemeRegistry.add(rD),this.ctx.managers.lociLabels.addProvider(this.labelProvider),this.ctx.representation.structure.registry.add(gT)}unregister(){this.ctx.customStructureProperties.unregister(this.provider.descriptor.name),this.ctx.representation.structure.themes.colorThemeRegistry.remove(rD),this.ctx.managers.lociLabels.removeProvider(this.labelProvider),this.ctx.representation.structure.registry.remove(gT)}},params:()=>({autoAttach:C.Boolean(!1),showTooltip:C.Boolean(!0)})});var sPe=Kr.create({name:"computed-secondary-structure-prop",category:"custom-props",display:{name:"Secondary Structure"},ctor:class extends Kr.Handler{constructor(){super(...arguments);this.provider=ol}update(t){let r=this.params.autoAttach!==t.autoAttach;return this.params.autoAttach=t.autoAttach,this.ctx.customStructureProperties.setDefaultAutoAttach(this.provider.descriptor.name,this.params.autoAttach),r}register(){this.ctx.customStructureProperties.register(this.provider,this.params.autoAttach)}unregister(){this.ctx.customStructureProperties.unregister(this.provider.descriptor.name)}},params:()=>({autoAttach:C.Boolean(!1)})});var lPe=Kr.create({name:"computed-valence-model-prop",category:"custom-props",display:{name:"Valence Model"},ctor:class extends Kr.Handler{constructor(){super(...arguments);this.provider=Wg;this.labelProvider={label:t=>{if(this.params.showTooltip)switch(t.kind){case"element-loci":if(t.elements.length===0)return;let r=[],n=this.getStructures(t.structure);for(let o of n){let i=this.provider.get(o).value;if(!i)continue;let a=Q.Loci.remap(t,o);if(a.elements.length!==1)continue;let s=a.elements[0];if(xe.size(s.indices)!==1)continue;let l=i.get(s.unit.id);if(!l)continue;let u=xe.start(s.indices),c=l.charge[u],m=l.idealGeometry[u],d=l.implicitH[u],p=l.totalH[u];r.push(`Valence Model: <small>Charge</small> ${c} | <small>Ideal Geometry</small> ${aTe(m)} | <small>Implicit H</small> ${d} | <small>Total H</small> ${p}`)}return r.length?r.join("<br/>"):void 0;default:return}}}}getStructures(t){let r=[],n=this.ctx.helpers.substructureParent.get(t);if(n){let i=this.ctx.state.data.select(tr.Generators.ofType(ne.Molecule.Structure,n.transform.ref));for(let a of i)a.obj&&li(r,a.obj.data)}return r}update(t){let r=this.params.autoAttach!==t.autoAttach||this.params.showTooltip!==t.showTooltip;return this.params.autoAttach=t.autoAttach,this.params.showTooltip=t.showTooltip,this.ctx.customStructureProperties.setDefaultAutoAttach(this.provider.descriptor.name,this.params.autoAttach),r}register(){this.ctx.customStructureProperties.register(this.provider,this.params.autoAttach),this.ctx.managers.lociLabels.addProvider(this.labelProvider)}unregister(){this.ctx.customStructureProperties.unregister(this.provider.descriptor.name),this.ctx.managers.lociLabels.removeProvider(this.labelProvider)}},params:()=>({autoAttach:C.Boolean(!1),showTooltip:C.Boolean(!0)})});var LQ=16448250,Out="Assigns a color based on SIFTS mapping.",aD=new Map,uPe={...ni({type:"colors",colorList:"set-1"})};function Gut(e){return uPe}function cPe(e,t){let r;if(e.structure){for(let s of e.structure.models){let l=Qc.Provider.get(s).value;if(l)for(let u of l.accession)!u||aD.has(u)||aD.set(u,aD.size)}let n=Q.Location.create(e.structure),o=di(aD.size+1,t,{valueLabel:s=>`${s}`}),i=new Map,a=s=>{let l=Qc.getKey(s);if(!l)return LQ;if(i.has(l))return i.get(l);let u=o.color(aD.get(l));return i.set(l,u),u};r=s=>Q.Location.is(s)&&ue.isAtomic(s.unit)?a(s):It.isLocation(s)?(n.unit=s.aUnit,n.element=s.aUnit.elements[s.aIndex],a(n)):LQ}else r=()=>LQ;return{factory:cPe,granularity:"group",preferSmoothing:!0,color:r,props:t,description:Out}}var VQ={name:"sifts-mapping",label:"SIFTS Mapping",category:yr.Residue,factory:cPe,getParams:Gut,defaultValues:C.getDefaultValues(uPe),isApplicable:e=>!!e.structure?.models.some(t=>Qc.Provider.isApplicable(t)),ensureCustomProperties:{attach:async(e,t)=>{if(t.structure)for(let r of t.structure.models)await Qc.Provider.attach(e,r,void 0,!0)},detach:e=>{if(e.structure)for(let t of e.structure.models)Qc.Provider.ref(t,!1)}}};var mPe=Kr.create({name:"sifts-mapping-prop",category:"custom-props",display:{name:"SIFTS Mapping"},ctor:class extends Kr.Handler{constructor(){super(...arguments);this.provider=Qc.Provider;this.labelProvider={label:t=>{if(this.params.showTooltip)return Uut(t)}}}update(t){let r=this.params.autoAttach!==t.autoAttach||this.params.showTooltip!==t.showTooltip;return this.params.autoAttach=t.autoAttach,this.params.showTooltip=t.showTooltip,this.ctx.customStructureProperties.setDefaultAutoAttach(this.provider.descriptor.name,this.params.autoAttach),r}register(){this.ctx.customModelProperties.register(this.provider,this.params.autoAttach),this.ctx.representation.structure.themes.colorThemeRegistry.add(VQ),this.ctx.managers.lociLabels.addProvider(this.labelProvider)}unregister(){this.ctx.customModelProperties.unregister(this.provider.descriptor.name),this.ctx.representation.structure.themes.colorThemeRegistry.remove(VQ),this.ctx.managers.lociLabels.removeProvider(this.labelProvider)}},params:()=>({autoAttach:C.Boolean(!0),showTooltip:C.Boolean(!0)})});function Uut(e){if(e.kind==="element-loci"){if(e.elements.length===0)return;let t=e.elements[0],r=t.unit,n=Q.Location.create(e.structure,r,r.elements[xe.getAt(t.indices,0)]);return Qc.getLabel(n)}}var Xg;(n=>{n.Descriptor={name:"ihm_cross_link_restraint"},n.Provider=_l.create(n.Descriptor);function r(o,i){let a={entity_id:o.entity_id_1,asym_id:o.asym_id_1,seq_id:o.seq_id_1,atom_id:o.atom_id_1},s={entity_id:o.entity_id_2,asym_id:o.asym_id_2,seq_id:o.seq_id_2,atom_id:o.atom_id_2};function l(f,g,y){let x=f.get(g);x?x.push(y):f.set(g,[y])}function u(f,g){let y=g.entity_id.value(f),x=g.asym_id.value(f),S=g.seq_id.value(f);if(o.model_granularity.value(f)==="by-atom"){let I=i.atomicHierarchy.index.findAtom({auth_seq_id:S,label_asym_id:x,label_atom_id:g.atom_id.value(f),label_entity_id:y});I>=0&&l(m,I,f)}else if(i.coarseHierarchy.isDefined){let I=i.coarseHierarchy.spheres.findSequenceKey(y,x,S);if(I>=0)l(d,I,f);else{let v=i.coarseHierarchy.gaussians.findSequenceKey(y,x,S);v>=0&&l(p,v,f)}}}function c(f){switch(f){case ue.Kind.Atomic:return m;case ue.Kind.Spheres:return d;case ue.Kind.Gaussians:return p}}let m=new Map,d=new Map,p=new Map,h=[];for(let f=0;f<o._rowCount;++f)u(f,a),u(f,s);return{getIndicesByElement:(f,g)=>{let x=c(g).get(f);return x!==void 0?x:h},data:o}}n.fromTable=r})(Xg||={});var Nut=[];function dPe(e,t,r,n){return`${e}|${t.id}|${r}|${n.id}`}var sD=class{constructor(t){this.pairs=t;let r=new Map;this.pairs.forEach((n,o)=>{let i=dPe(n.indexA,n.unitA,n.indexB,n.unitB),a=r.get(i);a?a.push(o):r.set(i,[o])}),this.count=t.length,this.pairKeyIndices=r}getPairIndices(t,r,n,o){let i=dPe(t,r,n,o);return this.pairKeyIndices.get(i)||Nut}getPairs(t,r,n,o){return this.getPairIndices(t,r,n,o).map(a=>this.pairs[a])}};var hh=Zl.createProvider({label:"Cross Link Restraint",descriptor:{name:"integrative-cross-link-restraint"},type:"local",defaultParams:{},getParams:e=>({}),isApplicable:e=>e.models.some(t=>!!Xg.Provider.get(t)),obtain:async(e,t,r)=>({value:jut(t)})});var Zp;(h=>{let e;(g=>g.CrossLinkRestraint="cross-link-restraint")(e=h.Tag||={});function t(f){return f.models.some(g=>!!Xg.Provider.get(g))}h.isApplicable=t;let r=b(),n=b();function o(f){return f.unitA.conformation.position(f.unitA.elements[f.indexA],r),f.unitB.conformation.position(f.unitB.elements[f.indexB],n),b.distance(r,n)}h.distance=o;function i(f,g,y){return Mk("cross-link-restraints",{structure:g,crossLinkRestraints:f},y)}h.Location=i;function a(f){return!!f&&f.kind==="data-location"&&f.tag==="cross-link-restraints"}h.isLocation=a;function s(f,g){return f.data.structure===g.data.structure&&f.data.crossLinkRestraints===g.data.crossLinkRestraints&&f.element===g.element}h.areLocationsEqual=s;function l(f,g){let y=f.pairs[g];return`Cross Link Restraint | Type: ${y.restraintType} | Threshold: ${y.distanceThreshold} \u212B | Psi: ${y.psi} | Sigma 1: ${y.sigma1} | Sigma 2: ${y.sigma2} | Distance: ${o(y).toFixed(2)} \u212B`}function u(f){return l(f.data.crossLinkRestraints,f.element)}h.locationLabel=u;function c(f,g,y){return _C("cross-link-restraints",{structure:f,crossLinkRestraints:g},y,x=>d(g,y,x),()=>p(f,g,y))}h.Loci=c;function m(f){return!!f&&f.kind==="data-loci"&&f.tag==="interactions"}h.isLoci=m;function d(f,g,y){return ku.fromPairProvider(g.length,(x,S,I)=>{let v=f.pairs[g[x]];v.unitA.conformation.position(v.unitA.elements[v.indexA],S),v.unitB.conformation.position(v.unitB.elements[v.indexB],I)},y)}h.getBoundingSphere=d;function p(f,g,y){let x=y[0];if(x===void 0)return"";let S=g.pairs[x];return[l(g,x),LR(It.Location(f,S.unitA,S.indexA,f,S.unitB,S.indexB))].join("</br>")}h.getLabel=p})(Zp||={});function pPe(e,t,r){let{elements:n}=t,o=n.length,i=t.kind;for(let a=0;a<o;a++){let s=n[a];r.getIndicesByElement(s,i).forEach(l=>e.set(l,a))}}function zut(e,t,r){if(t.model!==r.model||t.model.sourceData.kind!=="mmCIF")return;let n=Xg.Provider.get(t.model);if(!n)return;let o=new Map,i=new Map;pPe(o,t,n),pPe(i,r,n),o.forEach((a,s)=>{let l=i.get(s);l!==void 0&&e.push(CV(t,a,r,l,n,s),CV(r,l,t,a,n,s))})}function Hut(e,t){if(t.model.sourceData.kind!=="mmCIF")return;let r=Xg.Provider.get(t.model);if(!r)return;let{elements:n}=t,o=n.length,i=t.kind,a=new Map;for(let s=0;s<o;s++){let l=n[s];r.getIndicesByElement(l,i).forEach(u=>{let c=a.get(u);c?c.push(s):a.set(u,[s])})}a.forEach((s,l)=>{if(s.length<2)return;let[u,c]=s;e.push(CV(t,u,t,c,r,l),CV(t,c,t,u,r,l))})}function CV(e,t,r,n,o,i){return{unitA:e,indexA:t,unitB:r,indexB:n,restraintType:o.data.restraint_type.value(i),distanceThreshold:o.data.distance_threshold.value(i),psi:o.data.psi.value(i),sigma1:o.data.sigma_1.value(i),sigma2:o.data.sigma_2.value(i)}}function jut(e){let t=[];if(!e.models.some(n=>Xg.Provider.get(n)))return new sD(t);let r=e.units.length;for(let n=0;n<r;++n){let o=e.units[n];Hut(t,o);for(let i=n+1;i<r;++i){let a=e.units[i];o.model===a.model&&zut(t,o,a)}}return new sD(t)}function Wut(e,t,r,n,o){let i=hh.get(t).value;if(!i.count)return ft.createEmpty(o);let{sizeFactor:a}=n,s=Q.Location.create(t),l={linkCount:i.count,position:(m,d,p)=>{let h=i.pairs[p],f=h.unitA,g=h.unitB;f.conformation.position(f.elements[h.indexA],m),g.conformation.position(g.elements[h.indexB],d)},radius:m=>{let d=i.pairs[m];return s.unit=d.unitA,s.element=d.unitA.elements[d.indexA],r.size.size(s)*a}},{mesh:u,boundingSphere:c}=rm(e,l,n,o);if(c)u.setBoundingSphere(c);else if(u.triangleCount>0){let m=he.expand(he(),t.boundary.sphere,1*a);u.setBoundingSphere(m)}return u}var fPe={...fc,...Nd,sizeFactor:C.Numeric(.5,{min:0,max:10,step:.1})};function Xut(e){return Ps({defaultProps:C.getDefaultValues(fPe),createGeometry:Wut,createLocationIterator:Qut,getLoci:Zut,eachLocation:qut,setUpdateState:(t,r,n)=>{t.createGeometry=r.sizeFactor!==n.sizeFactor||r.radialSegments!==n.radialSegments||r.linkCap!==n.linkCap}},e)}function Qut(e){let t=hh.get(e).value,{pairs:r}=t,n=r.length,o=1,i=Zp.Location(t,e);return un(n,o,1,s=>(i.element=s,i),!0)}function Zut(e,t,r){let{objectId:n,groupId:o}=e;if(r===n){let i=hh.get(t).value;if(i.pairs[o])return Zp.Loci(t,i,[o])}return vr}function qut(e,t,r){let n=!1;if(Zp.isLoci(e)){if(!De.areEquivalent(e.data.structure,t))return!1;let o=hh.get(t).value;if(e.data.crossLinkRestraints!==o)return!1;for(let i of e.elements)r(ye.ofSingleton(i))&&(n=!0)}return n}var Yut={"cross-link-restraint":(e,t)=>po("Cross-link restraint",e,t,Xut)},hPe={...fPe};function Kut(e,t){return C.clone(hPe)}function Jut(e,t){return Ut.createMulti("CrossLinkRestraint",e,t,qn,Yut)}var OQ={name:Zp.Tag.CrossLinkRestraint,label:"Cross Link Restraint",description:"Displays cross-link restraints.",factory:Jut,getParams:Kut,defaultValues:C.getDefaultValues(hPe),defaultColorTheme:{name:Zp.Tag.CrossLinkRestraint},defaultSizeTheme:{name:"uniform"},isApplicable:e=>Zp.isApplicable(e),ensureCustomProperties:{attach:(e,t)=>hh.attach(e,t,void 0,!0),detach:e=>hh.ref(e,!1)}};var gPe=13421772,$ut="Colors cross-links by the deviation of the observed distance versus the modeled distance (e.g. modeled / `ihm_cross_link_restraint.distance_threshold`).",yPe={domain:C.Interval([.5,1.5],{step:.01}),list:C.ColorList("red-grey",{presetKind:"scale"})};function ect(e){return yPe}function bPe(e,t){let r,n,o=e.structure&&hh.get(e.structure).value;if(o){n=Ja.create({domain:t.domain,listOrName:t.list.colors});let i=n.color;r=a=>{if(Zp.isLocation(a)){let s=o.pairs[a.element];if(s)return i(Zp.distance(s)/s.distanceThreshold)}return gPe}}else r=()=>gPe;return{factory:bPe,granularity:"group",color:r,props:t,description:$ut,legend:n?n.legend:void 0}}var GQ={name:"cross-link",label:"Cross Link",category:yr.Misc,factory:bPe,getParams:ect,defaultValues:C.getDefaultValues(yPe),isApplicable:e=>!!e.structure&&Zp.isApplicable(e.structure),ensureCustomProperties:{attach:(e,t)=>t.structure?hh.attach(e,t.structure,void 0,!0):Promise.resolve(),detach:e=>e.structure&&hh.ref(e.structure,!1)}};var xPe=Kr.create({name:"integrative-cross-link-restraint",category:"custom-props",display:{name:"Cross Link Restraint"},ctor:class extends Kr.Handler{constructor(){super(...arguments);this.provider=Xg.Provider}register(){this.provider.formatRegistry.add("mmCIF",tct),this.ctx.representation.structure.themes.colorThemeRegistry.add(GQ),this.ctx.representation.structure.registry.add(OQ)}unregister(){this.provider.formatRegistry.remove("mmCIF"),this.ctx.representation.structure.themes.colorThemeRegistry.remove(GQ),this.ctx.representation.structure.registry.remove(OQ)}}});function tct(e){if(!Ln.is(e.sourceData))return;let{ihm_cross_link_restraint:t}=e.sourceData.data.db;if(t._rowCount!==0)return Xg.fromTable(t,e)}var lD={State:jX,Representation:XX,Camera:QX,Misc:ZX},yc={Representation:YX,Camera:$X,State:eQ,CustomProps:UQ};var bc;(r=>{function e(n){return n}r.create=e;function t(n,o){if(o.customDurationMs)return o.customDurationMs;let i=o.definition.getDuration?.(o.params,n);if(i?.kind==="fixed")return i.durationMs}r.getDuration=t})(bc||={});async function XC(e,t,r=!1){if(t.data&&await e.runTask(e.state.data.setSnapshot(t.data)),t.canvas3d?.props){let n=C.normalizeParams(Na,t.canvas3d.props,"children");(t.camera?.current||t.camera?.focus)&&(n.camera=void 0,n.cameraClipping=void 0,n.cameraFog=void 0),e.canvas3d?.setProps(n)}t.camera?.current?e.canvas3d?.requestCameraReset({snapshot:t.camera.current,durationMs:r||t.camera.transitionStyle==="instant"?0:t.camera.transitionDurationInMs}):t.camera?.focus&&e.managers.camera.focusObject({...t.camera.focus,durationMs:r||t.camera.transitionStyle==="instant"?0:t.camera.transitionDurationInMs})}var CPe=bc.create({name:"built-in.animate-state-snapshots",display:{name:"State Snapshots"},isExportable:!0,params:()=>({}),canApply(e){let t=e.managers.snapshot.state.entries;return t.size<1?{canApply:!1,reason:"At least 1 state required."}:t.some(r=>!!r?.snapshot.startAnimation)?{canApply:!1,reason:"Nested animations not supported."}:{canApply:e.managers.snapshot.state.entries.size>0}},setup(e,t,r){let n=r.managers.snapshot.state.entries.get(0);XC(r,n.snapshot,!0)},getDuration:(e,t)=>({kind:"fixed",durationMs:t.managers.snapshot.state.entries.toArray().reduce((r,n)=>r+(n.snapshot.durationInMs??0),0)}),initialState:(e,t)=>{let r=t.managers.snapshot.state.entries.toArray();return{totalDuration:r.reduce((n,o)=>n+(o.snapshot.durationInMs??0),0),snapshots:r,currentIndex:0,currentTransitionFrame:0}},async apply(e,t,r){if(t.current>=e.totalDuration)return{kind:"finished"};let n=0,o=0,i=0;for(let c of e.snapshots){if(i=t.current-n,n+=c.snapshot.durationInMs??0,t.current<n)break;o++}if(o>=e.snapshots.length)return{kind:"finished"};let{transition:a,camera:s,canvas3d:l}=e.snapshots[o].snapshot,u=yu.getStateTransitionFrameIndex(e.snapshots[o].snapshot,i);return a&&u!==void 0?o===e.currentIndex&&u===e.currentTransitionFrame?{kind:"skip"}:(u===0||o!==e.currentIndex?await XC(r.plugin,{...a.frames[u],camera:s,canvas3d:l}):await XC(r.plugin,a.frames[u]),{kind:"next",state:{...e,currentIndex:o,currentAnimationFrame:u}}):o===e.currentIndex?{kind:"skip"}:(await XC(r.plugin,e.snapshots[o].snapshot),{kind:"next",state:{...e,currentIndex:o,currentAnimationFrame:void 0}})}}),QC=bc.create({name:"built-in.animate-state-snapshot-transition",display:{name:"State Snapshot Transition"},isExportable:!0,params:()=>({}),canApply(e){let{snapshot:t}=e.managers,{current:r}=t;return r?.snapshot.transition?{canApply:!0}:{canApply:!1,reason:"No transition found"}},setup(e,t,r){let{current:n}=r.managers.snapshot;n&&XC(r,n.snapshot.transition?.frames[0]??n.snapshot,!0)},getDuration:(e,t)=>{let{current:r}=t.managers.snapshot;return r?.snapshot.transition?r.snapshot.transition?.loop?{kind:"infinite"}:{kind:"fixed",durationMs:yu.getStateTransitionDuration(r.snapshot)??0}:{kind:"fixed",durationMs:0}},initialState:(e,t)=>{let{current:r}=t.managers.snapshot;if(r)return{totalDuration:r.snapshot.transition?.loop?Number.MAX_VALUE:yu.getStateTransitionDuration(r.snapshot)??0,snapshots:[r],currentIndex:0,currentTransitionFrame:void 0,isInitial:!0}},async apply(e,t,r){let n=e.snapshots[0]?.snapshot;if(t.current>=e.totalDuration){if(n?.transition&&e.isInitial){let l=n.transition.frames.length-1;r.plugin.managers.snapshot.setSnapshotAnimationFrame(e.totalDuration,!1),await XC(r.plugin,n.transition.frames[l])}return{kind:"finished"}}if(!n)return{kind:"finished"};let{transition:o,camera:i,canvas3d:a}=n,s=yu.getStateTransitionFrameIndex(n,t.current);return!o||s===void 0?{kind:"finished"}:s===e.currentTransitionFrame?{kind:"skip"}:(r.plugin.managers.snapshot.setSnapshotAnimationFrame(t.current,!1),s===0?await XC(r.plugin,{...o.frames[s],camera:i,canvas3d:a}):await XC(r.plugin,o.frames[s]),{kind:"next",state:{...e,currentAnimationFrame:s,isInitial:!1}})}});var yu=class e extends Pc{constructor(r){super();this.plugin=r;this.data=Rm.create(new ne.Root({}),{runTask:this.plugin.runTask,globalContext:this.plugin,historyCapacity:this.plugin.config.get(Lr.State.HistoryCapacity)});this.behaviors=Rm.create(new Kr.Root({}),{runTask:this.plugin.runTask,globalContext:this.plugin,rootState:{isLocked:!0}});this.events={cell:{stateUpdated:fm(this.data.events.cell.stateUpdated,this.behaviors.events.cell.stateUpdated),created:fm(this.data.events.cell.created,this.behaviors.events.cell.created),removed:fm(this.data.events.cell.removed,this.behaviors.events.cell.removed)},object:{created:fm(this.data.events.object.created,this.behaviors.events.object.created),removed:fm(this.data.events.object.removed,this.behaviors.events.object.removed),updated:fm(this.data.events.object.updated,this.behaviors.events.object.updated)}};this.snapshotParams=this.ev.behavior(e.DefaultSnapshotParams);this.setSnapshotParams=r=>{this.snapshotParams.next({...e.DefaultSnapshotParams,...r})}}get animation(){return this.plugin.managers.animation}getSnapshot(r){let n={...this.snapshotParams.value,...r};return{id:fn.create22(),data:n.data?this.data.getSnapshot():void 0,behaviour:n.behavior?this.behaviors.getSnapshot():void 0,animation:n.animation?this.animation.getSnapshot():void 0,startAnimation:n.startAnimation?!!n.startAnimation:void 0,camera:n.camera?{current:this.plugin.canvas3d.camera.getSnapshot(),transitionStyle:n.cameraTransition.name,transitionDurationInMs:n?.cameraTransition?.name==="animate"?n.cameraTransition.params.durationInMs:void 0}:void 0,canvas3dContext:n.canvas3dContext?{props:this.plugin.canvas3dContext?.props}:void 0,canvas3d:n.canvas3d?{props:this.plugin.canvas3d?.props}:void 0,interactivity:n.interactivity?{props:this.plugin.managers.interactivity.props}:void 0,structureFocus:this.plugin.managers.structure.focus.getSnapshot(),structureSelection:n.structureSelection?this.plugin.managers.structure.selection.getSnapshot():void 0,structureComponentManager:n.componentManager?{options:this.plugin.managers.structure.component.state.options}:void 0,durationInMs:n?.durationInMs}}async setSnapshot(r){if(await this.animation.stop(),r.structureComponentManager?.options&&this.plugin.managers.structure.component._setSnapshotState(r.structureComponentManager?.options),r.behaviour&&await this.plugin.runTask(this.behaviors.setSnapshot(r.behaviour)),r.data&&await this.plugin.runTask(this.data.setSnapshot(r.data)),r.canvas3d?.props){let n=C.normalizeParams(Na,r.canvas3d.props,"children");(r.camera?.current||r.camera?.focus)&&(n.camera=void 0,n.cameraClipping=void 0,n.cameraFog=void 0),await lt.Canvas3D.SetSettings(this.plugin,{settings:n})}if(r.canvas3dContext?.props){let n=C.normalizeParams(lh.Params,r.canvas3dContext.props,"children");this.plugin.canvas3dContext?.setProps(n)}if(r.interactivity&&r.interactivity.props&&this.plugin.managers.interactivity.setProps(r.interactivity.props),r.structureFocus&&this.plugin.managers.structure.focus.setSnapshot(r.structureFocus),r.structureSelection&&this.plugin.managers.structure.selection.setSnapshot(r.structureSelection),r.animation&&this.animation.setSnapshot(r.animation),r.camera?.current?lt.Camera.Reset(this.plugin,{snapshot:r.camera.current,durationMs:r.camera.transitionStyle==="animate"?r.camera.transitionDurationInMs:void 0}):r.camera?.focus&&lt.Camera.FocusObject(this.plugin,{...r.camera.focus,durationMs:r.camera.transitionStyle==="animate"?r.camera.transitionDurationInMs:void 0}),typeof r?.onLoadMarkdownCommands=="object"&&Object.keys(r.onLoadMarkdownCommands).length>0&&this.plugin.managers.markdownExtensions.tryExecute("click",r.onLoadMarkdownCommands),r.startAnimation){this.animation.start();return}r.transition?.autoplay&&(await Vf.immediatePromise(),this.animation.play(QC,{}))}async setAnimationSnapshot(r,n){await this.animation.stopStateTransitionAnimation();let{transition:o}=r;if(!o)return;let i=Math.min(n,o.frames.length-1),a=o.frames[i]??r.data;if(a.data&&await this.plugin.runTask(this.data.setSnapshot(a.data)),a.canvas3d?.props){let s=C.normalizeParams(Na,a.canvas3d.props,"children");this.plugin.canvas3d?.setProps(s)}a.camera?.current&&lt.Camera.Reset(this.plugin,{snapshot:a.camera.current,durationMs:a.camera.transitionStyle==="animate"?a.camera.transitionDurationInMs:void 0}),!n&&typeof r?.onLoadMarkdownCommands=="object"&&Object.keys(r.onLoadMarkdownCommands).length>0&&this.plugin.managers.markdownExtensions.tryExecute("click",r.onLoadMarkdownCommands)}updateTransform(r,n,o,i){let a=r.build().to(n).update(o);return lt.State.Update(this.plugin,{state:r,tree:a,options:{canUndo:i}})}hasBehavior(r){return this.behaviors.tree.transforms.has(r.id)}updateBehavior(r,n){let o=this.behaviors.build();if(this.behaviors.tree.transforms.has(r.id))o.to(r.id).update(n);else{let i=r.createDefaultParams(void 0,this.plugin);o.to(Kr.getCategoryId(r)).apply(r,Pl(i,n),{ref:r.id})}return this.plugin.runTask(this.behaviors.updateTree(o))}dispose(){this.behaviors.cells.forEach(r=>{Kr.Behavior.is(r.obj)&&(r.obj.data.unregister?.(),r.obj.data.dispose?.())}),super.dispose(),this.data.dispose(),this.behaviors.dispose(),this.animation.dispose()}};(a=>{a.SnapshotParams={durationInMs:C.Numeric(1500,{min:100,max:15e3,step:100},{label:"Duration in ms"}),data:C.Boolean(!0),behavior:C.Boolean(!1),structureSelection:C.Boolean(!1),componentManager:C.Boolean(!0),animation:C.Boolean(!0),startAnimation:C.Boolean(!1),canvas3d:C.Boolean(!0),canvas3dContext:C.Boolean(!0),interactivity:C.Boolean(!0),camera:C.Boolean(!0),cameraTransition:C.MappedStatic("animate",{animate:C.Group({durationInMs:C.Numeric(250,{min:100,max:5e3,step:500},{label:"Duration in ms"})}),instant:C.Group({})},{options:[["animate","Animate"],["instant","Instant"]]}),image:C.Boolean(!1)},a.DefaultSnapshotParams=C.getDefaultValues(a.SnapshotParams),a.getMinFrameDuration=es(s=>{if(!s)return 1e3/60;let{transition:l}=s;if(!l)return 1e3/60;let u=1/0;for(let c of l.frames)c.durationInMs>0&&c.durationInMs<u&&(u=c.durationInMs);return Number.isFinite(u)?u:1e3/60}),a.getStateTransitionDuration=es(s=>{if(!s)return;let{transition:l}=s;if(!l)return;let u=0;for(let c=0;c<l.frames.length;c++){let m=l.frames[c];u+=m.durationInMs}return u}),a.getStateTransitionFrameTime=es((s,l)=>{if(!s||l===void 0)return 0;let{transition:u}=s;if(!u)return 0;let c=0;for(let m=0;m<l&&!(u.frames.length<=m);m++){let d=u.frames[m];c+=d.durationInMs}return c});function i(s,l){let{transition:u}=s;if(!u?.frames.length)return;let c=l;u.loop&&(c%=(0,a.getStateTransitionDuration)(s)??1);let m=0;if(c<=u.frames[0].durationInMs)return 0;for(let d=0;d<u.frames.length;d++){if(m>=c)return d;let p=u.frames[d];m+=p.durationInMs}return u.frames.length-1}a.getStateTransitionFrameIndex=i})(yu||={});var SV="5.5.0",SPe=new Date(1766404541788);function rct(e,t,r,n=1){e.width=Math.round(window.devicePixelRatio*n*t),e.height=Math.round(window.devicePixelRatio*n*r),Object.assign(e.style,{width:`${t}px`,height:`${r}px`})}function vPe(e,t,r=1){let n=window.innerWidth,o=window.innerHeight;t!==document.body&&(n=t.offsetWidth,o=t.offsetHeight),rct(e,n,o,r)}function nct(e,t,r,n){let o=atob(e.toDataURL(r,n).split(",")[1]),i=o.length,a=i>>2,s=new Uint8Array(i),l=new Uint32Array(s.buffer,0,a),u=0;for(let m=0;m<a;++m)l[m]=o.charCodeAt(u++)|o.charCodeAt(u++)<<8|o.charCodeAt(u++)<<16|o.charCodeAt(u++)<<24;let c=i&3;for(;c--;)s[u]=o.charCodeAt(u++);t(new Blob([s],{type:r||"image/png"}))}async function uD(e,t,r){return new Promise((n,o)=>{let i=a=>{a?n(a):o("no blob returned")};HTMLCanvasElement.prototype.toBlob?e.toBlob(i,t,r):nct(e,i,t,r)})}var vV=class{constructor(){this.queue=[]}run(t){this.queue.length<2?this.queue.push(t):this.queue[this.queue.length-1]=t,this.queue.length===1&&this.next()}async next(){for(;this.queue.length>0;)try{let t=this.queue[0];await t()}catch(t){console.error("Error in SingleTaskQueue execution:",t)}finally{this.queue.shift()}}};var jp=class e extends qs{constructor(r){super({current:void 0,entries:qh(),isPlaying:!1,nextSnapshotDelayInMs:e.DefaultNextSnapshotDelayInMs});this.plugin=r;this.entryMap=new Map;this.defaultSnapshotId=void 0;this.events={changed:this.ev(),opened:this.ev()};this.animationFrameQueue=new vV;this.timeoutHandle=void 0;this.next=async()=>{this.timeoutHandle=void 0;let r=this.getNextId(this.state.current,1);if(!r||r===this.state.current){this.stop();return}let n=this.setCurrent(r);await this.plugin.state.setSnapshot(n);let o=typeof n.durationInMs<"u"?n.durationInMs:this.state.nextSnapshotDelayInMs;this.state.isPlaying&&(this.timeoutHandle=setTimeout(this.next,o))}}static{this.DefaultNextSnapshotDelayInMs=1500}updateState(r){return"current"in r&&!("currentAnimationTimeMs"in r)?super.updateState({...r,currentAnimationTimeMs:0}):super.updateState(r)}get current(){let r=this.state.current;return this.state.entries.find(n=>n.snapshot.id===r)}getIndex(r){return this.state.entries.indexOf(r)}getEntry(r){if(r)return this.entryMap.get(r)}remove(r){let n=this.entryMap.get(r);n&&(n?.image&&this.plugin.managers.asset.delete(n.image),this.entryMap.delete(r),this.updateState({current:this.state.current===r?void 0:this.state.current,entries:this.state.entries.delete(this.getIndex(n))}),this.events.changed.next(void 0))}add(r){this.entryMap.set(r.snapshot.id,r),this.updateState({current:r.snapshot.id,entries:this.state.entries.push(r)}),this.events.changed.next(void 0)}replace(r,n,o){let i=this.getEntry(r);if(!i)return;this.defaultSnapshotId=void 0,i?.image&&this.plugin.managers.asset.delete(i.image);let a=this.getIndex(i),s=e.Entry(n,{key:o?.key??i.key,name:o?.name??i.name,description:o?.description??i.description,descriptionFormat:o?.descriptionFormat??i.descriptionFormat,image:o?.image});this.entryMap.set(n.id,s),this.updateState({current:s.snapshot.id,entries:this.state.entries.set(a,s)}),this.events.changed.next(void 0)}move(r,n){let o=this.state.entries.size;if(o<2)return;let i=this.getEntry(r);if(!i)return;let a=this.getIndex(i),s=(a+n)%o;s<0&&(s+=o);let l=this.state.entries.get(s),u=this.state.entries.asMutable();u.set(s,i),u.set(a,l),this.updateState({current:i.snapshot.id,entries:u.asImmutable()}),this.events.changed.next(void 0)}update(r,n){let o=this.getIndex(r);if(o<0)return;let i=this.state.entries.set(o,{...r,key:n.key?.trim()||void 0,name:n.name?.trim()||void 0,description:n.description?.trim()||void 0,descriptionFormat:n.descriptionFormat});this.updateState({entries:i}),this.entryMap.set(r.snapshot.id,this.state.entries.get(o)),this.events.changed.next(void 0)}clear(){this.state.entries.size!==0&&(this.entryMap.forEach(r=>{r?.image&&this.plugin.managers.asset.delete(r.image)}),this.entryMap.clear(),this.updateState({current:void 0,entries:qh()}),this.events.changed.next(void 0))}applyKey(r){let n=this.state.entries.find(o=>o.key===r);n&&(this.updateState({current:n.snapshot.id}),this.events.changed.next(void 0),this.plugin.state.setSnapshot(n.snapshot))}setCurrent(r){let n=this.getEntry(r);return n&&(this.updateState({current:r}),this.events.changed.next(void 0)),n&&n.snapshot}setSnapshotAnimationFrame(r,n=!1){let o=this.getEntry(this.state.current);if(!o)return;let i=yu.getStateTransitionFrameIndex(o.snapshot,r)??0;return this.updateState({currentAnimationTimeMs:r})&&this.events.changed.next(void 0),n&&this.animationFrameQueue.run(()=>this.plugin.state.setAnimationSnapshot(o.snapshot,i??0)),i}getNextId(r,n){let o=this.state.entries.size;if(!r){if(o===0)return;let s=n===-1?o-1:0;return this.state.entries.get(s).snapshot.id}let i=this.getEntry(r);if(!i)return;let a=this.getIndex(i);if(!(a<0))return a=(a+n)%o,a<0&&(a+=o),this.state.entries.get(a).snapshot.id}applyNext(r){let n=this.getNextId(this.state.current,r);if(n){let o=this.setCurrent(n);if(o)return this.plugin.state.setSnapshot(o)}}async setStateSnapshot(r){this.clear();let n=qh().asMutable();for(let s of r.entries)this.entryMap.set(s.snapshot.id,s),n.push(s);let o=r.current?r.current:r.entries.length>0?r.entries[0].snapshot.id:void 0;if(this.updateState({current:o,entries:n.asImmutable(),isPlaying:!1,nextSnapshotDelayInMs:r.playback?r.playback.nextSnapshotDelayInMs:e.DefaultNextSnapshotDelayInMs}),this.events.changed.next(void 0),!o)return;let i=this.getEntry(o),a=i&&i.snapshot;if(a)return await this.plugin.state.setSnapshot(a),r.playback?.isPlaying&&this.play({delayFirst:!0}),a}async syncCurrent(r){let n=this.state.entries.size===0,o=this.state.entries.size===1&&this.state.current&&(!this.defaultSnapshotId||this.state.current===this.defaultSnapshotId);if(!n&&!o)return;let i=this.plugin.state.getSnapshot(r?.params),a=r?.params?.image??this.plugin.state.snapshotParams.value.image?await e.getCanvasImageAsset(this.plugin,`${i.id}-image.png`):void 0;if(n)this.add(e.Entry(i,{name:r?.name,description:r?.description,descriptionFormat:r?.descriptionFormat,image:a}));else if(o){let s=this.getEntry(this.state.current);s?.image&&this.plugin.managers.asset.delete(s.image),this.replace(this.state.current,i,{image:a})}this.defaultSnapshotId=i.id}async getStateSnapshot(r){await this.syncCurrent(r);let n=this.state.entries.valueSeq().toArray();for(let o=0;o<n.length;o++)n[o]._transientData&&(n[o]={...n[o]},delete n[o]._transientData);return{timestamp:+new Date,version:SV,name:r&&r.name,description:r&&r.description,current:this.state.current,playback:{isPlaying:!!(r&&r.playOnLoad),nextSnapshotDelayInMs:this.state.nextSnapshotDelayInMs},entries:n}}async serialize(r){let n=JSON.stringify(await this.getStateSnapshot({params:r?.params}),null,2);if(!r?.type||r.type==="json"||r.type==="molj")return new Blob([n],{type:"application/json;charset=utf-8"});{let o=new Uint8Array(pI(n));Wx(o,0,n);let i={"state.json":o},a=[];for(let{asset:l,file:u}of this.plugin.managers.asset.assets)a.push([l.id,l]),i[`assets/${l.id}`]=new Uint8Array(await u.arrayBuffer());if(a.length>0){let l=JSON.stringify(a,null,2),u=new Uint8Array(pI(l));Wx(u,0,l),i["assets.json"]=u}let s=await this.plugin.runTask(Ole(i));return new Blob([s],{type:"application/zip"})}}async open(r){try{let n=r.name.toLowerCase();if(n.endsWith("json")||n.endsWith("molj")){let o=await this.plugin.runTask(eg(r,"string")),i=JSON.parse(Tm.toString(o));e.isStateSnapshot(i)?await this.setStateSnapshot(i):e.isStateSnapshot(i.data)?await this.setStateSnapshot(i.data):await this.plugin.state.setSnapshot(i)}else{let o=await this.plugin.runTask(eg(r,"zip")),i=Object.create(null);wi(o,(l,u)=>{if(u==="state.json"||u==="assets.json")return;let c=u.substring(u.indexOf("/")+1);i[c]=l});let a=new File([o["state.json"]],"state.json"),s=await this.plugin.runTask(eg(a,"json"));if(o["assets.json"]){let l=new File([o["assets.json"]],"assets.json"),u=await this.plugin.runTask(eg(l,"json"));for(let[c,m]of u)this.plugin.managers.asset.set(m,new File([i[c]],m.name))}await this.setStateSnapshot(s)}this.events.opened.next(void 0)}catch(n){console.error(n),this.plugin.log.error("Error reading state")}}async startPlayback(){let{current:r}=this;if(r)if(r.snapshot.transition){let n=this.setCurrent(this.state.current);await this.plugin.state.setSnapshot(n);let o=typeof n.durationInMs<"u"?n.durationInMs:this.state.nextSnapshotDelayInMs;this.state.isPlaying&&(this.timeoutHandle=setTimeout(this.next,o))}else return this.next()}async play(r){if(this.state.isPlaying&&!r?.delayFirst)if(r?.restart)await this.stop();else return;if(this.updateState({isPlaying:!0}),r?.delayFirst){let n=this.getEntry(this.state.current);if(!n){this.next();return}this.events.changed.next(void 0);let o=n.snapshot,i=typeof o.durationInMs<"u"?o.durationInMs:this.state.nextSnapshotDelayInMs;this.timeoutHandle=setTimeout(this.next,i)}else this.startPlayback()}async stop(){await this.plugin.managers.animation.stop(),this.updateState({isPlaying:!1}),typeof this.timeoutHandle<"u"&&clearTimeout(this.timeoutHandle),this.timeoutHandle=void 0,this.events.changed.next(void 0)}async togglePlay(){this.state.isPlaying?(await this.stop(),this.plugin.managers.markdownExtensions.audio.pause()):await this.play()}dispose(){super.dispose(),this.entryMap.clear()}};(n=>{function e(o,i){return{timestamp:+new Date,snapshot:o,...i}}n.Entry=e;function t(o){let i=o;return!!i&&!!i.timestamp&&!!i.entries}n.isStateSnapshot=t;async function r(o,i){let a=Ae.create("Render Screenshot",async s=>{if(!o.helpers.viewportScreenshot)return;let l=await o.helpers.viewportScreenshot.getPreview(s,512);if(!l)return;let u=await uD(l.canvas,"png"),c=new File([u],i),m={kind:"file",id:fn.create22(),name:i};return o.managers.asset.set(m,c),m});return o.runTask(a)}n.getCanvasImageAsset=r})(jp||={});function zQ(e,t){if(!e.canvas3d)return;let r=t.targets?.map(o=>{let i=o.targetRef!==void 0?HQ(e,o.targetRef):NQ(e);if(!i)return;let a=o.radius??i.radius*(o.radiusFactor??1)+(o.extraRadius??0);return he.create(i.center,a)}).filter(o=>o!==void 0),n=r&&r.length>0?jQ(r):NQ(e);return ict(e.canvas3d.camera,{center:n.center,radius:Math.max(n.radius,t.minRadius??0),up:t.up,direction:t.direction})}var oct=b();function ict(e,t){let r=t.center,n=Math.max(t.radius,.01),o=t.direction??b.sub(b(),e.target,e.position),i=b.orthogonalize(b(),o,t.up??e.up),a=e.getTargetDistance(n),s=b.setMagnitude(oct,o,a),l=b.sub(b(),r,s);return{target:r,position:l,up:i,radius:n}}function HQ(e,t){let r=IPe([],e,t);if(r.length!==0)return r.length===1?r[0]:jQ(r)}function IPe(e,t,r){let n=t.state.data.cells.get(r),o=act(t,n);return o?e.push(...o):t.state.data.tree.children.get(r).forEach(a=>IPe(e,t,a)),e}function act(e,t){let r=t?.obj;if(r){if(!r.data){console.warn("Focus: no data");return}if(r.data instanceof De){let o=tr.getDecorated(e.state.data,t.transform.ref)?.obj?.data??r?.data,i=nr.getBoundingSphere(De.Loci(o));return i?[i]:[]}else if(ne.isRepresentation3D(r)){let n=[];for(let o of r.data.repr.renderObjects){let i=o.values.boundingSphere.ref.value;i.radius>0&&n.push(i)}return n}}}function NQ(e){let r=sct(e,!1).map(n=>n.values.boundingSphere.ref.value).filter(n=>n.radius>0);return jQ(r)}function sct(e,t){let r=Array.from(e.state.data.cells.values()).filter(o=>o.obj&&ne.isRepresentation3D(o.obj));return t||(r=r.filter(o=>!o.state.isHidden)),r.flatMap(o=>o.obj.data.repr.renderObjects)}var yT;function jQ(e){yT??=new Fi("98"),yT.reset();for(let t of e)yT.includeSphere(t);yT.finishedIncludeStep();for(let t of e)yT.radiusSphere(t);return yT.getSphere()}function APe(e,t){return e==="orthographic"?1/(2*Math.tan(t/2)):1/(2*Math.sin(t/2))}function TPe(e,t,r,n){let o=b.sub(b(),t,e),i=APe(r,n);return b.scaleAndAdd(o,e,o,i)}function PPe(e,t,r,n){let o=b.sub(b(),t,e),i=APe(r,n)||1;return b.scaleAndAdd(o,e,o,1/i)}var lct=function(e,t,r){if(r||arguments.length===2)for(var n=0,o=t.length,i;n<o;n++)(i||!(n in t))&&(i||(i=Array.prototype.slice.call(t,0,n)),i[n]=t[n]);return e.concat(i||Array.prototype.slice.call(t))};function _Pe(e){return e}function WQ(e,t,r,n,o,i,a,s,l){switch(arguments.length){case 1:return e;case 2:return t(e);case 3:return r(t(e));case 4:return n(r(t(e)));case 5:return o(n(r(t(e))));case 6:return i(o(n(r(t(e)))));case 7:return a(i(o(n(r(t(e))))));case 8:return s(a(i(o(n(r(t(e)))))));case 9:return l(s(a(i(o(n(r(t(e))))))));default:{for(var u=arguments[0],c=1;c<arguments.length;c++)u=arguments[c](u);return u}}}var IV=function(e,t){var r=typeof e=="number"?function(n){return n.length>=e}:e;return function(){var n=Array.from(arguments);return r(arguments)?t.apply(this,n):function(o){return t.apply(void 0,lct([o],n,!1))}}};var RPe=function(e){return e._tag==="Left"};var DPe=function(e){return{_tag:"Left",left:e}},wPe=function(e){return{_tag:"Right",right:e}};function XQ(e){return function(t,r){return e.map(t,function(){return r})}}function MPe(e){var t=XQ(e);return function(r){return t(r,void 0)}}function BPe(e){return function(t,r){return e.chain(t,function(n){return e.map(r(n),function(){return n})})}}var EPe=DPe,cD=wPe,mct=IV(2,function(e,t){return _s(e)?e:t(e.right)}),kPe=function(e,t){return WQ(e,pct(t))},dct=function(e,t){return WQ(e,hct(t))};var QQ="Either";var pct=function(e){return function(t){return _s(t)?t:cD(e(t.right))}},FPe={URI:QQ,map:kPe},Mln=IV(2,XQ(FPe)),Bln=MPe(FPe);var fct=function(e){return function(t){return _s(t)?t:_s(e)?e:cD(t.right(e.right))}},hct=fct;var gct={URI:QQ,map:kPe,ap:dct,chain:mct};var yct={URI:QQ,fromEither:_Pe};var _s=RPe;var Eln=IV(2,BPe(gct));var kln={fromEither:yct.fromEither};var Ti=(function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(n[i]=o[i])},e(t,r)};return function(t,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");e(t,r);function n(){this.constructor=t}t.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}})(),bT=function(){return bT=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e},bT.apply(this,arguments)},bct=function(e,t,r){if(r||arguments.length===2)for(var n=0,o=t.length,i;n<o;n++)(i||!(n in t))&&(i||(i=Array.prototype.slice.call(t,0,n)),i[n]=t[n]);return e.concat(i||Array.prototype.slice.call(t))},ZC=EPe,Zm=function(e,t,r){return ZC([{value:e,context:t,message:r}])},Rs=cD,Ko=(function(){function e(t,r,n,o){this.name=t,this.is=r,this.validate=n,this.encode=o,this.decode=this.decode.bind(this)}return e.prototype.pipe=function(t,r){var n=this;return r===void 0&&(r="pipe(".concat(this.name,", ").concat(t.name,")")),new e(r,t.is,function(o,i){var a=n.validate(o,i);return _s(a)?a:t.validate(a.right,i)},this.encode===Xi&&t.encode===Xi?Xi:function(o){return n.encode(t.encode(o))})},e.prototype.asDecoder=function(){return this},e.prototype.asEncoder=function(){return this},e.prototype.decode=function(t){return this.validate(t,[{key:"",type:this,actual:t}])},e})();var Xi=function(e){return e};function xct(e){return e.displayName||e.name||"<function".concat(e.length,">")}function Db(e,t,r,n){for(var o=e.length,i=Array(o+1),a=0;a<o;a++)i[a]=e[a];return i[o]={key:t,type:r,actual:n},i}function b1(e,t){for(var r=t.length,n=0;n<r;n++)e.push(t[n])}var xT=Object.prototype.hasOwnProperty;function qQ(e){return Object.keys(e).map(function(t){return"".concat(t,": ").concat(e[t].name)}).join(", ")}function mD(e){for(var t=0;t<e.length;t++)if(e[t].encode!==Xi)return!1;return!0}function UPe(e){return"{ ".concat(qQ(e)," }")}function NPe(e){return"Partial<".concat(e,">")}function Cct(e,t,r,n){n===void 0&&(n="{ [K in ".concat(t.name,"]: ").concat(r.name," }"));for(var o=e.length,i={},a=0;a<o;a++)i[e[a]]=r;var s=emt(i,n);return new YPe(n,function(l){return s.is(l)},s.validate,s.encode,t,r)}function zPe(e){var t;if(jPe(e)){var r=e.value;if(JQ.is(r))return t={},t[r]=null,t}else{if(_ct(e))return e.keys;if(XPe(e)){var n=e.types.map(function(o){return zPe(o)});return n.some(KQ.is)?void 0:Object.assign.apply(Object,bct([{}],n,!1))}}}function LPe(e,t){for(var r=Object.keys(e),n=r.length,o=!1,i={},a=0;a<n;a++){var s=r[a];t.is(s)?i[s]=e[s]:o=!0}return o?i:e}function Sct(e,t,r){return r===void 0&&(r="{ [K in ".concat(e.name,"]: ").concat(t.name," }")),new YPe(r,function(n){return gh.is(n)?Object.keys(n).every(function(o){return!e.is(o)||t.is(n[o])}):GPe(t)&&Array.isArray(n)},function(n,o){if(gh.is(n)){for(var i={},a=[],s=Object.keys(n),l=s.length,u=!1,c=0;c<l;c++){var m=s[c],d=n[m],p=e.validate(m,Db(o,m,e,m));if(_s(p))u=!0;else{var h=p.right;u=u||h!==m,m=h;var f=t.validate(d,Db(o,m,t,d));if(_s(f))b1(a,f.left);else{var g=f.right;u=u||g!==d,i[m]=g}}}return a.length>0?ZC(a):Rs(u?i:n)}return GPe(t)&&Array.isArray(n)?Rs(n):Zm(n,o)},e.encode===Xi&&t.encode===Xi?function(n){return LPe(n,e)}:function(n){for(var o={},i=Object.keys(LPe(n,e)),a=i.length,s=0;s<a;s++){var l=i[s];o[String(e.encode(l))]=t.encode(n[l])}return o},e,t)}function vct(e){return"("+e.map(function(t){return t.name}).join(" | ")+")"}function VPe(e,t){for(var r=!0,n=!0,o=!gh.is(e),i=0,a=t;i<a.length;i++){var s=a[i];s!==e&&(r=!1),gh.is(s)&&(n=!1)}if(r)return e;if(n)return t[t.length-1];for(var l={},u=0,c=t;u<c.length;u++){var s=c[u];for(var m in s)(!xT.call(l,m)||o||s[m]!==e[m])&&(l[m]=s[m])}return l}function YQ(e){switch(e._tag){case"RefinementType":case"ReadonlyType":return YQ(e.type);case"InterfaceType":case"StrictType":case"PartialType":return e.props;case"IntersectionType":return e.types.reduce(function(t,r){return Object.assign(t,YQ(r))},{})}}function OPe(e,t){for(var r=Object.getOwnPropertyNames(e),n=!1,o={},i=0;i<r.length;i++){var a=r[i];xT.call(t,a)?o[a]=e[a]:n=!0}return n?o:e}function Ict(e){return WPe(e)?"{| ".concat(qQ(e.props)," |}"):Rct(e)?NPe("{| ".concat(qQ(e.props)," |}")):"Exact<".concat(e.name,">")}function Act(e){return e.length>0}var zd={};function HPe(e,t){for(var r=[],n=0,o=e;n<o.length;n++){var i=o[n];t.indexOf(i)!==-1&&r.push(i)}return r}function Tct(e,t){if(e===zd)return t;if(t===zd)return e;var r=Object.assign({},e);for(var n in t)if(xT.call(e,n)){var o=HPe(e[n],t[n]);if(Act(o))r[n]=o;else{r=zd;break}}else r[n]=t[n];return r}function Pct(e,t){if(e===zd||t===zd)return zd;var r=zd;for(var n in e)if(xT.call(t,n)){var o=HPe(e[n],t[n]);o.length===0&&(r===zd&&(r={}),r[n]=e[n].concat(t[n]))}return r}function GPe(e){return e._tag==="AnyType"}function jPe(e){return e._tag==="LiteralType"}function _ct(e){return e._tag==="KeyofType"}function WPe(e){return e._tag==="InterfaceType"}function Rct(e){return e._tag==="PartialType"}function Dct(e){return e._tag==="StrictType"}function wct(e){return e._tag==="ExactType"}function Mct(e){return e._tag==="RefinementType"}function Bct(e){return e._tag==="IntersectionType"}function XPe(e){return e._tag==="UnionType"}function Ect(e){return e._tag==="RecursiveType"}function kct(e){return e._tag==="ReadonlyType"}var ZQ=[];function y1(e){if(ZQ.indexOf(e)!==-1)return zd;if(WPe(e)||Dct(e)){var t=zd;for(var r in e.props){var n=e.props[r];jPe(n)&&(t===zd&&(t={}),t[r]=[n.value])}return t}else{if(wct(e)||Mct(e)||kct(e))return y1(e.type);if(Bct(e))return e.types.reduce(function(i,a){return Tct(i,y1(a))},zd);if(XPe(e))return e.types.slice(1).reduce(function(i,a){return Pct(i,y1(a))},y1(e.types[0]));if(Ect(e)){ZQ.push(e);var o=y1(e.type);return ZQ.pop(),o}}return zd}function Fct(e){var t=y1(e[0]),r=Object.keys(t),n=e.length,o=function(u){for(var c=t[u].slice(),m=[t[u]],d=1;d<n;d++){var p=e[d],h=y1(p),f=h[u];if(f===void 0)return"continue-keys";if(f.some(function(g){return c.indexOf(g)!==-1}))return"continue-keys";c.push.apply(c,f),m.push(f)}return{value:[u,m]}};e:for(var i=0,a=r;i<a.length;i++){var s=a[i],l=o(s);if(typeof l=="object")return l.value;if(l==="continue-keys")continue e}}var Lct=(function(e){Ti(t,e);function t(){var r=e.call(this,"null",function(n){return n===null},function(n,o){return r.is(n)?Rs(n):Zm(n,o)},Xi)||this;return r._tag="NullType",r}return t})(Ko);var QPe=new Lct,Vct=(function(e){Ti(t,e);function t(){var r=e.call(this,"undefined",function(n){return n===void 0},function(n,o){return r.is(n)?Rs(n):Zm(n,o)},Xi)||this;return r._tag="UndefinedType",r}return t})(Ko);var KQ=new Vct,Oct=(function(e){Ti(t,e);function t(){var r=e.call(this,"void",KQ.is,KQ.validate,Xi)||this;return r._tag="VoidType",r}return t})(Ko);var Vln=new Oct,Gct=(function(e){Ti(t,e);function t(){var r=e.call(this,"unknown",function(n){return!0},Rs,Xi)||this;return r._tag="UnknownType",r}return t})(Ko);var Oln=new Gct,Uct=(function(e){Ti(t,e);function t(){var r=e.call(this,"string",function(n){return typeof n=="string"},function(n,o){return r.is(n)?Rs(n):Zm(n,o)},Xi)||this;return r._tag="StringType",r}return t})(Ko);var JQ=new Uct,Nct=(function(e){Ti(t,e);function t(){var r=e.call(this,"number",function(n){return typeof n=="number"},function(n,o){return r.is(n)?Rs(n):Zm(n,o)},Xi)||this;return r._tag="NumberType",r}return t})(Ko);var TV=new Nct,zct=(function(e){Ti(t,e);function t(){var r=e.call(this,"bigint",function(n){return typeof n=="bigint"},function(n,o){return r.is(n)?Rs(n):Zm(n,o)},Xi)||this;return r._tag="BigIntType",r}return t})(Ko);var Gln=new zct,Hct=(function(e){Ti(t,e);function t(){var r=e.call(this,"boolean",function(n){return typeof n=="boolean"},function(n,o){return r.is(n)?Rs(n):Zm(n,o)},Xi)||this;return r._tag="BooleanType",r}return t})(Ko);var ZPe=new Hct,jct=(function(e){Ti(t,e);function t(){var r=e.call(this,"UnknownArray",Array.isArray,function(n,o){return r.is(n)?Rs(n):Zm(n,o)},Xi)||this;return r._tag="AnyArrayType",r}return t})(Ko);var AV=new jct,Wct=(function(e){Ti(t,e);function t(){var r=e.call(this,"UnknownRecord",function(n){return n!==null&&typeof n=="object"&&!Array.isArray(n)},function(n,o){return r.is(n)?Rs(n):Zm(n,o)},Xi)||this;return r._tag="AnyDictionaryType",r}return t})(Ko);var gh=new Wct;var Uln=(function(e){Ti(t,e);function t(r,n,o,i,a){var s=e.call(this,r,n,o,i)||this;return s.value=a,s._tag="LiteralType",s}return t})(Ko);var Nln=(function(e){Ti(t,e);function t(r,n,o,i,a){var s=e.call(this,r,n,o,i)||this;return s.keys=a,s._tag="KeyofType",s}return t})(Ko);var Xct=(function(e){Ti(t,e);function t(r,n,o,i,a,s){var l=e.call(this,r,n,o,i)||this;return l.type=a,l.predicate=s,l._tag="RefinementType",l}return t})(Ko);function Qct(e,t,r){return t2e(e,t,r)}var zln=Qct(TV,function(e){return Number.isInteger(e)},"Int"),Zct=(function(e){Ti(t,e);function t(r,n,o,i,a){var s=e.call(this,r,n,o,i)||this;return s.runDefinition=a,s._tag="RecursiveType",s}return t})(Ko);Object.defineProperty(Zct.prototype,"type",{get:function(){return this.runDefinition()},enumerable:!0,configurable:!0});var qct=(function(e){Ti(t,e);function t(r,n,o,i,a){var s=e.call(this,r,n,o,i)||this;return s.type=a,s._tag="ArrayType",s}return t})(Ko);function qPe(e,t){return t===void 0&&(t="Array<".concat(e.name,">")),new qct(t,function(r){return AV.is(r)&&r.every(e.is)},function(r,n){var o=AV.validate(r,n);if(_s(o))return o;for(var i=o.right,a=i.length,s=i,l=[],u=0;u<a;u++){var c=i[u],m=e.validate(c,Db(n,String(u),e,c));if(_s(m))b1(l,m.left);else{var d=m.right;d!==c&&(s===i&&(s=i.slice()),s[u]=d)}}return l.length>0?ZC(l):Rs(s)},e.encode===Xi?Xi:function(r){return r.map(e.encode)},e)}var Yct=(function(e){Ti(t,e);function t(r,n,o,i,a){var s=e.call(this,r,n,o,i)||this;return s.props=a,s._tag="InterfaceType",s}return t})(Ko);function PV(e,t){t===void 0&&(t=UPe(e));var r=Object.keys(e),n=r.map(function(i){return e[i]}),o=r.length;return new Yct(t,function(i){if(gh.is(i)){for(var a=0;a<o;a++){var s=r[a],l=i[s];if(l===void 0&&!xT.call(i,s)||!n[a].is(l))return!1}return!0}return!1},function(i,a){var s=gh.validate(i,a);if(_s(s))return s;for(var l=s.right,u=l,c=[],m=0;m<o;m++){var d=r[m],p=u[d],h=n[m],f=h.validate(p,Db(a,d,h,p));if(_s(f))b1(c,f.left);else{var g=f.right;(g!==p||g===void 0&&!xT.call(u,d))&&(u===l&&(u=bT({},l)),u[d]=g)}}return c.length>0?ZC(c):Rs(u)},mD(n)?Xi:function(i){for(var a=bT({},i),s=0;s<o;s++){var l=r[s],u=n[s].encode;u!==Xi&&(a[l]=u(i[l]))}return a},e)}var Kct=(function(e){Ti(t,e);function t(r,n,o,i,a){var s=e.call(this,r,n,o,i)||this;return s.props=a,s._tag="PartialType",s}return t})(Ko);function $Q(e,t){t===void 0&&(t=NPe(UPe(e)));var r=Object.keys(e),n=r.map(function(i){return e[i]}),o=r.length;return new Kct(t,function(i){if(gh.is(i)){for(var a=0;a<o;a++){var s=r[a],l=i[s];if(l!==void 0&&!e[s].is(l))return!1}return!0}return!1},function(i,a){var s=gh.validate(i,a);if(_s(s))return s;for(var l=s.right,u=l,c=[],m=0;m<o;m++){var d=r[m],p=u[d],h=e[d],f=h.validate(p,Db(a,d,h,p));if(_s(f))p!==void 0&&b1(c,f.left);else{var g=f.right;g!==p&&(u===l&&(u=bT({},l)),u[d]=g)}}return c.length>0?ZC(c):Rs(u)},mD(n)?Xi:function(i){for(var a=bT({},i),s=0;s<o;s++){var l=r[s],u=i[l];u!==void 0&&(a[l]=n[s].encode(u))}return a},e)}var YPe=(function(e){Ti(t,e);function t(r,n,o,i,a,s){var l=e.call(this,r,n,o,i)||this;return l.domain=a,l.codomain=s,l._tag="DictionaryType",l}return t})(Ko);function KPe(e,t,r){var n=zPe(e);return n?Cct(Object.keys(n),e,t,r):Sct(e,t,r)}var _V=(function(e){Ti(t,e);function t(r,n,o,i,a){var s=e.call(this,r,n,o,i)||this;return s.types=a,s._tag="UnionType",s}return t})(Ko);function JPe(e,t){t===void 0&&(t=vct(e));var r=Fct(e);if(r!==void 0&&e.length>0){var n=r[0],o=r[1],i=o.length,a=function(s){for(var l=0;l<i;l++)if(o[l].indexOf(s)!==-1)return l};return new amt(t,function(s){if(gh.is(s)){var l=a(s[n]);return l!==void 0?e[l].is(s):!1}return!1},function(s,l){var u=gh.validate(s,l);if(_s(u))return u;var c=u.right,m=a(c[n]);if(m===void 0)return Zm(s,l);var d=e[m];return d.validate(c,Db(l,String(m),d,c))},mD(e)?Xi:function(s){var l=a(s[n]);if(l===void 0)throw new Error("no codec found to encode value in union codec ".concat(t));return e[l].encode(s)},e,n)}else return new _V(t,function(s){return e.some(function(l){return l.is(s)})},function(s,l){for(var u=[],c=0;c<e.length;c++){var m=e[c],d=m.validate(s,Db(l,String(c),m,s));if(_s(d))b1(u,d.left);else return Rs(d.right)}return ZC(u)},mD(e)?Xi:function(s){for(var l=0,u=e;l<u.length;l++){var c=u[l];if(c.is(s))return c.encode(s)}throw new Error("no codec found to encode value in union type ".concat(t))},e)}var Jct=(function(e){Ti(t,e);function t(r,n,o,i,a){var s=e.call(this,r,n,o,i)||this;return s.types=a,s._tag="IntersectionType",s}return t})(Ko);function $Pe(e,t){t===void 0&&(t="(".concat(e.map(function(n){return n.name}).join(" & "),")"));var r=e.length;return new Jct(t,function(n){return e.every(function(o){return o.is(n)})},e.length===0?Rs:function(n,o){for(var i=[],a=[],s=0;s<r;s++){var l=e[s],u=l.validate(n,Db(o,String(s),l,n));_s(u)?b1(a,u.left):i.push(u.right)}return a.length>0?ZC(a):Rs(VPe(n,i))},e.length===0?Xi:function(n){return VPe(n,e.map(function(o){return o.encode(n)}))},e)}var $ct=(function(e){Ti(t,e);function t(r,n,o,i,a){var s=e.call(this,r,n,o,i)||this;return s.types=a,s._tag="TupleType",s}return t})(Ko);function e2e(e,t){t===void 0&&(t="[".concat(e.map(function(n){return n.name}).join(", "),"]"));var r=e.length;return new $ct(t,function(n){return AV.is(n)&&n.length===r&&e.every(function(o,i){return o.is(n[i])})},function(n,o){var i=AV.validate(n,o);if(_s(i))return i;for(var a=i.right,s=a.length>r?a.slice(0,r):a,l=[],u=0;u<r;u++){var c=a[u],m=e[u],d=m.validate(c,Db(o,String(u),m,c));if(_s(d))b1(l,d.left);else{var p=d.right;p!==c&&(s===a&&(s=a.slice()),s[u]=p)}}return l.length>0?ZC(l):Rs(s)},mD(e)?Xi:function(n){return e.map(function(o,i){return o.encode(n[i])})},e)}var Hln=(function(e){Ti(t,e);function t(r,n,o,i,a){var s=e.call(this,r,n,o,i)||this;return s.type=a,s._tag="ReadonlyType",s}return t})(Ko);var jln=(function(e){Ti(t,e);function t(r,n,o,i,a){var s=e.call(this,r,n,o,i)||this;return s.type=a,s._tag="ReadonlyArrayType",s}return t})(Ko);var emt=function(e,t){return rmt(PV(e),t)},tmt=(function(e){Ti(t,e);function t(r,n,o,i,a){var s=e.call(this,r,n,o,i)||this;return s.type=a,s._tag="ExactType",s}return t})(Ko);function rmt(e,t){t===void 0&&(t=Ict(e));var r=YQ(e);return new tmt(t,e.is,function(n,o){var i=gh.validate(n,o);if(_s(i))return i;var a=e.validate(n,o);return _s(a)?a:cD(OPe(a.right,r))},function(n){return e.encode(OPe(n,r))},e)}var nmt=(function(e){Ti(t,e);function t(){var r=e.call(this,"Function",function(n){return typeof n=="function"},function(n,o){return r.is(n)?Rs(n):Zm(n,o)},Xi)||this;return r._tag="FunctionType",r}return t})(Ko);var Wln=new nmt,omt=(function(e){Ti(t,e);function t(){var r=e.call(this,"never",function(n){return!1},function(n,o){return Zm(n,o)},function(){throw new Error("cannot encode never")})||this;return r._tag="NeverType",r}return t})(Ko);var Xln=new omt,imt=(function(e){Ti(t,e);function t(){var r=e.call(this,"any",function(n){return!0},Rs,Xi)||this;return r._tag="AnyType",r}return t})(Ko);var Qln=new imt;function t2e(e,t,r){return r===void 0&&(r="(".concat(e.name," | ").concat(xct(t),")")),new Xct(r,function(n){return e.is(n)&&t(n)},function(n,o){var i=e.validate(n,o);if(_s(i))return i;var a=i.right;return t(a)?Rs(a):Zm(a,o)},e.encode,e,t)}var r2e=t2e(TV,Number.isInteger,"Integer"),amt=(function(e){Ti(t,e);function t(r,n,o,i,a,s){var l=e.call(this,r,n,o,i,a)||this;return l.tag=s,l}return t})(_V);var smt=(function(e){Ti(t,e);function t(){var r=e.call(this,"object",function(n){return n!==null&&typeof n=="object"},function(n,o){return r.is(n)?Rs(n):Zm(n,o)},Xi)||this;return r._tag="ObjectType",r}return t})(Ko);var Zln=new smt;var qln=(function(e){Ti(t,e);function t(r,n,o,i,a){var s=e.call(this,r,n,o,i)||this;return s.props=a,s._tag="StrictType",s}return t})(Ko);var Vr=JQ,To=r2e,mr=TV,ho=ZPe,Qg=e2e,za=qPe,qm=KPe;function RV(e,t,r){if(!t)return PV(e,r);if(r===void 0){let n=[];for(let o in e)n.push(`${o}: ${e[o].name}`);for(let o in t)n.push(`${o}?: ${t[o].name}`);r=`{ ${n.join(", ")} }`}return $Pe([PV(e),$Q(t)],r)}function eZ(e,t){if(t===void 0){let r=[];for(let n in e)r.push(`${n}?: ${e[n].name}`);t=`{ ${r.join(", ")} }`}return $Q(e,t)}function aa(e,t,...r){let n=[];for(let o of[e,t,...r])o instanceof _V?n.push(...o.types):n.push(o);return JPe(n)}function kt(e){return aa(e,QPe)}function Qi(...e){if(e.length===0)throw new Error("literal type must have at least one value");let t=e.length===1?V3(e[0]):`(${e.map(n=>V3(n)).join(" | ")})`,r=new Set(e);return new Ko(t,(n=>r.has(n)),(n,o)=>r.has(n)?{_tag:"Right",right:n}:{_tag:"Left",left:[{value:n,context:o,message:`"${n}" is not a valid value for literal type ${t}`}]},n=>n)}function yn(e,t){return{type:e,required:!0,description:t}}function Ue(e,t,r){return{type:e,required:!1,description:r,default:t}}function o2e(e,t){let r=e.type.decode(t);if(r._tag!=="Right")return lmt(r.left)}function lmt(e){if(e.length!==0)return e.map(umt)}function umt(e){return e.message!==void 0?e.message:`Invalid value ${dmt(e.value)} supplied to ${cmt(e.context)}`}function cmt(e){return e.map(t=>`${t.key}: ${t.type.name}`).join("/")}function mmt(e){return e.displayName||e.name||`<function ${e.length}>`}function dmt(e){return typeof e=="function"?mmt(e):typeof e=="number"&&!isFinite(e)?isNaN(e)?"NaN":e>0?"Infinity":"-Infinity":JSON.stringify(e)}function Ur(e){return{type:"simple",fields:e}}function wb(e,t,r){return{type:"union",discriminator:e,discriminatorDescription:t,cases:r}}function pmt(e){let t=VP(e.fields,r=>yn(r.type,r.description));return Ur(t)}function fmt(e){let t=VP(e.cases,tZ);return wb(e.discriminator,e.discriminatorDescription,t)}function tZ(e){return e.type==="simple"?pmt(e):fmt(e)}function rZ(e,t,r={}){return rv(t)?e.type==="simple"?hmt(e,t,r):gmt(e,t,r):[`Parameters must be an object, not ${t}`]}function hmt(e,t,r){for(let n in e.fields){let o=e.fields[n];if(Object.hasOwn(t,n)){let i=t[n],a=o2e(o,i);if(a)return[`Invalid value for parameter "${n}":`,...a.map(s=>"  "+s)]}else{if(o.required)return[`Missing required parameter "${n}".`];if(r.requireAll)return[`Missing optional parameter "${n}".`]}}if(r.noExtra){for(let n in t)if(!Object.hasOwn(e.fields,n))return[`Unknown parameter "${n}".`]}}function gmt(e,t,r){if(!Object.hasOwn(t,e.discriminator))return[`Missing required parameter "${e.discriminator}".`];let n=t[e.discriminator],o=e.cases[n];if(o===void 0){let a=Object.keys(e.cases).map(s=>`"${s}"`).join(" | ");return[`Invalid value for parameter "${e.discriminator}":`,`"${n}" is not a valid value for literal type (${a})`]}let i=rZ(o,Tu(t,[e.discriminator]),r);if(i)return i.unshift(`(case "${e.discriminator}": "${n}")`),i.map(a=>"  "+a)}function x1(e,t){return e.type==="simple"?ymt(e,t):bmt(e,t)}function ymt(e,t){let r={...t};for(let n in e.fields){let o=e.fields[n];!o.required&&r[n]===void 0&&(r[n]=o.default)}return r}function bmt(e,t){let r=t[e.discriminator],n=e.cases[r];return x1(n,t)}function DV(e){return e.params??{}}function i2e(e){return e.custom??{}}function qC(e){return e.children??[]}function a2e(e){return{...e,nodes:VP(e.nodes,t=>({...t,params:tZ(t.params)}))}}var s2e=Qi("mmcif","bcif","pdb","pdbqt","gro","xyz","mol","sdf","mol2","lammpstrj","xtc","nctraj","dcd","trr","psf","prmtop","top","map","dx","dxbin"),dD=Qi("cif","pdb","pdbqt","gro","xyz","mol","sdf","mol2","lammpstrj","xtc","nctraj","dcd","trr","psf","prmtop","top","map","dx","dxbin"),l2e=Qi("model","assembly","symmetry","symmetry_mates"),nZ=Qi("all","polymer","protein","nucleic","branched","ligand","ion","water","coarse"),xmt=eZ({label_entity_id:Vr,label_asym_id:Vr,auth_asym_id:Vr,label_seq_id:To,auth_seq_id:To,pdbx_PDB_ins_code:Vr,beg_label_seq_id:To,end_label_seq_id:To,beg_auth_seq_id:To,end_auth_seq_id:To,label_comp_id:Vr,auth_comp_id:Vr,residue_index:To,label_atom_id:Vr,auth_atom_id:Vr,type_symbol:Vr,atom_id:To,atom_index:To,instance_id:Vr}),C1=xmt,wV=Qi("whole_structure","entity","chain","auth_chain","residue","auth_residue","residue_range","auth_residue_range","atom","auth_atom","all_atomic"),u2e=Qi("cif","bcif","json"),Pi=Qg([mr,mr,mr]),qp=za(mr),c2e=Qi("bottom-left","bottom-center","bottom-right","middle-left","middle-center","middle-right","top-left","top-center","top-right"),Cmt=eZ({structure_ref:Vr,expression_schema:wV,expressions:za(C1)}),Smt=Cmt,xc=aa(Pi,C1,Smt),oZ=za(mr),pD=za(To),m2e=za(Vr),vmt=new Ko("HexColor",(e=>typeof e=="string"),(e,t)=>Amt(e)?{_tag:"Right",right:e}:{_tag:"Left",left:[{value:e,context:t,message:`"${e}" is not a valid hex color string`}]},e=>e),Imt=/^#([0-9A-F]{3}){1,2}$/i;function Amt(e){return typeof e=="string"&&Imt.test(e)}var Tmt=new Ko("ColorName",(e=>typeof e=="string"),(e,t)=>Pmt(e)?{_tag:"Right",right:e}:{_tag:"Left",left:[{value:e,context:t,message:`"${e}" is not a valid color name`}]},e=>e);function Pmt(e){return e in Lt}var Po=aa(Tmt,vmt);function d2e(e){return!!e&&Array.isArray(e)&&e.length===3&&typeof e[0]=="number"}function iZ(e){return!!e&&Array.isArray(e.expressions)}function p2e(e){return!!e&&typeof e=="object"&&!e.expressions}var aZ=Qi("Reds","Oranges","Greens","Blues","Purples","Greys","OrRd","BuGn","PuBuGn","GnBu","PuBu","BuPu","RdPu","PuRd","YlOrRd","YlOrBr","YlGn","YlGnBu","Magma","Inferno","Plasma","Viridis","Cividis","Turbo","Warm","Cool","CubehelixDefault","Rainbow","Sinebow","RdBu","RdGy","PiYG","BrBG","PRGn","PuOr","RdYlGn","RdYlBu","Spectral","Category10","Observable10","Tableau10","Set1","Set2","Set3","Pastel1","Pastel2","Dark2","Paired","Accent","Chainbow"),_mt=Qi("ElementSymbol","ResidueName","ResidueProperties","SecondaryStructure"),Rmt=RV({kind:Qi("categorical")},{colors:aa(aZ,_mt,za(Po),qm(Vr,Po)),repeat_color_list:ho,sort:Qi("none","lexical","numeric"),sort_direction:Qi("ascending","descending"),case_insensitive:ho,missing_color:kt(Po)}),Dmt=Rmt,f2e={kind:"categorical",colors:"Category10",repeat_color_list:!1,sort:"none",sort_direction:"ascending",case_insensitive:!1,missing_color:null},wmt=RV({kind:Qi("discrete")},{colors:aa(aZ,za(Po),za(Qg([Po,mr])),za(Qg([kt(Po),kt(mr),kt(mr)]))),reverse:ho,mode:Qi("normalized","absolute"),value_domain:Qg([kt(mr),kt(mr)])}),sZ=wmt,h2e={kind:"discrete",colors:"YlGn",reverse:!1,mode:"normalized",value_domain:[null,null]},Mmt=RV({kind:Qi("continuous")},{colors:aa(aZ,za(Po),za(Qg([Po,mr]))),reverse:ho,mode:Qi("normalized","absolute"),value_domain:Qg([kt(mr),kt(mr)]),underflow_color:kt(aa(Qi("auto"),Po)),overflow_color:kt(aa(Qi("auto"),Po))}),lZ=Mmt,g2e={kind:"continuous",colors:"YlGn",reverse:!1,mode:"normalized",value_domain:[null,null],underflow_color:null,overflow_color:null},uZ=aa(Dmt,sZ,lZ);var y2e={start:yn(xc,"Start point of the tube."),end:yn(xc,"End point of the tube."),radius:Ue(mr,.05,"Tube radius (in Angstroms)."),dash_length:Ue(kt(mr),null,"Length of each dash and gap between dashes. If not specified (null), draw full line."),color:Ue(kt(Po),null,"Color of the tube. If not specified, uses the parent primitives group `color`.")},Bmt={vertices:yn(oZ,"3*n_vertices length array of floats with vertex position (x1, y1, z1, ...)."),indices:yn(pD,"3*n_triangles length array of indices into vertices that form triangles (t1_1, t1_2, t1_3, ...)."),triangle_groups:Ue(kt(pD),null,"Assign a number to each triangle to group them. If not specified, each triangle is considered a separate group (triangle i = group i)."),group_colors:Ue(qm(To,Po),{},"Assign a color to each group. Where not assigned, uses `color`."),group_tooltips:Ue(qm(To,Vr),{},"Assign a tooltip to each group. Where not assigned, uses `tooltip`."),color:Ue(kt(Po),null,"Color of the triangles and wireframe. Can be overwritten by `group_colors`. If not specified, uses the parent primitives group `color`."),tooltip:Ue(kt(Vr),null,"Tooltip shown when hovering over the mesh. Can be overwritten by `group_tooltips`. If not specified, uses the parent primitives group `tooltip`."),show_triangles:Ue(ho,!0,"Determine whether to render triangles of the mesh."),show_wireframe:Ue(ho,!1,"Determine whether to render wireframe of the mesh."),wireframe_width:Ue(mr,1,"Wireframe line width (in screen-space units)."),wireframe_color:Ue(kt(Po),null,"Wireframe color. If not specified, uses `group_colors`.")},Emt={vertices:yn(oZ,"3*n_vertices length array of floats with vertex position (x1, y1, z1, ...)."),indices:yn(pD,"2*n_lines length array of indices into vertices that form lines (l1_1, l1_2, ...)."),line_groups:Ue(kt(pD),null,"Assign a number to each triangle to group them. If not specified, each line is considered a separate group (line i = group i)."),group_colors:Ue(qm(To,Po),{},"Assign a color to each group. Where not assigned, uses `color`."),group_tooltips:Ue(qm(To,Vr),{},"Assign a tooltip to each group. Where not assigned, uses `tooltip`."),group_widths:Ue(qm(To,mr),{},"Assign a line width to each group. Where not assigned, uses `width`."),color:Ue(kt(Po),null,"Color of the lines. Can be overwritten by `group_colors`. If not specified, uses the parent primitives group `color`."),tooltip:Ue(kt(Vr),null,"Tooltip shown when hovering over the lines. Can be overwritten by `group_tooltips`. If not specified, uses the parent primitives group `tooltip`."),width:Ue(mr,1,"Line width (in screen-space units). Can be overwritten by `group_widths`.")},kmt={...y2e,tooltip:Ue(kt(Vr),null,"Tooltip to show when hovering over the tube. If not specified, uses the parent primitives group `tooltip`.")},Fmt={start:yn(xc,"Start point of the arrow."),end:Ue(kt(xc),null,"End point of the arrow."),direction:Ue(kt(Pi),null,"If specified, the endpoint is computed as start + direction."),length:Ue(kt(mr),null,"Length of the arrow. If unset, the distance between start and end is used."),show_start_cap:Ue(ho,!1,"Draw a cap at the start of the arrow."),start_cap_length:Ue(kt(mr),null,"Length of the start cap. If not provided, will be 2 * start_cap_radius."),start_cap_radius:Ue(kt(mr),null,"Radius of the start cap. If not provided, will be 2 * tube_radius."),show_end_cap:Ue(ho,!1,"Draw a cap at the end of the arrow."),end_cap_length:Ue(kt(mr),null,"Length of the end cap. If not provided, will be 2 * end_cap_radius."),end_cap_radius:Ue(kt(mr),null,"Radius of the end cap. If not provided, will be 2 * tube_radius."),show_tube:Ue(ho,!0,"Draw a tube connecting the start and end points."),tube_radius:Ue(mr,.05,"Tube radius (in Angstroms)."),tube_dash_length:Ue(kt(mr),null,"Length of each dash and gap between dashes. If not specified (null), draw full line."),color:Ue(kt(Po),null,"Color of the tube. If not specified, uses the parent primitives group `color`."),tooltip:Ue(kt(Vr),null,"Tooltip to show when hovering over the arrow. If not specified, uses the parent primitives group `tooltip`.")},Lmt={...y2e,label_template:Ue(Vr,"{{distance}}","Template used to construct the label. Use {{distance}} as placeholder for the distance."),label_size:Ue(kt(mr),null,"Size of the label (text height in Angstroms). If not specified, size will be relative to the distance (see label_auto_size_scale, label_auto_size_min)."),label_auto_size_scale:Ue(mr,.1,"Scaling factor for relative size."),label_auto_size_min:Ue(mr,0,"Minimum size for relative size."),label_color:Ue(kt(Po),null,"Color of the label. If not specified, uses the parent primitives group `label_color`.")},Vmt={a:yn(xc,"Point A."),b:yn(xc,"Point B."),c:yn(xc,"Point C."),label_template:Ue(Vr,"{{angle}}","Template used to construct the label. Use {{angle}} as placeholder for the angle in radians."),label_size:Ue(kt(mr),null,"Size of the label (text height in Angstroms). If not specified, size will be relative to the distance (see label_auto_size_scale, label_auto_size_min)."),label_auto_size_scale:Ue(mr,.33,"Scaling factor for relative size."),label_auto_size_min:Ue(mr,0,"Minimum size for relative size."),label_color:Ue(kt(Po),null,"Color of the label. If not specified, uses the parent primitives group `label_color`."),show_vector:Ue(ho,!0,"Draw vectors between (a, b) and (b, c)."),vector_color:Ue(kt(Po),null,"Color of the vectors."),vector_radius:Ue(mr,.05,"Radius of the vectors."),show_section:Ue(ho,!0,"Draw a filled circle section representing the angle."),section_color:Ue(kt(Po),null,"Color of the angle section. If not specified, the primitives group color is used."),section_radius:Ue(kt(mr),null,"Radius of the angle section. In angstroms."),section_radius_scale:Ue(mr,.33,"Factor to scale the radius of the angle section. Ignored if section_radius is set.")},Omt={position:yn(xc,"Position of this label."),text:yn(Vr,"The label."),label_size:Ue(mr,1,"Size of the label (text height in Angstroms)."),label_color:Ue(kt(Po),null,"Color of the label. If not specified, uses the parent primitives group `label_color`."),label_offset:Ue(mr,0,"Camera-facing offset to prevent overlap with geometry.")},Gmt={color:Ue(kt(Po),null,"Color of the ellipse. If not specified, uses the parent primitives group `color`."),as_circle:Ue(ho,!1,"If true, ignores radius_minor/magnitude of the minor axis."),center:yn(xc,"The center of the ellipse."),major_axis:Ue(kt(Pi),null,"Major axis of this ellipse."),minor_axis:Ue(kt(Pi),null,"Minor axis of this ellipse."),major_axis_endpoint:Ue(kt(xc),null,"Major axis endpoint. If specified, overrides major axis to be major_axis_endpoint - center."),minor_axis_endpoint:Ue(kt(xc),null,"Minor axis endpoint. If specified, overrides minor axis to be minor_axis_endpoint - center."),radius_major:Ue(kt(mr),null,"Radius of the major axis. If unset, the length of the major axis is used."),radius_minor:Ue(kt(mr),null,"Radius of the minor axis. If unset, the length of the minor axis is used."),theta_start:Ue(mr,0,"Start of the arc. In radians"),theta_end:Ue(mr,2*Math.PI,"End of the arc. In radians"),tooltip:Ue(kt(Vr),null,"Tooltip to show when hovering over the tube. If not specified, uses the parent primitives group `tooltip`.")},Umt={color:Ue(kt(Po),null,"Color of the ellipsoid. If not specified, uses the parent primitives group `color`."),center:yn(xc,"The center of the ellipsoid."),major_axis:Ue(kt(Pi),null,"Major axis of this ellipsoid."),minor_axis:Ue(kt(Pi),null,"Minor axis of this ellipsoid."),major_axis_endpoint:Ue(kt(xc),null,"Major axis endpoint. If specified, overrides major axis to be major_axis_endpoint - center."),minor_axis_endpoint:Ue(kt(xc),null,"Minor axis endpoint. If specified, overrides minor axis to be minor_axis_endpoint - center."),radius:Ue(kt(aa(Pi,mr)),null,"Radii of the ellipsoid along each axis."),radius_extent:Ue(kt(aa(Pi,mr)),null,"Added to the radii of the ellipsoid along each axis."),tooltip:Ue(kt(Vr),null,"Tooltip to show when hovering over the tube. If not specified, uses the parent primitives group `tooltip`.")},Nmt={center:yn(xc,"The center of the box."),extent:Ue(kt(Pi),null,"The width, the height, and the depth of the box. Added to the bounding box determined by the center."),show_faces:Ue(ho,!0,"Determine whether to render the faces of the box."),face_color:Ue(kt(Po),null,"Color of the box faces."),show_edges:Ue(ho,!1,"Determine whether to render the edges of the box."),edge_radius:Ue(mr,.1,"Radius of the box edges. In angstroms."),edge_color:Ue(kt(Po),null,"Color of the edges."),tooltip:Ue(kt(Vr),null,"Tooltip to show when hovering over the tube. If not specified, uses the parent primitives group `tooltip`.")},b2e=wb("kind","Kind of geometrical primitive",{mesh:Ur(Bmt),lines:Ur(Emt),tube:Ur(kmt),arrow:Ur(Fmt),distance_measurement:Ur(Lmt),angle_measurement:Ur(Vmt),label:Ur(Omt),ellipse:Ur(Gmt),ellipsoid:Ur(Umt),box:Ur(Nmt)});var zmt={size_factor:Ue(mr,1,"Scales the corresponding visuals."),tubular_helices:Ue(ho,!1,"Simplify corkscrew helices to tubes.")},Hmt={size_factor:Ue(mr,1,"Scales the corresponding visuals.")},jmt={size_factor:Ue(mr,1,"Scales the corresponding visuals."),ignore_hydrogens:Ue(ho,!1,"Controls whether hydrogen atoms are drawn.")},Wmt={size_factor:Ue(mr,1,"Scales the corresponding visuals."),ignore_hydrogens:Ue(ho,!1,"Controls whether hydrogen atoms are drawn.")},Xmt={size_factor:Ue(mr,1,"Scales the corresponding visuals."),ignore_hydrogens:Ue(ho,!1,"Controls whether hydrogen atoms are drawn.")},Qmt={size_factor:Ue(mr,1,"Scales the corresponding visuals.")},Zmt={surface_type:Ue(Qi("molecular","gaussian"),"molecular","Type of surface representation. (Default is 'molecular')"),size_factor:Ue(mr,1,"Scales the corresponding visuals."),ignore_hydrogens:Ue(ho,!1,"Controls whether hydrogen atoms are drawn.")},x2e=wb("type","Representation type",{cartoon:Ur(zmt),backbone:Ur(Hmt),ball_and_stick:Ur(jmt),line:Ur(Wmt),spacefill:Ur(Xmt),carbohydrate:Ur(Qmt),surface:Ur(Zmt)}),qmt={relative_isovalue:Ue(kt(mr),null,"Relative isovalue."),absolute_isovalue:Ue(kt(mr),null,"Absolute isovalue. Overrides `relative_isovalue`."),show_wireframe:Ue(ho,!1,"Show mesh wireframe. Defaults to false."),show_faces:Ue(ho,!0,"Show mesh faces. Defaults to true.")},Ymt={dimension:yn(Qi("x","y","z"),"Dimension of the grid slice, i.e. 'x', 'y', or 'z'."),absolute_index:Ue(kt(To),null,"Index of the grid slice in the specified dimension. 0-based index, i.e. 0 is the first slice."),relative_index:Ue(kt(mr),null,"Relative index of the grid slice in the specified dimension. 0.0 is the first slice, 1.0 is the last slice. Overrides `absolute_index`."),relative_isovalue:Ue(kt(mr),null,"Relative isovalue."),absolute_isovalue:Ue(kt(mr),null,"Absolute isovalue. Overrides `relative_isovalue`.")},C2e=wb("type","Representation type",{isosurface:Ur(qmt),grid_slice:Ur(Ymt)}),cZ={check_transform:Ue(kt(qp),null,"Transformation matrix to applied to each point before clipping. For example, can be used to clip volumes in the grid/fractional space. Default is null."),invert:Ue(ho,!1,"Inverts the clipping region. Default is false"),variant:Ue(Qi("object","pixel"),"pixel",'Variant of the clip node, either "object" or "pixel"')},S2e=wb("type","Clip type",{plane:Ur({...cZ,normal:yn(Pi,"Normal vector of the clipping plane."),point:yn(Pi,"Point on the clipping plane.")}),sphere:Ur({...cZ,center:yn(Pi,"Center of the clipping sphere."),radius:Ue(mr,1,"Radius of the clipping sphere.")}),box:Ur({...cZ,center:yn(Pi,"Center of the clipping box."),size:Ue(Pi,[1,1,1],"Size of the clipping box."),rotation:Ue(qp,[1,0,0,0,1,0,0,0,1],"Rotation matrix (3x3 matrix flattened in column major format (j*3+i indexing), this is equivalent to Fortran-order in numpy). This matrix will multiply the structure coordinates from the left. The default value is the identity matrix (corresponds to no rotation).")})});var MV={uri:yn(Vr,"URL of the annotation resource."),format:yn(u2e,"Format of the annotation resource."),schema:yn(wV,"Annotation schema defines what fields in the annotation will be taken into account."),block_header:Ue(kt(Vr),null,'Header of the CIF block to read annotation from (only applies when `format` is `"cif"` or `"bcif"`). If `null`, block is selected based on `block_index`.'),block_index:Ue(To,0,'0-based index of the CIF block to read annotation from (only applies when `format` is `"cif"` or `"bcif"` and `block_header` is `null`).'),category_name:Ue(kt(Vr),null,'Name of the CIF category to read annotation from (only applies when `format` is `"cif"` or `"bcif"`). If `null`, the first category in the block is used.'),field_name:yn(Vr,"Name of the column in CIF or field name (key) in JSON that contains the dependent variable (color/label/tooltip/component_id...)."),field_remapping:Ue(qm(Vr,kt(Vr)),{},'Optional remapping of annotation field names `{ standardName1: actualName1, ... }`. Use `{ "label_asym_id": "X" }` to load actual field "X" as "label_asym_id". Use `{ "label_asym_id": null }` to ignore actual field "label_asym_id". Fields not mentioned here are mapped implicitely (i.e. actual name = standard name).')},BV={schema:yn(wV,"Annotation schema defines what fields in the annotation will be taken into account."),block_header:Ue(kt(Vr),null,"Header of the CIF block to read annotation from. If `null`, block is selected based on `block_index`."),block_index:Ue(To,0,"0-based index of the CIF block to read annotation from (only applies when `block_header` is `null`)."),category_name:Ue(kt(Vr),null,"Name of the CIF category to read annotation from. If `null`, the first category in the block is used."),field_name:yn(Vr,"Name of the column in CIF or field name (key) in JSON that contains the dependent variable (color/label/tooltip/component_id...)."),field_remapping:Ue(qm(Vr,kt(Vr)),{},'Optional remapping of annotation field names `{ standardName1: actualName1, ... }`. Use `{ "label_asym_id": "X" }` to load actual field "X" as "label_asym_id". Use `{ "label_asym_id": null }` to ignore actual field "label_asym_id". Fields not mentioned here are mapped implicitely (i.e. actual name = standard name).')},fD="white",v2e=Ur({rotation:Ue(qp,[1,0,0,0,1,0,0,0,1],"Rotation matrix (3x3 matrix flattened in column major format (j*3+i indexing), this is equivalent to Fortran-order in numpy). This matrix will multiply the structure coordinates from the left. The default value is the identity matrix (corresponds to no rotation)."),translation:Ue(Pi,[0,0,0],"Translation vector, applied to the structure coordinates after rotation. The default value is the zero vector (corresponds to no translation)."),rotation_center:Ue(kt(aa(Pi,Qi("centroid"))),null,"Point to rotate the object around. Can be either a 3D vector or dynamically computed object centroid."),matrix:Ue(kt(qp),null,"Transform matrix (4x4 matrix flattened in column major format (j*4+i indexing), this is equivalent to Fortran-order in numpy). This matrix will multiply the structure coordinates from the left. Takes precedence over `rotation` and `translation`.")}),nm={rootKind:"root",nodes:{root:{description:"Auxiliary node kind that only appears as the tree root.",parent:[],params:Ur({})},download:{description:"This node instructs to retrieve a data resource.",parent:["root"],params:Ur({url:yn(Vr,"URL of the data resource.")})},parse:{description:"This node instructs to parse a data resource.",parent:["download"],params:Ur({format:yn(s2e,"Format of the input data resource.")})},coordinates:{description:"This node instructs to retrieve molecular coordinates from a parsed data resource.",parent:["parse"],params:Ur({})},structure:{description:'This node instructs to create a structure from a parsed data resource. "Structure" refers to an internal representation of molecular coordinates without any visual representation.',parent:["parse"],params:Ur({type:yn(l2e,'Type of structure to be created (`"model"` for original model coordinates, `"assembly"` for assembly structure, `"symmetry"` for a set of crystal unit cells based on Miller indices, `"symmetry_mates"` for a set of asymmetric units within a radius from the original model).'),block_header:Ue(kt(Vr),null,"Header of the CIF block to read coordinates from (only applies when the input data are from CIF or BinaryCIF). If `null`, block is selected based on `block_index`."),block_index:Ue(To,0,"0-based index of the CIF block to read coordinates from (only applies when the input data are from CIF or BinaryCIF and `block_header` is `null`)."),model_index:Ue(To,0,"0-based index of model in case the input data contain multiple models."),assembly_id:Ue(kt(Vr),null,'Assembly identifier (only applies when `kind` is `"assembly"`). If `null`, the first assembly is selected.'),radius:Ue(mr,5,'Distance (in Angstroms) from the original model in which asymmetric units should be included (only applies when `kind` is `"symmetry_mates"`).'),ijk_min:Ue(Qg([To,To,To]),[-1,-1,-1],'Miller indices of the bottom-left unit cell to be included (only applies when `kind` is `"symmetry"`).'),ijk_max:Ue(Qg([To,To,To]),[1,1,1],'Miller indices of the top-right unit cell to be included (only applies when `kind` is `"symmetry"`).'),coordinates_ref:Ue(kt(Vr),null,"Reference to a specific set of coordinates.")})},transform:{description:"This node instructs to rotate and/or translate coordinates OR provide a transformation matrix.",parent:["structure","component","volume"],params:v2e},instance:{description:"This node allows instantiation using the provided transformation parameters.",parent:["structure","component","volume"],params:v2e},component:{description:"This node instructs to create a component (i.e. a subset of the parent structure).",parent:["structure"],params:Ur({selector:yn(aa(nZ,C1,za(C1)),"Defines what part of the parent structure should be included in this component.")})},component_from_uri:{description:"This node instructs to create a component defined by an external annotation resource.",parent:["structure"],params:Ur({...MV,field_name:Ue(Vr,"component","Name of the column in CIF or field name (key) in JSON that contains the component identifier."),field_values:Ue(kt(za(Vr)),null,"List of component identifiers (i.e. values in the field given by `field_name`) which should be included in this component. If `null`, component identifiers are ignored (all annotation rows are included), and `field_name` field can be dropped from the annotation.")})},component_from_source:{description:"This node instructs to create a component defined by an annotation resource included in the same file this structure was loaded from. Only applicable if the structure was loaded from an mmCIF or BinaryCIF file.",parent:["structure"],params:Ur({...BV,field_name:Ue(Vr,"component","Name of the column in CIF or field name (key) in JSON that contains the component identifier."),field_values:Ue(kt(za(Vr)),null,"List of component identifiers (i.e. values in the field given by `field_name`) which should be included in this component. If `null`, component identifiers are ignored (all annotation rows are included), and `field_name` field can be dropped from the annotation.")})},representation:{description:"This node instructs to create a visual representation of a component.",parent:["component","component_from_uri","component_from_source"],params:x2e},volume:{description:'This node instructs to create a volume from a parsed data resource. "Volume" refers to an internal representation of volumetric data without any visual representation.',parent:["parse"],params:Ur({channel_id:Ue(kt(Vr),null,"Channel identifier (only applies when the input data contain multiple channels).")})},volume_representation:{description:"This node instructs to create a visual representation of a volume.",parent:["volume"],params:C2e},color:{description:"This node instructs to apply color to a visual representation.",parent:["representation","volume_representation"],params:Ur({color:Ue(Po,fD,'Color to apply to the representation. Can be either an X11 color name (e.g. `"red"`) or a hexadecimal code (e.g. `"#FF0011"`).'),selector:Ue(aa(nZ,C1,za(C1)),"all","Defines to what part of the representation this color should be applied.")})},color_from_uri:{description:"This node instructs to apply colors to a visual representation. The colors are defined by an external annotation resource.",parent:["representation"],params:Ur({...MV,field_name:Ue(Vr,"color","Name of the column in CIF or field name (key) in JSON that contains the color."),palette:Ue(kt(uZ),null,"Customize mapping of annotation values to colors.")})},color_from_source:{description:"This node instructs to apply colors to a visual representation. The colors are defined by an annotation resource included in the same file this structure was loaded from. Only applicable if the structure was loaded from an mmCIF or BinaryCIF file.",parent:["representation"],params:Ur({...BV,field_name:Ue(Vr,"color","Name of the column in CIF or field name (key) in JSON that contains the color."),palette:Ue(kt(uZ),null,"Customize mapping of annotation values to colors.")})},clip:{description:"This node instructs to apply clipping to a visual representation.",parent:["representation","volume_representation","primitives","primitives_from_uri"],params:S2e},opacity:{description:"This node instructs to apply opacity/transparency to a visual representation.",parent:["representation","volume_representation"],params:Ur({opacity:yn(mr,"Opacity of a representation. 0.0: fully transparent, 1.0: fully opaque.")})},label:{description:"This node instructs to add a label (textual visual representation) to a component.",parent:["component","component_from_uri","component_from_source"],params:Ur({text:yn(Vr,"Content of the shown label.")})},label_from_uri:{description:"This node instructs to add labels (textual visual representations) to parts of a structure. The labels are defined by an external annotation resource.",parent:["structure"],params:Ur({...MV,field_name:Ue(Vr,"label","Name of the column in CIF or field name (key) in JSON that contains the label text.")})},label_from_source:{description:"This node instructs to add labels (textual visual representations) to parts of a structure. The labels are defined by an annotation resource included in the same file this structure was loaded from. Only applicable if the structure was loaded from an mmCIF or BinaryCIF file.",parent:["structure"],params:Ur({...BV,field_name:Ue(Vr,"label","Name of the column in CIF or field name (key) in JSON that contains the label text.")})},tooltip:{description:'This node instructs to add a tooltip to a component. "Tooltip" is a text which is not a part of the visualization but should be presented to the users when they interact with the component (typically, the tooltip will be shown somewhere on the screen when the user hovers over a visual representation of the component).',parent:["component","component_from_uri","component_from_source"],params:Ur({text:yn(Vr,"Content of the shown tooltip.")})},tooltip_from_uri:{description:"This node instructs to add tooltips to parts of a structure. The tooltips are defined by an external annotation resource.",parent:["structure"],params:Ur({...MV,field_name:Ue(Vr,"tooltip","Name of the column in CIF or field name (key) in JSON that contains the tooltip text.")})},tooltip_from_source:{description:"This node instructs to add tooltips to parts of a structure. The tooltips are defined by an annotation resource included in the same file this structure was loaded from. Only applicable if the structure was loaded from an mmCIF or BinaryCIF file.",parent:["structure"],params:Ur({...BV,field_name:Ue(Vr,"tooltip","Name of the column in CIF or field name (key) in JSON that contains the tooltip text.")})},focus:{description:"This node instructs to set the camera focus to a component (zoom in).",parent:["root","component","component_from_uri","component_from_source","primitives","primitives_from_uri","volume","volume_representation"],params:Ur({direction:Ue(Pi,[0,0,-1],"Vector describing the direction of the view (camera position -> focused target)."),up:Ue(Pi,[0,1,0],"Vector which will be aligned with the screen Y axis."),radius:Ue(kt(mr),null,"Radius of the focused sphere (overrides `radius_factor` and `radius_extra`)."),radius_factor:Ue(mr,1,"Radius of the focused sphere relative to the radius of parent component (default: 1). Focused radius = component_radius * radius_factor + radius_extent."),radius_extent:Ue(mr,0,"Addition to the radius of the focused sphere, if computed from the radius of parent component (default: 0). Focused radius = component_radius * radius_factor + radius_extent.")})},camera:{description:"This node instructs to set the camera position and orientation.",parent:["root"],params:Ur({target:yn(Pi,"Coordinates of the point in space at which the camera is pointing."),position:yn(Pi,"Coordinates of the camera."),up:Ue(Pi,[0,1,0],"Vector which will be aligned with the screen Y axis."),near:Ue(kt(mr),null,"Near clipping plane distance from the position.")})},canvas:{description:"This node sets canvas properties.",parent:["root"],params:Ur({background_color:Ue(Po,"white",'Color of the canvas background. Can be either an X11 color name (e.g. `"red"`) or a hexadecimal code (e.g. `"#FF0011"`). Defaults to white.')})},primitives:{description:"This node groups a list of geometrical primitives",parent:["structure","root"],params:Ur({color:Ue(Po,"white","Default color for primitives in this group."),label_color:Ue(Po,"white","Default label color for primitives in this group."),tooltip:Ue(kt(Vr),null,"Default tooltip for primitives in this group."),opacity:Ue(mr,1,"Opacity of primitive geometry in this group."),label_opacity:Ue(mr,1,"Opacity of primitive labels in this group."),label_show_tether:Ue(ho,!1,"Whether to show a tether line between the label and the target. Defaults to false."),label_tether_length:Ue(mr,1,"Length of the tether line between the label and the target. Defaults to 1 (Angstrom)."),label_attachment:Ue(c2e,"middle-center",'How to attach the label to the target. Defaults to "middle-center".'),label_background_color:Ue(kt(Po),null,"Background color of the label. Defaults to none/transparent."),snapshot_key:Ue(kt(Vr),null,"Load snapshot with the provided key when interacting with this primitives group."),instances:Ue(kt(za(qp)),null,"Instances of this primitive group defined as 4x4 column major (j * 4 + i indexing) transformation matrices.")})},primitives_from_uri:{description:"This node loads a list of primitives from URI",parent:["structure","root"],params:Ur({uri:yn(Vr,"Location of the resource."),format:yn(Qi("mvs-node-json"),"Format of the data."),references:Ue(m2e,[],"List of nodes the data are referencing.")})},primitive:{description:"This node represents a geometrical primitive",parent:["primitives"],params:b2e}}},Mb=a2e(nm);var Kmt=Lt.white,Jmt=b();function $mt(e,t){let r=b.create(...t.target),n=b.create(...t.position),o=b.distance(r,n)/2;e.canvas3d&&(n=TPe(r,n,e.canvas3d.camera.state.mode,e.canvas3d.camera.state.fov));let i=b.create(...t.up);return b.orthogonalize(i,b.sub(Jmt,r,n),i),{target:r,position:n,up:i,radius:o,radiusMax:o,minNear:t.near??void 0}}function edt(e){let t=e.length>0?e[e.length-1]:void 0,r=t?.params.direction??nm.nodes.focus.params.fields.direction.default,n=t?.params.up??nm.nodes.focus.params.fields.up.default;return{targets:e.map(o=>({targetRef:o.target.ref==="-=root=-"?void 0:o.target.ref,radius:o.params.radius??void 0,radiusFactor:o.params.radius_factor,extraRadius:o.params.radius_extent})),direction:b.create(...r),up:b.create(...n)}}function A2e(e,t,r){let n={transitionStyle:"animate",transitionDurationInMs:r.previousTransitionDurationMs??0};if(t.camera.cameraParams!==void 0){let o=e.canvas3d.camera.getSnapshot(),i=$mt(e,t.camera.cameraParams);n.current={...o,...i}}else n.focus=edt(t.camera.focuses);return n}function CT(e,t,r,n){return typeof e=="boolean"?e?{name:"on",params:{...C.getDefaultValues(r),...t}}:{name:"off",params:{}}:n}function tdt(e,t){return e?C.normalizeParams(wL,{variant:e},"children"):t}function T2e(e,t,r){let n=t?.params,o=Zo(n?.background_color)??Kmt,i=t?.custom?.molstar_postprocessing,a=i?.enable_outline,s=i?.outline_params,l=i?.enable_shadow,u=i?.shadow_params,c=i?.enable_ssao,m=i?.ssao_params,d=i?.enable_fog,p=i?.fog_params,h=i?.enable_depth_of_field,f=i?.depth_of_field_params,g=i?.enable_bloom,y=i?.bloom_params,x=i?.background,S=r?.custom?.molstar_trackball,I=S?.name,v=S?.params??{};return{...e,postprocessing:{...e.postprocessing,outline:CT(a,s,kL,e.postprocessing.outline),shadow:CT(l,u,FL,e.postprocessing.shadow),occlusion:CT(c,m,VL,e.postprocessing.occlusion),dof:CT(h,f,BL,e.postprocessing.dof),bloom:CT(g,y,EL,e.postprocessing.bloom),background:tdt(x,e.postprocessing.background)},cameraFog:CT(d,p,UX,e.cameraFog),renderer:{...e.renderer,backgroundColor:o},trackball:{...e?.trackball,...I?{animate:{name:I,params:{...QR.animate.map(I)?.defaultValue,...v}}}:{}}}}function P2e(e){let t=e.canvas3d?.props;e.canvas3d?.setProps({...t,postprocessing:{...t,outline:Wo(Ud.postprocessing.outline),shadow:Wo(Ud.postprocessing.shadow),occlusion:Wo(Ud.postprocessing.occlusion),dof:Wo(Ud.postprocessing.dof),bloom:Wo(Ud.postprocessing.bloom),background:Wo(Ud.postprocessing.background)},cameraFog:Wo(Ud.cameraFog),trackball:{...t?.trackball,animate:{name:"off",params:{}}}})}function om(e,t,r){return _2e(e,void 0,t,r)}function _2e(e,t,r,n){r&&r(e,t);for(let o of e.children??[])_2e(o,e,r,n);n&&n(e,t)}function hD(e){let t=0,r=[];return om(e,n=>r.push("  ".repeat(t++)+rdt(n)),n=>t--),r.join(`
`)}function rdt(e){return`- ${e.kind} ${gD(e.params??{})}${ndt(e.custom)}${odt(e.ref)}`}function gD(e){return e?JSON.stringify(e).replace(/,("\w+":)/g,", $1").replace(/"(\w+)":/g,"$1: "):"undefined"}function ndt(e){return!e||Object.keys(e).length===0?"":`, custom: ${gD(e)}`}function odt(e){return e===void 0?"":`, ref: "${e}"`}function idt(e){return{kind:e.kind,params:e.params?{...e.params}:void 0,custom:e.custom?{...e.custom}:void 0,ref:e.ref}}function adt(e){return EV(e,{})}function EV(e,t){let r=new Map,n;return om(e,(o,i)=>{let a=t[o.kind];if(a){let s=a(o,i);if(!i&&s?.subtree.length===0)throw new Error("Cannot convert root to empty path");let l=i?r.get(i):void 0;for(let u of s.subtree)l?(l.children??=[]).push(u):n=u,l=u;r.set(o,l)}else{let s=idt(o);i?(r.get(i).children??=[]).push(s):n=s,r.set(o,s)}}),n}function R2e(e,t,r){let n=new Map,o=adt(e);return om(o,i=>{n.clear();let a=[];for(let s of i.children??[]){let l;if((!t||t.has(s.kind))&&!r?.has(s.kind)){let c=s.kind+xy(DV(s));l=n.get(c),l||n.set(c,s)}l?(l.children??=[]).push(...s.children??[]):a.push(s)}i.children=a}),o}function kV(e,t){let r={};for(let n in t.nodes)r[n]=o=>({subtree:[{kind:o.kind,params:x1(t.nodes[n].params,o.params),custom:o.custom,ref:o.ref}]});return EV(e,r)}function D2e(e,t,r){om(e,n=>{let o=n.params;if(o){for(let i in o)if(r.includes(i)){let a=o[i];typeof a=="string"&&(o[i]=sdt(a,t,ldt()))}}})}function sdt(...e){let t;for(let r of e.reverse())r!==void 0&&(t===void 0?t=r:t=new URL(r,t).href);return t}function ldt(){return typeof window<"u"?window.location.href:void 0}function S1(e,t,r={}){if(!rv(t))return[`Node must be an object, not ${t}`];if(!r.anyRoot&&t.kind!==e.rootKind)return[`Invalid root node kind "${t.kind}", root must be of kind "${e.rootKind}"`];let n=e.nodes[t.kind];if(!n)return[`Unknown node kind "${t.kind}"`];if(n.parent&&r.parent!==void 0&&!n.parent.includes(r.parent))return[`Node of kind "${t.kind}" cannot appear as a child of "${r.parent}". Allowed parents for "${t.kind}" are: ${n.parent.map(i=>`"${i}"`).join(", ")}`];let o=rZ(n.params,DV(t),r);if(o)return[`Invalid parameters for node of kind "${t.kind}":`,...o.map(i=>"  "+i)];if(t.custom!==void 0&&(typeof t.custom!="object"||t.custom===null))return[`Invalid "custom" for node of kind "${t.kind}": must be an object, not ${t.custom}.`];for(let i of qC(t)){let a=S1(e,i,{...r,anyRoot:!0,parent:t.kind});if(a)return a}}function FV(e,t,r,n){let o=S1(e,t,{noExtra:!0});if(o){console.warn(`Invalid ${r} tree:
${hD(t)}`),console.error(`${r} tree validation issues:`),n.log.error(`${r} tree validation issues:`);for(let i of o)console.error(" ",i),n.log.error(i);throw new Error("FormatError")}}function B2e(e){let t=new Set;for(let r of e.children??[]){if(r.kind!=="primitive")continue;let n=r.params;bD[n.kind].resolveRefs?.(n,t)}return t}var A1=class extends ne.Create({name:"Primitive Data",typeClass:"Object"}){},w2e=class extends ne.Create({name:"Primitive Shapes",typeClass:"Object"}){},E2e=oh({name:"mvs-download-primitive-data",display:{name:"MVS Primitives"},from:[ne.Root,ne.Molecule.Structure],to:A1,params:{uri:C.Url("",{isHidden:!0}),format:C.Text("mvs-node-json",{isHidden:!0})}})({apply({a:e,params:t,cache:r},n){return Ae.create("Download Primitive Data",async o=>{let i=sn.getUrlAsset(n.managers.asset,t.uri),a=await n.managers.asset.resolve(i,"string").runInContext(o),s=JSON.parse(Tm.toString(a.data)),l=S1(nm,s,{anyRoot:!0});if(l)throw new Error(`Invalid primitive data from ${t.uri}:
${l.join(`
`)}`);if(s.kind!=="primitives")throw new Error(`Expected primitives node from ${t.uri}, got ${s.kind}`);let u={...s,params:x1(nm.nodes.primitives.params,s.params||{}),children:s.children?.map(c=>c.kind==="primitive"?{...c,params:x1(nm.nodes.primitive.params,c.params||{})}:c)};return r.asset=a,new A1({node:u,defaultStructure:ne.Molecule.Structure.is(e)?e.data:void 0,structureRefs:{},primitives:L2e(u),options:{...u.params},positionCache:new Map,instances:V2e(u.params)},{label:"Primitive Data"})})},dispose({cache:e}){e?.asset?.dispose()}}),k2e=oh({name:"mvs-inline-primitive-data",display:{name:"MVS Primitives"},from:[ne.Root,ne.Molecule.Structure],to:A1,params:{node:C.Value({kind:"primitives",params:x1(nm.nodes.primitives.params,{})},{isHidden:!0})}})({apply({a:e,params:t}){return new A1({node:t.node,defaultStructure:ne.Molecule.Structure.is(e)?e.data:void 0,structureRefs:{},primitives:L2e(t.node),options:{...t.node.params},positionCache:new Map,instances:V2e(t.node.params)},{label:"Primitive Data"})}}),LV=oh({name:"mvs-build-primitive-shape",display:{name:"MVS Primitives"},from:A1,to:ne.Shape.Provider,params:{kind:C.Text("mesh"),clip:C.Value(void 0,{isHidden:!0})}})({apply({a:e,params:t,dependencies:r}){let n=r?Epe([ne.Molecule.Structure],r):{},o={...e.data,structureRefs:n},i={snapshotKey:{...udt,defaultValue:e.data.options?.snapshot_key??""}},a={markdownCommands:{...cdt,defaultValue:e.data.node?.custom?.molstar_markdown_commands}},s=Sm(t.kind);if(t.kind==="mesh"){if(!mZ(e.data,"mesh"))return Gn.Null;let l=e.data.node.custom?.molstar_mesh_params;return new ne.Shape.Provider({label:s,data:o,params:{...C.withDefaults(ft.Params,{alpha:e.data.options?.opacity??1,clip:t.clip,...l}),...i,...a},getShape:(u,c,m,d)=>hdt(c,d?.geometry),geometryUtils:ft.Utils},{label:s})}else if(t.kind==="labels"){if(!mZ(e.data,"label"))return Gn.Null;let l=e.data.options,u=l?.label_background_color,c=e.data.node.custom?.molstar_label_params;return new ne.Shape.Provider({label:s,data:o,params:{...C.withDefaults(ddt,{alpha:e.data.options?.label_opacity??1,attachment:l?.label_attachment??"middle-center",tether:l?.label_show_tether??!1,tetherLength:l?.label_tether_length??1,background:en(u),backgroundColor:en(u)?Zo(u):void 0,clip:t.clip,...c}),...i,...a},getShape:(m,d,p,h)=>ydt(d,h?.geometry,p),geometryUtils:na.Utils},{label:s})}else if(t.kind==="lines"){if(!mZ(e.data,"line"))return Gn.Null;let l=e.data.node.custom?.molstar_line_params;return new ne.Shape.Provider({label:s,data:o,params:{...C.withDefaults(Cn.Params,{alpha:e.data.options?.opacity??1,clip:t.clip,...l}),...i,...a},getShape:(u,c,m,d)=>gdt(c,d?.geometry),geometryUtils:Cn.Utils},{label:s})}return Gn.Null}}),VV=oh({name:"shape-representation-3d",display:"3D Representation",from:ne.Shape.Provider,to:ne.Shape.Representation3D,params:(e,t)=>e?e.data.params:Xe.Params})({canAutoUpdate(){return!0},apply({a:e,params:t}){return Ae.create("Shape Representation",async r=>{let n={...C.getDefaultValues(e.data.params),...t},o=Ci(e.data.getShape,e.data.geometryUtils);await o.createOrUpdate(n,e.data.data).runInContext(r);let i=!!t.snapshotKey?.trim()||!!t.markdownCommands;return i&&o.setState({pickable:i,markerActions:ii.Highlighting}),new ne.Shape.Representation3D({repr:o,sourceData:e.data},{label:e.data.label})})},update({a:e,b:t,newParams:r}){return Ae.create("Shape Representation",async n=>{let o={...t.data.repr.props,...r};await t.data.repr.createOrUpdate(o,e.data.data).runInContext(n),t.data.sourceData=e.data;let i=!!r.snapshotKey?.trim()||!!r.markdownCommands;return i&&t.data.repr.setState({pickable:i,markerActions:ii.Highlighting}),et.UpdateResult.Updated})}}),udt=C.Text("",{isEssential:!0,disableInteractiveUpdates:!0,description:"Activate the snapshot with the provided key when clicking on the label"}),cdt=C.Value(void 0,{isHidden:!0}),yD=class{constructor(){this.current=-1;this.groupToNodeMap=new Map;this.sizes=new Map;this.colors=new Map;this.tooltips=new Map}allocateSingle(t){let r=++this.current;return this.groupToNodeMap.set(r,t),r}allocateMany(t,r){let n=new Map,o=this.current;for(let i of r){if(n.has(i))continue;let a=o+n.size+1;this.groupToNodeMap.set(a,t),n.set(i,a)}return this.current+=n.size+1,n}updateColor(t,r){let n=Zo(r);typeof n=="number"&&this.colors.set(t,n)}updateTooltip(t,r){typeof r=="string"&&this.tooltips.set(t,r)}updateSize(t,r){typeof r=="number"&&this.sizes.set(t,r)}};function mdt(e,t){e.emptySelectionWarningPrinted||(console.warn("Some primitives use positions which refer to empty substructure, not showing these primitives.",t,"(There may be more)"),e.emptySelectionWarningPrinted=!0)}var F2e={...C.getDefaultValues(na.Params),attachment:"middle-center",fontQuality:3,fontWeight:"normal",borderWidth:.15,borderColor:0,background:!1,backgroundOpacity:.5,tether:!1},ddt=C.withDefaults(na.Params,F2e),bD={mesh:{builders:{mesh:bdt,line:xdt},isApplicable:{mesh:e=>e.show_triangles,line:e=>e.show_wireframe}},lines:{builders:{line:Cdt}},tube:{builders:{mesh:G2e},resolveRefs:M2e},arrow:{builders:{mesh:Sdt},resolveRefs:(e,t)=>{am(e.start,t),e.end&&am(e.end,t)}},label:{builders:{label:_dt},resolveRefs:Pdt},distance_measurement:{builders:{mesh:vdt,label:Idt},resolveRefs:M2e},angle_measurement:{builders:{mesh:Adt,label:Tdt},resolveRefs:(e,t)=>{am(e.a,t),am(e.b,t),am(e.c,t)}},ellipse:{builders:{mesh:H2e},resolveRefs:(e,t)=>{am(e.center,t),e.major_axis_endpoint&&am(e.major_axis_endpoint,t),e.minor_axis_endpoint&&am(e.minor_axis_endpoint,t)}},ellipsoid:{builders:{mesh:Ddt},resolveRefs:(e,t)=>{am(e.center,t),e.major_axis_endpoint&&am(e.major_axis_endpoint,t),e.minor_axis_endpoint&&am(e.minor_axis_endpoint,t)}},box:{builders:{mesh:wdt},resolveRefs:(e,t)=>{am(e.center,t)}}};function L2e(e){return(e.children??[]).filter(t=>t.kind==="primitive")}function am(e,t){iZ(e)&&e.structure_ref&&t.add(e.structure_ref)}function mZ(e,t){for(let r of e.primitives){let n=r.params,o=bD[n.kind];if(o.builders[t]){let a=o.isApplicable?.[t];if(a===void 0||a(n,e))return!0}}return!1}function Bb(e,t,r){return Eb(e,t,r,void 0,void 0)}var pdt=he.zero(),fdt=pt.zero();function Eb(e,t,r,n,o){let i,a;if(d2e(t))return r&&b.copy(r,t),n&&he.set(n,t,0),o&&pt.set(o,t,t),!0;if(iZ(t)?(i=ZI(t.expressions),a=t.structure_ref):p2e(t)&&(i=sk(t)),!i)throw console.error("Invalid expression",t),new Error("Invalid primitive potition expression, see console for details.");let s=a?e.structureRefs[a]:e.defaultStructure;if(!s)throw new Error(`Structure with ref '${a??"<default>"}' not found.`);let l=JSON.stringify(t);if(e.positionCache.has(l)){let[p,h,f]=e.positionCache.get(l);return r&&b.copy(r,h.center),n&&he.copy(n,h),o&&pt.copy(o,f),p}let{selection:u}=js.createAndRun(s,i),c,m,d;if(ut.isEmpty(u))r&&b.set(r,0,0,0),c=fdt,m=pdt,d=!1,mdt(e,t);else{let p=ut.toLociWithSourceUnits(u),h=Q.Loci.getBoundary(p);r&&b.copy(r,h.sphere.center),c=h.box,m=h.sphere,d=!0}return n&&he.copy(n,m),o&&pt.copy(o,c),e.positionCache.set(l,[d,m,c]),d}function V2e(e){if(e?.instances?.length)return e.instances.map(t=>H.fromArray(H(),t,0))}function hdt(e,t){let r=tt.createState(1024,1024,t),n={groups:new yD,mesh:r};r.currentGroup=-1;for(let l of e.primitives){let u=l.params,c=bD[u.kind];if(!c){console.warn(`Primitive ${u.kind} not supported`);continue}c.builders.mesh?.(e,n,l,u)}let{colors:o,tooltips:i}=n.groups,a=e.options?.tooltip??"",s=Zo(e.options?.color)??0;return Wr.create("Mesh",{kind:"mvs-primitives",node:e.node,groupToNode:n.groups.groupToNodeMap},tt.getMesh(r),l=>o.get(l)??s,l=>1,l=>i.get(l)??a,e.instances)}function gdt(e,t){let r=ns.create(1024,1024,t),n={groups:new yD,lines:r};for(let u of e.primitives){let c=u.params,m=bD[c.kind];if(!m){console.warn(`Primitive ${c.kind} not supported`);continue}m.builders.line?.(e,n,u,c)}let{colors:o,sizes:i,tooltips:a}=n.groups,s=e.options?.tooltip??"",l=Zo(e.options?.color)??0;return Wr.create("Lines",{kind:"mvs-primitives",node:e.node,groupToNode:n.groups.groupToNodeMap},r.getLines(),u=>o.get(u)??l,u=>i.get(u)??1,u=>a.get(u)??s,e.instances)}function ydt(e,t,r){let n=Ws.create({...F2e,...r},1024,1024,t),o={groups:new yD,labels:n};for(let u of e.primitives){let c=u.params,m=bD[c.kind];if(!m){console.warn(`Primitive ${c.kind} not supported`);continue}m.builders.label?.(e,o,u,c)}let i=Zo(e.options?.label_color)??0,{colors:a,sizes:s,tooltips:l}=o.groups;return Wr.create("Labels",{kind:"mvs-primitives",node:e.node,groupToNode:o.groups.groupToNodeMap},n.getText(),u=>a.get(u)??i,u=>s.get(u)??1,u=>l.get(u)??"",e.instances)}function O2e(e,t,r,n,o){let i=b.zero(),a=b.zero(),s=b.zero(),{indices:l,vertices:u,triangle_groups:c}=n,m=Math.floor(l.length/3);c??=Vl(m);let d=t.allocateMany(r,c);for(let p=0;p<m;p++){let h=c[p],f=d.get(h);b.fromArray(i,u,3*l[3*p]),b.fromArray(a,u,3*l[3*p+1]),b.fromArray(s,u,3*l[3*p+2]),o(h,f,i,a,s)}}function bdt(e,{groups:t,mesh:r},n,o){if(!o.show_triangles)return;let{group_colors:i,group_tooltips:a,color:s,tooltip:l}=o;O2e(e,t,n,o,(u,c,m,d,p)=>{t.updateColor(c,i[u]??s),t.updateTooltip(c,a[u]??l),r.currentGroup=c,tt.addTriangle(r,m,d,p)})}function xdt(e,{groups:t,lines:r},n,o){if(!o.show_wireframe)return;let i=o.wireframe_width,{group_colors:a,group_tooltips:s,wireframe_color:l,color:u,tooltip:c}=o;O2e(e,t,n,o,(m,d,p,h,f)=>{t.updateColor(d,l??a[m]??u),t.updateTooltip(d,s[m]??c),t.updateSize(d,i),r.add(p[0],p[1],p[2],h[0],h[1],h[2],d),r.add(h[0],h[1],h[2],f[0],f[1],f[2],d),r.add(f[0],f[1],f[2],p[0],p[1],p[2],d)})}function Cdt(e,{groups:t,lines:r},n,o){let i=b.zero(),a=b.zero(),{indices:s,vertices:l,line_groups:u,group_colors:c,group_tooltips:m,group_widths:d}=o,p=o.width,h=Math.floor(s.length/2);u??=Vl(h);let f=t.allocateMany(n,u);for(let g=0;g<h;g++){let y=u[g],x=f.get(y);t.updateColor(x,c[y]??o.color),t.updateTooltip(x,m[y]??o.tooltip),t.updateSize(x,d[y]??p),b.fromArray(i,l,3*s[2*g]),b.fromArray(a,l,3*s[2*g+1]),r.add(i[0],i[1],i[2],a[0],a[1],a[2],x)}}function M2e(e,t){am(e.start,t),am(e.end,t)}var v1=b.zero(),I1=b.zero();function G2e(e,{groups:t,mesh:r},n,o,i){if(!i?.skipResolvePosition){let l=Bb(e,o.start,v1),u=Bb(e,o.end,I1);if(!l||!u)return}let a=o.radius,s={radiusBottom:a,radiusTop:a,topCap:!0,bottomCap:!0};if(r.currentGroup=t.allocateSingle(n),t.updateColor(r.currentGroup,o.color),t.updateTooltip(r.currentGroup,o.tooltip),o.dash_length){let l=b.distance(v1,I1),u=Math.ceil(l/(2*o.dash_length));wp(r,v1,I1,1,u,!0,s)}else gR(r,v1,I1,s)}var Jo={start:b.zero(),end:b.zero(),dir:b.zero(),startCap:b.zero(),endCap:b.zero()};function Sdt(e,{groups:t,mesh:r},n,o){if(!Bb(e,o.start,Jo.start))return;if(o.end){if(!Bb(e,o.end,Jo.end))return}else if(o.direction)b.add(Jo.end,Jo.start,o.direction);else{console.warn('Primitive arrow does not contain "end" nor "distance". Not showing.');return}if(b.sub(Jo.dir,Jo.end,Jo.start),b.normalize(Jo.dir,Jo.dir),o.length&&b.scaleAndAdd(Jo.end,Jo.start,Jo.dir,o.length),b.distance(Jo.start,Jo.end)<.001)return;let s=o.tube_radius,l={radiusBottom:s,radiusTop:s,topCap:!o.show_end_cap,bottomCap:!o.show_start_cap};if(r.currentGroup=t.allocateSingle(n),t.updateColor(r.currentGroup,o.color),t.updateTooltip(r.currentGroup,o.tooltip),o.show_start_cap){let u=o.start_cap_radius??2*s,c=o.start_cap_length??2*u;b.scaleAndAdd(Jo.startCap,Jo.start,Jo.dir,c),gR(r,Jo.startCap,Jo.start,{radiusBottom:u,radiusTop:0,topCap:!1,bottomCap:!0,radialSegments:12})}else b.copy(Jo.startCap,Jo.start);if(o.show_end_cap){let u=o.end_cap_radius??2*s,c=o.end_cap_length??2*u;b.scaleAndAdd(Jo.endCap,Jo.end,Jo.dir,-c),gR(r,Jo.endCap,Jo.end,{radiusBottom:u,radiusTop:0,topCap:!1,bottomCap:!0,radialSegments:12})}else b.copy(Jo.endCap,Jo.end);if(o.show_tube)if(o.tube_dash_length){let u=b.distance(Jo.startCap,Jo.endCap),c=Math.ceil(u/(2*o.tube_dash_length));wp(r,Jo.startCap,Jo.endCap,1,c,!0,l)}else gR(r,Jo.startCap,Jo.endCap,l)}function U2e(e,t,r){let n=Bb(e,t,v1),o=Bb(e,r,I1);if(n&&o)return b.distance(v1,I1)}function N2e(e,t){let r=`${Oh(e,2)} \xC5`;return typeof t.label_template=="string"?t.label_template.replace("{{distance}}",r):r}function vdt(e,t,r,n){let o=U2e(e,n.start,n.end);if(o===void 0)return;let i=N2e(o,n);G2e(e,t,r,{...n,tooltip:i},{skipResolvePosition:!0})}var ST=b.zero();function Idt(e,t,r,n){let{labels:o,groups:i}=t,a=U2e(e,n.start,n.end);if(a===void 0)return;let s;typeof n.label_size=="number"?s=n.label_size:s=Math.max(a*n.label_auto_size_scale,n.label_auto_size_min),b.add(ST,v1,I1),b.scale(ST,ST,.5);let l=i.allocateSingle(r);i.updateColor(l,n.label_color),i.updateSize(l,s),o.add(N2e(a,n),ST[0],ST[1],ST[2],1.05*n.radius,1,l)}var Pr={isDefined:!1,a:b(),b:b(),c:b(),ba:b(),bc:b(),labelPos:b(),radius:0,label:""};function z2e(e,t){let r=Bb(e,t.a,Pr.a),n=Bb(e,t.b,Pr.b),o=Bb(e,t.c,Pr.c);if(Pr.isDefined=r&&n&&o,!Pr.isDefined)return;b.sub(Pr.ba,Pr.a,Pr.b),b.sub(Pr.bc,Pr.c,Pr.b);let i=Ya(b.angle(Pr.ba,Pr.bc)),a=`${Oh(i,2)}\xB0`;Pr.label=typeof t.label_template=="string"?t.label_template.replace("{{angle}}",a):a,typeof t.section_radius=="number"?Pr.radius=t.section_radius:(Pr.radius=Math.min(b.magnitude(Pr.ba),b.magnitude(Pr.bc)),typeof t.section_radius_scale=="number"&&(Pr.radius*=t.section_radius_scale))}function Adt(e,t,r,n){if(z2e(e,n),!Pr.isDefined)return;let{groups:o,mesh:i}=t;if(n.show_vector){let a=n.vector_radius??.05,s={radiusBottom:a,radiusTop:a,topCap:!0,bottomCap:!0};i.currentGroup=o.allocateSingle(r),o.updateColor(i.currentGroup,n.vector_color),o.updateTooltip(i.currentGroup,Pr.label);let l=Math.ceil(b.magnitude(Pr.ba)/(2*a));wp(i,Pr.a,Pr.b,1,l,!0,s),l=Math.ceil(b.magnitude(Pr.bc)/(2*a)),wp(i,Pr.b,Pr.c,1,l,!0,s)}if(n.show_section){let a=b.angle(Pr.ba,Pr.bc);b.normalize(Pr.ba,Pr.ba),b.normalize(Pr.bc,Pr.bc),b.scale(Pr.ba,Pr.ba,Pr.radius),b.scale(Pr.bc,Pr.bc,Pr.radius),H2e(e,t,r,{kind:"ellipse",as_circle:!0,center:Pr.b,major_axis_endpoint:null,major_axis:Pr.ba,minor_axis_endpoint:null,minor_axis:Pr.bc,radius_major:Pr.radius,radius_minor:Pr.radius,theta_start:0,theta_end:a,color:n.section_color,tooltip:Pr.label})}}function Tdt(e,t,r,n){let{labels:o,groups:i}=t;if(z2e(e,n),!Pr.isDefined)return;b.normalize(Pr.ba,Pr.ba),b.normalize(Pr.bc,Pr.bc),b.scale(Pr.ba,Pr.ba,Pr.radius),b.scale(Pr.bc,Pr.bc,Pr.radius);let a;typeof n.label_size=="number"?a=n.label_size:a=Math.max(Pr.radius*n.label_auto_size_scale,n.label_auto_size_min),b.add(Pr.labelPos,Pr.ba,Pr.bc),b.normalize(Pr.labelPos,Pr.labelPos),b.scale(Pr.labelPos,Pr.labelPos,Pr.radius),b.add(Pr.labelPos,Pr.labelPos,Pr.b);let s=i.allocateSingle(r);i.updateColor(s,n.label_color),i.updateSize(s,a),o.add(Pr.label,Pr.labelPos[0],Pr.labelPos[1],Pr.labelPos[2],1,1,s)}function Pdt(e,t){am(e.position,t)}var vT={position:b.zero(),sphere:he.zero()};function _dt(e,t,r,n){let{labels:o,groups:i}=t;if(!Eb(e,n.position,vT.position,vT.sphere,void 0))return;let s=i.allocateSingle(r);i.updateColor(s,n.label_color),i.updateSize(s,n.label_size);let l=vT.sphere.radius+n.label_offset;o.add(n.text,vT.position[0],vT.position[1],vT.position[2],l,1,s)}var dZ=new Map;function Rdt(e){let t=JSON.stringify(e);if(dZ.has(t))return dZ.get(t);let r=(e.thetaEnd??2*Math.PI)-(e.thetaStart??0);if(Math.abs(r)<.001)return null;let n=MA({radius:1,thetaStart:e.thetaStart??0,thetaLength:r,segments:Math.ceil(2*Math.PI/r*64)});return dZ.set(t,n),n}var _o={centerPos:b.zero(),majorPos:b.zero(),minorPos:b.zero(),majorAxis:b.zero(),minorAxis:b.zero(),scale:b.zero(),normal:b.zero(),scaleXform:H.identity(),rotationXform:H.identity(),translationXform:H.identity(),xform:H.identity()};function H2e(e,t,r,n){let o=Rdt({thetaStart:n.theta_start,thetaEnd:n.theta_end});if(!o||!Eb(e,n.center,_o.centerPos,void 0,void 0))return;if(n.major_axis_endpoint){if(!Eb(e,n.major_axis_endpoint,_o.majorPos,void 0,void 0))return;b.sub(_o.majorAxis,_o.majorPos,_o.centerPos)}else b.copy(_o.majorAxis,n.major_axis);if(n.minor_axis_endpoint){if(!Eb(e,n.minor_axis_endpoint,_o.minorPos,void 0,void 0))return;b.sub(_o.minorAxis,_o.minorPos,_o.centerPos)}else b.copy(_o.minorAxis,n.minor_axis);let{mesh:a,groups:s}=t;if(H.fromTranslation(_o.translationXform,_o.centerPos),n.as_circle){let l=n.radius_major??b.magnitude(_o.majorAxis);b.set(_o.scale,l,1,l)}else{let l=n.radius_major??b.magnitude(_o.majorAxis),u=n.radius_minor??b.magnitude(_o.minorAxis);b.set(_o.scale,u,1,l)}H.fromScaling(_o.scaleXform,_o.scale),b.normalize(_o.minorAxis,_o.minorAxis),b.normalize(_o.majorAxis,_o.majorAxis),b.cross(_o.normal,_o.majorAxis,_o.minorAxis),H.targetTo(_o.rotationXform,b.origin,_o.majorAxis,_o.normal),H.mul(_o.rotationXform,_o.rotationXform,H.rotY180),H.mul3(_o.xform,_o.translationXform,_o.rotationXform,_o.scaleXform),a.currentGroup=s.allocateSingle(r),s.updateColor(a.currentGroup,n.color),s.updateTooltip(a.currentGroup,n.tooltip),tt.addPrimitive(a,_o.xform,o),tt.addPrimitiveFlipped(a,_o.xform,o)}var jo={centerPos:b.zero(),majorPos:b.zero(),minorPos:b.zero(),majorAxis:b.zero(),minorAxis:b.zero(),sphere:he.zero(),radius:b.zero(),extent:b.zero(),up:b.zero()};function Ddt(e,t,r,n){if(!Eb(e,n.center,jo.centerPos,jo.sphere,void 0))return;if(n.major_axis_endpoint){if(!Eb(e,n.major_axis_endpoint,jo.majorPos,void 0,void 0))return;b.sub(jo.majorAxis,jo.majorPos,jo.centerPos)}else n.major_axis?b.copy(jo.majorAxis,n.major_axis):b.copy(jo.majorAxis,b.unitX);if(n.minor_axis_endpoint){if(!Eb(e,n.minor_axis_endpoint,jo.minorPos,void 0,void 0))return;b.sub(jo.minorAxis,jo.minorPos,jo.centerPos)}else n.minor_axis?b.copy(jo.minorAxis,n.minor_axis):b.copy(jo.minorAxis,b.unitY);if(typeof n.radius=="number")b.set(jo.radius,n.radius,n.radius,n.radius);else if(n.radius)b.copy(jo.radius,n.radius);else{let s=jo.sphere.radius;b.set(jo.radius,s,s,s)}typeof n.radius_extent=="number"?b.set(jo.extent,n.radius_extent,n.radius_extent,n.radius_extent):n.radius_extent?b.copy(jo.extent,n.radius_extent):b.set(jo.extent,0,0,0),b.add(jo.radius,jo.radius,jo.extent);let{mesh:i,groups:a}=t;i.currentGroup=a.allocateSingle(r),a.updateColor(i.currentGroup,n.color),a.updateTooltip(i.currentGroup,n.tooltip),b.normalize(jo.majorAxis,jo.majorAxis),b.normalize(jo.minorAxis,jo.minorAxis),b.cross(jo.up,jo.majorAxis,jo.minorAxis),xb(i,jo.centerPos,jo.up,jo.minorAxis,jo.radius,3)}var im={center:b.zero(),boundary:pt.zero(),size:b.zero(),cage:QS(),translationXform:H.identity(),scaleXform:H.identity(),xform:H.identity()};function wdt(e,t,r,n){if(!n.show_edges&&!n.show_faces||!Eb(e,n.center,im.center,void 0,im.boundary)||(n.extent&&pt.expand(im.boundary,im.boundary,n.extent),pt.volume(im.boundary)<.001))return;let{mesh:i,groups:a}=t;H.fromScaling(im.scaleXform,pt.size(im.size,im.boundary)),H.fromTranslation(im.translationXform,im.center),H.mul(im.xform,im.translationXform,im.scaleXform),n.show_faces&&(i.currentGroup=a.allocateSingle(r),a.updateColor(i.currentGroup,n.face_color),a.updateTooltip(i.currentGroup,n.tooltip),tt.addPrimitive(i,im.xform,SC())),n.show_edges&&(i.currentGroup=a.allocateSingle(r),a.updateColor(i.currentGroup,n.edge_color),a.updateTooltip(i.currentGroup,n.tooltip),tt.addCage(i,im.xform,QS(),n.edge_radius,2,8))}var pZ=oh({name:"trajectory-with-coordinates",display:{name:"Trajectory with Coordinates",description:"Create a trajectory from existing model and the provided coordinates."},from:[ne.Molecule.Model,ne.Molecule.Topology],to:ne.Molecule.Trajectory,params:{coordinatesRef:C.Text("",{isHidden:!0})}})({apply({a:e,params:t,dependencies:r}){return Ae.create("Create trajectory from model/topology and coordinates",async n=>{let o=kpe([ne.Molecule.Coordinates],r,t.coordinatesRef);if(!o)throw new Error("Coordinates not found.");let i=await EF(n,e,o.data),a={label:"Trajectory",description:`${i.frameCount} model${i.frameCount===1?"":"s"}`};return new ne.Molecule.Trajectory(i,a)})}});var fZ=.36363636363636365,Mdt=6/11,Bdt=8/11,Edt=3/4,kdt=9/11,Fdt=10/11,Ldt=15/16,Vdt=21/22,Odt=63/64,OV=1/fZ/fZ;function j2e(e){return 1-xD(1-e)}function xD(e){return(e=+e)<fZ?OV*e*e:e<Bdt?OV*(e-=Mdt)*e+Edt:e<Fdt?OV*(e-=kdt)*e+Ldt:OV*(e-=Vdt)*e+Odt}function W2e(e){return((e*=2)<=1?1-xD(1-e):xD(e-1)+1)/2}function X2e(e){return 1-Math.sqrt(1-e*e)}function Q2e(e){return Math.sqrt(1- --e*e)}function Z2e(e){return((e*=2)<=1?1-Math.sqrt(1-e*e):Math.sqrt(1-(e-=2)*e)+1)/2}function q2e(e){return e*e*e}function Y2e(e){return--e*e*e+1}function K2e(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}function J2e(e){return Math.pow(2,10*e-10)}function $2e(e){return 1-Math.pow(2,-10*e)}function e_e(e){return((e*=2)<=1?Math.pow(2,10*e-10):2-Math.pow(2,10-10*e))/2}function t_e(e){return e*e}function r_e(e){return e*(2-e)}function n_e(e){return((e*=2)<=1?e*e:--e*(2-e)+1)/2}var o_e=Math.PI,i_e=o_e/2;function a_e(e){return 1-Math.cos(e*i_e)}function s_e(e){return Math.sin(e*i_e)}function l_e(e){return(1-Math.cos(o_e*e))/2}var CD=-1;function Udt(e){return e>=0}var c_e=Lt.white;function Ndt(e,t){let r={help:o=>{let{name:i,params:a}=o,l=e.get(i).factory({},a);return{description:l.description,legend:l.legend}}},n=e.types.filter(([o,i,a])=>o!==GV&&e.get(o).isApplicable(t));return{layers:C.ObjectList({theme:C.Mapped("uniform",n,o=>C.Group(e.get(o).getParams({structure:De.Empty})),r),selection:XA},o=>va(o.theme.name),{description:"A list of layers, each defining a color theme. The last listed layer is the top layer (applies first). If the top layer does not provide color for a location or its selection does not cover the location, the underneath layers will apply."}),background:C.Color(c_e,{description:"Color for elements where no layer applies"})}}var zdt={layers:[],background:c_e};function m_e(e,t,r){let{colorLayers:n,granularity:o,preferSmoothing:i}=jdt(e,t,r);function a(u,c){for(let m of n){if(!(!m.elementSet||QA.has(m.elementSet,u)))continue;let p=m.color(u,c);if(Udt(p))return p}return t.background}let s=Q.Location.create(e.structure);return{factory:(u,c)=>m_e(u,c,r),granularity:o,preferSmoothing:i,color:(u,c)=>Q.Location.is(u)?a(u,c):It.isLocation(u)?(s.unit=u.aUnit,s.element=u.aUnit.elements[u.aIndex],a(s,c)):t.background,props:t,description:"Combines colors from multiple color themes."}}var IT=1,hZ=2,gZ=4,u_e={uniform:0,instance:IT,group:hZ,groupInstance:hZ|IT,vertex:gZ,vertexInstance:gZ|IT};function Hdt(e){return e&gZ?e&IT?"vertexInstance":"vertex":e&hZ?e&IT?"groupInstance":"group":e&IT?"instance":"uniform"}function jdt(e,t,r){let n=[],o=0,i=!1;for(let a=t.layers.length-1;a>=0;a--){let s=t.layers[a],l=r.get(s.theme.name);if(!l){console.warn(`Skipping color theme '${s.theme.name}', cannot find it in registry.`);continue}l.ensureCustomProperties?.attach&&console.warn(`Multilayer color theme: layer "${l.name}" has ensureCustomProperties.attach method, but Multilayer color theme does not call it. If the layer does not work, make sure you call ensureCustomProperties.attach somewhere.`);let u=l.factory(e,s.theme.params);switch(u.granularity){case"uniform":case"instance":case"group":case"groupInstance":case"vertex":case"vertexInstance":let c,m;if(!e.structure)c={},m="uniform";else if(rIe(s.selection))c=void 0,m="uniform";else{let d=XR(e.structure,s.selection);c=QA.fromStructure(d),m=Wdt(e.structure,d)}n.push({elementSet:c,color:u.color}),o|=u_e[m],o|=u_e[u.granularity];break;default:console.warn(`Skipping color theme '${s.theme.name}', cannot process granularity '${u.granularity}'`)}u.preferSmoothing&&(i=!0)}return{colorLayers:n,granularity:Hdt(o),preferSmoothing:i}}function Wdt(e,t){let r={};for(let u of e.units){let c=u.conformation.operator.instanceId;r[c]??=0,r[c]+=u.elements.length}let n={},o={};for(let u of t.units){let c=u.conformation.operator.instanceId;n[c]??=0,n[c]+=u.elements.length,(o[c]??={})[u.invariantId]=u.elements}let i=Object.keys(r),a=Object.keys(n),s=!a.every(u=>n[u]===r[u]),l;if(a.length===0)l=!1;else if(a.length<i.length)l=!0;else{l=!1;for(let u=1;u<a.length;u++)if(!qi(o[a[0]],o[a[u]])){l=!0;break}}return s?l?"groupInstance":"group":l?"instance":"uniform"}var GV="mvs-multilayer";function d_e(e){return{name:GV,label:"MVS Multi-layer",category:yr.Misc,factory:(t,r)=>m_e(t,r,e),getParams:t=>Ndt(e,t),defaultValues:zdt,isApplicable:t=>!!t.structure&&fC(t.structure)}}var ml={aromatic:Zo("#15A4A4"),hydrophobic:Zo("#80A0F0"),polar:Zo("#15C015"),positive:Zo("#F01505"),negative:Zo("#C048C0"),proline:Zo("#C0C000"),cysteine:Zo("#F08080"),glycine:Zo("#F09048")},Xdt={...iR,HIS:ml.aromatic,TYR:ml.aromatic,ALA:ml.hydrophobic,VAL:ml.hydrophobic,LEU:ml.hydrophobic,ILE:ml.hydrophobic,MET:ml.hydrophobic,PHE:ml.hydrophobic,TRP:ml.hydrophobic,SER:ml.polar,THR:ml.polar,ASN:ml.polar,GLN:ml.polar,LYS:ml.positive,ARG:ml.positive,ASP:ml.negative,GLU:ml.negative,PRO:ml.proline,CYS:ml.cysteine,GLY:ml.glycine},Qdt={helix:Fm.alphaHelix,strand:Fm.betaStrand,turn:Fm.betaTurn,bend:Fm.bend,H:Fm.alphaHelix,B:Fm.betaStrand,E:Fm.betaStrand,G:Fm.threeTenHelix,I:Fm.piHelix,P:10485760,T:Fm.betaTurn,S:Fm.bend},yZ={ElementSymbol:Tu(bk,["C"]),ResidueName:iR,ResidueProperties:Xdt,SecondaryStructure:Qdt},T1={Reds:Sr.reds,Oranges:Sr.oranges,Greens:Sr.greens,Blues:Sr.blues,Purples:Sr.purples,Greys:Sr.greys,OrRd:Sr["orange-red"],BuGn:Sr["blue-green"],PuBuGn:Sr["purple-blue-green"],GnBu:Sr["green-blue"],PuBu:Sr["purple-blue"],BuPu:Sr["blue-purple"],RdPu:Sr["red-purple"],PuRd:Sr["purple-red"],YlOrRd:Sr["yellow-orange-red"],YlOrBr:Sr["yellow-orange-brown"],YlGn:Sr["yellow-green"],YlGnBu:Sr["yellow-green-blue"],Magma:Sr.magma,Inferno:Sr.inferno,Plasma:Sr.plasma,Viridis:Sr.viridis,Cividis:Sr.cividis,Turbo:Sr.turbo,Warm:Sr.warm,Cool:Sr.cool,CubehelixDefault:Sr["cubehelix-default"],Rainbow:Sr.rainbow,Sinebow:Sr.sinebow,RdBu:Sr["red-blue"],RdGy:Sr["red-grey"],PiYG:Sr["pink-yellow-green"],BrBG:Sr["brown-white-green"],PRGn:Sr["purple-green"],PuOr:Sr["purple-orange"],RdYlGn:Sr["red-yellow-green"],RdYlBu:Sr["red-yellow-blue"],Spectral:Sr.spectral,Category10:Sr["category-10"],Observable10:Sr["observable-10"],Tableau10:Sr["tableau-10"],Set1:Sr["set-1"],Set2:Sr["set-2"],Set3:Sr["set-3"],Pastel1:Sr["pastel-1"],Pastel2:Sr["pastel-2"],Dark2:Sr["dark-2"],Paired:Sr.paired,Accent:Sr.accent,Chainbow:Sr["turbo-no-black"]};function p_e(e,t,r,n,o){let i=Er.create(e,o?.replaceExisting??!1);Zdt(i,t,r,n,o);let a=i.update.getTree({useHashVersion:!0}),s={tree:Co.toJSON(a)};return{id:fn.create22(),data:s}}function Zdt(e,t,r,n,o){let i=new Map;o?.replaceExisting&&Er.deleteChildren(e);let a=(o?.extensions??[]).map(l=>({ext:l,extCtx:l.createExtensionContext(t,n)})),s=new Map;om(t,(l,u)=>{let c=l.kind,m,d=u?i.get(u):e,p=r[c];if(p)if(d)m=p(d,l,n),m&&l.ref&&(Er.tag(m,xZ(l.ref)),s.set(l.ref,m.selector.ref)),i.set(l,m);else{console.warn(`No target found for this "${l.kind}" node`);return}if(d)for(let{ext:h,extCtx:f}of a)h.action(m??d,l,n,f)});for(let l of e.targetManager.allTargets)Er.dependsOn(l,s);a.forEach(l=>l.ext.disposeExtensionContext?.(l.extCtx,t,n))}var Er={create(e,t){let r=e.build(),n=r.toRoot();return{update:r,selector:n.selector,targetManager:new bZ(e,t),mvsDependencyRefs:new Set}},apply(e,t,r,n){let o=t.id;if(t.id===Od.id){let l=r?.type?.name??"";o+=`:${l}`}let i=e.targetManager.getChildRef(e.selector,o),a=e.update.to(e.selector).apply(t,r,{...n,ref:i}),s={...e,selector:a.selector,mvsDependencyRefs:new Set,transformer:t,transformParams:r};return e.targetManager.allTargets.push(s),s},setMvsDependencies(e,t){return t.forEach(r=>e.mvsDependencyRefs.add(r)),e},dependsOn(e,t){if(!e.mvsDependencyRefs.size)return e;let r=Array.from(e.mvsDependencyRefs).map(n=>t.get(n)).filter(n=>n);return r.length&&e.update.to(e.selector).dependsOn(r),e},tag(e,t){return t.length>0&&e.update.to(e.selector).tag(t),e},deleteChildren(e){return e.update.currentTree.children.get(e.selector.ref).forEach(r=>e.update.delete(r)),e},commit(e){return e.update.commit()}},bZ=class{constructor(t,r){this._counter={};this.allTargets=[];r||t.state.data.cells.forEach(n=>{let o=n.transform.ref;if(o.startsWith("!mvs:")){let[i,a,s]=o.split(":"),l=parseInt(s)+1;l>(this._counter[a]??0)&&(this._counter[a]=l)}})}nextRef(t){this._counter[t]??=0;let r=this._counter[t]++;return`!mvs:${t}:${r}`}getChildRef(t,r){let n=t.ref.replace(/^!mvs:/,"")+":"+r,o=ik(n);return this.nextRef(o)}};function xZ(e){return e===void 0?[]:[`mvs-ref:${e}`]}var qdt=new Set(["color_from_uri","component_from_uri","label_from_uri","tooltip_from_uri"]),Ydt=new Set(["color_from_source","component_from_source","label_from_source","tooltip_from_source"]);function Kdt(e,t){if(e&&e.length!==9)throw new Error(`'rotation' param for 'transform' node must be array of 9 elements, found ${e}`);if(t&&t.length!==3)throw new Error(`'translation' param for 'transform' node must be array of 3 elements, found ${t}`);let r=H.identity();if(e){let n=Mt.fromArray(Mt(),e,0);b_e(n,n),H.fromMat3(r,n)}if(t&&H.setTranslation(r,b.fromArray(b(),t,0)),!H.isRotationAndTranslation(r))throw new Error(`'rotation' param for 'transform' is not a valid rotation matrix: ${e}`);return r}function Jdt(e){if(e&&e.length!==9)throw new Error(`'rotation' param for 'transform' node must be array of 9 elements, found ${e}`);if(e){let t=Mt.fromArray(Mt(),e,0);b_e(t,t);let r=lr.fromMat3(lr(),t),n=b(),o=lr.getAxisAngle(n,r)*180/Math.PI;return{axis:n,angle:o}}return{axis:b.create(1,0,0),angle:0}}function b_e(e,t){let r=b.fromArray($dt,t,0),n=b.fromArray(ept,t,3),o=b.fromArray(tpt,t,6);return b.normalize(r,r),b.orthogonalize(n,r,n),b.normalize(o,b.cross(o,r,n)),Mt.fromColumns(e,r,n,o),e}var $dt=b(),ept=b(),tpt=b();function SD(e,t){return C_e(e,t,IW,AW)}function x_e(e,t){return C_e(e,t,wW,MW)}function C_e(e,t,r,n){let o=e;for(let{params:a,ref:s}of f_e(t,"transform"))o=Er.apply(o,r,a),Er.tag(o,xZ(s));let i=f_e(t,"instance");return i.length>0&&(o=Er.apply(o,n,{transforms:i.map(a=>a.params)})),o}function f_e(e,t){let r=[],n=qC(e).filter(o=>o.kind===t);for(let o of n){let i=o.params.matrix;if(!i){let{rotation:a,translation:s,rotation_center:l}=o.params;if(l){let u=Jdt(a);r.push({params:{transform:{name:"components",params:{translation:s?b.fromArray(b(),s,0):b.create(0,0,0),angle:u.angle,axis:u.axis,rotationCenter:l==="centroid"?{name:"centroid",params:{}}:{name:"point",params:{point:b.fromArray(b(),l,0)}}}}},ref:o.ref});continue}i=Kdt(a,s)}r.push({params:{transform:{name:"matrix",params:{data:i,transpose:!1}}},ref:o.ref})}return r}function S_e(e,t){let r={};return om(e,n=>{let o;if(qdt.has(n.kind)){let i=n.params;o={source:{name:"url",params:{url:i.uri,format:i.format}},schema:i.schema,cifBlock:h_e(i.block_header,i.block_index),cifCategory:i.category_name,fieldRemapping:Object.entries(i.field_remapping).map(([a,s])=>({standardName:a,actualName:s}))}}else if(Ydt.has(n.kind)){let i=n.params;o={source:{name:"source-cif",params:{}},schema:i.schema,cifBlock:h_e(i.block_header,i.block_index),cifCategory:i.category_name,fieldRemapping:Object.entries(i.field_remapping).map(([a,s])=>({standardName:a,actualName:s}))}}if(o){let i=xy(o);r[i]??={...o,id:ik(i)},t.annotationMap.set(n,r[i].id)}}),Object.values(r)}function h_e(e,t){return en(e)?{name:"header",params:{header:e}}:{name:"index",params:{index:t??0}}}function v_e(e,t){let r=[];return om(e,n=>{if(n.kind==="tooltip_from_uri"||n.kind==="tooltip_from_source"){let o=t.annotationMap.get(n);o&&r.push({annotationId:o,fieldName:n.params.field_name})}}),YJ(r)}function I_e(e,t){let r=[];return om(e,(n,o)=>{if(n.kind==="tooltip"){if(o?.kind==="component")r.push({text:n.params.text,selector:vD(o.params.selector)});else if(o?.kind==="component_from_uri"||o?.kind==="component_from_source"){let i=ID(o,t);en(i.annotationId)&&en(i.fieldName)&&en(i.fieldValues)&&r.push({text:n.params.text,selector:{name:"annotation",params:{annotationId:i.annotationId,fieldName:i.fieldName,fieldValues:i.fieldValues,label:i.label||"Annotation"}}})}}}),r}function A_e(e,t){let r=[];return om(e,(n,o)=>{if(n.kind==="label"){if(o?.kind==="component")r.push({text:n.params.text,position:{name:"selection",params:{selector:vD(o.params.selector)}}});else if(o?.kind==="component_from_uri"||o?.kind==="component_from_source"){let i=ID(o,t);en(i.annotationId)&&en(i.fieldName)&&en(i.fieldValues)&&r.push({text:n.params.text,position:{name:"selection",params:{selector:{name:"annotation",params:{annotationId:i.annotationId,fieldName:i.fieldName,fieldValues:i.fieldValues,label:i.label||"Annotation"}}}}})}}}),r}function UV(e){return e.ref!==void 0||e.custom!==void 0&&Object.keys(e.custom).length>0?!1:e.children&&e.children.every(t=>t.kind==="tooltip"||t.kind==="label")}function T_e(e){let t=e.params;switch(t.type){case"model":return{type:{name:"model",params:{}}};case"assembly":return{type:{name:"assembly",params:{id:t.assembly_id??void 0}}};case"symmetry":return{type:{name:"symmetry",params:{ijkMin:b.ofArray(t.ijk_min),ijkMax:b.ofArray(t.ijk_max)}}};case"symmetry_mates":return{type:{name:"symmetry-mates",params:{radius:t.radius}}};default:throw new Error(`NotImplementedError: Loading action for "structure" node, type "${t.type}"`)}}function vD(e){return e===void 0?tIe:typeof e=="string"?{name:"static",params:e}:Array.isArray(e)?{name:"expression",params:ZI(e)}:{name:"expression",params:sk(e)}}function P_e(e){return e===void 0?"All":typeof e=="string"?va(e):Array.isArray(e)?`Custom Selection: [${e.map(gD).join(", ")}]`:`Custom Selection: ${gD(e)}`}function vZ(e,t){let r=t.annotationMap.get(e),n=e.params.field_name,o=t.nearestReprMap?.get(e);return{type:{name:yL.name,params:{annotationId:r,fieldName:n}},colorTheme:_1(o,t)}}function ID(e,t){let r=t.annotationMap.get(e),{field_name:n,field_values:o}=e.params;return{annotationId:r,fieldName:n,fieldValues:o?{name:"selected",params:o.map(i=>({value:i}))}:{name:"all",params:{}},nullIfEmpty:!1}}function rpt(e){let t=R_e(e),r=e.params;switch(r.type){case"cartoon":return{type:{name:"cartoon",params:{alpha:t,tubularHelices:r.tubular_helices}},sizeTheme:{name:"uniform",params:{value:r.size_factor}}};case"backbone":return{type:{name:"backbone",params:{alpha:t}},sizeTheme:{name:"uniform",params:{value:r.size_factor}}};case"ball_and_stick":return{type:{name:"ball-and-stick",params:{sizeFactor:(r.size_factor??1)*.5,sizeAspectRatio:.5,alpha:t,ignoreHydrogens:r.ignore_hydrogens}}};case"line":return{type:{name:"line",params:{alpha:t,ignoreHydrogens:r.ignore_hydrogens}},sizeTheme:{name:"uniform",params:{value:r.size_factor}}};case"spacefill":return{type:{name:"spacefill",params:{alpha:t,ignoreHydrogens:r.ignore_hydrogens}},sizeTheme:{name:"physical",params:{scale:r.size_factor}}};case"carbohydrate":return{type:{name:"carbohydrate",params:{alpha:t,sizeFactor:r.size_factor??1}}};case"surface":return{type:{name:r.surface_type==="gaussian"?"gaussian-surface":"molecular-surface",params:{alpha:t,ignoreHydrogens:r.ignore_hydrogens}},sizeTheme:{name:"physical",params:{scale:r.size_factor}}};default:throw new Error("NotImplementedError")}}function __e(e){let t=rpt(e),r=AD(e);return r&&(t.type.params={...t.type?.params,clip:r}),e.custom?.molstar_representation_params&&(t.type.params={...t.type.params,...e.custom.molstar_representation_params}),t}function R_e(e){let t=qC(e).filter(r=>r.kind==="opacity");return t.length>0?t[t.length-1].params.opacity:1}function CZ(e){return{invert:!!e.params.invert,transform:e.params.check_transform?H.fromArray(H(),e.params.check_transform,0):H.identity()}}function npt(e){switch(e.params.type){case"sphere":return{type:"sphere",position:b.ofArray(e.params.center),scale:typeof e.params.radius=="number"?b.create(2*e.params.radius,2*e.params.radius,2*e.params.radius):b.create(2,2,2),rotation:{axis:b.create(1,0,0),angle:0},...CZ(e)};case"plane":{let o=b.create(0,1,0),i=b.normalize(b(),b.ofArray(e.params.normal)),a=b.cross(b(),o,i),s=b.magnitude(a)<1e-6;return{type:"plane",position:b.ofArray(e.params.point),scale:b.create(1,1,1),rotation:{axis:s?b.unitX:a,angle:s?0:b.angle(o,i)*180/Math.PI},...CZ(e)}}case"box":let t=lr.fromMat3(lr(),Mt.fromArray(Mt(),e.params.rotation,0)),r=b(),n=lr.getAxisAngle(r,t)*180/Math.PI;return{type:"cube",position:b.ofArray(e.params.center),scale:b.ofArray(e.params.size),rotation:{axis:r,angle:n},...CZ(e)};default:console.warn(`Mol* MVS: Unsupported clip type "${e.params.type}" in node ${e.ref}.`)}}function AD(e){let t=qC(e).filter(o=>o.kind==="clip");if(!t.length)return;let r=t[0].params.variant==="object"?"instance":"pixel",n=t.map(npt).filter(o=>!!o);return{variant:r,objects:n}}function g_e(e){return e.custom?"molstar_use_default_coloring"in e.custom||"molstar_color_theme_name"in e.custom:!1}function y_e(e){if(!e?.molstar_use_default_coloring)return{name:e?.molstar_color_theme_name??void 0,params:e?.molstar_color_theme_params??{}}}function _1(e,t){if(e?.kind==="representation"){let r=qC(e).filter(n=>n.kind==="color"||n.kind==="color_from_uri"||n.kind==="color_from_source");if(r.length===0)return{name:"uniform",params:{value:Zo(fD)}};if(r.length===1&&g_e(r[0]))return y_e(r[0].custom);if(r.length===1&&opt(r[0]))return _1(r[0],t);{let n=r.map(o=>{let i=_1(o,t);if(i)return{theme:i,selection:vD(o.kind==="color"?o.params.selector:void 0)}}).filter(o=>!!o);return{name:GV,params:{layers:n}}}}if(e?.kind==="color")return g_e(e)?y_e(e.custom):{name:"uniform",params:{value:Zo(e.params.color)}};if(e?.kind==="color_from_uri"||e?.kind==="color_from_source"){let r=t.annotationMap.get(e);if(r===void 0)return{name:"uniform",params:{}};let n=e.params.field_name;return{name:uk.name,params:{annotationId:r,fieldName:n,background:CD,palette:IZ(e.params.palette)}}}}function opt(e){return e.kind==="color"?!en(e.params.selector)||e.params.selector==="all":!0}var P1=Zo(fD);function IZ(e){if(!e)return{name:"direct",params:{}};if(e.kind==="categorical"){let t=SZ(f2e,e);return{name:"categorical",params:{colors:ipt(t.colors),repeatColorList:t.repeat_color_list,sort:t.sort,sortDirection:t.sort_direction,caseInsensitive:t.case_insensitive,setMissingColor:!!t.missing_color,missingColor:Zo(t.missing_color)??P1}}}if(e.kind==="discrete"){let t=SZ(h2e,e);return{name:"discrete",params:{colors:apt(t.colors,t.reverse),mode:t.mode,xMin:t.value_domain[0],xMax:t.value_domain[1]}}}if(e.kind==="continuous"){let t=SZ(g2e,e),r=spt(t.colors,t.reverse);return{name:"continuous",params:{colors:r,mode:t.mode,xMin:t.value_domain[0],xMax:t.value_domain[1],setUnderflowColor:!!t.underflow_color,underflowColor:(t.underflow_color==="auto"?lpt(r.colors):Zo(t.underflow_color))??P1,setOverflowColor:!!t.overflow_color,overflowColor:(t.overflow_color==="auto"?upt(r.colors):Zo(t.overflow_color))??P1}}}throw new Error(`NotImplementedError: palettePropsFromMVSPalette is not implemented for palette kind "${e.kind}"`)}function SZ(e,t){let r={...e};for(let n in t){let o=t[n];o!==void 0&&(r[n]=o)}return r}function ipt(e){if(typeof e=="string"){if(e in T1)return{name:"list",params:{kind:"set",colors:T1[e].list}};if(e in yZ){let t=yZ[e];return{name:"dictionary",params:Object.entries(t).map(([r,n])=>({value:r,color:n}))}}console.warn(`Could not find named color palette "${e}"`)}return Array.isArray(e)?{name:"list",params:{kind:"set",colors:e.map(t=>Zo(t)??P1)}}:typeof e=="object"?{name:"dictionary",params:Object.entries(e).map(([t,r])=>({value:t,color:Zo(r)??P1}))}:{name:"list",params:{kind:"set",colors:[]}}}function apt(e,t){if(typeof e=="string"){if(e in T1){let r=T1[e],n=t?r.list.slice().reverse():r.list,o=1/n.length;return n.map((i,a)=>({color:Le.fromColorListEntry(i),fromValue:a*o,toValue:(a+1)*o}))}console.warn(`Could not find named color palette "${e}"`)}if(Array.isArray(e)&&e.every(r=>typeof r=="string")){let r=t?e.slice().reverse():e,n=1/e.length;return r.map((o,i)=>({color:Zo(o)??CD,fromValue:i*n,toValue:(i+1)*n}))}return Array.isArray(e)&&e.every(r=>Array.isArray(r)&&r.length===2)?e.map((r,n)=>({color:Zo(r[0])??CD,fromValue:r[1],toValue:e[n+1]?.[1]??1/0})):Array.isArray(e)&&e.every(r=>Array.isArray(r)&&r.length===3)?e.map(r=>({color:Zo(r[0])??CD,fromValue:r[1]??-1/0,toValue:r[2]??1/0})):[]}function spt(e,t){if(typeof e=="string"){if(e in T1){let r=T1[e],n=t?r.list.slice().reverse():r.list,o=n.length-1;return{kind:"interpolate",colors:n.map((i,a)=>[Le.fromColorListEntry(i),a/o])}}console.warn(`Could not find named color palette "${e}"`)}if(Array.isArray(e)){if(e.every(r=>Array.isArray(r)))return{kind:"interpolate",colors:e.map(r=>[Zo(r[0])??P1,r[1]])};{let r=t?e.slice().reverse():e,n=r.length-1;return{kind:"interpolate",colors:r.map((o,i)=>[Zo(o)??P1,i/n])}}}return{kind:"interpolate",colors:[]}}function lpt(e){if(e.length!==0)return e.every(t=>Array.isArray(t))?Le.fromColorListEntry(e.reduce((t,r)=>t[1]<r[1]?t:r)):Le.fromColorListEntry(e[0])}function upt(e){if(e.length!==0)return e.every(t=>Array.isArray(t))?Le.fromColorListEntry(e.reduce((t,r)=>t[1]>r[1]?t:r)):Le.fromColorListEntry(e[e.length-1])}function D_e(e){let t=new Map;return om(e,void 0,(r,n)=>{r.kind==="representation"&&t.set(r,r),r.kind!=="structure"&&t.has(r)&&n&&!t.has(n)&&t.set(n,t.get(r))}),om(e,(r,n)=>{!t.has(r)&&n&&t.has(n)&&t.set(r,t.get(n))}),t}function w_e(e){let t=R_e(e),r=AD(e),n=e.params,o=typeof n.absolute_isovalue=="number"?Ge.IsoValue.absolute(n.absolute_isovalue):Ge.IsoValue.relative(n.relative_isovalue??0);switch(n.type){case"isosurface":let i=[];return n.show_wireframe&&i.push("wireframe"),n.show_faces&&i.push("solid"),{type:{name:"isosurface",params:{alpha:t,isoValue:o,visuals:i,clip:r}}};case"grid_slice":let s={name:n.relative_index!==void 0?`relative${n.dimension.toUpperCase()}`:n.dimension,params:n.relative_index??n.relative_index};return{type:{name:"slice",params:{alpha:t,dimension:s,isoValue:o,clip:r}}};default:throw new Error("NotImplementedError")}}function M_e(e,t){if(e?.kind!=="volume_representation")return;let r=qC(e).filter(n=>n.kind==="color");if(r.length===0)return{name:"uniform",params:{value:Zo(fD)}};if(r.length===1)return _1(r[0],t)}var NV=Qi("linear","bounce-in","bounce-out","bounce-in-out","circle-in","circle-out","circle-in-out","cubic-in","cubic-out","cubic-in-out","exp-in","exp-out","exp-in-out","quad-in","quad-out","quad-in-out","sin-in","sin-out","sin-in-out"),AZ={noise_magnitude:Ue(mr,0,"Magnitude of the noise to apply to the interpolated value.")},TD={target_ref:yn(Vr,"Reference to the node."),property:yn(aa(Vr,za(aa(Vr,To))),"Value accessor."),start_ms:Ue(mr,0,"Start time of the transition in milliseconds."),duration_ms:yn(mr,"Duration of the transition in milliseconds.")},zV={frequency:Ue(To,1,"Determines how many times the interpolation loops. Current T = frequency * t mod 1."),alternate_direction:Ue(ho,!1,"Whether to alternate the direction of the interpolation for frequency > 1.")},HV={easing:Ue(NV,"linear","Easing function to use for the transition.")},cpt={...TD,...zV,...HV,start:Ue(kt(aa(mr,za(mr))),null,"Start value. If a list of values is provided, each element will be interpolated separately. If unset, parent state value is used."),end:Ue(kt(aa(mr,za(mr))),null,"End value. If a list of values is provided, each element will be interpolated separately. If unset, only noise is applied."),discrete:Ue(ho,!1,"Whether to round the values to the closest integer. Useful for example for trajectory animation."),...AZ},mpt={...TD,...zV,...HV,start:Ue(kt(za(mr)),null,"Start value. If unset, parent state value is used. Must be array of length 3N (x1, y1, z1, x2, y2, z2, ...)."),end:Ue(kt(za(mr)),null,"End value. Must be array of length 3N (x1, y1, z1, x2, y2, z2, ...). If unset, only noise is applied."),spherical:Ue(ho,!1,"Whether to use spherical interpolation."),...AZ},dpt={...TD,...zV,...HV,start:Ue(kt(qp),null,"Start value. If unset, parent state value is used."),end:Ue(kt(qp),null,"End value. If unset, only noise is applied."),...AZ},ppt={...TD,...zV,...HV,start:Ue(aa(kt(Po),qm(aa(To,Vr),Po)),null,"Start value. If unset, parent state value is used."),end:Ue(aa(kt(Po),qm(aa(To,Vr),Po)),null,"End value."),palette:Ue(kt(aa(sZ,lZ)),null,"Palette to sample colors from. Overrides start and end values.")},fpt={...TD,pivot:Ue(kt(Pi),null,"Pivot point for rotation and scale."),rotation_start:Ue(kt(qp),null,"Start rotation value. If unset, parent state value is used."),rotation_end:Ue(kt(qp),null,"End rotation value. If unset, only noise is applied."),rotation_noise_magnitude:Ue(mr,0,"Magnitude of the noise to apply to the rotation."),rotation_easing:Ue(NV,"linear","Easing function to use for the rotation."),rotation_frequency:Ue(To,1,"Determines how many times the rotation interpolation loops. Current T = frequency * t mod 1."),rotation_alternate_direction:Ue(ho,!1,"Whether to alternate the direction of the interpolation for frequency > 1."),translation_start:Ue(kt(Pi),null,"Start translation value. If unset, parent state value is used."),translation_end:Ue(kt(Pi),null,"End translation value. If unset, only noise is applied."),translation_noise_magnitude:Ue(mr,0,"Magnitude of the noise to apply to the translation."),translation_easing:Ue(NV,"linear","Easing function to use for the translation."),translation_frequency:Ue(To,1,"Determines how many times the translation interpolation loops. Current T = frequency * t mod 1."),translation_alternate_direction:Ue(ho,!1,"Whether to alternate the direction of the interpolation for frequency > 1."),scale_start:Ue(kt(Pi),null,"Start scale value. If unset, parent state value is used."),scale_end:Ue(kt(Pi),null,"End scale value. If unset, only noise is applied."),scale_noise_magnitude:Ue(mr,0,"Magnitude of the noise to apply to the scale."),scale_easing:Ue(NV,"linear","Easing function to use for the scale."),scale_frequency:Ue(To,1,"Determines how many times the scale interpolation loops. Current T = frequency * t mod 1."),scale_alternate_direction:Ue(ho,!1,"Whether to alternate the direction of the interpolation for frequency > 1.")},AT={rootKind:"animation",nodes:{animation:{description:"Animation root node",parent:[],params:Ur({frame_time_ms:Ue(mr,1e3/60,"Frame time in milliseconds."),duration_ms:Ue(kt(mr),null,"Total duration of the animation. If not specified, computed as maximum of all transitions."),autoplay:Ue(ho,!0,"Determines whether the animation should autoplay when a snapshot is loaded."),loop:Ue(ho,!1,"Determines whether the animation should loop when it reaches the end."),include_camera:Ue(ho,!1,"Determines whether the camera state should be included in the animation."),include_canvas:Ue(ho,!1,"Determines whether the canvas state should be included in the animation.")})},interpolate:{description:"This node enables interpolating between values",parent:["animation"],params:wb("kind","Interpolation kind",{scalar:Ur(cpt),vec3:Ur(mpt),rotation_matrix:Ur(dpt),transform_matrix:Ur(fpt),color:Ur(ppt)})}}};async function F_e(e,t,r,n){if(!t.animation)return;let o=kV(t.animation,AT),i=o.children?.filter(h=>h.kind==="interpolate");if(!i?.length)return;let a=Math.max(t.animation.params?.duration_ms??0,...i.map(h=>(h.params.start_ms??0)+h.params.duration_ms)),s=[],l=o.params?.frame_time_ms??1e3/60,u=Math.ceil(a/l),c=V_e(t.root,new Map,[]),m=new Map,d=gpt(i),p;for(let h=0;h<=u;h++){let f=h*l,g=ypt(t.root,d,f,m,c);g===p||p&&qi(g,p)?s[s.length-1][1]+=l:s.push([g,l]),p=g,e.shouldUpdate&&await e.update({message:`Generating transition for snapshot ${r+1}/${n}`,current:h+1,max:u})}return{tree:o,frametimeMs:l,frames:s}}var YC={linear:e=>e,"bounce-in":j2e,"bounce-out":xD,"bounce-in-out":W2e,"circle-in":X2e,"circle-out":Q2e,"circle-in-out":Z2e,"cubic-in":q2e,"cubic-out":Y2e,"cubic-in-out":K2e,"exp-in":J2e,"exp-out":$2e,"exp-in-out":e_e,"quad-in":t_e,"quad-out":r_e,"quad-in-out":n_e,"sin-in":a_e,"sin-out":s_e,"sin-in-out":l_e};function hpt(e){let t=e.params.property;return Array.isArray(t)?`${e.params.target_ref}:${t.join(".")}`:`${e.params.target_ref}:${t}`}function gpt(e){let t=new Map,r=[];for(let n of e){let o=hpt(n);if(!t.has(o)){let i=[];t.set(o,i),r.push(i)}t.get(o).push(n)}for(let n of r)n.sort((o,i)=>{let a=(o.params.start_ms??0)-(i.params.start_ms??0);return a!==0?a:o.params.duration_ms-i.params.duration_ms});return r}function ypt(e,t,r,n,o){let i=!1,a=Pl(e,s=>{for(let l of t){let u=l[0],c=o.get(u.params.target_ref);if(!c)continue;let m=ZV(s,c,0),d=u.params.property[0]==="custom"?m?.custom:m?.params;if(!d)continue;let p=u.params.property[0]==="custom"?1:0,h=u,f;for(let v=l.length-1;v>0;v--){let A=l[v],P=A.params.start_ms??0;if(r>=P){h=A,f=v>0?l[v-1]:void 0;break}}n.has(h)||n.set(h,{});let g=n.get(h),y=h.params.start_ms??0,x=h.params.duration_ms??0,S=(r-y)/x,I;h.params.kind==="transform_matrix"?I=Cpt(h,d,_r(S,0,1),g,p,f):I=xpt(h,d,S,g,p,f),I!==void 0&&(i=!0,Apt(d,h.params.property,I,p))}});return i?a:e}function XV(e,t,r){let n=e*(t||1);return n<1?n:r?Math.abs(n-1)<1e-6?1:(n=n%2,n>1?2-n:n):(n=n%1,n===0?1:n)}function bpt(e){if(!(!e||e.params.kind==="transform_matrix"))return e.params.end}function xpt(e,t,r,n,o,i){if(e.params.kind==="transform_matrix"||i&&i.params.kind==="transform_matrix")return;let a=e.params.start??bpt(i)??ZV(t,e.params.property,o);e.params.kind==="color"&&!n.paletteFn&&(n.paletteFn=Tpt(e));let s=e.params.end;if(r<=0)return a;if(r>=1-1e-6&&!e.params.alternate_direction&&e.params.kind!=="color")return s;let l=_r(r,0,1);if(l=XV(l,e.params.frequency??1,!!e.params.alternate_direction),l=(YC[e.params.easing??"linear"]??YC.linear)(l),e.params.kind==="scalar")return Spt(a,s,l,e.params.noise_magnitude??0,!!e.params.discrete);if(e.params.kind==="vec3")return vpt(a,s,l,e.params.noise_magnitude??0,!!e.params.spherical);if(e.params.kind==="rotation_matrix")return L_e(a,s,l,e.params.noise_magnitude??0,n);if(e.params.kind==="color"){if(n.paletteFn){let m=n.paletteFn(l);return Le.toHexStyle(m)}let c=typeof a=="object"?ZV(t,e.params.property,o):void 0;return Ipt(a,s,l,n,c)}}function TZ(e,t){if(!(!e||e.params.kind!=="transform_matrix"))return e.params[t]}var yh={pivotTranslation:H(),pivotTranslationInv:H(),rotation:H(),scale:H(),translation:H(),pivotNeg:b(),temp:H()};function Cpt(e,t,r,n,o,i){if(e.params.kind!=="transform_matrix"||i&&i.params.kind!=="transform_matrix")return;let a=ZV(t,e.params.property,o)??H.identity(),s=e.params.rotation_start??TZ(i,"rotation_start")??Mt.fromMat4(Mt(),a),l=e.params.translation_start??TZ(i,"translation_start")??H.getTranslation(b(),a),u=e.params.scale_start??TZ(i,"scale_start")??H.getScaling(b(),a),c=e.params.rotation_end,m=e.params.translation_end,d=e.params.scale_end,p,h,f;if(r<=0)p=s,h=l,f=u;else{let x=_r(r,0,1),S=XV(x,e.params.rotation_frequency??1,!!e.params.rotation_alternate_direction),I=YC[e.params.rotation_easing??"linear"]??YC.linear;p=L_e(s,c,I(S),e.params.rotation_noise_magnitude??0,n),S=XV(x,e.params.translation_frequency??1,!!e.params.translation_alternate_direction),I=YC[e.params.translation_easing??"linear"]??YC.linear,h=B_e(l,m,I(S),e.params.translation_noise_magnitude??0,!1),S=XV(x,e.params.scale_frequency??1,!!e.params.scale_alternate_direction),I=YC[e.params.scale_easing??"linear"]??YC.linear,f=B_e(u,d,I(S),e.params.scale_noise_magnitude??0,!1)}let g=e.params.pivot??b.zero();H.fromTranslation(yh.translation,h),H.fromScaling(yh.scale,f),H.setIdentity(yh.rotation),H.fromMat3(yh.rotation,p),H.fromTranslation(yh.pivotTranslation,g),H.fromTranslation(yh.pivotTranslationInv,b.negate(yh.pivotNeg,g));let y=H();return H.mul(y,yh.scale,yh.pivotTranslationInv),H.mul(y,yh.rotation,y),H.mul(y,yh.translation,y),y}function Spt(e,t,r,n,o){if(Array.isArray(e)){let i=Array.from({length:e.length}).fill(.1);if(!t||!Array.isArray(t)){for(let a=0;a<e.length;a++)i[a]=jV(e[a],t,r,n,o);return i}for(let a=0;a<e.length;a++)i[a]=jV(e[a],t[a],r,n,o);return i}if(Array.isArray(t)){let i=Array.from({length:t.length}).fill(.1);for(let a=0;a<t.length;a++)i[a]=jV(e,t[a],r,n,o);return i}return jV(e,t,r,n,o)}function jV(e,t,r,n,o){let i=typeof t=="number"?to(e,t,r):e;return n&&(i+=(Math.random()-.5)*n),o&&(i=Math.round(i)),i}var WV={start:b(),end:b(),v:b()};function vpt(e,t,r,n,o){if((!t||e===t)&&!n)return e;let i=Array.from({length:e.length}).fill(.1);for(let a=0;a<e.length;a+=3){let s=b.fromArray(WV.start,e,a),l;if(t){let u=b.fromArray(WV.end,t,a);l=o?b.slerp(WV.v,s,u,r):b.lerp(WV.v,s,u,r)}else l=b.clone(s);n&&r<=1-1e-6&&(b.random(QV,n),b.add(l,l,QV)),b.toArray(l,i,a)}return i}var QV=b();function B_e(e,t,r,n,o){if((!t||e===t)&&!n)return e;let i;return t?i=o?b.slerp(b(),e,t,r):b.lerp(b(),e,t,r):i=b.clone(e),n&&r<=1-1e-6&&(b.random(QV,n),b.add(i,i,QV)),i}var Yp={start:lr(),end:lr(),v:lr(),noise:lr(),axis:b(),temp:H()};function L_e(e,t,r,n,o){if((!t||e===t)&&!n)return e;if(t){o.rotation||(o.rotation={...Rpt(e,t),start:lr.fromMat3(lr(),e),end:lr.fromMat3(lr(),t)});let{axis:i,angle:a,start:s,end:l}=o.rotation;a<1e-6?lr.setAxisAngle(Yp.v,i,r*2*Math.PI):lr.slerp(Yp.v,s,l,r)}else lr.fromMat3(Yp.v,e);return n&&r<=1-1e-6&&(b.random(Yp.axis,1),lr.setAxisAngle(Yp.noise,Yp.axis,2*Math.PI*n*(Math.random()-.5)),lr.multiply(Yp.v,Yp.noise,Yp.v)),H.fromQuat(Yp.temp,Yp.v),Mt.fromMat4(Mt(),Yp.temp)}function E_e(e,t){if(e!=null){if(typeof e=="object"){let r={};if(t)for(let n of Object.keys(t)){let o=Vx(t[n]);o!==void 0&&(r[n]=o)}for(let n of Object.keys(e)){let o=Vx(e[n]);o!==void 0&&(r[n]=o)}return r}return Vx(e)}}function Ipt(e,t,r,n,o){let i=_r(r,0,1);if(n.paletteFn){let l=n.paletteFn(i);return Le.toHexStyle(l)}n.startColor===void 0&&(n.startColor=E_e(e,o)),n.endColor===void 0&&(n.endColor=E_e(t,void 0));let{startColor:a,endColor:s}=n;if(typeof a=="object"){if(typeof o!="object")throw new Error("Cannot interpolate from scalar color to color mapping");let l={...o,...a};if(typeof s=="object")for(let u of Object.keys(s))l[u]=Le.toHexStyle(Le.interpolate(a[u],s[u],i));else if(typeof s=="number")for(let u of Object.keys(a))l[u]=Le.toHexStyle(Le.interpolate(a[u],s,i));return l}if(typeof s=="object")throw new Error("Cannot interpolate from scalar color to color mapping");return typeof s=="number"&&typeof a=="number"?Le.toHexStyle(Le.interpolate(a,s,i)):e}function ZV(e,t,r){if(typeof t=="string")return e?.[t];let n=e;for(let o=r;o<t.length&&n;o++)n=n[t[o]];return n}function Apt(e,t,r,n){if(!e)return;if(typeof t=="string"){e[t]=r;return}let o=e;for(let i=n;i<t.length&&o;i++)i===t.length-1?o[t[i]]=r:o=o[t[i]]}function V_e(e,t,r){if(e.ref&&t.set(e.ref,[...r]),!e.children)return t;r.push("children");for(let n=0;n<e.children.length;n++){let o=e.children[n];r.push(n),V_e(o,t,r),r.pop()}return r.pop(),t}function Tpt(e){if(e.params.kind!=="color"||!e.params.palette)return;let t=IZ(e.params.palette);if(t.name==="discrete")return Ppt(t.params);if(t.name==="continuous")return _pt(t.params);throw new Error(`NotImplementedError: makePaletteFunction for ${e.name}`)}function Ppt(e){let t=0;return e.colors.length===0?()=>t:r=>{let n=_r(r,0,1);for(let o=e.colors.length-1;o>=0;o--){let{color:i,fromValue:a,toValue:s}=e.colors[o];if(a<=n&&n<=s)return i}return t}}function _pt(e){let t=0,{colors:r,checkpoints:n}=Zj(e);if(r.length===0)return()=>t;let o=e.setUnderflowColor?e.underflowColor:t,i=e.setOverflowColor?e.overflowColor:t;return a=>{let s=_r(a,0,1),l=Be.findPredecessorIndex(n,s);if(l===0)return s===n[0]?r[0]:o;if(l===n.length)return i;let u=(s-n[l-1])/(n[l]-n[l-1]);return Le.interpolate(r[l-1],r[l],u)}}var k_e={Rt:Mt(),R:Mt()};function Rpt(e,t){let r=e,n=t,o=Mt.transpose(k_e.Rt,r),i=Mt.mul(k_e.R,n,o),a=i[0]+i[4]+i[8],s=Math.acos(_r((a-1)*.5,-1,1)),l=b(),u=1e-6,c=Math.sin(s);if(s<u)return b.set(l,0,0,1),s=0,{axis:l,angle:s};if(Math.PI-s>1e-4)return l[0]=(i[5]-i[7])/(2*c),l[1]=(i[6]-i[2])/(2*c),l[2]=(i[1]-i[3])/(2*c),b.normalize(l,l),{axis:l,angle:s};let m=Math.max(0,(i[0]+1)*.5),d=Math.max(0,(i[4]+1)*.5),p=Math.max(0,(i[8]+1)*.5),h=Math.sqrt(m),f=Math.sqrt(d),g=Math.sqrt(p);return h>=f&&h>=g?(h=Math.max(h,1e-8),f=(i[1]+i[3])/(4*h),g=(i[2]+i[6])/(4*h),b.set(l,h,f,g)):f>=h&&f>=g?(f=Math.max(f,1e-8),h=(i[1]+i[3])/(4*f),g=(i[5]+i[7])/(4*f),b.set(l,h,f,g)):(g=Math.max(g,1e-8),h=(i[2]+i[6])/(4*g),f=(i[5]+i[7])/(4*g),b.set(l,h,f,g)),b.normalize(l,l),{axis:l,angle:Math.PI}}var O_e={id:"ww-pdb/is-hidden-custom-state",description:"Allow updating initial visibility of nodes",createExtensionContext:()=>({}),action:(e,t)=>{!t.custom||!t.custom?.is_hidden||e.update.to(e.selector).updateState({isHidden:!0})}};var Dpt={radius:C.Numeric(5,{min:0},{description:"Surroundings radius in Angstroms"}),includeSelf:C.Boolean(!0,{description:"Include parent selection itself in the surroundings"}),wholeResidues:C.Boolean(!0,{description:"Include whole residues, instead of individual atoms"}),nullIfEmpty:C.Optional(C.Boolean(!0,{isHidden:!0}))},G_e=Vt.BuiltIn({name:"structure-surroundings",display:{name:"Surroundings",description:"Surroundings of a structure component."},from:ne.Molecule.Structure,to:ne.Molecule.Structure,params:Dpt})({apply({a:e,params:t,cache:r}){let n=e.data,o=n.parent??n,i=Q.Bundle.fromSubStructure(o,n),a=Q.Bundle.toExpression(i),s=ie.struct.modifier.includeSurroundings({0:a,radius:t.radius,"as-whole-residues":t.wholeResidues});return t.includeSelf||(s=ie.struct.modifier.exceptBy({0:s,by:a})),hA(o,{label:`Surroundings (${t.radius} \xC5)`,type:{name:"expression",params:s},nullIfEmpty:t.nullIfEmpty},r)},dispose({b:e}){e?.data.customPropertyDescriptors.dispose()}});var wpt=5,U_e={id:"wwpdb/non-covalent-interactions",description:"Allow showing non-covalent interactions around components with molstar_show_non_covalent_interactions additional property",createExtensionContext:()=>({}),action:(e,t,r,n)=>{if(t.kind!=="component"&&t.kind!=="component_from_uri"&&t.kind!=="component_from_source")return;let o=i2e(t);if(!o.molstar_show_non_covalent_interactions)return;let i=Er.apply(e,G_e,{radius:o.molstar_non_covalent_interactions_radius_ang??wpt,includeSelf:!0,wholeResidues:!0,nullIfEmpty:!1});Er.apply(e,Qe.Representation.StructureRepresentation3D,{type:{name:"ball-and-stick",params:{sizeFactor:.22,sizeAspectRatio:.73,adjustCylinderLength:!0,xrayShaded:!0,aromaticBonds:!1,multipleBonds:"off",excludeTypes:["hydrogen-bond","metal-coordination"]}},colorTheme:{name:"element-symbol",params:{}},sizeTheme:{name:"physical",params:{}}}),Er.apply(i,Qe.Representation.StructureRepresentation3D,{type:{name:"ball-and-stick",params:{sizeFactor:.16,excludeTypes:["hydrogen-bond","metal-coordination"]}},colorTheme:{name:"element-symbol",params:{}},sizeTheme:{name:"physical",params:{}}}),Er.apply(i,Qe.Representation.StructureRepresentation3D,{type:{name:"interactions",params:{}},colorTheme:{name:"interaction-type",params:{}},sizeTheme:{name:"uniform",params:{}}})}};function z_e(e={}){return new PZ(e)}var sm=class{constructor(t,r){this._root=t;this._node=r}addChild(t,r){let{params:n,custom:o,ref:i}=FZ(r),a={kind:t,params:n,custom:o,ref:i};return this._node.children??=[],this._node.children.push(a),a}},PZ=class extends sm{constructor(r){let{custom:n,ref:o}=r;super(void 0,{kind:"root",custom:n,ref:o});this._animation=void 0;this.focus=Cc(this,KC,"focus");this.primitives=Cc(this,PT,"primitives");this.primitivesFromUri=Cc(this,PT,"primitivesFromUri");this._root=this}getState(r){return{root:Wo(this._node),metadata:LZ.create(r)}}getSnapshot(r){return{root:Wo(this._node),metadata:{...r},animation:this?._animation?Wo(this._animation.node):void 0}}camera(r){return this.addChild("camera",r),this}canvas(r){return this.addChild("canvas",r),this}download(r){return new RZ(this._root,this.addChild("download",r))}animation(r={}){return this._animation??=new _Z(r),this._animation}extendRootCustomState(r){return this._node.custom={...this._node.custom,...r},this}},_Z=class{constructor(t){this._node={kind:"animation",children:[],...FZ(t)}}get node(){return this._node}interpolate(t){let r={kind:"interpolate",...FZ(t)};return this._node.children.push(r),this}},RZ=class extends sm{parse(t){return new DZ(this._root,this.addChild("parse",t))}},qV={model:["block_header","block_index","model_index","coordinates_ref"],assembly:["block_header","block_index","model_index","assembly_id","coordinates_ref"],symmetry:["block_header","block_index","model_index","ijk_min","ijk_max","coordinates_ref"],symmetry_mates:["block_header","block_index","model_index","radius","coordinates_ref"]},DZ=class extends sm{modelStructure(t={}){return new TT(this._root,this.addChild("structure",{type:"model",...Ll(t,[...qV.model]),custom:t.custom,ref:t.ref}))}assemblyStructure(t={}){return new TT(this._root,this.addChild("structure",{type:"assembly",...Ll(t,qV.assembly),custom:t.custom,ref:t.ref}))}symmetryStructure(t={}){return new TT(this._root,this.addChild("structure",{type:"symmetry",...Ll(t,qV.symmetry),custom:t.custom,ref:t.ref}))}symmetryMatesStructure(t={}){return new TT(this._root,this.addChild("structure",{type:"symmetry_mates",...Ll(t,qV.symmetry_mates),custom:t.custom,ref:t.ref}))}volume(t={}){return new MZ(this._root,this.addChild("volume",t))}coordinates(t={}){return this.addChild("coordinates",t),this}},TT=class extends sm{constructor(){super(...arguments);this.transform=Cc(this,JC,"transform");this.instance=Cc(this,JC,"instance");this.primitives=Cc(this,PT,"primitives");this.primitivesFromUri=Cc(this,PT,"primitivesFromUri")}component(r={}){let n={...r,selector:r.selector??"all"};return new PD(this._root,this.addChild("component",n))}componentFromUri(r){return new PD(this._root,this.addChild("component_from_uri",r))}componentFromSource(r){return new PD(this._root,this.addChild("component_from_source",r))}labelFromUri(r){return this.addChild("label_from_uri",r),this}labelFromSource(r){return this.addChild("label_from_source",r),this}tooltipFromUri(r){return this.addChild("tooltip_from_uri",r),this}tooltipFromSource(r){return this.addChild("tooltip_from_source",r),this}},PD=class extends sm{constructor(){super(...arguments);this.focus=Cc(this,KC,"focus");this.transform=Cc(this,JC,"transform");this.instance=Cc(this,JC,"instance")}representation(r={}){let n={...r,type:r.type??"cartoon"};return new wZ(this._root,this.addChild("representation",n))}label(r){return this.addChild("label",r),this}tooltip(r){return this.addChild("tooltip",r),this}},wZ=class extends sm{color(t){return this.addChild("color",t),this}colorFromUri(t){return this.addChild("color_from_uri",t),this}colorFromSource(t){return this.addChild("color_from_source",t),this}opacity(t){return this.addChild("opacity",t),this}clip(t){return this.addChild("clip",t),this}},MZ=class extends sm{constructor(){super(...arguments);this.focus=Cc(this,KC,"focus");this.transform=Cc(this,JC,"transform");this.instance=Cc(this,JC,"instance")}representation(r){return r||(r={type:"isosurface"}),new BZ(this._root,this.addChild("volume_representation",r))}},BZ=class extends sm{constructor(){super(...arguments);this.focus=Cc(this,KC,"focus")}color(r){return this.addChild("color",r),this}opacity(r){return this.addChild("opacity",r),this}clip(r){return this.addChild("clip",r),this}},EZ=class extends sm{constructor(){super(...arguments);this.focus=Cc(this,KC,"focus")}mesh(r){return this.addChild("primitive",{kind:"mesh",...r}),this}lines(r){return this.addChild("primitive",{kind:"lines",...r}),this}tube(r){return this.addChild("primitive",{kind:"tube",...r}),this}arrow(r){return this.addChild("primitive",{kind:"arrow",...r}),this}distance(r){return this.addChild("primitive",{kind:"distance_measurement",...r}),this}angle(r){return this.addChild("primitive",{kind:"angle_measurement",...r}),this}label(r){return this.addChild("primitive",{kind:"label",...r}),this}ellipse(r){return this.addChild("primitive",{kind:"ellipse",...r}),this}ellipsoid(r){return this.addChild("primitive",{kind:"ellipsoid",...r}),this}sphere(r){return this.addChild("primitive",{kind:"ellipsoid",...r}),this}box(r){return this.addChild("primitive",{kind:"box",...r}),this}clip(r){return this.addChild("clip",r),this}},kZ=class extends sm{constructor(){super(...arguments);this.focus=Cc(this,KC,"focus")}clip(r){return this.addChild("clip",r),this}};function Cc(e,t,r){return t.prototype[r].bind(e)}var KC=class extends sm{focus(t={}){return this.addChild("focus",t),this}},PT=class extends sm{primitives(t={}){return new EZ(this._root,this.addChild("primitives",t))}primitivesFromUri(t){return new kZ(this._root,this.addChild("primitives_from_uri",t))}},JC=class extends sm{transform(t={}){return N_e(t),this.addChild("transform",t),this}instance(t={}){return N_e(t),this.addChild("instance",t),this}};function N_e(e){if(e.rotation&&e.rotation.length!==9)throw new Error("ValueError: `rotation` parameter must be an array of 9 numbers");if(e.matrix&&e.matrix.length!==16)throw new Error("ValueError: `matrix` parameter must be an array of 16 numbers");if(e.matrix&&(e.translation||e.rotation))throw new Error("ValueError: `matrix` parameter cannot be used together with `translation` or `rotation` parameters")}function FZ(e){let{custom:t,ref:r,...n}=e;return{params:n,custom:t,ref:r}}var LZ={create(e){return{...e,version:`${Ym.SupportedVersion}`,timestamp:Mpt()}}},Ym={SupportedVersion:1,fromMVSJ(e){let t=JSON.parse(e),r=H_e(t?.metadata?.version);return r===void 0?console.error("Loaded MVS does not contain valid version info."):r>(H_e(Ym.SupportedVersion)??0)&&console.warn(`Loaded MVS is of higher version (${t.metadata.version}) than currently supported version (${Ym.SupportedVersion}). Some features may not work as expected.`),t},toMVSJ(e,t){return JSON.stringify(e,void 0,t)},isValid(e,t={}){return Ym.validationIssues(e,t)===void 0},validationIssues(e,t={}){let r=e?.metadata?.version;if(typeof r!="string")return[`MVSData.metadata.version must be a string, not ${typeof r}: ${r}`];if(e.kind==="single"||e.kind===void 0)return j_e(e,t);if(e.kind==="multiple"){if(e.snapshots===void 0)return['"snapshots" missing in MVS'];let n=[];for(let o of e.snapshots){let i=j_e(o,t);i&&n.push(...i)}return n.length>0?n:void 0}else return[`MVSData.kind must be 'single' or 'multiple', not ${e.kind}`]},toPrettyString(e){let t=e.kind==="multiple"?"multiple states":"single state",r=e.metadata.title!==void 0?` "${e.metadata.title}"`:"",n=e.kind==="multiple"?e.snapshots.map((o,i)=>`[Snapshot #${i}]
${hD(o.root)}`).join(`
`):hD(e.root);return`MolViewSpec ${t}${r} (version ${e.metadata.version}, created ${e.metadata.timestamp}):
${n}`},createBuilder(){return z_e()},createMultistate(e,t){return{kind:"multiple",snapshots:[...e],metadata:LZ.create(t)}},stateToStates(e){return{kind:"multiple",metadata:e.metadata,snapshots:[{metadata:{title:e.metadata.title,description:e.metadata.description,description_format:e.metadata.description_format,key:void 0,linger_duration_ms:1e3,transition_duration_ms:250},root:e.root}]}}};function H_e(e){if(typeof e=="string")return parseInt(e.split(".")[0]);if(typeof e=="number")return Math.floor(e);console.error(`Version should be a string, not ${typeof e}: ${e}`)}function j_e(e,t={}){if(e.root===void 0)return['"root" missing in snapshot'];let r=S1(nm,e.root,t),n="animation"in e&&e.animation!==void 0?S1(AT,e.animation,t):void 0;if(r&&n)return[...r,...n];if(r)return r;if(n)return n}function Mpt(){return new Date().toISOString()}var VZ={mmcif:{format:"cif",is_binary:!1},bcif:{format:"cif",is_binary:!0},pdb:{format:"pdb",is_binary:!1},pdbqt:{format:"pdbqt",is_binary:!1},gro:{format:"gro",is_binary:!1},xyz:{format:"xyz",is_binary:!1},mol:{format:"mol",is_binary:!1},sdf:{format:"sdf",is_binary:!1},mol2:{format:"mol2",is_binary:!1},lammpstrj:{format:"lammpstrj",is_binary:!1},xtc:{format:"xtc",is_binary:!0},nctraj:{format:"nctraj",is_binary:!0},dcd:{format:"dcd",is_binary:!0},trr:{format:"trr",is_binary:!0},psf:{format:"psf",is_binary:!1},prmtop:{format:"prmtop",is_binary:!1},top:{format:"top",is_binary:!1},map:{format:"map",is_binary:!0},dx:{format:"dx",is_binary:!1},dxbin:{format:"dxbin",is_binary:!0}},Bpt=new Set(["psf","prmtop","top"]),Ept={download:e=>({subtree:[]}),parse:(e,t)=>{let{format:r,is_binary:n}=VZ[e.params.format];return t?.kind==="download"?{subtree:[{kind:"download",params:{...t.params,is_binary:n},custom:t.custom,ref:t.ref},{kind:"parse",params:{...e.params,format:r},custom:e.custom,ref:e.ref}]}:(console.warn('"parse" node is not being converted, this is suspicious'),{subtree:[{kind:"parse",params:{...e.params,format:r},custom:e.custom,ref:e.ref}]})},coordinates:(e,t)=>{if(t?.kind!=="parse")throw new Error(`Parent of "coordinates" must be "parse", not "${t?.kind}".`);let{format:r}=VZ[t.params.format];return{subtree:[{kind:"coordinates",params:{format:r},custom:e.custom,ref:e.ref}]}},structure:(e,t)=>{if(t?.kind!=="parse")throw new Error(`Parent of "structure" must be "parse", not "${t?.kind}".`);let{format:r}=VZ[t.params.format];if(Bpt.has(t.params.format)){if(!e.params.coordinates_ref)throw new Error(`"structure" node with topology format "${t.params.format}" must have "coordinates_ref" parameter.`);return{subtree:[{kind:"topology_with_coordinates",params:{format:r,coordinates_ref:e.params.coordinates_ref}},{kind:"model",params:Ll(e.params,["model_index"])},{kind:"structure",params:Tu(e.params,["block_header","block_index","model_index","coordinates_ref"]),custom:e.custom,ref:e.ref}]}}else return e.params.coordinates_ref?{subtree:[{kind:"trajectory",params:{format:r,...Ll(e.params,["block_header","block_index"])}},{kind:"model",params:{model_index:0}},{kind:"trajectory_with_coordinates",params:{coordinates_ref:e.params.coordinates_ref}},{kind:"model",params:Ll(e.params,["model_index"])},{kind:"structure",params:Tu(e.params,["block_header","block_index","model_index","coordinates_ref"]),custom:e.custom,ref:e.ref}]}:{subtree:[{kind:"trajectory",params:{format:r,...Ll(e.params,["block_header","block_index"])}},{kind:"model",params:Ll(e.params,["model_index"])},{kind:"structure",params:Tu(e.params,["block_header","block_index","model_index","coordinates_ref"]),custom:e.custom,ref:e.ref}]}}},kpt=new Set(["download","parse","trajectory","model"]);function OZ(e,t){let r=kV(e,nm);t&&D2e(r,t,["uri","url"]);let n=EV(r,Ept);if(n.kind!=="root")throw new Error("Root's type is not 'root' after conversion from MVS tree to Molstar tree.");return R2e(n,kpt)}function Fpt(e,t){return e=e.toLowerCase(),t.some(r=>r==="*"||e.endsWith(r))}var Lpt={mmcif:[".cif",".mmif"],bcif:[".bcif"],pdb:[".pdb",".ent"],pdbqt:[".pdbqt"],gro:[".gro"],xyz:[".xyz"],mol:[".mol"],sdf:[".sdf"],mol2:[".mol2"],lammpstrj:[".lammpstrj"],xtc:[".xtc"],nctraj:[".nc",".nctraj"],dcd:[".dcd"],trr:[".trr"],psf:[".psf"],prmtop:[".prmtop",".parm7"],top:[".top"],map:[".map",".ccp4",".mrc",".mrcs"],dx:[".dx"],dxbin:[".dxbin"]};function Vpt(e){let t=[];return om(e,(r,n)=>{if(r.kind==="parse"&&n?.kind==="download"){let o=n.params.url,i=Lpt[r.params.format];Fpt(o,i)||t.push(`Parsing data from ${o} as ${r.params.format} format might be a mistake. The file extension doesn't match recommended file extensions (${i.join(", ")})`)}}),t.length>0?t:void 0}function W_e(e){let t=Vpt(e);if(t){console.warn("There are potential issues in the MVS tree:");for(let r of t)console.warn(" ",r)}}var X_e={rootKind:"root",nodes:{...Mb.nodes,download:{...Mb.nodes.download,params:Ur({...Mb.nodes.download.params.fields,is_binary:yn(ho,"Specifies whether file is downloaded as bytes array or string")})},parse:{...Mb.nodes.parse,params:Ur({format:yn(dD,"File format")})},coordinates:{description:"Auxiliary node corresponding to Molstar's CoordinatesFrom*.",parent:["parse"],params:Ur({format:yn(dD,"File format")})},trajectory:{description:"Auxiliary node corresponding to Molstar's TrajectoryFrom*.",parent:["parse"],params:Ur({format:yn(dD,"File format"),...Ll(Mb.nodes.structure.params.fields,["block_header","block_index"])})},trajectory_with_coordinates:{description:"Auxiliary node corresponding to assigning a separate coordinates to a trajectory.",parent:["model"],params:Ur({coordinates_ref:yn(Vr,"Coordinates reference")})},topology_with_coordinates:{description:"Auxiliary node corresponding to assigning a separate coordinates to a topology.",parent:["parse"],params:Ur({format:yn(dD,"File format"),coordinates_ref:yn(Vr,"Coordinates reference")})},model:{description:"Auxiliary node corresponding to Molstar's ModelFromTrajectory.",parent:["trajectory","trajectory_with_coordinates","topology_with_coordinates"],params:Ur(Ll(Mb.nodes.structure.params.fields,["model_index"]))},structure:{...Mb.nodes.structure,parent:["model"],params:Ur(Tu(Mb.nodes.structure.params.fields,["block_header","block_index","model_index","coordinates_ref"]))}}};function R1(e,t,r={}){let n=Ae.create("Load MVS",o=>Opt(o,e,t,r));return e.runTask(n)}async function Opt(e,t,r,n={}){t.errorContext.clear("mvs");try{if(!t.state.hasBehavior(YV))throw new Error("MolViewSpec extension is not loaded.");t.managers.markdownExtensions.audio.dispose(),P2e(t);let i=r.kind==="multiple"?r:Ym.stateToStates(r),a=[];for(let s=0;s<i.snapshots.length;s++){let l=i.snapshots[s],u=s>0?i.snapshots[s-1]:i.snapshots[i.snapshots.length-1];FV(nm,l.root,"MVS",t),l.animation&&FV(AT,l.animation,"Animation",t),n.sanityChecks&&W_e(l.root);let c=OZ(l.root,n.sourceUrl);FV(X_e,c,"Converted Molstar",t);let m=Z_e(t,c,l.animation,{...l.metadata,previousTransitionDurationMs:u.metadata.transition_duration_ms},n);await Gpt(e,t,m,l,n,s,i.snapshots.length),a.push({...m,_transientData:{sourceMvsSnapshot:l}}),e.shouldUpdate&&await e.update({message:"Loading MVS...",current:s,max:i.snapshots.length})}n.appendSnapshots||t.managers.snapshot.clear();for(let s of a)t.managers.snapshot.add(s);a.length>0&&await lt.State.Snapshots.Apply(t,{id:a[0].snapshot.id})}catch(o){throw t.log.error(`${o}`),o}finally{if(!n.doNotReportErrors)for(let o of t.errorContext.get("mvs"))t.log.warn(o),lt.Toast.Show(t,{title:"Error",message:o,timeoutMs:1e4});t.errorContext.clear("mvs")}}async function Gpt(e,t,r,n,o,i,a){let s=await F_e(e,n,i,a);if(!s?.frames.length)return;let l={autoplay:!!s.tree.params?.autoplay,loop:!!s.tree.params?.loop,frames:[]};for(let u=0;u<s.frames.length;u++){let c=s.frames[u],m=OZ(c[0],o.sourceUrl),d=Z_e(t,m,n.animation,{...n.metadata,previousTransitionDurationMs:s.frametimeMs},o);Co.reuseTransformParams(d.snapshot.data.tree,r.snapshot.data.tree),l.frames.push({durationInMs:c[1],data:d.snapshot.data,camera:s.tree.params?.include_camera?d.snapshot.camera:void 0,canvas3d:s.tree.params?.include_canvas?d.snapshot.canvas3d:void 0}),e.shouldUpdate&&await e.update({message:`Loading animation for snapshot ${i+1}/${a}...`,current:u+1,max:s.frames.length})}r.snapshot.transition=l}function Z_e(e,t,r,n,o){let i=Upt.create(),a=p_e(e,t,Npt,i,{replaceExisting:!0,extensions:o?.extensions??zpt});a.canvas3d={props:e.canvas3d?T2e(e.canvas3d.props,i.canvas,r):void 0},o?.keepCamera||(a.camera=A2e(e,i,n)),a.durationInMs=n.linger_duration_ms+(n.previousTransitionDurationMs??0),t.custom?.molstar_on_load_markdown_commands&&(a.onLoadMarkdownCommands=t.custom.molstar_on_load_markdown_commands);let s={key:n.key,name:n.title,description:n.description,descriptionFormat:n.description_format??"markdown"};return jp.Entry(a,s)}var Upt={create(){return{annotationMap:new Map,camera:{focuses:[]}}}},Npt={root(e,t,r){return r.nearestReprMap=D_e(t),e},download(e,t){return Er.apply(e,ZS,{url:t.params.url,isBinary:t.params.is_binary})},parse(e,t){let r=t.params.format;switch(r){case"cif":return Er.apply(e,l8,{});case"pdb":case"pdbqt":case"gro":case"xyz":case"mol":case"sdf":case"mol2":case"xtc":case"lammpstrj":case"dcd":case"nctraj":case"trr":return e;case"psf":return Er.apply(e,u8,{});case"prmtop":return Er.apply(e,c8,{});case"top":return Er.apply(e,m8,{});case"map":return Er.apply(e,d8,{});case"dx":case"dxbin":return Er.apply(e,p8,{});default:console.error(`Unknown format in "parse" node: "${r}"`);return}},coordinates(e,t){let r=t.params.format;switch(r){case"nctraj":return Er.apply(e,uW);case"dcd":return Er.apply(e,aW);case"trr":return Er.apply(e,lW);case"xtc":return Er.apply(e,sW);case"lammpstrj":return Er.apply(e,cW);default:console.error(`Unknown format in "coordinates" node: "${r}"`);return}},trajectory(e,t){let r=t.params.format;switch(r){case"cif":return Er.apply(e,fW,{blockHeader:t.params.block_header??"",blockIndex:t.params.block_index??void 0});case"pdb":case"pdbqt":return Er.apply(e,hW,{isPdbqt:r==="pdbqt"});case"gro":return Er.apply(e,gW);case"xyz":return Er.apply(e,yW);case"mol":return Er.apply(e,xW);case"sdf":return Er.apply(e,CW);case"mol2":return Er.apply(e,SW);case"lammpstrj":return Er.apply(e,bW);default:console.error(`Unknown format in "trajectory" node: "${r}"`);return}},trajectory_with_coordinates(e,t){let r=Er.apply(e,pZ,{coordinatesRef:t.params.coordinates_ref});return Er.setMvsDependencies(r,[t.params.coordinates_ref])},topology_with_coordinates(e,t){let r,n=t.params.format;switch(n){case"psf":r=Er.apply(e,mW,{});break;case"prmtop":r=Er.apply(e,dW,{});break;case"top":r=Er.apply(e,pW,{});break;default:console.error(`Unknown format in "topology_with_coordinates" node: "${n}"`);return}let o=Er.apply(r,pZ,{coordinatesRef:t.params.coordinates_ref});return Er.setMvsDependencies(o,[t.params.coordinates_ref])},model(e,t,r){let n=S_e(t,r),o=Er.apply(e,_R,{modelIndex:t.params.model_index});return Er.apply(o,RR,{properties:{[YI.descriptor.name]:{isMvs:!0},[nb.descriptor.name]:{annotations:n}},autoAttach:[YI.descriptor.name,nb.descriptor.name]}),o},structure(e,t,r){let n=T_e(t),o=Er.apply(e,vW,n),i=SD(o,t),a=v_e(t,r),s=I_e(t,r);Er.apply(o,DR,{properties:{[u1.descriptor.name]:{tooltips:a},[c1.descriptor.name]:{tooltips:s}},autoAttach:[u1.descriptor.name,c1.descriptor.name]});let l=A_e(t,r);if(l.length>0){let u=r.nearestReprMap?.get(t);Er.apply(o,Od,{type:{name:bL.name,params:{items:l}},colorTheme:_1(u,r)})}return i},tooltip:void 0,tooltip_from_uri:void 0,tooltip_from_source:void 0,component(e,t){if(UV(t))return e;let r=t.params.selector;return SD(Er.apply(e,TW,{type:vD(r),label:P_e(r),nullIfEmpty:!1}),t)},component_from_uri(e,t,r){if(UV(t))return;let n=ID(t,r);return SD(Er.apply(e,fX,n),t)},component_from_source(e,t,r){if(UV(t))return;let n=ID(t,r);return SD(Er.apply(e,fX,n),t)},representation(e,t,r){return Er.apply(e,Od,{...__e(t),colorTheme:_1(t,r)})},volume(e,t){let r;if(e.transformer?.definition.to.includes(ne.Format.Ccp4))r=Er.apply(e,_W,{});else if(e.transformer?.definition.to.includes(ne.Format.Dx))r=Er.apply(e,RW,{});else if(e.transformer?.definition.to.includes(ne.Format.Cif))r=Er.apply(e,DW,{blockHeader:t.params.channel_id||void 0});else{console.error("Unsupported volume format");return}return x_e(r,t)},volume_representation(e,t,r){return Er.apply(e,tX,{...w_e(t),colorTheme:M_e(t,r)})},color:void 0,color_from_uri:void 0,color_from_source:void 0,label:void 0,label_from_uri(e,t,r){let n=vZ(t,r);return Er.apply(e,Od,n)},label_from_source(e,t,r){let n=vZ(t,r);return Er.apply(e,Od,n)},focus(e,t,r){return r.camera.focuses.push({target:e.selector,params:t.params}),e},camera(e,t,r){return r.camera.cameraParams=t.params,e},canvas(e,t,r){return r.canvas=t,e},primitives(e,t,r){let n=B2e(t),o=AD(t),i=Er.apply(e,k2e,{node:t});return Er.setMvsDependencies(i,n),Q_e(i,n,o)},primitives_from_uri(e,t,r){let n=new Set(t.params.references),o=AD(t),i=Er.apply(e,E2e,{uri:t.params.uri,format:t.params.format});return Er.setMvsDependencies(i,n),Q_e(i,n,o)}};function Q_e(e,t,r){let n=Er.setMvsDependencies(Er.apply(e,LV,{kind:"mesh",clip:r},{state:{isGhost:!0}}),t);Er.apply(n,VV);let o=Er.setMvsDependencies(Er.apply(e,LV,{kind:"labels",clip:r},{state:{isGhost:!0}}),t);Er.apply(o,VV);let i=Er.setMvsDependencies(Er.apply(e,LV,{kind:"lines",clip:r},{state:{isGhost:!0}}),t);return Er.apply(i,VV),e}var zpt=[U_e,O_e];var D1=class extends ne.Create({name:"MVS Data",typeClass:"Data"}){},Hpt=oh({name:"mvs-parse-mvsj",display:{name:"MolViewSpec from MVSJ",description:"Create MolViewSpec view from MVSJ data"},from:ne.Data.String,to:D1})({apply({a:e},t){let r=Ym.fromMVSJ(Tm.toString(e.data)),n=Xpt(e,t);return new D1({mvsData:r,sourceUrl:n})}}),jpt=oh({name:"mvs-parse-mvsx",display:{name:"MolViewSpec from MVSX",description:"Create MolViewSpec view from MVSX data"},from:ne.Data.Binary,to:D1,params:{mainFilePath:C.Text("index.mvsj")}})({apply({a:e,params:t},r){return Ae.create("Parse MVSX file",async n=>{let o=await JV(r,n,e.data,t.mainFilePath);return new D1(o)})}}),K_e={appendSnapshots:C.Boolean(!1,{description:"If true, add snapshots from MVS into current snapshot list; if false, replace the snapshot list."}),keepCamera:C.Boolean(!1,{description:"If true, any camera positioning from the MVS state will be ignored and the current camera position will be kept."}),applyExtensions:C.Boolean(!0,{description:"If true, apply builtin MVS-loading extensions (not a part of standard MVS specification)."})},GZ=Gs.build({display:{name:"Load MVS Data"},from:D1,params:K_e})(({a:e,params:t},r)=>Ae.create("Load MVS Data",async()=>{let{mvsData:n,sourceUrl:o}=e.data;await R1(r,n,{appendSnapshots:t.appendSnapshots,keepCamera:t.keepCamera,sourceUrl:o,extensions:t.applyExtensions?void 0:[]})})),UZ={label:"MVSJ",description:"MVSJ",category:"Miscellaneous",stringExtensions:["mvsj"],parse:async(e,t)=>e.state.data.build().to(t).apply(Hpt).commit(),visuals:async(e,t)=>{let r=ci.resolveRef(t),n=C.getDefaultValues(K_e);return await e.state.data.applyAction(GZ,n,r).run()}},J_e={label:"MVSX",description:"MVSX",category:"Miscellaneous",binaryExtensions:["mvsx"],parse:async(e,t)=>e.state.data.build().to(t).apply(jpt).commit(),visuals:UZ.visuals};async function JV(e,t,r,n){typeof n=="string"&&(n={mainFilePath:n});let o=n?.mainFilePath??"index.mvsj";(n?.doNotClearAssets??!1)||Wpt(e);let a=`ni,MurmurHash3_128;${Wre(r,42)}`,s;try{s=await Yx(t,r.buffer)}catch(m){throw e.log.error("Invalid MVSX file"),m}for(let m in s){let d=q_e(a,m);Qpt(e.managers.asset,d,s[m],{isFile:!0})}let l=s[o];if(!l)throw new Error(`File ${o} not found in the MVSX archive`);let u=Ym.fromMVSJ(Zpt(l)),c=q_e(a,o);return{mvsData:u,sourceUrl:c}}async function NZ(e,t,r,n){if(typeof t=="string"&&t.startsWith("base64")&&(t=Uint8Array.from(atob(t.substring(7)),o=>o.charCodeAt(0))),r==="mvsj"){t.BYTES_PER_ELEMENT&&t.buffer&&(t=new TextDecoder().decode(t));let o;typeof t=="string"?o=Ym.fromMVSJ(t):o=t,await R1(e,o,{sanityChecks:!0,sourceUrl:void 0,...n})}else if(r==="mvsx"){if(typeof t=="string")throw new Error("loadMvsData: if `format` is 'mvsx', then `data` must be a Uint8Array or a base64-encoded string prefixed with 'base64,'.");await e.runTask(Ae.create("Load MVSX file",async o=>{let i=await JV(e,o,t,{doNotClearAssets:n?.appendSnapshots});await R1(e,i.mvsData,{sanityChecks:!0,...n,sourceUrl:i.sourceUrl})}))}else throw new Error(`Unknown MolViewSpec format: ${r}`);return t}function Wpt(e){e.managers.asset.clearTag("mvsx-file")}function Xpt(e,t){let n=t.state.data.selectQ(o=>o.ofTransformer(ZS)).find(o=>o.obj===e)?.transform.params?.url;return n?sn.getUrl(n):void 0}function q_e(e,t){return new URL(t,`arcp://${e}/`).href}function Qpt(e,t,r,n){let o=sn.getUrlAsset(e,t);if(!e.has(o)){let i=t.split("/").pop()??"file";e.set(o,new File([r],i),n?.isFile?{isStatic:!0,tag:"mvsx-file"}:void 0)}}function Zpt(e){return Y_e??=new TextDecoder,Y_e.decode(e)}var Y_e;var YV=Kr.create({name:"molviewspec",category:"misc",display:{name:"MolViewSpec",description:"MolViewSpec extension"},ctor:class extends Kr.Handler{constructor(){super(...arguments);this.registrables={customModelProperties:[YI,nb],customStructureProperties:[c1,u1],representations:[bL,yL],colorThemes:[uk,d_e(this.ctx.representation.structure.themes.colorThemeRegistry)],lociLabels:[aIe,eIe],dragAndDropHandlers:[qpt],dataFormats:[{name:"MVSJ",provider:UZ},{name:"MVSX",provider:J_e}],actions:[GZ]}}register(){for(let t of this.registrables.customModelProperties??[])this.ctx.customModelProperties.register(t,this.params.autoAttach);for(let t of this.registrables.customStructureProperties??[])this.ctx.customStructureProperties.register(t,this.params.autoAttach);for(let t of this.registrables.representations??[])this.ctx.representation.structure.registry.add(t);for(let t of this.registrables.colorThemes??[])this.ctx.representation.structure.themes.colorThemeRegistry.add(t);for(let t of this.registrables.lociLabels??[])this.ctx.managers.lociLabels.addProvider(t);for(let t of this.registrables.dragAndDropHandlers??[])this.ctx.managers.dragAndDrop.addHandler(t.name,t.handle);for(let t of this.registrables.dataFormats??[])this.ctx.dataFormats.add(t.name,t.provider);for(let t of this.registrables.actions??[])this.ctx.state.data.actions.add(t);this.ctx.state.data.registerRefResolver("mvs",(t,r)=>Co.doPreOrder(t.tree,t.tree.root,{ref:r,ret:void 0},(o,i,a)=>{if(o.tags){for(let s of o.tags)if(s.startsWith("mvs-ref:")&&s.substring(8)===r)return a.ret=t.cells.get(o.ref)?.obj?.data,!1}}).ret),this.ctx.managers.markdownExtensions.registerRefResolver("mvs",(t,r)=>{let n=new Set(r.map(o=>`mvs-ref:${o}`));return Co.doPreOrder(t.state.data.tree,t.state.data.tree.root,{mvsRefs:n,plugin:t,cells:[]},(o,i,a)=>{if(o.tags)for(let s of o.tags){if(!a.mvsRefs.has(s))continue;let l=a.plugin.state.data.cells.get(o.ref);if(l){a.cells.push(l);break}}}).cells}),this.ctx.managers.markdownExtensions.registerUriResolver("mvs",(t,r)=>{let{assets:n}=t.managers.asset,o=n.find(i=>i.file.name===r);if(o)try{return pue(o.file)}catch(i){console.error(`MVS: Failed to convert asset file to data URI for '${r}'`,i);return}})}update(t){let r=this.params.autoAttach!==t.autoAttach;this.params.autoAttach=t.autoAttach;for(let n of this.registrables.customModelProperties??[])this.ctx.customModelProperties.setDefaultAutoAttach(n.descriptor.name,this.params.autoAttach);for(let n of this.registrables.customStructureProperties??[])this.ctx.customStructureProperties.setDefaultAutoAttach(n.descriptor.name,this.params.autoAttach);return r}unregister(){for(let t of this.registrables.customModelProperties??[])this.ctx.customModelProperties.unregister(t.descriptor.name);for(let t of this.registrables.customStructureProperties??[])this.ctx.customStructureProperties.unregister(t.descriptor.name);for(let t of this.registrables.representations??[])this.ctx.representation.structure.registry.remove(t);for(let t of this.registrables.colorThemes??[])this.ctx.representation.structure.themes.colorThemeRegistry.remove(t);for(let t of this.registrables.lociLabels??[])this.ctx.managers.lociLabels.removeProvider(t);for(let t of this.registrables.dragAndDropHandlers??[])this.ctx.managers.dragAndDrop.removeHandler(t.name);for(let t of this.registrables.dataFormats??[])this.ctx.dataFormats.remove(t.name);for(let t of this.registrables.actions??[])this.ctx.state.data.actions.remove(t);this.ctx.state.data.removeRefResolver("mvs"),this.ctx.managers.markdownExtensions.removeRefResolver("mvs")}},params:()=>({autoAttach:C.Boolean(!1)})}),qpt={name:"mvs-mvsj-mvsx",async handle(e,t){let r=!1;for(let n of e){if(n.name.toLowerCase().endsWith(".mvsj")){let o=Ae.create("Load MVSJ file",async i=>{let a=await n.text(),s=Ym.fromMVSJ(a);await R1(t,s,{sanityChecks:!0,appendSnapshots:r,sourceUrl:void 0})});await t.runTask(o),r=!0}if(n.name.toLowerCase().endsWith(".mvsx")){let o=Ae.create("Load MVSX file",async i=>{let a=await n.arrayBuffer(),s=new Uint8Array(a),l=await JV(t,i,s);await R1(t,l.mvsData,{sanityChecks:!0,appendSnapshots:r,sourceUrl:l.sourceUrl})});await t.runTask(o),r=!0}}return r}};var XBe=_t(Mi());var U1=_t(Mi());var UT=_t(Mi());var jZ={};Gi(jZ,{AddTrajectory:()=>Bft,DownloadStructure:()=>Pft,EnableModelCustomProps:()=>wft,EnableStructureCustomProps:()=>Mft,LoadTrajectory:()=>Eft,PdbDownloadProvider:()=>uRe,UpdateTrajectory:()=>DD});function _T(e,t,r={}){let n=r;return typeof n.type=="string"||typeof n.color=="string"||typeof n.size=="string"?Ypt(e,t||De.Empty,r):eRe(e,t||De.Empty,r)}function $_e(e,t){let{themes:r}=e.representation.structure;return t?r.colorThemeRegistry.getApplicableTypes({structure:t}):r.colorThemeRegistry.types}function _D(e,t,r,n,o){let{registry:i,themes:a}=e.representation.structure,s=i.get(r||i.default.name),l=a.colorThemeRegistry.get(n||s.defaultColorTheme.name),u=C.getDefaultValues(l.getParams({structure:t||De.Empty}));return l.name===s.defaultColorTheme.name&&Object.assign(u,s.defaultColorTheme.props),{name:l.name,params:Object.assign(u,o)}}function zZ(e,t,r,n,o){let{registry:i,themes:a}=e.representation.structure,s=i.get(r||i.default.name),l=a.sizeThemeRegistry.get(n||s.defaultSizeTheme.name),u=C.getDefaultValues(l.getParams({structure:t||De.Empty}));return l.name===s.defaultSizeTheme.name&&Object.assign(u,s.defaultSizeTheme.props),{name:l.name,params:Object.assign(u,o)}}function Ypt(e,t,r){let n=r.type&&e.representation.structure.registry.get(r.type)||e.representation.structure.registry.default.provider,o=r.color&&e.representation.structure.themes.colorThemeRegistry.get(r.color)||e.representation.structure.themes.colorThemeRegistry.get(n.defaultColorTheme.name),i=r.size&&e.representation.structure.themes.sizeThemeRegistry.get(r.size)||e.representation.structure.themes.sizeThemeRegistry.get(n.defaultSizeTheme.name);return eRe(e,t,{type:n,typeParams:r.typeParams,color:o,colorParams:r.colorParams,size:i,sizeParams:r.sizeParams})}function eRe(e,t,r={}){let{themes:n}=e.representation.structure,o={structure:t},i=r.type||e.representation.structure.registry.default.provider,a=C.getDefaultValues(i.getParams(n,t)),s=Object.assign(a,r.typeParams),l=r.color||n.colorThemeRegistry.get(i.defaultColorTheme.name),u=C.getDefaultValues(l.getParams(o));l.name===i.defaultColorTheme.name&&Object.assign(u,i.defaultColorTheme.props);let c=Object.assign(u,r.colorParams),m=r.size||n.sizeThemeRegistry.get(i.defaultSizeTheme.name),d=C.getDefaultValues(m.getParams(o));m.name===i.defaultSizeTheme.name&&Object.assign(d,i.defaultSizeTheme.props);let p=Object.assign(d,r.sizeParams);return{type:{name:i.name,params:s},colorTheme:{name:l.name,params:c},sizeTheme:{name:m.name,params:p}}}var Kpt=e=>{let t=Qe.Representation.StructureRepresentation3D.definition.params(void 0,e);return{expandRadius:C.Numeric(5,{min:1,max:10,step:1}),targetParams:C.Group(t,{label:"Target",customDefault:_T(e,void 0,{type:"ball-and-stick",size:"physical",typeParams:{sizeFactor:.22,sizeAspectRatio:.73,adjustCylinderLength:!0,xrayShaded:!0,aromaticBonds:!1,multipleBonds:"off",excludeTypes:["hydrogen-bond","metal-coordination"]}})}),surroundingsParams:C.Group(t,{label:"Surroundings",customDefault:_T(e,void 0,{type:"ball-and-stick",size:"physical",typeParams:{sizeFactor:.16,excludeTypes:["hydrogen-bond","metal-coordination"]}})}),nciParams:C.Group(t,{label:"Non-covalent Int.",customDefault:_T(e,void 0,{type:gT,color:rD,size:Bo.BuiltIn.uniform})}),components:C.MultiSelect(tRe,C.arrayToOptions(tRe)),excludeTargetFromSurroundings:C.Boolean(!1,{label:"Exclude Target",description:'Exclude the focus "target" from the surroudings component.'}),ignoreHydrogens:C.Boolean(!1),ignoreHydrogensVariant:C.Select("all",C.arrayToOptions(["all","non-polar"])),ignoreLight:C.Boolean(!1),material:Hi.getParam(),clip:C.Group(Zf.Params),interior:vp()}},tRe=["target","surroundings","interactions"];var Jpt=new Set(["structure-focus-target-sel","structure-focus-target-repr","structure-focus-surr-sel","structure-focus-surr-repr","structure-focus-surr-nci-repr"]),HZ=class extends Kr.WithSubscribers{constructor(){super(...arguments);this.currentSource=void 0}get surrLabel(){return`[Focus] Surroundings (${this.params.expandRadius} \xC5)`}getReprParams(r){return{...r,type:{name:r.type.name,params:{...r.type.params,ignoreHydrogens:this.params.ignoreHydrogens,ignoreHydrogensVariant:this.params.ignoreHydrogensVariant,ignoreLight:this.params.ignoreLight,material:this.params.material,clip:this.params.clip,interior:this.params.interior}}}}ensureShape(r){let n=this.plugin.state.data,o=n.tree,i=n.build(),a=tr.findUniqueTagsInSubtree(o,r.transform.ref,Jpt);a["structure-focus-target-sel"]||(a["structure-focus-target-sel"]=i.to(r).apply(Qe.Model.StructureSelectionFromBundle,{bundle:Q.Bundle.Empty,label:"[Focus] Target"},{tags:"structure-focus-target-sel"}).ref),a["structure-focus-surr-sel"]||(a["structure-focus-surr-sel"]=i.to(r).apply(Qe.Model.StructureSelectionFromExpression,{expression:ie.struct.generator.empty(),label:this.surrLabel},{tags:"structure-focus-surr-sel"}).ref);let s=this.params.components;return s.indexOf("target")>=0&&!a["structure-focus-target-repr"]&&(a["structure-focus-target-repr"]=i.to(a["structure-focus-target-sel"]).apply(Qe.Representation.StructureRepresentation3D,this.getReprParams(this.params.targetParams),{tags:"structure-focus-target-repr"}).ref),s.indexOf("surroundings")>=0&&!a["structure-focus-surr-repr"]&&(a["structure-focus-surr-repr"]=i.to(a["structure-focus-surr-sel"]).apply(Qe.Representation.StructureRepresentation3D,this.getReprParams(this.params.surroundingsParams),{tags:"structure-focus-surr-repr"}).ref),s.indexOf("interactions")>=0&&!a["structure-focus-surr-nci-repr"]&&r.obj&&gT.isApplicable(r.obj?.data)&&(a["structure-focus-surr-nci-repr"]=i.to(a["structure-focus-surr-sel"]).apply(Qe.Representation.StructureRepresentation3D,this.getReprParams(this.params.nciParams),{tags:"structure-focus-surr-nci-repr"}).ref),{state:n,builder:i,refs:a}}clear(r){let n=this.plugin.state.data;this.currentSource=void 0;let o=n.select(tr.Generators.byRef(r).subtree().withTag("structure-focus-target-sel")),i=n.select(tr.Generators.byRef(r).subtree().withTag("structure-focus-surr-sel"));if(o.length===0&&i.length===0)return;let a=n.build(),s=Q.Bundle.Empty;for(let u of o)a.to(u).update(Qe.Model.StructureSelectionFromBundle,c=>({...c,bundle:s}));let l=ie.struct.generator.empty();for(let u of i)a.to(u).update(Qe.Model.StructureSelectionFromExpression,c=>({...c,expression:l}));return lt.State.Update(this.plugin,{state:n,tree:a,options:{doNotLogTiming:!0,doNotUpdateCurrent:!0}})}async focus(r){let n=this.plugin.helpers.substructureParent.get(r.structure);if(!n||!n.obj)return;this.currentSource=r;let o=Q.Loci.remap(r,n.obj.data),i=Q.Loci.extendToWholeResidues(o),a=Q.Bundle.fromLoci(i),s=Q.Bundle.toExpression(a),l=ie.struct.modifier.includeSurroundings({0:s,radius:this.params.expandRadius,"as-whole-residues":!0});this.params.excludeTargetFromSurroundings&&(l=ie.struct.modifier.exceptBy({0:l,by:s}));let{state:u,builder:c,refs:m}=this.ensureShape(n);c.to(m["structure-focus-target-sel"]).update(Qe.Model.StructureSelectionFromBundle,d=>({...d,bundle:a})),c.to(m["structure-focus-surr-sel"]).update(Qe.Model.StructureSelectionFromExpression,d=>({...d,expression:l,label:this.surrLabel})),await lt.State.Update(this.plugin,{state:u,tree:c,options:{doNotLogTiming:!0,doNotUpdateCurrent:!0}})}register(r){this.subscribeObservable(this.plugin.managers.structure.focus.behaviors.current,n=>{n?this.focus(n.loci):this.clear(Br.RootRef)})}async update(r){let n=this.params;if(this.params=r,n.excludeTargetFromSurroundings!==r.excludeTargetFromSurroundings)return this.currentSource&&this.focus(this.currentSource),!0;let o=this.plugin.state.data,i=o.build(),a=tr.Generators.root.subtree(),s=this.params.components,l=s.indexOf("target")>=0;for(let u of o.select(a.withTag("structure-focus-target-repr")))l?i.to(u).update(this.getReprParams(this.params.targetParams)):i.delete(u.transform.ref);l=s.indexOf("surroundings")>=0;for(let u of o.select(a.withTag("structure-focus-surr-repr")))l?i.to(u).update(this.getReprParams(this.params.surroundingsParams)):i.delete(u.transform.ref);l=s.indexOf("interactions")>=0;for(let u of o.select(a.withTag("structure-focus-surr-nci-repr")))l?i.to(u).update(this.getReprParams(this.params.nciParams)):i.delete(u.transform.ref);return await lt.State.Update(this.plugin,{state:o,tree:i,options:{doNotLogTiming:!0,doNotUpdateCurrent:!0}}),r.expandRadius!==n.expandRadius&&this.currentSource&&this.focus(this.currentSource),!0}},w1=Kr.create({name:"create-structure-focus-representation",display:{name:"Structure Focus Representation"},category:"interaction",ctor:HZ,params:(e,t)=>Kpt(t)});function Zg(e){return e}(i=>{i.CommonParams={ignoreHydrogens:C.Optional(C.Boolean(!1)),ignoreHydrogensVariant:C.Optional(C.Select("all",C.arrayToOptions(["all","non-polar"]))),ignoreLight:C.Optional(C.Boolean(!1)),quality:C.Optional(C.Select("auto",cR)),theme:C.Optional(C.Group({globalName:C.Optional(C.Text("")),globalColorParams:C.Optional(C.Value({},{isHidden:!0})),carbonColor:C.Optional(C.Select("chain-id",C.arrayToOptions(["chain-id","operator-name","element-symbol"]))),symmetryColor:C.Optional(C.Text("")),symmetryColorParams:C.Optional(C.Value({},{isHidden:!0})),focus:C.Optional(C.Group({name:C.Optional(C.Text("")),params:C.Optional(C.Value({}))}))}))};function t(a){return a==="chain-id"?{name:a,params:mk.defaultValues}:a==="operator-name"?{name:a,params:JI.defaultValues}:{name:a,params:{}}}function r(a){return a.units.some(s=>!s.conformation.operator.assembly&&s.conformation.operator.spgrOp>=0)}function n(a,s,l){let u=a.state.data.build(),c=a.builders.structure.representation,m=a.managers.structure.component.state.options.hydrogens,d={quality:a.managers.structure.component.state.options.visualQuality,ignoreHydrogens:m!=="all",ignoreHydrogensVariant:m==="only-polar"?"non-polar":"all",ignoreLight:a.managers.structure.component.state.options.ignoreLight};s.quality&&s.quality!=="auto"&&(d.quality=s.quality),s.ignoreHydrogens!==void 0&&(d.ignoreHydrogens=!!s.ignoreHydrogens),s.ignoreHydrogensVariant!==void 0&&(d.ignoreHydrogensVariant=s.ignoreHydrogensVariant),s.ignoreLight!==void 0&&(d.ignoreLight=!!s.ignoreLight);let p=s.theme?.globalName?s.theme?.globalName:void 0,h=s.theme?.carbonColor!==void 0?{carbonColor:t(s.theme?.carbonColor),...s.theme?.globalColorParams}:{...s.theme?.globalColorParams},f=l&&s.theme?.symmetryColor&&r(l)?s.theme?.symmetryColor:p,g=s.theme?.symmetryColorParams?{...s.theme?.globalColorParams,...s.theme?.symmetryColorParams}:{...s.theme?.globalColorParams},y=s.theme?.globalColorParams?{...s.theme?.globalColorParams}:void 0;return{update:u,builder:c,color:p,symmetryColor:f,symmetryColorParams:g,globalColorParams:y,typeParams:d,ballAndStickColor:h}}i.reprBuilder=n;function o(a,s,l,u){if(a.state.hasBehavior(w1))return a.state.updateBehavior(w1,c=>{let m=_D(a,s,"ball-and-stick",l||"element-symbol",u);c.surroundingsParams.colorTheme=m,c.targetParams.colorTheme=m})}i.updateFocusRepr=o})(Zg||={});var kb=Zg.CommonParams,$C=Zg.reprBuilder,e0=Zg.updateFocusRepr,$pt={id:"preset-structure-representation-auto",display:{name:"Automatic",description:"Show representations based on the size of the structure. Smaller structures are shown with more detail than larger ones, ranging from atomistic display to coarse surfaces."},params:()=>kb,apply(e,t,r){let n=ci.resolveAndCheck(r.state.data,e)?.obj?.data;if(!n)return{};let o=r.config.get(Lr.Structure.SizeThresholds)||De.DefaultSizeThresholds,i=De.getSize(n,o),a=n.polymerResidueCount/n.polymerGapCount;switch(i){case De.Size.Gigantic:case De.Size.Huge:return oRe.apply(e,t,r);case De.Size.Large:return iRe.apply(e,t,r);case De.Size.Medium:if(a>3)return nRe.apply(e,t,r);case De.Size.Small:return aRe.apply(e,{...t,showCarbohydrateSymbol:!0},r);default:Mr(i)}}},eft={id:"preset-structure-representation-empty",display:{name:"Empty",description:"Removes all existing representations."},async apply(e,t,r){return{}}},RD="Basic",nRe={id:"preset-structure-representation-polymer-and-ligand",display:{name:"Polymer & Ligand",group:RD,description:"Shows polymers as Cartoon, ligands as Ball & Stick, carbohydrates as 3D-SNFG and water molecules semi-transparent."},params:()=>kb,async apply(e,t,r){let n=ci.resolveAndCheck(r.state.data,e);if(!n)return{};let o={polymer:await Sc(r,n,"polymer"),ligand:await Sc(r,n,"ligand"),nonStandard:await Sc(r,n,"non-standard"),branched:await Sc(r,n,"branched",{label:"Carbohydrate"}),water:await Sc(r,n,"water"),ion:await Sc(r,n,"ion"),lipid:await Sc(r,n,"lipid"),coarse:await Sc(r,n,"coarse")},i=n.obj.data,a=(o.water?.obj?.data?.elementCount||0)>5e4?"line":"ball-and-stick",s=(o.lipid?.obj?.data?.elementCount||0)>2e4?"line":"ball-and-stick",{update:l,builder:u,typeParams:c,color:m,symmetryColor:d,symmetryColorParams:p,globalColorParams:h,ballAndStickColor:f}=$C(r,t,i),g={polymer:u.buildRepresentation(l,o.polymer,{type:"cartoon",typeParams:c,color:d,colorParams:p},{tag:"polymer"}),ligand:u.buildRepresentation(l,o.ligand,{type:"ball-and-stick",typeParams:c,color:m,colorParams:f},{tag:"ligand"}),nonStandard:u.buildRepresentation(l,o.nonStandard,{type:"ball-and-stick",typeParams:c,color:m,colorParams:f},{tag:"non-standard"}),branchedBallAndStick:u.buildRepresentation(l,o.branched,{type:"ball-and-stick",typeParams:{...c,alpha:.3},color:m,colorParams:f},{tag:"branched-ball-and-stick"}),branchedSnfg3d:u.buildRepresentation(l,o.branched,{type:"carbohydrate",typeParams:c,color:m,colorParams:h},{tag:"branched-snfg-3d"}),water:u.buildRepresentation(l,o.water,{type:a,typeParams:{...c,alpha:.6,visuals:a==="line"?["intra-bond","element-point"]:void 0},color:m,colorParams:{carbonColor:{name:"element-symbol",params:{}},...h}},{tag:"water"}),ion:u.buildRepresentation(l,o.ion,{type:"ball-and-stick",typeParams:c,color:m,colorParams:{carbonColor:{name:"element-symbol",params:{}},...h}},{tag:"ion"}),lipid:u.buildRepresentation(l,o.lipid,{type:s,typeParams:{...c,alpha:.6,visuals:s==="line"?["intra-bond"]:void 0},color:m,colorParams:{carbonColor:{name:"element-symbol",params:{}},...h}},{tag:"lipid"}),coarse:u.buildRepresentation(l,o.coarse,{type:"spacefill",typeParams:c,color:m||"chain-id",colorParams:h},{tag:"coarse"})};return await l.commit({revertOnError:!1}),await e0(r,i,t.theme?.focus?.name,t.theme?.focus?.params),{components:o,representations:g}}},tft={id:"preset-structure-representation-protein-and-nucleic",display:{name:"Protein & Nucleic",group:RD,description:"Shows proteins as Cartoon and RNA/DNA as Gaussian Surface."},params:()=>kb,async apply(e,t,r){let n=ci.resolveAndCheck(r.state.data,e);if(!n)return{};let o={protein:await rRe(r,n,"protein"),nucleic:await rRe(r,n,"nucleic")},i=n.obj.data,a={radiusOffset:i.isCoarseGrained?2:0,smoothness:i.isCoarseGrained?1:1.5},{update:s,builder:l,typeParams:u,symmetryColor:c,symmetryColorParams:m}=$C(r,t,i),d={protein:l.buildRepresentation(s,o.protein,{type:"cartoon",typeParams:u,color:c,colorParams:m},{tag:"protein"}),nucleic:l.buildRepresentation(s,o.nucleic,{type:"gaussian-surface",typeParams:{...u,...a},color:c,colorParams:m},{tag:"nucleic"})};return await s.commit({revertOnError:!0}),await e0(r,i,t.theme?.focus?.name,t.theme?.focus?.params),{components:o,representations:d}}},oRe={id:"preset-structure-representation-coarse-surface",display:{name:"Coarse Surface",group:RD,description:"Shows polymers and lipids as coarse Gaussian Surface."},params:()=>kb,async apply(e,t,r){let n=ci.resolveAndCheck(r.state.data,e);if(!n)return{};let o={polymer:await Sc(r,n,"polymer"),lipid:await Sc(r,n,"lipid")},i=n.obj.data,a=r.config.get(Lr.Structure.SizeThresholds)||De.DefaultSizeThresholds,s=De.getSize(i,a),l=Object.create(null);s===De.Size.Gigantic?Object.assign(l,{traceOnly:!i.isCoarseGrained,radiusOffset:2,smoothness:1,visuals:["structure-gaussian-surface-mesh"]}):s===De.Size.Huge?Object.assign(l,{radiusOffset:i.isCoarseGrained?2:0,smoothness:1}):i.isCoarseGrained&&Object.assign(l,{radiusOffset:2,smoothness:1});let{update:u,builder:c,typeParams:m,symmetryColor:d,symmetryColorParams:p}=$C(r,t,i),h={polymer:c.buildRepresentation(u,o.polymer,{type:"gaussian-surface",typeParams:{...m,...l},color:d,colorParams:p},{tag:"polymer"}),lipid:c.buildRepresentation(u,o.lipid,{type:"gaussian-surface",typeParams:{...m,...l},color:d,colorParams:p},{tag:"lipid"})};return await u.commit({revertOnError:!0}),await e0(r,i,t.theme?.focus?.name,t.theme?.focus?.params),{components:o,representations:h}}},iRe={id:"preset-structure-representation-polymer-cartoon",display:{name:"Polymer Cartoon",group:RD,description:"Shows polymers as Cartoon."},params:()=>kb,async apply(e,t,r){let n=ci.resolveAndCheck(r.state.data,e);if(!n)return{};let o={polymer:await Sc(r,n,"polymer")},i=n.obj.data,{update:a,builder:s,typeParams:l,symmetryColor:u,symmetryColorParams:c}=$C(r,t,i),m={polymer:s.buildRepresentation(a,o.polymer,{type:"cartoon",typeParams:l,color:u,colorParams:c},{tag:"polymer"})};return await a.commit({revertOnError:!0}),await e0(r,i,t.theme?.focus?.name,t.theme?.focus?.params),{components:o,representations:m}}},aRe={id:"preset-structure-representation-atomic-detail",display:{name:"Atomic Detail",group:RD,description:"Shows everything in atomic detail."},params:()=>({...kb,showCarbohydrateSymbol:C.Boolean(!1)}),async apply(e,t,r){let n=ci.resolveAndCheck(r.state.data,e);if(!n)return{};let o={all:await Sc(r,n,"all"),branched:void 0},i=n.obj.data,a=i.elementCount>1e5,s=i.elementCount>1e6,l=i.units.length>5e3,u=i.atomicResidueCount&&i.elementCount>1e3&&i.atomicResidueCount/i.elementCount<3,c=i.models[0],m=!!Xo.Provider.get(c)||jc.isExhaustive(c),d="ball-and-stick";i.isCoarseGrained||l?d=s?"point":"spacefill":u&&!m?d="spacefill":a&&(d="line");let p=t.showCarbohydrateSymbol&&!a&&!u;p&&Object.assign(o,{branched:await Sc(r,n,"branched",{label:"Carbohydrate"})});let{update:h,builder:f,typeParams:g,color:y,ballAndStickColor:x,globalColorParams:S}=$C(r,t,i),I=u&&!m?{carbonColor:{name:"element-symbol",params:{}},...S}:x,v={all:f.buildRepresentation(h,o.all,{type:d,typeParams:g,color:y,colorParams:I},{tag:"all"})};return p&&Object.assign(v,{snfg3d:f.buildRepresentation(h,o.branched,{type:"carbohydrate",typeParams:{...g,alpha:.4,visuals:["carbohydrate-symbol"]},color:y,colorParams:S},{tag:"snfg-3d"})}),await h.commit({revertOnError:!0}),await e0(r,i,t.theme?.focus?.name??y,t.theme?.focus?.params??I),{components:o,representations:v}}},rft={id:"preset-structure-representation-illustrative",display:{name:"Illustrative",group:"Miscellaneous",description:"Show everything in spacefill representation with illustrative colors and ignore light."},params:()=>kb,async apply(e,t,r){let n=ci.resolveAndCheck(r.state.data,e);if(!n)return{};let o={all:await Sc(r,n,"all"),branched:void 0},i=n.obj.data,{update:a,builder:s,typeParams:l,color:u}=$C(r,t,i),c={all:s.buildRepresentation(a,o.all,{type:"spacefill",typeParams:{...l,ignoreLight:!0},color:"illustrative",colorParams:{style:{name:"entity-id",params:{overrideWater:!0}}}},{tag:"all"})};return await a.commit({revertOnError:!0}),await e0(r,i,t.theme?.focus?.name??u,t.theme?.focus?.params),{components:o,representations:c}}},nft={id:"preset-structure-representation-molecular-surface",display:{name:"Molecular Surface",group:"Miscellaneous",description:"Show everything in molecular surface representation with illustrative colors."},params:()=>kb,async apply(e,t,r){let n=ci.resolveAndCheck(r.state.data,e);if(!n)return{};let o={all:await Sc(r,n,"all"),branched:void 0},i=n.obj.data,{update:a,builder:s,typeParams:l,color:u}=$C(r,t,i),c={all:s.buildRepresentation(a,o.all,{type:"molecular-surface",typeParams:l,color:"entity-id",colorParams:{overrideWater:!0}},{tag:"all"})};return await a.commit({revertOnError:!0}),await e0(r,i,t.theme?.focus?.name??u,t.theme?.focus?.params),{components:o,representations:c}}},oft={id:"preset-structure-representation-auto-lod",display:{name:"Automatic Detail",group:"Miscellaneous",description:"Shows more (or less) detailed representations automatically based on camera distance."},params:()=>kb,async apply(e,t,r){let n=ci.resolveAndCheck(r.state.data,e);if(!n)return{};let o={all:await Sc(r,n,"all")},i=n.obj.data,{update:a,builder:s,typeParams:l,color:u,symmetryColor:c,symmetryColorParams:m,ballAndStickColor:d}=$C(r,t,i),p={gaussianSurface:s.buildRepresentation(a,o.all,{type:"gaussian-surface",typeParams:{...l,lod:b.create(30,1e7,100)},color:c,colorParams:m},{tag:"gaussian-surface"}),cartoon:s.buildRepresentation(a,o.all,{type:"cartoon",typeParams:{...l,lod:b.create(-20,300,100)},color:c,colorParams:m},{tag:"cartoon"}),ballAndStick:s.buildRepresentation(a,o.all,{type:"ball-and-stick",typeParams:{...l,lod:b.create(-20,40,20)},color:u,colorParams:d},{tag:"ball-and-stick"})};return await a.commit({revertOnError:!1}),await e0(r,i,t.theme?.focus?.name,t.theme?.focus?.params),{components:o,representations:p}}};function Sc(e,t,r,n){return e.builders.structure.tryCreateComponentStatic(t,r,n)}function rRe(e,t,r,n){return e.builders.structure.tryCreateComponentFromSelection(t,oi[r],`selection-${r}`,n)}var bu={empty:eft,auto:$pt,"atomic-detail":aRe,"polymer-cartoon":iRe,"polymer-and-ligand":nRe,"protein-and-nucleic":tft,"coarse-surface":oRe,illustrative:rft,"molecular-surface":nft,"auto-lod":oft};var Km="Trajectory";function bh(e,t){return e.builders.structure.hierarchy.applyPreset(t.trajectory,"default")}var ift={label:"mmCIF",description:"mmCIF",category:Km,stringExtensions:["cif","mmcif","mcif"],binaryExtensions:["bcif"],isApplicable:(e,t)=>e.ext==="mmcif"||e.ext==="mcif"?!0:e.ext==="cif"||e.ext==="bcif"?ZA(e,t)===-1:!1,parse:async(e,t,r)=>{let o=e.state.data.build().to(t).apply(Qe.Data.ParseCif,void 0,{state:{isGhost:!0}}),i=await o.apply(Qe.Model.TrajectoryFromMmCif,void 0,{tags:r?.trajectoryTags}).commit({revertOnError:!0});return(o.selector.cell?.obj?.data.blocks.length||0)>1&&e.state.data.updateCellState(o.ref,{isGhost:!1}),{trajectory:i}},visuals:bh},aft={label:"cifCore",description:"CIF Core",category:Km,stringExtensions:["cif"],isApplicable:(e,t)=>e.ext==="cif"?ZA(e,t)==="coreCif":!1,parse:async(e,t,r)=>{let o=e.state.data.build().to(t).apply(Qe.Data.ParseCif,void 0,{state:{isGhost:!0}}),i=await o.apply(Qe.Model.TrajectoryFromCifCore,void 0,{tags:r?.trajectoryTags}).commit({revertOnError:!0});return(o.selector.cell?.obj?.data.blocks.length||0)>1&&e.state.data.updateCellState(o.ref,{isGhost:!1}),{trajectory:i}},visuals:bh};function Fb(e,t){return async(r,n,o)=>({trajectory:await r.state.data.build().to(n).apply(e,t,{tags:o?.trajectoryTags}).commit({revertOnError:!0})})}var sft={label:"PDB",description:"PDB",category:Km,stringExtensions:["pdb","ent"],parse:Fb(Qe.Model.TrajectoryFromPDB),visuals:bh},lft={label:"PDBQT",description:"PDBQT",category:Km,stringExtensions:["pdbqt"],parse:Fb(Qe.Model.TrajectoryFromPDB,{isPdbqt:!0}),visuals:bh},uft={label:"XYZ",description:"XYZ",category:Km,stringExtensions:["xyz"],parse:Fb(Qe.Model.TrajectoryFromXYZ),visuals:bh},cft={label:"Lammps Data",description:"Lammps Data",category:Km,stringExtensions:["data"],parse:Fb(Qe.Model.TrajectoryFromLammpsData),visuals:bh},mft={label:"Lammps Trajectory Data",description:"Lammps Trajectory Data",category:Km,stringExtensions:["lammpstrj"],parse:Fb(Qe.Model.TrajectoryFromLammpsTrajData),visuals:bh},dft={label:"GRO",description:"GRO",category:Km,stringExtensions:["gro"],binaryExtensions:[],parse:Fb(Qe.Model.TrajectoryFromGRO),visuals:bh},pft={label:"MOL",description:"MOL",category:Km,stringExtensions:["mol"],parse:Fb(Qe.Model.TrajectoryFromMOL),visuals:bh},fft={label:"SDF",description:"SDF",category:Km,stringExtensions:["sdf","sd"],parse:Fb(Qe.Model.TrajectoryFromSDF),visuals:bh},hft={label:"MOL2",description:"MOL2",category:Km,stringExtensions:["mol2"],parse:Fb(Qe.Model.TrajectoryFromMOL2),visuals:bh},$V=[["mmcif",ift],["cifCore",aft],["pdb",sft],["pdbqt",lft],["gro",dft],["xyz",uft],["lammps_data",cft],["lammps_traj_data",mft],["mol",pft],["sdf",fft],["mol2",hft]];var gft=["gz","zip"];function Lb(e){let t=e,r="",n=t.lastIndexOf("?"),o=n!==-1?t.substring(n):"";t=t.substring(0,n===-1?t.length:n);let i=t.replace(/^.*[\\/]/,""),a=i.substring(0,i.lastIndexOf(".")),s=i.split("."),l=s.length>1?(s.pop()||"").toLowerCase():"",u=t.match(/^(.+):\/\/(.+)$/);u&&(r=u[1].toLowerCase(),t=u[2]||"");let c=t.substring(0,t.lastIndexOf("/")+1);if(gft.includes(l)){let m=t.length-l.length-1;l=(t.substring(0,m).split(".").pop()||"").toLowerCase();let d=a.length-l.length-1;a=a.substring(0,d)}return{path:t,name:i,ext:l,base:a,dir:c,protocol:r,query:o}}var RT="Topology";var yft={label:"PSF",description:"PSF",category:RT,stringExtensions:["psf"],parse:async(e,t)=>{let r=e.state.data.build().to(t).apply(Qe.Data.ParsePsf,{},{state:{isGhost:!0}}),n=r.apply(Qe.Model.TopologyFromPsf);return await r.commit(),{format:r.selector,topology:n.selector}}};var bft={label:"PRMTOP",description:"PRMTOP",category:RT,stringExtensions:["prmtop","parm7"],parse:async(e,t)=>{let r=e.state.data.build().to(t).apply(Qe.Data.ParsePrmtop,{},{state:{isGhost:!0}}),n=r.apply(Qe.Model.TopologyFromPrmtop);return await r.commit(),{format:r.selector,topology:n.selector}}};var xft={label:"TOP",description:"TOP",category:RT,stringExtensions:["top"],parse:async(e,t)=>{let r=e.state.data.build().to(t).apply(Qe.Data.ParseTop,{},{state:{isGhost:!0}}),n=r.apply(Qe.Model.TopologyFromTop);return await r.commit(),{format:r.selector,topology:n.selector}}},sRe=[["psf",yft],["prmtop",bft],["top",xft]];var t0="Coordinates";var Cft={label:"DCD",description:"DCD",category:t0,binaryExtensions:["dcd"],parse:(e,t)=>e.state.data.build().to(t).apply(Qe.Model.CoordinatesFromDcd).commit()};var Sft={label:"XTC",description:"XTC",category:t0,binaryExtensions:["xtc"],parse:(e,t)=>e.state.data.build().to(t).apply(Qe.Model.CoordinatesFromXtc).commit()};var vft={label:"TRR",description:"TRR",category:t0,binaryExtensions:["trr"],parse:(e,t)=>e.state.data.build().to(t).apply(Qe.Model.CoordinatesFromTrr).commit()};var Ift={label:"NCTRAJ",description:"NCTRAJ",category:t0,binaryExtensions:["nc","nctraj"],parse:(e,t)=>e.state.data.build().to(t).apply(Qe.Model.CoordinatesFromNctraj).commit()};var Aft={label:"LAMMPSTRAJ",description:"LAMMPSTRAJ",category:t0,stringExtensions:["lammpstrj"],parse:(e,t)=>e.state.data.build().to(t).apply(Qe.Model.CoordinatesFromLammpstraj).commit()},lRe=[["dcd",Cft],["xtc",Sft],["trr",vft],["nctraj",Ift],["lammpstrj",Aft]];var Tft=e=>{let t=e.config.get(Lr.Structure.DefaultRepresentationPreset)||bu.auto.id;return C.Group({type:hb.getParams(void 0,"auto").type,representation:C.Select(t,e.builders.structure.representation.getPresets().map(r=>[r.id,r.display.name,r.display.group]),{description:"Which representation preset to use."}),representationParams:C.Group(Zg.CommonParams,{isHidden:!0}),asTrajectory:C.Optional(C.Boolean(!1,{description:"Load all entries into a single trajectory."}))},{isExpanded:!1})},uRe={rcsb:C.Group({encoding:C.Select("bcif",C.arrayToOptions(["cif","bcif"]))},{label:"RCSB PDB",isFlat:!0}),pdbe:C.Group({variant:C.Select("updated-bcif",[["updated-bcif","Updated (bcif)"],["updated","Updated"],["archival","Archival"]])},{label:"PDBe",isFlat:!0}),pdbj:C.EmptyGroup({label:"PDBj"})};var Pft=Gs.build({from:ne.Root,display:{name:"Download Structure",description:"Load a structure from the provided source and create its representation."},params:(e,t)=>{let r=Tft(t),n=t.config.get(Lr.Download.DefaultPdbProvider)||"pdbe";return{source:C.MappedStatic("pdb",{pdb:C.Group({provider:C.Group({id:C.Text("1tqn",{label:"PDB Id(s)",description:"One or more comma/space separated PDB ids."}),server:C.MappedStatic(n,uRe)},{pivot:"id"}),options:r},{isFlat:!0,label:"PDB"}),"pdb-ihm":C.Group({provider:C.Group({id:C.Text("8zzc",{label:"PDB-IHM Id(s)",description:"One or more comma/space separated ids."}),encoding:C.Select("bcif",C.arrayToOptions(["cif","bcif"]))},{pivot:"id"}),options:r},{isFlat:!0,label:"PDB-IHM"}),swissmodel:C.Group({id:C.Text("Q9Y2I8",{label:"UniProtKB AC(s)",description:"One or more comma/space separated ACs."}),options:r},{isFlat:!0,label:"SWISS-MODEL",description:"Loads the best homology model or experimental structure"}),alphafolddb:C.Group({provider:C.Group({id:C.Text("Q8W3K0",{label:"UniProtKB AC(s)",description:"One or more comma/space separated ACs."}),encoding:C.Select("bcif",C.arrayToOptions(["cif","bcif"]))},{pivot:"id"}),options:r},{isFlat:!0,label:"AlphaFold DB",description:"Loads the predicted model if available"}),modelarchive:C.Group({id:C.Text("ma-bak-cepc-0003",{label:"Accession Code(s)",description:"One or more comma/space separated ACs."}),options:r},{isFlat:!0,label:"Model Archive"}),pubchem:C.Group({id:C.Text("2244,2245",{label:"PubChem ID",description:"One or more comma/space separated IDs."}),options:r},{isFlat:!0,label:"PubChem",description:"Loads 3D conformer from PubChem."}),url:C.Group({url:C.Url(""),format:C.Select("mmcif",C.arrayToOptions($V.map(o=>o[0]),o=>o)),isBinary:C.Boolean(!1),label:C.Optional(C.Text("")),options:r},{isFlat:!0,label:"URL"})})}}})(({params:e,state:t},r)=>Ae.create("Download Structure",async n=>{r.behaviors.layout.leftPanelTabName.next("data");let o=e.source,i,a=!1,s="mmcif";switch(o.name){case"url":i=[{url:o.params.url,isBinary:o.params.isBinary,label:o.params.label||void 0}],s=o.params.format;break;case"pdb":i=await(o.params.provider.server.name==="pdbe"?_ft(o):o.params.provider.server.name==="pdbj"?Rft(o):o.params.provider.server.name==="rcsb"?Dft(o):Mr(o)),a=!!o.params.options.asTrajectory;break;case"pdb-ihm":let m=d=>d.startsWith("PDBDEV_")?d:`PDBDEV_${d.padStart(8,"0")}`;i=await xh(o.params.provider.id,d=>{if(d.match(/^[1-9][A-Z0-9]{3}$/i)!==null)return o.params.provider.encoding==="bcif"?`https://pdb-ihm.org/bcif/${d.toLowerCase()}.bcif`:`https://pdb-ihm.org/cif/${d.toLowerCase()}.cif`;let p=m(d.toUpperCase());return o.params.provider.encoding==="bcif"?`https://pdb-ihm.org/bcif/${p}.bcif`:`https://pdb-ihm.org/cif/${p}.cif`},d=>{let p=d.toUpperCase();return p.match(/^[1-9][A-Z0-9]{3}$/)?`PDB-IHM: ${p}`:m(p)},o.params.provider.encoding==="bcif"),a=!!o.params.options.asTrajectory;break;case"swissmodel":i=await xh(o.params.id,d=>`https://swissmodel.expasy.org/repository/uniprot/${d.toUpperCase()}.pdb`,d=>`SWISS-MODEL: ${d}`,!1),a=!!o.params.options.asTrajectory,s="pdb";break;case"alphafolddb":i=await xh(o.params.provider.id,async d=>{let p=`https://www.alphafold.ebi.ac.uk/api/prediction/${d.toUpperCase()}`,h=await r.runTask(r.fetch({url:p,type:"json"}));if(Array.isArray(h)&&h.length>0){let f=o.params.provider.encoding==="bcif"?"bcifUrl":"cifUrl";return h[0][f]}throw new Error(`No AlphaFold DB entry for '${d}'`)},d=>`AlphaFold DB: ${d}`,o.params.provider.encoding==="bcif"),a=!!o.params.options.asTrajectory,s="mmcif";break;case"modelarchive":i=await xh(o.params.id,d=>`https://www.modelarchive.org/doi/10.5452/${d.toLowerCase()}.cif`,d=>`Model Archive: ${d}`,!1),a=!!o.params.options.asTrajectory,s="mmcif";break;case"pubchem":i=await xh(o.params.id,d=>`https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/CID/${d.trim()}/record/SDF/?record_type=3d`,d=>`PubChem: ${d}`,!1),a=!!o.params.options.asTrajectory,s="mol";break;default:Mr(o)}let l=e.source.params.options.representation||r.config.get(Lr.Structure.DefaultRepresentationPreset)||bu.auto.id,u=l!==bu.empty.id,c=o.params.options.type.name==="auto"?void 0:o.params.options.type;await t.transaction(async()=>{if(i.length>0&&a){let m=await r.builders.data.downloadBlob({sources:i.map((p,h)=>({id:""+h,url:p.url,isBinary:p.isBinary})),maxConcurrency:6},{state:{isGhost:!0}}),d=await r.builders.structure.parseTrajectory(m,{formats:i.map((p,h)=>({id:""+h,format:"cif"}))});await r.builders.structure.hierarchy.applyPreset(d,"default",{structure:c,showUnitcell:u,representationPreset:l,representationPresetParams:e.source.params.options.representationParams})}else for(let m of i){let d=await r.builders.data.download(m,{state:{isGhost:!0}}),p=r.dataFormats.get(s);if(!p)throw new Error("unknown file format");let h=await r.builders.structure.parseTrajectory(d,p);await r.builders.structure.hierarchy.applyPreset(h,"default",{structure:c,showUnitcell:u,representationPreset:l,representationPresetParams:e.source.params.options.representationParams})}}).runInContext(n)}));async function xh(e,t,r,n){let o=e.split(/[,\s]/).map(a=>a.trim()).filter(a=>!!a&&(a.length>=4||/^[1-9][0-9]*$/.test(a))),i=[];for(let a of o)i.push({url:sn.Url(await t(a)),isBinary:n,label:r(a)});return i}async function _ft(e){if(e.name!=="pdb"||e.params.provider.server.name!=="pdbe")throw new Error("expected pdbe");return e.params.provider.server.params.variant==="updated"?xh(e.params.provider.id,t=>`https://www.ebi.ac.uk/pdbe/static/entry/${t.toLowerCase()}_updated.cif`,t=>`PDBe: ${t} (updated cif)`,!1):e.params.provider.server.params.variant==="updated-bcif"?xh(e.params.provider.id,t=>`https://www.ebi.ac.uk/pdbe/entry-files/download/${t.toLowerCase()}.bcif`,t=>`PDBe: ${t} (updated cif)`,!0):xh(e.params.provider.id,t=>`https://www.ebi.ac.uk/pdbe/static/entry/${t.toLowerCase()}.cif`,t=>`PDBe: ${t} (cif)`,!1)}async function Rft(e){if(e.name!=="pdb"||e.params.provider.server.name!=="pdbj")throw new Error("expected pdbj");return xh(e.params.provider.id,t=>`https://data.pdbjlc1.pdbj.org/pub/pdb/data/structures/divided/mmCIF/${t.toLowerCase().substring(1,3)}/${t.toLowerCase()}.cif`,t=>`PDBj: ${t} (cif)`,!1)}async function Dft(e){if(e.name!=="pdb"||e.params.provider.server.name!=="rcsb")throw new Error("expected rcsb");return e.params.provider.server.params.encoding==="cif"?xh(e.params.provider.id,t=>`https://files.rcsb.org/download/${t.toUpperCase()}.cif`,t=>`RCSB PDB: ${t} (cif)`,!1):xh(e.params.provider.id,t=>`https://models.rcsb.org/${t.toUpperCase()}.bcif`,t=>`RCSB PDB: ${t} (bcif)`,!0)}var DD=Gs.build({display:{name:"Update Trajectory"},params:{action:C.Select("advance",C.arrayToOptions(["advance","reset"])),by:C.Optional(C.Numeric(1,{min:-1,max:1,step:1}))}})(({params:e,state:t})=>{let r=t.selectQ(o=>o.ofTransformer(Qe.Model.ModelFromTrajectory)),n=t.build();if(e.action==="reset")for(let o of r)n.to(o).update({modelIndex:0});else for(let o of r){let i=tr.findAncestorOfType(t.tree,t.cells,o.transform.ref,ne.Molecule.Trajectory);if(!i||!i.obj)continue;let a=i.obj;n.to(o).update(s=>{let l=(s.modelIndex+e.by)%a.data.frameCount;return l<0&&(l+=a.data.frameCount),{modelIndex:l}})}return t.updateTree(n)}),wft=Gs.build({display:{name:"Custom Model Properties",description:"Enable parameters for custom properties of the model."},from:ne.Molecule.Model,params(e,t){return t.customModelProperties.getParams(e?.data)},isApplicable(e,t,r){return t.transformer!==RR}})(({ref:e,params:t},r)=>r.builders.structure.insertModelProperties(e,t)),Mft=Gs.build({display:{name:"Custom Structure Properties",description:"Enable parameters for custom properties of the structure."},from:ne.Molecule.Structure,params(e,t){return t.customStructureProperties.getParams(e?.data)},isApplicable(e,t,r){return t.transformer!==DR}})(({ref:e,params:t},r)=>r.builders.structure.insertStructureProperties(e,t)),Bft=Gs.build({display:{name:"Add Trajectory",description:"Add trajectory from existing model/topology and coordinates."},from:ne.Root,params(e,t){let r=t.state.data,o=[...r.selectQ(s=>s.rootsOfType(ne.Molecule.Model)),...r.selectQ(s=>s.rootsOfType(ne.Molecule.Topology))].map(s=>[s.transform.ref,s.obj.label]),a=r.selectQ(s=>s.rootsOfType(ne.Molecule.Coordinates)).map(s=>[s.transform.ref,s.obj.label]);return{model:C.Select(o.length?o[0][0]:"",o),coordinates:C.Select(a.length?a[0][0]:"",a)}}})(({params:e,state:t},r)=>Ae.create("Add Trajectory",n=>t.transaction(async()=>{let o=[e.model,e.coordinates],i=t.build().toRoot().apply(kF,{modelRef:e.model,coordinatesRef:e.coordinates},{dependsOn:o}).apply(Qe.Model.ModelFromTrajectory,{modelIndex:0});await t.updateTree(i).runInContext(n);let a=await r.builders.structure.createStructure(i.selector);await r.builders.structure.representation.applyPreset(a,"auto")}).runInContext(n))),Eft=Gs.build({display:{name:"Load Trajectory",description:"Load trajectory of model/topology and coordinates from URL or file."},from:ne.Root,params(e,t){let{options:r}=t.dataFormats,n=r.filter(s=>s[2]===Km||s[2]===RT),o=r.filter(s=>s[2]===t0),i=[],a=[];for(let{provider:s}of t.dataFormats.list)s.category===Km||s.category===RT?(s.binaryExtensions&&i.push(...s.binaryExtensions),s.stringExtensions&&i.push(...s.stringExtensions)):s.category===t0&&(s.binaryExtensions&&a.push(...s.binaryExtensions),s.stringExtensions&&a.push(...s.stringExtensions));return{source:C.MappedStatic("file",{url:C.Group({model:C.Group({url:C.Url(""),format:C.Select(n[0][0],n),isBinary:C.Boolean(!1)},{isExpanded:!0}),coordinates:C.Group({url:C.Url(""),format:C.Select(o[0][0],o)},{isExpanded:!0})},{isFlat:!0}),file:C.Group({model:C.File({accept:i.map(s=>`.${s}`).join(","),label:"Model"}),coordinates:C.File({accept:a.map(s=>`.${s}`).join(","),label:"Coordinates"})},{isFlat:!0})},{options:[["url","URL"],["file","File"]]})}}})(({params:e,state:t},r)=>Ae.create("Load Trajectory",n=>t.transaction(async()=>{let o=e.source;if(o.name==="file"&&(o.params.model===null||o.params.coordinates===null)){r.log.error("No file(s) selected");return}if(o.name==="url"&&(!o.params.model||!o.params.coordinates)){r.log.error("No URL(s) given");return}let i=async(s,l,u)=>{let c=await r.builders.data.download({url:s,isBinary:u}),m=r.dataFormats.get(l);if(!m){r.log.warn(`LoadTrajectory: could not find data provider for '${l}'`);return}return m.parse(r,c)},a=async s=>{if(!s)throw new Error("No file selected");let l=Lb(s.file?.name??""),u=r.dataFormats.binaryExtensions.has(l.ext),{data:c}=await r.builders.data.readFile({file:s,isBinary:u}),m=r.dataFormats.auto(l,c.cell?.obj);if(!m){r.log.warn(`LoadTrajectory: could not find data provider for '${l.ext}'`),await r.state.data.build().delete(c).commit();return}return m.parse(r,c)};try{let s=o.name==="url"?await i(o.params.model.url,o.params.model.format,o.params.model.isBinary):await a(o.params.model),l;"trajectory"in s?l=await t.build().to(s.trajectory).apply(_R,{modelIndex:0}).commit():l=s.topology;let u=o.name==="url"?await i(o.params.coordinates.url,o.params.coordinates.format,!0):await a(o.params.coordinates),c=[l.ref,u.ref],m=t.build().toRoot().apply(kF,{modelRef:l.ref,coordinatesRef:u.ref},{dependsOn:c}).apply(Qe.Model.ModelFromTrajectory,{modelIndex:0});await t.updateTree(m).runInContext(n);let d=await r.builders.structure.createStructure(m.selector);await r.builders.structure.representation.applyPreset(d,"auto")}catch(s){console.error(s),r.log.error("Error loading trajectory")}}).runInContext(n)));var _i=_t(Mi());var ZZ=_t(Mi());var Ds=_t(ur()),Rr=class extends ZZ.PureComponent{constructor(){super(...arguments);this.hide=()=>this.props.onSelect(void 0)}render(){let r=this.props,n=(0,Ds.jsx)(XZ,{items:r.items,onSelect:r.onSelect,current:r.current,multiselect:this.props.multiselect,noOffset:this.props.noOffset,noAccent:this.props.noAccent});return(0,Ds.jsxs)("div",{className:`msp-action-menu-options${r.header?"":" msp-action-menu-options-no-header"}`,children:[r.header&&(0,Ds.jsx)(zl,{header:r.header,title:r.title,initialExpanded:!0,hideExpander:!0,hideOffset:!0,onHeaderClick:this.hide,topRightIcon:Bc,children:n}),!r.header&&n]})}};(l=>{function e(u,c){return c?{kind:"header",label:u,...c}:{kind:"header",label:u}}l.Header=e;function t(u,c,m){return{kind:"item",label:u,value:c,...m}}l.Item=t;function r(u,c){let{label:m,value:d,category:p,selected:h,icon:f,addOn:g,description:y}=c||{},x,S=[];for(let I=0;I<u.length;I++){let v=u[I];if(c?.filter&&!c.filter(v))continue;let A=p?.(v),P=m?m(v):""+v,T=d?d(v):v,R=y?y(v):typeof v=="string"?v:void 0,w;A?(x||(x=new Map),w=x.get(A),w||(w=[l.Header(A,{description:A})],x.set(A,w),S.push(w))):w=S;let E=g?.(v);w.push({kind:"item",label:P,value:T,icon:f?f(v):void 0,selected:h?h(v):void 0,addOn:E,description:R})}return S}l.createItems=r;let n={value:u=>u[0],label:u=>u[1],category:u=>u[2]};function o(u,c){return r(u,c?{...n,...c}:n)}l.createItemsFromSelectOptions=o;function i(u){if(Vb(u))return!1;if(DT(u))return!!u.selected;for(let c of u)if(i(c))return!0;return!1}l.hasSelectedItem=i;function a(u,c){if(!Vb(u)){if(DT(u))return u.value===c?u:void 0;for(let m of u){let d=a(m,c);if(d)return d}}}l.findItem=a;function s(u){if(!Vb(u)){if(DT(u))return u;for(let c of u){let m=s(c);if(m)return m}}}l.getFirstItem=s})(Rr||={});var XZ=class e extends ZZ.PureComponent{constructor(){super(...arguments);this.state=e.createState(this.props);this.toggleExpanded=r=>{this.setState({isExpanded:!this.state.isExpanded}),r.currentTarget.blur()};this.selectAll=()=>{let r=QZ(this.props.items,[]).filter(n=>!n.selected);this.props.onSelect(r)};this.selectNone=()=>{let r=QZ(this.props.items,[]).filter(n=>!!n.selected);this.props.onSelect(r)}}static createState(r,n){let o=WZ(r.items)&&Vb(r.items[0])?r.items[0]:void 0,i=o?.isIndependent?!1:r.multiselect?Rr.hasSelectedItem(r.items):!!r.current&&!!Rr.findItem(r.items,r.current.value)||Rr.hasSelectedItem(r.items);return{header:o,hasCurrent:i,isExpanded:i||(n??!!o?.initiallyExpanded)}}componentDidUpdate(r){if(this.props.items!==r.items||this.props.current!==r.current){let n=WZ(this.props.items)&&WZ(r.items)&&Vb(this.props.items[0])&&Vb(r.items[0])&&this.props.items[0].label===r.items[0].label?this.state.isExpanded:void 0;this.setState(e.createState(this.props,n))}}get multiselectHeader(){let{header:r,hasCurrent:n}=this.state;return(0,Ds.jsxs)("div",{className:"msp-flex-row msp-control-group-header",children:[(0,Ds.jsx)(gr,{icon:this.state.isExpanded?ec:tc,flex:!0,noOverflow:!0,onClick:this.toggleExpanded,title:`Click to ${this.state.isExpanded?"collapse":"expand"}.${r?.description?` ${r?.description}`:""}`,children:n?(0,Ds.jsx)("b",{children:r?.label}):r?.label}),(0,Ds.jsx)(gr,{icon:cd,flex:!0,onClick:this.selectAll,style:{flex:"0 0 50px",textAlign:"right"},children:"All"}),(0,Ds.jsx)(gr,{icon:Bc,flex:!0,onClick:this.selectNone,style:{flex:"0 0 50px",textAlign:"right"},children:"None"})]})}get basicHeader(){let{header:r,hasCurrent:n}=this.state;return(0,Ds.jsx)("div",{className:"msp-control-group-header",style:{marginTop:"1px"},children:(0,Ds.jsx)(gr,{noOverflow:!0,icon:this.state.isExpanded?ec:tc,onClick:this.toggleExpanded,title:`Click to ${this.state.isExpanded?"collapse":"expand"}. ${r?.description?r?.description:""}`,children:n?(0,Ds.jsx)("b",{children:r?.label}):r?.label})})}render(){let{items:r,onSelect:n,current:o}=this.props;if(Vb(r))return null;if(DT(r))return(0,Ds.jsx)(cRe,{item:r,onSelect:n,current:o,multiselect:this.props.multiselect});let{header:i}=this.state;return(0,Ds.jsxs)(Ds.Fragment,{children:[i&&(this.props.multiselect&&this.state.isExpanded?this.multiselectHeader:this.basicHeader),(0,Ds.jsx)("div",{className:this.props.noOffset?void 0:this.props.noAccent?"msp-control-offset":"msp-accent-offset",children:(!i||this.state.isExpanded)&&r.map((a,s)=>Vb(a)?null:DT(a)?(0,Ds.jsx)(cRe,{item:a,onSelect:n,current:o,multiselect:this.props.multiselect},s):(0,Ds.jsx)(e,{items:a,onSelect:n,current:o,multiselect:this.props.multiselect,noAccent:!0},s))})]})}},cRe=({item:e,onSelect:t,current:r,multiselect:n})=>{let o=r===e,i=e.addOn?{position:"relative"}:void 0;return(0,Ds.jsxs)(gr,{icon:e.icon,noOverflow:!0,className:"msp-action-menu-button",onClick:a=>t(n?[e]:e,a),disabled:e.disabled,style:i,title:e.description,children:[o||e.selected?(0,Ds.jsx)("b",{children:e.label}):e.label,e.addOn]})};function WZ(e){return!!e&&Array.isArray(e)}function DT(e){let t=e;return t&&t.kind==="item"}function Vb(e){let t=e;return t&&t.kind==="header"}function QZ(e,t){if(Vb(e))return t;if(DT(e))return t.push(e),t;for(let r of e)QZ(r,t);return t}var mRe=_t(Mi());var qZ=[["black",0],["gray",8421504],["white",16777215],["red",13840661],["orange",14840576],["yellow",16565248],["green",6863872],["cyan",1484197],["blue",40160],["purple",8086783],["magenta",16394495],["violet",8200583]];var Xs=_t(ur()),wT=class extends mRe.PureComponent{constructor(){super(...arguments);this.state={isExpanded:!!this.props.param.isExpanded||!!this.props.hideNameRow,lightness:0};this.toggleExpanded=r=>{this.setState({isExpanded:!this.state.isExpanded}),r.currentTarget.blur()};this.onClickSwatch=r=>{let n=Le.fromHexString(r.currentTarget.getAttribute("data-color")||"0");n!==this.props.value&&(this.props.param.isExpanded||this.setState({isExpanded:!1}),this.update(n))};this.onR=r=>{let[,n,o]=Le.toRgb(this.props.value),i=Le.fromRgb(r,n,o);i!==this.props.value&&this.update(i)};this.onG=r=>{let[n,,o]=Le.toRgb(this.props.value),i=Le.fromRgb(n,r,o);i!==this.props.value&&this.update(i)};this.onB=r=>{let[n,o]=Le.toRgb(this.props.value),i=Le.fromRgb(n,o,r);i!==this.props.value&&this.update(i)};this.onRGB=r=>{let n=Le.fromHexStyle(r.currentTarget.value||"0");n!==this.props.value&&this.update(n)};this.onLighten=()=>{this.update(Le.lighten(this.props.value,.1))};this.onDarken=()=>{this.update(Le.darken(this.props.value,.1))}}update(r){this.props.onChange({param:this.props.param,name:this.props.name,value:r})}swatch(){return(0,Xs.jsx)("div",{className:"msp-combined-color-swatch",children:qZ.map(r=>(0,Xs.jsx)(gr,{inline:!0,"data-color":r[1],onClick:this.onClickSwatch,style:{background:Le.toStyle(r[1])}},r[1]))})}render(){let r=this.props.param.label||Ks(this.props.name),[n,o,i]=Le.toRgb(this.props.value),a=(0,Xs.jsxs)(Xs.Fragment,{children:[this.swatch(),(0,Xs.jsx)(Hl,{label:"RGB",className:"msp-control-label-short",control:(0,Xs.jsxs)("div",{style:{display:"flex",textAlignLast:"center",left:"80px"},children:[(0,Xs.jsx)(Ec,{onChange:this.onR,numeric:!0,value:n,delayMs:250,style:{order:1,flex:"1 1 auto",minWidth:0},className:"msp-form-control",onEnter:this.props.onEnter,blurOnEnter:!0,blurOnEscape:!0}),(0,Xs.jsx)(Ec,{onChange:this.onG,numeric:!0,value:o,delayMs:250,style:{order:2,flex:"1 1 auto",minWidth:0},className:"msp-form-control",onEnter:this.props.onEnter,blurOnEnter:!0,blurOnEscape:!0}),(0,Xs.jsx)(Ec,{onChange:this.onB,numeric:!0,value:i,delayMs:250,style:{order:3,flex:"1 1 auto",minWidth:0},className:"msp-form-control",onEnter:this.props.onEnter,blurOnEnter:!0,blurOnEscape:!0}),(0,Xs.jsx)("input",{onInput:this.onRGB,type:"color",value:Le.toHexStyle(this.props.value),style:{order:4,flex:"1 1 auto",minWidth:"32px",width:"32px",height:"32px",padding:"0 2px 0 2px",background:"none",border:"none",cursor:"pointer"}})]})}),(0,Xs.jsxs)("div",{style:{display:"flex",textAlignLast:"center"},children:[(0,Xs.jsx)(gr,{onClick:this.onLighten,style:{order:1,flex:"1 1 auto",minWidth:0},className:"msp-form-control",children:"Lighten"}),(0,Xs.jsx)(gr,{onClick:this.onDarken,style:{order:1,flex:"1 1 auto",minWidth:0},className:"msp-form-control",children:"Darken"})]})]});return this.props.hideNameRow?a:(0,Xs.jsxs)(Xs.Fragment,{children:[(0,Xs.jsx)(Hl,{title:this.props.param.description,label:r,control:(0,Xs.jsx)(gr,{onClick:this.toggleExpanded,inline:!0,className:"msp-combined-color-button",style:{background:Le.toStyle(this.props.value)}})}),this.state.isExpanded&&(0,Xs.jsx)("div",{className:"msp-control-offset",children:a})]})}};var Vgn=(function(){let e=new Map;for(let t of qZ)e.set(t[1],t[0]);return e})();var JZ=_t(Mi()),qg=_t(ur());function dRe(e){switch(e.kind){case"scale-legend":return YZ;case"table-legend":return KZ;default:console.warn(`${e} has no associated UI component`);return}}var YZ=class extends JZ.PureComponent{render(){let{legend:t}=this.props,r=t.colors.map(n=>Array.isArray(n)?`${Le.toStyle(n[0])} ${100*n[1]}%`:Le.toStyle(n)).join(", ");return(0,qg.jsx)("div",{className:"msp-scale-legend",children:(0,qg.jsxs)("div",{style:{background:`linear-gradient(to right, ${r})`},children:[(0,qg.jsx)("span",{style:{float:"left"},children:t.minLabel}),(0,qg.jsx)("span",{style:{float:"right"},children:t.maxLabel})]})})}},KZ=class extends JZ.PureComponent{render(){let{legend:t}=this.props;return(0,qg.jsx)("div",{className:"msp-table-legend",children:t.table.map((r,n)=>{let[o,i]=r;return(0,qg.jsxs)("div",{children:[(0,qg.jsx)("div",{className:"msp-table-legend-color",style:{backgroundColor:Le.toStyle(i)}}),(0,qg.jsx)("div",{className:"msp-table-legend-text",children:o})]},n)})})}};var pRe=_t(Mi());var fRe=_t(ur()),eO=class extends pRe.Component{constructor(t){super(t),this.state={show:!1},this.handleHover=this.handleHover.bind(this),this.handleHoverOff=this.handleHoverOff.bind(this),this.deletePoint=this.deletePoint.bind(this)}handleHover(){this.setState({show:!0});let t=Ce.create(this.props.nX,this.props.nY);this.props.onmouseover(t)}handleHoverOff(){this.setState({show:!1}),this.props.onmouseover(void 0)}deletePoint(){this.props.delete(this.props.id)}render(){return[(0,fRe.jsx)("circle",{r:"10",id:`${this.props.id}`,cx:this.props.x,cy:this.props.y,onClick:this.props.onclick,onDoubleClick:this.props.delete(this.props.id),onMouseEnter:this.handleHover,onMouseLeave:this.handleHoverOff,onMouseDown:this.props.onmousedown,fill:"black"},`${this.props.id}circle`)]}};var rO=_t(Mi());var Yg=_t(ur()),tO=class extends rO.Component{constructor(r){super(r);this.handleKeyDown=r=>{};this.handleKeyUp=r=>{};this.handleClick=r=>n=>{};this.handleMouseDown=r=>n=>{if(r===0||r===this.state.points.length-1||this.state.canSelectMultiple)return;let o=this.normalizePoint(Ce.create(this.state.points[r][0],this.state.points[r][1]));this.ghostPoints.push(document.createElementNS(this.namespace,"circle")),this.ghostPoints[0].setAttribute("r","10"),this.ghostPoints[0].setAttribute("fill","orange"),this.ghostPoints[0].setAttribute("cx",`${o[0]}`),this.ghostPoints[0].setAttribute("cy",`${o[1]}`),this.ghostPoints[0].setAttribute("style","display: none"),this.gElement.appendChild(this.ghostPoints[0]),this.updatedX=o[0],this.updatedY=o[1],this.selected=[r]};this.deletePoint=r=>n=>{if(r===0||r===this.state.points.length-1)return;let o=this.state.points.filter((i,a)=>a!==r);o.sort((i,a)=>i[0]===a[0]?i[0]===0?i[1]-a[1]:i[1]===1?a[1]-i[1]:i[1]-a[1]:i[0]-a[0]),this.setState({points:o}),this.change(o),n.stopPropagation()};this.myRef=rO.createRef(),this.state={points:[Ce.create(0,0),Ce.create(1,0)],copyPoint:void 0,canSelectMultiple:!1},this.height=400,this.width=600,this.padding=70,this.selected=void 0,this.ghostPoints=[],this.namespace="http://www.w3.org/2000/svg";for(let n of this.props.data)this.state.points.push(n);this.state.points.sort((n,o)=>n[0]===o[0]?n[0]===0?n[1]-o[1]:n[1]===1?o[1]-n[1]:n[1]-o[1]:n[0]-o[0]),this.handleDrag=this.handleDrag.bind(this),this.handleMultipleDrag=this.handleMultipleDrag.bind(this),this.handleDoubleClick=this.handleDoubleClick.bind(this),this.refCallBack=this.refCallBack.bind(this),this.handlePointUpdate=this.handlePointUpdate.bind(this),this.change=this.change.bind(this),this.handleKeyUp=this.handleKeyUp.bind(this),this.handleLeave=this.handleLeave.bind(this),this.handleEnter=this.handleEnter.bind(this)}render(){let r=this.renderPoints(),n=this.renderLines(),o=this.renderHistogram();return[(0,Yg.jsx)("div",{children:(0,Yg.jsxs)("svg",{className:"msp-canvas",ref:this.refCallBack,viewBox:`0 0 ${this.width+this.padding} ${this.height+this.padding}`,onMouseMove:this.handleDrag,onMouseUp:this.handlePointUpdate,onMouseLeave:this.handleLeave,onMouseEnter:this.handleEnter,tabIndex:0,onKeyDown:this.handleKeyDown,onKeyUp:this.handleKeyUp,onDoubleClick:this.handleDoubleClick,children:[(0,Yg.jsxs)("g",{stroke:"black",fill:"black",children:[o,n,r]}),(0,Yg.jsx)("g",{className:"ghost-points",stroke:"black",fill:"black"})]})},"LineGraph"),(0,Yg.jsx)("div",{id:"modal-root"},"modal")]}componentDidMount(){this.gElement=document.getElementsByClassName("ghost-points")[0]}change(r){let n=r.slice();n.shift(),n.pop(),this.props.onChange(n)}handleDrag(r){if(this.selected===void 0)return;let n=this.myRef.createSVGPoint(),o,i=this.padding/2;n.x=r.clientX,n.y=r.clientY;let a=n.matrixTransform(this.myRef.getScreenCTM().inverse());o=Ce.create(a.x,a.y),(a.x<i||a.x>this.width+i)&&(a.y>this.height+i||a.y<i)?o=Ce.create(this.updatedX,this.updatedY):a.x<i?o=Ce.create(i,a.y):a.x>this.width+i?o=Ce.create(this.width+i,a.y):a.y>this.height+i?o=Ce.create(a.x,this.height+i):a.y<i?o=Ce.create(a.x,i):o=Ce.create(a.x,a.y),this.updatedX=o[0],this.updatedY=o[1];let s=this.unNormalizePoint(o);this.ghostPoints[0].setAttribute("style","display: visible"),this.ghostPoints[0].setAttribute("cx",`${o[0]}`),this.ghostPoints[0].setAttribute("cy",`${o[1]}`),this.props.onDrag(s)}handleMultipleDrag(){}handlePointUpdate(r){let n=this.selected;if(this.state.canSelectMultiple)return;if(n===void 0||n[0]===0||n[0]===this.state.points.length-1){this.setState({copyPoint:void 0});return}this.selected=void 0;let o=this.unNormalizePoint(Ce.create(this.updatedX,this.updatedY)),i=this.state.points.filter((a,s)=>s!==n[0]);i.push(o),i.sort((a,s)=>a[0]===s[0]?a[0]===0?a[1]-s[1]:a[1]===1?s[1]-a[1]:a[1]-s[1]:a[0]-s[0]),this.setState({points:i}),this.change(i),this.gElement.innerHTML="",this.ghostPoints=[],document.removeEventListener("mousemove",this.handleDrag,!0),document.removeEventListener("mouseup",this.handlePointUpdate,!0)}handleDoubleClick(r){let n=this.myRef.createSVGPoint();n.x=r.clientX,n.y=r.clientY;let o=n.matrixTransform(this.myRef.getScreenCTM().inverse()),i=this.state.points,a=this.padding/2;if(o.x<a||o.x>this.width+a||o.y>this.height+a||o.y<this.padding/2)return;let s=this.unNormalizePoint(Ce.create(o.x,o.y));i.push(s),i.sort((l,u)=>l[0]===u[0]?l[0]===0?l[1]-u[1]:l[1]===1?u[1]-l[1]:l[1]-u[1]:l[0]-u[0]),this.setState({points:i}),this.change(i)}handleLeave(){this.selected!==void 0&&(document.addEventListener("mousemove",this.handleDrag,!0),document.addEventListener("mouseup",this.handlePointUpdate,!0))}handleEnter(){document.removeEventListener("mousemove",this.handleDrag,!0),document.removeEventListener("mouseup",this.handlePointUpdate,!0)}normalizePoint(r){let n=this.padding/2,o=this.width+n,i=this.height+n,a=r[0]*(o-n)+n,s=r[1]*(i-n)+n,l=this.height+this.padding-s;return Ce.create(a,l)}unNormalizePoint(r){let n=this.padding/2,o=this.width+n,i=this.height+n,a=(r[0]-n)/(o-n),s=(this.height+this.padding-r[1]-n)/(i-n);return Ce.create(a,s)}refCallBack(r){r&&(this.myRef=r)}renderHistogram(){if(!this.props.volume)return null;let r=Nn.getHistogram(this.props.volume.grid,40),n=[],o=r.counts.length,i=this.width/o,a=this.padding/2,s=xl(r.counts)||1;for(let l=0;l<o;l++){let u=this.width*l/(o-1)+a,c=this.height+a,m=this.height*(1-r.counts[l]/s)+a;n.push((0,Yg.jsx)("line",{x1:u,x2:u,y1:c,y2:m,stroke:"#ded9ca",strokeWidth:i},`histogram${l}`))}return n}renderPoints(){let r=[],n;for(let o=0;o<this.state.points.length;o++)o!==0&&o!==this.state.points.length-1&&(n=this.normalizePoint(this.state.points[o]),r.push((0,Yg.jsx)(eO,{id:o,x:n[0],y:n[1],nX:this.state.points[o][0],nY:this.state.points[o][1],selected:!1,delete:this.deletePoint,onmouseover:this.props.onHover,onmousedown:this.handleMouseDown(o),onclick:this.handleClick(o)},o)));return r}renderLines(){let r=[],n=[],o,i,a,s,l,u=this.padding/2;for(let d of this.state.points)o=this.width+u,i=this.height+this.padding,a=d[0]*(o-u)+u,s=d[1]*(i-u)+u,l=this.height+this.padding-s,r.push(Ce.create(a,l));let c=r,m=c.length;for(let d=0;d<m-1;d++){let p=c[d][0],h=c[d][1],f=c[d+1][0],g=c[d+1][1];n.push((0,Yg.jsx)("line",{x1:p,x2:f,y1:h,y2:g,stroke:"#cec9ba",strokeWidth:"5"},`lineOf${d}`))}return n}};var Kg=_t(Mi());var xu=_t(ur()),r0=class extends Kg.Component{constructor(){super(...arguments);this.state={isChanging:!1,current:0};this.begin=()=>{this.setState({isChanging:!0})};this.end=r=>{this.setState({isChanging:!1}),this.props.onChange(r)};this.updateCurrent=r=>{this.setState({current:r}),this.props.onChangeImmediate?.(r)};this.updateManually=r=>{this.setState({isChanging:!0});let n=r;this.props.step===1&&(n=Math.round(n)),n<this.props.min&&(n=this.props.min),n>this.props.max&&(n=this.props.max),this.setState({current:n,isChanging:!0})};this.onManualBlur=()=>{this.setState({isChanging:!1}),this.props.onChange(this.state.current)};this.onMouseWheel=r=>{let{dx:n,dy:o,dz:i}=vX(r),a=(n>=0?1:-1)*(o>=0?1:-1)*(i>=0?1:-1),s=r.getModifierState("Shift"),l=a*(this.props.max-this.props.min)/(s?100:25);this.updateCurrent(this.state.current+l)}}static getDerivedStateFromProps(r,n){return n.isChanging||r.value===n.current?null:{current:r.value}}render(){let r=this.props.step;return r===void 0&&(r=1),(0,xu.jsxs)("div",{className:this.props.hideInput?"msp-slider msp-slider-no-input":"msp-slider",children:[(0,xu.jsx)("div",{children:(0,xu.jsx)(oO,{min:this.props.min,max:this.props.max,step:r,value:this.state.current,disabled:this.props.disabled,onBeforeChange:this.begin,onWheel:this.onMouseWheel,onChange:this.updateCurrent,onAfterChange:this.end})}),(0,xu.jsx)("div",{children:(0,xu.jsx)(Ec,{numeric:!0,delayMs:50,value:this.state.current,blurOnEnter:!0,onBlur:this.onManualBlur,isDisabled:this.props.disabled,onChange:this.updateManually})})]})}},nO=class extends Kg.Component{constructor(){super(...arguments);this.state={isChanging:!1,current:[0,1]};this.begin=()=>{this.setState({isChanging:!0})};this.end=r=>{this.setState({isChanging:!1}),this.props.onChange(r)};this.updateCurrent=r=>{this.setState({current:r})};this.updateMax=r=>{let n=r;this.props.step===1&&(n=Math.round(n)),n<this.state.current[0]?n=this.state.current[0]:n<this.props.min&&(n=this.props.min),n>this.props.max&&(n=this.props.max),this.props.onChange([this.state.current[0],n])};this.updateMin=r=>{let n=r;this.props.step===1&&(n=Math.round(n)),n<this.props.min&&(n=this.props.min),n>this.state.current[1]?n=this.state.current[1]:n>this.props.max&&(n=this.props.max),this.props.onChange([n,this.state.current[1]])}}static getDerivedStateFromProps(r,n){return n.isChanging||r.value[0]===n.current[0]&&r.value[1]===n.current[1]?null:{current:r.value}}render(){let r=this.props.step;return r===void 0&&(r=1),(0,xu.jsxs)("div",{className:"msp-slider2",children:[(0,xu.jsx)("div",{children:(0,xu.jsx)(Ec,{numeric:!0,delayMs:50,value:this.state.current[0],onEnter:this.props.onEnter,blurOnEnter:!0,isDisabled:this.props.disabled,onChange:this.updateMin})}),(0,xu.jsx)("div",{children:(0,xu.jsx)(oO,{min:this.props.min,max:this.props.max,step:r,value:this.state.current,disabled:this.props.disabled,onBeforeChange:this.begin,onChange:this.updateCurrent,onAfterChange:this.end,range:!0,allowCross:!0})}),(0,xu.jsx)("div",{children:(0,xu.jsx)(Ec,{numeric:!0,delayMs:50,value:this.state.current[1],onEnter:this.props.onEnter,blurOnEnter:!0,isDisabled:this.props.disabled,onChange:this.updateMax})})]})}};function eq(e){let t=[],r={}.hasOwnProperty;for(let n=0;n<arguments.length;n++){let o=arguments[n];if(!o)continue;let i=typeof o;if(i==="string"||i==="number")t.push(o);else if(Array.isArray(o))t.push(eq.apply(null,o));else if(i==="object")for(let a in o)r.call(o,a)&&o[a]&&t.push(a)}return t.join(" ")}function hRe(e){return e.touches.length>1||e.type.toLowerCase()==="touchend"&&e.touches.length>0}function gRe(e,t){return e?t.touches[0].clientY:t.touches[0].pageX}function yRe(e,t){return e?t.clientY:t.pageX}function bRe(e,t){let r=t.getBoundingClientRect();return e?r.top+r.height*.5:r.left+r.width*.5}function $Z(e){e.stopPropagation(),e.preventDefault()}var tq=class extends Kg.Component{render(){let{className:t,tipFormatter:r,vertical:n,offset:o,value:i,index:a}=this.props,s=n?{bottom:`${o}%`}:{left:`${o}%`};return(0,xu.jsx)("div",{className:t,style:s,title:r(i,a)})}},oO=class extends Kg.Component{constructor(r){super(r);this.sliderElement=Kg.createRef();this.handleElements=[];this.dragOffset=0;this.startPosition=0;this.startValue=0;this._getPointsCache=void 0;this.onMouseDown=r=>{if(r.button!==0)return;let n=yRe(this.props.vertical,r);if(!this.isEventFromHandle(r))this.dragOffset=0;else{let o=bRe(this.props.vertical,r.target);this.dragOffset=n-o,n=o}this.onStart(n),this.addDocumentEvents("mouse"),$Z(r)};this.onTouchMove=r=>{if(hRe(r)){this.end("touch");return}let n=gRe(this.props.vertical,r);this.onMove(r,n-this.dragOffset)};this.onTouchStart=r=>{if(hRe(r))return;let n=gRe(this.props.vertical,r);if(!this.isEventFromHandle(r))this.dragOffset=0;else{let o=bRe(this.props.vertical,r.target);this.dragOffset=n-o,n=o}this.onStart(n),this.addDocumentEvents("touch"),$Z(r)};this.eventHandlers={touchmove:r=>this.onTouchMove(r),touchend:r=>this.end("touch"),mousemove:r=>this.onMouseMove(r),mouseup:r=>this.end("mouse")};this.calcOffset=r=>{let{min:n,max:o}=this.props;return(r-n)/(o-n)*100};let{range:n,min:o,max:i}=r,a=n?Array.apply(null,Array(+n+1)).map(()=>o):o,s="defaultValue"in r?r.defaultValue:a,l=r.value!==void 0?r.value:s,u=(n?l:[o,l]).map(m=>this.trimAlignValue(m)),c;n&&u[0]===u[u.length-1]&&u[0]===i?c=0:c=u.length-1,this.state={handle:null,recent:c,bounds:u}}static{this.defaultProps={prefixCls:"msp-slider-base",className:"",min:0,max:100,step:1,marks:{},handle:(0,xu.jsx)(tq,{className:"",vertical:!1,offset:0,tipFormatter:r=>r,value:0,index:0}),onBeforeChange:vl,onChange:vl,onAfterChange:vl,tipFormatter:(r,n)=>r,disabled:!1,range:!1,vertical:!1,allowCross:!0,pushable:!1}}componentDidUpdate(r){if(!("value"in this.props||"min"in this.props||"max"in this.props))return;let{bounds:n}=this.state;if(r.range){let i=(this.props.value||n).map(a=>this.trimAlignValue(a,this.props));if(i.every((a,s)=>a===n[s]))return;this.setState({bounds:i}),n.some(a=>this.isValueOutOfBounds(a,this.props))&&this.props.onChange(i)}else{let o=this.props.value!==void 0?this.props.value:n[1],i=this.trimAlignValue(o,this.props);if(i===n[1]&&n[0]===r.min)return;this.setState({bounds:[r.min,i]}),this.isValueOutOfBounds(n[1],this.props)&&this.props.onChange(i)}}onChange(r){let n=this.props;!("value"in n)?this.setState(r):r.handle!==void 0&&this.setState({handle:r.handle});let i={...this.state,...r},a=n.range?i.bounds:i.bounds[1];n.onChange(a)}onMouseMove(r){let n=yRe(this.props.vertical,r);this.onMove(r,n-this.dragOffset)}onMove(r,n){$Z(r);let o=this.props,i=this.state,a=n-this.startPosition;a=this.props.vertical?-a:a;let s=a/this.getSliderLength()*(o.max-o.min),l=this.trimAlignValue(this.startValue+s),u=i.bounds[i.handle];if(l===u)return;let c=[...i.bounds];c[i.handle]=l;let m=i.handle;if(o.pushable){let d=i.bounds[m];this.pushSurroundingHandles(c,m,d)}else o.allowCross&&(c.sort((d,p)=>d-p),m=c.indexOf(l));this.onChange({handle:m,bounds:c})}onStart(r){this.props.onBeforeChange(this.getValue());let o=this.calcValueByPos(r);this.startValue=o,this.startPosition=r;let i=this.state,{bounds:a}=i,s=1;if(this.props.range){let c=0;for(let d=1;d<a.length-1;++d)o>a[d]&&(c=d);Math.abs(a[c+1]-o)<Math.abs(a[c]-o)&&(c=c+1),s=c;let m=a[c+1]===a[c];m&&(s=i.recent),m&&o!==a[c+1]&&(s=o<a[c+1]?c:c+1)}this.setState({handle:s,recent:s});let l=i.bounds[s];if(o===l)return;let u=[...i.bounds];u[s]=o,this.onChange({bounds:u})}getPoints(){let{marks:r,step:n,min:o,max:i}=this.props,a=this._getPointsCache;if(!a||a.marks!==r||a.step!==n){let s={...r};if(n!==null)for(let u=o;u<=i;u+=n)s[u]=u;let l=Object.keys(s).map(parseFloat);l.sort((u,c)=>u-c),this._getPointsCache={marks:r,step:n,points:l}}return this._getPointsCache.points}getPrecision(r){let n=r.toString(),o=0;return n.indexOf(".")>=0&&(o=n.length-n.indexOf(".")-1),o}getSliderLength(){let r=this.sliderElement.current;return r?this.props.vertical?r.clientHeight:r.clientWidth:0}getSliderStart(){let n=this.sliderElement.current.getBoundingClientRect();return this.props.vertical?n.top:n.left}getValue(){let{bounds:r}=this.state;return this.props.range?r:r[1]}addDocumentEvents(r){r==="touch"?(document.addEventListener("touchmove",this.eventHandlers.touchmove),document.addEventListener("touchend",this.eventHandlers.touchend)):r==="mouse"&&(document.addEventListener("mousemove",this.eventHandlers.mousemove),document.addEventListener("mouseup",this.eventHandlers.mouseup))}calcValue(r){let{vertical:n,min:o,max:i}=this.props,a=Math.abs(r/this.getSliderLength());return n?(1-a)*(i-o)+o:a*(i-o)+o}calcValueByPos(r){let n=r-this.getSliderStart();return this.trimAlignValue(this.calcValue(n))}end(r){this.removeEvents(r),this.props.onAfterChange(this.getValue()),this.setState({handle:null})}isEventFromHandle(r){for(let n of this.handleElements)if(n.current===r.target)return!0;return!1}isValueOutOfBounds(r,n){return r<n.min||r>n.max}pushHandle(r,n,o,i){let a=r[n],s=r[n];for(;o*(s-a)<i;){if(!this.pushHandleOnePoint(r,n,o))return r[n]=a,!1;s=r[n]}return!0}pushHandleOnePoint(r,n,o){let i=this.getPoints(),s=i.indexOf(r[n])+o;if(s>=i.length||s<0)return!1;let l=n+o,u=i[s],{pushable:c}=this.props,m=o*(r[l]-u);return this.pushHandle(r,l,o,+c-m)?(r[n]=u,!0):!1}pushSurroundingHandles(r,n,o){let{pushable:i}=this.props,a=r[n],s=0;if(r[n+1]-a<+i?s=1:a-r[n-1]<+i&&(s=-1),s===0)return;let l=n+s,u=s*(r[l]-a);this.pushHandle(r,l,s,+i-u)||(r[n]=o)}removeEvents(r){r==="touch"?(document.removeEventListener("touchmove",this.eventHandlers.touchmove),document.removeEventListener("touchend",this.eventHandlers.touchend)):r==="mouse"&&(document.removeEventListener("mousemove",this.eventHandlers.mousemove),document.removeEventListener("mouseup",this.eventHandlers.mouseup))}trimAlignValue(r,n){let{handle:o,bounds:i}=this.state||{},{marks:a,step:s,min:l,max:u,allowCross:c}={...this.props,...n||{}},m=r;m<=l&&(m=l),m>=u&&(m=u),!c&&o!=null&&o>0&&m<=i[o-1]&&(m=i[o-1]),!c&&o!=null&&o<i.length-1&&m>=i[o+1]&&(m=i[o+1]);let d=Object.keys(a).map(parseFloat);if(s!==null){let f=Math.round((m-l)/s)*s+l;d.push(f)}let p=d.map(f=>Math.abs(m-f)),h=d[p.indexOf(Math.min.apply(Math,p))];return s!==null?parseFloat(h.toFixed(this.getPrecision(s))):h}render(){let{handle:r,bounds:n}=this.state,{className:o,prefixCls:i,disabled:a,vertical:s,range:l,step:u,marks:c,tipFormatter:m}=this.props,d=this.props.handle,p=n.map(this.calcOffset),h=`${i}-handle`,f=n.map((I,v)=>eq({[h]:!0,[`${h}-${v+1}`]:!0,[`${h}-lower`]:v===0,[`${h}-upper`]:v===n.length-1})),y={prefixCls:i,noTip:u===null||m===null,tipFormatter:m,vertical:s};if(this.handleElements.length!==n.length){this.handleElements=[];for(let I=0;I<n.length;I++)this.handleElements.push(Kg.createRef())}let x=n.map((I,v)=>Kg.cloneElement(d,{...y,className:f[v],value:I,offset:p[v],dragging:r===v,index:v,key:v,ref:this.handleElements[v]}));l||x.shift();let S=eq({[i]:!0,[`${i}-with-marks`]:Object.keys(c).length,[`${i}-disabled`]:a,[`${i}-vertical`]:this.props.vertical,[o]:!!o});return(0,xu.jsxs)("div",{ref:this.sliderElement,className:S,onTouchStart:a?vl:this.onTouchStart,onMouseDown:a?vl:this.onMouseDown,onWheel:a?vl:this.props.onWheel,children:[(0,xu.jsx)("div",{className:`${i}-rail`}),x]})}};var rt=_t(ur()),uo=class extends _i.PureComponent{constructor(){super(...arguments);this.onChange=r=>{if(this.props.onChange?.(r,this.props.values),this.props.onChangeValues){let n={...this.props.values,[r.name]:r.value};this.props.onChangeValues(n,this.props.values)}};this.paramGroups=es(r=>kft(r))}renderGroup(r){if(r.length===0)return null;let n=this.props.values,o=null,i;for(let[a,s,l]of r)s.hideIf?.(n)||(o||(o=[]),i=s.category,o.push((0,rt.jsx)(l,{param:s,onChange:this.onChange,onEnter:this.props.onEnter,isDisabled:this.props.isDisabled,name:a,value:n[a]},a)));return o?i?[(0,rt.jsx)(fs,{header:i,children:o},i)]:o:null}renderPart(r){let n=null;for(let o of r){let i=this.renderGroup(o);if(i){n||(n=[]);for(let a of i)n.push(a)}}return n}render(){let r=this.paramGroups(this.props.params),n=this.renderPart(r.essentials),o=this.renderPart(r.advanced);return n&&o?(0,rt.jsxs)(rt.Fragment,{children:[n,(0,rt.jsx)(fs,{header:"Advanced Options",children:o})]}):n||o}},aO=class extends Fr{constructor(){super(...arguments);this.state={isDisabled:!1};this.setSettings=(r,n)=>{let o={...n,[r.name]:r.value},i=this.props.mapping.update(o,this.plugin);this.props.mapping.apply(i,this.plugin)}}componentDidMount(){this.subscribe(this.plugin.state.data.behaviors.isUpdating,r=>{this.setState({isDisabled:r})})}render(){let r=this.props.mapping.getTarget(this.plugin),n=this.props.mapping.getValues(r,this.plugin),o=this.props.mapping.params(this.plugin);return(0,rt.jsx)(uo,{params:o,values:n,onChange:this.setSettings,isDisabled:this.state.isDisabled})}};function kft(e){function t(a,s,l){let u=ED(s);if(u)if(!s.category)l.params[0].push([a,s,u]);else{l.map||(l.map=new Map);let c=l.map.get(s.category);c||(c=[],l.map.set(s.category,c),l.params.push(c)),c.push([a,s,u])}}function r(a,s){let l=a[0],u=s[0];return!l||!l[1].category?-1:!u||!u[1].category?1:l[1].category<u[1].category?-1:1}let n=Object.keys(e),o={params:[[]],map:void 0},i={params:[[]],map:void 0};for(let a of n){let s=e[a];s.isHidden||(s.isEssential?t(a,s,o):t(a,s,i))}return o.params.sort(r),i.params.sort(r),{essentials:o.params,advanced:i.params}}function ED(e){switch(e.type){case"value":return;case"boolean":return MD;case"number":return typeof e.min<"u"&&typeof e.max<"u"?oq:nq;case"converted":return bq;case"conditioned":return yq;case"multi-select":return fq;case"color":return wT;case"color-list":return e.offsets?lq:sq;case"vec3":return uq;case"mat4":return cq;case"url":return mq;case"file":return dq;case"file-list":return pq;case"select":return MT;case"value-ref":return lO;case"data-ref":return;case"text":return sO;case"interval":return typeof e.min<"u"&&typeof e.max<"u"?aq:iq;case"group":return uO;case"mapped":return hq;case"line-graph":return rq;case"script":return xq;case"object-list":return BD;default:console.warn(`${e} has no associated UI component`);return}}var wD=class extends _i.PureComponent{render(){let{legend:t,description:r}=this.props,n=t&&dRe(t);return(0,rt.jsx)("div",{className:"msp-help-text",children:(0,rt.jsxs)("div",{children:[(0,rt.jsxs)("div",{className:"msp-help-description",children:[(0,rt.jsx)(Dn,{svg:Du,inline:!0}),r]}),n&&(0,rt.jsx)("div",{className:"msp-help-legend",children:(0,rt.jsx)(n,{legend:t})})]})})}};function B1(e){let{props:t,state:r,control:n,toggleHelp:o,addOn:i}=e,a=[];t.param.shortLabel&&a.push("msp-control-label-short"),t.param.twoColumns&&a.push("msp-control-col-2"),t.param.multiline&&a.push("msp-control-twoline");let s=a.join(" "),l=t.param.label||Ks(t.name),u=t.param.help?t.param.help(t.value):{description:t.param.description,legend:t.param.legend},c=u.description||u.legend,m=l+(c?". Click for help.":"");return(0,rt.jsxs)(rt.Fragment,{children:[(0,rt.jsx)(Hl,{className:s,title:m,label:(0,rt.jsxs)(rt.Fragment,{children:[l,c&&(0,rt.jsx)(Cq,{show:r.showHelp,toggle:o,title:m})]}),control:n}),c&&r.showHelp&&(0,rt.jsx)("div",{className:"msp-control-offset",children:(0,rt.jsx)(wD,{legend:u.legend,description:u.description})}),i]})}function Cq({show:e,toggle:t,title:r}){return(0,rt.jsx)("button",{className:"msp-help msp-btn-link msp-btn-icon msp-control-group-expander",onClick:t,title:r||`${e?"Hide":"Show"} help`,style:{background:"transparent",textAlign:"left",padding:"0"},children:(0,rt.jsx)(Dn,{svg:Du})})}var M1=class extends _i.PureComponent{constructor(){super(...arguments);this.state={showHelp:!1};this.toggleHelp=()=>this.setState({showHelp:!this.state.showHelp})}update(r){this.props.onChange({param:this.props.param,name:this.props.name,value:r})}renderAddOn(){return null}render(){return B1({props:this.props,state:this.state,control:this.renderControl(),toggleHelp:this.toggleHelp,addOn:this.renderAddOn()})}},MD=class extends M1{constructor(){super(...arguments);this.onClick=r=>{this.update(!this.props.value),r.currentTarget.blur()}}renderControl(){return(0,rt.jsxs)("button",{onClick:this.onClick,disabled:this.props.isDisabled,children:[(0,rt.jsx)(Dn,{svg:this.props.value?cd:H5}),this.props.value?"On":"Off"]})}},rq=class extends _i.PureComponent{constructor(){super(...arguments);this.state={isExpanded:!1,isOverPoint:!1,message:`${this.props.param.defaultValue.length} points`};this.onHover=r=>{this.setState({isOverPoint:!this.state.isOverPoint}),r?this.setState({message:this.pointToLabel(r)}):this.setState({message:`${this.props.value.length} points`})};this.onDrag=r=>{this.setState({message:this.pointToLabel(r)})};this.onChange=r=>{this.props.onChange({name:this.props.name,param:this.props.param,value:r})};this.toggleExpanded=r=>{this.setState({isExpanded:!this.state.isExpanded}),r.currentTarget.blur()}}pointToLabel(r){if(!r)return"";let n=this.props.param.getVolume?.();if(n){let{min:o,max:i,mean:a,sigma:s}=n.grid.stats,l=o+(i-o)*r[0],u=(l-a)/s;return`(${l.toFixed(2)} | ${u.toFixed(2)}\u03C3, ${r[1].toFixed(2)})`}else return`(${r[0].toFixed(2)}, ${r[1].toFixed(2)})`}render(){let r=this.props.param.label||Ks(this.props.name);return(0,rt.jsxs)(rt.Fragment,{children:[(0,rt.jsx)(Hl,{label:r,control:(0,rt.jsx)("button",{onClick:this.toggleExpanded,disabled:this.props.isDisabled,children:`${this.state.message}`})}),(0,rt.jsx)("div",{className:"msp-control-offset",style:{display:this.state.isExpanded?"block":"none",marginTop:1},children:(0,rt.jsx)(tO,{data:this.props.value,volume:this.props.param.getVolume?.(),onChange:this.onChange,onHover:this.onHover,onDrag:this.onDrag})})]})}},nq=class extends _i.PureComponent{constructor(){super(...arguments);this.state={value:"0"};this.update=r=>{let n=LS(this.props.param.step||.01);r=parseFloat(r.toFixed(n)),this.props.onChange({param:this.props.param,name:this.props.name,value:r})}}render(){let r=this.props.param.label||Ks(this.props.name),n=this.props.param.label||Ks(this.props.name),o=LS(this.props.param.step||.01);return(0,rt.jsx)(Hl,{title:this.props.param.description,label:n,control:(0,rt.jsx)(Ec,{numeric:!0,value:parseFloat(this.props.value.toFixed(o)),onEnter:this.props.onEnter,placeholder:r,isDisabled:this.props.isDisabled,onChange:this.update})})}},oq=class extends M1{constructor(){super(...arguments);this.onChange=r=>{this.update(r)}}renderControl(){let r=typeof this.props.value>"u"?this.props.param.defaultValue:this.props.value;return(0,rt.jsx)(r0,{value:r,min:this.props.param.min,max:this.props.param.max,step:this.props.param.step,onChange:this.onChange,onChangeImmediate:this.props.param.immediateUpdate?this.onChange:void 0,disabled:this.props.isDisabled,onEnter:this.props.onEnter})}},sO=class extends M1{constructor(){super(...arguments);this.updateValue=r=>{r!==this.props.value&&this.update(r)}}renderControl(){let r=this.props.param.placeholder||this.props.param.label||Ks(this.props.name);return(0,rt.jsx)(Fft,{props:this.props,placeholder:r,update:this.updateValue})}};function Fft({props:e,placeholder:t,update:r}){let[n,o]=_i.useState(e.value),[i,a]=_i.useState(!1);_i.useEffect(()=>o(e.value),[e.value]);let s=m=>{i||e.param.disableInteractiveUpdates?o(m.target.value):r(m.target.value)},l=m=>{a(!1);let d=m.target;e.param.disableInteractiveUpdates?o(d.value):r(d.value)},u=m=>{e.param.disableInteractiveUpdates&&r(m.target.value)},c=m=>{m.key==="Enter"&&(e.onEnter&&!e.param.multiline?(m.stopPropagation(),e.onEnter()):m.shiftKey||m.ctrlKey||m.metaKey?m.currentTarget.blur():e.param.disableInteractiveUpdates&&!e.param.multiline&&r(n))};return e.param.multiline?(0,rt.jsx)("div",{className:"msp-control-text-area-wrapper",children:(0,rt.jsx)("textarea",{value:n??"",placeholder:t,disabled:e.isDisabled,onChange:s,onBlur:u,onKeyDown:c,onCompositionStart:()=>a(!0),onCompositionEnd:l})}):(0,rt.jsx)("input",{type:"text",value:n??"",placeholder:t,disabled:e.isDisabled,onChange:s,onBlur:u,onKeyDown:c,onCompositionStart:()=>a(!0),onCompositionEnd:l})}var Jg=class extends _i.PureComponent{constructor(){super(...arguments);this.onChange=r=>{typeof this.props.param.defaultValue=="number"?this.update(parseInt(r.target.value,10)):this.update(r.target.value)}}update(r){this.props.onChange({param:this.props.param,name:this.props.name,value:r})}render(){let r=this.props.value!==void 0&&!this.props.param.options.some(n=>n[0]===this.props.value);return(0,rt.jsxs)("select",{className:"msp-form-control",title:this.props.title,value:this.props.value!==void 0?this.props.value:this.props.param.defaultValue,onChange:this.onChange,disabled:this.props.isDisabled,children:[r&&(0,rt.jsx)("option",{value:this.props.value,children:`[Invalid] ${this.props.value}`},this.props.value),this.props.param.options.map(([n,o])=>(0,rt.jsx)("option",{value:n,children:o},n))]})}},MT=class extends _i.PureComponent{constructor(){super(...arguments);this.state={showHelp:!1,showOptions:!1};this.onSelect=r=>{!r||r.value===this.props.value?this.setState({showOptions:!1}):this.setState({showOptions:!1},()=>{this.props.onChange({param:this.props.param,name:this.props.name,value:r.value})})};this.toggle=()=>this.setState({showOptions:!this.state.showOptions});this.cycle=()=>{let{options:r}=this.props.param,n=r.findIndex(i=>i[0]===this.props.value),o=n===r.length-1?0:n+1;this.props.onChange({param:this.props.param,name:this.props.name,value:r[o][0]})};this.items=es(r=>Rr.createItemsFromSelectOptions(r.options));this.toggleHelp=()=>this.setState({showHelp:!this.state.showHelp})}renderControl(){let r=this.items(this.props.param),n=this.props.value!==void 0?Rr.findItem(r,this.props.value):void 0,o=n?n.label:typeof this.props.value>"u"?`${Rr.getFirstItem(r)?.label||""} [Default]`:`[Invalid] ${this.props.value}`,i=this.props.param.cycle?this.cycle:this.toggle,a=this.props.param.cycle?"center":"left",s=this.props.param.cycle?this.props.value==="on"?cd:this.props.value==="off"?H5:void 0:void 0;return(0,rt.jsx)(yi,{disabled:this.props.isDisabled,style:{textAlign:a,overflow:"hidden",textOverflow:"ellipsis"},label:o,title:o,icon:s,toggle:i,isSelected:this.state.showOptions,className:"msp-select-toggle"})}renderAddOn(){if(!this.state.showOptions)return null;let r=this.items(this.props.param),n=Rr.findItem(r,this.props.value);return(0,rt.jsx)(Rr,{items:r,current:n,onSelect:this.onSelect})}render(){return B1({props:this.props,state:this.state,control:this.renderControl(),toggleHelp:this.toggleHelp,addOn:this.renderAddOn()})}},lO=class extends _i.PureComponent{constructor(){super(...arguments);this.state={showHelp:!1,showOptions:!1};this.onSelect=r=>{!r||r.value===this.props.value?this.setState({showOptions:!1}):this.setState({showOptions:!1},()=>{this.props.onChange({param:this.props.param,name:this.props.name,value:{ref:r.value}})})};this.toggle=()=>this.setState({showOptions:!this.state.showOptions});this.toggleHelp=()=>this.setState({showHelp:!this.state.showHelp})}get items(){return Rr.createItemsFromSelectOptions(this.props.param.getOptions(this.context))}renderControl(){let r=this.items,n=this.props.value.ref?Rr.findItem(r,this.props.value.ref):void 0,o=n?n.label:`[Ref] ${this.props.value.ref??""}`;return(0,rt.jsx)(yi,{disabled:this.props.isDisabled,style:{textAlign:"left",overflow:"hidden",textOverflow:"ellipsis"},label:o,title:o,toggle:this.toggle,isSelected:this.state.showOptions})}renderAddOn(){if(!this.state.showOptions)return null;let r=this.items,n=Rr.findItem(r,this.props.value.ref);return(0,rt.jsx)(Rr,{items:r,current:n,onSelect:this.onSelect})}render(){return B1({props:this.props,state:this.state,control:this.renderControl(),toggleHelp:this.toggleHelp,addOn:this.renderAddOn()})}};lO.contextType=Al;var iq=class extends _i.PureComponent{constructor(){super(...arguments);this.state={isExpanded:!1};this.components={0:C.Numeric(0,{step:this.props.param.step},{label:"Min"}),1:C.Numeric(0,{step:this.props.param.step},{label:"Max"})};this.componentChange=({name:r,value:n})=>{let o=[...this.props.value];o[+r]=n,this.change(o)};this.toggleExpanded=r=>{this.setState({isExpanded:!this.state.isExpanded}),r.currentTarget.blur()}}change(r){this.props.onChange({name:this.props.name,param:this.props.param,value:r})}render(){let r=this.props.value,n=this.props.param.label||Ks(this.props.name),o=LS(this.props.param.step||.01),i=`[${r[0].toFixed(o)}, ${r[1].toFixed(o)}]`;return(0,rt.jsxs)(rt.Fragment,{children:[(0,rt.jsx)(Hl,{label:n,control:(0,rt.jsx)("button",{onClick:this.toggleExpanded,disabled:this.props.isDisabled,children:i})}),this.state.isExpanded&&(0,rt.jsx)("div",{className:"msp-control-offset",children:(0,rt.jsx)(uo,{params:this.components,values:r,onChange:this.componentChange,onEnter:this.props.onEnter})})]})}},aq=class extends M1{constructor(){super(...arguments);this.onChange=r=>{this.update(r)}}renderControl(){return(0,rt.jsx)(nO,{value:this.props.value,min:this.props.param.min,max:this.props.param.max,step:this.props.param.step,onChange:this.onChange,disabled:this.props.isDisabled,onEnter:this.props.onEnter})}};var Lft=zf(fB),Vft=zf(pB);function Sq(e,t="0"){return{background:Oft(e.colors,e.kind==="set"),position:"absolute",bottom:"0",height:"4px",right:t,left:"0"}}function Oft(e,t){return t?Vft(e):Lft(e)}function Gft(){let e=t=>{let r=Ka(t[0]);return(0,rt.jsx)("div",{style:Sq({kind:r.type!=="qualitative"?"interpolate":"set",colors:r.list})})};return{ColorPresets:{all:Rr.createItemsFromSelectOptions(cM,{addOn:e,description:t=>t[3]}),scale:Rr.createItemsFromSelectOptions(Fre,{addOn:e,description:t=>t[3]}),set:Rr.createItemsFromSelectOptions(Lre,{addOn:e,description:t=>t[3]})},ColorsParam:C.ObjectList({color:C.Color(0)},({color:t})=>Le.toHexString(t).toUpperCase()),OffsetColorsParam:C.ObjectList({color:C.Color(0),offset:C.Numeric(0,{min:0,max:1,step:.01})},({color:t,offset:r})=>`${Le.toHexString(t).toUpperCase()} [${r.toFixed(2)}]`),IsInterpolatedParam:C.Boolean(!1,{label:"Interpolated"})}}var iO;function xRe(){return iO||(iO=Gft(),iO)}var sq=class extends _i.PureComponent{constructor(){super(...arguments);this.state={showHelp:!1,show:void 0};this.toggleEdit=()=>this.setState({show:this.state.show==="edit"?void 0:"edit"});this.togglePresets=()=>this.setState({show:this.state.show==="presets"?void 0:"presets"});this.selectPreset=r=>{if(!r)return;this.setState({show:void 0});let n=Ka(r.value);this.update({kind:n.type!=="qualitative"?"interpolate":"set",colors:n.list})};this.colorsChanged=({value:r})=>{this.update({kind:this.props.value.kind,colors:r.map(n=>n.color)})};this.isInterpolatedChanged=({value:r})=>{this.update({kind:r?"interpolate":"set",colors:this.props.value.colors})};this.toggleHelp=()=>this.setState({showHelp:!this.state.showHelp})}update(r){this.props.onChange({param:this.props.param,name:this.props.name,value:r})}renderControl(){let{value:r}=this.props;return(0,rt.jsxs)(rt.Fragment,{children:[(0,rt.jsxs)("button",{onClick:this.toggleEdit,style:{position:"relative",paddingRight:"33px"},children:[r.colors.length===1?"1 color":`${r.colors.length} colors`,(0,rt.jsx)("div",{style:Sq(r,"33px")})]}),(0,rt.jsx)(sr,{svg:Ly,onClick:this.togglePresets,toggleState:this.state.show==="presets",title:"Color Presets",style:{padding:0,position:"absolute",right:0,top:0,width:"32px"}})]})}renderColors(){if(!this.state.show)return null;let{ColorPresets:r,ColorsParam:n,IsInterpolatedParam:o}=xRe(),i=r[this.props.param.presetKind];if(this.state.show==="presets")return(0,rt.jsx)(Rr,{items:i,onSelect:this.selectPreset});let a=this.props.value.colors.map(s=>({color:Array.isArray(s)?s[0]:s}));return(0,rt.jsxs)("div",{className:"msp-control-offset",children:[(0,rt.jsx)(BD,{name:"colors",param:n,value:a,onChange:this.colorsChanged,isDisabled:this.props.isDisabled,onEnter:this.props.onEnter}),(0,rt.jsx)(MD,{name:"isInterpolated",param:o,value:this.props.value.kind==="interpolate",onChange:this.isInterpolatedChanged,isDisabled:this.props.isDisabled,onEnter:this.props.onEnter})]})}render(){return B1({props:this.props,state:this.state,control:this.renderControl(),toggleHelp:this.toggleHelp,addOn:this.renderColors()})}},lq=class extends _i.PureComponent{constructor(){super(...arguments);this.state={showHelp:!1,show:void 0};this.toggleEdit=()=>this.setState({show:this.state.show==="edit"?void 0:"edit"});this.togglePresets=()=>this.setState({show:this.state.show==="presets"?void 0:"presets"});this.selectPreset=r=>{if(!r)return;this.setState({show:void 0});let n=Ka(r.value);this.update({kind:n.type!=="qualitative"?"interpolate":"set",colors:n.list})};this.colorsChanged=({value:r})=>{let n=r.map(o=>[o.color,o.offset]);n.sort((o,i)=>o[1]-i[1]),this.update({kind:this.props.value.kind,colors:n})};this.isInterpolatedChanged=({value:r})=>{this.update({kind:r?"interpolate":"set",colors:this.props.value.colors})};this.toggleHelp=()=>this.setState({showHelp:!this.state.showHelp})}update(r){this.props.onChange({param:this.props.param,name:this.props.name,value:r})}renderControl(){let{value:r}=this.props;return(0,rt.jsxs)(rt.Fragment,{children:[(0,rt.jsxs)("button",{onClick:this.toggleEdit,style:{position:"relative",paddingRight:"33px"},children:[r.colors.length===1?"1 color":`${r.colors.length} colors`,(0,rt.jsx)("div",{style:Sq(r,"33px")})]}),(0,rt.jsx)(sr,{svg:Ly,onClick:this.togglePresets,toggleState:this.state.show==="presets",title:"Color Presets",style:{padding:0,position:"absolute",right:0,top:0,width:"32px"}})]})}renderColors(){if(!this.state.show)return null;let{ColorPresets:r,OffsetColorsParam:n,IsInterpolatedParam:o}=xRe(),i=r[this.props.param.presetKind];if(this.state.show==="presets")return(0,rt.jsx)(Rr,{items:i,onSelect:this.selectPreset});let a=this.props.value.colors,s=a.map((l,u)=>Array.isArray(l)?{color:l[0],offset:l[1]}:{color:l,offset:u/a.length});return s.sort((l,u)=>l.offset-u.offset),(0,rt.jsxs)("div",{className:"msp-control-offset",children:[(0,rt.jsx)(BD,{name:"colors",param:n,value:s,onChange:this.colorsChanged,isDisabled:this.props.isDisabled,onEnter:this.props.onEnter}),(0,rt.jsx)(MD,{name:"isInterpolated",param:o,value:this.props.value.kind==="interpolate",onChange:this.isInterpolatedChanged,isDisabled:this.props.isDisabled,onEnter:this.props.onEnter})]})}render(){return B1({props:this.props,state:this.state,control:this.renderControl(),toggleHelp:this.toggleHelp,addOn:this.renderColors()})}},uq=class extends _i.PureComponent{constructor(){super(...arguments);this.state={isExpanded:!1};this.components={0:C.Numeric(0,{step:this.props.param.step},{label:this.props.param.fieldLabels&&this.props.param.fieldLabels.x||"X"}),1:C.Numeric(0,{step:this.props.param.step},{label:this.props.param.fieldLabels&&this.props.param.fieldLabels.y||"Y"}),2:C.Numeric(0,{step:this.props.param.step},{label:this.props.param.fieldLabels&&this.props.param.fieldLabels.z||"Z"})};this.componentChange=({name:r,value:n})=>{let o=b.copy(b.zero(),this.props.value);o[+r]=n,this.change(o)};this.toggleExpanded=r=>{this.setState({isExpanded:!this.state.isExpanded}),r.currentTarget.blur()}}change(r){this.props.onChange({name:this.props.name,param:this.props.param,value:r})}render(){let r=this.props.value,n=this.props.param.label||Ks(this.props.name),o=LS(this.props.param.step||.01),i=`[${r[0].toFixed(o)}, ${r[1].toFixed(o)}, ${r[2].toFixed(o)}]`;return(0,rt.jsxs)(rt.Fragment,{children:[(0,rt.jsx)(Hl,{label:n,control:(0,rt.jsx)("button",{onClick:this.toggleExpanded,disabled:this.props.isDisabled,children:(0,rt.jsx)("div",{title:i,className:"msp-no-overflow",style:{display:"block"},children:i})})}),this.state.isExpanded&&(0,rt.jsx)("div",{className:"msp-control-offset",children:(0,rt.jsx)(uo,{params:this.components,values:r,onChange:this.componentChange,onEnter:this.props.onEnter})})]})}},cq=class extends _i.PureComponent{constructor(){super(...arguments);this.state={isExpanded:!1};this.components={json:C.Text(JSON.stringify(H()),{description:"JSON array with 4x4 matrix in a column major (j * 4 + i indexing) format"})};this.componentChange=({name:r,value:n})=>{let o=H.copy(H(),this.props.value);r==="json"?H.copy(o,JSON.parse(n)):o[+r]=n,this.change(o)};this.toggleExpanded=r=>{this.setState({isExpanded:!this.state.isExpanded}),r.currentTarget.blur()}}change(r){this.props.onChange({name:this.props.name,param:this.props.param,value:r})}changeValue(r){return n=>{let o=H.copy(H(),this.props.value);o[r]=n,this.change(o)}}get grid(){let r=this.props.value,n=[];for(let o=0;o<4;o++){let i=[];for(let a=0;a<4;a++)i.push((0,rt.jsx)(Ec,{numeric:!0,delayMs:50,value:H.getValue(r,o,a),onChange:this.changeValue(4*a+o),className:"msp-form-control",blurOnEnter:!0,isDisabled:this.props.isDisabled},a));n.push((0,rt.jsx)("div",{className:"msp-flex-row",children:i},o))}return(0,rt.jsx)("div",{className:"msp-parameter-matrix",children:n})}render(){let r={json:JSON.stringify(this.props.value)},n=this.props.param.label||Ks(this.props.name);return(0,rt.jsxs)(rt.Fragment,{children:[(0,rt.jsx)(Hl,{label:n,control:(0,rt.jsx)("button",{onClick:this.toggleExpanded,disabled:this.props.isDisabled,children:(0,rt.jsx)("div",{className:"msp-no-overflow",style:{display:"block"},children:"4\xD74 Matrix"})})}),this.state.isExpanded&&(0,rt.jsxs)("div",{className:"msp-control-offset",children:[this.grid,(0,rt.jsx)(uo,{params:this.components,values:r,onChange:this.componentChange,onEnter:this.props.onEnter})]})]})}},mq=class extends M1{constructor(){super(...arguments);this.onChange=r=>{let n=r.target.value;n!==sn.getUrl(this.props.value||"")&&this.update(sn.Url(n))};this.onKeyPress=r=>{(r.keyCode===13||r.charCode===13||r.key==="Enter")&&this.props.onEnter&&this.props.onEnter(),r.stopPropagation()}}renderControl(){let r=this.props.param.label||Ks(this.props.name);return(0,rt.jsx)("input",{type:"text",value:sn.getUrl(this.props.value||""),placeholder:r,onChange:this.onChange,onKeyPress:this.props.onEnter?this.onKeyPress:void 0,disabled:this.props.isDisabled})}},dq=class extends _i.PureComponent{constructor(){super(...arguments);this.state={showHelp:!1};this.onChangeFile=r=>{this.change(r.target.files[0])};this.toggleHelp=()=>this.setState({showHelp:!this.state.showHelp})}change(r){this.props.onChange({name:this.props.name,param:this.props.param,value:sn.File(r)})}renderControl(){let r=this.props.value;return(0,rt.jsxs)("div",{className:"msp-btn msp-btn-block msp-btn-action msp-loader-msp-btn-file",style:{marginTop:"1px"},children:[r?r.name:"Select a file..."," ",(0,rt.jsx)("input",{disabled:this.props.isDisabled,onChange:this.onChangeFile,type:"file",multiple:!1,accept:this.props.param.accept})]})}render(){return this.props.param.label?B1({props:this.props,state:this.state,control:this.renderControl(),toggleHelp:this.toggleHelp,addOn:null}):this.renderControl()}},pq=class extends _i.PureComponent{constructor(){super(...arguments);this.state={showHelp:!1};this.onChangeFileList=r=>{this.change(r.target.files)};this.toggleHelp=()=>this.setState({showHelp:!this.state.showHelp})}change(r){let n=[];if(r)for(let o=0,i=r.length;o<i;++o)n.push(sn.File(r[o]));this.props.onChange({name:this.props.name,param:this.props.param,value:n})}renderControl(){let r=this.props.value,n=[];if(r)for(let i of r)n.push(i.name);let o=n.length===0?"Select files...":n.length===1?n[0]:`${n.length} files selected`;return(0,rt.jsxs)("div",{className:"msp-btn msp-btn-block msp-btn-action msp-loader-msp-btn-file",style:{marginTop:"1px"},children:[o," ",(0,rt.jsx)("input",{disabled:this.props.isDisabled,onChange:this.onChangeFileList,type:"file",multiple:!0,accept:this.props.param.accept})]})}render(){return this.props.param.label?B1({props:this.props,state:this.state,control:this.renderControl(),toggleHelp:this.toggleHelp,addOn:null}):this.renderControl()}},fq=class extends _i.PureComponent{constructor(){super(...arguments);this.state={isExpanded:!1};this.toggleExpanded=r=>{this.setState({isExpanded:!this.state.isExpanded}),r.currentTarget.blur()}}change(r){this.props.onChange({name:this.props.name,param:this.props.param,value:r})}toggle(r){return n=>{this.props.value.indexOf(r)<0?this.change(this.props.value.concat(r)):this.change(this.props.value.filter(o=>o!==r)),n.currentTarget.blur()}}render(){let r=this.props.value,n=this.props.param.emptyValue,o=this.props.param.label||Ks(this.props.name);return(0,rt.jsxs)(rt.Fragment,{children:[(0,rt.jsx)(Hl,{label:o,control:(0,rt.jsx)("button",{onClick:this.toggleExpanded,disabled:this.props.isDisabled,children:r.length===0&&n?n:`${r.length} of ${this.props.param.options.length}`})}),this.state.isExpanded&&(0,rt.jsx)("div",{className:"msp-control-offset",children:this.props.param.options.map(([i,a])=>{let s=r.indexOf(i)>=0;return(0,rt.jsx)(gr,{onClick:this.toggle(i),disabled:this.props.isDisabled,style:{marginTop:"1px"},children:(0,rt.jsx)("span",{style:{float:s?"left":"right"},children:s?`\u2713 ${a}`:`${a} \u2717`})},i)})})]})}},uO=class extends _i.PureComponent{constructor(){super(...arguments);this.state={isExpanded:!!this.props.param.isExpanded,showPresets:!1,showHelp:!1};this.onChangeParam=r=>{this.change({...this.props.value,[r.name]:r.value})};this.toggleExpanded=()=>this.setState({isExpanded:!this.state.isExpanded});this.toggleShowPresets=()=>this.setState({showPresets:!this.state.showPresets});this.presetItems=es(r=>Rr.createItemsFromSelectOptions(r.presets??[]));this.onSelectPreset=r=>{this.setState({showPresets:!1}),this.change(r?.value)}}change(r){this.props.onChange({name:this.props.name,param:this.props.param,value:r})}pivotedPresets(){if(!this.props.param.presets)return null;let r=this.props.param.label||Ks(this.props.name);return(0,rt.jsxs)("div",{className:"msp-control-group-wrapper",children:[(0,rt.jsx)("div",{className:"msp-control-group-header",children:(0,rt.jsxs)("button",{className:"msp-btn msp-form-control msp-btn-block",onClick:this.toggleShowPresets,children:[(0,rt.jsx)(Dn,{svg:Ly}),r," Presets"]})}),this.state.showPresets&&(0,rt.jsx)(Rr,{items:this.presetItems(this.props.param),onSelect:this.onSelectPreset})]})}presets(){return this.props.param.presets?(0,rt.jsxs)(rt.Fragment,{children:[(0,rt.jsx)("div",{className:"msp-control-group-presets-wrapper",children:(0,rt.jsx)("div",{className:"msp-control-group-header",children:(0,rt.jsxs)("button",{className:"msp-btn msp-form-control msp-btn-block",onClick:this.toggleShowPresets,children:[(0,rt.jsx)(Dn,{svg:Ly}),"Presets"]})})}),this.state.showPresets&&(0,rt.jsx)(Rr,{items:this.presetItems(this.props.param),onSelect:this.onSelectPreset})]}):null}pivoted(){let r=this.props.param.pivot,n=this.props.param.params,o=n[r],i=ED(o),a=(0,rt.jsx)(i,{name:r,param:o,value:this.props.value[r],onChange:this.onChangeParam,onEnter:this.props.onEnter,isDisabled:this.props.isDisabled});if(!this.state.isExpanded)return(0,rt.jsxs)("div",{className:"msp-mapped-parameter-group",children:[a,(0,rt.jsx)(sr,{svg:Il,onClick:this.toggleExpanded,toggleState:this.state.isExpanded,title:"More Options",style:{opacity:.7}})]});let s=Object.create(null);for(let l of Object.keys(n))l!==r&&(s[l]=n[l]);return(0,rt.jsxs)("div",{className:"msp-mapped-parameter-group",children:[a,(0,rt.jsx)(sr,{svg:Il,onClick:this.toggleExpanded,toggleState:this.state.isExpanded,title:"More Options"}),(0,rt.jsxs)("div",{className:"msp-control-offset",children:[this.pivotedPresets(),(0,rt.jsx)(uo,{params:s,onEnter:this.props.onEnter,values:this.props.value,onChange:this.onChangeParam,isDisabled:this.props.isDisabled})]})]})}render(){let r=this.props.param.params;if(Object.keys(r).length===0)return null;if(this.props.param.pivot)return this.pivoted();let n=this.props.param.label||Ks(this.props.name),o=(0,rt.jsx)(uo,{params:r,onChange:this.onChangeParam,values:this.props.value,onEnter:this.props.onEnter,isDisabled:this.props.isDisabled});return this.props.inMapped?(0,rt.jsx)("div",{className:"msp-control-offset",children:o}):this.props.param.isFlat?o:(0,rt.jsxs)("div",{className:"msp-control-group-wrapper",style:{position:"relative"},children:[(0,rt.jsx)("div",{className:"msp-control-group-header",children:(0,rt.jsxs)("button",{className:"msp-btn msp-form-control msp-btn-block",onClick:this.toggleExpanded,children:[(0,rt.jsx)(Dn,{svg:this.state.isExpanded?ec:tc}),n]})}),this.presets(),this.state.isExpanded&&(0,rt.jsx)("div",{className:"msp-control-offset",children:o})]})}},hq=class extends _i.PureComponent{constructor(){super(...arguments);this.state={isExpanded:!1};this.valuesCache={};this.onChangeName=r=>{this.change({name:r.value,params:this.getValues(r.value)})};this.onChangeParam=r=>{this.setValues(this.props.value.name,r.value),this.change({name:this.props.value.name,params:r.value})};this.toggleExpanded=()=>this.setState({isExpanded:!this.state.isExpanded})}setValues(r,n){this.valuesCache[r]=n}getValues(r){return r in this.valuesCache?this.valuesCache[r]:this.props.param.map(r).defaultValue}change(r){this.props.onChange({name:this.props.name,param:this.props.param,value:r})}areParamsEmpty(r){for(let n of Object.keys(r))if(!r[n].isHidden)return!1;return!0}render(){let r=this.props.value||this.props.param.defaultValue,n=this.props.param.map(r.name),o=this.props.param.label||Ks(this.props.name),i=ED(n),a=this.props.param.help,s=a?{...this.props.param.select,help:u=>a({name:u,params:this.getValues(u)})}:this.props.param.select,l=(0,rt.jsx)(MT,{param:s,isDisabled:this.props.isDisabled,onChange:this.onChangeName,onEnter:this.props.onEnter,name:o,value:r.name});return i?n.type==="group"&&!n.isFlat?this.areParamsEmpty(n.params)?l:(0,rt.jsxs)("div",{className:"msp-mapped-parameter-group",children:[l,(0,rt.jsx)(sr,{svg:Il,onClick:this.toggleExpanded,toggleState:this.state.isExpanded,title:`${o} Properties`,style:{opacity:this.state.isExpanded?void 0:.7}}),this.state.isExpanded&&(0,rt.jsx)(uO,{inMapped:!0,param:n,value:r.params,name:r.name,onChange:this.onChangeParam,onEnter:this.props.onEnter,isDisabled:this.props.isDisabled})]}):(0,rt.jsxs)(rt.Fragment,{children:[l,(0,rt.jsx)(i,{param:n,value:r.params,name:r.name,onChange:this.onChangeParam,onEnter:this.props.onEnter,isDisabled:this.props.isDisabled})]}):l}},cO=class extends _i.PureComponent{constructor(){super(...arguments);this.state={current:this.props.value};this.onChangeParam=r=>{this.setState({current:{...this.state.current,[r.name]:r.value}})};this.apply=()=>{this.props.apply(this.state.current)}}componentDidUpdate(r){(this.props.params!==r.params||this.props.value!==r.value)&&this.setState({current:this.props.value})}render(){return(0,rt.jsxs)(rt.Fragment,{children:[(0,rt.jsx)(uo,{params:this.props.params,onChange:this.onChangeParam,values:this.state.current,onEnter:this.apply,isDisabled:this.props.isDisabled}),(0,rt.jsx)("button",{className:"msp-btn msp-btn-block msp-form-control msp-control-top-offset",onClick:this.apply,disabled:this.props.isDisabled,children:this.props.isUpdate?"Update":"Add"})]})}},gq=class extends _i.PureComponent{constructor(){super(...arguments);this.state={isExpanded:!1};this.update=r=>{this.props.actions.update(r,this.props.index)};this.moveUp=()=>{this.props.actions.move(this.props.index,-1)};this.moveDown=()=>{this.props.actions.move(this.props.index,1)};this.remove=()=>{this.setState({isExpanded:!1}),this.props.actions.remove(this.props.index)};this.toggleExpanded=r=>{this.setState({isExpanded:!this.state.isExpanded}),r.currentTarget.blur()}}render(){return(0,rt.jsxs)(rt.Fragment,{children:[(0,rt.jsxs)("div",{className:"msp-param-object-list-item",children:[(0,rt.jsxs)("button",{className:"msp-btn msp-btn-block msp-form-control",onClick:this.toggleExpanded,children:[(0,rt.jsx)("span",{children:`${this.props.index+1}: `}),this.props.param.getLabel(this.props.value)]}),(0,rt.jsxs)("div",{children:[(0,rt.jsx)(sr,{svg:_x,title:"Move Up",onClick:this.moveUp,small:!0}),(0,rt.jsx)(sr,{svg:Rx,title:"Move Down",onClick:this.moveDown,small:!0}),(0,rt.jsx)(sr,{svg:$s,title:"Remove",onClick:this.remove,small:!0})]})]}),this.state.isExpanded&&(0,rt.jsx)("div",{className:"msp-control-offset",children:(0,rt.jsx)(cO,{params:this.props.param.element,apply:this.update,value:this.props.value,isUpdate:!0,isDisabled:this.props.isDisabled})})]})}},BD=class extends _i.PureComponent{constructor(){super(...arguments);this.state={isExpanded:!1};this.add=r=>{this.change([...this.props.value,r])};this.actions={update:(r,n)=>{let o=this.props.value.slice(0);o[n]=r,this.change(o)},move:(r,n)=>{let o=this.props.value;if(o.length===1)return;let i=(r+n)%o.length;i<0&&(i+=o.length),o=o.slice(0);let a=o[r];o[r]=o[i],o[i]=a,this.change(o)},remove:r=>{let n=this.props.value,o=[];for(let i=0;i<n.length;i++)r!==i&&o.push(n[i]);this.change(o)}};this.toggleExpanded=r=>{this.setState({isExpanded:!this.state.isExpanded}),r.currentTarget.blur()}}change(r){this.props.onChange({name:this.props.name,param:this.props.param,value:r})}render(){let r=this.props.value,n=this.props.param.label||Ks(this.props.name),o=`${r.length} item${r.length!==1?"s":""}`;return(0,rt.jsxs)(rt.Fragment,{children:[(0,rt.jsx)(Hl,{label:n,control:(0,rt.jsx)("button",{onClick:this.toggleExpanded,disabled:this.props.isDisabled,children:o})}),this.state.isExpanded&&(0,rt.jsxs)("div",{className:"msp-control-offset",children:[this.props.value.map((i,a)=>(0,rt.jsx)(gq,{param:this.props.param,value:i,index:a,actions:this.actions,isDisabled:this.props.isDisabled},a)),(0,rt.jsx)(zl,{header:"New Item",children:(0,rt.jsx)(cO,{params:this.props.param.element,apply:this.add,value:this.props.param.ctor(),isDisabled:this.props.isDisabled})})]})]})}},yq=class extends _i.PureComponent{constructor(){super(...arguments);this.onChangeCondition=r=>{this.change(this.props.param.conditionedValue(this.props.value,r.value))};this.onChangeParam=r=>{this.change(r.value)}}change(r){this.props.onChange({name:this.props.name,param:this.props.param,value:r})}render(){let r=this.props.value,n=this.props.param.conditionForValue(r),o=this.props.param.conditionParams[n],i=this.props.param.label||Ks(this.props.name),a=ED(o),s=(0,rt.jsx)(MT,{param:this.props.param.select,isDisabled:this.props.isDisabled,onChange:this.onChangeCondition,onEnter:this.props.onEnter,name:`${i} Kind`,value:n});return a?(0,rt.jsxs)(rt.Fragment,{children:[s,(0,rt.jsx)(a,{param:o,value:r,name:i,onChange:this.onChangeParam,onEnter:this.props.onEnter,isDisabled:this.props.isDisabled})]}):s}},bq=class extends _i.PureComponent{constructor(){super(...arguments);this.onChange=r=>{this.props.onChange({name:this.props.name,param:this.props.param,value:this.props.param.toValue(r.value)})}}render(){let r=this.props.param.fromValue(this.props.value),n=ED(this.props.param.converted);return n?(0,rt.jsx)(n,{param:this.props.param.converted,value:r,name:this.props.name,onChange:this.onChange,onEnter:this.props.onEnter,isDisabled:this.props.isDisabled}):null}},xq=class extends _i.PureComponent{constructor(){super(...arguments);this.onChange=({name:r,value:n})=>{let o=r;n!==this.props.value[o]&&this.props.onChange({param:this.props.param,name:this.props.name,value:{...this.props.value,[o]:n}})}}render(){let r={defaultValue:this.props.value.language,options:C.objectToOptions(Mo.Info),type:"select"},n=(0,rt.jsx)(MT,{param:r,isDisabled:this.props.isDisabled,onChange:this.onChange,onEnter:this.props.onEnter,name:"language",value:this.props.value.language}),o={defaultValue:this.props.value.language,type:"text"},i=(0,rt.jsx)(sO,{param:o,isDisabled:this.props.isDisabled,onChange:this.onChange,name:"expression",value:this.props.value.expression});return(0,rt.jsxs)(rt.Fragment,{children:[n,this.props.value.language!=="mol-script"&&(0,rt.jsxs)("div",{className:"msp-help-text",style:{padding:"10px"},children:[(0,rt.jsx)(Dn,{svg:RM})," Support for PyMOL, VMD, and Jmol selections is an experimental feature and may not always work as intended."]}),i]})}};var Ob=_t(ur()),mO=class extends Fr{constructor(){super(...arguments);this.updateParams=r=>{this.plugin.managers.animation.updateParams({[r.name]:r.value})};this.updateCurrentParams=r=>{this.plugin.managers.animation.updateCurrentParams({[r.name]:r.value})};this.startOrStop=()=>{let r=this.plugin.managers.animation;r.state.animationState==="playing"?r.stop():(this.props.onStart&&this.props.onStart(),r.start())}}componentDidMount(){this.subscribe(this.plugin.managers.animation.events.updated,()=>this.forceUpdate())}render(){let r=this.plugin.managers.animation;if(r.isEmpty)return null;let n=r.state.animationState==="playing",o=r.current.anim.canApply?.(this.plugin);return(0,Ob.jsxs)(Ob.Fragment,{children:[(0,Ob.jsx)(uo,{params:r.getParams(),values:r.state.params,onChange:this.updateParams,isDisabled:n}),(0,Ob.jsx)(uo,{params:r.current.params,values:r.current.paramValues,onChange:this.updateCurrentParams,isDisabled:n}),(0,Ob.jsx)("div",{className:"msp-flex-row",children:(0,Ob.jsx)(gr,{icon:r.state.animationState!=="playing"?void 0:TM,onClick:this.startOrStop,disabled:o!==void 0&&o.canApply===!1,children:r.state.animationState==="playing"?"Stop":o===void 0||o.canApply?"Start":o.reason||"Start"})})]})}};var SRe="overpaint-controls";async function vq(e,t,r,n,o){await Uft(e,t,async(i,a,s)=>{if(o&&o.length>0&&!o.includes(a.params.values.type.name))return;let l=a.obj.data.sourceData,u=await n(l.root);if(nr.isEmpty(u)||Oi(u))return;let c={bundle:Q.Bundle.fromLoci(u),color:r===-1?0:r,clear:r===-1};if(s){let m=[...s.params.values.layers,c],d=CRe(m,l);i.to(s).update(as.toBundle(d))}else{let m=CRe([c],l);i.to(a.transform.ref).apply(Qe.Representation.OverpaintStructureRepresentation3DFromBundle,as.toBundle(m),{tags:SRe})}})}async function Uft(e,t,r){let n=e.state.data,o=n.build();for(let i of t)for(let a of i.representations){let s=n.select(tr.Generators.ofTransformer(Qe.Representation.OverpaintStructureRepresentation3DFromBundle,a.cell.transform.ref).withTag(SRe));await r(o,a.cell,s[0])}return o.commit({doNotUpdateCurrent:!0})}function CRe(e,t){let r=as.ofBundle(e,t.root),n=as.merge(r);return as.filter(n,t)}var IRe="clipping-controls";async function ARe(e,t,r,n,o){await Nft(e,t,async(i,a,s)=>{if(o&&o.length>0&&!o.includes(a.params.values.type.name))return;let l=a.obj.data.sourceData,u=await n(l.root);if(nr.isEmpty(u)||Oi(u))return;let c={bundle:Q.Bundle.fromLoci(u),groups:r};if(s){let m=[...s.params.values.layers,c],d=vRe(m,l);i.to(s).update(Io.toBundle(d))}else{let m=vRe([c],l);i.to(a.transform.ref).apply(Qe.Representation.ClippingStructureRepresentation3DFromBundle,Io.toBundle(m),{tags:IRe})}})}async function Nft(e,t,r){let n=e.state.data,o=n.build();for(let i of t)for(let a of i.representations){let s=n.select(tr.Generators.ofTransformer(Qe.Representation.ClippingStructureRepresentation3DFromBundle,a.cell.transform.ref).withTag(IRe));await r(o,a.cell,s[0])}return o.commit({doNotUpdateCurrent:!0})}function vRe(e,t){let r=Io.ofBundle(e,t.root),n=Io.merge(r);return Io.filter(n,t)}var PRe="transparency-controls";async function _Re(e,t,r,n,o){await zft(e,t,async(i,a,s)=>{if(o&&o.length>0&&!o.includes(a.params.values.type.name))return;let l=a.obj.data.sourceData,u=await n(l.root);if(nr.isEmpty(u)||Oi(u))return;let c={bundle:Q.Bundle.fromLoci(u),value:r};if(s){let m=[...s.params.values.layers,c],d=TRe(m,l);i.to(s).update(ss.toBundle(d))}else{let m=TRe([c],l);i.to(a.transform.ref).apply(Qe.Representation.TransparencyStructureRepresentation3DFromBundle,ss.toBundle(m),{tags:PRe})}})}async function zft(e,t,r){let n=e.state.data,o=n.build();for(let i of t)for(let a of i.representations){let s=n.select(tr.Generators.ofTransformer(Qe.Representation.TransparencyStructureRepresentation3DFromBundle,a.cell.transform.ref).withTag(PRe));await r(o,a.cell,s[0])}return o.commit({doNotUpdateCurrent:!0})}function TRe(e,t){let r=ss.ofBundle(e,t.root),n=ss.merge(r);return ss.filter(n,t)}var DRe="substance-controls";async function Iq(e,t,r,n,o){await Hft(e,t,async(i,a,s)=>{if(o&&o.length>0&&!o.includes(a.params.values.type.name))return;let l=a.obj.data.sourceData,u=await n(l.root);if(nr.isEmpty(u)||Oi(u))return;let c={bundle:Q.Bundle.fromLoci(u),material:r??Hi(),clear:!r};if(s){let m=[...s.params.values.layers,c],d=RRe(m,l);i.to(s).update(ls.toBundle(d))}else{let m=RRe([c],l);i.to(a.transform.ref).apply(Qe.Representation.SubstanceStructureRepresentation3DFromBundle,ls.toBundle(m),{tags:DRe})}})}async function Hft(e,t,r){let n=e.state.data,o=n.build();for(let i of t)for(let a of i.representations){let s=n.select(tr.Generators.ofTransformer(Qe.Representation.SubstanceStructureRepresentation3DFromBundle,a.cell.transform.ref).withTag(DRe));await r(o,a.cell,s[0])}return o.commit({doNotUpdateCurrent:!0})}function RRe(e,t){let r=ls.ofBundle(e,t.root),n=ls.merge(r);return ls.filter(n,t)}var MRe="emissive-controls";async function BRe(e,t,r,n,o){await jft(e,t,async(i,a,s)=>{if(o&&o.length>0&&!o.includes(a.params.values.type.name))return;let l=a.obj.data.sourceData,u=await n(l.root);if(nr.isEmpty(u)||Oi(u))return;let c={bundle:Q.Bundle.fromLoci(u),value:r};if(s){let m=[...s.params.values.layers,c],d=wRe(m,l);i.to(s).update(us.toBundle(d))}else{let m=wRe([c],l);i.to(a.transform.ref).apply(Qe.Representation.EmissiveStructureRepresentation3DFromBundle,us.toBundle(m),{tags:MRe})}})}async function jft(e,t,r){let n=e.state.data,o=n.build();for(let i of t)for(let a of i.representations){let s=n.select(tr.Generators.ofTransformer(Qe.Representation.EmissiveStructureRepresentation3DFromBundle,a.cell.transform.ref).withTag(MRe));await r(o,a.cell,s[0])}return o.commit({doNotUpdateCurrent:!0})}function wRe(e,t){let r=us.ofBundle(e,t.root),n=us.merge(r);return us.filter(n,t)}var Kp=class e extends qs{constructor(r){super({options:C.getDefaultValues(e.OptionsParams)});this.plugin=r;this.events={optionsUpdated:this.ev()}}get currentStructures(){return this.plugin.managers.structure.hierarchy.selection.structures}get pivotStructure(){return this.currentStructures[0]}_setSnapshotState(r){this.updateState({options:r}),this.events.optionsUpdated.next(void 0)}async setOptions(r){let n=r.interactions!==this.state.options.interactions;this.updateState({options:r}),this.events.optionsUpdated.next(void 0);let o=this.dataState.build();for(let i of this.currentStructures)for(let a of i.components)this.updateReprParams(o,a);return this.plugin.dataTransaction(async()=>{await o.commit(),await this.plugin.state.updateBehavior(w1,i=>{i.ignoreHydrogens=r.hydrogens!=="all",i.ignoreHydrogensVariant=r.hydrogens==="only-polar"?"non-polar":"all",i.ignoreLight=r.ignoreLight,i.material=r.materialStyle,i.clip=r.clipObjects,i.interior=r.interior}),n&&await this.updateInterationProps()})}updateReprParams(r,n){let{hydrogens:o,visualQuality:i,ignoreLight:a,materialStyle:s,clipObjects:l,interior:u}=this.state.options,c=o!=="all",m=o==="only-polar"?"non-polar":"all";for(let d of n.representations){if(d.cell.transform.transformer!==Od)continue;let p=d.cell.transform.params;(!!p.type.params.ignoreHydrogens!==c||p.type.params.ignoreHydrogensVariant!==m||p.type.params.quality!==i||p.type.params.ignoreLight!==a||!Hi.areEqual(p.type.params.material,s)||!C.areEqual(Zf.Params,p.type.params.clip,l)||!pbe(p.type.params.interior,u))&&r.to(d.cell).update(h=>{h.type.params.ignoreHydrogens=c,h.type.params.ignoreHydrogensVariant=m,h.type.params.quality=i,h.type.params.ignoreLight=a,h.type.params.material=s,h.type.params.clip=l,h.type.params.interior=u})}}async updateInterationProps(){for(let r of this.currentStructures){let n=Si.getParams(r.cell.obj?.data);if(r.properties){let o=r.properties.cell.transform.params?.properties[Si.descriptor.name];if(C.areEqual(n,o,this.state.options.interactions))continue;await this.dataState.build().to(r.properties.cell).update(i=>{i.properties[Si.descriptor.name]=this.state.options.interactions}).commit()}else{let o=this.plugin.customStructureProperties.getParams(r.cell.obj?.data),i=C.getDefaultValues(o);if(C.areEqual(n,i.properties[Si.descriptor.name],this.state.options.interactions))continue;i.properties[Si.descriptor.name]=this.state.options.interactions,await this.plugin.builders.structure.insertStructureProperties(r.cell,i)}}}applyPreset(r,n,o){return this.plugin.dataTransaction(async()=>{for(let i of r){let a=await this.plugin.builders.structure.representation.applyPreset(i.cell,n,o);await this.syncPreset(i,a)}},{canUndo:"Preset"})}syncPreset(r,n){if(!n||!n.components)return this.clearComponents([r]);let o=new Set;if(wi(n.components,l=>{l&&o.add(l.ref)}),n.representations&&wi(n.representations,l=>{l&&o.add(l.ref)}),o.size===0)return this.clearComponents([r]);let i=!1,a=this.dataState.build(),s=l=>{o.has(l.cell.transform.ref)||(i=!0,a.delete(l.cell))};for(let l of r.components){s(l);for(let u of l.representations)s(u);if(l.genericRepresentations)for(let u of l.genericRepresentations)s(u)}if(r.genericRepresentations)for(let l of r.genericRepresentations)s(l);if(i)return a.commit()}clear(r){return this.clearComponents(r)}selectThis(r){let n=this.plugin.managers.structure.selection;n.clear();for(let o of r){let i=De.toSubStructureElementLoci(o.structure.cell.obj.data,o.cell.obj?.data);n.fromLoci("set",i)}}canBeModified(r){return this.plugin.builders.structure.isComponentTransform(r.cell)}modifyByCurrentSelection(r,n){return this.plugin.runTask(Ae.create("Modify Component",async o=>{let i=this.dataState.build();for(let a of r){if(!this.canBeModified(a))continue;let s=this.plugin.managers.structure.selection.getStructure(a.structure.cell.obj.data);!s||s.elementCount===0||this.modifyComponent(i,a,s,n)}await this.dataState.updateTree(i,{canUndo:"Modify Selection"}).runInContext(o)}))}toggleVisibility(r,n){if(r.length!==0)if(n){let o=r[0].representations.indexOf(n),i=!n.cell.state.isHidden;for(let a of r){let s=a.representations[o];s&&uh(this.dataState,s.cell.transform.ref,i)}}else{let o=!r[0].cell.state.isHidden;for(let i of r)uh(this.dataState,i.cell.transform.ref,o)}}removeRepresentations(r,n){if(r.length===0)return;let o=[];if(n){let i=r[0].representations.indexOf(n);if(i<0)return;for(let a of r)a.representations[i]&&o.push(a.representations[i])}else for(let i of r)for(let a of i.representations)o.push(a);return this.plugin.managers.structure.hierarchy.remove(o,!0)}updateRepresentations(r,n,o){if(r.length===0)return Promise.resolve();let i=r[0].representations.indexOf(n);if(i<0)return Promise.resolve();let a=this.dataState.build();for(let s of r){let l=s.representations[i];l&&l.cell.transform.transformer===n.cell.transform.transformer&&a.to(l.cell).update(o)}return a.commit({canUndo:"Update Representation"})}updateRepresentationsTheme(r,n){if(r.length===0)return;let o=this.dataState.build();for(let i of r)for(let a of i.representations){let s=a.cell.transform.params,l=typeof n=="function"?n(i,a):n,u=l.color==="default"?_D(this.plugin,i.structure.cell.obj?.data,s?.type.name):l.color?_D(this.plugin,i.structure.cell.obj?.data,s?.type.name,l.color,l.colorParams):void 0,c=l.size==="default"?zZ(this.plugin,i.structure.cell.obj?.data,s?.type.name):l.color?zZ(this.plugin,i.structure.cell.obj?.data,s?.type.name,l.size,l.sizeParams):void 0;(u||c)&&o.to(a.cell).update(m=>{u&&(m.colorTheme=u),c&&(m.sizeTheme=c)})}return o.commit({canUndo:"Update Theme"})}addRepresentation(r,n){if(r.length===0)return;let{hydrogens:o,visualQuality:i,ignoreLight:a,materialStyle:s,clipObjects:l,interior:u}=this.state.options,d={ignoreHydrogens:o!=="all",ignoreHydrogensVariant:o==="only-polar"?"non-polar":"all",quality:i,ignoreLight:a,material:s,clip:l,interior:u};return this.plugin.dataTransaction(async()=>{for(let p of r)await this.plugin.builders.structure.representation.addRepresentation(p.cell,{type:this.plugin.representation.structure.registry.get(n),typeParams:d})},{canUndo:"Add Representation"})}tryFindComponent(r,n){if(r.components.length!==0)return this.plugin.runTask(Ae.create("Find Component",async o=>{let i=r.cell.obj?.data;if(!i)return;let a=ut.unionStructure(await n.getSelection(this.plugin,o,i));for(let s of r.components){let l=s.cell.obj?.data;if(!(!l||!s.cell.parent)&&Zme(a,l))return s.cell}}))}async add(r,n){return this.plugin.dataTransaction(async()=>{let o=n||this.currentStructures;if(o.length===0)return;let{hydrogens:i,visualQuality:a,ignoreLight:s,materialStyle:l,clipObjects:u,interior:c}=this.state.options,p={ignoreHydrogens:i!=="all",ignoreHydrogensVariant:i==="only-polar"?"non-polar":"all",quality:a,ignoreLight:s,material:l,clip:u,interior:c},h=fn.create22();for(let f of o){let g;r.options.checkExisting&&(g=await this.tryFindComponent(f,r.selection)),g||(g=await this.plugin.builders.structure.tryCreateComponentFromSelection(f.cell,r.selection,h,{label:r.options.label||(r.selection===oi.current?"Custom Selection":"")})),!(r.representation==="none"||!g)&&await this.plugin.builders.structure.representation.addRepresentation(g,{type:this.plugin.representation.structure.registry.get(r.representation),typeParams:p})}},{canUndo:"Add Selection"})}async applyTheme(r,n){return this.plugin.dataTransaction(async o=>{let i=n||this.currentStructures;if(i.length===0)return;let a=async s=>ut.toLociWithSourceUnits(await r.selection.getSelection(this.plugin,o,s));for(let s of i)if(r.action.name==="color"){let l=r.action.params;await vq(this.plugin,s.components,l.color,a,r.representations)}else if(r.action.name==="resetColor")await vq(this.plugin,s.components,-1,a,r.representations);else if(r.action.name==="transparency"){let l=r.action.params;await _Re(this.plugin,s.components,l.value,a,r.representations)}else if(r.action.name==="emissive"){let l=r.action.params;await BRe(this.plugin,s.components,l.value,a,r.representations)}else if(r.action.name==="material"){let l=r.action.params;await Iq(this.plugin,s.components,l.material,a,r.representations)}else if(r.action.name==="resetMaterial")await Iq(this.plugin,s.components,void 0,a,r.representations);else if(r.action.name==="clipping"){let l=r.action.params;await ARe(this.plugin,s.components,Io.Groups.fromNames(l.excludeGroups),a,r.representations)}},{canUndo:"Apply Theme"})}modifyComponent(r,n,o,i){let a=n.cell.obj?.data;if(!a||(i==="subtract"||i==="intersect")&&!FI(a,o))return;let s=n.structure.cell.obj?.data,l=i==="union"?Ky(s,[a,o]):i==="intersect"?LE(a,o):LI(a,o);if(l.elementCount===0)r.delete(n.cell.transform.ref);else{let c={type:{name:"bundle",params:Q.Bundle.fromSubStructure(s,l)},nullIfEmpty:!0,label:n.cell.obj?.label};r.to(n.cell).update(c)}}updateLabel(r,n){let o={type:r.cell.params?.values.type,nullIfEmpty:r.cell.params?.values.nullIfEmpty,label:n};this.dataState.build().to(r.cell).update(o).commit()}get dataState(){return this.plugin.state.data}clearComponents(r){let n=this.dataState.build();for(let o of r)for(let i of o.components)n.delete(i.cell.transform.ref);return n.commit({canUndo:"Clear Selections"})}};(i=>{i.OptionsParams={hydrogens:C.Select("all",[["all","Show All"],["hide-all","Hide All"],["only-polar","Only Polar"]],{description:"Determine display of hydrogen atoms in representations"}),visualQuality:C.Select("auto",cR,{description:"Control the visual/rendering quality of representations"}),ignoreLight:C.Boolean(!1,{description:"Ignore light for stylized rendering of representations"}),materialStyle:Hi.getParam(),clipObjects:C.Group(Zf.Params),interactions:C.Group(Si.defaultParams,{label:"Non-covalent Interactions"}),interior:vp()};function t(a,s){let{options:l}=a.query.structure.registry;return s={pivot:a.managers.structure.component.pivotStructure,allowNone:!0,hideSelection:!1,checkExisting:!1,...s},{selection:C.Select(l[1][0],l,{isHidden:s?.hideSelection}),representation:o(a,s?.pivot,s?.allowNone?[["none","< Create Later >"]]:[]),options:C.Group({label:C.Text(""),checkExisting:C.Boolean(!!s?.checkExisting,{help:()=>({description:"Checks if a selection with the specifield elements already exists to avoid creating duplicate components."})})})}}i.getAddParams=t;function r(a,s){let{options:l}=a.query.structure.registry;return{selection:C.Select(l[1][0],l,{isHidden:!1}),action:C.MappedStatic("color",{color:C.Group({color:C.Color(Lt.blue,{isExpanded:!0})},{isFlat:!0}),resetColor:C.EmptyGroup({label:"Reset Color"}),transparency:C.Group({value:C.Numeric(.5,{min:0,max:1,step:.01})},{isFlat:!0}),emissive:C.Group({value:C.Numeric(.5,{min:0,max:1,step:.01})},{isFlat:!0}),material:C.Group({material:Hi.getParam({isFlat:!0})},{isFlat:!0}),resetMaterial:C.EmptyGroup({label:"Reset Material"}),clipping:C.Group({excludeGroups:C.MultiSelect([],C.objectToOptions(Io.Groups.Names))},{isFlat:!0})}),representations:C.MultiSelect([],n(a,s),{emptyValue:"All"})}}i.getThemeParams=r;function n(a,s){return s?.cell.obj?.data?a.representation.structure.registry.getApplicableTypes(s.cell.obj?.data):a.representation.structure.registry.types}i.getRepresentationTypes=n;function o(a,s,l,u){let c=[...l,...n(a,s)];return C.Select(c[0][0],c,{label:u})}})(Kp||={});var kD;(i=>{function e(a,s){return{key:a,data:s}}function t(a){return{entries:G_(),capacity:Math.max(1,a)}}i.create=t;function r(a,s){for(let l=a.entries.first;l;l=l.next)if(l.value.key===s)return a.entries.remove(l),a.entries.addLast(l.value),l.value.data}i.get=r;function n(a,s,l){let u;if(a.entries.count>=a.capacity){let c=a.entries.first;u=c.value.data,a.entries.remove(c)}return a.entries.addLast(e(s,l)),u}i.set=n;function o(a,s){for(let l=a.entries.first;l;l=l.next)if(l.value.key===s){a.entries.remove(l);break}}i.remove=o})(kD||={});var dO=class{constructor(t=!1){this.isRunning=!1,this.queue=[],this.counter=0,this.log=t}enqueue(t){this.log&&console.log("SingleAsyncQueue enqueue",this.counter),this.queue[0]={id:this.counter,func:t},this.counter++,this.run()}async run(){if(this.isRunning)return;let t=this.queue.pop();if(t){this.isRunning=!0;try{this.log&&console.log("SingleAsyncQueue run",t.id),await t.func(),this.log&&console.log("SingleAsyncQueue complete",t.id)}finally{this.isRunning=!1,this.run()}}}};var ws=class extends ne.CreateBehavior({name:"Volume Streaming"}){};(c=>{c.RootTag="volume-streaming-info";function t(m,d,p,h,f={}){return C.Group({isoValue:Ge.createIsoValueParam(f.isoValue??p,h),color:C.Color(f.color??d),wireframe:C.Boolean(f.wireframe??!1),opacity:C.Numeric(f.opacity??.3,{min:0,max:1,step:.01})},{label:m,isExpanded:!0})}let r={byteOffset:0,rate:1,sampleCount:[1,1,1],valuesInfo:[{mean:0,min:-1,max:1,sigma:.1},{mean:0,min:-1,max:1,sigma:.1}]};function n(m={}){let{data:d,defaultView:p,channelParams:h}=m,f=new Map;d&&d.entries.forEach(x=>f.set(x.dataId,x));let g=d?d.entries.map(x=>[x.dataId,x.dataId]):[],y=d?d.entries[0].dataId:"";return{entry:C.Mapped(y,g,x=>C.Group(o({entryData:f.get(x),defaultView:p,structure:d&&d.structure,channelParams:h})))}}c.createParams=n;function o(m){let{entryData:d,defaultView:p,structure:h,channelParams:f={}}=m,g=d||{kind:"em",header:{sampling:[r],availablePrecisions:[{precision:0,maxVoxels:0}]},emDefaultContourLevel:Ge.IsoValue.relative(0)},y=h&&h.boundary.box||pt();return{view:C.MappedStatic(p||(g.kind==="em"?"auto":"selection-box"),{off:C.Group({}),box:C.Group({bottomLeft:C.Vec3(y.min),topRight:C.Vec3(y.max)},{description:"Static box defined by cartesian coords.",isFlat:!0}),"selection-box":C.Group({radius:C.Numeric(5,{min:0,max:50,step:.5},{description:"Radius in \u212B within which the volume is shown."}),bottomLeft:C.Vec3(b.create(0,0,0),{},{isHidden:!0}),topRight:C.Vec3(b.create(0,0,0),{},{isHidden:!0})},{description:"Box around focused element.",isFlat:!0}),"camera-target":C.Group({radius:C.Numeric(.5,{min:0,max:1,step:.05},{description:"Radius within which the volume is shown (relative to the field of view)."}),dynamicDetailLevel:i(g.header.availablePrecisions,0,{label:"Dynamic Detail"}),bottomLeft:C.Vec3(b.create(0,0,0),{},{isHidden:!0}),topRight:C.Vec3(b.create(0,0,0),{},{isHidden:!0})},{description:"Box around camera target.",isFlat:!0}),cell:C.Group({}),auto:C.Group({radius:C.Numeric(5,{min:0,max:50,step:.5},{description:"Radius in \u212B within which the volume is shown."}),selectionDetailLevel:i(g.header.availablePrecisions,6,{label:"Selection Detail"}),isSelection:C.Boolean(!1,{isHidden:!0}),bottomLeft:C.Vec3(y.min,{},{isHidden:!0}),topRight:C.Vec3(y.max,{},{isHidden:!0})},{description:"Box around focused element.",isFlat:!0})},{options:c.ViewTypeOptions,description:'Controls what of the volume is displayed. "Off" hides the volume alltogether. "Bounded box" shows the volume inside the given box. "Around Interaction" shows the volume around the focused element/atom. "Whole Structure" shows the volume for the whole structure.'}),detailLevel:i(g.header.availablePrecisions,3),channels:g.kind==="em"?C.Group({em:t("EM",6524815,g.emDefaultContourLevel||Ge.IsoValue.relative(1),g.header.sampling[0].valuesInfo[0],f.em)},{isFlat:!0}):C.Group({"2fo-fc":t("2Fo-Fc",3367602,Ge.IsoValue.relative(1.5),g.header.sampling[0].valuesInfo[0],f["2fo-fc"]),"fo-fc(+ve)":t("Fo-Fc(+ve)",3390259,Ge.IsoValue.relative(3),g.header.sampling[0].valuesInfo[1],f["fo-fc(+ve)"]),"fo-fc(-ve)":t("Fo-Fc(-ve)",12268339,Ge.IsoValue.relative(-3),g.header.sampling[0].valuesInfo[1],f["fo-fc(-ve)"])},{isFlat:!0})}}c.createEntryParams=o;function i(m,d,p){return C.Select(Math.min(d,m.length-1),m.map((h,f)=>[f,`${f+1} [ ${Math.pow(h.maxVoxels,1/3)|0}^3 cells ]`]),{description:"Determines the maximum number of voxels. Depending on the size of the volume options are in the range from 1 (0.52M voxels) to 7 (25.17M voxels).",...p})}function a(m){return{entry:{name:m.entry.name,params:{detailLevel:m.entry.params.detailLevel,channels:m.entry.params.channels,view:{name:m.entry.params.view.name,params:{...m.entry.params.view.params}}}}}}c.copyParams=a,c.ViewTypeOptions=[["off","Off"],["box","Bounded Box"],["selection-box","Around Focus"],["camera-target","Around Camera"],["cell","Whole Structure"],["auto","Auto"]],c.ChannelTypeOptions=[["em","em"],["2fo-fc","2fo-fc"],["fo-fc(+ve)","fo-fc(+ve)"],["fo-fc(-ve)","fo-fc(-ve)"]];class u extends Kr.WithSubscribers{constructor(p,h){super(p,{});this.plugin=p;this.data=h;this.cache=kD.create(25);this.params={};this.lastLoci=vr;this.ref="";this.cameraTargetObservable=this.plugin.canvas3d.didDraw.pipe(Xu(500,void 0,{leading:!0,trailing:!0}),D0(()=>this.plugin.canvas3d?.camera.getSnapshot()),FP((p,h)=>this.isCameraTargetSame(p,h)),Rh(p=>p!==void 0));this.cameraTargetSubscription=void 0;this.channels={};this._invTransform=H();this.infoMap=new Map,this.data.entries.forEach(f=>this.infoMap.set(f.dataId,f)),this.updateQueue=new dO}get info(){return this.infoMap.get(this.params.entry.name)}async queryData(p){let h=NC(this.data.serverUrl,`${this.info.kind}/${this.info.dataId.toLowerCase()}`);if(p){let{min:v,max:A}=p;h+=`/box/${v.map(P=>Math.round(1e3*P)/1e3).join(",")}/${A.map(P=>Math.round(1e3*P)/1e3).join(",")}`}else h+="/cell";let f=this.params.entry.params.detailLevel;this.params.entry.params.view.name==="auto"&&this.params.entry.params.view.params.isSelection&&(f=this.params.entry.params.view.params.selectionDetailLevel),this.params.entry.params.view.name==="camera-target"&&p&&(f=this.decideDetail(p,this.params.entry.params.view.params.dynamicDetailLevel)),h+=`?detail=${f}`;let g=kD.get(this.cache,h);if(g)return g.data;let y=sn.getUrlAsset(this.plugin.managers.asset,h),x=await this.plugin.runTask(this.plugin.managers.asset.resolve(y,"binary")),S=await this.parseCif(x.data);if(!S)return;let I=kD.set(this.cache,h,{data:S,asset:x});return I&&I.asset.dispose(),S}async parseCif(p){let h=await this.plugin.runTask(Fu.parseBinary(p));if(h.isError){this.plugin.log.error("VolumeStreaming, parsing CIF: "+h.toString());return}if(h.result.blocks.length<2){this.plugin.log.error("VolumeStreaming: Invalid data.");return}let f={};for(let g=1;g<h.result.blocks.length;g++){let y=h.result.blocks[g],x=Fu.schema.densityServer(y),S=await this.plugin.runTask(qk(x));f[y.header]=S}return f}async updateParams(p,h=!1){let f=a(this.params),g=f.entry.params.view.name;g!=="off"&&g!=="cell"&&(f.entry.params.view.params.bottomLeft=p?.min||b.zero(),f.entry.params.view.params.topRight=p?.max||b.zero()),g==="auto"&&(f.entry.params.view.params.isSelection=h);let y=this.plugin.state.data,x=y.build().to(this.ref).update(f);await lt.State.Update(this.plugin,{state:y,tree:x,options:{doNotUpdateCurrent:!0}})}getStructureRoot(){return this.plugin.state.data.select(tr.Generators.byRef(this.ref).rootOfType(ne.Molecule.Structure))[0]}register(p){this.ref=p,this.subscribeObservable(this.plugin.state.events.object.removed,h=>{!ne.Molecule.Structure.is(h.obj)||!Q.Loci.is(this.lastLoci)||this.lastLoci.structure===h.obj.data&&(this.lastLoci=vr)}),this.subscribeObservable(this.plugin.state.events.object.updated,h=>{!ne.Molecule.Structure.is(h.oldObj)||!Q.Loci.is(this.lastLoci)||this.lastLoci.structure===h.oldObj.data&&(this.lastLoci=vr)}),this.subscribeObservable(this.plugin.managers.structure.focus.behaviors.current,h=>{if(!this.plugin.state.data.tree.children.has(this.ref))return;let f=h?h.loci:vr;switch(this.params.entry.params.view.name){case"auto":this.updateAuto(f);break;case"selection-box":this.updateSelectionBox(f);break;default:this.lastLoci=f;break}})}unregister(){let p=this.cache.entries.first;for(;p;)p.value.data.asset.dispose(),p=p.next}isCameraTargetSame(p,h){if(!p||!h)return!1;let f=b.equals(p.target,h.target),g=b.squaredDistance(p.target,p.position),y=b.squaredDistance(h.target,h.position),x=Math.abs(g-y)/g<.001;return f&&x}cameraTargetDistance(p){return b.distance(p.target,p.position)}getBoxFromLoci(p){if(nr.isEmpty(p)||Oi(p))return pt();let h=this.plugin.helpers.substructureParent.get(p.structure,!0);if(!h)return pt();let f=this.getStructureRoot();if(!f||f.obj?.data!==h.obj?.data)return pt();let g=tb.get(f.obj?.data.models[0]);g&&H.invert(this._invTransform,g);let y=Q.Loci.extendToWholeResidues(p),x=Q.Loci.getBoundary(y,g&&!Number.isNaN(this._invTransform[0])?this._invTransform:void 0).box;return Q.Loci.size(y)===1&&pt.expand(x,x,b.create(1,1,1)),x}updateAuto(p){this.updateQueue.enqueue(async()=>{this.lastLoci=p,Oi(p)?await this.updateParams(this.info.kind==="x-ray"?this.data.structure.boundary.box:void 0,!1):await this.updateParams(this.getBoxFromLoci(p),!0)})}updateSelectionBox(p){this.updateQueue.enqueue(async()=>{nr.areEqual(this.lastLoci,p)?this.lastLoci=vr:this.lastLoci=p;let h=this.getBoxFromLoci(this.lastLoci);await this.updateParams(h)})}updateCameraTarget(p){this.updateQueue.enqueue(async()=>{let h=this.plugin.canvas3d?.props.camera.manualReset;try{h||this.plugin.canvas3d?.setProps({camera:{manualReset:!0}});let f=this.boxFromCameraTarget(p,!0);await this.updateParams(f)}finally{h||this.plugin.canvas3d?.setProps({camera:{manualReset:h}})}})}boxFromCameraTarget(p,h){let f=p.target,g=this.cameraTargetDistance(p),x=Math.tan(.5*p.fov)*g,S=this.plugin.canvas3d?.camera.viewport;S&&S.width>S.height&&(x*=S.width/S.height);let I=this.params.entry.params.view.name==="camera-target"?this.params.entry.params.view.params.radius:.5;x*=I;let v,A,P;if(h){let T=b.zero();pt.size(T,this.data.structure.boundary.box),v=Math.min(x,.5*T[0]),A=Math.min(x,.5*T[1]),P=Math.min(x,.5*T[2])}else v=A=P=x;return pt.create(b.create(f[0]-v,f[1]-A,f[2]-P),b.create(f[0]+v,f[1]+A,f[2]+P))}decideDetail(p,h){let f=this.info.kind==="x-ray"?pt.volume(this.data.structure.boundary.box):this.info.header.spacegroup.size.reduce((I,v)=>I*v,1),y=pt.volume(p)/f,x=this.info.header.availablePrecisions.length-1,S=h;for(;y<=.5&&S<x;)y*=2,S+=1;return S}async update(p){let h=p.entry.params.view.name==="selection-box"&&this.params&&this.params.entry&&this.params.entry.params&&this.params.entry.params.view&&this.params.entry.params.view.name!=="selection-box";this.params=p;let f,g=!1;switch(p.entry.params.view.name!=="camera-target"&&this.cameraTargetSubscription&&(this.cameraTargetSubscription.unsubscribe(),this.cameraTargetSubscription=void 0),p.entry.params.view.name){case"off":g=!0;break;case"box":f=pt.create(p.entry.params.view.params.bottomLeft,p.entry.params.view.params.topRight),g=pt.volume(f)<1e-4;break;case"selection-box":{h?f=this.getBoxFromLoci(this.lastLoci)||pt():f=pt.create(b.clone(p.entry.params.view.params.bottomLeft),b.clone(p.entry.params.view.params.topRight));let S=p.entry.params.view.params.radius;g=pt.volume(f)<1e-4,pt.expand(f,f,b.create(S,S,S));break}case"camera-target":this.cameraTargetSubscription||(this.cameraTargetSubscription=this.subscribeObservable(this.cameraTargetObservable,S=>this.updateCameraTarget(S))),f=this.boxFromCameraTarget(this.plugin.canvas3d.camera.getSnapshot(),!0);break;case"cell":f=this.info.kind==="x-ray"?this.data.structure.boundary.box:void 0;break;case"auto":if(f=p.entry.params.view.params.isSelection||this.info.kind==="x-ray"?pt.create(b.clone(p.entry.params.view.params.bottomLeft),b.clone(p.entry.params.view.params.topRight)):void 0,f&&(g=pt.volume(f)<1e-4,p.entry.params.view.params.isSelection)){let S=p.entry.params.view.params.radius;pt.expand(f,f,b.create(S,S,S))}break}let y=g?{}:await this.queryData(f);if(!y)return!1;let x=p.entry.params.channels;return this.info.kind==="x-ray"?(this.channels["2fo-fc"]=this.createChannel(y["2FO-FC"]||Ge.One,x["2fo-fc"],this.info.header.sampling[0].valuesInfo[0]),this.channels["fo-fc(+ve)"]=this.createChannel(y["FO-FC"]||Ge.One,x["fo-fc(+ve)"],this.info.header.sampling[0].valuesInfo[1]),this.channels["fo-fc(-ve)"]=this.createChannel(y["FO-FC"]||Ge.One,x["fo-fc(-ve)"],this.info.header.sampling[0].valuesInfo[1])):this.channels.em=this.createChannel(y.EM||Ge.One,x.em,this.info.header.sampling[0].valuesInfo[0]),!0}createChannel(p,h,f){let g=h;return{data:p,color:g.color,wireframe:g.wireframe,opacity:g.opacity,isoValue:g.isoValue.kind==="relative"?g.isoValue:Ge.IsoValue.toRelative(g.isoValue,f)}}getDescription(){return this.params.entry.params.view.name==="selection-box"?"Selection":this.params.entry.params.view.name==="camera-target"?"Camera":this.params.entry.params.view.name==="box"?"Static Box":this.params.entry.params.view.name==="cell"?"Cell":""}}c.Behavior=u})(ws||={});function VRe(e,t){let r=tht(e,t||fO());return iht(e.tree,r),t&&t.refs.forEach(nht,r),{hierarchy:r.hierarchy,added:r.added,changed:r.changed}}function fO(){return{trajectories:[],models:[],structures:[],refs:new Map}}function Wft(e){return{kind:"trajectory",cell:e,version:e.transform.version,models:[]}}function ERe(e,t){return{kind:"model",cell:e,version:e.transform.version,trajectory:t,structures:[]}}function Xft(e,t){return{kind:"model-properties",cell:e,version:e.transform.version,model:t}}function Qft(e,t){return{kind:"model-unitcell",cell:e,version:e.transform.version,model:t}}function kRe(e,t){return{kind:"structure",cell:e,version:e.transform.version,model:t,components:[]}}function Zft(e,t){return{kind:"structure-properties",cell:e,version:e.transform.version,structure:t}}function qft(e,t){return{kind:"structure-transform",cell:e,version:e.transform.version,structure:t}}function Yft(e,t){return{kind:"structure-volume-streaming",cell:e,version:e.transform.version,structure:t}}function Kft(e){return e.transform.tags?[...e.transform.tags].sort().join():e.transform.ref}function Jft(e,t){return{kind:"structure-component",cell:e,version:e.transform.version,structure:t,key:Kft(e),representations:[]}}function $ft(e,t){return{kind:"structure-representation",cell:e,version:e.transform.version,component:t}}function eht(e,t){return{kind:"generic-representation",cell:e,version:e.transform.version,parent:t}}function tht(e,t){return{state:e,oldHierarchy:t,hierarchy:fO(),changed:!1,added:new Set}}function BT(e,t,r,n,...o){let i=n(...o);r.push(i),e.hierarchy.refs.set(t.transform.ref,i);let a=e.oldHierarchy.refs.get(t.transform.ref);return a?a.version!==t.transform.version&&(e.changed=!0):(e.added.add(i.cell.transform.ref),e.changed=!0),i}function E1(e,t,r,...n){let o=r(...n);e.hierarchy.refs.set(t.transform.ref,o);let i=e.oldHierarchy.refs.get(t.transform.ref);return i?i.version!==t.transform.version&&(e.changed=!0):(e.added.add(o.cell.transform.ref),e.changed=!0),o}function FRe(e){return t=>e.is(t.obj)}function LRe(e,t){return(r,n)=>!t(n)&&e.is(r.obj)}function pO(e){return t=>t.transform.transformer===e}function k1(){}var rht=[[FRe(ne.Molecule.Trajectory),(e,t)=>{e.currentTrajectory=BT(e,t,e.hierarchy.trajectories,Wft,t)},e=>e.currentTrajectory=void 0],[LRe(ne.Molecule.Model,e=>e.currentModel),(e,t)=>{e.currentTrajectory?e.currentModel=BT(e,t,e.currentTrajectory.models,ERe,t,e.currentTrajectory):e.currentModel=E1(e,t,ERe,t),e.hierarchy.models.push(e.currentModel)},e=>e.currentModel=void 0],[pO(Qe.Model.CustomModelProperties),(e,t)=>{if(!e.currentModel)return!1;e.currentModel.properties=E1(e,t,Xft,t,e.currentModel)},k1],[pO(Qe.Representation.ModelUnitcell3D),(e,t)=>{if(!e.currentModel)return!1;e.currentModel.unitcell=E1(e,t,Qft,t,e.currentModel)},k1],[LRe(ne.Molecule.Structure,e=>e.currentStructure),(e,t)=>{e.currentModel?e.currentStructure=BT(e,t,e.currentModel.structures,kRe,t,e.currentModel):e.currentStructure=E1(e,t,kRe,t),e.hierarchy.structures.push(e.currentStructure)},e=>e.currentStructure=void 0],[pO(Qe.Model.CustomStructureProperties),(e,t)=>{if(!e.currentStructure)return!1;e.currentStructure.properties=E1(e,t,Zft,t,e.currentStructure)},k1],[pO(Qe.Model.TransformStructureConformation),(e,t)=>{if(!e.currentStructure)return!1;e.currentStructure.transform=E1(e,t,qft,t,e.currentStructure)},k1],[FRe(ws),(e,t)=>(e.currentStructure&&(e.currentStructure.volumeStreaming=E1(e,t,Yft,t,e.currentStructure)),!1),k1],[(e,t)=>!t.currentStructure||e.transform.transformer.definition.isDecorator?!1:ne.Molecule.Structure.is(e.obj),(e,t)=>{e.currentStructure&&(e.currentComponent&&(e.parentComponents||(e.parentComponents=[]),e.parentComponents.push(e.currentComponent)),e.currentComponent=BT(e,t,e.currentStructure.components,Jft,t,e.currentStructure))},e=>{e.parentComponents&&e.parentComponents.length>0?e.currentComponent=e.parentComponents.pop():e.currentComponent=void 0}],[(e,t)=>!e.state.isGhost&&!!t.currentComponent&&ne.Molecule.Structure.Representation3D.is(e.obj),(e,t)=>(e.currentComponent&&BT(e,t,e.currentComponent.representations,$ft,t,e.currentComponent),!1),k1],[e=>!e.state.isGhost&&ne.isRepresentation3D(e.obj),(e,t)=>{let r=e.currentComponent||e.currentStructure||e.currentModel;r&&(r.genericRepresentations||(r.genericRepresentations=[]),BT(e,t,r.genericRepresentations,eht,t,r))},k1]];function ORe(e){if(!e||!e?.parent||!e.parent.cells.has(e.transform.ref))return!1;let{obj:t}=e;return!(!t||t===Gn.Null||e.status!=="ok"&&e.status!=="error")}function nht(e){let{cell:t}=e;ORe(t)||(this.changed=!0)}function oht(e){GRe(this,this.tree.transforms.get(e))}function GRe(e,t){let{state:r}=e,n=r.state.cells.get(t.ref);if(!ORe(n))return;let o,i=!1;for(let[s,l,u]of rht)if(s(n,r)){if(l(r,n)===!1){i=!0;break}o=u;break}if(i)return;let a=e.tree.children.get(t.ref);a&&a.size&&a.forEach(oht,e),o&&o(r)}function iht(e,t){let r={tree:e,state:t};return GRe(r,e.root),r.state}var $g=class e extends Pc{constructor(r){super();this.plugin=r;this.state={syncedTree:this.dataState.tree,notified:!1,hierarchy:fO(),selection:{trajectories:[],models:[],structures:[]}};this.behaviors={selection:this.ev.behavior({hierarchy:this.current,trajectories:this.selection.trajectories,models:this.selection.models,structures:this.selection.structures})};this._currentComponentGroups=void 0;this._currentSelectionSet=void 0;this.subscribe(r.state.data.events.changed,n=>{n.inTransaction||r.behaviors.state.isAnimating.value||this.sync(!0)}),this.subscribe(r.behaviors.state.isAnimating,n=>{!n&&!r.behaviors.state.isUpdating.value&&this.sync(!0)})}get dataState(){return this.plugin.state.data}get currentComponentGroups(){return this._currentComponentGroups?this._currentComponentGroups:(this._currentComponentGroups=e.getComponentGroups(this.selection.structures),this._currentComponentGroups)}get seletionSet(){if(this._currentSelectionSet)return this._currentSelectionSet;this._currentSelectionSet=new Set;for(let r of this.selection.trajectories)this._currentSelectionSet.add(r.cell.transform.ref);for(let r of this.selection.models)this._currentSelectionSet.add(r.cell.transform.ref);for(let r of this.selection.structures)this._currentSelectionSet.add(r.cell.transform.ref);return this._currentSelectionSet}get current(){return this.sync(!1),this.state.hierarchy}get selection(){return this.sync(!1),this.state.selection}getStructuresWithSelection(){let r=this.plugin.managers.structure.hierarchy.current.structures,n=[];for(let o of r)this.plugin.managers.structure.selection.structureHasSelection(o)&&n.push(o);return n}findStructure(r){if(!r)return;let n=this.plugin.helpers.substructureParent.get(r);if(!n)return;let o=this.plugin.state.data.selectQ(i=>i.byValue(n).rootOfType(ne.Molecule.Structure))[0];if(o)return this.behaviors.selection.value.structures.find(i=>i.cell===o)}syncCurrent(r,n){let o=this.seletionSet,i=[];for(let a of r){let s=a.cell.transform.ref;(o.has(s)||n.has(s))&&i.push(a)}return i.length===0?r.length>0?[r[0]]:[]:i}sync(r){if(!r&&this.dataState.inUpdate)return;if(this.state.syncedTree===this.dataState.tree){r&&!this.state.notified&&(this.state.notified=!0,this.behaviors.selection.next({hierarchy:this.state.hierarchy,...this.state.selection}));return}this.state.syncedTree=this.dataState.tree;let n=VRe(this.plugin.state.data,this.current);if(!n.changed)return;let{hierarchy:o}=n,i=this.syncCurrent(o.trajectories,n.added),a=this.syncCurrent(o.models,n.added),s=this.syncCurrent(o.structures,n.added);this._currentComponentGroups=void 0,this._currentSelectionSet=void 0,this.state.hierarchy=o,this.state.selection.trajectories=i,this.state.selection.models=a,this.state.selection.structures=s,r?(this.state.notified=!0,this.behaviors.selection.next({hierarchy:o,trajectories:i,models:a,structures:s})):this.state.notified=!1}updateCurrent(r,n){let o=this.current,i=n==="add"?go.union(this.seletionSet,new Set(r.map(u=>u.cell.transform.ref))):go.difference(this.seletionSet,new Set(r.map(u=>u.cell.transform.ref))),a=[],s=[],l=[];for(let u of o.trajectories)i.has(u.cell.transform.ref)&&a.push(u);for(let u of o.models)i.has(u.cell.transform.ref)&&s.push(u);for(let u of o.structures)i.has(u.cell.transform.ref)&&l.push(u);this._currentComponentGroups=void 0,this._currentSelectionSet=void 0,this.state.selection.trajectories=a,this.state.selection.models=s,this.state.selection.structures=l,this.behaviors.selection.next({hierarchy:o,trajectories:a,models:s,structures:l})}remove(r,n){if(r.length===0)return;let o=this.plugin.state.data.build();for(let i of r)o.delete(typeof i=="string"?i:i.cell.transform.ref);return o.commit({canUndo:n?"Remove":!1})}toggleVisibility(r,n){if(r.length===0)return;let o=n!==void 0?n!=="show":!r[0].cell.state.isHidden;for(let i of r)uh(this.dataState,i.cell.transform.ref,o)}applyPreset(r,n,o){return this.plugin.dataTransaction(async()=>{for(let i of r)i.models.length>0&&await this.clearTrajectory(i),await this.plugin.builders.structure.hierarchy.applyPreset(i.cell,n,o)})}async updateStructure(r,n){await this.plugin.dataTransaction(async()=>{let o=Co.getDecoratorRoot(this.dataState.tree,r.cell.transform.ref),i=this.dataState.tree.children.get(o).toArray();await this.remove(i,!1),await this.plugin.state.updateTransform(this.plugin.state.data,r.cell.transform.ref,n,"Structure Type"),await this.plugin.builders.structure.representation.applyPreset(r.cell.transform.ref,"auto")},{canUndo:"Structure Type"}),lt.Camera.Reset(this.plugin)}clearTrajectory(r){let n=this.dataState.build();for(let o of r.models)n.delete(o.cell);return n.commit()}};(r=>{function e(n){if(!n.length)return[];if(n.length===1)return n[0].components.map(a=>[a]);let o=[],i=new Map;for(let a of n)for(let s of a.components){let l=s.key;if(!l)continue;let u=i.get(l);u||(u=[],i.set(l,u),o.push(u)),u.push(s)}return o}r.getComponentGroups=e;function t(n){let{structures:o}=n.managers.structure.hierarchy.selection;if(o.length===0)return"";if(o.length===1){let l=o[0],u=l.cell.obj?.data;if(!u)return l.cell.obj?.label||"Structure";let c=u.models[0]||u.representativeModel||u.masterModel;if(!c)return l.cell.obj?.label||"Structure";let m=c.entryId;return l.model?.trajectory?.models&&l.model.trajectory.models.length===1?m:l.model?`${l.model.cell.obj?.label} | ${m}`:m}let a=o[0]?.model?.trajectory,s=!0;for(let l of o)if(l?.model?.trajectory!==a){s=!1;break}return s&&a?`${a.cell.obj?.label} | ${o.length} structures`:`${o.length} structures`}r.getSelectedStructuresDescription=t})($g||={});var Ms=_t(ur());var Ch=class extends bi{constructor(){super(...arguments);this.onChange=({name:r,value:n})=>{let o={...this.props.params,[r]:n};this.props.events.onChange(o,this.areInitial(o),this.validate(o))}}validate(r){}areInitial(r){return C.areEqual(this.props.info.params,r,this.props.info.initialValues)}render(){return(0,Ms.jsx)(uo,{params:this.props.info.params,values:this.props.params,onChange:this.onChange,onEnter:this.props.events.onEnter,isDisabled:this.props.isDisabled})}};(n=>{function e(o){let i=Object.keys(o);for(let a of i)if(!o[a].isHidden)return!1;return!0}function t(o,i,a,s){let l=i.cells.get(s).obj,u=a.definition.params?a.definition.params(l,o):{};return{initialValues:C.getDefaultValues(u),params:u,isEmpty:e(u)}}n.infoFromAction=t;function r(o,i,a){let s=i.cells.get(a.ref),l=s.params&&s.params.definition||{};return{initialValues:s.params&&s.params.values||{},params:l,isEmpty:e(l)}}n.infoFromTransform=r})(Ch||={});var ET=class extends bi{constructor(){super(...arguments);this.busy=new Di(!1);this.onEnter=()=>{this.state.error||this.apply()};this.autoApplyHandle=void 0;this.events={onEnter:this.onEnter,onChange:(r,n,o)=>{this.clearAutoApply(),this.setState({params:r,isInitial:n,error:o&&o[0]},()=>{!n&&!this.state.error&&this.canAutoApply(r)&&(this.clearAutoApply(),this.autoApplyHandle=setTimeout(this.apply,50))})}};this.apply=async()=>{this.clearAutoApply(),this.setState({busy:!0});try{await this.applyAction()}catch(r){console.error(r)}finally{this.props.onApply?.(),this.busy.next(!1)}};this.refresh=()=>{this.setState({params:this.getInfo().initialValues,isInitial:!0,error:void 0})};this.setDefault=()=>{let r=this.getInfo(),n=C.getDefaultValues(r.params);this.setState({params:n,isInitial:C.areEqual(r.params,n,r.initialValues),error:void 0})};this.toggleExpanded=()=>{this.setState({isCollapsed:!this.state.isCollapsed})}}clearAutoApply(){this.autoApplyHandle!==void 0&&(clearTimeout(this.autoApplyHandle),this.autoApplyHandle=void 0)}componentDidMount(){this.subscribe(this.plugin.behaviors.state.isBusy,r=>{this.busy.value!==r&&this.busy.next(r)}),this.subscribe(this.busy.pipe(LP(1)),r=>{this.setState({busy:r})})}renderApply(){let r=this.canApply();return this.props.autoHideApply&&(!r||this.canAutoApply(this.state.params))?null:(0,Ms.jsxs)("div",{className:"msp-transform-apply-wrap",children:[(0,Ms.jsx)(sr,{svg:J0,className:"msp-transform-default-params",onClick:this.setDefault,disabled:this.state.busy,title:"Set default params"}),(0,Ms.jsx)("div",{className:"msp-transform-apply-wider",children:(0,Ms.jsx)(gr,{icon:r?cd:void 0,className:`msp-btn-commit msp-btn-commit-${r?"on":"off"}`,onClick:this.apply,disabled:!r,children:this.props.applyLabel||this.applyText()})})]})}renderDefault(){let r=this.getInfo(),n=r.isEmpty&&this.isUpdate(),o=this.getHeader(),i=this.getTransformerId(),a=this.plugin.customParamEditors.has(i)?this.plugin.customParamEditors.get(i):Ch,s=this.state.isCollapsed?"msp-transform-wrapper msp-transform-wrapper-collapsed":"msp-transform-wrapper",l=null;if(!n&&!this.state.isCollapsed){let{a:c,b:m,bCell:d}=this.getSourceAndTarget(),p=this.renderApply();l=(0,Ms.jsxs)(Ms.Fragment,{children:[(0,Ms.jsx)(a,{info:r,a:c,b:m,bCell:d,events:this.events,params:this.state.params,isDisabled:this.state.busy}),p]})}let u=(0,Ms.jsxs)("div",{className:s,style:{marginBottom:this.props.noMargin?0:void 0},children:[o!=="none"&&!this.props.wrapInExpander&&(0,Ms.jsx)("div",{className:"msp-transform-header",children:(0,Ms.jsxs)(gr,{onClick:this.toggleExpanded,title:o.description,children:[!n&&(0,Ms.jsx)(Dn,{svg:this.state.isCollapsed?tc:ec}),o.name]})}),l]});return n||!this.props.wrapInExpander?u:(0,Ms.jsx)(fs,{header:this.isUpdate()?`Update ${o==="none"?"":o.name}`:`Apply ${o==="none"?"":o.name}`,headerLeftMargin:this.props.expanderHeaderLeftMargin,children:u})}renderSimple(){let r=this.getInfo(),n=this.canApply(),o=(0,Ms.jsxs)("div",{className:"msp-flex-row",children:[(0,Ms.jsx)(gr,{icon:this.props.simpleApply?.icon,title:this.props.simpleApply?.title,disabled:this.state.busy||!n,onClick:this.apply,className:"msp-btn-apply-simple",children:this.props.simpleApply?.header}),!r.isEmpty&&(0,Ms.jsx)(yi,{icon:Il,label:"",title:"Options",toggle:this.toggleExpanded,isSelected:!this.state.isCollapsed,disabled:this.state.busy,style:{flex:"0 0 40px",padding:0}})]});if(this.state.isCollapsed)return o;let i=this.getTransformerId(),a=this.plugin.customParamEditors.has(i)?this.plugin.customParamEditors.get(i):Ch,{a:s,b:l,bCell:u}=this.getSourceAndTarget();return(0,Ms.jsxs)(Ms.Fragment,{children:[o,(0,Ms.jsx)(a,{info:r,a:s,b:l,bCell:u,events:this.events,params:this.state.params,isDisabled:this.state.busy})]})}render(){return this.props.simpleApply?this.renderSimple():this.renderDefault()}};var aht=_t(ur());var vc=class extends ET{constructor(){super(...arguments);this._getInfo=es(r=>Ch.infoFromTransform(this.plugin,this.props.state,r));this.state={error:void 0,isInitial:!0,params:this.getInfo().initialValues,busy:!1,isCollapsed:this.props.initiallyCollapsed}}applyAction(){return this.props.customUpdate?this.props.customUpdate(this.state.params):this.plugin.state.updateTransform(this.props.state,this.props.transform.ref,this.state.params)}getInfo(){return this._getInfo(this.props.transform)}getTransformerId(){return this.props.transform.transformer.id}getHeader(){return this.props.customHeader||this.props.transform.transformer.definition.display}canApply(){let{state:r}=this.props,n=r.cells.get(this.props.transform.ref);if(!n)return!1;if(n.status==="error"){let o=r.cells.get(this.props.transform.parent);return o?o.status==="ok":!1}return!this.state.error&&!this.state.busy&&!this.state.isInitial}applyText(){return this.canApply()?"Update":"Nothing to Update"}isUpdate(){return!0}getSourceAndTarget(){let r=this.props.state.cells.get(this.props.transform.ref);return{a:this.props.state.cells.get(this.props.transform.parent).obj,b:r?.obj,bCell:r}}canAutoApply(r){let n=this.props.transform.transformer.definition.canAutoUpdate;if(!n)return!1;let{state:o}=this.props,i=o.cells.get(this.props.transform.ref);if(!i||!i.sourceRef||i.status!=="ok")return!1;let a=o.cells.get(i.sourceRef);return n({a:a.obj,b:i.obj,oldParams:this.getInfo().initialValues,newParams:r},this.plugin)}componentDidMount(){super.componentDidMount(),this.props.toggleCollapsed&&this.subscribe(this.props.toggleCollapsed,()=>this.setState({isCollapsed:!this.state.isCollapsed})),this.subscribe(this.plugin.state.events.object.updated,({ref:r,state:n})=>{this.props.transform.ref!==r||this.props.state!==n||this.state.params!==this.props.transform.params&&(this._getInfo=es(o=>Ch.infoFromTransform(this.plugin,this.props.state,o)),this.setState({params:this.props.transform.params,isInitial:!0}))})}componentDidUpdate(r){if(this.props.transform!==r.transform){let n=this.props.state.cells.get(this.props.transform.ref);this.setState({params:n.params?.values||{},isInitial:!0,error:void 0,simpleOnly:this.state.simpleOnly})}}};var dl=_t(ur()),hO=class extends bi{get current(){return this.plugin.managers.structure.hierarchy.behaviors.selection}componentDidMount(){this.subscribe(this.current,()=>this.forceUpdate())}get unitcell(){let{selection:t}=this.plugin.managers.structure.hierarchy;if(t.structures.length===0)return null;let r=[];for(let n of t.structures){let o=n.model;o?.unitcell&&o.unitcell?.cell.obj&&r.push(o.unitcell)}return r.length===0?null:(0,dl.jsx)(gO,{refs:r,labelMultiple:"Unit Cells"})}get customControls(){let t=[];return this.plugin.genericRepresentationControls.forEach((r,n)=>{let[o,i]=r(this.plugin.managers.structure.hierarchy.selection);o.length>0&&t.push((0,dl.jsx)("div",{children:(0,dl.jsx)(gO,{refs:o,labelMultiple:i})},n))}),t.length>0?t:null}render(){return(0,dl.jsx)(dl.Fragment,{children:(0,dl.jsxs)("div",{style:{marginTop:"6px"},children:[this.unitcell,this.customControls]})})}},gO=class extends bi{constructor(){super(...arguments);this.state={showOptions:!1};this.toggleVisibility=r=>{r.preventDefault(),this.plugin.managers.structure.hierarchy.toggleVisibility(this.props.refs),r.currentTarget.blur()};this.highlight=r=>{r.preventDefault(),this.pivot.cell.parent&&lt.Interactivity.Object.Highlight(this.plugin,{state:this.pivot.cell.parent,ref:this.props.refs.map(n=>n.cell.transform.ref)})};this.clearHighlight=r=>{r.preventDefault(),lt.Interactivity.ClearHighlights(this.plugin)};this.focus=r=>{r.preventDefault();let n=!0;for(let i of this.props.refs)if(!i.cell.state.isHidden){n=!1;break}n&&this.plugin.managers.structure.hierarchy.toggleVisibility(this.props.refs,"show");let o=[];for(let i of this.props.refs){if(i.cell.state.isHidden)continue;let a=i.cell.obj?.data.repr.getLoci();a&&o.push(a)}this.plugin.managers.camera.focusLoci(o)};this.toggleOptions=()=>this.setState({showOptions:!this.state.showOptions})}componentDidMount(){this.subscribe(this.plugin.state.events.cell.stateUpdated,r=>{Rm.ObjectEvent.isCell(r,this.pivot?.cell)&&this.forceUpdate()})}get pivot(){return this.props.refs[0]}render(){let{refs:r,labelMultiple:n}=this.props;if(r.length===0)return null;let o=r[0],i,a;if(r.length===1){let{obj:s}=o.cell;if(!s)return null;i=s?.label,a=s?.description}else i=`${r.length} ${n||"Objects"}`;return(0,dl.jsxs)(dl.Fragment,{children:[(0,dl.jsxs)("div",{className:"msp-flex-row",children:[(0,dl.jsxs)("button",{className:"msp-form-control msp-control-button-label",title:`${i}. Click to focus.`,onClick:this.focus,onMouseEnter:this.highlight,onMouseLeave:this.clearHighlight,style:{textAlign:"left"},children:[i," ",(0,dl.jsx)("small",{children:a})]}),(0,dl.jsx)(sr,{svg:o.cell.state.isHidden?md:vm,toggleState:!1,className:"msp-form-control",onClick:this.toggleVisibility,title:`${o.cell.state.isHidden?"Show":"Hide"}`,small:!0,flex:!0}),r.length===1&&(0,dl.jsx)(sr,{svg:Dx,className:"msp-form-control",onClick:this.toggleOptions,title:"Options",toggleState:this.state.showOptions,flex:!0})]}),r.length===1&&this.state.showOptions&&o.cell.parent&&(0,dl.jsx)(dl.Fragment,{children:(0,dl.jsx)("div",{className:"msp-control-offset",children:(0,dl.jsx)(vc,{state:o.cell.parent,transform:o.cell.transform,customHeader:"none",autoHideApply:!0})})})]})}};var Bn=_t(ur()),yO=class extends kc{defaultState(){return{header:"Components",isCollapsed:!1,isDisabled:!1,brand:{accent:"blue",svg:O2}}}componentDidMount(){this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,t=>this.setState({description:$g.getSelectedStructuresDescription(this.plugin)}))}renderControls(){return(0,Bn.jsxs)(Bn.Fragment,{children:[(0,Bn.jsx)(Aq,{}),(0,Bn.jsx)(Pq,{}),(0,Bn.jsx)(hO,{})]})}},Aq=class extends bi{constructor(){super(...arguments);this.state={isEmpty:!0,isBusy:!1,canUndo:!1};this.togglePreset=this.toggleAction("preset");this.toggleAdd=this.toggleAction("add");this.toggleOptions=this.toggleAction("options");this.hideAction=()=>this.setState({action:void 0});this.applyPreset=r=>{if(this.hideAction(),!r)return;let n=this.plugin.managers.structure,{structures:o}=n.hierarchy.selection;r.value===null?n.component.clear(o):n.component.applyPreset(o,r.value)};this.undo=()=>{let r=this.plugin.state.data.undo();r&&this.plugin.runTask(r)}}get isDisabled(){return this.state.isBusy||this.state.isEmpty}componentDidMount(){this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,r=>this.setState({action:this.state.action!=="options"||r.structures.length===0?void 0:"options",isEmpty:r.structures.length===0})),this.subscribe(this.plugin.behaviors.state.isBusy,r=>{this.setState({isBusy:r,action:this.state.action!=="options"?void 0:"options"})}),this.subscribe(this.plugin.state.data.events.historyUpdated,({state:r})=>{this.setState({canUndo:r.canUndo})})}toggleAction(r){return()=>this.setState({action:this.state.action===r?void 0:r})}get presetControls(){return(0,Bn.jsx)(Rr,{items:this.presetActions,onSelect:this.applyPreset})}get presetActions(){let r=this.plugin.managers.structure.component.pivotStructure,n=this.plugin.builders.structure.representation.getPresets(r?.cell.obj);return Rr.createItems(n,{label:o=>o.display.name,category:o=>o.display.group,description:o=>o.display.description})}render(){let r=this.state.canUndo?`Undo ${this.plugin.state.data.latestUndoLabel}`:"Some mistakes of the past can be undone.";return(0,Bn.jsxs)(Bn.Fragment,{children:[(0,Bn.jsxs)("div",{className:"msp-flex-row",children:[(0,Bn.jsx)(yi,{icon:Ly,label:"Preset",title:"Apply a representation preset for the current structure(s).",toggle:this.togglePreset,isSelected:this.state.action==="preset",disabled:this.isDisabled}),(0,Bn.jsx)(yi,{icon:Bf,label:"Add",title:"Add a new representation component for a selection.",toggle:this.toggleAdd,isSelected:this.state.action==="add",disabled:this.isDisabled}),(0,Bn.jsx)(yi,{icon:Il,label:"",title:"Options that are applied to all applicable representations.",style:{flex:"0 0 40px",padding:0},toggle:this.toggleOptions,isSelected:this.state.action==="options",disabled:this.isDisabled}),(0,Bn.jsx)(sr,{svg:H2,className:"msp-flex-item",flex:"40px",onClick:this.undo,disabled:!this.state.canUndo||this.isDisabled,title:r})]}),this.state.action==="preset"&&this.presetControls,this.state.action==="add"&&(0,Bn.jsx)("div",{className:"msp-control-offset",children:(0,Bn.jsx)(FD,{onApply:this.hideAction})}),this.state.action==="options"&&(0,Bn.jsx)("div",{className:"msp-control-offset",children:(0,Bn.jsx)(Tq,{isDisabled:this.isDisabled})})]})}},FD=class extends bi{constructor(){super(...arguments);this.state=this.createState();this.apply=()=>{let r=this.props.forSelection?this.currentStructures:this.selectedStructures;this.props.onApply(),this.plugin.managers.structure.component.add(this.state.values,r)};this.paramsChanged=r=>this.setState({values:r})}createState(){let r=Kp.getAddParams(this.plugin);return{params:r,values:C.getDefaultValues(r)}}get selectedStructures(){return this.plugin.managers.structure.component.currentStructures}get currentStructures(){return this.plugin.managers.structure.hierarchy.current.structures}render(){return(0,Bn.jsxs)(Bn.Fragment,{children:[(0,Bn.jsx)(uo,{params:this.state.params,values:this.state.values,onChangeValues:this.paramsChanged}),(0,Bn.jsx)(gr,{icon:Bf,title:"Use Selection and optional Representation to create a new Component.",className:"msp-btn-commit msp-btn-commit-on",onClick:this.apply,style:{marginTop:"1px"},children:"Create Component"})]})}},Tq=class extends bi{constructor(){super(...arguments);this.update=r=>this.plugin.managers.structure.component.setOptions(r)}componentDidMount(){this.subscribe(this.plugin.managers.structure.component.events.optionsUpdated,()=>this.forceUpdate())}render(){return(0,Bn.jsx)(uo,{params:Kp.OptionsParams,values:this.plugin.managers.structure.component.state.options,onChangeValues:this.update,isDisabled:this.props.isDisabled})}},Pq=class extends bi{componentDidMount(){this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,()=>{this.forceUpdate()})}render(){let t=this.plugin.managers.structure.hierarchy.currentComponentGroups;return t.length===0?null:(0,Bn.jsx)("div",{style:{marginTop:"6px"},children:t.map(r=>(0,Bn.jsx)(_q,{group:r},r[0].cell.transform.ref))})}},_q=class extends bi{constructor(){super(...arguments);this.state={action:void 0};this.toggleVisible=r=>{r.preventDefault(),r.currentTarget.blur(),this.plugin.managers.structure.component.toggleVisibility(this.props.group)};this.selectAction=r=>{r&&(r?.value)()};this.remove=()=>this.plugin.managers.structure.hierarchy.remove(this.props.group,!0);this.toggleAction=()=>this.setState({action:this.state.action==="action"?void 0:"action"});this.toggleLabel=()=>this.setState({action:this.state.action==="label"?void 0:"label"});this.highlight=r=>{r.preventDefault(),this.props.group[0].cell.parent&&lt.Interactivity.Object.Highlight(this.plugin,{state:this.props.group[0].cell.parent,ref:this.props.group.map(n=>n.cell.transform.ref)})};this.clearHighlight=r=>{r.preventDefault(),lt.Interactivity.ClearHighlights(this.plugin)};this.focus=()=>{let r=!0;for(let n of this.props.group)if(!n.cell.state.isHidden){r=!1;break}r&&this.plugin.managers.structure.hierarchy.toggleVisibility(this.props.group,"show"),this.plugin.managers.camera.focusSpheres(this.props.group,n=>{if(!n.cell.state.isHidden)return n.cell.obj?.data.boundary.sphere})};this.updateLabel=r=>{this.plugin.managers.structure.component.updateLabel(this.pivot,r)}}get pivot(){return this.props.group[0]}componentDidMount(){this.subscribe(this.plugin.state.events.cell.stateUpdated,r=>{Rm.ObjectEvent.isCell(r,this.pivot.cell)&&this.forceUpdate()})}get colorByActions(){let r=this.plugin.managers.structure.component,o=this.pivot.representations[0].cell.transform.params?.colorTheme.name,i=$_e(this.plugin,this.pivot.cell.obj?.data);return Rr.createItemsFromSelectOptions(i,{value:a=>()=>r.updateRepresentationsTheme(this.props.group,{color:a[0]}),selected:a=>a[0]===o})}get actions(){let r=this.plugin.managers.structure.component,n=[[Rr.Header("Add Representation"),...Kp.getRepresentationTypes(this.plugin,this.props.group[0]).map(o=>Rr.Item(o[1],()=>r.addRepresentation(this.props.group,o[0])))]];return this.pivot.representations.length>0&&n.push([Rr.Header("Set Coloring",{isIndependent:!0}),...this.colorByActions]),r.canBeModified(this.props.group[0])&&n.push([Rr.Header("Modify by Selection"),Rr.Item("Include",()=>r.modifyByCurrentSelection(this.props.group,"union"),{icon:F2}),Rr.Item("Subtract",()=>r.modifyByCurrentSelection(this.props.group,"subtract"),{icon:L2}),Rr.Item("Intersect",()=>r.modifyByCurrentSelection(this.props.group,"intersect"),{icon:V2})]),n.push(Rr.Item("Select This",()=>r.selectThis(this.props.group),{icon:K0})),r.canBeModified(this.props.group[0])&&n.push(Rr.Item("Edit Label",this.toggleLabel)),n}get reprLabel(){let r=this.pivot;return r.representations.length===0?"No repr.":r.representations.length===1?r.representations[0].cell.obj?.label:`${r.representations.length} reprs`}render(){let r=this.pivot,n=r.cell,o=n.obj?.label,i=this.reprLabel;return(0,Bn.jsxs)(Bn.Fragment,{children:[(0,Bn.jsxs)("div",{className:"msp-flex-row",children:[(0,Bn.jsxs)(gr,{noOverflow:!0,className:"msp-control-button-label",title:`${o}. Click to focus.`,onClick:this.focus,onMouseEnter:this.highlight,onMouseLeave:this.clearHighlight,style:{textAlign:"left"},children:[o,(0,Bn.jsx)("small",{className:"msp-25-lower-contrast-text",style:{float:"right"},children:i})]}),(0,Bn.jsx)(sr,{svg:n.state.isHidden?md:vm,toggleState:!1,onClick:this.toggleVisible,title:`${n.state.isHidden?"Show":"Hide"} component`,small:!0,className:"msp-form-control",flex:!0}),(0,Bn.jsx)(sr,{svg:$s,toggleState:!1,onClick:this.remove,title:"Remove",small:!0,className:"msp-form-control",flex:!0}),(0,Bn.jsx)(sr,{svg:Dx,onClick:this.toggleAction,title:"Actions",toggleState:this.state.action==="action",className:"msp-form-control",flex:!0})]}),this.state.action==="label"&&(0,Bn.jsx)("div",{className:"msp-control-offset",style:{marginBottom:"6px"},children:(0,Bn.jsx)(Hl,{label:"Label",control:(0,Bn.jsxs)("div",{style:{display:"flex",textAlignLast:"center"},children:[(0,Bn.jsx)(Ec,{onChange:this.updateLabel,value:o,style:{flex:"1 1 auto",minWidth:0},className:"msp-form-control",blurOnEnter:!0,blurOnEscape:!0}),(0,Bn.jsx)(sr,{svg:cd,onClick:this.toggleLabel,className:"msp-form-control msp-control-button-label",flex:!0})]})})}),this.state.action==="action"&&(0,Bn.jsxs)("div",{className:"msp-accent-offset",children:[(0,Bn.jsx)("div",{style:{marginBottom:"6px"},children:(0,Bn.jsx)(Rr,{items:this.actions,onSelect:this.selectAction,noOffset:!0})}),(0,Bn.jsx)("div",{style:{marginBottom:"6px"},children:r.representations.map(a=>(0,Bn.jsx)(Rq,{group:this.props.group,representation:a},a.cell.transform.ref))})]})]})}},Rq=class extends bi{constructor(){super(...arguments);this.remove=()=>this.plugin.managers.structure.component.removeRepresentations(this.props.group,this.props.representation);this.toggleVisible=r=>{r.preventDefault(),r.currentTarget.blur(),this.plugin.managers.structure.component.toggleVisibility(this.props.group,this.props.representation)};this.update=r=>this.plugin.managers.structure.component.updateRepresentations(this.props.group,this.props.representation,r)}componentDidMount(){this.subscribe(this.plugin.state.events.cell.stateUpdated,r=>{Rm.ObjectEvent.isCell(r,this.props.representation.cell)&&this.forceUpdate()})}render(){let r=this.props.representation.cell;return(0,Bn.jsxs)("div",{className:"msp-representation-entry",children:[r.parent&&(0,Bn.jsx)(fs,{header:`${r.obj?.label||""} Representation`,noOffset:!0,children:(0,Bn.jsx)(vc,{state:r.parent,transform:r.transform,customHeader:"none",customUpdate:this.update,noMargin:!0})}),(0,Bn.jsx)(sr,{svg:$s,onClick:this.remove,title:"Remove",small:!0,className:"msp-default-bg",toggleState:!1,style:{position:"absolute",top:0,right:"32px",lineHeight:"24px",height:"24px",textAlign:"right",width:"44px",paddingRight:"6px",background:"none"}}),(0,Bn.jsx)(sr,{svg:this.props.representation.cell.state.isHidden?md:vm,toggleState:!1,onClick:this.toggleVisible,title:"Toggle Visibility",small:!0,className:"msp-default-bg",style:{position:"absolute",top:0,right:0,lineHeight:"24px",height:"24px",textAlign:"right",width:"32px",paddingRight:"6px",background:"none"}})]})}};var Dq="measurement-group",bO="measurement-order-label",wq={distanceUnitLabel:C.Text("\u212B",{isEssential:!0}),textColor:jW.textColor},sht=C.getDefaultValues(wq);function Hd(e){return{bundle:Q.Bundle.fromLoci(e)}}var xO=class extends qs{constructor(r){super({labels:[],distances:[],angles:[],dihedrals:[],orientations:[],planes:[],options:sht});this.plugin=r;this.behaviors={state:this.ev.behavior(this.state)};this._empty=[];r.state.data.events.changed.subscribe(n=>{n.inTransaction||r.behaviors.state.isAnimating.value||this.sync()}),r.behaviors.state.isAnimating.subscribe(n=>{!n&&!r.behaviors.state.isUpdating.value&&this.sync()})}stateUpdated(){this.behaviors.state.next(this.state)}getGroup(){let r=this.plugin.state.data,n=tr.findTagInSubtree(r.tree,Br.RootRef,Dq),o=this.plugin.state.data.build();return n?o.to(n):o.toRoot().group(Qe.Misc.CreateGroup,{label:"Measurements"},{tags:Dq})}async setOptions(r){this.updateState({options:r})&&this.stateUpdated();let n=this.plugin.state.data.build();for(let o of this.state.distances)n.to(o).update(i=>{i.unitLabel=r.distanceUnitLabel,i.textColor=r.textColor});for(let o of this.state.labels)n.to(o).update(i=>{i.textColor=r.textColor});for(let o of this.state.angles)n.to(o).update(i=>{i.textColor=r.textColor});for(let o of this.state.dihedrals)n.to(o).update(i=>{i.textColor=r.textColor});n.editInfo.count!==0&&await lt.State.Update(this.plugin,{state:this.plugin.state.data,tree:n,options:{doNotLogTiming:!0}})}async addDistance(r,n,o){let i=this.plugin.helpers.substructureParent.get(r.structure),a=this.plugin.helpers.substructureParent.get(n.structure);if(!i||!a)return;let s=[i.transform.ref];li(s,a.transform.ref);let u=this.getGroup().apply(Qe.Model.MultiStructureSelectionFromBundle,{selections:[{key:"a",groupId:"a",ref:i.transform.ref,...Hd(r)},{key:"b",groupId:"b",ref:a.transform.ref,...Hd(n)}],isTransitive:!0,label:"Distance"},{dependsOn:s,tags:o?.selectionTags}),c=u.apply(Qe.Representation.StructureSelectionsDistance3D,{customText:o?.customText||"",unitLabel:this.state.options.distanceUnitLabel,textColor:this.state.options.textColor,...o?.lineParams,...o?.labelParams,...o?.visualParams},{tags:o?.reprTags}),m=this.plugin.state.data;return await lt.State.Update(this.plugin,{state:m,tree:c,options:{doNotLogTiming:!0}}),{selection:u.selector,representation:c.selector}}async addAngle(r,n,o,i){let a=this.plugin.helpers.substructureParent.get(r.structure),s=this.plugin.helpers.substructureParent.get(n.structure),l=this.plugin.helpers.substructureParent.get(o.structure);if(!a||!s||!l)return;let u=[a.transform.ref];li(u,s.transform.ref),li(u,l.transform.ref);let m=this.getGroup().apply(Qe.Model.MultiStructureSelectionFromBundle,{selections:[{key:"a",ref:a.transform.ref,...Hd(r)},{key:"b",ref:s.transform.ref,...Hd(n)},{key:"c",ref:l.transform.ref,...Hd(o)}],isTransitive:!0,label:"Angle"},{dependsOn:u,tags:i?.selectionTags}),d=m.apply(Qe.Representation.StructureSelectionsAngle3D,{customText:i?.customText||"",textColor:this.state.options.textColor,...i?.lineParams,...i?.labelParams,...i?.visualParams},{tags:i?.reprTags}),p=this.plugin.state.data;return await lt.State.Update(this.plugin,{state:p,tree:d,options:{doNotLogTiming:!0}}),{selection:m.selector,representation:d.selector}}async addDihedral(r,n,o,i,a){let s=this.plugin.helpers.substructureParent.get(r.structure),l=this.plugin.helpers.substructureParent.get(n.structure),u=this.plugin.helpers.substructureParent.get(o.structure),c=this.plugin.helpers.substructureParent.get(i.structure);if(!s||!l||!u||!c)return;let m=[s.transform.ref];li(m,l.transform.ref),li(m,u.transform.ref),li(m,c.transform.ref);let p=this.getGroup().apply(Qe.Model.MultiStructureSelectionFromBundle,{selections:[{key:"a",ref:s.transform.ref,...Hd(r)},{key:"b",ref:l.transform.ref,...Hd(n)},{key:"c",ref:u.transform.ref,...Hd(o)},{key:"d",ref:c.transform.ref,...Hd(i)}],isTransitive:!0,label:"Dihedral"},{dependsOn:m,tags:a?.selectionTags}),h=p.apply(Qe.Representation.StructureSelectionsDihedral3D,{customText:a?.customText||"",textColor:this.state.options.textColor,...a?.lineParams,...a?.labelParams,...a?.visualParams},{tags:a?.reprTags}),f=this.plugin.state.data;return await lt.State.Update(this.plugin,{state:f,tree:h,options:{doNotLogTiming:!0}}),{selection:p.selector,representation:h.selector}}async addLabel(r,n){let o=this.plugin.helpers.substructureParent.get(r.structure);if(!o)return;let i=[o.transform.ref],s=this.getGroup().apply(Qe.Model.MultiStructureSelectionFromBundle,{selections:[{key:"a",ref:o.transform.ref,...Hd(r)}],isTransitive:!0,label:"Label"},{dependsOn:i,tags:n?.selectionTags}),l=s.apply(Qe.Representation.StructureSelectionsLabel3D,{textColor:this.state.options.textColor,...n?.labelParams,...n?.visualParams},{tags:n?.reprTags}),u=this.plugin.state.data;return await lt.State.Update(this.plugin,{state:u,tree:l,options:{doNotLogTiming:!0}}),{selection:s.selector,representation:l.selector}}async addOrientation(r){let n=[],o=[];for(let u=0,c=r.length;u<c;++u){let m=r[u],d=this.plugin.helpers.substructureParent.get(m.structure);d&&(li(o,d.transform.ref),n.push({key:`l${u}`,ref:d.transform.ref,...Hd(m)}))}if(n.length===0)return;let a=this.getGroup().apply(Qe.Model.MultiStructureSelectionFromBundle,{selections:n,isTransitive:!0,label:"Orientation"},{dependsOn:o}),s=a.apply(Qe.Representation.StructureSelectionsOrientation3D),l=this.plugin.state.data;return await lt.State.Update(this.plugin,{state:l,tree:s,options:{doNotLogTiming:!0}}),{selection:a.selector,representation:s.selector}}async addPlane(r){let n=[],o=[];for(let u=0,c=r.length;u<c;++u){let m=r[u],d=this.plugin.helpers.substructureParent.get(m.structure);d&&(li(o,d.transform.ref),n.push({key:`l${u}`,ref:d.transform.ref,...Hd(m)}))}if(n.length===0)return;let i=this.getGroup(),a=i.apply(Qe.Model.MultiStructureSelectionFromBundle,{selections:n,isTransitive:!0,label:"Plane"},{dependsOn:o}),s=a.apply(Qe.Representation.StructureSelectionsPlane3D),l=this.plugin.state.data;return await lt.State.Update(this.plugin,{state:l,tree:i,options:{doNotLogTiming:!0}}),{selection:a.selector,representation:s.selector}}async addOrderLabels(r){let n=this.getGroup(),o=this.plugin.state.data.select(tr.Generators.ofType(ne.Molecule.Structure.Selections).withTag(bO));for(let s of o)n.delete(s);let i=1;for(let s of r){let l=this.plugin.helpers.substructureParent.get(s.structure);if(!l)continue;let u=[l.transform.ref];n.apply(Qe.Model.MultiStructureSelectionFromBundle,{selections:[{key:"a",ref:l.transform.ref,...Hd(s)}],isTransitive:!0,label:"Order"},{dependsOn:u,tags:bO}).apply(Qe.Representation.StructureSelectionsLabel3D,{textColor:Le.fromRgb(255,255,255),borderColor:Le.fromRgb(0,0,0),textSize:.33,borderWidth:.3,offsetZ:.75,customText:`${i++}`},{tags:bO})}let a=this.plugin.state.data;return await lt.State.Update(this.plugin,{state:a,tree:n,options:{doNotLogTiming:!0}}),{representation:n.selector}}getTransforms(r){let n=this.plugin.state.data,o=tr.findTagInSubtree(n.tree,Br.RootRef,Dq),i=o?n.select(tr.Generators.ofTransformer(r,o)):this._empty;return i.length===0?this._empty:i}sync(){let r=[];for(let o of this.getTransforms(Qe.Representation.StructureSelectionsLabel3D)){let i=o.obj.tags;(!i||!i.includes(bO))&&r.push(o)}this.updateState({labels:r,distances:this.getTransforms(Qe.Representation.StructureSelectionsDistance3D),angles:this.getTransforms(Qe.Representation.StructureSelectionsAngle3D),dihedrals:this.getTransforms(Qe.Representation.StructureSelectionsDihedral3D),orientations:this.getTransforms(Qe.Representation.StructureSelectionsOrientation3D),planes:this.getTransforms(Qe.Representation.StructureSelectionsPlane3D)})&&this.stateUpdated()}};var zRe=_t(Mi());var n0=class e extends qs{constructor(r,n={}){super({props:{...C.getDefaultValues(e.Params),...n}});this.plugin=r;this._props=C.getDefaultValues(e.Params);this.events={propsUpdated:this.ev()};this.lociSelects=new e.LociSelectManager(r,this._props),this.lociHighlights=new e.LociHighlightManager(r,this._props)}get props(){return{...this.state.props}}setProps(r){let n=this.props,o={...this.state.props,...r};qb(n,o)||(this.updateState({props:o}),this.lociSelects.setProps(o),this.lociHighlights.setProps(o),this.events.propsUpdated.next(void 0))}dispose(){super.dispose(),this.lociSelects.dispose(),this.lociHighlights.dispose()}};(o=>{o.Params={granularity:C.Select("residue",nr.GranularityOptions,{label:"Picking Level",description:"Controls if selections are expanded upon picking to whole residues, chains, structures, instances, or left as atoms and coarse elements"})};class t{constructor(a,s={}){this.ctx=a;this.providers=[];this.props=C.getDefaultValues(o.Params);this.sel=a.managers.structure.selection,this.setProps(s)}setProps(a){Object.assign(this.props,a)}addProvider(a){this.providers.push(a)}removeProvider(a){this.providers=this.providers.filter(s=>s!==a)}normalizedLoci(a,s,l=!1){let{loci:u,repr:c}=a,m=s?this.props.granularity:void 0;return{loci:nr.normalize(u,m,l),repr:c}}mark(a,s,l=!1){if(!nr.isEmpty(a.loci))for(let u of this.providers)u(a,s,l)}dispose(){this.providers.length=0,this.sel.dispose()}}o.LociMarkManager=t;class r extends t{constructor(){super(...arguments);this.prev=[];this.clearHighlights=(s=!1)=>{for(let l of this.prev)this.mark(l,2,s);this.prev.length=0}}isHighlighted(s){for(let l of this.prev)if(Ut.Loci.areEqual(l,s))return!0;return!1}addHighlight(s){this.mark(s,1),this.prev.push(s)}highlight(s,l=!0){let u=this.normalizedLoci(s,l);this.isHighlighted(u)||this.addHighlight(u)}highlightOnly(s,l=!0){let u=this.normalizedLoci(s,l);this.isHighlighted(u)||(nr.isEmpty(u.loci)?this.clearHighlights():(this.clearHighlights(!0),this.addHighlight(u)))}highlightOnlyExtend(s,l=!0){let u=this.normalizedLoci(s,l);if(Q.Loci.is(u.loci)){let m={loci:(this.ctx.selectionMode?this.sel.tryGetRange(u.loci):this.ctx.managers.structure.focus.tryGetRange(u.loci))??u.loci,repr:u.repr};this.isHighlighted(m)||(nr.isEmpty(m.loci)?this.clearHighlights():(this.clearHighlights(!0),this.addHighlight(m)))}}dispose(){super.dispose(),this.prev.length=0}}o.LociHighlightManager=r;class n extends t{toggle(a,s=!0){if(nr.isEmpty(a.loci))return;let l=this.normalizedLoci(a,s,!0);Q.Loci.is(l.loci)?this.toggleSel(l):super.mark(l,16)}toggleExtend(a,s=!0){if(nr.isEmpty(a.loci))return;let l=this.normalizedLoci(a,s,!0);if(Q.Loci.is(l.loci)){let u=this.sel.tryGetRange(l.loci)||l.loci;this.toggleSel({loci:u,repr:l.repr})}}select(a,s=!0){let l=this.normalizedLoci(a,s,!0);Q.Loci.is(l.loci)&&this.sel.modify("add",l.loci),this.mark(l,4)}selectJoin(a,s=!0){let l=this.normalizedLoci(a,s,!0);Q.Loci.is(l.loci)&&this.sel.modify("intersect",l.loci),this.mark(l,4)}selectOnly(a,s=!0){let l=this.normalizedLoci(a,s,!0);Q.Loci.is(l.loci)&&(this.mark({loci:De.Loci(l.loci.structure),repr:l.repr},8),this.sel.modify("set",l.loci)),this.mark(l,4)}deselect(a,s=!0){let l=this.normalizedLoci(a,s,!0);Q.Loci.is(l.loci)&&this.sel.modify("remove",l.loci),this.mark(l,8)}deselectAll(){this.sel.clear(),this.mark({loci:Mg},8)}deselectAllOnEmpty(a){Oi(a.loci)&&this.deselectAll()}mark(a,s){let{loci:l}=a;if(!nr.isEmpty(l))if(Q.Loci.is(l)){let u=this.sel.getLoci(l.structure);super.mark({loci:De.Loci(l.structure)},8,!nr.isEmpty(u)),super.mark({loci:u},4)}else super.mark(a,s)}toggleSel(a){this.sel.has(a.loci)?(this.sel.modify("remove",a.loci),this.mark(a,8)):(this.sel.modify("add",a.loci),this.mark(a,4))}}o.LociSelectManager=n})(n0||={});function lht(e,t){let r=[],n=t==="auth"?"auth_asym_id":"label_asym_id",o=t==="auth"?"auth_seq_id":"label_seq_id";for(let a of e)if(a.kind==="range")r.push(ie.struct.generator.atomGroups({"chain-test":ie.core.rel.eq([ie.ammp(n),a.asym_id]),"residue-test":ie.core.rel.inRange([ie.ammp(o),a.seq_id_beg,a.seq_id_end])}));else{let s=(a.ins_code??"").trim();r.push(ie.struct.generator.atomGroups({"chain-test":ie.core.rel.eq([ie.ammp(n),a.asym_id]),"residue-test":ie.core.logic.and([ie.core.rel.eq([ie.ammp(o),a.seq_id]),ie.core.rel.eq([ie.ammp("pdbx_PDB_ins_code"),s])])}))}let i=ie.struct.combinator.merge(r);return Wc(i)}function uht(e){let t=Un.create();for(let[n,o]of e)for(let i=n;i<=o;i++)Un.add(t,i,i);let r=ie.struct.generator.atomGroups({"atom-test":ie.core.set.has([ie.set(...t.array),ie.ammp("id")])});return Wc(r)}function cht(e){let t=Un.create();for(let[n,o]of e)for(let i=n;i<=o;i++)Un.add(t,i.toString(),i.toString());let r=ie.struct.generator.atomGroups({"atom-test":ie.core.set.has([ie.set(...t.array),ie.acp("elementSymbol")])});return Wc(r)}function mht(e){let t=ie.struct.generator.atomGroups({"atom-test":ie.core.set.has([ie.set(...e),ie.acp("elementSymbol")])});return Wc(t)}function dht(e,t,r){if(!(!e||t.length===0||Number.isNaN(+t[0])))return Number.isNaN(r)?{kind:"single",asym_id:e,seq_id:+t[0],ins_code:t[1]}:{kind:"range",asym_id:e,seq_id_beg:+t[0],seq_id_end:r}}function pht(e){return e?e.split(":"):[]}function fht(e){return e.split(",").map(t=>t.trim().split(/\s+|[-]/g).filter(r=>!!r)).map(t=>dht(t[0],pht(t[1]),+t[2])).filter(t=>!!t)}function URe(e){return e.split(",").map(t=>t.trim().split(/\s+|[-]/g).filter(r=>!!r)).filter(t=>t.length===1||t.length===2).map(t=>t.length===1?[+t[0],+t[0]]:[+t[0],+t[1]])}function NRe(e,t){if(t==="atom-id"){let r=URe(e);return uht(r)}else if(t==="element-symbol"){if(/[a-zA-Z]/.test(e))return mht(e.split(",").map(n=>n.trim()));{let n=URe(e);return cht(n)}}else{let r=fht(e);return lht(r,t)}}var SO=_t(Mi());var Hr=_t(ur());function hht(e){return Object.keys(e).map(t=>[t,e[t]]).filter(t=>Ct.isBinding(t[1]))}var kT=class extends SO.PureComponent{getBindingComponents(){let t=hht(this.props.bindings);return(0,Hr.jsx)(Hr.Fragment,{children:t.map(r=>{let[n,o]=r;return Ct.isEmpty(o)?null:(0,Hr.jsxs)("div",{style:{marginBottom:"6px"},children:[(0,Hr.jsx)("b",{children:o.action}),(0,Hr.jsx)("br",{}),(0,Hr.jsx)("span",{dangerouslySetInnerHTML:{__html:Ct.format(o,n)}})]},n)})})}render(){return(0,Hr.jsx)(jd,{children:this.getBindingComponents()})}},jd=class extends SO.PureComponent{render(){return(0,Hr.jsx)("div",{className:"msp-help-text",children:(0,Hr.jsx)("div",{children:this.props.children})})}},Wd=class extends SO.PureComponent{constructor(){super(...arguments);this.state={header:this.props.header,isExpanded:!!this.props.initiallyExpanded};this.toggleExpanded=()=>this.setState({isExpanded:!this.state.isExpanded})}render(){return(0,Hr.jsxs)("div",{className:"msp-control-group-wrapper",children:[(0,Hr.jsx)("div",{className:"msp-control-group-header",children:(0,Hr.jsxs)(gr,{onClick:this.toggleExpanded,children:[(0,Hr.jsx)(Dn,{svg:this.state.isExpanded?ec:tc}),this.props.header]})}),this.state.isExpanded&&(0,Hr.jsx)("div",{className:"msp-control-offset",style:{display:this.state.isExpanded?"block":"none"},children:this.props.children})]})}};function Mq(e){return(0,Hr.jsx)("div",{className:"msp-simple-help-section",children:e.header})}var F1=class extends Fr{constructor(){super(...arguments);this.getInteractionBindings=es(r=>{let n;return r.forEach(o=>{let i=o.params?.values;i?.bindings&&Object.keys(i.bindings).length>0&&(n||(n={}),Object.assign(n,i.bindings))}),n})}componentDidMount(){this.subscribe(this.plugin.events.canvas3d.settingsUpdated,()=>this.forceUpdate())}render(){let r=this.getInteractionBindings(this.plugin.state.behaviors.cells);return(0,Hr.jsxs)(Hr.Fragment,{children:[!this.props.selectOnly&&this.plugin.canvas3d&&(0,Hr.jsx)(Wd,{header:"Moving in 3D",children:(0,Hr.jsx)(kT,{bindings:this.plugin.canvas3d.attribs.trackball.bindings})},"trackball"),!!r&&(0,Hr.jsx)(Wd,{header:"Mouse & Key Controls",children:(0,Hr.jsx)(kT,{bindings:r})},"interactions")]})}},CO=class extends Fr{componentDidMount(){this.subscribe(this.plugin.events.canvas3d.settingsUpdated,()=>this.forceUpdate())}formatTriggers(t){return t.triggers.map(r=>Ct.Trigger.format(r)).join(" or ")}getTriggerFor(t,r){let o=this.plugin.state.behaviors.select(tr.Generators.ofTransformer(t)),i=o.length===1?o[0].params:void 0,a=i?i.values.bindings:{},s=r in a?a[r]:Ct.Empty;return this.formatTriggers(s)}render(){let t=this.getTriggerFor(qX,"clickSelectToggle"),r=this.getTriggerFor(p1,"clickFocus");return(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)(Mq,{header:"Interface Controls"}),(0,Hr.jsxs)(Wd,{header:"Inline Help",children:[(0,Hr.jsx)(jd,{children:"Many user interface elements show a little questionmark icon when hovered over. Clicking the icon toggles the display of an inline help text."}),(0,Hr.jsx)(jd,{children:"Tooltips may provide additional information on a user interface element and are shown when hovering over it with the mouse."})]}),(0,Hr.jsx)(Wd,{header:"Selections",children:(0,Hr.jsxs)(jd,{children:["The viewer allows changing colors and representations for selections of atoms, residues or chains. Selections can be created by",(0,Hr.jsxs)("ul",{style:{paddingLeft:"20px"},children:[(0,Hr.jsxs)("li",{children:["picking elements on the 3D canvas or the sequence view using the mouse, e.g. toggle selection using ",t," (for more see help section on ",(0,Hr.jsx)("i",{children:"Mouse Controls"}),")"]}),(0,Hr.jsxs)("li",{children:["using the ",(0,Hr.jsx)("i",{children:"Add"}),", ",(0,Hr.jsx)("i",{children:"Remove"})," and ",(0,Hr.jsx)("i",{children:"Only"})," dropdown buttons in the ",(0,Hr.jsx)("i",{children:"Manage Selection"})," panel which allow modifing the current selection by predefined sets"]})]})]})}),(0,Hr.jsx)(Wd,{header:"Coloring",children:(0,Hr.jsxs)(jd,{children:["There are two ways to color structures. Every representation (e.g. cartoon or spacefill) has a color theme which can be changed using the dropdown for each representation in the ",(0,Hr.jsx)("i",{children:"Structure Settings"})," panel. Additionally any selection atoms, residues or chains can by given a custom color. For that, first select the parts of the structure to be colored (see help section on ",(0,Hr.jsx)("i",{children:"Selections"}),") and, second, choose a color from the color dropdown botton in the ",(0,Hr.jsx)("i",{children:"Selection"})," row of the ",(0,Hr.jsx)("i",{children:"Change Representation"})," panel. The theme color can be seen as a base color that is overpainted by the custom color. Custom colors can be removed for a selection with the 'Clear' option in the color dropdown."]})}),(0,Hr.jsx)(Wd,{header:"Representations",children:(0,Hr.jsxs)(jd,{children:["Structures can be shown with many different representations (e.g. cartoon or spacefill). The ",(0,Hr.jsx)("i",{children:"Change Representation"})," panel offers a collection of predefined styles which can be applied using the ",(0,Hr.jsx)("i",{children:"Preset"})," dropdown button. Additionally any selection atoms, residues or chains can by shown with a custom representation. For that, first select the parts of the structure to be mofified (see help section on ",(0,Hr.jsx)("i",{children:"Selections"}),") and, second, choose a representation to hide or show from the ",(0,Hr.jsx)("i",{children:"Show"})," and ",(0,Hr.jsx)("i",{children:"Hide"})," dropdown bottons in the ",(0,Hr.jsx)("i",{children:"Selection"})," row of the ",(0,Hr.jsx)("i",{children:"Change Representation"})," panel. The ",(0,Hr.jsx)("i",{children:"Everything"})," row applies the action to the whole structure instead of the current selection."]})}),(0,Hr.jsx)(Wd,{header:"Surroundings",children:(0,Hr.jsxs)(jd,{children:["To show the surroundings of a residue or ligand, click it in the 3D scene or in the sequence widget using ",r,"."]})}),(0,Hr.jsx)(Mq,{header:"How-to Guides"}),(0,Hr.jsx)(Wd,{header:"Create an Image",children:(0,Hr.jsxs)(jd,{children:[(0,Hr.jsxs)("p",{children:["Use the ",(0,Hr.jsx)(Dn,{svg:Une})," icon in the viewport to bring up the screenshot controls."]}),(0,Hr.jsxs)("p",{children:["To adjust the size of the image, use the ",(0,Hr.jsx)("i",{children:"Resolution"})," dropdown."]})]})}),(0,Hr.jsx)(Mq,{header:"Mouse Controls"}),(0,Hr.jsx)(F1,{})]})}};var Jr=_t(ur()),o0=class extends bi{constructor(){super(...arguments);this._toggleSelMode=()=>{this.plugin.selectionMode=!this.plugin.selectionMode}}componentDidMount(){this.subscribe(this.plugin.events.canvas3d.settingsUpdated,()=>this.forceUpdate()),this.subscribe(this.plugin.layout.events.updated,()=>this.forceUpdate()),this.subscribe(this.plugin.behaviors.interaction.selectionMode,()=>this.forceUpdate())}render(){let r=this.props.inline?{background:"transparent",width:"auto",height:"auto",lineHeight:"unset"}:{background:"transparent"};return(0,Jr.jsx)(sr,{svg:toe,onClick:this._toggleSelMode,title:"Toggle Selection Mode",style:r,toggleState:this.plugin.selectionMode})}},vO={granularity:n0.Params.granularity},FT=new Map([["add","Add/Union Selection"],["remove","Remove/Subtract Selection"],["intersect","Intersect Selection"],["set","Set Selection"]]),IO=class extends Fr{constructor(){super(...arguments);this.state={action:void 0,helper:void 0,isEmpty:!0,isBusy:!1,canUndo:!1,structureSelectionParams:vO};this.set=(r,n)=>{this.plugin.managers.structure.selection.fromSelectionQuery(r,n,!1)};this.selectQuery=(r,n)=>{if(!r||!this.state.action){this.setState({action:void 0});return}let o=this.state.action;n?.shiftKey?this.set(o,r.value):this.setState({action:void 0},()=>{this.set(o,r.value)})};this.selectHelper=(r,n)=>{if(console.log(r),!r||!this.state.action){this.setState({action:void 0,helper:void 0});return}this.setState({helper:r.value.kind})};this.queriesItems=[];this.queriesVersion=-1;this.helpersItems=void 0;this.toggleAdd=this.showAction("add");this.toggleRemove=this.showAction("remove");this.toggleIntersect=this.showAction("intersect");this.toggleSet=this.showAction("set");this.toggleTheme=this.showAction("theme");this.toggleAddComponent=this.showAction("add-component");this.toggleHelp=this.showAction("help");this.setGranuality=({value:r})=>{this.plugin.managers.interactivity.setProps({granularity:r})};this.turnOff=()=>this.plugin.selectionMode=!1;this.undo=()=>{let r=this.plugin.state.data.undo();r&&this.plugin.runTask(r)};this.subtract=()=>{let r=this.plugin.managers.structure.hierarchy.getStructuresWithSelection(),n=[];for(let o of r)n.push(...o.components);n.length!==0&&this.plugin.managers.structure.component.modifyByCurrentSelection(n,"subtract")}}componentDidMount(){this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,n=>{let o=n.hierarchy.structures.length===0;this.state.isEmpty!==o&&this.setState({isEmpty:o}),this.queriesVersion=-1,this.forceUpdate()}),this.subscribe(this.plugin.behaviors.state.isBusy,n=>{this.setState({isBusy:n,action:void 0})}),this.subscribe(this.plugin.managers.interactivity.events.propsUpdated,()=>{this.forceUpdate()}),this.subscribe(this.plugin.state.data.events.historyUpdated,({state:n})=>{this.setState({canUndo:n.canUndo})});let r=this.plugin.spec.components?.selectionTools?.granularityOptions;if(r){let n=new Set(r),o={...vO,granularity:{...vO.granularity,options:vO.granularity.options.filter(([i])=>n.has(i))}};this.setState({structureSelectionParams:o})}}get isDisabled(){return this.state.isBusy||this.state.isEmpty}get structures(){let r=[];for(let n of this.plugin.managers.structure.hierarchy.selection.structures){let o=n.cell.obj?.data;o&&r.push(o)}return r}get queries(){let{registry:r}=this.plugin.query.structure;if(r.version!==this.queriesVersion){let n=this.structures,o=[...r.list,...Q1e(n),...X1e(n),...W1e(n)].sort((i,a)=>a.priority-i.priority);this.queriesItems=Rr.createItems(o,{filter:i=>i!==oi.current&&!i.isHidden,label:i=>i.label,category:i=>i.category,description:i=>i.description}),this.queriesVersion=r.version}return this.queriesItems}get helpers(){if(this.helpersItems)return this.helpersItems;let r=[{kind:"residue-list",category:"Helpers",label:"Atom/Residue Identifier List",description:"Create a selection from a list of atom/residue ranges."}];return this.helpersItems=Rr.createItems(r,{label:n=>n.label,category:n=>n.category,description:n=>n.description}),this.helpersItems}showAction(r){return()=>this.setState({action:this.state.action===r?void 0:r,helper:void 0})}render(){let r=this.plugin.managers.interactivity.props.granularity,n=this.plugin.spec.components?.selectionTools?.hide,o=this.state.canUndo?`Undo ${this.plugin.state.data.latestUndoLabel}`:"Some mistakes of the past can be undone.",i;if(this.state.action&&!this.state.helper)i=(0,Jr.jsxs)(Jr.Fragment,{children:[this.state.action&&this.state.action!=="theme"&&this.state.action!=="add-component"&&this.state.action!=="help"&&(0,Jr.jsxs)("div",{className:"msp-selection-viewport-controls-actions",children:[(0,Jr.jsx)(Rr,{header:FT.get(this.state.action),title:"Click to close.",items:this.queries,onSelect:this.selectQuery,noOffset:!0}),(0,Jr.jsx)(Rr,{items:this.helpers,onSelect:this.selectHelper,noOffset:!0})]}),this.state.action==="theme"&&(0,Jr.jsx)("div",{className:"msp-selection-viewport-controls-actions",children:(0,Jr.jsx)(zl,{header:"Theme",title:"Click to close.",initialExpanded:!0,hideExpander:!0,hideOffset:!0,onHeaderClick:this.toggleTheme,topRightIcon:Bc,children:(0,Jr.jsx)(Bq,{onApply:this.toggleTheme})})}),this.state.action==="add-component"&&(0,Jr.jsx)("div",{className:"msp-selection-viewport-controls-actions",children:(0,Jr.jsx)(zl,{header:"Add Component",title:"Click to close.",initialExpanded:!0,hideExpander:!0,hideOffset:!0,onHeaderClick:this.toggleAddComponent,topRightIcon:Bc,children:(0,Jr.jsx)(FD,{onApply:this.toggleAddComponent,forSelection:!0})})}),this.state.action==="help"&&(0,Jr.jsx)("div",{className:"msp-selection-viewport-controls-actions",children:(0,Jr.jsxs)(zl,{header:"Help",title:"Click to close.",initialExpanded:!0,hideExpander:!0,hideOffset:!0,onHeaderClick:this.toggleHelp,topRightIcon:Bc,maxHeight:"300px",children:[(0,Jr.jsx)(Wd,{header:"Selection Operations",children:(0,Jr.jsxs)(jd,{children:["Use ",(0,Jr.jsx)(Dn,{svg:F2,inline:!0})," ",(0,Jr.jsx)(Dn,{svg:L2,inline:!0})," ",(0,Jr.jsx)(Dn,{svg:V2,inline:!0})," ",(0,Jr.jsx)(Dn,{svg:K0,inline:!0})," to modify the selection."]})}),(0,Jr.jsx)(Wd,{header:"Representation Operations",children:(0,Jr.jsxs)(jd,{children:["Use ",(0,Jr.jsx)(Dn,{svg:IM,inline:!0})," ",(0,Jr.jsx)(Dn,{svg:O2,inline:!0})," ",(0,Jr.jsx)(Dn,{svg:z2,inline:!0})," ",(0,Jr.jsx)(Dn,{svg:H2,inline:!0})," to color, create components, remove from components, or undo actions."]})}),(0,Jr.jsx)(F1,{selectOnly:!0})]})})]});else if(FT.has(this.state.action)&&this.state.helper==="residue-list"){let a=()=>this.setState({action:void 0,helper:void 0});i=(0,Jr.jsx)("div",{className:"msp-selection-viewport-controls-actions",children:(0,Jr.jsx)(zl,{header:"Atom/Residue Identifier List",title:"Click to close.",initialExpanded:!0,hideExpander:!0,hideOffset:!0,onHeaderClick:a,topRightIcon:Bc,children:(0,Jr.jsx)(yht,{modifier:this.state.action,plugin:this.plugin,close:a})})})}return(0,Jr.jsxs)(Jr.Fragment,{children:[(0,Jr.jsxs)("div",{className:"msp-flex-row",style:{background:"none"},children:[!n?.granularity&&(0,Jr.jsx)(Jg,{title:"Picking Level for selecting and highlighting",param:this.state.structureSelectionParams.granularity,name:"granularity",value:r,onChange:this.setGranuality,isDisabled:this.isDisabled}),!n?.union&&(0,Jr.jsx)(yi,{icon:F2,title:`${FT.get("add")}. Hold shift key to keep menu open.`,toggle:this.toggleAdd,isSelected:this.state.action==="add",disabled:this.isDisabled}),!n?.subtract&&(0,Jr.jsx)(yi,{icon:L2,title:`${FT.get("remove")}. Hold shift key to keep menu open.`,toggle:this.toggleRemove,isSelected:this.state.action==="remove",disabled:this.isDisabled}),!n?.intersect&&(0,Jr.jsx)(yi,{icon:V2,title:`${FT.get("intersect")}. Hold shift key to keep menu open.`,toggle:this.toggleIntersect,isSelected:this.state.action==="intersect",disabled:this.isDisabled}),!n?.set&&(0,Jr.jsx)(yi,{icon:K0,title:`${FT.get("set")}. Hold shift key to keep menu open.`,toggle:this.toggleSet,isSelected:this.state.action==="set",disabled:this.isDisabled}),!n?.theme&&(0,Jr.jsx)(yi,{icon:IM,title:"Apply Theme to Selection",toggle:this.toggleTheme,isSelected:this.state.action==="theme",disabled:this.isDisabled,style:{marginLeft:"10px"}}),!n?.componentAdd&&(0,Jr.jsx)(yi,{icon:O2,title:"Create Component of Selection with Representation",toggle:this.toggleAddComponent,isSelected:this.state.action==="add-component",disabled:this.isDisabled}),!n?.componentRemove&&(0,Jr.jsx)(sr,{svg:z2,title:"Remove/subtract Selection from all Components",onClick:this.subtract,disabled:this.isDisabled}),!n?.undo&&(0,Jr.jsx)(sr,{svg:H2,onClick:this.undo,disabled:!this.state.canUndo||this.isDisabled,title:o}),!n?.help&&(0,Jr.jsx)(yi,{icon:Du,title:"Show/hide help",toggle:this.toggleHelp,style:{marginLeft:"10px"},isSelected:this.state.action==="help"}),!n?.cancel&&this.plugin.config.get(Lr.Viewport.ShowSelectionMode)&&(0,Jr.jsx)(sr,{svg:G2,title:"Turn selection mode off",onClick:this.turnOff})]}),i]})}},AO=class extends Fr{constructor(){super(...arguments);this.state={isEmpty:!0,isBusy:!1};this.clear=()=>this.plugin.managers.interactivity.lociSelects.deselectAll();this.focus=()=>{if(this.plugin.managers.structure.selection.stats.elementCount===0)return;let{sphere:r}=this.plugin.managers.structure.selection.getBoundary();this.plugin.managers.camera.focusSphere(r)};this.highlight=r=>{this.plugin.managers.interactivity.lociHighlights.clearHighlights(),this.plugin.managers.structure.selection.entries.forEach(n=>{this.plugin.managers.interactivity.lociHighlights.highlight({loci:n.selection},!1)})};this.clearHighlight=()=>{this.plugin.managers.interactivity.lociHighlights.clearHighlights()}}componentDidMount(){this.subscribe(this.plugin.managers.structure.selection.events.changed,()=>{this.forceUpdate()}),this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,r=>{let n=r.structures.length===0;this.state.isEmpty!==n&&this.setState({isEmpty:n})}),this.subscribe(this.plugin.behaviors.state.isBusy,r=>{this.setState({isBusy:r})})}get isDisabled(){return this.state.isBusy||this.state.isEmpty}get stats(){let r=this.plugin.managers.structure.selection.stats;return r.structureCount===0||r.elementCount===0?"Nothing Selected":`${ud(r.label)} Selected`}render(){let r=this.plugin.managers.structure.selection.stats,n=r.structureCount===0||r.elementCount===0;return n&&this.props.hideOnEmpty?null:(0,Jr.jsx)(Jr.Fragment,{children:(0,Jr.jsxs)("div",{className:"msp-flex-row",children:[(0,Jr.jsx)(gr,{noOverflow:!0,onClick:this.focus,title:"Click to Focus Selection",disabled:n,onMouseEnter:this.highlight,onMouseLeave:this.clearHighlight,style:{textAlignLast:n?void 0:"left"},children:this.stats}),!n&&(0,Jr.jsx)(sr,{svg:G2,onClick:this.clear,title:"Clear",className:"msp-form-control",flex:!0})]})})}},Bq=class extends bi{constructor(){super(...arguments);this._params=es(r=>Kp.getThemeParams(this.plugin,r));this.state={values:C.getDefaultValues(this.params)};this.apply=()=>{this.plugin.managers.structure.component.applyTheme(this.state.values,this.plugin.managers.structure.hierarchy.current.structures),this.props.onApply?.()};this.paramsChanged=r=>this.setState({values:r})}get params(){return this._params(this.plugin.managers.structure.component.pivotStructure)}render(){return(0,Jr.jsxs)(Jr.Fragment,{children:[(0,Jr.jsx)(uo,{params:this.params,values:this.state.values,onChangeValues:this.paramsChanged}),(0,Jr.jsx)(gr,{icon:IM,className:"msp-btn-commit msp-btn-commit-on",onClick:this.apply,style:{marginTop:"1px"},children:"Apply Theme"})]})}},HRe={idType:C.Select("auth",C.arrayToOptions(["auth","label","atom-id","element-symbol"])),identifiers:C.Text("",{description:"A comma separated list of atom identifiers (e.g. 10, 15-25), element symbols (e.g. N, C or 20-200) or residue ranges in given chain (e.g. A 10-15, B 25, C 30:i)"})},ght=C.getDefaultValues(HRe);function yht({modifier:e,plugin:t,close:r}){let[n,o]=zRe.useState(ght),i=()=>{if(n.identifiers.trim().length!==0)try{r();let a=NRe(n.identifiers,n.idType);t.managers.structure.selection.fromCompiledQuery(e,a,!1)}catch(a){console.error(a),t.log.error("Failed to create selection")}};return(0,Jr.jsxs)(Jr.Fragment,{children:[(0,Jr.jsx)(uo,{params:HRe,values:n,onChangeValues:o,onEnter:i}),(0,Jr.jsxs)(gr,{className:"msp-btn-commit msp-btn-commit-on",disabled:n.identifiers.trim().length===0,onClick:i,style:{marginTop:"1px"},children:[Sm(e)," Selection"]})]})}var On=_t(ur()),TO=class extends kc{defaultState(){return{isCollapsed:!1,header:"Measurements",brand:{accent:"gray",svg:Ene}}}renderControls(){return(0,On.jsxs)(On.Fragment,{children:[(0,On.jsx)(kq,{}),(0,On.jsx)(Eq,{})]})}},Eq=class extends bi{componentDidMount(){this.subscribe(this.plugin.managers.structure.measurement.behaviors.state,()=>{this.forceUpdate()})}renderGroup(t,r){let n=[];for(let o of t)o.obj&&n.push((0,On.jsx)(Lq,{cell:o},o.obj.id));return n.length?(0,On.jsx)(fs,{header:r,initiallyExpanded:!0,children:n}):null}render(){let t=this.plugin.managers.structure.measurement.state;return(0,On.jsxs)("div",{style:{marginTop:"6px"},children:[this.renderGroup(t.labels,"Labels"),this.renderGroup(t.distances,"Distances"),this.renderGroup(t.angles,"Angles"),this.renderGroup(t.dihedrals,"Dihedrals"),this.renderGroup(t.orientations,"Orientations"),this.renderGroup(t.planes,"Planes")]})}},kq=class extends bi{constructor(){super(...arguments);this.state={isBusy:!1,action:void 0};this.measureDistance=()=>{let r=this.plugin.managers.structure.selection.additionsHistory;this.plugin.managers.structure.measurement.addDistance(r[0].loci,r[1].loci)};this.measureAngle=()=>{let r=this.plugin.managers.structure.selection.additionsHistory;this.plugin.managers.structure.measurement.addAngle(r[0].loci,r[1].loci,r[2].loci)};this.measureDihedral=()=>{let r=this.plugin.managers.structure.selection.additionsHistory;this.plugin.managers.structure.measurement.addDihedral(r[0].loci,r[1].loci,r[2].loci,r[3].loci)};this.addLabel=()=>{let r=this.plugin.managers.structure.selection.additionsHistory;this.plugin.managers.structure.measurement.addLabel(r[0].loci)};this.addOrientation=()=>{let r=[];this.plugin.managers.structure.selection.entries.forEach(n=>{r.push(n.selection)}),this.plugin.managers.structure.measurement.addOrientation(r)};this.addPlane=()=>{let r=[];this.plugin.managers.structure.selection.entries.forEach(n=>{r.push(n.selection)}),this.plugin.managers.structure.measurement.addPlane(r)};this.selectAction=r=>{this.toggleAdd(),r&&(r?.value)()};this.toggleAdd=()=>this.setState({action:this.state.action==="add"?void 0:"add"});this.toggleOptions=()=>this.setState({action:this.state.action==="options"?void 0:"options"})}componentDidMount(){this.subscribe(this.selection.events.additionsHistoryUpdated,()=>{this.forceUpdate(),this.updateOrderLabels()}),this.subscribe(this.plugin.behaviors.state.isBusy,r=>{this.setState({isBusy:r})})}componentWillUnmount(){this.clearOrderLabels(),super.componentWillUnmount()}componentDidUpdate(r,n){this.state.action!==n.action&&this.updateOrderLabels()}clearOrderLabels(){this.plugin.managers.structure.measurement.addOrderLabels([])}updateOrderLabels(){if(this.state.action!=="add"){this.clearOrderLabels();return}let r=[],n=this.selection.additionsHistory;for(let o=0;o<n.length&&o<4;o++)r.push(n[o].loci);this.plugin.managers.structure.measurement.addOrderLabels(r)}get selection(){return this.plugin.managers.structure.selection}get actions(){let r=this.selection.additionsHistory;return[{kind:"item",label:`Label ${r.length===0?" (1 selection item required)":" (1st selection item)"}`,value:this.addLabel,disabled:r.length===0},{kind:"item",label:`Distance ${r.length<2?" (2 selection items required)":" (top 2 selection items)"}`,value:this.measureDistance,disabled:r.length<2},{kind:"item",label:`Angle ${r.length<3?" (3 selection items required)":" (top 3 items)"}`,value:this.measureAngle,disabled:r.length<3},{kind:"item",label:`Dihedral ${r.length<4?" (4 selection items required)":" (top 4 selection items)"}`,value:this.measureDihedral,disabled:r.length<4},{kind:"item",label:`Orientation ${r.length===0?" (selection required)":" (current selection)"}`,value:this.addOrientation,disabled:r.length===0},{kind:"item",label:`Plane ${r.length===0?" (selection required)":" (current selection)"}`,value:this.addPlane,disabled:r.length===0}]}highlight(r){this.plugin.managers.interactivity.lociHighlights.highlightOnly({loci:r},!1)}moveHistory(r,n){this.plugin.managers.structure.selection.modifyHistory(r,n,4)}focusLoci(r){this.plugin.managers.camera.focusLoci(r)}historyEntry(r,n){let o=this.plugin.managers.structure.selection.additionsHistory;return(0,On.jsxs)("div",{className:"msp-flex-row",onMouseEnter:()=>this.highlight(r.loci),onMouseLeave:()=>this.plugin.managers.interactivity.lociHighlights.clearHighlights(),children:[(0,On.jsxs)(gr,{noOverflow:!0,title:"Click to focus. Hover to highlight.",onClick:()=>this.focusLoci(r.loci),style:{width:"auto",textAlign:"left"},children:[n,". ",(0,On.jsx)("span",{dangerouslySetInnerHTML:{__html:r.label}})]}),o.length>1&&(0,On.jsx)(sr,{svg:Rx,small:!0,className:"msp-form-control",onClick:()=>this.moveHistory(r,"up"),flex:"20px",title:"Move up"}),o.length>1&&(0,On.jsx)(sr,{svg:_x,small:!0,className:"msp-form-control",onClick:()=>this.moveHistory(r,"down"),flex:"20px",title:"Move down"}),(0,On.jsx)(sr,{svg:$s,small:!0,className:"msp-form-control",onClick:()=>this.plugin.managers.structure.selection.modifyHistory(r,"remove"),flex:!0,title:"Remove"})]},r.id)}add(){let r=this.plugin.managers.structure.selection.additionsHistory,n=[];for(let a=0,s=Math.min(r.length,4);a<s;a++)n.push(this.historyEntry(r[a],a+1));let i=this.plugin.config.get(Lr.Viewport.ShowSelectionMode)?(0,On.jsxs)(On.Fragment,{children:[" ","(toggle ",(0,On.jsx)(o0,{inline:!0})," mode)"]}):null;return(0,On.jsxs)(On.Fragment,{children:[(0,On.jsx)(Rr,{items:this.actions,onSelect:this.selectAction}),n.length>0&&(0,On.jsx)("div",{className:"msp-control-offset",children:n}),n.length===0&&(0,On.jsx)("div",{className:"msp-control-offset msp-help-text",children:(0,On.jsxs)("div",{className:"msp-help-description",children:[(0,On.jsx)(Dn,{svg:Du,inline:!0}),"Add one or more selections",i]})})]})}render(){return(0,On.jsxs)(On.Fragment,{children:[(0,On.jsxs)("div",{className:"msp-flex-row",children:[(0,On.jsx)(yi,{icon:Bf,label:"Add",toggle:this.toggleAdd,isSelected:this.state.action==="add",disabled:this.state.isBusy,className:"msp-btn-apply-simple"}),(0,On.jsx)(yi,{icon:Il,label:"",title:"Options",toggle:this.toggleOptions,isSelected:this.state.action==="options",disabled:this.state.isBusy,style:{flex:"0 0 40px",padding:0}})]}),this.state.action==="add"&&this.add(),this.state.action==="options"&&(0,On.jsx)(Fq,{})]})}},Fq=class extends bi{constructor(){super(...arguments);this.state={isDisabled:!1};this.changed=r=>{this.plugin.managers.structure.measurement.setOptions(r)}}componentDidMount(){this.subscribe(this.plugin.managers.structure.measurement.behaviors.state,()=>{this.forceUpdate()}),this.subscribe(this.plugin.behaviors.state.isBusy,r=>{this.setState({isDisabled:r})})}render(){let r=this.plugin.managers.structure.measurement.state;return(0,On.jsx)("div",{className:"msp-control-offset",children:(0,On.jsx)(uo,{params:wq,values:r.options,onChangeValues:this.changed,isDisabled:this.state.isDisabled})})}},Lq=class extends bi{constructor(){super(...arguments);this.state={showUpdate:!1};this.delete=()=>{lt.State.RemoveObject(this.plugin,{state:this.props.cell.parent,ref:this.props.cell.transform.parent,removeParentGhosts:!0})};this.toggleVisibility=r=>{r.preventDefault(),lt.State.ToggleVisibility(this.plugin,{state:this.props.cell.parent,ref:this.props.cell.transform.parent}),r.currentTarget.blur()};this.highlight=()=>{if(!this.selections)return;this.plugin.managers.interactivity.lociHighlights.clearHighlights();for(let o of this.lociArray)this.plugin.managers.interactivity.lociHighlights.highlight({loci:o},!1);let n=this.props.cell.obj?.data.repr.getAllLoci();if(n)for(let o of n)this.plugin.managers.interactivity.lociHighlights.highlight({loci:o},!1)};this.clearHighlight=()=>{this.plugin.managers.interactivity.lociHighlights.clearHighlights()};this.toggleUpdate=()=>this.setState({showUpdate:!this.state.showUpdate});this.focus=()=>{if(!this.selections)return;let n=nr.getBundleBoundingSphere({loci:this.lociArray});n&&this.plugin.managers.camera.focusSphere(n)};this.selectAction=r=>{r&&(this.setState({showUpdate:!1}),(r?.value)())}}componentDidMount(){this.subscribe(this.plugin.state.events.cell.stateUpdated,r=>{this.forceUpdate()})}get selections(){return this.props.cell.obj?.data.sourceData}get lociArray(){let r=this.selections;return r?r.infos?[r.infos[0].loci]:r.pairs?r.pairs[0].loci:r.triples?r.triples[0].loci:r.quads?r.quads[0].loci:r.locis?r.locis:[]:[]}get label(){let r=this.selections;return r?r.infos?Np(r.infos[0].loci,{condensed:!0}):r.pairs?RA(r.pairs[0],{condensed:!0,unitLabel:this.plugin.managers.structure.measurement.state.options.distanceUnitLabel}):r.triples?DA(r.triples[0],{condensed:!0}):r.quads?wA(r.quads[0],{condensed:!0}):r.locis?RC(r.locis,{countsOnly:!0}):"<empty>":"<empty>"}get actions(){return this.props.cell.sourceRef,[Rr.Item("Select This",()=>this.plugin.managers.structure.selection.fromSelections(this.props.cell.sourceRef),{icon:K0})]}render(){let{cell:r}=this.props,{obj:n}=r;return n?(0,On.jsxs)(On.Fragment,{children:[(0,On.jsxs)("div",{className:"msp-flex-row",onMouseEnter:this.highlight,onMouseLeave:this.clearHighlight,children:[(0,On.jsx)("button",{className:"msp-form-control msp-control-button-label msp-no-overflow",title:"Click to focus. Hover to highlight.",onClick:this.focus,style:{width:"auto",textAlign:"left"},children:(0,On.jsx)("span",{dangerouslySetInnerHTML:{__html:this.label}})}),(0,On.jsx)(sr,{svg:r.state.isHidden?md:vm,toggleState:!1,small:!0,className:"msp-form-control",onClick:this.toggleVisibility,flex:!0,title:r.state.isHidden?"Show":"Hide"}),(0,On.jsx)(sr,{svg:$s,small:!0,className:"msp-form-control",onClick:this.delete,flex:!0,title:"Delete",toggleState:!1}),(0,On.jsx)(sr,{svg:Dx,className:"msp-form-control",onClick:this.toggleUpdate,flex:!0,title:"Actions",toggleState:this.state.showUpdate})]},n.id),this.state.showUpdate&&r.parent&&(0,On.jsx)(On.Fragment,{children:(0,On.jsxs)("div",{className:"msp-accent-offset",children:[(0,On.jsx)(Rr,{items:this.actions,onSelect:this.selectAction,noOffset:!0}),(0,On.jsx)(fs,{header:"Options",noOffset:!0,children:(0,On.jsx)(vc,{state:r.parent,transform:r.transform,customHeader:"none",autoHideApply:!0})})]})})]}):null}};var ey=_t(ur());function Vq(e,t,r,n){let o=Be.indexOf(t.unit.elements,t.element),i=Q.Loci(t.structure,[{unit:t.unit,indices:xe.ofSingleton(o)}]),a=n==="residue"?Q.Loci.extendToWholeResidues(i):Q.Loci.extendToWholeChains(i),s=Ke.entity.pdbx_description(t).join(", ");for(let l of r.units){let u=Q.Loci(a.structure,[{unit:l,indices:a.elements[0].indices}]),c=Np(u,{reverse:!0,hidePrefix:!0,htmlStyling:!1,granularity:n});c||(c=Np(u,{hidePrefix:!1,htmlStyling:!1})),r.units.length>1&&(c+=` | ${u.elements[0].unit.conformation.operator.name}`);let m={label:c,category:s,loci:u};e.has(s)?e.get(s).push(m):e.set(s,[m])}}function bht(e){let t=new Map,r=Q.Location.create(e);for(let o of e.unitSymmetryGroups){if(!ue.isAtomic(o.units[0]))continue;r.unit=o.units[0],r.element=o.elements[0];let i=ue.Traits.is(r.unit.traits,ue.Trait.MultiChain),a=Ke.entity.type(r),s=a==="non-polymer",l=a==="branched";if(!!Ke.entity.prd_id(r))Vq(t,r,o,"chain");else if(s&&!i)Vq(t,r,o,"residue");else if(l||s&&i){let c=r.unit,{index:m}=c.model.atomicHierarchy.residueAtomSegments,d=-1;for(let p=0,h=c.elements.length;p<h;++p){let f=c.elements[p],g=m[f];g!==d&&(r.element=f,Vq(t,r,o,"residue"),d=g)}}}let n=[];return t.forEach((o,i)=>{o.length===1?n.push({label:`${i}: ${o[0].label}`,loci:o[0].loci}):o.length<2e3&&n.push(...o)}),n}var PO=class extends Fr{constructor(){super(...arguments);this.state={isBusy:!1,showAction:!1};this.getSelectionItems=es(r=>{let n=[];for(let o of r){let i=o.cell.obj?.data;if(i){let a=bht(i);a.length>0&&n.push([Rr.Header(i.label,{description:i.label}),...Rr.createItems(a,{label:s=>s.label,category:s=>s.category,description:s=>s.label})])}}return n});this.selectAction=(r,n)=>{if(!r||!this.state.showAction){this.setState({showAction:!1});return}let o=r.value;n?.shiftKey?this.plugin.managers.structure.focus.addFromLoci(o.loci):this.plugin.managers.structure.focus.set(o),this.focusCamera()};this.toggleAction=()=>this.setState({showAction:!this.state.showAction});this.focusCamera=()=>{let{current:r}=this.plugin.managers.structure.focus;r&&this.plugin.managers.camera.focusLoci(r.loci)};this.clear=()=>{this.plugin.managers.structure.focus.clear(),this.plugin.managers.camera.reset()};this.highlightCurrent=()=>{let{current:r}=this.plugin.managers.structure.focus;r&&this.plugin.managers.interactivity.lociHighlights.highlightOnly({loci:r.loci},!1)};this.clearHighlights=()=>{this.plugin.managers.interactivity.lociHighlights.clearHighlights()}}componentDidMount(){this.subscribe(this.plugin.managers.structure.focus.behaviors.current,r=>{this.getSelectionItems([]),this.forceUpdate()}),this.subscribe(this.plugin.managers.structure.focus.events.historyUpdated,r=>{this.forceUpdate()}),this.subscribe(this.plugin.behaviors.state.isBusy,r=>{this.setState({isBusy:r,showAction:!1})})}get isDisabled(){return this.state.isBusy||this.plugin.managers.structure.hierarchy.selection.structures.length===0}get actionItems(){let r=[],{history:n}=this.plugin.managers.structure.focus;n.length>0&&r.push([Rr.Header("History",{description:"Previously focused on items."}),...Rr.createItems(n,{label:a=>a.label,description:a=>a.category&&a.label!==a.category?`${a.category} | ${a.label}`:a.label})]);let o=this.getSelectionItems(this.plugin.managers.structure.hierarchy.selection.structures);if(o.length===1){let s=o[0][0];s.initiallyExpanded=!0}let i=[];return o.length>0&&i.push(...o),r.length>0&&i.push(...r),i}getToggleBindingLabel(){let r=this.plugin.state.behaviors.transforms.get(p1.id);if(!r)return"";let n=r.params?.bindings.clickFocus;return!n||Ct.isEmpty(n)?"":Ct.formatTriggers(n)}render(){let{current:r}=this.plugin.managers.structure.focus,n=r?.label||"Nothing Focused",o="Click to Center Camera";if(!r){o="Select focus using the menu";let i=this.getToggleBindingLabel();i&&(o+=`
or use '${i}' on element`)}return(0,ey.jsxs)(ey.Fragment,{children:[(0,ey.jsxs)("div",{className:"msp-flex-row",children:[(0,ey.jsx)(gr,{noOverflow:!0,onClick:this.focusCamera,title:o,onMouseEnter:this.highlightCurrent,onMouseLeave:this.clearHighlights,disabled:this.isDisabled||!r,style:{textAlignLast:r?"left":void 0},children:n}),r&&(0,ey.jsx)(sr,{svg:G2,onClick:this.clear,title:"Clear",className:"msp-form-control",flex:!0,disabled:this.isDisabled}),(0,ey.jsx)(yi,{icon:Nne,title:"Select a focus target to center on an show its surroundings. Hold shift to focus on multiple targets.",toggle:this.toggleAction,isSelected:this.state.showAction,disabled:this.isDisabled,style:{flex:"0 0 40px",padding:0}})]}),this.state.showAction&&(0,ey.jsx)(Rr,{items:this.actionItems,onSelect:this.selectAction})]})}};var Nu=_t(ur()),_O=class extends kc{constructor(){super(...arguments);this.item=r=>{let n=this.plugin.managers.structure.hierarchy.seletionSet,o;switch(r.kind){case"model":{let a=r.cell.obj?.data;a&&Gt.TrajectoryInfo.get(a).size>1&&(o=`${r.cell.obj?.data.entryId} | Model ${Gt.TrajectoryInfo.get(a).index+1} of ${Gt.TrajectoryInfo.get(a).size}`),o=`${r.cell.obj?.data.entryId} | ${r.cell.obj?.label}`;break}case"structure":{let a=r.cell.obj?.data.models[0];if(a&&Gt.TrajectoryInfo.get(a).size>1){o=`${a.entryId} | ${r.cell.obj?.label} (Model ${Gt.TrajectoryInfo.get(a).index+1} of ${Gt.TrajectoryInfo.get(a).size})`;break}else if(a){o=`${a.entryId} | ${r.cell.obj?.label}`;break}else{o=`${r.cell.obj?.label}`;break}}default:o=r.cell.obj?.label;break}return{kind:"item",label:o||r.kind,selected:n.has(r.cell.transform.ref),value:[r]}};this.getTrajectoryItems=r=>r.models.length===0?this.item(r):[Rr.Header(r.cell.obj?.label),...r.models.map(this.getModelItems)];this.getModelItems=r=>{if(r.structures.length===0)return this.item(r);if(r.structures.length===1){let n=this.plugin.managers.structure.hierarchy.seletionSet,o=r.structures[0];return{label:`${r.cell.obj?.label} | ${o.cell.obj?.label}`,selected:n.has(o.cell.transform.ref),value:[r,o]}}return[Rr.Header(r.cell.obj?.label),...r.structures.map(this.item)]};this.selectHierarchy=r=>{if(!r||r.length===0)return;let n=[];for(let o of r)for(let i of o.value)n.push(i);this.plugin.managers.structure.hierarchy.updateCurrent(n,r[0].selected?"remove":"add")};this.toggleHierarchy=()=>this.setState({show:this.state.show!=="hierarchy"?"hierarchy":void 0});this.togglePreset=()=>this.setState({show:this.state.show!=="presets"?"presets":void 0});this.applyPreset=r=>{if(this.setState({show:void 0}),!r)return;let n=this.plugin.managers.structure,{trajectories:o}=n.hierarchy.selection;n.hierarchy.applyPreset(o,r.value)};this.updateModelQueueParams=void 0;this.isUpdatingModel=!1;this.updateStructureModel=r=>{this.updateModelQueueParams=r,this._updateStructureModel()};this.updateStructure=r=>{let{selection:n}=this.plugin.managers.structure.hierarchy,o=n.structures[0];return this.plugin.managers.structure.hierarchy.updateStructure(o,r)}}defaultState(){return{header:"Structure",isCollapsed:!1,isBusy:!1,brand:{accent:"purple",svg:Mne}}}componentDidMount(){this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,()=>this.forceUpdate()),this.subscribe(this.plugin.behaviors.state.isBusy,r=>{this.setState({isBusy:r})})}get hierarchyItems(){let r=this.plugin.managers.structure.hierarchy,{current:n}=r,o=[];return n.trajectories.length>1&&o.push([Rr.Header("Trajectories"),...n.trajectories.map(this.item)]),(n.models.length>1||n.trajectories.length>1)&&o.push([Rr.Header("Models"),...n.models.map(this.item)]),n.trajectories.length===1&&n.models.length===1?o.push(...n.structures.map(this.item)):n.structures.length>0&&o.push([Rr.Header("Structures"),...n.structures.map(this.item)]),o}get isEmpty(){let{structures:r,models:n,trajectories:o}=this.plugin.managers.structure.hierarchy.current;return o.length===0&&n.length===0&&r.length===0}get label(){let{structures:r,models:n,trajectories:o}=this.plugin.managers.structure.hierarchy.selection;if(r.length===1){let i=r[0];return i.model?.trajectory?.models&&i.model.trajectory.models.length===1?i.cell.obj?.data.label:i.model?`${i.model.cell.obj?.label} | ${i.cell.obj?.data.label}`:i.cell.obj?.data.label}if(r.length>1){let a=r[0]?.model?.trajectory,s=!0;for(let l of r)if(l?.model?.trajectory!==a){s=!1;break}return s&&a?`${a.cell.obj?.label} | ${r.length} structures`:`${r.length} structures`}if(n.length>0){let i=n[0].trajectory;if(n.length===1){let s=n[0].cell.obj?.data;return s&&Gt.TrajectoryInfo.get(s).size>1?`${i?.cell.obj?.label} | Model ${Gt.TrajectoryInfo.get(s).index+1} of ${Gt.TrajectoryInfo.get(s).size}`:`${i?.cell.obj?.label} | Model`}let a=!0;for(let s of n)if(s.trajectory!==i){a=!1;break}return a?`${i?.cell.obj?.label} | ${n.length} models`:`${n.length} models`}return o.length>0?o.length===1?`${o[0].cell.obj?.label} trajectory`:`${o.length} trajectories`:o.length===0&&n.length===0&&r.length===0?"Nothing Loaded":"Nothing Selected"}get presetActions(){let r=[],{trajectories:n}=this.plugin.managers.structure.hierarchy.selection;if(n.length===0)return r;let o=this.plugin.builders.structure.hierarchy.getPresets(n[0].cell.obj);if(n.length>1){let i=new Set(o);for(let a=1;a<n.length;a++){let s=this.plugin.builders.structure.hierarchy.getPresets(n[a].cell.obj),l=new Set(s);for(let u of s)l.has(u)||i.delete(u)}o=o.filter(a=>i.has(a))}for(let i of o)r.push(Rr.Item(i.display.name,i,{description:i.display.description}));return r}async _updateStructureModel(){if(!this.updateModelQueueParams||this.isUpdatingModel)return;let r=this.updateModelQueueParams;this.updateModelQueueParams=void 0;try{this.isUpdatingModel=!0;let{selection:n}=this.plugin.managers.structure.hierarchy,o=n.structures[0].model;await this.plugin.state.updateTransform(this.plugin.state.data,o.cell.transform.ref,r,"Model Index")}finally{this.isUpdatingModel=!1,this._updateStructureModel()}}get modelIndex(){let{selection:r}=this.plugin.managers.structure.hierarchy;if(r.structures.length!==1)return null;let n=r.structures[0].model;if(!n||n.cell.transform.transformer!==Qe.Model.ModelFromTrajectory||!n.cell.obj||Gt.TrajectoryInfo.get(n.cell.obj.data).size<=1)return null;let o=n.cell.params?.definition;return o?(0,Nu.jsx)(uo,{params:o,values:n.cell.params?.values,onChangeValues:this.updateStructureModel,isDisabled:this.state.isBusy}):null}get structureType(){let{selection:r}=this.plugin.managers.structure.hierarchy;if(r.structures.length!==1)return null;let n=r.structures[0];return!n.cell.params?.definition||!n.cell.parent?null:(0,Nu.jsx)(vc,{state:n.cell.parent,transform:n.cell.transform,customHeader:"none",customUpdate:this.updateStructure,noMargin:!0,autoHideApply:!0})}get transform(){let{selection:r}=this.plugin.managers.structure.hierarchy;if(r.structures.length!==1)return null;let n=r.structures[0];if(!n.cell.parent)return null;let o=tr.tryFindDecorator(this.plugin.state.data,n.cell.transform.ref,Qe.Model.TransformStructureConformation);if(o)return(0,Nu.jsx)(fs,{header:"Conformation Transform",children:(0,Nu.jsx)(vc,{state:o.parent,transform:o.transform,customHeader:"none",noMargin:!0,autoHideApply:!0})})}renderControls(){let r=this.state.isBusy||this.isEmpty,n=this.presetActions,o=this.label;return(0,Nu.jsxs)(Nu.Fragment,{children:[(0,Nu.jsxs)("div",{className:"msp-flex-row",style:{marginTop:"1px"},children:[(0,Nu.jsx)(gr,{noOverflow:!0,flex:!0,onClick:this.toggleHierarchy,disabled:r,title:o,children:o}),n.length>0&&(0,Nu.jsx)(sr,{svg:Ly,className:"msp-form-control",flex:"40px",onClick:this.togglePreset,title:"Apply a structure presets to the current hierarchy.",toggleState:this.state.show==="presets",disabled:r})]}),this.state.show==="hierarchy"&&(0,Nu.jsx)(Rr,{items:this.hierarchyItems,onSelect:this.selectHierarchy,multiselect:!0}),this.state.show==="presets"&&(0,Nu.jsx)(Rr,{items:n,onSelect:this.applyPreset}),this.modelIndex,this.structureType,this.transform,(0,Nu.jsxs)("div",{style:{marginTop:"6px"},children:[(0,Nu.jsx)(PO,{}),(0,Nu.jsx)(AO,{hideOnEmpty:!0})]})]})}};function Gb(e,t,r={}){let n=r;return typeof n.type=="string"||typeof n.color=="string"||typeof n.size=="string"?xht(e,t||Ge.One,r):jRe(e,t||Ge.One,r)}function xht(e,t,r){let n=r.type&&e.representation.volume.registry.get(r.type)||e.representation.volume.registry.default.provider,o=r.color&&e.representation.volume.themes.colorThemeRegistry.get(r.color)||e.representation.volume.themes.colorThemeRegistry.get(n.defaultColorTheme.name),i=r.size&&e.representation.volume.themes.sizeThemeRegistry.get(r.size)||e.representation.volume.themes.sizeThemeRegistry.get(n.defaultSizeTheme.name);return jRe(e,t,{type:n,typeParams:r.typeParams,color:o,colorParams:r.colorParams,size:i,sizeParams:r.sizeParams})}function jRe(e,t,r={}){let{themes:n}=e.representation.volume,o={volume:t},i=r.type||e.representation.volume.registry.default.provider,a=C.getDefaultValues(i.getParams(n,t)),s=Object.assign(a,r.typeParams),l=r.color||n.colorThemeRegistry.get(i.defaultColorTheme.name),u=C.getDefaultValues(l.getParams(o));l.name===i.defaultColorTheme.name&&Object.assign(u,i.defaultColorTheme.props);let c=Object.assign(u,r.colorParams),m=r.size||n.sizeThemeRegistry.get(i.defaultSizeTheme.name),d=C.getDefaultValues(m.getParams(o));m.name===i.defaultSizeTheme.name&&Object.assign(d,i.defaultSizeTheme.props);let p=Object.assign(d,r.sizeParams);return{type:{name:i.name,params:s},colorTheme:{name:l.name,params:c},sizeTheme:{name:m.name,params:p}}}function XRe(e,t){let r=Iht(e,t||RO());return Rht(e.tree,r),t&&t.refs.forEach(Pht,r),{hierarchy:r.hierarchy,added:r.added,changed:r.changed}}function RO(){return{volumes:[],lazyVolumes:[],refs:new Map}}function Cht(e){return{kind:"volume",cell:e,version:e.transform.version,representations:[]}}function Sht(e){return{kind:"lazy-volume",cell:e,version:e.transform.version}}function vht(e,t){return{kind:"volume-representation",cell:e,version:e.transform.version,volume:t}}function Iht(e,t){return{state:e,oldHierarchy:t,hierarchy:RO(),changed:!1,added:new Set}}function Oq(e,t,r,n,...o){let i=n(...o);r.push(i),e.hierarchy.refs.set(t.transform.ref,i);let a=e.oldHierarchy.refs.get(t.transform.ref);return a?a.version!==t.transform.version&&(e.changed=!0):(e.added.add(i.cell.transform.ref),e.changed=!0),i}function Aht(e,t){return(r,n)=>!t(n)&&e.is(r.obj)}function WRe(){}var Tht=[[Aht(ne.Volume.Data,e=>e.currentVolume),(e,t)=>{e.currentVolume=Oq(e,t,e.hierarchy.volumes,Cht,t)},e=>e.currentVolume=void 0],[e=>ne.Volume.Lazy.is(e.obj),(e,t)=>{Oq(e,t,e.hierarchy.lazyVolumes,Sht,t)},WRe],[(e,t)=>!e.state.isGhost&&!!t.currentVolume&&ne.Volume.Representation3D.is(e.obj),(e,t)=>(e.currentVolume&&Oq(e,t,e.currentVolume.representations,vht,t,e.currentVolume),!1),WRe]];function QRe(e){if(!e||!e?.parent||!e.parent.cells.has(e.transform.ref))return!1;let{obj:t}=e;return!(!t||t===Gn.Null||e.status!=="ok"&&e.status!=="error")}function Pht(e){let{cell:t}=e;QRe(t)||(this.changed=!0)}function _ht(e){ZRe(this,this.tree.transforms.get(e))}function ZRe(e,t){let{state:r}=e,n=r.state.cells.get(t.ref);if(!QRe(n))return;let o,i=!1;for(let[s,l,u]of Tht)if(s(n,r)){if(l(r,n)===!1){i=!0;break}o=u;break}if(i)return;let a=e.tree.children.get(t.ref);a&&a.size&&a.forEach(_ht,e),o&&o(r)}function Rht(e,t){let r={tree:e,state:t};return ZRe(r,e.root),r.state}var i0=class extends Pc{constructor(r){super();this.plugin=r;this.state={syncedTree:this.dataState.tree,notified:!1,hierarchy:RO(),selection:void 0};this.behaviors={selection:this.ev.behavior({hierarchy:this.current,volume:this.selection})};this.subscribe(r.state.data.events.changed,n=>{n.inTransaction||r.behaviors.state.isAnimating.value||this.sync(!0)}),this.subscribe(r.behaviors.state.isAnimating,n=>{!n&&!r.behaviors.state.isUpdating.value&&this.sync(!0)})}get dataState(){return this.plugin.state.data}get current(){return this.sync(!1),this.state.hierarchy}get selection(){return this.sync(!1),this.state.selection}sync(r){if(!r&&this.dataState.inUpdate)return;if(this.state.syncedTree===this.dataState.tree){r&&!this.state.notified&&(this.state.notified=!0,this.behaviors.selection.next({hierarchy:this.state.hierarchy,volume:this.state.selection}));return}this.state.syncedTree=this.dataState.tree;let n=XRe(this.plugin.state.data,this.current);if(!n.changed)return;let{hierarchy:o}=n;this.state.hierarchy=o,this.state.selection?this.state.selection=o.refs.has(this.state.selection.cell.transform.ref)?o.refs.get(this.state.selection.cell.transform.ref):o.volumes[0]:this.state.selection=o.volumes[0],r?(this.state.notified=!0,this.behaviors.selection.next({hierarchy:o,volume:this.state.selection})):this.state.notified=!1}setCurrent(r){this.state.selection=r||this.state.hierarchy.volumes[0],this.behaviors.selection.next({hierarchy:this.state.hierarchy,volume:r||this.state.hierarchy.volumes[0]})}remove(r,n){if(r.length===0)return;let o=this.plugin.state.data.build();for(let i of r)o.delete(typeof i=="string"?i:i.cell.transform.ref);return o.commit({canUndo:n?"Remove":!1})}toggleVisibility(r,n){if(r.length===0)return;let o=n!==void 0?n!=="show":!r[0].cell.state.isHidden;for(let i of r)uh(this.dataState,i.cell.transform.ref,o)}addRepresentation(r,n){return this.dataState.build().to(r.cell).apply(Qe.Representation.VolumeRepresentation3D,Gb(this.plugin,r.cell.obj?.data,{type:n})).commit({canUndo:"Add Representation"})}};(t=>{function e(r,n){return n?.cell.obj?.data?r.representation.volume.registry.getApplicableTypes(n.cell.obj?.data):r.representation.volume.registry.types}t.getRepresentationTypes=e})(i0||={});var LT=class extends ne.Create({name:"Volume Streaming",typeClass:"Object"}){},Dht;(t=>{let e;(o=>(o.Float32="float32",o.Int8="int8"))(e=t.ValueType||={})})(Dht||={});function qRe(e,t="x-ray"){if(!e)return t;let r=e.models[0];return Ln.is(r.sourceData)?Gt.hasEmMap(r)?"em":Gt.hasXrayMap(r)?"x-ray":Gt.isFromEm(r)?"em":Gt.isFromXray(r)?"x-ray":t:t}function wht(e){let t=[];if(!Ln.is(e.sourceData))return[e.entryId];let{db_id:r,db_name:n,content_type:o}=e.sourceData.data.db.pdbx_database_related;if(!n.isDefined)return[e.entryId];for(let i=0,a=n.rowCount;i<a;++i)n.value(i).toUpperCase()==="EMDB"&&o.value(i)==="associated EM volume"&&t.push(r.value(i));return t}function Mht(e){return[e.entryId]}function YRe(e,t){if(!t||!t.models.length)return[];let r=t.models[0];switch(e){case"em":return wht(r);case"x-ray":return Mht(r)}}async function Gq(e,t,r,n){switch(e){case"emdb":return Uq(t,r,n);case"pdbe":return Bht(t,r,n)}}async function Uq(e,t,r){let n=e.config.get(Lr.VolumeStreaming.EmdbHeaderServer),a=(await e.fetch({url:`${n}/${r.toUpperCase()}/header/${r.toLowerCase()}.xml`,type:"xml"}).runInContext(t)).getElementsByTagName("map")[0].getElementsByTagName("contour"),s=a[0];for(let u=1;u<a.length;u++)if(a[u].getAttribute("primary")==="true"){s=a[u];break}return parseFloat(s.getElementsByTagName("level")[0].textContent)}async function Bht(e,t,r){r=r.toUpperCase();let o=(await e.fetch({url:`https://www.ebi.ac.uk/emdb/api/entry/map/${r}`,type:"json"}).runInContext(t))?.map?.contour_list?.contour;return!o||o.length===0?Eht(e,t,r):o.find(i=>i.primary)?.level??o[0].level}async function Eht(e,t,r){r=r.toUpperCase();let o=(await e.fetch({url:`https://www.ebi.ac.uk/pdbe/api/emdb/entry/map/${r}`,type:"json"}).runInContext(t))?.[r],i;return o?.[0]?.map?.contour_level?.value!==void 0&&(i=+o[0].map.contour_level.value),i}async function KRe(e,t,r){let o=(await e.fetch({url:`https://www.ebi.ac.uk/pdbe/api/pdb/entry/summary/${r}`,type:"json"}).runInContext(t))?.[r],i=[];if(o?.[0]?.related_structures){let a=o[0].related_structures.filter(s=>s.resource==="EMDB"&&s.relationship==="associated EM volume");if(!a.length)throw new Error(`No related EMDB entry found for '${r}'.`);i.push(...a.map(s=>s.accession))}else throw new Error(`No related EMDB entry found for '${r}'.`);return i}function a0(e,t,r){return{i:e,j:t,k:r}}function Jp(e,t){return{a:e,b:t}}var Ha=[a0(0,0,0),a0(1,0,0),a0(1,1,0),a0(0,1,0),a0(0,0,1),a0(1,0,1),a0(1,1,1),a0(0,1,1)],JRe=[Jp(Ha[0],Ha[1]),Jp(Ha[1],Ha[2]),Jp(Ha[2],Ha[3]),Jp(Ha[3],Ha[0]),Jp(Ha[4],Ha[5]),Jp(Ha[5],Ha[6]),Jp(Ha[6],Ha[7]),Jp(Ha[7],Ha[4]),Jp(Ha[0],Ha[4]),Jp(Ha[1],Ha[5]),Jp(Ha[2],Ha[6]),Jp(Ha[3],Ha[7])],$Re=[{i:0,j:0,k:0,e:0},{i:1,j:0,k:0,e:1},{i:0,j:1,k:0,e:0},{i:0,j:0,k:0,e:1},{i:0,j:0,k:1,e:0},{i:1,j:0,k:1,e:1},{i:0,j:1,k:1,e:0},{i:0,j:0,k:1,e:1},{i:0,j:0,k:0,e:2},{i:1,j:0,k:0,e:2},{i:1,j:1,k:0,e:2},{i:0,j:1,k:0,e:2}],eDe=[0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0],s0=[[],[0,8,3],[0,1,9],[1,8,3,9,8,1],[1,2,10],[0,8,3,1,2,10],[9,2,10,0,2,9],[2,8,3,2,10,8,10,9,8],[3,11,2],[0,11,2,8,11,0],[1,9,0,2,3,11],[1,11,2,1,9,11,9,8,11],[3,10,1,11,10,3],[0,10,1,0,8,10,8,11,10],[3,9,0,3,11,9,11,10,9],[9,8,10,10,8,11],[4,7,8],[4,3,0,7,3,4],[0,1,9,8,4,7],[4,1,9,4,7,1,7,3,1],[1,2,10,8,4,7],[3,4,7,3,0,4,1,2,10],[9,2,10,9,0,2,8,4,7],[2,10,9,2,9,7,2,7,3,7,9,4],[8,4,7,3,11,2],[11,4,7,11,2,4,2,0,4],[9,0,1,8,4,7,2,3,11],[4,7,11,9,4,11,9,11,2,9,2,1],[3,10,1,3,11,10,7,8,4],[1,11,10,1,4,11,1,0,4,7,11,4],[4,7,8,9,0,11,9,11,10,11,0,3],[4,7,11,4,11,9,9,11,10],[9,5,4],[9,5,4,0,8,3],[0,5,4,1,5,0],[8,5,4,8,3,5,3,1,5],[1,2,10,9,5,4],[3,0,8,1,2,10,4,9,5],[5,2,10,5,4,2,4,0,2],[2,10,5,3,2,5,3,5,4,3,4,8],[9,5,4,2,3,11],[0,11,2,0,8,11,4,9,5],[0,5,4,0,1,5,2,3,11],[2,1,5,2,5,8,2,8,11,4,8,5],[10,3,11,10,1,3,9,5,4],[4,9,5,0,8,1,8,10,1,8,11,10],[5,4,0,5,0,11,5,11,10,11,0,3],[5,4,8,5,8,10,10,8,11],[9,7,8,5,7,9],[9,3,0,9,5,3,5,7,3],[0,7,8,0,1,7,1,5,7],[1,5,3,3,5,7],[9,7,8,9,5,7,10,1,2],[10,1,2,9,5,0,5,3,0,5,7,3],[8,0,2,8,2,5,8,5,7,10,5,2],[2,10,5,2,5,3,3,5,7],[7,9,5,7,8,9,3,11,2],[9,5,7,9,7,2,9,2,0,2,7,11],[2,3,11,0,1,8,1,7,8,1,5,7],[11,2,1,11,1,7,7,1,5],[9,5,8,8,5,7,10,1,3,10,3,11],[5,7,0,5,0,9,7,11,0,1,0,10,11,10,0],[11,10,0,11,0,3,10,5,0,8,0,7,5,7,0],[11,10,5,7,11,5],[10,6,5],[0,8,3,5,10,6],[9,0,1,5,10,6],[1,8,3,1,9,8,5,10,6],[1,6,5,2,6,1],[1,6,5,1,2,6,3,0,8],[9,6,5,9,0,6,0,2,6],[5,9,8,5,8,2,5,2,6,3,2,8],[2,3,11,10,6,5],[11,0,8,11,2,0,10,6,5],[0,1,9,2,3,11,5,10,6],[5,10,6,1,9,2,9,11,2,9,8,11],[6,3,11,6,5,3,5,1,3],[0,8,11,0,11,5,0,5,1,5,11,6],[3,11,6,0,3,6,0,6,5,0,5,9],[6,5,9,6,9,11,11,9,8],[5,10,6,4,7,8],[4,3,0,4,7,3,6,5,10],[1,9,0,5,10,6,8,4,7],[10,6,5,1,9,7,1,7,3,7,9,4],[6,1,2,6,5,1,4,7,8],[1,2,5,5,2,6,3,0,4,3,4,7],[8,4,7,9,0,5,0,6,5,0,2,6],[7,3,9,7,9,4,3,2,9,5,9,6,2,6,9],[3,11,2,7,8,4,10,6,5],[5,10,6,4,7,2,4,2,0,2,7,11],[0,1,9,4,7,8,2,3,11,5,10,6],[9,2,1,9,11,2,9,4,11,7,11,4,5,10,6],[8,4,7,3,11,5,3,5,1,5,11,6],[5,1,11,5,11,6,1,0,11,7,11,4,0,4,11],[0,5,9,0,6,5,0,3,6,11,6,3,8,4,7],[6,5,9,6,9,11,4,7,9,7,11,9],[10,4,9,6,4,10],[4,10,6,4,9,10,0,8,3],[10,0,1,10,6,0,6,4,0],[8,3,1,8,1,6,8,6,4,6,1,10],[1,4,9,1,2,4,2,6,4],[3,0,8,1,2,9,2,4,9,2,6,4],[0,2,4,4,2,6],[8,3,2,8,2,4,4,2,6],[10,4,9,10,6,4,11,2,3],[0,8,2,2,8,11,4,9,10,4,10,6],[3,11,2,0,1,6,0,6,4,6,1,10],[6,4,1,6,1,10,4,8,1,2,1,11,8,11,1],[9,6,4,9,3,6,9,1,3,11,6,3],[8,11,1,8,1,0,11,6,1,9,1,4,6,4,1],[3,11,6,3,6,0,0,6,4],[6,4,8,11,6,8],[7,10,6,7,8,10,8,9,10],[0,7,3,0,10,7,0,9,10,6,7,10],[10,6,7,1,10,7,1,7,8,1,8,0],[10,6,7,10,7,1,1,7,3],[1,2,6,1,6,8,1,8,9,8,6,7],[2,6,9,2,9,1,6,7,9,0,9,3,7,3,9],[7,8,0,7,0,6,6,0,2],[7,3,2,6,7,2],[2,3,11,10,6,8,10,8,9,8,6,7],[2,0,7,2,7,11,0,9,7,6,7,10,9,10,7],[1,8,0,1,7,8,1,10,7,6,7,10,2,3,11],[11,2,1,11,1,7,10,6,1,6,7,1],[8,9,6,8,6,7,9,1,6,11,6,3,1,3,6],[0,9,1,11,6,7],[7,8,0,7,0,6,3,11,0,11,6,0],[7,11,6],[7,6,11],[3,0,8,11,7,6],[0,1,9,11,7,6],[8,1,9,8,3,1,11,7,6],[10,1,2,6,11,7],[1,2,10,3,0,8,6,11,7],[2,9,0,2,10,9,6,11,7],[6,11,7,2,10,3,10,8,3,10,9,8],[7,2,3,6,2,7],[7,0,8,7,6,0,6,2,0],[2,7,6,2,3,7,0,1,9],[1,6,2,1,8,6,1,9,8,8,7,6],[10,7,6,10,1,7,1,3,7],[10,7,6,1,7,10,1,8,7,1,0,8],[0,3,7,0,7,10,0,10,9,6,10,7],[7,6,10,7,10,8,8,10,9],[6,8,4,11,8,6],[3,6,11,3,0,6,0,4,6],[8,6,11,8,4,6,9,0,1],[9,4,6,9,6,3,9,3,1,11,3,6],[6,8,4,6,11,8,2,10,1],[1,2,10,3,0,11,0,6,11,0,4,6],[4,11,8,4,6,11,0,2,9,2,10,9],[10,9,3,10,3,2,9,4,3,11,3,6,4,6,3],[8,2,3,8,4,2,4,6,2],[0,4,2,4,6,2],[1,9,0,2,3,4,2,4,6,4,3,8],[1,9,4,1,4,2,2,4,6],[8,1,3,8,6,1,8,4,6,6,10,1],[10,1,0,10,0,6,6,0,4],[4,6,3,4,3,8,6,10,3,0,3,9,10,9,3],[10,9,4,6,10,4],[4,9,5,7,6,11],[0,8,3,4,9,5,11,7,6],[5,0,1,5,4,0,7,6,11],[11,7,6,8,3,4,3,5,4,3,1,5],[9,5,4,10,1,2,7,6,11],[6,11,7,1,2,10,0,8,3,4,9,5],[7,6,11,5,4,10,4,2,10,4,0,2],[3,4,8,3,5,4,3,2,5,10,5,2,11,7,6],[7,2,3,7,6,2,5,4,9],[9,5,4,0,8,6,0,6,2,6,8,7],[3,6,2,3,7,6,1,5,0,5,4,0],[6,2,8,6,8,7,2,1,8,4,8,5,1,5,8],[9,5,4,10,1,6,1,7,6,1,3,7],[1,6,10,1,7,6,1,0,7,8,7,0,9,5,4],[4,0,10,4,10,5,0,3,10,6,10,7,3,7,10],[7,6,10,7,10,8,5,4,10,4,8,10],[6,9,5,6,11,9,11,8,9],[3,6,11,0,6,3,0,5,6,0,9,5],[0,11,8,0,5,11,0,1,5,5,6,11],[6,11,3,6,3,5,5,3,1],[1,2,10,9,5,11,9,11,8,11,5,6],[0,11,3,0,6,11,0,9,6,5,6,9,1,2,10],[11,8,5,11,5,6,8,0,5,10,5,2,0,2,5],[6,11,3,6,3,5,2,10,3,10,5,3],[5,8,9,5,2,8,5,6,2,3,8,2],[9,5,6,9,6,0,0,6,2],[1,5,8,1,8,0,5,6,8,3,8,2,6,2,8],[1,5,6,2,1,6],[1,3,6,1,6,10,3,8,6,5,6,9,8,9,6],[10,1,0,10,0,6,9,5,0,5,6,0],[0,3,8,5,6,10],[10,5,6],[11,5,10,7,5,11],[11,5,10,11,7,5,8,3,0],[5,11,7,5,10,11,1,9,0],[10,7,5,10,11,7,9,8,1,8,3,1],[11,1,2,11,7,1,7,5,1],[0,8,3,1,2,7,1,7,5,7,2,11],[9,7,5,9,2,7,9,0,2,2,11,7],[7,5,2,7,2,11,5,9,2,3,2,8,9,8,2],[2,5,10,2,3,5,3,7,5],[8,2,0,8,5,2,8,7,5,10,2,5],[9,0,1,5,10,3,5,3,7,3,10,2],[9,8,2,9,2,1,8,7,2,10,2,5,7,5,2],[1,3,5,3,7,5],[0,8,7,0,7,1,1,7,5],[9,0,3,9,3,5,5,3,7],[9,8,7,5,9,7],[5,8,4,5,10,8,10,11,8],[5,0,4,5,11,0,5,10,11,11,3,0],[0,1,9,8,4,10,8,10,11,10,4,5],[10,11,4,10,4,5,11,3,4,9,4,1,3,1,4],[2,5,1,2,8,5,2,11,8,4,5,8],[0,4,11,0,11,3,4,5,11,2,11,1,5,1,11],[0,2,5,0,5,9,2,11,5,4,5,8,11,8,5],[9,4,5,2,11,3],[2,5,10,3,5,2,3,4,5,3,8,4],[5,10,2,5,2,4,4,2,0],[3,10,2,3,5,10,3,8,5,4,5,8,0,1,9],[5,10,2,5,2,4,1,9,2,9,4,2],[8,4,5,8,5,3,3,5,1],[0,4,5,1,0,5],[8,4,5,8,5,3,9,0,5,0,3,5],[9,4,5],[4,11,7,4,9,11,9,10,11],[0,8,3,4,9,7,9,11,7,9,10,11],[1,10,11,1,11,4,1,4,0,7,4,11],[3,1,4,3,4,8,1,10,4,7,4,11,10,11,4],[4,11,7,9,11,4,9,2,11,9,1,2],[9,7,4,9,11,7,9,1,11,2,11,1,0,8,3],[11,7,4,11,4,2,2,4,0],[11,7,4,11,4,2,8,3,4,3,2,4],[2,9,10,2,7,9,2,3,7,7,4,9],[9,10,7,9,7,4,10,2,7,8,7,0,2,0,7],[3,7,10,3,10,2,7,4,10,1,10,0,4,0,10],[1,10,2,8,7,4],[4,9,1,4,1,7,7,1,3],[4,9,1,4,1,7,0,8,1,8,7,1],[4,0,3,7,4,3],[4,8,7],[9,10,8,10,11,8],[3,0,9,3,9,11,11,9,10],[0,1,10,0,10,8,8,10,11],[3,1,10,11,3,10],[1,2,11,1,11,9,9,11,8],[3,0,9,3,9,11,1,2,9,2,11,9],[0,2,11,8,0,11],[3,2,11],[2,3,8,2,8,10,10,8,9],[9,10,2,0,9,2],[2,3,8,2,8,10,0,1,8,1,10,8],[1,10,2],[1,3,8,9,1,8],[0,9,1],[0,3,8],[]],DO=[[0,4,4,4,2,0,0,0,2,2,0,0],[4,0,4,4,0,8,0,0,0,8,8,0],[4,4,0,4,0,0,8,0,0,0,8,8],[4,4,4,0,0,0,0,1,1,0,0,1],[2,0,0,0,0,8,8,8,2,2,0,0],[0,8,0,0,8,0,8,8,0,8,8,0],[0,0,8,0,8,8,0,8,0,0,8,8],[0,0,0,1,8,8,8,0,1,0,0,1],[2,0,0,1,2,0,0,1,0,2,0,1],[2,8,0,0,2,8,0,0,2,0,8,0],[0,8,8,0,0,8,8,0,0,8,0,8],[0,0,8,1,0,0,8,1,1,0,8,0]];function tDe(e,t){let r=Math.min(65536,e*4),n=qe.create(Float32Array,3,e,t&&t.vertexBuffer.ref.value),o=qe.create(Float32Array,3,e,t&&t.normalBuffer.ref.value),i=qe.create(Float32Array,1,e,t&&t.groupBuffer.ref.value),a=qe.create(Uint32Array,3,r,t&&t.indexBuffer.ref.value),s=0,l=0;return{addVertex:(u,c,m)=>(++s,qe.add3(n,u,c,m)),addNormal:(u,c,m)=>{qe.add3(o,u,c,m)},addGroup:u=>{qe.add(i,u)},addTriangle:(u,c,m,d)=>{let p=u[c],h=u[m],f=u[d];p>=0&&h>=0&&f>=0&&(++l,qe.add3(a,p,h,f))},get:()=>{let u=qe.compact(n,!0),c=qe.compact(o,!0),m=qe.compact(a,!0),d=qe.compact(i,!0);return ft.create(u,m,c,d,s,l,t)}}}function rDe(e,t){let r=qe.create(Float32Array,3,e),n=qe.create(Float32Array,1,e),o=qe.create(Float32Array,2,e),i=0;return{addVertex:(a,s,l)=>qe.add3(r,a,s,l),addNormal:()=>vl,addGroup:a=>{qe.add(n,a)},addTriangle:(a,s,l,u,c)=>{let m=a[s],d=a[l],p=a[u];m>=0&&d>=0&&p>=0&&(DO[s][l]&c&&(++i,qe.add2(o,a[s],a[l])),DO[l][u]&c&&(++i,qe.add2(o,a[l],a[u])),DO[s][u]&c&&(++i,qe.add2(o,a[s],a[u])))},get:()=>{let a=qe.compact(r,!0),s=qe.compact(o,!0),l=qe.compact(n,!0),u=ns.create(i,i/10,t);for(let c=0;c<i;++c){let m=s[c*2],d=s[c*2+1];u.add(a[m*3],a[m*3+1],a[m*3+2],a[d*3],a[d*3+1],a[d*3+2],l[m])}return u.getLines()}}}function nDe(e){return{...e,bottomLeft:ua(e.bottomLeft,[0,0,0]),topRight:ua(e.topRight,e.scalarField.space.dimensions)}}function oDe(e){return{dX:e.topRight[0]-e.bottomLeft[0],dY:e.topRight[1]-e.bottomLeft[1],dZ:e.topRight[2]-e.bottomLeft[2]}}function ty(e,t){return Ae.create("Marching Cubes Mesh",async r=>{let n=nDe(e),{dX:o,dY:i,dZ:a}=oDe(n),s=Math.min(262144,Math.max(o*i*a/32,1024)),l=tDe(s,t);return await new wO(r,l,n).run(),l.get()})}function VT(e,t){return Ae.create("Marching Cubes Lines",async r=>{let n=nDe(e),{dX:o,dY:i,dZ:a}=oDe(n),s=Math.min(262144,Math.max(o*i*a/32,1024)),l=rDe(s,t);return await new wO(r,l,n).run(),l.get()})}var wO=class{constructor(t,r,n){this.ctx=t;this.minX=0;this.minY=0;this.minZ=0;this.maxX=0;this.maxY=0;this.maxZ=0;this.state=new Nq(r,n),this.minX=n.bottomLeft[0],this.minY=n.bottomLeft[1],this.minZ=n.bottomLeft[2],this.maxX=n.topRight[0]-1,this.maxY=n.topRight[1]-1,this.maxZ=n.topRight[2]-1,this.size=(this.maxX-this.minX)*(this.maxY-this.minY)*(this.maxZ-this.minZ),this.sliceSize=(this.maxX-this.minX)*(this.maxY-this.minY)}async doSlices(){let t=0;this.edgeFilter=15;for(let r=this.minZ;r<this.maxZ;r++,this.edgeFilter&=-5)this.slice(r),t+=this.sliceSize,this.ctx.shouldUpdate&&await this.ctx.update({message:"Computing surface...",current:t,max:this.size})}slice(t){this.edgeFilter|=2;for(let r=this.minY;r<this.maxY;r++,this.edgeFilter&=-3){this.edgeFilter|=1;for(let n=this.minX;n<this.maxX;n++,this.edgeFilter&=-2)this.state.processCell(n,r,t,this.edgeFilter)}this.state.clearEdgeVertexIndexSlice(t)}async run(){await this.doSlices()}},Nq=class{constructor(t,r){this.builder=t;this.vertList=[0,0,0,0,0,0,0,0,0,0,0,0];this.i=0;this.j=0;this.k=0;let n=r.scalarField.space.dimensions;this.nX=n[0],this.nY=n[1],this.nZ=n[2],this.isoLevel=r.isoLevel,this.scalarFieldGet=r.scalarField.space.get,this.scalarField=r.scalarField.data,r.idField&&(this.idField=r.idField.data,this.idFieldGet=r.idField.space.get),this.verticesOnEdges=new Int32Array(3*this.nX*this.nY*2)}get3dOffsetFromEdgeInfo(t){return this.nX*((this.k+t.k)%2*this.nY+this.j+t.j)+this.i+t.i}clearEdgeVertexIndexSlice(t){let r=t%2===0?0:3*this.nX*this.nY,n=t%2===0?3*this.nX*this.nY:this.verticesOnEdges.length;this.verticesOnEdges.fill(0,r,n)}interpolate(t){let r=$Re[t],n=3*this.get3dOffsetFromEdgeInfo(r)+r.e,o=this.verticesOnEdges[n];if(o>0)return o-1;let i=this.scalarField,a=this.scalarFieldGet,s=JRe[t],l=s.a,u=s.b,c=l.i+this.i,m=l.j+this.j,d=l.k+this.k,p=u.i+this.i,h=u.j+this.j,f=u.k+this.k,g=a(i,c,m,d),y=a(i,p,h,f),x=(this.isoLevel-g)/(g-y);if(this.idField){let D=this.idFieldGet(this.idField,c,m,d),B=this.idFieldGet(this.idField,p,h,f),k=x<.5?D:B;if(k===-1&&(k=x<.5?B:D),k===-2)return-1;this.builder.addGroup(k)}else this.builder.addGroup(0);let S=this.builder.addVertex(c+x*(c-p),m+x*(m-h),d+x*(d-f));this.verticesOnEdges[n]=S+1;let I=a(i,Math.max(0,c-1),m,d)-a(i,Math.min(this.nX-1,c+1),m,d),v=a(i,c,Math.max(0,m-1),d)-a(i,c,Math.min(this.nY-1,m+1),d),A=a(i,c,m,Math.max(0,d-1))-a(i,c,m,Math.min(this.nZ-1,d+1)),P=a(i,Math.max(0,p-1),h,f)-a(i,Math.min(this.nX-1,p+1),h,f),T=a(i,p,Math.max(0,h-1),f)-a(i,p,Math.min(this.nY-1,h+1),f),R=a(i,p,h,Math.max(0,f-1))-a(i,p,h,Math.min(this.nZ-1,f+1)),w=I+x*(I-P),E=v+x*(v-T),M=A+x*(A-R);return this.isoLevel>=0?this.builder.addNormal(w,E,M):this.builder.addNormal(-w,-E,-M),S}get(t,r,n){return this.scalarFieldGet(this.scalarField,t,r,n)}processCell(t,r,n,o){let i=0;if(this.get(t,r,n)<this.isoLevel&&(i|=1),this.get(t+1,r,n)<this.isoLevel&&(i|=2),this.get(t+1,r+1,n)<this.isoLevel&&(i|=4),this.get(t,r+1,n)<this.isoLevel&&(i|=8),this.get(t,r,n+1)<this.isoLevel&&(i|=16),this.get(t+1,r,n+1)<this.isoLevel&&(i|=32),this.get(t+1,r+1,n+1)<this.isoLevel&&(i|=64),this.get(t,r+1,n+1)<this.isoLevel&&(i|=128),i===0||i===255)return;this.i=t,this.j=r,this.k=n;let a=eDe[i];(a&1)>0&&(this.vertList[0]=this.interpolate(0)),(a&2)>0&&(this.vertList[1]=this.interpolate(1)),(a&4)>0&&(this.vertList[2]=this.interpolate(2)),(a&8)>0&&(this.vertList[3]=this.interpolate(3)),(a&16)>0&&(this.vertList[4]=this.interpolate(4)),(a&32)>0&&(this.vertList[5]=this.interpolate(5)),(a&64)>0&&(this.vertList[6]=this.interpolate(6)),(a&128)>0&&(this.vertList[7]=this.interpolate(7)),(a&256)>0&&(this.vertList[8]=this.interpolate(8)),(a&512)>0&&(this.vertList[9]=this.interpolate(9)),(a&1024)>0&&(this.vertList[10]=this.interpolate(10)),(a&2048)>0&&(this.vertList[11]=this.interpolate(11));let s=s0[i];for(let l=0;l<s.length;l+=3){let u=s[l],c=s[l+1],m=s[l+2];this.isoLevel>=0?this.builder.addTriangle(this.vertList,u,c,m,o):this.builder.addTriangle(this.vertList,m,c,u,o)}}};function iDe(e,t,r,n,o){let i=e.instances.length,a=new Float32Array(i*16);for(let s=0;s<i;++s)H.toArray(e.instances[s].transform,a,s*16);return WS(a,i,t,r,n,o)}function kht(e,t,r,n,o,i){let{createValues:a,createRenderableState:s}=ba.getUtils(t),l=iDe(e,t.boundingSphere,o.cellSize,o.batchSize),u=a(t,l,r,n,o),c=s(o);return Pp(t.kind,u,c,i)}function lm(e,t){let{defaultProps:r,createGeometry:n,createLocationIterator:o,getLoci:i,eachLocation:a,setUpdateState:s,mustRecreate:l,dispose:u}=e,{updateValues:c,updateBoundingSphere:m,updateRenderableState:d,createPositionIterator:p}=e.geometryUtils,h=kd.create(),f,g,y,x,S,I=Object.assign({},r),v=Ii.createEmpty(),A,P,T,R=-1,w,E;function M(F,z,j,Y){if(!j&&!A)throw new Error("missing volume");if(g=Object.assign({},I,z),y=F,x=j,S=Y,kd.reset(h),f?Nn.areEquivalent(x.grid,A.grid)&&!Ge.areInstanceTransformsEqual(x,A)?h.updateTransform=!0:(!Ge.areEquivalent(x,A)||S!==P)&&(h.createNew=!0):h.createNew=!0,h.createNew){h.createGeometry=!0;return}s(h,j,g,I,y,v),vs.areEqual(F.color,v.color)||(h.updateColor=!0),Bo.areEqual(F.size,v.size)||(h.updateSize=!0),(g.instanceGranularity!==I.instanceGranularity||g.cellSize!==I.cellSize||g.batchSize!==I.batchSize)&&(h.updateTransform=!0),h.updateTransform&&(h.updateMatrix=!0),h.updateSize&&!("uSize"in f.values)&&(h.createGeometry=!0),h.createGeometry&&(h.updateColor=!0,h.updateSize=!0)}function D(F){if(h.createNew)if(w=o(x,S),F)f=kht(x,F,w,y,g,t),E=p(F,f.values);else throw new Error("expected geometry to be given");else{if(!f)throw new Error("expected renderObject to be available");if((h.updateColor||h.updateSize||h.updateTransform)&&(w=o(x,S)),h.updateTransform){let{instanceCount:z,groupCount:j}=w;g.instanceGranularity?yo(z,"instance",f.values):yo(z*j,"groupInstance",f.values)}if(h.updateMatrix&&iDe(x,T.boundingSphere,g.cellSize,g.batchSize,f.values),h.createGeometry)if(F)_.updateIfChanged(f.values.drawCount,ba.getDrawCount(F)),_.updateIfChanged(f.values.uVertexCount,ba.getVertexCount(F)),_.updateIfChanged(f.values.uGroupCount,w.groupCount);else throw new Error("expected geometry to be given");(h.updateTransform||h.createGeometry)&&(m(f.values,F||T),E=p(F||T,f.values)),h.updateSize&&"uSize"in f.values&&eu(w,y.size,f.values),h.updateColor&&ya(w,E,y.color,f.values),c(f.values,g),d(f.state,g)}I=g,v=y,A=x,P=S,F&&(T=F,R+=1)}function B(F,z,j,Y){let G=!1;if(Ge.Cell.isLoci(F)){if(Ge.Cell.isLociEmpty(F)||!Ge.areEquivalent(F.volume,z))return!1;for(let{instances:X}of F.elements)xe.forEach(X,U=>{Y(ye.ofSingleton(U))&&(G=!0)})}else if(Ge.Segment.isLoci(F)){if(Ge.Segment.isLociEmpty(F)||!Ge.areEquivalent(F.volume,z))return!1;for(let{segments:X,instances:U}of F.elements)xe.has(X,j)&&xe.forEach(U,L=>{Y(ye.ofSingleton(L))&&(G=!0)})}else if(Ge.Isosurface.isLoci(F)){if(Ge.Isosurface.isLociEmpty(F))return!1;if(ye.is(F.instances))Y(F.instances)&&(G=!0);else for(let X=0,U=F.instances.length;X<U;++X)Y(ye.ofSingleton(X))&&(G=!0)}else if(Ge.isLoci(F)){if(Ge.isLociEmpty(F))return!1;if(ye.is(F.instances))Y(F.instances)&&(G=!0);else for(let X=0,U=F.instances.length;X<U;++X)Y(ye.ofSingleton(X))&&(G=!0)}return G}function k(F,z){return xa(F)?I.instanceGranularity?z(ye.ofBounds(0,w.instanceCount)):z(ye.ofBounds(0,w.groupCount*w.instanceCount)):I.instanceGranularity?B(F,A,P,z):a(F,A,P,I,z)}return{get groupCount(){return w?w.count:0},get renderObject(){return f},get geometryVersion(){return R},async createOrUpdate(F,z,j={},Y){if(M(z,j,Y?.volume||A,Y?.key||P),h.createGeometry){let G=n(F,x,S,y,g,T);return jx(G)?G.then(D):D(G)}else D()},getLoci(F){return f?i(F,A,P,I,f.id):vr},eachLocation(F){for(w.reset();w.hasNext;){let{location:z,isSecondary:j}=w.move();F(z,j)}},mark(F,z){return qr.mark(f,F,z,k)},setVisibility(F){qr.setVisibility(f,F)},setAlphaFactor(F){qr.setAlphaFactor(f,F)},setPickable(F){qr.setPickable(f,F)},setColorOnly(F){qr.setColorOnly(f,F)},setTransform(F,z){qr.setTransform(f,F,z)},setOverpaint(F){return qr.setOverpaint(f,F,k,!0)},setTransparency(F){return qr.setTransparency(f,F,k,!0)},setEmissive(F){return qr.setEmissive(f,F,k,!0)},setSubstance(F){return qr.setSubstance(f,F,k,!0)},setClipping(F){return qr.setClipping(f,F,k,!0)},setThemeStrength(F){qr.setThemeStrength(f,F)},destroy(){u?.(T),f&&(f.state.disposed=!0,f=void 0)},mustRecreate:l}}var U1n={...Xe.Params};function $p(e,t,r,n,o,i=()=>[-1]){let a=0,{webgl:s}=t,l=new Pn,u=new Ut.GeometryState,c=Kc(),m=[],d=Ut.createState(),p=new Map,h,f,g,y,x=Ii.createEmpty();async function S(w,E){let M=p.get(E);return M?M.mustRecreate?.({volume:h,key:E},y,s)&&(M.destroy(),M=n(c,h,E,y,s),p.set(E,M)):(M=n(c,h,E,y,s),p.set(E,M)),M.createOrUpdate({webgl:s,runtime:w},x,y,{volume:h,key:E})}function I(w={},E){E&&E!==h&&(g=r(t,E),h=E,y||(y=C.getDefaultValues(g)));let M=wR(Object.assign({},y,w),h);return Object.assign(y,w,M),f=i(y),Ae.create("Creating or updating VolumeRepresentation",async D=>{let B=new Set(p.keys());for(let k=0,F=f.length;k<F;++k){let z=f[k];B.delete(z);let j=S(D,z);j&&await j}B.forEach(k=>{p.get(k)?.destroy(),p.delete(k)}),m.length=0,p.forEach(k=>{k.renderObject&&(m.push(k.renderObject),u.add(k.renderObject.id,k.geometryVersion))}),u.snapshot(),l.next(a++)})}function v(w,E){let M=!1;return p.forEach(D=>{M=D.mark(w,E)||M}),M}function A(w,E){E.visible!==void 0&&w&&w.setVisibility(E.visible),E.alphaFactor!==void 0&&w&&w.setAlphaFactor(E.alphaFactor),E.pickable!==void 0&&w&&w.setPickable(E.pickable),E.overpaint!==void 0&&w&&w.setOverpaint(E.overpaint),E.transparency!==void 0&&w&&w.setTransparency(E.transparency),E.emissive!==void 0&&w&&w.setEmissive(E.emissive),E.substance!==void 0&&w&&w.setSubstance(E.substance),E.clipping!==void 0&&w&&w.setClipping(E.clipping),E.transform!==void 0&&w&&w.setTransform(E.transform),E.themeStrength!==void 0&&w&&w.setThemeStrength(E.themeStrength)}function P(w){let{visible:E,alphaFactor:M,pickable:D,overpaint:B,transparency:k,emissive:F,substance:z,clipping:j,transform:Y,themeStrength:G,syncManually:X,markerActions:U}=w,L={};E!==void 0&&(L.visible=E),M!==void 0&&(L.alphaFactor=M),D!==void 0&&(L.pickable=D),B!==void 0&&(L.overpaint=B),k!==void 0&&(L.transparency=k),F!==void 0&&(L.emissive=F),z!==void 0&&(L.substance=z),j!==void 0&&(L.clipping=j),G!==void 0&&(L.themeStrength=G),Y!==void 0&&!H.areEqual(Y,d.transform,1e-6)&&(L.transform=Y),X!==void 0&&(L.syncManually=X),U!==void 0&&(L.markerActions=U),p.forEach(q=>A(q,L)),Ut.updateState(d,w)}function T(w){x=w}function R(){p.forEach(w=>w.destroy()),p.clear()}return{label:e,get groupCount(){let w=0;return p.forEach(E=>{E.renderObject&&(w+=E.groupCount)}),w},get props(){return y},get params(){return g},get state(){return d},get theme(){return x},get geometryVersion(){return u.version},renderObjects:m,updated:l,createOrUpdate:I,setState:P,setTheme:T,getLoci:w=>{let E=vr;return p.forEach(M=>{let D=M.getLoci(w);Oi(D)||(E=D)}),E},getAllLoci:()=>[o(h,y)],eachLocation:w=>{p.forEach(E=>{E.eachLocation(w)})},mark:v,destroy:R}}var aDe=`
precision highp float;
precision highp int;

#if __VERSION__ == 100
    precision highp sampler2D;
    uniform sampler2D tTexture;
#else
    precision highp isampler2D;
    uniform isampler2D tTexture;
#endif

void main(void) {
    #if __VERSION__ == 100
        gl_FragColor = texture2D(tTexture, vec2(0.5));
    #else
        gl_FragColor = ivec4(texture2D(tTexture, vec2(0.5)).r);
    #endif
}
`;var Fht={...Sn,tTexture:yt("texture","rgba","float","nearest")},ef="histopyramid-sum";function Lht(e,t){if(e.namedComputeRenderables[ef]){let r=e.namedComputeRenderables[ef].values;_.update(r.tTexture,t),e.namedComputeRenderables[ef].update()}else e.namedComputeRenderables[ef]=Vht(e,t);return e.namedComputeRenderables[ef]}function Vht(e,t){let r={...vn,tTexture:_.create(t)},n={...Fht},o=zr("sum",Fn,aDe,{},{0:"ivec4"}),i=on(e,"triangles",o,n,r);return an(i,r)}function Oht(e){let{gl:t,state:r}=e;r.disable(t.CULL_FACE),r.disable(t.BLEND),r.disable(t.DEPTH_TEST),r.disable(t.SCISSOR_TEST),r.depthMask(!1),r.colorMask(!0,!0,!0,!0),r.clearColor(0,0,0,0)}var MO=new Uint8Array(4),sDe=new Int32Array(4);function lDe(e,t){je&&e.timer.mark("getHistopyramidSum");let{gl:r,state:n,resources:o}=e,i=Lht(e,t);e.state.currentRenderItemId=-1,e.namedFramebuffers[ef]||(e.namedFramebuffers[ef]=o.framebuffer());let a=e.namedFramebuffers[ef];return e.namedTextures[ef]||(e.namedTextures[ef]=Ht(r)?o.texture("image-int32","rgba","int","nearest"):o.texture("image-uint8","rgba","ubyte","nearest"),e.namedTextures[ef].define(1,1)),e.namedTextures[ef].attachFramebuffer(a,0),Oht(e),n.viewport(0,0,1,1),i.render(),r.finish(),e.readPixels(0,0,1,1,Ht(r)?sDe:MO),r.bindFramebuffer(r.FRAMEBUFFER,null),je&&e.timer.markEnd("getHistopyramidSum"),Ht(r)?sDe[0]:xC(MO[0],MO[1],MO[2])}var uDe=`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tInputLevel;

// previous level used to evaluate the new level
#if __VERSION__ == 100
    uniform sampler2D tPreviousLevel;
#else
    precision highp isampler2D;
    uniform isampler2D tPreviousLevel;
#endif

// inverted size of the previous level texture.
uniform float uSize;
uniform float uTexSize;
uniform bool uFirst;

#include common

void main(void) {
    float k = 0.5 * uSize;
    vec2 position = floor((gl_FragCoord.xy / uTexSize) / uSize) * uSize;

    #if __VERSION__ == 100
        float a, b, c, d;

        if (uFirst) {
            a = texture2D(tInputLevel, position).r * 255.0;
            b = texture2D(tInputLevel, position + vec2(k, 0.0)).r * 255.0;
            c = texture2D(tInputLevel, position + vec2(0.0, k)).r * 255.0;
            d = texture2D(tInputLevel, position + vec2(k, k)).r * 255.0;
        } else {
            a = unpackRGBToInt(texture2D(tPreviousLevel, position).rgb);
            b = unpackRGBToInt(texture2D(tPreviousLevel, position + vec2(k, 0.0)).rgb);
            c = unpackRGBToInt(texture2D(tPreviousLevel, position + vec2(0.0, k)).rgb);
            d = unpackRGBToInt(texture2D(tPreviousLevel, position + vec2(k, k)).rgb);
        }
        gl_FragColor = vec4(packIntToRGB(a + b + c + d), 1.0);
    #else
        int a, b, c, d;

        if (uFirst) {
            a = int(texture2D(tInputLevel, position).r * 255.0);
            b = int(texture2D(tInputLevel, position + vec2(k, 0.0)).r * 255.0);
            c = int(texture2D(tInputLevel, position + vec2(0.0, k)).r * 255.0);
            d = int(texture2D(tInputLevel, position + vec2(k, k)).r * 255.0);
        } else {
            a = texture2D(tPreviousLevel, position).r;
            b = texture2D(tPreviousLevel, position + vec2(k, 0.0)).r;
            c = texture2D(tPreviousLevel, position + vec2(0.0, k)).r;
            d = texture2D(tPreviousLevel, position + vec2(k, k)).r;
        }
        gl_FragColor = ivec4(a + b + c + d);
    #endif
}
`;var Ght={...Sn,tInputLevel:yt("texture","rgba","float","nearest"),tPreviousLevel:yt("texture","rgba","float","nearest"),uSize:de("f"),uTexSize:de("f"),uFirst:de("b")},l0="histogram-pyramid";function Uht(e,t,r){if(e.namedComputeRenderables[l0]){let n=e.namedComputeRenderables[l0].values;_.update(n.tInputLevel,t),_.update(n.tPreviousLevel,r),e.namedComputeRenderables[l0].update()}else e.namedComputeRenderables[l0]=Nht(e,t,r);return e.namedComputeRenderables[l0]}function Nht(e,t,r){let n={...vn,tInputLevel:_.create(t),tPreviousLevel:_.create(r),uSize:_.create(0),uTexSize:_.create(0),uFirst:_.create(!0)},o={...Ght},i=zr("reduction",Fn,uDe,{},{0:"ivec4"}),a=on(e,"triangles",i,o,n);return an(a,n)}function zht(e,t){let r=Math.pow(2,t),n=`level${t}`,o=e.isWebGL2?BO(n,e,"image-int32","alpha","int","nearest"):BO(n,e,"image-uint8","rgba","ubyte","nearest");o.define(r,r);let i=jht(n,e);return i||(i=cDe(n,e)),o.attachFramebuffer(i,0),{texture:o,framebuffer:i}}function Hht(e){let{gl:t,state:r}=e;r.disable(t.CULL_FACE),r.disable(t.BLEND),r.disable(t.DEPTH_TEST),r.enable(t.SCISSOR_TEST),r.depthMask(!1),r.colorMask(!0,!0,!0,!0),r.clearColor(0,0,0,0)}function cDe(e,t){let r=`${l0}-${e}`;return t.namedFramebuffers[r]||(t.namedFramebuffers[r]=t.resources.framebuffer()),t.namedFramebuffers[r]}function BO(e,t,r,n,o,i){let a=`${l0}-${e}`;return t.namedTextures[a]||(t.namedTextures[a]=t.resources.texture(r,n,o,i)),t.namedTextures[a]}function jht(e,t){let r=`${l0}-${e}`;return t.namedFramebuffers[r]}function mDe(e,t,r,n){je&&e.timer.mark("createHistogramPyramid");let{gl:o,state:i}=e,a=t.getWidth(),s=t.getHeight();if(a!==s||!Ix(a))throw new Error("inputTexture must be of square power-of-two size");let l=Math.ceil(Math.log(a)/Math.log(2)),u=Math.pow(2,l),c=Math.pow(2,l),m=Math.pow(2,l-1),d=e.isWebGL2?BO("pyramid",e,"image-int32","alpha","int","nearest"):BO("pyramid",e,"image-uint8","rgba","ubyte","nearest");d.define(c,m);let p=cDe("pyramid",e);d.attachFramebuffer(p,0),i.viewport(0,0,c,m),Ht(o)?o.clearBufferiv(o.COLOR,0,[0,0,0,0]):o.clear(o.COLOR_BUFFER_BIT);let h=[];for(let S=0;S<l;++S)h.push(zht(e,S));let f=Uht(e,t,h[0].texture);i.currentRenderItemId=-1,Hht(e);let g=0;for(let S=0;S<l;S++){let I=l-1-S;h[I].framebuffer.bind();let A=Math.pow(2,I);_.update(f.values.uSize,Math.pow(2,S+1)/u),_.update(f.values.uTexSize,A),_.updateIfChanged(f.values.uFirst,S===0),S>0&&(_.update(f.values.tPreviousLevel,h[l-S].texture),f.update()),i.currentRenderItemId=-1,i.viewport(0,0,A,A),i.scissor(0,0,A,A),Ht(o)?o.clearBufferiv(o.COLOR,0,[0,0,0,0]):o.clear(o.COLOR_BUFFER_BIT),i.scissor(0,0,n[0],n[1]),f.render(),d.bind(0),o.copyTexSubImage2D(o.TEXTURE_2D,0,g,0,0,0,A,A),d.unbind(0),g+=A}o.finish(),je&&e.timer.markEnd("createHistogramPyramid");let y=Math.max(1,lDe(e,h[0].texture)),x=Math.ceil(y/Math.pow(2,l));return{pyramidTex:d,count:y,height:x,levels:l,scale:r}}var LD;function dDe(){if(LD!==void 0)return LD;LD=So(256,1,Uint8Array);let{array:e}=LD;for(let t=0,r=s0.length;t<r;++t)e[t]=s0[t].length/3;return LD}var VD;function pDe(){if(VD!==void 0)return VD;VD=So(4096,1,Uint8Array);let{array:e}=VD;for(let t=0,r=s0.length;t<r;++t)for(let n=0;n<16;++n)n<s0[t].length?e[t*16+n]=s0[t][n]:e[t*16+n]=255;return VD}var fDe=`
precision highp float;
precision highp int;
precision highp sampler2D;

#if __VERSION__ == 100
    uniform sampler2D tActiveVoxelsPyramid;
#else
    precision highp isampler2D;
    uniform isampler2D tActiveVoxelsPyramid;
#endif

uniform sampler2D tActiveVoxelsBase;
uniform sampler2D tVolumeData;
uniform sampler2D tTriIndices;

uniform float uIsoValue;
uniform float uLevels;
uniform float uSize;
uniform float uCount;
uniform bool uInvert;

uniform vec3 uGridDim;
uniform vec3 uGridTexDim;
uniform vec3 uGridDataDim;
uniform mat4 uGridTransform;
uniform mat3 uGridTransformAdjoint;

// scale to volume data coord
uniform vec2 uScale;

#include common

// cube corners (excluding origin)
const vec3 c1 = vec3(1., 0., 0.);
const vec3 c2 = vec3(1., 1., 0.);
const vec3 c3 = vec3(0., 1., 0.);
const vec3 c4 = vec3(0., 0., 1.);
const vec3 c5 = vec3(1., 0., 1.);
const vec3 c6 = vec3(1., 1., 1.);
const vec3 c7 = vec3(0., 1., 1.);

vec3 index3dFrom2d(vec2 coord) {
    vec2 gridTexPos = coord * uGridTexDim.xy;
    vec2 columnRow = ivec2Div(gridTexPos, uGridDim.xy);
    vec2 posXY = gridTexPos - columnRow * uGridDim.xy;
    float posZ = columnRow.y * intDiv(uGridTexDim.x, uGridDim.x) + columnRow.x;
    return vec3(posXY, posZ);
}

vec4 texture3dFrom2dNearest(sampler2D tex, vec3 pos, vec3 gridDim, vec2 texDim) {
    float zSlice = floor(pos.z * gridDim.z + 0.5); // round to nearest z-slice
    float column = intDiv(intMod(zSlice * gridDim.x, texDim.x), gridDim.x);
    float row = intDiv(zSlice * gridDim.x, texDim.x);
    vec2 coord = (vec2(column * gridDim.x, row * gridDim.y) + (pos.xy * gridDim.xy)) / (texDim / uScale);
    return texture2D(tex, coord + 0.5 / (texDim / uScale));
}

vec4 voxel(vec3 pos) {
    pos = min(max(vec3(0.0), pos), uGridDim - vec3(1.0));
    return texture3dFrom2dNearest(tVolumeData, pos / uGridDim, uGridDim, uGridTexDim.xy);
}

float voxelValuePadded(vec3 pos) {
    pos = min(max(vec3(0.0), pos), uGridDim - vec3(vec2(2.0), 1.0)); // remove xy padding
    vec4 v = texture3dFrom2dNearest(tVolumeData, pos / uGridDim, uGridDim, uGridTexDim.xy);
    #ifdef dValueChannel_red
        return v.r;
    #else
        return v.a;
    #endif
}

int idot2(const in ivec2 a, const in ivec2 b) {
    return a.x * b.x + a.y * b.y;
}

int idot4(const in ivec4 a, const in ivec4 b) {
    return a.x * b.x + a.y * b.y + a.z * b.z + a.w * b.w;
}

#if __VERSION__ == 100
    int pyramidVoxel(vec2 pos) {
        return int(unpackRGBToInt(texture2D(tActiveVoxelsPyramid, pos / (vec2(1.0, 0.5) * uSize)).rgb));
    }
#else
    int pyramidVoxel(vec2 pos) {
        return texture2D(tActiveVoxelsPyramid, pos / (vec2(1.0, 0.5) * uSize)).r;
    }
#endif

vec4 baseVoxel(vec2 pos) {
    return texture2D(tActiveVoxelsBase, pos / uSize);
}

vec4 getGroup(const in vec3 p) {
    // note that we swap x and z because the texture is flipped around y
    #if defined(dAxisOrder_012)
        float group = p.z + p.y * uGridDataDim.z + p.x * uGridDataDim.z * uGridDataDim.y; // 210
    #elif defined(dAxisOrder_021)
        float group = p.y + p.z * uGridDataDim.y + p.x * uGridDataDim.y * uGridDataDim.z; // 120
    #elif defined(dAxisOrder_102)
        float group = p.z + p.x * uGridDataDim.z + p.y * uGridDataDim.z * uGridDataDim.x; // 201
    #elif defined(dAxisOrder_120)
        float group = p.x + p.z * uGridDataDim.x + p.y * uGridDataDim.x * uGridDataDim.z; // 021
    #elif defined(dAxisOrder_201)
        float group = p.y + p.x * uGridDataDim.y + p.z * uGridDataDim.y * uGridDataDim.x; // 102
    #elif defined(dAxisOrder_210)
        float group = p.x + p.y * uGridDataDim.x + p.z * uGridDataDim.x * uGridDataDim.y; // 012
    #endif
    return vec4(group > 16777215.5 ? vec3(1.0) : packIntToRGB(group), 1.0);
}

void main(void) {
    // get 1D index
    int vI = int(gl_FragCoord.x) + int(gl_FragCoord.y) * int(uSize);

    // ignore 1D indices outside of the grid
    if(vI >= int(uCount)) discard;

    ivec2 offset = ivec2(int(uSize) - 2, 0);

    int start = 0;
    ivec4 starts = ivec4(0);
    ivec4 ends = ivec4(0);
    int diff = 2;
    ivec4 m = ivec4(0);
    ivec2 position = ivec2(0);
    ivec4 vI4 = ivec4(vI);

    ivec2 relativePosition = ivec2(0);
    int end = 0;
    ivec2 pos1 = ivec2(0);
    ivec2 pos2 = ivec2(0);
    ivec2 pos3 = ivec2(0);
    ivec2 pos4 = ivec2(0);
    ivec3 vI3 = ivec3(vI);
    ivec3 mask = ivec3(0);

    // traverse the different levels of the pyramid
    for(int i = 1; i < 14; i++) {
        if(float(i) >= uLevels) break;

        offset.x -= diff;
        diff *= 2;
        relativePosition = position + offset;

        end = start + pyramidVoxel(vec2(relativePosition));
        pos1 = ivec2(relativePosition);
        starts.x = start;
        ends.x = end;
        pos2 = ivec2(relativePosition + ivec2(1, 0));
        starts.y = ends.x;
        ends.y = ends.x + pyramidVoxel(vec2(pos2));
        pos3 = relativePosition + ivec2(0, 1);
        starts.z = ends.y;
        ends.z = ends.y + pyramidVoxel(vec2(pos3));
        pos4 = relativePosition + ivec2(1, 1);
        starts.w = ends.z;
        mask = ivec3(greaterThanEqual(vI3, starts.rgb)) * ivec3(lessThan(vI3, ends.rgb));
        m = ivec4(mask, 1 - int(any(bvec3(mask))));

        relativePosition = m.x * pos1 + m.y * pos2 + m.z * pos3 + m.w * pos4;
        start = idot4(m, starts);
        position = 2 * (relativePosition - offset);
    }

    end = start + int(baseVoxel(vec2(position)).r * 255.0);
    pos1 = position;
    starts.x = start;
    ends.x = end;
    pos2 = position + ivec2(1, 0);
    starts.y = ends.x;
    ends.y = ends.x + int(baseVoxel(vec2(pos2)).r * 255.0);
    pos3 = position + ivec2(0, 1);
    starts.z = ends.y;
    ends.z = ends.y + int(baseVoxel(vec2(pos3)).r * 255.0);
    pos4 = position + ivec2(1, 1);
    starts.w = ends.z;
    mask = ivec3(greaterThanEqual(vI3, starts.rgb)) * ivec3(lessThan(vI3, ends.rgb));
    m = ivec4(mask, 1 - int(any(bvec3(mask))));
    position = m.x * pos1 + m.y * pos2 + m.z * pos3 + m.w * pos4;

    vec2 coord2d = (vec2(position) / uSize) / uScale;
    vec3 coord3d = floor(index3dFrom2d(coord2d) + 0.5);

    float edgeIndex = floor(baseVoxel(vec2(position)).a * 255.0 + 0.5);

    // current vertex for the up to 15 MC cases
    int currentVertex = vI - idot4(m, starts);

    // ensure winding-order is the same for negative and positive iso-levels
    if (uInvert) {
        int v = imod(currentVertex + 1, 3);
        if (v == 1) currentVertex += 2;
        else if (v == 0) currentVertex -= 2;
    }

    // get index into triIndices table
    int mcIndex = 16 * int(edgeIndex) + currentVertex;
    vec4 mcData = texture2D(tTriIndices, vec2(imod(mcIndex, 64), mcIndex / 64) / 64.);

    // bit mask to avoid conditionals (see comment below) for getting MC case corner
    vec4 m0 = vec4(floor(mcData.a * 255.0 + 0.5));

    // get edge value masks
    vec4 m1 = vec4(equal(m0, vec4(0., 1., 2., 3.)));
    vec4 m2 = vec4(equal(m0, vec4(4., 5., 6., 7.)));
    vec4 m3 = vec4(equal(m0, vec4(8., 9., 10., 11.)));

    // apply bit masks
    vec3 b0 = coord3d +
                m1.y * c1 +
                m1.z * c2 +
                m1.w * c3 +
                m2.x * c4 +
                m2.y * c5 +
                m2.z * c6 +
                m2.w * c7 +
                m3.y * c1 +
                m3.z * c2 +
                m3.w * c3;
    vec3 b1 = coord3d +
                m1.x * c1 +
                m1.y * c2 +
                m1.z * c3 +
                m2.x * c5 +
                m2.y * c6 +
                m2.z * c7 +
                m2.w * c4 +
                m3.x * c4 +
                m3.y * c5 +
                m3.z * c6 +
                m3.w * c7;

    // the conditionals that are avoided by above bitmasks
    // vec3 b0 = coord3d;
    // vec3 b1 = coord3d;
    // if (mcIndex == 0.0) {
    //     b1 += c1;
    // } else if (mcIndex == 1.0) {
    //     b0 += c1; b1 += c2;
    // } else if (mcIndex == 2.0) {
    //     b0 += c2; b1 += c3;
    // } else if (mcIndex == 3.0) {
    //     b0 += c3;
    // } else if (mcIndex == 4.0) {
    //     b0 += c4; b1 += c5;
    // } else if (mcIndex == 5.0) {
    //     b0 += c5; b1 += c6;
    // } else if (mcIndex == 6.0) {
    //     b0 += c6; b1 += c7;
    // } else if (mcIndex == 7.0) {
    //     b0 += c7; b1 += c4;
    // } else if (mcIndex == 8.0) {
    //     b1 += c4;
    // } else if (mcIndex == 9.0) {
    //     b0 += c1; b1 += c5;
    // } else if (mcIndex == 10.0) {
    //     b0 += c2; b1 += c6;
    // } else if (mcIndex == 11.0) {
    //     b0 += c3; b1 += c7;
    // }
    // b0 = floor(b0 + 0.5);
    // b1 = floor(b1 + 0.5);

    vec4 d0 = voxel(b0);
    vec4 d1 = voxel(b1);

    #ifdef dValueChannel_red
        float v0 = d0.r;
        float v1 = d1.r;
    #else
        float v0 = d0.a;
        float v1 = d1.a;
    #endif

    float t = (uIsoValue - v0) / (v0 - v1);
    gl_FragData[0].xyz = (uGridTransform * vec4(b0 + t * (b0 - b1), 1.0)).xyz;

    // group id
    #if __VERSION__ == 100 || defined(dConstantGroup)
        // webgl1 does not support 'flat' interpolation (i.e. no interpolation)
        // ensure a constant group id per triangle as needed
        #ifdef dPackedGroup
            gl_FragData[1] = vec4(voxel(coord3d).rgb, 1.0);
        #else
            gl_FragData[1] = getGroup(coord3d);
        #endif
    #else
        #ifdef dPackedGroup
            gl_FragData[1] = vec4(t < 0.5 ? d0.rgb : d1.rgb, 1.0);
        #else
            gl_FragData[1] = getGroup(t < 0.5 ? b0 : b1);
        #endif
    #endif

    // normals from gradients
    vec3 n0 = -normalize(vec3(
        voxelValuePadded(b0 - c1) - voxelValuePadded(b0 + c1),
        voxelValuePadded(b0 - c3) - voxelValuePadded(b0 + c3),
        voxelValuePadded(b0 - c4) - voxelValuePadded(b0 + c4)
    ));
    vec3 n1 = -normalize(vec3(
        voxelValuePadded(b1 - c1) - voxelValuePadded(b1 + c1),
        voxelValuePadded(b1 - c3) - voxelValuePadded(b1 + c3),
        voxelValuePadded(b1 - c4) - voxelValuePadded(b1 + c4)
    ));
    gl_FragData[2].xyz = -vec3(
        n0.x + t * (n0.x - n1.x),
        n0.y + t * (n0.y - n1.y),
        n0.z + t * (n0.z - n1.z)
    );

    // ensure normal-direction is the same for negative and positive iso-levels
    if (uInvert) {
        gl_FragData[2].xyz *= -1.0;
    }

    // apply normal matrix
    gl_FragData[2].xyz = uGridTransformAdjoint * gl_FragData[2].xyz;
}
`;var hDe=`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tTriCount;
uniform sampler2D tVolumeData;

uniform float uIsoValue;
uniform vec3 uGridDim;
uniform vec3 uGridTexDim;
uniform vec2 uScale;

#include common

// cube corners (excluding origin)
const vec3 c1 = vec3(1., 0., 0.);
const vec3 c2 = vec3(1., 1., 0.);
const vec3 c3 = vec3(0., 1., 0.);
const vec3 c4 = vec3(0., 0., 1.);
const vec3 c5 = vec3(1., 0., 1.);
const vec3 c6 = vec3(1., 1., 1.);
const vec3 c7 = vec3(0., 1., 1.);

vec3 index3dFrom2d(vec2 coord) {
    vec2 gridTexPos = coord * uGridTexDim.xy;
    vec2 columnRow = ivec2Div(gridTexPos, uGridDim.xy);
    vec2 posXY = gridTexPos - columnRow * uGridDim.xy;
    float posZ = columnRow.y * intDiv(uGridTexDim.x, uGridDim.x) + columnRow.x;
    return vec3(posXY, posZ);
}

vec4 texture3dFrom2dNearest(sampler2D tex, vec3 pos, vec3 gridDim, vec2 texDim) {
    float zSlice = floor(pos.z * gridDim.z + 0.5); // round to nearest z-slice
    float column = intDiv(intMod(zSlice * gridDim.x, texDim.x), gridDim.x);
    float row = intDiv(zSlice * gridDim.x, texDim.x);
    vec2 coord = (vec2(column * gridDim.x, row * gridDim.y) + (pos.xy * gridDim.xy)) / (texDim / uScale);
    return texture2D(tex, coord);
}

float voxelValue(vec3 pos) {
    pos = min(max(vec3(0.0), pos), uGridDim - vec3(1.0));
    vec4 v = texture3dFrom2dNearest(tVolumeData, pos / uGridDim, uGridDim, uGridTexDim.xy);
    #ifdef dValueChannel_red
        return v.r;
    #else
        return v.a;
    #endif
}

void main(void) {
    vec2 uv = gl_FragCoord.xy / uGridTexDim.xy;
    vec3 posXYZ = index3dFrom2d(uv);

    // get MC case as the sum of corners that are below the given iso level
    float c = step(voxelValue(posXYZ), uIsoValue)
        + 2. * step(voxelValue(posXYZ + c1), uIsoValue)
        + 4. * step(voxelValue(posXYZ + c2), uIsoValue)
        + 8. * step(voxelValue(posXYZ + c3), uIsoValue)
        + 16. * step(voxelValue(posXYZ + c4), uIsoValue)
        + 32. * step(voxelValue(posXYZ + c5), uIsoValue)
        + 64. * step(voxelValue(posXYZ + c6), uIsoValue)
        + 128. * step(voxelValue(posXYZ + c7), uIsoValue);
    c *= step(c, 254.);

    // handle out of bounds positions
    posXYZ += 1.0;
    posXYZ.xy += 1.0; // pixel padding (usually ok even if the texture has no padding)
    if (posXYZ.x >= uGridDim.x || posXYZ.y >= uGridDim.y || posXYZ.z >= uGridDim.z)
        c = 0.0;

    // get total triangles to generate for calculated MC case from triCount texture
    float totalTrianglesToGenerate = texture2D(tTriCount, vec2(intMod(c, 16.), floor(c / 16.)) / 16.).a;
    gl_FragColor = vec4(vec3(totalTrianglesToGenerate * 3.0), c / 255.0);
}
`;var Wht={...Sn,tTriCount:yt("image-uint8","alpha","ubyte","nearest"),tVolumeData:yt("texture","rgba","ubyte","nearest"),dValueChannel:dt("string",["red","alpha"]),uIsoValue:de("f"),uGridDim:de("v3"),uGridTexDim:de("v3"),uScale:de("v2")},Sh="active-voxels";function gDe(e,t){return Ht(e.gl)&&t.format===e.gl.RED?"red":"alpha"}function Xht(e,t,r,n,o,i){if(e.namedComputeRenderables[Sh]){let a=e.namedComputeRenderables[Sh].values;_.update(a.uQuadScale,i),_.update(a.tVolumeData,t),_.update(a.dValueChannel,gDe(e,t)),_.updateIfChanged(a.uIsoValue,o),_.update(a.uGridDim,r),_.update(a.uGridTexDim,n),_.update(a.uScale,i),e.namedComputeRenderables[Sh].update()}else e.namedComputeRenderables[Sh]=Qht(e,t,r,n,o,i);return e.namedComputeRenderables[Sh]}function Qht(e,t,r,n,o,i){let a={...vn,tTriCount:_.create(dDe()),uQuadScale:_.create(i),tVolumeData:_.create(t),dValueChannel:_.create(gDe(e,t)),uIsoValue:_.create(o),uGridDim:_.create(r),uGridTexDim:_.create(n),uScale:_.create(i)},s={...Wht},l=zr("active-voxels",Fn,hDe),u=on(e,"triangles",l,s,a);return an(u,a)}function Zht(e){let{gl:t,state:r}=e;r.disable(t.CULL_FACE),r.disable(t.BLEND),r.disable(t.DEPTH_TEST),r.enable(t.SCISSOR_TEST),r.depthMask(!1),r.colorMask(!0,!0,!0,!0),r.clearColor(0,0,0,0)}function yDe(e,t,r,n,o,i){je&&e.timer.mark("calcActiveVoxels");let{gl:a,state:s,resources:l}=e,u=t.getWidth(),c=t.getHeight();e.namedFramebuffers[Sh]||(e.namedFramebuffers[Sh]=l.framebuffer());let m=e.namedFramebuffers[Sh];m.bind(),e.namedTextures[Sh]||(e.namedTextures[Sh]=l.texture("image-uint8","rgba","ubyte","nearest"));let d=e.namedTextures[Sh];d.define(u,c);let p=Xht(e,t,r,n,o,i);return e.state.currentRenderItemId=-1,d.attachFramebuffer(m,0),Zht(e),s.viewport(0,0,u,c),s.scissor(0,0,u,c),a.clear(a.COLOR_BUFFER_BIT),s.scissor(0,0,n[0],n[1]),p.render(),a.finish(),je&&e.timer.markEnd("calcActiveVoxels"),d}var qht={...Sn,tTriIndices:yt("image-uint8","alpha","ubyte","nearest"),tActiveVoxelsPyramid:yt("texture","rgba","float","nearest"),tActiveVoxelsBase:yt("texture","rgba","float","nearest"),tVolumeData:yt("texture","rgba","ubyte","nearest"),dValueChannel:dt("string",["red","alpha"]),uIsoValue:de("f"),uSize:de("f"),uLevels:de("f"),uCount:de("f"),uInvert:de("b"),uGridDim:de("v3"),uGridTexDim:de("v3"),uGridDataDim:de("v3"),uGridTransform:de("m4"),uGridTransformAdjoint:de("m3"),uScale:de("v2"),dPackedGroup:dt("boolean"),dAxisOrder:dt("string",["012","021","102","120","201","210"]),dConstantGroup:dt("boolean")},u0="isosurface";function bDe(e,t){return Ht(e.gl)&&t.format===e.gl.RED?"red":"alpha"}function Yht(e,t,r,n,o,i,a,s,l,u,c,m,d,p,h,f){if(e.namedComputeRenderables[u0]){let g=e.namedComputeRenderables[u0].values;_.update(g.tActiveVoxelsPyramid,t),_.update(g.tActiveVoxelsBase,r),_.update(g.tVolumeData,n),_.update(g.dValueChannel,bDe(e,n)),_.updateIfChanged(g.uIsoValue,l),_.updateIfChanged(g.uSize,Math.pow(2,u)),_.updateIfChanged(g.uLevels,u),_.updateIfChanged(g.uCount,m),_.updateIfChanged(g.uInvert,d),_.update(g.uGridDim,o),_.update(g.uGridTexDim,i),_.update(g.uGridDataDim,a),_.update(g.uGridTransform,s),_.update(g.uGridTransformAdjoint,Mt.adjointFromMat4(Mt(),s)),_.update(g.uScale,c),_.updateIfChanged(g.dPackedGroup,p),_.updateIfChanged(g.dAxisOrder,h.join("")),_.updateIfChanged(g.dConstantGroup,f),e.namedComputeRenderables[u0].update()}else e.namedComputeRenderables[u0]=Kht(e,t,r,n,o,i,a,s,l,u,c,m,d,p,h,f);return e.namedComputeRenderables[u0]}function Kht(e,t,r,n,o,i,a,s,l,u,c,m,d,p,h,f){let g={...vn,tTriIndices:_.create(pDe()),tActiveVoxelsPyramid:_.create(t),tActiveVoxelsBase:_.create(r),tVolumeData:_.create(n),dValueChannel:_.create(bDe(e,n)),uIsoValue:_.create(l),uSize:_.create(Math.pow(2,u)),uLevels:_.create(u),uCount:_.create(m),uInvert:_.create(d),uGridDim:_.create(o),uGridTexDim:_.create(i),uGridDataDim:_.create(a),uGridTransform:_.create(s),uGridTransformAdjoint:_.create(Mt.adjointFromMat4(Mt(),s)),uScale:_.create(c),dPackedGroup:_.create(p),dAxisOrder:_.create(h.join("")),dConstantGroup:_.create(f)},y={...qht},x=zr("isosurface",Fn,fDe,{drawBuffers:"required"}),S=on(e,"triangles",x,y,g);return an(S,g)}function Jht(e){let{gl:t,state:r}=e;r.disable(t.CULL_FACE),r.disable(t.BLEND),r.disable(t.DEPTH_TEST),r.disable(t.SCISSOR_TEST),r.depthMask(!1),r.colorMask(!0,!0,!0,!0),r.clearColor(0,0,0,0)}function $ht(e,t,r,n,o,i,a,s,l,u,c,m,d,p,h,f){let{drawBuffers:g}=e.extensions;if(!g)throw new Error("need WebGL draw buffers");je&&e.timer.mark("createIsosurfaceBuffers");let{gl:y,state:x,resources:S,extensions:I}=e,{pyramidTex:v,height:A,levels:P,scale:T,count:R}=n,w=v.getWidth();e.namedFramebuffers[u0]||(e.namedFramebuffers[u0]=S.framebuffer());let E=e.namedFramebuffers[u0];Ht(y)?(p||(p=S.texture("image-float32","rgba","float","nearest")),h||(h=S.texture("image-uint8","rgba","ubyte","nearest")),f||(f=I.colorBufferHalfFloat&&I.textureHalfFloat?S.texture("image-float16","rgba","fp16","nearest"):S.texture("image-float32","rgba","float","nearest"))):(p||(p=S.texture("image-float32","rgba","float","nearest")),h||(h=S.texture("image-float32","rgba","float","nearest")),f||(f=S.texture("image-float32","rgba","float","nearest"))),p.define(w,A),h.define(w,A),f.define(w,A),p.attachFramebuffer(E,0),h.attachFramebuffer(E,1),f.attachFramebuffer(E,2);let M=Yht(e,v,t,r,o,i,a,s,l,P,T,R,u,c,m,d);return e.state.currentRenderItemId=-1,E.bind(),g.drawBuffers([g.COLOR_ATTACHMENT0,g.COLOR_ATTACHMENT1,g.COLOR_ATTACHMENT2]),Jht(e),x.viewport(0,0,w,A),y.clear(y.COLOR_BUFFER_BIT),M.render(),y.finish(),je&&e.timer.markEnd("createIsosurfaceBuffers"),{vertexTexture:p,groupTexture:h,normalTexture:f,vertexCount:R}}function L1(e,t,r,n,o,i,a,s,l,u,c,m,d,p,h){je&&e.timer.mark("extractIsosurface");let f=yDe(e,t,r,n,s,i),g=mDe(e,f,i,n),y=$ht(e,f,t,g,r,n,o,a,s,l,u,c,m,d,p,h);return je&&e.timer.markEnd("extractIsosurface"),y}var Hq={isoValue:Ge.IsoValueParam,wrap:C.Select("auto",C.arrayToOptions(["off","on","auto"]))},egt={...Hq,tryUseGpu:C.Boolean(!0),gpuDataType:C.Select("byte",C.arrayToOptions(["byte","float","halfFloat"]),{hideIf:e=>!e.tryUseGpu})};function tgt(e){return e.extensions.colorBufferFloat&&e.extensions.textureFloat&&e.extensions.drawBuffers}function kO(e,t){return t==="on"?!0:t==="off"?!1:e.periodicity==="xyz"}var OD=1;function jq(e,t){if(e.grid.cells.data.length<Math.pow(10,3))return!1;let r=e.grid.cells.space.dimensions,{powerOfTwoSize:n}=Gp(r,OD);return n<=t.maxTextureSize/2}function rgt(e,t,r,n,o){return n.tryUseGpu&&o&&tgt(o)&&jq(t,o)?agt(e):ogt(e)}function xDe(e,t){let r=ye.ofLength(e.instances.length);return Ge.Isosurface.Loci(e,t.isoValue,r)}function Wq(e,t,r,n,o){let{objectId:i,groupId:a,instanceId:s}=e;if(o===i){let l=Ge.PickingGranularity.get(t),u=xe.ofSingleton(s);if(l==="volume")return Ge.Loci(t,u);if(l==="object"||a===vi.Null)return Ge.Isosurface.Loci(t,n.isoValue,u);{let c=ye.ofSingleton(a);return Ge.Cell.Loci(t,[{indices:c,instances:u}])}}return vr}function Xq(e,t,r,n,o){return Bg(e,t,{isoValue:n.isoValue},o)}async function ngt(e,t,r,n,o,i){e.runtime.update({message:"Marching cubes..."});let a=t.grid.cells;kO(t,o.wrap)&&(a=UF(t).grid.cells);let s=Xa(new Int32Array(t.grid.cells.data.length)),l=await ty({isoLevel:Ge.IsoValue.toAbsolute(o.isoValue,t.grid.stats).absoluteValue,scalarField:a,idField:Dr.create(a.space,Dr.Data1(s))},i).runAsChild(e.runtime),u=Nn.getGridToCartesianTransform(t.grid);return ft.transform(l,u),e.webgl&&!e.webgl.isWebGL2?(ft.uniformTriangleGroup(l,!1),_.updateIfChanged(l.varyingGroup,!1)):_.updateIfChanged(l.varyingGroup,!0),l.setBoundingSphere(Ge.Isosurface.getBoundingSphere(t,o.isoValue)),l}var Qq={...ft.Params,...Ss.Params,...Hq,...egt,quality:{...ft.Params.quality,isEssential:!1}};function ogt(e){return lm({defaultProps:C.getDefaultValues(Qq),createGeometry:ngt,createLocationIterator:Op,getLoci:Wq,eachLocation:Xq,setUpdateState:(t,r,n,o)=>{t.createGeometry=!Ge.IsoValue.areSame(n.isoValue,o.isoValue,r.grid.stats)||n.wrap!==o.wrap},geometryUtils:ft.Utils,mustRecreate:(t,r,n)=>r.tryUseGpu&&!!n&&jq(t.volume,n)},e)}var zq;(o=>{let e="volume-isosurface-texture";o.descriptor={name:e};function r(i){delete i._propertyData[e]}o.clear=r;function n(i,a,s){let{gpuDataType:l}=s,u=kO(i,s.wrap),c=Nn.getGridToCartesianTransform(i.grid),m=b.clone(i.grid.cells.space.dimensions),{width:d,height:p,powerOfTwoSize:h}=Gp(m,OD),f=b.create(d,p,0),g=b.subScalar(b(),m,u?1:0),y=Ce.create(d/h,p/h);if(h>a.maxTextureSize/2)throw new Error("volume too large for gpu isosurface extraction");let x=l==="halfFloat"&&!a.extensions.textureHalfFloat?"float":l;if(i._propertyData[e]?.dataType!==x||i._propertyData[e]?.wrap!==u){let S=x==="byte"?a.resources.texture("image-uint8","alpha","ubyte","linear"):x==="halfFloat"?a.resources.texture("image-float16","alpha","fp16","linear"):a.resources.texture("image-float32","alpha","float","linear");i._propertyData[e]={texture:S,dataType:x,wrap:u},S.define(h,h),S.load(GF(i,"data",OD,x),!0),i.customProperties.add(o.descriptor),i.customProperties.assets(o.descriptor,[{dispose:()=>S.destroy()}])}return m[0]+=OD,m[1]+=OD,{texture:i._propertyData[e].texture,transform:c,gridDimension:m,gridTexDim:f,gridDataDim:g,gridTexScale:y}}o.get=n})(zq||={});function igt(e,t,r,n,o,i){let{webgl:a}=e;if(!a)throw new Error("webgl context required to create volume isosurface texture-mesh");if(t.grid.cells.data.length<=1)return Ss.createEmpty(i);kO(t,o.wrap)&&(t=UF(t));let{max:s,min:l}=t.grid.stats,u=s-l,c=Ge.IsoValue.toAbsolute(o.isoValue,t.grid.stats).absoluteValue,m=(c-l)/u,d=t.grid.cells.space.axisOrderSlowToFast,p=t.grid.cells.data.length,h=Ge.getBoundingSphere(t),f=y=>{let{texture:x,gridDimension:S,gridTexDim:I,gridDataDim:v,gridTexScale:A,transform:P}=zq.get(t,a,o),T=y?.doubleBuffer.get(),R=L1(a,x,S,I,v,A,P,m,c<0,!1,d,!0,T?.vertex,T?.group,T?.normal);return Ss.create(R.vertexCount,p,R.vertexTexture,R.groupTexture,R.normalTexture,h,y)},g=f(i);return g.meta.webgl=a,g.meta.reset=()=>{zq.clear(t),f(g)},g}function agt(e){return lm({defaultProps:C.getDefaultValues(Qq),createGeometry:igt,createLocationIterator:Op,getLoci:Wq,eachLocation:Xq,setUpdateState:(t,r,n,o)=>{t.createGeometry=!Ge.IsoValue.areSame(n.isoValue,o.isoValue,r.grid.stats)||n.gpuDataType!==o.gpuDataType||n.wrap!==o.wrap},geometryUtils:Ss.Utils,mustRecreate:(t,r,n)=>!r.tryUseGpu||!n||!jq(t.volume,n),dispose:t=>{t.vertexTexture.ref.value.destroy(),t.groupTexture.ref.value.destroy(),t.normalTexture.ref.value.destroy(),t.doubleBuffer.destroy()}},e)}async function sgt(e,t,r,n,o,i){e.runtime.update({message:"Marching cubes..."});let a=t.grid.cells;kO(t,o.wrap)&&(a=UF(t).grid.cells);let s=Xa(new Int32Array(t.grid.cells.data.length)),l=await VT({isoLevel:Ge.IsoValue.toAbsolute(o.isoValue,t.grid.stats).absoluteValue,scalarField:a,idField:Dr.create(a.space,Dr.Data1(s))},i).runAsChild(e.runtime),u=Nn.getGridToCartesianTransform(t.grid);return Cn.transform(l,u),l.setBoundingSphere(Ge.Isosurface.getBoundingSphere(t,o.isoValue)),l}var CDe={...Cn.Params,...Hq,quality:{...Cn.Params.quality,isEssential:!1},sizeFactor:C.Numeric(3,{min:0,max:10,step:.1})};function lgt(e){return lm({defaultProps:C.getDefaultValues(CDe),createGeometry:sgt,createLocationIterator:Op,getLoci:Wq,eachLocation:Xq,setUpdateState:(t,r,n,o)=>{t.createGeometry=!Ge.IsoValue.areSame(n.isoValue,o.isoValue,r.grid.stats)||n.wrap!==o.wrap},geometryUtils:Cn.Utils},e)}var SDe={solid:(e,t)=>$p("Isosurface mesh",e,t,rgt,xDe),wireframe:(e,t)=>$p("Isosurface wireframe",e,t,lgt,xDe)},vDe={...Qq,...CDe,visuals:C.MultiSelect(["solid"],C.objectToOptions(SDe)),bumpFrequency:C.Numeric(1,{min:0,max:10,step:.1},Xe.ShadingCategory)};function ugt(e,t){let r=C.clone(vDe);return r.isoValue=Ge.createIsoValueParam(Ge.IsoValue.relative(2),t.grid.stats),r}function cgt(e,t){return Ut.createMulti("Isosurface",e,t,Ut.StateBuilder,SDe)}var IDe={name:"isosurface",label:"Isosurface",description:"Displays a triangulated isosurface of volumetric data.",factory:cgt,getParams:ugt,defaultValues:C.getDefaultValues(vDe),defaultColorTheme:{name:"uniform"},defaultSizeTheme:{name:"uniform"},isApplicable:e=>!Ge.isEmpty(e)&&!Ge.Segmentation.get(e)};var qq={...Gu.Params,quality:{...Gu.Params.quality,isEssential:!1},dimension:C.MappedStatic("x",{x:C.Numeric(0,{min:0,max:0,step:1},{immediateUpdate:!0}),y:C.Numeric(0,{min:0,max:0,step:1},{immediateUpdate:!0}),z:C.Numeric(0,{min:0,max:0,step:1},{immediateUpdate:!0}),relativeX:C.Numeric(0,{min:0,max:1,step:.01},{immediateUpdate:!0}),relativeY:C.Numeric(0,{min:0,max:1,step:.01},{immediateUpdate:!0}),relativeZ:C.Numeric(0,{min:0,max:1,step:.01},{immediateUpdate:!0})},{isEssential:!0,hideIf:e=>e.mode!=="grid",description:"Slice position in grid coordinates."}),isoValue:Ge.IsoValueParam,mode:C.Select("grid",C.arrayToOptions(["grid","frame","plane"]),{description:"Grid: slice through the volume along the grid axes in integer steps. Frame: slice through the volume along arbitrary axes in any step size. Plane: an arbitrary plane defined by point and normal."}),offset:C.Numeric(0,{min:-1,max:1,step:.01},{isEssential:!0,immediateUpdate:!0,hideIf:e=>e.mode!=="frame",description:"Relative offset from center."}),axis:C.Select("a",C.arrayToOptions(["a","b","c"]),{isEssential:!0,hideIf:e=>e.mode!=="frame",description:"Axis of the frame."}),rotation:C.Group({axis:C.Vec3(b.create(1,0,0),{},{description:"Axis of rotation"}),angle:C.Numeric(0,{min:-180,max:180,step:1},{immediateUpdate:!0,description:"Axis rotation angle in Degrees"})},{isExpanded:!0,hideIf:e=>e.mode!=="frame"}),plane:C.Group({point:C.Vec3(b.create(0,0,0),{},{description:"Plane point"}),normal:C.Vec3(b.create(1,0,0),{},{description:"Plane normal"})},{isExpanded:!0,hideIf:e=>e.mode!=="plane"})};function mgt(e,t){let r=C.clone(qq),n=t.grid.cells.space.dimensions;return r.dimension=C.MappedStatic("x",{x:C.Numeric(0,{min:0,max:n[0]-1,step:1},{immediateUpdate:!0}),y:C.Numeric(0,{min:0,max:n[1]-1,step:1},{immediateUpdate:!0}),z:C.Numeric(0,{min:0,max:n[2]-1,step:1},{immediateUpdate:!0}),relativeX:C.Numeric(0,{min:0,max:1,step:.01},{immediateUpdate:!0}),relativeY:C.Numeric(0,{min:0,max:1,step:.01},{immediateUpdate:!0}),relativeZ:C.Numeric(0,{min:0,max:1,step:.01},{immediateUpdate:!0})},{isEssential:!0,hideIf:o=>o.mode!=="grid"}),r.isoValue=Ge.createIsoValueParam(Ge.IsoValue.absolute(t.grid.stats.min),t.grid.stats),r}async function dgt(e,t,r,n,o,i){switch(o.mode){case"frame":return fgt(e,t,r,n,o,i);case"grid":return ggt(e,t,r,n,o,i);case"plane":return hgt(e,t,r,n,o,i);default:Mr(o.mode)}}function pgt(e,t){let{axis:r,rotation:n,mode:o}=t,i=Nn.getGridToCartesianTransform(e.grid),a=H.invert(H(),i),[s,l,u]=e.grid.cells.space.dimensions,c=s,m=l,d=u,p=b.create(c,0,0),h=b.create(0,m,0),f=b.create(0,0,d),g=Math.max(c,m,d)/Math.max(s,l,u),y=b.create(0,0,0),x=b.create(c,m,d);b.transformMat4(y,y,i),b.transformMat4(x,x,i);let S=b.center(b(),x,y),I=b(),v=b(),A=b(),P=b();if(r==="c"?(b.set(I,c,m,d),b.copy(v,p),b.copy(A,h),b.copy(P,f)):r==="b"?(b.set(I,c,d,m),b.copy(v,p),b.copy(P,h),b.copy(A,f)):(b.set(I,m,d,c),b.copy(P,p),b.copy(v,h),b.copy(A,f)),n.angle!==0){let R=b();b.scaleAndAdd(R,R,p,n.axis[0]),b.scaleAndAdd(R,R,h,n.axis[1]),b.scaleAndAdd(R,R,f,n.axis[2]),b.normalize(R,R);let w=H.fromRotation(H(),kr(n.angle),R);b.transformDirection(v,v,w),b.transformDirection(A,A,w),b.transformDirection(P,P,w)}if(o==="frame"){let R=b.distance(y,x),w=b.distance(y,x)*Math.SQRT2;b.set(I,w,w,R)}b.transformDirection(v,v,i),b.transformDirection(A,A,i),b.transformDirection(P,P,i);let T={type:3,center:b.create(c/2,m/2,d/2),scale:b.create(c,m,d),rotation:lr.identity(),transform:a};return{size:I,major:v,minor:A,normal:P,center:S,trim:T,resolution:g}}function ADe(e,t,r,n,o,i){let{m:a,width:s,height:l}=r,{cells:{space:u},stats:c}=e.grid,{min:m,max:d}=c,p=t.color.granularity==="uniform",h="color"in t.color&&t.color.color?t.color.color:()=>16777215,f=b(),g=Nn.getGridToCartesianTransform(e.grid),y=H.invert(H(),g),[x,S,I]=u.dimensions,v=new Uint8Array(s*l*4),A=new Uint8Array(s*l*4),P=new Float32Array(s*l),T=b(),R=zs(b(),b()),w=Nn.makeGetTrilinearlyInterpolated(e.grid,"none"),E=0;for(let j=0;j<l;++j)for(let Y=0;Y<s;++Y){let G=_r(Y+.5,0,s-1)/s-.5,X=_r(j+.5,0,l-1)/l-.5;b.set(f,X,-G,0),b.transformMat4(f,f,a),b.copy(T,f),b.transformMat4(T,T,y);let U=Math.trunc(T[0]),L=Math.trunc(T[1]),q=Math.trunc(T[2]);b.copy(R.position,f);let te=h(R,!1);Le.toArray(te,v,E);let J=wf(w(f),m,d);p&&(v[E]*=J,v[E+1]*=J,v[E+2]*=J),P[E/4]=J,U>=0&&U<x&&L>=0&&L<S&&q>=0&&q<I&&qf(u.dataOffset(U,L,q),A,E),E+=4}let M={width:s,height:l,array:v,flipY:!0},D={width:s,height:l,array:A,flipY:!0},B={width:s,height:l,array:P,flipY:!0},k=new Float32Array([-.5,.5,0,.5,.5,0,-.5,-.5,0,.5,-.5,0]);Zc(a,k,0,4);let F=_r(wf(Ge.IsoValue.toAbsolute(n,c).absoluteValue,m,d),0,1),z=Gu.create(M,k,D,B,o,F,i);return z.setBoundingSphere(Ge.getBoundingSphere(e)),z}async function fgt(e,t,r,n,o,i){let{offset:a,isoValue:s}=o,{size:l,major:u,minor:c,normal:m,center:d,trim:p,resolution:h}=pgt(t,o),f=1/h,g=b.create(l[0],l[1],1),y=b.setMagnitude(b(),m,l[2]/2),x=Math.floor(l[1]*f),S=Math.floor(l[0]*f),I=H.identity(),v=b(),A=b();return b.add(v,d,u),H.targetTo(I,d,v,c),b.scaleAndAdd(A,d,y,a),H.setTranslation(I,A),H.mul(I,I,H.rotY90),H.scale(I,I,g),ADe(t,n,{m:I,width:x,height:S},s,p,i)}async function hgt(e,t,r,n,o,i){let{plane:{point:a,normal:s},isoValue:l}=o,u=H.fromPlane(H(),s,a),c=Nn.getGridToCartesianTransform(t.grid),m=H.invert(H(),c),[d,p,h]=t.grid.cells.space.dimensions,f=d,g=p,y=h,S=1/(Math.max(f,g,y)/Math.max(d,p,h)),I=b.distance(b.create(0,0,0),b.create(f,g,y))*Math.SQRT2,v=b.set(b(),I,I,I);H.mul(u,u,H.rotY90),H.scale(u,u,v);let A=Math.floor(v[1]*S),P=Math.floor(v[0]*S),T={type:3,center:b.create(f/2,g/2,y/2),scale:b.create(f,g,y),rotation:lr.identity(),transform:m};return ADe(t,n,{m:u,width:A,height:P},l,T,i)}async function ggt(e,t,r,n,o,i){let{dimension:{name:a},isoValue:s}=o,{cells:{space:l,data:u},stats:c}=t.grid,{min:m,max:d}=c,p=n.color.granularity==="uniform",h="color"in n.color&&n.color.color?n.color.color:()=>16777215,{width:f,height:g,x:y,y:x,z:S,x0:I,y0:v,z0:A,nx:P,ny:T,nz:R}=Yq(t.grid,o),w=new Float32Array(a==="x"||a==="relativeX"?[y,0,0,y,x,0,y,0,S,y,x,S]:a==="y"||a==="relativeY"?[0,x,0,y,x,0,0,x,S,y,x,S]:[0,0,S,0,x,S,y,0,S,y,x,S]),E=new Uint8Array(f*g*4),M=ygt(t.grid,o),D=new Float32Array(f*g),B=Nn.getGridToCartesianTransform(t.grid),k=zs(b(),b()),F=0;for(let q=v;q<T;++q)for(let te=I;te<P;++te)for(let J=A;J<R;++J){b.set(k.position,te,q,J),b.transformMat4(k.position,k.position,B),Le.toArray(h(k,!1),E,F);let ee=wf(l.get(u,te,q,J),m,d);p&&(E[F]*=ee,E[F+1]*=ee,E[F+2]*=ee),D[F/4]=ee,F+=4}let z={width:f,height:g,array:E,flipY:!0},j={width:f,height:g,array:M,flipY:!0},Y={width:f,height:g,array:D,flipY:!0},G=Nn.getGridToCartesianTransform(t.grid);Zc(G,w,0,4);let X=Gu.createEmptyTrim(),U=_r(wf(Ge.IsoValue.toAbsolute(s,c).absoluteValue,m,d),0,1),L=Gu.create(z,w,j,Y,X,U,i);return L.setBoundingSphere(Ge.getBoundingSphere(t)),L}function Zq(e,t){return _r(Math.round((e-1)*t),0,e-1)}function Yq(e,t){let{dimension:{name:r,params:n}}=t,{space:o}=e.cells,i,a,s,l,u,c=0,m=0,d=0,[p,h,f]=o.dimensions;return r==="x"?(s=n,l=h,u=f,i=f,a=h,c=s,p=c+1):r==="y"?(s=p,l=n,u=f,i=f,a=p,m=l,h=m+1):r==="z"?(s=p,l=h,u=n,i=p,a=h,d=u,f=d+1):r==="relativeX"?(s=Zq(p,n),l=h,u=f,i=f,a=h,c=s,p=c+1):r==="relativeY"?(s=p,l=Zq(h,n),u=f,i=f,a=p,m=l,h=m+1):(s=p,l=h,u=Zq(f,n),i=p,a=h,d=u,f=d+1),{width:i,height:a,x:s,y:l,z:u,x0:c,y0:m,z0:d,nx:p,ny:h,nz:f}}function ygt(e,t){let{space:r}=e.cells,{width:n,height:o,x0:i,y0:a,z0:s,nx:l,ny:u,nz:c}=Yq(e,t),m=new Uint8Array(n*o*4),d=0;for(let p=a;p<u;++p)for(let h=i;h<l;++h)for(let f=s;f<c;++f)qf(r.dataOffset(h,p,f),m,d),d+=4;return m}function bgt(e,t){let{space:r}=e.cells,{width:n,height:o,x0:i,y0:a,z0:s,nx:l,ny:u,nz:c}=Yq(e,t),m=new Uint32Array(n*o),d=0;for(let p=a;p<u;++p)for(let h=i;h<l;++h)for(let f=s;f<c;++f)m[d]=r.dataOffset(h,p,f),d+=1;return m}function TDe(e,t,r){if(r.mode==="grid"){let n=bgt(e.grid,r),o=Be.ofUnsortedArray(n);return Ge.Cell.Loci(e,[{indices:o,instances:t}])}else return Ge.Loci(e,t)}function xgt(e,t){let r=ye.ofLength(e.instances.length);return TDe(e,r,t)}function Cgt(e,t,r,n,o){let{objectId:i,groupId:a,instanceId:s}=e;if(o===i){let l=Ge.PickingGranularity.get(t),u=xe.ofSingleton(s);if(l==="volume")return Ge.Loci(t,u);if(l==="object"||a===vi.Null)return TDe(t,u,n);{let c=ye.ofSingleton(a);return Ge.Cell.Loci(t,[{indices:c,instances:u}])}}return vr}function Sgt(e,t,r,n,o){return Bg(e,t,void 0,o)}function vgt(e){return lm({defaultProps:C.getDefaultValues(qq),createGeometry:dgt,createLocationIterator:Op,getLoci:Cgt,eachLocation:Sgt,setUpdateState:(t,r,n,o,i,a)=>{t.createGeometry=n.dimension.name!==o.dimension.name||n.dimension.params!==o.dimension.params||n.mode!==o.mode||!b.equals(n.rotation.axis,o.rotation.axis)||n.rotation.angle!==o.rotation.angle||n.offset!==o.offset||n.axis!==o.axis||!b.equals(n.plane.point,o.plane.point)||!b.equals(n.plane.normal,o.plane.normal)||!Ge.IsoValue.areSame(n.isoValue,o.isoValue,r.grid.stats)||!vs.areEqual(i.color,a.color)},geometryUtils:Gu.Utils},e)}function Igt(e,t){return $p("Slice",e,t,vgt,xgt)}var PDe={name:"slice",label:"Slice",description:"Slice of volume rendered as image with interpolation.",factory:Igt,getParams:mgt,defaultValues:C.getDefaultValues(qq),defaultColorTheme:{name:"uniform"},defaultSizeTheme:{name:"uniform"},isApplicable:e=>!Ge.isEmpty(e)&&!Ge.Segmentation.get(e)};function _De(e,t){let r=pt();return pt.add(r,e),pt.transform(r,r,t),r}function Agt(e,t,r,n,o){let i=r.grid.cells.space.dimensions,{width:a,height:s}=Gp(i);if(Math.max(a,s)>t.maxTextureSize/2)throw new Error("volume too large for direct-volume rendering");let l=n.dataType==="halfFloat"&&!t.extensions.textureHalfFloat?"float":n.dataType,u=GF(r,"normals",0,l),c=Nn.getGridToCartesianTransform(r.grid),m=_De(i,c),d;o&&o.dataType.ref.value===l?d=o.gridTexture.ref.value:d=l==="byte"?t.resources.texture("image-uint8","rgba","ubyte","linear"):l==="halfFloat"?t.resources.texture("image-float16","rgba","fp16","linear"):t.resources.texture("image-float32","rgba","float","linear"),d.load(u);let{unitToCartn:p,cellDim:h}=RDe(r.grid),f=r.grid.cells.space.axisOrderSlowToFast;return tu.create(m,i,c,p,h,d,r.grid.stats,!1,f,l,o)}function RDe(e){if(e.transform.kind==="matrix")return{unitToCartn:H.mul(H(),e.transform.matrix,H.fromScaling(H(),e.cells.space.dimensions)),cellDim:H.getScaling(b(),e.transform.matrix)};let t=e.transform.fractionalBox,r=pt.size(b(),t);return{unitToCartn:H.mul3(H(),e.transform.cell.fromFractional,H.fromTranslation(H(),t.min),H.fromScaling(H(),r)),cellDim:b.div(b(),e.transform.cell.size,e.cells.space.dimensions)}}function Tgt(e,t,r,n,o){let i=r.grid.cells.space.dimensions;if(Math.max(...i)>t.max3dTextureSize/2)throw new Error("volume too large for direct-volume rendering");let a=n.dataType==="halfFloat"&&!t.extensions.textureHalfFloat?"float":n.dataType,s=jSe(r,a),l=Nn.getGridToCartesianTransform(r.grid),u=_De(i,l),c;o&&o.dataType.ref.value===a?c=o.gridTexture.ref.value:c=a==="byte"?t.resources.texture("volume-uint8","rgba","ubyte","linear"):a==="halfFloat"?t.resources.texture("volume-float16","rgba","fp16","linear"):t.resources.texture("volume-float32","rgba","float","linear"),c.load(s);let{unitToCartn:m,cellDim:d}=RDe(r.grid),p=r.grid.cells.space.axisOrderSlowToFast;return tu.create(u,i,l,m,d,c,r.grid.stats,!1,p,a,o)}async function Pgt(e,t,r,n,o,i){let{runtime:a,webgl:s}=e;if(s===void 0)throw new Error("DirectVolumeVisual requires `webgl` in VisualContext");return s.isWebGL2?Tgt(a,s,t,o,i):Agt(a,s,t,o,i)}function _gt(e,t){let r=ye.ofLength(e.instances.length);return Ge.Loci(e,r)}function Rgt(e,t,r,n,o){let{objectId:i,groupId:a,instanceId:s}=e;if(o===i){let l=xe.ofSingleton(s),u=ye.ofSingleton(a);return Ge.Cell.Loci(t,[{indices:u,instances:l}])}return vr}function Dgt(e,t,r,n,o){return Bg(e,t,void 0,o)}var Kq={...tu.Params,quality:{...tu.Params.quality,isEssential:!1},dataType:C.Select("byte",C.arrayToOptions(["byte","float","halfFloat"]))};function wgt(e,t){let r=C.clone(Kq);return r.controlPoints.getVolume=()=>t,r}function Mgt(e){return lm({defaultProps:C.getDefaultValues(Kq),createGeometry:Pgt,createLocationIterator:Op,getLoci:Rgt,eachLocation:Dgt,setUpdateState:(t,r,n,o)=>{t.createGeometry=n.dataType!==o.dataType},geometryUtils:tu.Utils,dispose:t=>{t.gridTexture.ref.value.destroy()}},e)}function Bgt(e,t){return $p("Direct Volume",e,t,Mgt,_gt)}var DDe={name:"direct-volume",label:"Direct Volume",description:"Direct rendering of volumetric data.",factory:Bgt,getParams:wgt,defaultValues:C.getDefaultValues(Kq),defaultColorTheme:{name:"volume-value"},defaultSizeTheme:{name:"uniform"},locationKinds:["position-location","direct-location"],isApplicable:e=>!Ge.isEmpty(e)&&!Ge.Segmentation.get(e)};var Egt={segments:C.Converted(e=>e.map(t=>`${t}`),e=>e.map(t=>parseInt(t)),C.MultiSelect(["0"],C.arrayToOptions(["0"]),{isEssential:!0}))};function kgt(e){return e.extensions.colorBufferFloat&&e.extensions.textureFloat&&e.extensions.drawBuffers}var GD=1;function $q(e,t){if(e.grid.cells.data.length<Math.pow(10,3))return!1;let r=e.grid.cells.space.dimensions,{powerOfTwoSize:n}=Gp(r,GD);return n<=t.maxTextureSize/2}var Fgt=H();function wDe(e,t){let r=Nn.getGridToCartesianTransform(e),n=H.fromTranslation(Fgt,t.min);return H.mul(H(),r,n)}function Lgt(e,t,r,n,o){return n.tryUseGpu&&o&&kgt(o)&&$q(t,o)?Hgt(e):Ugt(e)}function Vgt(e,t){let r=Be.ofUnsortedArray(t.segments),n=ye.ofLength(e.instances.length);return Ge.Segment.Loci(e,[{segments:r,instances:n}])}function MDe(e,t,r,n,o){let{objectId:i,groupId:a,instanceId:s}=e;if(o===i){let l=Ge.PickingGranularity.get(t),u=xe.ofSingleton(s);if(l==="volume")return Ge.Loci(t,u);if(l==="object"||a===vi.Null){let c=xe.ofSingleton(r);return Ge.Segment.Loci(t,[{segments:c,instances:u}])}else{let c=ye.ofSingleton(a);return Ge.Cell.Loci(t,[{indices:c,instances:u}])}}return vr}function BDe(e,t,r,n,o){let i=Be.ofSingleton(r);return Bg(e,t,{segments:i},o)}function Ogt(e,t,r){let n=r.data,o=r.space.dataOffset,i=pt.size(b(),t),[a,s,l]=i,u=a-1,c=s-1,m=l-1,[d,p,h]=t.min,[f,g,y]=t.max,x=[...r.space.axisOrderSlowToFast],S=Dr.Space(i,x,Uint8Array),I=Dr.create(S,S.create()),v=I.data,A=S.set;for(let P=0;P<l;++P)for(let T=0;T<s;++T)for(let R=0;R<a;++R){let w=e.includes(n[o(R+d,T+p,P+h)])?255:0,E=e.includes(n[o(Math.min(u+f,R+1+d),T+p,P+h)])?255:0,M=e.includes(n[o(Math.max(0,R-1+d),T+p,P+h)])?255:0,D=e.includes(n[o(R+d,Math.min(c+g,T+1+p),P+h)])?255:0,B=e.includes(n[o(R+d,Math.max(0,T-1+p),P+h)])?255:0,k=e.includes(n[o(R+d,T+p,Math.min(m+y,P+1+h))])?255:0,F=e.includes(n[o(R+d,T+p,Math.max(0,P-1+h))])?255:0;A(v,R,T,P,Math.round((w+w+E+M+D+B+k+F)/8))}return I}async function Ggt(e,t,r,n,o,i){let a=Ge.Segmentation.get(t);if(!a)throw new Error("missing volume segmentation");e.runtime.update({message:"Marching cubes..."});let s=pt.clone(a.bounds[r]);pt.expand(s,s,b.create(2,2,2));let l=Array.from(a.segments.get(r).values()),u=Ogt(l,s,t.grid.cells),c=Xa(new Int32Array(u.data.length)),m=await ty({isoLevel:128,scalarField:u,idField:Dr.create(u.space,Dr.Data1(c))},i).runAsChild(e.runtime),d=wDe(t.grid,s);ft.transform(m,d),e.webgl&&!e.webgl.isWebGL2?(ft.uniformTriangleGroup(m,!1),_.updateIfChanged(m.varyingGroup,!1)):_.updateIfChanged(m.varyingGroup,!0);let p=ye.ofLength(t.instances.length),h=xe.ofSingleton(r);return m.setBoundingSphere(Ge.Segment.getBoundingSphere(t,[{segments:h,instances:p}])),m}var eY={...ft.Params,...Ss.Params,...Egt,quality:{...ft.Params.quality,isEssential:!1},tryUseGpu:C.Boolean(!0)};function Ugt(e){return lm({defaultProps:C.getDefaultValues(eY),createGeometry:Ggt,createLocationIterator:(t,r)=>{let n=Ge.Segment.Location(t,r);return un(t.grid.cells.data.length,t.instances?t.instances.length:1,1,()=>n)},getLoci:MDe,eachLocation:BDe,setUpdateState:(t,r,n,o)=>{},geometryUtils:ft.Utils,mustRecreate:(t,r,n)=>r.tryUseGpu&&!!n&&$q(t.volume,n)},e)}var Jq="segment-texture";function Ngt(e,t,r){let n=Ge.Segmentation.get(e);if(!n)throw new Error("missing volume segmentation");let{resources:o}=r,i=pt.clone(n.bounds[t]);pt.expand(i,i,b.create(2,2,2));let a=wDe(e.grid,i),s=pt.size(b(),i),{width:l,height:u,powerOfTwoSize:c}=Gp(s,GD),m=b.create(l,u,0),d=b.clone(s),p=Ce.create(l/c,u/c);if(c>r.maxTextureSize/2)throw new Error("volume too large for gpu segment extraction");r.namedTextures[Jq]||(r.namedTextures[Jq]=o.texture("image-uint8","alpha","ubyte","linear"));let h=r.namedTextures[Jq];h.define(c,c);let f=Array.from(n.segments.get(t).values());return h.load(WSe(e,f,i,GD),!0),s[0]+=GD,s[1]+=GD,{texture:h,transform:a,gridDimension:s,gridTexDim:m,gridDataDim:d,gridTexScale:p}}async function zgt(e,t,r,n,o,i){if(!e.webgl)throw new Error("webgl context required to create volume segment texture-mesh");if(t.grid.cells.data.length<=1)return Ss.createEmpty(i);let{texture:a,gridDimension:s,gridTexDim:l,gridDataDim:u,gridTexScale:c,transform:m}=Ngt(t,r,e.webgl),d=t.grid.cells.space.axisOrderSlowToFast,p=i?.doubleBuffer.get(),h=L1(e.webgl,a,s,l,u,c,m,.5,!1,!1,d,!0,p?.vertex,p?.group,p?.normal),f=t.grid.cells.data.length,g=ye.ofLength(t.instances.length),y=xe.ofSingleton(r),x=Ge.Segment.getBoundingSphere(t,[{segments:y,instances:g}]);return Ss.create(h.vertexCount,f,h.vertexTexture,h.groupTexture,h.normalTexture,x,i)}function Hgt(e){return lm({defaultProps:C.getDefaultValues(eY),createGeometry:zgt,createLocationIterator:(t,r)=>{let n=Ge.Segment.Location(t,r);return un(t.grid.cells.data.length,t.instances?t.instances.length:1,1,()=>n)},getLoci:MDe,eachLocation:BDe,setUpdateState:(t,r,n,o)=>{},geometryUtils:Ss.Utils,mustRecreate:(t,r,n)=>!r.tryUseGpu||!n||!$q(t.volume,n),dispose:t=>{t.vertexTexture.ref.value.destroy(),t.groupTexture.ref.value.destroy(),t.normalTexture.ref.value.destroy(),t.doubleBuffer.destroy()}},e)}function jgt(e){return Be.ofUnsortedArray(e.segments)}var EDe={segment:(e,t)=>$p("Segment mesh",e,t,Lgt,Vgt,jgt)},kDe={...eY,visuals:C.MultiSelect(["segment"],C.objectToOptions(EDe)),bumpFrequency:C.Numeric(1,{min:0,max:10,step:.1},Xe.ShadingCategory)};function Wgt(e,t){let r=C.clone(kDe),n=Ge.Segmentation.get(t);if(n){let o=Array.from(n.segments.keys());r.segments=C.Converted(i=>i.map(a=>`${a}`),i=>i.map(a=>parseInt(a)),C.MultiSelect(o.map(i=>`${i}`),C.arrayToOptions(o.map(i=>`${i}`)),{isEssential:!0}))}return r}function Xgt(e,t){return Ut.createMulti("Segment",e,t,Ut.StateBuilder,EDe)}var FDe={name:"segment",label:"Segment",description:"Displays a triangulated segment of volumetric data.",factory:Xgt,getParams:Wgt,defaultValues:C.getDefaultValues(kDe),defaultColorTheme:{name:"volume-segment"},defaultSizeTheme:{name:"uniform"},isApplicable:e=>!Ge.isEmpty(e)&&!!Ge.Segmentation.get(e)};var Qgt=qe.add3,Zgt=qe.add,OT;(t=>{function e(r=2048,n=1024,o){let i=qe.create(Float32Array,3,n,o?o.centerBuffer.ref.value:r),a=qe.create(Float32Array,1,n,o?o.groupBuffer.ref.value:r);return{add:(s,l,u,c)=>{Qgt(i,s,l,u),Zgt(a,c)},getPoints:()=>{let s=qe.compact(i,!0),l=qe.compact(a,!0);return Dl.create(s,l,i.elementCount,o)}}}t.create=e})(OT||={});var VDe={isoValue:Ge.IsoValueParam,perturbPositions:C.Boolean(!1)},tY={...Hs.Params,...ft.Params,...VDe,tryUseImpostor:C.Boolean(!0),detail:C.Numeric(0,{min:0,max:3,step:1},Xe.CustomQualityParamInfo)};function qgt(e,t,r,n,o){return n.tryUseImpostor&&o&&o.extensions.fragDepth&&o.extensions.textureFloat?Ygt(e):Kgt(e)}function Ygt(e){return lm({defaultProps:C.getDefaultValues(tY),createGeometry:Jgt,createLocationIterator:Op,getLoci:oY,eachLocation:iY,setUpdateState:(t,r,n,o,i,a)=>{t.createGeometry=!Ge.IsoValue.areSame(n.isoValue,o.isoValue,r.grid.stats)||n.perturbPositions!==o.perturbPositions},geometryUtils:Hs.Utils,mustRecreate:(t,r,n)=>!r.tryUseImpostor||!n},e)}function Kgt(e){return lm({defaultProps:C.getDefaultValues(tY),createGeometry:$gt,createLocationIterator:Op,getLoci:oY,eachLocation:iY,setUpdateState:(t,r,n,o,i,a)=>{t.createGeometry=!Ge.IsoValue.areSame(n.isoValue,o.isoValue,r.grid.stats)||n.perturbPositions!==o.perturbPositions||n.sizeFactor!==o.sizeFactor||n.detail!==o.detail},geometryUtils:ft.Utils,mustRecreate:(t,r,n)=>r.tryUseImpostor&&!!n},e)}function rY(e){return{...H.extractBasis(e),maxScale:H.getMaxScaleOnAxis(e)}}var GT=b();function nY({x:e,y:t,z:r,maxScale:n}){let o=(Math.random()-.5)*n,i=(Math.random()-.5)*n,a=(Math.random()-.5)*n;return b.scale(GT,e,o),b.scaleAndAdd(GT,GT,t,i),b.scaleAndAdd(GT,GT,r,a),GT}function Jgt(e,t,r,n,o,i){let{cells:{space:a,data:s},stats:l}=t.grid,u=Nn.getGridToCartesianTransform(t.grid),c=Ge.IsoValue.toAbsolute(o.isoValue,l).absoluteValue,m=b(),[d,p,h]=a.dimensions,f=Math.ceil(d*p*h/10),g=Fg.create(f,Math.ceil(f/2),i),y=c<0,x=o.perturbPositions?rY(u):void 0;for(let I=0;I<h;++I)for(let v=0;v<p;++v)for(let A=0;A<d;++A){let P=a.get(s,A,v,I);if(!y&&P<c||y&&P>c)continue;let T=a.dataOffset(A,v,I);if(x){b.set(m,A,v,I),b.transformMat4(m,m,u);let R=nY(x);b.add(m,m,R)}else b.set(m,A,v,I),b.transformMat4(m,m,u);g.add(m[0],m[1],m[2],T)}let S=g.getSpheres();return S.setBoundingSphere(Ge.Isosurface.getBoundingSphere(t,o.isoValue)),S}function $gt(e,t,r,n,o,i){let{detail:a,sizeFactor:s}=o,{cells:{space:l,data:u},stats:c}=t.grid,m=Nn.getGridToCartesianTransform(t.grid),d=Ge.IsoValue.toAbsolute(o.isoValue,c).absoluteValue,p=b(),[h,f,g]=l.dimensions,x=Math.ceil(h*f*g/10)*Nm(a),S=tt.createState(x,Math.ceil(x/2),i),I=Ge.Cell.Location(t),v=n.size.size,A=d<0,P=o.perturbPositions?rY(m):void 0;for(let R=0;R<g;++R)for(let w=0;w<f;++w)for(let E=0;E<h;++E){let M=l.get(u,E,w,R);if(!A&&M<d||A&&M>d)continue;let D=l.dataOffset(E,w,R);I.cell=D;let B=v(I)*s;if(P){b.set(p,E,w,R),b.transformMat4(p,p,m);let k=nY(P);b.add(p,p,k)}else b.set(p,E,w,R),b.transformMat4(p,p,m);S.currentGroup=D,Zr(S,p,B,a)}let T=tt.getMesh(S);return T.setBoundingSphere(Ge.Isosurface.getBoundingSphere(t,o.isoValue)),T}var ODe={...Dl.Params,...VDe};function eyt(e){return lm({defaultProps:C.getDefaultValues(ODe),createGeometry:tyt,createLocationIterator:Op,getLoci:oY,eachLocation:iY,setUpdateState:(t,r,n,o,i,a)=>{t.createGeometry=!Ge.IsoValue.areSame(n.isoValue,o.isoValue,r.grid.stats)||n.perturbPositions!==o.perturbPositions},geometryUtils:Dl.Utils},e)}function tyt(e,t,r,n,o,i){let{cells:{space:a,data:s},stats:l}=t.grid,u=Nn.getGridToCartesianTransform(t.grid),c=Ge.IsoValue.toAbsolute(o.isoValue,l).absoluteValue,m=b(),[d,p,h]=a.dimensions,f=Math.ceil(d*p*h/10),g=OT.create(f,Math.ceil(f/2),i),y=c<0,x=o.perturbPositions?rY(u):void 0;for(let I=0;I<h;++I)for(let v=0;v<p;++v)for(let A=0;A<d;++A){let P=a.get(s,A,v,I);if(!y&&P<c||y&&P>c)continue;let T=a.dataOffset(A,v,I);if(x){b.set(m,A,v,I),b.transformMat4(m,m,u);let R=nY(x);b.add(m,m,R)}else b.set(m,A,v,I),b.transformMat4(m,m,u);g.add(m[0],m[1],m[2],T)}let S=g.getPoints();return S.setBoundingSphere(Ge.Isosurface.getBoundingSphere(t,o.isoValue)),S}function LDe(e,t){let r=ye.ofLength(e.instances.length);return Ge.Isosurface.Loci(e,t.isoValue,r)}function oY(e,t,r,n,o){let{objectId:i,groupId:a,instanceId:s}=e;if(o===i){let l=Ge.PickingGranularity.get(t),u=xe.ofSingleton(s);if(l==="volume")return Ge.Loci(t,u);if(l==="object"||a===vi.Null)return Ge.Isosurface.Loci(t,n.isoValue,u);{let c=ye.ofSingleton(a);return Ge.Cell.Loci(t,[{indices:c,instances:u}])}}return vr}function iY(e,t,r,n,o){return Bg(e,t,{isoValue:n.isoValue},o)}var GDe={sphere:(e,t)=>$p("Dot sphere",e,t,qgt,LDe),point:(e,t)=>$p("Dot point",e,t,eyt,LDe)},UDe={...tY,...ODe,visuals:C.MultiSelect(["sphere"],C.objectToOptions(GDe)),bumpFrequency:C.Numeric(1,{min:0,max:10,step:.1},Xe.ShadingCategory)};function ryt(e,t){let r=C.clone(UDe);return r.isoValue=Ge.createIsoValueParam(Ge.IsoValue.relative(2),t.grid.stats),r}function nyt(e,t){return Ut.createMulti("Dot",e,t,Ut.StateBuilder,GDe)}var NDe={name:"dot",label:"Dot",description:"Displays dots of volumetric data.",factory:nyt,getParams:ryt,defaultValues:C.getDefaultValues(UDe),defaultColorTheme:{name:"uniform"},defaultSizeTheme:{name:"uniform"},isApplicable:e=>!Ge.isEmpty(e)&&!Ge.Segmentation.get(e)};var c0=class e extends kA{constructor(){super(),wi(e.BuiltIn,(t,r)=>{if(t.name!==r)throw new Error(`Fix BuiltInVolumeRepresentations to have matching names. ${t.name} ${r}`);this.add(t)})}};(t=>t.BuiltIn={"direct-volume":DDe,dot:NDe,isosurface:IDe,segment:FDe,slice:PDe})(c0||={});function zDe(e,t,r,n){e.push({source:t==="em"?{name:"em",params:{isoValue:Ge.IsoValue.absolute(n||0)}}:{name:"x-ray",params:{}},dataId:r})}var UD=Gs.build({display:{name:"Volume Streaming"},from:ne.Molecule.Structure,params(e,t){let r=qRe(e&&e.data),n=YRe(r,e&&e.data);return{method:C.Select(r,[["em","EM"],["x-ray","X-Ray"]]),entries:C.ObjectList({id:C.Text(n[0]||"")},({id:o})=>o,{defaultValue:n.map(o=>({id:o}))}),defaultView:C.Select(r==="em"?"auto":"selection-box",ws.ViewTypeOptions),options:C.Group({serverUrl:C.Text(t.config.get(Lr.VolumeStreaming.DefaultServer)||"https://ds.litemol.org"),behaviorRef:C.Text("",{isHidden:!0}),emContourProvider:C.Select("emdb",[["emdb","EMDB"],["pdbe","PDBe"]],{isHidden:!0}),channelParams:C.Value({},{isHidden:!0})})}},isApplicable:(e,t,r)=>{let n=r.config.get(Lr.VolumeStreaming.CanStream);return n?n(e.data,r):e.data.models.length===1&&Gt.probablyHasDensityMap(e.data.models[0])}})(({ref:e,state:t,params:r},n)=>Ae.create("Volume Streaming",async o=>{let i=[];for(let m=0,d=r.entries.length;m<d;++m){let p=r.entries[m].id.toLowerCase(),h;if(r.method==="em"){if(!p.toUpperCase().startsWith("EMD")){await o.update("Getting EMDB info...");let f=await KRe(n,o,p);for(let g=0,y=f.length;g<y;++g){let x=f[g],S;try{S=await Gq(r.options.emContourProvider,n,o,x)}catch(I){console.info(`Could not get map info for ${x}: ${I}`);continue}zDe(i,r.method,x,S||0)}continue}try{h=await Gq(r.options.emContourProvider,n,o,p)}catch(f){console.info(`Could not get map info for ${p}: ${f}`);continue}}zDe(i,r.method,p,h||0)}let a=t.build().to(e).applyOrUpdateTagged(ws.RootTag,iyt,{serverUrl:r.options.serverUrl,entries:i});await a.commit();let s=a.selector;if(!s.isOk)return;let l=t.tree.children.get(s.ref);l?.size>0&&await n.managers.structure.hierarchy.remove(l?.toArray());let u=s.cell.obj,c=t.build().to(a.ref).apply(ND,C.getDefaultValues(ws.createParams({data:u.data,defaultView:r.defaultView,channelParams:r.options.channelParams})),{ref:r.options.behaviorRef?r.options.behaviorRef:void 0});r.method==="em"?c.apply(FO,{channel:"em"},{state:{isGhost:!0},tags:"em"}):(c.apply(FO,{channel:"2fo-fc"},{state:{isGhost:!0},tags:"2fo-fc"}),c.apply(FO,{channel:"fo-fc(+ve)"},{state:{isGhost:!0},tags:"fo-fc(+ve)"}),c.apply(FO,{channel:"fo-fc(-ve)"},{state:{isGhost:!0},tags:"fo-fc(-ve)"})),await t.updateTree(c).runInContext(o)})),jDe=Gs.build({display:{name:"Boxify Volume Streaming",description:"Make the current box permanent."},from:ws,isApplicable:e=>e.data.params.entry.params.view.name==="selection-box"})(({a:e,ref:t,state:r},n)=>{let o=e.data.params;if(o.entry.params.view.name!=="selection-box")return;let i=pt.create(b.clone(o.entry.params.view.params.bottomLeft),b.clone(o.entry.params.view.params.topRight)),a=o.entry.params.view.params.radius;pt.expand(i,i,b.create(a,a,a));let s={...o,entry:{name:o.entry.name,params:{...o.entry.params,view:{name:"box",params:{bottomLeft:i.min,topRight:i.max}}}}};return r.updateTree(r.build().to(t).update(s))}),oyt={dataId:C.Text(""),source:C.MappedStatic("x-ray",{em:C.Group({isoValue:Ge.createIsoValueParam(Ge.IsoValue.relative(1))}),"x-ray":C.Group({})})};var iyt=Vt.BuiltIn({name:"create-volume-streaming-info",display:{name:"Volume Streaming Info"},from:ne.Molecule.Structure,to:LT,params(e){return{serverUrl:C.Text("https://ds.litemol.org"),entries:C.ObjectList(oyt,({dataId:t})=>t,{defaultValue:[{dataId:"",source:{name:"x-ray",params:{}}}]})}}})({apply:({a:e,params:t},r)=>Ae.create("",async n=>{let o=[];for(let a=0,s=t.entries.length;a<s;++a){let l=t.entries[a],u=l.dataId,c=l.source.name==="em"?l.source.params.isoValue:Ge.IsoValue.relative(1);await n.update("Getting server header...");let m=await r.fetch({url:NC(t.serverUrl,`${l.source.name}/${u.toLocaleLowerCase()}`),type:"json"}).runInContext(n);o.push({dataId:u,kind:l.source.name,header:m,emDefaultContourLevel:c})}let i={serverUrl:t.serverUrl,entries:o,structure:e.data};return new LT(i,{label:"Volume Server",description:`${o.map(a=>a.dataId).join(", ")}`})})});var ND=Vt.BuiltIn({name:"create-volume-streaming-behavior",display:{name:"Volume Streaming Behavior"},from:LT,to:ws,params(e){return ws.createParams({data:e&&e.data})}})({canAutoUpdate:({oldParams:e,newParams:t})=>e.entry.params.view===t.entry.params.view||t.entry.params.view.name==="selection-box"||t.entry.params.view.name==="camera-target"||t.entry.params.view.name==="off",apply:({a:e,params:t},r)=>Ae.create("Volume streaming",async n=>{let o=new ws.Behavior(r,e.data);return await o.update(t),new ws(o,{label:"Volume Streaming",description:o.getDescription()})}),update({a:e,b:t,oldParams:r,newParams:n}){return Ae.create("Update Volume Streaming",async o=>{if(r.entry.name!==n.entry.name&&"em"in n.entry.params.channels){let{emDefaultContourLevel:a}=t.data.infoMap.get(n.entry.name);a&&(n.entry.params.channels.em.isoValue=a)}let i=await t.data.update(n)?et.UpdateResult.Updated:et.UpdateResult.Unchanged;return t.description=t.data.getDescription(),i})}});var FO=Vt.BuiltIn({name:"create-volume-streaming-visual",display:{name:"Volume Streaming Visual"},from:ws,to:ne.Volume.Representation3D,params:{channel:C.Select("em",ws.ChannelTypeOptions,{isHidden:!0})}})({apply:({a:e,params:t,spine:r},n)=>Ae.create("Volume Representation",async o=>{let i=e.data.channels[t.channel];if(!i)return Gn.Null;let a=HDe(e.data,t.channel),s=c0.BuiltIn.isosurface,l=a.type.params||{},u=s.factory({webgl:n.canvas3d?.webgl,...n.representation.volume.themes},s.getParams);u.setTheme(Ii.create(n.representation.volume.themes,{volume:i.data},a));let c=r.getAncestorOfType(ne.Molecule.Structure)?.data,m=c?.models.length===0?void 0:tb.get(c?.models[0]);return await u.createOrUpdate(l,i.data).runInContext(o),m&&u.setState({transform:m}),new ne.Volume.Representation3D({repr:u,sourceData:i.data},{label:`${Math.round(i.isoValue.relativeValue*100)/100} \u03C3 [${t.channel}]`})}),update:({a:e,b:t,newParams:r,spine:n},o)=>Ae.create("Volume Representation",async i=>{let a=e.data.channels[r.channel];if(!a)return et.UpdateResult.Unchanged;let s=t.data.repr.state.visible,l=HDe(e.data,r.channel),u={...t.data.repr.props,...l.type.params};return t.data.repr.setTheme(Ii.create(o.representation.volume.themes,{volume:a.data},l)),await t.data.repr.createOrUpdate(u,a.data).runInContext(i),t.data.repr.setState({visible:s}),t.data.sourceData=a.data,et.UpdateResult.Updated})});function HDe(e,t){let r=e.channels[t];return nh.getDefaultParamsStatic(e.plugin,"isosurface",{isoValue:r.isoValue,alpha:r.opacity,visuals:r.wireframe?["wireframe"]:["solid"]},"uniform",{value:r.color})}var m0=class extends ET{constructor(){super(...arguments);this._getInfo=es((r,n,o)=>Ch.infoFromAction(this.plugin,this.props.state,this.props.action,this.props.nodeRef));this.state={plugin:this.plugin,ref:this.props.nodeRef,version:this.props.state.transforms.get(this.props.nodeRef).version,error:void 0,isInitial:!0,params:this.getInfo().initialValues,busy:!1,isCollapsed:this.props.initiallyCollapsed}}applyAction(){return lt.State.ApplyAction(this.plugin,{state:this.props.state,action:this.props.action.create(this.state.params),ref:this.props.nodeRef})}getInfo(){return this._getInfo(this.props.nodeRef,this.props.state.transforms.get(this.props.nodeRef).version,this.state?.isCollapsed)}getTransformerId(){return this.props.state.transforms.get(this.props.nodeRef).transformer.id}getHeader(){return this.props.hideHeader?"none":this.props.action.definition.display}canApply(){return!this.state.error&&!this.state.busy}canAutoApply(){return!1}applyText(){return"Apply"}isUpdate(){return!1}getSourceAndTarget(){return{a:this.props.state.cells.get(this.props.nodeRef).obj}}static getDerivedStateFromProps(r,n){let o=r.state.transforms.get(r.nodeRef).version;if(r.nodeRef===n.ref&&o===n.version)return null;let i=r.state.cells.get(r.nodeRef).obj,a=r.action.definition.params?C.getDefaultValues(r.action.definition.params(i,n.plugin)):{};return{plugin:n.plugin,ref:r.nodeRef,version:o,params:a,isInitial:!0,error:void 0}}};var no=_t(ur()),LO=class extends kc{defaultState(){return{header:"Volume Streaming",isCollapsed:!1,isBusy:!1,isHidden:!0,brand:{accent:"cyan",svg:z5}}}componentDidMount(){this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,()=>{this.setState({isHidden:!this.canEnable(),description:$g.getSelectedStructuresDescription(this.plugin)})}),this.subscribe(this.plugin.state.events.cell.stateUpdated,t=>{Br.hasTag(t.cell.transform,ws.RootTag)&&this.forceUpdate()}),this.subscribe(this.plugin.behaviors.state.isBusy,t=>{this.setState({isBusy:t})})}get pivot(){return this.plugin.managers.structure.hierarchy.selection.structures[0]}canEnable(){let{selection:t}=this.plugin.managers.structure.hierarchy;if(t.structures.length!==1)return!1;let r=this.pivot.cell;return r.obj?!!UD.definition.isApplicable?.(r.obj,r.transform,this.plugin):!1}renderEnable(){let t=this.pivot;if(!t.cell.parent)return null;let r=tr.findTagInSubtree(t.cell.parent.tree,this.pivot.cell.transform.ref,ws.RootTag),n=r&&t.cell.parent.cells.get(r),o=n&&n.status==="error"?{header:n.errorText&&n.errorText?.includes("404")?"No Density Data Available":"Error Enabling",icon:j5,title:n.errorText}:n&&n.obj?.data.entries.length===0?{header:"Error Enabling",icon:j5,title:"No Entry for Streaming Found"}:{header:"Enable",icon:cd,title:"Enable"};return(0,no.jsx)(m0,{state:t.cell.parent,action:UD,initiallyCollapsed:!0,nodeRef:t.cell.transform.ref,simpleApply:o})}renderParams(){let t=this.pivot;if(!t.cell.parent)return null;let r=t.volumeStreaming?.cell.transform.params?.entry.params.view.name==="selection-box"&&this.plugin.state.behaviors.cells.get(p1.id)?.params?.values?.bindings;return(0,no.jsxs)(no.Fragment,{children:[(0,no.jsx)(vc,{state:t.cell.parent,transform:t.volumeStreaming.cell.transform,customHeader:"none",noMargin:!0}),r&&(0,no.jsx)(fs,{header:"Controls Help",children:(0,no.jsx)(kT,{bindings:r})})]})}renderControls(){let t=this.pivot;return t?t.volumeStreaming?this.renderParams():this.renderEnable():null}},VO=class extends kc{constructor(){super(...arguments);this.item=r=>{let n=this.plugin.managers.volume.hierarchy.selection,o=r.cell.obj?.label||"Volume";return{kind:"item",label:(r.kind==="lazy-volume"?"Load ":"")+(o||r.kind),selected:n===r,value:r}};this.selectCurrent=r=>{if(this.toggleHierarchy(),!r)return;let n=r.value;n.kind==="volume"?this.plugin.managers.volume.hierarchy.setCurrent(n):this.lazyLoad(n.cell)};this.selectAdd=r=>{r&&(this.setState({show:void 0}),r.value())};this.toggleHierarchy=()=>this.setState({show:this.state.show!=="hierarchy"?"hierarchy":void 0});this.toggleAddRepr=()=>this.setState({show:this.state.show!=="add-repr"?"add-repr":void 0});this.toggleVisibility=()=>{let r=this.plugin.managers.volume.hierarchy,{current:n}=r,o=!n.volumes[0]?.representations[0]?.cell.state.isHidden;this.plugin.managers.volume.hierarchy.toggleVisibility(n.volumes.flatMap(i=>i.representations),o?"hide":"show")}}defaultState(){return{header:"Volume",isCollapsed:!1,isBusy:!1,isHidden:!0,brand:{accent:"purple",svg:z5}}}componentDidMount(){this.subscribe(this.plugin.managers.volume.hierarchy.behaviors.selection,r=>{this.setState({isHidden:r.hierarchy.volumes.length===0&&r.hierarchy.lazyVolumes.length===0})}),this.subscribe(this.plugin.behaviors.state.isBusy,r=>{this.setState({isBusy:r})})}get hierarchyItems(){let r=this.plugin.managers.volume.hierarchy,{current:n}=r,o=[];for(let i of n.volumes)o.push(this.item(i));for(let i of n.lazyVolumes)o.push(this.item(i));return o}get addActions(){let r=this.plugin.managers.volume.hierarchy,n=r.selection;return[...i0.getRepresentationTypes(this.plugin,n).map(i=>Rr.Item(i[1],()=>r.addRepresentation(n,i[0])))]}get isEmpty(){let{volumes:r,lazyVolumes:n}=this.plugin.managers.volume.hierarchy.current;return r.length===0&&n.length===0}get label(){if(this.state.loadingLabel)return`Loading ${this.state.loadingLabel}...`;let r=this.plugin.managers.volume.hierarchy.selection;return r?r?.cell.obj?.label||"Volume":"Nothing Selected"}async lazyLoad(r){let{url:n,isBinary:o,format:i,entryId:a,isovalues:s}=r.obj.data;this.setState({isBusy:!0,loadingLabel:r.obj.label});try{let l=this.plugin;await l.dataTransaction(async()=>{let u=await l.builders.data.download({url:n,isBinary:o},{state:{isGhost:!0}}),c=await l.dataFormats.get(i).parse(l,u,{entryId:a}),m=c.volume||c.volumes[0];if(!m?.isOk)throw new Error("Failed to parse any volume.");let d=l.build();for(let p of s)d.to(c.volumes?.[p.volumeIndex??0]??c.volume).apply(Qe.Representation.VolumeRepresentation3D,Gb(this.plugin,m.data,{type:"isosurface",typeParams:{alpha:p.alpha??1,isoValue:p.type==="absolute"?{kind:"absolute",absoluteValue:p.value}:{kind:"relative",relativeValue:p.value}},color:"uniform",colorParams:{value:p.color}}));await d.commit(),await l.build().delete(r).commit()})}finally{this.setState({isBusy:!1,loadingLabel:void 0})}}renderControls(){let r=this.state.isBusy||this.isEmpty,n=this.label,o=this.plugin.managers.volume.hierarchy.selection,i=this.plugin.managers.volume.hierarchy,{current:a}=i;return(0,no.jsxs)(no.Fragment,{children:[(0,no.jsxs)("div",{className:"msp-flex-row",style:{marginTop:"1px"},children:[(0,no.jsx)(gr,{noOverflow:!0,flex:!0,onClick:this.toggleHierarchy,disabled:r,title:n,children:n}),!this.isEmpty&&o&&(0,no.jsx)(sr,{svg:Bf,onClick:this.toggleAddRepr,title:"Apply a structure presets to the current hierarchy.",toggleState:this.state.show==="add-repr",disabled:r}),!this.isEmpty&&(0,no.jsx)(sr,{svg:vm,onClick:this.toggleVisibility,toggleState:!1,title:"Toggle visibility of all volumes.",disabled:r})]}),this.state.show==="hierarchy"&&(0,no.jsx)(Rr,{items:this.hierarchyItems,onSelect:this.selectCurrent}),this.state.show==="add-repr"&&(0,no.jsx)(Rr,{items:this.addActions,onSelect:this.selectAdd}),a.volumes.length>0&&(0,no.jsx)("div",{style:{marginTop:"6px"},children:a.volumes.map(s=>(0,no.jsx)(ayt,{volume:s},s.cell.transform.ref))})]})}};function ayt({volume:e}){return(0,no.jsxs)(no.Fragment,{children:[(0,no.jsx)("div",{className:"msp-control-group-header",style:{marginTop:"1px"},children:(0,no.jsx)("div",{children:(0,no.jsx)("b",{children:e.cell.obj?.label??"n/a"})})}),e.representations.map(t=>(0,no.jsx)(aY,{volume:e,representation:t},t.cell.transform.ref))]})}var aY=class extends bi{constructor(){super(...arguments);this.state={action:void 0};this.updateIsoValueEvent=new Pn;this.remove=()=>this.plugin.managers.volume.hierarchy.remove([this.props.representation],!0);this.toggleVisible=r=>{r.preventDefault(),r.currentTarget.blur(),this.plugin.managers.volume.hierarchy.toggleVisibility([this.props.representation])};this.toggleColor=()=>{this.setState({action:this.state.action==="select-color"?void 0:"select-color"})};this.toggleUpdate=()=>this.setState({action:this.state.action==="update"?void 0:"update"});this.highlight=r=>{r.preventDefault(),this.props.representation.cell.parent&&lt.Interactivity.Object.Highlight(this.plugin,{state:this.props.representation.cell.parent,ref:this.props.representation.cell.transform.ref})};this.clearHighlight=r=>{r.preventDefault(),lt.Interactivity.ClearHighlights(this.plugin)};this.focus=()=>{let r=this.props.representation,n=r.cell.obj?.data.repr.getAllLoci();r.cell.state.isHidden&&this.plugin.managers.volume.hierarchy.toggleVisibility([this.props.representation],"show"),n&&this.plugin.managers.camera.focusLoci(n,{extraRadius:1})};this.updateColor=({value:r})=>{let n=this.props.representation.cell.transform;return this.plugin.build().to(n.ref).update({...n.params,colorTheme:{name:"uniform",params:{value:r}}}).commit()};this.requestIsoValueUpdate=r=>{this.updateIsoValueEvent.next(r)};this.updateIsoValue=r=>{let n=this.props.representation.cell.transform;return this.plugin.build().to(n.ref).update({...n.params,type:{...n.params?.type,params:{...n.params?.type.params,isoValue:r.isoValue}}}).commit()};this.isoValueParams=es((r,n)=>{let i=this.props.representation.cell.transform.params;if(i?.type.name==="isosurface")return{isoValue:Ge.createIsoValueParam(i.type.params.isoValue,this.props.volume.cell.obj?.data.grid?.stats)}})}componentDidMount(){this.subscribe(this.plugin.state.events.cell.stateUpdated,r=>{Rm.ObjectEvent.isCell(r,this.props.representation.cell)&&this.forceUpdate()}),this.subscribe(this.updateIsoValueEvent.pipe(Xu(100,void 0,{leading:!1,trailing:!0})),this.updateIsoValue)}get color(){let r=this.props.representation.cell;if(r.transform.params?.colorTheme.name==="uniform")return r.transform.params?.colorTheme.params.value}get isIsoSurface(){return this.props.representation.cell.transform.params?.type.name==="isosurface"}render(){let r=this.props.representation.cell,n=r.transform.params,o=this.color,i=this.isoValueParams(r.transform.ref,n?.type.name);return(0,no.jsxs)(no.Fragment,{children:[(0,no.jsxs)("div",{className:"msp-flex-row",children:[o!==void 0&&(0,no.jsx)(gr,{style:{backgroundColor:Le.toStyle(o),minWidth:32,width:32},onClick:this.toggleColor}),(0,no.jsxs)(gr,{noOverflow:!0,className:"msp-control-button-label",title:`${r.obj?.label}. Click to focus.`,onClick:this.focus,onMouseEnter:this.highlight,onMouseLeave:this.clearHighlight,style:{textAlign:"left"},children:[r.obj?.label,(0,no.jsx)("small",{className:"msp-25-lower-contrast-text",style:{float:"right"},children:r.obj?.description})]}),(0,no.jsx)(sr,{svg:r.state.isHidden?md:vm,toggleState:!1,onClick:this.toggleVisible,title:`${r.state.isHidden?"Show":"Hide"} component`,small:!0,className:"msp-form-control",flex:!0}),(0,no.jsx)(sr,{svg:$s,onClick:this.remove,title:"Remove",small:!0}),(0,no.jsx)(sr,{svg:Dx,onClick:this.toggleUpdate,title:"Actions",toggleState:this.state.action==="update"})]}),this.state.action==="update"&&!!r.parent&&(0,no.jsx)("div",{style:{marginBottom:"6px"},className:"msp-accent-offset",children:(0,no.jsxs)("div",{children:[!!i&&(0,no.jsx)("div",{style:{marginBottom:"1px"},children:(0,no.jsx)(uo,{params:i,values:{isoValue:n?.type.params.isoValue},onChangeValues:this.requestIsoValueUpdate})}),(0,no.jsx)(vc,{state:r.parent,transform:r.transform,customHeader:"none",noMargin:!0})]})}),this.state.action==="select-color"&&o!==void 0&&(0,no.jsx)("div",{style:{marginBottom:"6px",marginTop:1},className:"msp-accent-offset",children:(0,no.jsx)(zl,{header:"Select Color",initialExpanded:!0,hideExpander:!0,hideOffset:!0,onHeaderClick:this.toggleColor,topRightIcon:Bc,noTopMargin:!0,childrenClassName:"msp-viewport-controls-panel-controls",children:(0,no.jsx)(wT,{param:syt,value:this.color,onChange:this.updateColor,name:"color",hideNameRow:!0})})})]})}},syt=C.Color(1184274);var OO;(r=>{function e(n){return{size:n,matrix:zn.create(n,n),eigenValues:new Float64Array(n),D:new Float64Array(n),E:new Float64Array(n)}}r.createCache=e;function t(n){lyt(n.size,n.matrix.data,n.eigenValues,n.D,n.E)}r.compute=t})(OO||={});function lyt(e,t,r,n,o){for(let a=0;a<e;a++)o[a]=0;let i=e-1;for(let a=0;a<e;a++)n[a]=t[a*e+i];uyt(t,n,o,e),cyt(t,n,o,e);for(let a=0;a<e;a++)r[a]=n[a]}function uyt(e,t,r,n){for(let o=n-1;o>0;o--){let i=0,a=0;for(let s=0;s<o;s++)i=i+Math.abs(t[s]);if(i===0){r[o]=t[o-1];for(let s=0;s<o;s++)t[s]=e[s*n+o-1],e[s*n+o]=0,e[o*n+s]=0}else{for(let c=0;c<o;c++)t[c]/=i,a+=t[c]*t[c];let s=t[o-1],l=Math.sqrt(a);s>0&&(l=-l),r[o]=i*l,a=a-s*l,t[o-1]=s-l;for(let c=0;c<o;c++)r[c]=0;for(let c=0;c<o;c++){s=t[c],e[o*n+c]=s,l=r[c]+e[c*n+c]*s;for(let m=c+1;m<=o-1;m++)l+=e[c*n+m]*t[m],r[m]+=e[c*n+m]*s;r[c]=l}s=0;for(let c=0;c<o;c++)r[c]/=a,s+=r[c]*t[c];let u=s/(a+a);for(let c=0;c<o;c++)r[c]-=u*t[c];for(let c=0;c<o;c++){s=t[c],l=r[c];for(let m=c;m<=o-1;m++)e[c*n+m]-=s*r[m]+l*t[m];t[c]=e[c*n+o-1],e[c*n+o]=0}}t[o]=a}for(let o=0;o<n-1;o++){e[o*n+n-1]=e[o*n+o],e[o*n+o]=1;let i=t[o+1];if(i!==0){for(let a=0;a<=o;a++)t[a]=e[(o+1)*n+a]/i;for(let a=0;a<=o;a++){let s=0;for(let l=0;l<=o;l++)s+=e[(o+1)*n+l]*e[a*n+l];for(let l=0;l<=o;l++)e[a*n+l]-=s*t[l]}}for(let a=0;a<=o;a++)e[(o+1)*n+a]=0}for(let o=0;o<n;o++)t[o]=e[o*n+n-1],e[o*n+n-1]=0;e[n*n-1]=1,r[0]=0}function cyt(e,t,r,n){for(let l=1;l<n;l++)r[l-1]=r[l];r[n-1]=0;let i=0,a=0,s=Math.pow(2,-53);for(let l=0;l<n;l++){a=Math.max(a,Math.abs(t[l])+Math.abs(r[l]));let u=l;for(;u<n&&!(Math.abs(r[u])<=s*a);)u++;if(u>l){let c=0;do{c=c+1;let m=t[l],d=(t[l+1]-m)/(2*r[l]),p=WDe(d,1);d<0&&(p=-p),t[l]=r[l]/(d+p),t[l+1]=r[l]*(d+p);let h=t[l+1],f=m-t[l];for(let A=l+2;A<n;A++)t[A]-=f;i=i+f,d=t[u];let g=1,y=g,x=g,S=r[l+1],I=0,v=0;for(let A=u-1;A>=l;A--){x=y,y=g,v=I,m=g*r[A],f=g*d,p=WDe(d,r[A]),r[A+1]=I*p,I=r[A]/p,g=d/p,d=g*t[A]-I*m,t[A+1]=f+I*(g*m+I*t[A]);for(let P=0;P<n;P++)f=e[(A+1)*n+P],e[(A+1)*n+P]=I*e[A*n+P]+g*f,e[A*n+P]=g*e[A*n+P]-I*f}if(d=-I*v*x*S*r[l]/h,r[l]=I*d,t[l]=g*d,c>=1e3)throw new Error("SVD: Not converging.")}while(Math.abs(r[l])>s*a)}t[l]=t[l]+i,r[l]=0}for(let l=0;l<n-1;l++){let u=l,c=t[l];for(let m=l+1;m<n;m++)t[m]<c&&(u=m,c=t[m]);if(u!==l){t[u]=t[l],t[l]=c;for(let m=0;m<n;m++)c=e[l*n+m],e[l*n+m]=e[u*n+m],e[u*n+m]=c}}}function WDe(e,t){if(Math.abs(e)>Math.abs(t)){let r=t/e;return Math.abs(e)*Math.sqrt(1+r*r)}if(t!==0){let r=e/t;return Math.abs(t)*Math.sqrt(1+r*r)}return 0}var um;(r=>{let e;(o=>{function n(i){return{x:new Float64Array(i),y:new Float64Array(i),z:new Float64Array(i)}}o.empty=n})(e=r.Positions||={});function t(n,o){return o??={bTransform:H.zero(),rmsd:0,nAlignedElements:0},pyt(new sY(n,o)),o}r.compute=t})(um||={});var sY=class{constructor(t,r){this.evdCache=OO.createCache(4);this.translateB=H.identity();this.rotateB=H.identity();this.tempMatrix=H.identity();this.a=t.a,this.b=t.b,t.centerA?this.centerA=t.centerA:this.centerA=t.centerA=ku.fromArrays(t.a,he()).center,t.centerB?this.centerB=t.centerB:this.centerB=t.centerB=ku.fromArrays(t.b,he()).center,this.result=r}};function myt(e){let t=e.evdCache.matrix;zn.makeZero(t);let r=e.a.x,n=e.a.y,o=e.a.z,i=e.b.x,a=e.b.y,s=e.b.z,l=e.centerA,u=e.centerB,c=0,m=Math.min(e.a.x.length,e.b.x.length);for(let d=0;d<m;d++){let p=r[d]-l[0],h=n[d]-l[1],f=o[d]-l[2],g=i[d]-u[0],y=a[d]-u[1],x=s[d]-u[2];c+=p*p+h*h+f*f+g*g+y*y+x*x,zn.add(t,0,0,p*g+h*y+f*x),zn.add(t,0,1,-(f*y)+h*x),zn.add(t,0,2,f*g-p*x),zn.add(t,0,3,-(h*g)+p*y),zn.add(t,1,0,-(f*y)+h*x),zn.add(t,1,1,p*g-h*y-f*x),zn.add(t,1,2,h*g+p*y),zn.add(t,1,3,f*g+p*x),zn.add(t,2,0,f*g-p*x),zn.add(t,2,1,h*g+p*y),zn.add(t,2,2,-(p*g)+h*y-f*x),zn.add(t,2,3,f*y+h*x),zn.add(t,3,0,-(h*g)+p*y),zn.add(t,3,1,f*g+p*x),zn.add(t,3,2,f*y+h*x),zn.add(t,3,3,-(p*g)-h*y+f*x)}return c}function dyt(e){let t=e.evdCache.matrix,r=zn.get(t,1,3),n=zn.get(t,2,3),o=zn.get(t,3,3),i=zn.get(t,0,3),a=2*n*n,s=2*o*o,l=2*r*r,u=2*r*n,c=2*i*o,m=2*r*o,d=2*i*n,p=2*n*o,h=2*i*r,f=e.translateB;H.setValue(f,0,3,-e.centerB[0]),H.setValue(f,1,3,-e.centerB[1]),H.setValue(f,2,3,-e.centerB[2]),f=e.rotateB,H.setValue(f,0,0,1-a-s),H.setValue(f,0,1,u+c),H.setValue(f,0,2,m-d),H.setValue(f,1,0,u-c),H.setValue(f,1,1,1-l-s),H.setValue(f,1,2,p+h),H.setValue(f,2,0,m+d),H.setValue(f,2,1,p-h),H.setValue(f,2,2,1-l-a),H.setValue(f,3,3,1),H.mul(e.tempMatrix,e.rotateB,e.translateB),f=e.translateB,H.setValue(f,0,3,e.centerA[0]),H.setValue(f,1,3,e.centerA[1]),H.setValue(f,2,3,e.centerA[2]),H.mul(e.result.bTransform,e.translateB,e.tempMatrix)}function pyt(e){let t=myt(e);OO.compute(e.evdCache);let r=t-2*e.evdCache.eigenValues[3];r=r<0?0:Math.sqrt(r/e.a.x.length),dyt(e),e.result.rmsd=r,e.result.nAlignedElements=e.a.x.length}var fyt="ACDEFGHIKLMNPQRSTVWY",hyt="ARNDCQEGHILKMFPSTWYVBZX",gyt=[[4,0,-2,-1,-2,0,-2,-1,-1,-1,-1,-2,-1,-1,-1,1,0,0,-3,-2],[0,9,-3,-4,-2,-3,-3,-1,-3,-1,-1,-3,-3,-3,-3,-1,-1,-1,-2,-2],[-2,-3,6,2,-3,-1,-1,-3,-1,-4,-3,1,-1,0,-2,0,-1,-3,-4,-3],[-1,-4,2,5,-3,-2,0,-3,1,-3,-2,0,-1,2,0,0,-1,-2,-3,-2],[-2,-2,-3,-3,6,-3,-1,0,-3,0,0,-3,-4,-3,-3,-2,-2,-1,1,3],[0,-3,-1,-2,-3,6,-2,-4,-2,-4,-3,0,-2,-2,-2,0,-2,-3,-2,-3],[-2,-3,-1,0,-1,-2,8,-3,-1,-3,-2,1,-2,0,0,-1,-2,-3,-2,2],[-1,-1,-3,-3,0,-4,-3,4,-3,2,1,-3,-3,-3,-3,-2,-1,3,-3,-1],[-1,-3,-1,1,-3,-2,-1,-3,5,-2,-1,0,-1,1,2,0,-1,-2,-3,-2],[-1,-1,-4,-3,0,-4,-3,2,-2,4,2,-3,-3,-2,-2,-2,-1,1,-2,-1],[-1,-1,-3,-2,0,-3,-2,1,-1,2,5,-2,-2,0,-1,-1,-1,1,-1,-1],[-2,-3,1,0,-3,0,1,-3,0,-3,-2,6,-2,0,0,1,0,-3,-4,-2],[-1,-3,-1,-1,-4,-2,-2,-3,-1,-3,-2,-2,7,-1,-2,-1,-1,-2,-4,-3],[-1,-3,0,2,-3,-2,0,-3,1,-2,0,0,-1,5,1,0,-1,-2,-2,-1],[-1,-3,-2,0,-3,-2,0,-3,2,-2,-1,0,-2,1,5,-1,-1,-3,-3,-2],[1,-1,0,0,-2,0,-1,-2,0,-2,-1,1,-1,0,-1,4,1,-2,-3,-2],[0,-1,-1,-1,-2,-2,-2,-1,-1,-1,-1,0,-1,-1,-1,1,5,0,-2,-2],[0,-1,-3,-2,-1,-3,-3,3,-2,1,1,-3,-2,-2,-3,-2,0,4,-3,-1],[-3,-2,-4,-3,1,-2,-2,-3,-3,-2,-1,-4,-4,-2,-3,-3,-2,-3,11,2],[-2,-2,-3,-2,3,-3,2,-1,-2,-1,-1,-2,-3,-1,-2,-2,-2,-1,2,7]],yyt=[[4,-1,-2,-2,0,-1,-1,0,-2,-1,-1,-1,-1,-2,-1,1,0,-3,-2,0,-2,-1,0],[-1,5,0,-2,-3,1,0,-2,0,-3,-2,2,-1,-3,-2,-1,-1,-3,-2,-3,-1,0,-1],[-2,0,6,1,-3,0,0,0,1,-3,-3,0,-2,-3,-2,1,0,-4,-2,-3,3,0,-1],[-2,-2,1,6,-3,0,2,-1,-1,-3,-4,-1,-3,-3,-1,0,-1,-4,-3,-3,4,1,-1],[0,-3,-3,-3,9,-3,-4,-3,-3,-1,-1,-3,-1,-2,-3,-1,-1,-2,-2,-1,-3,-3,-2],[-1,1,0,0,-3,5,2,-2,0,-3,-2,1,0,-3,-1,0,-1,-2,-1,-2,0,3,-1],[-1,0,0,2,-4,2,5,-2,0,-3,-3,1,-2,-3,-1,0,-1,-3,-2,-2,1,4,-1],[0,-2,0,-1,-3,-2,-2,6,-2,-4,-4,-2,-3,-3,-2,0,-2,-2,-3,-3,-1,-2,-1],[-2,0,1,-1,-3,0,0,-2,8,-3,-3,-1,-2,-1,-2,-1,-2,-2,2,-3,0,0,-1],[-1,-3,-3,-3,-1,-3,-3,-4,-3,4,2,-3,1,0,-3,-2,-1,-3,-1,3,-3,-3,-1],[-1,-2,-3,-4,-1,-2,-3,-4,-3,2,4,-2,2,0,-3,-2,-1,-2,-1,1,-4,-3,-1],[-1,2,0,-1,-3,1,1,-2,-1,-3,-2,5,-1,-3,-1,0,-1,-3,-2,-2,0,1,-1],[-1,-1,-2,-3,-1,0,-2,-3,-2,1,2,-1,5,0,-2,-1,-1,-1,-1,1,-3,-1,-1],[-2,-3,-3,-3,-2,-3,-3,-3,-1,0,0,-3,0,6,-4,-2,-2,1,3,-1,-3,-3,-1],[-1,-2,-2,-1,-3,-1,-1,-2,-2,-3,-3,-1,-2,-4,7,-1,-1,-4,-3,-2,-2,-1,-2],[1,-1,1,0,-1,0,0,0,-1,-2,-2,0,-1,-2,-1,4,1,-3,-2,-2,0,0,0],[0,-1,0,-1,-1,-1,-1,-2,-2,-1,-1,-1,-1,-2,-1,1,5,-2,-2,0,-1,-1,0],[-3,-3,-4,-4,-2,-2,-3,-2,-2,-3,-2,-3,-1,1,-4,-3,-2,11,2,-3,-4,-3,-2],[-2,-2,-2,-3,-2,-1,-2,-3,2,-1,-1,-2,-1,3,-3,-2,-2,2,7,-1,-3,-2,-1],[0,-3,-3,-3,-1,-2,-2,-3,-3,3,1,-2,1,-1,-2,-2,0,-3,-1,4,-3,-2,-1],[-2,-1,3,4,-3,0,1,-1,0,-3,-4,0,-3,-3,-2,0,-1,-4,-3,-3,4,1,-1],[-1,0,0,1,-3,3,4,-2,0,-3,-3,1,-1,-3,-1,0,-1,-3,-2,-2,1,4,-1],[0,-1,-1,-1,-2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-2,0,0,-2,-1,-1,-1,-1,-1]];function XDe(e,t){let r,n=0,o={};return t.forEach(i=>{r=0;let a={};i.forEach(s=>a[e[r++]]=s),o[e[n++]]=a}),o}var QDe={blosum62:XDe(hyt,yyt),blosum62x:XDe(fyt,gyt)};var byt={gapPenalty:-11,gapExtensionPenalty:-1,substMatrix:"default"};function ZDe(e,t,r={}){let n={...byt,...r},o=new lY(e,t,n);return o.calculate(),o.trace()}var lY=class{constructor(t,r,n){this.seqA=t;this.seqB=r;this.S=[];this.V=[];this.H=[];this.gapPenalty=n.gapPenalty,this.gapExtensionPenalty=n.gapExtensionPenalty,this.substMatrix=n.substMatrix==="default"?void 0:QDe[n.substMatrix],this.n=this.seqA.length,this.m=this.seqB.length}initMatrices(){let{n:t,m:r,gapPenalty:n,S:o,V:i,H:a}=this;for(let s=0;s<=t;++s){o[s]=[],i[s]=[],a[s]=[];for(let l=0;l<=r;++l)o[s][l]=0,i[s][l]=0,a[s][l]=0}for(let s=0;s<=t;++s)o[s][0]=n,a[s][0]=-1/0;for(let s=0;s<=r;++s)o[0][s]=n,i[0][s]=-1/0;o[0][0]=0}makeScoreFn(){let{seqA:t,seqB:r,substMatrix:n}=this;return n?function(i,a){let s=t[i],l=r[a];return n[s]?.[l]??-4}:function(i,a){let s=t[i],l=r[a];return s===l?5:-3}}calculate(){this.initMatrices();let t=this.makeScoreFn(),{V:r,H:n,S:o,n:i,m:a,gapExtensionPenalty:s,gapPenalty:l}=this,u,c,m,d,p;for(let h=1;h<=i;++h){c=o[h-1],u=r[h-1],m=r[h],d=n[h],p=o[h];for(let f=1;f<=a;++f)m[f]=Math.max(c[f]+l,u[f]+s),d[f]=Math.max(p[f-1]+l,d[f-1]+s),p[f]=Math.max(c[f-1]+t(h-1,f-1),m[f],d[f])}}trace(){let t=this.makeScoreFn(),{V:r,H:n,S:o,seqA:i,seqB:a,gapExtensionPenalty:s,gapPenalty:l}=this,u=this.n,c=this.m,m,d,p="",h="";for(o[u][c]>=r[u][c]?(m="S",d=o[u][c]):r[u][c]>=n[u][c]?(m="V",d=r[u][c]):(m="H",d=n[u][c]);u>0&&c>0;)m==="S"?o[u][c]===o[u-1][c-1]+t(u-1,c-1)?(p=i[u-1]+p,h=a[c-1]+h,--u,--c,m="S"):o[u][c]===r[u][c]?m="V":o[u][c]===n[u][c]?m="H":(--u,--c):m==="V"?r[u][c]===r[u-1][c]+s?(p=i[u-1]+p,h="-"+h,--u,m="V"):r[u][c]===o[u-1][c]+l?(p=i[u-1]+p,h="-"+h,--u,m="S"):--u:m==="H"&&(n[u][c]===n[u][c-1]+s?(p="-"+p,h=a[c-1]+h,--c,m="H"):n[u][c]===o[u][c-1]+l?(p="-"+p,h=a[c-1]+h,--c,m="S"):--c);for(;u>0;)p=i[u-1]+p,h="-"+h,--u;for(;c>0;)p="-"+p,h=a[c-1]+h,--c;return{aliA:p,aliB:h,score:d}}};var uY;(r=>{function e(n){let o=new Map;if(ue.isAtomic(n.unit)){let{label_seq_id:i}=n.unit.model.atomicHierarchy.residues,{residueIndex:a}=n.unit;for(let s=0,l=xe.size(n.indices);s<l;++s){let u=xe.getAt(n.indices,s),c=n.unit.elements[u],m=i.value(a[c]);o.has(m)?o.get(m).push(u):o.set(m,[u])}}else if(ue.isCoarse(n.unit)){let{seq_id_begin:i}=ue.isSpheres(n.unit)?n.unit.model.coarseHierarchy.spheres:n.unit.model.coarseHierarchy.gaussians;for(let a=0,s=xe.size(n.indices);a<s;++a){let l=xe.getAt(n.indices,a),u=n.unit.elements[l],c=i.value(u);o.set(c,[l])}}return o}r.createSeqIdIndicesMap=e;function t(n,o={}){let i=qDe(n.a.unit),a=qDe(n.b.unit),s=e(n.a),l=e(n.b),u=[],c=[],{aliA:m,aliB:d,score:p}=ZDe(i.code.toArray(),a.code.toArray(),o),h=0,f=0;for(let x=0,S=m.length;x<S;++x){if(m[x]==="-"||d[x]==="-"){m[x]!=="-"&&(h+=1),d[x]!=="-"&&(f+=1);continue}let I=i.seqId.value(h),v=a.seqId.value(f);if(s.has(I)&&l.has(v)){let A=s.get(I),P=l.get(v);for(let T=0,R=Math.min(A.length,P.length);T<R;++T)u.push(A[T]),c.push(P[T])}h+=1,f+=1}let g=xe.intersect(xe.ofSortedArray(u),n.a.indices),y=xe.intersect(xe.ofSortedArray(c),n.b.indices);return{a:{unit:n.a.unit,indices:g},b:{unit:n.b.unit,indices:y},score:p}}r.compute=t})(uY||={});function xyt(e){switch(e.kind){case ue.Kind.Atomic:return e.model.atomicHierarchy.index.getEntityFromChain(e.chainIndex[e.elements[0]]);case ue.Kind.Spheres:return e.model.coarseHierarchy.spheres.entityKey[e.elements[0]];case ue.Kind.Gaussians:return e.model.coarseHierarchy.gaussians.entityKey[e.elements[0]]}}function qDe(e){return e.model.sequence.byEntityKey[xyt(e)].sequence}function cY(e){let t=[];if(e.length<=0)return t;let r=Syt(e),n={a:d0(e[0],r),b:d0(e[1],r)};t[0]=um.compute(n);for(let o=2;o<e.length;o++)n.b=d0(e[o],r),n.centerB=void 0,t.push(um.compute(n));return t}var Cyt=/(polypeptide|cyclic-pseudo-peptide)/i;function YDe(e){let t=[];if(e.length<=0)return t;let r=Q.Loci.getFirstLocation(e[0]),o=Ke.entity.subtype(r).match(Cyt)?"blosum62":"default";for(let i=1;i<e.length;i++){let{a,b:s,score:l}=uY.compute({a:e[0].elements[0],b:e[i].elements[0]},{substMatrix:o}),u=Q.Loci(e[0].structure,[a]),c=Q.Loci(e[i].structure,[s]),m=xe.size(a.indices);t.push({...um.compute({a:d0(u,m),b:d0(c,m)}),alignmentScore:l})}return t}function d0(e,t){let r=um.Positions.empty(t),n=0;for(let o of e.elements){let{unit:i,indices:a}=o,{elements:s,conformation:l}=i;for(let u=0,c=xe.size(a);u<c;u++){let m=s[xe.getAt(a,u)];if(r.x[n]=l.x(m),r.y[n]=l.y(m),r.z[n]=l.z(m),n++,n>=t)break}if(n>=t)break}return r}function Syt(e){if(e.length===0)return 0;let t=Q.Loci.size(e[0]);for(let r=1;r<e.length;r++){let n=Q.Loci.size(e[r]);n<t&&(t=n)}return t}function KDe(e,t){let r=new Map;for(let l=0;l<e.length;l++)Tyt(e[l],r,l,t?.traceOnly??!0,t?.includeResidueTest??Ayt);let n=Array.from(r.values()),o=Iyt(e.length,n),i=[],a=[],s=[];for(let l of o)if(l.count===0)i.push([l.i,l.j]);else{let[u,c]=vyt(n,l.i,l.j,l.count),m=um.compute({a:u,b:c});Number.isNaN(m.rmsd)?a.push([l.i,l.j]):s.push({transform:m,pivot:l.i,other:l.j})}return{entries:s,zeroOverlapPairs:i,failedPairs:a}}function vyt(e,t,r,n){let o=um.Positions.empty(n),i=um.Positions.empty(n),a=0;for(let{pivots:s}of e){let l=s[t],u=s[r];if(!l||!u)continue;let c=Math.min(l[2]-l[1],u[2]-u[1]);for(let m=0;m<c;m++){let d=l[1]+m;o.x[a]=l[0].conformation.x(d),o.y[a]=l[0].conformation.y(d),o.z[a]=l[0].conformation.z(d),d=u[1]+m,i.x[a]=u[0].conformation.x(d),i.y[a]=u[0].conformation.y(d),i.z[a]=u[0].conformation.z(d),a++}}return[o,i]}function Iyt(e,t){let r=[];for(let o=0;o<e;o++){r[o]=[];for(let i=0;i<e;i++)r[o][i]=0}for(let{pivots:o}of t)for(let i=0;i<e;i++){if(!o[i])continue;let a=o[i][2]-o[i][1];for(let s=i+1;s<e;s++){if(!o[s])continue;let l=o[s][2]-o[s][1];r[i][s]=r[i][s]+Math.min(a,l)}}let n=[];for(let o=1;o<e;o++)n[o-1]={i:0,j:o,count:r[0][o]};return n}function Ayt(){return!0}function Tyt(e,t,r,n,o){let i=Q.Location.create(e);for(let a of e.units){if(a.kind!==ue.Kind.Atomic)continue;let{elements:s,model:l}=a;i.unit=a;let u=Qc.Provider.get(l).value;if(!u)return;let{dbName:c,accession:m,num:d}=u,p=Kt.transientSegments(a.model.atomicHierarchy.chainAtomSegments,s),h=Kt.transientSegments(a.model.atomicHierarchy.residueAtomSegments,s),f=a.model.atomicHierarchy.derived.residue.traceElementIndex;for(;p.hasNext;){let g=p.move();for(h.setSegment(g);h.hasNext;){let y=h.move(),x=y.index;if(!c[x])continue;let S=f[x],I,v;if(n){if(I=S,I===-1)continue;v=I+1}else I=s[y.start],v=s[y.end-1]+1;if(i.element=S>=0?S:I,!o(i,x,I,v))continue;let A=`${c[x]}-${m[x]}-${d[x]}`;if(!t.has(A))t.set(A,{key:A,pivots:{[r]:[a,I,v]}});else{let P=t.get(A);P.pivots[r]||(P.pivots[r]=[a,I,v])}}}}}var dY;(a=>{a.Positions=um.Positions;function t(s){let{a:l,b:u}=s,c=l.x.length,m=u.x.length;if(c===0||m===0)return{bTransform:H.identity(),tmScoreA:0,tmScoreB:0,rmsd:0,alignedLength:0,sequenceIdentity:0,alignmentA:[],alignmentB:[]};let d=i(l),p=i(u),h=r(c),f=r(m),g=Math.min(c,m),y=Math.min(Math.max(Math.min(h,f),4.5),8),x=1.5*Math.pow(g,.3)+3.5,S=new mY(d,p,c,m,h,y,x);S.align();let{alignmentA:I,alignmentB:v,transform:A}=S.getBestAlignment(),P=n(d,p,I,v,A,h,c),T=n(d,p,I,v,A,f,m),R=o(d,p,I,v,A),w=0;if(s.seqA&&s.seqB){let E=0;for(let M=0;M<I.length;M++)s.seqA[I[M]]===s.seqB[v[M]]&&E++;w=I.length>0?E/I.length:0}return{bTransform:A,tmScoreA:P,tmScoreB:T,rmsd:R,alignedLength:I.length,sequenceIdentity:w,alignmentA:I,alignmentB:v}}a.compute=t;function r(s){if(s<=21)return .5;let l=1.24*Math.pow(s-15,1/3)-1.8;return Math.max(l,.5)}a.calculateD0=r;function n(s,l,u,c,m,d,p){if(u.length===0)return 0;let h=d*d,f=0,g=b(),y=b();for(let x=0;x<u.length;x++){let S=u[x],I=c[x];b.set(g,s[S][0],s[S][1],s[S][2]),b.set(y,l[I][0],l[I][1],l[I][2]),b.transformMat4(y,y,m);let v=b.squaredDistance(g,y);f+=1/(1+v/h)}return f/p}function o(s,l,u,c,m){if(u.length===0)return 0;let d=0,p=b(),h=b();for(let f=0;f<u.length;f++)b.set(p,s[u[f]][0],s[u[f]][1],s[u[f]][2]),b.set(h,l[c[f]][0],l[c[f]][1],l[c[f]][2]),b.transformMat4(h,h,m),d+=b.squaredDistance(p,h);return Math.sqrt(d/u.length)}function i(s){let l=s.x.length,u=new Array(l);for(let c=0;c<l;c++)u[c]=[s.x[c],s.y[c],s.z[c]];return u}})(dY||={});var mY=class{constructor(t,r,n,o,i,a,s){this.bestScore=-1;this.bestAlignmentA=[];this.bestAlignmentB=[];this.bestTransform=H.identity();this.xa=t,this.ya=r,this.lenA=n,this.lenB=o,this.d0A=i,this.d0Search=a,this.scoreD8=s,this.dpPath=new Array(n+1),this.dpVal=new Array(n+1);for(let l=0;l<=n;l++)this.dpPath[l]=new Array(o+1).fill(!1),this.dpVal[l]=new Array(o+1).fill(0);this.j2i=new Array(o).fill(-1)}align(){let{lenA:t,lenB:r}=this,n=Math.min(t,r);this.getInitialAlignment(),this.refineAlignment(),this.tryGaplessThreading();for(let i=5;i<=Math.min(12,n);i++)this.tryFragmentInitializationMedium(i);for(let i=16;i<=Math.min(30,n);i+=2)this.tryFragmentInitializationMedium(i);let o=[Math.floor(n*.15),Math.floor(n*.25),Math.floor(n*.4),Math.floor(n*.6)].filter(i=>i>30);for(let i of o)this.tryFragmentInitializationFast(i);this.refineAlignment();for(let i=Math.max(1,this.d0A-3);i<=this.d0A+3;i++)this.refineWithCutoff(i);this.refineWithCutoff(this.d0A*.8),this.optimizeFinalAlignment()}optimizeFinalAlignment(){let{xa:t,ya:r,d0A:n,lenA:o}=this,i=[8,7,6,5.5,5,4.5,4];for(let a of i){let s=a*a,l=[],u=[];for(let h=0;h<this.bestAlignmentA.length;h++){let f=this.bestAlignmentA[h],g=this.bestAlignmentB[h],y=b.create(r[g][0],r[g][1],r[g][2]);b.transformMat4(y,y,this.bestTransform);let x=y[0]-t[f][0],S=y[1]-t[f][1],I=y[2]-t[f][2];x*x+S*S+I*I<=s&&(l.push(f),u.push(g))}if(l.length<3)continue;let c=l.map(h=>t[h]),m=u.map(h=>r[h]),d=this.kabsch(c,m),p=this.scoreTM(this.bestAlignmentA,this.bestAlignmentB,d,n,o);p>this.bestScore&&(this.bestScore=p,this.bestTransform=H.clone(d))}this.bestScore=this.scoreTM(this.bestAlignmentA,this.bestAlignmentB,this.bestTransform,n,o)}scoreTM(t,r,n,o,i){let{xa:a,ya:s}=this,l=o*o,u=0;for(let c=0;c<t.length;c++){let m=t[c],d=r[c],p=b.create(s[d][0],s[d][1],s[d][2]);b.transformMat4(p,p,n);let h=p[0]-a[m][0],f=p[1]-a[m][1],g=p[2]-a[m][2],y=h*h+f*f+g*g;u+=1/(1+y/l)}return u/i}refineWithCutoff(t){if(t<1)return;let{xa:r,ya:n,lenA:o,d0A:i,d0Search:a,scoreD8:s}=this,l=t*t;for(let u=0;u<10&&!(this.bestAlignmentA.length<3);u++){let c=[],m=[];for(let S=0;S<this.bestAlignmentA.length;S++){let I=this.bestAlignmentA[S],v=this.bestAlignmentB[S],A=b.create(n[v][0],n[v][1],n[v][2]);b.transformMat4(A,A,this.bestTransform);let P=A[0]-r[I][0],T=A[1]-r[I][1],R=A[2]-r[I][2];P*P+T*T+R*R<=l&&(c.push(r[I]),m.push(n[v]))}if(c.length<3)break;let d=this.kabsch(c,m),p=new Array(this.lenB);for(let S=0;S<this.lenB;S++){let I=b.create(n[S][0],n[S][1],n[S][2]);b.transformMat4(I,I,d),p[S]=[I[0],I[1],I[2]]}let h=a+1;this.nwdpStructure(r,p,h*h,-.6);let f=[],g=[];for(let S=0;S<this.lenB;S++)this.j2i[S]>=0&&(f.push(this.j2i[S]),g.push(S));if(f.length<3)break;let y=this.trimmedKabsch(f,g,d,s),x=this.scoreTMWithCutoff(f,g,y,i,o,s);if(x>this.bestScore)this.bestScore=x,this.bestAlignmentA=f,this.bestAlignmentB=g,this.bestTransform=y;else break}}tryGaplessThreading(){let{xa:t,ya:r,lenA:n,lenB:o,d0A:i,scoreD8:a}=this;for(let s=-o+4;s<=n-4;s++){let l=[],u=[];for(let h=0;h<n;h++){let f=h-s;f>=0&&f<o&&(l.push(h),u.push(f))}if(l.length<4)continue;let c=l.map(h=>t[h]),m=u.map(h=>r[h]),d=this.kabsch(c,m);this.scoreTMWithCutoff(l,u,d,i,n,a)>this.bestScore*.8&&this.extendFromSeed(d)}}tryFragmentInitializationMedium(t){let{xa:r,ya:n,lenA:o,lenB:i,d0A:a,scoreD8:s}=this,l=o-t,u=i-t,c=Math.max(2,Math.floor(t/2));for(let m=0;m<=l;m+=c)for(let d=0;d<=u;d+=c){let p=[],h=[];for(let S=0;S<t;S++)p.push(r[m+S]),h.push(n[d+S]);let f=this.kabsch(p,h),g=[],y=[];for(let S=0;S<t;S++)g.push(m+S),y.push(d+S);this.scoreTMWithCutoff(g,y,f,a,o,s)>this.bestScore*.3&&this.extendFromSeed(f)}}tryFragmentInitializationFast(t){let{xa:r,ya:n,lenA:o,lenB:i,d0A:a,scoreD8:s}=this,l=o-t,u=i-t,c=Math.max(t,10);for(let m=0;m<=l;m+=c)for(let d=0;d<=u;d+=c){let p=[],h=[];for(let S=0;S<t;S++)p.push(r[m+S]),h.push(n[d+S]);let f=this.kabsch(p,h),g=[],y=[];for(let S=0;S<t;S++)g.push(m+S),y.push(d+S);this.scoreTMWithCutoff(g,y,f,a,o,s)>this.bestScore*.5&&this.extendFromSeed(f)}}getInitialAlignment(){let{xa:t,ya:r,lenA:n,lenB:o,d0Search:i}=this,a=i*i,s=new Array(n+1);for(let l=0;l<=n;l++)s[l]=new Array(o+1).fill(0);for(let l=1;l<=n;l++)for(let u=1;u<=o;u++){let c=t[l-1][0]-r[u-1][0],m=t[l-1][1]-r[u-1][1],d=t[l-1][2]-r[u-1][2],p=c*c+m*m+d*d;s[l][u]=1/(1+p/a)}this.nwdpScore(s,-.6)}extendFromSeed(t){let{xa:r,ya:n,lenA:o,lenB:i,d0A:a,d0Search:s,scoreD8:l}=this,u=t,c=[],m=[],d=-1;for(let p=0;p<20;p++){let h=new Array(i);for(let I=0;I<i;I++){let v=b.create(n[I][0],n[I][1],n[I][2]);b.transformMat4(v,v,u),h[I]=[v[0],v[1],v[2]]}let f=s+1;this.nwdpStructure(r,h,f*f,-.6);let g=[],y=[];for(let I=0;I<i;I++)this.j2i[I]>=0&&(g.push(this.j2i[I]),y.push(I));if(g.length<3||this.alignmentsEqual(g,y,c,m))break;let x=this.trimmedKabsch(g,y,u,l),S=this.scoreTMWithCutoff(g,y,x,a,o,l);if(c=g,m=y,u=x,S<=d)break;d=S,S>this.bestScore&&(this.bestScore=S,this.bestAlignmentA=g.slice(),this.bestAlignmentB=y.slice(),this.bestTransform=H.clone(x))}}trimmedKabsch(t,r,n,o){let{xa:i,ya:a}=this,s=o*o,l=[],u=[];for(let c=0;c<t.length;c++){let m=t[c],d=r[c],p=b.create(a[d][0],a[d][1],a[d][2]);b.transformMat4(p,p,n);let h=p[0]-i[m][0],f=p[1]-i[m][1],g=p[2]-i[m][2];h*h+f*f+g*g<=s&&(l.push(i[m]),u.push(a[d]))}if(l.length<3){let c=t.map(d=>i[d]),m=r.map(d=>a[d]);return this.kabsch(c,m)}return this.kabsch(l,u)}refineAlignment(){let{xa:t,ya:r,lenA:n,d0A:o,d0Search:i,scoreD8:a}=this,s=20;for(let l=0;l<s&&!(this.bestAlignmentA.length<3);l++){let u=this.trimmedKabsch(this.bestAlignmentA,this.bestAlignmentB,this.bestTransform,a),c=new Array(this.lenB);for(let x=0;x<this.lenB;x++){let S=b.create(r[x][0],r[x][1],r[x][2]);b.transformMat4(S,S,u),c[x]=[S[0],S[1],S[2]]}let m=i+1;this.nwdpStructure(t,c,m*m,-.6);let d=[],p=[];for(let x=0;x<this.lenB;x++)this.j2i[x]>=0&&(d.push(this.j2i[x]),p.push(x));if(d.length<3||this.alignmentsEqual(d,p,this.bestAlignmentA,this.bestAlignmentB))break;let h=d.map(x=>t[x]),f=p.map(x=>r[x]),g=this.kabsch(h,f),y=this.scoreTMWithCutoff(d,p,g,o,n,a);y>this.bestScore&&(this.bestScore=y,this.bestAlignmentA=d,this.bestAlignmentB=p,this.bestTransform=g)}}alignmentsEqual(t,r,n,o){if(t.length!==n.length)return!1;for(let i=0;i<t.length;i++)if(t[i]!==n[i]||r[i]!==o[i])return!1;return!0}scoreTMWithCutoff(t,r,n,o,i,a){let{xa:s,ya:l}=this,u=o*o,c=a*a,m=0;for(let d=0;d<t.length;d++){let p=t[d],h=r[d],f=b.create(l[h][0],l[h][1],l[h][2]);b.transformMat4(f,f,n);let g=f[0]-s[p][0],y=f[1]-s[p][1],x=f[2]-s[p][2],S=g*g+y*y+x*x;S<=c&&(m+=1/(1+S/u))}return m/i}nwdpScore(t,r){let{lenA:n,lenB:o,dpPath:i,dpVal:a,j2i:s}=this;for(let c=0;c<=n;c++)a[c][0]=0,i[c][0]=!1;for(let c=0;c<=o;c++)a[0][c]=0,i[0][c]=!1,s[c]=-1;for(let c=1;c<=n;c++)for(let m=1;m<=o;m++){let d=a[c-1][m-1]+t[c][m],p=a[c-1][m];i[c-1][m]&&(p+=r);let h=a[c][m-1];i[c][m-1]&&(h+=r),d>=p&&d>=h?(i[c][m]=!0,a[c][m]=d):(i[c][m]=!1,a[c][m]=h>=p?h:p)}let l=n,u=o;for(;l>0&&u>0;)if(i[l][u])s[u-1]=l-1,l--,u--;else{let c=a[l-1][u];i[l-1][u]&&(c+=r);let m=a[l][u-1];i[l][u-1]&&(m+=r),m>=c?u--:l--}this.bestAlignmentA=[],this.bestAlignmentB=[];for(let c=0;c<o;c++)s[c]>=0&&(this.bestAlignmentA.push(s[c]),this.bestAlignmentB.push(c));if(this.bestAlignmentA.length>=3){let c=this.bestAlignmentA.map(d=>this.xa[d]),m=this.bestAlignmentB.map(d=>this.ya[d]);this.bestTransform=this.kabsch(c,m),this.bestScore=this.scoreTMWithCutoff(this.bestAlignmentA,this.bestAlignmentB,this.bestTransform,this.d0A,this.lenA,this.scoreD8)}}nwdpStructure(t,r,n,o){let{lenA:i,lenB:a,dpPath:s,dpVal:l,j2i:u}=this;for(let d=0;d<=i;d++)l[d][0]=0,s[d][0]=!1;for(let d=0;d<=a;d++)l[0][d]=0,s[0][d]=!1,u[d]=-1;for(let d=1;d<=i;d++)for(let p=1;p<=a;p++){let h=t[d-1][0]-r[p-1][0],f=t[d-1][1]-r[p-1][1],g=t[d-1][2]-r[p-1][2],y=h*h+f*f+g*g,x=l[d-1][p-1]+1/(1+y/n),S=l[d-1][p];s[d-1][p]&&(S+=o);let I=l[d][p-1];s[d][p-1]&&(I+=o),x>=S&&x>=I?(s[d][p]=!0,l[d][p]=x):(s[d][p]=!1,l[d][p]=I>=S?I:S)}let c=i,m=a;for(;c>0&&m>0;)if(s[c][m])u[m-1]=c-1,c--,m--;else{let d=l[c-1][m];s[c-1][m]&&(d+=o);let p=l[c][m-1];s[c][m-1]&&(p+=o),p>=d?m--:c--}}kabsch(t,r){let n=t.length;if(n<3)return H.identity();let o=um.Positions.empty(n),i=um.Positions.empty(n);for(let s=0;s<n;s++)o.x[s]=t[s][0],o.y[s]=t[s][1],o.z[s]=t[s][2],i.x[s]=r[s][0],i.y[s]=r[s][1],i.z[s]=r[s][2];return um.compute({a:o,b:i}).bTransform}getBestAlignment(){return{alignmentA:this.bestAlignmentA,alignmentB:this.bestAlignmentB,transform:this.bestTransform}}};function JDe(e,t){let r=Q.Loci.size(e),n=Q.Loci.size(t);if(r===0||n===0)return{bTransform:H.identity(),tmScoreA:0,tmScoreB:0,rmsd:0,alignedLength:0,sequenceIdentity:0,alignmentA:[],alignmentB:[]};let o=d0(e,r),i=d0(t,n);return dY.compute({a:o,b:i})}var dn=_t(ur()),GO=class extends kc{defaultState(){return{isCollapsed:!1,header:"Superposition",brand:{accent:"gray",svg:noe},isHidden:!0}}componentDidMount(){this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,t=>{this.setState({isHidden:t.structures.length<2})})}renderControls(){return(0,dn.jsx)(dn.Fragment,{children:(0,dn.jsx)(pY,{})})}},$De={alignSequences:C.Boolean(!0,{isEssential:!0,description:"For Chain-based 3D superposition, perform a sequence alignment and use the aligned residue pairs to guide the 3D superposition."}),traceOnly:C.Boolean(!0,{description:"For Chain- and Uniprot-based 3D superposition, base superposition only on CA (and equivalent) atoms."})},Pyt=C.getDefaultValues($De),_yt="SuperpositionTransform",pY=class extends bi{constructor(){super(...arguments);this.state={isBusy:!1,canUseDb:!1,action:void 0,options:Pyt};this.superposeChains=async()=>{let{query:r}=this.state.options.traceOnly?oi.trace:oi.polymer,n=this.chainEntries,o=n.map(u=>{let c=Q.Loci.toStructure(u.loci),m=ut.toLociWithSourceUnits(r(new zo(c)));return Q.Loci.remap(m,this.getRootStructure(u.loci.structure))}),a=this.plugin.managers.structure.hierarchy.findStructure(o[0]?.structure)?.transform?.cell.obj?.data.coordinateSystem,s=this.state.options.alignSequences?YDe(o):cY(o),l=n[0];for(let u=1,c=o.length;u<c;++u){let m=n[u],{bTransform:d,rmsd:p}=s[u-1];await this.transform(m.cell,d,a);let h=ud(l.label),f=ud(m.label);this.plugin.log.info(`Superposed [${h}] and [${f}] with RMSD ${p.toFixed(2)}.`)}await this.cameraReset()};this.superposeAtoms=async()=>{let r=this.atomEntries,n=r.map(l=>Q.Loci.remap(l.loci,this.getRootStructure(l.loci.structure))),o=cY(n),a=this.plugin.managers.structure.hierarchy.findStructure(n[0]?.structure)?.transform?.cell.obj?.data.coordinateSystem,s=r[0];for(let l=1,u=n.length;l<u;++l){let c=r[l],{bTransform:m,rmsd:d}=o[l-1];await this.transform(c.cell,m,a);let p=ud(s.label),h=ud(c.label),f=r[l].atoms.length;this.plugin.log.info(`Superposed ${f} ${f===1?"atom":"atoms"} of [${p}] and [${h}] with RMSD ${d.toFixed(2)}.`)}await this.cameraReset()};this.superposeDb=async()=>{let r=this.plugin.managers.structure.hierarchy.behaviors.selection.value.structures,n=this.state.options.traceOnly,o=r.map(m=>m.cell.obj?.data),{entries:i,failedPairs:a,zeroOverlapPairs:s}=KDe(o,{traceOnly:n}),l=r[0]?.transform?.cell.obj?.data.coordinateSystem,u=0;for(let m of i)await this.transform(r[m.other].cell,m.transform.bTransform,l),u+=m.transform.rmsd;u/=Math.max(i.length-1,1);let c=m=>`[${m.map(([d,p])=>`(${o[d].models[0].entryId}, ${o[p].models[0].entryId})`).join(", ")}]`;s.length&&this.plugin.log.warn(`Superposition: No UNIPROT mapping overlap between structures ${c(s)}.`),a.length&&this.plugin.log.error(`Superposition: Failed to superpose structures ${c(a)}.`),i.length&&(this.plugin.log.info(`Superposed ${i.length+1} structures with avg. RMSD ${u.toFixed(2)} \xC5.`),await this.cameraReset())};this.superposeTMAlign=async()=>{let{query:r}=this.state.options.traceOnly?oi.trace:oi.polymer,n=this.chainEntries,o=n.map(l=>{let u=Q.Loci.toStructure(l.loci),c=ut.toLociWithSourceUnits(r(new zo(u)));return Q.Loci.remap(c,this.getRootStructure(l.loci.structure))}),a=this.plugin.managers.structure.hierarchy.findStructure(o[0]?.structure)?.transform?.cell.obj?.data.coordinateSystem,s=n[0];for(let l=1,u=o.length;l<u;++l){let c=n[l],m=JDe(o[0],o[l]),{bTransform:d,tmScoreA:p,tmScoreB:h,rmsd:f,alignedLength:g}=m;await this.transform(c.cell,d,a);let y=ud(s.label),x=ud(c.label);this.plugin.log.info(`TM-align [${y}] and [${x}]: TM-score=${p.toFixed(4)}/${h.toFixed(4)}, RMSD=${f.toFixed(2)} \xC5, aligned ${g} residues.`)}await this.cameraReset()};this.toggleByChains=()=>this.setState({action:this.state.action==="byChains"?void 0:"byChains"});this.toggleByAtoms=()=>this.setState({action:this.state.action==="byAtoms"?void 0:"byAtoms"});this.toggleByTMAlign=()=>this.setState({action:this.state.action==="byTMAlign"?void 0:"byTMAlign"});this.toggleOptions=()=>this.setState({action:this.state.action==="options"?void 0:"options"});this.setOptions=r=>{this.setState({options:r})}}componentDidMount(){this.subscribe(this.selection.events.changed,()=>{this.forceUpdate()}),this.subscribe(this.selection.events.additionsHistoryUpdated,()=>{this.forceUpdate()}),this.subscribe(this.plugin.behaviors.state.isBusy,r=>{this.setState({isBusy:r})}),this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,r=>{this.setState({canUseDb:r.structures.every(n=>!!n.cell.obj?.data&&n.cell.obj.data.models.some(o=>Qc.Provider.isApplicable(o)))})})}get selection(){return this.plugin.managers.structure.selection}async transform(r,n,o){let i=ci.resolveAndCheck(this.plugin.state.data,r);if(!i)return;let a=this.plugin.state.data.selectQ(c=>c.byRef(i.transform.ref).subtree().withTransformer(Qe.Model.TransformStructureConformation))[0],l={transform:{name:"matrix",params:{data:o&&!H.isIdentity(o.matrix)?H.mul(H(),o.matrix,n):n,transpose:!1}}},u=a?this.plugin.state.data.build().to(a).update(l):this.plugin.state.data.build().to(r).insert(Qe.Model.TransformStructureConformation,l,{tags:_yt});await this.plugin.runTask(this.plugin.state.data.updateTree(u))}getRootStructure(r){let n=this.plugin.helpers.substructureParent.get(r);return this.plugin.state.data.selectQ(o=>o.byValue(n).rootOfType(ne.Molecule.Structure))[0].obj?.data}async cameraReset(){await new Promise(r=>requestAnimationFrame(r)),lt.Camera.Reset(this.plugin)}highlight(r){this.plugin.managers.interactivity.lociHighlights.highlightOnly({loci:r},!1)}moveHistory(r,n){this.plugin.managers.structure.selection.modifyHistory(r,n,void 0,!0)}focusLoci(r){this.plugin.managers.camera.focusLoci(r)}lociEntry(r,n){return(0,dn.jsx)("div",{className:"msp-flex-row",children:(0,dn.jsx)(gr,{noOverflow:!0,title:"Click to focus. Hover to highlight.",onClick:()=>this.focusLoci(r.loci),style:{width:"auto",textAlign:"left"},onMouseEnter:()=>this.highlight(r.loci),onMouseLeave:()=>this.plugin.managers.interactivity.lociHighlights.clearHighlights(),children:(0,dn.jsx)("span",{dangerouslySetInnerHTML:{__html:r.label}})})},n)}historyEntry(r,n){let o=this.plugin.managers.structure.selection.additionsHistory;return(0,dn.jsxs)("div",{className:"msp-flex-row",children:[(0,dn.jsxs)(gr,{noOverflow:!0,title:"Click to focus. Hover to highlight.",onClick:()=>this.focusLoci(r.loci),style:{width:"auto",textAlign:"left"},onMouseEnter:()=>this.highlight(r.loci),onMouseLeave:()=>this.plugin.managers.interactivity.lociHighlights.clearHighlights(),children:[n,". ",(0,dn.jsx)("span",{dangerouslySetInnerHTML:{__html:r.label}})]}),o.length>1&&(0,dn.jsx)(sr,{svg:Rx,small:!0,className:"msp-form-control",onClick:()=>this.moveHistory(r,"up"),flex:"20px",title:"Move up"}),o.length>1&&(0,dn.jsx)(sr,{svg:_x,small:!0,className:"msp-form-control",onClick:()=>this.moveHistory(r,"down"),flex:"20px",title:"Move down"}),(0,dn.jsx)(sr,{svg:$s,small:!0,className:"msp-form-control",onClick:()=>this.plugin.managers.structure.selection.modifyHistory(r,"remove"),flex:!0,title:"Remove"})]},r.id)}atomsLociEntry(r,n){return(0,dn.jsxs)("div",{children:[(0,dn.jsx)("div",{className:"msp-control-group-header",children:(0,dn.jsx)("div",{className:"msp-no-overflow",title:r.label,children:r.label})}),(0,dn.jsx)("div",{className:"msp-control-offset",children:r.atoms.map((o,i)=>this.historyEntry(o,i))})]},n)}get chainEntries(){let r=Q.Location.create(),n=[];return this.plugin.managers.structure.selection.entries.forEach(({selection:o},i)=>{let a=ci.resolveAndCheck(this.plugin.state.data,i);if(!a||Q.Loci.isEmpty(o))return;let s=Q.Loci.getFirstLocation(o,r);if(o.elements.length>1||Ke.entity.type(s)!=="polymer")return;let l=Q.Stats.ofLoci(o),u=r1(l,{countsOnly:!0}),c=Ld(s,{reverse:!0,granularity:"chain"}).split("|"),m=`${u} | ${c[0]} | ${c[c.length-1]}`;n.push({loci:o,label:m,cell:a})}),n}get atomEntries(){let r=new Map,n=this.plugin.managers.structure.selection.additionsHistory;for(let i=0,a=n.length;i<a;++i){let s=n[i];if(Q.Loci.size(s.loci)!==1)continue;let l=s.loci.structure;r.has(l)?r.get(l).push(s):r.set(l,[s])}let o=[];return r.forEach((i,a)=>{let s=this.plugin.helpers.substructureParent.get(a),l=[];for(let m=0,d=i.length;m<d;++m)l.push(i[m].loci.elements[0]);let u=Q.Loci(i[0].loci.structure,l),c=u.structure.label.split(" | ")[0];o.push({loci:u,label:c,cell:s,atoms:i})}),o}toggleHint(){return this.plugin.config.get(Lr.Viewport.ShowSelectionMode)?(0,dn.jsxs)(dn.Fragment,{children:[" ","(toggle ",(0,dn.jsx)(o0,{inline:!0})," mode)"]}):null}addByChains(){let r=this.chainEntries;return(0,dn.jsxs)(dn.Fragment,{children:[r.length>0&&(0,dn.jsx)("div",{className:"msp-control-offset",children:r.map((n,o)=>this.lociEntry(n,o))}),r.length<2&&(0,dn.jsx)("div",{className:"msp-control-offset msp-help-text",children:(0,dn.jsxs)("div",{className:"msp-help-description",children:[(0,dn.jsx)(Dn,{svg:Du,inline:!0}),"Add 2 or more selections",this.toggleHint()," from separate structures. Selections must be limited to single polymer chains or residues therein."]})}),r.length>1&&(0,dn.jsx)(gr,{title:"Superpose structures by selected chains.",className:"msp-btn-commit msp-btn-commit-on",onClick:this.superposeChains,style:{marginTop:"1px"},children:"Superpose"})]})}addByAtoms(){let r=this.atomEntries;return(0,dn.jsxs)(dn.Fragment,{children:[r.length>0&&(0,dn.jsx)("div",{className:"msp-control-offset",children:r.map((n,o)=>this.atomsLociEntry(n,o))}),r.length<2&&(0,dn.jsx)("div",{className:"msp-control-offset msp-help-text",children:(0,dn.jsxs)("div",{className:"msp-help-description",children:[(0,dn.jsx)(Dn,{svg:Du,inline:!0}),"Add 1 or more selections",this.toggleHint()," from separate structures. Selections must be limited to single atoms."]})}),r.length>1&&(0,dn.jsx)(gr,{title:"Superpose structures by selected atoms.",className:"msp-btn-commit msp-btn-commit-on",onClick:this.superposeAtoms,style:{marginTop:"1px"},children:"Superpose"})]})}addByTMAlign(){let r=this.chainEntries;return(0,dn.jsxs)(dn.Fragment,{children:[r.length>0&&(0,dn.jsx)("div",{className:"msp-control-offset",children:r.map((n,o)=>this.lociEntry(n,o))}),r.length<2&&(0,dn.jsx)("div",{className:"msp-control-offset msp-help-text",children:(0,dn.jsxs)("div",{className:"msp-help-description",children:[(0,dn.jsx)(Dn,{svg:Du,inline:!0}),"Add 2 or more selections",this.toggleHint()," from separate structures. Selections must be limited to single polymer chains. TM-align performs structure-based alignment independent of sequence."]})}),r.length>1&&(0,dn.jsx)(gr,{title:"Superpose structures using TM-align (structure-based alignment).",className:"msp-btn-commit msp-btn-commit-on",onClick:this.superposeTMAlign,style:{marginTop:"1px"},children:"TM-align Superpose"})]})}superposeByDbMapping(){return(0,dn.jsx)(dn.Fragment,{children:(0,dn.jsx)(gr,{icon:DM,title:"Superpose structures using intersection of residues from SIFTS UNIPROT mapping.",className:"msp-btn msp-btn-block",onClick:this.superposeDb,style:{marginTop:"1px"},disabled:this.state.isBusy,children:"Uniprot"})})}render(){return(0,dn.jsxs)(dn.Fragment,{children:[(0,dn.jsxs)("div",{className:"msp-flex-row",children:[(0,dn.jsx)(yi,{icon:DM,label:"Chains",toggle:this.toggleByChains,isSelected:this.state.action==="byChains",disabled:this.state.isBusy}),(0,dn.jsx)(yi,{icon:roe,label:"Atoms",toggle:this.toggleByAtoms,isSelected:this.state.action==="byAtoms",disabled:this.state.isBusy}),(0,dn.jsx)(yi,{icon:DM,label:"TM-align",toggle:this.toggleByTMAlign,isSelected:this.state.action==="byTMAlign",disabled:this.state.isBusy}),this.state.canUseDb&&this.superposeByDbMapping(),(0,dn.jsx)(yi,{icon:Il,label:"",title:"Options",toggle:this.toggleOptions,isSelected:this.state.action==="options",disabled:this.state.isBusy,style:{flex:"0 0 40px",padding:0}})]}),this.state.action==="byChains"&&this.addByChains(),this.state.action==="byAtoms"&&this.addByAtoms(),this.state.action==="byTMAlign"&&this.addByTMAlign(),this.state.action==="options"&&(0,dn.jsx)("div",{className:"msp-control-offset",children:(0,dn.jsx)(uo,{params:$De,values:this.state.options,onChangeValues:this.setOptions,isDisabled:this.state.isBusy})})]})}};var Bs=_t(ur()),UO=class extends kc{defaultState(){return{isCollapsed:!1,header:"Quick Styles",brand:{accent:"gray",svg:Bne}}}renderControls(){return(0,Bs.jsx)(Bs.Fragment,{children:(0,Bs.jsx)(fY,{})})}},fY=class extends bi{constructor(){super(...arguments);this.state={busy:!1,style:"default"}}async applyRepresentation(r){this.setState({busy:!0}),await Ryt(this.plugin,r),await t3e(this.plugin,this.state.style),this.setState({busy:!1})}async applyStyle(r){this.setState({busy:!0}),await t3e(this.plugin,r),this.setState({busy:!1,style:r})}render(){return(0,Bs.jsxs)(Bs.Fragment,{children:[(0,Bs.jsx)(e3e,{title:"Apply Representation",children:(0,Bs.jsxs)("div",{className:"msp-flex-row",children:[(0,Bs.jsx)(gr,{title:"Applies default representation preset (depends on structure size)",onClick:()=>this.applyRepresentation("default"),disabled:this.state.busy,children:"Default"}),(0,Bs.jsx)(gr,{title:"Applies cartoon polymer and ball-and-stick ligand representation preset",onClick:()=>this.applyRepresentation("cartoon"),disabled:this.state.busy,children:"Cartoon"}),(0,Bs.jsx)(gr,{title:"Applies spacefill representation preset",onClick:()=>this.applyRepresentation("spacefill"),disabled:this.state.busy,children:"Spacefill"}),(0,Bs.jsx)(gr,{title:"Applies molecular surface representation preset",onClick:()=>this.applyRepresentation("surface"),disabled:this.state.busy,children:"Surface"})]})}),(0,Bs.jsx)(e3e,{title:"Apply Style",children:(0,Bs.jsxs)("div",{className:"msp-flex-row",children:[(0,Bs.jsx)(gr,{title:"Applies default appearance (no outline, no ignore-light)",onClick:()=>this.applyStyle("default"),disabled:this.state.busy,children:"Default"}),(0,Bs.jsx)(gr,{title:"Applies illustrative appearance (outline, ignore-light)",onClick:()=>this.applyStyle("illustrative"),disabled:this.state.busy,children:"Illustrative"})]})})]})}};function e3e(e){return(0,Bs.jsxs)("div",{className:"msp-control-group-wrapper",children:[(0,Bs.jsx)("div",{className:"msp-control-group-header",children:(0,Bs.jsx)("div",{children:(0,Bs.jsx)("b",{children:e.title})})}),e.children]})}async function Ryt(e,t){let{structures:r}=e.managers.structure.hierarchy.selection;switch(t){case"default":let n=e.config.get(Lr.Structure.DefaultRepresentationPreset)||bu.auto.id,o=e.builders.structure.representation.resolveProvider(n);await e.managers.structure.component.applyPreset(r,o);break;case"spacefill":await e.managers.structure.component.applyPreset(r,bu.illustrative);break;case"cartoon":await e.managers.structure.component.applyPreset(r,bu["polymer-and-ligand"]);break;case"surface":await e.managers.structure.component.applyPreset(r,bu["molecular-surface"]);break}}async function t3e(e,t){if(t==="default"&&(await e.managers.structure.component.setOptions({...e.managers.structure.component.state.options,ignoreLight:!1}),e.canvas3d)){let r=C.getDefaultValues(eT);e.canvas3d.setProps({postprocessing:{outline:r.outline,occlusion:r.occlusion,shadow:r.shadow}})}if(t==="illustrative"&&(await e.managers.structure.component.setOptions({...e.managers.structure.component.state.options,ignoreLight:!0}),e.canvas3d)){let r=e.canvas3d.props.postprocessing;e.canvas3d.setProps({postprocessing:{outline:{name:"on",params:r.outline.name==="on"?r.outline.params:{scale:1,color:0,threshold:.33,includeTransparent:!0}},occlusion:{name:"on",params:r.occlusion.name==="on"?r.occlusion.params:{multiScale:{name:"off",params:{}},radius:5,bias:.8,blurKernelSize:15,blurDepthBias:.5,samples:32,resolutionScale:1,color:0,transparentThreshold:.4}},shadow:{name:"off",params:{}}}})}}var Tn=_t(ur()),NO=class extends Fr{constructor(){super(...arguments);this.state={show:!1,label:""};this.update=()=>{let r=this.plugin.state.data,n=r.selectQ(s=>s.ofTransformer(Qe.Model.ModelFromTrajectory));if(n.length===0){this.setState({show:!1});return}let o="",i=0,a=new Set;for(let s of n){if(!s.sourceRef)continue;let l=r.cells.get(s.sourceRef).obj;if(l&&l.data.frameCount>1){if(a.has(s.sourceRef)){this.setState({show:!1});return}if(a.add(s.sourceRef),i++,!o){let u=s.transform.params.modelIndex;o=`Model ${Math.round(u+1)} / ${l.data.frameCount}`}}}i>1&&(o=""),this.setState({show:i>0,label:o})};this.reset=()=>lt.State.ApplyAction(this.plugin,{state:this.plugin.state.data,action:DD.create({action:"reset"})});this.prev=()=>lt.State.ApplyAction(this.plugin,{state:this.plugin.state.data,action:DD.create({action:"advance",by:-1})});this.next=()=>lt.State.ApplyAction(this.plugin,{state:this.plugin.state.data,action:DD.create({action:"advance",by:1})})}componentDidMount(){this.subscribe(this.plugin.state.data.events.changed,this.update),this.subscribe(this.plugin.behaviors.state.isAnimating,this.update)}render(){let r=this.plugin.behaviors.state.isAnimating.value;return!this.state.show||r&&!this.state.label||!this.plugin.config.get(Lr.Viewport.ShowTrajectoryControls)?null:(0,Tn.jsxs)("div",{className:"msp-traj-controls",children:[!r&&(0,Tn.jsx)(sr,{svg:Yne,title:"First Model",onClick:this.reset,disabled:r}),!r&&(0,Tn.jsx)(sr,{svg:W5,title:"Previous Model",onClick:this.prev,disabled:r}),!r&&(0,Tn.jsx)(sr,{svg:X5,title:"Next Model",onClick:this.next,disabled:r}),!!this.state.label&&(0,Tn.jsx)("span",{children:this.state.label})]})}},zO=class extends Fr{constructor(){super(...arguments);this.state={isBusy:!1,show:!0,showAnimation:!1};this.change=r=>{r.target.value!=="none"&&this.update(r.target.value)};this.prev=()=>{let r=this.plugin.managers.snapshot,n=r.getNextId(r.state.current,-1);n&&this.update(n)};this.next=()=>{let r=this.plugin.managers.snapshot,n=r.getNextId(r.state.current,1);n&&this.update(n)};this.togglePlay=()=>{this.plugin.managers.snapshot.togglePlay()};this.toggleShowAnimation=()=>{this.setState({showAnimation:!this.state.showAnimation})};this.toggleStateAnimation=()=>{this.state.isBusy?(this.plugin.managers.animation.stop(),this.plugin.managers.markdownExtensions.audio.pause()):this.plugin.managers.animation.play(QC,{})}}componentDidMount(){this.subscribe(this.plugin.managers.snapshot.events.changed,()=>this.forceUpdate()),this.subscribe(this.plugin.behaviors.state.isBusy,r=>this.setState({isBusy:r})),this.subscribe(this.plugin.behaviors.state.isAnimating,r=>this.setState({isBusy:r}))}componentWillUnmount(){super.componentWillUnmount()}async update(r){this.setState({isBusy:!0}),await lt.State.Snapshots.Apply(this.plugin,{id:r}),this.setState({isBusy:!1})}get isStateTransitionPlaying(){return this.plugin.managers.animation.isAnimatingStateTransition}render(){let r=this.plugin.managers.snapshot,n=r.state.entries.size;if(!n||!this.state.show)return null;let o=r.state.current,i=r.state.isPlaying,a=r.getEntry(o),s=!!a?.snapshot.transition,l=i||this.state.isBusy&&!this.isStateTransitionPlaying;return(0,Tn.jsxs)("div",{className:"msp-state-snapshot-viewport-controls",children:[(0,Tn.jsxs)("select",{className:"msp-form-control",value:o||"none",onChange:this.change,disabled:l,children:[!o&&(0,Tn.jsx)("option",{value:"none"},"none"),r.state.entries.valueSeq().map((u,c)=>(0,Tn.jsxs)("option",{value:u.snapshot.id,children:[`[${c+1}/${n}]`," ",u.name||new Date(u.timestamp).toLocaleString()]},u.snapshot.id))]}),(0,Tn.jsx)(sr,{svg:i?_M:TM,title:i?"Pause":"Cycle States",onClick:this.togglePlay,disabled:i?!1:this.state.isBusy&&!this.isStateTransitionPlaying}),!i&&(0,Tn.jsxs)(Tn.Fragment,{children:[n>1&&(0,Tn.jsx)(sr,{svg:W5,title:"Previous State",onClick:this.prev,disabled:l}),n>1&&(0,Tn.jsx)(sr,{svg:X5,title:"Next State",onClick:this.next,disabled:l}),s&&(0,Tn.jsx)(sr,{svg:kne,className:"msp-state-snapshot-animation-button",title:"Snapshot Transition",onClick:this.toggleShowAnimation,disabled:!s,toggleState:this.state.showAnimation})]}),s&&this.state.showAnimation&&!i&&(0,Tn.jsxs)(Tn.Fragment,{children:[(0,Tn.jsxs)("div",{className:"msp-state-snapshot-animation-slider msp-form-control",children:[(0,Tn.jsx)(r0,{value:Math.round(100*(r.state.currentAnimationTimeMs??0))/100,min:0,step:yu.getMinFrameDuration(a?.snapshot),max:yu.getStateTransitionDuration(a?.snapshot)??1e3,onChange:()=>{},onChangeImmediate:u=>r.setSnapshotAnimationFrame(u,!0),hideInput:!0,disabled:this.state.isBusy}),"\xA0"]}),(0,Tn.jsx)(sr,{svg:this.state.isBusy?_M:J0,title:this.state.isBusy?"Stop":"Replay",onClick:this.toggleStateAnimation,toggleState:!1})]})]})}};function r3e(){let e=UT.useContext(Al),[t,r]=UT.useState(0);UT.useEffect(()=>{let i=e.managers.snapshot.events.changed.subscribe(()=>r(a=>a+1));return()=>i.unsubscribe()},[e]);let n=e.managers.snapshot.state.current;if(!n)return null;let o=e.managers.snapshot.getEntry(n);return o?.description?.trim()?(0,Tn.jsx)("div",{id:"snapinfo",className:"msp-snapshot-description-wrapper",children:o.descriptionFormat==="plaintext"&&o.description||(0,Tn.jsx)(hB,{children:o.description})}):null}var HO=class extends Fr{constructor(){super(...arguments);this.state={isEmpty:!0,isExpanded:!1,isBusy:!1,isAnimating:!1,isPlaying:!1};this.toggleExpanded=()=>this.setState({isExpanded:!this.state.isExpanded});this.stop=()=>{this.plugin.managers.animation.stop(),this.plugin.managers.snapshot.stop()}}componentDidMount(){this.subscribe(this.plugin.managers.snapshot.events.changed,()=>{this.plugin.managers.snapshot.state.isPlaying?this.setState({isPlaying:!0,isExpanded:!1}):this.setState({isPlaying:!1})}),this.subscribe(this.plugin.behaviors.state.isBusy,r=>{r?this.setState({isBusy:!0,isExpanded:!1,isEmpty:this.plugin.state.data.tree.transforms.size<2}):this.setState({isBusy:!1,isEmpty:this.plugin.state.data.tree.transforms.size<2})}),this.subscribe(this.plugin.behaviors.state.isAnimating,r=>{r?this.setState({isAnimating:!0,isExpanded:!1}):this.setState({isAnimating:!1})})}render(){let r=this.plugin.managers.snapshot.state.isPlaying;if(r||this.state.isEmpty||this.plugin.managers.animation.isEmpty||!this.plugin.config.get(Lr.Viewport.ShowAnimation))return null;let n=this.state.isAnimating;return(0,Tn.jsxs)("div",{className:"msp-animation-viewport-controls",children:[(0,Tn.jsxs)("div",{children:[(0,Tn.jsx)("div",{className:"msp-semi-transparent-background"}),(0,Tn.jsx)(sr,{svg:n||r?_M:Kne,transparent:!0,title:n?"Stop":"Select Animation",onClick:n||r?this.stop:this.toggleExpanded,toggleState:this.state.isExpanded,disabled:n||r?!1:this.state.isBusy||this.state.isPlaying||this.state.isEmpty})]}),this.state.isExpanded&&!this.state.isBusy&&(0,Tn.jsx)("div",{className:"msp-animation-viewport-controls-select",children:(0,Tn.jsx)(mO,{onStart:this.toggleExpanded})})]})}},jO=class extends Fr{componentDidMount(){this.subscribe(this.plugin.behaviors.interaction.selectionMode,()=>this.forceUpdate())}render(){return this.plugin.selectionMode?(0,Tn.jsx)("div",{className:"msp-selection-viewport-controls",children:(0,Tn.jsx)(IO,{})}):null}},WO=class extends Fr{constructor(){super(...arguments);this.state={labels:[]}}componentDidMount(){this.subscribe(this.plugin.behaviors.labels.highlight,r=>this.setState({labels:r.labels}))}render(){return this.state.labels.length===0?null:(0,Tn.jsx)("div",{className:"msp-highlight-info",children:this.state.labels.map((r,n)=>r.indexOf(`
`)>=0?(0,Tn.jsx)("div",{className:"msp-highlight-markdown-row",children:(0,Tn.jsx)(o_,{skipHtml:!0,children:r})},""+n):(0,Tn.jsx)("div",{className:"msp-highlight-simple-row",dangerouslySetInnerHTML:{__html:r}},""+n))})}},hY=class extends Fr{componentDidMount(){this.subscribe(this.plugin.state.behaviors.events.changed,()=>this.forceUpdate())}render(){let t=[];return this.plugin.customStructureControls.forEach((r,n)=>{t.push((0,Tn.jsx)(r,{initiallyCollapsed:this.props.initiallyCollapsed},n))}),t.length>0?(0,Tn.jsx)(Tn.Fragment,{children:t}):null}},XO=class extends Fr{render(){return(0,Tn.jsxs)(Tn.Fragment,{children:[(0,Tn.jsxs)("div",{className:"msp-section-header",children:[(0,Tn.jsx)(Dn,{svg:One}),"Structure Tools"]}),(0,Tn.jsx)(_O,{}),(0,Tn.jsx)(TO,{}),(0,Tn.jsx)(GO,{}),(0,Tn.jsx)(UO,{}),(0,Tn.jsx)(yO,{}),this.plugin.config.get(Lr.VolumeStreaming.Enabled)&&(0,Tn.jsx)(LO,{}),(0,Tn.jsx)(VO,{}),(0,Tn.jsx)(hY,{})]})}};var NT=_t(ur()),QO=class extends Fr{get current(){return this.props.state.behaviors.currentObject.value}componentDidMount(){this.subscribe(this.plugin.state.events.object.updated,({ref:t,state:r})=>{let n=this.current;n.ref!==t||n.state!==r||this.forceUpdate()}),this.subscribe(this.plugin.state.data.actions.events.added,()=>this.forceUpdate()),this.subscribe(this.plugin.state.data.actions.events.removed,()=>this.forceUpdate())}render(){let{state:t,nodeRef:r}=this.props,n=t.cells.get(r),o=t.actions.fromCell(n,this.plugin);if(o.length===0)return null;let i=n.transform.transformer.definition,a=n.obj?n.obj.label:i.display&&i.display.name||i.name;return(0,NT.jsxs)("div",{className:"msp-state-actions",children:[!this.props.hideHeader&&(0,NT.jsxs)("div",{className:"msp-section-header",children:[(0,NT.jsx)(Dn,{svg:Hne})," ",`Actions (${a})`]}),o.map((s,l)=>(0,NT.jsx)(m0,{state:t,action:s,nodeRef:r,initiallyCollapsed:l===0?!this.props.alwaysExpandFirst&&this.props.initiallyCollapsed:this.props.initiallyCollapsed},`${s.id}`))]})}};var V1=_t(Mi());var cr=_t(ur()),ZO=class extends Fr{render(){return(0,cr.jsxs)("div",{children:[(0,cr.jsx)(Ef,{icon:PM,title:"Plugin State"}),(0,cr.jsx)("div",{style:{marginBottom:"10px"},children:(0,cr.jsx)(fs,{header:"Save Options",initiallyExpanded:!1,children:(0,cr.jsx)(HD,{})})}),(0,cr.jsx)(gY,{}),(0,cr.jsx)(yY,{}),(0,cr.jsx)(Ef,{title:"Save as File",accent:"blue"}),(0,cr.jsx)(zD,{}),this.plugin.spec.components?.remoteState!=="none"&&(0,cr.jsx)(jD,{})]})}},zD=class extends Fr{constructor(){super(...arguments);this.downloadToFileJson=()=>{this.props.onAction?.(),lt.State.Snapshots.DownloadToFile(this.plugin,{type:"json"})};this.downloadToFileZip=()=>{this.props.onAction?.(),lt.State.Snapshots.DownloadToFile(this.plugin,{type:"zip"})};this.open=r=>{if(!r.target.files||!r.target.files[0]){this.plugin.log.error("No state file selected");return}this.props.onAction?.(),lt.State.Snapshots.OpenFile(this.plugin,{file:r.target.files[0]})}}render(){return(0,cr.jsxs)(cr.Fragment,{children:[(0,cr.jsxs)("div",{className:"msp-flex-row",children:[(0,cr.jsx)(gr,{icon:U2,onClick:this.downloadToFileJson,title:"Save the state description. Input data are loaded using the provided sources. Does not work if local files are used as input.",children:"State"}),(0,cr.jsx)(gr,{icon:U2,onClick:this.downloadToFileZip,title:"Save the state including the input data.",children:"Session"}),(0,cr.jsxs)("div",{className:"msp-btn msp-btn-block msp-btn-action msp-loader-msp-btn-file",children:[(0,cr.jsx)(Dn,{svg:qne,inline:!0})," Open ",(0,cr.jsx)("input",{onChange:this.open,type:"file",multiple:!1,accept:".molx,.molj"})]})]}),(0,cr.jsxs)("div",{className:"msp-help-text",style:{padding:"10px"},children:[(0,cr.jsx)(Dn,{svg:RM})," This is an experimental feature and stored states/sessions might not be openable in a future version."]})]})}},HD=class extends Fr{componentDidMount(){this.subscribe(this.plugin.state.snapshotParams,()=>this.forceUpdate())}render(){return(0,cr.jsx)(uo,{params:yu.SnapshotParams,values:this.plugin.state.snapshotParams.value,onChangeValues:this.plugin.state.setSnapshotParams})}},gY=class e extends Fr{constructor(){super(...arguments);this.state={params:C.getDefaultValues(e.Params)};this.add=()=>{lt.State.Snapshots.Add(this.plugin,{name:this.state.params.name,description:this.state.params.description})};this.updateParams=r=>this.setState({params:r});this.clear=()=>{lt.State.Snapshots.Clear(this.plugin,{})}}static{this.Params={name:C.Text(),description:C.Text()}}shouldComponentUpdate(r,n){return!Gh(this.props,r)||!Gh(this.state,n)}render(){return(0,cr.jsx)("div",{children:(0,cr.jsx)(Dyt,{parent:this})})}};function n3e(e,t,r){return t?e.managers.snapshot.state.entries.some(n=>(!r||n.snapshot.id!==r)&&n.key===t):!1}function Dyt({parent:e}){let[t,r]=V1.useState({key:"",name:"",description:""}),n=()=>{lt.State.Snapshots.Add(e.plugin,{key:t.key,name:t.name,description:t.description}),r({key:"",name:"",description:""})},o=n3e(e.plugin,t.key);return(0,cr.jsxs)(cr.Fragment,{children:[(0,cr.jsx)(o3e,{state:t,setState:r,apply:n}),(0,cr.jsxs)("div",{className:"msp-flex-row",children:[(0,cr.jsx)(sr,{onClick:e.clear,svg:$s,title:"Remove All"}),(0,cr.jsx)(gr,{onClick:n,icon:o?void 0:Bf,style:{textAlign:"right"},commit:o?"off":"on",disabled:o,children:o?"Key must be unique":"Add"})]})]})}var yY=class extends Fr{constructor(){super(...arguments);this.state={editingId:void 0};this.edit=r=>{let n=r.currentTarget.getAttribute("data-id");if(!n)return;let o=this.state.editingId;this.setState({editingId:n===o?void 0:n})};this.doneEdit=()=>this.setState({editingId:void 0});this.apply=r=>{let n=r.currentTarget.getAttribute("data-id");n&&lt.State.Snapshots.Apply(this.plugin,{id:n})};this.remove=r=>{let n=r.currentTarget.getAttribute("data-id");n&&lt.State.Snapshots.Remove(this.plugin,{id:n})};this.moveUp=r=>{let n=r.currentTarget.getAttribute("data-id");n&&lt.State.Snapshots.Move(this.plugin,{id:n,dir:-1})};this.moveDown=r=>{let n=r.currentTarget.getAttribute("data-id");n&&lt.State.Snapshots.Move(this.plugin,{id:n,dir:1})};this.replace=r=>{let n=r.currentTarget.getAttribute("data-id");n&&lt.State.Snapshots.Replace(this.plugin,{id:n})}}componentDidMount(){this.subscribe(this.plugin.managers.snapshot.events.changed,()=>this.forceUpdate())}render(){let r=this.plugin.managers.snapshot.state.current,n=[];return this.plugin.managers.snapshot.state.entries.forEach(o=>{n.push((0,cr.jsxs)("li",{className:"msp-flex-row",children:[(0,cr.jsxs)(gr,{"data-id":o.snapshot.id,onClick:this.apply,className:"msp-no-overflow",children:[(0,cr.jsxs)("span",{style:{fontWeight:o.snapshot.id===r?"bold":void 0},children:[!!o.key&&`[${o.key}] `,o.name||new Date(o.timestamp).toLocaleString()]})," ",(0,cr.jsx)("small",{children:`${o.snapshot.durationInMs?Fv(o.snapshot.durationInMs,!1):""}`})]}),(0,cr.jsx)(sr,{svg:Il,"data-id":o.snapshot.id,title:"Edit",onClick:this.edit,flex:"28px"}),(0,cr.jsx)(sr,{svg:Rx,"data-id":o.snapshot.id,title:"Move Up",onClick:this.moveUp,flex:"20px"}),(0,cr.jsx)(sr,{svg:_x,"data-id":o.snapshot.id,title:"Move Down",onClick:this.moveDown,flex:"20px"}),(0,cr.jsx)(sr,{svg:Jne,"data-id":o.snapshot.id,title:"Replace",onClick:this.replace,flex:"20px"}),(0,cr.jsx)(sr,{svg:$s,"data-id":o.snapshot.id,title:"Remove",onClick:this.remove,flex:"20px"})]},o.snapshot.id)),this.state.editingId===o.snapshot.id&&n.push((0,cr.jsx)(wyt,{entry:o,plugin:this.plugin,done:this.doneEdit},`${o.snapshot.id}-edit`));let i=o.image&&this.plugin.managers.asset.get(o.image)?.file;i&&n.push((0,cr.jsx)("li",{className:"msp-state-image-row",children:(0,cr.jsx)(gr,{"data-id":o.snapshot.id,onClick:this.apply,children:(0,cr.jsx)("img",{draggable:!1,src:URL.createObjectURL(i)})})},`${o.snapshot.id}-image`))}),(0,cr.jsx)(cr.Fragment,{children:(0,cr.jsx)("ul",{style:{listStyle:"none",marginTop:"10px"},className:"msp-state-list",children:n})})}};function o3e({state:e,setState:t,apply:r}){let n=V1.useRef(),o=V1.useRef(),[i,a]=V1.useState(!1);return(0,cr.jsxs)(cr.Fragment,{children:[(0,cr.jsx)(Hl,{label:"Name",control:(0,cr.jsx)("input",{type:"text",value:e.name,placeholder:"Name",onChange:s=>t({...e,name:s.target.value}),onKeyUp:s=>{s.key==="Enter"&&n.current?.focus()}})}),(0,cr.jsx)(Hl,{label:(0,cr.jsxs)(cr.Fragment,{children:["Key",(0,cr.jsx)(Cq,{show:i,toggle:()=>a(s=>!s)})]}),control:(0,cr.jsx)("input",{type:"text",ref:n,value:e.key,placeholder:"Key (optional)",onChange:s=>t({...e,key:s.target.value}),onKeyUp:s=>{s.key==="Enter"&&o.current?.focus()}})}),i&&(0,cr.jsx)("div",{className:"msp-control-offset",children:(0,cr.jsx)(wD,{description:"Optional snapshot key used to activate snapshots from descriptions, labels, etc."})}),(0,cr.jsx)("div",{className:"msp-flex-row msp-text-area-wrapper",style:{marginBottom:1},children:(0,cr.jsx)("textarea",{ref:o,placeholder:`Markdown Description

- Use [title](#key) to link to a snapshot`,className:"msp-form-control",value:e.description,onChange:s=>t({...e,description:s.target.value}),onKeyUp:s=>{s.key==="Enter"&&s.ctrlKey&&r(e)}})})]})}function wyt({entry:e,plugin:t,done:r}){let[n,o]=V1.useState({key:e.key??"",name:e.name??"",description:e.description??"",descriptionFormat:e.descriptionFormat}),i=()=>{t.managers.snapshot.update(e,n),r()},a=n3e(t,n.key,e.snapshot.id);return(0,cr.jsxs)(cr.Fragment,{children:[(0,cr.jsx)(o3e,{state:n,setState:o,apply:i}),(0,cr.jsx)("div",{className:"msp-flex-row",style:{marginBottom:1},children:(0,cr.jsx)(gr,{onClick:i,icon:a?void 0:cd,style:{textAlign:"right"},commit:a?"off":"on",disabled:a,children:a?"Key must be unique":"Apply"})})]})}var jD=class extends Fr{constructor(){super(...arguments);this.Params={name:C.Text(),options:C.Group({description:C.Text(),playOnLoad:C.Boolean(!1),serverUrl:C.Text(this.plugin.config.get(Lr.State.CurrentServer))})};this.state={params:C.getDefaultValues(this.Params),entries:tl(),isBusy:!1};this.ListOnlyParams={options:C.Group({serverUrl:C.Text(this.plugin.config.get(Lr.State.CurrentServer))},{isFlat:!0})};this._mounted=!1;this.refresh=async()=>{try{this.setState({isBusy:!0}),this.plugin.config.set(Lr.State.CurrentServer,this.state.params.options.serverUrl);let r=await this.plugin.runTask(this.plugin.fetch({url:this.serverUrl("list"),type:"json"}))||[];r.sort((o,i)=>o.isSticky===i.isSticky?o.timestamp-i.timestamp:o.isSticky?-1:1);let n=tl().asMutable();for(let o of r)n.set(o.id,{...o,url:this.serverUrl(`get/${o.id}`),removeUrl:this.serverUrl(`remove/${o.id}`)});this._mounted&&this.setState({entries:n.asImmutable(),isBusy:!1})}catch(r){console.error(r),this.plugin.log.error("Error fetching remote snapshots"),this._mounted&&this.setState({entries:tl(),isBusy:!1})}};this.upload=async()=>{this.setState({isBusy:!0}),this.plugin.config.set(Lr.State.CurrentServer,this.state.params.options.serverUrl),await lt.State.Snapshots.Upload(this.plugin,{name:this.state.params.name,description:this.state.params.options.description,playOnLoad:this.state.params.options.playOnLoad,serverUrl:this.state.params.options.serverUrl}),this.plugin.log.message("Snapshot uploaded."),this._mounted&&(this.setState({isBusy:!1}),this.refresh())};this.fetch=async r=>{let n=r.currentTarget.getAttribute("data-id");if(!n)return;let o=this.state.entries.get(n);if(o){this.setState({isBusy:!0});try{await lt.State.Snapshots.Fetch(this.plugin,{url:o.url})}finally{this._mounted&&this.setState({isBusy:!1})}}};this.remove=async r=>{let n=r.currentTarget.getAttribute("data-id");if(!n)return;let o=this.state.entries.get(n);if(o){this.setState({entries:this.state.entries.remove(n)});try{await fetch(o.removeUrl)}catch(i){console.error(i)}}}}componentDidMount(){this.refresh(),this._mounted=!0}componentWillUnmount(){super.componentWillUnmount(),this._mounted=!1}serverUrl(r){return r?NC(this.state.params.options.serverUrl,r):this.state.params.options.serverUrl}render(){return(0,cr.jsxs)(cr.Fragment,{children:[(0,cr.jsx)(Ef,{title:"Remote States",accent:"blue"}),!this.props.listOnly&&(0,cr.jsxs)(cr.Fragment,{children:[(0,cr.jsx)(uo,{params:this.Params,values:this.state.params,onEnter:this.upload,onChange:r=>{this.setState({params:{...this.state.params,[r.name]:r.value}})},isDisabled:this.state.isBusy}),(0,cr.jsxs)("div",{className:"msp-flex-row",children:[(0,cr.jsx)(sr,{onClick:this.refresh,disabled:this.state.isBusy,svg:J0}),(0,cr.jsx)(gr,{icon:zne,onClick:this.upload,disabled:this.state.isBusy,commit:!0,children:"Upload"})]})]}),(0,cr.jsx)(bY,{entries:this.state.entries,isBusy:this.state.isBusy,serverUrl:this.state.params.options.serverUrl,fetch:this.fetch,remove:this.props.listOnly?void 0:this.remove}),this.props.listOnly&&(0,cr.jsxs)("div",{style:{marginTop:"10px"},children:[(0,cr.jsx)(uo,{params:this.ListOnlyParams,values:this.state.params,onEnter:this.upload,onChange:r=>{this.setState({params:{...this.state.params,[r.name]:r.value}})},isDisabled:this.state.isBusy}),(0,cr.jsx)("div",{className:"msp-flex-row",children:(0,cr.jsx)(gr,{onClick:this.refresh,disabled:this.state.isBusy,icon:J0,children:"Refresh"})})]})]})}},bY=class extends bi{constructor(){super(...arguments);this.open=async r=>{let n=r.currentTarget.getAttribute("data-id");if(!n)return;let o=this.props.entries.get(n);if(!o)return;r.preventDefault();let i=`${window.location}`,a=i.indexOf("?");a>0&&(i=i.substr(0,a)),window.open(`${i}?snapshot-url=${encodeURIComponent(o.url)}`,"_blank")}}render(){return(0,cr.jsx)("ul",{style:{listStyle:"none",marginTop:"10px"},className:"msp-state-list",children:this.props.entries.valueSeq().map(r=>(0,cr.jsxs)("li",{className:"msp-flex-row",children:[(0,cr.jsxs)(gr,{"data-id":r.id,onClick:this.props.fetch,disabled:this.props.isBusy,onContextMenu:this.open,title:"Click to download, right-click to open in a new tab.",children:[r.name||new Date(r.timestamp).toLocaleString()," ",(0,cr.jsx)("small",{children:r.description})]}),!r.isSticky&&this.props.remove&&(0,cr.jsx)(sr,{svg:$s,"data-id":r.id,title:"Remove",onClick:this.props.remove,disabled:this.props.isBusy,small:!0})]},r.id))})}};var $o=_t(ur()),WD=class extends Fr{constructor(){super(...arguments);this.state={showActions:!0}}componentDidMount(){this.subscribe(this.plugin.state.events.cell.created,r=>{r.cell.transform.parent===Br.RootRef&&this.forceUpdate()}),this.subscribe(this.plugin.state.events.cell.removed,r=>{r.parent===Br.RootRef&&this.forceUpdate()})}static getDerivedStateFromProps(r,n){let o=r.state.tree.root.ref,a=r.state.tree.children.get(o).size===0;return n.showActions===a?null:{showActions:a}}render(){let r=this.props.state.tree.root.ref;return this.state.showActions?(0,$o.jsxs)("div",{style:{margin:"10px",cursor:"default"},children:[(0,$o.jsx)("p",{children:"Nothing to see here yet."}),(0,$o.jsxs)("p",{children:["Structures and Volumes can be loaded from the ",(0,$o.jsx)(Dn,{svg:N2})," tab."]})]}):(0,$o.jsx)(xY,{cell:this.props.state.cells.get(r),depth:0})}},xY=class e extends Fr{constructor(){super(...arguments);this.state={isCollapsed:!!this.props.cell.state.isCollapsed,isNull:e.isNull(this.props.cell),showLabel:e.showLabel(this.props.cell)}}is(r){return r.ref===this.ref&&r.state===this.props.cell.parent}get ref(){return this.props.cell.transform.ref}componentDidMount(){this.subscribe(this.plugin.state.events.cell.stateUpdated,r=>{this.props.cell===r.cell&&this.is(r)&&r.state.cells.has(this.ref)&&(this.state.isCollapsed!==!!r.cell.state.isCollapsed||this.state.isNull!==e.isNull(r.cell)||this.state.showLabel!==e.showLabel(r.cell))&&this.forceUpdate()}),this.subscribe(this.plugin.state.events.cell.created,r=>{this.props.cell.parent===r.state&&this.ref===r.cell.transform.parent&&this.forceUpdate()}),this.subscribe(this.plugin.state.events.cell.removed,r=>{this.props.cell.parent===r.state&&this.ref===r.parent&&this.forceUpdate()})}static getDerivedStateFromProps(r,n){let o=e.isNull(r.cell),i=e.showLabel(r.cell);return!!r.cell.state.isCollapsed===n.isCollapsed&&n.isNull===o&&n.showLabel===i?null:{isCollapsed:!!r.cell.state.isCollapsed,isNull:o,showLabel:i}}static hasDecorator(r){let n=r.parent.tree.children.get(r.transform.ref);if(n.size!==1)return!1;let o=n.first();return!!o&&!!r.parent?.tree.transforms.get(o).transformer.definition.isDecorator}static isNull(r){return!r||!r.parent||r.obj===Gn.Null||!r.parent.tree.transforms.has(r.transform.ref)}static showLabel(r){return r.transform.ref!==Br.RootRef&&(r.status!=="ok"||!r.state.isGhost&&!e.hasDecorator(r))}render(){if(this.state.isNull)return null;let r=this.props.cell,n=r.parent.tree.children.get(this.ref);if(!this.state.showLabel)return n.size===0?null:(0,$o.jsx)($o.Fragment,{children:n.map(i=>(0,$o.jsx)(e,{cell:r.parent.cells.get(i),depth:this.props.depth},i))});let o=this.props.depth+1;return(0,$o.jsxs)($o.Fragment,{children:[(0,$o.jsx)(CY,{cell:r,depth:this.props.depth}),n.size===0?void 0:(0,$o.jsx)("div",{style:{display:this.state.isCollapsed?"none":"block"},children:n.map(i=>(0,$o.jsx)(e,{cell:r.parent.cells.get(i),depth:o},i))})]})}},CY=class extends Fr{constructor(){super(...arguments);this.state={isCurrent:this.props.cell.parent.current===this.ref,isCollapsed:!!this.props.cell.state.isCollapsed,action:void 0,currentAction:void 0};this.setCurrent=r=>{r?.preventDefault(),r?.currentTarget.blur(),lt.State.SetCurrentObject(this.plugin,{state:this.props.cell.parent,ref:this.ref})};this.setCurrentRoot=r=>{r?.preventDefault(),r?.currentTarget.blur(),this.props.cell.parent&&lt.State.SetCurrentObject(this.plugin,{state:this.props.cell.parent,ref:Br.RootRef})};this.remove=r=>{r?.preventDefault(),lt.State.RemoveObject(this.plugin,{state:this.props.cell.parent,ref:this.ref,removeParentGhosts:!0})};this.toggleVisible=r=>{r.preventDefault(),lt.State.ToggleVisibility(this.plugin,{state:this.props.cell.parent,ref:this.ref}),r.currentTarget.blur()};this.toggleExpanded=r=>{r.preventDefault(),lt.State.ToggleExpanded(this.plugin,{state:this.props.cell.parent,ref:this.ref}),r.currentTarget.blur()};this.highlight=r=>{r.preventDefault(),lt.Interactivity.Object.Highlight(this.plugin,{state:this.props.cell.parent,ref:this.ref}),r.currentTarget.blur()};this.clearHighlight=r=>{r.preventDefault(),lt.Interactivity.ClearHighlights(this.plugin),r.currentTarget.blur()};this.hideApply=()=>{this.setCurrentRoot()};this.selectAction=r=>{r&&(r?.value)()}}is(r){return r.ref===this.ref&&r.state===this.props.cell.parent}get ref(){return this.props.cell.transform.ref}componentDidMount(){this.subscribe(this.plugin.state.events.cell.stateUpdated.pipe(Rh(r=>this.is(r)),Zb(33)),r=>{this.forceUpdate()}),this.subscribe(this.props.cell.parent.behaviors.currentObject,r=>{if(!this.is(r)){this.state.isCurrent&&r.state.transforms.has(this.ref)&&this._setCurrent(this.props.cell.parent.current===this.ref,this.state.isCollapsed);return}r.state.transforms.has(this.ref)&&this._setCurrent(this.props.cell.parent.current===this.ref,!!this.props.cell.state.isCollapsed)})}_setCurrent(r,n){r?this.setState({isCurrent:r,action:"options",currentAction:void 0,isCollapsed:n}):this.setState({isCurrent:r,action:void 0,currentAction:void 0,isCollapsed:n})}static getDerivedStateFromProps(r,n){let o=r.cell.parent.current===r.cell.transform.ref,i=!!r.cell.state.isCollapsed;return n.isCollapsed===i&&n.isCurrent===o?null:{isCurrent:o,isCollapsed:i,action:void 0,currentAction:void 0}}get actions(){let r=this.props.cell,n=[...r.parent.actions.fromCell(r,this.plugin)];if(n.length!==0)return n.sort((o,i)=>o.definition.display.name<i.definition.display.name?-1:o.definition.display.name===i.definition.display.name?0:1),[Rr.Header("Apply Action"),...n.map(o=>Rr.Item(o.definition.display.name,()=>this.setState({action:"apply",currentAction:o})))]}updates(r){let n=this.props.cell,o=IS.getDecoratorChain(n.parent,n.transform.ref),i=[];for(let a=o.length-1;a>=0;a--){let s=o[a];i.push((0,$o.jsx)(vc,{state:n.parent,transform:s.transform,noMargin:!0,wrapInExpander:!0,expanderHeaderLeftMargin:r},`${s.transform.transformer.id}-${a}`))}return(0,$o.jsx)("div",{className:"msp-tree-updates-wrapper",children:i})}render(){let r=this.props.cell,n=r.transform;if(!r)return null;let o=this.is(r.parent.behaviors.currentObject.value),i=r.status!=="error"&&r.status!=="ok",a;if(r.status==="error"||!r.obj){let h=r.status==="error"?r.errorText:n.transformer.definition.display.name;a=(0,$o.jsxs)(gr,{className:"msp-btn-tree-label msp-no-hover-outline",noOverflow:!0,title:h,onClick:this.state.isCurrent?this.setCurrentRoot:this.setCurrent,disabled:i,children:[r.status==="error"&&(0,$o.jsxs)("b",{children:["[",r.status,"]"]})," ",(0,$o.jsx)("span",{children:h})]})}else{let h=r.obj,f=`${h.label} ${h.description?h.description:""}`;a=(0,$o.jsxs)(gr,{className:`msp-btn-tree-label msp-type-class-${h.type.typeClass}`,noOverflow:!0,disabled:i,title:f,onClick:this.state.isCurrent?this.setCurrentRoot:this.setCurrent,children:[(0,$o.jsx)("span",{children:h.label})," ",h.description?(0,$o.jsx)("small",{children:h.description}):void 0]})}let s=r.parent.tree.children.get(this.ref),l=r.state,u=(0,$o.jsx)(sr,{svg:l.isCollapsed?tc:ec,flex:"20px",disabled:i,onClick:this.toggleExpanded,transparent:!0,className:"msp-no-hover-outline",style:{visibility:s.size>0?"visible":"hidden"}}),c=r.state.isLocked?void 0:(0,$o.jsx)(sr,{svg:$s,onClick:this.remove,disabled:i,small:!0,toggleState:!1}),m=(0,$o.jsx)(sr,{svg:l.isHidden?md:vm,toggleState:!1,disabled:i,small:!0,onClick:this.toggleVisible}),d={marginLeft:`${this.props.depth*8}px`},p=(0,$o.jsxs)("div",{className:`msp-flex-row msp-tree-row${o?" msp-tree-row-current":""}`,onMouseEnter:this.highlight,onMouseLeave:this.clearHighlight,style:d,children:[u,a,c,m]});if(!o)return p;if(this.state.action==="apply"&&this.state.currentAction)return(0,$o.jsxs)("div",{style:{marginBottom:"1px"},children:[p,(0,$o.jsx)(zl,{header:`Apply ${this.state.currentAction.definition.display.name}`,initialExpanded:!0,hideExpander:!0,hideOffset:!1,onHeaderClick:this.hideApply,topRightIcon:Bc,headerLeftMargin:`${this.props.depth*8+21}px`,children:(0,$o.jsx)(m0,{onApply:this.hideApply,state:this.props.cell.parent,action:this.state.currentAction,nodeRef:this.props.cell.transform.ref,hideHeader:!0,noMargin:!0})})]});if(this.state.action==="options"){let h=this.actions,f=this.updates(`${this.props.depth*8+21}px`);return(0,$o.jsxs)("div",{style:{marginBottom:"1px"},children:[p,f,h&&(0,$o.jsx)("div",{style:{marginLeft:`${this.props.depth*8+21}px`,marginTop:"-1px"},children:(0,$o.jsx)(Rr,{items:h,onSelect:this.selectAction})})]})}return p}};var _n=_t(ur()),SY=class extends Fr{componentDidMount(){this.subscribe(this.plugin.state.behaviors.events.changed,()=>this.forceUpdate())}render(){let t=[];return this.plugin.customImportControls.forEach((r,n)=>{t.push((0,_n.jsx)(r,{initiallyCollapsed:this.props.initiallyCollapsed},n))}),t.length>0?(0,_n.jsx)(_n.Fragment,{children:t}):null}},qO=class extends Fr{constructor(){super(...arguments);this.state={tab:this.plugin.behaviors.layout.leftPanelTabName.value};this.set=r=>{if(this.state.tab===r){this.setState({tab:"none"},()=>this.plugin.behaviors.layout.leftPanelTabName.next("none")),lt.Layout.Update(this.plugin,{state:{regionState:{...this.plugin.layout.state.regionState,left:"collapsed"}}});return}this.setState({tab:r},()=>this.plugin.behaviors.layout.leftPanelTabName.next(r)),this.plugin.layout.state.regionState.left!=="full"&&lt.Layout.Update(this.plugin,{state:{regionState:{...this.plugin.layout.state.regionState,left:"full"}}})};this.tabs={none:(0,_n.jsx)(_n.Fragment,{}),root:(0,_n.jsxs)(_n.Fragment,{children:[(0,_n.jsx)(Ef,{icon:N2,title:"Home"}),(0,_n.jsx)(QO,{state:this.plugin.state.data,nodeRef:Br.RootRef,hideHeader:!0,initiallyCollapsed:!0,alwaysExpandFirst:!0}),(0,_n.jsx)(SY,{}),this.plugin.spec.components?.remoteState!=="none"&&(0,_n.jsx)(jD,{listOnly:!0})]}),data:(0,_n.jsxs)(_n.Fragment,{children:[(0,_n.jsx)(Ef,{icon:N5,title:(0,_n.jsxs)(_n.Fragment,{children:[(0,_n.jsx)(AY,{})," State Tree"]})}),(0,_n.jsx)(WD,{state:this.plugin.state.data})]}),states:(0,_n.jsx)(ZO,{}),settings:(0,_n.jsxs)(_n.Fragment,{children:[(0,_n.jsx)(Ef,{icon:Il,title:"Plugin Settings"}),(0,_n.jsx)(IY,{})]}),help:(0,_n.jsxs)(_n.Fragment,{children:[(0,_n.jsx)(Ef,{icon:Du,title:"Help"}),(0,_n.jsx)(CO,{})]})}}componentDidMount(){this.subscribe(this.plugin.behaviors.layout.leftPanelTabName,r=>{this.state.tab!==r&&this.setState({tab:r}),r==="none"&&this.plugin.layout.state.regionState.left!=="collapsed"&&lt.Layout.Update(this.plugin,{state:{regionState:{...this.plugin.layout.state.regionState,left:"collapsed"}}})}),this.subscribe(this.plugin.state.data.events.changed,({state:r})=>{this.state.tab==="data"&&r.cells.size===1&&this.set("root")})}render(){let r=this.state.tab;return(0,_n.jsxs)("div",{className:"msp-left-panel-controls",children:[(0,_n.jsxs)("div",{className:"msp-left-panel-controls-buttons",children:[(0,_n.jsx)(sr,{svg:N2,toggleState:r==="root",transparent:!0,onClick:()=>this.set("root"),title:"Home"}),(0,_n.jsx)(vY,{set:this.set}),(0,_n.jsx)(sr,{svg:PM,toggleState:r==="states",transparent:!0,onClick:()=>this.set("states"),title:"Plugin State"}),(0,_n.jsx)(sr,{svg:Du,toggleState:r==="help",transparent:!0,onClick:()=>this.set("help"),title:"Help"}),(0,_n.jsx)("div",{className:"msp-left-panel-controls-buttons-bottom",children:(0,_n.jsx)(sr,{svg:Il,toggleState:r==="settings",transparent:!0,onClick:()=>this.set("settings"),title:"Settings"})})]}),(0,_n.jsx)("div",{className:"msp-scrollable-container",children:this.tabs[r]})]})}},vY=class extends Fr{constructor(){super(...arguments);this.state={changed:!1}}get tab(){return this.plugin.behaviors.layout.leftPanelTabName.value}componentDidMount(){this.subscribe(this.plugin.behaviors.layout.leftPanelTabName,r=>{this.tab==="data"?this.setState({changed:!1}):this.forceUpdate()}),this.subscribe(this.plugin.state.data.events.changed,r=>{this.tab!=="data"&&this.setState({changed:!0})})}render(){return(0,_n.jsx)(sr,{svg:N5,toggleState:this.tab==="data",transparent:!0,onClick:()=>this.props.set("data"),title:"State Tree",style:{position:"relative"},extraContent:this.state.changed?(0,_n.jsx)("div",{className:"msp-left-panel-controls-button-data-dirty"}):void 0})}},IY=class extends Fr{constructor(){super(...arguments);this.setSettings=r=>{lt.Canvas3D.SetSettings(this.plugin,{settings:{[r.name]:r.value}})};this.setCanvas3DContextProps=r=>{this.plugin.canvas3dContext?.setProps({[r.name]:r.value}),this.plugin.events.canvas3d.settingsUpdated.next(void 0)}}componentDidMount(){this.subscribe(this.plugin.events.canvas3d.settingsUpdated,()=>this.forceUpdate()),this.subscribe(this.plugin.layout.events.updated,()=>this.forceUpdate()),this.plugin.canvas3d&&this.subscribe(this.plugin.canvas3d.camera.stateChanged.pipe(Xu(500,void 0,{leading:!0,trailing:!0})),r=>{(r.radiusMax!==void 0||r.radius!==void 0)&&this.forceUpdate()})}render(){return(0,_n.jsxs)(_n.Fragment,{children:[this.plugin.canvas3d&&this.plugin.canvas3dContext&&(0,_n.jsxs)(_n.Fragment,{children:[(0,_n.jsx)(Ef,{title:"Viewport"}),(0,_n.jsx)(uo,{params:Na,values:this.plugin.canvas3d.props,onChange:this.setSettings}),(0,_n.jsx)(uo,{params:lh.Params,values:this.plugin.canvas3dContext.props,onChange:this.setCanvas3DContextProps})]}),(0,_n.jsx)(Ef,{title:"Behavior"}),(0,_n.jsx)(WD,{state:this.plugin.state.behaviors})]})}},AY=class extends Fr{constructor(){super(...arguments);this.remove=r=>{r.preventDefault(),lt.State.RemoveObject(this.plugin,{state:this.plugin.state.data,ref:Br.RootRef})}}componentDidMount(){this.subscribe(this.plugin.state.events.cell.created,r=>{r.cell.transform.parent===Br.RootRef&&this.forceUpdate()}),this.subscribe(this.plugin.state.events.cell.removed,r=>{r.parent===Br.RootRef&&this.forceUpdate()})}render(){return this.plugin.state.data.tree.children.get(Br.RootRef).size===0?null:(0,_n.jsx)(sr,{svg:$s,onClick:this.remove,title:"Remove All",style:{display:"inline-block"},small:!0,className:"msp-no-hover-outline",transparent:!0})}};var u3e=_t(Mi());var a3e=_t(Mi());var YO=_t(ur()),i3e=5,TY={selected:"rgb(51, 255, 25)",highlighted:"rgb(255, 102, 153)",focused:""},KO=class extends Fr{constructor(){super(...arguments);this.parentDiv=a3e.createRef();this.lastMouseOverSeqIdx=-1;this.highlightQueue=new Pn;this.markerColors={...TY};this.customColorThemeWrapper=void 0;this.customColorFunction=void 0;this.lociHighlightProvider=(r,n)=>{this.props.sequenceWrapper.markResidue(r.loci,n)&&this.updateMarker()};this.lociSelectionProvider=(r,n)=>{this.props.sequenceWrapper.markResidue(r.loci,n)&&this.updateMarker()};this.contextMenu=r=>{r.preventDefault()};this.mouseDownLoci=void 0;this.mouseDown=r=>{r.stopPropagation();let n=this.getSeqIdx(r),o=this.getLoci(n);this.mouseDownLoci=o};this.mouseUp=r=>{if(r.stopPropagation(),this.mouseDownLoci===void 0)return;let n=this.getSeqIdx(r),o=this.getLoci(n);if(o){let i=m1(r.nativeEvent),a=qA(r.nativeEvent),s=CL(r.nativeEvent),l=o;if(!Q.Loci.areEqual(this.mouseDownLoci,o)){let u=this.mouseDownLoci.elements[0],c=o.elements[0],m=Math.min(xe.min(u.indices),xe.min(c.indices)),d=Math.max(xe.max(u.indices),xe.max(c.indices));l=Q.Loci(o.structure,[{unit:u.unit,indices:xe.ofRange(m,d)}])}this.click(l,i,a,s)}this.mouseDownLoci=void 0};this.location=Q.Location.create(void 0);this.mouseMove=r=>{r.stopPropagation();let n=m1(r.nativeEvent),o=qA(r.nativeEvent),i=CL(r.nativeEvent),a=r.target;if(!a||!a.getAttribute){if(this.lastMouseOverSeqIdx===-1)return;this.lastMouseOverSeqIdx=-1,this.highlightQueue.next({seqIdx:-1,buttons:n,button:o,modifiers:i});return}let s=a.hasAttribute("data-seqid")?+a.getAttribute("data-seqid"):-1;if(this.lastMouseOverSeqIdx!==s)if(this.lastMouseOverSeqIdx=s,this.mouseDownLoci!==void 0){let l=this.getLoci(s);this.hover(l,Ai.Flag.None,Ai.Flag.None,i)}else this.highlightQueue.next({seqIdx:s,buttons:n,button:o,modifiers:i})};this.mouseLeave=r=>{if(r.stopPropagation(),this.mouseDownLoci=void 0,this.lastMouseOverSeqIdx===-1)return;this.lastMouseOverSeqIdx=-1;let n=m1(r.nativeEvent),o=qA(r.nativeEvent),i=CL(r.nativeEvent);this.highlightQueue.next({seqIdx:-1,buttons:n,button:o,modifiers:i})}}get sequenceNumberPeriod(){return this.props.sequenceNumberPeriod!==void 0?this.props.sequenceNumberPeriod:this.props.sequenceWrapper.length>10?10:this.getSequenceNumber(this.props.sequenceWrapper.length-1).length>1?5:1}componentDidMount(){this.plugin.managers.interactivity.lociHighlights.addProvider(this.lociHighlightProvider),this.plugin.managers.interactivity.lociSelects.addProvider(this.lociSelectionProvider),this.subscribe(this.highlightQueue.pipe(Xu(3*16.666,void 0,{leading:!0,trailing:!0})),n=>{let o=this.getLoci(n.seqIdx<0?void 0:n.seqIdx);this.hover(o,n.buttons,n.button,n.modifiers)}),this.subscribe(this.plugin.managers.structure.focus.behaviors.current,n=>{this.updateFocus(n?.loci),this.updateMarker()}),this.updateColors(),lt.Canvas3D.SetSettings.subscribe(this.plugin,()=>{this.updateColors(),this.updateMarker()});let r=this.plugin.customUIState.experimentalSequenceColorTheme;r&&this.subscribe(r,n=>{!n&&!this.customColorThemeWrapper||(this.customColorThemeWrapper=Myt(this.plugin,n,()=>this.forceUpdate()),this.forceUpdate())})}updateColors(){this.plugin.canvas3d?(this.markerColors.highlighted=Le.toHexStyle(this.plugin.canvas3d.props.renderer.highlightColor),this.markerColors.selected=Le.toHexStyle(this.plugin.canvas3d.props.renderer.selectColor)):(this.markerColors.highlighted=TY.highlighted,this.markerColors.selected=TY.selected)}updateFocus(r){this.props.sequenceWrapper.markResidue(Mg,"unfocus"),r&&this.props.sequenceWrapper.markResidue(r,"focus")}componentWillUnmount(){super.componentWillUnmount(),this.plugin.managers.interactivity.lociHighlights.removeProvider(this.lociHighlightProvider),this.plugin.managers.interactivity.lociSelects.removeProvider(this.lociSelectionProvider)}getLoci(r){if(r!==void 0){let n=this.props.sequenceWrapper.getLoci(r);if(!Q.Loci.isEmpty(n))return n}}getSeqIdx(r){let n,o=r.target;return o&&o.getAttribute&&(n=o.hasAttribute("data-seqid")?+o.getAttribute("data-seqid"):void 0),n}hover(r,n,o,i){let a={current:Ut.Loci.Empty,buttons:n,button:o,modifiers:i};if(r!==void 0&&!Q.Loci.isEmpty(r)&&(a.current={loci:r},this.mouseDownLoci)){let s=this.mouseDownLoci.elements[0],l=r.elements[0],u=Math.min(xe.min(s.indices),xe.min(l.indices)),c=Math.max(xe.max(s.indices),xe.max(l.indices)),m=Q.Loci(r.structure,[{unit:s.unit,indices:xe.ofRange(u,c)}]);a.current={loci:m}}this.plugin.behaviors.interaction.hover.next(a)}click(r,n,o,i){let a={current:Ut.Loci.Empty,buttons:n,button:o,modifiers:i};r!==void 0&&!Q.Loci.isEmpty(r)&&(a.current={loci:r}),this.plugin.behaviors.interaction.click.next(a)}getBackgroundColor(r){let n=this.props.sequenceWrapper;return n.isHighlighted(r)&&this.markerColors.highlighted?this.markerColors.highlighted:n.isSelected(r)&&this.markerColors.selected?this.markerColors.selected:n.isFocused(r)&&this.markerColors.focused?this.markerColors.focused:this.customColorFunction?this.customColorFunction(r):""}getResidueClass(r,n){let o=this.props.sequenceWrapper,i=[o.residueClass(r)];return n.length>1&&i.push(r===0?"msp-sequence-residue-long-begin":"msp-sequence-residue-long"),o.isHighlighted(r)&&i.push("msp-sequence-residue-highlighted"),o.isSelected(r)&&i.push("msp-sequence-residue-selected"),o.isFocused(r)&&i.push("msp-sequence-residue-focused"),i.join(" ")}residue(r,n){return(0,YO.jsx)("span",{"data-seqid":r,style:{backgroundColor:this.getBackgroundColor(r)},className:this.getResidueClass(r,n),children:`\u200B${n}\u200B`},r)}getSequenceNumberClass(r,n,o){let i=["msp-sequence-number"];return n.startsWith("-")?o.length>1&&r>0?i.push("msp-sequence-number-long-negative"):i.push("msp-sequence-number-negative"):o.length>1&&r>0&&i.push("msp-sequence-number-long"),i.join(" ")}getSequenceNumber(r){let n="",o=this.props.sequenceWrapper.getLoci(r),i=Q.Loci.getFirstLocation(o,this.location);if(i)if(ue.isAtomic(i.unit)){let a=Ke.residue.auth_seq_id(i),s=Ke.residue.pdbx_PDB_ins_code(i);n=`${a}${s||""}`}else ue.isCoarse(i.unit)&&(n=`${r+1}`);return n}padSeqNum(r){return r.length<i3e?r+new Array(i3e-r.length+1).join("\xA0"):r}getSequenceNumberSpan(r,n){let o=this.getSequenceNumber(r);return(0,YO.jsx)("span",{className:this.getSequenceNumberClass(r,o,n),children:this.padSeqNum(o)},`marker-${r}`)}updateMarker(){if(!this.parentDiv.current)return;let r=this.parentDiv.current.children,n=!this.props.hideSequenceNumbers,o=this.sequenceNumberPeriod,i=this.props.sequenceWrapper,a=i.length,s=0;for(let l=0;l<a;l++){n&&l%o===0&&l<a&&s++;let u=r[s];if(!u)return;s++;let c=this.getResidueClass(l,i.residueLabel(l));u.className!==c&&(u.className=c);let m=this.getBackgroundColor(l);u.style.backgroundColor!==m&&(u.style.backgroundColor=m)}}render(){let r=this.props.sequenceWrapper,n=[];this.customColorThemeWrapper&&(this.customColorFunction=this.customColorThemeWrapper.getColorFunction(r));let o=!this.props.hideSequenceNumbers,i=this.sequenceNumberPeriod;for(let a=0,s=r.length;a<s;++a){let l=r.residueLabel(a);o&&a%i===0&&a<s&&(n[n.length]=this.getSequenceNumberSpan(a,l)),n[n.length]=this.residue(a,l)}return this.updateFocus(this.plugin.managers.structure.focus.behaviors.current.value?.loci),this.updateMarker(),(0,YO.jsx)("div",{className:"msp-sequence-wrapper",onContextMenu:this.contextMenu,onMouseDown:this.mouseDown,onMouseUp:this.mouseUp,onMouseMove:this.mouseMove,onMouseLeave:this.mouseLeave,ref:this.parentDiv,children:n})}};function Myt(e,t,r){let n=Q.Location.create();function o(a,s,l){let u=a.getLoci(s);if(!u||Q.Loci.isEmpty(u))return"";Q.Loci.getFirstLocation(u,n);let c=l(n,!1);return c<0?"":Le.toHexStyle(c)}let i=es(a=>{if(!t)return;let s=a.getLoci(0)?.structure;if(!s)return;let l,u=t.getProps?.({structure:s})??t.provider.defaultValues;t.provider.ensureCustomProperties?e.runTask(Ae.create("Attach custom properties for coloring theme",async m=>{try{await t.provider.ensureCustomProperties?.attach({assetManager:e.managers.asset,runtime:m},{structure:s})}catch(d){console.warn(`Failed to attach custom properties needed for coloring theme ${t.provider.name}:`,d)}finally{l=t.provider.factory({structure:s},u).color,r()}})):l=t.provider.factory({structure:s},u).color;let c={};return m=>l?c[m]??=o(a,m,l):""});return{themeName:t?.provider.name,getColorFunction:i}}var ry=class{constructor(t,r){this.data=t;this.length=r;this.markerArray=new Uint8Array(r),this.focusMarkerArray=new Uint8Array(r)}mark(t,r){let n=this.getSeqIndices(t);return xe.size(n)===0?!1:PC(this.markerArray,n,r)}markResidue(t,r){return r==="focus"?this.markResidueFocus(t,!0):r==="unfocus"?this.markResidueFocus(t,!1):xa(t)?PC(this.markerArray,ye.ofLength(this.length),r):this.mark(t,r)}markResidueFocus(t,r){let n=r?1:0;if(xa(t))return this.focusMarkerArray.fill(n,0,this.length),!0;{let o=this.getSeqIndices(t);return xe.forEach(o,i=>this.focusMarkerArray[i]=n),xe.size(o)>0}}isHighlighted(t){return!!(this.markerArray[t]&1)}isSelected(t){return!!(this.markerArray[t]&2)}isFocused(t){return!!this.focusMarkerArray[t]}};var JO=class extends ry{seqId(t){return this.sequence.seqId.value(t)}residueLabel(t){return this.sequence.label.value(t)||this.sequence.code.value(t)}residueColor(t){return this.missing.has(this.modelNum,this.asymId,this.seqId(t))?Lt.grey:Lt.black}residueClass(t){return this.missing.has(this.modelNum,this.asymId,this.seqId(t))?"msp-sequence-missing":"msp-sequence-present"}getSeqIndices(t){let{structure:r}=this.data,n=o=>this.sequence.index(o);if(Q.Loci.is(t)){if(!De.areRootsEquivalent(t.structure,r))return ye.Empty;t=Q.Loci.remap(t,r);let o=[];for(let i of t.elements)this.unitMap.has(i.unit.id)&&(ue.isAtomic(i.unit)?Eyt(o,i,n):kyt(o,i,n));return Be.deduplicate(Be.ofSortedArray(o))}else if(De.isLoci(t))return De.areRootsEquivalent(t.structure,r)?this.observed:ye.Empty;return ye.Empty}getLoci(t){let r=Byt(this.data.units[0].chainGroupId,this.data.units[0].conformation.operator.name,this.seqId(t));return ut.toLociWithSourceUnits(GE.run(r,this.data.structure))}constructor(t){let r=Q.Location.create(t.structure,t.units[0],t.units[0].elements[0]),n=t.units[0].model.sequence.byEntityKey[Ke.entity.key(r)],o=n.sequence.length;super(t,o),this.unitMap=new Map;for(let a of t.units)this.unitMap.set(a.id,a);this.sequence=n.sequence,this.missing=t.units[0].model.properties.missingResidues,this.modelNum=t.units[0].model.modelNum,this.asymId=ue.isAtomic(t.units[0])?Ke.chain.label_asym_id(r):Ke.coarse.asym_id(r);let i=[];for(let a=0;a<o;++a)this.missing.has(this.modelNum,this.asymId,this.seqId(a))&&i.push(a);this.observed=xe.subtract(ye.ofBounds(0,o),Be.ofSortedArray(i))}};function Byt(e,t,r){return Xn.generators.atoms({unitTest:n=>Ke.unit.chainGroupId(n.element)===e&&Ke.unit.operator_name(n.element)===t,residueTest:n=>n.element.unit.kind===ue.Kind.Atomic?Ke.residue.label_seq_id(n.element)===r:Ke.coarse.seq_id_begin(n.element)<=r&&Ke.coarse.seq_id_end(n.element)>=r})}function Eyt(e,t,r){let{model:n,elements:o}=t.unit,{index:i}=n.atomicHierarchy.residueAtomSegments,{label_seq_id:a}=n.atomicHierarchy.residues;return xe.forEachSegment(t.indices,s=>i[o[s]],s=>{let l=a.value(s),u=r(l);e.push(u)}),!0}function kyt(e,t,r){let{model:n,elements:o}=t.unit,i=ue.isSpheres(t.unit)?n.coarseHierarchy.spheres.seq_id_begin:n.coarseHierarchy.gaussians.seq_id_begin,a=ue.isSpheres(t.unit)?n.coarseHierarchy.spheres.seq_id_end:n.coarseHierarchy.gaussians.seq_id_end;return xe.forEach(t.indices,s=>{let l=o[s];for(let u=r(i.value(l)),c=r(a.value(l));u<=c;u++)e.push(u)}),!0}var $O=class extends ry{residueLabel(t){return this.sequence[t]}residueColor(t){return Lt.black}residueClass(t){return"msp-sequence-present"}getSeqIndices(t){let{structure:r}=this.data;if(Q.Loci.is(t)){if(!De.areRootsEquivalent(t.structure,r))return ye.Empty;t=Q.Loci.remap(t,r);let n=[];for(let o of t.elements){let i=this.unitMap.get(o.unit.id);if(i){let{index:a}=o.unit.model.atomicHierarchy.residueAtomSegments;xe.forEach(o.indices,s=>{let l=this.sequenceIndices.get(a[i.elements[s]]);l!==void 0&&n.push(l)})}}return Be.deduplicate(Be.ofSortedArray(n))}else if(De.isLoci(t))return De.areRootsEquivalent(t.structure,r)?ye.ofBounds(0,this.length):ye.Empty;return ye.Empty}getLoci(t){let r=[],n=this.residueIndices.get(t);if(n!==void 0){let o=this.seqToUnit.get(t),{offsets:i}=o.model.atomicHierarchy.residueAtomSegments,a=Be.findPredecessorIndex(o.elements,i[n]),s=Be.findPredecessorIndex(o.elements,i[n+1]);r.push({unit:o,indices:ye.ofBounds(a,s)})}return Q.Loci(this.data.structure,r)}constructor(t){let r=[],n=new Map,o=new Map,i=new Map;for(let s=0,l=t.units.length;s<l;++s){let u=t.units[s],{residueAtomSegments:c,atoms:m}=u.model.atomicHierarchy,d=Kt.transientSegments(c,u.elements);for(;d.hasNext;){let{index:p}=d.move();n.set(p,r.length),o.set(r.length,p),i.set(r.length,u),r.push(m.label_comp_id.value(c.offsets[p]))}}let a=r.length;super(t,a),this.unitMap=new Map;for(let s of t.units)this.unitMap.set(s.id,s);this.sequence=r,this.sequenceIndices=n,this.residueIndices=o,this.seqToUnit=i}};var zT=class extends ry{residueLabel(t){return this.label}residueColor(t){return Lt.black}residueClass(t){return"msp-sequence-present"}getSeqIndices(t){let{structure:r}=this.data;if(Q.Loci.is(t)){if(!De.areRootsEquivalent(t.structure,r))return ye.Empty;t=Q.Loci.remap(t,r);for(let n of t.elements){let o=this.unitIndices.get(n.unit.id);if(o&&xe.isSubset(o,n.indices))return ye.ofSingleton(0)}}else if(De.isLoci(t))return De.areRootsEquivalent(t.structure,r)?ye.ofSingleton(0):ye.Empty;return ye.Empty}getLoci(t){return this.loci}constructor(t){let r=0,n=0,o=[],i=Q.Location.create(t.structure),a=new Map,s=[];for(let u=0,c=t.units.length;u<c;++u){let m=t.units[u];Q.Location.set(i,t.structure,m,m.elements[0]);let d=m.model.sequence.byEntityKey[Ke.entity.key(i)];d&&(r+=d.sequence.length),n+=m.elements.length;let p=ye.ofBounds(0,m.elements.length);a.set(m.id,p),s.push({unit:m,indices:p})}r>0&&o.push(`${r} residues`),o.push(`${n} elements`),super(t,1),this.label=`Whole Chain (${o.join(", ")})`,this.unitIndices=a,this.loci=Q.Loci(this.data.structure,s)}};var e4=class extends ry{residueLabel(t){return"X"}residueColor(t){return Lt.black}residueClass(t){return"msp-sequence-present"}getSeqIndices(t){let{structure:r,units:n}=this.data;if(Q.Loci.is(t)){if(!De.areRootsEquivalent(t.structure,r))return ye.Empty;t=Q.Loci.remap(t,r);for(let o of t.elements){let i=this.unitIndices.get(o.unit.id);if(i&&xe.isSubset(i,o.indices))return o.indices}}else if(De.isLoci(t)){if(!De.areRootsEquivalent(t.structure,r))return ye.Empty;for(let o=0,i=n.length;o<i;++o)return this.unitIndices.get(n[o].id)}return ye.Empty}getLoci(t){let{units:r}=this.data,n=[],o=0;for(let i=0,a=r.length;i<a;++i){let s=r[i];if(t<o+s.elements.length){n.push({unit:s,indices:ye.ofSingleton(t-o)});break}o+=s.elements.length}return Q.Loci(this.data.structure,n)}constructor(t){let r=0,n=new Map,o=[];for(let i=0,a=t.units.length;i<a;++i){let s=t.units[i];r+=s.elements.length;let l=ye.ofBounds(0,s.elements.length);n.set(s.id,l),o.push({unit:s,indices:l})}super(t,r),this.unitIndices=n}};var _a=_t(ur()),PY=5e3,RY=1e3,Fyt=30;function c3e(e){let t=Ke.unit.pdbx_struct_oper_list_ids(e),r=Ke.unit.struct_ncs_oper_id(e),n=Ke.unit.hkl(e),o=Ke.unit.spgrOp(e);return`${t.sort().join(",")}|${r}|${n}|${o}`}function DY(e){let[t,r]=e.split("|");return[parseInt(t),r]}function s3e(e,t){let{structure:r,modelEntityId:n,chainGroupId:o,operatorKey:i}=e,a=Q.Location.create(r),[s,l]=DY(n),u=[];for(let c of r.units)Q.Location.set(a,r,c,c.elements[0]),r.getModelIndex(c.model)===s&&Ke.entity.id(a)===l&&c.chainGroupId===o&&c3e(a)===i&&u.push(c);if(u.length>0){let c={structure:r,units:u},m=u[0],d;if(m.polymerElements.length){let p=Q.Location.create(r,m,m.elements[0]),h=m.model.sequence.byEntityKey[Ke.entity.key(p)];if(h&&h.sequence.length<=PY)d=new JO(c);else{let f=u.reduce((g,y)=>g+y.polymerElements.length,0);ue.isAtomic(m)||f>PY?d=new zT(c):d=new e4(c)}}else ue.isAtomic(m)?u.reduce((h,f)=>h+f.residueCount,0)>PY?d=new zT(c):d=new $O(c):(console.warn("should not happen, expecting coarse units to be polymeric"),d=new zT(c));return d.markResidue(t.getLoci(r),4),d}else return"No sequence available"}function t4(e,t=!1){let r=[],n=Q.Location.create(e),o=new Set;for(let i of e.units){Q.Location.set(n,e,i,i.elements[0]);let a=Ke.entity.id(n),s=e.getModelIndex(i.model),l=`${s}|${a}`;if(o.has(l)||t&&Ke.entity.type(n)!=="polymer")continue;let u=Ke.entity.pdbx_description(n).join(", ");e.models.length&&(e.representativeModel?u+=` (Model ${e.models[s].modelNum})`:u.startsWith("Polymer ")&&(u+=` (${e.models[s].entry})`));let c=`${a}: ${u}`;if(r.push([l,c]),o.add(l),r.length>RY)return[["","Too many entities"]]}return r.length===0&&r.push(["","No entities"]),r}function XD(e,t){let r=[],n=Q.Location.create(e),o=new Set,[i,a]=DY(t);for(let s of e.units){if(Q.Location.set(n,e,s,s.elements[0]),e.getModelIndex(s.model)!==i||Ke.entity.id(n)!==a)continue;let l=s.chainGroupId;if(o.has(l))continue;let u=Ld(n,{granularity:"chain",hidePrefix:!0,htmlStyling:!1});if(r.push([l,u]),o.add(l),r.length>RY)return[[-1,"Too many chains"]]}return r.length===0&&r.push([-1,"No chains"]),r}function HT(e,t,r){let n=[],o=Q.Location.create(e),i=new Set,[a,s]=DY(t);for(let l of e.units){if(Q.Location.set(o,e,l,l.elements[0]),e.getModelIndex(l.model)!==a||Ke.entity.id(o)!==s||l.chainGroupId!==r)continue;let u=c3e(o);if(i.has(u))continue;let c=l.conformation.operator.name;if(n.push([u,c]),i.add(u),n.length>RY)return[["","Too many operators"]]}return n.length===0&&n.push(["","No operators"]),n}function l3e(e){let t=[],r=[],n=e.select(tr.Generators.rootsOfType(ne.Molecule.Structure));for(let o of n)o.obj?.data&&(r.push(o.obj.data),t.push([o.transform.ref,o.obj.data.label]));return t.length===0&&t.push(["","No structure"]),{options:t,all:r}}var _Y=C.Select("single",[["single","Chain"],["polymers","Polymers"],["all","Everything"]]),r4=class extends Fr{constructor(){super(...arguments);this.state={structureOptions:{options:[],all:[]},structure:De.Empty,structureRef:"",modelEntityId:"",chainGroupId:-1,operatorKey:"",mode:"single",sequenceViewModeParam:_Y};this.setParamProps=r=>{let n={...this.state};switch(r.name){case"mode":if(n.mode=r.value,this.state.mode===n.mode)return;if(n.mode==="all"||n.mode==="polymers")break;case"structure":r.name==="structure"&&(n.structureRef=r.value),n.structure=this.getStructure(n.structureRef),n.modelEntityId=t4(n.structure)[0][0],n.chainGroupId=XD(n.structure,n.modelEntityId)[0][0],n.operatorKey=HT(n.structure,n.modelEntityId,n.chainGroupId)[0][0];break;case"entity":n.modelEntityId=r.value,n.chainGroupId=XD(n.structure,n.modelEntityId)[0][0],n.operatorKey=HT(n.structure,n.modelEntityId,n.chainGroupId)[0][0];break;case"chain":n.chainGroupId=r.value,n.operatorKey=HT(n.structure,n.modelEntityId,n.chainGroupId)[0][0];break;case"operator":n.operatorKey=r.value;break}this.setState(n)}}componentDidMount(){this.plugin.state.data.select(tr.Generators.rootsOfType(ne.Molecule.Structure)).length>0&&this.setState(this.getInitialState()),this.subscribe(this.plugin.state.events.object.updated,({ref:n,obj:o})=>{n===this.state.structureRef&&o&&o.type===ne.Molecule.Structure.type&&o.data!==this.state.structure&&this.sync()}),this.subscribe(this.plugin.state.events.object.created,({obj:n})=>{n&&n.type===ne.Molecule.Structure.type&&this.sync()}),this.subscribe(this.plugin.state.events.object.removed,({obj:n})=>{n&&n.type===ne.Molecule.Structure.type&&this.sync()});let r=this.plugin.spec.components?.sequenceViewer?.modeOptions;if(r){let n=new Set(r),o={..._Y,options:_Y.options.filter(([i])=>n.has(i))};this.setState({sequenceViewModeParam:o})}}sync(){let r=l3e(this.plugin.state.data);w0(r.all,this.state.structureOptions.all)||this.setState(this.getInitialState())}getStructure(r){let o=this.plugin.state.data.select(r)[0];return!r||!o||!o.obj?De.Empty:o.obj.data}getSequenceWrapper(r){return{wrapper:s3e(this.state,this.plugin.managers.structure.selection),label:`${C.optionLabel(r.chain,this.state.chainGroupId)} | ${C.optionLabel(r.entity,this.state.modelEntityId)}`}}getSequenceWrappers(r){if(this.state.mode==="single")return[this.getSequenceWrapper(r)];let n=this.getStructure(this.state.structureRef),o=[];for(let[i,a]of t4(n,this.state.mode==="polymers"))for(let[s,l]of XD(n,i))for(let[u]of HT(n,i,s))if(o.push({wrapper:s3e({structure:n,modelEntityId:i,chainGroupId:s,operatorKey:u},this.plugin.managers.structure.selection),label:`${l} | ${a}`}),o.length>Fyt)return[];return o}getInitialState(){let r=l3e(this.plugin.state.data),n=r.options[0][0],o=this.getStructure(n),i=t4(o)[0][0],a=XD(o,i)[0][0],s=HT(o,i,a)[0][0];this.state.structure&&this.state.structure===o&&(i=this.state.modelEntityId,a=this.state.chainGroupId,s=this.state.operatorKey);let l=this.plugin.spec.components?.sequenceViewer?.defaultMode,u=this.props.defaultMode??l??"single";return{structureOptions:r,structure:o,structureRef:n,modelEntityId:i,chainGroupId:a,operatorKey:s,mode:u,sequenceViewModeParam:this.state.sequenceViewModeParam}}get params(){let{structureOptions:r,structure:n,modelEntityId:o,chainGroupId:i}=this.state,a=t4(n),s=XD(n,o),l=HT(n,o,i);return{structure:C.Select(r.options[0][0],r.options,{shortLabel:!0}),entity:C.Select(a[0][0],a,{shortLabel:!0}),chain:C.Select(s[0][0],s,{shortLabel:!0,twoColumns:!0,label:"Chain"}),operator:C.Select(l[0][0],l,{shortLabel:!0,twoColumns:!0}),mode:this.state.sequenceViewModeParam}}get values(){return{structure:this.state.structureRef,entity:this.state.modelEntityId,chain:this.state.chainGroupId,operator:this.state.operatorKey,mode:this.state.mode}}render(){if(this.getStructure(this.state.structureRef)===De.Empty)return(0,_a.jsx)("div",{className:"msp-sequence",children:(0,_a.jsxs)("div",{className:"msp-sequence-select",children:[(0,_a.jsx)(Dn,{svg:Du,style:{cursor:"help",position:"absolute",right:0,top:0},title:"Shows a sequence of one or more chains. Use the controls to alter selection."}),(0,_a.jsx)("span",{children:"Sequence"}),(0,_a.jsx)("span",{style:{fontWeight:"normal"},children:"No structure available"})]})});let r=this.params,n=this.values,o=this.getSequenceWrappers(r);return(0,_a.jsxs)("div",{className:"msp-sequence",children:[(0,_a.jsxs)("div",{className:"msp-sequence-select",children:[(0,_a.jsx)(Dn,{svg:Du,style:{cursor:"help",position:"absolute",right:0,top:0},title:`This shows a single sequence. Use the controls to show a different sequence. 
Use Ctrl or Cmd key to add a sequence range to focus; use Shift key to extend last focused/selected range.`}),(0,_a.jsx)("span",{children:"Sequence of"}),(0,_a.jsx)(Jg,{title:`[Structure] ${C.optionLabel(r.structure,n.structure)}`,param:r.structure,name:"structure",value:n.structure,onChange:this.setParamProps}),(0,_a.jsx)(Jg,{title:"[Mode]",param:this.state.sequenceViewModeParam,name:"mode",value:n.mode,onChange:this.setParamProps}),n.mode==="single"&&(0,_a.jsx)(Jg,{title:`[Entity] ${C.optionLabel(r.entity,n.entity)}`,param:r.entity,name:"entity",value:n.entity,onChange:this.setParamProps}),n.mode==="single"&&(0,_a.jsx)(Jg,{title:`[Chain] ${C.optionLabel(r.chain,n.chain)}`,param:r.chain,name:"chain",value:n.chain,onChange:this.setParamProps}),r.operator.options.length>1&&(0,_a.jsx)(_a.Fragment,{children:(0,_a.jsx)(Jg,{title:`[Instance] ${C.optionLabel(r.operator,n.operator)}`,param:r.operator,name:"operator",value:n.operator,onChange:this.setParamProps})})]}),(0,_a.jsx)(Lyt,{children:o.map((i,a)=>{let s=typeof i.wrapper=="string"?(0,_a.jsx)("div",{className:"msp-sequence-wrapper",children:i.wrapper},a):(0,_a.jsx)(KO,{sequenceWrapper:i.wrapper},a);return n.mode==="single"?s:(0,_a.jsxs)(u3e.Fragment,{children:[(0,_a.jsx)("div",{className:"msp-sequence-chain-label",children:i.label}),s]},a)})})]})}};function Lyt({children:e}){return(0,_a.jsx)("div",{className:"msp-sequence-wrapper-non-empty",children:e})}var ny=_t(Mi());var Ml=_t(ur());function m3e(){let e=(0,ny.useContext)(Al),[t,r]=(0,ny.useState)(tl());return(0,ny.useEffect)(()=>{let n=e.events.task.progress.subscribe(i=>{let a=!!e.spec.components?.hideTaskOverlay;i.level==="background"&&(a||!i.useOverlay)&&r(s=>s.set(i.id,i))}),o=e.events.task.finished.subscribe(({id:i})=>{r(a=>a.delete(i))});return()=>{n.unsubscribe(),o.unsubscribe()}},[e]),(0,Ml.jsxs)("div",{className:"msp-background-tasks",children:[t.valueSeq().map(n=>(0,Ml.jsx)(n4,{event:n},n.id)),(0,Ml.jsx)(Vyt,{})]})}function Vyt(){let e=(0,ny.useContext)(Al),t=Ol(e.canvas3d?.commitQueueSize);return t?(0,Ml.jsx)("div",{className:"msp-task-state",children:(0,Ml.jsx)("div",{children:(0,Ml.jsxs)("div",{children:["Commiting renderables... ",t," remaining"]})})}):null}var n4=class extends Fr{constructor(){super(...arguments);this.abort=()=>{this.plugin.managers.task.requestAbort(this.props.event.progress.root.progress.taskId,"User Request")}}render(){let r=this.props.event.progress.root,n=d3e(this.props.event.progress.root)-1,o=r.progress.isIndeterminate?void 0:(0,Ml.jsxs)(Ml.Fragment,{children:["[",r.progress.current,"/",r.progress.max,"]"]}),i=n>0?(0,Ml.jsxs)(Ml.Fragment,{children:["[",n," subtask(s)]"]}):void 0;return(0,Ml.jsx)("div",{className:"msp-task-state",children:(0,Ml.jsxs)("div",{children:[r.progress.canAbort&&(0,Ml.jsx)(sr,{svg:AM,onClick:this.abort,title:"Abort"}),(0,Ml.jsxs)("div",{children:[r.progress.message," ",o," ",i]})]})})}};function d3e(e){if(e.children.length===0)return 1;let t=0;for(let r of e.children)t+=d3e(r);return t}function p3e(){let e=(0,ny.useContext)(Al),[t,r]=(0,ny.useState)(tl());return(0,ny.useEffect)(()=>{let n=e.events.task.progress.subscribe(i=>{i.useOverlay&&r(a=>a.set(i.id,i))}),o=e.events.task.finished.subscribe(({id:i})=>{r(a=>a.delete(i))});return()=>{n.unsubscribe(),o.unsubscribe()}},[e]),t.size===0?null:(0,Ml.jsx)("div",{className:"msp-overlay-tasks",children:t.valueSeq().map(n=>(0,Ml.jsx)(n4,{event:n},n.id))})}var Xd=_t(ur()),wY=class extends Fr{constructor(){super(...arguments);this.hide=()=>{(this.props.entry.hide||function(){}).call(null)}}render(){let r=this.props.entry,n=typeof r.message=="string"?(0,Xd.jsx)("div",{dangerouslySetInnerHTML:{__html:r.message}}):(0,Xd.jsx)("div",{children:(0,Xd.jsx)(r.message,{})});return(0,Xd.jsxs)("div",{className:"msp-toast-entry",children:[(0,Xd.jsx)("div",{className:"msp-toast-title",onClick:()=>this.hide(),children:r.title}),(0,Xd.jsx)("div",{className:"msp-toast-message",children:n}),(0,Xd.jsx)("div",{className:"msp-toast-clear"}),(0,Xd.jsx)("div",{className:"msp-toast-hide",children:(0,Xd.jsx)(sr,{svg:AM,onClick:this.hide,title:"Hide",className:"msp-no-hover-outline"})})]})}},o4=class extends Fr{componentDidMount(){this.subscribe(this.plugin.managers.toast.events.changed,()=>this.forceUpdate())}render(){let t=this.plugin.managers.toast.state;if(!t.entries.count())return null;let r=[];return t.entries.forEach((n,o)=>r.push(n)),r.sort(function(n,o){return n.serialNumber-o.serialNumber}),(0,Xd.jsx)("div",{className:"msp-toast-container",children:r.map(n=>(0,Xd.jsx)(wY,{entry:n},n.serialNumber))})}};var f3e=_t(Mi());var tf=_t(ur()),i4=class extends Fr{constructor(){super(...arguments);this.container=f3e.createRef();this.mounted=!1;this.state={noWebGl:!1,showLogo:!0};this.handleLogo=()=>{this.setState({showLogo:!this.plugin.canvas3d?.reprCount.value})}}async applyMount(){try{let r=await this.plugin.mountAsync(this.container.current,{checkeredCanvasBackground:!0});if(!this.mounted)return;r||this.setState({noWebGl:!0}),this.handleLogo(),this.subscribe(this.plugin.canvas3d.reprCount,this.handleLogo)}catch(r){console.error(r),this.setState({noWebGl:!0})}}componentDidMount(){if(this.mounted=!0,!this.container.current){this.setState({noWebGl:!0});return}this.applyMount()}componentWillUnmount(){this.mounted=!1,super.componentWillUnmount(),this.plugin.unmount()}renderMissing(){if(this.props.noWebGl){let r=this.props.noWebGl;return(0,tf.jsx)(r,{})}return(0,tf.jsx)("div",{className:"msp-no-webgl",children:(0,tf.jsxs)("div",{children:[(0,tf.jsx)("p",{children:(0,tf.jsx)("b",{children:"WebGL does not seem to be available."})}),(0,tf.jsx)("p",{children:"This can be caused by an outdated browser, graphics card driver issue, or bad weather. Sometimes, just restarting the browser helps. Also, make sure hardware acceleration is enabled in your browser."}),(0,tf.jsxs)("p",{children:["For a list of supported browsers, refer to ",(0,tf.jsx)("a",{href:"http://caniuse.com/#feat=webgl",target:"_blank",children:"http://caniuse.com/#feat=webgl"}),"."]})]})})}render(){if(this.state.noWebGl)return this.renderMissing();let r=this.props.logo;return(0,tf.jsx)("div",{className:this.props.parentClassName||"msp-viewport",style:this.props.parentStyle,ref:this.container,children:this.state.showLogo&&r&&(0,tf.jsx)(r,{})})}};var a4=_t(Mi()),Jm=_t(Mi());var Bl=_t(ur()),Oyt=e=>{let{plugin:t,cropFrameColor:r}=e,n=t.helpers.viewportScreenshot,[o,i]=(0,Jm.useState)(null),a=(0,Jm.useRef)(null),s=(0,Jm.useRef)(e);return(0,Jm.useEffect)(()=>{s.current=e},Object.values(e)),(0,Jm.useEffect)(()=>{o!==a.current&&i(a.current)}),(0,Jm.useEffect)(()=>{let l=!1,u=[];function c(f,g){f&&u.push(f.subscribe(g))}function m(){let f=s.current;!f.suspend&&a.current&&h3e(t,n,a.current,f.customBackground,f.borderColor,f.borderWidth),a.current||(l=!0)}let d=setInterval(()=>{l&&(l=!1,m())},1e3/8);c(t.events.canvas3d.settingsUpdated,()=>l=!0),c(t.canvas3d?.didDraw,()=>l=!0),c(t.state.data.behaviors.isUpdating,f=>{f||(l=!0)}),c(n?.behaviors.values,()=>l=!0),c(n?.behaviors.cropParams,()=>l=!0);let p;typeof ResizeObserver<"u"&&(p=new ResizeObserver(()=>l=!0));let h=a.current;return p?.observe(h),m(),()=>{clearInterval(d),u.forEach(f=>f.unsubscribe()),p?.unobserve(h)}},[n]),(0,Jm.useLayoutEffect)(()=>{a.current&&h3e(t,n,a.current,e.customBackground,e.borderColor,e.borderWidth)},[...Object.values(e)]),(0,Bl.jsx)(Bl.Fragment,{children:(0,Bl.jsxs)("div",{style:{position:"relative",width:"100%",height:"100%"},children:[(0,Bl.jsx)("canvas",{ref:a,onContextMenu:l=>{l.preventDefault(),l.stopPropagation()},style:{display:"block",width:"100%",height:"100%"}}),(0,Bl.jsx)(Gyt,{plugin:t,canvas:o,color:r})]})})},y3e=a4.memo(Oyt,(e,t)=>qb(e,t));async function h3e(e,t,r,n,o,i){let a=Ae.create("Render Screenshot",async s=>{if(!t)return;let l=await t.getPreview(s);if(!l)return;let u=r.getContext("2d");if(!u)return;let{canvas:c,width:m,height:d}=l,p=r.clientWidth,h=r.clientHeight;r.width=p,r.height=h,u.clearRect(0,0,p,h);let f=b3e(m,d,p,h);if(n)u.fillStyle=n,u.fillRect(f.x,f.y,f.width,f.height);else if(t.values.transparent)for(let y=0;y<f.width;y+=13)for(let x=0;x<f.height;x+=13){u.fillStyle=(y+x)%2?"#ffffff":"#bfbfbf";let S=f.x+y,I=f.y+x,v=y+13>f.width?f.width-y:13,A=x+13>f.height?f.height-x:13;u.fillRect(S,I,v,A)}if(u.drawImage(c,f.x,f.y,f.width,f.height),o&&i){let g=i;u.rect(f.x,f.y,f.width,f.height),u.rect(f.x+g,f.y+g,f.width-2*g,f.height-2*g),u.fillStyle=o,u.fill("evenodd")}});return e.runTask(a,{useOverlay:!0})}function Gyt({plugin:e,canvas:t,color:r="rgba(255, 87, 45, 0.75)"}){let n=e.helpers.viewportScreenshot,o=Ol(n?.behaviors.values),i=Ol(n?.behaviors.cropParams),a=Ol(n?.behaviors.relativeCrop),s=(0,Jm.useRef)({x:0,y:0,width:0,height:0});Ol(o?.resolution.name==="viewport"?e.canvas3d?.resized:void 0);let[l,u]=a4.useState(""),[c,m]=(0,Jm.useState)([0,0]),[d,p]=(0,Jm.useState)([0,0]);if(!n||!t||!a)return null;let{width:h,height:f}=n.getSizeAndViewport(),g=b3e(h,f,t.clientWidth,t.clientHeight),y={x:g.x+Math.floor(g.width*a.x),y:g.y+Math.floor(g.height*a.y),width:Math.ceil(g.width*a.width),height:Math.ceil(g.height*a.height)},x=g3e(y),S=g3e(g);if(l==="move"?(x.l+=d[0]-c[0],x.r+=d[0]-c[0],x.t+=d[1]-c[1],x.b+=d[1]-c[1]):l&&(l.indexOf("left")>=0?x.l+=d[0]-c[0]:l.indexOf("right")>=0&&(x.r+=d[0]-c[0]),l.indexOf("top")>=0?x.t+=d[1]-c[1]:l.indexOf("bottom")>=0&&(x.b+=d[1]-c[1])),x.l>x.r){let F=x.l;x.l=x.r,x.r=F}if(x.t>x.b){let F=x.t;x.t=x.b,x.b=F}let I=40;x.l=Math.min(S.r-I,Math.max(S.l,x.l)),x.r=Math.max(S.l+I,Math.min(S.r,x.r)),x.t=Math.min(S.b-I,Math.max(S.t,x.t)),x.b=Math.max(S.t+I,Math.min(S.b,x.b)),y.x=x.l,y.y=x.t,y.width=x.r-x.l+1,y.height=x.b-x.t+1,s.current=y;let v=F=>{F.preventDefault(),p([F.pageX,F.pageY])},A=F=>{F.preventDefault();let z=F.touches[0];p([z.pageX,z.pageY])},P=F=>{F.preventDefault(),u(F.currentTarget.getAttribute("data-drag"));let z=F.touches[0],j=[z.pageX,z.pageY];m(j),p(j),window.addEventListener("touchend",w),window.addEventListener("touchmove",A)},T=F=>{F.preventDefault(),u(F.currentTarget.getAttribute("data-drag"));let z=[F.pageX,F.pageY];m(z),p(z),window.addEventListener("mouseup",R),window.addEventListener("mousemove",v)},R=()=>{window.removeEventListener("mouseup",R),window.removeEventListener("mousemove",v),E()},w=()=>{window.removeEventListener("touchend",w),window.removeEventListener("touchmove",A),E()};function E(){let F=s.current;i?.auto&&n?.behaviors.cropParams.next({...i,auto:!1}),n?.behaviors.relativeCrop.next({x:(F.x-g.x)/g.width,y:(F.y-g.y)/g.height,width:F.width/g.width,height:F.height/g.height}),u("");let z=[0,0];m(z),p(z)}let M=F=>{F.preventDefault(),F.stopPropagation()},D=4,B=`3px solid ${r}`,k="transparent";return(0,Bl.jsxs)(Bl.Fragment,{children:[(0,Bl.jsx)("div",{"data-drag":"move",style:{position:"absolute",left:y.x,top:y.y,width:y.width,height:y.height,border:B,cursor:"move"},onMouseDown:T,onTouchStart:P,draggable:!1,onContextMenu:M}),(0,Bl.jsx)("div",{"data-drag":"left",style:{position:"absolute",left:y.x-D,top:y.y+D,width:4*D,height:y.height-D,background:k,cursor:"w-resize"},onMouseDown:T,onTouchStart:P,draggable:!1,onContextMenu:M}),(0,Bl.jsx)("div",{"data-drag":"right",style:{position:"absolute",left:x.r-2*D,top:y.y,width:4*D,height:y.height-D,background:k,cursor:"w-resize"},onMouseDown:T,onTouchStart:P,draggable:!1,onContextMenu:M}),(0,Bl.jsx)("div",{"data-drag":"top",style:{position:"absolute",left:y.x-D,top:y.y-D,width:y.width+2*D,height:4*D,background:k,cursor:"n-resize"},onMouseDown:T,onTouchStart:P,draggable:!1,onContextMenu:M}),(0,Bl.jsx)("div",{"data-drag":"bottom",style:{position:"absolute",left:y.x-D,top:x.b-2*D,width:y.width+2*D,height:4*D,background:k,cursor:"n-resize"},onMouseDown:T,onTouchStart:P,draggable:!1,onContextMenu:M}),(0,Bl.jsx)("div",{"data-drag":"top, left",style:{position:"absolute",left:x.l-D,top:x.t-D,width:4*D,height:4*D,background:k,cursor:"nw-resize"},onMouseDown:T,onTouchStart:P,draggable:!1,onContextMenu:M}),(0,Bl.jsx)("div",{"data-drag":"bottom, right",style:{position:"absolute",left:x.r-2*D,top:x.b-2*D,width:4*D,height:4*D,background:k,cursor:"nw-resize"},onMouseDown:T,onTouchStart:P,draggable:!1,onContextMenu:M}),(0,Bl.jsx)("div",{"data-drag":"top, right",style:{position:"absolute",left:x.r-2*D,top:x.t-D,width:4*D,height:4*D,background:k,cursor:"ne-resize"},onMouseDown:T,onTouchStart:P,draggable:!1,onContextMenu:M}),(0,Bl.jsx)("div",{"data-drag":"bottom, left",style:{position:"absolute",left:x.l-D,top:x.b-2*D,width:4*D,height:4*D,background:k,cursor:"ne-resize"},onMouseDown:T,onTouchStart:P,draggable:!1,onContextMenu:M})]})}function g3e(e){return{l:e.x,t:e.y,r:e.x+e.width-1,b:e.y+e.height-1}}function b3e(e,t,r,n){let o=e/t,i=r/n;if(o<=i){let a=n*o;return{x:Math.round((r-a)/2),y:0,width:Math.round(a),height:n}}else{let a=r/o;return{x:0,y:Math.round((n-a)/2),width:r,height:Math.round(a)}}}var l4=_t(Mi());var Eo=_t(ur()),s4=class extends Fr{constructor(){super(...arguments);this.state={showPreview:!0,isDisabled:!1};this.download=()=>{this.plugin.helpers.viewportScreenshot?.download(),this.props.close()};this.copy=async()=>{try{await this.plugin.helpers.viewportScreenshot?.copyToClipboard(),lt.Toast.Show(this.plugin,{message:"Copied to clipboard.",title:"Screenshot",timeoutMs:1500})}catch{return this.copyImg()}};this.copyImg=async()=>{let r=await this.plugin.helpers.viewportScreenshot?.getImageDataUri();this.setState({imageData:r})};this.open=r=>{!r.target.files||!r.target.files[0]||lt.State.Snapshots.OpenFile(this.plugin,{file:r.target.files[0]})}}componentDidMount(){this.subscribe(this.plugin.state.data.behaviors.isUpdating,r=>{this.setState({isDisabled:r})})}componentWillUnmount(){super.componentWillUnmount(),this.setState({imageData:void 0})}render(){let r=!!navigator.clipboard?.write;return(0,Eo.jsxs)("div",{children:[this.state.showPreview&&(0,Eo.jsxs)("div",{className:"msp-image-preview",children:[(0,Eo.jsx)(y3e,{plugin:this.plugin}),(0,Eo.jsx)(Hyt,{plugin:this.plugin})]}),(0,Eo.jsxs)("div",{className:"msp-flex-row",children:[!this.state.imageData&&(0,Eo.jsx)(gr,{icon:jne,onClick:r?this.copy:this.copyImg,disabled:this.state.isDisabled,children:"Copy"}),this.state.imageData&&(0,Eo.jsx)(gr,{onClick:()=>this.setState({imageData:void 0}),disabled:this.state.isDisabled,children:"Clear"}),(0,Eo.jsx)(gr,{icon:U2,onClick:this.download,disabled:this.state.isDisabled,children:"Download"})]}),this.state.imageData&&(0,Eo.jsxs)("div",{className:"msp-row msp-copy-image-wrapper",children:[(0,Eo.jsx)("div",{children:"Right click below + Copy Image"}),(0,Eo.jsx)("img",{src:this.state.imageData,style:{width:"100%",height:32,display:"block"}})]}),(0,Eo.jsx)(zyt,{plugin:this.plugin,isDisabled:this.state.isDisabled}),(0,Eo.jsxs)(fs,{header:"State",children:[(0,Eo.jsx)(zD,{onAction:this.props.close}),(0,Eo.jsx)(fs,{header:"Save Options",initiallyExpanded:!1,noOffset:!0,children:(0,Eo.jsx)(HD,{})})]}),(0,Eo.jsx)(fs,{header:"Camera",children:(0,Eo.jsx)(Nyt,{plugin:this.plugin})})]})}};function QD(e){return`${e?.map(t=>Oh(t,2)).join(", ")}`}function O1({title:e,children:t}){return(0,Eo.jsxs)("div",{className:"msp-control-row",children:[(0,Eo.jsx)("span",{className:"msp-control-row-label",children:e}),(0,Eo.jsx)("div",{className:"msp-control-row-text",style:{fontSize:"0.85rem",overflow:"hidden",whiteSpace:"nowrap"},children:t})]})}function Uyt(e){if(e)return PPe(e.target,e.position,e.mode,e.fov)}function Nyt({plugin:e}){let[,t]=(0,l4.useState)({});(0,l4.useEffect)(()=>{let i=e.canvas3d?.didDraw.subscribe(()=>t({}));return()=>i?.unsubscribe()},[e]);let r=e.canvas3d?.camera.state,n=Uyt(r),o=b.sub(b(),r?.target??b.origin,r?.position??b.origin);return b.normalize(o,o),(0,Eo.jsxs)("div",{children:[(0,Eo.jsx)(O1,{title:"Position",children:QD(r?.position)}),(0,Eo.jsx)(O1,{title:"FoV Norm. Pos.",children:QD(n)}),(0,Eo.jsx)(O1,{title:"Target",children:QD(r?.target)}),(0,Eo.jsx)(O1,{title:"Direction",children:QD(o)}),(0,Eo.jsx)(O1,{title:"Up",children:QD(r?.up)}),(0,Eo.jsx)(O1,{title:"Distance",children:Oh(b.distance(r?.position??b.origin,r?.target??b.origin),2)}),(0,Eo.jsx)(O1,{title:"Radius",children:Oh(r?.radius??0,2)}),(0,Eo.jsx)(gr,{onClick:()=>{if(!navigator.clipboard)return;let i=`{
    position: [${n?.map(a=>Oh(a,2)).join(", ")}],
    target: [${r?.target.map(a=>Oh(a,2)).join(", ")}],
    up: [${r?.up.map(a=>Oh(a,2)).join(", ")}],
}`;navigator.clipboard.writeText(i)},style:{marginTop:1},title:"Copy JSON usable in MolViewSpec, uses FoV Normalized Position",children:"Copy MVS JSON"})]})}function zyt({plugin:e,isDisabled:t}){let r=e.helpers.viewportScreenshot,n=Ol(r?.behaviors.values);return r?(0,Eo.jsx)(uo,{params:r.params,values:n,onChangeValues:o=>r.behaviors.values.next(o),isDisabled:t}):null}function Hyt({plugin:e}){let t=e.helpers.viewportScreenshot,r=Ol(t?.behaviors.cropParams);return Ol(t?.behaviors.relativeCrop),!t||!r?null:(0,Eo.jsxs)("div",{style:{width:"100%",height:"24px",marginTop:"8px"},children:[(0,Eo.jsx)(yi,{icon:Qne,title:"Auto-crop",inline:!0,isSelected:r.auto,style:{background:"transparent",float:"left",width:"auto",height:"24px",lineHeight:"24px"},toggle:()=>t.toggleAutocrop(),label:"Auto-crop "+(r.auto?"On":"Off")}),!r.auto&&(0,Eo.jsx)(gr,{icon:Wne,title:"Crop",style:{background:"transparent",float:"right",height:"24px",lineHeight:"24px",width:"24px",padding:"0"},onClick:()=>t.autocrop()}),!r.auto&&!t.isFullFrame&&(0,Eo.jsx)(gr,{icon:Xne,title:"Reset Crop",style:{background:"transparent",float:"right",height:"24px",lineHeight:"24px",width:"24px",padding:"0"},onClick:()=>t.resetCrop()})]})}function x3e(e){return({values:t,update:r,apply:n})=>({params:typeof e.params=="function"?e.params:o=>e.params,getTarget:e.target,getValues:t,update(o,i){let a=e.target(i);return Pl(a,s=>r(o,s,i))},apply:n||(()=>{})})}var G1=_t(ur()),u4=class extends Fr{componentDidMount(){this.plugin.canvas3d&&(this.subscribe(this.plugin.events.canvas3d.settingsUpdated,()=>this.forceUpdate()),this.subscribe(this.plugin.canvas3d.camera.stateChanged.pipe(Xu(500,void 0,{leading:!0,trailing:!0})),t=>{(t.radiusMax!==void 0||t.radius!==void 0)&&this.forceUpdate()}))}render(){return this.plugin.canvas3d?(0,G1.jsxs)(G1.Fragment,{children:[(0,G1.jsx)(aO,{mapping:Wyt}),(0,G1.jsx)(F1,{})]}):null}},ZD={sequence:"Sequence",log:"Log",left:"Left Panel",right:"Right Panel"},jyt={animate:Na.trackball.params.animate,camera:Na.camera,background:C.Group({color:C.Color(16579577,{label:"Background",description:"Custom background color"}),transparent:C.Boolean(!1),style:Na.postprocessing.params.background},{pivot:"color"}),lighting:C.Group({occlusion:Na.postprocessing.params.occlusion,shadow:Na.postprocessing.params.shadow,outline:Na.postprocessing.params.outline,dof:Na.postprocessing.params.dof,fog:Na.cameraFog},{isFlat:!0}),clipping:C.Group({...Na.cameraClipping.params},{pivot:"radius"}),layout:C.MultiSelect([],C.objectToOptions(ZD)),advanced:C.Group({illumination:Na.illumination,multiSample:Na.multiSample,hiZ:Na.hiZ,sharpening:Na.postprocessing.params.sharpening,bloom:Na.postprocessing.params.bloom,resolutionMode:lh.Params.resolutionMode,pixelScale:lh.Params.pixelScale,transparency:lh.Params.transparency})},Wyt=x3e({params:e=>{let t=C.clone(jyt),r=e.spec.components?.controls;if(r){let o=[];r.top!=="none"&&o.push(["sequence",ZD.sequence]),r.bottom!=="none"&&o.push(["log",ZD.log]),r.left!=="none"&&o.push(["left",ZD.left]),r.right!=="none"&&o.push(["right",ZD.right]),t.layout.options=o}let n=e.config.get(Lr.Background.Styles)||[];return n.length>0&&Object.assign(t.background.params.style,{presets:Wo(n),isFlat:!1}),t},target(e){let t=e.spec.components?.controls,r=e.layout.state.regionState,n=[];r.top!=="hidden"&&(!t||t.top!=="none")&&n.push("sequence"),r.bottom!=="hidden"&&(!t||t.bottom!=="none")&&n.push("log"),r.left!=="hidden"&&(!t||t.left!=="none")&&n.push("left"),r.right!=="hidden"&&(!t||t.right!=="none")&&n.push("right");let{pixelScale:o,transparency:i,resolutionMode:a}=e.canvas3dContext?.props;return{canvas:e.canvas3d?.props,layout:n,resolutionMode:a,pixelScale:o,transparency:i}}})({values(e,t){let{canvas:r}=e,n=r.renderer;return{layout:e.layout,animate:r.trackball.animate,camera:r.camera,background:{color:n.backgroundColor,transparent:r.transparentBackground,style:r.postprocessing.background},lighting:{occlusion:r.postprocessing.occlusion,shadow:r.postprocessing.shadow,outline:r.postprocessing.outline,dof:r.postprocessing.dof,fog:r.cameraFog},clipping:{...r.cameraClipping},advanced:{illumination:r.illumination,multiSample:r.multiSample,hiZ:r.hiZ,sharpening:r.postprocessing.sharpening,bloom:r.postprocessing.bloom,resolutionMode:e.resolutionMode,pixelScale:e.pixelScale,transparency:e.transparency}}},update(e,t){let r=t.canvas;r.trackball.animate=e.animate,r.camera=e.camera,r.transparentBackground=e.background.transparent,r.renderer.backgroundColor=e.background.color,r.postprocessing.occlusion=e.lighting.occlusion,r.postprocessing.shadow=e.lighting.shadow,r.postprocessing.outline=e.lighting.outline,r.postprocessing.background=e.background.style,r.cameraFog=e.lighting.fog,r.cameraClipping={radius:e.clipping.radius,far:e.clipping.far,minNear:e.clipping.minNear},r.illumination=e.advanced.illumination,r.multiSample=e.advanced.multiSample,r.hiZ=e.advanced.hiZ,r.postprocessing.sharpening=e.advanced.sharpening,r.postprocessing.bloom=e.advanced.bloom,r.postprocessing.dof=e.lighting.dof,t.layout=e.layout,t.resolutionMode=e.advanced.resolutionMode,t.pixelScale=e.advanced.pixelScale,t.transparency=e.advanced.transparency},async apply(e,t){await lt.Canvas3D.SetSettings(t,{settings:e.canvas});let r=e.layout.indexOf("left")<0,n=Pl(t.layout.state,o=>{o.regionState.top=e.layout.indexOf("sequence")>=0?"full":"hidden",o.regionState.bottom=e.layout.indexOf("log")>=0?"full":"hidden",o.regionState.left=r?"hidden":t.behaviors.layout.leftPanelTabName.value==="none"?"collapsed":"full",o.regionState.right=e.layout.indexOf("right")>=0?"full":"hidden"});await lt.Layout.Update(t,{state:n}),r&&lt.State.SetCurrentObject(t,{state:t.state.data,ref:Br.RootRef}),t.canvas3dContext?.setProps({resolutionMode:e.resolutionMode,pixelScale:e.pixelScale,transparency:e.transparency})}});var ko=_t(ur()),c4=class extends Fr{constructor(){super(...arguments);this.allCollapsedState={isSettingsExpanded:!1,isScreenshotExpanded:!1};this.state={...this.allCollapsedState,isCameraResetEnabled:!0};this.resetCamera=()=>{lt.Camera.Reset(this.plugin,{})};this.toggleSettingsExpanded=this.toggle("isSettingsExpanded");this.toggleScreenshotExpanded=this.toggle("isScreenshotExpanded");this.toggleControls=()=>{lt.Layout.Update(this.plugin,{state:{showControls:!this.plugin.layout.state.showControls}})};this.toggleExpanded=()=>{lt.Layout.Update(this.plugin,{state:{isExpanded:!this.plugin.layout.state.isExpanded,expandToFullscreen:!1}})};this.toggleFullscreen=()=>{lt.Layout.Update(this.plugin,{state:{expandToFullscreen:!this.plugin.layout.state.expandToFullscreen}})};this.toggleXR=()=>{this.plugin.canvas3d&&(this.plugin.canvas3d.xr.isPresenting.value?this.plugin.canvas3d.xr.end():this.plugin.canvas3d.xr.request())};this.toggleIllumination=()=>{this.plugin.canvas3d&&lt.Canvas3D.SetSettings(this.plugin,{settings:{illumination:{...this.plugin.canvas3d.props.illumination,enabled:!this.plugin.canvas3d.props.illumination.enabled}}})};this.setSettings=r=>{lt.Canvas3D.SetSettings(this.plugin,{settings:{[r.name]:r.value}})};this.setLayout=r=>{lt.Layout.Update(this.plugin,{state:{[r.name]:r.value}})};this.screenshot=()=>{this.plugin.helpers.viewportScreenshot?.download()};this.enableCameraReset=r=>{this.setState(n=>({...n,isCameraResetEnabled:r}))}}toggle(r){return n=>{this.setState(o=>({...o,...this.allCollapsedState,[r]:!this.state[r]})),n?.currentTarget.blur()}}componentDidMount(){this.subscribe(this.plugin.events.canvas3d.settingsUpdated,()=>this.forceUpdate()),this.subscribe(this.plugin.layout.events.updated,()=>this.forceUpdate()),this.plugin.canvas3d&&(this.subscribe(this.plugin.canvas3d.camera.stateChanged.pipe(Xu(500,void 0,{leading:!0,trailing:!0})),r=>this.enableCameraReset(r.radius!==0&&r.radiusMax!==0)),this.subscribe(this.plugin.canvas3d.xr.isSupported,()=>this.forceUpdate()),this.subscribe(this.plugin.canvas3d.xr.isPresenting,()=>this.forceUpdate()))}icon(r,n,o,i=!0,a=!1){return(0,ko.jsx)(sr,{svg:r,toggleState:i,onClick:n,title:o,style:{background:"transparent"},disabled:a})}render(){let r=this.plugin.config.get(Lr.Viewport.ShowXR),n=!!this.plugin.canvas3d?.xr.isSupported.value,o=!!this.plugin.canvas3d?.xr.isPresenting.value,i=r==="always"||r==="auto"&&n,a=n?o?"Exit XR":"Enter XR":"Augmented/Virtual Reality unavailable",s=this.plugin.layout.state;return(0,ko.jsxs)("div",{className:"msp-viewport-controls",children:[(0,ko.jsxs)("div",{className:"msp-viewport-controls-buttons",children:[this.plugin.config.get(Lr.Viewport.ShowReset)&&(0,ko.jsxs)("div",{className:"msp-hover-box-wrapper",children:[(0,ko.jsx)("div",{className:"msp-semi-transparent-background"}),this.icon(Fne,this.resetCamera,"Reset Zoom"),(0,ko.jsx)("div",{className:"msp-hover-box-body",children:(0,ko.jsxs)("div",{className:"msp-flex-column",children:[(0,ko.jsx)("div",{className:"msp-flex-row",children:(0,ko.jsx)(gr,{onClick:()=>this.resetCamera(),disabled:!this.state.isCameraResetEnabled,title:"Set camera zoom to fit the visible scene into view",children:"Reset Zoom"})}),(0,ko.jsx)("div",{className:"msp-flex-row",children:(0,ko.jsx)(gr,{onClick:()=>lt.Camera.OrientAxes(this.plugin),disabled:!this.state.isCameraResetEnabled,title:"Align principal component axes of the loaded structures to the screen axes (\u201Clay flat\u201D)",children:"Orient Axes"})}),(0,ko.jsx)("div",{className:"msp-flex-row",children:(0,ko.jsx)(gr,{onClick:()=>lt.Camera.ResetAxes(this.plugin),disabled:!this.state.isCameraResetEnabled,title:"Align Cartesian axes to the screen axes",children:"Reset Axes"})})]})}),(0,ko.jsx)("div",{className:"msp-hover-box-spacer"})]}),this.plugin.config.get(Lr.Viewport.ShowScreenshotControls)&&(0,ko.jsxs)("div",{children:[(0,ko.jsx)("div",{className:"msp-semi-transparent-background"}),this.icon(Gne,this.toggleScreenshotExpanded,"Screenshot / State Snapshot",this.state.isScreenshotExpanded)]}),(0,ko.jsxs)("div",{children:[(0,ko.jsx)("div",{className:"msp-semi-transparent-background"}),this.plugin.config.get(Lr.Viewport.ShowControls)&&this.icon(Vne,this.toggleControls,"Toggle Controls Panel",this.plugin.layout.state.showControls),this.plugin.config.get(Lr.Viewport.ShowExpand)&&(0,ko.jsxs)("div",{className:"msp-hover-box-wrapper",children:[this.icon(Zne,this.toggleExpanded,"Toggle Expanded Viewport",this.plugin.layout.state.isExpanded),(0,ko.jsx)("div",{className:"msp-hover-box-body",children:(0,ko.jsx)("div",{className:"msp-flex-column",children:(0,ko.jsx)("div",{className:"msp-flex-row",children:(0,ko.jsx)(gr,{onClick:this.toggleFullscreen,children:s.expandToFullscreen?"Exit Fullscreen":"Fullscreen"})})})}),(0,ko.jsx)("div",{className:"msp-hover-box-spacer"})]}),!this.plugin.config.get(Lr.Viewport.ShowExpand)&&this.plugin.config.get(Lr.Viewport.ShowToggleFullscreen)&&this.icon(Lne,this.toggleFullscreen,"Toggle Full Screen",this.plugin.layout.state.expandToFullscreen),this.plugin.config.get(Lr.Viewport.ShowSettings)&&this.icon(Il,this.toggleSettingsExpanded,"Settings / Controls Info",this.state.isSettingsExpanded),this.plugin.config.get(Lr.Viewport.ShowIllumination)&&this.icon($ne,this.toggleIllumination,"Illumination",this.plugin.canvas3d?.props.illumination.enabled||!1),i&&this.icon(eoe,this.toggleXR,a,o,!n)]}),this.plugin.config.get(Lr.Viewport.ShowSelectionMode)&&(0,ko.jsxs)("div",{children:[(0,ko.jsx)("div",{className:"msp-semi-transparent-background"}),(0,ko.jsx)(o0,{})]})]}),this.state.isScreenshotExpanded&&(0,ko.jsx)("div",{className:"msp-viewport-controls-panel",children:(0,ko.jsx)(zl,{header:"Screenshot / State",title:"Click to close.",initialExpanded:!0,hideExpander:!0,hideOffset:!0,onHeaderClick:this.toggleScreenshotExpanded,topRightIcon:Bc,noTopMargin:!0,childrenClassName:"msp-viewport-controls-panel-controls",children:(0,ko.jsx)(s4,{close:this.toggleScreenshotExpanded})})}),this.state.isSettingsExpanded&&(0,ko.jsx)("div",{className:"msp-viewport-controls-panel",children:(0,ko.jsx)(zl,{header:"Settings / Controls Info",title:"Click to close.",initialExpanded:!0,hideExpander:!0,hideOffset:!0,onHeaderClick:this.toggleSettingsExpanded,topRightIcon:Bc,noTopMargin:!0,childrenClassName:"msp-viewport-controls-panel-controls",children:(0,ko.jsx)(u4,{})})})]})}},Xyt=()=>(0,ko.jsx)("a",{className:"msp-logo",href:"https://molstar.org",target:"_blank"}),C3e=()=>(0,ko.jsx)(i4,{logo:Xyt});var MY={};Gi(MY,{DownloadFile:()=>Qyt,OpenFiles:()=>qD});async function m4(e,t,r,n){let o=Lb(e.file?.name??""),i=t.dataFormats.binaryExtensions.has(o.ext),{data:a}=await t.builders.data.readFile({file:e,isBinary:i}),s=r==="auto"?t.dataFormats.auto(o,a.cell?.obj):t.dataFormats.get(r);if(!s){t.log.warn(`OpenFiles: could not find data provider for '${o.ext}'`),await t.state.data.build().delete(a).commit();return}let l=await s.parse(t,a);n&&await s.visuals?.(t,l)}var qD=Gs.build({display:{name:"Open Files",description:"Load one or more files and optionally create default visuals"},from:ne.Root,params:(e,t)=>{let{extensions:r,options:n}=t.dataFormats;return{files:C.FileList({accept:Array.from(r.values()).map(o=>`.${o}`).join(",")+",.gz,.zip",multiple:!0}),format:C.MappedStatic("auto",{auto:C.EmptyGroup(),specific:C.Select(n[0][0],n)}),visuals:C.Boolean(!0,{description:"Add default visuals"})}}})(({params:e,state:t},r)=>Ae.create("Open Files",async n=>{r.behaviors.layout.leftPanelTabName.next("data"),await t.transaction(async()=>{if(e.files===null){r.log.error("No file(s) selected");return}for(let o of e.files)try{if(o.file&&o.name.toLowerCase().endsWith(".zip")){let i=await Yx(n,await o.file.arrayBuffer());for(let[a,s]of Object.entries(i)){if(!(s instanceof Uint8Array)||s.length===0)continue;let l=sn.File(new File([s],a));await m4(l,r,"auto",e.visuals)}}else{let i=e.format.name==="auto"?"auto":e.format.params;await m4(o,r,i,e.visuals)}}catch(i){console.error(i),r.log.error(`Error opening file '${o.name}'`)}}).runInContext(n)})),Qyt=Gs.build({display:{name:"Download File",description:"Load one or more file from an URL"},from:ne.Root,params:(e,t)=>{let r=[...t.dataFormats.options,["zip","Zip"],["gzip","Gzip"]];return{url:C.Url(""),format:C.Select(r[0][0],r),isBinary:C.Boolean(!1),visuals:C.Boolean(!0,{description:"Add default visuals"})}}})(({params:e,state:t},r)=>Ae.create("Open Files",async n=>{r.behaviors.layout.leftPanelTabName.next("data"),await t.transaction(async()=>{try{if(e.format==="zip"||e.format==="gzip"){let o=await r.builders.data.download({url:e.url,isBinary:!0});if(e.format==="zip"){let i=await Yx(n,(o.obj?.data).buffer);for(let[a,s]of Object.entries(i)){if(!(s instanceof Uint8Array)||s.length===0)continue;let l=sn.File(new File([s],a));await m4(l,r,"auto",e.visuals)}}else{let i=sn.getUrl(e.url),a=Lb(i).name;await m4(sn.File(new File([o.obj?.data],a)),r,"auto",e.visuals)}}else{let o=r.dataFormats.get(e.format);if(!o){r.log.warn(`DownloadFile: could not find data provider for '${e.format}'`);return}let i=await r.builders.data.download({url:e.url,isBinary:e.isBinary}),a=await o.parse(r,i);e.visuals&&await o.visuals?.(r,a)}}catch(o){console.error(o),r.log.error(`Error downloading '${typeof e.url=="string"?e.url:e.url.url}'`)}}).runInContext(n)}));var co=_t(ur());function S3e({plugin:e}){return e.isInitialized?(0,co.jsx)(Al.Provider,{value:e,children:(0,co.jsx)(d4,{})}):(0,co.jsx)(Zyt,{plugin:e})}function Zyt({plugin:e}){let[t,r]=U1.useState({kind:"pending"});return U1.useEffect(()=>{r({kind:"pending"});let n=!0;return e.initialized.then(()=>{n&&r({kind:"initialized"})}).catch(o=>{n&&r({kind:"error",message:`${o}`})}),()=>{n=!1}},[e]),t.kind==="pending"?null:t.kind==="error"?(0,co.jsx)("div",{className:"msp-plugin",children:(0,co.jsxs)("div",{className:"msp-plugin-init-error",children:["Initialization error: ",t.message]})}):(0,co.jsx)(Al.Provider,{value:e,children:(0,co.jsx)(d4,{})})}var d4=class extends Fr{constructor(){super(...arguments);this.onDrop=r=>{r.preventDefault();let n=[];if(r.dataTransfer.items)for(let i=0;i<r.dataTransfer.items.length;i++){if(r.dataTransfer.items[i].kind!=="file")continue;let a=r.dataTransfer.items[i].getAsFile();a&&n.push(a)}else for(let i=0;i<r.dataTransfer.files.length;i++){let a=r.dataTransfer.files[i];a&&n.push(a)}let o=n.filter(i=>{let a=i.name.toLowerCase();return a.endsWith(".molx")||a.endsWith(".molj")});o.length>0?lt.State.Snapshots.OpenFile(this.plugin,{file:o[0]}):this.plugin.runTask(this.plugin.state.data.applyAction(qD,{files:n.map(i=>sn.File(i)),format:{name:"auto",params:{}},visuals:!0}))};this.onDragOver=r=>{r.preventDefault()};this.showDragOverlay=new Di(!1);this.onDragEnter=r=>{let n=!1;if(r.dataTransfer.items&&r.dataTransfer.items.length>0){for(let o=0;o<r.dataTransfer.items.length;o++)if(r.dataTransfer.items[o].kind==="file"){n=!0;break}}else for(let o=0;o<r.dataTransfer.types.length;o++)if(r.dataTransfer.types[o]==="Files"){n=!0;break}n&&this.showDragOverlay.next(!0)}}componentDidMount(){this.subscribe(this.plugin.layout.events.updated,()=>this.forceUpdate())}region(r,n){return(0,co.jsx)("div",{className:`msp-layout-region msp-layout-${r}`,children:(0,co.jsx)("div",{className:"msp-layout-static",children:n?(0,co.jsx)(n,{}):null})})}get layoutVisibilityClassName(){let r=this.plugin.layout.state,n=this.plugin.spec.components?.controls??{},o=[];return(n.top==="none"||!r.showControls||r.regionState.top==="hidden")&&o.push("msp-layout-hide-top"),n.left==="none"||!r.showControls||r.regionState.left==="hidden"?o.push("msp-layout-hide-left"):r.regionState.left==="collapsed"&&o.push("msp-layout-collapse-left"),(n.right==="none"||!r.showControls||r.regionState.right==="hidden")&&o.push("msp-layout-hide-right"),(n.bottom==="none"||!r.showControls||r.regionState.bottom==="hidden")&&o.push("msp-layout-hide-bottom"),o.join(" ")}get layoutClassName(){let r=this.plugin.layout.state,n=["msp-plugin-content"];return r.isExpanded?n.push("msp-layout-expanded"):n.push("msp-layout-standard",`msp-layout-standard-${r.controlsDisplay}`),n.join(" ")}render(){let r=this.plugin.layout.state,n=this.plugin.spec.components?.controls||{},o=this.plugin.spec.components?.viewport?.view||EY,i=this.plugin.spec.components?.sequenceViewer?.view||r4;return(0,co.jsx)("div",{className:"msp-plugin",children:(0,co.jsxs)("div",{className:this.layoutClassName,onDragEnter:this.onDragEnter,children:[(0,co.jsxs)("div",{className:this.layoutVisibilityClassName,children:[this.region("main",o),r.showControls&&n.top!=="none"&&this.region("top",n.top||i),r.showControls&&n.left!=="none"&&this.region("left",n.left||qO),r.showControls&&n.right!=="none"&&this.region("right",n.right||BY),r.showControls&&n.bottom!=="none"&&this.region("bottom",n.bottom||kY)]}),!this.plugin.spec.components?.hideTaskOverlay&&(0,co.jsx)(p3e,{}),!this.plugin.spec.components?.disableDragOverlay&&(0,co.jsx)(Yyt,{plugin:this.plugin,showDragOverlay:this.showDragOverlay})]})})}};function qyt(e,t,r){e.preventDefault(),e.stopPropagation(),r.next(!1);let n=[];if(e.dataTransfer.items)for(let o=0;o<e.dataTransfer.items.length;o++){if(e.dataTransfer.items[o].kind!=="file")continue;let i=e.dataTransfer.items[o].getAsFile();i&&n.push(i)}else for(let o=0;o<e.dataTransfer.files.length;o++){let i=e.dataTransfer.files[o];i&&n.push(i)}t.managers.dragAndDrop.handle(n)}function Yyt({plugin:e,showDragOverlay:t}){let r=Ol(t),n=o=>{o.dataTransfer.dropEffect="copy",o.preventDefault(),o.stopPropagation()};return(0,co.jsx)("div",{className:"msp-drag-drop-overlay",style:{display:r?"flex":"none"},onDragEnter:n,onDragOver:n,onDragLeave:()=>t.next(!1),onDrop:o=>qyt(o,e,t),children:"Load File(s)"})}var BY=class extends Fr{render(){let t=this.plugin.spec.components?.structureTools||XO;return(0,co.jsx)("div",{className:"msp-scrollable-container",children:(0,co.jsx)(t,{})})}},EY=class extends Fr{render(){let t=this.plugin.spec.components?.viewport?.controls||c4,r=this.plugin.spec.components?.selectionTools?.controls||jO,n=this.plugin.spec.components?.viewport?.snapshotDescription||r3e;return(0,co.jsxs)(co.Fragment,{children:[(0,co.jsx)(C3e,{}),(0,co.jsxs)("div",{className:"msp-viewport-top-left-controls",children:[(0,co.jsx)(HO,{}),(0,co.jsx)(NO,{}),(0,co.jsx)(zO,{}),(0,co.jsx)(n,{})]}),(0,co.jsx)(r,{}),(0,co.jsx)(t,{}),(0,co.jsx)(m3e,{}),(0,co.jsxs)("div",{className:"msp-highlight-toast-wrapper",children:[(0,co.jsx)(WO,{}),(0,co.jsx)(o4,{})]})]})}},kY=class extends Fr{constructor(){super(...arguments);this.wrapper=U1.createRef();this.state={entries:this.plugin.log.entries}}componentDidMount(){this.subscribe(this.plugin.events.log,()=>this.setState({entries:this.plugin.log.entries}))}componentDidUpdate(){this.scrollToBottom()}scrollToBottom(){let r=this.wrapper.current;r&&(r.scrollTop=r.scrollHeight-r.clientHeight-1)}render(){let n=this.state.entries,o=n.size,i=[];for(let a=Math.max(0,o-10),s=0;a<o;a++){let l=n.get(a);i.push((0,co.jsxs)("li",{children:[(0,co.jsx)("div",{className:"msp-log-entry-badge msp-log-entry-"+l.type}),(0,co.jsx)("div",{className:"msp-log-timestamp",children:Ure(l.timestamp)}),(0,co.jsx)("div",{className:"msp-log-entry",children:l.message})]},s++))}return(0,co.jsx)("div",{ref:this.wrapper,className:"msp-log",style:{position:"absolute",top:"0",right:"0",bottom:"0",left:"0",overflowY:"auto"},children:(0,co.jsx)("ul",{className:"msp-list-unstyled",children:i})})}};var p4;(t=>{class e{constructor(){this.providers=tl().asMutable();this.defaultAutoAttachValues=new Map}getParams(n){let o={},i=[],a=[];if(n){let s=this.providers.values();for(;;){let l=s.next();if(l.done)break;let u=l.value;u.isApplicable(n)&&(u.isHidden||(i.push([u.descriptor.name,u.label]),this.defaultAutoAttachValues.get(u.descriptor.name)&&a.push(u.descriptor.name)),o[u.descriptor.name]=C.Group({...u.getParams(n)},{label:u.label,isHidden:u.isHidden}))}}return{autoAttach:C.MultiSelect(a,i),properties:C.Group(o,{isFlat:!0})}}setDefaultAutoAttach(n,o){this.defaultAutoAttachValues.set(n,o)}get(n){if(!this.providers.get(n))throw new Error(`Custom property '${n}' is not registered.`);return this.providers.get(n)}register(n,o){this.providers.set(n.descriptor.name,n),this.defaultAutoAttachValues.set(n.descriptor.name,o)}unregister(n){this.providers.delete(n),this.defaultAutoAttachValues.delete(n)}}t.Registry=e})(p4||={});var f4=class{constructor(t){this.plugin=t}get dataState(){return this.plugin.state.data}rawData(t,r){return this.dataState.build().toRoot().apply(a8,t,r).commit({revertOnError:!0})}download(t,r){return this.dataState.build().toRoot().apply(ZS,t,r).commit({revertOnError:!0})}downloadBlob(t,r){return this.dataState.build().toRoot().apply(i8,t,r).commit({revertOnError:!0})}async readFile(t,r){let n=await this.dataState.build().toRoot().apply(s8,t,r).commit({revertOnError:!0}),o=Lb(t.file?.file?.name??"");return{data:n,fileInfo:o}}};var h4=class{constructor(t){this.plugin=t;this._providers=[];this.providerMap=new Map;this.defaultProvider=bu.auto;wi(bu,r=>this.registerPreset(r))}get dataState(){return this.plugin.state.data}resolveProvider(t){return typeof t=="string"?bu[t]??Lv(this._providers,r=>r.id===t):t}hasPreset(t){for(let r of this._providers)if(!r.isApplicable||r.isApplicable(t,this.plugin))return!0;return!1}get providers(){return this._providers}getPresets(t){if(!t)return this.providers;let r=[];for(let n of this._providers)n.isApplicable&&!n.isApplicable(t,this.plugin)||r.push(n);return r}getPresetSelect(t){let r=[];for(let n of this._providers)t&&n.isApplicable&&!n.isApplicable(t,this.plugin)||r.push([n.id,n.display.name,n.display.group]);return C.Select("auto",r)}getPresetsWithOptions(t){let r=[],n=Object.create(null);for(let o of this._providers)o.isApplicable&&!o.isApplicable(t,this.plugin)||(r.push([o.id,o.display.name]),n[o.id]=o.params?C.Group(o.params(t,this.plugin)):C.EmptyGroup());return r.length===0?C.MappedStatic("",{"":C.EmptyGroup()}):C.MappedStatic(r[0][0],n,{options:r})}registerPreset(t){if(this.providerMap.has(t.id))throw new Error(`Representation provider with id '${t.id}' already registered.`);this._providers.push(t),this.providerMap.set(t.id,t)}unregisterPreset(t){this.providerMap.delete(t.id),Sf(this._providers,t)}applyPreset(t,r,n){let o=this.resolveProvider(r);if(!o)return;let i=this.plugin.state.data,a=ci.resolveAndCheck(i,t);if(!a){Xx||console.warn("Applying structure repr. provider to bad cell.");return}let s=o.params?.(a.obj,this.plugin)||{},l=n||(o.params?C.getDefaultValues(s):{}),u=this.plugin.config.get(Lr.Structure.DefaultRepresentationPresetParams);l=C.merge(s,u,l);let c=Ae.create(`${o.display.name}`,()=>o.apply(a,l,this.plugin));return this.plugin.runTask(c)}async addRepresentation(t,r,n){let o=this.dataState.build(),i=this.buildRepresentation(o,t,r,n);if(i)return await o.commit(),i}buildRepresentation(t,r,n,o){if(!r)return;let i=ci.resolveAndCheck(this.dataState,r)?.obj?.data;if(!i)return;let a=_T(this.plugin,i,n);return o?.tag?t.to(r).applyOrUpdateTagged(o.tag,Od,a,{state:o?.initialState}).selector:t.to(r).apply(Od,a,{state:o?.initialState}).selector}};function FY(e){return e}(t=>t.CommonParams=(r,n)=>({modelProperties:C.Optional(C.Group(et.getParamDefinition(Qe.Model.CustomModelProperties,void 0,n))),structureProperties:C.Optional(C.Group(et.getParamDefinition(Qe.Model.CustomStructureProperties,void 0,n))),representationPreset:C.Optional(C.Text("auto"))}))(FY||={});var g4=FY.CommonParams,Kyt=(e,t)=>({model:C.Optional(C.Group(et.getParamDefinition(Qe.Model.ModelFromTrajectory,e,t))),showUnitcell:C.Optional(C.Boolean(!1)),structure:C.Optional(hb.getParams(void 0,"assembly").type),representationPresetParams:C.Optional(C.Group(Zg.CommonParams)),...g4(e,t)}),v3e={id:"preset-trajectory-default",display:{name:"Default (Assembly)",group:"Preset",description:"Shows the first assembly or, if that is unavailable, the first model."},isApplicable:e=>!0,params:Kyt,async apply(e,t,r){let n=r.builders.structure,o=await n.createModel(e,t.model),i=await n.insertModelProperties(o,t.modelProperties),a=await n.createStructure(i||o,t.structure),s=await n.insertStructureProperties(a,t.structureProperties),l=t.showUnitcell===void 0||t.showUnitcell?await n.tryCreateUnitcell(i,void 0,{isHidden:!0}):void 0,u=t.representationPreset||r.config.get(Lr.Structure.DefaultRepresentationPreset)||bu.auto.id,c=await r.builders.structure.representation.applyPreset(s,u,t.representationPresetParams);return{model:o,modelProperties:i,unitcell:l,structure:a,structureProperties:s,representation:c}}},Jyt=(e,t)=>({useDefaultIfSingleModel:C.Optional(C.Boolean(!1)),representationPresetParams:C.Optional(C.Group(Zg.CommonParams)),...g4(e,t)}),$yt={id:"preset-trajectory-all-models",display:{name:"All Models",group:"Preset",description:"Shows all models; colored by trajectory-index."},isApplicable:e=>e.data.frameCount>1,params:Jyt,async apply(e,t,r){let n=ci.resolveAndCheck(r.state.data,e)?.obj?.data;if(!n)return{};if(n.frameCount===1&&t.useDefaultIfSingleModel)return v3e.apply(e,t,r);let o=r.builders.structure,i=[],a=[];for(let s=0;s<n.frameCount;s++){let l=await o.createModel(e,{modelIndex:s}),u=await o.insertModelProperties(l,t.modelProperties,{isCollapsed:!0}),c=await o.createStructure(u||l,{name:"model",params:{}}),m=await o.insertStructureProperties(c,t.structureProperties);i.push(l),a.push(c);let d=c.obj?kW(c.obj.data,{elementCountFactor:n.frameCount}):"medium",p=t.representationPreset||r.config.get(Lr.Structure.DefaultRepresentationPreset)||bu.auto.id;await o.representation.applyPreset(m,p,{theme:{globalName:"trajectory-index"},quality:d})}return{models:i,structures:a}}},I3e=(e,t)=>({model:C.Optional(C.Group(et.getParamDefinition(Qe.Model.ModelFromTrajectory,e,t))),...g4(e,t)});async function A3e(e,t,r,n){let o=n.builders.structure,i=await o.createModel(t,r.model),a=await o.insertModelProperties(i,r.modelProperties),s=await o.createStructure(a||i,{name:"symmetry",params:e}),l=await o.insertStructureProperties(s,r.structureProperties),u=await o.tryCreateUnitcell(a,void 0,{isHidden:!1}),c=r.representationPreset||n.config.get(Lr.Structure.DefaultRepresentationPreset)||bu.auto.id,m=await n.builders.structure.representation.applyPreset(l,c,{theme:{globalName:e.theme}});return{model:i,modelProperties:a,unitcell:u,structure:s,structureProperties:l,representation:m}}var ebt={id:"preset-trajectory-unitcell",display:{name:"Unit Cell",group:"Preset",description:"Shows the fully populated unit cell."},isApplicable:e=>Gt.hasCrystalSymmetry(e.data.representative),params:I3e,async apply(e,t,r){return await A3e({ijkMin:b.create(0,0,0),ijkMax:b.create(0,0,0)},e,t,r)}},tbt={id:"preset-trajectory-supercell",display:{name:"Super Cell",group:"Preset",description:"Shows the super cell, i.e. the central unit cell and all adjacent unit cells."},isApplicable:e=>Gt.hasCrystalSymmetry(e.data.representative),params:I3e,async apply(e,t,r){return await A3e({ijkMin:b.create(-1,-1,-1),ijkMax:b.create(1,1,1),theme:"operator-hkl"},e,t,r)}},rbt=(e,t)=>({model:C.Optional(C.Group(et.getParamDefinition(Qe.Model.ModelFromTrajectory,e,t))),...g4(e,t)}),nbt={id:"preset-trajectory-crystal-contacts",display:{name:"Crystal Contacts",group:"Preset",description:"Showsasymetric unit and chains from neighbours within 5 \u212B, i.e., symmetry mates."},isApplicable:e=>Gt.hasCrystalSymmetry(e.data.representative),params:rbt,async apply(e,t,r){let n=r.builders.structure,o=await n.createModel(e,t.model),i=await n.insertModelProperties(o,t.modelProperties),a=await n.createStructure(i||o,{name:"symmetry-mates",params:{radius:5}}),s=await n.insertStructureProperties(a,t.structureProperties),l=await n.tryCreateUnitcell(i,void 0,{isHidden:!0}),u=t.representationPreset||r.config.get(Lr.Structure.DefaultRepresentationPreset)||bu.auto.id,c=await r.builders.structure.representation.applyPreset(s,u,{theme:{globalName:"operator-name",carbonColor:"operator-name",focus:{name:"element-symbol",params:{carbonColor:{name:"operator-name",params:JI.defaultValues}}}}});return{model:o,modelProperties:i,unitcell:l,structure:a,structureProperties:s,representation:c}}},y4={default:v3e,"all-models":$yt,unitcell:ebt,supercell:tbt,crystalContacts:nbt};var b4=class{constructor(t){this.plugin=t;this._providers=[];this.providerMap=new Map;this.defaultProvider=y4.default;wi(y4,r=>this.registerPreset(r))}resolveProvider(t){return typeof t=="string"?y4[t]??Lv(this._providers,r=>r.id===t):t}hasPreset(t){for(let r of this._providers)if(!r.isApplicable||r.isApplicable(t,this.plugin))return!0;return!1}get providers(){return this._providers}getPresets(t){if(!t)return this.providers;let r=[];for(let n of this._providers)n.isApplicable&&!n.isApplicable(t,this.plugin)||r.push(n);return r}getPresetSelect(t){let r=[];for(let n of this._providers)t&&n.isApplicable&&!n.isApplicable(t,this.plugin)||r.push([n.id,n.display.name]);return C.Select("auto",r)}getPresetsWithOptions(t){let r=[],n=Object.create(null);for(let o of this._providers)o.isApplicable&&!o.isApplicable(t,this.plugin)||(r.push([o.id,o.display.name]),n[o.id]=o.params?C.Group(o.params(t,this.plugin)):C.EmptyGroup());return r.length===0?C.MappedStatic("",{"":C.EmptyGroup()}):C.MappedStatic(r[0][0],n,{options:r})}registerPreset(t){if(this.providerMap.has(t.id))throw new Error(`Hierarchy provider with id '${t.id}' already registered.`);this._providers.push(t),this.providerMap.set(t.id,t)}unregisterPreset(t){this.providerMap.delete(t.id),Sf(this._providers,t)}applyPreset(t,r,n){let o=this.resolveProvider(r);if(!o)return;let i=this.plugin.state.data,a=ci.resolveAndCheck(i,t);if(!a){Xx||console.warn("Applying hierarchy preset provider to bad cell.");return}let s=n||(o.params?C.getDefaultValues(o.params(a.obj,this.plugin)):{}),l=Ae.create(`${o.display.name}`,()=>o.apply(a,s,this.plugin));return this.plugin.runTask(l)}};var x4=class{constructor(t){this.plugin=t;this.hierarchy=new b4(this.plugin);this.representation=new h4(this.plugin)}get dataState(){return this.plugin.state.data}async parseTrajectoryData(t,r){let n=typeof r=="string"?this.plugin.dataFormats.get(r):r;if(!n)throw new Error(`'${r}' is not a supported data format.`);let{trajectory:o}=await n.parse(this.plugin,t);return o}parseTrajectoryBlob(t,r){return this.dataState.build().to(t).apply(Qe.Data.ParseBlob,r,{state:{isGhost:!0}}).apply(Qe.Model.TrajectoryFromBlob,void 0).commit({revertOnError:!0})}parseTrajectory(t,r){let n=ci.resolveAndCheck(this.dataState,t);if(!n)throw new Error("Invalid data cell.");return ne.Data.Blob.is(n.obj)?this.parseTrajectoryBlob(t,r):this.parseTrajectoryData(t,r)}createModel(t,r,n){return this.dataState.build().to(t).apply(Qe.Model.ModelFromTrajectory,r||{modelIndex:0},{state:n}).commit({revertOnError:!0})}insertModelProperties(t,r,n){return this.dataState.build().to(t).apply(Qe.Model.CustomModelProperties,r,{state:n}).commit({revertOnError:!0})}tryCreateUnitcell(t,r,n){let o=this.dataState,i=ci.resolveAndCheck(o,t)?.obj?.data;if(!i)return;let a=Qo.Provider.get(i)?.spacegroup.cell;return ha.isZero(a)?void 0:o.build().to(t).apply(Qe.Representation.ModelUnitcell3D,r,{state:n}).commit({revertOnError:!0})}createStructure(t,r,n,o){let i=this.dataState;if(!r){let s=ci.resolveAndCheck(i,t);if(s){let l=Qo.Provider.get(s.obj?.data);(!l||l?.assemblies.length===0)&&(r={name:"model",params:{}})}}return i.build().to(t).apply(Qe.Model.StructureFromModel,{type:r||{name:"assembly",params:{}}},{state:n,tags:o}).commit({revertOnError:!0})}insertStructureProperties(t,r){return this.dataState.build().to(t).apply(Qe.Model.CustomStructureProperties,r).commit({revertOnError:!0})}isComponentTransform(t){return t.transform.transformer===Qe.Model.StructureComponent}async tryCreateComponent(t,r,n,o){let i=this.dataState,a=i.build().to(t),s=`structure-component-${n}`,l=a.applyOrUpdateTagged(s,Qe.Model.StructureComponent,r,{tags:o?[...o,s]:[s]});await l.commit();let u=l.selector;if(!u.isOk||u.cell?.obj?.data.elementCount===0){await i.build().delete(u.ref).commit();return}return u}tryCreateComponentFromExpression(t,r,n,o){return this.tryCreateComponent(t,{type:{name:"expression",params:r},nullIfEmpty:!0,label:(o?.label||"").trim()},n,o?.tags)}tryCreateComponentStatic(t,r,n){return this.tryCreateComponent(t,{type:{name:"static",params:r},nullIfEmpty:!0,label:(n?.label||"").trim()},`static-${r}`,n?.tags)}tryCreateComponentFromSelection(t,r,n,o){return this.plugin.runTask(Ae.create("Query Component",async i=>{let{label:a,tags:s}=o||{};a=(a||"").trim();let l=ci.resolveAndCheck(this.dataState,t)?.obj?.data;if(!l)return;let u=r.referencesCurrent?{type:{name:"bundle",params:Q.Bundle.fromSelection(await r.getSelection(this.plugin,i,l))},nullIfEmpty:!0,label:a||r.label}:{type:{name:"expression",params:r.expression},nullIfEmpty:!0,label:a||r.label};return r.ensureCustomProperties&&await r.ensureCustomProperties({runtime:i,assetManager:this.plugin.managers.asset,errorContext:this.plugin.errorContext},l),this.tryCreateComponent(t,u,n,s)}))}};var T3e;(t=>{function e(r){let{name:n}=r;return{descriptor:r,get(o){return o._propertyData[n]},set(o,i){o.customProperties.add(r),o._propertyData[n]=i}}}t.create=e})(T3e||={});var C4;(r=>(r.Descriptor={name:"recommended_iso_value"},r.Provider=T3e.create(r.Descriptor)))(C4||={});var jT="Volume";async function YD(e,t){if(!t)return;let{entryId:r}=t;if(!(!r||!r.toLowerCase().startsWith("emd")))return e.runTask(Ae.create("Try Set Recommended IsoValue",async n=>{try{let o=await Uq(e,n,r);C4.Provider.set(t,Ge.IsoValue.absolute(o))}catch(o){console.warn(o)}}))}function P3e(e){let t=C4.Provider.get(e);if(t)return t.kind==="relative"?t:Ge.adjustedIsoValue(e,t.absoluteValue,"absolute")}async function LY(e,t){let r={},n=t.volume.data&&P3e(t.volume.data);return n&&(r.isoValue=n),[await e.build().to(t.volume).apply(Qe.Representation.VolumeRepresentation3D,Gb(e,t.volume.data,{type:"isosurface",typeParams:r})).commit()]}var obt={label:"CCP4/MRC/MAP",description:"CCP4/MRC/MAP",category:jT,binaryExtensions:["ccp4","mrc","map"],parse:async(e,t,r)=>{let n=e.build().to(t).apply(Qe.Data.ParseCcp4,{},{state:{isGhost:!0}}),o=n.apply(Qe.Volume.VolumeFromCcp4,{entryId:r?.entryId});return await n.commit({revertOnError:!0}),await YD(e,o.selector.data),{format:n.selector,volume:o.selector}},visuals:LY},ibt={label:"DSN6/BRIX",description:"DSN6/BRIX",category:jT,binaryExtensions:["dsn6","brix"],parse:async(e,t,r)=>{let n=e.build().to(t).apply(Qe.Data.ParseDsn6,{},{state:{isGhost:!0}}),o=n.apply(Qe.Volume.VolumeFromDsn6,{entryId:r?.entryId});return await n.commit({revertOnError:!0}),await YD(e,o.selector.data),{format:n.selector,volume:o.selector}},visuals:LY},abt={label:"DX",description:"DX",category:jT,stringExtensions:["dx"],binaryExtensions:["dxbin"],parse:async(e,t,r)=>{let o=e.build().to(t).apply(Qe.Data.ParseDx,{},{state:{isGhost:!0}}).apply(Qe.Volume.VolumeFromDx,{entryId:r?.entryId});return await o.commit({revertOnError:!0}),await YD(e,o.selector.data),{volume:o.selector}},visuals:LY},sbt={label:"Cube",description:"Cube",category:jT,stringExtensions:["cub","cube"],parse:async(e,t,r)=>{let n=e.build().to(t).apply(Qe.Data.ParseCube,{},{state:{isGhost:!0}}),o=n.apply(Qe.Volume.VolumeFromCube,{entryId:r?.entryId}),i=n.apply(Qe.Model.TrajectoryFromCube,void 0,{state:{isGhost:!0}}).apply(Qe.Model.ModelFromTrajectory).apply(Qe.Model.StructureFromModel);return await n.commit({revertOnError:!0}),await YD(e,o.selector.data),{format:n.selector,volume:o.selector,structure:i.selector}},visuals:async(e,t)=>{let r=e.build(),n=[],o=t.volume.cell?.obj?.data;if(o&&Ge.isOrbitals(o)){let s=r.to(t.volume).apply(Qe.Representation.VolumeRepresentation3D,Gb(e,o,{type:"isosurface",typeParams:{isoValue:Ge.IsoValue.relative(1),alpha:.4},color:"uniform",colorParams:{value:Lt.blue}})),l=r.to(t.volume).apply(Qe.Representation.VolumeRepresentation3D,Gb(e,o,{type:"isosurface",typeParams:{isoValue:Ge.IsoValue.relative(-1),alpha:.4},color:"uniform",colorParams:{value:Lt.red}}));n.push(s.selector,l.selector)}else{let s=r.to(t.volume).apply(Qe.Representation.VolumeRepresentation3D,Gb(e,o,{type:"isosurface",typeParams:{isoValue:Ge.IsoValue.relative(2),alpha:.4},color:"uniform",colorParams:{value:Lt.grey}}));n.push(s.selector)}let i=await e.builders.structure.representation.applyPreset(t.structure,"auto");await r.commit();let a=[];return wi(i?.representations,s=>{s&&a.push(s)}),[...n,...a]}},lbt={label:"DensityServer CIF",description:"DensityServer CIF",category:jT,stringExtensions:["cif"],binaryExtensions:["bcif"],isApplicable:(e,t)=>ZA(e,t)==="dscif",parse:async(e,t,r)=>{let n=await e.build().to(t).apply(Qe.Data.ParseCif).commit(),o=e.build().to(n),i=n.obj.data.blocks;if(i.length===0)throw new Error("no data blocks");let a=[],s=0;for(let l of i){if(l.header.toUpperCase()==="SERVER")continue;let u=Array.isArray(r?.entryId)?r?.entryId[s]:r?.entryId;l.categories.volume_data_3d_info?.rowCount>0&&(a.push(o.apply(Qe.Volume.VolumeFromDensityServerCif,{blockHeader:l.header,entryId:u}).selector),s++)}await o.commit();for(let l of a)await YD(e,l.data);return{volumes:a}},visuals:async(e,t)=>{let{volumes:r}=t,n=e.build(),o=[];if(r.length>0){let i=r[0].data&&P3e(r[0].data)||Ge.IsoValue.relative(1.5);o[0]=n.to(r[0]).apply(Qe.Representation.VolumeRepresentation3D,nh.getDefaultParamsStatic(e,"isosurface",{isoValue:i,alpha:1},"uniform",{value:Lt.teal})).selector}if(r.length>1){let i=nh.getDefaultParamsStatic(e,"isosurface",{isoValue:Ge.IsoValue.relative(3),alpha:.3},"uniform",{value:Lt.green}),a=nh.getDefaultParamsStatic(e,"isosurface",{isoValue:Ge.IsoValue.relative(-3),alpha:.3},"uniform",{value:Lt.red});o[o.length]=n.to(r[1]).apply(Qe.Representation.VolumeRepresentation3D,i).selector,o[o.length]=n.to(r[1]).apply(Qe.Representation.VolumeRepresentation3D,a).selector}return await n.commit(),o}},ubt={label:"Segmentation CIF",description:"Segmentation CIF",category:jT,stringExtensions:["cif"],binaryExtensions:["bcif"],isApplicable:(e,t)=>ZA(e,t)==="segcif",parse:async(e,t)=>{let r=await e.build().to(t).apply(Qe.Data.ParseCif).commit(),n=e.build().to(r),o=r.obj.data.blocks;if(o.length===0)throw new Error("no data blocks");let i=[];for(let a of o)a.header.toUpperCase()!=="SERVER"&&a.categories.volume_data_3d_info?.rowCount>0&&i.push(n.apply(Qe.Volume.VolumeFromSegmentationCif,{blockHeader:a.header}).selector);return await n.commit(),{volumes:i}},visuals:async(e,t)=>{let{volumes:r}=t,n=e.build(),o=[];return r.length>0&&Ge.Segmentation.get(r[0].data)&&(o[o.length]=n.to(r[0]).apply(Qe.Representation.VolumeRepresentation3D,nh.getDefaultParams(e,"segment",r[0].data,{alpha:1,instanceGranularity:!0},"volume-segment",{})).selector),await n.commit(),o}},_3e=[["ccp4",obt],["dsn6",ibt],["cube",sbt],["dx",abt],["dscif",lbt],["segcif",ubt]];var cbt="Shape",mbt={label:"PLY",description:"PLY",category:cbt,stringExtensions:["ply"],parse:async(e,t)=>{let r=e.state.data.build().to(t).apply(Qe.Data.ParsePly,{},{state:{isGhost:!0}}),n=r.apply(Qe.Model.ShapeFromPly);return await r.commit(),{format:r.selector,shape:n.selector}},visuals(e,t){return e.state.data.build().to(t.shape).apply(Qe.Representation.ShapeRepresentation3D).commit()}},R3e=[["ply",mbt]];var S4=class{constructor(){this._list=[];this._map=new Map;this._extensions=void 0;this._binaryExtensions=void 0;this._options=void 0;for(let[t,r]of _3e)this.add(t,r);for(let[t,r]of sRe)this.add(t,r);for(let[t,r]of lRe)this.add(t,r);for(let[t,r]of R3e)this.add(t,r);for(let[t,r]of $V)this.add(t,r)}get types(){return this._list.map(t=>[t.name,t.provider.label])}get extensions(){if(this._extensions)return this._extensions;let t=new Set;return this._list.forEach(({provider:r})=>{r.stringExtensions?.forEach(n=>t.add(n)),r.binaryExtensions?.forEach(n=>t.add(n))}),this._extensions=t,t}get binaryExtensions(){if(this._binaryExtensions)return this._binaryExtensions;let t=new Set;return this._list.forEach(({provider:r})=>r.binaryExtensions?.forEach(n=>t.add(n))),this._binaryExtensions=t,t}get options(){if(this._options)return this._options;let t=[];return this._list.forEach(({name:r,provider:n})=>t.push([r,n.label,n.category||""])),this._options=t,t}_clear(){this._extensions=void 0,this._binaryExtensions=void 0,this._options=void 0}add(t,r){this._clear(),this._list.push({name:t,provider:r}),this._map.set(t,r)}remove(t){this._clear(),this._list.splice(this._list.findIndex(r=>r.name===t),1),this._map.delete(t)}auto(t,r){for(let n=0,o=this.list.length;n<o;++n){let i=this._list[n].provider,a=!1;if((i.binaryExtensions?.includes(t.ext)||i.stringExtensions?.includes(t.ext))&&(a=!0),a&&(!i.isApplicable||i.isApplicable(t,r.data)))return i}}get(t){if(this._map.has(t))return this._map.get(t);throw new Error(`unknown data format name '${t}'`)}get list(){return this._list}};var v4=class extends qs{constructor(r){super({params:{current:""},animationState:"stopped"});this.context=r;this.map=new Map;this._animations=[];this.currentTime=0;this._params=void 0;this.events={updated:this.ev(),applied:this.ev()};this.isStopped=!0;this.isApplying=!1}get isEmpty(){return this._animations.length===0}get current(){return this._current}get animations(){return this._animations}get isAnimatingStateTransition(){return this._current.anim.name==="built-in.animate-state-snapshot-transition"}triggerUpdate(){this.events.updated.next(void 0)}triggerApply(){this.events.applied.next(void 0)}getParams(){return this._params||(this._params={current:C.Select(this._animations[0]&&this._animations[0].name,this._animations.map(r=>[r.name,r.display.name]),{label:"Animation"})}),this._params}updateParams(r){if(this.isEmpty)return;this.updateState({params:{...this.state.params,...r}});let n=this.map.get(this.state.params.current),o=n.params(this.context);this._current={anim:n,params:o,paramValues:C.getDefaultValues(o),state:{},startedTime:-1,lastTime:0},this.triggerUpdate()}updateCurrentParams(r){this.isEmpty||(this._current.paramValues={...this._current.paramValues,...r},this.triggerUpdate())}register(r){if(this.map.has(r.name)){this.context.log.error(`Animation '${r.name}' is already registered.`);return}this._params=void 0,this.map.set(r.name,r),this._animations.push(r),this._animations.length===1?this.updateParams({current:r.name}):this.triggerUpdate()}async play(r,n){await this.stop(),this.map.has(r.name)||this.register(r),this.updateParams({current:r.name}),this.updateCurrentParams(n),await this.start()}async tick(r,n,o){this.currentTime=r,!this.isStopped&&(n||o?await this.applyFrame(o):this.applyAsync())}async start(){this.updateState({animationState:"playing"}),this.context.behaviors.state.isAnimating.value||this.context.behaviors.state.isAnimating.next(!0),this.triggerUpdate();let r=this._current.anim,n=this._current.anim.initialState(this._current.paramValues,this.context);if(r.setup){let o=await r.setup(this._current.paramValues,n,this.context);o&&(n=o)}this._current.lastTime=0,this._current.startedTime=-1,this._current.state=n,this.isStopped=!1}async stop(){if(this.isStopped=!0,this.state.animationState!=="stopped"){let r=this._current.anim;r.teardown&&await r.teardown(this._current.paramValues,this._current.state,this.context),this.updateState({animationState:"stopped"}),this.triggerUpdate()}this.context.behaviors.state.isAnimating.value&&this.context.behaviors.state.isAnimating.next(!1)}stopStateTransitionAnimation(){if(this.isAnimatingStateTransition)return this.stop()}get isAnimating(){return this.state.animationState==="playing"}async applyAsync(){if(!this.isApplying){this.isApplying=!0;try{await this.applyFrame()}finally{this.isApplying=!1}}}async applyFrame(r){let n=this.currentTime;this._current.startedTime<0&&(this._current.startedTime=n);let o=await this._current.anim.apply(this._current.state,{lastApplied:this._current.lastTime,current:n-this._current.startedTime,animation:r},{params:this._current.paramValues,plugin:this.context});o.kind==="finished"?this.stop():o.kind==="next"&&(this._current.state=o.state,this._current.lastTime=n-this._current.startedTime),this.triggerApply()}getSnapshot(){return this.current?{state:this.state,current:{paramValues:this._current.paramValues,state:this._current.anim.stateSerialization?this._current.anim.stateSerialization.toJSON(this._current.state):this._current.state}}:{state:this.state}}setSnapshot(r){this.isEmpty||(this.updateState({animationState:r.state.animationState}),this.updateParams(r.state.params),r.current&&(this.current.paramValues=r.current.paramValues,this.current.state=this._current.anim.stateSerialization?this._current.anim.stateSerialization.fromJSON(r.current.state):r.current.state,this.triggerUpdate(),this.state.animationState==="playing"&&this.resume()))}async resume(){this._current.lastTime=0,this._current.startedTime=-1;let r=this._current.anim;this.context.behaviors.state.isAnimating.value||this.context.behaviors.state.isAnimating.next(!0),r.setup&&await r.setup(this._current.paramValues,this._current.state,this.context),this.isStopped=!1}};function D3e(e,t,r){let n=r[0],o=r[1],i=r[2],a=-n*t[0]-o*t[1]-i*t[2],s=e[0],l=e[1],u=e[2];return(n*s+o*l+i*u+a)/Math.sqrt(n*n+o*o+i*i)}function dbt(e,t,r,n){let o=D3e(e,t,n);return{aroundX:D3e(e,t,r)<0,aroundY:o<0}}function w3e(e,t,r){if(!e.canvas3d)return;let{origin:n,dirA:o,dirB:i,dirC:a}=r.principalAxes.boxAxes,s=b.clone(o),l=b.clone(a);if(r.positionToFlip){let{aroundX:c,aroundY:m}=dbt(r.positionToFlip,n,s,i);c&&(b.negate(l,l),b.negate(s,s)),m&&b.negate(l,l)}let u=b.scale(b(),n,-100);return b.dot(u,s)<=0&&b.negate(l,l),b.dot(b.unitY,l)<=0&&b.negate(s,s),e.canvas3d.camera.getFocus(n,t,s,l,ro.createDefaultSnapshot())}var pbt=3,oy={identity:Mt.create(1,0,0,0,1,0,0,0,1),rotX90:Mt.create(1,0,0,0,0,1,0,-1,0),rotY90:Mt.create(0,0,-1,0,1,0,1,0,0),rotZ90:Mt.create(0,1,0,-1,0,0,0,0,1),rotX270:Mt.create(1,0,0,0,0,-1,0,1,0),rotY270:Mt.create(0,0,1,0,1,0,-1,0,0),rotZ270:Mt.create(0,-1,0,1,0,0,0,0,1),rotX180:Mt.create(1,0,0,0,-1,0,0,0,-1),rotY180:Mt.create(-1,0,0,0,1,0,0,0,-1),rotZ180:Mt.create(-1,0,0,0,-1,0,0,0,1)};function M3e(e,t){let r=hbt(e,pbt);return fbt(r,t)}function fbt(e,t){if(e.length===0)return console.warn("Skipping PCA, no atoms"),{rotation:oy.identity,origin:b.zero()};let r=Bu.calculateMomentsAxes(e),n=Bu.calculateNormalizedAxes(r),o=xbt(n.dirA,n.dirB,n.dirC);Cbt(o);let i=t?gbt(o,t):ybt(e,o,r.origin);return Mt.mul(o,i,o),{rotation:o,origin:n.origin}}function hbt(e,t){let r;return r=VY(e,{onlyTrace:!0}),r.length>=3*t||(r=VY(e,{skipHydrogens:!0,skipWater:!0}),r.length>=3*t)||(r=VY(e,{})),r}function VY(e,t){let{onlyTrace:r,skipHydrogens:n,skipWater:o}=t,{x:i,y:a,z:s,type_symbol:l,label_comp_id:u}=Ke.atom,c=[];for(let m of e){let d=Q.Location.create(m);for(let p of m.units){d.unit=p;let h=r?p.polymerElements:p.elements;for(let f=0;f<h.length;f++)d.element=h[f],!(n&&l(d)==="H")&&(o&&u(d)==="HOH"||c.push(i(d),a(d),s(d)))}}return c}function gbt(e,t){let r=oy.identity,n=0,o=Mt();for(let i of[oy.identity,oy.rotX180,oy.rotY180,oy.rotZ180]){let a=Mt.innerProduct(Mt.mul(o,i,e),t);a>n&&(r=i,n=a)}return r}function ybt(e,t,r){let n=b.create(Mt.getValue(t,0,0),Mt.getValue(t,0,1),Mt.getValue(t,0,2)),o=b.create(Mt.getValue(t,1,0),Mt.getValue(t,1,1),Mt.getValue(t,1,2)),i=b.create(Mt.getValue(t,2,0),Mt.getValue(t,2,1),Mt.getValue(t,2,2)),a=Math.floor(e.length/3),s=b(),l=0,u=0,c=0;for(let p=0;p<a;p++)b.fromArray(s,e,3*p),b.sub(s,s,r),l+=p*b.dot(s,n),u+=p*b.dot(s,o),c+=bbt(p,a)*b.dot(s,i);let m=c<0,d=m?l+u<0:l-u<0;return d&&m?oy.rotY180:m?oy.rotX180:d?oy.rotZ180:oy.identity}function bbt(e,t){let r=Math.floor(t/2);return e<r?t%2?r-e:r-e-1:e-r}function xbt(e,t,r){let n=Mt();return Mt.setValue(n,0,0,e[0]),Mt.setValue(n,0,1,e[1]),Mt.setValue(n,0,2,e[2]),Mt.setValue(n,1,0,t[0]),Mt.setValue(n,1,1,t[1]),Mt.setValue(n,1,2,t[2]),Mt.setValue(n,2,0,r[0]),Mt.setValue(n,2,1,r[1]),Mt.setValue(n,2,2,r[2]),n}function Cbt(e){Mt.determinant(e)<0&&(Mt.setValue(e,2,0,-Mt.getValue(e,2,0)),Mt.setValue(e,2,1,-Mt.getValue(e,2,1)),Mt.setValue(e,2,2,-Mt.getValue(e,2,2)))}function OY(e,t){let r=Mt.invert(Mt(),t),n=b.distance(e.position,e.target),o=b.transformMat3(b(),b.create(0,0,n),r),i=b.transformMat3(b(),b.create(0,1,0),r),a=b.add(b(),e.target,o);return{...e,position:a,up:i}}var I4={minRadius:1,extraRadius:4,durationMs:250},A4=class{constructor(t){this.plugin=t;this.boundaryHelper=new Fi("98")}transformedLoci(t){if(Q.Loci.is(t)){let r=this.plugin.helpers.substructureParent.get(t.structure)?.obj?.data;r&&(t=Q.Loci.remap(t,r))}return t}focusRenderObjects(t,r){if(!t)return;let n=[];for(let o of t){let i=o.values.boundingSphere.ref.value;i.radius!==0&&n.push(i)}this.focusSpheres(n,o=>o,r)}focusLoci(t,r){let n;if(Array.isArray(t)&&t.length>1){let o=[];for(let i of t){let a=nr.getBoundingSphere(this.transformedLoci(i));a&&o.push(a)}if(o.length===0)return;this.boundaryHelper.reset();for(let i of o)this.boundaryHelper.includeSphere(i);this.boundaryHelper.finishedIncludeStep();for(let i of o)this.boundaryHelper.radiusSphere(i);n=this.boundaryHelper.getSphere()}else if(Array.isArray(t)){if(t.length===0)return;n=nr.getBoundingSphere(this.transformedLoci(t[0]))}else n=nr.getBoundingSphere(this.transformedLoci(t));n&&this.focusSphere(n,r)}focusSpheres(t,r,n){let o=[];for(let i of t){let a=r(i);a&&o.push(a)}if(o.length!==0){if(o.length===1)return this.focusSphere(o[0],n);this.boundaryHelper.reset();for(let i of o)this.boundaryHelper.includeSphere(i);this.boundaryHelper.finishedIncludeStep();for(let i of o)this.boundaryHelper.radiusSphere(i);this.focusSphere(this.boundaryHelper.getSphere(),n)}}focusSphere(t,r){let{canvas3d:n}=this.plugin;if(!n)return;let{extraRadius:o,minRadius:i,durationMs:a}={...I4,...r},s=Math.max(t.radius+o,i);if(r?.principalAxes){let l=w3e(this.plugin,s,r);this.plugin.canvas3d?.requestCameraReset({durationMs:a,snapshot:l})}else{let l=n.camera.getFocus(t.center,s);n.requestCameraReset({durationMs:a,snapshot:l})}}focusObject(t){if(!this.plugin.canvas3d)return;let r=zQ(this.plugin,{...t,targets:t.targets?.map(n=>({...n,extraRadius:n.extraRadius??I4.extraRadius})),minRadius:t.minRadius??I4.minRadius});this.plugin.canvas3d.requestCameraReset({snapshot:r,durationMs:t.durationMs??I4.durationMs})}orientAxes(t,r){if(!this.plugin.canvas3d)return;t||(t=this.plugin.state.data.selectQ(s=>s.ofType(ne.Molecule.Structure)).filter(s=>s.obj&&!s.transform.transformer.definition.isDecorator&&!s.obj.data.parent).map(s=>s.obj?.data).filter(s=>!!s));let{rotation:n}=M3e(t),o=OY(this.plugin.canvas3d.camera.getSnapshot(),n);this.setSnapshot(o,r)}resetAxes(t){if(!this.plugin.canvas3d)return;let r=OY(this.plugin.canvas3d.camera.getSnapshot(),Mt.Identity);this.setSnapshot(r,t)}setSnapshot(t,r){this.plugin.canvas3d?.requestCameraReset({snapshot:t,durationMs:r})}reset(t,r){this.plugin.canvas3d?.requestCameraReset({snapshot:t,durationMs:r})}};var T4=class{constructor(t){this.ctx=t;this.providers=[];this.locis=[];this.isDirty=!1;this.labels=[];this.groupedLabels=new Map;t.managers.interactivity.lociHighlights.addProvider((r,n,o)=>{this.providers.length!==0&&(this.mark(r,n),o||this.showLabels())})}clearProviders(){this.providers=[],this.isDirty=!0,this.showLabels()}addProvider(t){this.providers.push(t),this.providers.sort((r,n)=>(n.priority||0)-(r.priority||0)),this.isDirty=!0,this.showLabels()}removeProvider(t){this.providers=this.providers.filter(r=>r!==t),this.isDirty=!0,this.showLabels()}mark(t,r){let n=this.locis.findIndex(o=>Ut.Loci.areEqual(t,o));n===-1&&r===1?(this.locis.push(t),this.isDirty=!0):n!==-1&&r===2&&($b(this.locis,n),this.isDirty=!0)}showLabels(){this.ctx.behaviors.labels.highlight.next({labels:this.getLabels()})}getLabels(){if(this.isDirty){this.groupedLabels.clear(),this.labels.length=0;for(let t of this.providers)for(let r of this.locis){if(nr.isEmpty(r.loci))continue;let n=t.label(r.loci,r.repr);if(n){let o=t.group?t.group(n):n.toString(),i=this.groupedLabels.get(o);i?i.push(n):this.groupedLabels.set(o,[n])}}this.labels.length=0,this.groupedLabels.forEach((t,r)=>{let n=t.length,o=n>1&&t[0]!==t[1]?r:t[0];this.labels.push(n===1?o:`${o} <small>|| \xD7 ${n}</small>`)}),this.isDirty=!1}return this.labels}};var KD=new Fi("98"),Sbt=24,P4=class extends qs{constructor(r){super({entries:new Map,additionsHistory:[],stats:vbt()});this.plugin=r;this.events={changed:this.ev(),additionsHistoryUpdated:this.ev(),loci:{add:this.ev(),remove:this.ev(),clear:this.ev()}};r.helpers.substructureParent.events.removed.subscribe(n=>this.onRemove(n.ref,n.obj)),r.helpers.substructureParent.events.updated.subscribe(n=>this.onUpdate(n.ref,n.oldObj,n.obj))}get entries(){return this.state.entries}get additionsHistory(){return this.state.additionsHistory}get stats(){return this.state.stats?this.state.stats:(this.state.stats=this.calcStats(),this.state.stats)}getEntry(r){let n=this.plugin.helpers.substructureParent.get(r,!0);if(!n)return;let o=n.transform.ref;if(!this.entries.has(o)){let i=new JD(Q.Loci(r,[]));return this.entries.set(o,i),i}return this.entries.get(o)}calcStats(){let r=0,n=0,o=Q.Stats.create();this.entries.forEach(a=>{let{elements:s}=a.selection;if(s.length){r+=1;for(let l=0,u=s.length;l<u;++l)n+=xe.size(s[l].indices);Q.Stats.add(o,o,Q.Stats.ofLoci(a.selection))}});let i=r1(o,{countsOnly:!0});return{structureCount:r,elementCount:n,label:i}}add(r){if(!Q.Loci.is(r))return!1;let n=this.getEntry(r.structure);if(!n)return!1;let o=n.selection;return n.selection=Q.Loci.union(n.selection,r),this.tryAddHistory(r),this.referenceLoci=r,this.events.loci.add.next(r),!Q.Loci.areEqual(o,n.selection)}remove(r){if(!Q.Loci.is(r))return!1;let n=this.getEntry(r.structure);if(!n)return!1;let o=n.selection;return n.selection=Q.Loci.subtract(n.selection,r),this.referenceLoci=r,this.events.loci.remove.next(r),!Q.Loci.areEqual(o,n.selection)}intersect(r){if(!Q.Loci.is(r))return!1;let n=this.getEntry(r.structure);if(!n)return!1;let o=n.selection;return n.selection=Q.Loci.intersect(n.selection,r),this.referenceLoci=r,!Q.Loci.areEqual(o,n.selection)}set(r){if(!Q.Loci.is(r))return!1;let n=this.getEntry(r.structure);if(!n)return!1;let o=n.selection;return n.selection=r,this.tryAddHistory(r),this.referenceLoci=void 0,!Q.Loci.areEqual(o,n.selection)}modifyHistory(r,n,o,i=!1){let a=this.additionsHistory,s=a.indexOf(r);if(s<0)return;let l;switch(n){case"remove":$b(a,s);break;case"up":l=s-1;break;case"down":l=s+1;break}if(l!==void 0){let u=o?Math.min(a.length,o):a.length;for(;;)if(l=l%u,l<0&&(l+=u),!i||a[s].loci.structure===a[l].loci.structure){let c=a[s];a[s]=a[l],a[l]=c;break}else l+=n==="up"?-1:1}this.events.additionsHistoryUpdated.next(void 0)}tryAddHistory(r){if(nr.isEmpty(r))return;let n=0,o;for(let s of this.additionsHistory){if(nr.areEqual(s.loci,r)){o=s;break}n++}if(o){$b(this.additionsHistory,n),this.additionsHistory.unshift(o),this.events.additionsHistoryUpdated.next(void 0);return}let i=Q.Stats.ofLoci(r),a=r1(i,{reverse:!0});this.additionsHistory.unshift({id:fn.create22(),loci:r,label:a}),this.additionsHistory.length>Sbt&&this.additionsHistory.pop(),this.events.additionsHistoryUpdated.next(void 0)}clearHistory(){this.state.additionsHistory.length!==0&&(this.state.additionsHistory=[],this.events.additionsHistoryUpdated.next(void 0))}clearHistoryForStructure(r){let n=[];for(let o of this.state.additionsHistory)o.loci.structure.root===r.root&&n.push(o);for(let o of n)this.modifyHistory(o,"remove");n.length!==0&&this.events.additionsHistoryUpdated.next(void 0)}onRemove(r,n){this.entries.has(r)&&(this.entries.delete(r),n?.data&&this.clearHistoryForStructure(n.data),this.referenceLoci?.structure===n?.data&&(this.referenceLoci=void 0),this.state.stats=void 0,this.events.changed.next(void 0))}onUpdate(r,n,o){if(n===o||n?.data===o.data)return;let i=this.plugin.helpers.substructureParent.get(o.data,!0);if(!i||r!==i.transform.ref||!this.entries.has(r))return;let a=this.plugin.helpers.substructureParent.get(o.data)?.obj?.data;if(a)if(!n?.data||De.areUnitIdsAndIndicesEqual(n.data,o.data)){this.entries.set(r,Ibt(this.entries.get(r),a)),this.referenceLoci?.structure.root===a.root&&(this.referenceLoci=Q.Loci.remap(this.referenceLoci,a));let s=!1;for(let l of this.state.additionsHistory)l.loci.structure.root===a.root&&(l.loci=Q.Loci.remap(l.loci,a),s=!0);s&&this.events.additionsHistoryUpdated.next(void 0)}else this.entries.set(r,new JD(Q.Loci(a,[]))),this.referenceLoci?.structure.root===a.root&&(this.referenceLoci=void 0),this.clearHistoryForStructure(a),this.state.stats=void 0,this.events.changed.next(void 0)}clear(){let r=this.entries.keys(),n=[];for(;;){let o=r.next();if(o.done)break;let i=this.entries.get(o.value);Q.Loci.isEmpty(i.selection)||n.push(i.selection),i.selection=Q.Loci(i.selection.structure,[])}return this.referenceLoci=void 0,this.state.stats=void 0,this.events.changed.next(void 0),this.events.loci.clear.next(void 0),this.clearHistory(),n}getLoci(r){let n=this.getEntry(r);return n?n.selection:vr}getStructure(r){let n=this.getEntry(r);if(n)return n.structure}structureHasSelection(r){let n=r.cell?.obj?.data;if(!n)return!1;let o=this.getEntry(n);return!!o&&!Q.Loci.isEmpty(o.selection)}has(r){if(Q.Loci.is(r)){let n=this.getEntry(r.structure);if(n)return Q.Loci.isSubset(n.selection,r)}return!1}tryGetRange(r){if(Q.Loci.is(r)&&this.getEntry(r.structure))return GY(this.referenceLoci,r)}elementCount(){let r=0;return this.entries.forEach(n=>{r+=Q.Loci.size(n.selection)}),r}getBoundary(){let r=b.create(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),n=b.create(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);KD.reset();let o=[];this.entries.forEach(i=>{let a=i.selection;Q.Loci.isEmpty(a)||o.push(Q.Loci.getBoundary(a))});for(let i=0,a=o.length;i<a;++i){let{box:s,sphere:l}=o[i];b.min(r,r,s.min),b.max(n,n,s.max),KD.includePositionRadius(l.center,l.radius)}KD.finishedIncludeStep();for(let i=0,a=o.length;i<a;++i){let{sphere:s}=o[i];KD.radiusPositionRadius(s.center,s.radius)}return{box:{min:r,max:n},sphere:KD.getSphere()}}getPrincipalAxes(){let r=Vv(this.entries.values());return Q.Loci.getPrincipalAxesMany(r.map(n=>n.selection))}modify(r,n){let o=!1;switch(r){case"add":o=this.add(n);break;case"remove":o=this.remove(n);break;case"intersect":o=this.intersect(n);break;case"set":o=this.set(n);break}o&&(this.state.stats=void 0,this.events.changed.next(void 0))}get applicableStructures(){return this.plugin.managers.structure.hierarchy.selection.structures.filter(r=>!!r.cell.obj).map(r=>r.cell.obj.data)}triggerInteraction(r,n,o=!0){switch(r){case"add":this.plugin.managers.interactivity.lociSelects.select({loci:n},o);break;case"remove":this.plugin.managers.interactivity.lociSelects.deselect({loci:n},o);break;case"intersect":this.plugin.managers.interactivity.lociSelects.selectJoin({loci:n},o);break;case"set":this.plugin.managers.interactivity.lociSelects.selectOnly({loci:n},o);break}}fromLoci(r,n,o=!0){this.triggerInteraction(r,n,o)}fromCompiledQuery(r,n,o=!0){for(let i of this.applicableStructures){let a=n(new zo(i));this.triggerInteraction(r,ut.toLociWithSourceUnits(a),o)}}fromSelectionQuery(r,n,o=!0){this.plugin.runTask(Ae.create("Structure Selection",async i=>{for(let a of this.applicableStructures){let s=await n.getSelection(this.plugin,i,a);this.triggerInteraction(r,ut.toLociWithSourceUnits(s),o)}}))}fromSelections(r){let n=ci.resolveAndCheck(this.plugin.state.data,r);if(!(!n||!n.obj)){if(!ne.Molecule.Structure.Selections.is(n.obj)){console.warn("fromSelections applied to wrong object type.",n.obj);return}this.clear();for(let o of n.obj?.data)this.fromLoci("set",o.loci)}}getSnapshot(){let r=[];return this.entries.forEach((n,o)=>{r.push({ref:o,bundle:Q.Bundle.fromLoci(n.selection)})}),{entries:r}}setSnapshot(r){this.entries.clear();for(let{ref:n,bundle:o}of r.entries){let i=this.plugin.state.data.select(tr.Generators.byRef(n))[0]?.obj?.data;if(!i)continue;let a=Q.Bundle.toLoci(o,i);this.fromLoci("set",a,!1)}}};function vbt(){return{structureCount:0,elementCount:0,label:"Nothing Selected"}}var JD=class{constructor(t){this._structure=void 0;this._selection=t}get selection(){return this._selection}set selection(t){this._selection=t,this._structure=void 0}get structure(){return this._structure?this._structure:(nr.isEmpty(this._selection)?this._structure=void 0:this._structure=Q.Loci.toStructure(this._selection),this._structure)}};function Ibt(e,t){return new JD(Q.Loci.remap(e.selection,t))}function GY(e,t){if(!Q.Loci.is(e)||!Q.Loci.is(t)||e.structure!==t.structure||t.elements.length!==1)return;let r=t.elements[0];if(!r)return;let n;for(let o of e.elements)if(r.unit===o.unit){n=o;break}if(n&&r.unit===n.unit)return Abt(t.structure,n,r)}function Abt(e,t,r){let n=Math.min(xe.min(t.indices),xe.min(r.indices)),o=Math.max(xe.max(t.indices),xe.max(r.indices));return Q.Loci(e,[{unit:t.unit,indices:xe.ofRange(n,o)}])}var Tbt=8,_4=class extends qs{constructor(r){super({history:[]});this.plugin=r;this.events={historyUpdated:this.ev()};this.behaviors={current:this.ev.behavior(void 0)};r.state.data.events.object.removed.subscribe(({obj:o})=>{if(!ne.Molecule.Structure.is(o))return;this.current?.loci.structure===o.data&&this.clear();let i=[];for(let a of this.history)a.loci.structure===o.data&&i.push(a);i.length!==this.history.length&&(this.history.length=0,this.history.push(...i),this.events.historyUpdated.next(void 0))});let n=he();r.state.data.events.object.updated.subscribe(({oldData:o,obj:i,action:a})=>{if(ne.Molecule.Structure.is(i)&&o!==i.data&&a==="in-place"){let s=this.state.current,l=i.data;if(s&&s.loci.structure===o){let u=Q.Loci.remap(s.loci,l);this.state.current={...s,loci:u},this.behaviors.current.next(this.state.current),nr.getBoundingSphere(u,n);let c=this.plugin.canvas3d?.camera,m=c.getTargetDistance(n.radius+4);(b.distance(c.target,n.center)>n.radius||m>c.viewport.height/c.zoom)&&this.plugin.managers.camera.focusSphere(n,{durationMs:0})}}})}get current(){return this.state.current}get history(){return this.state.history}tryAddHistory(r){if(Q.Loci.isEmpty(r.loci))return;let n=0,o;for(let i of this.state.history){if(Q.Loci.areEqual(i.loci,r.loci)){o=i;break}n++}if(o){$b(this.state.history,n),this.state.history.unshift(r),this.events.historyUpdated.next(void 0);return}this.state.history.unshift(r),this.state.history.length>Tbt&&this.state.history.pop(),this.events.historyUpdated.next(void 0)}set(r){this.tryAddHistory(r),(!this.state.current||!Q.Loci.areEqual(this.state.current.loci,r.loci))&&(this.state.current=r,this.behaviors.current.next(r))}tryGetRange(r){return GY(this.referenceLoci,r)}setFromLoci(r){let n=nr.normalize(r);if(!Q.Loci.is(n)||Q.Loci.isEmpty(n)){this.clear();return}this.set({loci:n,label:Np(n,{reverse:!0,hidePrefix:!0,htmlStyling:!1})}),this.referenceLoci=n}addFromLoci(r){let n=this.state.current&&Q.Loci.is(r)&&r.structure===this.state.current.loci.structure?Q.Loci.union(r,this.state.current.loci):r;this.setFromLoci(n);let o=nr.normalize(r);this.referenceLoci=Q.Loci.is(o)?o:void 0}toggleFromLoci(r){let{kind:n,loci:o}=Pbt(this.state.current?.loci,r);this.setFromLoci(o);let i=nr.normalize(r);this.referenceLoci=Q.Loci.is(i)&&n!=="subtract"?i:void 0}extendFromLoci(r){let n=this.tryGetRange(r)??r;this.toggleFromLoci(n)}clear(){this.state.current&&(this.state.current=void 0,this.behaviors.current.next(void 0)),this.referenceLoci=void 0}getSnapshot(){if(!this.current)return{};let n=this.plugin.helpers.substructureParent.get(this.current.loci.structure)?.transform.ref;return n?{current:{label:this.current.label,ref:n,bundle:Q.Bundle.fromLoci(this.current.loci),category:this.current.category}}:{}}setSnapshot(r){if(!r.current){this.clear();return}let{label:n,ref:o,bundle:i,category:a}=r.current,s=this.plugin.state.data.select(tr.Generators.byRef(o))[0]?.obj?.data;if(!s)return;let l=Q.Bundle.toLoci(i,s);this.set({label:n,loci:l,category:a})}};function Pbt(e,t){return e&&Q.Loci.is(t)&&t.structure===e.structure?Q.Loci.isSubset(e,t)?{kind:"subtract",loci:Q.Loci.subtract(e,t)}:{kind:"add",loci:Q.Loci.union(t,e)}:{kind:"new",loci:t}}var _bt=[{name:"center-camera",execute:({event:e,args:t,manager:r})=>{e==="click"&&"center-camera"in t&&r.plugin.managers.camera.reset()}},{name:"apply-snapshot",execute:({event:e,args:t,manager:r})=>{if(e!=="click")return;let n=t["apply-snapshot"];n&&r.plugin.managers.snapshot.applyKey(n)}},{name:"next-snapshot",execute:({event:e,args:t,manager:r})=>{if(e!=="click"||!("next-snapshot"in t))return;let n=+t["next-snapshot"]||1;n&&(n<0?n=-1:n=1,r.plugin.managers.snapshot.applyNext(n))}},{name:"focus-refs",execute:({event:e,args:t,manager:r})=>{if(e!=="click")return;let n=UY(t["focus-refs"]);if(!n?.length)return;let o=r.findCells(n);if(!o.length)return;let i=B3e(r.plugin,o);if(!i.length)return;let a=i.map(s=>HQ(r.plugin,s.transform.ref)).filter(s=>!!s);a.length&&r.plugin.managers.camera.focusSpheres(a,s=>s,{extraRadius:3})}},{name:"highlight-refs",execute:({event:e,args:t,manager:r})=>{let n=UY(t["highlight-refs"]);if(n?.length){if(e==="mouse-leave"&&n.length){r.plugin.managers.interactivity.lociHighlights.clearHighlights();return}else if(e==="mouse-enter"){let o=r.findCells(n);for(let i of B3e(r.plugin,o)){if(!i.obj?.data)continue;let{repr:a}=i.obj.data;for(let s of a.getAllLoci())r.plugin.managers.interactivity.lociHighlights.highlight({loci:s,repr:a},!1)}}}}},{name:"query",execute:({event:e,args:t,manager:r})=>{let n=t.query;if(!n?.length)return;let o=t.lang||"mol-script",i=UY(t.action||"highlight"),a=parseFloat(t["focus-radius"]||"3");if(e==="mouse-leave"){i.includes("highlight")&&r.plugin.managers.interactivity.lociHighlights.clearHighlights();return}let s;try{s=Mo.toQuery({language:o,expression:n})}catch(u){console.warn(`Failed to parse query '${n}' (${o})`,u);return}let l=r.plugin.state.data.selectQ(u=>u.rootsOfType(ne.Molecule.Structure));if(e==="mouse-enter"){if(!i.includes("focus"))return;r.plugin.managers.interactivity.lociHighlights.clearHighlights();for(let u of l){if(!u.obj?.data)continue;let c=s(new zo(u.obj.data)),m=ut.toLociWithSourceUnits(c);r.plugin.managers.interactivity.lociHighlights.highlight({loci:m},!1)}}if(e==="click"){if(!i.includes("focus"))return;let c=l.map(m=>tr.getDecorated(r.plugin.state.data,m.transform.ref)).map(m=>{if(!m.obj?.data)return;let d=s(new zo(m.obj.data));if(ut.isEmpty(d))return;let p=ut.toLociWithSourceUnits(d);return Q.Loci.getBoundary(p).sphere}).filter(m=>!!m);c.length&&r.plugin.managers.camera.focusSpheres(c,m=>m,{extraRadius:a})}}},{name:"play-audio",execute:({event:e,args:t,manager:r})=>{if(e!=="click")return;let n=t["play-audio"];n?.length&&r.audio.play(n)}},{name:"toggle-audio",execute:({event:e,args:t,manager:r})=>{if(e!=="click"||!("toggle-audio"in t))return;let n=t["toggle-audio"];r.audio.play(n,{toggle:!0})}},{name:"pause-audio",execute:({event:e,args:t,manager:r})=>{e!=="click"||!("pause-audio"in t)||r.audio.pause()}},{name:"stop-audio",execute:({event:e,args:t,manager:r})=>{e!=="click"||!("stop-audio"in t)||r.audio.stop()}},{name:"dispose-audio",execute:({event:e,args:t,manager:r})=>{e!=="click"||!("dispose-audio"in t)||r.audio.dispose()}},{name:"play-transition",execute:({event:e,args:t,manager:r})=>{e!=="click"||!("play-transition"in t)||r.plugin.managers.animation.play(QC,{})}},{name:"play-snapshots",execute:({event:e,args:t,manager:r})=>{e!=="click"||!("play-snapshots"in t)||r.plugin.managers.snapshot.play({restart:!0})}},{name:"stop-animation",execute:({event:e,args:t,manager:r})=>{e!=="click"||!("stop-animation"in t)||r.plugin.managers.snapshot.stop()}}],R4=class{constructor(t){this.plugin=t;this.state={audioPlayer:new Di(null)};this.extension=[];this.refResolvers={default:(t,r)=>r.map(n=>t.state.data.cells.get(n)).filter(n=>!!n)};this.uriResolvers={};this.argsParsers=[["default",100,Rbt]];this.audio={play:async(t,r)=>{try{let n=this.resolveAudioPlayer(),o=!1;if(t?.trim()){let i=this.tryResolveUri(t),a=t;typeof i?.then=="function"?a=await i:i&&(a=i),o=n.src!==a,o&&(n.src=a,n.load())}!o&&r?.toggle?n.paused?await n.play():n.pause():(n.currentTime=0,await n.play())}catch(n){console.error("Failed to play audio",n)}},pause:()=>{this.audioPlayer?.pause()},stop:()=>{this.audioPlayer&&(this.audioPlayer.pause(),this.audioPlayer.currentTime=0)},dispose:()=>{this.audioPlayer&&(this.audioPlayer.pause(),this.audioPlayer.currentTime=0,this.state.audioPlayer.next(null))}};for(let r of _bt)this.registerExtension(r)}registerArgsParser(t,r,n){this.removeArgsParser(t),this.argsParsers.push([t,r,n]),this.argsParsers.sort((o,i)=>i[1]-o[1])}removeArgsParser(t){let r=this.argsParsers.findIndex(n=>n[0]===t);r>=0&&this.argsParsers.splice(r,1)}parseArgs(t){for(let[,,r]of this.argsParsers){let n=r(t);if(n)return n}}registerRefResolver(t,r){this.refResolvers[t]=r}removeRefResolver(t){delete this.refResolvers[t]}registerUriResolver(t,r){this.uriResolvers[t]=r}removeUriResolver(t){delete this.uriResolvers[t]}registerExtension(t){let r=this.extension.findIndex(n=>n.name===t.name);r>=0?this.extension[r]=t:this.extension.push(t)}removeExtension(t){let r=this.extension.findIndex(n=>n.name===t);r>=0&&this.extension.splice(r,1)}_tryRender(t,r){try{return t.reactRenderFn?.(r)}catch(n){return console.error(`Failed to render markdown extension '${t.name}'`,n),null}}tryRender(t,r){let n={args:t,manager:this};for(let o of this.extension){let i=this._tryRender(o,n);if(i)return i}for(let o of r){let i=this._tryRender(o,n);if(i)return i}return null}tryExecute(t,r){let n={event:t,args:r,manager:this};for(let o of this.extension)try{o.execute?.(n)}catch(i){console.error(`Failed to execute markdown extension '${o.name}'`,i)}}tryResolveUri(t){for(let r of Object.values(this.uriResolvers)){let n=r(this.plugin,t);if(n)return n}}findCells(t){let r=new Set,n=[];for(let o of Object.values(this.refResolvers))for(let i of o(this.plugin,t))i&&!r.has(i.transform.ref)&&(r.add(i.transform.ref),n.push(i));return n}resolveAudioPlayer(){if(this.state.audioPlayer.value)return this.state.audioPlayer.value;let t=document.createElement("audio");return t.controls=!0,t.preload="auto",t.style.width="100%",t.style.height="32px",this.state.audioPlayer.next(t),t}get audioPlayer(){return this.state.audioPlayer.value}};function UY(e){return e?.split(",").map(t=>t.trim()).filter(t=>t.length>0)??[]}function B3e(e,t){return t.length?e.state.data.selectQ(r=>r.byValue(...t).subtree().filter(n=>ne.isRepresentation3D(n.obj))):[]}function Rbt(e){if(!e?.startsWith("!"))return;let t=decodeURIComponent(e.substring(1)).split("&").map(r=>r.trim()).filter(r=>r.length>0).map(r=>r.split("=",2).map(n=>n.trim()));if(t.length!==0)return Object.fromEntries(t)}var Dbt=[["full","Full"],["collapsed","Collapsed"],["hidden","Hidden"]],NY=[["full","Full"],["hidden","Hidden"]],wbt={isExpanded:C.Boolean(!1),showControls:C.Boolean(!0),regionState:C.Group({left:C.Select("full",Dbt),top:C.Select("full",NY),right:C.Select("full",NY),bottom:C.Select("full",NY)}),controlsDisplay:C.Value("outside",{isHidden:!0}),expandToFullscreen:C.Boolean(!1)},D4=class extends qs{constructor(r){super({...C.getDefaultValues(wbt),...r.spec.layout&&r.spec.layout.initial});this.context=r;this.events={updated:this.ev()};this.rootState=void 0;this.fullscreenChangeHandler=()=>{document.fullscreenElement||this.updateProps({expandToFullscreen:!1})};document.addEventListener("fullscreenchange",this.fullscreenChangeHandler),document.addEventListener("webkitfullscreenchange",this.fullscreenChangeHandler),lt.Layout.Update.subscribe(r,n=>this.updateProps(n.state)),typeof document<"u"&&(this.expandedViewport=document.createElement("meta"),this.expandedViewport.name="viewport",this.expandedViewport.content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0")}updateProps(r){let n=!!this.state.isExpanded;if(this.updateState(r),this.root&&typeof r.isExpanded=="boolean"&&r.isExpanded!==n&&this.handleExpand(),this.state.expandToFullscreen){let o=document.getElementsByTagName("body")[0];o&&this.tryRequestFullscreen(o)}else document.fullscreenElement&&this.tryExitFullscreen();this.events.updated.next(void 0)}setProps(r){this.updateState(r)}setRoot(r){this.root=r,this.state.isExpanded&&this.handleExpand()}getScrollElement(){return document.scrollingElement?document.scrollingElement:document.documentElement?document.documentElement:document.body}async tryRequestFullscreen(r){if(!document.fullscreenElement)try{await r.requestFullscreen()}catch(n){console.error(n)}}async tryExitFullscreen(){if(document.fullscreenElement)try{await document.exitFullscreen()}catch(r){console.error(r)}}handleExpand(){try{let r=document.getElementsByTagName("body")[0],n=document.getElementsByTagName("head")[0];if(!r||!n||!this.root)return;if(this.state.isExpanded){let o=n.children,i=[],a=!1;for(let m=0;m<o.length;m++)o[m]===this.expandedViewport?a=!0:(o[m].name||"").toLowerCase()==="viewport"&&i.push(o[m]);for(let m of i)n.removeChild(m);a||n.appendChild(this.expandedViewport);let s=r.style,l=this.getScrollElement(),u=l.scrollLeft,c=l.scrollTop;this.rootState={top:s.top,bottom:s.bottom,right:s.right,left:s.left,scrollTop:c,scrollLeft:u,position:s.position,overflow:s.overflow,viewports:i,zIndex:this.root.style.zIndex,width:s.width,height:s.height,maxWidth:s.maxWidth,maxHeight:s.maxHeight,margin:s.margin,marginLeft:s.marginLeft,marginRight:s.marginRight,marginTop:s.marginTop,marginBottom:s.marginBottom},s.overflow="hidden",s.position="fixed",s.top="0",s.bottom="0",s.right="0",s.left="0",s.width="100%",s.height="100%",s.maxWidth="100%",s.maxHeight="100%",s.margin="0",s.marginLeft="0",s.marginRight="0",s.marginTop="0",s.marginBottom="0"}else{let o=n.children;for(let i=0;i<o.length;i++)if(o[i]===this.expandedViewport){n.removeChild(this.expandedViewport);break}if(this.state.expandToFullscreen&&document.fullscreenElement&&document.exitFullscreen(),this.rootState){let i=this.rootState;for(let l of i.viewports)n.appendChild(l);let a=r.style;a.top=i.top,a.bottom=i.bottom,a.left=i.left,a.right=i.right,a.width=i.width,a.height=i.height,a.maxWidth=i.maxWidth,a.maxHeight=i.maxHeight,a.margin=i.margin,a.marginLeft=i.marginLeft,a.marginRight=i.marginRight,a.marginTop=i.marginTop,a.marginBottom=i.marginBottom,a.position=i.position,a.overflow=i.overflow||"";let s=this.getScrollElement();s.scrollTop=i.scrollTop,s.scrollLeft=i.scrollLeft,this.rootState=void 0,this.root.style.zIndex=i.zIndex}}}catch(r){let n="Layout change error, you might have to reload the page.";this.context.log.error(n),console.error(n,r)}}dispose(){super.dispose(),document.removeEventListener("fullscreenchange",this.fullscreenChangeHandler),document.removeEventListener("webkitfullscreenchange",this.fullscreenChangeHandler)}};var HY={includeTypes:C.MultiSelect(bS(xt.Names),C.objectToOptions(xt.Names)),excludeTypes:C.MultiSelect([],C.objectToOptions(xt.Names)),ignoreHydrogens:C.Boolean(!1),ignoreHydrogensVariant:C.Select("all",C.arrayToOptions(["all","non-polar"])),aromaticBonds:C.Boolean(!0,{description:"Display aromatic bonds with dashes"}),multipleBonds:C.Select("symmetric",C.arrayToOptions(["off","symmetric","offset"]))},MBn=C.getDefaultValues(HY),WT={...Nd,...HY,adjustCylinderLength:C.Boolean(!1,{description:"Shorten cylinders to reduce overlap with spheres. Useful for for transparent bonds. Not working well with aromatic bonds."})},BBn=C.getDefaultValues(WT),XT={...wQ,...HY},EBn=C.getDefaultValues(XT);function QT(e,t,r){return!xt.is(e,r)||xt.is(t,r)}function w4(e,t,r){let n=t.elements,o=t.bonds,{a:i,b:a,edgeProps:s}=o,{flags:l}=s,{ignoreHydrogens:u,ignoreHydrogensVariant:c,includeTypes:m,excludeTypes:d}=r,p=xt.fromNames(m),h=xt.fromNames(d),f=xt.isAll(p)&&xt.Flag.None===h,{child:g}=e,y=g?.unitMap.get(t.id);if(g&&!y)throw new Error("expected childUnit to exist if child exists");if(!(f&&!u&&!g))return x=>{let S=i[x],I=a[x];return y&&!Be.has(y.elements,n[S])||!f&&QT(p,h,l[x])?!0:u?!!(em(e,t,n[S],c)||em(e,t,n[I],c)):!1}}function M4(e,t){let r=e.interUnitBonds,{edges:n}=r,{ignoreHydrogens:o,ignoreHydrogensVariant:i,includeTypes:a,excludeTypes:s}=t,l=xt.fromNames(a),u=xt.fromNames(s),c=xt.isAll(l)&&xt.Flag.None===u,{child:m}=e;if(!(c&&!o&&!m))return d=>{if(m){let p=n[d],h=m.unitMap.get(p.unitA);if(!h)return!0;let g=e.unitMap.get(p.unitA).elements[p.indexA];if(!Be.has(h.elements,g))return!0}if(o){let p=n[d],h=e.unitMap.get(p.unitA),f=e.unitMap.get(p.unitB);if(em(e,h,h.elements[p.indexA],i)||em(e,f,f.elements[p.indexB],i))return!0}return!!(!c&&QT(l,u,n[d].props.flag))}}function Ub(e,t){return ue.Traits.is(e.traits,ue.Trait.Water)?!t.ignoreHydrogens||t.ignoreHydrogensVariant==="non-polar":!0}function Es(e,t){for(let{units:r}of e.unitSymmetryGroups)if(ue.isAtomic(r[0])&&Ub(r[0],t))return!0;return!1}var $m;(n=>{function e(o,i){let{group:a,structure:s}=o,l=a.units[0],u=ue.isAtomic(l)?l.bonds.edgeCount*2:0,c=a.units.length,m=It.Location(s,void 0,void 0,s,void 0,void 0),d=(p,h)=>{let f=a.units[h];return m.aUnit=f,m.bUnit=f,m.aIndex=f.bonds.a[p],m.bIndex=f.bonds.b[p],m};if(i?.includeLocation2){let p=It.Location(s,void 0,void 0,s,void 0,void 0);return un(u,c,1,d,!1,()=>!1,(f,g)=>{let y=a.units[g];return p.aUnit=y,p.bUnit=y,p.aIndex=y.bonds.b[f],p.bIndex=y.bonds.a[f],p})}return un(u,c,1,d)}n.fromGroup=e;function t(o,i){let a=o.interUnitBonds.edgeCount,s=1,l=It.Location(o,void 0,void 0,o,void 0,void 0),u=c=>{let m=o.interUnitBonds.edges[c];return l.aUnit=o.unitMap.get(m.unitA),l.aIndex=m.indexA,l.bUnit=o.unitMap.get(m.unitB),l.bIndex=m.indexB,l};if(i?.includeLocation2){let c=It.Location(o,void 0,void 0,o,void 0,void 0);return un(a,s,1,u,!0,()=>!1,d=>{let p=o.interUnitBonds.edges[d];return c.aUnit=o.unitMap.get(p.unitB),c.aIndex=p.indexB,c.bUnit=o.unitMap.get(p.unitA),c.bIndex=p.indexA,c})}return un(a,s,1,u,!0)}n.fromStructure=t;function r(o,i){let{bondCount:a,unitIndex:s,unitGroupIndex:l,unitEdgeIndex:u}=o.intraUnitBondMapping,c=a,m=1,d=It.Location(o,void 0,void 0,o,void 0,void 0),p=h=>{let g=o.unitSymmetryGroups[s[h]].units[l[h]],y=u[h];return d.aUnit=g,d.bUnit=g,d.aIndex=g.bonds.a[y],d.bIndex=g.bonds.b[y],d};if(i?.includeLocation2){let h=It.Location(o,void 0,void 0,o,void 0,void 0);return un(c,m,1,p,!0,()=>!1,g=>{let x=o.unitSymmetryGroups[s[g]].units[l[g]],S=u[g];return h.aUnit=x,h.bUnit=x,h.aIndex=x.bonds.b[S],h.bIndex=x.bonds.a[S],h})}return un(c,m,1,p,!0)}n.fromStructureGroups=r})($m||={});function ZT(e,t,r){let{objectId:n,instanceId:o,groupId:i}=e;if(r===n){let{structure:a,group:s}=t,l=s.units[o];if(i===vi.Null){let u=xe.ofRange(0,l.elements.length);return Q.Loci(a.target,[{unit:l,indices:u}])}else if(ue.isAtomic(l)){let{target:u}=a,c=l.bonds.a[i],m=l.bonds.b[i];return It.Loci(u,[It.Location(u,l,c,u,l,m),It.Location(u,l,m,u,l,c)])}}return vr}function $D(e,t,r,n){let o=!1;if(It.isLoci(e)){let{structure:i,group:a}=t;if(!De.areEquivalent(e.structure,i))return!1;let s=a.units[0];if(!ue.isAtomic(s))return!1;let l=s.bonds.edgeCount*2;for(let u of e.bonds){if(u.aUnit!==u.bUnit)continue;let c=a.unitIndexMap.get(u.aUnit.id);if(c!==void 0){let m=s.bonds.getDirectedEdgeIndex(u.aIndex,u.bIndex);m!==-1&&r(ye.ofSingleton(c*l+m))&&(o=!0)}}}else if(Q.Loci.is(e)){let{structure:i,group:a}=t;if(!De.areEquivalent(e.structure,i))return!1;let s=a.units[0];if(!ue.isAtomic(s))return!1;let l=s.bonds.edgeCount*2;for(let u of e.elements){let c=a.unitIndexMap.get(u.unit.id);if(c!==void 0){let{offset:m,b:d}=s.bonds;xe.forEach(u.indices,p=>{for(let h=m[p],f=m[p+1];h<f;h++)(!n||xe.has(u.indices,d[h]))&&r(ye.ofSingleton(c*l+h))&&(o=!0)})}}}return o}function e3(e,t,r){let{objectId:n,groupId:o}=e;if(r===n){let{target:i}=t;if(o===vi.Null)return De.Loci(i);{let a=t.interUnitBonds.edges[o],s=t.unitMap.get(a.unitA),l=t.unitMap.get(a.unitB);return It.Loci(i,[It.Location(i,s,a.indexA,i,l,a.indexB),It.Location(i,l,a.indexB,i,s,a.indexA)])}}return vr}var zY=new Map;function t3(e,t,r,n){let o=!1;if(It.isLoci(e)){if(!De.areEquivalent(e.structure,t))return!1;for(let i of e.bonds){let a=t.interUnitBonds.getBondIndexFromLocation(i);a!==-1&&r(ye.ofSingleton(a))&&(o=!0)}}else if(Q.Loci.is(e)){if(!De.areEquivalent(e.structure,t)||n&&e.elements.length===1)return!1;for(let i of e.elements)zY.set(i.unit.id,i.indices);for(let i of e.elements){let{unit:a}=i;if(ue.isAtomic(a))for(let s of t.interUnitBonds.getConnectedUnits(a.id)){let l=zY.get(s.unitB);(!n||l)&&xe.forEach(i.indices,u=>{if(s.connectedIndices.includes(u)){for(let c of s.getEdges(u))if(!n||l&&xe.has(l,c.indexB)){let m=t.interUnitBonds.getEdgeIndex(u,a.id,c.indexB,s.unitB);r(ye.ofSingleton(m))&&(o=!0)}}})}}zY.clear()}return o}function r3(e,t,r){let{objectId:n,groupId:o}=e;if(r===n){let i=t.intraUnitBondMapping;return ZT({objectId:n,instanceId:i.unitGroupIndex[o],groupId:i.unitEdgeIndex[o]},{structure:t,group:t.unitSymmetryGroups[i.unitIndex[o]]},r)}return vr}function n3(e,t,r,n){let{unitGroupOffset:o}=t.intraUnitBondMapping,i=!1;if(It.isLoci(e)){if(!De.areEquivalent(e.structure,t))return!1;for(let a of e.bonds){if(a.aUnit!==a.bUnit)continue;let s=t.unitSymmetryGroupsIndexMap.get(a.aUnit.id),l=t.unitSymmetryGroups[s],u=l.units[0];if(!ue.isAtomic(u))continue;let c=o[s],m=u.bonds.edgeCount*2,d=l.unitIndexMap.get(a.aUnit.id);if(d!==void 0){let p=u.bonds.getDirectedEdgeIndex(a.aIndex,a.bIndex);p!==-1&&r(ye.ofSingleton(d*m+p+c))&&(i=!0)}}}else if(Q.Loci.is(e)){if(!De.areEquivalent(e.structure,t))return!1;for(let a of e.elements){let s=t.unitSymmetryGroupsIndexMap.get(a.unit.id),l=t.unitSymmetryGroups[s],u=l.units[0];if(!ue.isAtomic(u))continue;let c=o[s],m=u.bonds.edgeCount*2,d=l.unitIndexMap.get(a.unit.id);if(d!==void 0){let{offset:p,b:h}=u.bonds;xe.forEach(a.indices,f=>{for(let g=p[f],y=p[f+1];g<y;g++)(!n||xe.has(a.indices,h[g]))&&r(ye.ofSingleton(d*m+g+c))&&(i=!0)})}}}return i}var jY=xt.is;function WY(e,t,r,n){let o=e.elements,i=e.bonds,{edgeCount:a,a:s,b:l,edgeProps:u,offset:c}=i,{order:m,flags:d}=u,{sizeFactor:p,sizeAspectRatio:h,adjustCylinderLength:f,aromaticBonds:g,includeTypes:y,excludeTypes:x,multipleBonds:S}=n,I=S==="off",v=S==="symmetric",A=xt.fromNames(y),P=xt.fromNames(x),T=QT(A,P,xt.Flag.Computed),R=b(),w=b(),E=e.conformation,M,D=Q.Location.create(t,e),B=It.Location(t,e,void 0,t,e,void 0),{child:k}=t;if(n.includeParent&&k){let U=k.unitMap.get(e.id);if(!U)throw new Error("expected childUnit to exist");M=L=>{let q=o[s[L]],te=o[l[L]];return Be.has(U.elements,q)&&!Be.has(U.elements,te)}}let F=U=>(B.aIndex=s[U],B.bIndex=l[U],r.size.size(B)*p),z=U=>(D.element=o[s[U]],r.size.size(D)*p),j=U=>(D.element=o[l[U]],r.size.size(D)*p),{elementRingIndices:Y,elementAromaticRingIndices:G}=e.rings,X=g?e.resonance.delocalizedTriplets:void 0;return{linkCount:a*2,referencePosition:U=>{let L=s[U],q=l[U],te=X?.getThirdElement(L,q);if(te!==void 0)return E.invariantPosition(o[te],R);L>q&&([L,q]=[q,L]),c[L+1]-c[L]===1&&([L,q]=[q,L]);let J=G.get(L)||Y.get(L),ee=0;for(let ce=c[L],fe=c[L+1];ce<fe;++ce){let O=l[ce];if(O!==q&&O!==L)if(J){let V=G.get(O)||Y.get(O);if(!V)continue;let Z=nv(J,V);Z>ee&&(ee=Z,E.invariantPosition(o[O],R))}else return E.invariantPosition(o[O],R)}return ee>0?R:null},position:(U,L,q,te)=>{if(E.invariantPosition(o[s[q]],U),E.invariantPosition(o[l[q]],L),te&&f){let J=z(q),ee=j(q),ce=Math.min(J,ee)*h,fe=Math.sqrt(Math.max(0,J*J-ce*ce))-.05,O=Math.sqrt(Math.max(0,ee*ee-ce*ce))-.05;if(fe<=.01&&O<=.01)return;b.normalize(w,b.sub(w,L,U)),b.scaleAndAdd(U,U,w,fe),b.scaleAndAdd(L,L,w,-O)}},style:U=>{let L=m[U],q=d[U];if(jY(q,xt.Flag.MetallicCoordination)||jY(q,xt.Flag.HydrogenBond))return 1;if(L===3)return I?0:v?4:5;if(g){let te=s[U],J=l[U],ee=G.get(te),ce=G.get(J),fe=ee&&ce?nv(ee,ce):0;if(jY(q,xt.Flag.Aromatic)||fe&&!T)return fe===2?8:7}return L!==2||I?0:v?2:3},radius:U=>F(U)*h,ignore:w4(t,e,n),stub:M}}function Mbt(e,t,r,n,o,i){if(!ue.isAtomic(t))return ji.createEmpty(i);if(!Ub(t,o))return ji.createEmpty(i);if(!t.bonds.edgeCount)return ji.createEmpty(i);let{child:a}=r,s=a?.unitMap.get(t.id);if(a&&!s)return ji.createEmpty(i);let l=WY(t,r,n,o),{cylinders:u,boundingSphere:c}=oD(e,l,o,i);if(c)u.setBoundingSphere(c);else if(u.cylinderCount>0){let m=he.expand(he(),(s??t).boundary.sphere,1*o.sizeFactor);u.setBoundingSphere(m)}return u}function Bbt(e,t,r,n,o,i){if(!ue.isAtomic(t))return ft.createEmpty(i);if(!Ub(t,o))return ft.createEmpty(i);if(!t.bonds.edgeCount)return ft.createEmpty(i);let{child:a}=r,s=a?.unitMap.get(t.id);if(a&&!s)return ft.createEmpty(i);let l=WY(t,r,n,o),{mesh:u,boundingSphere:c}=rm(e,l,o,i);if(c)u.setBoundingSphere(c);else if(u.triangleCount>0){let m=he.expand(he(),(s??t).boundary.sphere,1*o.sizeFactor);u.setBoundingSphere(m)}return u}var qT={...fo,...HA,...WT,sizeFactor:C.Numeric(.3,{min:0,max:10,step:.01}),sizeAspectRatio:C.Numeric(2/3,{min:0,max:3,step:.01}),tryUseImpostor:C.Boolean(!0),includeParent:C.Boolean(!1)};function B4(e,t,r,n){return r.tryUseImpostor&&kC(n)?Ebt(e):kbt(e)}function Ebt(e){return jA({defaultProps:C.getDefaultValues(qT),createGeometry:Mbt,createLocationIterator:(t,r)=>$m.fromGroup(t,{includeLocation2:r.colorMode==="interpolate"}),getLoci:ZT,eachLocation:$D,setUpdateState:(t,r,n,o,i,a,s)=>{t.createGeometry=r.sizeFactor!==n.sizeFactor||r.sizeAspectRatio!==n.sizeAspectRatio||r.linkScale!==n.linkScale||r.linkSpacing!==n.linkSpacing||r.ignoreHydrogens!==n.ignoreHydrogens||r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||r.linkCap!==n.linkCap||r.aromaticScale!==n.aromaticScale||r.aromaticSpacing!==n.aromaticSpacing||r.aromaticDashCount!==n.aromaticDashCount||r.dashCount!==n.dashCount||r.dashScale!==n.dashScale||r.dashCap!==n.dashCap||r.stubCap!==n.stubCap||!Yi(r.includeTypes,n.includeTypes)||!Yi(r.excludeTypes,n.excludeTypes)||r.adjustCylinderLength!==n.adjustCylinderLength||r.aromaticBonds!==n.aromaticBonds||r.multipleBonds!==n.multipleBonds||r.adjustCylinderLength&&!Bo.areEqual(o.size,i.size),r.colorMode!==n.colorMode&&(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0);let l=a.group.units[0],u=s.group.units[0];ue.isAtomic(l)&&ue.isAtomic(u)&&(xs.areEqual(l.bonds,u.bonds)||(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0,t.updateSize=!0))},mustRecreate:(t,r,n)=>!r.tryUseImpostor||!n},e)}function kbt(e){return Oo({defaultProps:C.getDefaultValues(qT),createGeometry:Bbt,createLocationIterator:t=>$m.fromGroup(t),getLoci:ZT,eachLocation:$D,setUpdateState:(t,r,n,o,i,a,s)=>{t.createGeometry=r.sizeFactor!==n.sizeFactor||r.sizeAspectRatio!==n.sizeAspectRatio||r.radialSegments!==n.radialSegments||r.linkScale!==n.linkScale||r.linkSpacing!==n.linkSpacing||r.ignoreHydrogens!==n.ignoreHydrogens||r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||r.linkCap!==n.linkCap||r.aromaticScale!==n.aromaticScale||r.aromaticSpacing!==n.aromaticSpacing||r.aromaticDashCount!==n.aromaticDashCount||r.dashCount!==n.dashCount||r.dashScale!==n.dashScale||r.dashCap!==n.dashCap||r.stubCap!==n.stubCap||!Yi(r.includeTypes,n.includeTypes)||!Yi(r.excludeTypes,n.excludeTypes)||r.adjustCylinderLength!==n.adjustCylinderLength||r.aromaticBonds!==n.aromaticBonds||r.multipleBonds!==n.multipleBonds;let l=a.group.units[0],u=s.group.units[0];ue.isAtomic(l)&&ue.isAtomic(u)&&(xs.areEqual(l.bonds,u.bonds)||(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0,t.updateSize=!0))},mustRecreate:(t,r,n)=>r.tryUseImpostor&&!!n},e)}function E3e(e,t,r){let n=[],{bondCount:o,unitIndex:i,unitEdgeIndex:a,unitGroupIndex:s}=e.intraUnitBondMapping,{child:l}=e;for(let u of e.unitSymmetryGroups){let c=u.units[0],m=l?.unitMap.get(c.id),d=ue.isAtomic(c)&&!(l&&!m)?WY(c,e,t,r):yV;n.push({group:u,props:d})}return{linkCount:o,referencePosition:u=>{let{group:c,props:m}=n[i[u]];if(!m.referencePosition)return null;let d=m.referencePosition(a[u]);if(!d)return null;let p=c.units[s[u]];return b.transformMat4(d,d,p.conformation.operator.matrix),d},position:(u,c,m,d)=>{let{group:p,props:h}=n[i[m]];h.position(u,c,a[m],d);let f=p.units[s[m]];b.transformMat4(u,u,f.conformation.operator.matrix),b.transformMat4(c,c,f.conformation.operator.matrix)},style:u=>{let{props:c}=n[i[u]];return c.style?c.style(a[u]):0},radius:u=>{let{props:c}=n[i[u]];return c.radius(a[u])},ignore:u=>{let{props:c}=n[i[u]];return c.ignore?c.ignore(a[u]):!1},stub:u=>{let{props:c}=n[i[u]];return c.stub?c.stub(a[u]):!1}}}function Fbt(e,t,r,n,o){if(!Es(t,n))return ji.createEmpty(o);if(!t.intraUnitBondMapping.bondCount)return ji.createEmpty(o);let i=E3e(t,r,n),{cylinders:a,boundingSphere:s}=oD(e,i,n,o);if(s)a.setBoundingSphere(s);else if(a.cylinderCount>0){let{child:l}=t,u=he.expand(he(),(l??t).boundary.sphere,1*n.sizeFactor);a.setBoundingSphere(u)}return a}function Lbt(e,t,r,n,o){if(!Es(t,n))return ft.createEmpty(o);if(!t.intraUnitBondMapping.bondCount)return ft.createEmpty(o);let i=E3e(t,r,n),{mesh:a,boundingSphere:s}=rm(e,i,n,o);if(s)a.setBoundingSphere(s);else if(a.triangleCount>0){let{child:l}=t,u=he.expand(he(),(l??t).boundary.sphere,1*n.sizeFactor);a.setBoundingSphere(u)}return a}var k3e={...fc,...dL,...WT,sizeFactor:C.Numeric(.3,{min:0,max:10,step:.01}),sizeAspectRatio:C.Numeric(2/3,{min:0,max:3,step:.01}),tryUseImpostor:C.Boolean(!0),includeParent:C.Boolean(!1)};function E4(e,t,r,n){return r.tryUseImpostor&&n&&n.extensions.fragDepth?Vbt(e):Obt(e)}function Vbt(e){return pL({defaultProps:C.getDefaultValues(k3e),createGeometry:Fbt,createLocationIterator:(t,r)=>Es(t,r)?$m.fromStructureGroups(t,{includeLocation2:r.colorMode==="interpolate"}):vg,getLoci:r3,eachLocation:n3,setUpdateState:(t,r,n,o,i,a,s)=>{t.createGeometry=r.sizeFactor!==n.sizeFactor||r.sizeAspectRatio!==n.sizeAspectRatio||r.linkScale!==n.linkScale||r.linkSpacing!==n.linkSpacing||r.ignoreHydrogens!==n.ignoreHydrogens||r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||r.linkCap!==n.linkCap||r.aromaticScale!==n.aromaticScale||r.aromaticSpacing!==n.aromaticSpacing||r.aromaticDashCount!==n.aromaticDashCount||r.dashCount!==n.dashCount||r.dashScale!==n.dashScale||r.dashCap!==n.dashCap||r.stubCap!==n.stubCap||!Yi(r.includeTypes,n.includeTypes)||!Yi(r.excludeTypes,n.excludeTypes)||r.adjustCylinderLength!==n.adjustCylinderLength||r.multipleBonds!==n.multipleBonds,r.colorMode!==n.colorMode&&(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0),Es(a,r)&&a.interUnitBonds!==s.interUnitBonds&&(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0,t.updateSize=!0)},mustRecreate:(t,r,n)=>!r.tryUseImpostor||!n},e)}function Obt(e){return Ps({defaultProps:C.getDefaultValues(k3e),createGeometry:Lbt,createLocationIterator:(t,r)=>Es(t,r)?$m.fromStructureGroups(t):vg,getLoci:r3,eachLocation:n3,setUpdateState:(t,r,n,o,i,a,s)=>{t.createGeometry=r.sizeFactor!==n.sizeFactor||r.sizeAspectRatio!==n.sizeAspectRatio||r.radialSegments!==n.radialSegments||r.linkScale!==n.linkScale||r.linkSpacing!==n.linkSpacing||r.ignoreHydrogens!==n.ignoreHydrogens||r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||r.linkCap!==n.linkCap||r.aromaticScale!==n.aromaticScale||r.aromaticSpacing!==n.aromaticSpacing||r.aromaticDashCount!==n.aromaticDashCount||r.dashCount!==n.dashCount||r.dashScale!==n.dashScale||r.dashCap!==n.dashCap||r.stubCap!==n.stubCap||!Yi(r.includeTypes,n.includeTypes)||!Yi(r.excludeTypes,n.excludeTypes)||r.adjustCylinderLength!==n.adjustCylinderLength||r.multipleBonds!==n.multipleBonds||r.adjustCylinderLength&&!Bo.areEqual(o.size,i.size),Es(a,r)&&a.interUnitBonds!==s.interUnitBonds&&(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0,t.updateSize=!0)},mustRecreate:(t,r,n)=>r.tryUseImpostor&&!!n},e)}var XY=new It.ElementBondIterator;function F3e(e,t,r,n){for(XY.setElement(t,r,n);XY.hasNext;){let o=XY.move();return o.otherUnit.conformation.position(o.otherUnit.elements[o.otherIndex],e),e}return null}var L3e=b();function V3e(e,t,r){let n=Q.Location.create(e),o=It.Location(e,void 0,void 0,e,void 0,void 0),i=e.interUnitBonds,{edgeCount:a,edges:s}=i,{sizeFactor:l,sizeAspectRatio:u,adjustCylinderLength:c,aromaticBonds:m,multipleBonds:d}=r,p=d==="off",h=d==="symmetric",f=b(),g,{child:y}=e;r.includeParent&&y&&(g=v=>{let A=s[v],P=y.unitMap.get(A.unitA),T=y.unitMap.get(A.unitB),w=e.unitMap.get(A.unitA).elements[A.indexA],M=e.unitMap.get(A.unitB).elements[A.indexB];return P&&Be.has(P.elements,w)&&(!T||!Be.has(T.elements,M))});let x=v=>{let A=s[v];return o.aUnit=e.unitMap.get(A.unitA),o.aIndex=A.indexA,o.bUnit=e.unitMap.get(A.unitB),o.bIndex=A.indexB,t.size.size(o)*l},S=v=>{let A=s[v];return n.unit=e.unitMap.get(A.unitA),n.element=n.unit.elements[A.indexA],t.size.size(n)*l},I=v=>{let A=s[v];return n.unit=e.unitMap.get(A.unitB),n.element=n.unit.elements[A.indexB],t.size.size(n)*l};return{linkCount:a,referencePosition:v=>{let A=s[v],P,T,R,w;if(A.unitA<A.unitB)P=e.unitMap.get(A.unitA),T=e.unitMap.get(A.unitB),R=A.indexA,w=A.indexB;else if(A.unitA>A.unitB)P=e.unitMap.get(A.unitB),T=e.unitMap.get(A.unitA),R=A.indexB,w=A.indexA;else throw new Error("same units in createInterUnitBondCylinderMesh");return F3e(L3e,e,P,R)||F3e(L3e,e,T,w)},position:(v,A,P,T)=>{let R=s[P],w=e.unitMap.get(R.unitA),E=e.unitMap.get(R.unitB);if(w.conformation.position(w.elements[R.indexA],v),E.conformation.position(E.elements[R.indexB],A),T&&c){let M=S(P),D=I(P),B=Math.min(M,D)*u,k=Math.sqrt(Math.max(0,M*M-B*B))-.05,F=Math.sqrt(Math.max(0,D*D-B*B))-.05;if(k<=.01&&F<=.01)return;b.normalize(f,b.sub(f,A,v)),b.scaleAndAdd(v,v,f,k),b.scaleAndAdd(A,A,f,-F)}},style:v=>{let A=s[v].props.order,P=Ia.create(s[v].props.flag);return xt.is(P,xt.Flag.MetallicCoordination)||xt.is(P,xt.Flag.HydrogenBond)?1:A===3?p?0:h?4:5:m&&xt.is(P,xt.Flag.Aromatic)?7:A!==2||p?0:h?2:3},radius:v=>x(v)*u,ignore:M4(e,r),stub:g}}function Gbt(e,t,r,n,o){if(!Es(t,n))return ji.createEmpty(o);if(!t.interUnitBonds.edgeCount)return ji.createEmpty(o);let i=V3e(t,r,n),{cylinders:a,boundingSphere:s}=oD(e,i,n,o);if(s)a.setBoundingSphere(s);else if(a.cylinderCount>0){let{child:l}=t,u=he.expand(he(),(l??t).boundary.sphere,1*n.sizeFactor);a.setBoundingSphere(u)}return a}function Ubt(e,t,r,n,o){if(!Es(t,n))return ft.createEmpty(o);if(!t.interUnitBonds.edgeCount)return ft.createEmpty(o);let i=V3e(t,r,n),{mesh:a,boundingSphere:s}=rm(e,i,n,o);if(s)a.setBoundingSphere(s);else if(a.triangleCount>0){let{child:l}=t,u=he.expand(he(),(l??t).boundary.sphere,1*n.sizeFactor);a.setBoundingSphere(u)}return a}var YT={...fc,...dL,...WT,sizeFactor:C.Numeric(.3,{min:0,max:10,step:.01}),sizeAspectRatio:C.Numeric(2/3,{min:0,max:3,step:.01}),tryUseImpostor:C.Boolean(!0),includeParent:C.Boolean(!1)};function k4(e,t,r,n){return r.tryUseImpostor&&kC(n)?Nbt(e):zbt(e)}function Nbt(e){return pL({defaultProps:C.getDefaultValues(YT),createGeometry:Gbt,createLocationIterator:(t,r)=>Es(t,r)?$m.fromStructure(t,{includeLocation2:r.colorMode==="interpolate"}):vg,getLoci:e3,eachLocation:t3,setUpdateState:(t,r,n,o,i,a,s)=>{t.createGeometry=r.sizeFactor!==n.sizeFactor||r.sizeAspectRatio!==n.sizeAspectRatio||r.linkScale!==n.linkScale||r.linkSpacing!==n.linkSpacing||r.ignoreHydrogens!==n.ignoreHydrogens||r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||r.linkCap!==n.linkCap||r.aromaticScale!==n.aromaticScale||r.aromaticSpacing!==n.aromaticSpacing||r.aromaticDashCount!==n.aromaticDashCount||r.dashCount!==n.dashCount||r.dashScale!==n.dashScale||r.dashCap!==n.dashCap||r.stubCap!==n.stubCap||!Yi(r.includeTypes,n.includeTypes)||!Yi(r.excludeTypes,n.excludeTypes)||r.adjustCylinderLength!==n.adjustCylinderLength||r.multipleBonds!==n.multipleBonds,r.colorMode!==n.colorMode&&(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0),Es(a,r)&&a.interUnitBonds!==s.interUnitBonds&&(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0,t.updateSize=!0)},mustRecreate:(t,r,n)=>!r.tryUseImpostor||!n},e)}function zbt(e){return Ps({defaultProps:C.getDefaultValues(YT),createGeometry:Ubt,createLocationIterator:(t,r)=>Es(t,r)?$m.fromStructure(t):vg,getLoci:e3,eachLocation:t3,setUpdateState:(t,r,n,o,i,a,s)=>{t.createGeometry=r.sizeFactor!==n.sizeFactor||r.sizeAspectRatio!==n.sizeAspectRatio||r.radialSegments!==n.radialSegments||r.linkScale!==n.linkScale||r.linkSpacing!==n.linkSpacing||r.ignoreHydrogens!==n.ignoreHydrogens||r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||r.linkCap!==n.linkCap||r.aromaticScale!==n.aromaticScale||r.aromaticSpacing!==n.aromaticSpacing||r.aromaticDashCount!==n.aromaticDashCount||r.dashCount!==n.dashCount||r.dashScale!==n.dashScale||r.dashCap!==n.dashCap||r.stubCap!==n.stubCap||!Yi(r.includeTypes,n.includeTypes)||!Yi(r.excludeTypes,n.excludeTypes)||r.adjustCylinderLength!==n.adjustCylinderLength||r.multipleBonds!==n.multipleBonds||r.adjustCylinderLength&&!Bo.areEqual(o.size,i.size),Es(a,r)&&a.interUnitBonds!==s.interUnitBonds&&(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0,t.updateSize=!0)},mustRecreate:(t,r,n)=>r.tryUseImpostor&&!!n},e)}var O3e={sizeFactor:C.Numeric(1,{min:0,max:10,step:.1}),detail:C.Numeric(0,{min:0,max:3,step:1},Xe.CustomQualityParamInfo),ignoreHydrogens:C.Boolean(!1),ignoreHydrogensVariant:C.Select("all",C.arrayToOptions(["all","non-polar"])),traceOnly:C.Boolean(!1),tryUseImpostor:C.Boolean(!0),stride:C.Numeric(1,{min:1,max:100,step:1})},KT={...fo,...NA,...O3e};function F4(e,t,r,n){return r.tryUseImpostor&&FA(n)?Hbt(e):jbt(e)}function Hbt(e){return zA({defaultProps:C.getDefaultValues(KT),createGeometry:jve,createLocationIterator:Ao.fromGroup,getLoci:cl,eachLocation:ul,setUpdateState:(t,r,n)=>{t.createGeometry=r.ignoreHydrogens!==n.ignoreHydrogens||r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||r.traceOnly!==n.traceOnly||r.stride!==n.stride},mustRecreate:(t,r,n)=>!r.tryUseImpostor||!n},e)}function jbt(e){return Oo({defaultProps:C.getDefaultValues(KT),createGeometry:Hve,createLocationIterator:Ao.fromGroup,getLoci:cl,eachLocation:ul,setUpdateState:(t,r,n)=>{t.createGeometry=r.sizeFactor!==n.sizeFactor||r.detail!==n.detail||r.ignoreHydrogens!==n.ignoreHydrogens||r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||r.traceOnly!==n.traceOnly||r.stride!==n.stride},mustRecreate:(t,r,n)=>r.tryUseImpostor&&!!n},e)}var G3e={...fc,...Tve,...O3e};function L4(e,t,r,n){return r.tryUseImpostor&&n&&n.extensions.fragDepth&&n.extensions.textureFloat?Wbt(e):Xbt(e)}function Wbt(e){return Pve({defaultProps:C.getDefaultValues(G3e),createGeometry:Xve,createLocationIterator:Ao.fromStructure,getLoci:Ua,eachLocation:Ga,setUpdateState:(t,r,n)=>{t.createGeometry=r.ignoreHydrogens!==n.ignoreHydrogens||r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||r.traceOnly!==n.traceOnly||r.stride!==n.stride},mustRecreate:(t,r,n)=>!r.tryUseImpostor||!n},e)}function Xbt(e){return Ps({defaultProps:C.getDefaultValues(G3e),createGeometry:Wve,createLocationIterator:Ao.fromStructure,getLoci:Ua,eachLocation:Ga,setUpdateState:(t,r,n)=>{t.createGeometry=r.sizeFactor!==n.sizeFactor||r.detail!==n.detail||r.ignoreHydrogens!==n.ignoreHydrogens||r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||r.traceOnly!==n.traceOnly||r.stride!==n.stride},mustRecreate:(t,r,n)=>r.tryUseImpostor&&!!n},e)}var U3e={"element-sphere":(e,t)=>eo("Element sphere",e,t,F4),"intra-bond":(e,t)=>eo("Intra-unit bond cylinder",e,t,B4),"inter-bond":(e,t)=>po("Inter-unit bond cylinder",e,t,k4),"structure-element-sphere":(e,t)=>po("Structure element sphere",e,t,L4),"structure-intra-bond":(e,t)=>po("Structure intra-unit bond cylinder",e,t,E4)},N3e={...KT,traceOnly:C.Boolean(!1,{isHidden:!0}),...qT,...YT,includeParent:C.Boolean(!1),unitKinds:Cb(["atomic"]),sizeFactor:C.Numeric(.15,{min:.01,max:10,step:.01}),sizeAspectRatio:C.Numeric(2/3,{min:.01,max:3,step:.01}),visuals:C.MultiSelect(["element-sphere","intra-bond","inter-bond"],C.objectToOptions(U3e)),bumpFrequency:C.Numeric(0,{min:0,max:10,step:.1},Xe.ShadingCategory),density:C.Numeric(.1,{min:0,max:1,step:.01},Xe.ShadingCategory)};function Qbt(e,t){let r=N3e;return De.getSize(t)>=De.Size.Huge?(r=C.clone(r),r.visuals.defaultValue=["element-sphere","intra-bond"]):t.unitSymmetryGroups.length>5e3&&(r=C.clone(r),r.visuals.defaultValue=["structure-element-sphere","structure-intra-bond"]),r}function Zbt(e,t){return Ut.createMulti("Ball & Stick",e,t,qn,U3e)}var z3e={name:"ball-and-stick",label:"Ball & Stick",description:"Displays atoms as spheres and bonds as cylinders.",factory:Zbt,getParams:Qbt,defaultValues:C.getDefaultValues(N3e),defaultColorTheme:{name:"element-symbol"},defaultSizeTheme:{name:"physical"},isApplicable:e=>e.elementCount>0,getData:(e,t)=>t.includeParent?e.asParent():e,mustRecreate:(e,t)=>e.includeParent!==t.includeParent};function qbt(e,t,r,n,o){let{links:i,elements:a}=t.carbohydrates,{linkSizeFactor:s}=n,l=Q.Location.create(t),u={linkCount:i.length,position:(d,p,h)=>{let f=i[h];b.copy(d,a[f.carbohydrateIndexA].geometry.center),b.copy(p,a[f.carbohydrateIndexB].geometry.center)},radius:d=>{let p=i[d],h=a[p.carbohydrateIndexA],f=h.unit.rings.all[h.ringIndex];return l.unit=h.unit,l.element=h.unit.elements[f[0]],r.size.size(l)*s}},{mesh:c,boundingSphere:m}=rm(e,u,n,o);if(m)c.setBoundingSphere(m);else if(c.triangleCount>0){let d=he.expand(he(),t.boundary.sphere,1*s);c.setBoundingSphere(d)}return c}var ZY={...fo,...Nd,linkSizeFactor:C.Numeric(.3,{min:0,max:3,step:.01})};function H3e(e){return Ps({defaultProps:C.getDefaultValues(ZY),createGeometry:qbt,createLocationIterator:Ybt,getLoci:Kbt,eachLocation:Jbt,setUpdateState:(t,r,n)=>{t.createGeometry=r.linkSizeFactor!==n.linkSizeFactor||r.radialSegments!==n.radialSegments||r.linkCap!==n.linkCap}},e)}function Ybt(e){let{elements:t,links:r}=e.carbohydrates,n=r.length,o=1,i=Q.Location.create(e);return un(n,o,1,s=>{let l=r[s],u=t[l.carbohydrateIndexA],c=u.unit.rings.all[u.ringIndex];return i.unit=u.unit,i.element=u.unit.elements[c[0]],i},!0)}function Kbt(e,t,r){let{objectId:n,groupId:o}=e;if(r===n){if(o===vi.Null)return De.Loci(t);{let{links:i,elements:a}=t.carbohydrates,s=i[o],l=a[s.carbohydrateIndexA],u=a[s.carbohydrateIndexB];return Q.Loci.union(FC(t,l.unit,l.residueIndex,l.altId),FC(t,u.unit,u.residueIndex,u.altId))}}return vr}var QY=new Set;function Jbt(e,t,r){let n=!1;if(!Q.Loci.is(e)||!De.areEquivalent(e.structure,t))return!1;let{getLinkIndices:o}=t.carbohydrates;for(let{unit:i,indices:a}of e.elements)ue.isAtomic(i)&&(QY.clear(),xe.forEach(a,s=>{let l=o(i,i.elements[s]);for(let u=0,c=l.length;u<c;++u)QY.has(l[u])||(QY.add(l[u]),r(ye.ofSingleton(l[u]))&&(n=!0))}));return n}var $bt=b.create(0,0,-.5),ext=b.create(0,0,.5),p0=b(),f0=b(),V4=b(),j3e=b();function txt(e){let t=e.length/3,n=(t===3?1:t===4?2:t)+t,o=t===4?t*3+4:n*3,i=Kf(n,o);for(let a=0;a<t;++a){let s=(a+1)%t;b.set(p0,e[a*3],e[a*3+1],-.5),b.set(f0,e[s*3],e[s*3+1],-.5),i.add(p0,f0,ext)}if(t===3)b.set(p0,e[0],e[1],-.5),b.set(f0,e[3],e[4],-.5),b.set(V4,e[6],e[7],-.5),i.add(V4,f0,p0);else if(t===4)b.set(p0,e[0],e[1],-.5),b.set(f0,e[3],e[4],-.5),b.set(V4,e[6],e[7],-.5),b.set(j3e,e[9],e[10],-.5),i.addQuad(j3e,V4,f0,p0);else for(let a=0;a<t;++a){let s=(a+1)%t;b.set(p0,e[a*3],e[a*3+1],-.5),b.set(f0,e[s*3],e[s*3+1],-.5),i.add($bt,f0,p0)}return i.getPrimitive()}var qY;function W3e(){return qY||(qY=txt(Yc(8,!0))),qY}var YY;function X3e(){if(!YY){let e=Yc(8,!0),t=new Float32Array(30);for(let n=0;n<8;++n)t[n*3]=e[n*3],t[n*3+1]=e[n*3+1],t[n*3+2]=-.5;t[24]=0,t[25]=0,t[26]=-.5,t[27]=0,t[28]=0,t[29]=.5,YY=XS(t,[0,1,8,1,2,8,4,5,8,5,6,8,2,3,9,3,4,9,6,7,9,7,0,9])}return YY}var rxt={pointCount:5,outerRadius:1,innerRadius:.5,thickness:.3},KY=b.zero(),JY=b.zero(),$Y=b.zero(),o3=b.zero(),eK=b.zero();function Q3e(e){let{outerRadius:t,innerRadius:r,thickness:n,pointCount:o}={...rxt,...e},i=o*2*2,a=Kf(i),s=new Float32Array(o*2),l=new Float32Array(o*2);for(let u=0;u<o;++u){let c=u*2,m=u*2+1,d=(c+1)/o*Math.PI,p=(m+1)/o*Math.PI;l[c]=Math.cos(d)*t,l[m]=Math.sin(d)*t,s[c]=Math.cos(p)*r,s[m]=Math.sin(p)*r}b.set(KY,0,0,n/2),b.set(JY,0,0,-n/2);for(let u=0;u<o;++u){let c=(u+1)%o;b.set($Y,l[u*2],l[u*2+1],0),b.set(o3,s[u*2],s[u*2+1],0),b.set(eK,l[c*2],l[c*2+1],0),a.add(KY,$Y,o3),a.add(o3,$Y,JY),a.add(KY,o3,eK),a.add(eK,o3,JY)}return a.getPrimitive()}var nK=[.5,0,0,-.5,0,0,0,.5,0,0,-.5,0,0,0,.5,0,0,-.5],nxt=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],oxt=[0,2,4,0,4,3,1,2,5,1,5,3],ixt=[0,2,1,3,2,1,3,0,0,4,1,4,2,4,3,4,0,5,1,5,2,5,3,5],tK;function Z3e(){return tK||(tK=XS(nK,nxt)),tK}var rK;function q3e(){return rK||(rK=XS(nK,oxt)),rK}var Tkn=Ig(nK,ixt);var Tr=H.identity(),Nb=b(),Y3e=b(),axt=2*.806,K3e=SC(),J3e=Pbe(),sxt=W3e(),$3e=X3e(),lxt=Q3e({outerRadius:1,innerRadius:.5,thickness:.5,pointCount:5}),uxt=Z3e(),ewe=q3e(),twe=fCe(),cxt=hCe(),mxt=gCe(),dxt=yCe(),pxt=bCe();function fxt(e,t,r,n,o){let i=tt.createState(256,128,o),{detail:a,sizeFactor:s}=n,l=t.carbohydrates,u=l.elements.length,c=Q.Location.create(t);for(let m=0;m<u;++m){let d=l.elements[m],p=d.unit.rings.all[d.ringIndex],h=ice(d.component.type,p.length);c.unit=d.unit,c.element=d.unit.elements[p[0]];let f=r.size.size(c),g=f*s,y=f*s*axt,{center:x,normal:S,direction:I}=d.geometry;switch(b.add(Y3e,x,I),H.targetTo(Tr,x,Y3e,S),H.setTranslation(Tr,x),i.currentGroup=m*2,h){case 0:Zr(i,x,g,a);break;case 1:H.scaleUniformly(Tr,Tr,y),tt.addPrimitive(i,Tr,K3e);break;case 2:H.scaleUniformly(Tr,Tr,y),tt.addPrimitive(i,Tr,J3e),H.mul(Tr,Tr,H.rotZ90X180),i.currentGroup+=1,tt.addPrimitive(i,Tr,J3e);break;case 4:H.scaleUniformly(Tr,Tr,y*1.2),tt.addPrimitive(i,Tr,sxt);break;case 5:H.scaleUniformly(Tr,Tr,y*1.2),tt.addPrimitive(i,Tr,$3e),H.mul(Tr,Tr,H.rotZ90),i.currentGroup+=1,tt.addPrimitive(i,Tr,$3e);break;case 6:H.mul(Tr,Tr,H.rotZY90),H.scale(Tr,Tr,b.set(Nb,y,y,y/2)),tt.addPrimitive(i,Tr,K3e);break;case 7:H.scaleUniformly(Tr,Tr,y),H.mul(Tr,Tr,H.rotZY90),tt.addPrimitive(i,Tr,lxt);break;case 8:H.mul(Tr,Tr,H.rotZY90),H.scale(Tr,Tr,b.set(Nb,y*1.4,y*1.4,y*1.4)),tt.addPrimitive(i,Tr,uxt);break;case 3:H.mul(Tr,Tr,H.rotZY90),H.scale(Tr,Tr,b.set(Nb,y*1.4,y*1.4,y*1.4)),tt.addPrimitive(i,Tr,ewe),H.mul(Tr,Tr,H.rotY90),i.currentGroup+=1,tt.addPrimitive(i,Tr,ewe);break;case 9:H.mul(Tr,Tr,H.rotZY90),H.scale(Tr,Tr,b.set(Nb,y,y/2,y/2)),tt.addPrimitive(i,Tr,twe);break;case 12:H.mul(Tr,Tr,H.rotZY90),H.scale(Tr,Tr,b.set(Nb,y,y,y/2)),tt.addPrimitive(i,Tr,twe);break;case 13:case 11:H.mul(Tr,Tr,H.rotZY90),H.scale(Tr,Tr,b.set(Nb,y,y,y/2)),tt.addPrimitive(i,Tr,cxt);break;case 14:H.mul(Tr,Tr,H.rotZY90),H.scale(Tr,Tr,b.set(Nb,y,y,y/2)),tt.addPrimitive(i,Tr,mxt);break;case 15:H.mul(Tr,Tr,H.rotZY90),H.scale(Tr,Tr,b.set(Nb,y,y,y/2)),tt.addPrimitive(i,Tr,pxt);break;case 10:default:H.mul(Tr,Tr,H.rotZYZ90),H.scale(Tr,Tr,b.set(Nb,y/1.5,y,y/2)),tt.addPrimitive(i,Tr,dxt);break}}return tt.getMesh(i)}var iK={...fc,detail:C.Numeric(0,{min:0,max:3,step:1},Xe.CustomQualityParamInfo),sizeFactor:C.Numeric(1.75,{min:0,max:10,step:.01})};function rwe(e){return Ps({defaultProps:C.getDefaultValues(iK),createGeometry:fxt,createLocationIterator:hxt,getLoci:gxt,eachLocation:yxt,setUpdateState:(t,r,n)=>{t.createGeometry=r.sizeFactor!==n.sizeFactor||r.detail!==n.detail}},e)}function hxt(e){let t=e.carbohydrates.elements,r=t.length*2,n=1,o=Q.Location.create(e);function i(s,l){let u=t[Math.floor(s/2)],c=u.unit.rings.all[u.ringIndex];return o.unit=u.unit,o.element=u.unit.elements[c[0]],o}function a(s,l){return s%2===1}return un(r,n,1,i,!0,a)}function gxt(e,t,r){let{objectId:n,groupId:o}=e;if(r===n){if(o===vi.Null)return De.Loci(t);{let i=t.carbohydrates.elements[Math.floor(o/2)];return FC(t,i.unit,i.residueIndex,i.altId)}}return vr}var oK=new Set;function yxt(e,t,r){let{getElementIndices:n}=t.carbohydrates,o=!1;if(!Q.Loci.is(e)||!De.areEquivalent(e.structure,t))return!1;for(let{unit:i,indices:a}of e.elements)ue.isAtomic(i)&&(oK.clear(),xe.forEach(a,s=>{let l=n(i,i.elements[s]);for(let u=0,c=l.length;u<c;++u)oK.has(l[u])||(oK.add(l[u]),r(ye.ofSingleton(l[u]*2))&&(o=!0))}));return o}function bxt(e,t,r,n,o){let{terminalLinks:i,elements:a}=t.carbohydrates,{terminalLinkSizeFactor:s}=n,l=Q.Location.create(t),u={linkCount:i.length,position:(d,p,h)=>{let f=i[h];f.fromCarbohydrate?(b.copy(d,a[f.carbohydrateIndex].geometry.center),f.elementUnit.conformation.position(f.elementUnit.elements[f.elementIndex],p)):(f.elementUnit.conformation.position(f.elementUnit.elements[f.elementIndex],d),b.copy(p,a[f.carbohydrateIndex].geometry.center))},radius:d=>{let p=i[d];if(p.fromCarbohydrate){let h=a[p.carbohydrateIndex],f=h.unit.rings.all[h.ringIndex];l.unit=h.unit,l.element=h.unit.elements[f[0]]}else l.unit=p.elementUnit,l.element=p.elementUnit.elements[p.elementIndex];return r.size.size(l)*s},style:d=>{let p=i[d],h=p.elementUnit.elements[p.elementIndex],f=Mm(p.elementUnit.model.atomicHierarchy.atoms.type_symbol.value(h));return nC.has(f)?1:0}},{mesh:c,boundingSphere:m}=rm(e,u,n,o);if(m)c.setBoundingSphere(m);else if(c.triangleCount>0){let d=he.expand(he(),t.boundary.sphere,1*s);c.setBoundingSphere(d)}return c}var sK={...fo,...Nd,terminalLinkSizeFactor:C.Numeric(.2,{min:0,max:3,step:.01})};function nwe(e){return Ps({defaultProps:C.getDefaultValues(sK),createGeometry:bxt,createLocationIterator:xxt,getLoci:Cxt,eachLocation:Sxt,setUpdateState:(t,r,n)=>{t.createGeometry=r.terminalLinkSizeFactor!==n.terminalLinkSizeFactor||r.radialSegments!==n.radialSegments||r.linkCap!==n.linkCap}},e)}function xxt(e){let{elements:t,terminalLinks:r}=e.carbohydrates,n=r.length,o=1,i=Q.Location.create(e);return un(n,o,1,s=>{let l=r[s];if(l.fromCarbohydrate){let u=t[l.carbohydrateIndex],c=u.unit.rings.all[u.ringIndex];i.unit=u.unit,i.element=u.unit.elements[c[0]]}else i.unit=l.elementUnit,i.element=l.elementUnit.elements[l.elementIndex];return i},!0)}function Cxt(e,t,r){let{objectId:n,groupId:o}=e;if(r===n){if(o===vi.Null)return De.Loci(t);{let{terminalLinks:i,elements:a}=t.carbohydrates,s=i[o],l=a[s.carbohydrateIndex];return Q.Loci.union(FC(t,l.unit,l.residueIndex,l.altId),Cve(t,s.elementUnit,s.elementUnit.elements[s.elementIndex]))}}return vr}var aK=new Set;function Sxt(e,t,r){let n=!1;if(!Q.Loci.is(e)||!De.areEquivalent(e.structure,t))return!1;let{getTerminalLinkIndices:o}=t.carbohydrates;for(let{unit:i,indices:a}of e.elements)ue.isAtomic(i)&&(aK.clear(),xe.forEach(a,s=>{let l=o(i,i.elements[s]);for(let u=0,c=l.length;u<c;++u)aK.has(l[u])||(aK.add(l[u]),r(ye.ofSingleton(l[u]))&&(n=!0))}));return n}var owe={"carbohydrate-symbol":(e,t)=>po("Carbohydrate symbol mesh",e,t,rwe),"carbohydrate-link":(e,t)=>po("Carbohydrate link cylinder",e,t,H3e),"carbohydrate-terminal-link":(e,t)=>po("Carbohydrate terminal link cylinder",e,t,nwe)},iwe={...iK,...ZY,...sK,visuals:C.MultiSelect(["carbohydrate-symbol","carbohydrate-link","carbohydrate-terminal-link"],C.objectToOptions(owe)),bumpFrequency:C.Numeric(0,{min:0,max:10,step:.1},Xe.ShadingCategory),density:C.Numeric(.2,{min:0,max:1,step:.01},Xe.ShadingCategory)};function vxt(e,t){return iwe}function Ixt(e,t){return Ut.createMulti("Carbohydrate",e,t,qn,owe)}var awe={name:"carbohydrate",label:"Carbohydrate",description:"Displays carbohydrate symbols (3D SNFG).",factory:Ixt,getParams:vxt,defaultValues:C.getDefaultValues(iwe),defaultColorTheme:{name:"carbohydrate-symbol"},defaultSizeTheme:{name:"uniform"},isApplicable:e=>e.models.some(t=>Gt.hasCarbohydrate(t))};function lK(e,t){switch(e.kind){case ue.Kind.Atomic:return Axt(e,t);case ue.Kind.Spheres:case ue.Kind.Gaussians:return Txt(e,t)}}function Axt(e,t){let r=e.model.atomicRanges.cyclicPolymerMap,n=Wn.transientSegments(N1(e),e.elements),o=Kt.transientSegments(e.model.atomicHierarchy.residueAtomSegments,e.elements),i=e.model.atomicHierarchy.derived.residue.traceElementIndex,{moleculeType:a}=e.model.atomicHierarchy.derived.residue,s=-1,l=-1,u=!0,c=-1,m=0;for(;n.hasNext;){for(u=!0,c=m,o.setSegment(n.move());o.hasNext;){if(u){let p=o.move().index;if(++m,!o.hasNext)continue;u=!1,l=p}let d=o.move().index;s=l,l=d,t(i[s],i[l],m-1,m,a[s]),++m}r.has(l)&&(s=l,l=r.get(s),t(i[s],i[l],m-1,c,a[s]))}}function Txt(e,t){let r=Wn.transientSegments(N1(e),e.elements),{elements:n}=e,o=!0,i=0;for(;r.hasNext;){o=!0;let a=r.move(),s=a.start,l=a.end;for(let u=s,c=l;u<c;++u){if(o){if(++u,++i,u>c)continue;o=!1}t(n[u-1],n[u],i-1,i,0),++i}}}function uK(e,t){switch(e.kind){case ue.Kind.Atomic:return Pxt(e,t);case ue.Kind.Spheres:case ue.Kind.Gaussians:return _xt(e,t)}}function Pxt(e,t){let r=Wn.transientSegments(N1(e),e.elements),n=Kt.transientSegments(e.model.atomicHierarchy.residueAtomSegments,e.elements),o=e.model.atomicHierarchy.derived.residue.traceElementIndex,i=0;for(;r.hasNext;)for(n.setSegment(r.move());n.hasNext;){let a=n.move().index;t(o[a],i),++i}}function _xt(e,t){let r=Wn.transientSegments(N1(e),e.elements),{elements:n}=e,o=0;for(;r.hasNext;){let i=r.move(),a=i.start,s=i.end;for(let l=a,u=s;l<u;++l)t(n[l],o),++o}}function swe(e,t){switch(t.kind){case ue.Kind.Atomic:return new cK(e,t);case ue.Kind.Spheres:case ue.Kind.Gaussians:return new mK(e,t)}}function lwe(e,t){return{centerA:Q.Location.create(e,t),centerB:Q.Location.create(e,t)}}var cK=class{constructor(t,r){this.unit=r;this.hasNext=!1;this.traceElementIndex=r.model.atomicHierarchy.derived.residue.traceElementIndex,this.gapIt=Wn.transientSegments(dK(r),r.elements),this.value=lwe(t,r),this.hasNext=this.gapIt.hasNext}move(){let{elements:t,residueIndex:r}=this.unit,n=this.gapIt.move();return this.value.centerA.element=this.traceElementIndex[r[t[n.start]]],this.value.centerB.element=this.traceElementIndex[r[t[n.end-1]]],this.hasNext=this.gapIt.hasNext,this.value}},mK=class{constructor(t,r){this.unit=r;this.hasNext=!1;this.gapIt=Wn.transientSegments(dK(r),r.elements),this.value=lwe(t,r),this.hasNext=this.gapIt.hasNext}move(){let t=this.gapIt.move();return this.value.centerA.element=this.unit.elements[t.start],this.value.centerB.element=this.unit.elements[t.end-1],this.hasNext=this.gapIt.hasNext,this.value}};function uwe(e){let{x:t,y:r,z:n}=e.atomicConformation,{polymerType:o,traceElementIndex:i}=e.atomicHierarchy.derived.residue,a=o.length,s=xe.ofBounds(0,e.atomicConformation.atomId.rowCount),l=Wn.transientSegments(e.atomicRanges.polymerRanges,s),u=Kt.transientSegments(e.atomicHierarchy.residueAtomSegments,s),c=new Float32Array(a*3),m=new Float32Array(a*3),d=0,p=-1,h=-1,f=b(),g=b(),y=b(),x=b(),S=b(),I=b(),v=b(),A=b(),P=b(),T=b(),R=b(),w=b(),E=b(),M=b();for(;l.hasNext;){let D=l.move();for(u.setSegment(D),d=-1,h=-1;u.hasNext;){d+=1;let{index:Y}=u.move();d===0&&(h=Y),p=Y-2;let G=p*3;b.copy(f,g),b.copy(g,y),b.copy(y,x);let X=i[Y];if(b.set(x,t[X],r[X],n[X]),d<3)continue;b.sub(S,g,f),b.sub(I,y,g),b.sub(v,x,y),b.sub(R,S,I),b.sub(w,I,v),b.cross(E,R,w),b.normalize(E,E),b.toArray(E,m,G);let U=Math.cos(b.angle(R,w)),L=b.magnitude(R),q=b.magnitude(w),te=Math.sqrt(q*L)/Math.max(2,2*(1-U));b.scale(A,R,te/L),b.sub(A,g,A),b.toArray(A,c,G),b.scale(P,w,te/q),b.sub(P,y,P),b.toArray(P,c,G+3),b.copy(M,E)}let B=h*3;b.fromArray(A,c,B+3),b.fromArray(P,c,B+6),b.normalize(E,b.sub(E,A,P));let k=i[h];b.set(f,t[k],r[k],n[k]),b.copy(T,f),b.projectPointOnVector(T,T,E,A),b.toArray(T,c,B);let F=p+2,z=F*3;b.fromArray(A,c,z-3),b.fromArray(P,c,z-6),b.normalize(E,b.sub(E,A,P));let j=i[F];b.set(f,t[j],r[j],n[j]),b.copy(T,f),b.projectPointOnVector(T,T,E,A),b.toArray(T,c,z)}return{centers:c}}var i3=_d.createProvider({label:"Helix Orientation",descriptor:{name:"molstar_helix_orientation"},type:"dynamic",defaultParams:{},getParams:()=>({}),isApplicable:e=>!0,obtain:async(e,t)=>({value:uwe(t)})});function vh(e){return rr.is(e,rr.Flag.Helix)}function Rxt(e){return rr.is(e,rr.Flag.Beta)}function JT(e,t,r={}){switch(e.kind){case ue.Kind.Atomic:return new pK(e,t,r);case ue.Kind.Spheres:case ue.Kind.Gaussians:return new fK(e,t)}}var U4=rr.create(rr.Flag.NA);function cwe(e,t){return{center:Q.Location.create(e,t),centerPrev:Q.Location.create(e,t),centerNext:Q.Location.create(e,t),first:!1,last:!1,initial:!1,final:!1,secStrucFirst:!1,secStrucLast:!1,secStrucType:U4,moleculeType:0,coarseBackboneFirst:!1,coarseBackboneLast:!1,p0:b(),p1:b(),p2:b(),p3:b(),p4:b(),d12:b(),d23:b()}}var Yr=b(),O4=b(),G4=b(),pK=class{constructor(t,r,n={}){this.unit=t;this.state=0;this.p0=b();this.p1=b();this.p2=b();this.p3=b();this.p4=b();this.p5=b();this.p6=b();this.d01=b();this.d12=b();this.d23=b();this.d34=b();this.hasNext=!1;if(this.atomicConformation=t.model.atomicConformation,this.residueAtomSegments=t.model.atomicHierarchy.residueAtomSegments,this.polymerRanges=t.model.atomicRanges.polymerRanges,this.traceElementIndex=t.model.atomicHierarchy.derived.residue.traceElementIndex,this.directionFromElementIndex=t.model.atomicHierarchy.derived.residue.directionFromElementIndex,this.directionToElementIndex=t.model.atomicHierarchy.derived.residue.directionToElementIndex,this.moleculeType=t.model.atomicHierarchy.derived.residue.moleculeType,this.cyclicPolymerMap=t.model.atomicRanges.cyclicPolymerMap,this.polymerIt=Wn.transientSegments(this.polymerRanges,t.elements),this.residueIt=Kt.transientSegments(this.residueAtomSegments,t.elements),this.value=cwe(r,t),this.hasNext=this.residueIt.hasNext&&this.polymerIt.hasNext,n.ignoreSecondaryStructure||(this.secondaryStructure=ol.get(r).value?.get(t.invariantId)),n.useHelixOrientation){let o=i3.get(t.model).value;if(!o)throw new Error("missing helix-orientation");this.helixOrientationCenters=o.centers}}atomicPos(t,r){r!==-1&&(t[0]=this.atomicConformation.x[r],t[1]=this.atomicConformation.y[r],t[2]=this.atomicConformation.z[r])}pos(t,r,n){let o=this.traceElementIndex[r];this.helixOrientationCenters&&vh(n)?b.fromArray(t,this.helixOrientationCenters,r*3):this.atomicPos(t,o)}updateResidueSegmentRange(t){let{index:r}=this.residueAtomSegments;this.residueSegmentMin=r[this.polymerRanges[t.index*2]],this.residueSegmentMax=r[this.polymerRanges[t.index*2+1]]}getResidueIndex(t){if(t<this.residueSegmentMin){let r=this.cyclicPolymerMap.get(this.residueSegmentMin);r!==void 0?t=r-(this.residueSegmentMin-t-1):t=this.residueSegmentMin}else if(t>this.residueSegmentMax){let r=this.cyclicPolymerMap.get(this.residueSegmentMax);r!==void 0?t=r+(t-this.residueSegmentMax-1):t=this.residueSegmentMax}return t}getSecStruc(t){if(this.secondaryStructure){let{type:r,getIndex:n}=this.secondaryStructure,o=r[n(t)];return vh(o)?rr.Flag.Helix:o}else return U4}setControlPoint(t,r,n,o,i){Rxt(i)||this.helixOrientationCenters&&vh(i)?b.scale(t,b.add(t,r,b.add(t,o,b.add(t,n,n))),1/4):b.copy(t,n)}setFromToVector(t,r,n){this.helixOrientationCenters&&vh(n)?b.set(t,1,0,0):(this.atomicPos(O4,this.directionFromElementIndex[r]),this.atomicPos(G4,this.directionToElementIndex[r]),b.sub(t,G4,O4))}setDirection(t,r,n,o){b.matchDirection(O4,r,n),b.matchDirection(G4,o,n),b.scale(t,b.add(t,O4,b.add(t,G4,b.add(t,n,n))),1/4)}move(){let{residueIt:t,polymerIt:r,value:n}=this;if(this.state===0){for(;r.hasNext;)if(this.polymerSegment=r.move(),t.setSegment(this.polymerSegment),this.updateResidueSegmentRange(this.polymerSegment),t.hasNext){this.state=1;let o=this.residueAtomSegments.index[this.unit.elements[this.polymerSegment.start]],i=this.getResidueIndex(o-1);this.currSecStrucType=o===i?U4:this.getSecStruc(i),this.nextSecStrucType=this.getSecStruc(o),this.currCoarseBackbone=this.directionFromElementIndex[i]===-1||this.directionToElementIndex[i]===-1,this.nextCoarseBackbone=this.directionFromElementIndex[o]===-1||this.directionToElementIndex[o]===-1;break}}if(this.state===1){let{index:o}=t.move(),i=this.getResidueIndex(o-3),a=this.getResidueIndex(o-2),s=this.getResidueIndex(o-1),l=this.getResidueIndex(o+1),u=this.getResidueIndex(o+2),c=this.getResidueIndex(o+3);this.prevSecStrucType=this.getSecStruc(s),this.currSecStrucType=this.getSecStruc(o),this.nextSecStrucType=o===l?U4:this.getSecStruc(l),this.prevCoarseBackbone=this.currCoarseBackbone,this.currCoarseBackbone=this.nextCoarseBackbone,this.nextCoarseBackbone=this.directionFromElementIndex[l]===-1||this.directionToElementIndex[l]===-1,n.secStrucType=this.currSecStrucType,n.secStrucFirst=this.prevSecStrucType!==this.currSecStrucType,n.secStrucLast=this.currSecStrucType!==this.nextSecStrucType,n.coarseBackboneFirst=this.prevCoarseBackbone!==this.currCoarseBackbone,n.coarseBackboneLast=this.currCoarseBackbone!==this.nextCoarseBackbone,n.first=o===this.residueSegmentMin,n.last=o===this.residueSegmentMax,n.moleculeType=this.moleculeType[o],n.initial=o===s,n.final=o===l,n.centerPrev.element=this.traceElementIndex[s],n.center.element=this.traceElementIndex[o],n.centerNext.element=this.traceElementIndex[l];let m=this.getSecStruc(i),d=this.getSecStruc(a),p=this.getSecStruc(s),h=this.getSecStruc(o),f=this.getSecStruc(l),g=this.getSecStruc(u),y=this.getSecStruc(c);this.pos(this.p0,i,m),this.pos(this.p1,a,d),this.pos(this.p2,s,p),this.pos(this.p3,o,h),this.pos(this.p4,l,f),this.pos(this.p5,u,g),this.pos(this.p6,c,y);let x=vh(m),S=vh(d),I=vh(p),v=vh(h),A=vh(f),P=vh(g),T=vh(y);this.helixOrientationCenters&&!(v&&n.secStrucFirst&&n.secStrucLast)&&(v!==I?v?(b.copy(this.p0,this.p3),b.copy(this.p1,this.p3),b.copy(this.p2,this.p3)):I&&(b.scale(Yr,b.sub(Yr,this.p2,this.p3),2),b.add(this.p2,this.p3,Yr),b.add(this.p1,this.p2,Yr),b.add(this.p0,this.p1,Yr)):v!==S?v?(b.copy(this.p0,this.p2),b.copy(this.p1,this.p2)):S&&(b.scale(Yr,b.sub(Yr,this.p1,this.p2),2),b.add(this.p1,this.p2,Yr),b.add(this.p0,this.p1,Yr)):v!==x&&(v?b.copy(this.p0,this.p1):x&&(b.scale(Yr,b.sub(Yr,this.p0,this.p1),2),b.add(this.p0,this.p1,Yr))),v!==A?v?(b.copy(this.p4,this.p3),b.copy(this.p5,this.p3),b.copy(this.p6,this.p3)):A&&(b.scale(Yr,b.sub(Yr,this.p4,this.p3),2),b.add(this.p4,this.p3,Yr),b.add(this.p5,this.p4,Yr),b.add(this.p6,this.p5,Yr)):v!==P?v?(b.copy(this.p5,this.p4),b.copy(this.p6,this.p4)):P&&(b.scale(Yr,b.sub(Yr,this.p5,this.p4),2),b.add(this.p5,this.p4,Yr),b.add(this.p6,this.p5,Yr)):v!==T&&(v?b.copy(this.p6,this.p5):T&&(b.scale(Yr,b.sub(Yr,this.p6,this.p5),2),b.add(this.p6,this.p5,Yr)))),this.currCoarseBackbone?(b.triangleNormal(this.d01,this.p1,this.p2,this.p3),b.triangleNormal(this.d12,this.p2,this.p3,this.p4),b.triangleNormal(this.d23,this.p3,this.p4,this.p5),b.triangleNormal(this.d34,this.p4,this.p5,this.p6)):(this.setFromToVector(this.d01,s,p),this.setFromToVector(this.d12,o,h),this.setFromToVector(this.d23,l,f),this.setFromToVector(this.d34,u,g));let R=v&&this.helixOrientationCenters,w=1.5;o===s||h!==p&&R?(b.setMagnitude(Yr,b.sub(Yr,this.p3,this.p4),w),b.add(this.p2,this.p3,Yr),b.add(this.p1,this.p2,Yr),b.add(this.p0,this.p1,Yr)):s===a||h!==d&&R?(b.setMagnitude(Yr,b.sub(Yr,this.p2,this.p3),w),b.add(this.p1,this.p2,Yr),b.add(this.p0,this.p1,Yr)):(a===i||h!==m&&R)&&(b.setMagnitude(Yr,b.sub(Yr,this.p1,this.p2),w),b.add(this.p0,this.p1,Yr)),o===l||h!==f&&R?(b.setMagnitude(Yr,b.sub(Yr,this.p3,this.p2),w),b.add(this.p4,this.p3,Yr),b.add(this.p5,this.p4,Yr),b.add(this.p6,this.p5,Yr)):l===u||h!==g&&R?(b.setMagnitude(Yr,b.sub(Yr,this.p4,this.p3),w),b.add(this.p5,this.p4,Yr),b.add(this.p6,this.p5,Yr)):(u===c||h!==y&&R)&&(b.setMagnitude(Yr,b.sub(Yr,this.p5,this.p4),w),b.add(this.p6,this.p5,Yr)),this.setControlPoint(n.p0,this.p0,this.p1,this.p2,d),this.setControlPoint(n.p1,this.p1,this.p2,this.p3,p),this.setControlPoint(n.p2,this.p2,this.p3,this.p4,h),this.setControlPoint(n.p3,this.p3,this.p4,this.p5,f),this.setControlPoint(n.p4,this.p4,this.p5,this.p6,g),this.setDirection(n.d12,this.d01,this.d12,this.d23),this.setDirection(n.d23,this.d12,this.d23,this.d34),t.hasNext||(this.state=0)}return this.hasNext=t.hasNext||r.hasNext,this.value}};var fK=class{constructor(t,r){this.unit=t;this.state=0;this.hasNext=!1;switch(this.polymerIt=Wn.transientSegments(N1(t),t.elements),this.value=cwe(r,t),b.set(this.value.d12,1,0,0),b.set(this.value.d23,1,0,0),t.kind){case ue.Kind.Spheres:this.conformation=t.model.coarseConformation.spheres;break;case ue.Kind.Gaussians:this.conformation=t.model.coarseConformation.gaussians;break}this.hasNext=this.polymerIt.hasNext}getElementIndex(t){return Math.min(Math.max(this.polymerSegment.start,t),this.polymerSegment.end-1)}pos(t,r){let n=this.unit.elements[r];t[0]=this.conformation.x[n],t[1]=this.conformation.y[n],t[2]=this.conformation.z[n]}move(){if(this.state===0){for(;this.polymerIt.hasNext;)if(this.polymerSegment=this.polymerIt.move(),this.elementIndex=this.polymerSegment.start,this.elementIndex<this.polymerSegment.end){this.state=1;break}}if(this.state===1){let t=this.getElementIndex(this.elementIndex-2),r=this.getElementIndex(this.elementIndex-1),n=this.getElementIndex(this.elementIndex+1),o=this.getElementIndex(this.elementIndex+2);this.value.centerPrev.element=this.value.center.unit.elements[r],this.value.center.element=this.value.center.unit.elements[this.elementIndex],this.value.centerNext.element=this.value.center.unit.elements[n],this.pos(this.value.p0,t),this.pos(this.value.p1,r),this.pos(this.value.p2,this.elementIndex),this.pos(this.value.p3,n),this.pos(this.value.p4,o);let i=.5;this.elementIndex===r?(b.scale(Yr,b.sub(Yr,this.value.p2,this.value.p3),i),b.add(this.value.p1,this.value.p2,Yr),b.add(this.value.p0,this.value.p1,Yr)):r===t&&(b.scale(Yr,b.sub(Yr,this.value.p1,this.value.p2),i),b.add(this.value.p0,this.value.p1,Yr)),this.elementIndex===n?(b.scale(Yr,b.sub(Yr,this.value.p2,this.value.p1),i),b.add(this.value.p3,this.value.p2,Yr),b.add(this.value.p4,this.value.p3,Yr)):n===o&&(b.scale(Yr,b.sub(Yr,this.value.p3,this.value.p2),i),b.add(this.value.p4,this.value.p3,Yr)),this.value.first=this.elementIndex===this.polymerSegment.start,this.value.last=this.elementIndex===this.polymerSegment.end-1,this.elementIndex+1>=this.polymerSegment.end&&(this.state=0)}return this.hasNext=this.elementIndex+1<this.polymerSegment.end||this.polymerIt.hasNext,this.elementIndex+=1,this.value}};var z1=b.fromArray,tP=b.toArray,CK=b.normalize,Dxt=b.sub,$T=b.spline,wxt=b.slerp,mwe=b.copy,dwe=b.cross,hK=b.orthogonalize,Mxt=b.matchDirection,Bxt=b.scale,pwe=b.add;function rP(e){let t=e+1,r=t*3;return{curvePoints:new Float32Array(r),tangentVectors:new Float32Array(r),normalVectors:new Float32Array(r),binormalVectors:new Float32Array(r),widthValues:new Float32Array(t),heightValues:new Float32Array(t),linearSegments:e}}function nP(e,t,r,n){Ext(e,t,r,n),Fxt(e,t)}var gK=b(),yK=b(),bK=b();function Ext(e,t,r,n){let{curvePoints:o,tangentVectors:i,linearSegments:a}=e,{p0:s,p1:l,p2:u,p3:c,p4:m,secStrucFirst:d,secStrucLast:p}=t,h=1-n,f=d?.5:r,g=p?.5:r;for(let y=0;y<=a;++y){let x=y*1/a;if(x<h){let S=to(f,r,x);$T(bK,s,l,u,c,x+n,S),$T(gK,s,l,u,c,x+n+.01,f),$T(yK,s,l,u,c,x+n-.01,f)}else{let S=to(r,g,x);$T(bK,l,u,c,m,x-h,S),$T(gK,l,u,c,m,x-h+.01,S),$T(yK,l,u,c,m,x-h-.01,S)}tP(bK,o,y*3),CK(h0,Dxt(h0,gK,yK)),tP(h0,i,y*3)}}var kxt=b(),h0=b(),Ih=b(),eP=b(),a3=b(),fwe=b(),hwe=b(),gwe=b(),xK=b(),N4=b();function Fxt(e,t){let{curvePoints:r,tangentVectors:n,normalVectors:o,binormalVectors:i}=e,{d12:a,d23:s}=t,l=r.length/3;z1(hwe,n,0),z1(gwe,n,(l-1)*3),hK(xK,hwe,a),hK(N4,gwe,s),Mxt(N4,N4,xK),mwe(a3,xK);let u=l-1;for(let c=0;c<l;++c){let m=uM(0,u,c)*u,d=c===0?0:1/(l-m);z1(h0,n,c*3),hK(Ih,h0,wxt(kxt,a3,N4,d)),tP(Ih,o,c*3),mwe(a3,Ih),CK(eP,dwe(eP,h0,Ih)),tP(eP,i,c*3)}for(let c=1;c<u;++c)z1(a3,o,(c-1)*3),z1(Ih,o,c*3),z1(fwe,o,(c+1)*3),Bxt(Ih,pwe(Ih,a3,pwe(Ih,fwe,Ih)),1/3),tP(Ih,o,c*3),z1(h0,n,c*3),CK(eP,dwe(eP,h0,Ih)),tP(eP,i,c*3)}function s3(e,t,r,n,o,i,a,s){let{widthValues:l,heightValues:u,linearSegments:c}=e,m=1-s;for(let d=0;d<=c;++d){let p=d*1/c;p<m?(l[d]=to(t,r,p+s),u[d]=to(o,i,p+s)):(l[d]=to(r,n,p-m),u[d]=to(i,a,p-m))}}var z4=.5,bwe=.9,H1=.5,j1=.3,oP=2;function N1(e){switch(e.kind){case ue.Kind.Atomic:return e.model.atomicRanges.polymerRanges;case ue.Kind.Spheres:return e.model.coarseHierarchy.spheres.polymerRanges;case ue.Kind.Gaussians:return e.model.coarseHierarchy.gaussians.polymerRanges}}function dK(e){switch(e.kind){case ue.Kind.Atomic:return e.model.atomicRanges.gapRanges;case ue.Kind.Spheres:return e.model.coarseHierarchy.spheres.gapRanges;case ue.Kind.Gaussians:return e.model.coarseHierarchy.gaussians.gapRanges}}var Qd;(t=>{function e(r,n){let{group:o,structure:i}=r,a=o.units[0].polymerElements,s=a.length,l=o.units.length,u=Q.Location.create(i),c=(p,h)=>{let f=o.units[h];return u.unit=f,u.element=a[p],u},m=!!n?.asSecondary;function d(p,h){return m}return un(s,l,1,c,!1,d)}t.fromGroup=e})(Qd||={});var SK;(t=>{function e(r,n){let{group:o,structure:i}=r,a=o.units[0].gapElements,s=a.length,l=o.units.length,u=Q.Location.create(i),c=(p,h)=>{let f=o.units[h];return u.unit=f,u.element=a[p],u},m=!!n?.asSecondary;function d(p,h){return m}return un(s,l,1,c,!1,d)}t.fromGroup=e})(SK||={});function rf(e,t,r){let{objectId:n,instanceId:o,groupId:i}=e;if(r===n){let{structure:a,group:s}=t,l=s.units[o];if(i===vi.Null){let u=xe.ofRange(0,l.elements.length);return Q.Loci(a.target,[{unit:l,indices:u}])}else{if(ue.isAtomic(l))return tL(a,l,l.polymerElements[i]);{let{elements:u}=l,c=l.polymerElements[i],m=xe.indexOf(u,c);if(m!==-1){let d=xe.ofSingleton(m);return Q.Loci(a,[{unit:l,indices:d}])}}}}return vr}function ywe(e,t,r,n,o,i){let a=-1,s=-1;for(let u=o;u<=i;u++){let c=r[u];if(!(c<0)&&(a=xe.indexOf(t,c),a>=0)){s=u;break}}if(a<0)return!1;let l=a;for(let u=i;u>s;u--){let c=r[u];if(c<0)continue;let m=xe.indexOf(t,c);if(m>=0){l=m;break}}return n(ye.ofRange(e+a,e+l))}function vK(e,t,r,n,o){let i=!1,{elements:a}=o.unit,{traceElementIndex:s}=o.unit.model.atomicHierarchy.derived.residue,{index:l}=o.unit.model.atomicHierarchy.residueAtomSegments,u=r(o.unit);if(ye.is(o.indices))if(ye.start(o.indices)===0&&ye.end(o.indices)===o.unit.elements.length)i=n(ye.ofBounds(e,e+t))||i;else{let c=l[a[ye.min(o.indices)]],m=l[a[ye.max(o.indices)]];i=ywe(e,u,s,n,c,m)||i}else{let{indices:c}=o;for(let m=0,d=c.length;m<d;m++){let p=l[a[c[m]]],h=p,f=m+1;for(;f<d;){let g=l[a[c[f]]];if(g-h>1)break;h=g,f++}m=f-1,i=ywe(e,u,s,n,p,h)||i}}return i}function Lxt(e){return e.polymerElements}function nf(e,t,r){let n=!1;if(!Q.Loci.is(e))return!1;let{structure:o,group:i}=t;if(!De.areEquivalent(e.structure,o))return!1;let a=i.units[0].polymerElements.length;for(let s of e.elements){if(!i.unitIndexMap.has(s.unit.id))continue;let l=i.unitIndexMap.get(s.unit.id)*a;if(ue.isAtomic(s.unit))n=vK(l,a,Lxt,r,s)||n;else if(ye.is(s.indices)){let u=l+ye.start(s.indices),c=l+ye.end(s.indices);n=r(ye.ofBounds(u,c))||n}else for(let u=0,c=s.indices.length;u<c;u++){let m=s.indices[u],d=u+1;for(;d<c&&s.indices[d]===m;)d++;u=d-1;let p=s.indices[u];n=r(ye.ofRange(l+m,l+p))||n}}return n}function xwe(e,t,r){let{objectId:n,instanceId:o,groupId:i}=e;if(r===n){let{structure:a,group:s}=t,l=s.units[o],u=xe.indexOf(l.elements,l.gapElements[i]),c=xe.indexOf(l.elements,l.gapElements[i%2?i-1:i+1]);if(u!==-1&&c!==-1)return It.Loci(a,[It.Location(a,l,u,a,l,c),It.Location(a,l,c,a,l,u)])}return vr}function Cwe(e,t,r){let n=!1;if(It.isLoci(e)){let{structure:o,group:i}=t;if(!De.areRootsEquivalent(e.structure,o))return!1;e=It.remapLoci(e,o);let a=i.units[0].gapElements.length;for(let s of e.bonds){let l=i.unitIndexMap.get(s.aUnit.id);if(l!==void 0){let u=xe.indexOf(s.aUnit.gapElements,s.aUnit.elements[s.aIndex]),c=xe.indexOf(s.bUnit.gapElements,s.bUnit.elements[s.bIndex]);u!==-1&&c!==-1&&r(ye.ofSingleton(l*a+u))&&(n=!0)}}}else if(Q.Loci.is(e)){let{structure:o,group:i}=t;if(!De.areRootsEquivalent(e.structure,o))return!1;e=Q.Loci.remap(e,o);let a=i.units[0].gapElements.length;for(let s of e.elements){let l=i.unitIndexMap.get(s.unit.id);l!==void 0&&xe.forEach(s.indices,u=>{let c=xe.indexOf(s.unit.gapElements,s.unit.elements[u]);c!==-1&&(r(ye.ofSingleton(l*a+c))&&(n=!0),xe.getAt(s.unit.gapElements,c+1)===s.unit.elements[u]&&r(ye.ofSingleton(l*a+c+1))&&(n=!0))})}}return n}var Zd;(t=>{function e(r){let{group:n,structure:o}=r,i=n.units[0],a=ue.isAtomic(i)?i.nucleotideElements:[],s=a.length,l=n.units.length,u=Q.Location.create(o);return un(s,l,1,(m,d)=>{let p=n.units[d];return u.unit=p,u.element=a[m],u})}t.fromGroup=e})(Zd||={});function of(e,t,r){let{objectId:n,instanceId:o,groupId:i}=e;if(r===n){let{structure:a,group:s}=t,l=s.units[o];if(ue.isAtomic(l))if(i===vi.Null){let u=ye.ofRange(0,l.elements.length);return Q.Loci(a.target,[{unit:l,indices:u}])}else return tL(a,l,l.nucleotideElements[i])}return vr}function Vxt(e){return e.nucleotideElements}function af(e,t,r){let n=!1;if(!Q.Loci.is(e))return!1;let{structure:o,group:i}=t;if(!De.areEquivalent(e.structure,o))return!1;let a=i.units[0];if(!ue.isAtomic(a))return!1;let{nucleotideElements:s}=a,l=s.length;for(let u of e.elements){if(!ue.isAtomic(u.unit)||!i.unitIndexMap.has(u.unit.id))continue;let c=i.unitIndexMap.get(u.unit.id)*l;ue.isAtomic(u.unit)&&(n=vK(c,l,Vxt,r,u)||n)}return n}var Oxt=b(),Gxt=b();function sf(e,t){let{model:r,conformation:n}=e,{residueAtomSegments:o,atoms:i,index:a}=r.atomicHierarchy,{label_comp_id:s}=i,l=s.value(o.offsets[t]),u=Ice(l),c=Ace(l);if(!u&&!c){let m=a.findAtomOnResidue(t,"C4"),d=a.findAtomOnResidue(t,"N9");m!==-1&&d!==-1&&b.distance(n.invariantPosition(m,Oxt),n.invariantPosition(d,Gxt))<1.6?u=!0:c=!0}return{isPurine:u,isPyrimidine:c}}function lf(){return{trace:-1,N1:-1,C2:-1,N3:-1,C4:-1,C5:-1,C6:-1,N7:-1,C8:-1,N9:-1,C1_1:-1,C2_1:-1,C3_1:-1,C4_1:-1,O4_1:-1}}function uf(e,t,r){let n=t.model.atomicHierarchy.index,{traceElementIndex:o}=t.model.atomicHierarchy.derived.residue;return e.trace=o[r],e.N1=n.findAtomOnResidue(r,"N1"),e.C2=n.findAtomOnResidue(r,"C2"),e.N3=n.findAtomOnResidue(r,"N3"),e.C4=n.findAtomOnResidue(r,"C4"),e.C5=n.findAtomOnResidue(r,"C5"),e.C5===-1&&(e.C5=n.findAtomOnResidue(r,"N5")),e.C6=n.findAtomOnResidue(r,"C6"),e.N7=n.findAtomOnResidue(r,"N7"),e.N7===-1&&(e.N7=n.findAtomOnResidue(r,"C7")),e.C8=n.findAtomOnResidue(r,"C8"),e.N9=n.findAtomOnResidue(r,"N9"),e}function iy(e){return e.trace!==-1&&e.N1!==-1&&e.C2!==-1&&e.N3!==-1&&e.C4!==-1&&e.C5!==-1&&e.C6!==-1&&e.N7!==-1&&e.C8!==-1&&e.N9!==-1}function cf(e,t,r){let n=t.model.atomicHierarchy.index,{traceElementIndex:o}=t.model.atomicHierarchy.derived.residue;return e.trace=o[r],e.N1=n.findAtomOnResidue(r,"N1"),e.N1===-1&&(e.N1=n.findAtomOnResidue(r,"C1")),e.C2=n.findAtomOnResidue(r,"C2"),e.N3=n.findAtomOnResidue(r,"N3"),e.C4=n.findAtomOnResidue(r,"C4"),e.C5=n.findAtomOnResidue(r,"C5"),e.C6=n.findAtomOnResidue(r,"C6"),e}function ay(e){return e.trace!==-1&&e.N1!==-1&&e.C2!==-1&&e.N3!==-1&&e.C4!==-1&&e.C5!==-1&&e.C6!==-1}function g0(e,t,r){let n=t.model.atomicHierarchy.index,{traceElementIndex:o}=t.model.atomicHierarchy.derived.residue;return e.trace=o[r],e.C1_1=n.findAtomOnResidue(r,"C1'"),e.C2_1=n.findAtomOnResidue(r,"C2'"),e.C3_1=n.findAtomOnResidue(r,"C3'"),e.C4_1=n.findAtomOnResidue(r,"C4'"),e.O4_1=n.findAtomOnResidue(r,"O4'"),e}function y0(e){return e.trace!==-1&&e.C1_1!==-1&&e.C2_1!==-1&&e.C3_1!==-1&&e.C4_1!==-1&&e.O4_1!==-1}var H4=b(),IK=b(),Swe=b(),vwe=b(),Iwe=b(),Awe=b(),j4=b(),AK=b(),TK=b(),Twe=b(),l3=H.identity(),Uxt=b(),Pwe=SC(),_we={sizeFactor:C.Numeric(.2,{min:0,max:10,step:.01}),thicknessFactor:C.Numeric(1,{min:0,max:2,step:.01}),radialSegments:C.Numeric(16,{min:2,max:56,step:2},Xe.CustomQualityParamInfo)},tVn=C.getDefaultValues(_we);function Nxt(e,t,r,n,o,i){if(!ue.isAtomic(t))return ft.createEmpty(i);let a=t.nucleotideElements.length;if(!a)return ft.createEmpty(i);let{sizeFactor:s,thicknessFactor:l,radialSegments:u}=o,c=a*(Pwe.vertices.length/3+u*2),m=tt.createState(c,c/4,i),{elements:d,model:p,conformation:h}=t,{chainAtomSegments:f,residueAtomSegments:g}=p.atomicHierarchy,{moleculeType:y}=p.atomicHierarchy.derived.residue,x=Kt.transientSegments(f,d),S=Kt.transientSegments(g,d),I=1*s,v=4.5,A=l*s*2,P={radiusTop:I,radiusBottom:I,radialSegments:u,bottomCap:!0},T=0;for(;x.hasNext;)for(S.setSegment(x.move());S.hasNext;){let{index:E}=S.move();if(pa(y[E])){let M=lf(),D=-1,B=-1,k=-1,F=-1,z=-1,j=4.5,{isPurine:Y,isPyrimidine:G}=sf(t,E);Y?(j=4.5,uf(M,t,E),D=M.N1,B=M.C4,k=M.C6,F=M.C2,z=M.N9):G&&(j=3,cf(M,t,E),D=M.N3,B=M.C6,k=M.C4,F=M.C2,z=M.N1),z!==-1&&M.trace!==-1&&(h.invariantPosition(z,Iwe),h.invariantPosition(M.trace,Awe),m.currentGroup=T,gn(m,Iwe,Awe,1,P),D!==-1&&B!==-1&&k!==-1&&F!==-1&&(h.invariantPosition(D,H4),h.invariantPosition(B,IK),h.invariantPosition(k,Swe),h.invariantPosition(F,vwe),b.normalize(j4,b.sub(j4,IK,H4)),b.normalize(AK,b.sub(AK,vwe,Swe)),b.normalize(TK,b.cross(TK,j4,AK)),H.targetTo(l3,H4,IK,TK),b.scaleAndAdd(Twe,H4,j4,j/2-.2),H.scale(l3,l3,b.set(Uxt,v,A,j)),H.setTranslation(l3,Twe),tt.addPrimitive(m,l3,Pwe))),++T}}let R=tt.getMesh(m),w=he.expand(he(),t.boundary.sphere,I);return R.setBoundingSphere(w),R}var PK={...fo,..._we};function Rwe(e){return Oo({defaultProps:C.getDefaultValues(PK),createGeometry:Nxt,createLocationIterator:Zd.fromGroup,getLoci:of,eachLocation:af,setUpdateState:(t,r,n)=>{t.createGeometry=r.sizeFactor!==n.sizeFactor||r.thicknessFactor!==n.thicknessFactor||r.radialSegments!==n.radialSegments}},e)}var W4=b(),b0=b(),X4=b(),Q4=b(),iP=b(),aP=b(),Z4=b(),Dwe=b(),wwe=b(),q4=b(),x0=b(),Ewe={sizeFactor:C.Numeric(.2,{min:0,max:10,step:.01}),thicknessFactor:C.Numeric(1,{min:0,max:2,step:.01}),radialSegments:C.Numeric(16,{min:2,max:56,step:2},Xe.CustomQualityParamInfo),detail:C.Numeric(0,{min:0,max:3,step:1},Xe.CustomQualityParamInfo)},bVn=C.getDefaultValues(Ewe),Y4=new Float32Array(54),zxt=new Uint32Array([0,1,2,3,4,5,6,7,16,17,14,15,12,13,8,9,10,11,0,1]),Hxt=new Uint32Array([8,12,14,16,6,4,2,0,10]),jxt=new Uint32Array([9,11,1,3,5,7,17,15,13]),K4=new Float32Array(36),Wxt=new Uint32Array([0,1,2,3,4,5,6,7,8,9,10,11,0,1]),Xxt=new Uint32Array([0,10,8,6,4,2]),Qxt=new Uint32Array([1,3,5,7,9,11]),Mwe=b();function Bwe(e,t,...r){for(let n=0,o=r.length;n<o;++n){let i=r[n];b.toArray(b.add(Mwe,i,t),e,n*2*3),b.toArray(b.sub(Mwe,i,t),e,(n*2+1)*3)}}function Zxt(e,t,r,n,o,i){if(!ue.isAtomic(t))return ft.createEmpty(i);let a=t.nucleotideElements.length;if(!a)return ft.createEmpty(i);let{sizeFactor:s,thicknessFactor:l,radialSegments:u,detail:c}=o,m=a*(26+u*2),d=tt.createState(m,m/4,i),{elements:p,model:h,conformation:f}=t,{chainAtomSegments:g,residueAtomSegments:y}=h.atomicHierarchy,{moleculeType:x}=h.atomicHierarchy.derived.residue,S=Kt.transientSegments(g,p),I=Kt.transientSegments(y,p),v=1*s,A=l*s,P={radiusTop:v,radiusBottom:v,radialSegments:u},T=0;for(;S.hasNext;)for(I.setSegment(S.move());I.hasNext;){let{index:E}=I.move();if(pa(x[E])){let M=lf();d.currentGroup=T;let{isPurine:D,isPyrimidine:B}=sf(t,E);D?(uf(M,t,E),M.N9!==-1&&M.trace!==-1&&(f.invariantPosition(M.N9,q4),f.invariantPosition(M.trace,W4),d.currentGroup=T,gn(d,q4,W4,1,P),Zr(d,q4,v,c)),iy(M)&&(f.invariantPosition(M.N1,b0),f.invariantPosition(M.C2,X4),f.invariantPosition(M.N3,Q4),f.invariantPosition(M.C4,iP),f.invariantPosition(M.C5,aP),f.invariantPosition(M.C6,Z4),f.invariantPosition(M.N7,Dwe),f.invariantPosition(M.C8,wwe),b.triangleNormal(x0,b0,iP,aP),b.scale(x0,x0,A),Bwe(Y4,x0,b0,X4,Q4,iP,aP,Z4,Dwe,wwe,q4),tt.addTriangleStrip(d,Y4,zxt),tt.addTriangleFan(d,Y4,Hxt),tt.addTriangleFan(d,Y4,jxt))):B&&(cf(M,t,E),M.N1!==-1&&M.trace!==-1&&(f.invariantPosition(M.N1,b0),f.invariantPosition(M.trace,W4),d.currentGroup=T,gn(d,b0,W4,1,P),Zr(d,b0,v,c)),ay(M)&&(f.invariantPosition(M.C2,X4),f.invariantPosition(M.N3,Q4),f.invariantPosition(M.C4,iP),f.invariantPosition(M.C5,aP),f.invariantPosition(M.C6,Z4),b.triangleNormal(x0,b0,iP,aP),b.scale(x0,x0,A),Bwe(K4,x0,b0,X4,Q4,iP,aP,Z4),tt.addTriangleStrip(d,K4,Wxt),tt.addTriangleFan(d,K4,Xxt),tt.addTriangleFan(d,K4,Qxt))),++T}}let R=tt.getMesh(d),w=he.expand(he(),t.boundary.sphere,v);return R.setBoundingSphere(w),R}var _K={...fo,...Ewe};function kwe(e){return Oo({defaultProps:C.getDefaultValues(_K),createGeometry:Zxt,createLocationIterator:Zd.fromGroup,getLoci:of,eachLocation:af,setUpdateState:(t,r,n)=>{t.createGeometry=r.sizeFactor!==n.sizeFactor||r.thicknessFactor!==n.thicknessFactor||r.radialSegments!==n.radialSegments}},e)}var sP=b(),J4=b(),$4=b(),lP=b(),uP=b(),eG=b(),Fwe=b(),Lwe=b(),Vwe=b(),tG=b(),RK=b(),rG=b(),nG=b(),DK=b(),cP=b(),Cu=b(),mP=b(),Gwe={sizeFactor:C.Numeric(.2,{min:0,max:10,step:.01}),thicknessFactor:C.Numeric(1,{min:0,max:2,step:.01})},BVn=C.getDefaultValues(Gwe),oG=new Float32Array(54),qxt=new Uint32Array([0,1,2,3,4,5,6,7,16,17,14,15,12,13,8,9,10,11,0,1]),Yxt=new Uint32Array([8,12,14,16,6,4,2,0,10]),Kxt=new Uint32Array([9,11,1,3,5,7,17,15,13]),iG=new Float32Array(36),Jxt=new Uint32Array([2,3,4,5,6,7,8,9,10,11,2,3]),$xt=new Uint32Array([0,10,8,6,4,2,10]),eCt=new Uint32Array([1,3,5,7,9,11,3]),aG=new Float32Array(36),tCt=new Uint32Array([0,1,2,3,4,5,6,7,8,9,10,11,0,1]),rCt=new Uint32Array([0,10,8,6,4,2]),nCt=new Uint32Array([1,3,5,7,9,11]),Owe=b();function wK(e,t,...r){for(let n=0,o=r.length;n<o;++n){let i=r[n];b.toArray(b.add(Owe,i,t),e,n*2*3),b.toArray(b.sub(Owe,i,t),e,(n*2+1)*3)}}function oCt(e,t,r,n,o,i){if(!ue.isAtomic(t))return ft.createEmpty(i);let a=t.nucleotideElements.length;if(!a)return ft.createEmpty(i);let{sizeFactor:s,thicknessFactor:l}=o,u=a*25,c=tt.createState(u,u/4,i),{elements:m,model:d,conformation:p}=t,{chainAtomSegments:h,residueAtomSegments:f}=d.atomicHierarchy,{moleculeType:g}=d.atomicHierarchy.derived.residue,y=Kt.transientSegments(h,m),x=Kt.transientSegments(f,m),S=s*l,I=0;for(;y.hasNext;)for(x.setSegment(y.move());x.hasNext;){let{index:P}=x.move();if(pa(g[P])){let T=lf();c.currentGroup=I,g0(T,t,P),y0(T)&&(p.invariantPosition(T.C1_1,tG),p.invariantPosition(T.C2_1,RK),p.invariantPosition(T.C3_1,rG),p.invariantPosition(T.C4_1,nG),p.invariantPosition(T.O4_1,DK),b.triangleNormal(Cu,rG,nG,tG),b.scale(cP,b.add(cP,DK,b.add(cP,nG,b.add(cP,rG,b.add(cP,tG,RK)))),.2),b.scale(mP,Cu,S),wK(iG,mP,cP,rG,nG,DK,tG,RK),tt.addTriangleStrip(c,iG,Jxt),tt.addTriangleFanWithNormal(c,iG,$xt,Cu),b.negate(Cu,Cu),tt.addTriangleFanWithNormal(c,iG,eCt,Cu));let{isPurine:R,isPyrimidine:w}=sf(t,P);R?(uf(T,t,P),iy(T)&&(p.invariantPosition(T.N1,sP),p.invariantPosition(T.C2,J4),p.invariantPosition(T.N3,$4),p.invariantPosition(T.C4,lP),p.invariantPosition(T.C5,uP),p.invariantPosition(T.C6,eG),p.invariantPosition(T.N7,Fwe),p.invariantPosition(T.C8,Lwe),p.invariantPosition(T.N9,Vwe),b.triangleNormal(Cu,sP,lP,uP),b.scale(mP,Cu,S),wK(oG,mP,sP,J4,$4,lP,uP,eG,Fwe,Lwe,Vwe),tt.addTriangleStrip(c,oG,qxt),tt.addTriangleFanWithNormal(c,oG,Yxt,Cu),b.negate(Cu,Cu),tt.addTriangleFanWithNormal(c,oG,Kxt,Cu))):w&&(cf(T,t,P),ay(T)&&(p.invariantPosition(T.N1,sP),p.invariantPosition(T.C2,J4),p.invariantPosition(T.N3,$4),p.invariantPosition(T.C4,lP),p.invariantPosition(T.C5,uP),p.invariantPosition(T.C6,eG),b.triangleNormal(Cu,sP,lP,uP),b.scale(mP,Cu,S),wK(aG,mP,sP,J4,$4,lP,uP,eG),tt.addTriangleStrip(c,aG,tCt),tt.addTriangleFanWithNormal(c,aG,rCt,Cu),b.negate(Cu,Cu),tt.addTriangleFanWithNormal(c,aG,nCt,Cu))),++I}}let v=tt.getMesh(c),A=he.expand(he(),t.boundary.sphere,S);return v.setBoundingSphere(A),v}var MK={...fo,...Gwe};function Uwe(e){return Oo({defaultProps:C.getDefaultValues(MK),createGeometry:oCt,createLocationIterator:Zd.fromGroup,getLoci:of,eachLocation:af,setUpdateState:(t,r,n)=>{t.createGeometry=r.sizeFactor!==n.sizeFactor||r.thicknessFactor!==n.thicknessFactor}},e)}var Su=b(),hi=b(),pl=b(),fl=b(),ja=b(),Wa=b(),hl=b(),sy=b(),ly=b(),ks=b(),Fs=b(),uy=b(),ed=b(),cy=b(),my=b(),sG={...fo,...HA,sizeFactor:C.Numeric(.3,{min:0,max:10,step:.01}),radialSegments:C.Numeric(16,{min:2,max:56,step:2},Xe.CustomQualityParamInfo),tryUseImpostor:C.Boolean(!0)};function Nwe(e,t,r,n){return r.tryUseImpostor&&kC(n)?aCt(e):lCt(e)}function iCt(e,t,r,n,o,i){if(!ue.isAtomic(t))return ji.createEmpty(i);let a=t.nucleotideElements.length;if(!a)return ji.createEmpty(i);let s=a*15,l=g1.create(s,s/4,i),{elements:u,model:c,conformation:m}=t,{chainAtomSegments:d,residueAtomSegments:p}=c.atomicHierarchy,{moleculeType:h}=c.atomicHierarchy.derived.residue,f=Kt.transientSegments(d,u),g=Kt.transientSegments(p,u),y=0,x=2;for(;f.hasNext;)for(g.setSegment(f.move());g.hasNext;){let{index:v}=g.move();if(pa(h[v])){let A=lf();g0(A,t,v),y0(A)&&(m.invariantPosition(A.C1_1,Fs),m.invariantPosition(A.C2_1,uy),m.invariantPosition(A.C3_1,ed),m.invariantPosition(A.C4_1,cy),m.invariantPosition(A.O4_1,my),m.invariantPosition(A.trace,Su),l.add(ed[0],ed[1],ed[2],Su[0],Su[1],Su[2],1,!0,!0,x,y),l.add(ed[0],ed[1],ed[2],cy[0],cy[1],cy[2],1,!0,!0,x,y),l.add(cy[0],cy[1],cy[2],my[0],my[1],my[2],1,!0,!0,x,y),l.add(my[0],my[1],my[2],Fs[0],Fs[1],Fs[2],1,!0,!0,x,y),l.add(Fs[0],Fs[1],Fs[2],uy[0],uy[1],uy[2],1,!0,!0,x,y),l.add(uy[0],uy[1],uy[2],ed[0],ed[1],ed[2],1,!0,!0,x,y));let{isPurine:P,isPyrimidine:T}=sf(t,v);P?(uf(A,t,v),A.C1_1!==-1&&A.N9!==-1?(m.invariantPosition(A.C1_1,Fs),m.invariantPosition(A.N9,ks),l.add(ks[0],ks[1],ks[2],Fs[0],Fs[1],Fs[2],1,!0,!0,x,y)):A.N9!==-1&&A.trace!==-1&&(m.invariantPosition(A.N9,ks),m.invariantPosition(A.trace,Su),l.add(ks[0],ks[1],ks[2],Su[0],Su[1],Su[2],1,!0,!0,x,y)),iy(A)&&(m.invariantPosition(A.N1,hi),m.invariantPosition(A.C2,pl),m.invariantPosition(A.N3,fl),m.invariantPosition(A.C4,ja),m.invariantPosition(A.C5,Wa),m.invariantPosition(A.C6,hl),m.invariantPosition(A.N7,sy),m.invariantPosition(A.C8,ly),m.invariantPosition(A.N9,ks),l.add(ks[0],ks[1],ks[2],ly[0],ly[1],ly[2],1,!0,!0,x,y),l.add(ly[0],ly[1],ly[2],sy[0],sy[1],sy[2],1,!0,!0,x,y),l.add(sy[0],sy[1],sy[2],Wa[0],Wa[1],Wa[2],1,!0,!0,x,y),l.add(Wa[0],Wa[1],Wa[2],hl[0],hl[1],hl[2],1,!0,!0,x,y),l.add(hl[0],hl[1],hl[2],hi[0],hi[1],hi[2],1,!0,!0,x,y),l.add(hi[0],hi[1],hi[2],pl[0],pl[1],pl[2],1,!0,!0,x,y),l.add(pl[0],pl[1],pl[2],fl[0],fl[1],fl[2],1,!0,!0,x,y),l.add(fl[0],fl[1],fl[2],ja[0],ja[1],ja[2],1,!0,!0,x,y),l.add(ja[0],ja[1],ja[2],Wa[0],Wa[1],Wa[2],1,!0,!0,x,y),l.add(ja[0],ja[1],ja[2],ks[0],ks[1],ks[2],1,!0,!0,x,y))):T&&(cf(A,t,v),A.C1_1!==-1&&A.N1!==-1?(m.invariantPosition(A.N1,hi),m.invariantPosition(A.C1_1,Fs),l.add(hi[0],hi[1],hi[2],Fs[0],Fs[1],Fs[2],1,!0,!0,x,y)):A.N1!==-1&&A.trace!==-1&&(m.invariantPosition(A.N1,hi),m.invariantPosition(A.trace,Su),l.add(hi[0],hi[1],hi[2],Su[0],Su[1],Su[2],1,!0,!0,x,y)),ay(A)&&(m.invariantPosition(A.N1,hi),m.invariantPosition(A.C2,pl),m.invariantPosition(A.N3,fl),m.invariantPosition(A.C4,ja),m.invariantPosition(A.C5,Wa),m.invariantPosition(A.C6,hl),l.add(hi[0],hi[1],hi[2],hl[0],hl[1],hl[2],1,!0,!0,x,y),l.add(hl[0],hl[1],hl[2],Wa[0],Wa[1],Wa[2],1,!0,!0,x,y),l.add(Wa[0],Wa[1],Wa[2],ja[0],ja[1],ja[2],1,!0,!0,x,y),l.add(ja[0],ja[1],ja[2],fl[0],fl[1],fl[2],1,!0,!0,x,y),l.add(fl[0],fl[1],fl[2],pl[0],pl[1],pl[2],1,!0,!0,x,y),l.add(pl[0],pl[1],pl[2],hi[0],hi[1],hi[2],1,!0,!0,x,y))),++y}}let S=l.getCylinders(),I=he.expand(he(),t.boundary.sphere,1*o.sizeFactor);return S.setBoundingSphere(I),S}function aCt(e){return jA({defaultProps:C.getDefaultValues(sG),createGeometry:iCt,createLocationIterator:Zd.fromGroup,getLoci:of,eachLocation:af,setUpdateState:(t,r,n)=>{t.createGeometry=r.sizeFactor!==n.sizeFactor},mustRecreate:(t,r,n)=>!r.tryUseImpostor||!n},e)}function sCt(e,t,r,n,o,i){if(!ue.isAtomic(t))return ft.createEmpty(i);let a=t.nucleotideElements.length;if(!a)return ft.createEmpty(i);let{sizeFactor:s,radialSegments:l}=o,u=a*(l*15),c=tt.createState(u,u/4,i),{elements:m,model:d,conformation:p}=t,{chainAtomSegments:h,residueAtomSegments:f}=d.atomicHierarchy,{moleculeType:g}=d.atomicHierarchy.derived.residue,y=Kt.transientSegments(h,m),x=Kt.transientSegments(f,m),S={radiusTop:1*s,radiusBottom:1*s,radialSegments:l},I=0;for(;y.hasNext;)for(x.setSegment(y.move());x.hasNext;){let{index:P}=x.move();if(pa(g[P])){let T=lf();c.currentGroup=I,g0(T,t,P),y0(T)&&(p.invariantPosition(T.C1_1,Fs),p.invariantPosition(T.C2_1,uy),p.invariantPosition(T.C3_1,ed),p.invariantPosition(T.C4_1,cy),p.invariantPosition(T.O4_1,my),p.invariantPosition(T.trace,Su),gn(c,ed,Su,1,S),gn(c,ed,cy,1,S),gn(c,cy,my,1,S),gn(c,my,Fs,1,S),gn(c,Fs,uy,1,S),gn(c,uy,ed,1,S));let{isPurine:R,isPyrimidine:w}=sf(t,P);R?(uf(T,t,P),T.C1_1!==-1&&T.N9!==-1?(p.invariantPosition(T.C1_1,Fs),p.invariantPosition(T.N9,ks),gn(c,ks,Fs,1,S)):T.N9!==-1&&T.trace!==-1&&(p.invariantPosition(T.N9,ks),p.invariantPosition(T.trace,Su),gn(c,ks,Su,1,S)),iy(T)&&(p.invariantPosition(T.N1,hi),p.invariantPosition(T.C2,pl),p.invariantPosition(T.N3,fl),p.invariantPosition(T.C4,ja),p.invariantPosition(T.C5,Wa),p.invariantPosition(T.C6,hl),p.invariantPosition(T.N7,sy),p.invariantPosition(T.C8,ly),p.invariantPosition(T.N9,ks),gn(c,ks,ly,1,S),gn(c,ly,sy,1,S),gn(c,sy,Wa,1,S),gn(c,Wa,hl,1,S),gn(c,hl,hi,1,S),gn(c,hi,pl,1,S),gn(c,pl,fl,1,S),gn(c,fl,ja,1,S),gn(c,ja,Wa,1,S),gn(c,ja,ks,1,S))):w&&(cf(T,t,P),T.C1_1!==-1&&T.N1!==-1?(p.invariantPosition(T.N1,hi),p.invariantPosition(T.C1_1,Fs),gn(c,hi,Fs,1,S)):T.N1!==-1&&T.trace!==-1&&(p.invariantPosition(T.N1,hi),p.invariantPosition(T.trace,Su),gn(c,hi,Su,1,S)),ay(T)&&(p.invariantPosition(T.N1,hi),p.invariantPosition(T.C2,pl),p.invariantPosition(T.N3,fl),p.invariantPosition(T.C4,ja),p.invariantPosition(T.C5,Wa),p.invariantPosition(T.C6,hl),gn(c,hi,hl,1,S),gn(c,hl,Wa,1,S),gn(c,Wa,ja,1,S),gn(c,ja,fl,1,S),gn(c,fl,pl,1,S),gn(c,pl,hi,1,S))),++I}}let v=tt.getMesh(c),A=he.expand(he(),t.boundary.sphere,1*o.sizeFactor);return v.setBoundingSphere(A),v}function lCt(e){return Oo({defaultProps:C.getDefaultValues(sG),createGeometry:sCt,createLocationIterator:Zd.fromGroup,getLoci:of,eachLocation:af,setUpdateState:(t,r,n)=>{t.createGeometry=r.sizeFactor!==n.sizeFactor||r.radialSegments!==n.radialSegments},mustRecreate:(t,r,n)=>r.tryUseImpostor&&!!n},e)}var dP=b(),mf=b(),df=b(),pf=b(),ff=b(),qd=b(),hf=b(),pP=b(),fP=b(),hP=b(),gP=b(),yP=b(),bP=b(),xP=b(),CP=b(),lG={...fo,...NA,sizeFactor:C.Numeric(.3,{min:0,max:10,step:.01}),detail:C.Numeric(0,{min:0,max:3,step:1},Xe.CustomQualityParamInfo),tryUseImpostor:C.Boolean(!0)};function zwe(e,t,r,n){return r.tryUseImpostor&&FA(n)?cCt(e):dCt(e)}function uCt(e,t,r,n,o,i){if(!ue.isAtomic(t))return Hs.createEmpty(i);let a=t.nucleotideElements.length;if(!a)return Hs.createEmpty(i);let s=a*15,l=Fg.create(s,s/4,i),{elements:u,model:c,conformation:m}=t,{chainAtomSegments:d,residueAtomSegments:p}=c.atomicHierarchy,{moleculeType:h}=c.atomicHierarchy.derived.residue,f=Kt.transientSegments(d,u),g=Kt.transientSegments(p,u),y=0;for(;f.hasNext;)for(g.setSegment(f.move());g.hasNext;){let{index:I}=g.move();if(pa(h[I])){let v=lf();g0(v,t,I),y0(v)&&(m.invariantPosition(v.C1_1,gP),m.invariantPosition(v.C2_1,yP),m.invariantPosition(v.C3_1,bP),m.invariantPosition(v.C4_1,xP),m.invariantPosition(v.O4_1,CP),m.invariantPosition(v.trace,dP),l.add(dP[0],dP[1],dP[2],y),l.add(bP[0],bP[1],bP[2],y),l.add(xP[0],xP[1],xP[2],y),l.add(CP[0],CP[1],CP[2],y),l.add(gP[0],gP[1],gP[2],y),l.add(yP[0],yP[1],yP[2],y));let{isPurine:A,isPyrimidine:P}=sf(t,I);A?(uf(v,t,I),iy(v)&&(m.invariantPosition(v.N1,mf),m.invariantPosition(v.C2,df),m.invariantPosition(v.N3,pf),m.invariantPosition(v.C4,ff),m.invariantPosition(v.C5,qd),m.invariantPosition(v.C6,hf),m.invariantPosition(v.N7,pP),m.invariantPosition(v.C8,fP),m.invariantPosition(v.N9,hP),l.add(hP[0],hP[1],hP[2],y),l.add(fP[0],fP[1],fP[2],y),l.add(pP[0],pP[1],pP[2],y),l.add(qd[0],qd[1],qd[2],y),l.add(hf[0],hf[1],hf[2],y),l.add(mf[0],mf[1],mf[2],y),l.add(df[0],df[1],df[2],y),l.add(pf[0],pf[1],pf[2],y),l.add(ff[0],ff[1],ff[2],y))):P&&(cf(v,t,I),ay(v)&&(m.invariantPosition(v.N1,mf),m.invariantPosition(v.C2,df),m.invariantPosition(v.N3,pf),m.invariantPosition(v.C4,ff),m.invariantPosition(v.C5,qd),m.invariantPosition(v.C6,hf),l.add(mf[0],mf[1],mf[2],y),l.add(hf[0],hf[1],hf[2],y),l.add(qd[0],qd[1],qd[2],y),l.add(ff[0],ff[1],ff[2],y),l.add(pf[0],pf[1],pf[2],y),l.add(df[0],df[1],df[2],y))),++y}}let x=l.getSpheres(),S=he.expand(he(),t.boundary.sphere,1*o.sizeFactor);return x.setBoundingSphere(S),x}function cCt(e){return zA({defaultProps:C.getDefaultValues(lG),createGeometry:uCt,createLocationIterator:Zd.fromGroup,getLoci:of,eachLocation:af,setUpdateState:(t,r,n)=>{t.createGeometry=r.sizeFactor!==n.sizeFactor},mustRecreate:(t,r,n)=>!r.tryUseImpostor||!n},e)}function mCt(e,t,r,n,o,i){if(!ue.isAtomic(t))return ft.createEmpty(i);let a=t.nucleotideElements.length;if(!a)return ft.createEmpty(i);let{sizeFactor:s,detail:l}=o,u=a*Nm(l),c=tt.createState(u,u/2,i),{elements:m,model:d,conformation:p}=t,{chainAtomSegments:h,residueAtomSegments:f}=d.atomicHierarchy,{moleculeType:g}=d.atomicHierarchy.derived.residue,y=Kt.transientSegments(h,m),x=Kt.transientSegments(f,m),S=1*s,I=0;for(;y.hasNext;)for(x.setSegment(y.move());x.hasNext;){let{index:P}=x.move();if(pa(g[P])){let T=lf();c.currentGroup=I,g0(T,t,P),y0(T)&&(p.invariantPosition(T.C1_1,gP),p.invariantPosition(T.C2_1,yP),p.invariantPosition(T.C3_1,bP),p.invariantPosition(T.C4_1,xP),p.invariantPosition(T.O4_1,CP),p.invariantPosition(T.trace,dP),Zr(c,dP,S,l),Zr(c,xP,S,l),Zr(c,CP,S,l),Zr(c,gP,S,l),Zr(c,yP,S,l),Zr(c,bP,S,l));let{isPurine:R,isPyrimidine:w}=sf(t,P);R?(uf(T,t,P),iy(T)&&(p.invariantPosition(T.N1,mf),p.invariantPosition(T.C2,df),p.invariantPosition(T.N3,pf),p.invariantPosition(T.C4,ff),p.invariantPosition(T.C5,qd),p.invariantPosition(T.C6,hf),p.invariantPosition(T.N7,pP),p.invariantPosition(T.C8,fP),p.invariantPosition(T.N9,hP),Zr(c,fP,S,l),Zr(c,pP,S,l),Zr(c,qd,S,l),Zr(c,hf,S,l),Zr(c,mf,S,l),Zr(c,df,S,l),Zr(c,pf,S,l),Zr(c,ff,S,l),Zr(c,qd,S,l),Zr(c,hP,S,l))):w&&(cf(T,t,P),ay(T)&&(p.invariantPosition(T.N1,mf),p.invariantPosition(T.C2,df),p.invariantPosition(T.N3,pf),p.invariantPosition(T.C4,ff),p.invariantPosition(T.C5,qd),p.invariantPosition(T.C6,hf),Zr(c,hf,S,l),Zr(c,qd,S,l),Zr(c,ff,S,l),Zr(c,pf,S,l),Zr(c,df,S,l),Zr(c,mf,S,l))),++I}}let v=tt.getMesh(c),A=he.expand(he(),t.boundary.sphere,1*o.sizeFactor);return v.setBoundingSphere(A),v}function dCt(e){return Oo({defaultProps:C.getDefaultValues(lG),createGeometry:mCt,createLocationIterator:Zd.fromGroup,getLoci:of,eachLocation:af,setUpdateState:(t,r,n)=>{t.createGeometry=r.sizeFactor!==n.sizeFactor||r.detail!==n.detail},mustRecreate:(t,r,n)=>r.tryUseImpostor&&!!n},e)}var W1=b.zero(),SP=b.zero(),X1=b.zero(),Hwe=b.zero(),gl=Yc(3,!1);function pCt(){let e=Kf(8);for(let t=0;t<3;++t){let r=(t+1)%3;b.set(W1,gl[t*3],gl[t*3+1],-.5),b.set(SP,gl[r*3],gl[r*3+1],-.5),b.set(X1,gl[r*3],gl[r*3+1],.5),b.set(Hwe,gl[t*3],gl[t*3+1],.5),e.add(W1,SP,X1),e.add(X1,Hwe,W1)}return b.set(W1,gl[0],gl[1],-.5),b.set(SP,gl[3],gl[4],-.5),b.set(X1,gl[6],gl[7],-.5),e.add(X1,SP,W1),b.set(W1,gl[0],gl[1],.5),b.set(SP,gl[3],gl[4],.5),b.set(X1,gl[6],gl[7],.5),e.add(W1,SP,X1),e.getPrimitive()}var BK;function jwe(){return BK||(BK=pCt()),BK}var Q1=H.identity(),fCt=b.zero(),Wwe=b.zero(),Xwe=b.zero(),EK=b.zero(),hCt=4,gCt=4,yCt=6,bCt=jwe(),Qwe={sizeFactor:C.Numeric(.2,{min:0,max:10,step:.01})},LOn=C.getDefaultValues(Qwe);function xCt(e,t,r,n,o,i){let a=t.polymerElements.length;if(!a)return ft.createEmpty(i);let{sizeFactor:s}=o,l=a*24,u=tt.createState(l,l/10,i),m=rP(1),{normalVectors:d,binormalVectors:p}=m,h=0,f=JT(t,r);for(;f.hasNext;){let x=f.move();u.currentGroup=h;let S=pa(x.moleculeType),I=rr.is(x.secStrucType,rr.Flag.Beta);if(nP(m,x,S||I?.5:.9,S?.3:.5),I&&!x.secStrucLast||!I){let P=n.size.size(x.center)*s,T=hCt*P,R=gCt*P,w=yCt*P,E=S?p:d;b.fromArray(Wwe,E,0),b.fromArray(Xwe,E,3),b.normalize(EK,b.add(EK,Wwe,Xwe)),H.targetTo(Q1,x.p3,x.p1,EK),H.mul(Q1,Q1,H.rotY90Z180),H.scale(Q1,Q1,b.set(fCt,w,R,T)),H.setTranslation(Q1,x.p2),tt.addPrimitive(u,Q1,bCt)}++h}let g=tt.getMesh(u),y=he.expand(he(),t.boundary.sphere,1*o.sizeFactor);return g.setBoundingSphere(y),g}var kK={...fo,...Qwe};function Zwe(e){return Oo({defaultProps:C.getDefaultValues(kK),createGeometry:xCt,createLocationIterator:t=>Qd.fromGroup(t),getLoci:rf,eachLocation:nf,setUpdateState:(t,r,n)=>{t.createGeometry=r.sizeFactor!==n.sizeFactor}},e)}var FK=10,qwe={sizeFactor:C.Numeric(.2,{min:0,max:10,step:.01}),radialSegments:C.Numeric(16,{min:2,max:56,step:2},Xe.CustomQualityParamInfo)},ZOn=C.getDefaultValues(qwe);function CCt(e,t,r,n,o,i){let a=t.gapElements.length;if(!a)return ft.createEmpty(i);let{sizeFactor:s,radialSegments:l}=o,u=FK*l*2*a*2,c=tt.createState(u,u/10,i),m=b(),d=b(),p={radiusTop:1,radiusBottom:1,topCap:!0,bottomCap:!0,radialSegments:l},h=0,f=swe(r,t);for(;f.hasNext;){let{centerA:x,centerB:S}=f.move();x.element===S.element||(t.conformation.invariantPosition(x.element,m),t.conformation.invariantPosition(S.element,d),p.radiusTop=p.radiusBottom=n.size.size(x)*s,c.currentGroup=h,wp(c,m,d,.5,FK,!1,p),p.radiusTop=p.radiusBottom=n.size.size(S)*s,c.currentGroup=h+1,wp(c,d,m,.5,FK,!1,p)),h+=2}let g=tt.getMesh(c),y=he.expand(he(),t.boundary.sphere,1*o.sizeFactor);return g.setBoundingSphere(y),g}var Z1={...fo,...qwe};function vP(e){return Oo({defaultProps:C.getDefaultValues(Z1),createGeometry:CCt,createLocationIterator:t=>SK.fromGroup(t,{asSecondary:!0}),getLoci:xwe,eachLocation:Cwe,setUpdateState:(t,r,n)=>{t.createGeometry=r.sizeFactor!==n.sizeFactor||r.radialSegments!==n.radialSegments}},e)}var oo=b(),Uo=b(),SCt=b(),Yd=b(),dy=b(),uG=b(),cG=b(),u3=b(),Ah=b(),py=b(),LK=b(),C0=b(),S0=b(),v0=b(),I0=b(),gf=b.fromArray,IP=b.scale,yf=b.add,zb=b.sub,vCt=b.magnitude,Ywe=b.negate,VK=b.copy,Kwe=b.cross,ICt=b.set,ei=qe.add3,ACt=qe.add;function mG(e,t,r,n,o,i,a,s,l){let{vertices:u,normals:c,indices:m}=t,d=u.elementCount;if(gf(oo,n,e),IP(cG,oo,a),IP(uG,oo,s),gf(Uo,o,e),IP(Yd,Uo,i),Kwe(py,Uo,oo),gf(Ah,r,e),yf(C0,yf(C0,Ah,Yd),uG),zb(S0,yf(S0,Ah,Yd),cG),zb(v0,zb(v0,Ah,Yd),cG),yf(I0,zb(I0,Ah,Yd),uG),a<s?(ei(u,I0[0],I0[1],I0[2]),ei(u,v0[0],v0[1],v0[2]),ei(u,S0[0],S0[1],S0[2]),ei(u,C0[0],C0[1],C0[2]),VK(dy,uG)):(ei(u,C0[0],C0[1],C0[2]),ei(u,S0[0],S0[1],S0[2]),ei(u,v0[0],v0[1],v0[2]),ei(u,I0[0],I0[1],I0[2]),VK(dy,cG)),l){for(let p=0;p<4;++p)ei(c,-py[0],-py[1],-py[2]);ei(m,d,d+1,d+2),ei(m,d+2,d+3,d)}else{for(let p=0;p<4;++p)ei(c,py[0],py[1],py[2]);ei(m,d+2,d+1,d),ei(m,d,d+3,d+2)}}function AP(e,t,r,n,o,i,a,s,l,u){let{currentGroup:c,vertices:m,normals:d,indices:p,groups:h}=e,f=m.elementCount,g=0;s>0?(gf(oo,t,0),gf(Uo,t,o*3),g=s/vCt(zb(SCt,Uo,oo))):ICt(u3,0,0,0);for(let x=0;x<=o;++x){let S=i[x],I=a[x],v=s===0?I:s*(1-x/o),A=x*3;gf(dy,r,A),IP(dy,dy,v),gf(Yd,n,A),IP(Yd,Yd,S),s>0&&(gf(oo,r,A),gf(Uo,n,A),IP(u3,Kwe(u3,oo,Uo),g)),gf(Ah,t,A),gf(py,r,A),gf(LK,n,A),yf(oo,yf(oo,Ah,Yd),dy),yf(Uo,py,u3),ei(m,oo[0],oo[1],oo[2]),ei(d,Uo[0],Uo[1],Uo[2]),yf(oo,zb(oo,Ah,Yd),dy),ei(m,oo[0],oo[1],oo[2]),ei(d,Uo[0],Uo[1],Uo[2]),Ywe(Uo,LK),ei(m,oo[0],oo[1],oo[2]),ei(d,Uo[0],Uo[1],Uo[2]),zb(oo,zb(oo,Ah,Yd),dy),ei(m,oo[0],oo[1],oo[2]),ei(d,Uo[0],Uo[1],Uo[2]),yf(Uo,Ywe(Uo,py),u3),ei(m,oo[0],oo[1],oo[2]),ei(d,Uo[0],Uo[1],Uo[2]),zb(oo,yf(oo,Ah,Yd),dy),ei(m,oo[0],oo[1],oo[2]),ei(d,Uo[0],Uo[1],Uo[2]),VK(Uo,LK),ei(m,oo[0],oo[1],oo[2]),ei(d,Uo[0],Uo[1],Uo[2]),yf(oo,yf(oo,Ah,Yd),dy),ei(m,oo[0],oo[1],oo[2]),ei(d,Uo[0],Uo[1],Uo[2])}for(let x=0;x<o;++x){for(let S=0;S<2;S++)ei(p,f+x*8+2*S,f+(x+1)*8+2*S+1,f+x*8+2*S+1),ei(p,f+x*8+2*S,f+(x+1)*8+2*S,f+(x+1)*8+2*S+1);for(let S=2;S<4;S++)ei(p,f+x*8+2*S,f+(x+1)*8+2*S,f+x*8+2*S+1),ei(p,f+(x+1)*8+2*S,f+(x+1)*8+2*S+1,f+x*8+2*S+1)}if(l){let x=i[0],S=a[0],I=s===0?S:s;mG(0,e,t,r,n,x,I,I,!1)}else if(s>0){let x=i[0],S=a[0];mG(0,e,t,r,n,x,s,-S,!1),mG(0,e,t,r,n,x,-s,S,!1)}if(u&&s===0){let x=i[o],S=a[o];mG(o*3,e,t,r,n,x,S,S,!0)}let y=(o+1)*8+(l?4:s>0?8:0)+(u&&s===0?4:0);for(let x=0,S=y;x<S;++x)ACt(h,c)}var Ra=b(),dG=b(),Qs=b(),cm=b(),yl=b(),vu=b();function pG(e,t,r,n,o){e[0]=t[0]*n+r[0]*o,e[1]=t[1]*n+r[1]*o,e[2]=t[2]*n+r[2]*o}function TP(e,t,r,n,o,i){e[0]=t[0]*o+r[0]*i+n[0],e[1]=t[1]*o+r[1]*i+n[1],e[2]=t[2]*o+r[2]*i+n[2]}var Hb=b.fromArray,Jwe=b.normalize,OK=b.scaleAndAdd,GK=b.cross,TCt=b.slerp,PCt=b.dot,_Ct=b.unitX,Ic=qe.add3,UK=new Map;function RCt(e,t){let r=t?1:0,n=ca(e,r);if(!UK.has(n)){let o=[],i=[];for(let a=0;a<e;++a){let s=(a*2+r)/e*Math.PI;o[a]=Math.cos(s),i[a]=Math.sin(s)}UK.set(n,{cos:o,sin:i})}return UK.get(n)}function c3(e,t,r,n,o,i,a,s,l,u,c,m=!1){let{currentGroup:d,vertices:p,normals:h,indices:f,groups:g}=e,y=p.elementCount,{cos:x,sin:S}=RCt(i,c==="rounded"),I=Math.round(i/4),v=I*3,A=m&&o&&(l||u),P,T=A&&l&&u;T&&(P=o/2);for(let E=0;E<=o;++E){let M=E*3;Hb(yl,r,M),Hb(vu,n,M),Hb(cm,t,M);let D=a[E],B=s[E],k;if(A){let z=T?E<=P:l;T?k=Math.max(Number.EPSILON,Math.sqrt(1-Math.pow((z?P-E:E-P)/P,2))):k=Math.max(Number.EPSILON,Math.sqrt(1-Math.pow((z?o-E:E)/o,2))),D*=k,B*=k,GK(dG,z?vu:yl,z?yl:vu),Jwe(dG,dG)}let F=c==="rounded"&&B>D;for(let z=0;z<i;++z){if(F){TP(Qs,yl,vu,cm,D*x[z],D*S[z]);let j=PCt(vu,_Ct)<0?z<I||z>=v?B-D:-B+D:z>=I&&z<v?-B+D:B-D;OK(Qs,Qs,yl,j),z===I||z===I-1?pG(Ra,yl,vu,0,1):z===v||z===v-1?pG(Ra,yl,vu,0,-1):pG(Ra,yl,vu,x[z],S[z])}else TP(Qs,yl,vu,cm,B*x[z],D*S[z]),pG(Ra,yl,vu,D*x[z],B*S[z]);Jwe(Ra,Ra),Ic(p,Qs[0],Qs[1],Qs[2]),A&&TCt(Ra,dG,Ra,k),Ic(h,Ra[0],Ra[1],Ra[2])}}let R=Math.round(i/2);for(let E=0;E<o;++E){for(let M=0;M<R;++M)Ic(f,y+E*i+(M+1)%i,y+(E+1)*i+(M+1)%i,y+E*i+M),Ic(f,y+(E+1)*i+(M+1)%i,y+(E+1)*i+M,y+E*i+M);for(let M=R;M<i;++M)Ic(f,y+E*i+(M+1)%i,y+(E+1)*i+M,y+E*i+M),Ic(f,y+(E+1)*i+(M+1)%i,y+(E+1)*i+M,y+E*i+(M+1)%i)}if(l){let M=p.elementCount;Hb(yl,r,0),Hb(vu,n,0),Hb(cm,t,0),GK(Ra,vu,yl),Ic(p,cm[0],cm[1],cm[2]),Ic(h,Ra[0],Ra[1],Ra[2]);let D=A?0:a[0],B=A?0:s[0],k=c==="rounded"&&B>D;k&&(B-=D),y=p.elementCount;for(let F=0;F<i;++F)k?(TP(Qs,yl,vu,cm,D*x[F],D*S[F]),OK(Qs,Qs,yl,F<I||F>=v?B:-B)):TP(Qs,yl,vu,cm,B*x[F],D*S[F]),Ic(p,Qs[0],Qs[1],Qs[2]),Ic(h,Ra[0],Ra[1],Ra[2]),Ic(f,y+(F+1)%i,y+F,M)}if(u){let E=o*3,M=p.elementCount;Hb(yl,r,E),Hb(vu,n,E),Hb(cm,t,E),GK(Ra,yl,vu),Ic(p,cm[0],cm[1],cm[2]),Ic(h,Ra[0],Ra[1],Ra[2]);let D=A?0:a[o],B=A?0:s[o],k=c==="rounded"&&B>D;k&&(B-=D),y=p.elementCount;for(let F=0;F<i;++F)k?(TP(Qs,yl,vu,cm,D*x[F],D*S[F]),OK(Qs,Qs,yl,F<I||F>=v?B:-B)):TP(Qs,yl,vu,cm,B*x[F],D*S[F]),Ic(p,Qs[0],Qs[1],Qs[2]),Ic(h,Ra[0],Ra[1],Ra[2]),Ic(f,y+F,y+(F+1)%i,M)}let w=(o+1)*i+(l?i+1:0)+(u?i+1:0);qe.addRepeat(g,w,d)}var jb=b.fromArray,DCt=b.magnitude,NK=b.sub,$we=b.add,zK=b.scale,wCt=b.negate,MCt=b.copy,BCt=b.cross,bf=qe.add3,ECt=qe.add,bl=b(),Iu=b(),kCt=b(),HK=b(),q1=b(),eMe=b(),m3=b(),FCt=b(),jK=b();function PP(e,t,r,n,o,i,a,s){let{currentGroup:l,vertices:u,normals:c,indices:m,groups:d}=e,p=u.elementCount,h=0;s>0&&(jb(bl,t,0),jb(Iu,t,o*3),h=s/DCt(NK(kCt,Iu,bl)));for(let g=0;g<=o;++g){let y=i[g],x=a[g],S=s===0?x:s*(1-g/o),I=g*3;jb(q1,r,I),zK(q1,q1,S),jb(HK,n,I),zK(HK,HK,y),s>0&&(jb(bl,r,I),jb(Iu,n,I),zK(eMe,BCt(eMe,bl,Iu),h)),jb(m3,t,I),jb(FCt,r,I),jb(jK,n,I),$we(bl,m3,q1),wCt(Iu,jK),bf(u,bl[0],bl[1],bl[2]),bf(c,Iu[0],Iu[1],Iu[2]),NK(bl,m3,q1),bf(u,bl[0],bl[1],bl[2]),bf(c,Iu[0],Iu[1],Iu[2]),$we(bl,m3,q1),MCt(Iu,jK),bf(u,bl[0],bl[1],bl[2]),bf(c,Iu[0],Iu[1],Iu[2]),NK(bl,m3,q1),bf(u,bl[0],bl[1],bl[2]),bf(c,Iu[0],Iu[1],Iu[2])}for(let g=0;g<o;++g)bf(m,p+g*4,p+(g+1)*4+1,p+g*4+1),bf(m,p+g*4,p+(g+1)*4,p+(g+1)*4+1),bf(m,p+g*4+2+1,p+(g+1)*4+2+1,p+g*4+2),bf(m,p+g*4+2,p+(g+1)*4+2+1,p+(g+1)*4+2);let f=(o+1)*4;for(let g=0,y=f;g<y;++g)ECt(d,l)}var tMe={sizeFactor:C.Numeric(.2,{min:0,max:10,step:.01}),aspectRatio:C.Numeric(5,{min:.1,max:10,step:.1}),arrowFactor:C.Numeric(1.5,{min:0,max:3,step:.1},{description:"Size factor for sheet arrows"}),tubularHelices:C.Boolean(!1,{description:"Draw alpha helices as tubes"}),roundCap:C.Boolean(!1,{description:"Draw round caps on tubular alpha helices"}),helixProfile:C.Select("elliptical",C.arrayToOptions(["elliptical","rounded","square"]),{description:"Protein helix trace profile"}),nucleicProfile:C.Select("square",C.arrayToOptions(["elliptical","rounded","square"]),{description:"Nucleic strand trace profile"}),detail:C.Numeric(0,{min:0,max:3,step:1},Xe.CustomQualityParamInfo),linearSegments:C.Numeric(8,{min:1,max:48,step:1},Xe.CustomQualityParamInfo),radialSegments:C.Numeric(16,{min:2,max:56,step:2},Xe.CustomQualityParamInfo)},v4n=C.getDefaultValues(tMe),td=b();function LCt(e,t,r,n,o,i){let a=t.polymerElements.length;if(!a)return ft.createEmpty(i);let{sizeFactor:s,detail:l,linearSegments:u,radialSegments:c,aspectRatio:m,arrowFactor:d,tubularHelices:p,roundCap:h,helixProfile:f,nucleicProfile:g}=o,y=u*c*a+(c+1)*a*2,x=tt.createState(y,y/10,i),S=ue.isCoarse(t),I=rP(u),{curvePoints:v,normalVectors:A,binormalVectors:P,widthValues:T,heightValues:R}=I,w=0,E=JT(t,r,{ignoreSecondaryStructure:!1,useHelixOrientation:p});for(;E.hasNext;){let B=E.move();x.currentGroup=w;let k=pa(B.moleculeType),F=rr.is(B.secStrucType,rr.Flag.Beta),z=rr.is(B.secStrucType,rr.Flag.Helix),j=z&&!p?bwe:z4,Y=k?j1:H1;nP(I,B,j,Y);let G=n.size.size(B.centerPrev)*s,X=n.size.size(B.center)*s,U=n.size.size(B.centerNext)*s;S&&(G*=m/2,X*=m/2,U*=m/2);let L=B.secStrucFirst||B.coarseBackboneFirst||B.first,q=B.secStrucLast||B.coarseBackboneLast||B.last,te=z&&p&&h,J=u;if(B.initial){J=Math.max(Math.round(u*Y),1);let ee=u-J;v.copyWithin(0,ee*3),P.copyWithin(0,ee*3),A.copyWithin(0,ee*3),b.fromArray(td,v,3),b.normalize(td,b.sub(td,B.p2,td)),b.scaleAndAdd(td,B.p2,td,X*oP),b.toArray(td,v,0)}else B.final&&(J=Math.max(Math.round(u*(1-Y)),1),b.fromArray(td,v,J*3-3),b.normalize(td,b.sub(td,B.p2,td)),b.scaleAndAdd(td,B.p2,td,X*oP),b.toArray(td,v,J*3));if(B.initial===!0&&B.final===!0)Zr(x,B.p2,X*2,l);else if(F){let ee=G*m,ce=X*m,fe=U*m,O=B.secStrucLast?ce*d:0;s3(I,G,X,U,ee,ce,fe,Y),c===2?PP(x,v,A,P,J,T,R,O):AP(x,v,A,P,J,T,R,O,L,q)}else{let ee,ce,fe;z?p?(G*=m*1.5,X*=m*1.5,U*=m*1.5,ee=G,ce=X,fe=U):(ee=G*m,ce=X*m,fe=U*m):k?(ee=G*m,ce=X*m,fe=U*m):(ee=G,ce=X,fe=U),s3(I,G,X,U,ee,ce,fe,Y);let[O,V]=k?[P,A]:[A,P];if(k)for(let pe=0,$=O.length;pe<$;pe++)O[pe]*=-1;let Z=k?g:f;c===2?k?PP(x,v,O,V,J,R,T,0):PP(x,v,O,V,J,T,R,0):c===4?AP(x,v,O,V,J,T,R,0,L,q):ce===X?c3(x,v,O,V,J,c,T,R,L,q,"elliptical",te):Z==="square"?AP(x,v,O,V,J,T,R,0,L,q):c3(x,v,O,V,J,c,T,R,L,q,Z)}++w}let M=tt.getMesh(x),D=he.expand(he(),t.boundary.sphere,1*o.sizeFactor);return M.setBoundingSphere(D),M}var WK={...fo,...tMe};function rMe(e){return Oo({defaultProps:C.getDefaultValues(WK),createGeometry:LCt,createLocationIterator:t=>Qd.fromGroup(t,{asSecondary:!0}),getLoci:rf,eachLocation:nf,setUpdateState:(t,r,n,o,i,a,s)=>{t.createGeometry=r.sizeFactor!==n.sizeFactor||r.tubularHelices!==n.tubularHelices||r.roundCap!==n.roundCap||r.detail!==n.detail||r.linearSegments!==n.linearSegments||r.radialSegments!==n.radialSegments||r.aspectRatio!==n.aspectRatio||r.arrowFactor!==n.arrowFactor||r.helixProfile!==n.helixProfile||r.nucleicProfile!==n.nucleicProfile;let l=ol.get(a.structure).version;t.info.secondaryStructureHash!==l&&(t.info.secondaryStructureHash!==void 0&&(t.createGeometry=!0),t.info.secondaryStructureHash=l)},initUpdateState:(t,r,n,o)=>{let i=ol.get(o.structure).version;t.info.secondaryStructureHash=i}},e)}var nMe={"polymer-trace":(e,t)=>eo("Polymer trace mesh",e,t,rMe),"polymer-gap":(e,t)=>eo("Polymer gap cylinder",e,t,vP),"nucleotide-block":(e,t)=>eo("Nucleotide block mesh",e,t,Rwe),"nucleotide-ring":(e,t)=>eo("Nucleotide ring mesh",e,t,kwe),"nucleotide-atomic-ring-fill":(e,t)=>eo("Nucleotide atomic ring fill",e,t,Uwe),"nucleotide-atomic-bond":(e,t)=>eo("Nucleotide atomic bond",e,t,Nwe),"nucleotide-atomic-element":(e,t)=>eo("Nucleotide atomic element",e,t,zwe),"direction-wedge":(e,t)=>eo("Polymer direction wedge",e,t,Zwe)},oMe={...WK,...Z1,...PK,..._K,...sG,...lG,...MK,...kK,sizeFactor:C.Numeric(.2,{min:0,max:10,step:.01}),visuals:C.MultiSelect(["polymer-trace","polymer-gap","nucleotide-ring","nucleotide-atomic-ring-fill","nucleotide-atomic-bond","nucleotide-atomic-element"],C.objectToOptions(nMe)),bumpFrequency:C.Numeric(2,{min:0,max:10,step:.1},Xe.ShadingCategory),density:C.Numeric(.1,{min:0,max:1,step:.01},Xe.ShadingCategory),colorMode:C.Select("default",C.arrayToOptions(["default","interpolate"]),{...Xe.ShadingCategory,isHidden:!0})};function VCt(e,t){let r=C.clone(oMe),n=!1,o=!1;return t.units.forEach(i=>{!n&&ue.isAtomic(i)&&i.nucleotideElements.length&&(n=!0),!o&&i.gapElements.length&&(o=!0)}),r.visuals.defaultValue=["polymer-trace"],n&&r.visuals.defaultValue.push("nucleotide-ring"),o&&r.visuals.defaultValue.push("polymer-gap"),r}function OCt(e,t){return Ut.createMulti("Cartoon",e,t,qn,nMe)}var iMe={name:"cartoon",label:"Cartoon",description:"Displays ribbons, planks, tubes smoothly following the trace atoms of polymers.",factory:OCt,getParams:VCt,defaultValues:C.getDefaultValues(oMe),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"uniform"},isApplicable:e=>e.polymerResidueCount>0,ensureCustomProperties:{attach:async(e,t)=>{await ol.attach(e,t,void 0,!0);for(let r of t.models)await i3.attach(e,r,void 0,!0)},detach:e=>{ol.ref(e,!1);for(let t of e.models)i3.ref(t,!1)}}};var aMe=b.add;function GCt(e,t,r,n,o,i){let{child:a}=r,s=a?.unitMap.get(t.id);if(a&&!s)return ft.createEmpty(i);let{detail:l,sizeFactor:u}=o,{elements:c,model:m}=t,d=c.length,p=d*Nm(l),h=tt.createState(p,p/2,i),f=Em.Provider.get(m);if(!f)return ft.createEmpty(i);let g=b(),y=Mt(),x=b(),S=b(),I=b(),{elementToAnsiotrop:v,data:A}=f,{U:P}=A,T=A._schema.U.space,R=t.conformation,w=Q.Location.create(r);w.unit=t;let E=tm(r,t,o),M=b(),D=0;for(let z=0;z<d;z++){let j=c[z],Y=v[j];if(Y!==-1&&!(E&&E(c[z]))){w.element=j,R.invariantPosition(j,g),aMe(M,M,g),D+=1,h.currentGroup=z,Dr.toMat3(y,T,P.value(Y)),Mt.symmtricFromLower(y,y),Mt.symmetricEigenvalues(x,y),Mt.eigenvector(S,y,x[1]),Mt.eigenvector(I,y,x[2]);for(let G=0;G<3;++G)x[G]=u*1.5958*Math.sqrt(Math.abs(x[G]));mo(x[0],x[1],1e-6)&&mo(x[1],x[2],1e-6)?Zr(h,g,x[0],l):xb(h,g,I,S,x,l)}}let B=tt.getMesh(h);if(D===0)return B;let k;b.scale(M,M,1/D);let F=i?he.clone(i.boundingSphere):void 0;return F&&b.distance(M,F.center)/F.radius<.1?k=F:k=he.expand(he(),(s??t).boundary.sphere,1*u*2),B.setBoundingSphere(k),B}var XK={...fo,sizeFactor:C.Numeric(1,{min:0,max:10,step:.1}),detail:C.Numeric(0,{min:0,max:3,step:1},Xe.CustomQualityParamInfo),ignoreHydrogens:C.Boolean(!1),ignoreHydrogensVariant:C.Select("all",C.arrayToOptions(["all","non-polar"])),traceOnly:C.Boolean(!1)};function sMe(e){return Oo({defaultProps:C.getDefaultValues(XK),createGeometry:GCt,createLocationIterator:Ao.fromGroup,getLoci:cl,eachLocation:ul,setUpdateState:(t,r,n)=>{t.createGeometry=r.sizeFactor!==n.sizeFactor||r.detail!==n.detail||r.ignoreHydrogens!==n.ignoreHydrogens}},e)}function UCt(e,t,r,n,o){let{child:i}=t,{detail:a,sizeFactor:s}=n,{getSerialIndex:l}=t.serialMapping,c=t.elementCount*Nm(a),m=tt.createState(c,c/2,o),d=b(),p=Mt(),h=b(),f=b(),g=b(),y=b(),x=0;for(let A of t.units){let P=i?.unitMap.get(A.id);if(i&&!P)return ft.createEmpty(o);let{elements:T,model:R}=A,w=T.length,E=Em.Provider.get(R);if(!E)return ft.createEmpty(o);let M=tm(t,A,n),{elementToAnsiotrop:D,data:B}=E,{U:k}=B,F=B._schema.U.space,z=A.conformation,j=Q.Location.create(t);j.unit=A;for(let Y=0;Y<w;Y++){let G=T[Y],X=D[G];if(X!==-1&&!(M&&M(T[Y]))){j.element=G,z.position(G,d),aMe(y,y,d),x+=1,m.currentGroup=l(A,T[Y]),Dr.toMat3(p,F,k.value(X)),Mt.symmtricFromLower(p,p),Mt.symmetricEigenvalues(h,p),Mt.eigenvector(f,p,h[1]),Mt.eigenvector(g,p,h[2]);for(let U=0;U<3;++U)h[U]=s*1.5958*Math.sqrt(Math.abs(h[U]));mo(h[0],h[1],1e-6)&&mo(h[1],h[2],1e-6)?Zr(m,d,h[0],a):xb(m,d,g,f,h,a)}}}let S=tt.getMesh(m);if(x===0)return S;let I;b.scale(y,y,1/x);let v=o?he.clone(o.boundingSphere):void 0;return v&&b.distance(y,v.center)/v.radius<1?I=v:I=he.expand(he(),(i??t).boundary.sphere,1*s*2),S.setBoundingSphere(I),S}var NCt={...fc,sizeFactor:C.Numeric(1,{min:0,max:10,step:.1}),detail:C.Numeric(0,{min:0,max:3,step:1},Xe.CustomQualityParamInfo),ignoreHydrogens:C.Boolean(!1),ignoreHydrogensVariant:C.Select("all",C.arrayToOptions(["all","non-polar"])),traceOnly:C.Boolean(!1)};function lMe(e){return Ps({defaultProps:C.getDefaultValues(NCt),createGeometry:UCt,createLocationIterator:Ao.fromStructure,getLoci:Ua,eachLocation:Ga,setUpdateState:(t,r,n)=>{t.createGeometry=r.sizeFactor!==n.sizeFactor||r.detail!==n.detail||r.ignoreHydrogens!==n.ignoreHydrogens}},e)}var uMe={"ellipsoid-mesh":(e,t)=>eo("Ellipsoid Mesh",e,t,sMe),"intra-bond":(e,t)=>eo("Intra-unit bond cylinder",e,t,B4),"inter-bond":(e,t)=>po("Inter-unit bond cylinder",e,t,k4),"structure-ellipsoid-mesh":(e,t)=>po("Structure Ellipsoid Mesh",e,t,lMe),"structure-intra-bond":(e,t)=>po("Structure intra-unit bond cylinder",e,t,E4)},cMe={...XK,...qT,...YT,includeParent:C.Boolean(!1),adjustCylinderLength:C.Boolean(!1,{isHidden:!0}),unitKinds:Cb(["atomic"]),sizeFactor:C.Numeric(1,{min:.01,max:10,step:.01}),sizeAspectRatio:C.Numeric(.1,{min:.01,max:3,step:.01}),linkCap:C.Boolean(!0),visuals:C.MultiSelect(["ellipsoid-mesh","intra-bond","inter-bond"],C.objectToOptions(uMe)),bumpFrequency:C.Numeric(0,{min:0,max:10,step:.1},Xe.ShadingCategory)};function zCt(e,t){let r=cMe;return De.getSize(t)>=De.Size.Huge?(r=C.clone(r),r.visuals.defaultValue=["ellipsoid-mesh","intra-bond"]):t.unitSymmetryGroups.length>5e3&&(r=C.clone(r),r.visuals.defaultValue=["structure-ellipsoid-mesh","structure-intra-bond"]),r}function HCt(e,t){return Ut.createMulti("Ellipsoid",e,t,qn,uMe)}var mMe={name:"ellipsoid",label:"Ellipsoid",description:"Displays anisotropic displacement ellipsoids of atomic elements plus bonds as cylinders.",factory:HCt,getParams:zCt,defaultValues:C.getDefaultValues(cMe),defaultColorTheme:{name:"element-symbol"},defaultSizeTheme:{name:"uniform"},isApplicable:e=>e.elementCount>0&&e.models.some(t=>Em.Provider.isApplicable(t)),getData:(e,t)=>t.includeParent?e.asParent():e,mustRecreate:(e,t)=>e.includeParent!==t.includeParent};var dMe=`
precision highp float;

attribute vec3 aPosition;
attribute float aRadius;

varying vec3 vPosition;
varying float vRadiusSqInv;

#if defined(dCalcType_groupId)
    attribute float aGroup;
    varying float vGroup;
#endif

uniform vec3 uBboxSize;
uniform vec3 uBboxMin;
uniform float uResolution;

void main() {
    vRadiusSqInv = 1.0 / (aRadius * aRadius);
    #if defined(dCalcType_groupId)
        vGroup = aGroup;
    #endif
    gl_PointSize = ceil(((aRadius * 3.0) / uResolution) + uResolution);
    vPosition = (aPosition - uBboxMin) / uResolution;
    gl_Position = vec4(((aPosition - uBboxMin) / uBboxSize) * 2.0 - 1.0, 1.0);
}
`;var pMe=`
precision highp float;

varying vec3 vPosition;
varying float vRadiusSqInv;
#if defined(dCalcType_groupId)
    #if defined(dGridTexType_2d)
        precision highp sampler2D;
        uniform sampler2D tMinDistanceTex;
        uniform vec3 uGridTexDim;
    #elif defined(dGridTexType_3d)
        precision highp sampler3D;
        uniform sampler3D tMinDistanceTex;
    #endif
    varying float vGroup;
#endif

#include common

uniform vec3 uGridDim;
uniform vec2 uGridTexScale;
uniform float uCurrentSlice;
uniform float uCurrentX;
uniform float uCurrentY;
uniform float uAlpha;
uniform float uResolution;
uniform float uRadiusFactorInv;

void main() {
    vec2 v = gl_FragCoord.xy - vec2(uCurrentX, uCurrentY) - 0.5;
    vec3 fragPos = vec3(v.x, v.y, uCurrentSlice);
    float dist = distance(fragPos, vPosition) * uResolution;

    #if defined(dCalcType_density)
        float density = exp(-uAlpha * ((dist * dist) * vRadiusSqInv));
        gl_FragColor.a = density * uRadiusFactorInv;
    #elif defined(dCalcType_minDistance)
        gl_FragColor.a = 1.0 - dist * uRadiusFactorInv;
    #elif defined(dCalcType_groupId)
        #if defined(dGridTexType_2d)
            float minDistance = 1.0 - texture2D(tMinDistanceTex, (gl_FragCoord.xy) / (uGridTexDim.xy / uGridTexScale)).a;
        #elif defined(dGridTexType_3d)
            float minDistance = 1.0 - texelFetch(tMinDistanceTex, ivec3(gl_FragCoord.xy, uCurrentSlice), 0).a;
        #endif
        if (dist * uRadiusFactorInv > minDistance + uResolution * 0.05)
            discard;
        gl_FragColor.rgb = packIntToRGB(vGroup);
    #endif
}
`;var jCt={drawCount:Qn("number"),instanceCount:Qn("number"),aRadius:Vn("float32",1,0),aPosition:Vn("float32",3,0),aGroup:Vn("float32",1,0),uCurrentSlice:de("f"),uCurrentX:de("f"),uCurrentY:de("f"),uBboxMin:de("v3","material"),uBboxSize:de("v3","material"),uGridDim:de("v3","material"),uGridTexDim:de("v3","material"),uGridTexScale:de("v2","material"),uAlpha:de("f","material"),uResolution:de("f","material"),uRadiusFactorInv:de("f","material"),tMinDistanceTex:yt("texture","rgba","float","nearest","material"),dGridTexType:dt("string",["2d","3d"]),dCalcType:dt("string",["density","minDistance","groupId"])},fy="gaussian-density";function fMe(e){return e.namedFramebuffers[fy]||(e.namedFramebuffers[fy]=e.resources.framebuffer()),e.namedFramebuffers[fy]}function hMe(e,t,r,n,o,i){let a=`${fy}-${e}`;return t.namedTextures[a]||(t.namedTextures[a]=t.resources.texture(r,n,o,i)),t.namedTextures[a]}function QK(e,t,r,n,o,i){return e.isWebGL2?WCt(e,t,r,n,o,i):fG(e,t,r,n,!1,o,i)}function fG(e,t,r,n,o,i,a){je&&e.timer.mark("GaussianDensityTexture2d");let s=QCt(e,t,r,n,o,i,a);return je&&e.timer.markEnd("GaussianDensityTexture2d"),gMe(s)}function WCt(e,t,r,n,o,i){je&&e.timer.mark("GaussianDensityTexture3d");let a=ZCt(e,t,r,n,o,i);return je&&e.timer.markEnd("GaussianDensityTexture3d"),gMe(a)}function gMe({texture:e,scale:t,bbox:r,gridDim:n,gridTexDim:o,gridDataDim:i,gridTexScale:a,radiusFactor:s,resolution:l,maxRadius:u}){return{transform:XCt(t,r),texture:e,bbox:r,gridDim:n,gridTexDim:o,gridDataDim:i,gridTexScale:a,radiusFactor:s,resolution:l,maxRadius:u}}function XCt(e,t){let r=H.identity();return H.fromScaling(r,e),H.setTranslation(r,t.min),r}function QCt(e,t,r,n,o,i,a){let{gl:s,resources:l,state:u,extensions:{colorBufferFloat:c,textureFloat:m,colorBufferHalfFloat:d,textureHalfFloat:p,blendMinMax:h}}=e,{smoothness:f,resolution:g}=i,{drawCount:y,positions:x,radii:S,groups:I,scale:v,expandedBox:A,dim:P,maxRadius:T}=yMe(t,r,n,i),[R,w,E]=P,{texDimX:M,texDimY:D,texCols:B,powerOfTwoSize:k}=YCt(P),F=b.create(M,D,0),z=Ce.create(M/k,D/k),j=T*2,Y=o?k:M,G=o?k:D,X=hMe("min-dist-2d",e,"image-uint8","rgba","ubyte","nearest");X.define(Y,G);let U=bMe(e,y,x,S,I,X,A,P,F,z,f,g,j),{uCurrentSlice:L,uCurrentX:q,uCurrentY:te}=U.values,J=fMe(e);J.bind(),xMe(e),a||(a=d&&p?l.texture("image-float16","rgba","fp16","linear"):c&&m?l.texture("image-float32","rgba","float","linear"):l.texture("image-uint8","rgba","ubyte","linear")),a.define(Y,G);function ee(ce,fe){u.currentRenderItemId=-1,ce.attachFramebuffer(J,0),fe&&(u.viewport(0,0,Y,G),u.scissor(0,0,Y,G),s.clear(s.COLOR_BUFFER_BIT)),_.update(te,0);let O=0,V=0,Z=0;for(let pe=0;pe<E;++pe)O>=B&&(O-=B,V+=w,Z=0,_.update(te,V)),_.update(q,Z),_.update(L,pe),u.viewport(Z,V,R,w),u.scissor(Z,V,R,w),U.render(),++O,Z+=R;s.flush()}return SMe(e,U),ee(a,!0),h&&(CMe(e,U),ee(X,!0),vMe(e,U),ee(a,!1)),{texture:a,scale:v,bbox:A,gridDim:P,gridTexDim:F,gridDataDim:P,gridTexScale:z,radiusFactor:j,resolution:g,maxRadius:T}}function ZCt(e,t,r,n,o,i){let{gl:a,resources:s,state:l,extensions:{colorBufferFloat:u,textureFloat:c,colorBufferHalfFloat:m,textureHalfFloat:d}}=e,{smoothness:p,resolution:h}=o,{drawCount:f,positions:g,radii:y,groups:x,scale:S,expandedBox:I,dim:v,maxRadius:A}=yMe(t,r,n,o),[P,T,R]=v,w=hMe("min-dist-3d",e,"volume-uint8","rgba","ubyte","nearest");w.define(P,T,R);let E=Ce.create(1,1),M=A*2,D=bMe(e,f,g,y,x,w,I,v,v,E,p,h,M),{uCurrentSlice:B}=D.values,k=fMe(e);k.bind(),xMe(e),l.viewport(0,0,P,T),l.scissor(0,0,P,T),i||(i=m&&d?s.texture("volume-float16","rgba","fp16","linear"):u&&c?s.texture("volume-float32","rgba","float","linear"):s.texture("volume-uint8","rgba","ubyte","linear")),i.define(P,T,R);function F(z,j){l.currentRenderItemId=-1;for(let Y=0;Y<R;++Y)_.update(B,Y),z.attachFramebuffer(k,0,Y),j&&a.clear(a.COLOR_BUFFER_BIT),D.render();a.flush()}return SMe(e,D),F(i,!0),CMe(e,D),F(w,!0),vMe(e,D),F(i,!1),{texture:i,scale:S,bbox:I,gridDim:v,gridTexDim:v,gridDataDim:v,gridTexScale:E,radiusFactor:M,resolution:h,maxRadius:A}}function yMe(e,t,r,n){let{resolution:o,radiusOffset:i}=n,a=1/o,{indices:s,x:l,y:u,z:c,id:m}=e,d=xe.size(s),p=new Float32Array(d*3),h=new Float32Array(d),f=new Float32Array(d),g=0;for(let A=0;A<d;++A){let P=xe.getAt(s,A);p[A*3]=l[P],p[A*3+1]=u[P],p[A*3+2]=c[P];let T=r(P)+i;g<T&&(g=T),h[A]=T,f[A]=m?m[A]:A}let y=g*2+o*4,x=pt.expand(pt(),t,b.create(y,y,y)),S=pt.scale(pt(),x,a),I=pt.size(b(),S);b.ceil(I,I);let v=b.create(o,o,o);return{drawCount:d,positions:p,radii:h,groups:f,scale:v,expandedBox:x,dim:I,maxRadius:g}}function bMe(e,t,r,n,o,i,a,s,l,u,c,m,d){if(e.namedComputeRenderables[fy]){let p=b.sub(b(),a.max,a.min),h=e.namedComputeRenderables[fy].values;_.updateIfChanged(h.drawCount,t),_.updateIfChanged(h.instanceCount,1),_.update(h.aRadius,n),_.update(h.aPosition,r),_.update(h.aGroup,o),_.updateIfChanged(h.uCurrentSlice,0),_.updateIfChanged(h.uCurrentX,0),_.updateIfChanged(h.uCurrentY,0),_.update(h.uBboxMin,a.min),_.update(h.uBboxSize,p),_.update(h.uGridDim,s),_.update(h.uGridTexDim,l),_.update(h.uGridTexScale,u),_.updateIfChanged(h.uAlpha,c),_.updateIfChanged(h.uResolution,m),_.updateIfChanged(h.uRadiusFactorInv,1/d),_.update(h.tMinDistanceTex,i),_.updateIfChanged(h.dGridTexType,i.getDepth()>0?"3d":"2d"),_.updateIfChanged(h.dCalcType,"density"),e.namedComputeRenderables[fy].update()}else e.namedComputeRenderables[fy]=qCt(e,t,r,n,o,i,a,s,l,u,c,m,d);return e.namedComputeRenderables[fy]}function qCt(e,t,r,n,o,i,a,s,l,u,c,m,d){let p=b.sub(b(),a.max,a.min),h={drawCount:_.create(t),instanceCount:_.create(1),aRadius:_.create(n),aPosition:_.create(r),aGroup:_.create(o),uCurrentSlice:_.create(0),uCurrentX:_.create(0),uCurrentY:_.create(0),uBboxMin:_.create(a.min),uBboxSize:_.create(p),uGridDim:_.create(s),uGridTexDim:_.create(l),uGridTexScale:_.create(u),uAlpha:_.create(c),uResolution:_.create(m),uRadiusFactorInv:_.create(1/d),tMinDistanceTex:_.create(i),dGridTexType:_.create(i.getDepth()>0?"3d":"2d"),dCalcType:_.create("density")},f={...jCt},g=zr(fy,dMe,pMe),y=on(e,"points",g,f,h);return an(y,h)}function xMe(e){let{gl:t,state:r}=e;r.disable(t.CULL_FACE),r.enable(t.BLEND),r.disable(t.DEPTH_TEST),r.enable(t.SCISSOR_TEST),r.depthMask(!1),r.clearColor(0,0,0,0)}function CMe(e,t){let{gl:r,state:n}=e;if(_.update(t.values.dCalcType,"minDistance"),t.update(),n.colorMask(!1,!1,!1,!0),n.blendFunc(r.ONE,r.ONE),!e.extensions.blendMinMax)throw new Error("GPU gaussian surface calculation requires EXT_blend_minmax");n.blendEquation(e.extensions.blendMinMax.MAX)}function SMe(e,t){let{gl:r,state:n}=e;_.update(t.values.dCalcType,"density"),t.update(),n.colorMask(!1,!1,!1,!0),n.blendFunc(r.ONE,r.ONE),n.blendEquation(r.FUNC_ADD)}function vMe(e,t){let{gl:r,state:n}=e;_.update(t.values.dCalcType,"groupId"),t.update(),n.colorMask(!0,!0,!0,!1),n.blendFunc(r.ONE,r.ZERO),n.blendEquation(r.FUNC_ADD)}function YCt(e){let t=e[0]*e[1]*e[2],r=Math.sqrt(t),n=Math.pow(2,Math.ceil(Math.log(r)/Math.log(2))),o=0,i=e[1],a=1,s=e[2];return n<e[0]*e[2]?(s=Math.floor(n/e[0]),a=Math.ceil(e[2]/s),o=s*e[0],i*=a):o=e[0]*e[2],{texDimX:o,texDimY:i,texRows:a,texCols:s,powerOfTwoSize:i<n?n:n*2}}async function ZK(e,t,r,n,o){let{resolution:i,radiusOffset:a,smoothness:s}=o,l=1/i,{indices:u,x:c,y:m,z:d,id:p}=t,h=xe.size(u),f=new Float32Array(h),g=0;for(let J=0;J<h;++J){let ee=n(xe.getAt(u,J))+a;g<ee&&(g=ee),f[J]=ee}let y=g*2+i,x=pt.expand(pt(),r,b.create(y,y,y)),S=x.min,I=pt.scale(pt(),x,l),v=pt.size(b(),I);b.ceil(v,v);let A=Dr.Space(v,[0,1,2],Float32Array),P=A.create(),T=Dr.create(A,P),R=A.create();R.fill(-1);let w=Dr.create(A,R),[E,M,D]=v,B=D,k=M,F=B*k,z=tC(v[0],S[0],i),j=tC(v[1],S[1],i),Y=tC(v[2],S[2],i),G=A.create(),X=s,U=Math.ceil(1e5/(Math.pow(Math.pow(g,3),3)*l));function L(J,ee){for(let ce=J;ce<ee;++ce){let fe=xe.getAt(u,ce),O=c[fe],V=m[fe],Z=d[fe],pe=f[ce],ae=1/(pe*pe),Se=pe*2,ve=Se*Se,K=Math.ceil(Se*l),re=Math.floor(l*(O-S[0])),le=Math.floor(l*(V-S[1])),ge=Math.floor(l*(Z-S[2])),Ee=Math.max(0,re-K),nt=Math.max(0,le-K),at=Math.max(0,ge-K),be=Math.min(E,re+K+2),Re=Math.min(M,le+K+2),Fe=Math.min(D,ge+K+2);for(let Ne=Ee;Ne<be;++Ne){let ot=z[Ne]-O,it=Ne*F;for(let Xt=nt;Xt<Re;++Xt){let $r=j[Xt]-V,bt=ot*ot+$r*$r,xr=Xt*B+it;for(let tn=at;tn<Fe;++tn){let pn=Y[tn]-Z,io=bt+pn*pn;if(io<=ve){let Hn=dAe(-X*(io*ae)),Zi=tn+xr;P[Zi]+=Hn,Hn>G[Zi]&&(G[Zi]=Hn,R[Zi]=p?p[ce]:ce)}}}}}}async function q(){for(let J=0;J<h;J+=U)L(J,Math.min(J+U,h)),e.shouldUpdate&&await e.update({message:"filling density grid",current:J,max:h})}await q();let te=H.identity();return H.fromScaling(te,b.create(i,i,i)),H.setTranslation(te,x.min),{field:T,idField:w,transform:te,radiusFactor:1,resolution:i,maxRadius:g}}var A0={resolution:C.Numeric(1,{min:.1,max:20,step:.1},{description:"Grid resolution/cell spacing.",...Xe.CustomQualityParamInfo}),radiusOffset:C.Numeric(0,{min:0,max:10,step:.1},{description:"Extra/offset radius added to the atoms/coarse elements for gaussian calculation. Useful to create coarse, low resolution surfaces."}),smoothness:C.Numeric(1.5,{min:.5,max:2.5,step:.1},{description:"Smoothness of the gausian surface, lower is smoother."}),...l1},iUn=C.getDefaultValues(A0);function IMe(e,t){let r=e.maxTextureSize/3;return r*r/Math.max(1,t?t.units.length/16:1)}function hG(e,t,r,n){let{position:o,boundary:i,radius:a}=LA(e,t,r,n),s=Eg(i.box,n);return Ae.create("Gaussian Density",async l=>await ZK(l,o,i.box,a,s))}function AMe(e,t,r,n,o,i){let{position:a,boundary:s,radius:l}=LA(e,t,r,n),u=Eg(s.box,n,IMe(o,e));return QK(o,a,s.box,l,u,i)}function TMe(e,t,r,n,o,i,a){let{position:s,boundary:l,radius:u}=LA(e,t,r,o),c=Eg(l.box,o,IMe(i,e));return fG(i,s,l.box,u,n,c,a)}function PMe(e,t,r){let{position:n,boundary:o,radius:i}=VA(e,t,r),a=Eg(o.box,r);return Ae.create("Gaussian Density",async s=>await ZK(s,n,o.box,i,a))}function _Me(e,t,r,n,o){let{position:i,boundary:a,radius:s}=VA(e,t,r),l=Eg(a.box,r);return QK(n,i,a.box,s,l,o)}function RMe(e,t,r,n,o,i){let{box:a}=e.lookup3d.boundary,{position:s,boundary:l,radius:u}=VA(e,t,n),c=Eg(l.box,n);return fG(o,s,a,u,r,c,i)}var DMe={...A0,...Hk,ignoreHydrogens:C.Boolean(!1),ignoreHydrogensVariant:C.Select("all",C.arrayToOptions(["all","non-polar"])),tryUseGpu:C.Boolean(!0),includeParent:C.Boolean(!1,{isHidden:!0})},gG={...fo,...Nve,...DMe},wMe={...fc,...Bve,...DMe};function MMe(e){return e.extensions.colorBufferFloat&&e.extensions.textureFloat&&e.extensions.textureFloatLinear&&e.extensions.blendMinMax&&e.extensions.drawBuffers}function RP(e,t,r){if(t.resolution>1)return!1;let n=r.maxTextureSize/3,{areaCells:o,maxAreaCells:i}=uX(e.boundary.box,t.resolution,n*n);return o<i}function BMe(e,t,r,n){return r.tryUseGpu&&n&&MMe(n)&&RP(t,r,n)?r0t(e):JCt(e)}function EMe(e,t,r,n){return r.tryUseGpu&&n&&MMe(n)&&RP(t,r,n)?o0t(e):e0t(e)}async function KCt(e,t,r,n,o,i){let{smoothness:a}=o,{transform:s,field:l,idField:u,radiusFactor:c,resolution:m,maxRadius:d}=await hG(r,t,n.size,o).runInContext(e.runtime),p={isoLevel:Math.exp(-a)/c,scalarField:l,idField:u},h=await ty(p,i).runAsChild(e.runtime);h.meta.resolution=m,ft.transform(h,s),e.webgl&&!e.webgl.isWebGL2?(ft.uniformTriangleGroup(h),_.updateIfChanged(h.varyingGroup,!1)):_.updateIfChanged(h.varyingGroup,!0);let f=he.expand(he(),t.boundary.sphere,d);return h.setBoundingSphere(f),h}function JCt(e){return Oo({defaultProps:C.getDefaultValues(gG),createGeometry:KCt,createLocationIterator:Ao.fromGroup,getLoci:cl,eachLocation:ul,setUpdateState:(t,r,n)=>{r.resolution!==n.resolution&&(t.createGeometry=!0),r.radiusOffset!==n.radiusOffset&&(t.createGeometry=!0),r.smoothness!==n.smoothness&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0),r.smoothColors.name!==n.smoothColors.name?t.updateColor=!0:r.smoothColors.name==="on"&&n.smoothColors.name==="on"&&(r.smoothColors.params.resolutionFactor!==n.smoothColors.params.resolutionFactor&&(t.updateColor=!0),r.smoothColors.params.sampleStride!==n.smoothColors.params.sampleStride&&(t.updateColor=!0))},mustRecreate:(t,r,n)=>r.tryUseGpu&&!!n&&RP(t.structure,r,n),processValues:(t,r,n,o,i)=>{let{resolution:a,colorTexture:s}=r.meta,l=Ou(n.smoothColors,o.color.preferSmoothing,a);l&&(vA(t,l.resolution,l.stride,i,s),r.meta.colorTexture=t.tColorGrid.ref.value)},dispose:t=>{t.meta.colorTexture?.destroy()}},e)}async function $Ct(e,t,r,n,o){let{smoothness:i}=n,{transform:a,field:s,idField:l,radiusFactor:u,resolution:c,maxRadius:m}=await PMe(t,r.size,n).runInContext(e.runtime),d={isoLevel:Math.exp(-i)/u,scalarField:s,idField:l},p=await ty(d,o).runAsChild(e.runtime);p.meta.resolution=c,ft.transform(p,a),e.webgl&&!e.webgl.isWebGL2?(ft.uniformTriangleGroup(p),_.updateIfChanged(p.varyingGroup,!1)):_.updateIfChanged(p.varyingGroup,!0);let h=he.expand(he(),t.boundary.sphere,m);return p.setBoundingSphere(h),p}function e0t(e){return Ps({defaultProps:C.getDefaultValues(wMe),createGeometry:$Ct,createLocationIterator:Ao.fromStructure,getLoci:Ua,eachLocation:Ga,setUpdateState:(t,r,n)=>{r.resolution!==n.resolution&&(t.createGeometry=!0),r.radiusOffset!==n.radiusOffset&&(t.createGeometry=!0),r.smoothness!==n.smoothness&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.smoothColors.name!==n.smoothColors.name?t.updateColor=!0:r.smoothColors.name==="on"&&n.smoothColors.name==="on"&&(r.smoothColors.params.resolutionFactor!==n.smoothColors.params.resolutionFactor&&(t.updateColor=!0),r.smoothColors.params.sampleStride!==n.smoothColors.params.sampleStride&&(t.updateColor=!0))},mustRecreate:(t,r,n)=>r.tryUseGpu&&!!n&&RP(t,r,n),processValues:(t,r,n,o,i)=>{let{resolution:a,colorTexture:s}=r.meta,l=Ou(n.smoothColors,o.color.preferSmoothing,a);l&&(vA(t,l.resolution,l.stride,i,s),r.meta.colorTexture=t.tColorGrid.ref.value)},dispose:t=>{t.meta.colorTexture?.destroy()}},e)}var _P="gaussian-surface";function t0t(e,t,r,n,o,i){let{webgl:a}=e;if(!a)throw new Error("webgl context required to create gaussian surface texture-mesh");let{namedTextures:s,resources:l,extensions:{colorBufferFloat:u,textureFloat:c,colorBufferHalfFloat:m,textureHalfFloat:d}}=a;s[_P]||(s[_P]=m&&d?l.texture("image-float16","rgba","fp16","linear"):u&&c?l.texture("image-float32","rgba","float","linear"):l.texture("image-uint8","rgba","ubyte","linear"));let p=b.create(0,1,2),h=t.elements.length,f=y=>{je&&a.timer.mark("createGaussianSurfaceTextureMesh");let x=TMe(r,t,n.size,!0,o,a,s[_P]),S=Math.exp(-o.smoothness)/x.radiusFactor,I=y?.doubleBuffer.get(),v=L1(a,x.texture,x.gridDim,x.gridTexDim,x.gridDataDim,x.gridTexScale,x.transform,S,!1,!0,p,!0,I?.vertex,I?.group,I?.normal);je&&a.timer.markEnd("createGaussianSurfaceTextureMesh");let A=he.expand(he(),t.boundary.sphere,x.maxRadius),P=Ss.create(v.vertexCount,h,v.vertexTexture,v.groupTexture,v.normalTexture,A,y);return P.meta.resolution=x.resolution,P},g=f(i);return g.meta.webgl=a,g.meta.reset=()=>{f(g)},g}function r0t(e){return zve({defaultProps:C.getDefaultValues(gG),createGeometry:t0t,createLocationIterator:Ao.fromGroup,getLoci:cl,eachLocation:ul,setUpdateState:(t,r,n)=>{r.resolution!==n.resolution&&(t.createGeometry=!0),r.radiusOffset!==n.radiusOffset&&(t.createGeometry=!0),r.smoothness!==n.smoothness&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0),r.smoothColors.name!==n.smoothColors.name?t.updateColor=!0:r.smoothColors.name==="on"&&n.smoothColors.name==="on"&&(r.smoothColors.params.resolutionFactor!==n.smoothColors.params.resolutionFactor&&(t.updateColor=!0),r.smoothColors.params.sampleStride!==n.smoothColors.params.sampleStride&&(t.updateColor=!0))},mustRecreate:(t,r,n)=>!r.tryUseGpu||!n||!RP(t.structure,r,n),processValues:(t,r,n,o,i)=>{let{resolution:a,colorTexture:s}=r.meta,l=Ou(n.smoothColors,o.color.preferSmoothing,a);l&&i&&(VW(t,l.resolution,l.stride,i,s),r.meta.colorTexture=t.tColorGrid.ref.value)},dispose:t=>{t.vertexTexture.ref.value.destroy(),t.groupTexture.ref.value.destroy(),t.normalTexture.ref.value.destroy(),t.doubleBuffer.destroy(),t.meta.colorTexture?.destroy()}},e)}function n0t(e,t,r,n,o){let{webgl:i}=e;if(!i)throw new Error("webgl context required to create structure gaussian surface texture-mesh");let{namedTextures:a,resources:s,extensions:{colorBufferFloat:l,textureFloat:u,colorBufferHalfFloat:c,textureHalfFloat:m}}=i;a[_P]||(a[_P]=c&&m?s.texture("image-float16","rgba","fp16","linear"):l&&u?s.texture("image-float32","rgba","float","linear"):s.texture("image-uint8","rgba","ubyte","linear"));let d=b.create(0,1,2),p=t.elementCount,h=g=>{je&&i.timer.mark("createStructureGaussianSurfaceTextureMesh");let y=RMe(t,r.size,!0,n,i,a[_P]),x=Math.exp(-n.smoothness)/y.radiusFactor,S=g?.doubleBuffer.get(),I=L1(i,y.texture,y.gridDim,y.gridTexDim,y.gridDataDim,y.gridTexScale,y.transform,x,!1,!0,d,!0,S?.vertex,S?.group,S?.normal);je&&i.timer.markEnd("createStructureGaussianSurfaceTextureMesh");let v=he.expand(he(),t.boundary.sphere,y.maxRadius),A=Ss.create(I.vertexCount,p,I.vertexTexture,I.groupTexture,I.normalTexture,v,g);return A.meta.resolution=y.resolution,A},f=h(o);return f.meta.webgl=i,f.meta.reset=()=>{h(f)},f}function o0t(e){return Eve({defaultProps:C.getDefaultValues(wMe),createGeometry:n0t,createLocationIterator:Ao.fromStructure,getLoci:Ua,eachLocation:Ga,setUpdateState:(t,r,n)=>{r.resolution!==n.resolution&&(t.createGeometry=!0),r.radiusOffset!==n.radiusOffset&&(t.createGeometry=!0),r.smoothness!==n.smoothness&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0),r.smoothColors.name!==n.smoothColors.name?t.updateColor=!0:r.smoothColors.name==="on"&&n.smoothColors.name==="on"&&(r.smoothColors.params.resolutionFactor!==n.smoothColors.params.resolutionFactor&&(t.updateColor=!0),r.smoothColors.params.sampleStride!==n.smoothColors.params.sampleStride&&(t.updateColor=!0))},mustRecreate:(t,r,n)=>!r.tryUseGpu||!n||!RP(t,r,n),processValues:(t,r,n,o,i)=>{let{resolution:a,colorTexture:s}=r.meta,l=Ou(n.smoothColors,o.color.preferSmoothing,a);l&&i&&(VW(t,l.resolution,l.stride,i,s),r.meta.colorTexture=t.tColorGrid.ref.value)},dispose:t=>{t.vertexTexture.ref.value.destroy(),t.groupTexture.ref.value.destroy(),t.normalTexture.ref.value.destroy(),t.doubleBuffer.destroy(),t.meta.colorTexture?.destroy()}},e)}async function i0t(e,t,r,n,o,i){let{smoothness:a}=o,{transform:s,field:l,idField:u,maxRadius:c}=await hG(r,t,n.size,o).runInContext(e.runtime),m={isoLevel:Math.exp(-a),scalarField:l,idField:u},d=await VT(m,i).runAsChild(e.runtime);Cn.transform(d,s);let p=he.expand(he(),t.boundary.sphere,c);return d.setBoundingSphere(p),d}var qK={...VC,...A0,sizeFactor:C.Numeric(3,{min:0,max:10,step:.1}),lineSizeAttenuation:C.Boolean(!1),ignoreHydrogens:C.Boolean(!1),ignoreHydrogensVariant:C.Select("all",C.arrayToOptions(["all","non-polar"])),includeParent:C.Boolean(!1,{isHidden:!0})};function kMe(e){return OC({defaultProps:C.getDefaultValues(qK),createGeometry:i0t,createLocationIterator:Ao.fromGroup,getLoci:cl,eachLocation:ul,setUpdateState:(t,r,n)=>{r.resolution!==n.resolution&&(t.createGeometry=!0),r.radiusOffset!==n.radiusOffset&&(t.createGeometry=!0),r.smoothness!==n.smoothness&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0)}},e)}var FMe={"gaussian-surface-mesh":(e,t)=>eo("Gaussian surface mesh",e,t,BMe),"structure-gaussian-surface-mesh":(e,t)=>po("Structure-Gaussian surface mesh",e,t,EMe),"gaussian-surface-wireframe":(e,t)=>eo("Gaussian surface wireframe",e,t,kMe)},LMe={...gG,...qK,visuals:C.MultiSelect(["gaussian-surface-mesh"],C.objectToOptions(FMe)),bumpFrequency:C.Numeric(1,{min:0,max:10,step:.1},Xe.ShadingCategory),density:C.Numeric(.5,{min:0,max:1,step:.01},Xe.ShadingCategory)};function a0t(e,t){return LMe}function s0t(e,t){return Ut.createMulti("Gaussian Surface",e,t,qn,FMe)}var VMe={name:"gaussian-surface",label:"Gaussian Surface",description:"Displays a gaussian molecular surface.",factory:s0t,getParams:a0t,defaultValues:C.getDefaultValues(LMe),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"physical"},isApplicable:e=>e.elementCount>0};var OMe={"label-text":(e,t)=>po("Label text",e,t,Qve)},GMe={...Sb,visuals:C.MultiSelect(["label-text"],C.objectToOptions(OMe))};function l0t(e,t){return GMe}function u0t(e,t){let r=Ut.createMulti("Label",e,t,qn,OMe);return r.setState({pickable:!1,markerActions:0}),r}var UMe={name:"label",label:"Label",description:"Displays labels.",factory:u0t,getParams:l0t,defaultValues:C.getDefaultValues(GMe),defaultColorTheme:{name:"uniform"},defaultSizeTheme:{name:"physical"},isApplicable:e=>e.elementCount>0};function c0t(e,t){return e[0]=e[1]=e[2]=1,t[0]!==0?e[0]=(t[1]+t[2])/-t[0]:t[1]!==0?e[1]=(t[0]+t[2])/-t[1]:t[2]!==0&&(e[2]=(t[0]+t[1])/-t[2]),e}function m0t(e){let t=0,r=2*Math.PI/e,n=new Float32Array(e),o=new Float32Array(e);for(let i=0;i<e;i++)n[i]=Math.cos(t),o[i]=Math.sin(t),t+=r;return{cosTable:n,sinTable:o}}var d3={probeRadius:C.Numeric(1.4,{min:0,max:10,step:.1},{description:"Radius of the probe tracing the molecular surface."}),resolution:C.Numeric(.5,{min:.01,max:20,step:.01},{description:"Grid resolution/cell spacing."}),probePositions:C.Numeric(36,{min:12,max:90,step:1},{description:"Number of positions tested for probe target intersection."})},hNn=C.getDefaultValues(d3);async function NMe(e,t,r,n,o,i){let a=-1;function s(nt,at,be,Re,Fe){if(a!==-1){let Ne=a;if(Ne!==Re&&Ne!==Fe&&l(Ne,nt,at,be))return Ne;a=-1}for(let Ne=0,ot=w.count;Ne<ot;++Ne){let it=xe.getAt(E,w.indices[Ne]);if(it!==Re&&it!==Fe&&l(it,nt,at,be))return a=it,it}return-1}function l(nt,at,be,Re){let Fe=F[nt],Ne=M[nt]-at,ot=D[nt]-be,it=B[nt]-Re;return Ne*Ne+ot*ot+it*it<Fe*Fe}function u(nt,at){for(let be=nt;be<at;++be){let Re=xe.getAt(E,be),Fe=M[Re],Ne=D[Re],ot=B[Re],it=F[Re],Xt=it*it,$r=P>0;R.find(Fe,Ne,ot,it);let bt=Math.ceil(it*v)+P,xr=Math.floor(v*(Fe-G)),tn=Math.floor(v*(Ne-X)),pn=Math.floor(v*(ot-U)),io=Math.max(0,xr-bt),Hn=Math.max(0,tn-bt),Zi=Math.max(0,pn-bt),mm=Math.min(te,xr+bt+2),ao=Math.min(J,tn+bt+2),N=Math.min(ee,pn+bt+2);for(let oe=io;oe<mm;++oe){let Ve=Se[oe]-Fe,$e=oe*O;for(let ct=Hn;ct<ao;++ct){let vt=ve[ct]-Ne,Pt=Ve*Ve+vt*vt,Ot=ct*ce+$e;for(let Ft=Zi;Ft<N;++Ft){let Dt=K[Ft]-ot,wt=Pt+Dt*Dt;if($r||wt<Xt){let Nt=Ft+Ot,Zt=Math.sqrt(wt),zt=it/Zt,hr=Ve*zt+Fe,ar=vt*zt+Ne,fr=Dt*zt+ot,me=s(hr,ar,fr,Re,-1);if(wt<Xt){if($[Nt]<0&&($[Nt]*=-1),me===-1){let Ie=it-Zt;Ie<$[Nt]&&($[Nt]=Ie,ae[Nt]=k[be])}}else if($r&&me===-1){let Ie=it-Zt;Ie>$[Nt]&&($[Nt]=Ie)}}}}}}}async function c(){for(let nt=0;nt<z;nt+=re)u(nt,Math.min(nt+re,z)),e.shouldUpdate&&await e.update({message:"projecting points",current:nt,max:z})}let m=b(),d=b(),p=b(),h=b();function f(nt,at){let be=F[nt],Re=F[at],Fe=m[0]=M[at]-M[nt],Ne=m[1]=D[at]-D[nt],ot=m[2]=B[at]-B[nt],it=Fe*Fe+Ne*Ne+ot*ot,Xt=Math.sqrt(it),$r=(be*be+Xt*Xt-Re*Re)/(2*be*Xt),bt=be*$r;b.normalize(m,m),c0t(p,m),b.normalize(p,p),b.cross(h,m,p),b.normalize(h,h);let xr=Math.sqrt(be*be-bt*bt);b.scale(p,p,xr),b.scale(h,h,xr),b.scale(m,m,bt),d[0]=m[0]+M[nt],d[1]=m[1]+D[nt],d[2]=m[2]+B[nt],a=-1;for(let tn=0;tn<I;++tn){let pn=V[tn],io=Z[tn],Hn=d[0]+pn*p[0]+io*h[0],Zi=d[1]+pn*p[1]+io*h[1],mm=d[2]+pn*p[2]+io*h[2];if(s(Hn,Zi,mm,nt,at)===-1){let ao=Math.floor(v*(Hn-G)),N=Math.floor(v*(Zi-X)),oe=Math.floor(v*(mm-U)),Ve=Math.max(0,ao-A),$e=Math.max(0,N-A),ct=Math.max(0,oe-A),vt=Math.min(te,ao+A+2),Pt=Math.min(J,N+A+2),Ot=Math.min(ee,oe+A+2);for(let Ft=Ve;Ft<vt;++Ft){let Dt=Hn-Se[Ft],wt=Ft*O;for(let Nt=$e;Nt<Pt;++Nt){let Zt=Zi-ve[Nt],zt=Dt*Dt+Zt*Zt,hr=Nt*ce+wt;for(let ar=ct;ar<Ot;++ar){let fr=mm-K[ar],me=zt+fr*fr,Ie=ar+hr,Pe=$[Ie];if(Pe>0&&me<Pe*Pe){$[Ie]=Math.sqrt(me);let _e=Dt*m[0]+Zt*m[1]+fr*m[2];ae[Ie]=k[xe.indexOf(E,_e<0?at:nt)]}}}}}}}function g(nt,at){for(let be=nt;be<at;++be){let Re=xe.getAt(E,be);R.find(M[Re],D[Re],B[Re],F[Re]);for(let Fe=0,Ne=w.count;Fe<Ne;++Fe){let ot=xe.getAt(E,w.indices[Fe]);Re<ot&&f(Re,ot)}}}async function y(){for(let nt=0;nt<z;nt+=re)g(nt,Math.min(nt+re,z)),e.shouldUpdate&&await e.update({message:"projecting torii",current:nt,max:z})}let{resolution:x,probeRadius:S,probePositions:I}=i,v=1/x,A=2+Math.floor(S*v),P=S<x*2?1:0,T=b.create(n,n,n);b.scale(T,T,2);let R=zc(t,r,T),w=R.result;o===null&&(o=R.boundary.box);let{indices:E,x:M,y:D,z:B,id:k,radius:F}=t,z=xe.size(E),j=n+x,Y=pt.expand(pt(),o,b.create(j,j,j)),[G,X,U]=Y.min,L=pt.scale(pt(),Y,v),q=pt.size(b(),L);b.ceil(q,q);let[te,J,ee]=q,ce=ee,fe=J,O=ce*fe,{cosTable:V,sinTable:Z}=m0t(I),pe=Dr.Space(q,[0,1,2],Float32Array),$=pe.create(),ae=pe.create();$.fill(-1001),ae.fill(-1);let Se=tC(te,G,x),ve=tC(J,X,x),K=tC(ee,U,x),re=Math.ceil(1e5/(Math.pow(Math.pow(n,3),3)*v));await c(),await y();let le=Dr.create(pe,$),ge=Dr.create(pe,ae),Ee=H.identity();return H.fromScaling(Ee,b.create(x,x,x)),H.setTranslation(Ee,Y.min),{field:le,idField:ge,transform:Ee,resolution:x,maxRadius:n}}var yG={...d3,resolution:{...d3.resolution,...Xe.CustomQualityParamInfo},probePositions:{...d3.probePositions,...Xe.CustomQualityParamInfo}};function d0t(e,t,r,n){let{probeRadius:o}=n,{position:i,boundary:a,radius:s}=LA(e,t,r,n),{indices:l}=i,u=xe.size(l),c=new Float32Array(xe.end(l)),m=0;for(let d=0;d<u;++d){let p=xe.getAt(l,d),h=s(p);m<h&&(m=h),c[p]=h+o}return{position:{...i,radius:c},boundary:a,maxRadius:m}}function bG(e,t,r,n){let{position:o,boundary:i,maxRadius:a}=d0t(e,t,r,n),s=Eg(i.box,n);return Ae.create("Molecular Surface",async l=>await HMe(l,o,i,a,i.box,s))}function p0t(e,t,r){let{probeRadius:n}=r,{position:o,boundary:i,radius:a}=VA(e,t,r),{indices:s}=o,l=xe.size(s),u=new Float32Array(xe.end(s)),c=0;for(let m=0;m<l;++m){let d=xe.getAt(s,m),p=a(d);c<p&&(c=p),u[d]=p+n}return{position:{...o,radius:u},boundary:i,maxRadius:c}}function zMe(e,t,r){let{position:n,boundary:o,maxRadius:i}=p0t(e,t,r),a=Eg(o.box,r);return Ae.create("Molecular Surface",async s=>await HMe(s,n,o,i,o.box,a))}async function HMe(e,t,r,n,o,i){return NMe(e,t,r,n,o,i)}var xG={...fo,...yG,...l1,...Hk};async function f0t(e,t,r,n,o,i){let{transform:a,field:s,idField:l,resolution:u,maxRadius:c}=await bG(r,t,n.size,o).runInContext(e.runtime),m={isoLevel:o.probeRadius,scalarField:s,idField:l},d=await ty(m,i).runAsChild(e.runtime);if(o.includeParent){let h=Math.ceil(2/o.resolution);ft.smoothEdges(d,{iterations:h,maxNewEdgeLength:Math.sqrt(2)})}ft.transform(d,a),e.webgl&&!e.webgl.isWebGL2?(ft.uniformTriangleGroup(d),_.updateIfChanged(d.varyingGroup,!1)):_.updateIfChanged(d.varyingGroup,!0);let p=he.expand(he(),t.boundary.sphere,c);return d.setBoundingSphere(p),d.meta.resolution=u,d}function jMe(e){return Oo({defaultProps:C.getDefaultValues(xG),createGeometry:f0t,createLocationIterator:Ao.fromGroup,getLoci:cl,eachLocation:ul,setUpdateState:(t,r,n)=>{r.resolution!==n.resolution&&(t.createGeometry=!0),r.probeRadius!==n.probeRadius&&(t.createGeometry=!0),r.probePositions!==n.probePositions&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0),r.smoothColors.name!==n.smoothColors.name?t.updateColor=!0:r.smoothColors.name==="on"&&n.smoothColors.name==="on"&&(r.smoothColors.params.resolutionFactor!==n.smoothColors.params.resolutionFactor&&(t.updateColor=!0),r.smoothColors.params.sampleStride!==n.smoothColors.params.sampleStride&&(t.updateColor=!0))},processValues:(t,r,n,o,i)=>{let{resolution:a,colorTexture:s}=r.meta,l=Ou(n.smoothColors,o.color.preferSmoothing,a);l&&(vA(t,l.resolution,l.stride,i,s),r.meta.colorTexture=t.tColorGrid.ref.value)},dispose:t=>{t.meta.colorTexture?.destroy()}},e)}async function h0t(e,t,r,n,o){let{transform:i,field:a,idField:s,resolution:l,maxRadius:u}=await zMe(t,r.size,n).runInContext(e.runtime),c={isoLevel:n.probeRadius,scalarField:a,idField:s},m=await ty(c,o).runAsChild(e.runtime);if(n.includeParent){let p=Math.ceil(2/n.resolution);ft.smoothEdges(m,{iterations:p,maxNewEdgeLength:Math.sqrt(2)})}ft.transform(m,i),e.webgl&&!e.webgl.isWebGL2?(ft.uniformTriangleGroup(m),_.updateIfChanged(m.varyingGroup,!1)):_.updateIfChanged(m.varyingGroup,!0);let d=he.expand(he(),t.boundary.sphere,u);return m.setBoundingSphere(d),m.meta.resolution=l,m}function WMe(e){return Ps({defaultProps:C.getDefaultValues(xG),createGeometry:h0t,createLocationIterator:Ao.fromStructure,getLoci:Ua,eachLocation:Ga,setUpdateState:(t,r,n)=>{r.resolution!==n.resolution&&(t.createGeometry=!0),r.probeRadius!==n.probeRadius&&(t.createGeometry=!0),r.probePositions!==n.probePositions&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0),r.smoothColors.name!==n.smoothColors.name?t.updateColor=!0:r.smoothColors.name==="on"&&n.smoothColors.name==="on"&&(r.smoothColors.params.resolutionFactor!==n.smoothColors.params.resolutionFactor&&(t.updateColor=!0),r.smoothColors.params.sampleStride!==n.smoothColors.params.sampleStride&&(t.updateColor=!0))},processValues:(t,r,n,o,i)=>{let{resolution:a,colorTexture:s}=r.meta,l=Ou(n.smoothColors,o.color.preferSmoothing,a);l&&(vA(t,l.resolution,l.stride,i,s),r.meta.colorTexture=t.tColorGrid.ref.value)},dispose:t=>{t.meta.colorTexture?.destroy()}},e)}var YK={...VC,...yG,...l1,sizeFactor:C.Numeric(1.5,{min:0,max:10,step:.1})};async function g0t(e,t,r,n,o,i){let{transform:a,field:s,idField:l,maxRadius:u}=await bG(r,t,n.size,o).runInContext(e.runtime),c={isoLevel:o.probeRadius,scalarField:s,idField:l},m=await VT(c,i).runAsChild(e.runtime);Cn.transform(m,a);let d=he.expand(he(),t.boundary.sphere,u);return m.setBoundingSphere(d),m}function XMe(e){return OC({defaultProps:C.getDefaultValues(YK),createGeometry:g0t,createLocationIterator:Ao.fromGroup,getLoci:cl,eachLocation:ul,setUpdateState:(t,r,n)=>{r.resolution!==n.resolution&&(t.createGeometry=!0),r.probeRadius!==n.probeRadius&&(t.createGeometry=!0),r.probePositions!==n.probePositions&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0)}},e)}var QMe={"molecular-surface-mesh":(e,t)=>eo("Molecular surface mesh",e,t,jMe),"structure-molecular-surface-mesh":(e,t)=>po("Structure Molecular surface mesh",e,t,WMe),"molecular-surface-wireframe":(e,t)=>eo("Molecular surface wireframe",e,t,XMe)},ZMe={...xG,...YK,visuals:C.MultiSelect(["molecular-surface-mesh"],C.objectToOptions(QMe)),bumpFrequency:C.Numeric(1,{min:0,max:10,step:.1},Xe.ShadingCategory),density:C.Numeric(.5,{min:0,max:1,step:.01},Xe.ShadingCategory)};function y0t(e,t){return ZMe}function b0t(e,t){return Ut.createMulti("Molecular Surface",e,t,qn,QMe)}var qMe={name:"molecular-surface",label:"Molecular Surface",description:"Displays a molecular surface.",factory:b0t,getParams:y0t,defaultValues:C.getDefaultValues(ZMe),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"physical"},isApplicable:e=>e.elementCount>0};var KK={...fo,sizeFactor:C.Numeric(1,{min:0,max:2,step:.1}),detail:C.Numeric(0,{min:0,max:3,step:1},Xe.CustomQualityParamInfo)};function YMe(e){return Oo({defaultProps:C.getDefaultValues(KK),createGeometry:C0t,createLocationIterator:S0t,getLoci:v0t,eachLocation:I0t,setUpdateState:(t,r,n)=>{t.createGeometry=r.sizeFactor!==n.sizeFactor||r.detail!==n.detail}},e)}function x0t(e){if(ue.Traits.is(e.traits,ue.Trait.MultiChain)||ue.Traits.is(e.traits,ue.Trait.Partitioned))return!1;if(ue.isCoarse(e))return!0;if(e.elements.length===0)return!1;e.model.atomicHierarchy.derived.residue.moleculeType;let t=e.residueIndex[e.elements[0]],r=e.model.atomicHierarchy.derived.residue.moleculeType[t];return!(r===3||r===2)}function C0t(e,t,r,n,o,i){if(!x0t(t))return ft.createEmpty(i);let{detail:a,sizeFactor:s}=o,l=256,u=tt.createState(l,l/2,i),c=t.principalAxes.boxAxes,{origin:m,dirA:d,dirB:p}=c,h=ea.size(b(),c);b.scale(h,h,s/2);let f=b.create(h[2],h[1],h[0]);u.currentGroup=0,xb(u,m,d,p,f,a+1);let g=tt.getMesh(u),y=he.expand(he(),t.boundary.sphere,1*o.sizeFactor);return g.setBoundingSphere(y),g}function S0t(e){let{group:t,structure:r}=e,n=1,o=t.units.length,i=Q.Location.create(r);return un(n,o,1,(s,l)=>{let u=t.units[l];return i.unit=u,i.element=u.elements[s],i})}function v0t(e,t,r){let{objectId:n,instanceId:o}=e;if(r===n){let{structure:i,group:a}=t,s=a.units[o],l=xe.ofBounds(0,s.elements.length);return Q.Loci(i,[{unit:s,indices:l}])}return vr}function I0t(e,t,r){let n=!1;if(!Q.Loci.is(e))return!1;let{structure:o,group:i}=t;if(!De.areEquivalent(e.structure,o))return!1;let a=i.elements.length;for(let s of e.elements){let l=i.unitIndexMap.get(s.unit.id);l!==void 0&&xe.size(s.indices)===a&&r(ye.ofSingleton(l))&&(n=!0)}return n}var KMe={"orientation-ellipsoid-mesh":(e,t)=>eo("Orientation ellipsoid mesh",e,t,YMe)},JMe={...KK,visuals:C.MultiSelect(["orientation-ellipsoid-mesh"],C.objectToOptions(KMe)),bumpFrequency:C.Numeric(1,{min:0,max:10,step:.1},Xe.ShadingCategory)};function A0t(e,t){return JMe}function T0t(e,t){return Ut.createMulti("Orientation",e,t,qn,KMe)}var $Me={name:"orientation",label:"Orientation",description:"Displays orientation ellipsoids for polymer chains.",factory:T0t,getParams:A0t,defaultValues:C.getDefaultValues(JMe),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"uniform"},isApplicable:e=>e.elementCount>0};var CG=b.add,p3={...Vve,pointSizeAttenuation:C.Boolean(!1),ignoreHydrogens:C.Boolean(!1),ignoreHydrogensVariant:C.Select("all",C.arrayToOptions(["all","non-polar"])),traceOnly:C.Boolean(!1),stride:C.Numeric(1,{min:1,max:100,step:1})};function P0t(e,t,r,n,o,i){let{child:a}=r,s=a?.unitMap.get(t.id);if(a&&!s)return Dl.createEmpty(i);let{stride:l}=o,u=t.elements,c=u.length,m=OT.create(c,c/10,i),d=b(),p=t.conformation,h=tm(r,t,o),f=b(),g=0;if(l&&l>1||h)for(let I=0;I<c;++I)l&&I%l!==0||h&&h(u[I])||(p.invariantPosition(u[I],d),CG(f,f,d),g+=1,m.add(d[0],d[1],d[2],I));else for(let I=0;I<c;++I)p.invariantPosition(u[I],d),CG(f,f,d),g+=1,m.add(d[0],d[1],d[2],I);let y=m.getPoints();if(g===0)return y;let x;b.scale(f,f,1/g);let S=i?he.clone(i.boundingSphere):void 0;return S&&b.distance(f,S.center)/S.radius<.1?x=S:x=he.expand(he(),(s??t).boundary.sphere,1*o.sizeFactor),y.setBoundingSphere(x),y}function SG(e){return Ove({defaultProps:C.getDefaultValues(p3),createGeometry:P0t,createLocationIterator:Ao.fromGroup,getLoci:cl,eachLocation:ul,setUpdateState:(t,r,n)=>{t.createGeometry=r.ignoreHydrogens!==n.ignoreHydrogens||r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||r.traceOnly!==n.traceOnly||r.stride!==n.stride}},e)}function _0t(e,t,r,n,o){let{child:i}=t,{stride:a}=n,{getSerialIndex:s}=t.serialMapping,l=t.elementCount,u=OT.create(l,l/2,o),c=b(),m=0;for(let f of t.units){let g=i?.unitMap.get(f.id);if(i&&!g)return Dl.createEmpty(o);let{elements:y,conformation:x}=f,S=y.length,I=b(),v=tm(t,f,n);if(a&&a>1||v)for(let A=0;A<S;A++){let P=y[A];a&&A%a!==0||v&&v(P)||(x.position(P,I),u.add(I[0],I[1],I[2],s(f,P)),CG(c,c,I),m+=1)}else{for(let A=0;A<S;A++){let P=y[A];x.position(P,I),u.add(I[0],I[1],I[2],s(f,P)),CG(c,c,I)}m+=S}}let d=u.getPoints();if(m===0)return d;let p;b.scale(c,c,1/m);let h=o?he.clone(o.boundingSphere):void 0;return h&&b.distance(c,h.center)/h.radius<1?p=h:p=he.expand(he(),(i??t).boundary.sphere,1*n.sizeFactor),d.setBoundingSphere(p),d}var R0t={..._ve,pointSizeAttenuation:C.Boolean(!1),ignoreHydrogens:C.Boolean(!1),ignoreHydrogensVariant:C.Select("all",C.arrayToOptions(["all","non-polar"])),traceOnly:C.Boolean(!1),stride:C.Numeric(1,{min:1,max:100,step:1})};function vG(e){return Rve({defaultProps:C.getDefaultValues(R0t),createGeometry:_0t,createLocationIterator:Ao.fromStructure,getLoci:Ua,eachLocation:Ga,setUpdateState:(t,r,n)=>{t.createGeometry=r.ignoreHydrogens!==n.ignoreHydrogens||r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||r.traceOnly!==n.traceOnly||r.stride!==n.stride}},e)}var eBe={"element-point":(e,t)=>eo("Element points",e,t,SG),"structure-element-point":(e,t)=>po("Structure element points",e,t,vG)},tBe={...p3,density:C.Numeric(.1,{min:0,max:1,step:.01},Xe.ShadingCategory),visuals:C.MultiSelect(["element-point"],C.objectToOptions(eBe))};function D0t(e,t){let r=tBe;return t.unitSymmetryGroups.length>5e3&&(r=C.clone(r),r.visuals.defaultValue=["structure-element-point"]),r}function w0t(e,t){return Ut.createMulti("Point",e,t,qn,eBe)}var rBe={name:"point",label:"Point",description:"Displays elements (atoms, coarse spheres) as points.",factory:w0t,getParams:D0t,defaultValues:C.getDefaultValues(tBe),defaultColorTheme:{name:"element-symbol"},defaultSizeTheme:{name:"uniform"},isApplicable:e=>e.elementCount>0};var nBe={sizeFactor:C.Numeric(.2,{min:0,max:10,step:.01}),detail:C.Numeric(0,{min:0,max:3,step:1},Xe.CustomQualityParamInfo),linearSegments:C.Numeric(8,{min:1,max:48,step:1},Xe.CustomQualityParamInfo),radialSegments:C.Numeric(16,{min:2,max:56,step:2},Xe.CustomQualityParamInfo)},yzn=C.getDefaultValues(nBe),rd=b();function M0t(e,t,r,n,o,i){let a=t.polymerElements.length;if(!a)return ft.createEmpty(i);let{sizeFactor:s,detail:l,linearSegments:u,radialSegments:c}=o,m=u*c*a+(c+1)*a*2,d=tt.createState(m,m/10,i),p=rP(u),{curvePoints:h,normalVectors:f,binormalVectors:g,widthValues:y,heightValues:x}=p,S=0,I=JT(t,r,{ignoreSecondaryStructure:!0});for(;I.hasNext;){let P=I.move();d.currentGroup=S;let R=pa(P.moleculeType)?j1:H1;nP(p,P,z4,R);let w=P.coarseBackboneFirst||P.first,E=P.coarseBackboneLast||P.last,M=n.size.size(P.centerPrev)*s,D=n.size.size(P.center)*s,B=n.size.size(P.centerNext)*s;s3(p,M,D,B,M,D,B,R);let k=u;if(P.initial){k=Math.max(Math.round(u*R),1);let F=u-k;h.copyWithin(0,F*3),g.copyWithin(0,F*3),f.copyWithin(0,F*3),y.copyWithin(0,F*3),x.copyWithin(0,F*3),b.fromArray(rd,h,3),b.normalize(rd,b.sub(rd,P.p2,rd)),b.scaleAndAdd(rd,P.p2,rd,D*oP),b.toArray(rd,h,0)}else P.final&&(k=Math.max(Math.round(u*(1-R)),1),b.fromArray(rd,h,k*3-3),b.normalize(rd,b.sub(rd,P.p2,rd)),b.scaleAndAdd(rd,P.p2,rd,D*oP),b.toArray(rd,h,k*3));P.initial===!0&&P.final===!0?Zr(d,P.p2,D*2,l):c===2?PP(d,h,f,g,k,y,x,0):c===4?AP(d,h,f,g,k,y,x,0,w,E):c3(d,h,f,g,k,c,y,x,w,E,"elliptical"),++S}let v=tt.getMesh(d),A=he.expand(he(),t.boundary.sphere,1*o.sizeFactor);return v.setBoundingSphere(A),v}var JK={...fo,...nBe};function oBe(e){return Oo({defaultProps:C.getDefaultValues(JK),createGeometry:M0t,createLocationIterator:t=>Qd.fromGroup(t,{asSecondary:!0}),getLoci:rf,eachLocation:nf,setUpdateState:(t,r,n)=>{t.createGeometry=r.sizeFactor!==n.sizeFactor||r.detail!==n.detail||r.linearSegments!==n.linearSegments||r.radialSegments!==n.radialSegments}},e)}var iBe={"polymer-tube":(e,t)=>eo("Polymer tube mesh",e,t,oBe),"polymer-gap":(e,t)=>eo("Polymer gap cylinder",e,t,vP)},aBe={...JK,...Z1,sizeFactor:C.Numeric(.2,{min:0,max:10,step:.01}),visuals:C.MultiSelect(["polymer-tube","polymer-gap"],C.objectToOptions(iBe)),bumpFrequency:C.Numeric(2,{min:0,max:10,step:.1},Xe.ShadingCategory),density:C.Numeric(.1,{min:0,max:1,step:.01},Xe.ShadingCategory)};function B0t(e,t){let r=C.clone(aBe),n=!1,o=!1;return t.units.forEach(i=>{!n&&ue.isAtomic(i)&&i.nucleotideElements.length&&(n=!0),!o&&i.gapElements.length&&(o=!0)}),r.visuals.defaultValue=["polymer-tube"],o&&r.visuals.defaultValue.push("polymer-gap"),r}function E0t(e,t){return Ut.createMulti("Putty",e,t,qn,iBe)}var sBe={name:"putty",label:"Putty",description:"Displays a tube smoothly following the trace atoms of polymers.",factory:E0t,getParams:B0t,defaultValues:C.getDefaultValues(aBe),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"uncertainty"},isApplicable:e=>e.polymerResidueCount>0};var lBe={"element-sphere":(e,t)=>eo("Sphere mesh/impostor",e,t,F4),"structure-element-sphere":(e,t)=>po("Structure sphere mesh/impostor",e,t,L4)},$K={...KT,bumpFrequency:C.Numeric(1,{min:0,max:10,step:.1},Xe.ShadingCategory),density:C.Numeric(.5,{min:0,max:1,step:.01},Xe.ShadingCategory),visuals:C.MultiSelect(["element-sphere"],C.objectToOptions(lBe))},IG;function k0t(e,t){let r=$K;return t.isCoarseGrained&&(IG||(IG=C.clone($K),IG.sizeFactor.defaultValue=2),r=IG),t.unitSymmetryGroups.length>5e3&&(r=C.clone(r),r.visuals.defaultValue=["structure-element-sphere"]),r}function F0t(e,t){return Ut.createMulti("Spacefill",e,t,qn,lBe)}var uBe={name:"spacefill",label:"Spacefill",description:"Displays atomic/coarse elements as spheres.",factory:F0t,getParams:k0t,defaultValues:C.getDefaultValues($K),defaultColorTheme:{name:"element-symbol"},defaultSizeTheme:{name:"physical"},isApplicable:e=>e.elementCount>0};var eJ=xt.is;function cBe(e,t,r,n){let o=Q.Location.create(t,e),i=e.elements,a=e.bonds,{edgeCount:s,a:l,b:u,edgeProps:c,offset:m}=a,{order:d,flags:p}=c,{sizeFactor:h,aromaticBonds:f,includeTypes:g,excludeTypes:y,multipleBonds:x}=n,S=x==="off",I=x==="symmetric",v=xt.fromNames(g),A=xt.fromNames(y),P=QT(v,A,xt.Flag.Computed),T=b(),R=e.conformation,{elementRingIndices:w,elementAromaticRingIndices:E}=e.rings,M=f?e.resonance.delocalizedTriplets:void 0;return{linkCount:s*2,referencePosition:D=>{let B=l[D],k=u[D],F=M?.getThirdElement(B,k);if(F!==void 0)return R.invariantPosition(i[F],T);B>k&&([B,k]=[k,B]),m[B+1]-m[B]===1&&([B,k]=[k,B]);let z=E.get(B)||w.get(B),j=0;for(let Y=m[B],G=m[B+1];Y<G;++Y){let X=u[Y];if(X!==k&&X!==B)if(z){let U=E.get(X)||w.get(X);if(!U)continue;let L=nv(z,U);L>j&&(j=L,R.invariantPosition(i[X],T))}else return R.invariantPosition(i[X],T)}return j>0?T:null},position:(D,B,k,F)=>{R.invariantPosition(i[l[k]],D),R.invariantPosition(i[u[k]],B)},style:D=>{let B=d[D],k=p[D];if(eJ(k,xt.Flag.MetallicCoordination)||eJ(k,xt.Flag.HydrogenBond))return 1;if(B===3)return S?0:I?4:5;if(f){let F=l[D],z=u[D],j=E.get(F),Y=E.get(z),G=j&&Y?nv(j,Y):0;if(eJ(k,xt.Flag.Aromatic)||G&&!P)return G===2?8:7}return B!==2||S?0:I?2:3},radius:D=>{o.element=i[l[D]];let B=r.size.size(o);o.element=i[u[D]];let k=r.size.size(o);return Math.min(B,k)*h},ignore:w4(t,e,n)}}function L0t(e,t,r,n,o,i){if(!ue.isAtomic(t))return Cn.createEmpty(i);if(!Ub(t,o))return Cn.createEmpty(i);if(!t.bonds.edgeCount)return Cn.createEmpty(i);let{child:a}=r,s=a?.unitMap.get(t.id);if(a&&!s)return Cn.createEmpty(i);let l=cBe(t,r,n,o),{lines:u,boundingSphere:c}=iD(e,l,o,i);if(c)u.setBoundingSphere(c);else if(u.lineCount>0){let m=he.expand(he(),(s??t).boundary.sphere,1*o.sizeFactor);u.setBoundingSphere(m)}return u}var tJ={...VC,...XT,includeParent:C.Boolean(!1)};function mBe(e){return OC({defaultProps:C.getDefaultValues(tJ),createGeometry:L0t,createLocationIterator:t=>$m.fromGroup(t),getLoci:ZT,eachLocation:$D,setUpdateState:(t,r,n,o,i,a,s)=>{t.createGeometry=r.sizeFactor!==n.sizeFactor||r.linkScale!==n.linkScale||r.linkSpacing!==n.linkSpacing||r.aromaticDashCount!==n.aromaticDashCount||r.dashCount!==n.dashCount||r.ignoreHydrogens!==n.ignoreHydrogens||r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||!Yi(r.includeTypes,n.includeTypes)||!Yi(r.excludeTypes,n.excludeTypes)||r.aromaticBonds!==n.aromaticBonds||r.multipleBonds!==n.multipleBonds;let l=a.group.units[0],u=s.group.units[0];ue.isAtomic(l)&&ue.isAtomic(u)&&(xs.areEqual(l.bonds,u.bonds)||(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0,t.updateSize=!0))}},e)}function V0t(e,t,r){let n=[],{bondCount:o,unitIndex:i,unitEdgeIndex:a,unitGroupIndex:s}=e.intraUnitBondMapping,{child:l}=e;for(let u of e.unitSymmetryGroups){let c=u.units[0],m=l?.unitMap.get(c.id),d=ue.isAtomic(c)&&!(l&&!m)?cBe(c,e,t,r):yV;n.push({group:u,props:d})}return{linkCount:o,referencePosition:u=>{let{group:c,props:m}=n[i[u]];if(!m.referencePosition)return null;let d=m.referencePosition(a[u]);if(!d)return null;let p=c.units[s[u]];return b.transformMat4(d,d,p.conformation.operator.matrix),d},position:(u,c,m,d)=>{let{group:p,props:h}=n[i[m]];h.position(u,c,a[m],d);let f=p.units[s[m]];b.transformMat4(u,u,f.conformation.operator.matrix),b.transformMat4(c,c,f.conformation.operator.matrix)},style:u=>{let{props:c}=n[i[u]];return c.style?c.style(a[u]):0},radius:u=>{let{props:c}=n[i[u]];return c.radius(a[u])},ignore:u=>{let{props:c}=n[i[u]];return c.ignore?c.ignore(a[u]):!1},stub:u=>{let{props:c}=n[i[u]];return c.stub?c.stub(a[u]):!1}}}function O0t(e,t,r,n,o){if(!Es(t,n))return Cn.createEmpty(o);if(!t.intraUnitBondMapping.bondCount)return Cn.createEmpty(o);let i=V0t(t,r,n),{lines:a,boundingSphere:s}=iD(e,i,n,o);if(s)a.setBoundingSphere(s);else if(a.lineCount>0){let{child:l}=t,u=he.expand(he(),(l??t).boundary.sphere,1*n.sizeFactor);a.setBoundingSphere(u)}return a}var G0t={...OA,...XT,includeParent:C.Boolean(!1)};function dBe(e){return GA({defaultProps:C.getDefaultValues(G0t),createGeometry:O0t,createLocationIterator:(t,r)=>Es(t,r)?$m.fromStructureGroups(t):vg,getLoci:r3,eachLocation:n3,setUpdateState:(t,r,n,o,i,a,s)=>{t.createGeometry=r.sizeFactor!==n.sizeFactor||r.linkScale!==n.linkScale||r.linkSpacing!==n.linkSpacing||r.aromaticDashCount!==n.aromaticDashCount||r.dashCount!==n.dashCount||r.ignoreHydrogens!==n.ignoreHydrogens||r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||!Yi(r.includeTypes,n.includeTypes)||!Yi(r.excludeTypes,n.excludeTypes)||r.multipleBonds!==n.multipleBonds,Es(a,r)&&a.interUnitBonds!==s.interUnitBonds&&(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0,t.updateSize=!0)}},e)}var rJ=new It.ElementBondIterator;function pBe(e,t,r,n){for(rJ.setElement(t,r,n);rJ.hasNext;){let o=rJ.move();return o.otherUnit.conformation.position(o.otherUnit.elements[o.otherIndex],e),e}return null}function U0t(e,t,r){let n=e.interUnitBonds,{edgeCount:o,edges:i}=n,{sizeFactor:a,aromaticBonds:s,multipleBonds:l}=r,u=l==="off",c=l==="symmetric",m=b(),d=Q.Location.create();return{linkCount:o,referencePosition:p=>{let h=i[p],f,g,y,x;if(h.unitA<h.unitB)f=e.unitMap.get(h.unitA),g=e.unitMap.get(h.unitB),y=h.indexA,x=h.indexB;else if(h.unitA>h.unitB)f=e.unitMap.get(h.unitB),g=e.unitMap.get(h.unitA),y=h.indexB,x=h.indexA;else throw new Error("same units in createInterUnitBondLines");return pBe(m,e,f,y)||pBe(m,e,g,x)},position:(p,h,f,g)=>{let y=i[f],x=e.unitMap.get(y.unitA),S=e.unitMap.get(y.unitB);x.conformation.position(x.elements[y.indexA],p),S.conformation.position(S.elements[y.indexB],h)},style:p=>{let h=i[p].props.order,f=Ia.create(i[p].props.flag);return xt.is(f,xt.Flag.MetallicCoordination)||xt.is(f,xt.Flag.HydrogenBond)?1:h===3?u?0:c?4:5:s&&xt.is(f,xt.Flag.Aromatic)?7:h!==2||u?0:c?2:3},radius:p=>{let h=i[p];d.structure=e,d.unit=e.unitMap.get(h.unitA),d.element=d.unit.elements[h.indexA];let f=t.size.size(d);d.unit=e.unitMap.get(h.unitB),d.element=d.unit.elements[h.indexB];let g=t.size.size(d);return Math.min(f,g)*a},ignore:M4(e,r)}}function N0t(e,t,r,n,o){if(!Es(t,n))return Cn.createEmpty(o);if(!t.interUnitBonds.edgeCount)return Cn.createEmpty(o);let i=U0t(t,r,n),{lines:a,boundingSphere:s}=iD(e,i,n,o);if(s)a.setBoundingSphere(s);else if(a.lineCount>0){let{child:l}=t,u=he.expand(he(),(l??t).boundary.sphere,1*n.sizeFactor);a.setBoundingSphere(u)}return a}var nJ={...OA,...XT,includeParent:C.Boolean(!1)};function fBe(e){return GA({defaultProps:C.getDefaultValues(nJ),createGeometry:N0t,createLocationIterator:(t,r)=>Es(t,r)?$m.fromStructure(t):vg,getLoci:e3,eachLocation:t3,setUpdateState:(t,r,n,o,i,a,s)=>{t.createGeometry=r.sizeFactor!==n.sizeFactor||r.linkScale!==n.linkScale||r.linkSpacing!==n.linkSpacing||r.aromaticDashCount!==n.aromaticDashCount||r.dashCount!==n.dashCount||r.ignoreHydrogens!==n.ignoreHydrogens||r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||!Yi(r.includeTypes,n.includeTypes)||!Yi(r.excludeTypes,n.excludeTypes)||r.multipleBonds!==n.multipleBonds,Es(a,r)&&a.interUnitBonds!==s.interUnitBonds&&(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0,t.updateSize=!0)}},e)}var hBe=b.add,xf=b.scaleAndAdd,AG=b.unitX,TG=b.unitY,PG=b.unitZ,oJ={...VC,lineSizeAttenuation:C.Boolean(!1),ignoreHydrogens:C.Boolean(!1),ignoreHydrogensVariant:C.Select("all",C.arrayToOptions(["all","non-polar"])),traceOnly:C.Boolean(!1),crosses:C.Select("lone",C.arrayToOptions(["lone","all"])),crossSize:C.Numeric(.35,{min:0,max:2,step:.01})};function z0t(e,t,r,n,o,i){let{child:a}=r;if(a&&!a.unitMap.get(t.id))return Cn.createEmpty(i);let s=t.elements,l=s.length,u=ns.create(l,l/10,i),c=b(),m=b(),d=b(),p=t.conformation,h=tm(r,t,o),f=o.crossSize/2,g=o.crosses==="lone",y=b(),x=0;for(let A=0;A<l;++A)h&&h(s[A])||g&&ue.isAtomic(t)&&Ub(t,o)&&$c(r,t,A)!==0||(p.invariantPosition(s[A],c),hBe(y,y,c),x+=1,xf(m,c,AG,f),xf(d,c,AG,-f),u.add(m[0],m[1],m[2],d[0],d[1],d[2],A),xf(m,c,TG,f),xf(d,c,TG,-f),u.add(m[0],m[1],m[2],d[0],d[1],d[2],A),xf(m,c,PG,f),xf(d,c,PG,-f),u.add(m[0],m[1],m[2],d[0],d[1],d[2],A));let S=u.getLines();if(x===0)return S;let I;b.scale(y,y,1/x);let v=i?he.clone(i.boundingSphere):void 0;return v&&b.distance(y,v.center)/v.radius<.1?I=v:I=he.expand(he(),t.boundary.sphere,1*o.sizeFactor),S.setBoundingSphere(I),S}function gBe(e){return OC({defaultProps:C.getDefaultValues(oJ),createGeometry:z0t,createLocationIterator:Ao.fromGroup,getLoci:cl,eachLocation:ul,setUpdateState:(t,r,n)=>{t.createGeometry=r.ignoreHydrogens!==n.ignoreHydrogens||r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||r.traceOnly!==n.traceOnly||r.crosses!==n.crosses||r.crossSize!==n.crossSize}},e)}function H0t(e,t,r,n,o){let{child:i}=t,{getSerialIndex:a}=t.serialMapping,s=t.elementCount,l=ns.create(s,s/2,o),u=b(),c=b(),m=b(),d=n.crossSize/2,p=n.crosses==="lone",h=b(),f=0;for(let S of t.units){let I=i?.unitMap.get(S.id);if(i&&!I)return Cn.createEmpty(o);let{elements:v,conformation:A}=S,P=v.length,T=tm(t,S,n);for(let R=0;R<P;R++){if(T&&T(v[R])||p&&ue.isAtomic(S)&&Ub(S,n)&&$c(t,S,R)!==0)continue;A.position(v[R],u),hBe(h,h,u),f+=1;let w=a(S,v[R]);xf(c,u,AG,d),xf(m,u,AG,-d),l.add(c[0],c[1],c[2],m[0],m[1],m[2],w),xf(c,u,TG,d),xf(m,u,TG,-d),l.add(c[0],c[1],c[2],m[0],m[1],m[2],w),xf(c,u,PG,d),xf(m,u,PG,-d),l.add(c[0],c[1],c[2],m[0],m[1],m[2],w)}}let g=l.getLines();if(f===0)return g;let y;b.scale(h,h,1/f);let x=o?he.clone(o.boundingSphere):void 0;return x&&b.distance(h,x.center)/x.radius<1?y=x:y=he.expand(he(),(i??t).boundary.sphere,1*n.sizeFactor),g.setBoundingSphere(y),g}var j0t={...OA,lineSizeAttenuation:C.Boolean(!1),ignoreHydrogens:C.Boolean(!1),ignoreHydrogensVariant:C.Select("all",C.arrayToOptions(["all","non-polar"])),traceOnly:C.Boolean(!1),crosses:C.Select("lone",C.arrayToOptions(["lone","all"])),crossSize:C.Numeric(.35,{min:0,max:2,step:.01})};function yBe(e){return GA({defaultProps:C.getDefaultValues(j0t),createGeometry:H0t,createLocationIterator:Ao.fromStructure,getLoci:Ua,eachLocation:Ga,setUpdateState:(t,r,n)=>{t.createGeometry=r.ignoreHydrogens!==n.ignoreHydrogens||r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||r.traceOnly!==n.traceOnly||r.crosses!==n.crosses||r.crossSize!==n.crossSize}},e)}var bBe={"intra-bond":(e,t)=>eo("Intra-unit bond line",e,t,mBe),"inter-bond":(e,t)=>po("Inter-unit bond line",e,t,fBe),"element-point":(e,t)=>eo("Points",e,t,SG),"element-cross":(e,t)=>eo("Crosses",e,t,gBe),"structure-intra-bond":(e,t)=>po("Structure intra-unit bond line",e,t,dBe),"structure-element-point":(e,t)=>po("Structure element points",e,t,vG),"structure-element-cross":(e,t)=>po("Structure element crosses",e,t,yBe)},xBe={...tJ,...nJ,...p3,...oJ,pointStyle:C.Select("circle",C.objectToOptions(Dl.StyleTypes)),multipleBonds:C.Select("offset",C.arrayToOptions(["off","symmetric","offset"])),includeParent:C.Boolean(!1),sizeFactor:C.Numeric(2,{min:.01,max:10,step:.01}),unitKinds:Cb(["atomic"]),visuals:C.MultiSelect(["intra-bond","inter-bond","element-point","element-cross"],C.objectToOptions(bBe)),density:C.Numeric(.1,{min:0,max:1,step:.01},Xe.ShadingCategory)};function W0t(e,t){let r=xBe;return De.getSize(t)>=De.Size.Huge?(r=C.clone(r),r.visuals.defaultValue=["intra-bond","element-point","element-cross"]):t.unitSymmetryGroups.length>5e3&&(r=C.clone(r),r.visuals.defaultValue=["structure-intra-bond","structure-element-point","structure-element-cross"]),r}function X0t(e,t){return Ut.createMulti("Line",e,t,qn,bBe)}var CBe={name:"line",label:"Line",description:"Displays bonds as lines and atoms as points or croses.",factory:X0t,getParams:W0t,defaultValues:C.getDefaultValues(xBe),defaultColorTheme:{name:"element-symbol"},defaultSizeTheme:{name:"uniform"},isApplicable:e=>e.elementCount>0,getData:(e,t)=>t.includeParent?e.asParent():e,mustRecreate:(e,t)=>e.includeParent!==t.includeParent};function Q0t(e,t,r,n,o){let{webgl:i}=e;if(!i)throw new Error("GaussianDensityVolume requires `webgl`");let a=b.create(0,1,2),s={min:0,max:1,mean:.04,sigma:.01},l=c=>{let m=c?c.gridTexture.ref.value:void 0,d=_Me(t,r.size,n,i,m),{transform:p,texture:h,bbox:f,gridDim:g}=d,y=H.mul(H(),p,H.fromScaling(H(),g)),x=H.getScaling(b(),p),S=tu.create(f,g,p,y,x,h,s,!0,a,"byte",c),I=he.expand(he(),t.boundary.sphere,d.maxRadius);return S.setBoundingSphere(I),S},u=l(o);return u.meta.reset=()=>{l(u)},u}var iJ={...wve,...A0,ignoreHydrogens:C.Boolean(!1),ignoreHydrogensVariant:C.Select("all",C.arrayToOptions(["all","non-polar"])),includeParent:C.Boolean(!1,{isHidden:!0})};function SBe(e){return Mve({defaultProps:C.getDefaultValues(iJ),createGeometry:Q0t,createLocationIterator:Ao.fromStructure,getLoci:Ua,eachLocation:Ga,setUpdateState:(t,r,n)=>{r.resolution!==n.resolution&&(t.createGeometry=!0),r.radiusOffset!==n.radiusOffset&&(t.createGeometry=!0),r.smoothness!==n.smoothness&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0)},dispose:t=>{t.gridTexture.ref.value.destroy()}},e)}function Z0t(e,t,r,n,o,i){let{webgl:a}=e;if(!a)throw new Error("GaussianDensityVolume requires `webgl`");let s=b.create(0,1,2),l={min:0,max:1,mean:.04,sigma:.01},u=m=>{let d=m?m.gridTexture.ref.value:void 0,p=AMe(r,t,n.size,o,a,d),{transform:h,texture:f,bbox:g,gridDim:y}=p,x=H.mul(H(),h,H.fromScaling(H(),y)),S=H.getScaling(b(),h),I=tu.create(g,y,h,x,S,f,l,!0,s,"byte",m),v=he.expand(he(),t.boundary.sphere,p.maxRadius);return I.setBoundingSphere(v),I},c=u(i);return c.meta.reset=()=>{u(c)},c}var q0t={...Gve,...A0,ignoreHydrogens:C.Boolean(!1),ignoreHydrogensVariant:C.Select("all",C.arrayToOptions(["all","non-polar"])),includeParent:C.Boolean(!1,{isHidden:!0})};function vBe(e){return Uve({defaultProps:C.getDefaultValues(q0t),createGeometry:Z0t,createLocationIterator:Ao.fromGroup,getLoci:cl,eachLocation:ul,setUpdateState:(t,r,n)=>{r.resolution!==n.resolution&&(t.createGeometry=!0),r.radiusOffset!==n.radiusOffset&&(t.createGeometry=!0),r.smoothness!==n.smoothness&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0)},dispose:t=>{t.gridTexture.ref.value.destroy()}},e)}var IBe={"gaussian-volume":(e,t)=>po("Gaussian volume",e,t,SBe),"units-gaussian-volume":(e,t)=>eo("Units-Gaussian volume",e,t,vBe)},ABe={...iJ,jumpLength:C.Numeric(4,{min:0,max:20,step:.1}),visuals:C.MultiSelect(["gaussian-volume"],C.objectToOptions(IBe))};function Y0t(e,t){return ABe}function K0t(e,t){return Ut.createMulti("Gaussian Volume",e,t,qn,IBe)}var TBe={name:"gaussian-volume",label:"Gaussian Volume",description:"Displays a gaussian molecular density using direct volume rendering.",factory:K0t,getParams:Y0t,defaultValues:C.getDefaultValues(ABe),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"physical"},isApplicable:e=>e.elementCount>0};var J0t=b.scale,$0t=b.add,eSt=b.sub,_G={...fo,...HA,sizeFactor:C.Numeric(.3,{min:0,max:10,step:.01}),radialSegments:C.Numeric(16,{min:2,max:56,step:2},Xe.CustomQualityParamInfo),tryUseImpostor:C.Boolean(!0)};function PBe(e,t,r,n){return r.tryUseImpostor&&kC(n)?rSt(e):oSt(e)}function tSt(e,t,r,n,o,i){let a=t.polymerElements.length;if(!a)return ji.createEmpty(i);let s=a*2,l=g1.create(s,s/4,i),u=t.conformation,c=b(),m=b(),d=b();lK(t,function(g,y,x,S,I){u.invariantPosition(g,c),u.invariantPosition(y,m);let A=pa(I)?j1:H1;$0t(d,c,J0t(d,eSt(d,m,c),A)),l.add(c[0],c[1],c[2],d[0],d[1],d[2],1,!1,!1,2,x),l.add(d[0],d[1],d[2],m[0],m[1],m[2],1,!1,!1,2,S)});let h=l.getCylinders(),f=he.expand(he(),t.boundary.sphere,1*o.sizeFactor);return h.setBoundingSphere(f),h}function rSt(e){return jA({defaultProps:C.getDefaultValues(_G),createGeometry:tSt,createLocationIterator:t=>Qd.fromGroup(t),getLoci:rf,eachLocation:nf,setUpdateState:(t,r,n)=>{},mustRecreate:(t,r,n)=>!r.tryUseImpostor||!n},e)}function nSt(e,t,r,n,o,i){let a=t.polymerElements.length;if(!a)return ft.createEmpty(i);let{radialSegments:s,sizeFactor:l}=o,u=s*2*a*2,c=tt.createState(u,u/10,i),m=t.conformation,d=b(),p=b(),h={radiusTop:1,radiusBottom:1,radialSegments:s},f=Q.Location.create(r,t),g=Q.Location.create(r,t);lK(t,function(I,v,A,P,T){f.element=I,g.element=v,m.invariantPosition(f.element,d),m.invariantPosition(g.element,p);let w=pa(T)?j1:H1;h.radiusTop=h.radiusBottom=n.size.size(f)*l,c.currentGroup=A,gn(c,d,p,w,h),h.radiusTop=h.radiusBottom=n.size.size(g)*l,c.currentGroup=P,gn(c,p,d,1-w,h)});let x=tt.getMesh(c),S=he.expand(he(),t.boundary.sphere,1*o.sizeFactor);return x.setBoundingSphere(S),x}function oSt(e){return Oo({defaultProps:C.getDefaultValues(_G),createGeometry:nSt,createLocationIterator:t=>Qd.fromGroup(t),getLoci:rf,eachLocation:nf,setUpdateState:(t,r,n)=>{t.createGeometry=r.sizeFactor!==n.sizeFactor||r.radialSegments!==n.radialSegments},mustRecreate:(t,r,n)=>r.tryUseImpostor&&!!n},e)}var RG={...fo,...NA,sizeFactor:C.Numeric(.3,{min:0,max:10,step:.01}),detail:C.Numeric(0,{min:0,max:3,step:1},Xe.CustomQualityParamInfo),tryUseImpostor:C.Boolean(!0)};function _Be(e,t,r,n){return r.tryUseImpostor&&FA(n)?aSt(e):lSt(e)}function iSt(e,t,r,n,o,i){let a=t.polymerElements.length;if(!a)return Hs.createEmpty(i);let s=Fg.create(a,a/2,i),l=t.conformation,u=b();uK(t,(p,h)=>{l.invariantPosition(p,u),s.add(u[0],u[1],u[2],h)});let m=s.getSpheres(),d=he.expand(he(),t.boundary.sphere,1*o.sizeFactor);return m.setBoundingSphere(d),m}function aSt(e){return zA({defaultProps:C.getDefaultValues(RG),createGeometry:iSt,createLocationIterator:t=>Qd.fromGroup(t),getLoci:rf,eachLocation:nf,setUpdateState:(t,r,n)=>{},mustRecreate:(t,r,n)=>!r.tryUseImpostor||!n},e)}function sSt(e,t,r,n,o,i){let a=t.polymerElements.length;if(!a)return ft.createEmpty(i);let{detail:s,sizeFactor:l}=o,u=a*Nm(s),c=tt.createState(u,u/2,i),m=t.conformation,d=b(),p=Q.Location.create(r,t);uK(t,(y,x)=>{p.element=y,m.invariantPosition(p.element,d),c.currentGroup=x,Zr(c,d,n.size.size(p)*l,s)});let f=tt.getMesh(c),g=he.expand(he(),t.boundary.sphere,1*o.sizeFactor);return f.setBoundingSphere(g),f}function lSt(e){return Oo({defaultProps:C.getDefaultValues(RG),createGeometry:sSt,createLocationIterator:t=>Qd.fromGroup(t),getLoci:rf,eachLocation:nf,setUpdateState:(t,r,n)=>{t.createGeometry=r.sizeFactor!==n.sizeFactor||r.detail!==n.detail},mustRecreate:(t,r,n)=>r.tryUseImpostor&&!!n},e)}var RBe={"polymer-backbone-cylinder":(e,t)=>eo("Polymer backbone cylinder",e,t,PBe),"polymer-backbone-sphere":(e,t)=>eo("Polymer backbone sphere",e,t,_Be),"polymer-gap":(e,t)=>eo("Polymer gap cylinder",e,t,vP)},DBe={...RG,..._G,...Z1,sizeAspectRatio:C.Numeric(1,{min:.1,max:3,step:.1}),visuals:C.MultiSelect(["polymer-backbone-cylinder","polymer-backbone-sphere","polymer-gap"],C.objectToOptions(RBe)),bumpFrequency:C.Numeric(0,{min:0,max:10,step:.1},Xe.ShadingCategory),density:C.Numeric(.1,{min:0,max:1,step:.01},Xe.ShadingCategory),colorMode:C.Select("default",C.arrayToOptions(["default","interpolate"]),{...Xe.ShadingCategory,isHidden:!0})};function uSt(e,t){let r=C.clone(DBe),n=!1;return t.units.forEach(o=>{!n&&o.gapElements.length&&(n=!0)}),r.visuals.defaultValue=["polymer-backbone-cylinder","polymer-backbone-sphere"],n&&r.visuals.defaultValue.push("polymer-gap"),r}function cSt(e,t){return Ut.createMulti("Backbone",e,t,qn,RBe)}var wBe={name:"backbone",label:"Backbone",description:"Displays polymer backbone with cylinders and spheres.",factory:cSt,getParams:uSt,defaultValues:C.getDefaultValues(DBe),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"uniform"},isApplicable:e=>e.polymerResidueCount>0};var mSt=b.set,dSt=b.transformMat4,pSt=b.squaredDistance,aJ={...kve,interpolation:C.Select("nearest",C.objectToOptions(eF)),imageResolution:C.Numeric(.5,{min:.01,max:20,step:.01},{description:"Grid resolution/cell spacing.",...Xe.CustomQualityParamInfo}),mode:C.Select("frame",C.arrayToOptions(["frame","plane"]),{description:"Frame: slice through the structure along arbitrary axes in any step size. Plane: an arbitrary plane defined by point and normal."}),offset:C.Numeric(0,{min:-1,max:1,step:.01},{isEssential:!0,immediateUpdate:!0,hideIf:e=>e.mode!=="frame",description:"Relative offset from center."}),axis:C.Select("c",C.arrayToOptions(["a","b","c"]),{isEssential:!0,hideIf:e=>e.mode!=="frame"}),rotation:C.Group({axis:C.Vec3(b.create(1,0,0),{},{description:"Axis of rotation"}),angle:C.Numeric(0,{min:-180,max:180,step:1},{immediateUpdate:!0,description:"Axis rotation angle in Degrees"})},{isExpanded:!0,hideIf:e=>e.mode!=="frame"}),plane:C.Group({point:C.Vec3(b.create(0,0,0),{},{description:"Plane point"}),normal:C.Vec3(b.create(1,0,0),{},{description:"Plane normal"})},{isExpanded:!0,hideIf:e=>e.mode!=="plane"}),extent:C.Select("frame",C.arrayToOptions(["frame","sphere"]),{description:"Extent of the plane, either box (frame) or sphere."}),margin:C.Numeric(4,{min:0,max:50,step:1},{immediateUpdate:!0,description:"Margin around the structure in Angstrom"}),frame:C.Select("principalAxes",C.arrayToOptions(["principalAxes","boundingBox"])),antialias:C.Boolean(!0,{description:"Antialiasing of structure edges."}),cutout:C.Boolean(!1,{description:"Cutout the structure from the image."}),defaultColor:C.Color(13421772,{description:"Default color for parts of the image that are not covered by the color theme."}),includeParent:C.Boolean(!1,{description:"Show parent structure (but within extent of this structure)."})};function MBe(e){return Fve({defaultProps:C.getDefaultValues(aJ),createGeometry:hSt,createLocationIterator:Ao.fromStructure,getLoci:Ua,eachLocation:Ga,setUpdateState:(t,r,n,o,i)=>{t.createGeometry=r.imageResolution!==n.imageResolution||r.mode!==n.mode||r.margin!==n.margin||r.frame!==n.frame||r.extent!==n.extent||!b.equals(r.rotation.axis,n.rotation.axis)||r.rotation.angle!==n.rotation.angle||r.offset!==n.offset||r.axis!==n.axis||!b.equals(r.plane.point,n.plane.point)||!b.equals(r.plane.normal,n.plane.normal)||r.antialias!==n.antialias||r.cutout!==n.cutout||r.defaultColor!==n.defaultColor||!vs.areEqual(o.color,i.color)||!Bo.areEqual(o.size,i.size)}},e)}function fSt(e,t){let{mode:r,axis:n,frame:o,extent:i,margin:a,rotation:s,plane:l,includeParent:u}=t;u&&e.child&&(e=e.child);let c=b(),m=b(),d=b(),p=b(),h=b(),f=b(),g=0,y=0,x=0,S,I,v;if(o==="principalAxes"){let T=De.getPrincipalAxes(e).boxAxes;[g,y,x]=ea.size(b(),T),S=T.dirA,I=T.dirB,v=T.dirC,b.copy(f,T.origin)}else[g,y,x]=pt.size(b(),e.boundary.box),S=b.create(1,0,0),I=b.create(0,1,0),v=b.create(0,0,1),b.copy(f,e.boundary.sphere.center);if(b.set(m,g,y,x),n==="c"?(b.set(c,g,y,x),b.copy(d,S),b.copy(p,I),b.copy(h,v)):n==="b"?(b.set(c,g,x,y),b.copy(d,S),b.copy(h,I),b.copy(p,v)):(b.set(c,y,x,g),b.copy(h,S),b.copy(d,I),b.copy(p,v)),s.angle!==0){let T=b();b.scaleAndAdd(T,T,S,s.axis[0]),b.scaleAndAdd(T,T,I,s.axis[1]),b.scaleAndAdd(T,T,v,s.axis[2]),b.normalize(T,T);let R=H.fromRotation(H(),kr(s.angle),T);b.transformDirection(d,d,R),b.transformDirection(p,p,R),b.transformDirection(h,h,R)}if(i==="sphere"||s.angle!==0){let T=e.boundary.sphere.radius*2,R=b.magnitude(pt.size(b(),pt.fromSphere3D(pt(),e.boundary.sphere)));b.set(c,R,R,T),i==="sphere"&&b.set(m,T,T,T)}b.addScalar(c,c,a*2),b.addScalar(m,m,a*2);let A=lr.identity();o==="principalAxes"&&lr.fromBasis(A,b.normalize(b(),S),b.normalize(b(),I),b.normalize(b(),v)),r==="plane"&&(b.copy(f,l.point),b.copy(h,l.normal),b.cross(d,h,b.unitX),b.dot(d,d)<1e-6&&b.cross(d,h,b.unitY),b.normalize(d,d),b.cross(p,h,d),b.normalize(p,p));let P={type:i==="sphere"?2:3,center:f,scale:m,rotation:A,transform:H.identity()};return{size:c,major:d,minor:p,normal:h,center:f,trim:P}}function hSt(e,t,r,n,o){let{imageResolution:i,offset:a,antialias:s,cutout:l,defaultColor:u}=n,c=1/i,m="color"in r.color&&r.color.color?r.color.color:()=>16777215,{size:d,major:p,minor:h,normal:f,center:g,trim:y}=fSt(t,n),x=b.create(d[0],d[1],1),S=b.setMagnitude(b(),f,d[2]/2),I=Math.floor(d[1]*c),v=Math.floor(d[0]*c),A=H.identity(),P=b(),T=b();b.add(P,g,p),H.targetTo(A,g,P,h),b.scaleAndAdd(T,g,S,a),H.setTranslation(A,T),H.mul(A,A,H.rotY90),H.scale(A,A,x);let{getSerialIndex:R}=t.serialMapping,w=r.color.granularity.startsWith("vertex"),E=vo.fromNormalAndCoplanarPoint(vo(),b.normalize(b(),f),T),M=H.invert(H(),A),D=zs(b(),b()),B=Q.Location.create(t),{units:k}=t,F=0;for(let ee=0,ce=k.length;ee<ce;++ee){let{elements:fe}=k[ee];B.unit=k[ee];for(let O=0,V=fe.length;O<V;++O){B.element=fe[O];let Z=r.size.size(B);Z>F&&(F=Z)}}let z=new Uint8Array(I*v*4),j=new Uint8Array(I*v*4),Y=new Float32Array(I*v);Y.fill(Number.MAX_VALUE);let G=b(),X=b(),U=b();if(w){let ee=0;for(let ce=0;ce<v;++ce)for(let fe=0;fe<I;++fe){let O=_r(fe+.5,0,I-1)/I-.5,V=_r(ce+.5,0,v-1)/v-.5;b.set(P,V,-O,0),b.transformMat4(P,P,A),b.copy(D.position,P);let Z=m(D,!1);Le.toArray(Z,z,ee),z[ee+3]=l?0:255,ee+=4}}else for(let ee=0,ce=I*v*4;ee<ce;ee+=4)Le.toArray(u,z,ee),z[ee+3]=l?0:255;for(let ee=0,ce=k.length;ee<ce;++ee){let fe=k[ee],{elements:O,conformation:V}=fe;B.unit=k[ee];for(let Z=0,pe=O.length;Z<pe;++Z){let $=O[Z];B.element=$,V.position($,G);let ae=vo.distanceToPoint(E,G);if(Math.abs(ae)>F)continue;let Se=r.size.size(B);if(Math.abs(ae)>Se)continue;let ve=Math.cos(Math.abs(ae)/Se),K=s?i*ve:0,re=Se+K/2,le=re*re;b.scaleAndAdd(X,G,E.normal,-ae),b.transformMat4(U,X,M),b.addScalar(U,U,.5);let ge=Math.floor(U[0]*v),Ee=I-Math.ceil(U[1]*I),nt=Math.ceil(Se*c),at=Math.max(0,ge-nt),be=Math.max(0,Ee-nt),Re=Math.min(v,ge+nt+2),Fe=Math.min(I,Ee+nt+2);b.copy(D.position,X);let Ne=w?u:m(B,!1),ot=R(B.unit,B.element);for(let it=at;it<Re;++it)for(let Xt=be;Xt<Fe;++Xt){let $r=_r(it+.5,0,v-1)/v-.5,bt=_r(Xt+.5,0,I-1)/I-.5;mSt(P,$r,-bt,0),dSt(P,P,A);let xr=pSt(P,G);if(xr>le)continue;let tn=it*I+Xt;if(xr<Y[tn]){let pn=tn*4,io=Math.sqrt(xr)-Se+K/2,Hn=io>0?1-io/K:1;w?Hn===1?Y[tn]=xr:l&&(j[pn]!==0||j[pn+1]!==0||j[pn+2]!==0)&&(Hn=1):Hn===1?(Y[tn]=xr,Le.toArray(Ne,z,pn)):l?(Le.toArray(Ne,z,pn),(j[pn]!==0||j[pn+1]!==0||j[pn+2]!==0)&&(Hn=1)):Le.toArray(Le.interpolate(Le.fromArray(z,pn),Ne,Hn),z,pn),qf(ot,j,pn),j[pn+3]=s?Math.round(255*Hn):255,l&&(z[tn*4+3]=s?Math.round(255*Hn):255)}}}}let L={width:I,height:v,array:z,flipY:!0},q={width:I,height:v,array:j,flipY:!0},te={width:1,height:1,array:new Float32Array(1),flipY:!0},J=new Float32Array([-.5,.5,0,.5,.5,0,-.5,-.5,0,.5,-.5,0]);return Zc(A,J,0,4),Gu.create(L,J,q,te,y,-1,o)}var BBe={"plane-image":(e,t)=>po("Plane image",e,t,MBe)},EBe={...aJ,visuals:C.MultiSelect(["plane-image"],C.objectToOptions(BBe))};function gSt(e,t){return EBe}function ySt(e,t){return Ut.createMulti("Plane",e,t,qn,BBe)}var kBe={name:"plane",label:"Plane",description:"Displays planes.",factory:ySt,getParams:gSt,defaultValues:C.getDefaultValues(EBe),defaultColorTheme:{name:"element-symbol"},defaultSizeTheme:{name:"physical"},isApplicable:e=>e.elementCount>0,getData:(e,t)=>t.includeParent?e.asParent():e,mustRecreate:(e,t)=>e.includeParent!==t.includeParent};var DP=class e extends kA{constructor(){super(),wi(e.BuiltIn,(t,r)=>{if(t.name!==r)throw new Error(`Fix BuiltInStructureRepresentations to have matching names. ${t.name} ${r}`);this.add(t)})}};(t=>t.BuiltIn={cartoon:iMe,backbone:wBe,"ball-and-stick":z3e,carbohydrate:awe,ellipsoid:mMe,"gaussian-surface":VMe,"gaussian-volume":TBe,label:UMe,line:CBe,"molecular-surface":qMe,orientation:$Me,plane:kBe,point:rBe,putty:sBe,spacefill:uBe})(DP||={});var bSt=1e3/30,DG=class{constructor(t){this.plugin=t;this.lastTickT=0;this.properTimeT=0;this.currentFrame=void 0;this._isAnimating=!1;this.frame=(t,r)=>{let n=En(),o=n-this.lastTickT;this.lastTickT=n,this.properTimeT+=Math.min(o,bSt),this.tick(this.properTimeT,{xrFrame:r}),this._isAnimating&&(this.currentFrame=this.plugin.canvas3d?.requestAnimationFrame(this.frame))}}get isAnimating(){return this._isAnimating}async tick(t,r){if(await this.plugin.managers.animation.tick(t,r?.isSynchronous,r?.animation),this.plugin.canvas3d?.tick(t,r),je){let n=this.plugin.canvas3d?.webgl.timer.resolve();if(n)for(let o of n)lR([o])}}resetTime(t){this.plugin.canvas3d?.resetTime(t)}start(t){this.plugin.canvas3d?.resume(),this._isAnimating=!0,this.resetTime(0),this.properTimeT=0,this.lastTickT=En(),t?.immediate?this.frame():this.currentFrame=this.plugin.canvas3d?.requestAnimationFrame(this.frame)}stop(t){this._isAnimating=!1,this.currentFrame!==void 0&&(this.plugin.canvas3d?.cancelAnimationFrame(this.currentFrame),this.currentFrame=void 0),t?.noDraw&&this.plugin.canvas3d?.pause(t?.noDraw)}};var wG=class{constructor(t){this.plugin=t;this.ev=Tc.create();this.events={updated:this.ev(),removed:this.ev()};this.root=new Map;this.tracked=new Map;t.state.data.events.object.created.subscribe(r=>{this.addMapping(r.state,r.ref,r.obj)}),t.state.data.events.object.removed.subscribe(r=>{this.removeMapping(r.ref)&&this.events.removed.next({ref:r.ref,obj:r.obj})}),t.state.data.events.object.updated.subscribe(r=>{this.updateMapping(r.state,r.ref,r.oldObj,r.obj)&&this.events.updated.next({ref:r.ref,oldObj:r.oldObj,obj:r.obj})})}getDecorator(t){let r=this.plugin.state.data.tree,n=r.children.get(t);if(n.size!==1)return t;let o=n.first();return o&&r.transforms.get(o).transformer.definition.isDecorator?this.getDecorator(o):t}get(t,r=!1){let n=this.root.get(t);if(n)return r?this.plugin.state.data.cells.get(n.ref):this.plugin.state.data.cells.get(this.getDecorator(n.ref))}addMapping(t,r,n){if(!ne.Molecule.Structure.is(n))return!1;if(this.tracked.set(r,n.data),this.root.has(n.data)){let o=this.root.get(n.data);o.count++}else{let o=t.select(tr.Generators.byRef(r).rootOfType([ne.Molecule.Structure]))[0];o?this.root.set(n.data,{ref:o.transform.ref,count:1}):this.root.set(n.data,{ref:r,count:1})}return!0}removeMapping(t){if(!this.tracked.has(t))return!1;let r=this.tracked.get(t);this.tracked.delete(t);let n=this.root.get(r);return n.count>1?n.count--:this.root.delete(r),!0}updateMapping(t,r,n,o){return ne.Molecule.Structure.is(o)?(this.removeMapping(r),this.addMapping(t,r,o),!0):!1}dispose(){this.ev.dispose()}};var wP=class{constructor(){this.ev=Tc.create();this.id=0;this.runningTasks=new Set;this.abortRequests=new Map;this.options=new Map;this.currentContext=[];this.events={progress:this.ev(),finished:this.ev()}}tryGetAbortTaskId(t){if(this.abortRequests.has(t.progress.taskId))return t.progress.taskId;for(let r of t.children){let n=this.tryGetAbortTaskId(r);if(n!==void 0)return n}}track(t,r){return n=>{if(n.canAbort&&n.requestAbort){let i=this.tryGetAbortTaskId(n.root);i!==void 0&&n.requestAbort(this.abortRequests.get(i))}let o=En()-n.root.progress.startedTime;this.events.progress.next({id:t,useOverlay:this.options.get(r)?.useOverlay,level:o<250?"none":"background",progress:n})}}async run(t,r){let n=this.id++,o;r?.createNewContext||this.currentContext.length===0?o={ctx:fle(t,this.track(n,t.id),100),refCount:1}:(o=this.currentContext[this.currentContext.length-1],o.refCount++);try{return this.options.set(t.id,{useOverlay:!!r?.useOverlay}),this.runningTasks.add(t.id),await OB(o.ctx,t)}finally{this.options.delete(t.id),this.runningTasks.delete(t.id),this.events.finished.next({id:n}),this.abortRequests.delete(t.id),o.refCount--,o.refCount===0&&Sf(this.currentContext,o)}}requestAbortAll(t){this.runningTasks.forEach(r=>this.abortRequests.set(r,t))}requestAbort(t,r){let n=typeof t=="number"?t:t.root.progress.taskId;this.abortRequests.set(n,r)}dispose(){this.ev.dispose()}};(r=>{function e(n){return new Promise(o=>setTimeout(o,n))}function t(n){return Ae.create("Test",async o=>{let i=0;for(;i<n;)await e(100+Math.random()*200),o.shouldUpdate&&await o.update({message:"Step "+i,current:i,max:n,isIndeterminate:!1}),i++})}r.testTask=t})(wP||={});var MG=class extends qs{constructor(r){super({entries:tl()});this.events={changed:this.ev()};this.serialNumber=0;this.serialId=0;lt.Toast.Show.subscribe(r,n=>this.show(n)),lt.Toast.Hide.subscribe(r,n=>this.hide(this.findByKey(n.key)))}findByKey(r){return this.state.entries.find(n=>!!n&&n.key===r)}show(r){let n=this.state.entries,o,i=++this.serialId,a;r.key&&(o=this.findByKey(r.key))?(o.timeout!==void 0&&clearTimeout(o.timeout),a=o.serialNumber,n=n.remove(o.id)):a=++this.serialNumber,o={id:i,serialNumber:a,key:r.key,title:r.title,message:r.message,timeout:this.timeout(i,r.timeoutMs),hide:()=>this.hideId(i)},this.updateState({entries:n.set(i,o)})&&this.events.changed.next(void 0)}timeout(r,n){if(n!==void 0)return n<0&&(n=500),setTimeout(()=>{let o=this.state.entries.get(r);o.timeout=void 0,this.hide(o)},n)}hideId(r){this.hide(this.state.entries.get(r))}hide(r){r&&(r.timeout!==void 0&&clearTimeout(r.timeout),r.hide=void 0,this.updateState({entries:this.state.entries.delete(r.id)})&&this.events.changed.next(void 0))}};function xSt(){let e=document.createElement("canvas");return e.getContext&&e.getContext("2d")?e.toDataURL("image/webp").indexOf("data:image/webp")===0:!1}var BG=class extends Pc{constructor(r){super();this.plugin=r;this._params=void 0;this.behaviors={values:this.ev.behavior({transparent:this.params.transparent.defaultValue,format:{name:"png",params:{}},axes:{name:"off",params:{}},resolution:this.params.resolution.defaultValue,illumination:this.params.illumination.defaultValue}),cropParams:this.ev.behavior({auto:!0,relativePadding:.1}),relativeCrop:this.ev.behavior({x:0,y:0,width:1,height:1})};this.events={previewed:this.ev()};this.canvas=(function(){return document.createElement("canvas")})();this.previewCanvas=(function(){return document.createElement("canvas")})();this.previewData={image:{data:new Uint8ClampedArray(1),width:1,height:0},background:0,transparent:!1}}createParams(){let r=8192;if(this.plugin.canvas3d){let{webgl:n}=this.plugin.canvas3d;r=Math.floor(Math.min(n.maxRenderbufferSize,n.maxTextureSize)/2)}return{resolution:C.MappedStatic("viewport",{viewport:C.Group({}),hd:C.Group({}),"full-hd":C.Group({}),"ultra-hd":C.Group({}),custom:C.Group({width:C.Numeric(1920,{min:128,max:r,step:1}),height:C.Numeric(1080,{min:128,max:r,step:1})},{isFlat:!0})},{options:[["viewport","Viewport"],["hd","HD (1280 x 720)"],["full-hd","Full HD (1920 x 1080)"],["ultra-hd","Ultra HD (3840 x 2160)"],["custom","Custom"]]}),format:C.MappedStatic("png",{png:C.Group({}),webp:C.Group({quality:C.Numeric(.9,{min:0,max:1,step:.01})}),jpeg:C.Group({quality:C.Numeric(.9,{min:0,max:1,step:.01})})},{options:[["png","PNG"],["jpeg","JPEG"],...xSt()?[["webp","WebP"]]:[]]}),transparent:C.Boolean(!1),axes:UC.axes,illumination:C.Group({extraIterations:C.Numeric(1,{min:0,max:5,step:1}),targetIterationTimeMs:C.Numeric(300,{min:100,max:3e3,step:10})})}}get params(){return this._params?this._params:this._params=this.createParams()}get values(){return this.behaviors.values.value}get cropParams(){return this.behaviors.cropParams.value}get relativeCrop(){return this.behaviors.relativeCrop.value}getCanvasSize(){return{width:this.plugin.canvas3d?.webgl.gl.drawingBufferWidth||0,height:this.plugin.canvas3d?.webgl.gl.drawingBufferHeight||0}}getSize(){let r=this.values;switch(r.resolution.name){case"viewport":return this.getCanvasSize();case"hd":return{width:1280,height:720};case"full-hd":return{width:1920,height:1080};case"ultra-hd":return{width:3840,height:2160};default:return{width:r.resolution.params.width,height:r.resolution.params.height}}}getPostprocessingProps(){let r=this.plugin.canvas3d,n=r.props.postprocessing.occlusion;return{...r.props.postprocessing,occlusion:n.name==="on"?{name:"on",params:{...n.params,samples:128,resolutionScale:r.webgl.pixelRatio,transparentThreshold:1}}:n}}getIlluminationProps(r){let o=this.plugin.canvas3d.props.illumination,{extraIterations:i,targetIterationTimeMs:a}=this.values.illumination;return{...o,enabled:r?!1:o.enabled,maxIterations:Math.ceil(Math.log2(Math.pow(2,o.maxIterations+i)*o.rendersPerFrame[1])),targetFps:1e3/a,denoiseThreshold:[o.denoiseThreshold[0],o.denoiseThreshold[0]],rendersPerFrame:[1,1]}}createPass(r){let n=this.plugin.canvas3d,{colorBufferFloat:o,textureFloat:i}=n.webgl.extensions;return n.getImagePass({transparentBackground:this.values.transparent,cameraHelper:{axes:this.values.axes},multiSample:{...n.props.multiSample,mode:r?"off":"on",sampleLevel:o&&i?4:2,reuseOcclusion:!1},postprocessing:this.getPostprocessingProps(),marking:{...n.props.marking},illumination:this.getIlluminationProps(r)})}get previewPass(){return this._previewPass||(this._previewPass=this.createPass(!0))}get imagePass(){if(this._imagePass){let r=this.plugin.canvas3d;return this._imagePass.setProps({cameraHelper:{axes:this.values.axes},transparentBackground:this.values.transparent,postprocessing:this.getPostprocessingProps(),marking:{...r.props.marking},illumination:this.getIlluminationProps(!1)}),this._imagePass}return this._imagePass=this.createPass(!1)}getFilename(r){typeof r!="string"&&(r=this.extension);let n=this.plugin.state.data.select(tr.Generators.rootsOfType(ne.Molecule.Model)).map(a=>a.obj.data),o=new Set;return n.forEach(a=>o.add(a.entryId.toUpperCase())),`${go.toArray(o).join("-")||"molstar-image"}${r}`}resetCrop(){this.behaviors.relativeCrop.next({x:0,y:0,width:1,height:1})}toggleAutocrop(){this.cropParams.auto?(this.behaviors.cropParams.next({...this.cropParams,auto:!1}),this.resetCrop()):this.behaviors.cropParams.next({...this.cropParams,auto:!0})}get isFullFrame(){let r=this.relativeCrop;return mo(r.x,0,1e-5)&&mo(r.y,0,1e-5)&&mo(r.width,1,1e-5)&&mo(r.height,1,1e-5)}autocrop(r=this.cropParams.relativePadding){let{data:n,width:o,height:i}=this.previewData.image,a=this.previewData.transparent,s=a?this.previewData.background:4278190080|this.previewData.background,l=o,u=0,c=i,m=0;for(let f=0;f<i;f++){let g=f*o;for(let y=0;y<o;y++){let x=4*(g+y);if(a){if(n[x+3]===0)continue}else if((n[x]<<16|n[x+1]<<8|n[x+2]|n[x+3]<<24)===s)continue;y<l&&(l=y),y>u&&(u=y),f<c&&(c=f),f>m&&(m=f)}}if(l>u){let f=l;l=u,u=f}if(c>m){let f=c;c=m,m=f}let d=u-l+1,p=m-c+1;l-=r*d,u+=r*d,c-=r*p,m+=r*p;let h={x:Math.max(0,l/o),y:Math.max(0,c/i),width:Math.min(1,(u-l+1)/o),height:Math.min(1,(m-c+1)/i)};this.behaviors.relativeCrop.next(h)}async getPreview(r,n=320){let{width:o,height:i}=this.getSize();if(o<=0||i<=0)return;let a=o/i,s=0,l=0;a>1?(s=n,l=Math.round(n/a)):(l=n,s=Math.round(n*a));let u=this.plugin.canvas3d.props;this.previewPass.setProps({cameraHelper:{axes:this.values.axes},transparentBackground:this.values.transparent,postprocessing:u.postprocessing,marking:u.marking});let c=await this.previewPass.getImageData(r,s,l),m=this.previewCanvas;m.width=c.width,m.height=c.height,this.previewData.image=c,this.previewData.background=u.renderer.backgroundColor,this.previewData.transparent=this.values.transparent;let d=m.getContext("2d");if(!d)throw new Error("Could not create canvas 2d context");return d.putImageData(c,0,0),this.cropParams.auto&&this.autocrop(),this.events.previewed.next(void 0),{canvas:m,width:s,height:l}}getSizeAndViewport(){let{width:r,height:n}=this.getSize(),o=this.relativeCrop,i={x:Math.floor(o.x*r),y:Math.floor(o.y*n),width:Math.ceil(o.width*r),height:Math.ceil(o.height*n)};return i.width+i.x>r&&(i.width=r-i.x),i.height+i.y>n&&(i.height=n-i.y),{width:r,height:n,viewport:i}}async draw(r){let{width:n,height:o,viewport:i}=this.getSizeAndViewport();if(!(n<=0||o<=0)){this.plugin.animationLoop.stop({noDraw:!0});try{await r.update("Rendering image...");let a=this.imagePass;await a.updateBackground();let s=await a.getImageData(r,n,o,i);await r.update("Encoding image...");let l=this.canvas;l.width=s.width,l.height=s.height;let u=l.getContext("2d");if(!u)throw new Error("Could not create canvas 2d context");u.putImageData(s,0,0)}finally{this.plugin.animationLoop.start({immediate:!0})}}}copyToClipboardTask(){let r=navigator.clipboard;if(!r?.write){this.plugin.log.error("clipboard.write not supported!");return}return Ae.create("Copy Image",async n=>{await this.draw(n),await n.update("Converting image...");let o=this.mimeType,i=await uD(this.canvas,o,this.quality),a=new ClipboardItem({[o]:i});await r.write([a]),this.plugin.log.message("Image copied to clipboard.")})}get mimeType(){return`image/${this.values.format?.name??"png"}`}get extension(){return this.values.format?.name==="jpeg"?".jpg":`.${this.values.format?.name??"png"}`}get quality(){switch(this.values.format?.name){case"webp":case"jpeg":return this.values.format?.params?.quality??.9;default:return}}getImageDataUri(){return this.plugin.runTask(Ae.create("Generate Image",async r=>(await this.draw(r),await r.update("Converting image..."),this.canvas.toDataURL(this.mimeType))))}copyToClipboard(){let r=this.copyToClipboardTask();if(r)return this.plugin.runTask(r)}downloadTask(r){return Ae.create("Download Image",async n=>{await this.draw(n),await n.update("Downloading image...");let o=await uD(this.canvas,this.mimeType,this.quality);sT(o,r??this.getFilename(this.extension))})}download(r){return this.plugin.runTask(this.downloadTask(r),{useOverlay:!0})}};var EG=class{constructor(t){this.plugin=t;this.handlers=[]}addHandler(t,r){let n=this.handlers.findIndex(o=>o[0]===t);n<0?this.handlers.push([t,r]):this.handlers[n][1]=r}removeHandler(t){let r=this.handlers.findIndex(n=>n[0]===t);r>=0&&this.handlers.splice(r,1)}async handle(t){for(let r=this.handlers.length-1;r>=0;r--){let n=this.handlers[r][1];if(await n(t,this.plugin))return}CSt(this.plugin,t)}dispose(){this.handlers.length=0}};function CSt(e,t){let r=t.filter(n=>{let o=n.name.toLowerCase();return o.endsWith(".molx")||o.endsWith(".molj")});r.length>0?lt.State.Snapshots.OpenFile(e,{file:r[0]}):e.runTask(e.state.data.applyAction(qD,{files:t.map(n=>sn.File(n)),format:{name:"auto",params:{}},visuals:!0}))}var kG=class{constructor(){this.errors=Object.create(null)}get(t){return this.errors[t]??[]}add(t,r){t in this.errors&&Array.isArray(this.errors[t])?this.errors[t].push(r):this.errors[t]=[r]}clear(t){delete this.errors[t]}};var FG=class{constructor(t){this.options=t;let r=document.createElement("div");Object.assign(r.style,{position:"absolute",left:0,top:0,right:0,bottom:0,"-webkit-user-select":"none","user-select":"none","-webkit-tap-highlight-color":"rgba(0,0,0,0)","-webkit-touch-callout":"none","touch-action":"manipulation"});let n=t?.canvas;n||(n=document.createElement("canvas"),r.appendChild(n)),this.canvas=n,this.parent=r}mount(t){this.parent.parentElement!==t&&this.parent.parentElement?.removeChild(this.parent),t.appendChild(this.parent)}unmount(){this.parent.parentElement?.removeChild(this.parent)}};var LG=class{constructor(t){this.spec=t;this.runTask=(t,r)=>this.managers.task.run(t,r);this.resolveTask=t=>{if(t)return Ae.is(t)?this.runTask(t):t};this.subs=[];this.initCanvas3dPromiseCallbacks=[()=>{},()=>{}];this._isInitialized=!1;this.initializedPromiseCallbacks=[()=>{},()=>{}];this.disposed=!1;this.container=void 0;this.ev=Tc.create();this.config=new aV(this.spec.config);this.state=new yu(this);this.commands=new iV;this.canvas3dInit=this.ev.behavior(!1);this.behaviors={state:{isAnimating:this.ev.behavior(!1),isUpdating:this.ev.behavior(!1),isBusy:this.ev.behavior(!1)},interaction:{hover:this.ev.behavior({current:Ut.Loci.Empty,modifiers:cs.None,buttons:0,button:0}),click:this.ev.behavior({current:Ut.Loci.Empty,modifiers:cs.None,buttons:0,button:0}),drag:this.ev.behavior({current:Ut.Loci.Empty,modifiers:cs.None,buttons:0,button:0,pageStart:Ce(),pageEnd:Ce()}),key:this.ev.behavior(CX),keyReleased:this.ev.behavior(CX),selectionMode:this.ev.behavior(!1)},labels:{highlight:this.ev.behavior({labels:[]})},layout:{leftPanelTabName:this.ev.behavior("root")},canvas3d:{initialized:this.canvas3dInit.pipe(Rh(t=>!!t),eU(1))}};this.canvas3dInitialized=new Promise((t,r)=>{this.initCanvas3dPromiseCallbacks=[t,r]});this.initialized=new Promise((t,r)=>{this.initializedPromiseCallbacks=[t,r]});this.layout=new D4(this);this.animationLoop=new DG(this);this.representation={structure:{registry:new DP,themes:{colorThemeRegistry:vs.createRegistry(),sizeThemeRegistry:Bo.createRegistry()}},volume:{registry:new c0,themes:{colorThemeRegistry:vs.createRegistry(),sizeThemeRegistry:Bo.createRegistry()}}};this.query={structure:{registry:new ZF}};this.dataFormats=new S4;this.builders={data:new f4(this),structure:void 0};this.helpers={substructureParent:new wG(this),viewportScreenshot:void 0};this.managers={structure:{hierarchy:new $g(this),component:new Kp(this),measurement:new xO(this),selection:new P4(this),focus:new _4(this)},volume:{hierarchy:new i0(this)},interactivity:void 0,camera:new A4(this),animation:new v4(this),snapshot:new jp(this),lociLabels:void 0,toast:new MG(this),asset:new WB,task:new wP,markdownExtensions:new R4(this),dragAndDrop:new EG(this)};this.events={log:this.ev(),task:this.managers.task.events,canvas3d:{settingsUpdated:this.ev()}};this.customModelProperties=new p4.Registry;this.customStructureProperties=new p4.Registry;this.customStructureControls=new Map;this.customImportControls=new Map;this.genericRepresentationControls=new Map;this.errorContext=new kG;this.customState=Object.create(null);this.handleResize=()=>{let t=this.canvas3dContext?.canvas,r=this.layout.root;r&&t&&(vPe(t,r,this.canvas3dContext.pixelScale),this.canvas3dContext.syncPixelScale(),this.canvas3d?.requestResize())};this.log={entries:qh(),entry:t=>this.events.log.next(t),error:t=>this.events.log.next(Gf.error(t)),message:t=>this.events.log.next(Gf.message(t)),info:t=>this.events.log.next(Gf.info(t)),warn:t=>this.events.log.next(Gf.warning(t))};this.fetch=R_;mce(this.config.get(Lr.Structure.SaccharideCompIdMapType)??"default")}get isInitialized(){return this._isInitialized}build(){return this.state.data.build()}async initViewerAsync(t,r,n){return this._initViewer(t,r,n)}async initContainerAsync(t){return this._initContainer(t)}async mountAsync(t,r){return this._mount(t,r)}_initContainer(t){if(this.container)return!0;let r=new FG({checkeredCanvasBackground:t?.checkeredCanvasBackground,canvas:t?.canvas3dContext?.canvas});return this._initViewer(r.canvas,r.parent,t?.canvas3dContext)?(t?.checkeredCanvasBackground&&this.canvas3d?.setProps({checkeredTransparentBackground:!0}),this.container=r,!0):!1}_mount(t,r){if(this.disposed)throw new Error("Cannot mount a disposed context");return this._initContainer(r)?(this.container?.mount(t),this.handleResize(),!0):!1}unmount(){this.container?.unmount()}_initViewer(t,r,n){try{this.layout.setRoot(r),this.spec.layout&&this.spec.layout.initial&&this.layout.setProps(this.spec.layout.initial),n||(n=lh.fromCanvas(t,this.managers.asset,{antialias:!(this.config.get(Lr.General.DisableAntialiasing)??!1),preserveDrawingBuffer:!(this.config.get(Lr.General.DisablePreserveDrawingBuffer)??!1),preferWebGl1:this.config.get(Lr.General.PreferWebGl1)||!1,failIfMajorPerformanceCaveat:!(this.config.get(Lr.General.AllowMajorPerformanceCaveat)??!1),powerPreference:this.config.get(Lr.General.PowerPreference)||"high-performance",handleResize:this.handleResize},{pixelScale:this.config.get(Lr.General.PixelScale)||1,pickScale:this.config.get(Lr.General.PickScale)||.25,transparency:this.config.get(Lr.General.Transparency)||"wboit",resolutionMode:this.config.get(Lr.General.ResolutionMode)||"auto"})),this.canvas3dContext=n,this.canvas3d=NX.create(this.canvas3dContext),this.canvas3dInit.next(!0);let o=this.spec.canvas3d,i=16579577;return o?(o.renderer?.backgroundColor===void 0&&(o=Pl(o,a=>{a.renderer?a.renderer.backgroundColor=i:a.renderer={backgroundColor:i}})),this.canvas3d?.setProps(o)):this.canvas3d?.setProps({renderer:{backgroundColor:i}}),this.animationLoop.start(),this.helpers.viewportScreenshot=new BG(this),this.subs.push(this.canvas3d.interaction.click.subscribe(a=>this.behaviors.interaction.click.next(a))),this.subs.push(this.canvas3d.interaction.drag.subscribe(a=>this.behaviors.interaction.drag.next(a))),this.subs.push(this.canvas3d.interaction.hover.subscribe(a=>this.behaviors.interaction.hover.next(a))),this.subs.push(this.canvas3d.input.resize.pipe(Zb(50),Xu(100,void 0,{leading:!1,trailing:!0})).subscribe(()=>this.handleResize())),this.subs.push(this.canvas3d.input.keyDown.subscribe(a=>this.behaviors.interaction.key.next(a))),this.subs.push(this.canvas3d.input.keyUp.subscribe(a=>this.behaviors.interaction.keyReleased.next(a))),this.subs.push(this.canvas3d.xr.isPresenting.subscribe(a=>this.log.info(`WebXR ${a?"enabled":"disabled"}`))),this.subs.push(this.canvas3d.xr.requestFailed.subscribe(a=>this.log.error(`WebXR request failed: ${a}`))),this.subs.push(this.layout.events.updated.subscribe(()=>requestAnimationFrame(()=>this.handleResize()))),this.handleResize(),Vf.setImmediate(()=>this.initCanvas3dPromiseCallbacks[0]()),!0}catch(o){return this.log.error(""+o),console.error(o),Vf.setImmediate(()=>this.initCanvas3dPromiseCallbacks[1](o)),!1}}get isBusy(){return this.behaviors.state.isAnimating.value||this.behaviors.state.isUpdating.value}get selectionMode(){return this.behaviors.interaction.selectionMode.value}set selectionMode(t){this.behaviors.interaction.selectionMode.next(t)}dataTransaction(t,r){return this.runTask(this.state.data.transaction(t,r))}clear(t=!1){return t&&this.canvas3d?.setProps(Ud),lt.State.RemoveObject(this,{state:this.state.data,ref:Br.RootRef})}dispose(t){if(!this.disposed){for(let r of this.subs)r.unsubscribe();this.subs=[],this.layout.dispose(),this.managers.markdownExtensions.audio.dispose(),this.animationLoop.stop(),this.commands.dispose(),this.canvas3d?.dispose(),t?.doNotDisposeCanvas3DContext||this.canvas3dContext?.dispose(t),this.ev.dispose(),this.state.dispose(),this.helpers.substructureParent.dispose(),wi(this.managers,r=>r?.dispose?.()),wi(this.managers.structure,r=>r?.dispose?.()),wi(this.managers.volume,r=>r?.dispose?.()),this.unmount(),this.container=void 0,this.customState={},this.disposed=!0}}initBehaviorEvents(){this.subs.push(fm(this.state.data.behaviors.isUpdating,this.state.behaviors.behaviors.isUpdating).subscribe(a=>{this.behaviors.state.isUpdating.value!==a&&this.behaviors.state.isUpdating.next(a)}));let t=this.config.get(Lr.General.IsBusyTimeoutMs)||750,r=this.behaviors.state.isBusy,n,o=()=>{r.value||r.next(!0)},i=()=>{n!==void 0&&clearTimeout(n),n=void 0};this.subs.push(fm(this.behaviors.state.isUpdating,this.behaviors.state.isAnimating).subscribe(a=>{let s=this.behaviors.state.isUpdating.value,l=this.behaviors.state.isAnimating.value;s||l?r.value||(i(),n=setTimeout(o,t)):(i(),r.next(!1))})),this.subs.push(this.behaviors.interaction.selectionMode.subscribe(a=>{a||this.managers.interactivity?.lociSelects.deselectAll()}))}initBuiltInBehavior(){lD.State.registerDefault(this),lD.Representation.registerDefault(this),lD.Camera.registerDefault(this),lD.Misc.registerDefault(this),this.subs.push(fm(this.state.data.events.log,this.state.behaviors.events.log).subscribe(t=>this.events.log.next(t)))}async initBehaviors(){let t=this.state.behaviors.build();for(let r of Object.keys(Kr.Categories))t.toRoot().apply(Kr.CreateCategory,{label:Kr.Categories[r]},{ref:r,state:{isLocked:!0}});for(let r of this.spec.behaviors)Kr.getCategoryId(r.transformer)==="custom-props"&&t.to(Kr.getCategoryId(r.transformer)).apply(r.transformer,r.defaultParams,{ref:r.transformer.id});await this.runTask(this.state.behaviors.updateTree(t,{doNotUpdateCurrent:!0,doNotLogTiming:!0})),t=this.state.behaviors.build();for(let r of this.spec.behaviors)Kr.getCategoryId(r.transformer)!=="custom-props"&&t.to(Kr.getCategoryId(r.transformer)).apply(r.transformer,r.defaultParams,{ref:r.transformer.id});await this.runTask(this.state.behaviors.updateTree(t,{doNotUpdateCurrent:!0,doNotLogTiming:!0}))}initCustomFormats(){if(this.spec.customFormats)for(let t of this.spec.customFormats)this.dataFormats.add(t[0],t[1])}initAnimations(){if(this.spec.animations)for(let t of this.spec.animations)this.managers.animation.register(t)}initDataActions(){if(this.spec.actions)for(let t of this.spec.actions)this.state.data.actions.add(t.action)}async init(){try{this.subs.push(this.events.log.subscribe(t=>this.log.entries=this.log.entries.push(t))),this.initCustomFormats(),this.initBehaviorEvents(),this.initBuiltInBehavior(),this.managers.interactivity=new n0(this),this.managers.lociLabels=new T4(this),this.builders.structure=new x4(this),this.initAnimations(),this.initDataActions(),await this.initBehaviors(),this.log.message(`Mol* Plugin ${SV} [${SPe.toLocaleString()}]`),Xx||this.log.message("Development mode enabled"),Yt&&this.log.message("Debug mode enabled"),this._isInitialized=!0,this.initializedPromiseCallbacks[0]()}catch(t){throw this.initializedPromiseCallbacks[1](t),t}}};var VG=class extends LG{constructor(r){super(r);this.spec=r;this.customParamEditors=new Map;this.customUIState={};this.initCustomParamEditors()}initCustomParamEditors(){if(this.spec.customParamEditors)for(let[r,n]of this.spec.customParamEditors)this.customParamEditors.set(r.id,n)}dispose(r){super.dispose(r),this.layout.dispose()}};var FBe=bc.create({name:"built-in.animate-assembly-unwind",display:{name:"Unwind Assembly"},isExportable:!0,params:e=>{let t=[["all","All"]],r=e.state.data.select(tr.Generators.rootsOfType(ne.Molecule.Structure));for(let n of r)t.push([n.transform.ref,n.obj.data.models[0].label]);return{durationInMs:C.Numeric(3e3,{min:100,max:1e4,step:100}),playOnce:C.Boolean(!1),target:C.Select(t[0][0],t)}},canApply(e){let t=e.state.data,r=Br.RootRef;return{canApply:t.select(tr.Generators.ofType(ne.Molecule.Structure.Representation3D,r)).length>0}},getDuration:e=>({kind:"fixed",durationMs:e.durationInMs}),initialState:()=>({t:0}),setup(e,t,r){let n=r.state.data,o=!e.target||e.target==="all"?Br.RootRef:e.target,i=n.select(tr.Generators.ofType(ne.Molecule.Structure.Representation3D,o)),a=n.build(),s=!1;for(let l of i)n.select(tr.Generators.ofTransformer(Qe.Representation.UnwindStructureAssemblyRepresentation3D,l.transform.ref)).length>0||(s=!0,a.to(l).apply(Qe.Representation.UnwindStructureAssemblyRepresentation3D,{t:0},{tags:"animate-assembly-unwind"}));if(s)return a.commit({doNotUpdateCurrent:!0})},teardown(e,t,r){let n=r.state.data,o=n.select(tr.Generators.ofType(ne.Molecule.Structure.Representation3DState).withTag("animate-assembly-unwind"));if(o.length===0)return;let i=n.build();for(let a of o)i.delete(a.transform.ref);return i.commit()},async apply(e,t,r){let n=r.plugin.state.data,o=!r.params.target||r.params.target==="all"?Br.RootRef:r.params.target,i=n.select(tr.Generators.ofTransformer(Qe.Representation.UnwindStructureAssemblyRepresentation3D,o));if(i.length===0)return{kind:"finished"};let a=n.build(),s=(t.current-t.lastApplied)/r.params.durationInMs,l=e.t+s,u=!1;r.params.playOnce&&l>=1?(u=!0,l=1):l=l%1;for(let c of i)a.to(c).update({t:l});return await lt.State.Update(r.plugin,{state:n,tree:a,options:{doNotLogTiming:!0}}),u?{kind:"finished"}:{kind:"next",state:{t:l}}}});var OG=b(),LBe=b(),VBe=lr(),OBe=bc.create({name:"built-in.animate-camera-spin",display:{name:"Camera Spin",description:"Spin the 3D scene around the x-axis in view space"},isExportable:!0,params:()=>({durationInMs:C.Numeric(4e3,{min:100,max:2e4,step:100}),speed:C.Numeric(1,{min:1,max:10,step:1},{description:"How many times to spin in the specified duration."}),direction:C.Select("cw",[["cw","Clockwise"],["ccw","Counter Clockwise"]],{cycle:!0})}),initialState:(e,t)=>({snapshot:t.canvas3d?.camera.getSnapshot()}),getDuration:e=>({kind:"fixed",durationMs:e.durationInMs}),teardown:(e,t,r)=>{r.canvas3d?.requestCameraReset({snapshot:t.snapshot,durationMs:0})},async apply(e,t,r){if(t.current===0)return{kind:"next",state:e};let n=e.snapshot;if(n.radiusMax<1e-4)return{kind:"finished"};let o=t.animation?t.animation?.currentFrame/(t.animation.frameCount+1):_r(t.current/r.params.durationInMs,0,1),i=2*Math.PI*o*r.params.speed*(r.params.direction==="ccw"?-1:1);b.sub(OG,n.position,n.target),b.normalize(LBe,n.up),lr.setAxisAngle(VBe,LBe,i),b.transformQuat(OG,OG,VBe);let a=b.add(b(),n.target,OG);return r.plugin.canvas3d?.requestCameraReset({snapshot:{...n,position:a},durationMs:0}),o>=.99999?{kind:"finished"}:{kind:"next",state:e}}});var GBe=bc.create({name:"built-in.animate-model-index",display:{name:"Animate Trajectory"},isExportable:!0,params:()=>({mode:C.MappedStatic("loop",{palindrome:C.Group({}),loop:C.Group({direction:C.Select("forward",[["forward","Forward"],["backward","Backward"]])}),once:C.Group({direction:C.Select("forward",[["forward","Forward"],["backward","Backward"]])},{isFlat:!0})},{options:[["palindrome","Palindrome"],["loop","Loop"],["once","Once"]]}),duration:C.MappedStatic("fixed",{fixed:C.Group({durationInS:C.Numeric(5,{min:1,max:120,step:.1},{description:"Duration in seconds"})},{isFlat:!0}),computed:C.Group({targetFps:C.Numeric(30,{min:5,max:250,step:1},{label:"Target FPS"})},{isFlat:!0}),sequential:C.Group({maxFps:C.Numeric(30,{min:5,max:60,step:1})},{isFlat:!0})})}),canApply(e){let t=e.state.data,r=t.select(tr.Generators.ofTransformer(Qe.Model.ModelFromTrajectory));for(let n of r){let o=tr.findAncestorOfType(t.tree,t.cells,n.transform.ref,ne.Molecule.Trajectory);if(o&&o.obj&&o.obj.data.frameCount>1)return{canApply:!0}}return{canApply:!1,reason:"No trajectory to animate"}},getDuration:(e,t)=>{if(e.duration?.name==="fixed")return{kind:"fixed",durationMs:e.duration.params.durationInS*1e3};if(e.duration.name==="computed"){let r=t.state.data,n=r.select(tr.Generators.ofTransformer(Qe.Model.ModelFromTrajectory)),o=0;for(let i of n){let a=tr.findAncestorOfType(r.tree,r.cells,i.transform.ref,ne.Molecule.Trajectory);if(!a||!a.obj)continue;let s=a.obj;o=Math.max(Math.ceil(1e3*s.data.frameCount/e.duration.params.targetFps),o)}return{kind:"fixed",durationMs:o}}return{kind:"unknown"}},initialState:()=>({}),async apply(e,t,r){if(r.params.duration.name==="sequential"&&t.current>0&&t.current-t.lastApplied<1e3/r.params.duration.params.maxFps)return{kind:"skip"};let n=r.plugin.state.data,o=n.select(tr.Generators.ofTransformer(Qe.Model.ModelFromTrajectory));if(o.length===0)return{kind:"finished"};let i=n.build(),a=r.params,s=e.palindromeDirections||{},l=!1,u=!0;for(let c of o){let m=tr.findAncestorOfType(n.tree,n.cells,c.transform.ref,ne.Molecule.Trajectory);if(!m||!m.obj)continue;let d=m.obj;d.data.frameCount<=1||i.to(c).update(p=>{let h=d.data.frameCount;if(h!==1)u=!1;else return p;if(a.duration.name==="sequential"){let f=1;if(a.mode.name==="once"){if(f=a.mode.params.direction==="backward"?-1:1,f===-1&&p.modelIndex===0||f===1&&p.modelIndex===h-1)return l=!0,p}else a.mode.name==="palindrome"&&(p.modelIndex===0?f=1:p.modelIndex===h-1?f=-1:f=s[c.transform.ref]||1);s[c.transform.ref]=f;let g=(p.modelIndex+f)%h;return g<0&&(g+=h),l=l||f===-1&&g===0||f===1&&g===h-1,{modelIndex:g}}else{let f=a.duration.name==="fixed"?a.duration.params.durationInS*1e3:Math.ceil(1e3*d.data.frameCount/a.duration.params.targetFps);if(a.mode.name==="once"&&t.current>=f)return l=!0,{modelIndex:d.data.frameCount-1};let g=t.current%f/f;return a.mode.name==="loop"&&a.mode.params.direction==="backward"&&(g=1-g),a.mode.name==="palindrome"&&(g=2*g,g>1&&(g=2-g)),{modelIndex:Math.min(Math.floor(d.data.frameCount*g),d.data.frameCount-1)}}})}return u||await lt.State.Update(r.plugin,{state:n,tree:i,options:{doNotLogTiming:!0}}),u||a.mode.name==="once"&&l?{kind:"finished"}:a.mode.name==="palindrome"?{kind:"next",state:{palindromeDirections:s}}:{kind:"next",state:{}}}});var lJ={};Gi(lJ,{AssignColorVolume:()=>sJ,DownloadDensity:()=>SSt});var SSt=Gs.build({from:ne.Root,display:{name:"Download Density",description:"Load a density from the provided source and create its default visual."},params:(e,t)=>{let{options:r}=t.dataFormats;return{source:C.MappedStatic("pdb-xray",{"pdb-xray":C.Group({provider:C.Group({id:C.Text("1tqn",{label:"Id"}),server:C.Select("pdbe",[["pdbe","PDBe"]])},{pivot:"id"}),type:C.Select("2fofc",[["2fofc","2Fo-Fc"],["fofc","Fo-Fc"]])},{isFlat:!0}),"pdb-xray-ds":C.Group({provider:C.Group({id:C.Text("1tqn",{label:"Id"}),server:C.Select("pdbe",[["pdbe","PDBe"],["rcsb","RCSB PDB"]])},{pivot:"id"}),detail:C.Numeric(3,{min:0,max:6,step:1},{label:"Detail"})},{isFlat:!0}),"pdb-emd-ds":C.Group({provider:C.Group({id:C.Text("emd-8004",{label:"Id"}),server:C.Select("pdbe",[["pdbe","PDBe"],["rcsb","RCSB PDB"]])},{pivot:"id"}),detail:C.Numeric(3,{min:0,max:6,step:1},{label:"Detail"})},{isFlat:!0}),url:C.Group({url:C.Url(""),isBinary:C.Boolean(!1),format:C.Select("auto",r)},{isFlat:!0})},{options:[["pdb-xray","PDB X-ray maps"],["pdb-emd-ds","PDB EMD Density Server"],["pdb-xray-ds","PDB X-ray Density Server"],["url","URL"]]})}}})(({params:e},t)=>Ae.create("Download Density",async r=>{let n=e.source,o,i;switch(n.name){case"url":o=n.params;break;case"pdb-xray":o={url:sn.Url(n.params.type==="2fofc"?`https://www.ebi.ac.uk/pdbe/coordinates/files/${n.params.provider.id.toLowerCase()}.ccp4`:`https://www.ebi.ac.uk/pdbe/coordinates/files/${n.params.provider.id.toLowerCase()}_diff.ccp4`),isBinary:!0,label:`PDBe X-ray map: ${n.params.provider.id}`};break;case"pdb-emd-ds":o=n.params.provider.server==="pdbe"?{url:sn.Url(`https://www.ebi.ac.uk/pdbe/densities/emd/${n.params.provider.id.toLowerCase()}/cell?detail=${n.params.detail}`),isBinary:!0,label:`PDBe EMD Density Server: ${n.params.provider.id}`}:{url:sn.Url(`https://maps.rcsb.org/em/${n.params.provider.id.toLowerCase()}/cell?detail=${n.params.detail}`),isBinary:!0,label:`RCSB PDB EMD Density Server: ${n.params.provider.id}`};break;case"pdb-xray-ds":o=n.params.provider.server==="pdbe"?{url:sn.Url(`https://www.ebi.ac.uk/pdbe/densities/x-ray/${n.params.provider.id.toLowerCase()}/cell?detail=${n.params.detail}`),isBinary:!0,label:`PDBe X-ray Density Server: ${n.params.provider.id}`}:{url:sn.Url(`https://maps.rcsb.org/x-ray/${n.params.provider.id.toLowerCase()}/cell?detail=${n.params.detail}`),isBinary:!0,label:`RCSB PDB X-ray Density Server: ${n.params.provider.id}`};break;default:Mr(n)}let a=await t.builders.data.download(o),s;switch(n.name){case"url":o=n.params,i=n.params.format==="auto"?t.dataFormats.auto(Lb(sn.getUrl(o.url)),a.cell?.obj):t.dataFormats.get(n.params.format);break;case"pdb-xray":s=n.params.provider.id,i=t.dataFormats.get("ccp4");break;case"pdb-emd-ds":case"pdb-xray-ds":s=n.params.provider.id,i=t.dataFormats.get("dscif");break;default:Mr(n)}if(!i){t.log.warn("DownloadDensity: Format provider not found.");return}let l=await i.parse(t,a,{entryId:s});await i.visuals?.(t,l)})),sJ=Gs.build({display:{name:"Assign Volume Colors",description:"Assigns another volume to be available for coloring."},from:ne.Volume.Data,isApplicable(e){return!e.data.colorVolume},params(e,t){let r=t.state.data.select(tr.Generators.root.subtree().ofType(ne.Volume.Data).filter(n=>!!n.obj&&!n.obj?.data.colorVolume&&n.obj!==e));return r.length===0?{ref:C.Text("",{isHidden:!0,label:"Volume"})}:{ref:C.Select(r[0].transform.ref,r.map(n=>[n.transform.ref,n.obj.label]),{label:"Volume"})}}})(({ref:e,params:t,state:r},n)=>n.build().to(e).apply(Qe.Volume.AssignColorVolume,{ref:t.ref},{dependsOn:[t.ref]}).commit());var T0={Structure:jZ,Volume:lJ,DataFormat:MY};var UBe=bc.create({name:"built-in.animate-state-interpolation",display:{name:"Animate State (experimental)"},params:()=>({transtionDurationInMs:C.Numeric(2e3,{min:100,max:3e4,step:10})}),canApply(e){return{canApply:e.managers.snapshot.state.entries.size>1}},initialState:()=>({}),async apply(e,t,r){let n=r.plugin.managers.snapshot.state.entries;if(n.size<2)return{kind:"finished"};let o=t.current%r.params.transtionDurationInMs/r.params.transtionDurationInMs,i=Math.floor(t.current/r.params.transtionDurationInMs)%n.size,a=Math.ceil(t.current/r.params.transtionDurationInMs);a===i&&a++,a=a%n.size;let s=n.get(i).snapshot,l=n.get(a).snapshot;if(!s.data||!l.data)return{kind:"skip"};let u=s.data.tree.transforms,c=l.data.tree.transforms,m=r.plugin.state.data,d=m.build();for(let p of u)for(let h of c){if(h.ref!==p.ref||h.version===p.version)continue;let f=Br.fromJSON(p),g=Br.fromJSON(h),y=m.cells.get(p.ref);if(!y)continue;let x;f.transformer.definition.interpolate?x=f.transformer.definition.interpolate(f.params,g.params,o,r.plugin):x=o<=.5?f.params:g.params,Z0(y,x)||d.to(p.ref).update(x)}return await lt.State.Update(r.plugin,{state:m,tree:d,options:{doNotLogTiming:!0}}),{kind:"next",state:{}}}});var NBe=bc.create({name:"built-in.animate-structure-spin",display:{name:"Spin Structure"},isExportable:!0,params:()=>({durationInMs:C.Numeric(3e3,{min:100,max:1e4,step:100})}),initialState:()=>({t:0}),getDuration:e=>({kind:"fixed",durationMs:e.durationInMs}),async setup(e,t,r){let n=r.state.data,o=n.select(tr.Generators.ofType(ne.Molecule.Structure.Representation3D)),i=n.build(),a=!1;for(let s of o)n.select(tr.Generators.ofTransformer(Qe.Representation.SpinStructureRepresentation3D,s.transform.ref)).length>0||(a=!0,i.to(s.transform.ref).apply(Qe.Representation.SpinStructureRepresentation3D,{t:0},{tags:"animate-structure-spin"}));if(a)return i.commit({doNotUpdateCurrent:!0})},teardown(e,t,r){let n=r.state.data,o=n.select(tr.Generators.ofType(ne.Molecule.Structure.Representation3DState).withTag("animate-structure-spin"));if(o.length===0)return;let i=n.build();for(let a of o)i.delete(a.transform.ref);return i.commit()},async apply(e,t,r){let n=r.plugin.state.data,o=n.select(tr.Generators.ofTransformer(Qe.Representation.SpinStructureRepresentation3D));if(o.length===0)return{kind:"finished"};let i=n.build(),a=(t.current-t.lastApplied)/r.params.durationInMs,s=(e.t+a)%1;for(let l of o)i.to(l).update({...l.params?.values,t:s});return await lt.State.Update(r.plugin,{state:n,tree:i,options:{doNotLogTiming:!0}}),{kind:"next",state:{t:s}}}});var GG=b(),zBe=b(),HBe=lr(),jBe=bc.create({name:"built-in.animate-camera-rock",display:{name:"Camera Rock",description:"Rock the 3D scene around the x-axis in view space"},isExportable:!0,params:()=>({durationInMs:C.Numeric(4e3,{min:100,max:2e4,step:100}),speed:C.Numeric(1,{min:1,max:10,step:1},{description:"How many times to rock from side to side."}),angle:C.Numeric(10,{min:0,max:180,step:1},{description:"How many degrees to rotate in each direction."})}),initialState:(e,t)=>({snapshot:t.canvas3d.camera.getSnapshot()}),getDuration:e=>({kind:"fixed",durationMs:e.durationInMs}),teardown:(e,t,r)=>{r.canvas3d?.requestCameraReset({snapshot:t.snapshot,durationMs:0})},async apply(e,t,r){if(t.current===0)return{kind:"next",state:e};let n=e.snapshot;if(n.radiusMax<1e-4)return{kind:"finished"};let o=t.animation?t.animation?.currentFrame/(t.animation.frameCount+1):_r(t.current/r.params.durationInMs,0,1),i=Math.sin(o*r.params.speed*Math.PI*2)*kr(r.params.angle);b.sub(GG,n.position,n.target),b.normalize(zBe,n.up),lr.setAxisAngle(HBe,zBe,i),b.transformQuat(GG,GG,HBe);let a=b.add(b(),n.target,GG);return r.plugin.canvas3d?.requestCameraReset({snapshot:{...n,position:a},durationMs:0}),o>=.99999?{kind:"finished"}:{kind:"next",state:e}}});var jr;(r=>{function e(n,o){return{action:n,customControl:o&&o.customControl,autoUpdate:o&&o.autoUpdate}}r.Action=e;function t(n,o={}){return{transformer:n,defaultParams:o}}r.Behavior=t})(jr||={});var WBe=()=>({actions:[jr.Action(T0.Structure.DownloadStructure),jr.Action(T0.Volume.DownloadDensity),jr.Action(T0.DataFormat.DownloadFile),jr.Action(T0.DataFormat.OpenFiles),jr.Action(T0.Structure.LoadTrajectory),jr.Action(T0.Structure.EnableModelCustomProps),jr.Action(T0.Structure.EnableStructureCustomProps),jr.Action(UD),jr.Action(jDe),jr.Action(ND),jr.Action(Qe.Data.Download),jr.Action(Qe.Data.ParseCif),jr.Action(Qe.Data.ParseCcp4),jr.Action(Qe.Data.ParseDsn6),jr.Action(Qe.Model.TrajectoryFromMmCif),jr.Action(Qe.Model.TrajectoryFromCifCore),jr.Action(Qe.Model.TrajectoryFromPDB),jr.Action(Qe.Model.TransformStructureConformation),jr.Action(Qe.Model.StructureInstances),jr.Action(Qe.Model.StructureFromModel),jr.Action(Qe.Model.StructureFromTrajectory),jr.Action(Qe.Model.ModelFromTrajectory),jr.Action(Qe.Model.StructureSelectionFromScript),jr.Action(Qe.Representation.StructureRepresentation3D),jr.Action(Qe.Representation.StructureSelectionsDistance3D),jr.Action(Qe.Representation.StructureSelectionsAngle3D),jr.Action(Qe.Representation.StructureSelectionsDihedral3D),jr.Action(Qe.Representation.StructureSelectionsLabel3D),jr.Action(Qe.Representation.StructureSelectionsOrientation3D),jr.Action(Qe.Representation.ModelUnitcell3D),jr.Action(Qe.Representation.StructureBoundingBox3D),jr.Action(Qe.Representation.ExplodeStructureRepresentation3D),jr.Action(Qe.Representation.SpinStructureRepresentation3D),jr.Action(Qe.Representation.UnwindStructureAssemblyRepresentation3D),jr.Action(Qe.Representation.OverpaintStructureRepresentation3DFromScript),jr.Action(Qe.Representation.TransparencyStructureRepresentation3DFromScript),jr.Action(Qe.Representation.ClippingStructureRepresentation3DFromScript),jr.Action(Qe.Representation.SubstanceStructureRepresentation3DFromScript),jr.Action(Qe.Representation.ThemeStrengthRepresentation3D),jr.Action(sJ),jr.Action(Qe.Volume.VolumeFromCcp4),jr.Action(Qe.Volume.VolumeFromDsn6),jr.Action(Qe.Volume.VolumeFromCube),jr.Action(Qe.Volume.VolumeFromDx),jr.Action(Qe.Representation.VolumeRepresentation3D),jr.Action(Qe.Volume.VolumeTransform),jr.Action(Qe.Volume.VolumeInstances)],behaviors:[jr.Behavior(yc.Representation.HighlightLoci),jr.Behavior(yc.Representation.SelectLoci),jr.Behavior(yc.Representation.DefaultLociLabelProvider),jr.Behavior(yc.Representation.FocusLoci),jr.Behavior(yc.Camera.FocusLoci),jr.Behavior(yc.Camera.CameraAxisHelper),jr.Behavior(yc.Camera.CameraControls),jr.Behavior(yc.State.SnapshotControls),jr.Behavior(w1),jr.Behavior(yc.CustomProps.StructureInfo),jr.Behavior(yc.CustomProps.AccessibleSurfaceArea),jr.Behavior(yc.CustomProps.BestDatabaseSequenceMapping),jr.Behavior(yc.CustomProps.Interactions),jr.Behavior(yc.CustomProps.SecondaryStructure),jr.Behavior(yc.CustomProps.ValenceModel),jr.Behavior(yc.CustomProps.CrossLinkRestraint)],animations:[GBe,OBe,jBe,CPe,QC,FBe,NBe,UBe]});var Ac=_t(ur()),vSt={color:C.Color(Lt.black,{description:"Display color of the volume."}),wireframe:C.Boolean(!1,{description:"Control display of the volume as a wireframe."}),opacity:C.Numeric(.3,{min:0,max:1,step:.01},{description:"Opacity of the volume."})},ISt=new Map([["em",[-5,5]],["2fo-fc",[0,3]],["fo-fc(+ve)",[1,5]],["fo-fc(-ve)",[-5,-1]]]),MP=class extends Fr{constructor(){super(...arguments);this.ref=tr.findTagInSubtree(this.plugin.state.data.tree,this.props.bCell.transform.ref,this.props.name);this.getVisible=()=>{let r=this.plugin.state.data,n=this.ref;return n?!r.cells.get(n).state.isHidden:!1};this.toggleVisible=()=>{let r=this.plugin.state.data,n=this.ref;n&&uh(r,n,!r.cells.get(n).state.isHidden)}}componentDidUpdate(){this.ref=tr.findTagInSubtree(this.plugin.state.data.tree,this.props.bCell.transform.ref,this.props.name)}componentDidMount(){this.subscribe(this.plugin.state.data.events.cell.stateUpdated,r=>{this.ref===r.ref&&this.forceUpdate()})}render(){let r=this.props,{isRelative:n,stats:o}=r,i=r.channels[r.name],{min:a,max:s,mean:l,sigma:u}=o,c=Math.round(100*(i.isoValue.kind==="relative"?i.isoValue.relativeValue:i.isoValue.absoluteValue))/100,m=(a-l)/u,d=(s-l)/u;if(!this.props.isUnbounded){let x=ISt.get(this.props.name);this.props.name==="em"?(m=Math.max(x[0],m),d=Math.min(x[1],d)):(m=x[0],d=x[1])}let p=l+u*m,h=l+u*d,f=z_(n?Math.round((h-p)/u)/100:u/100,2),g=n?m:p,y=n?d:h;return(0,Ac.jsx)(wM,{label:r.label+(r.isRelative?" \u03C3":""),colorStripe:i.color,pivot:(0,Ac.jsxs)("div",{className:"msp-volume-channel-inline-controls",children:[(0,Ac.jsx)(r0,{value:c,min:g,max:y,step:f,onChange:x=>r.changeIso(r.name,x,n),onChangeImmediate:x=>r.changeIso(r.name,x,n),disabled:r.params.isDisabled,onEnter:r.params.events.onEnter}),(0,Ac.jsx)(sr,{svg:this.getVisible()?vm:md,onClick:this.toggleVisible,toggleState:!1,disabled:r.params.isDisabled})]}),controls:(0,Ac.jsx)(uo,{onChange:({name:x,value:S})=>r.changeParams(r.name,x,S),params:vSt,values:i,onEnter:r.params.events.onEnter,isDisabled:r.params.isDisabled})})}},UG=class extends Fr{constructor(){super(...arguments);this.changeIso=(r,n,o)=>{let i=this.props.params;this.newParams({...i,entry:{name:i.entry.name,params:{...i.entry.params,channels:{...i.entry.params.channels,[r]:{...i.entry.params.channels[r],isoValue:o?Ge.IsoValue.relative(n):Ge.IsoValue.absolute(n)}}}}})};this.changeParams=(r,n,o)=>{let i=this.props.params;this.newParams({...i,entry:{name:i.entry.name,params:{...i.entry.params,channels:{...i.entry.params.channels,[r]:{...i.entry.params.channels[r],[n]:o}}}}})};this.changeOption=({name:r,value:n})=>{let o=this.props.params;if(r==="entry")this.newParams({...o,entry:{name:n,params:o.entry.params}});else{let i=this.props.b.data,a=i.info.kind==="em",s=n.params.isRelative,l=i.info.header.sampling[0],u=o.entry.params.channels,m={...o.entry.params.view.name===n.name?o.entry.params.view.params:this.props.info.params.entry.map(o.entry.name).params.view.map(n.name).defaultValue};n.name==="selection-box"?m.radius=n.params.radius:n.name==="camera-target"?(m.radius=n.params.radius,m.dynamicDetailLevel=n.params.dynamicDetailLevel):n.name==="box"?(m.bottomLeft=n.params.bottomLeft,m.topRight=n.params.topRight):n.name==="auto"&&(m.radius=n.params.radius,m.selectionDetailLevel=n.params.selectionDetailLevel),m.isUnbounded=!!n.params.isUnbounded,this.newParams({...o,entry:{name:o.entry.name,params:{...o.entry.params,view:{name:n.name,params:m},detailLevel:n.params.detailLevel,channels:a?{em:this.convert(u.em,l.valuesInfo[0],s)}:{"2fo-fc":this.convert(u["2fo-fc"],l.valuesInfo[0],s),"fo-fc(+ve)":this.convert(u["fo-fc(+ve)"],l.valuesInfo[1],s),"fo-fc(-ve)":this.convert(u["fo-fc(-ve)"],l.valuesInfo[1],s)}}}})}}}areInitial(r){return C.areEqual(this.props.info.params,r,this.props.info.initialValues)}newParams(r){this.props.events.onChange(r,this.areInitial(r))}convert(r,n,o){return{...r,isoValue:o?Ge.IsoValue.toRelative(r.isoValue,n):Ge.IsoValue.toAbsolute(r.isoValue,n)}}render(){if(!this.props.b)return null;let r=this.props.b.data,n=r.info.kind==="em",o=n?"em":"2fo-fc",i=this.props.params,a=this.props.info.params.entry.map(i.entry.name),s=a.params.detailLevel,l={...s,label:"Dynamic Detail",defaultValue:a.params.view.map("camera-target").params.dynamicDetailLevel.defaultValue},u={...s,label:"Selection Detail",defaultValue:a.params.view.map("auto").params.selectionDetailLevel.defaultValue},c=r.info.header.sampling[0],m=i.entry.params.channels[o].isoValue.kind==="relative",d=C.Boolean(m,{description:"Use normalized or absolute isocontour scale.",label:"Normalized"}),p=!!i.entry.params.view.params.isUnbounded,h=C.Boolean(p,{description:"Show full/limited range of iso-values for more fine-grained control.",label:"Unbounded"}),f=i.entry.params.view.name==="off",g={entry:C.Select(i.entry.name,r.data.entries.map(x=>[x.dataId,x.dataId]),{isHidden:f,description:"Which entry with volume data to display."}),view:C.MappedStatic(i.entry.params.view.name,{off:C.Group({isRelative:C.Boolean(m,{isHidden:!0}),isUnbounded:C.Boolean(p,{isHidden:!0})},{description:"Display off."}),box:C.Group({bottomLeft:C.Vec3(b.zero()),topRight:C.Vec3(b.zero()),detailLevel:s,isRelative:d,isUnbounded:h},{description:"Static box defined by cartesian coords."}),"selection-box":C.Group({radius:C.Numeric(5,{min:0,max:50,step:.5},{description:"Radius in \u212B within which the volume is shown."}),detailLevel:s,isRelative:d,isUnbounded:h},{description:"Box around focused element."}),"camera-target":C.Group({radius:C.Numeric(.5,{min:0,max:1,step:.05},{description:"Radius within which the volume is shown (relative to the field of view)."}),detailLevel:{...s,isHidden:!0},dynamicDetailLevel:l,isRelative:d,isUnbounded:h},{description:"Box around camera target."}),cell:C.Group({detailLevel:s,isRelative:d,isUnbounded:h},{description:"Box around the structure's bounding box."}),auto:C.Group({radius:C.Numeric(5,{min:0,max:50,step:.5},{description:"Radius in \u212B within which the volume is shown."}),detailLevel:s,selectionDetailLevel:u,isRelative:d,isUnbounded:h},{description:"Box around focused element."})},{options:ws.ViewTypeOptions,description:'Controls what of the volume is displayed. "Off" hides the volume alltogether. "Bounded box" shows the volume inside the given box. "Around Focus" shows the volume around the element/atom last interacted with. "Around Camera" shows the volume around the point the camera is targeting. "Whole Structure" shows the volume for the whole structure.'})},y={entry:i.entry.name,view:{name:i.entry.params.view.name,params:{detailLevel:i.entry.params.detailLevel,radius:i.entry.params.view.params.radius,bottomLeft:i.entry.params.view.params.bottomLeft,topRight:i.entry.params.view.params.topRight,selectionDetailLevel:i.entry.params.view.params.selectionDetailLevel,dynamicDetailLevel:i.entry.params.view.params.dynamicDetailLevel,isRelative:m,isUnbounded:p}}};return f?(0,Ac.jsx)(uo,{onChange:this.changeOption,params:g,values:y,onEnter:this.props.events.onEnter,isDisabled:this.props.isDisabled}):(0,Ac.jsxs)(Ac.Fragment,{children:[!n&&(0,Ac.jsx)(MP,{label:"2Fo-Fc",name:"2fo-fc",bCell:this.props.bCell,channels:i.entry.params.channels,changeIso:this.changeIso,changeParams:this.changeParams,isRelative:m,params:this.props,stats:c.valuesInfo[0],isUnbounded:p}),!n&&(0,Ac.jsx)(MP,{label:"Fo-Fc(+ve)",name:"fo-fc(+ve)",bCell:this.props.bCell,channels:i.entry.params.channels,changeIso:this.changeIso,changeParams:this.changeParams,isRelative:m,params:this.props,stats:c.valuesInfo[1],isUnbounded:p}),!n&&(0,Ac.jsx)(MP,{label:"Fo-Fc(-ve)",name:"fo-fc(-ve)",bCell:this.props.bCell,channels:i.entry.params.channels,changeIso:this.changeIso,changeParams:this.changeParams,isRelative:m,params:this.props,stats:c.valuesInfo[1],isUnbounded:p}),n&&(0,Ac.jsx)(MP,{label:"EM",name:"em",bCell:this.props.bCell,channels:i.entry.params.channels,changeIso:this.changeIso,changeParams:this.changeParams,isRelative:m,params:this.props,stats:c.valuesInfo[0],isUnbounded:p}),(0,Ac.jsx)(uo,{onChange:this.changeOption,params:g,values:y,onEnter:this.props.events.onEnter,isDisabled:this.props.isDisabled})]})}};var NG=()=>({...WBe(),customParamEditors:[[ND,UG]]});async function QBe(e){let{spec:t,target:r,onBeforeUIRender:n,render:o}=e,i=new VG(t||NG());await i.init(),n&&await n(i),o((0,XBe.createElement)(S3e,{plugin:i}),r);try{await i.canvas3dInitialized}catch{}return i}var ZBe=_t(T5());function qBe(e,t){(0,ZBe.createRoot)(t).render(e)}var zG=_t(ur()),uJ=class extends Pc{constructor(r){super();this.options=r;this.plugin=void 0;this.context=tv(r?.context);let n=this.context.state.viewers.value,o=n.findIndex(i=>i.name===r?.name);if(o>=0){let i=[...n];i[o].model.dispose(),i.splice(o,0),this.context.state.viewers.next(i)}}async mount(r){let n=NG();this.plugin=await QBe({target:r,render:qBe,spec:{...n,layout:{initial:{isExpanded:!1,showControls:!1,controlsDisplay:"landscape"}},components:{remoteState:"none",viewport:{snapshotDescription:ASt}},behaviors:[...n.behaviors,jr.Behavior(YV)],config:[[Lr.Viewport.ShowAnimation,!1]]}}),this.subscribe(this.context.commands,async a=>{if(!(!a||!this.plugin))try{if(this.context.state.isLoading.next(!0),a.kind==="load-mvs"){let s;if(a.url){let l=await this.plugin.runTask(this.plugin.fetch({url:a.url,type:a.format==="mvsx"?"binary":"string"}));s=await NZ(this.plugin,l,a.format??"mvsj",{sourceUrl:a.url})}else a.data&&(s=await NZ(this.plugin,a.data,a.format??"mvsj"));Tm.is(s)||s instanceof Uint8Array?this.context.state.currentStoryData.next(s):s&&this.context.state.currentStoryData.next(JSON.stringify(s))}}catch(s){console.error(s),lt.Toast.Show(this.plugin,{key:"<mvsload>",title:"Error",message:s?.message?`${s?.message}`:`${s}`,timeoutMs:1e4})}finally{this.context.state.isLoading.next(!1)}});let i=[...this.context.state.viewers.value,{name:this.options?.name,model:this}];this.context.state.viewers.next(i)}};function ASt(){return(0,zG.jsx)(zG.Fragment,{})}var cJ=class extends HTMLElement{constructor(){super();this.model=void 0}async connectedCallback(){this.model=new uJ({name:this.getAttribute("name")??void 0,context:{name:this.getAttribute("context-name")??void 0}}),await this.model.mount(this)}disconnectedCallback(){this.model?.dispose(),this.model=void 0}};window.customElements.define("mvs-stories-viewer",cJ);function HG(e){return tv({name:e})}function YBe(e,t){setTimeout(()=>{HG(t?.contextName).dispatch({kind:"load-mvs",format:t?.format??"mvsj",url:e})},0)}function TSt(e,t){setTimeout(()=>{HG(t?.contextName).dispatch({kind:"load-mvs",format:t?.format??"mvsj",data:e})},0)}function PSt(e,t="mvsj"){return`https://stories.molstar.org/api/story/${e}/data`}function _St(e,t){YBe(PSt(e,t?.format),{format:t?.format??"mvsj",contextName:t?.contextName})}function RSt(e){let t=HG(e?.contextName).state.currentStoryData.value;if(!t)return;let r=typeof t=="string",n=`${e?.filename??"story"}.${r?"mvsj":"mvsx"}`;sT(new Blob([typeof t=="string"?t:t.buffer],{type:r?"application/json":"application/octet-stream"}),n)}return oEe(DSt);})();
/*! Bundled license information:

react/cjs/react.production.min.js:
  (**
   * @license React
   * react.production.min.js
   *
   * Copyright (c) Facebook, Inc. and its affiliates.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   *)

scheduler/cjs/scheduler.production.min.js:
  (**
   * @license React
   * scheduler.production.min.js
   *
   * Copyright (c) Facebook, Inc. and its affiliates.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   *)

react-dom/cjs/react-dom.production.min.js:
  (**
   * @license React
   * react-dom.production.min.js
   *
   * Copyright (c) Facebook, Inc. and its affiliates.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   *)

react/cjs/react-jsx-runtime.production.min.js:
  (**
   * @license React
   * react-jsx-runtime.production.min.js
   *
   * Copyright (c) Facebook, Inc. and its affiliates.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   *)

immutable/dist/immutable.es.js:
  (**
   * @license
   * MIT License
   * 
   * Copyright (c) 2014-present, Lee Byron and other contributors.
   * 
   * Permission is hereby granted, free of charge, to any person obtaining a copy
   * of this software and associated documentation files (the "Software"), to deal
   * in the Software without restriction, including without limitation the rights
   * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
   * copies of the Software, and to permit persons to whom the Software is
   * furnished to do so, subject to the following conditions:
   * 
   * The above copyright notice and this permission notice shall be included in all
   * copies or substantial portions of the Software.
   * 
   * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
   * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
   * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
   * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
   * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
   * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
   * SOFTWARE.
   *)
*/
//# sourceMappingURL=mvs-stories.js.map
