!function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=298)}([function(e,t,n){"use strict";n.d(t,"a",function(){return i});
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
var r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};function i(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}Object.assign},function(e,t,n){"use strict";n.d(t,"a",function(){return l});var r=n(0),i=n(57),a=n(112),o=n(10),u=n(88),s=n(31),c=n(67),l=function(e){function t(n,r,i){var o=e.call(this)||this;switch(o.syncErrorValue=null,o.syncErrorThrown=!1,o.syncErrorThrowable=!1,o.isStopped=!1,arguments.length){case 0:o.destination=a.a;break;case 1:if(!n){o.destination=a.a;break}if("object"==typeof n){n instanceof t?(o.syncErrorThrowable=n.syncErrorThrowable,o.destination=n,n.add(o)):(o.syncErrorThrowable=!0,o.destination=new f(o,n));break}default:o.syncErrorThrowable=!0,o.destination=new f(o,n,r,i)}return o}return r.a(t,e),t.prototype[u.a]=function(){return this},t.create=function(e,n,r){var i=new t(e,n,r);return i.syncErrorThrowable=!1,i},t.prototype.next=function(e){this.isStopped||this._next(e)},t.prototype.error=function(e){this.isStopped||(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this))},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){this.destination.error(e),this.unsubscribe()},t.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},t.prototype._unsubscribeAndRecycle=function(){var e=this._parent,t=this._parents;return this._parent=null,this._parents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parent=e,this._parents=t,this},t}(o.a),f=function(e){function t(t,n,r,o){var u,s=e.call(this)||this;s._parentSubscriber=t;var c=s;return Object(i.a)(n)?u=n:n&&(u=n.next,r=n.error,o=n.complete,n!==a.a&&(c=Object.create(n),Object(i.a)(c.unsubscribe)&&s.add(c.unsubscribe.bind(c)),c.unsubscribe=s.unsubscribe.bind(s))),s._context=c,s._next=u,s._error=r,s._complete=o,s}return r.a(t,e),t.prototype.next=function(e){if(!this.isStopped&&this._next){var t=this._parentSubscriber;s.a.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?this.__tryOrSetError(t,this._next,e)&&this.unsubscribe():this.__tryOrUnsub(this._next,e)}},t.prototype.error=function(e){if(!this.isStopped){var t=this._parentSubscriber,n=s.a.useDeprecatedSynchronousErrorHandling;if(this._error)n&&t.syncErrorThrowable?(this.__tryOrSetError(t,this._error,e),this.unsubscribe()):(this.__tryOrUnsub(this._error,e),this.unsubscribe());else if(t.syncErrorThrowable)n?(t.syncErrorValue=e,t.syncErrorThrown=!0):Object(c.a)(e),this.unsubscribe();else{if(this.unsubscribe(),n)throw e;Object(c.a)(e)}}},t.prototype.complete=function(){var e=this;if(!this.isStopped){var t=this._parentSubscriber;if(this._complete){var n=function(){return e._complete.call(e._context)};s.a.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?(this.__tryOrSetError(t,n),this.unsubscribe()):(this.__tryOrUnsub(n),this.unsubscribe())}else this.unsubscribe()}},t.prototype.__tryOrUnsub=function(e,t){try{e.call(this._context,t)}catch(e){if(this.unsubscribe(),s.a.useDeprecatedSynchronousErrorHandling)throw e;Object(c.a)(e)}},t.prototype.__tryOrSetError=function(e,t,n){if(!s.a.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{t.call(this._context,n)}catch(t){return s.a.useDeprecatedSynchronousErrorHandling?(e.syncErrorValue=t,e.syncErrorThrown=!0,!0):(Object(c.a)(t),!0)}return!1},t.prototype._unsubscribe=function(){var e=this._parentSubscriber;this._context=null,this._parentSubscriber=null,e.unsubscribe()},t}(l)},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(90)),r(n(305))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(7),i=n(2),a=n(187);!function(e){function t(e,t){return t?(t.label&&(e.label=t.label),t.description&&(e.description=t.description),t.fieldLabels&&(e.fieldLabels=t.fieldLabels),t.isHidden&&(e.isHidden=t.isHidden),e):e}function n(e,n,r){return t({type:"select",defaultValue:e,options:n},r)}function o(e,t){return t?(void 0!==t.min&&(e.min=t.min),void 0!==t.max&&(e.max=t.max),void 0!==t.step&&(e.step=t.step),e):e}function u(e){for(var t={},n=0,r=Object.keys(e);n<r.length;n++){var i=r[n];e[i].isOptional||(t[i]=e[i].defaultValue)}return t}function s(e,t,n){if(t===n)return!0;if(!t)return!n;if(!n)return!t;if("object"!=typeof t||"object"!=typeof n)return!1;for(var r=0,i=Object.keys(e);r<i.length;r++){var a=i[r];if(!c(e[a],t[a],n[a]))return!1}return!0}function c(e,t,n){if(t===n)return!0;if(!t)return!n;if(!n)return!t;if("group"===e.type)return s(e.params,t,n);if("mapped"===e.type){var a=n;return(f=t)?!(!f||!a)&&(f.name===a.name&&c(e.map(f.name),f.params,a.params)):!a}if("multi-select"===e.type){a=n;if((f=t).length!==a.length)return!1;if(f.length<10){for(var o=0,u=f.length;o<u;o++)if(f[o]!==a[o]&&a.indexOf(f[o])<0)return!1}else{var l=new Set(a);for(o=0,u=f.length;o<u;o++)if(f[o]!==a[o]&&!l.has(f[o]))return!1}return!0}if("interval"===e.type)return t[0]===n[0]&&t[1]===n[1];if("line-graph"===e.type){var f;a=n;if((f=t).length!==a.length)return!1;for(o=0,u=f.length;o<u;o++)if(!i.Vec2.areEqual(f[o],a[o]))return!1;return!0}return"vec3"===e.type?i.Vec3.equals(t,n):"object"==typeof t&&"object"==typeof n&&r.shallowEqual(t,n)}e.makeOptional=function(e){return e.isOptional=!0,e},e.Value=function(e,n){return t({type:"value",defaultValue:e},n)},e.Select=n,e.ColorScale=function(e,n,r){return t({type:"color-scale",defaultValue:e,options:n},r)},e.MultiSelect=function(e,n,r){return t({type:"multi-select",defaultValue:e,options:n},r)},e.Boolean=function(e,n){return t({type:"boolean",defaultValue:e},n)},e.Text=function(e,n){return void 0===e&&(e=""),t({type:"text",defaultValue:e},n)},e.Color=function(e,n){return t({type:"color",defaultValue:e},n)},e.Vec3=function(e,n){return t({type:"vec3",defaultValue:e},n)},e.File=function(e){var n=t({type:"file",defaultValue:void 0},e);return e&&e.accept&&(n.accept=e.accept),n},e.Numeric=function(e,n,r){return t(o({type:"number",defaultValue:e},n),r)},e.Interval=function(e,n,r){return t(o({type:"interval",defaultValue:e},n),r)},e.LineGraph=function(e,n){return t({type:"line-graph",defaultValue:e},n)},e.Group=function(e,n){var r=t({type:"group",defaultValue:u(e),params:e},n);return n&&n.isExpanded&&(r.isExpanded=n.isExpanded),n&&n.isFlat&&(r.isFlat=n.isFlat),r},e.Mapped=function(e,r,i,a){return t({type:"mapped",defaultValue:{name:e,params:i(e).defaultValue},select:n(e,r,a),map:i},a)},e.MappedStatic=function(e,r,i){var a=i&&i.options?i.options:Object.keys(r).map(function(e){return[e,e]});return t({type:"mapped",defaultValue:{name:e,params:r[e].defaultValue},select:n(e,a,i),map:function(e){return r[e]}},i)},e.Converted=function(e,t,n){return{type:"converted",defaultValue:t(n.defaultValue),converted:n,fromValue:e,toValue:t}},e.Conditioned=function(e,t,r,i){var a=Object.keys(t).map(function(e){return[e,e]});return{type:"conditioned",select:n(r(e),a),defaultValue:e,conditionParams:t,conditionForValue:r,conditionedValue:i}},e.getDefaultValues=u,e.clone=function(e){return a.deepClone(e)},e.validate=function(e,t){},e.areEqual=s}(t.ParamDefinition||(t.ParamDefinition={}))},function(e,t,n){"use strict";var r=n(109),i=n(1),a=n(88),o=n(112);var u=n(47),s=n(87),c=n(31);n.d(t,"a",function(){return l});var l=function(){function e(e){this._isScalar=!1,e&&(this._subscribe=e)}return e.prototype.lift=function(t){var n=new e;return n.source=this,n.operator=t,n},e.prototype.subscribe=function(e,t,n){var r=this.operator,u=function(e,t,n){if(e){if(e instanceof i.a)return e;if(e[a.a])return e[a.a]()}return e||t||n?new i.a(e,t,n):new i.a(o.a)}(e,t,n);if(r?u.add(r.call(u,this.source)):u.add(this.source||c.a.useDeprecatedSynchronousErrorHandling&&!u.syncErrorThrowable?this._subscribe(u):this._trySubscribe(u)),c.a.useDeprecatedSynchronousErrorHandling&&u.syncErrorThrowable&&(u.syncErrorThrowable=!1,u.syncErrorThrown))throw u.syncErrorValue;return u},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){c.a.useDeprecatedSynchronousErrorHandling&&(e.syncErrorThrown=!0,e.syncErrorValue=t),Object(r.a)(e)?e.error(t):console.warn(t)}},e.prototype.forEach=function(e,t){var n=this;return new(t=f(t))(function(t,r){var i;i=n.subscribe(function(t){try{e(t)}catch(e){r(e),i&&i.unsubscribe()}},r,t)})},e.prototype._subscribe=function(e){var t=this.source;return t&&t.subscribe(e)},e.prototype[u.a]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return 0===e.length?this:Object(s.b)(e)(this)},e.prototype.toPromise=function(e){var t=this;return new(e=f(e))(function(e,n){var r;t.subscribe(function(e){return r=e},function(e){return n(e)},function(){return e(r)})})},e.create=function(t){return new e(t)},e}();function f(e){if(e||(e=c.a.Promise||Promise),!e)throw new Error("no Promise impl found");return e}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(115);t.Interval=r.default;var i=n(235);t.OrderedSet=i.default;var a=n(352);t.Segmentation=a.default;var o=n(188);t.SortedArray=o.default;var u=n(234);t.Tuple=u.default;var s=n(354);t.LinkedIndex=s.default;var c=n(355);t.IntMap=c.default;var l=n(189);t.Iterator=l.default},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var r=n(30),i=n(173);function a(e,t,n,a,o){if(void 0===o&&(o=new r.a(e,n,a)),!o.closed)return Object(i.a)(t)(o)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(220);t.BitFlags=r.default;var i=n(221);t.StringBuilder=i.default;var a=n(181);t.UUID=a.default;var o=n(311);t.Mask=o.default,function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(77)),t.noop=function(){},t.round=function(e,t){var n=Math.pow(10,t);return Math.round(n*e)/n},t.arrayEqual=function(e,t){var n=e.length;if(n!==t.length)return!1;for(var r=0;r<n;r++)if(e[r]!==t[r])return!1;return!0};var u=Object.prototype.hasOwnProperty;function s(e,t,n){for(var r,i=t,a=e,o=n,u=0,s=Object.keys(t);u<s.length;u++){void 0!==(r=i[f=s[u]])?a[f]=r:n&&(a[f]=o[f])}if(n)for(var c=0,l=Object.keys(n);c<l.length;c++){var f;void 0===(r=a[f=l[c]])&&(a[f]=o[f])}return e}function c(e){return s({},e)}function l(e,n){for(var r=!1,i=0,a=Object.keys(n);i<a.length;i++){var o=a[i];if(u.call(n,o)&&n[o]!==e[o]){r=!0;break}}return r?t.assign(c(e),n):e}function f(e){return(e<10?"0":"")+e}t.deepEqual=function e(t,n){if(t===n)return!0;var r=Array.isArray(t),i=Array.isArray(n);if(r&&i){if(t.length!==n.length)return!1;for(var a=0;a<t.length;a++)if(!e(t[a],n[a]))return!1;return!0}if(r!==i)return!1;if(t&&n&&"object"==typeof t&&"object"==typeof n){var o=Object.keys(t);if(o.length!==Object.keys(n).length)return!1;var s=t instanceof Date,c=n instanceof Date;if(s&&c)return t.getTime()===n.getTime();if(s!==c)return!1;var l=t instanceof RegExp,f=n instanceof RegExp;if(l&&f)return t.toString()===n.toString();if(l!==f)return!1;for(a=0;a<o.length;a++)if(!u.call(n,o[a]))return!1;for(a=0;a<o.length;a++)if(!e(t[o[a]],n[o[a]]))return!1;return!0}return!1},t.shallowEqual=function(e,t){if(!e)return!t;if(!t)return!1;var n=Object.keys(e);if(Object.keys(t).length!==n.length)return!1;for(var r=0,i=n;r<i.length;r++){var a=i[r];if(!u.call(e,a)||e[a]!==t[a])return!1}return!0},t.defaults=function(e,t){return void 0!==e?e:t},t.extend=s,t.shallowClone=c,t.assign=Object.assign||function(e){for(var t=1;t<arguments.length;t++)for(var n=arguments[t],r=0,i=Object.keys(n);r<i.length;r++){var a=i[r];u.call(n,a)&&(e[a]=n[a])}return e},t.merge=function(e){for(var n=e,r=1;r<arguments.length;r++)if(arguments[r]&&(n=l(e,arguments[r]))!==e){for(var i=r+1;i<arguments.length;i++)n=t.assign(n,arguments[i]);break}return n},t.formatTime=function(e){var t=e.getHours(),n=e.getMinutes(),r=e.getSeconds();return t+":"+f(n)+":"+f(r)},t.formatProgress=function(e){var t=e.root.progress;if(t.isIndeterminate)return t.message;var n=(100*t.current/t.max).toFixed(2);return t.message+" "+n+"%"}},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var r=n(0),i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.a(t,e),t.prototype.notifyNext=function(e,t,n,r,i){this.destination.next(t)},t.prototype.notifyError=function(e,t){this.destination.error(e)},t.prototype.notifyComplete=function(e){this.destination.complete()},t}(n(1).a)},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(230)),r(n(43)),r(n(247))},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var r=n(15),i=n(170),a=n(57),o=n(89),u=function(){function e(e){this.closed=!1,this._parent=null,this._parents=null,this._subscriptions=null,e&&(this._unsubscribe=e)}var t;return e.prototype.unsubscribe=function(){var e,t=!1;if(!this.closed){var n=this._parent,u=this._parents,c=this._unsubscribe,l=this._subscriptions;this.closed=!0,this._parent=null,this._parents=null,this._subscriptions=null;for(var f=-1,d=u?u.length:0;n;)n.remove(this),n=++f<d&&u[f]||null;if(Object(a.a)(c))try{c.call(this)}catch(n){t=!0,e=n instanceof o.a?s(n.errors):[n]}if(Object(r.a)(l))for(f=-1,d=l.length;++f<d;){var p=l[f];if(Object(i.a)(p))try{p.unsubscribe()}catch(n){t=!0,e=e||[],n instanceof o.a?e=e.concat(s(n.errors)):e.push(n)}}if(t)throw new o.a(e)}},e.prototype.add=function(t){var n=t;switch(typeof t){case"function":n=new e(t);case"object":if(n===this||n.closed||"function"!=typeof n.unsubscribe)return n;if(this.closed)return n.unsubscribe(),n;if(!(n instanceof e)){var r=n;(n=new e)._subscriptions=[r]}break;default:if(!t)return e.EMPTY;throw new Error("unrecognized teardown "+t+" added to Subscription.")}if(n._addParent(this)){var i=this._subscriptions;i?i.push(n):this._subscriptions=[n]}return n},e.prototype.remove=function(e){var t=this._subscriptions;if(t){var n=t.indexOf(e);-1!==n&&t.splice(n,1)}},e.prototype._addParent=function(e){var t=this._parent,n=this._parents;return t!==e&&(t?n?-1===n.indexOf(e)&&(n.push(e),!0):(this._parents=[e],!0):(this._parent=e,!0))},e.EMPTY=((t=new e).closed=!0,t),e}();function s(e){return e.reduce(function(e,t){return e.concat(t instanceof o.a?t.errors:t)},[])}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(185);t.Task=r.Task;var i=n(340);t.RuntimeContext=i.RuntimeContext;var a=n(341);t.Progress=a.Progress;var o=n(227);t.Scheduler=o.Scheduler;var u=n(342);t.MultistepTask=u.MultistepTask;var s=n(343);t.chunkedSubtask=s.chunkedSubtask},function(e,t,n){"use strict";n.d(t,"b",function(){return l}),n.d(t,"a",function(){return f});var r=n(0),i=n(4),a=n(1),o=n(10),u=n(48),s=n(171),c=n(88),l=function(e){function t(t){var n=e.call(this,t)||this;return n.destination=t,n}return r.a(t,e),t}(a.a),f=function(e){function t(){var t=e.call(this)||this;return t.observers=[],t.closed=!1,t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return r.a(t,e),t.prototype[c.a]=function(){return new l(this)},t.prototype.lift=function(e){var t=new d(this,this);return t.operator=e,t},t.prototype.next=function(e){if(this.closed)throw new u.a;if(!this.isStopped)for(var t=this.observers,n=t.length,r=t.slice(),i=0;i<n;i++)r[i].next(e)},t.prototype.error=function(e){if(this.closed)throw new u.a;this.hasError=!0,this.thrownError=e,this.isStopped=!0;for(var t=this.observers,n=t.length,r=t.slice(),i=0;i<n;i++)r[i].error(e);this.observers.length=0},t.prototype.complete=function(){if(this.closed)throw new u.a;this.isStopped=!0;for(var e=this.observers,t=e.length,n=e.slice(),r=0;r<t;r++)n[r].complete();this.observers.length=0},t.prototype.unsubscribe=function(){this.isStopped=!0,this.closed=!0,this.observers=null},t.prototype._trySubscribe=function(t){if(this.closed)throw new u.a;return e.prototype._trySubscribe.call(this,t)},t.prototype._subscribe=function(e){if(this.closed)throw new u.a;return this.hasError?(e.error(this.thrownError),o.a.EMPTY):this.isStopped?(e.complete(),o.a.EMPTY):(this.observers.push(e),new s.a(this,e))},t.prototype.asObservable=function(){var e=new i.a;return e.source=this,e},t.create=function(e,t){return new d(e,t)},t}(i.a),d=function(e){function t(t,n){var r=e.call(this)||this;return r.destination=t,r.source=n,r}return r.a(t,e),t.prototype.next=function(e){var t=this.destination;t&&t.next&&t.next(e)},t.prototype.error=function(e){var t=this.destination;t&&t.error&&this.destination.error(e)},t.prototype.complete=function(){var e=this.destination;e&&e.complete&&this.destination.complete()},t.prototype._subscribe=function(e){return this.source?this.source.subscribe(e):o.a.EMPTY},t}(f)},function(e,t,n){"use strict";n.d(t,"a",function(){return i}),n.d(t,"b",function(){return a});var r=n(4),i=new r.a(function(e){return e.complete()});function a(e){return e?function(e){return new r.a(function(t){return e.schedule(function(){return t.complete()})})}(e):i}},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var r=n(65),i=new(n(63).a)(r.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var r=Array.isArray||function(e){return e&&"number"==typeof e.length}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(9),a=n(117),o=n(121),u=n(19),s=n(415),c=n(2),l=n(5),f=n(43);function d(e){return!!e&&"every-loci"===e.kind}function p(e){return!!e&&"empty-loci"===e.kind}function h(e){return!!e&&"data-loci"===e.kind}function m(e,t){return e.data===t.data&&e.tag===t.tag&&l.OrderedSet.areEqual(e.indices,t.indices)}t.EveryLoci={kind:"every-loci"},t.isEveryLoci=d,t.EmptyLoci={kind:"empty-loci"},t.isEmptyLoci=p,t.isDataLoci=h,t.areDataLociEqual=m,t.createDataLoci=function(e,t,n){return{kind:"data-loci",data:e,tag:t,indices:n}},function(e){e.areEqual=function(e,t){return!(!d(e)||!d(t))||!(!p(e)||!p(t))||(h(e)&&h(t)?m(e,t):f.Structure.isLoci(e)&&f.Structure.isLoci(t)?f.Structure.areLociEqual(e,t):i.StructureElement.isLoci(e)&&i.StructureElement.isLoci(t)?i.StructureElement.areLociEqual(e,t):a.Link.isLoci(e)&&a.Link.isLoci(t)?a.Link.areLociEqual(e,t):!(!o.Shape.isLoci(e)||!o.Shape.isLoci(t))&&o.Shape.areLociEqual(e,t))};var t=new s.CentroidHelper,n=c.Vec3.zero();function r(e,r){if("every-loci"!==e.kind&&"empty-loci"!==e.kind){if(r||(r=u.Sphere3D.zero()),t.reset(),"structure-loci"===e.kind)return u.Sphere3D.copy(r,e.structure.boundary.sphere);if("element-loci"===e.kind){for(var i=0,a=e.elements;i<a.length;i++)for(var o=(_=a[i]).indices,s=_.unit.conformation.position,f=_.unit.elements,d=0,p=l.OrderedSet.size(o);d<p;d++)s(f[l.OrderedSet.getAt(o,d)],n),t.includeStep(n);t.finishedIncludeStep();for(var h=0,m=e.elements;h<m.length;h++)for(o=(_=m[h]).indices,s=_.unit.conformation.position,f=_.unit.elements,d=0,p=l.OrderedSet.size(o);d<p;d++)s(f[l.OrderedSet.getAt(o,d)],n),t.radiusStep(n)}else if("link-loci"===e.kind){for(var y=0,v=e.links;y<v.length;y++){(_=v[y]).aUnit.conformation.position(_.aUnit.elements[_.aIndex],n),t.includeStep(n),_.bUnit.conformation.position(_.bUnit.elements[_.bIndex],n),t.includeStep(n)}t.finishedIncludeStep();for(var b=0,g=e.links;b<g.length;b++){var _;(_=g[b]).aUnit.conformation.position(_.aUnit.elements[_.aIndex],n),t.radiusStep(n),_.aUnit.conformation.position(_.bUnit.elements[_.bIndex],n),t.radiusStep(n)}}else{if("group-loci"===e.kind)return;if("data-loci"===e.kind)return}return c.Vec3.copy(r.center,t.center),r.radius=Math.sqrt(t.radiusSq),r}}e.getBoundingSphere=r;var y=u.Sphere3D.zero();e.getCenter=function(e,t){var n=r(e,y);return n?c.Vec3.copy(t||c.Vec3.zero(),n.center):void 0}}(r||(r={})),t.Loci=r},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(329)),r(n(330)),r(n(331)),r(n(332)),r(n(184)),r(n(333)),r(n(335))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(186);t.Color=r.Color,t.ColorMap=r.ColorMap,t.ColorTable=r.ColorTable;var i=n(50);t.ColorScale=i.ColorScale},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(135)),r(n(346)),r(n(232)),r(n(348)),r(n(233)),r(n(356))},function(e,t,n){"use strict";function r(e){return e&&"function"==typeof e.schedule}n.d(t,"a",function(){return r})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(334);t.Database=r.default;var i=n(222);t.Table=i.default;var a=n(223);t.Column=a.default;var o=n(224);t.ColumnHelpers=o},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var r=n(0),i=n(1);function a(e,t){return function(n){if("function"!=typeof e)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return n.lift(new o(e,t))}}var o=function(){function e(e,t){this.project=e,this.thisArg=t}return e.prototype.call=function(e,t){return t.subscribe(new u(e,this.project,this.thisArg))},e}(),u=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.project=n,i.count=0,i.thisArg=r||i,i}return r.a(t,e),t.prototype._next=function(e){var t;try{t=this.project.call(this.thisArg,e,this.count++)}catch(e){return void this.destination.error(e)}this.destination.next(t)},t}(i.a)},function(e,t,n){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0});var i=n(220),a=n(134),o=n(114),u=function(){for(var e=Object.create(null),t=[],n="A".charCodeAt(0);n<="Z".charCodeAt(0);n++)t[t.length]=String.fromCharCode(n);for(n="a".charCodeAt(0);n<="z".charCodeAt(0);n++)t[t.length]=String.fromCharCode(n);for(n="0".charCodeAt(0);n<="9".charCodeAt(0);n++)t[t.length]=String.fromCharCode(n);for(var r=0,i=t;r<i.length;r++){var a=i[r];e[a]=a.toUpperCase();for(var o=0,u=t;o<u.length;o++){var s=u[o];e[a+s]=(a+s).toUpperCase();for(var c=0,l=t;c<l.length;c++){var f=l[c];e[a+s+f]=(a+s+f).toUpperCase()}}}return e}();t.ElementSymbol=function(e){return u[e]||e.toUpperCase()},t.MoleculeTypeAtomRoleId=((r={})[4]={trace:"CA",direction:"O",backboneStart:"N",backboneEnd:"C"},r[5]={trace:"C4'",direction:"C3'",backboneStart:"P",backboneEnd:"O3'"},r[6]={trace:"C3'",direction:"C1'",backboneStart:"P",backboneEnd:"O3'"},r[7]={trace:"N4'",direction:"C7'",backboneStart:"N1'",backboneEnd:"C1'"},r),t.ProteinBackboneAtoms=new Set(["CA","C","N","O","O1","O2","OC1","OC2","OX1","OXT","H","H1","H2","H3","HA","HN","BB"]),t.NucleicBackboneAtoms=new Set(["P","OP1","OP2","HOP2","HOP3","O2'","O3'","O4'","O5'","C1'","C2'","C3'","C4'","C5'","H1'","H2'","H2''","HO2'","H3'","H4'","H5'","H5''","HO3'","HO5'","O2*","O3*","O4*","O5*","C1*","C2*","C3*","C4*","C5*"]),t.ProteinComponentTypeNames=new Set(["D-PEPTIDE LINKING","L-PEPTIDE LINKING","D-PEPTIDE NH3 AMINO TERMINUS","L-PEPTIDE NH3 AMINO TERMINUS","D-PEPTIDE COOH CARBOXY TERMINUS","L-PEPTIDE COOH CARBOXY TERMINUS","PEPTIDE LINKING","PEPTIDE-LIKE","L-GAMMA-PEPTIDE, C-DELTA LINKING","D-GAMMA-PEPTIDE, C-DELTA LINKING","L-BETA-PEPTIDE, C-GAMMA LINKING","D-BETA-PEPTIDE, C-GAMMA LINKING"]),t.DNAComponentTypeNames=["DNA LINKING","L-DNA LINKING","DNA OH 5 PRIME TERMINUS","DNA OH 3 PRIME TERMINUS"],t.RNAComponentTypeNames=new Set(["RNA LINKING","L-RNA LINKING","RNA OH 5 PRIME TERMINUS","RNA OH 3 PRIME TERMINUS"]),t.SaccharideComponentTypeNames=new Set(["D-SACCHARIDE 1,4 AND 1,4 LINKING","L-SACCHARIDE 1,4 AND 1,4 LINKING","D-SACCHARIDE 1,4 AND 1,6 LINKING","L-SACCHARIDE 1,4 AND 1,6 LINKING","L-SACCHARIDE","D-SACCHARIDE","SACCHARIDE"]),t.OtherComponentTypeNames=new Set(["NON-POLYMER","OTHER"]),t.WaterNames=new Set(["SOL","WAT","HOH","H2O","W","DOD","D3O","TIP3","TIP4","SPC"]),t.AminoAcidNames=new Set(["HIS","ARG","LYS","ILE","PHE","LEU","TRP","ALA","MET","PRO","CYS","ASN","VAL","GLY","SER","GLN","TYR","ASP","GLU","THR","SEC","PYL","DAL","DAR","DSG","DAS","DCY","DGL","DGN","DHI","DIL","DLE","DLY","MED","DPN","DPR","DSN","DTH","DTR","DTY","DVA","DNE"]),t.RnaBaseNames=new Set(["A","C","T","G","I","U"]),t.DnaBaseNames=new Set(["DA","DC","DT","DG","DI","DU"]),t.PeptideBaseNames=new Set(["APN","CPN","TPN","GPN"]),t.PurinBaseNames=new Set(["A","G","DA","DG","DI","APN","GPN"]),t.PyrimidineBaseNames=new Set(["C","T","U","DC","DT","DU","CPN","TPN"]),t.BaseNames=o.SetUtils.unionMany(t.RnaBaseNames,t.DnaBaseNames,t.PeptideBaseNames),t.isPurinBase=function(e){return t.PurinBaseNames.has(e.toUpperCase())},t.isPyrimidineBase=function(e){return t.PyrimidineBaseNames.has(e.toUpperCase())},t.getMoleculeType=function(e,n){return e=e.toUpperCase(),n=n.toUpperCase(),t.PeptideBaseNames.has(n)?7:t.ProteinComponentTypeNames.has(e)?4:t.RNAComponentTypeNames.has(e)?5:t.DNAComponentTypeNames.includes(e)?6:t.SaccharideComponentTypeNames.has(e)?8:t.WaterNames.has(n)?2:t.IonNames.has(n)?3:t.OtherComponentTypeNames.has(e)?1:0},t.getComponentType=function(e){return e=e.toUpperCase(),t.AminoAcidNames.has(e)?"peptide linking":t.RnaBaseNames.has(e)?"RNA linking":t.DnaBaseNames.has(e)?"DNA linking":a.SaccharideCompIdMap.has(e)?"saccharide":"other"},t.isPolymer=function(e){return 4===e||6===e||5===e||7===e},t.isNucleic=function(e){return 6===e||5===e||7===e},t.IonNames=new Set(["118","119","1AL","1CU","2FK","2HP","2OF","3CO","3MT","3NI","3OF","3P8","4MO","4PU","543","6MO","ACT","AG","AL","ALF","AM","ATH","AU","AU3","AUC","AZI","BA","BCT","BEF","BF4","BO4","BR","BS3","BSY","CA","CAC","CD","CD1","CD3","CD5","CE","CHT","CL","CO","CO3","CO5","CON","CR","CS","CSB","CU","CU1","CU3","CUA","CUZ","CYN","DME","DMI","DSC","DTI","DY","E4N","EDR","EMC","ER3","EU","EU3","F","FE","FE2","FPO","GA","GD3","GEP","HAI","HG","HGC","IN","IOD","IR","IR3","IRI","IUM","K","KO4","LA","LCO","LCP","LI","LU","MAC","MG","MH2","MH3","MLI","MLT","MMC","MN","MN3","MN5","MN6","MO1","MO2","MO3","MO4","MO5","MO6","MOO","MOS","MOW","MW1","MW2","MW3","NA","NA2","NA5","NA6","NAO","NAW","NCO","NET","NH4","NI","NI1","NI2","NI3","NO2","NO3","NRU","O4M","OAA","OC1","OC2","OC3","OC4","OC5","OC6","OC7","OC8","OCL","OCM","OCN","OCO","OF1","OF2","OF3","OH","OS","OS4","OXL","PB","PBM","PD","PDV","PER","PI","PO3","PO4","PR","PT","PT4","PTN","RB","RH3","RHD","RU","SB","SCN","SE4","SEK","SM","SMO","SO3","SO4","SR","T1A","TB","TBA","TCN","TEA","TH","THE","TL","TMA","TRA","UNX","V","VN3","VO4","W","WO5","Y1","YB","YB2","YH","YT3","ZCM","ZN","ZN2","ZN3","ZNO","ZO3","OHX"]),function(e){e.is=i.default.has,e.create=i.default.create,e.SecondaryStructureMmcif={HELX_LH_27_P:530,HELX_LH_3T_P:1042,HELX_LH_AL_P:2066,HELX_LH_A_N:262161,HELX_LH_B_N:524305,HELX_LH_GA_P:4114,HELX_LH_N:17,HELX_LH_OM_P:8210,HELX_LH_OT_N:65553,HELX_LH_OT_P:274,HELX_LH_P:18,HELX_LH_PI_P:16402,HELX_LH_PP_P:32786,HELX_LH_Z_N:131089,HELX_N:1,HELX_OT_N:1,HELX_OT_P:2,HELX_P:2,HELX_RH_27_P:546,HELX_RH_3T_P:1058,HELX_RH_AL_P:2082,HELX_RH_A_N:262177,HELX_RH_B_N:524321,HELX_RH_GA_P:4130,HELX_RH_N:33,HELX_RH_OM_P:8226,HELX_RH_OT_N:65569,HELX_RH_OT_P:290,HELX_RH_P:34,HELX_RH_PI_P:16418,HELX_RH_PP_P:32802,HELX_RH_Z_N:131105,STRN:2097156,TURN_OT_P:16777224,TURN_P:8,TURN_TY1P_P:33554568,TURN_TY1_P:33554504,TURN_TY2P_P:67109e3,TURN_TY2_P:67108936,TURN_TY3P_P:134217864,TURN_TY3_P:134217800},e.SecondaryStructurePdb={1:2082,2:8226,3:16418,4:4130,5:1058,6:2066,7:8210,8:4114,9:514,10:32770},e.SecondaryStructureStride={H:2050,G:1026,I:16386,E:4194308,B:2097156,T:8,C:268435456},e.SecondaryStructureDssp={H:2050,B:2097156,E:4194308,G:1026,I:16386,T:8,S:8}}(t.SecondaryStructureType||(t.SecondaryStructureType={})),t.VdwRadii={H:1.1,HE:1.4,LI:1.81,BE:1.53,B:1.92,C:1.7,N:1.55,O:1.52,F:1.47,NE:1.54,NA:2.27,MG:1.73,AL:1.84,SI:2.1,P:1.8,S:1.8,CL:1.75,AR:1.88,K:2.75,CA:2.31,SC:2.3,TI:2.15,V:2.05,CR:2.05,MN:2.05,FE:2.05,CO:2,NI:2,CU:2,ZN:2.1,GA:1.87,GE:2.11,AS:1.85,SE:1.9,BR:1.83,KR:2.02,RB:3.03,SR:2.49,Y:2.4,ZR:2.3,NB:2.15,MO:2.1,TC:2.05,RU:2.05,RH:2,PD:2.05,AG:2.1,CD:2.2,IN:2.2,SN:1.93,SB:2.17,TE:2.06,I:1.98,XE:2.16,CS:3.43,BA:2.68,LA:2.5,CE:2.48,PR:2.47,ND:2.45,PM:2.43,SM:2.42,EU:2.4,GD:2.38,TB:2.37,DY:2.35,HO:2.33,ER:2.32,TM:2.3,YB:2.28,LU:2.27,HF:2.25,TA:2.2,W:2.1,RE:2.05,OS:2,IR:2,PT:2.05,AU:2.1,HG:2.05,TL:1.96,PB:2.02,BI:2.07,PO:1.97,AT:2.02,RN:2.2,FR:3.48,RA:2.83,AC:2,TH:2.4,PA:2,U:2.3,NP:2,PU:2,AM:2,CM:2,BK:2,CF:2,ES:2,FM:2,MD:2,NO:2,LR:2,RF:2,DB:2,SG:2,BH:2,HS:2,MT:2,DS:2,RG:2,CN:2,UUT:2,FL:2,UUP:2,LV:2,UUH:2},t.DefaultVdwRadius=2,function(e){e.is=i.default.has,e.create=function(e){return i.default.create(e)},e.isCovalent=function(e){return 0!=(1&e)}}(t.LinkType||(t.LinkType={}))},function(e,t,n){"use strict";e.exports=n(545)},function(e,t,n){"use strict";var r=n(4),i=n(176),a=n(175),o=n(47);var u=n(42);var s=n(28),c=n(10),l=n(177);var f=n(178);var d=n(174);var p=n(173);function h(e,t){if(!t)return e instanceof r.a?e:new r.a(Object(p.a)(e));if(null!=e){if(function(e){return e&&"function"==typeof e[o.a]}(e))return function(e,t){return t?new r.a(function(n){var r=new c.a;return r.add(t.schedule(function(){var i=e[o.a]();r.add(i.subscribe({next:function(e){r.add(t.schedule(function(){return n.next(e)}))},error:function(e){r.add(t.schedule(function(){return n.error(e)}))},complete:function(){r.add(t.schedule(function(){return n.complete()}))}}))})),r}):new r.a(Object(d.a)(e))}(e,t);if(Object(i.a)(e))return function(e,t){return t?new r.a(function(n){var r=new c.a;return r.add(t.schedule(function(){return e.then(function(e){r.add(t.schedule(function(){n.next(e),r.add(t.schedule(function(){return n.complete()}))}))},function(e){r.add(t.schedule(function(){return n.error(e)}))})})),r}):new r.a(Object(l.a)(e))}(e,t);if(Object(a.a)(e))return Object(s.a)(e,t);if(function(e){return e&&"function"==typeof e[u.a]}(e)||"string"==typeof e)return function(e,t){if(!e)throw new Error("Iterable cannot be null");return t?new r.a(function(n){var r,i=new c.a;return i.add(function(){r&&"function"==typeof r.return&&r.return()}),i.add(t.schedule(function(){r=e[u.a](),i.add(t.schedule(function(){if(!n.closed){var e,t;try{var i=r.next();e=i.value,t=i.done}catch(e){return void n.error(e)}t?n.complete():(n.next(e),this.schedule())}}))})),i}):new r.a(Object(f.a)(e))}(e,t)}throw new TypeError((null!==e&&typeof e||e)+" is not observable")}n.d(t,"a",function(){return h})},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),a=this&&this.__assign||function(){return(a=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var o=n(27);!function(e){function t(t){return e.Create(a({},t,{typeClass:"Representation3D"}))}e.Create=o.StateObject.factory(),e.isRepresentation3D=function(e){return!!e&&"Representation3D"===e.type.typeClass},e.isBehavior=function(e){return!!e&&"Behavior"===e.type.typeClass},e.CreateRepresentation3D=t,e.CreateBehavior=function(t){return e.Create(a({},t,{typeClass:"Behavior"}))};var n=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t}(e.Create({name:"Root",typeClass:"Root"}));e.Root=n;var r=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t}(e.Create({name:"Group",typeClass:"Group"}));e.Group=r,function(t){var n=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t}(e.Create({name:"String Data",typeClass:"Data"}));t.String=n;var r=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t}(e.Create({name:"Binary Data",typeClass:"Data"}));t.Binary=r}(e.Data||(e.Data={})),function(t){var n=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t}(e.Create({name:"JSON Data",typeClass:"Data"}));t.Json=n;var r=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t}(e.Create({name:"CIF File",typeClass:"Data"}));t.Cif=r;var a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t}(e.Create({name:"CCP4/MRC/MAP File",typeClass:"Data"}));t.Ccp4=a;var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t}(e.Create({name:"DSN6/BRIX File",typeClass:"Data"}));t.Dsn6=o}(e.Format||(e.Format={})),function(n){var r=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t}(e.Create({name:"Trajectory",typeClass:"Object"}));n.Trajectory=r;var a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t}(e.Create({name:"Model",typeClass:"Object"}));n.Model=a;var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t}(e.Create({name:"Structure",typeClass:"Object"}));n.Structure=o;var u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t}(t({name:"Structure 3D"}));n.Representation3D=u}(e.Molecule||(e.Molecule={})),function(n){var r=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t}(e.Create({name:"Volume Data",typeClass:"Object"}));n.Data=r;var a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t}(t({name:"Volume 3D"}));n.Representation3D=a}(e.Volume||(e.Volume={}))}(t.PluginStateObject||(t.PluginStateObject={})),function(e){e.CreateBuiltIn=o.StateTransformer.factory("ms-plugin"),e.BuiltIn=o.StateTransformer.builderFactory("ms-plugin")}(t.PluginStateTransform||(t.PluginStateTransform={}))},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(149)),r(n(209)),r(n(474)),r(n(268)),r(n(267)),r(n(150)),r(n(100)),r(n(265))},function(e,t,n){"use strict";n.d(t,"a",function(){return o});var r=n(4),i=n(10),a=n(172);function o(e,t){return t?new r.a(function(n){var r=new i.a,a=0;return r.add(t.schedule(function(){a!==e.length?(n.next(e[a++]),n.closed||r.add(this.schedule())):n.complete()})),r}):new r.a(Object(a.a)(e))}},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{s(r.next(e))}catch(e){a(e)}}function u(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,u)}s((r=r.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(11),u=n(7),s=n(2),c=n(19),l=n(95),f=n(51),d=n(58),p=n(17),h=n(3),m=n(52),y=n(59);!function(e){function t(e){var t=e?e.vertexBuffer.ref.value:new Float32Array(0),n=e?e.indexBuffer.ref.value:new Uint32Array(0),r=e?e.normalBuffer.ref.value:new Float32Array(0),i=e?e.groupBuffer.ref.value:new Float32Array(0);return{kind:"mesh",vertexCount:0,triangleCount:0,vertexBuffer:e?u.ValueCell.update(e.vertexBuffer,t):u.ValueCell.create(t),indexBuffer:e?u.ValueCell.update(e.indexBuffer,n):u.ValueCell.create(n),normalBuffer:e?u.ValueCell.update(e.normalBuffer,r):u.ValueCell.create(r),groupBuffer:e?u.ValueCell.update(e.groupBuffer,i):u.ValueCell.create(i),normalsComputed:!0}}function n(e){if(!e.normalsComputed){var t=e.normalBuffer.ref.value.length>=3*e.vertexCount?e.normalBuffer.ref.value:new Float32Array(e.vertexBuffer.ref.value.length),n=e.vertexBuffer.ref.value,r=e.indexBuffer.ref.value;if(t===e.normalBuffer.ref.value)for(var i=0,a=3*e.vertexCount;i<a;i+=3)t[i]=0,t[i+1]=0,t[i+2]=0;var o=s.Vec3.zero(),c=s.Vec3.zero(),l=s.Vec3.zero(),f=s.Vec3.zero(),d=s.Vec3.zero(),p=s.Vec3.zero();for(i=0,a=3*e.triangleCount;i<a;i+=3){var h=3*r[i],m=3*r[i+1],y=3*r[i+2];s.Vec3.fromArray(o,n,h),s.Vec3.fromArray(c,n,m),s.Vec3.fromArray(l,n,y),s.Vec3.sub(f,l,c),s.Vec3.sub(d,o,c),s.Vec3.cross(p,f,d),t[h]+=p[0],t[h+1]+=p[1],t[h+2]+=p[2],t[m]+=p[0],t[m+1]+=p[1],t[m+2]+=p[2],t[y]+=p[0],t[y+1]+=p[1],t[y+2]+=p[2]}for(i=0,a=3*e.vertexCount;i<a;i+=3){var v=t[i],b=t[i+1],g=t[i+2],_=1/Math.sqrt(v*v+b*b+g*g);t[i]*=_,t[i+1]*=_,t[i+2]*=_}u.ValueCell.update(e.normalBuffer,t),e.normalsComputed=!0}}function v(e,t,n,r){var i=e.vertexBuffer.ref.value;l.transformPositionArray(t,i,n,r),u.ValueCell.update(e.vertexBuffer,i),e.normalsComputed=!1}function b(e,t,n,i,a){var o=n.instanceCount,s=n.groupCount;if(o!==t.instanceCount.ref.value)throw new Error("instanceCount values in TransformData and LocationIterator differ");var c=d.createColors(n,i.color),l=f.createMarkers(o*s),p={drawCount:3*e.triangleCount,groupCount:s,instanceCount:o},h=m.calculateBoundingSphere(e.vertexBuffer.ref.value,e.vertexCount,t.aTransform.ref.value,o),v=h.boundingSphere,b=h.invariantBoundingSphere;return r({aPosition:e.vertexBuffer,aNormal:e.normalBuffer,aGroup:e.groupBuffer,elements:e.indexBuffer,boundingSphere:u.ValueCell.create(v),invariantBoundingSphere:u.ValueCell.create(b)},c,l,t,y.BaseGeometry.createValues(a,p),{dDoubleSided:u.ValueCell.create(a.doubleSided),dFlatShaded:u.ValueCell.create(a.flatShaded),dFlipSided:u.ValueCell.create(a.flipSided)})}e.createEmpty=t,e.fromArrays=function(e,t,n,r,i,a,o){return{kind:"mesh",vertexCount:i,triangleCount:a,vertexBuffer:u.ValueCell.create(e),indexBuffer:u.ValueCell.create(t),normalBuffer:u.ValueCell.create(n),groupBuffer:u.ValueCell.create(r),normalsComputed:o}},e.computeNormalsImmediate=n,e.checkForDuplicateVertices=function(e,t){void 0===t&&(t=3);for(var n=e.vertexBuffer.ref.value,r=new Map,i=function(e,t){return e[0].toFixed(t)+"|"+e[1].toFixed(t)+"|"+e[2].toFixed(t)},a=0,o=s.Vec3.zero(),u=0,c=e.vertexCount;u<c;++u){s.Vec3.fromArray(o,n,3*u);var l=i(o,t),f=r.get(l);void 0!==f?(a+=1,r.set(l,f+1)):r.set(l,1)}return a},e.computeNormals=function(e){var t=this;return o.Task.create("Surface (Compute Normals)",function(r){return i(t,void 0,void 0,function(){return a(this,function(t){switch(t.label){case 0:return e.normalsComputed?[2,e]:[4,r.update("Computing normals...")];case 1:return t.sent(),n(e),[2,e]}})})})},e.transformImmediate=function(e,t){v(e,t,0,e.vertexCount)},e.transformRangeImmediate=v,e.computeBoundingSphere=function(e){var t=this;return o.Task.create("Mesh (Compute Bounding Sphere)",function(n){return i(t,void 0,void 0,function(){var t,r,i,o,u,c,l,f,d,p;return a(this,function(a){switch(a.label){case 0:return e.boundingSphere?[2,e]:[4,n.update("Computing bounding sphere...")];case 1:for(a.sent(),t=e.vertexBuffer.ref.value,r=0,i=0,o=0,c=0,l=t.length;c<l;c+=3)r+=t[c],i+=t[c+1],o+=t[c+2];for(r/=e.vertexCount,i/=e.vertexCount,o/=e.vertexCount,u=0,c=0,l=t.length;c<l;c+=3)f=r-t[c],d=i-t[c+1],p=o-t[c+2],u=Math.max(u,f*f+d*d+p*p);return e.boundingSphere={center:s.Vec3.create(r,i,o),radius:Math.sqrt(u)},[2,e]}})})})},e.uniformTriangleGroup=function(e,t){void 0===t&&(t=!0);var n=e.indexBuffer,r=e.vertexBuffer,i=e.groupBuffer,a=e.normalBuffer,o=e.triangleCount,c=e.vertexCount,l=n.ref.value,f=r.ref.value,d=i.ref.value,h=a.ref.value,m=p.ChunkedArray.create(Uint32Array,3,1024,o),y=p.ChunkedArray.create(Float32Array,3,1024,f);y.currentIndex=3*c,y.elementCount=c;var v=p.ChunkedArray.create(Float32Array,3,1024,h);v.currentIndex=3*c,v.elementCount=c;var b=p.ChunkedArray.create(Float32Array,1,1024,d);b.currentIndex=c,b.elementCount=c;var g=s.Vec3.zero(),_=s.Vec3.zero(),S=s.Vec3.zero(),C=s.Vec3.zero(),x=s.Vec3.zero(),w=s.Vec3.zero();function P(e){s.Vec3.fromArray(g,f,3*e),s.Vec3.fromArray(C,h,3*e),p.ChunkedArray.add3(y,g[0],g[1],g[2]),p.ChunkedArray.add3(v,C[0],C[1],C[2])}function T(e,t){s.Vec3.fromArray(g,f,3*e),s.Vec3.fromArray(_,f,3*t),s.Vec3.scale(g,s.Vec3.add(g,g,_),.5),s.Vec3.fromArray(C,h,3*e),s.Vec3.fromArray(x,h,3*t),s.Vec3.scale(C,s.Vec3.add(C,C,x),.5),p.ChunkedArray.add3(y,g[0],g[1],g[2]),p.ChunkedArray.add3(v,C[0],C[1],C[2])}function A(e,t,n){s.Vec3.fromArray(g,f,3*e),s.Vec3.fromArray(_,f,3*t),s.Vec3.fromArray(S,f,3*n),s.Vec3.scale(g,s.Vec3.add(g,s.Vec3.add(g,g,_),S),1/3),s.Vec3.fromArray(C,h,3*e),s.Vec3.fromArray(x,h,3*t),s.Vec3.fromArray(w,h,3*n),s.Vec3.scale(C,s.Vec3.add(C,s.Vec3.add(C,C,x),w),1/3),p.ChunkedArray.add3(y,g[0],g[1],g[2]),p.ChunkedArray.add3(v,C[0],C[1],C[2])}function E(e,t,n,r,i){++I,P(e),T(e,t),T(e,n),p.ChunkedArray.add3(m,k,k+1,k+2);for(var a=0;a<3;++a)p.ChunkedArray.add(b,r);for(k+=3,I+=2,P(t),P(n),T(e,t),T(e,n),p.ChunkedArray.add3(m,k,k+1,k+3),p.ChunkedArray.add3(m,k,k+3,k+2),a=0;a<4;++a)p.ChunkedArray.add(b,i);k+=4}var k=c,I=0;if(t)for(var M=0,V=o;M<V;++M){var O=l[3*M],D=l[3*M+1],R=l[3*M+2],j=d[O],N=d[D],B=d[R];if(j===N&&j===B)++I,p.ChunkedArray.add3(m,O,D,R);else if(j===N)E(R,O,D,B,j);else if(j===B)E(D,R,O,N,B);else if(N===B)E(O,D,R,j,N);else{I+=2,P(O),T(O,D),T(O,R),A(O,D,R),p.ChunkedArray.add3(m,k,k+1,k+3),p.ChunkedArray.add3(m,k,k+3,k+2);for(var F=0;F<4;++F)p.ChunkedArray.add(b,j);for(k+=4,I+=2,P(D),T(D,R),T(D,O),A(O,D,R),p.ChunkedArray.add3(m,k,k+1,k+3),p.ChunkedArray.add3(m,k,k+3,k+2),F=0;F<4;++F)p.ChunkedArray.add(b,N);for(k+=4,I+=2,P(R),T(R,D),T(R,O),A(O,D,R),p.ChunkedArray.add3(m,k+3,k+1,k),p.ChunkedArray.add3(m,k+2,k+3,k),F=0;F<4;++F)p.ChunkedArray.add(b,B);k+=4}}else for(M=0,V=o;M<V;++M)if(O=l[3*M],D=l[3*M+1],R=l[3*M+2],j=d[O],N=d[D],B=d[R],j!==N||j!==B){++I,P(O),P(D),P(R),p.ChunkedArray.add3(m,k,k+1,k+2);var L=N===B?N:j;for(F=0;F<3;++F)p.ChunkedArray.add(b,L);k+=3}else++I,p.ChunkedArray.add3(m,O,D,R);var z=p.ChunkedArray.compact(m),U=p.ChunkedArray.compact(y),G=p.ChunkedArray.compact(v),q=p.ChunkedArray.compact(b);return e.vertexCount=k,e.triangleCount=I,u.ValueCell.update(r,U),u.ValueCell.update(i,q),u.ValueCell.update(n,z),u.ValueCell.update(a,G),e},e.Params=r({},y.BaseGeometry.Params,{doubleSided:h.ParamDefinition.Boolean(!1),flipSided:h.ParamDefinition.Boolean(!1),flatShaded:h.ParamDefinition.Boolean(!1)}),e.Utils={Params:e.Params,createEmpty:t,createValues:b,createValuesSimple:function(t,n,i,a,o){var u=y.BaseGeometry.createSimple(i,a,o),s=r({},h.ParamDefinition.getDefaultValues(e.Params),n);return b(t,u.transform,u.locationIterator,u.theme,s)},updateValues:function(e,t){y.BaseGeometry.updateValues(e,t),u.ValueCell.updateIfChanged(e.dDoubleSided,t.doubleSided),u.ValueCell.updateIfChanged(e.dFlatShaded,t.flatShaded),u.ValueCell.updateIfChanged(e.dFlipSided,t.flipSided)},updateBoundingSphere:function(e,t){var n=m.calculateBoundingSphere(e.aPosition.ref.value,t.vertexCount,e.aTransform.ref.value,e.instanceCount.ref.value),r=n.boundingSphere,i=n.invariantBoundingSphere;c.Sphere3D.equals(r,e.boundingSphere.ref.value)||u.ValueCell.update(e.boundingSphere,r);c.Sphere3D.equals(i,e.invariantBoundingSphere.ref.value)||u.ValueCell.update(e.invariantBoundingSphere,i)},createRenderableState:y.BaseGeometry.createRenderableState,updateRenderableState:y.BaseGeometry.updateRenderableState}}(t.Mesh||(t.Mesh={}))},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var r=n(0),i=function(e){function t(t,n,r){var i=e.call(this)||this;return i.parent=t,i.outerValue=n,i.outerIndex=r,i.index=0,i}return r.a(t,e),t.prototype._next=function(e){this.parent.notifyNext(this.outerValue,e,this.outerIndex,this.index++,this)},t.prototype._error=function(e){this.parent.notifyError(e,this),this.unsubscribe()},t.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()},t}(n(1).a)},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var r=!1,i={Promise:void 0,set useDeprecatedSynchronousErrorHandling(e){e&&(new Error).stack;r=e},get useDeprecatedSynchronousErrorHandling(){return r}}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{s(r.next(e))}catch(e){a(e)}}function u(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,u)}s((r=r.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}};Object.defineProperty(t,"__esModule",{value:!0});var a=n(11),o=n(16),u=n(3),s=n(123),c=n(53),l=n(39),f=n(2),d=n(59),p=n(125);t.EmptyRepresentationProvider={label:"",description:"",factory:function(){return h.Empty},getParams:function(){return{}},defaultValues:{}};var h,m=function(){function e(){this._list=[],this._map=new Map}return Object.defineProperty(e.prototype,"default",{get:function(){return this._list[0]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"types",{get:function(){return this._list.map(function(e){return[e.name,e.provider.label]})},enumerable:!0,configurable:!0}),e.prototype.add=function(e,t){this._list.push({name:e,provider:t}),this._map.set(e,t)},e.prototype.remove=function(e){this._list.splice(this._list.findIndex(function(t){return t.name===e}),1),this._map.delete(e)},e.prototype.get=function(e){return this._map.get(e)||t.EmptyRepresentationProvider},Object.defineProperty(e.prototype,"list",{get:function(){return this._list},enumerable:!0,configurable:!0}),e}();t.RepresentationRegistry=m,function(e){function t(){return{visible:!1,pickable:!1,syncManually:!1,transform:f.Mat4.identity()}}function n(e,t){void 0!==t.visible&&(e.visible=t.visible),void 0!==t.pickable&&(e.pickable=t.pickable),void 0!==t.syncManually&&(e.syncManually=t.syncManually),void 0!==t.transform&&f.Mat4.copy(e.transform,t.transform)}e.createState=t,e.updateState=n,e.StateBuilder={create:t,update:n},e.Empty={label:"",groupCount:0,renderObjects:[],props:{},params:{},updated:new l.Subject,state:t(),theme:c.createEmptyTheme(),createOrUpdate:function(){return a.Task.constant("",void 0)},setState:function(){},setTheme:function(){},getLoci:function(){return o.EmptyLoci},mark:function(){return!1},destroy:function(){}},e.createMulti=function(e,t,n,f,d){var p,h,m,y=this,v=0,b=new l.Subject,g=f.create(),_=c.createEmptyTheme(),S={},C=Object.keys(d).map(function(e,r){return S[r]=e,d[e](t,n)});return{label:e,updated:b,get groupCount(){var e=0;if(h)for(var t=h.visuals,n=0,r=C.length;n<r;++n)t&&!t.includes(S[n])||(e+=C[n].groupCount);return e},get renderObjects(){var e=[];if(h)for(var t=h.visuals,n=0,r=C.length;n<r;++n)t&&!t.includes(S[n])||e.push.apply(e,C[n].renderObjects);return e},get props(){return h},get params(){return p},createOrUpdate:function(o,c){void 0===o&&(o={}),c&&c!==m&&(p=n(t,c),m=c,h||(h=u.ParamDefinition.getDefaultValues(p)));var l=s.getQualityProps(Object.assign({},h,o),m);Object.assign(h,o,l);var f=h.visuals;return a.Task.create("Creating or updating '"+e+"' representation",function(e){return r(y,void 0,void 0,function(){var t,n;return i(this,function(r){switch(r.label){case 0:t=0,n=C.length,r.label=1;case 1:return t<n?f&&!f.includes(S[t])?[3,3]:[4,C[t].createOrUpdate(h,m).runInContext(e)]:[3,4];case 2:r.sent(),r.label=3;case 3:return++t,[3,1];case 4:return b.next(v++),[2]}})})})},get state(){return g},get theme(){return _},getLoci:function(e){for(var t=0,n=C.length;t<n;++t){var r=C[t].getLoci(e);if(!o.isEmptyLoci(r))return r}return o.EmptyLoci},mark:function(e,t){for(var n=!1,r=0,i=C.length;r<i;++r)n=C[r].mark(e,t)||n;return n},setState:function(e){for(var t=0,n=C.length;t<n;++t)C[t].setState(e);f.update(g,e)},setTheme:function(e){for(var t=0,n=C.length;t<n;++t)C[t].setTheme(e)},destroy:function(){for(var e=0,t=C.length;e<t;++e)C[e].destroy()}}},e.fromRenderObject=function(t,n){var f=this,h=0,m=new l.Subject,y=e.createState(),v=c.createEmptyTheme(),b=u.ParamDefinition.clone(d.BaseGeometry.Params),g=u.ParamDefinition.getDefaultValues(d.BaseGeometry.Params);return{label:t,updated:m,get groupCount(){return n.values.uGroupCount.ref.value},get renderObjects(){return[n]},get props(){return g},get params(){return b},createOrUpdate:function(e){void 0===e&&(e={});var n=s.getQualityProps(Object.assign({},g,e));return Object.assign(g,e,n),a.Task.create("Updating '"+t+"' representation",function(e){return r(f,void 0,void 0,function(){return i(this,function(e){return m.next(h++),[2]})})})},get state(){return y},get theme(){return v},getLoci:function(){return o.EmptyLoci},mark:function(e,t){return!1},setState:function(t){void 0!==t.visible&&p.Visual.setVisibility(n,t.visible),void 0!==t.pickable&&p.Visual.setPickable(n,t.pickable),void 0!==t.transform&&p.Visual.setTransform(n,t.transform),e.updateState(y,t)},setTheme:function(){},destroy:function(){}}}}(h||(h={})),t.Representation=h},function(e,t,n){"use strict";function r(){}n.d(t,"a",function(){return r})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.idFactory=function(e,t){void 0===e&&(e=0),void 0===t&&(t=Number.MAX_SAFE_INTEGER);var n=e;return function(){var e=n;return n=(n+1)%t,e}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(186);t.TableLegend=function(e){return{kind:"table-legend",table:e}},t.ColorBrewer=i.ColorTable({OrangeRed:[16775148,16705736,16635038,16628612,16551257,15689032,14102559,11730944,8323072],PurpleBlue:[16775163,15525874,13685222,10927579,7645647,3576e3,356528,285325,145496],BluePurple:[16252157,14740724,12571622,10403034,9213638,9202609,8929693,8458108,5046347],Oranges:[16774635,16705230,16634018,16625259,16616764,15821075,14239745,10892803,8333060],BlueGreen:[16252157,15070713,13429990,10082505,6734500,4304502,2329413,27948,17435],YellowOrangeBrown:[16777189,16775100,16704401,16696399,16685353,15495188,13388802,10040324,6694150],YellowGreen:[16777189,16252089,14282915,11394446,7915129,4303709,2327619,26679,17705],Reds:[16774640,16703698,16563105,16552562,16476746,15678252,13309981,10817301,6750221],RedPurple:[16775155,16638173,16565696,16424885,16214177,14496919,11403646,7995767,4784234],Greens:[16252149,15070688,13101504,10607003,7652470,4303709,2329413,27948,17435],YellowGreenBlue:[16777177,15595697,13101492,8375739,4306628,1937856,2252456,2438292,531800],Purples:[16579581,15724021,14342891,12369372,10394312,8420794,6967715,5515151,4128893],GreenBlue:[16252144,14742491,13429701,11066805,8113348,5157843,2854078,551084,540801],Greys:[16777215,15790320,14277081,12434877,9868950,7566195,5395026,2434341,0],YellowOrangeRed:[16777164,16772512,16701814,16691788,16616764,16535082,14883356,12386342,8388646],PurpleRed:[16250105,15196655,13941210,13210823,14640560,15149450,13505110,9961539,6750239],Blues:[16251903,14609399,13032431,10406625,7057110,4362950,2191797,545180,536683],PurpleBlueGreen:[16775163,15524592,13685222,10927579,6793679,3576e3,164234,93273,83510],Spectral:[10355010,13975119,16018755,16625249,16703627,16777151,15136152,11263396,6734501,3311805,6180770],RedYellowGreen:[10813478,14102567,16018755,16625249,16703627,16777151,14282635,10934634,6733155,1742928,26679],RedBlue:[6750239,11671595,14049357,16033154,16636871,16250871,13755888,9618910,4428739,2188972,340065],PinkYellowGreen:[9306450,12917629,14579630,15840986,16638191,16250871,15136208,12116358,8371265,5083681,2581529],PurpleGreen:[4194379,7744131,10055851,12756431,15193320,16250871,14282963,10935200,5942881,1800247,17435],RedYellowBlue:[10813478,14102567,16018755,16625249,16703632,16777151,14742520,11262441,7646673,4552116,3225237],BrownWhiteGreen:[5517317,9195786,12550445,14664317,16181443,16119285,13101797,8441281,3512207,91742,15408],RedGrey:[6750239,11671595,14049357,16033154,16636871,16777215,14737632,12237498,8882055,5066061,1710618],PurpleOrange:[8338184,11753478,14713364,16627811,16703670,16250871,14211819,11709394,8418220,5515144,2949195],Set2:[6734501,16551266,9281739,15174339,10934356,16767279,15058068,11776947],Accent:[8374655,12496596,16629894,16777113,3697840,15729279,12540695,6710886],Set1:[14948892,3636920,5091146,9981603,16744192,16777011,10901032,16220607,10066329],Set3:[9294791,16777139,12499674,16482418,8434131,16626786,11787881,16567781,14277081,12353725,13429701,16772463],Dark2:[1810039,14245634,7696563,15149450,6727198,15117058,10909213,6710886],Paired:[10931939,2062516,11722634,3383340,16489113,14883356,16629615,16744192,13284054,6962586,16777113,11622696],Pastel2:[11789005,16633260,13358568,16042724,15136201,16773806,15852236,13421772],Pastel1:[16495790,11783651,13429701,14601188,16701862,16777164,15063229,16636652,15921906]}),t.ColorMatplotlib=i.ColorTable({Magma:[4329332,4853881,5378684,5903742,6363263,6888576,7413633,7938689,8463745,8988801,9513600,10038655,10563454,11088508,11613562,12138360,12728949,13254258,13714030,14239338,14699366,15094114,15489119,15753309,16017499,16216411,16350045,16483424,16551523,16619368,16621934,16689780,16692091,16694402,16696969,16633746,16636058,16638371,16575148,16577461,16514239],Inferno:[4721514,5246316,5771373,6296430,6821486,7346542,7871597,8396651,8921450,9446504,9971557,10496610,10956127,11481435,12006486,12466258,12926285,13386056,13780802,14241085,14570295,14965297,15229227,15558693,15757342,15956248,16154897,16288267,16421638,16489734,16492043,16494612,16496926,16368426,16305463,16111429,15982678,15853928,15856253,16119953,16580260],Plasma:[1771148,2426257,3081365,3671193,4195228,4784799,5308834,5833124,6357158,6815911,7340200,7864744,8324007,8783782,9309348,9769377,10164126,10624154,11018902,11413393,11808141,12137352,12466307,12795519,13124730,13453685,13717361,14046573,14309992,14573668,14837344,15035483,15299159,15497299,15695438,15893834,16091974,16224833,16357693,16425017,16557877,16625457,16627245,16629289,16631334,16567845,16438820,16310052,16115494,15921190,15726625],Viridis:[4524123,4656994,4658793,4726127,4727668,4663929,4599933,4535937,4406404,4276870,4081800,3952010,3822475,3627148,3497356,3302029,3172237,3042446,2912654,2782862,2652814,2523022,2393229,2328973,2198924,2069132,2004874,2005897,2007175,2139525,2337154,2666111,3060348,3520376,4045684,4570991,5227369,5883748,6605661,7392854,8180303,8967495,9819967,10672695,11525166,12443174,13295646,14148121,15000344,15852828,16639780],Cividis:[11367,12400,537456,1455727,2046574,2571629,3031404,3425388,3754092,4148075,4476779,4805227,5133932,5396844,5725549,5988462,6317166,6580079,6843249,7171698,7434867,7697781,7960951,8289656,8618104,8881272,9209976,9538679,9867127,10195830,10524533,10853235,11181938,11510640,11839343,12168045,12497002,12891240,13219941,13548642,13943134,14271834,14666326,14995025,15389516,15718470,16112703,16507190,16639799],Twilight:[14670305,14211037,13554648,12766675,11847630,10993866,10139847,9351365,8628419,8036290,7509952,7048895,6718653,6519739,6386105,6252470,6184114,6181293,6112935,6044831,5976470,5777291,5447293,5052270,4592479,4067665,3674181,3281211,3150646,3543352,4067644,4657728,5379141,6166345,6953549,7741007,8463184,9120336,9777743,10304079,10830671,11291984,11687762,12083541,12348505,12613471,12878439,13077872,13211771,13411209,13545111,13809830,14074293,14338756,14537169,14735067,14801121]}),t.ColorOther=i.ColorTable({Rainbow:[3367393,3516485,16383744,15501073,12526114],RedWhiteBlue:[12526114,16777215,3367393]}),t.ColorNames=i.ColorMap({aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflower:6591981,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,laserlemon:16777044,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrod:16448210,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,maroon2:8323072,maroon3:11546720,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,purple2:8323199,purple3:10494192,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074}),t.ColorNamesValueMap=(r=new Map,Object.keys(t.ColorNames).forEach(function(e){r.set(t.ColorNames[e],e)}),r)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(71);t.NullLocationValue={location:r.NullLocation,index:0,groupIndex:0,instanceIndex:0,isSecondary:!1},t.LocationIterator=function(e,t,n,i,a){void 0===i&&(i=!1),void 0===a&&(a=function(){return!1});var o={location:r.NullLocation,index:0,groupIndex:0,instanceIndex:0,isSecondary:!1},u=o.groupIndex<e,s=!1,c=0,l=0;return{get hasNext(){return u},get isNextNewInstance(){return s},groupCount:e,instanceCount:t,count:e*t,isComplex:i,move:function(){return u&&(o.groupIndex=c,o.instanceIndex=l,o.index=l*e+c,o.location=n(c,l),o.isSecondary=a(c,l),++c===e?(s=!0,++l<t&&(c=0)):s=!1,u=c<e),o},reset:function(){o.location=r.NullLocation,o.index=0,o.groupIndex=0,o.instanceIndex=0,o.isSecondary=!1,u=o.groupIndex<e,s=!1,c=0,l=0},skipInstance:function(){u&&o.instanceIndex===l&&(c=0,u=++l<t)}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(269);!function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(269)),t.PluginCommands={State:{SetCurrentObject:r.PluginCommand(),ApplyAction:r.PluginCommand(),Update:r.PluginCommand(),RemoveObject:r.PluginCommand(),ToggleExpanded:r.PluginCommand({isImmediate:!0}),ToggleVisibility:r.PluginCommand({isImmediate:!0}),Highlight:r.PluginCommand({isImmediate:!0}),ClearHighlight:r.PluginCommand({isImmediate:!0}),Snapshots:{Add:r.PluginCommand({isImmediate:!0}),Remove:r.PluginCommand({isImmediate:!0}),Apply:r.PluginCommand({isImmediate:!0}),Clear:r.PluginCommand({isImmediate:!0}),Upload:r.PluginCommand({isImmediate:!0}),Fetch:r.PluginCommand(),DownloadToFile:r.PluginCommand({isImmediate:!0}),OpenFile:r.PluginCommand({isImmediate:!0})}},Layout:{Update:r.PluginCommand({isImmediate:!0})},Camera:{Reset:r.PluginCommand({isImmediate:!0}),SetSnapshot:r.PluginCommand({isImmediate:!0}),Snapshots:{Add:r.PluginCommand({isImmediate:!0}),Remove:r.PluginCommand({isImmediate:!0}),Apply:r.PluginCommand({isImmediate:!0}),Clear:r.PluginCommand({isImmediate:!0})}},Canvas3D:{SetSettings:r.PluginCommand({isImmediate:!0})}}},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(32),a=n(59),o=n(29),u=n(203),s=n(122),c=n(96),l=n(206);t.StructureRepresentationStateBuilder={create:function(){return r({},i.Representation.createState(),{unitTransforms:null})},update:function(e,t){i.Representation.updateState(e,t),void 0!==t.unitTransforms&&(e.unitTransforms=t.unitTransforms)}},t.StructureParams=r({},a.BaseGeometry.Params),t.StructureMeshParams=r({},o.Mesh.Params,t.StructureParams),t.StructureSpheresParams=r({},l.Spheres.Params,t.StructureParams),t.StructurePointsParams=r({},u.Points.Params,t.StructureParams),t.StructureLinesParams=r({},s.Lines.Params,t.StructureParams),t.StructureDirectVolumeParams=r({},c.DirectVolume.Params,t.StructureParams);var f=n(145);t.ComplexRepresentation=f.ComplexRepresentation;var d=n(84);t.UnitsRepresentation=d.UnitsRepresentation;var p=n(73);t.ComplexVisual=p.ComplexVisual;var h=n(46);t.UnitsVisual=h.UnitsVisual},function(e,t,n){"use strict";n.r(t);var r=n(4),i=n(161),a=n(130),o=n(47),u=n(12),s=n(162),c=n(102),l=n(64),f=n(111),d=n(14),p=n(169),h=n(0),m=n(65),y=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r}return h.a(t,e),t.prototype.requestAsyncId=function(t,n,r){return void 0===r&&(r=0),null!==r&&r>0?e.prototype.requestAsyncId.call(this,t,n,r):(t.actions.push(this),t.scheduled||(t.scheduled=requestAnimationFrame(function(){return t.flush(null)})))},t.prototype.recycleAsyncId=function(t,n,r){if(void 0===r&&(r=0),null!==r&&r>0||null===r&&this.delay>0)return e.prototype.recycleAsyncId.call(this,t,n,r);0===t.actions.length&&(cancelAnimationFrame(n),t.scheduled=void 0)},t}(m.a),v=n(63),b=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return h.a(t,e),t.prototype.flush=function(e){this.active=!0,this.scheduled=void 0;var t,n=this.actions,r=-1,i=n.length;e=e||n.shift();do{if(t=e.execute(e.state,e.delay))break}while(++r<i&&(e=n.shift()));if(this.active=!1,t){for(;++r<i&&(e=n.shift());)e.unsubscribe();throw t}},t}(v.a))(y),g=function(e){function t(t,n){void 0===t&&(t=_),void 0===n&&(n=Number.POSITIVE_INFINITY);var r=e.call(this,t,function(){return r.frame})||this;return r.maxFrames=n,r.frame=0,r.index=-1,r}return h.a(t,e),t.prototype.flush=function(){for(var e,t,n=this.actions,r=this.maxFrames;(t=n[0])&&t.delay<=r&&(n.shift(),this.frame=t.delay,!(e=t.execute(t.state,t.delay))););if(e){for(;t=n.shift();)t.unsubscribe();throw e}},t.frameTimeFactor=10,t}(v.a),_=function(e){function t(t,n,r){void 0===r&&(r=t.index+=1);var i=e.call(this,t,n)||this;return i.scheduler=t,i.work=n,i.index=r,i.active=!0,i.index=t.index=r,i}return h.a(t,e),t.prototype.schedule=function(n,r){if(void 0===r&&(r=0),!this.id)return e.prototype.schedule.call(this,n,r);this.active=!1;var i=new t(this.scheduler,this.work);return this.add(i),i.schedule(n,r)},t.prototype.requestAsyncId=function(e,n,r){void 0===r&&(r=0),this.delay=e.frame+r;var i=e.actions;return i.push(this),i.sort(t.sortActions),!0},t.prototype.recycleAsyncId=function(e,t,n){void 0===n&&(n=0)},t.prototype._execute=function(t,n){if(!0===this.active)return e.prototype._execute.call(this,t,n)},t.sortActions=function(e,t){return e.delay===t.delay?e.index===t.index?0:e.index>t.index?1:-1:e.delay>t.delay?1:-1},t}(m.a),S=n(129),C=n(10),x=n(1),w=n(41),P=n(87),T=n(33),A=n(40);function E(e){return!!e&&(e instanceof r.a||"function"==typeof e.lift&&"function"==typeof e.subscribe)}var k=n(56),I=n(62),M=n(48),V=n(89),O=n(164),D=n(22),R=n(109),j=n(15),N=n(20);function B(e,t,n){if(t){if(!Object(N.a)(t))return function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];return B(e,n).apply(void 0,r).pipe(Object(D.a)(function(e){return Object(j.a)(e)?t.apply(void 0,e):t(e)}))};n=t}return function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var a,o=this,u={context:o,subject:a,callbackFunc:e,scheduler:n};return new r.a(function(r){if(n){var i={args:t,subscriber:r,params:u};return n.schedule(F,0,i)}if(!a){a=new l.a;try{e.apply(o,t.concat([function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];a.next(e.length<=1?e[0]:e),a.complete()}]))}catch(e){Object(R.a)(a)?a.error(e):console.warn(e)}}return a.subscribe(r)})}}function F(e){var t=this,n=e.args,r=e.subscriber,i=e.params,a=i.callbackFunc,o=i.context,u=i.scheduler,s=i.subject;if(!s){s=i.subject=new l.a;try{a.apply(o,n.concat([function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=e.length<=1?e[0]:e;t.add(u.schedule(L,0,{value:r,subject:s}))}]))}catch(e){s.error(e)}}this.add(s.subscribe(r))}function L(e){var t=e.value,n=e.subject;n.next(t),n.complete()}function z(e,t,n){if(t){if(!Object(N.a)(t))return function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];return z(e,n).apply(void 0,r).pipe(Object(D.a)(function(e){return Object(j.a)(e)?t.apply(void 0,e):t(e)}))};n=t}return function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var a={subject:void 0,args:t,callbackFunc:e,scheduler:n,context:this};return new r.a(function(r){var i=a.context,o=a.subject;if(n)return n.schedule(U,0,{params:a,subscriber:r,context:i});if(!o){o=a.subject=new l.a;try{e.apply(i,t.concat([function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e.shift();n?o.error(n):(o.next(e.length<=1?e[0]:e),o.complete())}]))}catch(e){Object(R.a)(o)?o.error(e):console.warn(e)}}return o.subscribe(r)})}}function U(e){var t=this,n=e.params,r=e.subscriber,i=e.context,a=n.callbackFunc,o=n.args,u=n.scheduler,s=n.subject;if(!s){s=n.subject=new l.a;try{a.apply(i,o.concat([function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=e.shift();if(r)t.add(u.schedule(q,0,{err:r,subject:s}));else{var i=e.length<=1?e[0]:e;t.add(u.schedule(G,0,{value:i,subject:s}))}}]))}catch(e){this.add(u.schedule(q,0,{err:e,subject:s}))}}this.add(s.subscribe(r))}function G(e){var t=e.value,n=e.subject;n.next(t),n.complete()}function q(e){var t=e.err;e.subject.error(t)}var H=n(105),W=n(49),Y=n(107),K=n(13),X=n(6);function Q(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return"function"==typeof t[t.length-1]&&(e=t.pop()),1===t.length&&Object(j.a)(t[0])&&(t=t[0]),0===t.length?K.a:e?Q(t).pipe(Object(D.a)(function(t){return e.apply(void 0,t)})):new r.a(function(e){return new Z(e,t)})}var Z=function(e){function t(t,n){var r=e.call(this,t)||this;r.sources=n,r.completed=0,r.haveValues=0;var i=n.length;r.values=new Array(i);for(var a=0;a<i;a++){var o=n[a],u=Object(X.a)(r,o,null,a);u&&r.add(u)}return r}return h.a(t,e),t.prototype.notifyNext=function(e,t,n,r,i){this.values[n]=t,i._hasValue||(i._hasValue=!0,this.haveValues++)},t.prototype.notifyComplete=function(e){var t=this.destination,n=this.haveValues,r=this.values,i=r.length;e._hasValue?(this.completed++,this.completed===i&&(n===i&&t.next(r),t.complete())):t.complete()},t}(n(8).a),J=n(25),$=n(57);Object.prototype.toString;function ee(e,t,n,i){return Object($.a)(n)&&(i=n,n=void 0),i?ee(e,t,n).pipe(Object(D.a)(function(e){return Object(j.a)(e)?i.apply(void 0,e):i(e)})):new r.a(function(r){!function e(t,n,r,i,a){var o;if(function(e){return e&&"function"==typeof e.addEventListener&&"function"==typeof e.removeEventListener}(t)){var u=t;t.addEventListener(n,r,a),o=function(){return u.removeEventListener(n,r,a)}}else if(function(e){return e&&"function"==typeof e.on&&"function"==typeof e.off}(t)){var s=t;t.on(n,r),o=function(){return s.off(n,r)}}else if(function(e){return e&&"function"==typeof e.addListener&&"function"==typeof e.removeListener}(t)){var c=t;t.addListener(n,r),o=function(){return c.removeListener(n,r)}}else{if(!t||!t.length)throw new TypeError("Invalid event target");for(var l=0,f=t.length;l<f;l++)e(t[l],n,r,i,a)}i.add(o)}(e,t,function(e){arguments.length>1?r.next(Array.prototype.slice.call(arguments)):r.next(e)},r,n)})}function te(e,t,n){return n?te(e,t).pipe(Object(D.a)(function(e){return Object(j.a)(e)?n.apply(void 0,e):n(e)})):new r.a(function(n){var r,i=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return n.next(1===e.length?e[0]:e)};try{r=e(i)}catch(e){return void n.error(e)}if(Object($.a)(t))return function(){return t(i,r)}})}function ne(e,t,n,i,a){var o,u;if(1==arguments.length){var s=e;u=s.initialState,t=s.condition,n=s.iterate,o=s.resultSelector||A.a,a=s.scheduler}else void 0===i||Object(N.a)(i)?(u=e,o=A.a,a=i):(u=e,o=i);return new r.a(function(e){var r=u;if(a)return a.schedule(re,0,{subscriber:e,iterate:n,condition:t,resultSelector:o,state:r});for(;;){if(t){var i=void 0;try{i=t(r)}catch(t){return void e.error(t)}if(!i){e.complete();break}}var s=void 0;try{s=o(r)}catch(t){return void e.error(t)}if(e.next(s),e.closed)break;try{r=n(r)}catch(t){return void e.error(t)}}})}function re(e){var t=e.subscriber,n=e.condition;if(!t.closed){if(e.needIterate)try{e.state=e.iterate(e.state)}catch(e){return void t.error(e)}else e.needIterate=!0;if(n){var r=void 0;try{r=n(e.state)}catch(e){return void t.error(e)}if(!r)return void t.complete();if(t.closed)return}var i;try{i=e.resultSelector(e.state)}catch(e){return void t.error(e)}if(!t.closed&&(t.next(i),!t.closed))return this.schedule(e)}}function ie(e,t,n){return void 0===t&&(t=K.a),void 0===n&&(n=K.a),Object(Y.a)(function(){return e()?t:n})}var ae=n(66);function oe(e,t){return void 0===e&&(e=0),void 0===t&&(t=d.a),(!Object(ae.a)(e)||e<0)&&(e=0),t&&"function"==typeof t.schedule||(t=d.a),new r.a(function(n){return n.add(t.schedule(ue,e,{subscriber:n,counter:0,period:e})),n})}function ue(e){var t=e.subscriber,n=e.counter,r=e.period;t.next(n),this.schedule({subscriber:t,counter:n+1,period:r},r)}var se=n(166),ce=new r.a(T.a);function le(){return ce}var fe=n(103);function de(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(0===e.length)return K.a;var n=e[0],i=e.slice(1);return 1===e.length&&Object(j.a)(n)?de.apply(void 0,n):new r.a(function(e){var t=function(){return e.add(de.apply(void 0,i).subscribe(e))};return Object(J.a)(n).subscribe({next:function(t){e.next(t)},error:t,complete:t})})}function pe(e,t){return t?new r.a(function(n){var r=Object.keys(e),i=new C.a;return i.add(t.schedule(he,0,{keys:r,index:0,subscriber:n,subscription:i,obj:e})),i}):new r.a(function(t){for(var n=Object.keys(e),r=0;r<n.length&&!t.closed;r++){var i=n[r];e.hasOwnProperty(i)&&t.next([i,e[i]])}t.complete()})}function he(e){var t=e.keys,n=e.index,r=e.subscriber,i=e.subscription,a=e.obj;if(!r.closed)if(n<t.length){var o=t[n];r.next([o,a[o]]),i.add(this.schedule({keys:t,index:n+1,subscriber:r,subscription:i,obj:a}))}else r.complete()}var me=n(167);function ye(e,t,n){return void 0===e&&(e=0),new r.a(function(r){void 0===t&&(t=e,e=0);var i=0,a=e;if(n)return n.schedule(ve,0,{index:i,count:t,start:e,subscriber:r});for(;;){if(i++>=t){r.complete();break}if(r.next(a++),r.closed)break}})}function ve(e){var t=e.start,n=e.index,r=e.count,i=e.subscriber;n>=r?i.complete():(i.next(t),i.closed||(e.index=n+1,e.start=t+1,this.schedule(e)))}var be=n(104),ge=n(168);function _e(e,t){return new r.a(function(n){var r,i;try{r=e()}catch(e){return void n.error(e)}try{i=t(r)}catch(e){return void n.error(e)}var a=(i?Object(J.a)(i):K.a).subscribe(n);return function(){a.unsubscribe(),r&&r.unsubscribe()}})}var Se=n(108),Ce=n(31);n.d(t,"Observable",function(){return r.a}),n.d(t,"ConnectableObservable",function(){return i.a}),n.d(t,"GroupedObservable",function(){return a.a}),n.d(t,"observable",function(){return o.a}),n.d(t,"Subject",function(){return u.a}),n.d(t,"BehaviorSubject",function(){return s.a}),n.d(t,"ReplaySubject",function(){return c.a}),n.d(t,"AsyncSubject",function(){return l.a}),n.d(t,"asapScheduler",function(){return f.a}),n.d(t,"asyncScheduler",function(){return d.a}),n.d(t,"queueScheduler",function(){return p.a}),n.d(t,"animationFrameScheduler",function(){return b}),n.d(t,"VirtualTimeScheduler",function(){return g}),n.d(t,"VirtualAction",function(){return _}),n.d(t,"Scheduler",function(){return S.a}),n.d(t,"Subscription",function(){return C.a}),n.d(t,"Subscriber",function(){return x.a}),n.d(t,"Notification",function(){return w.a}),n.d(t,"pipe",function(){return P.a}),n.d(t,"noop",function(){return T.a}),n.d(t,"identity",function(){return A.a}),n.d(t,"isObservable",function(){return E}),n.d(t,"ArgumentOutOfRangeError",function(){return k.a}),n.d(t,"EmptyError",function(){return I.a}),n.d(t,"ObjectUnsubscribedError",function(){return M.a}),n.d(t,"UnsubscriptionError",function(){return V.a}),n.d(t,"TimeoutError",function(){return O.a}),n.d(t,"bindCallback",function(){return B}),n.d(t,"bindNodeCallback",function(){return z}),n.d(t,"combineLatest",function(){return H.b}),n.d(t,"concat",function(){return W.a}),n.d(t,"defer",function(){return Y.a}),n.d(t,"empty",function(){return K.b}),n.d(t,"forkJoin",function(){return Q}),n.d(t,"from",function(){return J.a}),n.d(t,"fromEvent",function(){return ee}),n.d(t,"fromEventPattern",function(){return te}),n.d(t,"generate",function(){return ne}),n.d(t,"iif",function(){return ie}),n.d(t,"interval",function(){return oe}),n.d(t,"merge",function(){return se.a}),n.d(t,"never",function(){return le}),n.d(t,"of",function(){return fe.a}),n.d(t,"onErrorResumeNext",function(){return de}),n.d(t,"pairs",function(){return pe}),n.d(t,"race",function(){return me.a}),n.d(t,"range",function(){return ye}),n.d(t,"throwError",function(){return be.a}),n.d(t,"timer",function(){return ge.a}),n.d(t,"using",function(){return _e}),n.d(t,"zip",function(){return Se.b}),n.d(t,"EMPTY",function(){return K.a}),n.d(t,"NEVER",function(){return ce}),n.d(t,"config",function(){return Ce.a})},function(e,t,n){"use strict";function r(e){return e}n.d(t,"a",function(){return r})},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var r,i=n(13),a=n(103),o=n(104);r||(r={});var u=function(){function e(e,t,n){this.kind=e,this.value=t,this.error=n,this.hasValue="N"===e}return e.prototype.observe=function(e){switch(this.kind){case"N":return e.next&&e.next(this.value);case"E":return e.error&&e.error(this.error);case"C":return e.complete&&e.complete()}},e.prototype.do=function(e,t,n){switch(this.kind){case"N":return e&&e(this.value);case"E":return t&&t(this.error);case"C":return n&&n()}},e.prototype.accept=function(e,t,n){return e&&"function"==typeof e.next?this.observe(e):this.do(e,t,n)},e.prototype.toObservable=function(){switch(this.kind){case"N":return Object(a.a)(this.value);case"E":return Object(o.a)(this.error);case"C":return Object(i.b)()}throw new Error("unexpected notification kind value")},e.createNext=function(t){return void 0!==t?new e("N",t):e.undefinedValueNotification},e.createError=function(t){return new e("E",void 0,t)},e.createComplete=function(){return e.completeNotification},e.completeNotification=new e("C"),e.undefinedValueNotification=new e("N",void 0),e}()},function(e,t,n){"use strict";function r(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}n.d(t,"a",function(){return i});var i=r()},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0});var i=n(116);t.StructureElement=i.default;var a=n(92);t.Structure=a.default;var o=n(78);t.Unit=o.default;var u=n(140);t.StructureSymmetry=u.default;var s=n(117);t.Link=s.Link;var c=n(252);t.StructureProperties=c.default,r(n(194)),r(n(407))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(365),i=n(373),a=n(137),o=n(138);!function(e){e.Encoder=a.Encoder,e.Category=a.Category,e.Field=a.Field,e.Encoding=o.ArrayEncoding,e.createEncoder=function(e){var t=e||{},n=t.binary,a=void 0!==n&&n,o=t.encoderName,u=void 0===o?"mol*":o;return a?new i.default(u,e?e.binaryEncodingPovider:void 0,!!e&&!!e.binaryAutoClassifyEncoding):new r.default},e.fields=function(){return e.Field.build()};var t=e.Encoding;e.Encodings={deltaRLE:t.by(t.delta).and(t.runLength).and(t.integerPacking),fixedPoint2:t.by(t.fixedPoint(100)).and(t.delta).and(t.integerPacking),fixedPoint3:t.by(t.fixedPoint(1e3)).and(t.delta).and(t.integerPacking)},e.categoryInstance=function(e,t){return{fields:e,source:[t]}},e.createEncodingProviderFromCifFrame=function(e){return{get:function(t,n){var r=e.categories[t];if(r){var i=r.getField(n);return i&&i.binaryEncoding?o.ArrayEncoder.fromEncoding(i.binaryEncoding):void 0}}}}}(t.CifWriter||(t.CifWriter={}))},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(370)),r(n(371)),r(n(372))},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(9),a=n(125),o=n(38),u=n(16),s=n(79),c=n(7),l=n(5),f=n(70),d=n(51),p=n(72),h=n(58),m=n(29),y=n(203),v=n(122),b=n(96),g=n(123),_=n(53),S=n(124),C=n(144),x=n(84),w=n(206),P=n(60);function T(e){var t,n,r,o,m,y,v,b=e.defaultProps,C=e.createGeometry,x=e.createLocationIterator,w=e.getLoci,T=e.mark,A=e.setUpdateState,E=e.geometryUtils,k=E.createEmpty,I=E.updateValues,M=E.updateBoundingSphere,V=E.updateRenderableState,O=g.VisualUpdateState.create(),D=Object.assign({},b),R=_.createEmptyTheme();function j(e){if(O.createNew){if(v=x(n.group),!e)throw new Error("expected geometry to be given");t=function(e,t,n,r,i){var a=f.Geometry.getUtils(t),o=a.createValues,u=a.createRenderableState,c=o(t,P.createUnitsTransform(e),n,r,i),l=u(i);return s.createRenderObject(t.kind,c,l)}(n.group,e,v,R,D)}else{if(!t)throw new Error("expected renderObject to be available");if(O.updateTransform){var i=(v=x(n.group)).instanceCount,a=v.groupCount;d.createMarkers(i*a,t.values)}if(O.updateMatrix&&P.createUnitsTransform(n.group,t.values),O.createGeometry){if(!e)throw new Error("expected geometry to be given");c.ValueCell.update(t.values.drawCount,f.Geometry.getDrawCount(e))}(O.updateTransform||O.createGeometry)&&M(t.values,e||y),O.updateSize&&"uSize"in t.values&&p.createSizes(v,R.size,t.values),O.updateColor&&h.createColors(v,R.color,t.values),I(t.values,D),V(t.state,D)}r=D,o=R,m=n,e&&(y=e)}return{get groupCount(){return v?v.count:0},get renderObject(){return v&&v.count?t:void 0},createOrUpdate:function(e,a,u,s){if(void 0===u&&(u={}),function(e,a,u){if(void 0===a&&(a={}),!u&&!m)throw new Error("missing structureGroup");D=Object.assign({},r,a),R=e,n=u,g.VisualUpdateState.reset(O),t&&m&&n.group.hashCode===m.group.hashCode||(O.createNew=!0),O.createNew?O.createGeometry=!0:(A(O,D,r,e,o),S.ColorTheme.areEqual(e.color,o.color)||(O.updateColor=!0),c.deepEqual(D.unitKinds,r.unitKinds)||(O.createGeometry=!0),n.group.transformHash!==m.group.transformHash&&(n.group.units.length!==m.group.units.length||O.updateColor?O.updateTransform=!0:O.updateMatrix=!0),i.Unit.conformationId(n.group.units[0])!==i.Unit.conformationId(m.group.units[0])&&(O.createGeometry=!0),O.updateTransform&&(O.updateColor=!0,O.updateSize=!0,O.updateMatrix=!0),O.createGeometry&&(O.updateColor=!0,O.updateSize=!0))}(a,u,s||m),O.createGeometry){var l=function(e,t,n,r,i,a){return P.includesUnitKind(i.unitKinds,t)?C(e,t,n,r,i,a):k(a)}(e,n.group.units[0],n.structure,R,D,y);return l instanceof Promise?l.then(j):j(l)}j()},getLoci:function(e){return t?w(e,m,t.id):u.EmptyLoci},mark:function(e,n){if(!t)return!1;var r=t.values.tMarker,a=v.groupCount,o=v.instanceCount;function s(e){var t=l.Interval.start(e),i=l.Interval.end(e);return d.applyMarkerAction(r.ref.value.array,t,i,n)}var f=!1;return(f=u.isEveryLoci(e)||i.Structure.isLoci(e)&&e.structure===m.structure?s(l.Interval.ofBounds(0,a*o)):T(e,m,s))&&c.ValueCell.update(r,r.ref.value),f},setVisibility:function(e){a.Visual.setVisibility(t,e)},setPickable:function(e){a.Visual.setPickable(t,e)},setTransform:function(e,n){a.Visual.setTransform(t,e,n)},destroy:function(){t=void 0}}}t.UnitsVisual=T,t.UnitsMeshParams=r({},o.StructureMeshParams,x.UnitsParams),t.UnitsMeshVisual=function(e){return T(r({},e,{setUpdateState:function(t,n,r,i,a){e.setUpdateState(t,n,r,i,a),C.SizeTheme.areEqual(i.size,a.size)||(t.createGeometry=!0)},geometryUtils:m.Mesh.Utils}))},t.UnitsSpheresParams=r({},o.StructureSpheresParams,x.UnitsParams),t.UnitsSpheresVisual=function(e){return T(r({},e,{setUpdateState:function(t,n,r,i,a){e.setUpdateState(t,n,r,i,a),C.SizeTheme.areEqual(i.size,a.size)||(t.updateSize=!0)},geometryUtils:w.Spheres.Utils}))},t.UnitsPointsParams=r({},o.StructurePointsParams,x.UnitsParams),t.UnitsPointsVisual=function(e){return T(r({},e,{setUpdateState:function(t,n,r,i,a){e.setUpdateState(t,n,r,i,a),C.SizeTheme.areEqual(i.size,a.size)||(t.updateSize=!0)},geometryUtils:y.Points.Utils}))},t.UnitsLinesParams=r({},o.StructureLinesParams,x.UnitsParams),t.UnitsLinesVisual=function(e){return T(r({},e,{setUpdateState:function(t,n,r,i,a){e.setUpdateState(t,n,r,i,a),C.SizeTheme.areEqual(i.size,a.size)||(t.updateSize=!0)},geometryUtils:v.Lines.Utils}))},t.UnitsDirectVolumeParams=r({},o.StructureDirectVolumeParams,x.UnitsParams),t.UnitsDirectVolumeVisual=function(e){return T(r({},e,{setUpdateState:function(t,n,r,i,a){e.setUpdateState(t,n,r,i,a),C.SizeTheme.areEqual(i.size,a.size)||(t.createGeometry=!0)},geometryUtils:b.DirectVolume.Utils}))}},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var r="function"==typeof Symbol&&Symbol.observable||"@@observable"},function(e,t,n){"use strict";function r(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}n.d(t,"a",function(){return i}),r.prototype=Object.create(Error.prototype);var i=r},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var r=n(103),i=n(165);function a(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Object(i.a)()(r.a.apply(void 0,e))}},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(186),a=n(35),o=n(7);function u(e){return e in a.ColorBrewer?a.ColorBrewer[e]:e in a.ColorMatplotlib?a.ColorMatplotlib[e]:e in a.ColorOther?a.ColorOther[e]:(console.warn("unknown color list named '"+e+"'"),a.ColorBrewer.RedYellowBlue)}function s(e,t,n){return{kind:"scale-legend",minLabel:e,maxLabel:t,colors:n}}t.ColorListNames=Object.keys(a.ColorBrewer).concat(Object.keys(a.ColorMatplotlib),Object.keys(a.ColorOther)),t.ColorListOptions=t.ColorListNames.map(function(e){return[e,e]}),t.getColorListFromName=u,t.ScaleLegend=s,t.DefaultColorScaleProps={domain:[0,1],reverse:!1,listOrName:a.ColorBrewer.RedYellowBlue,minLabel:"",maxLabel:""},function(e){e.create=function(e){var n=r({},t.DefaultColorScaleProps,e),a=n.domain,c=n.reverse,l=n.listOrName,f="string"==typeof l?u(l):l,d=c?f.slice().reverse():f,p=d.length-1,h=0,m=0,y=0;function v(e,t){h=(y=t)-(m=e)||1}v(a[0],a[1]);var b=o.defaults(e.minLabel,m.toString()),g=o.defaults(e.maxLabel,y.toString());function _(e){var t=Math.min(d.length-1,Math.max(0,(e-m)/h*p)),n=Math.floor(t),r=d[n],a=d[Math.ceil(t)];return i.Color.interpolate(r,a,t-n)}return{color:_,colorToArray:function(e,t,n){i.Color.toArray(_(e),t,n)},normalizedColorToArray:function(e,t,n){i.Color.toArrayNormalized(_(e),t,n)},setDomain:v,get legend(){return s(b,g,d)}}}}(t.ColorScale||(t.ColorScale={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(77),a=n(2),o=n(52);!function(e){e[e.Highlight=0]="Highlight",e[e.RemoveHighlight=1]="RemoveHighlight",e[e.Select=2]="Select",e[e.Deselect=3]="Deselect",e[e.Toggle=4]="Toggle",e[e.Clear=5]="Clear"}(r=t.MarkerAction||(t.MarkerAction={})),t.applyMarkerAction=function(e,t,n,i){for(var a=!1,o=t;o<n;++o){var u=e[o];switch(i){case r.Highlight:u%2==0&&(u+=1);break;case r.RemoveHighlight:u%2!=0&&(u-=1);break;case r.Select:u+=2;break;case r.Deselect:u>=2&&(u-=2);break;case r.Toggle:u>=2?u-=2:u+=2;break;case r.Clear:u=0}a=e[o]!==u||a,e[o]=u}return a},t.createMarkers=function(e,t){var n=t&&t.tMarker.ref.value.array.length>=e?t.tMarker.ref.value:o.createTextureImage(e,1);return t?(i.ValueCell.update(t.tMarker,n),i.ValueCell.update(t.uMarkerTexDim,a.Vec2.create(n.width,n.height)),t):{tMarker:i.ValueCell.create(n),uMarkerTexDim:i.ValueCell.create(a.Vec2.create(n.width,n.height))}};var u={array:new Uint8Array(1),width:1,height:1};t.createEmptyMarkers=function(e){return e?(i.ValueCell.update(e.tMarker,u),i.ValueCell.update(e.uMarkerTexDim,a.Vec2.create(1,1)),e):{tMarker:i.ValueCell.create(u),uMarkerTexDim:i.ValueCell.create(a.Vec2.create(1,1))}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(19),i=n(2),a=n(136);function o(e,t){var n=Math.sqrt(e),r=Math.ceil(n),i=(r+=(t-r%t)%t)>0?Math.ceil(e/r):0;return{width:r,height:i,length:r*i*t}}function u(e,t){void 0===t&&(t=1);var n=document.createElement("canvas");n.width=e.width,n.height=e.height;var r=n.getContext("2d");if(!r)throw new Error("Could not create canvas 2d context");r.putImageData(e,0,0),n.toBlob(function(n){var r=window.URL.createObjectURL(n),i=document.createElement("img");i.src=r,i.style.width=e.width*t+"px",i.style.height=e.height*t+"px",i.style.position="absolute",i.style.top="0px",i.style.left="0px",i.style.border="solid grey",document.body.appendChild(i)},"image/png")}t.calculateTextureInfo=o,t.createTextureImage=function(e,t){var n=o(e,t),r=n.length,i=n.width,a=n.height;return{array:new Uint8Array(r),width:i,height:a}},t.printTextureImage=function(e,t){void 0===t&&(t=1);var n=e.array,r=e.width,i=e.height,a=n.length/(r*i),o=new Uint8ClampedArray(r*i*4);if(1===a)for(var s=0;s<i;++s)for(var c=0;c<r;++c)o[4*(s*r+c)+3]=n[s*r+c];else 4===a?o.set(n):console.warn("itemSize '"+a+"' not supported");return u(new ImageData(o,r,i),t)},t.printImageData=u;var s=i.Vec3.zero(),c=new a.BoundaryHelper;function l(e,t){c.reset(0);for(var n=0,r=3*t;n<r;n+=3)i.Vec3.fromArray(s,e,n),c.boundaryStep(s,0);c.finishBoundaryStep();for(n=0,r=3*t;n<r;n+=3)i.Vec3.fromArray(s,e,n),c.extendStep(s,0);return c.getSphere()}function f(e,t,n){var r=e.center,a=e.radius;c.reset(0);for(var o=0,u=n;o<u;++o)i.Vec3.transformMat4Offset(s,r,t,0,0,16*o),c.boundaryStep(s,a);c.finishBoundaryStep();for(o=0,u=n;o<u;++o)i.Vec3.transformMat4Offset(s,r,t,0,0,16*o),c.extendStep(s,a);return c.getSphere()}t.calculateInvariantBoundingSphere=l,t.calculateTransformBoundingSphere=f,t.calculateBoundingSphere=function(e,t,n,i,a){void 0===a&&(a=0);var o=l(e,t),u=f(o,n,i);return r.Sphere3D.expand(u,u,a),r.Sphere3D.expand(o,o,a),{boundingSphere:u,invariantBoundingSphere:o}}},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(124),a=n(144),o=n(3);function u(){return{color:i.ColorTheme.Empty,size:a.SizeTheme.Empty}}function s(e){return e.map(function(e){return[e.name,e.provider.label]})}t.createTheme=function(e,t,n,r){r=r||u();var i=n.colorTheme,a=n.sizeTheme;return r.color=e.colorThemeRegistry.create(i.name,t,i.params),r.size=e.sizeThemeRegistry.create(a.name,t,a.params),r},t.createEmptyTheme=u;var c=function(){function e(e,t){var n=this;this.emptyProvider=t,this._list=[],this._map=new Map,Object.keys(e).forEach(function(t){return n.add(t,e[t])})}return Object.defineProperty(e.prototype,"default",{get:function(){return this._list[0]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"list",{get:function(){return this._list},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"types",{get:function(){return s(this._list)},enumerable:!0,configurable:!0}),e.prototype.add=function(e,t){this._list.push({name:e,provider:t}),this._map.set(e,t)},e.prototype.remove=function(e){this._list.splice(this._list.findIndex(function(t){return t.name===e}),1),this._map.delete(e),console.log("removed",e,this._list,this._map)},e.prototype.get=function(e){return this._map.get(e)||this.emptyProvider},e.prototype.create=function(e,t,n){void 0===n&&(n={});var i=this.get(e);return i.factory(t,r({},o.ParamDefinition.getDefaultValues(i.getParams(t)),n))},e.prototype.getApplicableList=function(e){return this._list.filter(function(t){return t.provider.isApplicable(e)})},e.prototype.getApplicableTypes=function(e){return s(this.getApplicableList(e))},e}();t.ThemeRegistry=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(77),i=n(2),a=n(17),o=n(95),u=i.Vec3.zero(),s=i.Mat3.zero();!function(e){e.createState=function(e,t,n){return void 0===e&&(e=2048),void 0===t&&(t=1024),{currentGroup:-1,vertices:a.ChunkedArray.create(Float32Array,3,t,n?n.vertexBuffer.ref.value:e),normals:a.ChunkedArray.create(Float32Array,3,t,n?n.normalBuffer.ref.value:e),indices:a.ChunkedArray.create(Uint32Array,3,3*t,n?n.indexBuffer.ref.value:3*e),groups:a.ChunkedArray.create(Float32Array,1,t,n?n.groupBuffer.ref.value:e),mesh:n}},e.addPrimitive=function(e,t,n){for(var r=n.vertices,c=n.normals,l=n.indices,f=e.vertices,d=e.normals,p=e.indices,h=e.groups,m=e.currentGroup,y=f.elementCount,v=o.getNormalMatrix(s,t),b=0,g=r.length;b<g;b+=3)i.Vec3.transformMat4(u,i.Vec3.fromArray(u,r,b),t),a.ChunkedArray.add3(f,u[0],u[1],u[2]),i.Vec3.transformMat3(u,i.Vec3.fromArray(u,c,b),v),a.ChunkedArray.add3(d,u[0],u[1],u[2]),a.ChunkedArray.add(h,m);for(b=0,g=l.length;b<g;b+=3)a.ChunkedArray.add3(p,l[b]+y,l[b+1]+y,l[b+2]+y)},e.getMesh=function(e){var t=e.vertices,n=e.normals,i=e.indices,o=e.groups,u=e.mesh,s=a.ChunkedArray.compact(t,!0),c=a.ChunkedArray.compact(i,!0),l=a.ChunkedArray.compact(n,!0),f=a.ChunkedArray.compact(o,!0);return{kind:"mesh",vertexCount:e.vertices.elementCount,triangleCount:e.indices.elementCount,vertexBuffer:u?r.ValueCell.update(u.vertexBuffer,s):r.ValueCell.create(s),indexBuffer:u?r.ValueCell.update(u.indexBuffer,c):r.ValueCell.create(c),normalBuffer:u?r.ValueCell.update(u.normalBuffer,l):r.ValueCell.create(l),groupBuffer:u?r.ValueCell.update(u.groupBuffer,f):r.ValueCell.create(f),normalsComputed:!0}}}(t.MeshBuilder||(t.MeshBuilder={}))},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var r=n(0),i=n(6),a=n(8),o=n(30),u=n(22),s=n(25);function c(e,t,n){return void 0===n&&(n=Number.POSITIVE_INFINITY),"function"==typeof t?function(r){return r.pipe(c(function(n,r){return Object(s.a)(e(n,r)).pipe(Object(u.a)(function(e,i){return t(n,e,r,i)}))},n))}:("number"==typeof t&&(n=t),function(t){return t.lift(new l(e,n))})}var l=function(){function e(e,t){void 0===t&&(t=Number.POSITIVE_INFINITY),this.project=e,this.concurrent=t}return e.prototype.call=function(e,t){return t.subscribe(new f(e,this.project,this.concurrent))},e}(),f=function(e){function t(t,n,r){void 0===r&&(r=Number.POSITIVE_INFINITY);var i=e.call(this,t)||this;return i.project=n,i.concurrent=r,i.hasCompleted=!1,i.buffer=[],i.active=0,i.index=0,i}return r.a(t,e),t.prototype._next=function(e){this.active<this.concurrent?this._tryNext(e):this.buffer.push(e)},t.prototype._tryNext=function(e){var t,n=this.index++;try{t=this.project(e,n)}catch(e){return void this.destination.error(e)}this.active++,this._innerSub(t,e,n)},t.prototype._innerSub=function(e,t,n){var r=new o.a(this,void 0,void 0);this.destination.add(r),Object(i.a)(this,e,t,n,r)},t.prototype._complete=function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()},t.prototype.notifyNext=function(e,t,n,r,i){this.destination.next(t)},t.prototype.notifyComplete=function(e){var t=this.buffer;this.remove(e),this.active--,t.length>0?this._next(t.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()},t}(a.a)},function(e,t,n){"use strict";function r(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}n.d(t,"a",function(){return i}),r.prototype=Object.create(Error.prototype);var i=r},function(e,t,n){"use strict";function r(e){return"function"==typeof e}n.d(t,"a",function(){return r})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(7),i=n(52),a=n(18),o=n(2),u=n(71),s=n(70);function c(e,t){return t?(r.ValueCell.update(t.uColor,a.Color.toRgbNormalized(e)),"uniform"!==t.dColorType.ref.value&&r.ValueCell.update(t.dColorType,"uniform"),t):{uColor:r.ValueCell.create(a.Color.toRgbNormalized(e)),tColor:r.ValueCell.create({disabled:!0,array:new Uint8Array(3),width:1,height:1}),uColorTexDim:r.ValueCell.create(o.Vec2.create(1,1)),dColorType:r.ValueCell.create("uniform")}}function l(e,t,n){return c(t(u.NullLocation,!1),n)}function f(e,t,n){return n?(r.ValueCell.update(n.tColor,e),r.ValueCell.update(n.uColorTexDim,o.Vec2.create(e.width,e.height)),n.dColorType.ref.value!==t&&r.ValueCell.update(n.dColorType,t),n):{uColor:r.ValueCell.create(o.Vec3.zero()),tColor:r.ValueCell.create(e),uColorTexDim:r.ValueCell.create(o.Vec2.create(e.width,e.height)),dColorType:r.ValueCell.create(t)}}function d(e,t,n){var r=e.instanceCount,o=n&&n.tColor.ref.value.array.length>=3*r?n.tColor.ref.value:i.createTextureImage(r,3);for(e.reset();e.hasNext;){var u=e.move(),s=u.location,c=u.isSecondary,l=u.instanceIndex;a.Color.toArray(t(s,c),o.array,3*l),e.skipInstance()}return f(o,"instance",n)}function p(e,t,n){var r=e.groupCount,o=n&&n.tColor.ref.value.array.length>=3*r?n.tColor.ref.value:i.createTextureImage(r,3);for(e.reset();e.hasNext&&!e.isNextNewInstance;){var u=e.move(),s=u.location,c=u.isSecondary,l=u.groupIndex;a.Color.toArray(t(s,c),o.array,3*l)}return f(o,"group",n)}function h(e,t,n){var r=e.groupCount,o=e.instanceCount*r,u=n&&n.tColor.ref.value.array.length>=3*o?n.tColor.ref.value:i.createTextureImage(o,3);for(e.reset();e.hasNext;){var s=e.move(),c=s.location,l=s.isSecondary,d=s.index;a.Color.toArray(t(c,l),u.array,3*d)}return f(u,"groupInstance",n)}t.createColors=function(e,t,n){switch(s.Geometry.getGranularity(e,t.granularity)){case"uniform":return l(e,t.color,n);case"group":return p(e,t.color,n);case"groupInstance":return h(e,t.color,n);case"instance":return d(e,t.color,n)}},t.createValueColor=c,t.createUniformColor=l,t.createTextureColor=f,t.createInstanceColor=d,t.createGroupColor=p,t.createGroupInstanceColor=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(7),i=n(36),a=n(3),o=n(18),u=n(2),s=n(82),c=n(35),l=n(71),f=n(253),d=n(254);t.VisualQualityInfo={custom:{},auto:{},highest:{},higher:{},high:{},medium:{},low:{},lower:{},lowest:{}},t.VisualQualityNames=Object.keys(t.VisualQualityInfo),t.VisualQualityOptions=t.VisualQualityNames.map(function(e){return[e,e]}),function(e){e.Params={alpha:a.ParamDefinition.Numeric(1,{min:0,max:1,step:.01},{label:"Opacity"}),useFog:a.ParamDefinition.Boolean(!0),highlightColor:a.ParamDefinition.Color(o.Color.fromNormalizedRgb(1,.4,.6)),selectColor:a.ParamDefinition.Color(o.Color.fromNormalizedRgb(.2,1,.1)),quality:a.ParamDefinition.Select("auto",t.VisualQualityOptions)},e.createSimple=function(e,t,n){return void 0===e&&(e=c.ColorNames.grey),void 0===t&&(t=1),n||(n=s.createIdentityTransform()),{transform:n,locationIterator:i.LocationIterator(1,n.instanceCount.ref.value,function(){return l.NullLocation},!1,function(){return!1}),theme:{color:f.UniformColorTheme({},{value:e}),size:d.UniformSizeTheme({},{value:t})}}},e.createValues=function(e,t){return{uAlpha:r.ValueCell.create(e.alpha),uHighlightColor:r.ValueCell.create(o.Color.toArrayNormalized(e.highlightColor,u.Vec3.zero(),0)),uSelectColor:r.ValueCell.create(o.Color.toArrayNormalized(e.selectColor,u.Vec3.zero(),0)),uGroupCount:r.ValueCell.create(t.groupCount),drawCount:r.ValueCell.create(t.drawCount),dUseFog:r.ValueCell.create(e.useFog)}},e.updateValues=function(e,t){o.Color.fromNormalizedArray(e.uHighlightColor.ref.value,0)!==t.highlightColor&&r.ValueCell.update(e.uHighlightColor,o.Color.toArrayNormalized(t.highlightColor,e.uHighlightColor.ref.value,0)),o.Color.fromNormalizedArray(e.uSelectColor.ref.value,0)!==t.selectColor&&r.ValueCell.update(e.uSelectColor,o.Color.toArrayNormalized(t.selectColor,e.uSelectColor.ref.value,0)),r.ValueCell.updateIfChanged(e.uAlpha,t.alpha),r.ValueCell.updateIfChanged(e.dUseFog,t.useFog)},e.createRenderableState=function(e){return void 0===e&&(e={}),{visible:!0,pickable:!0,opaque:void 0===e.alpha||1===e.alpha}},e.updateRenderableState=function(e,t){e.opaque=1===t.alpha}}(t.BaseGeometry||(t.BaseGeometry={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(9),i=n(2),a=n(82),o=n(5),u=n(16);t.getResidueLoci=function(e,t,n){var i=t.elements,a=t.model;if(-1!==o.OrderedSet.indexOf(i,n)){for(var s=a.atomicHierarchy.residueAtomSegments,c=s.index,l=s.offsets,f=c[n],d=[],p=l[f],h=l[f+1];p<h;++p){var m=o.OrderedSet.indexOf(i,p);-1!==m&&d.push(m)}var y=o.OrderedSet.ofSortedArray(o.SortedArray.ofSortedArray(d));return r.StructureElement.Loci(e,[{unit:t,indices:y}])}return u.EmptyLoci},t.createUnitsTransform=function(e,t){for(var n=e.units,r=n.length,o=16*r,u=t&&t.aTransform.ref.value.length>=o?t.aTransform.ref.value:new Float32Array(o),s=0;s<r;s++)i.Mat4.toArray(n[s].conformation.operator.matrix,u,16*s);return a.createTransform(u,r,t)},t.UnitKindInfo={atomic:{},spheres:{},gaussians:{}},t.UnitKindNames=Object.keys(t.UnitKindInfo),t.UnitKindOptions=t.UnitKindNames.map(function(e){return[e,e]}),t.includesUnitKind=function(e,t){for(var n=0,i=e.length;n<i;++n){if(r.Unit.isAtomic(t)&&"atomic"===e[n])return!0;if(r.Unit.isSpheres(t)&&"spheres"===e[n])return!0;if(r.Unit.isGaussians(t)&&"gaussians"===e[n])return!0}return!1}},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var a=n(24);t.PluginReactContext=a.createContext(void 0);var o=function(e){function n(t,n){var r=e.call(this,t,n)||this;return r.subs=void 0,r.plugin=n,r.init&&r.init(),r}return i(n,e),n.prototype.subscribe=function(e,t){void 0===this.subs&&(this.subs=[]),this.subs.push(e.subscribe(t))},n.prototype.componentWillUnmount=function(){if(this.subs)for(var e=0,t=this.subs;e<t.length;e++){t[e].unsubscribe()}},n.contextType=t.PluginReactContext,n}(a.Component);t.PluginUIComponent=o;var u=function(e){function n(t,n){var r=e.call(this,t,n)||this;return r.subs=void 0,r.plugin=n,r.init&&r.init(),r}return i(n,e),n.prototype.subscribe=function(e,t){void 0===this.subs&&(this.subs=[]),this.subs.push(e.subscribe(t))},n.prototype.componentWillUnmount=function(){if(this.subs)for(var e=0,t=this.subs;e<t.length;e++){t[e].unsubscribe()}},n.contextType=t.PluginReactContext,n}(a.PureComponent);t.PurePluginUIComponent=u},function(e,t,n){"use strict";function r(){return Error.call(this),this.message="no elements in sequence",this.name="EmptyError",this}n.d(t,"a",function(){return i}),r.prototype=Object.create(Error.prototype);var i=r},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var r=n(0),i=n(129),a=function(e){function t(n,r){void 0===r&&(r=i.a.now);var a=e.call(this,n,function(){return t.delegate&&t.delegate!==a?t.delegate.now():r()})||this;return a.actions=[],a.active=!1,a.scheduled=void 0,a}return r.a(t,e),t.prototype.schedule=function(n,r,i){return void 0===r&&(r=0),t.delegate&&t.delegate!==this?t.delegate.schedule(n,r,i):e.prototype.schedule.call(this,n,r,i)},t.prototype.flush=function(e){var t=this.actions;if(this.active)t.push(e);else{var n;this.active=!0;do{if(n=e.execute(e.state,e.delay))break}while(e=t.shift());if(this.active=!1,n){for(;e=t.shift();)e.unsubscribe();throw n}}},t}(i.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return o});var r=n(0),i=n(12),a=n(10),o=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.value=null,t.hasNext=!1,t.hasCompleted=!1,t}return r.a(t,e),t.prototype._subscribe=function(t){return this.hasError?(t.error(this.thrownError),a.a.EMPTY):this.hasCompleted&&this.hasNext?(t.next(this.value),t.complete(),a.a.EMPTY):e.prototype._subscribe.call(this,t)},t.prototype.next=function(e){this.hasCompleted||(this.value=e,this.hasNext=!0)},t.prototype.error=function(t){this.hasCompleted||e.prototype.error.call(this,t)},t.prototype.complete=function(){this.hasCompleted=!0,this.hasNext&&e.prototype.next.call(this,this.value),e.prototype.complete.call(this)},t}(i.a)},function(e,t,n){"use strict";var r=n(0),i=function(e){function t(t,n){return e.call(this)||this}return r.a(t,e),t.prototype.schedule=function(e,t){return void 0===t&&(t=0),this},t}(n(10).a);n.d(t,"a",function(){return a});var a=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r.pending=!1,r}return r.a(t,e),t.prototype.schedule=function(e,t){if(void 0===t&&(t=0),this.closed)return this;this.state=e;var n=this.id,r=this.scheduler;return null!=n&&(this.id=this.recycleAsyncId(r,n,t)),this.pending=!0,this.delay=t,this.id=this.id||this.requestAsyncId(r,this.id,t),this},t.prototype.requestAsyncId=function(e,t,n){return void 0===n&&(n=0),setInterval(e.flush.bind(e,this),n)},t.prototype.recycleAsyncId=function(e,t,n){if(void 0===n&&(n=0),null!==n&&this.delay===n&&!1===this.pending)return t;clearInterval(t)},t.prototype.execute=function(e,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var n=this._execute(e,t);if(n)return n;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},t.prototype._execute=function(e,t){var n=!1,r=void 0;try{this.work(e)}catch(e){n=!0,r=!!e&&e||new Error(e)}if(n)return this.unsubscribe(),r},t.prototype._unsubscribe=function(){var e=this.id,t=this.scheduler,n=t.actions,r=n.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,-1!==r&&n.splice(r,1),null!=e&&(this.id=this.recycleAsyncId(t,e,null)),this.delay=null},t}(i)},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var r=n(15);function i(e){return!Object(r.a)(e)&&e-parseFloat(e)+1>=0}},function(e,t,n){"use strict";function r(e){setTimeout(function(){throw e})}n.d(t,"a",function(){return r})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(34).idFactory();function i(e,t,n){return{id:r(),vert:e,frag:t,extensions:n}}t.ShaderCode=i,t.PointsShaderCode=i(n(314),n(315),{standardDerivatives:!1,fragDepth:!1}),t.SpheresShaderCode=i(n(316),n(317),{standardDerivatives:!1,fragDepth:!0}),t.TextShaderCode=i(n(318),n(319),{standardDerivatives:!0,fragDepth:!1}),t.LinesShaderCode=i(n(320),n(321),{standardDerivatives:!1,fragDepth:!1}),t.MeshShaderCode=i(n(322),n(323),{standardDerivatives:!0,fragDepth:!1}),t.GaussianDensityShaderCode=i(n(324),n(325),{standardDerivatives:!1,fragDepth:!1}),t.DirectVolumeShaderCode=i(n(326),n(327),{standardDerivatives:!1,fragDepth:!0});var a="#version 300 es\n#define attribute in\n#define varying out\n#define texture2D texture\n",o="#version 300 es\n#define varying in\nlayout(location = 0) out highp vec4 out_FragColor;\n#define gl_FragColor out_FragColor\n#define gl_FragDepthEXT gl_FragDepth\n#define texture2D texture\n\n#define enabledStandardDerivatives\n#define enabledFragDepth\n";t.addShaderDefines=function(e,t,n){var i=e.isWebGL2,u=function(e){if(void 0===e)return"";var t=[];for(var n in e){var r=e[n].ref.value;if(void 0!==r)if("string"==typeof r)t.push("#define "+n+"_"+r);else if("number"==typeof r)t.push("#define "+n+" "+r);else{if("boolean"!=typeof r)throw new Error("unknown define type");r&&t.push("#define "+n)}}return t.join("\n")+"\n"}(t),s=i?a:"",c=i?o:function(e,t){var n=[];return t.standardDerivatives&&(n.push("#extension GL_OES_standard_derivatives : enable"),n.push("#define enabledStandardDerivatives")),t.fragDepth&&e.extensions.fragDepth&&(n.push("#extension GL_EXT_frag_depth : enable"),n.push("#define enabledFragDepth")),n.join("\n")+"\n"}(e,n.extensions);return{id:r(),vert:""+s+u+n.vert,frag:""+c+u+n.frag,extensions:n.extensions}}},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function i(e,t,n){return{type:"attribute",kind:e,itemSize:t,divisor:n}}function a(e){return{type:"uniform",kind:e}}function o(e,t,n,r){return{type:"texture",kind:e,format:t,dataType:n,filter:r}}function u(e,t){return{type:"define",kind:e,options:t}}function s(e){return{type:"value",kind:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.splitValues=function(e,t){var n={},r={},i={},a={};return Object.keys(e).forEach(function(o){"attribute"===e[o].type&&(n[o]=t[o]),"define"===e[o].type&&(r[o]=t[o]),"texture"===e[o].type&&(i[o]=t[o]),"uniform"===e[o].type&&(a[o]=t[o])}),{attributeValues:n,defineValues:r,textureValues:i,uniformValues:a}},t.splitKeys=function(e){var t=[],n=[],r=[],i=[];return Object.keys(e).forEach(function(a){"attribute"===e[a].type&&t.push(a),"define"===e[a].type&&n.push(a),"texture"===e[a].type&&r.push(a),"uniform"===e[a].type&&i.push(a)}),{attributeKeys:t,defineKeys:n,textureKeys:r,uniformKeys:i}},t.getValueVersions=function(e){var t={};return Object.keys(e).forEach(function(n){t[n]=e[n].ref.version}),t},t.AttributeSpec=i,t.UniformSpec=a,t.TextureSpec=o,t.ElementsSpec=function(e){return{type:"elements",kind:e}},t.DefineSpec=u,t.ValueSpec=s,t.GlobalUniformSchema={uModel:a("m4"),uView:a("m4"),uInvView:a("m4"),uModelView:a("m4"),uInvModelView:a("m4"),uProjection:a("m4"),uInvProjection:a("m4"),uModelViewProjection:a("m4"),uInvModelViewProjection:a("m4"),uLightColor:a("v3"),uLightAmbient:a("v3"),uPixelRatio:a("f"),uViewportHeight:a("f"),uViewport:a("v4"),uCameraPosition:a("v3"),uFogNear:a("f"),uFogFar:a("f"),uFogColor:a("v3"),uPickingAlphaThreshold:a("f")},t.InternalSchema={uObjectId:a("i"),uPickable:a("i")},t.ColorSchema={uColor:a("v3"),uColorTexDim:a("v2"),tColor:o("image-uint8","rgb","ubyte","nearest"),dColorType:u("string",["uniform","attribute","instance","group","group_instance"])},t.SizeSchema={uSize:a("f"),uSizeTexDim:a("v2"),tSize:o("image-uint8","alpha","ubyte","nearest"),dSizeType:u("string",["uniform","attribute","instance","group","group_instance"]),uSizeFactor:a("f")},t.BaseSchema=r({},t.ColorSchema,{aInstance:i("float32",1,1),aGroup:i("float32",1,0),aTransform:i("float32",16,1),uAlpha:a("f"),uInstanceCount:a("i"),uGroupCount:a("i"),uMarkerTexDim:a("v2"),uHighlightColor:a("v3"),uSelectColor:a("v3"),tMarker:o("image-uint8","alpha","ubyte","nearest"),drawCount:s("number"),instanceCount:s("number"),matrix:s("m4"),transform:s("float32"),extraTransform:s("float32"),boundingSphere:s("sphere"),invariantBoundingSphere:s("sphere"),dUseFog:u("boolean")})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(29),i=n(203),a=n(204),o=n(122),u=n(96),s=n(206),c=n(142);!function(e){function t(e){switch(e.kind){case"mesh":return 3*e.triangleCount;case"points":return e.pointCount;case"spheres":return 2*e.sphereCount*3;case"text":return 2*e.charCount*3;case"lines":return 2*e.lineCount*3;case"direct-volume":return 36}}e.getDrawCount=t,e.getGroupCount=function(e){switch(e.kind){case"mesh":case"points":case"spheres":case"text":case"lines":return 0===t(e)?0:c.arrayMax(e.groupBuffer.ref.value)+1;case"direct-volume":return 1}},e.getUtils=function(e){switch(e.kind){case"mesh":return r.Mesh.Utils;case"points":return i.Points.Utils;case"spheres":return s.Spheres.Utils;case"text":return a.Text.Utils;case"lines":return o.Lines.Utils;case"direct-volume":return u.DirectVolume.Utils}throw new Error("unknown geometry kind")},e.getGranularity=function(e,t){return"instance"===t&&e.isComplex?"group":t}}(t.Geometry||(t.Geometry={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NullLocation={kind:"null-location"},t.isNullLocation=function(e){return!!e&&"null-location"===e.kind}},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(7),a=n(2),o=n(52),u=n(71),s=n(70),c=n(198);t.createSizes=function(e,t,n){switch(s.Geometry.getGranularity(e,t.granularity)){case"uniform":return d(e,t.size,n);case"group":return m(e,t.size,n);case"groupInstance":return y(e,t.size,n);case"instance":return h(e,t.size,n)}},t.getMaxSize=function(e){switch(e.dSizeType.ref.value){case"uniform":return e.uSize.ref.value;case"instance":case"group":case"groupInstance":for(var t=0,n=e.tSize.ref.value.array,r=0,i=n.length;r<i;++r){var a=c.decodeFloatLog(n[r]/255);t<a&&(t=a)}return t}};var l={array:new Uint8Array(1),width:1,height:1};function f(e,t){return t?(i.ValueCell.update(t.uSize,e),"uniform"!==t.dSizeType.ref.value&&i.ValueCell.update(t.dSizeType,"uniform"),t):r({uSize:i.ValueCell.create(e)},{tSize:i.ValueCell.create(l),uSizeTexDim:i.ValueCell.create(a.Vec2.create(1,1))},{dSizeType:i.ValueCell.create("uniform")})}function d(e,t,n){return f(t(u.NullLocation),n)}function p(e,t,n){return n?(i.ValueCell.update(n.tSize,e),i.ValueCell.update(n.uSizeTexDim,a.Vec2.create(e.width,e.height)),n.dSizeType.ref.value!==t&&i.ValueCell.update(n.dSizeType,t),n):{uSize:i.ValueCell.create(0),tSize:i.ValueCell.create(e),uSizeTexDim:i.ValueCell.create(a.Vec2.create(e.width,e.height)),dSizeType:i.ValueCell.create(t)}}function h(e,t,n){var r=e.instanceCount,i=n&&n.tSize.ref.value.array.length>=r?n.tSize.ref.value:o.createTextureImage(r,1);for(e.reset();e.hasNext&&!e.isNextNewInstance;){var a=e.move();i.array[a.instanceIndex]=255*c.encodeFloatLog(t(a.location)),e.skipInstance()}return p(i,"instance",n)}function m(e,t,n){var r=e.groupCount,i=n&&n.tSize.ref.value.array.length>=r?n.tSize.ref.value:o.createTextureImage(r,1);for(e.reset();e.hasNext&&!e.isNextNewInstance;){var a=e.move();i.array[a.groupIndex]=255*c.encodeFloatLog(t(a.location))}return p(i,"group",n)}function y(e,t,n){var r=e.groupCount,i=e.instanceCount*r,a=n&&n.tSize.ref.value.array.length>=i?n.tSize.ref.value:o.createTextureImage(i,1);for(e.reset();e.hasNext&&!e.isNextNewInstance;){var u=e.move();a.array[u.index]=255*c.encodeFloatLog(t(u.location))}return p(a,"groupInstance",n)}t.createValueSize=f,t.createUniformSize=d,t.createTextureSize=p,t.createInstanceSize=h,t.createGroupSize=m,t.createGroupInstanceSize=y},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(9),a=n(125),o=n(79),u=n(60),s=n(38),c=n(7),l=n(16),f=n(5),d=n(3),p=n(72),h=n(70),m=n(58),y=n(51),v=n(29),b=n(123),g=n(53),_=n(124),S=n(144),C=n(96),x=n(82);r({},s.StructureParams,{unitKinds:d.ParamDefinition.MultiSelect(["atomic","spheres"],u.UnitKindOptions)});function w(e){var t,n,r,u,s,d,v,S=e.defaultProps,C=e.createGeometry,w=e.createLocationIterator,P=e.getLoci,T=e.mark,A=e.setUpdateState,E=e.geometryUtils,k=E.updateValues,I=E.updateBoundingSphere,M=E.updateRenderableState,V=b.VisualUpdateState.create(),O=Object.assign({},S),D=g.createEmptyTheme();function R(e){if(V.createNew){if(v=w(u),!e)throw new Error("expected geometry to be given");t=function(e,t,n,r,i){var a=h.Geometry.getUtils(t),u=a.createValues,s=a.createRenderableState,c=u(t,x.createIdentityTransform(),n,r,i),l=s(i);return o.createRenderObject(t.kind,c,l)}(0,e,v,r,n)}else{if(!t)throw new Error("expected renderObject to be available");if(v.reset(),V.createGeometry){if(!e)throw new Error("expected geometry to be given");c.ValueCell.update(t.values.drawCount,h.Geometry.getDrawCount(e)),I(t.values,e)}V.updateSize&&"uSize"in t.values&&p.createSizes(v,r.size,t.values),V.updateColor&&m.createColors(v,r.color,t.values),k(t.values,n),M(t.state,n)}O=n,D=r,s=u,e&&(d=e)}return{get groupCount(){return v?v.count:0},get renderObject(){return v&&v.count?t:void 0},createOrUpdate:function(e,a,o,l){if(void 0===o&&(o={}),function(e,a,o){if(!o&&!s)throw new Error("missing structure");n=Object.assign({},O,a),r=e,u=o,b.VisualUpdateState.reset(V),t&&s&&i.Structure.areEquivalent(u,s)||(V.createNew=!0),V.createNew?V.createGeometry=!0:(A(V,n,O,r,D),i.Structure.conformationHash(u)!==i.Structure.conformationHash(s)&&(V.createGeometry=!0),_.ColorTheme.areEqual(e.color,D.color)||(V.updateColor=!0),c.deepEqual(n.unitKinds,O.unitKinds)||(V.createGeometry=!0),V.createGeometry&&(V.updateColor=!0))}(a,o,l||s),V.createGeometry){var f=C(e,u,r,n,d);return f instanceof Promise?f.then(R):R(f)}R()},getLoci:function(e){return t?P(e,s,t.id):l.EmptyLoci},mark:function(e,n){if(!t)return!1;var r=t.values.tMarker,a=v.groupCount,o=v.instanceCount;function u(e){var t=f.Interval.start(e),i=f.Interval.end(e);return y.applyMarkerAction(r.ref.value.array,t,i,n)}var d=!1;return(d=l.isEveryLoci(e)||i.Structure.isLoci(e)&&e.structure===s?u(f.Interval.ofBounds(0,a*o)):T(e,s,u))&&c.ValueCell.update(r,r.ref.value),d},setVisibility:function(e){a.Visual.setVisibility(t,e)},setPickable:function(e){a.Visual.setPickable(t,e)},setTransform:function(e,n){a.Visual.setTransform(t,e,n)},destroy:function(){t=void 0}}}t.ComplexVisual=w,t.ComplexMeshParams=r({},s.StructureMeshParams,{unitKinds:d.ParamDefinition.MultiSelect(["atomic","spheres"],u.UnitKindOptions)}),t.ComplexMeshVisual=function(e){return w(r({},e,{setUpdateState:function(t,n,r,i,a){e.setUpdateState(t,n,r,i,a),S.SizeTheme.areEqual(i.size,a.size)||(t.createGeometry=!0)},geometryUtils:v.Mesh.Utils}))},t.ComplexDirectVolumeParams=r({},s.StructureDirectVolumeParams,{unitKinds:d.ParamDefinition.MultiSelect(["atomic","spheres","gaussians"],u.UnitKindOptions)}),t.ComplexDirectVolumeVisual=function(e){return w(r({},e,{setUpdateState:function(t,n,r,i,a){e.setUpdateState(t,n,r,i,a),S.SizeTheme.areEqual(i.size,a.size)||(t.createGeometry=!0)},geometryUtils:C.DirectVolume.Utils}))}},function(e,t,n){e.exports=function(){"use strict";var e=Array.prototype.slice;function t(e,t){t&&(e.prototype=Object.create(t.prototype)),e.prototype.constructor=e}function n(e){return o(e)?e:W(e)}function r(e){return u(e)?e:Y(e)}function i(e){return s(e)?e:K(e)}function a(e){return o(e)&&!c(e)?e:X(e)}function o(e){return!(!e||!e[f])}function u(e){return!(!e||!e[d])}function s(e){return!(!e||!e[p])}function c(e){return u(e)||s(e)}function l(e){return!(!e||!e[h])}t(r,n),t(i,n),t(a,n),n.isIterable=o,n.isKeyed=u,n.isIndexed=s,n.isAssociative=c,n.isOrdered=l,n.Keyed=r,n.Indexed=i,n.Set=a;var f="@@__IMMUTABLE_ITERABLE__@@",d="@@__IMMUTABLE_KEYED__@@",p="@@__IMMUTABLE_INDEXED__@@",h="@@__IMMUTABLE_ORDERED__@@",m=5,y=1<<m,v=y-1,b={},g={value:!1},_={value:!1};function S(e){return e.value=!1,e}function C(e){e&&(e.value=!0)}function x(){}function w(e,t){t=t||0;for(var n=Math.max(0,e.length-t),r=new Array(n),i=0;i<n;i++)r[i]=e[i+t];return r}function P(e){return void 0===e.size&&(e.size=e.__iterate(A)),e.size}function T(e,t){if("number"!=typeof t){var n=t>>>0;if(""+n!==t||4294967295===n)return NaN;t=n}return t<0?P(e)+t:t}function A(){return!0}function E(e,t,n){return(0===e||void 0!==n&&e<=-n)&&(void 0===t||void 0!==n&&t>=n)}function k(e,t){return M(e,t,0)}function I(e,t){return M(e,t,t)}function M(e,t,n){return void 0===e?n:e<0?Math.max(0,t+e):void 0===t?e:Math.min(t,e)}var V=0,O=1,D=2,R="function"==typeof Symbol&&Symbol.iterator,j="@@iterator",N=R||j;function B(e){this.next=e}function F(e,t,n,r){var i=0===e?t:1===e?n:[t,n];return r?r.value=i:r={value:i,done:!1},r}function L(){return{value:void 0,done:!0}}function z(e){return!!q(e)}function U(e){return e&&"function"==typeof e.next}function G(e){var t=q(e);return t&&t.call(e)}function q(e){var t=e&&(R&&e[R]||e[j]);if("function"==typeof t)return t}function H(e){return e&&"number"==typeof e.length}function W(e){return null==e?ae():o(e)?e.toSeq():function(e){var t=se(e)||"object"==typeof e&&new te(e);if(!t)throw new TypeError("Expected Array or iterable object of values, or keyed object: "+e);return t}(e)}function Y(e){return null==e?ae().toKeyedSeq():o(e)?u(e)?e.toSeq():e.fromEntrySeq():oe(e)}function K(e){return null==e?ae():o(e)?u(e)?e.entrySeq():e.toIndexedSeq():ue(e)}function X(e){return(null==e?ae():o(e)?u(e)?e.entrySeq():e:ue(e)).toSetSeq()}B.prototype.toString=function(){return"[Iterator]"},B.KEYS=V,B.VALUES=O,B.ENTRIES=D,B.prototype.inspect=B.prototype.toSource=function(){return this.toString()},B.prototype[N]=function(){return this},t(W,n),W.of=function(){return W(arguments)},W.prototype.toSeq=function(){return this},W.prototype.toString=function(){return this.__toString("Seq {","}")},W.prototype.cacheResult=function(){return!this._cache&&this.__iterateUncached&&(this._cache=this.entrySeq().toArray(),this.size=this._cache.length),this},W.prototype.__iterate=function(e,t){return ce(this,e,t,!0)},W.prototype.__iterator=function(e,t){return le(this,e,t,!0)},t(Y,W),Y.prototype.toKeyedSeq=function(){return this},t(K,W),K.of=function(){return K(arguments)},K.prototype.toIndexedSeq=function(){return this},K.prototype.toString=function(){return this.__toString("Seq [","]")},K.prototype.__iterate=function(e,t){return ce(this,e,t,!1)},K.prototype.__iterator=function(e,t){return le(this,e,t,!1)},t(X,W),X.of=function(){return X(arguments)},X.prototype.toSetSeq=function(){return this},W.isSeq=ie,W.Keyed=Y,W.Set=X,W.Indexed=K;var Q,Z,J,$="@@__IMMUTABLE_SEQ__@@";function ee(e){this._array=e,this.size=e.length}function te(e){var t=Object.keys(e);this._object=e,this._keys=t,this.size=t.length}function ne(e){this._iterable=e,this.size=e.length||e.size}function re(e){this._iterator=e,this._iteratorCache=[]}function ie(e){return!(!e||!e[$])}function ae(){return Q||(Q=new ee([]))}function oe(e){var t=Array.isArray(e)?new ee(e).fromEntrySeq():U(e)?new re(e).fromEntrySeq():z(e)?new ne(e).fromEntrySeq():"object"==typeof e?new te(e):void 0;if(!t)throw new TypeError("Expected Array or iterable object of [k, v] entries, or keyed object: "+e);return t}function ue(e){var t=se(e);if(!t)throw new TypeError("Expected Array or iterable object of values: "+e);return t}function se(e){return H(e)?new ee(e):U(e)?new re(e):z(e)?new ne(e):void 0}function ce(e,t,n,r){var i=e._cache;if(i){for(var a=i.length-1,o=0;o<=a;o++){var u=i[n?a-o:o];if(!1===t(u[1],r?u[0]:o,e))return o+1}return o}return e.__iterateUncached(t,n)}function le(e,t,n,r){var i=e._cache;if(i){var a=i.length-1,o=0;return new B(function(){var e=i[n?a-o:o];return o++>a?{value:void 0,done:!0}:F(t,r?e[0]:o-1,e[1])})}return e.__iteratorUncached(t,n)}function fe(e,t){return t?function e(t,n,r,i){return Array.isArray(n)?t.call(i,r,K(n).map(function(r,i){return e(t,r,i,n)})):pe(n)?t.call(i,r,Y(n).map(function(r,i){return e(t,r,i,n)})):n}(t,e,"",{"":e}):de(e)}function de(e){return Array.isArray(e)?K(e).map(de).toList():pe(e)?Y(e).map(de).toMap():e}function pe(e){return e&&(e.constructor===Object||void 0===e.constructor)}function he(e,t){if(e===t||e!=e&&t!=t)return!0;if(!e||!t)return!1;if("function"==typeof e.valueOf&&"function"==typeof t.valueOf){if(e=e.valueOf(),t=t.valueOf(),e===t||e!=e&&t!=t)return!0;if(!e||!t)return!1}return!("function"!=typeof e.equals||"function"!=typeof t.equals||!e.equals(t))}function me(e,t){if(e===t)return!0;if(!o(t)||void 0!==e.size&&void 0!==t.size&&e.size!==t.size||void 0!==e.__hash&&void 0!==t.__hash&&e.__hash!==t.__hash||u(e)!==u(t)||s(e)!==s(t)||l(e)!==l(t))return!1;if(0===e.size&&0===t.size)return!0;var n=!c(e);if(l(e)){var r=e.entries();return t.every(function(e,t){var i=r.next().value;return i&&he(i[1],e)&&(n||he(i[0],t))})&&r.next().done}var i=!1;if(void 0===e.size)if(void 0===t.size)"function"==typeof e.cacheResult&&e.cacheResult();else{i=!0;var a=e;e=t,t=a}var f=!0,d=t.__iterate(function(t,r){if(n?!e.has(t):i?!he(t,e.get(r,b)):!he(e.get(r,b),t))return f=!1,!1});return f&&e.size===d}function ye(e,t){if(!(this instanceof ye))return new ye(e,t);if(this._value=e,this.size=void 0===t?1/0:Math.max(0,t),0===this.size){if(Z)return Z;Z=this}}function ve(e,t){if(!e)throw new Error(t)}function be(e,t,n){if(!(this instanceof be))return new be(e,t,n);if(ve(0!==n,"Cannot step a Range by 0"),e=e||0,void 0===t&&(t=1/0),n=void 0===n?1:Math.abs(n),t<e&&(n=-n),this._start=e,this._end=t,this._step=n,this.size=Math.max(0,Math.ceil((t-e)/n-1)+1),0===this.size){if(J)return J;J=this}}function ge(){throw TypeError("Abstract")}function _e(){}function Se(){}function Ce(){}W.prototype[$]=!0,t(ee,K),ee.prototype.get=function(e,t){return this.has(e)?this._array[T(this,e)]:t},ee.prototype.__iterate=function(e,t){for(var n=this._array,r=n.length-1,i=0;i<=r;i++)if(!1===e(n[t?r-i:i],i,this))return i+1;return i},ee.prototype.__iterator=function(e,t){var n=this._array,r=n.length-1,i=0;return new B(function(){return i>r?{value:void 0,done:!0}:F(e,i,n[t?r-i++:i++])})},t(te,Y),te.prototype.get=function(e,t){return void 0===t||this.has(e)?this._object[e]:t},te.prototype.has=function(e){return this._object.hasOwnProperty(e)},te.prototype.__iterate=function(e,t){for(var n=this._object,r=this._keys,i=r.length-1,a=0;a<=i;a++){var o=r[t?i-a:a];if(!1===e(n[o],o,this))return a+1}return a},te.prototype.__iterator=function(e,t){var n=this._object,r=this._keys,i=r.length-1,a=0;return new B(function(){var o=r[t?i-a:a];return a++>i?{value:void 0,done:!0}:F(e,o,n[o])})},te.prototype[h]=!0,t(ne,K),ne.prototype.__iterateUncached=function(e,t){if(t)return this.cacheResult().__iterate(e,t);var n=this._iterable,r=G(n),i=0;if(U(r))for(var a;!(a=r.next()).done&&!1!==e(a.value,i++,this););return i},ne.prototype.__iteratorUncached=function(e,t){if(t)return this.cacheResult().__iterator(e,t);var n=this._iterable,r=G(n);if(!U(r))return new B(L);var i=0;return new B(function(){var t=r.next();return t.done?t:F(e,i++,t.value)})},t(re,K),re.prototype.__iterateUncached=function(e,t){if(t)return this.cacheResult().__iterate(e,t);for(var n,r=this._iterator,i=this._iteratorCache,a=0;a<i.length;)if(!1===e(i[a],a++,this))return a;for(;!(n=r.next()).done;){var o=n.value;if(i[a]=o,!1===e(o,a++,this))break}return a},re.prototype.__iteratorUncached=function(e,t){if(t)return this.cacheResult().__iterator(e,t);var n=this._iterator,r=this._iteratorCache,i=0;return new B(function(){if(i>=r.length){var t=n.next();if(t.done)return t;r[i]=t.value}return F(e,i,r[i++])})},t(ye,K),ye.prototype.toString=function(){return 0===this.size?"Repeat []":"Repeat [ "+this._value+" "+this.size+" times ]"},ye.prototype.get=function(e,t){return this.has(e)?this._value:t},ye.prototype.includes=function(e){return he(this._value,e)},ye.prototype.slice=function(e,t){var n=this.size;return E(e,t,n)?this:new ye(this._value,I(t,n)-k(e,n))},ye.prototype.reverse=function(){return this},ye.prototype.indexOf=function(e){return he(this._value,e)?0:-1},ye.prototype.lastIndexOf=function(e){return he(this._value,e)?this.size:-1},ye.prototype.__iterate=function(e,t){for(var n=0;n<this.size;n++)if(!1===e(this._value,n,this))return n+1;return n},ye.prototype.__iterator=function(e,t){var n=this,r=0;return new B(function(){return r<n.size?F(e,r++,n._value):{value:void 0,done:!0}})},ye.prototype.equals=function(e){return e instanceof ye?he(this._value,e._value):me(e)},t(be,K),be.prototype.toString=function(){return 0===this.size?"Range []":"Range [ "+this._start+"..."+this._end+(1!==this._step?" by "+this._step:"")+" ]"},be.prototype.get=function(e,t){return this.has(e)?this._start+T(this,e)*this._step:t},be.prototype.includes=function(e){var t=(e-this._start)/this._step;return t>=0&&t<this.size&&t===Math.floor(t)},be.prototype.slice=function(e,t){return E(e,t,this.size)?this:(e=k(e,this.size),(t=I(t,this.size))<=e?new be(0,0):new be(this.get(e,this._end),this.get(t,this._end),this._step))},be.prototype.indexOf=function(e){var t=e-this._start;if(t%this._step==0){var n=t/this._step;if(n>=0&&n<this.size)return n}return-1},be.prototype.lastIndexOf=function(e){return this.indexOf(e)},be.prototype.__iterate=function(e,t){for(var n=this.size-1,r=this._step,i=t?this._start+n*r:this._start,a=0;a<=n;a++){if(!1===e(i,a,this))return a+1;i+=t?-r:r}return a},be.prototype.__iterator=function(e,t){var n=this.size-1,r=this._step,i=t?this._start+n*r:this._start,a=0;return new B(function(){var o=i;return i+=t?-r:r,a>n?{value:void 0,done:!0}:F(e,a++,o)})},be.prototype.equals=function(e){return e instanceof be?this._start===e._start&&this._end===e._end&&this._step===e._step:me(this,e)},t(ge,n),t(_e,ge),t(Se,ge),t(Ce,ge),ge.Keyed=_e,ge.Indexed=Se,ge.Set=Ce;var xe="function"==typeof Math.imul&&-2===Math.imul(4294967295,2)?Math.imul:function(e,t){var n=65535&(e|=0),r=65535&(t|=0);return n*r+((e>>>16)*r+n*(t>>>16)<<16>>>0)|0};function we(e){return e>>>1&1073741824|3221225471&e}function Pe(e){if(!1===e||null==e)return 0;if("function"==typeof e.valueOf&&(!1===(e=e.valueOf())||null==e))return 0;if(!0===e)return 1;var t,n,r=typeof e;if("number"===r){if(e!=e||e===1/0)return 0;var i=0|e;for(i!==e&&(i^=4294967295*e);e>4294967295;)i^=e/=4294967295;return we(i)}if("string"===r)return e.length>Oe?(void 0===(n=je[t=e])&&(n=Te(t),Re===De&&(Re=0,je={}),Re++,je[t]=n),n):Te(e);if("function"==typeof e.hashCode)return e.hashCode();if("object"===r)return function(e){var t;if(Ie&&void 0!==(t=Ae.get(e)))return t;if(void 0!==(t=e[Ve]))return t;if(!ke){if(void 0!==(t=e.propertyIsEnumerable&&e.propertyIsEnumerable[Ve]))return t;if(void 0!==(t=function(e){if(e&&e.nodeType>0)switch(e.nodeType){case 1:return e.uniqueID;case 9:return e.documentElement&&e.documentElement.uniqueID}}(e)))return t}if(t=++Me,1073741824&Me&&(Me=0),Ie)Ae.set(e,t);else{if(void 0!==Ee&&!1===Ee(e))throw new Error("Non-extensible objects are not allowed as keys.");if(ke)Object.defineProperty(e,Ve,{enumerable:!1,configurable:!1,writable:!1,value:t});else if(void 0!==e.propertyIsEnumerable&&e.propertyIsEnumerable===e.constructor.prototype.propertyIsEnumerable)e.propertyIsEnumerable=function(){return this.constructor.prototype.propertyIsEnumerable.apply(this,arguments)},e.propertyIsEnumerable[Ve]=t;else{if(void 0===e.nodeType)throw new Error("Unable to set a non-enumerable property on object.");e[Ve]=t}}return t}(e);if("function"==typeof e.toString)return Te(e.toString());throw new Error("Value type "+r+" cannot be hashed.")}function Te(e){for(var t=0,n=0;n<e.length;n++)t=31*t+e.charCodeAt(n)|0;return we(t)}var Ae,Ee=Object.isExtensible,ke=function(){try{return Object.defineProperty({},"@",{}),!0}catch(e){return!1}}(),Ie="function"==typeof WeakMap;Ie&&(Ae=new WeakMap);var Me=0,Ve="__immutablehash__";"function"==typeof Symbol&&(Ve=Symbol(Ve));var Oe=16,De=255,Re=0,je={};function Ne(e){ve(e!==1/0,"Cannot perform this action with an infinite size.")}function Be(e){return null==e?Je():Fe(e)&&!l(e)?e:Je().withMutations(function(t){var n=r(e);Ne(n.size),n.forEach(function(e,n){return t.set(n,e)})})}function Fe(e){return!(!e||!e[ze])}t(Be,_e),Be.of=function(){var t=e.call(arguments,0);return Je().withMutations(function(e){for(var n=0;n<t.length;n+=2){if(n+1>=t.length)throw new Error("Missing value for key: "+t[n]);e.set(t[n],t[n+1])}})},Be.prototype.toString=function(){return this.__toString("Map {","}")},Be.prototype.get=function(e,t){return this._root?this._root.get(0,void 0,e,t):t},Be.prototype.set=function(e,t){return $e(this,e,t)},Be.prototype.setIn=function(e,t){return this.updateIn(e,b,function(){return t})},Be.prototype.remove=function(e){return $e(this,e,b)},Be.prototype.deleteIn=function(e){return this.updateIn(e,function(){return b})},Be.prototype.update=function(e,t,n){return 1===arguments.length?e(this):this.updateIn([e],t,n)},Be.prototype.updateIn=function(e,t,n){n||(n=t,t=void 0);var r=function e(t,n,r,i){var a=t===b,o=n.next();if(o.done){var u=a?r:t,s=i(u);return s===u?t:s}ve(a||t&&t.set,"invalid keyPath");var c=o.value,l=a?b:t.get(c,b),f=e(l,n,r,i);return f===l?t:f===b?t.remove(c):(a?Je():t).set(c,f)}(this,nn(e),t,n);return r===b?void 0:r},Be.prototype.clear=function(){return 0===this.size?this:this.__ownerID?(this.size=0,this._root=null,this.__hash=void 0,this.__altered=!0,this):Je()},Be.prototype.merge=function(){return rt(this,void 0,arguments)},Be.prototype.mergeWith=function(t){var n=e.call(arguments,1);return rt(this,t,n)},Be.prototype.mergeIn=function(t){var n=e.call(arguments,1);return this.updateIn(t,Je(),function(e){return"function"==typeof e.merge?e.merge.apply(e,n):n[n.length-1]})},Be.prototype.mergeDeep=function(){return rt(this,it,arguments)},Be.prototype.mergeDeepWith=function(t){var n=e.call(arguments,1);return rt(this,at(t),n)},Be.prototype.mergeDeepIn=function(t){var n=e.call(arguments,1);return this.updateIn(t,Je(),function(e){return"function"==typeof e.mergeDeep?e.mergeDeep.apply(e,n):n[n.length-1]})},Be.prototype.sort=function(e){return kt(Ht(this,e))},Be.prototype.sortBy=function(e,t){return kt(Ht(this,t,e))},Be.prototype.withMutations=function(e){var t=this.asMutable();return e(t),t.wasAltered()?t.__ensureOwner(this.__ownerID):this},Be.prototype.asMutable=function(){return this.__ownerID?this:this.__ensureOwner(new x)},Be.prototype.asImmutable=function(){return this.__ensureOwner()},Be.prototype.wasAltered=function(){return this.__altered},Be.prototype.__iterator=function(e,t){return new Ke(this,e,t)},Be.prototype.__iterate=function(e,t){var n=this,r=0;return this._root&&this._root.iterate(function(t){return r++,e(t[1],t[0],n)},t),r},Be.prototype.__ensureOwner=function(e){return e===this.__ownerID?this:e?Ze(this.size,this._root,e,this.__hash):(this.__ownerID=e,this.__altered=!1,this)},Be.isMap=Fe;var Le,ze="@@__IMMUTABLE_MAP__@@",Ue=Be.prototype;function Ge(e,t){this.ownerID=e,this.entries=t}function qe(e,t,n){this.ownerID=e,this.bitmap=t,this.nodes=n}function He(e,t,n){this.ownerID=e,this.count=t,this.nodes=n}function We(e,t,n){this.ownerID=e,this.keyHash=t,this.entries=n}function Ye(e,t,n){this.ownerID=e,this.keyHash=t,this.entry=n}function Ke(e,t,n){this._type=t,this._reverse=n,this._stack=e._root&&Qe(e._root)}function Xe(e,t){return F(e,t[0],t[1])}function Qe(e,t){return{node:e,index:0,__prev:t}}function Ze(e,t,n,r){var i=Object.create(Ue);return i.size=e,i._root=t,i.__ownerID=n,i.__hash=r,i.__altered=!1,i}function Je(){return Le||(Le=Ze(0))}function $e(e,t,n){var r,i;if(e._root){var a=S(g),o=S(_);if(r=et(e._root,e.__ownerID,0,void 0,t,n,a,o),!o.value)return e;i=e.size+(a.value?n===b?-1:1:0)}else{if(n===b)return e;i=1,r=new Ge(e.__ownerID,[[t,n]])}return e.__ownerID?(e.size=i,e._root=r,e.__hash=void 0,e.__altered=!0,e):r?Ze(i,r):Je()}function et(e,t,n,r,i,a,o,u){return e?e.update(t,n,r,i,a,o,u):a===b?e:(C(u),C(o),new Ye(t,r,[i,a]))}function tt(e){return e.constructor===Ye||e.constructor===We}function nt(e,t,n,r,i){if(e.keyHash===r)return new We(t,r,[e.entry,i]);var a,o=(0===n?e.keyHash:e.keyHash>>>n)&v,u=(0===n?r:r>>>n)&v,s=o===u?[nt(e,t,n+m,r,i)]:(a=new Ye(t,r,i),o<u?[e,a]:[a,e]);return new qe(t,1<<o|1<<u,s)}function rt(e,t,n){for(var i=[],a=0;a<n.length;a++){var u=n[a],s=r(u);o(u)||(s=s.map(function(e){return fe(e)})),i.push(s)}return ot(e,t,i)}function it(e,t,n){return e&&e.mergeDeep&&o(t)?e.mergeDeep(t):he(e,t)?e:t}function at(e){return function(t,n,r){if(t&&t.mergeDeepWith&&o(n))return t.mergeDeepWith(e,n);var i=e(t,n,r);return he(t,i)?t:i}}function ot(e,t,n){return 0===(n=n.filter(function(e){return 0!==e.size})).length?e:0!==e.size||e.__ownerID||1!==n.length?e.withMutations(function(e){for(var r=t?function(n,r){e.update(r,b,function(e){return e===b?n:t(e,n,r)})}:function(t,n){e.set(n,t)},i=0;i<n.length;i++)n[i].forEach(r)}):e.constructor(n[0])}function ut(e){return e=(e=(858993459&(e-=e>>1&1431655765))+(e>>2&858993459))+(e>>4)&252645135,e+=e>>8,127&(e+=e>>16)}function st(e,t,n,r){var i=r?e:w(e);return i[t]=n,i}Ue[ze]=!0,Ue.delete=Ue.remove,Ue.removeIn=Ue.deleteIn,Ge.prototype.get=function(e,t,n,r){for(var i=this.entries,a=0,o=i.length;a<o;a++)if(he(n,i[a][0]))return i[a][1];return r},Ge.prototype.update=function(e,t,n,r,i,a,o){for(var u=i===b,s=this.entries,c=0,l=s.length;c<l&&!he(r,s[c][0]);c++);var f=c<l;if(f?s[c][1]===i:u)return this;if(C(o),(u||!f)&&C(a),!u||1!==s.length){if(!f&&!u&&s.length>=ct)return function(e,t,n,r){e||(e=new x);for(var i=new Ye(e,Pe(n),[n,r]),a=0;a<t.length;a++){var o=t[a];i=i.update(e,0,void 0,o[0],o[1])}return i}(e,s,r,i);var d=e&&e===this.ownerID,p=d?s:w(s);return f?u?c===l-1?p.pop():p[c]=p.pop():p[c]=[r,i]:p.push([r,i]),d?(this.entries=p,this):new Ge(e,p)}},qe.prototype.get=function(e,t,n,r){void 0===t&&(t=Pe(n));var i=1<<((0===e?t:t>>>e)&v),a=this.bitmap;return 0==(a&i)?r:this.nodes[ut(a&i-1)].get(e+m,t,n,r)},qe.prototype.update=function(e,t,n,r,i,a,o){void 0===n&&(n=Pe(r));var u=(0===t?n:n>>>t)&v,s=1<<u,c=this.bitmap,l=0!=(c&s);if(!l&&i===b)return this;var f=ut(c&s-1),d=this.nodes,p=l?d[f]:void 0,h=et(p,e,t+m,n,r,i,a,o);if(h===p)return this;if(!l&&h&&d.length>=lt)return function(e,t,n,r,i){for(var a=0,o=new Array(y),u=0;0!==n;u++,n>>>=1)o[u]=1&n?t[a++]:void 0;return o[r]=i,new He(e,a+1,o)}(e,d,c,u,h);if(l&&!h&&2===d.length&&tt(d[1^f]))return d[1^f];if(l&&h&&1===d.length&&tt(h))return h;var g=e&&e===this.ownerID,_=l?h?c:c^s:c|s,S=l?h?st(d,f,h,g):function(e,t,n){var r=e.length-1;if(n&&t===r)return e.pop(),e;for(var i=new Array(r),a=0,o=0;o<r;o++)o===t&&(a=1),i[o]=e[o+a];return i}(d,f,g):function(e,t,n,r){var i=e.length+1;if(r&&t+1===i)return e[t]=n,e;for(var a=new Array(i),o=0,u=0;u<i;u++)u===t?(a[u]=n,o=-1):a[u]=e[u+o];return a}(d,f,h,g);return g?(this.bitmap=_,this.nodes=S,this):new qe(e,_,S)},He.prototype.get=function(e,t,n,r){void 0===t&&(t=Pe(n));var i=(0===e?t:t>>>e)&v,a=this.nodes[i];return a?a.get(e+m,t,n,r):r},He.prototype.update=function(e,t,n,r,i,a,o){void 0===n&&(n=Pe(r));var u=(0===t?n:n>>>t)&v,s=i===b,c=this.nodes,l=c[u];if(s&&!l)return this;var f=et(l,e,t+m,n,r,i,a,o);if(f===l)return this;var d=this.count;if(l){if(!f&&--d<ft)return function(e,t,n,r){for(var i=0,a=0,o=new Array(n),u=0,s=1,c=t.length;u<c;u++,s<<=1){var l=t[u];void 0!==l&&u!==r&&(i|=s,o[a++]=l)}return new qe(e,i,o)}(e,c,d,u)}else d++;var p=e&&e===this.ownerID,h=st(c,u,f,p);return p?(this.count=d,this.nodes=h,this):new He(e,d,h)},We.prototype.get=function(e,t,n,r){for(var i=this.entries,a=0,o=i.length;a<o;a++)if(he(n,i[a][0]))return i[a][1];return r},We.prototype.update=function(e,t,n,r,i,a,o){void 0===n&&(n=Pe(r));var u=i===b;if(n!==this.keyHash)return u?this:(C(o),C(a),nt(this,e,t,n,[r,i]));for(var s=this.entries,c=0,l=s.length;c<l&&!he(r,s[c][0]);c++);var f=c<l;if(f?s[c][1]===i:u)return this;if(C(o),(u||!f)&&C(a),u&&2===l)return new Ye(e,this.keyHash,s[1^c]);var d=e&&e===this.ownerID,p=d?s:w(s);return f?u?c===l-1?p.pop():p[c]=p.pop():p[c]=[r,i]:p.push([r,i]),d?(this.entries=p,this):new We(e,this.keyHash,p)},Ye.prototype.get=function(e,t,n,r){return he(n,this.entry[0])?this.entry[1]:r},Ye.prototype.update=function(e,t,n,r,i,a,o){var u=i===b,s=he(r,this.entry[0]);return(s?i===this.entry[1]:u)?this:(C(o),u?void C(a):s?e&&e===this.ownerID?(this.entry[1]=i,this):new Ye(e,this.keyHash,[r,i]):(C(a),nt(this,e,t,Pe(r),[r,i])))},Ge.prototype.iterate=We.prototype.iterate=function(e,t){for(var n=this.entries,r=0,i=n.length-1;r<=i;r++)if(!1===e(n[t?i-r:r]))return!1},qe.prototype.iterate=He.prototype.iterate=function(e,t){for(var n=this.nodes,r=0,i=n.length-1;r<=i;r++){var a=n[t?i-r:r];if(a&&!1===a.iterate(e,t))return!1}},Ye.prototype.iterate=function(e,t){return e(this.entry)},t(Ke,B),Ke.prototype.next=function(){for(var e=this._type,t=this._stack;t;){var n,r=t.node,i=t.index++;if(r.entry){if(0===i)return Xe(e,r.entry)}else if(r.entries){if(n=r.entries.length-1,i<=n)return Xe(e,r.entries[this._reverse?n-i:i])}else if(n=r.nodes.length-1,i<=n){var a=r.nodes[this._reverse?n-i:i];if(a){if(a.entry)return Xe(e,a.entry);t=this._stack=Qe(a,t)}continue}t=this._stack=this._stack.__prev}return{value:void 0,done:!0}};var ct=y/4,lt=y/2,ft=y/4;function dt(e){var t=Ct();if(null==e)return t;if(pt(e))return e;var n=i(e),r=n.size;return 0===r?t:(Ne(r),r>0&&r<y?St(0,r,m,null,new yt(n.toArray())):t.withMutations(function(e){e.setSize(r),n.forEach(function(t,n){return e.set(n,t)})}))}function pt(e){return!(!e||!e[ht])}t(dt,Se),dt.of=function(){return this(arguments)},dt.prototype.toString=function(){return this.__toString("List [","]")},dt.prototype.get=function(e,t){if((e=T(this,e))>=0&&e<this.size){var n=Pt(this,e+=this._origin);return n&&n.array[e&v]}return t},dt.prototype.set=function(e,t){return function(e,t,n){if((t=T(e,t))!=t)return e;if(t>=e.size||t<0)return e.withMutations(function(e){t<0?Tt(e,t).set(0,n):Tt(e,0,t+1).set(t,n)});t+=e._origin;var r=e._tail,i=e._root,a=S(_);return t>=Et(e._capacity)?r=xt(r,e.__ownerID,0,t,n,a):i=xt(i,e.__ownerID,e._level,t,n,a),a.value?e.__ownerID?(e._root=i,e._tail=r,e.__hash=void 0,e.__altered=!0,e):St(e._origin,e._capacity,e._level,i,r):e}(this,e,t)},dt.prototype.remove=function(e){return this.has(e)?0===e?this.shift():e===this.size-1?this.pop():this.splice(e,1):this},dt.prototype.insert=function(e,t){return this.splice(e,0,t)},dt.prototype.clear=function(){return 0===this.size?this:this.__ownerID?(this.size=this._origin=this._capacity=0,this._level=m,this._root=this._tail=null,this.__hash=void 0,this.__altered=!0,this):Ct()},dt.prototype.push=function(){var e=arguments,t=this.size;return this.withMutations(function(n){Tt(n,0,t+e.length);for(var r=0;r<e.length;r++)n.set(t+r,e[r])})},dt.prototype.pop=function(){return Tt(this,0,-1)},dt.prototype.unshift=function(){var e=arguments;return this.withMutations(function(t){Tt(t,-e.length);for(var n=0;n<e.length;n++)t.set(n,e[n])})},dt.prototype.shift=function(){return Tt(this,1)},dt.prototype.merge=function(){return At(this,void 0,arguments)},dt.prototype.mergeWith=function(t){var n=e.call(arguments,1);return At(this,t,n)},dt.prototype.mergeDeep=function(){return At(this,it,arguments)},dt.prototype.mergeDeepWith=function(t){var n=e.call(arguments,1);return At(this,at(t),n)},dt.prototype.setSize=function(e){return Tt(this,0,e)},dt.prototype.slice=function(e,t){var n=this.size;return E(e,t,n)?this:Tt(this,k(e,n),I(t,n))},dt.prototype.__iterator=function(e,t){var n=0,r=_t(this,t);return new B(function(){var t=r();return t===gt?{value:void 0,done:!0}:F(e,n++,t)})},dt.prototype.__iterate=function(e,t){for(var n,r=0,i=_t(this,t);(n=i())!==gt&&!1!==e(n,r++,this););return r},dt.prototype.__ensureOwner=function(e){return e===this.__ownerID?this:e?St(this._origin,this._capacity,this._level,this._root,this._tail,e,this.__hash):(this.__ownerID=e,this)},dt.isList=pt;var ht="@@__IMMUTABLE_LIST__@@",mt=dt.prototype;function yt(e,t){this.array=e,this.ownerID=t}mt[ht]=!0,mt.delete=mt.remove,mt.setIn=Ue.setIn,mt.deleteIn=mt.removeIn=Ue.removeIn,mt.update=Ue.update,mt.updateIn=Ue.updateIn,mt.mergeIn=Ue.mergeIn,mt.mergeDeepIn=Ue.mergeDeepIn,mt.withMutations=Ue.withMutations,mt.asMutable=Ue.asMutable,mt.asImmutable=Ue.asImmutable,mt.wasAltered=Ue.wasAltered,yt.prototype.removeBefore=function(e,t,n){if(n===t?1<<t:0===this.array.length)return this;var r=n>>>t&v;if(r>=this.array.length)return new yt([],e);var i,a=0===r;if(t>0){var o=this.array[r];if((i=o&&o.removeBefore(e,t-m,n))===o&&a)return this}if(a&&!i)return this;var u=wt(this,e);if(!a)for(var s=0;s<r;s++)u.array[s]=void 0;return i&&(u.array[r]=i),u},yt.prototype.removeAfter=function(e,t,n){if(n===(t?1<<t:0)||0===this.array.length)return this;var r,i=n-1>>>t&v;if(i>=this.array.length)return this;if(t>0){var a=this.array[i];if((r=a&&a.removeAfter(e,t-m,n))===a&&i===this.array.length-1)return this}var o=wt(this,e);return o.array.splice(i+1),r&&(o.array[i]=r),o};var vt,bt,gt={};function _t(e,t){var n=e._origin,r=e._capacity,i=Et(r),a=e._tail;return o(e._root,e._level,0);function o(e,u,s){return 0===u?function(e,o){var u=o===i?a&&a.array:e&&e.array,s=o>n?0:n-o,c=r-o;return c>y&&(c=y),function(){if(s===c)return gt;var e=t?--c:s++;return u&&u[e]}}(e,s):function(e,i,a){var u,s=e&&e.array,c=a>n?0:n-a>>i,l=1+(r-a>>i);return l>y&&(l=y),function(){for(;;){if(u){var e=u();if(e!==gt)return e;u=null}if(c===l)return gt;var n=t?--l:c++;u=o(s&&s[n],i-m,a+(n<<i))}}}(e,u,s)}}function St(e,t,n,r,i,a,o){var u=Object.create(mt);return u.size=t-e,u._origin=e,u._capacity=t,u._level=n,u._root=r,u._tail=i,u.__ownerID=a,u.__hash=o,u.__altered=!1,u}function Ct(){return vt||(vt=St(0,0,m))}function xt(e,t,n,r,i,a){var o,u=r>>>n&v,s=e&&u<e.array.length;if(!s&&void 0===i)return e;if(n>0){var c=e&&e.array[u],l=xt(c,t,n-m,r,i,a);return l===c?e:((o=wt(e,t)).array[u]=l,o)}return s&&e.array[u]===i?e:(C(a),o=wt(e,t),void 0===i&&u===o.array.length-1?o.array.pop():o.array[u]=i,o)}function wt(e,t){return t&&e&&t===e.ownerID?e:new yt(e?e.array.slice():[],t)}function Pt(e,t){if(t>=Et(e._capacity))return e._tail;if(t<1<<e._level+m){for(var n=e._root,r=e._level;n&&r>0;)n=n.array[t>>>r&v],r-=m;return n}}function Tt(e,t,n){void 0!==t&&(t|=0),void 0!==n&&(n|=0);var r=e.__ownerID||new x,i=e._origin,a=e._capacity,o=i+t,u=void 0===n?a:n<0?a+n:i+n;if(o===i&&u===a)return e;if(o>=u)return e.clear();for(var s=e._level,c=e._root,l=0;o+l<0;)c=new yt(c&&c.array.length?[void 0,c]:[],r),l+=1<<(s+=m);l&&(o+=l,i+=l,u+=l,a+=l);for(var f=Et(a),d=Et(u);d>=1<<s+m;)c=new yt(c&&c.array.length?[c]:[],r),s+=m;var p=e._tail,h=d<f?Pt(e,u-1):d>f?new yt([],r):p;if(p&&d>f&&o<a&&p.array.length){for(var y=c=wt(c,r),b=s;b>m;b-=m){var g=f>>>b&v;y=y.array[g]=wt(y.array[g],r)}y.array[f>>>m&v]=p}if(u<a&&(h=h&&h.removeAfter(r,0,u)),o>=d)o-=d,u-=d,s=m,c=null,h=h&&h.removeBefore(r,0,o);else if(o>i||d<f){for(l=0;c;){var _=o>>>s&v;if(_!==d>>>s&v)break;_&&(l+=(1<<s)*_),s-=m,c=c.array[_]}c&&o>i&&(c=c.removeBefore(r,s,o-l)),c&&d<f&&(c=c.removeAfter(r,s,d-l)),l&&(o-=l,u-=l)}return e.__ownerID?(e.size=u-o,e._origin=o,e._capacity=u,e._level=s,e._root=c,e._tail=h,e.__hash=void 0,e.__altered=!0,e):St(o,u,s,c,h)}function At(e,t,n){for(var r=[],a=0,u=0;u<n.length;u++){var s=n[u],c=i(s);c.size>a&&(a=c.size),o(s)||(c=c.map(function(e){return fe(e)})),r.push(c)}return a>e.size&&(e=e.setSize(a)),ot(e,t,r)}function Et(e){return e<y?0:e-1>>>m<<m}function kt(e){return null==e?Vt():It(e)?e:Vt().withMutations(function(t){var n=r(e);Ne(n.size),n.forEach(function(e,n){return t.set(n,e)})})}function It(e){return Fe(e)&&l(e)}function Mt(e,t,n,r){var i=Object.create(kt.prototype);return i.size=e?e.size:0,i._map=e,i._list=t,i.__ownerID=n,i.__hash=r,i}function Vt(){return bt||(bt=Mt(Je(),Ct()))}function Ot(e,t,n){var r,i,a=e._map,o=e._list,u=a.get(t),s=void 0!==u;if(n===b){if(!s)return e;o.size>=y&&o.size>=2*a.size?(i=o.filter(function(e,t){return void 0!==e&&u!==t}),r=i.toKeyedSeq().map(function(e){return e[0]}).flip().toMap(),e.__ownerID&&(r.__ownerID=i.__ownerID=e.__ownerID)):(r=a.remove(t),i=u===o.size-1?o.pop():o.set(u,void 0))}else if(s){if(n===o.get(u)[1])return e;r=a,i=o.set(u,[t,n])}else r=a.set(t,o.size),i=o.set(o.size,[t,n]);return e.__ownerID?(e.size=r.size,e._map=r,e._list=i,e.__hash=void 0,e):Mt(r,i)}function Dt(e,t){this._iter=e,this._useKeys=t,this.size=e.size}function Rt(e){this._iter=e,this.size=e.size}function jt(e){this._iter=e,this.size=e.size}function Nt(e){this._iter=e,this.size=e.size}function Bt(e){var t=$t(e);return t._iter=e,t.size=e.size,t.flip=function(){return e},t.reverse=function(){var t=e.reverse.apply(this);return t.flip=function(){return e.reverse()},t},t.has=function(t){return e.includes(t)},t.includes=function(t){return e.has(t)},t.cacheResult=en,t.__iterateUncached=function(t,n){var r=this;return e.__iterate(function(e,n){return!1!==t(n,e,r)},n)},t.__iteratorUncached=function(t,n){if(t===D){var r=e.__iterator(t,n);return new B(function(){var e=r.next();if(!e.done){var t=e.value[0];e.value[0]=e.value[1],e.value[1]=t}return e})}return e.__iterator(t===O?V:O,n)},t}function Ft(e,t,n){var r=$t(e);return r.size=e.size,r.has=function(t){return e.has(t)},r.get=function(r,i){var a=e.get(r,b);return a===b?i:t.call(n,a,r,e)},r.__iterateUncached=function(r,i){var a=this;return e.__iterate(function(e,i,o){return!1!==r(t.call(n,e,i,o),i,a)},i)},r.__iteratorUncached=function(r,i){var a=e.__iterator(D,i);return new B(function(){var i=a.next();if(i.done)return i;var o=i.value,u=o[0];return F(r,u,t.call(n,o[1],u,e),i)})},r}function Lt(e,t){var n=$t(e);return n._iter=e,n.size=e.size,n.reverse=function(){return e},e.flip&&(n.flip=function(){var t=Bt(e);return t.reverse=function(){return e.flip()},t}),n.get=function(n,r){return e.get(t?n:-1-n,r)},n.has=function(n){return e.has(t?n:-1-n)},n.includes=function(t){return e.includes(t)},n.cacheResult=en,n.__iterate=function(t,n){var r=this;return e.__iterate(function(e,n){return t(e,n,r)},!n)},n.__iterator=function(t,n){return e.__iterator(t,!n)},n}function zt(e,t,n,r){var i=$t(e);return r&&(i.has=function(r){var i=e.get(r,b);return i!==b&&!!t.call(n,i,r,e)},i.get=function(r,i){var a=e.get(r,b);return a!==b&&t.call(n,a,r,e)?a:i}),i.__iterateUncached=function(i,a){var o=this,u=0;return e.__iterate(function(e,a,s){if(t.call(n,e,a,s))return u++,i(e,r?a:u-1,o)},a),u},i.__iteratorUncached=function(i,a){var o=e.__iterator(D,a),u=0;return new B(function(){for(;;){var a=o.next();if(a.done)return a;var s=a.value,c=s[0],l=s[1];if(t.call(n,l,c,e))return F(i,r?c:u++,l,a)}})},i}function Ut(e,t,n,r){var i=e.size;if(void 0!==t&&(t|=0),void 0!==n&&(n===1/0?n=i:n|=0),E(t,n,i))return e;var a=k(t,i),o=I(n,i);if(a!=a||o!=o)return Ut(e.toSeq().cacheResult(),t,n,r);var u,s=o-a;s==s&&(u=s<0?0:s);var c=$t(e);return c.size=0===u?u:e.size&&u||void 0,!r&&ie(e)&&u>=0&&(c.get=function(t,n){return(t=T(this,t))>=0&&t<u?e.get(t+a,n):n}),c.__iterateUncached=function(t,n){var i=this;if(0===u)return 0;if(n)return this.cacheResult().__iterate(t,n);var o=0,s=!0,c=0;return e.__iterate(function(e,n){if(!s||!(s=o++<a))return c++,!1!==t(e,r?n:c-1,i)&&c!==u}),c},c.__iteratorUncached=function(t,n){if(0!==u&&n)return this.cacheResult().__iterator(t,n);var i=0!==u&&e.__iterator(t,n),o=0,s=0;return new B(function(){for(;o++<a;)i.next();if(++s>u)return{value:void 0,done:!0};var e=i.next();return r||t===O?e:F(t,s-1,t===V?void 0:e.value[1],e)})},c}function Gt(e,t,n,r){var i=$t(e);return i.__iterateUncached=function(i,a){var o=this;if(a)return this.cacheResult().__iterate(i,a);var u=!0,s=0;return e.__iterate(function(e,a,c){if(!u||!(u=t.call(n,e,a,c)))return s++,i(e,r?a:s-1,o)}),s},i.__iteratorUncached=function(i,a){var o=this;if(a)return this.cacheResult().__iterator(i,a);var u=e.__iterator(D,a),s=!0,c=0;return new B(function(){var e,a,l;do{if((e=u.next()).done)return r||i===O?e:F(i,c++,i===V?void 0:e.value[1],e);var f=e.value;a=f[0],l=f[1],s&&(s=t.call(n,l,a,o))}while(s);return i===D?e:F(i,a,l,e)})},i}function qt(e,t,n){var r=$t(e);return r.__iterateUncached=function(r,i){var a=0,u=!1;return function e(s,c){var l=this;s.__iterate(function(i,s){return(!t||c<t)&&o(i)?e(i,c+1):!1===r(i,n?s:a++,l)&&(u=!0),!u},i)}(e,0),a},r.__iteratorUncached=function(r,i){var a=e.__iterator(r,i),u=[],s=0;return new B(function(){for(;a;){var e=a.next();if(!1===e.done){var c=e.value;if(r===D&&(c=c[1]),t&&!(u.length<t)||!o(c))return n?e:F(r,s++,c,e);u.push(a),a=c.__iterator(r,i)}else a=u.pop()}return{value:void 0,done:!0}})},r}function Ht(e,t,n){t||(t=tn);var r=u(e),i=0,a=e.toSeq().map(function(t,r){return[r,t,i++,n?n(t,r,e):t]}).toArray();return a.sort(function(e,n){return t(e[3],n[3])||e[2]-n[2]}).forEach(r?function(e,t){a[t].length=2}:function(e,t){a[t]=e[1]}),r?Y(a):s(e)?K(a):X(a)}function Wt(e,t,n){if(t||(t=tn),n){var r=e.toSeq().map(function(t,r){return[t,n(t,r,e)]}).reduce(function(e,n){return Yt(t,e[1],n[1])?n:e});return r&&r[0]}return e.reduce(function(e,n){return Yt(t,e,n)?n:e})}function Yt(e,t,n){var r=e(n,t);return 0===r&&n!==t&&(null==n||n!=n)||r>0}function Kt(e,t,r){var i=$t(e);return i.size=new ee(r).map(function(e){return e.size}).min(),i.__iterate=function(e,t){for(var n,r=this.__iterator(O,t),i=0;!(n=r.next()).done&&!1!==e(n.value,i++,this););return i},i.__iteratorUncached=function(e,i){var a=r.map(function(e){return e=n(e),G(i?e.reverse():e)}),o=0,u=!1;return new B(function(){var n;return u||(n=a.map(function(e){return e.next()}),u=n.some(function(e){return e.done})),u?{value:void 0,done:!0}:F(e,o++,t.apply(null,n.map(function(e){return e.value})))})},i}function Xt(e,t){return ie(e)?t:e.constructor(t)}function Qt(e){if(e!==Object(e))throw new TypeError("Expected [K, V] tuple: "+e)}function Zt(e){return Ne(e.size),P(e)}function Jt(e){return u(e)?r:s(e)?i:a}function $t(e){return Object.create((u(e)?Y:s(e)?K:X).prototype)}function en(){return this._iter.cacheResult?(this._iter.cacheResult(),this.size=this._iter.size,this):W.prototype.cacheResult.call(this)}function tn(e,t){return e>t?1:e<t?-1:0}function nn(e){var t=G(e);if(!t){if(!H(e))throw new TypeError("Expected iterable or array-like: "+e);t=G(n(e))}return t}function rn(e,t){var n,r=function(a){if(a instanceof r)return a;if(!(this instanceof r))return new r(a);if(!n){n=!0;var o=Object.keys(e);!function(e,t){try{t.forEach(function(e,t){Object.defineProperty(e,t,{get:function(){return this.get(t)},set:function(e){ve(this.__ownerID,"Cannot set on an immutable record."),this.set(t,e)}})}.bind(void 0,e))}catch(e){}}(i,o),i.size=o.length,i._name=t,i._keys=o,i._defaultValues=e}this._map=Be(a)},i=r.prototype=Object.create(an);return i.constructor=r,r}t(kt,Be),kt.of=function(){return this(arguments)},kt.prototype.toString=function(){return this.__toString("OrderedMap {","}")},kt.prototype.get=function(e,t){var n=this._map.get(e);return void 0!==n?this._list.get(n)[1]:t},kt.prototype.clear=function(){return 0===this.size?this:this.__ownerID?(this.size=0,this._map.clear(),this._list.clear(),this):Vt()},kt.prototype.set=function(e,t){return Ot(this,e,t)},kt.prototype.remove=function(e){return Ot(this,e,b)},kt.prototype.wasAltered=function(){return this._map.wasAltered()||this._list.wasAltered()},kt.prototype.__iterate=function(e,t){var n=this;return this._list.__iterate(function(t){return t&&e(t[1],t[0],n)},t)},kt.prototype.__iterator=function(e,t){return this._list.fromEntrySeq().__iterator(e,t)},kt.prototype.__ensureOwner=function(e){if(e===this.__ownerID)return this;var t=this._map.__ensureOwner(e),n=this._list.__ensureOwner(e);return e?Mt(t,n,e,this.__hash):(this.__ownerID=e,this._map=t,this._list=n,this)},kt.isOrderedMap=It,kt.prototype[h]=!0,kt.prototype.delete=kt.prototype.remove,t(Dt,Y),Dt.prototype.get=function(e,t){return this._iter.get(e,t)},Dt.prototype.has=function(e){return this._iter.has(e)},Dt.prototype.valueSeq=function(){return this._iter.valueSeq()},Dt.prototype.reverse=function(){var e=this,t=Lt(this,!0);return this._useKeys||(t.valueSeq=function(){return e._iter.toSeq().reverse()}),t},Dt.prototype.map=function(e,t){var n=this,r=Ft(this,e,t);return this._useKeys||(r.valueSeq=function(){return n._iter.toSeq().map(e,t)}),r},Dt.prototype.__iterate=function(e,t){var n,r=this;return this._iter.__iterate(this._useKeys?function(t,n){return e(t,n,r)}:(n=t?Zt(this):0,function(i){return e(i,t?--n:n++,r)}),t)},Dt.prototype.__iterator=function(e,t){if(this._useKeys)return this._iter.__iterator(e,t);var n=this._iter.__iterator(O,t),r=t?Zt(this):0;return new B(function(){var i=n.next();return i.done?i:F(e,t?--r:r++,i.value,i)})},Dt.prototype[h]=!0,t(Rt,K),Rt.prototype.includes=function(e){return this._iter.includes(e)},Rt.prototype.__iterate=function(e,t){var n=this,r=0;return this._iter.__iterate(function(t){return e(t,r++,n)},t)},Rt.prototype.__iterator=function(e,t){var n=this._iter.__iterator(O,t),r=0;return new B(function(){var t=n.next();return t.done?t:F(e,r++,t.value,t)})},t(jt,X),jt.prototype.has=function(e){return this._iter.includes(e)},jt.prototype.__iterate=function(e,t){var n=this;return this._iter.__iterate(function(t){return e(t,t,n)},t)},jt.prototype.__iterator=function(e,t){var n=this._iter.__iterator(O,t);return new B(function(){var t=n.next();return t.done?t:F(e,t.value,t.value,t)})},t(Nt,Y),Nt.prototype.entrySeq=function(){return this._iter.toSeq()},Nt.prototype.__iterate=function(e,t){var n=this;return this._iter.__iterate(function(t){if(t){Qt(t);var r=o(t);return e(r?t.get(1):t[1],r?t.get(0):t[0],n)}},t)},Nt.prototype.__iterator=function(e,t){var n=this._iter.__iterator(O,t);return new B(function(){for(;;){var t=n.next();if(t.done)return t;var r=t.value;if(r){Qt(r);var i=o(r);return F(e,i?r.get(0):r[0],i?r.get(1):r[1],t)}}})},Rt.prototype.cacheResult=Dt.prototype.cacheResult=jt.prototype.cacheResult=Nt.prototype.cacheResult=en,t(rn,_e),rn.prototype.toString=function(){return this.__toString(un(this)+" {","}")},rn.prototype.has=function(e){return this._defaultValues.hasOwnProperty(e)},rn.prototype.get=function(e,t){if(!this.has(e))return t;var n=this._defaultValues[e];return this._map?this._map.get(e,n):n},rn.prototype.clear=function(){if(this.__ownerID)return this._map&&this._map.clear(),this;var e=this.constructor;return e._empty||(e._empty=on(this,Je()))},rn.prototype.set=function(e,t){if(!this.has(e))throw new Error('Cannot set unknown key "'+e+'" on '+un(this));if(this._map&&!this._map.has(e)){var n=this._defaultValues[e];if(t===n)return this}var r=this._map&&this._map.set(e,t);return this.__ownerID||r===this._map?this:on(this,r)},rn.prototype.remove=function(e){if(!this.has(e))return this;var t=this._map&&this._map.remove(e);return this.__ownerID||t===this._map?this:on(this,t)},rn.prototype.wasAltered=function(){return this._map.wasAltered()},rn.prototype.__iterator=function(e,t){var n=this;return r(this._defaultValues).map(function(e,t){return n.get(t)}).__iterator(e,t)},rn.prototype.__iterate=function(e,t){var n=this;return r(this._defaultValues).map(function(e,t){return n.get(t)}).__iterate(e,t)},rn.prototype.__ensureOwner=function(e){if(e===this.__ownerID)return this;var t=this._map&&this._map.__ensureOwner(e);return e?on(this,t,e):(this.__ownerID=e,this._map=t,this)};var an=rn.prototype;function on(e,t,n){var r=Object.create(Object.getPrototypeOf(e));return r._map=t,r.__ownerID=n,r}function un(e){return e._name||e.constructor.name||"Record"}function sn(e){return null==e?mn():cn(e)&&!l(e)?e:mn().withMutations(function(t){var n=a(e);Ne(n.size),n.forEach(function(e){return t.add(e)})})}function cn(e){return!(!e||!e[fn])}an.delete=an.remove,an.deleteIn=an.removeIn=Ue.removeIn,an.merge=Ue.merge,an.mergeWith=Ue.mergeWith,an.mergeIn=Ue.mergeIn,an.mergeDeep=Ue.mergeDeep,an.mergeDeepWith=Ue.mergeDeepWith,an.mergeDeepIn=Ue.mergeDeepIn,an.setIn=Ue.setIn,an.update=Ue.update,an.updateIn=Ue.updateIn,an.withMutations=Ue.withMutations,an.asMutable=Ue.asMutable,an.asImmutable=Ue.asImmutable,t(sn,Ce),sn.of=function(){return this(arguments)},sn.fromKeys=function(e){return this(r(e).keySeq())},sn.prototype.toString=function(){return this.__toString("Set {","}")},sn.prototype.has=function(e){return this._map.has(e)},sn.prototype.add=function(e){return pn(this,this._map.set(e,!0))},sn.prototype.remove=function(e){return pn(this,this._map.remove(e))},sn.prototype.clear=function(){return pn(this,this._map.clear())},sn.prototype.union=function(){var t=e.call(arguments,0);return 0===(t=t.filter(function(e){return 0!==e.size})).length?this:0!==this.size||this.__ownerID||1!==t.length?this.withMutations(function(e){for(var n=0;n<t.length;n++)a(t[n]).forEach(function(t){return e.add(t)})}):this.constructor(t[0])},sn.prototype.intersect=function(){var t=e.call(arguments,0);if(0===t.length)return this;t=t.map(function(e){return a(e)});var n=this;return this.withMutations(function(e){n.forEach(function(n){t.every(function(e){return e.includes(n)})||e.remove(n)})})},sn.prototype.subtract=function(){var t=e.call(arguments,0);if(0===t.length)return this;t=t.map(function(e){return a(e)});var n=this;return this.withMutations(function(e){n.forEach(function(n){t.some(function(e){return e.includes(n)})&&e.remove(n)})})},sn.prototype.merge=function(){return this.union.apply(this,arguments)},sn.prototype.mergeWith=function(t){var n=e.call(arguments,1);return this.union.apply(this,n)},sn.prototype.sort=function(e){return yn(Ht(this,e))},sn.prototype.sortBy=function(e,t){return yn(Ht(this,t,e))},sn.prototype.wasAltered=function(){return this._map.wasAltered()},sn.prototype.__iterate=function(e,t){var n=this;return this._map.__iterate(function(t,r){return e(r,r,n)},t)},sn.prototype.__iterator=function(e,t){return this._map.map(function(e,t){return t}).__iterator(e,t)},sn.prototype.__ensureOwner=function(e){if(e===this.__ownerID)return this;var t=this._map.__ensureOwner(e);return e?this.__make(t,e):(this.__ownerID=e,this._map=t,this)},sn.isSet=cn;var ln,fn="@@__IMMUTABLE_SET__@@",dn=sn.prototype;function pn(e,t){return e.__ownerID?(e.size=t.size,e._map=t,e):t===e._map?e:0===t.size?e.__empty():e.__make(t)}function hn(e,t){var n=Object.create(dn);return n.size=e?e.size:0,n._map=e,n.__ownerID=t,n}function mn(){return ln||(ln=hn(Je()))}function yn(e){return null==e?Sn():vn(e)?e:Sn().withMutations(function(t){var n=a(e);Ne(n.size),n.forEach(function(e){return t.add(e)})})}function vn(e){return cn(e)&&l(e)}dn[fn]=!0,dn.delete=dn.remove,dn.mergeDeep=dn.merge,dn.mergeDeepWith=dn.mergeWith,dn.withMutations=Ue.withMutations,dn.asMutable=Ue.asMutable,dn.asImmutable=Ue.asImmutable,dn.__empty=mn,dn.__make=hn,t(yn,sn),yn.of=function(){return this(arguments)},yn.fromKeys=function(e){return this(r(e).keySeq())},yn.prototype.toString=function(){return this.__toString("OrderedSet {","}")},yn.isOrderedSet=vn;var bn,gn=yn.prototype;function _n(e,t){var n=Object.create(gn);return n.size=e?e.size:0,n._map=e,n.__ownerID=t,n}function Sn(){return bn||(bn=_n(Vt()))}function Cn(e){return null==e?En():xn(e)?e:En().unshiftAll(e)}function xn(e){return!(!e||!e[Pn])}gn[h]=!0,gn.__empty=Sn,gn.__make=_n,t(Cn,Se),Cn.of=function(){return this(arguments)},Cn.prototype.toString=function(){return this.__toString("Stack [","]")},Cn.prototype.get=function(e,t){var n=this._head;for(e=T(this,e);n&&e--;)n=n.next;return n?n.value:t},Cn.prototype.peek=function(){return this._head&&this._head.value},Cn.prototype.push=function(){if(0===arguments.length)return this;for(var e=this.size+arguments.length,t=this._head,n=arguments.length-1;n>=0;n--)t={value:arguments[n],next:t};return this.__ownerID?(this.size=e,this._head=t,this.__hash=void 0,this.__altered=!0,this):An(e,t)},Cn.prototype.pushAll=function(e){if(0===(e=i(e)).size)return this;Ne(e.size);var t=this.size,n=this._head;return e.reverse().forEach(function(e){t++,n={value:e,next:n}}),this.__ownerID?(this.size=t,this._head=n,this.__hash=void 0,this.__altered=!0,this):An(t,n)},Cn.prototype.pop=function(){return this.slice(1)},Cn.prototype.unshift=function(){return this.push.apply(this,arguments)},Cn.prototype.unshiftAll=function(e){return this.pushAll(e)},Cn.prototype.shift=function(){return this.pop.apply(this,arguments)},Cn.prototype.clear=function(){return 0===this.size?this:this.__ownerID?(this.size=0,this._head=void 0,this.__hash=void 0,this.__altered=!0,this):En()},Cn.prototype.slice=function(e,t){if(E(e,t,this.size))return this;var n=k(e,this.size),r=I(t,this.size);if(r!==this.size)return Se.prototype.slice.call(this,e,t);for(var i=this.size-n,a=this._head;n--;)a=a.next;return this.__ownerID?(this.size=i,this._head=a,this.__hash=void 0,this.__altered=!0,this):An(i,a)},Cn.prototype.__ensureOwner=function(e){return e===this.__ownerID?this:e?An(this.size,this._head,e,this.__hash):(this.__ownerID=e,this.__altered=!1,this)},Cn.prototype.__iterate=function(e,t){if(t)return this.reverse().__iterate(e);for(var n=0,r=this._head;r&&!1!==e(r.value,n++,this);)r=r.next;return n},Cn.prototype.__iterator=function(e,t){if(t)return this.reverse().__iterator(e);var n=0,r=this._head;return new B(function(){if(r){var t=r.value;return r=r.next,F(e,n++,t)}return{value:void 0,done:!0}})},Cn.isStack=xn;var wn,Pn="@@__IMMUTABLE_STACK__@@",Tn=Cn.prototype;function An(e,t,n,r){var i=Object.create(Tn);return i.size=e,i._head=t,i.__ownerID=n,i.__hash=r,i.__altered=!1,i}function En(){return wn||(wn=An(0))}function kn(e,t){var n=function(n){e.prototype[n]=t[n]};return Object.keys(t).forEach(n),Object.getOwnPropertySymbols&&Object.getOwnPropertySymbols(t).forEach(n),e}Tn[Pn]=!0,Tn.withMutations=Ue.withMutations,Tn.asMutable=Ue.asMutable,Tn.asImmutable=Ue.asImmutable,Tn.wasAltered=Ue.wasAltered,n.Iterator=B,kn(n,{toArray:function(){Ne(this.size);var e=new Array(this.size||0);return this.valueSeq().__iterate(function(t,n){e[n]=t}),e},toIndexedSeq:function(){return new Rt(this)},toJS:function(){return this.toSeq().map(function(e){return e&&"function"==typeof e.toJS?e.toJS():e}).__toJS()},toJSON:function(){return this.toSeq().map(function(e){return e&&"function"==typeof e.toJSON?e.toJSON():e}).__toJS()},toKeyedSeq:function(){return new Dt(this,!0)},toMap:function(){return Be(this.toKeyedSeq())},toObject:function(){Ne(this.size);var e={};return this.__iterate(function(t,n){e[n]=t}),e},toOrderedMap:function(){return kt(this.toKeyedSeq())},toOrderedSet:function(){return yn(u(this)?this.valueSeq():this)},toSet:function(){return sn(u(this)?this.valueSeq():this)},toSetSeq:function(){return new jt(this)},toSeq:function(){return s(this)?this.toIndexedSeq():u(this)?this.toKeyedSeq():this.toSetSeq()},toStack:function(){return Cn(u(this)?this.valueSeq():this)},toList:function(){return dt(u(this)?this.valueSeq():this)},toString:function(){return"[Iterable]"},__toString:function(e,t){return 0===this.size?e+t:e+" "+this.toSeq().map(this.__toStringMapper).join(", ")+" "+t},concat:function(){var t=e.call(arguments,0);return Xt(this,function(e,t){var n=u(e),i=[e].concat(t).map(function(e){return o(e)?n&&(e=r(e)):e=n?oe(e):ue(Array.isArray(e)?e:[e]),e}).filter(function(e){return 0!==e.size});if(0===i.length)return e;if(1===i.length){var a=i[0];if(a===e||n&&u(a)||s(e)&&s(a))return a}var c=new ee(i);return n?c=c.toKeyedSeq():s(e)||(c=c.toSetSeq()),(c=c.flatten(!0)).size=i.reduce(function(e,t){if(void 0!==e){var n=t.size;if(void 0!==n)return e+n}},0),c}(this,t))},includes:function(e){return this.some(function(t){return he(t,e)})},entries:function(){return this.__iterator(D)},every:function(e,t){Ne(this.size);var n=!0;return this.__iterate(function(r,i,a){if(!e.call(t,r,i,a))return n=!1,!1}),n},filter:function(e,t){return Xt(this,zt(this,e,t,!0))},find:function(e,t,n){var r=this.findEntry(e,t);return r?r[1]:n},forEach:function(e,t){return Ne(this.size),this.__iterate(t?e.bind(t):e)},join:function(e){Ne(this.size),e=void 0!==e?""+e:",";var t="",n=!0;return this.__iterate(function(r){n?n=!1:t+=e,t+=null!=r?r.toString():""}),t},keys:function(){return this.__iterator(V)},map:function(e,t){return Xt(this,Ft(this,e,t))},reduce:function(e,t,n){var r,i;return Ne(this.size),arguments.length<2?i=!0:r=t,this.__iterate(function(t,a,o){i?(i=!1,r=t):r=e.call(n,r,t,a,o)}),r},reduceRight:function(e,t,n){var r=this.toKeyedSeq().reverse();return r.reduce.apply(r,arguments)},reverse:function(){return Xt(this,Lt(this,!0))},slice:function(e,t){return Xt(this,Ut(this,e,t,!0))},some:function(e,t){return!this.every(Dn(e),t)},sort:function(e){return Xt(this,Ht(this,e))},values:function(){return this.__iterator(O)},butLast:function(){return this.slice(0,-1)},isEmpty:function(){return void 0!==this.size?0===this.size:!this.some(function(){return!0})},count:function(e,t){return P(e?this.toSeq().filter(e,t):this)},countBy:function(e,t){return function(e,t,n){var r=Be().asMutable();return e.__iterate(function(i,a){r.update(t.call(n,i,a,e),0,function(e){return e+1})}),r.asImmutable()}(this,e,t)},equals:function(e){return me(this,e)},entrySeq:function(){var e=this;if(e._cache)return new ee(e._cache);var t=e.toSeq().map(On).toIndexedSeq();return t.fromEntrySeq=function(){return e.toSeq()},t},filterNot:function(e,t){return this.filter(Dn(e),t)},findEntry:function(e,t,n){var r=n;return this.__iterate(function(n,i,a){if(e.call(t,n,i,a))return r=[i,n],!1}),r},findKey:function(e,t){var n=this.findEntry(e,t);return n&&n[0]},findLast:function(e,t,n){return this.toKeyedSeq().reverse().find(e,t,n)},findLastEntry:function(e,t,n){return this.toKeyedSeq().reverse().findEntry(e,t,n)},findLastKey:function(e,t){return this.toKeyedSeq().reverse().findKey(e,t)},first:function(){return this.find(A)},flatMap:function(e,t){return Xt(this,function(e,t,n){var r=Jt(e);return e.toSeq().map(function(i,a){return r(t.call(n,i,a,e))}).flatten(!0)}(this,e,t))},flatten:function(e){return Xt(this,qt(this,e,!0))},fromEntrySeq:function(){return new Nt(this)},get:function(e,t){return this.find(function(t,n){return he(n,e)},void 0,t)},getIn:function(e,t){for(var n,r=this,i=nn(e);!(n=i.next()).done;){var a=n.value;if((r=r&&r.get?r.get(a,b):b)===b)return t}return r},groupBy:function(e,t){return function(e,t,n){var r=u(e),i=(l(e)?kt():Be()).asMutable();e.__iterate(function(a,o){i.update(t.call(n,a,o,e),function(e){return(e=e||[]).push(r?[o,a]:a),e})});var a=Jt(e);return i.map(function(t){return Xt(e,a(t))})}(this,e,t)},has:function(e){return this.get(e,b)!==b},hasIn:function(e){return this.getIn(e,b)!==b},isSubset:function(e){return e="function"==typeof e.includes?e:n(e),this.every(function(t){return e.includes(t)})},isSuperset:function(e){return(e="function"==typeof e.isSubset?e:n(e)).isSubset(this)},keyOf:function(e){return this.findKey(function(t){return he(t,e)})},keySeq:function(){return this.toSeq().map(Vn).toIndexedSeq()},last:function(){return this.toSeq().reverse().first()},lastKeyOf:function(e){return this.toKeyedSeq().reverse().keyOf(e)},max:function(e){return Wt(this,e)},maxBy:function(e,t){return Wt(this,t,e)},min:function(e){return Wt(this,e?Rn(e):Bn)},minBy:function(e,t){return Wt(this,t?Rn(t):Bn,e)},rest:function(){return this.slice(1)},skip:function(e){return this.slice(Math.max(0,e))},skipLast:function(e){return Xt(this,this.toSeq().reverse().skip(e).reverse())},skipWhile:function(e,t){return Xt(this,Gt(this,e,t,!0))},skipUntil:function(e,t){return this.skipWhile(Dn(e),t)},sortBy:function(e,t){return Xt(this,Ht(this,t,e))},take:function(e){return this.slice(0,Math.max(0,e))},takeLast:function(e){return Xt(this,this.toSeq().reverse().take(e).reverse())},takeWhile:function(e,t){return Xt(this,function(e,t,n){var r=$t(e);return r.__iterateUncached=function(r,i){var a=this;if(i)return this.cacheResult().__iterate(r,i);var o=0;return e.__iterate(function(e,i,u){return t.call(n,e,i,u)&&++o&&r(e,i,a)}),o},r.__iteratorUncached=function(r,i){var a=this;if(i)return this.cacheResult().__iterator(r,i);var o=e.__iterator(D,i),u=!0;return new B(function(){if(!u)return{value:void 0,done:!0};var e=o.next();if(e.done)return e;var i=e.value,s=i[0],c=i[1];return t.call(n,c,s,a)?r===D?e:F(r,s,c,e):(u=!1,{value:void 0,done:!0})})},r}(this,e,t))},takeUntil:function(e,t){return this.takeWhile(Dn(e),t)},valueSeq:function(){return this.toIndexedSeq()},hashCode:function(){return this.__hash||(this.__hash=function(e){if(e.size===1/0)return 0;var t=l(e),n=u(e),r=t?1:0;return function(e,t){return t=xe(t,3432918353),t=xe(t<<15|t>>>-15,461845907),t=xe(t<<13|t>>>-13,5),t=xe((t=(t+3864292196|0)^e)^t>>>16,2246822507),t=we((t=xe(t^t>>>13,3266489909))^t>>>16)}(e.__iterate(n?t?function(e,t){r=31*r+Fn(Pe(e),Pe(t))|0}:function(e,t){r=r+Fn(Pe(e),Pe(t))|0}:t?function(e){r=31*r+Pe(e)|0}:function(e){r=r+Pe(e)|0}),r)}(this))}});var In=n.prototype;In[f]=!0,In[N]=In.values,In.__toJS=In.toArray,In.__toStringMapper=jn,In.inspect=In.toSource=function(){return this.toString()},In.chain=In.flatMap,In.contains=In.includes,kn(r,{flip:function(){return Xt(this,Bt(this))},mapEntries:function(e,t){var n=this,r=0;return Xt(this,this.toSeq().map(function(i,a){return e.call(t,[a,i],r++,n)}).fromEntrySeq())},mapKeys:function(e,t){var n=this;return Xt(this,this.toSeq().flip().map(function(r,i){return e.call(t,r,i,n)}).flip())}});var Mn=r.prototype;function Vn(e,t){return t}function On(e,t){return[t,e]}function Dn(e){return function(){return!e.apply(this,arguments)}}function Rn(e){return function(){return-e.apply(this,arguments)}}function jn(e){return"string"==typeof e?JSON.stringify(e):String(e)}function Nn(){return w(arguments)}function Bn(e,t){return e<t?1:e>t?-1:0}function Fn(e,t){return e^t+2654435769+(e<<6)+(e>>2)|0}return Mn[d]=!0,Mn[N]=In.entries,Mn.__toJS=In.toObject,Mn.__toStringMapper=function(e,t){return JSON.stringify(t)+": "+jn(e)},kn(i,{toKeyedSeq:function(){return new Dt(this,!1)},filter:function(e,t){return Xt(this,zt(this,e,t,!1))},findIndex:function(e,t){var n=this.findEntry(e,t);return n?n[0]:-1},indexOf:function(e){var t=this.keyOf(e);return void 0===t?-1:t},lastIndexOf:function(e){var t=this.lastKeyOf(e);return void 0===t?-1:t},reverse:function(){return Xt(this,Lt(this,!1))},slice:function(e,t){return Xt(this,Ut(this,e,t,!1))},splice:function(e,t){var n=arguments.length;if(t=Math.max(0|t,0),0===n||2===n&&!t)return this;e=k(e,e<0?this.count():this.size);var r=this.slice(0,e);return Xt(this,1===n?r:r.concat(w(arguments,2),this.slice(e+t)))},findLastIndex:function(e,t){var n=this.findLastEntry(e,t);return n?n[0]:-1},first:function(){return this.get(0)},flatten:function(e){return Xt(this,qt(this,e,!1))},get:function(e,t){return(e=T(this,e))<0||this.size===1/0||void 0!==this.size&&e>this.size?t:this.find(function(t,n){return n===e},void 0,t)},has:function(e){return(e=T(this,e))>=0&&(void 0!==this.size?this.size===1/0||e<this.size:-1!==this.indexOf(e))},interpose:function(e){return Xt(this,function(e,t){var n=$t(e);return n.size=e.size&&2*e.size-1,n.__iterateUncached=function(n,r){var i=this,a=0;return e.__iterate(function(e,r){return(!a||!1!==n(t,a++,i))&&!1!==n(e,a++,i)},r),a},n.__iteratorUncached=function(n,r){var i,a=e.__iterator(O,r),o=0;return new B(function(){return(!i||o%2)&&(i=a.next()).done?i:o%2?F(n,o++,t):F(n,o++,i.value,i)})},n}(this,e))},interleave:function(){var e=[this].concat(w(arguments)),t=Kt(this.toSeq(),K.of,e),n=t.flatten(!0);return t.size&&(n.size=t.size*e.length),Xt(this,n)},keySeq:function(){return be(0,this.size)},last:function(){return this.get(-1)},skipWhile:function(e,t){return Xt(this,Gt(this,e,t,!1))},zip:function(){return Xt(this,Kt(this,Nn,[this].concat(w(arguments))))},zipWith:function(e){var t=w(arguments);return t[0]=this,Xt(this,Kt(this,e,t))}}),i.prototype[p]=!0,i.prototype[h]=!0,kn(a,{get:function(e,t){return this.has(e)?e:t},includes:function(e){return this.has(e)},keySeq:function(){return this.valueSeq()}}),a.prototype.has=In.includes,a.prototype.contains=a.prototype.includes,kn(Y,r.prototype),kn(K,i.prototype),kn(X,a.prototype),kn(_e,r.prototype),kn(Se,i.prototype),kn(Ce,a.prototype),{Iterable:n,Seq:W,Collection:ge,Map:Be,OrderedMap:kt,List:dt,Stack:Cn,Set:sn,OrderedSet:yn,Record:rn,Range:be,Repeat:ye,is:he,fromJS:fe}}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(492),i=n(493),a=n(210),o=n(120),u=n(496),s=n(497),c=n(498),l=n(499);t.default={parse:function(e){return"string"==typeof e?r.default(e):i.default(e)},parseText:r.default,parseBinary:i.default,toDatabaseCollection:a.toDatabaseCollection,toDatabase:a.toDatabase,schema:{mmCIF:function(e){return a.toDatabase(o.mmCIF_Schema,e)},CCD:function(e){return a.toDatabase(u.CCD_Schema,e)},BIRD:function(e){return a.toDatabase(s.BIRD_Schema,e)},dic:function(e){return a.toDatabase(c.dic_Schema,e)},densityServer:function(e){return a.toDatabase(l.DensityServer_Data_Schema,e)}}},function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(154))},function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){if("undefined"!=typeof window&&window.performance){var t=window.performance;return function(){return t.now()}}return void 0!==e&&"undefined"!==e.hrtime&&"function"==typeof e.hrtime?function(){var t=e.hrtime();return 1e3*t[0]+t[1]/1e6}:Date.now?function(){return Date.now()}:function(){return+new Date}}();t.now=n,t.formatTimespan=function(e){if(isNaN(e))return"n/a";for(var t=Math.floor(e/36e5),n=Math.floor(e/6e4%60),r=Math.floor(e/1e3%60),i=Math.floor(e%1e3).toString();i.length<3;)i="0"+i;return t>0?t+"h"+n+"m"+r+"."+i+"s":n>0?n+"m"+r+"."+i+"s":r>0?r+"."+i+"s":e.toFixed(0)+"ms"}}).call(this,n(179))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(34);!function(e){e.create=function(e){return{ref:e}},e.set=function(e,t){return e.ref=t,e}}(r||(r={})),t.ValueRef=r;var a,o,u=i.idFactory(0,2147483647);!function(e){e.create=function(e,t){return{id:u(),version:0,value:e,metadata:t}},e.withValue=function(e,t){return{id:e.id,version:e.version+1,value:t,metadata:e.metadata}}}(a||(a={})),t.ValueBox=a,function(e){function t(e,t){return r.set(e,a.withValue(e.ref,t))}e.create=function(e,t){return r.create(a.create(e,t))},e.update=t,e.set=function(e,t){return r.set(e,t)},e.updateIfChanged=function(e,n){return e.ref.value!==n?t(e,n):e}}(o||(o={})),t.ValueCell=o},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),a=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{s(r.next(e))}catch(e){a(e)}}function u(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,u)}s((r=r.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}};Object.defineProperty(t,"__esModule",{value:!0});var u,s=n(135),c=n(19),l=n(117),f=n(7),d=n(194),p=n(5),h=n(17),m=n(377),y=n(245),v=n(195);!function(e){function t(e){return h.hash2(e.invariantId,p.SortedArray.hashCode(e.elements))}e.isAtomic=function(e){return 0===e.kind},e.isCoarse=function(e){return 1===e.kind||2===e.kind},e.isSpheres=function(e){return 1===e.kind},e.isGaussians=function(e){return 2===e.kind},e.create=function(e,t,i,a,o,u){switch(i){case 0:return new n(e,t,a,u,s.SymmetryOperator.createMapping(o,a.atomicConformation,void 0),r());case 1:return g(e,t,a,1,u,s.SymmetryOperator.createMapping(o,a.coarseConformation.spheres,function(e){var t=e.coarseConformation.spheres.radius;return function(e){return t[e]}}(a)),b());case 2:return g(e,t,a,2,u,s.SymmetryOperator.createMapping(o,a.coarseConformation.gaussians,function(e){return 0}),b())}},e.SymmetryGroup=function(e){var n={};return{elements:e[0].elements,units:e,get unitIndexMap(){return n.unitIndexMap?n.unitIndexMap:(n.unitIndexMap=function(e){for(var t=p.IntMap.Mutable(),n=0,r=e.length;n<r;n++)t.set(e[n].id,n);return t}(e),n.unitIndexMap)},hashCode:t(e[0]),transformHash:h.hashFnv32a(e.map(function(e){return e.id}))}},e.conformationId=function(t){return e.isAtomic(t)?t.model.atomicConformation.id:t.model.coarseConformation.id},e.hashUnit=t;var n=function(){function e(e,t,n,r,i,a){this.kind=0,this.id=e,this.invariantId=t,this.model=n,this.elements=r,this.conformation=i,this.residueIndex=n.atomicHierarchy.residueAtomSegments.index,this.chainIndex=n.atomicHierarchy.chainAtomSegments.index,this.props=a}return e.prototype.getChild=function(t){return t.length===this.elements.length?this:new e(this.id,this.invariantId,this.model,t,this.conformation,r())},e.prototype.applyOperator=function(t,n,r){void 0===r&&(r=!1);var i=r?n:s.SymmetryOperator.compose(this.conformation.operator,n);return new e(t,this.invariantId,this.model,this.elements,s.SymmetryOperator.createMapping(i,this.model.atomicConformation,this.conformation.r),this.props)},Object.defineProperty(e.prototype,"lookup3d",{get:function(){if(this.props.lookup3d.ref)return this.props.lookup3d.ref;var e=this.model.atomicConformation,t=e.x,n=e.y,r=e.z;return this.props.lookup3d.ref=c.GridLookup3D({x:t,y:n,z:r,indices:this.elements}),this.props.lookup3d.ref},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"links",{get:function(){return this.props.links.ref?this.props.links.ref:(this.props.links.ref=l.computeIntraUnitBonds(this),this.props.links.ref)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rings",{get:function(){return this.props.rings.ref?this.props.rings.ref:(this.props.rings.ref=d.UnitRings.create(this),this.props.rings.ref)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"polymerElements",{get:function(){return this.props.polymerElements.ref?this.props.polymerElements.ref:(this.props.polymerElements.ref=m.getAtomicPolymerElements(this),this.props.polymerElements.ref)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"gapElements",{get:function(){return this.props.gapElements.ref?this.props.gapElements.ref:(this.props.gapElements.ref=m.getAtomicGapElements(this),this.props.gapElements.ref)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nucleotideElements",{get:function(){return this.props.nucleotideElements.ref?this.props.nucleotideElements.ref:(this.props.nucleotideElements.ref=y.getNucleotideElements(this),this.props.nucleotideElements.ref)},enumerable:!0,configurable:!0}),e.prototype.getResidueIndex=function(e){return this.model.atomicHierarchy.residueAtomSegments.index[this.elements[e]]},e.prototype.computeGaussianDensity=function(e,t,n){return a(this,void 0,void 0,function(){return o(this,function(r){return[2,v.computeUnitGaussianDensityCached(this,e,this.props.gaussianDensities,t,n)]})})},e}();function r(){return{lookup3d:f.ValueRef.create(void 0),links:f.ValueRef.create(void 0),rings:f.ValueRef.create(void 0),polymerElements:f.ValueRef.create(void 0),gapElements:f.ValueRef.create(void 0),nucleotideElements:f.ValueRef.create(void 0),gaussianDensities:new Map}}e.Atomic=n;var u=function(){function e(e,t,n,r,i,a,o){this.kind=r,this.id=e,this.invariantId=t,this.model=n,this.elements=i,this.conformation=a,this.coarseElements=1===r?n.coarseHierarchy.spheres:n.coarseHierarchy.gaussians,this.coarseConformation=1===r?n.coarseConformation.spheres:n.coarseConformation.gaussians,this.props=o}return e.prototype.getChild=function(e){return e.length===this.elements.length?this:g(this.id,this.invariantId,this.model,this.kind,e,this.conformation,b())},e.prototype.applyOperator=function(e,t,n){void 0===n&&(n=!1);var r=n?t:s.SymmetryOperator.compose(this.conformation.operator,t);return g(e,this.invariantId,this.model,this.kind,this.elements,s.SymmetryOperator.createMapping(r,this.getCoarseConformation(),this.conformation.r),this.props)},Object.defineProperty(e.prototype,"lookup3d",{get:function(){if(this.props.lookup3d.ref)return this.props.lookup3d.ref;var e=this.getCoarseConformation(),t=e.x,n=e.y,r=e.z;return this.props.lookup3d.ref=c.GridLookup3D({x:t,y:n,z:r,indices:this.elements}),this.props.lookup3d.ref},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"polymerElements",{get:function(){return this.props.polymerElements.ref?this.props.polymerElements.ref:(this.props.polymerElements.ref=m.getCoarsePolymerElements(this),this.props.polymerElements.ref)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"gapElements",{get:function(){return this.props.gapElements.ref?this.props.gapElements.ref:(this.props.gapElements.ref=m.getCoarseGapElements(this),this.props.gapElements.ref)},enumerable:!0,configurable:!0}),e.prototype.getCoarseConformation=function(){return 1===this.kind?this.model.coarseConformation.spheres:this.model.coarseConformation.gaussians},e.prototype.computeGaussianDensity=function(e,t,n){return a(this,void 0,void 0,function(){return o(this,function(r){return[2,v.computeUnitGaussianDensityCached(this,e,this.props.gaussianDensities,t,n)]})})},e}();function b(){return{lookup3d:f.ValueRef.create(void 0),gaussianDensities:new Map,polymerElements:f.ValueRef.create(void 0),gapElements:f.ValueRef.create(void 0)}}function g(e,t,n,r,i,a,o){return new u(e,t,n,r,i,a,o)}var _=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t}(u);e.Spheres=_;var S=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t}(u);e.Gaussians=S}(u||(u={})),t.default=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(34),i=n(379),a=n(382),o=n(383),u=n(384),s=n(385),c=n(386),l=n(387),f=r.idFactory(0,2147483647);t.createRenderObject=function(e,t,n){return{id:f(),type:e,values:t,state:n}},t.createRenderable=function(e,t){switch(t.type){case"mesh":return o.MeshRenderable(e,t.id,t.values,t.state);case"points":return u.PointsRenderable(e,t.id,t.values,t.state);case"spheres":return c.SpheresRenderable(e,t.id,t.values,t.state);case"text":return l.TextRenderable(e,t.id,t.values,t.state);case"lines":return s.LinesRenderable(e,t.id,t.values,t.state);case"direct-volume":return a.DirectVolumeRenderable(e,t.id,t.values,t.state);case"gaussian-density":return i.GaussianDensityRenderable(e,t.id,t.values,t.state)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(7),i=n(34).idFactory();t.createRenderable=function(e,t,n){return{id:i(),values:t,state:n,render:function(i){t.uPickable&&r.ValueCell.updateIfChanged(t.uPickable,n.pickable?1:0),e.render(i)},getProgram:function(t){return e.getProgram(t)},update:function(){return e.update()},dispose:function(){return e.destroy()}}}},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(380),a=n(139),o=n(69),u=n(34),s=n(381),c=n(7),l=u.idFactory();function f(e,t){var n=e.gl;switch(t){case"points":return n.POINTS;case"lines":return n.LINES;case"line-strip":return n.LINE_STRIP;case"line-loop":return n.LINE_LOOP;case"triangles":return n.TRIANGLES;case"triangle-strip":return n.TRIANGLE_STRIP;case"triangle-fan":return n.TRIANGLE_FAN}}t.getDrawMode=f;var d={draw:{},pickObject:{dColorType:c.ValueCell.create("objectPicking")},pickInstance:{dColorType:c.ValueCell.create("instancePicking")},pickGroup:{dColorType:c.ValueCell.create("groupPicking")}};t.createRenderItem=function(e,t,n,u,c){var p=l(),h=e.programCache,m=e.extensions,y=m.instancedArrays,v=m.vertexArrayObject,b=o.splitValues(u,c),g=b.attributeValues,_=b.defineValues,S=b.textureValues,C=b.uniformValues,x=o.splitKeys(u),w=x.attributeKeys,P=x.defineKeys,T=x.textureKeys,A=o.getValueVersions(c),E=f(e,t),k={};Object.keys(d).forEach(function(t){var i=d[t];k[t]=h.get(e,{defineValues:r({},_,i),shaderCode:n,schema:u})});var I,M=a.createTextures(e,u,S),V=i.createAttributeBuffers(e,u,g),O=c.elements;O&&O.ref.value&&(I=i.createElementsBuffer(e,O.ref.value));var D={};Object.keys(d).forEach(function(t){D[t]=s.createVertexArray(e,k[t].value,V,I)});var R=c.drawCount.ref.value,j=c.instanceCount.ref.value;e.drawCount+=R,e.instanceCount+=j,e.instancedDrawCount+=j*R;var N={attributes:!1,defines:!1,elements:!1,textures:!1,uniforms:!1},B=!1;return{id:p,getProgram:function(e){return k[e].value},render:function(e){if(0!==R&&0!==j){var t=k[e].value,n=D[e];t.setUniforms(C),v&&n?(v.bindVertexArray(n),I&&I.bind()):(I&&I.bind(),t.bindAttributes(V)),t.bindTextures(M),I?y.drawElementsInstanced(E,R,I._dataType,0,j):y.drawArraysInstanced(E,0,R,j)}},update:function(){!function(e){e.attributes=!1,e.defines=!1,e.elements=!1,e.textures=!1,e.uniforms=!1}(N);for(var t=0,a=P.length;t<a;++t){var o=P[t];(y=_[o]).ref.version!==A[o]&&(N.defines=!0,A[o]=y.ref.version)}for(N.defines&&Object.keys(d).forEach(function(t){var i=d[t];k[t].free(),k[t]=h.get(e,{defineValues:r({},_,i),shaderCode:n,schema:u})}),c.drawCount.ref.version!==A.drawCount&&(e.drawCount+=c.drawCount.ref.value-R,e.instancedDrawCount+=j*c.drawCount.ref.value-j*R,R=c.drawCount.ref.value,A.drawCount=c.drawCount.ref.version),c.instanceCount.ref.version!==A.instanceCount&&(e.instanceCount+=c.instanceCount.ref.value-j,e.instancedDrawCount+=c.instanceCount.ref.value*R-j*R,j=c.instanceCount.ref.value,A.instanceCount=c.instanceCount.ref.version),t=0,a=w.length;t<a;++t)if(o=w[t],(y=g[o]).ref.version!==A[o]){var s=V[o];if(s.length>=y.ref.value.length)s.updateData(y.ref.value);else{s.destroy();var l=u[o],f=l.itemSize,p=l.divisor;V[o]=i.createAttributeBuffer(e,y.ref.value,f,p),N.attributes=!0}A[o]=y.ref.version}if(I&&c.elements.ref.version!==A.elements&&(I.length>=c.elements.ref.value.length?I.updateData(c.elements.ref.value):(I.destroy(),I=i.createElementsBuffer(e,c.elements.ref.value),N.elements=!0),A.elements=c.elements.ref.version),N.attributes||N.defines||N.elements){var m=e.extensions.vertexArrayObject;m&&Object.keys(d).forEach(function(e){m.bindVertexArray(D[e]),I&&(N.defines||N.elements)&&I.bind(),(N.attributes||N.defines)&&k[e].value.bindAttributes(V),m.bindVertexArray(null)})}for(t=0,a=T.length;t<a;++t){var y;o=T[t],(y=S[o]).ref.version!==A[o]&&"texture"!==u[o].kind&&(M[o].load(y.ref.value),A[o]=y.ref.version,N.textures=!0)}return N},destroy:function(){B||(Object.keys(d).forEach(function(t){k[t].free(),s.deleteVertexArray(e,D[t])}),Object.keys(M).forEach(function(e){"texture"!==u[e].kind&&M[e].destroy()}),Object.keys(V).forEach(function(e){return V[e].destroy()}),I&&I.destroy(),B=!0)}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(7),i=n(2),a=n(142);function o(e,t,n){if(n){r.ValueCell.update(n.matrix,n.matrix.ref.value),r.ValueCell.update(n.transform,e),r.ValueCell.update(n.uInstanceCount,t),r.ValueCell.update(n.instanceCount,t);var o=n.aTransform.ref.value.length>=16*t?n.aTransform.ref.value:new Float32Array(16*t);o.set(e),r.ValueCell.update(n.aTransform,o);var u=n.extraTransform.ref.value.length>=16*t?n.extraTransform.ref.value:new Float32Array(16*t);r.ValueCell.update(n.extraTransform,s(u,t));var l=n.aInstance.ref.value.length>=t?n.aInstance.ref.value:new Float32Array(t);return r.ValueCell.update(n.aInstance,a.fillSerial(l,t)),c(n),n}return{aTransform:r.ValueCell.create(new Float32Array(e)),matrix:r.ValueCell.create(i.Mat4.identity()),transform:r.ValueCell.create(e),extraTransform:r.ValueCell.create(s(new Float32Array(16*t),t)),uInstanceCount:r.ValueCell.create(t),instanceCount:r.ValueCell.create(t),aInstance:r.ValueCell.create(a.fillSerial(new Float32Array(t)))}}t.createTransform=o;var u=new Float32Array(16);function s(e,t){for(var n=0;n<t;n++)e.set(u,16*n);return e}function c(e){for(var t=e.aTransform.ref.value,n=e.instanceCount.ref.value,a=e.matrix.ref.value,o=e.transform.ref.value,u=e.extraTransform.ref.value,s=0;s<n;s++){var c=16*s;i.Mat4.mulOffset(t,u,o,c,c,c),i.Mat4.mulOffset(t,a,t,c,0,c)}r.ValueCell.update(e.aTransform,t)}i.Mat4.toArray(i.Mat4.identity(),u,0),t.createIdentityTransform=function(e){return o(new Float32Array(u),1,e)},t.fillIdentityTransform=s,t.updateTransformData=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),i=r.Vec3.zero(),a=r.Vec3.zero(),o=r.Vec3.zero();t.createPrimitive=function(e,t){for(var n=t.length,u=s(n/3),c=0;c<n;c+=3)r.Vec3.fromArray(i,e,3*t[c]),r.Vec3.fromArray(a,e,3*t[c+1]),r.Vec3.fromArray(o,e,3*t[c+2]),u.add(i,a,o);return u.getPrimitive()};var u=r.Vec3.zero();function s(e){var t=new Float32Array(3*e*3),n=new Float32Array(3*e*3),i=new Uint32Array(3*e),a=0;return{add:function(e,o,s){r.Vec3.toArray(e,t,a),r.Vec3.toArray(o,t,a+3),r.Vec3.toArray(s,t,a+6),r.Vec3.triangleNormal(u,e,o,s);for(var c=0;c<3;++c)r.Vec3.toArray(u,n,a+3*c),i[a/3+c]=a/3+c;a+=9},getPrimitive:function(){return{vertices:t,normals:n,indices:i}}}}t.PrimitiveBuilder=s},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{s(r.next(e))}catch(e){a(e)}}function u(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,u)}s((r=r.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(9),u=n(11),s=n(16),c=n(38),l=n(53),f=n(3),d=n(60),p=n(39);t.UnitsParams=r({},c.StructureParams,{unitKinds:f.ParamDefinition.MultiSelect(["atomic","spheres"],d.UnitKindOptions)}),t.UnitsRepresentation=function(e,t,n,r){var d,h,m,y,v=0,b=new p.Subject,g=[],_=c.StructureRepresentationStateBuilder.create(),S=new Map,C=l.createEmptyTheme();return{label:e,get groupCount(){var e=0;return S.forEach(function(t){var n=t.visual;n.renderObject&&(e+=n.groupCount)}),e},get props(){return y},get params(){return m},get state(){return _},get theme(){return C},renderObjects:g,updated:b,createOrUpdate:function(e,s){var c=this;return void 0===e&&(e={}),s&&s!==d&&(m=n(t,s),y||(y=f.ParamDefinition.getDefaultValues(m))),y=Object.assign({},y,e),u.Task.create("Creating or updating UnitsRepresentation",function(e){return i(c,void 0,void 0,function(){var n,i,u,c,l,f,p,m;return a(this,function(a){switch(a.label){case 0:if(d||s)return[3,1];throw new Error("missing structure");case 1:if(!s||d)return[3,8];h=s.unitSymmetryGroups,l=0,a.label=2;case 2:return l<h.length?(i=h[l],p=r(),(m=p.createOrUpdate({webgl:t.webgl,runtime:e},C,y,{group:i,structure:s}))?[4,m]:[3,4]):[3,7];case 3:a.sent(),a.label=4;case 4:return S.set(i.hashCode,{visual:p,group:i}),e.shouldUpdate?[4,e.update({message:"Creating or updating UnitsVisual",current:l,max:h.length})]:[3,6];case 5:a.sent(),a.label=6;case 6:return l++,[3,2];case 7:return[3,34];case 8:if(!s||o.Structure.areEquivalent(s,d))return[3,19];h=s.unitSymmetryGroups,n=S,S=new Map,l=0,a.label=9;case 9:return l<h.length?(i=h[l],(u=n.get(i.hashCode))?(p=u.visual,(m=p.createOrUpdate({webgl:t.webgl,runtime:e},C,y,{group:i,structure:s}))?[4,m]:[3,11]):[3,12]):[3,18];case 10:a.sent(),a.label=11;case 11:return S.set(i.hashCode,{visual:p,group:i}),n.delete(i.hashCode),[3,15];case 12:return p=r(),(m=p.createOrUpdate({webgl:t.webgl,runtime:e},C,y,{group:i,structure:s}))?[4,m]:[3,14];case 13:a.sent(),a.label=14;case 14:S.set(i.hashCode,{visual:p,group:i}),a.label=15;case 15:return e.shouldUpdate?[4,e.update({message:"Creating or updating UnitsVisual",current:l,max:h.length})]:[3,17];case 16:a.sent(),a.label=17;case 17:return l++,[3,9];case 18:return n.forEach(function(e){e.visual.destroy()}),[3,34];case 19:if(!s||s===d||!o.Structure.areEquivalent(s,d))return[3,28];h=s.unitSymmetryGroups,l=0,a.label=20;case 20:return l<h.length?(i=h[l],(u=S.get(i.hashCode))?(m=u.visual.createOrUpdate({webgl:t.webgl,runtime:e},C,y,{group:i,structure:s}))?[4,m]:[3,22]:[3,23]):[3,27];case 21:a.sent(),a.label=22;case 22:return u.group=i,[3,24];case 23:throw new Error("expected to find visual for hashCode "+i.hashCode);case 24:return e.shouldUpdate?[4,e.update({message:"Creating or updating UnitsVisual",current:l,max:h.length})]:[3,26];case 25:a.sent(),a.label=26;case 26:return l++,[3,20];case 27:return[3,34];case 28:c=[],S.forEach(function(e){var t=e.visual,n=e.group;return c.push([t,n])}),l=0,f=c.length,a.label=29;case 29:return l<f?(p=c[l][0],(m=p.createOrUpdate({webgl:t.webgl,runtime:e},C,y))?[4,m]:[3,31]):[3,34];case 30:a.sent(),a.label=31;case 31:return e.shouldUpdate?[4,e.update({message:"Creating or updating UnitsVisual",current:l,max:f})]:[3,33];case 32:a.sent(),a.label=33;case 33:return++l,[3,29];case 34:return g.length=0,S.forEach(function(e){var t=e.visual;t.renderObject&&g.push(t.renderObject)}),s&&(d=s),b.next(v++),[2]}})})})},setState:function(e){var t=e.visible,n=e.pickable,r=e.transform,i=e.unitTransforms;void 0!==t&&S.forEach(function(e){return e.visual.setVisibility(t)}),void 0!==n&&S.forEach(function(e){return e.visual.setPickable(n)}),void 0!==r&&S.forEach(function(e){return e.visual.setTransform(r)}),void 0!==i&&S.forEach(function(e){var t=e.visual,n=e.group;i?t.setTransform(void 0,i.getSymmetryGroupTransforms(n)):t.setTransform(void 0,null)}),c.StructureRepresentationStateBuilder.update(_,e)},setTheme:function(e){C=e},getLoci:function(e){var t=s.EmptyLoci;return S.forEach(function(n){var r=n.visual.getLoci(e);s.isEmptyLoci(r)||(t=r)}),t},mark:function(e,t){var n=!1;return S.forEach(function(r){var i=r.visual;n=i.mark(e,t)||n}),n},destroy:function(){S.forEach(function(e){return e.visual.destroy()}),S.clear()}}}},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),a=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{s(r.next(e))}catch(e){a(e)}}function u(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,u)}s((r=r.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}};Object.defineProperty(t,"__esModule",{value:!0});var u,s=n(26),c=n(27),l=n(11),f=n(3),d=n(7);!function(e){var t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t}(s.PluginStateObject.Create({name:"Root",typeClass:"Root"}));e.Root=t;var n=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t}(s.PluginStateObject.Create({name:"Category",typeClass:"Object"}));e.Category=n;var r=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t}(s.PluginStateObject.CreateBehavior({name:"Behavior"}));e.Behavior=r,e.Categories={common:"Common",representation:"Representation",interaction:"Interaction","custom-props":"Custom Properties",misc:"Miscellaneous"},e.CreateCategory=s.PluginStateTransform.BuiltIn({name:"create-behavior-category",display:{name:"Behavior Category"},from:t,to:n,params:{label:f.ParamDefinition.Text("",{isHidden:!0})}})({apply:function(e){var t=e.params;return new n({},{label:t.label})}});var u=new Map;e.getCategoryId=function(e){return u.get(e.id)},e.create=function(e){var n=s.PluginStateTransform.CreateBuiltIn({name:e.name,display:e.display,from:[t],to:[r],params:e.params,apply:function(t,n){var i=t.params,a=e.label?e.label(i):{label:e.display.name,description:e.display.description};return new r(new e.ctor(n,i),a)},update:function(e){var t=this,n=e.b,r=e.newParams;return l.Task.create("Update Behavior",function(){return a(t,void 0,void 0,function(){return o(this,function(e){switch(e.label){case 0:return n.data.update?[4,n.data.update(r)]:[2,c.StateTransformer.UpdateResult.Unchanged];case 1:return[2,e.sent()?c.StateTransformer.UpdateResult.Updated:c.StateTransformer.UpdateResult.Unchanged]}})})})},canAutoUpdate:e.canAutoUpdate});return u.set(n.id,e.category),n},e.simpleCommandHandler=function(e,t){return function(){function n(e){this.ctx=e,this.sub=void 0}return n.prototype.register=function(){var n=this;this.sub=e.subscribe(this.ctx,function(e){return t(e,n.ctx)})},n.prototype.unregister=function(){this.sub&&this.sub.unsubscribe(),this.sub=void 0},n}()};var p=function(){function e(e,t){this.ctx=e,this.params=t,this.subs=[]}return e.prototype.subscribeCommand=function(e,t){this.subs.push(e.subscribe(this.ctx,t))},e.prototype.subscribeObservable=function(e,t){this.subs.push(e.subscribe(t))},e.prototype.track=function(e){this.subs.push(e)},e.prototype.unregister=function(){for(var e=0,t=this.subs;e<t.length;e++){t[e].unsubscribe()}this.subs=[]},e.prototype.update=function(e){return!d.shallowEqual(e,this.params)&&(this.params=e,!0)},e}();e.Handler=p}(u||(u={})),t.PluginBehavior=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(511))},function(e,t,n){"use strict";n.d(t,"a",function(){return i}),n.d(t,"b",function(){return a});var r=n(33);function i(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return a(e)}function a(e){return e?1===e.length?e[0]:function(t){return e.reduce(function(e,t){return t(e)},t)}:r.a}},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var r="function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random()},function(e,t,n){"use strict";function r(e){return Error.call(this),this.message=e?e.length+" errors occurred during unsubscription:\n"+e.map(function(e,t){return t+1+") "+e.toString()}).join("\n  "):"",this.name="UnsubscriptionError",this.errors=e,this}n.d(t,"a",function(){return i}),r.prototype=Object.create(Error.prototype);var i=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(218);t.Mat4=r.default;var i=n(219);t.Mat3=i.default;var a=n(302);t.Vec2=a.default;var o=n(180);t.Vec3=o.default;var u=n(303);t.Vec4=u.default;var s=n(304);t.Quat=s.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(5);!function(e){e.ofSortedRanges=function(e){return i.SortedArray.ofSortedArray(e)},e.start=function(e){return e[0]},e.end=function(e){return e[e.length-1]+1},e.min=function(e){return e[0]},e.max=function(e){return e[e.length-1]},e.size=function(e){for(var t=0,n=0,r=e.length;n<r;n+=2)t+=e[n+1]-e[n]+1;return t},e.transientSegments=function(e,n){return new t(e,n)};var t=function(){function e(e,t){this.ranges=e,this.set=t,this.value={index:0,start:0,end:0},this.curIndex=0,this.maxIndex=0,this.curMin=0,this.hasNext=!1;var n=i.SortedArray.findPredecessorIndex(this.ranges,i.OrderedSet.min(t)),r=i.SortedArray.findPredecessorIndex(this.ranges,i.OrderedSet.max(t)+1);e.length&&n!==r&&(this.curIndex=this.getRangeIndex(i.OrderedSet.min(t)),this.maxIndex=Math.min(e.length-2,this.getRangeIndex(i.OrderedSet.max(t))),this.curMin=this.ranges[this.curIndex],this.updateInterval()),this.hasNext=e.length>0&&n!==r&&this.curIndex<=this.maxIndex}return e.prototype.updateInterval=function(){this.interval=i.Interval.ofRange(this.ranges[this.curIndex],this.ranges[this.curIndex+1])},e.prototype.updateValue=function(){this.value.index=this.curIndex/2,this.value.start=i.OrderedSet.findPredecessorIndex(this.set,this.ranges[this.curIndex]),this.value.end=i.OrderedSet.findPredecessorIndex(this.set,this.ranges[this.curIndex+1])+1},e.prototype.move=function(){if(this.hasNext){for(this.updateValue();this.curIndex<=this.maxIndex&&(this.curIndex+=2,this.curMin=i.Interval.end(this.interval),this.updateInterval(),!(i.Interval.min(this.interval)>=this.curMin&&i.OrderedSet.areIntersecting(this.interval,this.set))););this.hasNext=this.curIndex<=this.maxIndex}return this.value},e.prototype.getRangeIndex=function(e){var t=i.SortedArray.findPredecessorIndex(this.ranges,e);return t%2==1?t-1:t},e}();e.Iterator=t}(r||(r={})),t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(5),i=n(45),a=n(135),o=n(17),u=n(116),s=n(78),c=n(389),l=n(391),f=n(117),d=n(398),p=n(140),h=n(252),m=n(402),y=n(2),v=n(34),b=n(19),g=function(){function e(e){this._props={hashCode:-1,transformHash:-1,elementCount:0,polymerResidueCount:0};for(var t=r.IntMap.Mutable(),n=0,i=0,a=!0,u=e.length>0?e[0].id:0,s=0,c=e.length;s<c;s++){var l=e[s];t.set(l.id,l),n+=l.elements.length,i+=l.polymerElements.length,l.id<u&&(a=!1),u=l.id}a||o.sort(e,0,e.length,_,o.arraySwap),this.unitMap=t,this.units=e,this._props.elementCount=n,this._props.polymerResidueCount=i}return e.prototype.subsetBuilder=function(e){return new l.StructureSubsetBuilder(this,e)},Object.defineProperty(e.prototype,"elementCount",{get:function(){return this._props.elementCount},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"polymerResidueCount",{get:function(){return this._props.polymerResidueCount},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isCoarse",{get:function(){var e=this.elementCount,t=this.polymerResidueCount;return!(!t||!e)&&e/t<2},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isEmpty",{get:function(){return 0===this.units.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hashCode",{get:function(){return-1!==this._props.hashCode?this._props.hashCode:this.computeHash()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"transformHash",{get:function(){return-1!==this._props.transformHash?this._props.transformHash:(this._props.transformHash=o.hashFnv32a(this.units.map(function(e){return e.id})),this._props.transformHash)},enumerable:!0,configurable:!0}),e.prototype.computeHash=function(){for(var e=23,t=0,n=this.units.length;t<n;t++){var i=this.units[t];e=31*(e=31*e+i.id|0)+r.SortedArray.hashCode(i.elements)|0}return e=31*e+this.elementCount|0,-1===(e=o.hash1(e))&&(e=0),this._props.hashCode=e,e},e.prototype.elementLocations=function(){return new e.ElementLocationIterator(this)},Object.defineProperty(e.prototype,"boundary",{get:function(){return this.lookup3d.boundary},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lookup3d",{get:function(){return this._props.lookup3d?this._props.lookup3d:(this._props.lookup3d=new c.StructureLookup3D(this),this._props.lookup3d)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"links",{get:function(){return this._props.links?this._props.links:(this._props.links=f.computeInterUnitBonds(this),this._props.links)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"crossLinkRestraints",{get:function(){return this._props.crossLinkRestraints?this._props.crossLinkRestraints:(this._props.crossLinkRestraints=d.extractCrossLinkRestraints(this),this._props.crossLinkRestraints)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"unitSymmetryGroups",{get:function(){return this._props.unitSymmetryGroups?this._props.unitSymmetryGroups:(this._props.unitSymmetryGroups=p.default.computeTransformGroups(this),this._props.unitSymmetryGroups)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"carbohydrates",{get:function(){return this._props.carbohydrates?this._props.carbohydrates:(this._props.carbohydrates=m.computeCarbohydrates(this),this._props.carbohydrates)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"models",{get:function(){return this._props.models?this._props.models:(this._props.models=function(e){for(var t=e.units,n=i.UniqueArray.create(),r=0,a=t;r<a.length;r++){var o=a[r];i.UniqueArray.add(n,o.model.id,o.model)}return n.array}(this),this._props.models)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"uniqueResidueNames",{get:function(){return this._props.uniqueResidueNames||(this._props.uniqueResidueNames=function(e){for(var t=h.default.residue.label_comp_id,n=new Set,i=u.default.create(),a=0,o=e.units;a<o.length;a++){var c=o[a];if(s.default.isAtomic(c)){var l=r.Segmentation.transientSegments(c.model.atomicHierarchy.residueAtomSegments,c.elements);for(i.unit=c;l.hasNext;){var f=l.move();i.element=c.elements[f.start],n.add(t(i))}}}return n}(this))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"entityIndices",{get:function(){return this._props.entityIndices||(this._props.entityIndices=function(e){for(var t=e.units,n=u.default.create(),a=i.UniqueArray.create(),s=0,c=t;s<c.length;s++){var l=c[s],f=0===l.kind?h.default.entity.key:h.default.coarse.entityKey;n.unit=l;for(var d=l.elements,p=r.Segmentation.transientSegments(l.model.atomicHierarchy.chainAtomSegments,d);p.hasNext;){var m=p.move();n.element=d[m.start];var y=f(n);i.UniqueArray.add(a,y,y)}}return o.sortArray(a.array),a.array}(this))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"uniqueAtomicResidueIndices",{get:function(){return this._props.uniqueAtomicResidueIndices||(this._props.uniqueAtomicResidueIndices=function(e){for(var t=new Map,n=[],a=e.unitSymmetryGroups,u=0,c=a;u<c.length;u++){var l=c[u],f=l.units[0];if(s.default.isAtomic(f)){var d=void 0;t.has(f.model.id)?d=t.get(f.model.id):(d=i.UniqueArray.create(),n.push(f.model.id),t.set(f.model.id,d));for(var p=r.Segmentation.transientSegments(f.model.atomicHierarchy.residueAtomSegments,f.elements);p.hasNext;){var h=p.move();i.UniqueArray.add(d,h.index,h.index)}}}for(var m=new Map,y=0,v=n;y<v.length;y++){var b=v[y],g=t.get(b).array;o.sortArray(g),m.set(b,g)}return m}(this))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"model",{get:function(){if(this._props.model)return this._props.model;var e=this.models;if(e.length>1)throw new Error("The structre is based on multiple models.");return this._props.model=e[0],this._props.model},enumerable:!0,configurable:!0}),e.prototype.hasElement=function(e){return!!this.unitMap.has(e.unit.id)&&r.SortedArray.has(this.unitMap.get(e.unit.id).elements,e.element)},e}();function _(e,t,n){return e[t].id-e[n].id}!function(e){function t(t){return new e(t)}function n(e,t,n){var r=e.atomicHierarchy.index.getEntityFromChain(t);return"water"===e.entities.data.type.value(r)}function i(e,t,n){for(var i=e.atomicConformation,o=i.x,u=i.y,s=i.z,c=b.GridLookup3D({x:o,y:u,z:s,indices:t},y.Vec3.create(64,64,64)).buckets,l=c.offset,f=c.count,d=c.array,p=0,h=l.length;p<h;p++){for(var m=l[p],v=new Int32Array(f[p]),g=0,_=f[p];g<_;g++)v[g]=t[d[m+g]];n.addUnit(0,e,a.SymmetryOperator.Default,r.SortedArray.ofSortedArray(v))}}function c(e,t,n,i){for(var o=n.chainElementSegments,u=0;u<o.count;u++){var s=r.SortedArray.ofBounds(o.offsets[u],o.offsets[u+1]);e.addUnit(i,t,a.SymmetryOperator.Default,s)}}e.Empty=new e([]),e.Loci=function(e){return{kind:"structure-loci",structure:e}},e.isLoci=function(e){return!!e&&"structure-loci"===e.kind},e.areLociEqual=function(e,t){return e.structure===t.structure},e.create=t,e.ofModel=function(e){for(var t=e.atomicHierarchy.chainAtomSegments,o=new l,u=0;u<t.count;u++){for(var s=t.offsets[u];u+1<t.count&&t.offsets[u+1]-t.offsets[u]==1&&t.offsets[u+2]-t.offsets[u+1]==1;)u++;var f=r.SortedArray.ofBounds(s,t.offsets[u+1]);n(e,u,f)?i(e,f,o):o.addUnit(0,e,a.SymmetryOperator.Default,f)}var d=e.coarseHierarchy;return d.isDefined&&(d.spheres.count>0&&c(o,e,e.coarseHierarchy.spheres,1),d.gaussians.count>0&&c(o,e,e.coarseHierarchy.gaussians,2)),o.getStructure()},e.transform=function(t,n){if(y.Mat4.isIdentity(n))return t;if(!y.Mat4.isRotationAndTranslation(n))throw new Error("Only rotation/translation combination can be applied.");for(var r=[],i=0,o=t.units;i<o.length;i++){var u=o[i],s=u.conformation.operator,c=a.SymmetryOperator.create(s.name,n,{id:"",operList:[]},s.ncsId,s.hkl);r.push(u.applyOperator(u.id,c))}return new e(r)};var l=function(){function e(){this.units=[],this.invariantId=v.idFactory()}return e.prototype.addUnit=function(e,t,n,r){var i=s.default.create(this.units.length,this.invariantId(),e,t,n,r);return this.units.push(i),i},e.prototype.addWithOperator=function(e,t){var n=e.applyOperator(this.units.length,t);return this.units.push(n),n},e.prototype.getStructure=function(){return t(this.units)},Object.defineProperty(e.prototype,"isEmpty",{get:function(){return 0===this.units.length},enumerable:!0,configurable:!0}),e}();e.StructureBuilder=l,e.Builder=function(){return new l},e.hashCode=function(e){return e.hashCode},e.conformationHash=function(e){return o.hashString(e.units.map(function(e){return s.default.conformationId(e)}).join("|"))},e.areEqual=function(e,t){if(e.elementCount!==t.elementCount)return!1;var n=e.units.length;if(n!==t.units.length)return!1;for(var i=0;i<n;i++)if(e.units[i].id!==t.units[i].id)return!1;for(i=0;i<n;i++)if(!r.SortedArray.areEqual(e.units[i].elements,t.units[i].elements))return!1;return!0},e.areEquivalent=function(e,t){return e===t||e.hashCode===t.hashCode&&p.default.areTransformGroupsEquivalent(e.unitSymmetryGroups,t.unitSymmetryGroups)};var f=function(){function e(e){this.structure=e,this.current=u.default.create(),this.unitIndex=0,this.maxIdx=0,this.idx=-1,this.hasNext=e.elementCount>0,this.hasNext&&(this.elements=e.units[0].elements,this.maxIdx=this.elements.length-1,this.current.unit=e.units[0])}return e.prototype.move=function(){return this.advance(),this.current.element=this.elements[this.idx],this.current},e.prototype.advance=function(){if(this.idx<this.maxIdx)return this.idx++,void(this.idx===this.maxIdx&&(this.hasNext=this.unitIndex+1<this.structure.units.length));this.idx=0,this.unitIndex++,this.unitIndex>=this.structure.units.length?this.hasNext=!1:(this.current.unit=this.structure.units[this.unitIndex],this.elements=this.current.unit.elements,this.maxIdx=this.elements.length-1)},e}();e.ElementLocationIterator=f;var d=y.Vec3.zero();function h(e,t,n){for(var r=e.elements,i=e.conformation,a=i.position,o=i.r,u=d,s=Number.MAX_VALUE,c=0,l=r.length;c<l;c++){var f=r[c],p=y.Vec3.distance(t,a(f,u))-n-o(f);p<s&&(s=p)}return s}function m(e,t,n){for(var r=e.units,i=Number.MAX_VALUE,a=0,o=r.length;a<o;a++){var u=h(r[a],t,n);u<i&&(i=u)}return i}e.minDistanceToPoint=m;var g=y.Vec3.zero();e.distance=function(e,t){if(0===e.elementCount||0===t.elementCount)return 0;for(var n=e.units,r=Number.MAX_VALUE,i=0,a=n.length;i<a;i++)for(var o=n[i],u=o.elements,s=o.conformation,c=s.position,l=s.r,f=0,d=u.length;f<d;f++){var p=u[f],h=m(t,c(p,g),l(p));h<r&&(r=h)}return r}}(g||(g={})),t.default=g},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(45),a=n(43),o=n(141),u=n(5);!function(e){function t(e,t){return{kind:"singletons",source:e,structure:t}}function n(e,t){return{kind:"sequence",source:e,structures:t}}function r(e){return t(e,a.Structure.Empty)}function s(e){return"singletons"===e.kind}function c(e){return s(e)?0===e.structure.units.length:0===e.structures.length}function l(e){return c(e)?a.Structure.Empty:s(e)?e.structure:o.structureUnion(e.source,e.structures)}function f(e,i,a){return 0===i.length?r(e):a?t(e,o.structureUnion(e,i)):n(e,i)}e.Singletons=t,e.Sequence=n,e.Empty=r,e.isSingleton=s,e.isEmpty=c,e.structureCount=function(e){return s(e)?e.structure.elementCount:e.structures.length},e.unionStructure=l,e.toLoci=function(e){for(var t=[],n=e.source.unitMap,r=0,i=l(e).units;r<i.length;r++){var o=i[r];o===n.get(o.id)?t[t.length]={unit:o,indices:u.OrderedSet.ofBounds(0,o.elements.length)}:t[t.length]={unit:o,indices:u.OrderedSet.ofSortedArray(u.SortedArray.indicesOf(e.source.unitMap.get(o.id).elements,o.elements))}}return a.StructureElement.Loci(e.source,t)};var d=function(){function e(e){this.source=e,this.structures=[],this.allSingletons=!0}return e.prototype.add=function(e){var t=e.elementCount;0!==t&&(this.structures[this.structures.length]=e,1!==t&&(this.allSingletons=!1))},e.prototype.getSelection=function(){return f(this.source,this.structures,this.allSingletons)},e}(),p=function(){function e(e){this.structure=e,this.structures=[],this.allSingletons=!0,this.uniqueSets=i.HashSet(a.Structure.hashCode,a.Structure.areEqual)}return e.prototype.add=function(e){var t=e.elementCount;0!==t&&this.uniqueSets.add(e)&&(this.structures[this.structures.length]=e,1!==t&&(this.allSingletons=!1))},e.prototype.getSelection=function(){return f(this.structure,this.structures,this.allSingletons)},e}();e.LinearBuilder=function(e){return new d(e)},e.UniqueBuilder=function(e){return new p(e)},e.forEach=function(t,n){var r=0;if(e.isSingleton(t))for(var i=0,o=t.structure.units;i<o.length;i++)for(var s=o[i],c=s.elements,l=0,f=c.length;l<f;l++)n(a.Structure.create([s.getChild(u.SortedArray.ofSingleton(c[l]))]),r++);else for(var d=0,p=t.structures;d<p.length;d++)n(p[d],r++)},e.withInputStructure=function(e,r){return s(e)?t(r,e.structure):n(r,e.structures)}}(r||(r={})),t.StructureSelection=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(23),i=n(2),a=n(200);function o(e,t){var n=e.coarseElements.entityKey[t],r=e.model.sequence.byEntityKey[n],i=e.coarseElements.seq_id_begin.value(t);return r.compId.value(i-1)}t.getCoarseBegCompId=o,t.getElementMoleculeType=function(e,t){switch(e.kind){case 0:return e.model.atomicHierarchy.derived.residue.moleculeType[e.residueIndex[t]];case 1:case 2:var n=o(e,t),i=e.model.properties.chemicalComponentMap.get(n);if(i)return r.getMoleculeType(i.type,n)}return 0},t.getAtomicMoleculeType=function(e,t){return e.atomicHierarchy.derived.residue.moleculeType[t]},t.getAtomIdForAtomRole=function(e,t){var n=r.MoleculeTypeAtomRoleId[e];if(void 0!==n){var i=n[t];if(void 0!==i)return i}return""},t.residueLabel=function(e,t){var n=e.atomicHierarchy,r=n.residues,i=n.chains,a=n.residueAtomSegments,o=n.chainAtomSegments,u=r.label_comp_id,s=r.label_seq_id,c=i.label_asym_id,l=o.index[a.offsets[t]];return c.value(l)+" "+u.value(t)+" "+s.value(t)},t.elementLabel=function(e,t){var n=e.atomicHierarchy,r=n.atoms,i=n.residues,a=n.chains,o=n.residueAtomSegments,u=n.chainAtomSegments,s=r.label_atom_id,c=i.auth_seq_id,l=i.auth_comp_id,f=a.auth_asym_id,d=o.index[t],p=u.index[d];return"["+l.value(d)+"]"+c.value(d)+":"+f.value(p)+"."+s.value(t)};var u=i.Vec3.zero();t.getPositionMatrix=function(e,t){for(var n=e.conformation.position,r=a.default.create(3,t.length),o=e.elements,s=0,c=t.length;s<c;++s)n(o[t[s]],u),i.Vec3.toArray(u,r.data,3*s);return r}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2);function i(e){for(var t=e.length,n=0;n<t;n+=3){var r=e[n],i=e[n+1],a=e[n+2],o=1/Math.sqrt(r*r+i*i+a*a);e[n]=r*o,e[n+1]=i*o,e[n+2]=a*o}}t.normalizeVec3Array=i,t.getNormalMatrix=function(e,t){return r.Mat3.fromMat4(e,t),r.Mat3.invert(e,e),r.Mat3.transpose(e,e),e};var a=r.Vec3.zero();function o(e){for(var t=e.length,n=0;n<t;++n)e[n]=0}t.transformPositionArray=function(e,t,n,i){for(var o=0,u=3*i;o<u;o+=3)r.Vec3.fromArray(a,t,n+o),r.Vec3.transformMat4(a,a,e),r.Vec3.toArray(a,t,n+o)},t.transformDirectionArray=function(e,t,n,i){for(var o=0,u=3*i;o<u;o+=3)r.Vec3.fromArray(a,t,n+o),r.Vec3.transformMat3(a,a,e),r.Vec3.toArray(a,t,n+o)},t.setArrayZero=o,t.appplyRadius=function(e,t){for(var n=r.Vec3.zero(),i=e.length,a=0;a<i;a+=3)r.Vec3.fromArray(n,e,a),r.Vec3.normalize(n,n),r.Vec3.scale(n,n,t),r.Vec3.toArray(n,e,a)},t.computeIndexedVertexNormals=function(e,t,n){for(var a=r.Vec3.zero(),o=r.Vec3.zero(),u=r.Vec3.zero(),s=r.Vec3.zero(),c=r.Vec3.zero(),l=0,f=t.length;l<f;l+=3){var d=3*t[l],p=3*t[l+1],h=3*t[l+2];r.Vec3.fromArray(a,e,d),r.Vec3.fromArray(o,e,p),r.Vec3.fromArray(u,e,h),r.Vec3.sub(s,u,o),r.Vec3.sub(c,a,o),r.Vec3.cross(s,s,c),n[d]+=s[0],n[d+1]+=s[1],n[d+2]+=s[2],n[p]+=s[0],n[p+1]+=s[1],n[p+2]+=s[2],n[h]+=s[0],n[h+1]+=s[1],n[h+2]+=s[2]}return i(n),n},t.computeVertexNormals=function(e,t){o(t);for(var n=r.Vec3.zero(),a=r.Vec3.zero(),u=r.Vec3.zero(),s=r.Vec3.zero(),c=r.Vec3.zero(),l=0,f=e.length;l<f;l+=9)r.Vec3.fromArray(n,e,l),r.Vec3.fromArray(a,e,l+3),r.Vec3.fromArray(u,e,l+6),r.Vec3.sub(s,u,a),r.Vec3.sub(c,n,a),r.Vec3.cross(s,s,c),t[l]=s[0],t[l+1]=s[1],t[l+2]=s[2],t[l+3]=s[0],t[l+4]=s[1],t[l+5]=s[2],t[l+6]=s[0],t[l+7]=s[1],t[l+8]=s[2];return i(t),t}},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(7),a=n(19),o=n(3),u=n(2),s=n(205),c=n(414),l=n(58),f=n(51),d=n(95),p=n(52),h=n(50),m=n(59),y=s.Box(),v=[["isosurface","Isosurface"],["volume","Volume"]];!function(e){function t(e){return{}}function n(e,t,n,a,o){var s=e.gridTexture,d=e.gridTextureDim,p=e.bboxSize,h=e.bboxMin,v=e.bboxMax,b=e.gridDimension,g=e.transform,_=n.instanceCount,S=n.groupCount,x=l.createColors(n,a.color),w=f.createMarkers(_*S),P={drawCount:y.indices.length,groupCount:S,instanceCount:_},T=C(b.ref.value,g.ref.value,t.aTransform.ref.value,t.instanceCount.ref.value),A=T.boundingSphere,E=T.invariantBoundingSphere,k=c.getControlPointsFromVec2Array(o.controlPoints),I=c.createTransferFunctionTexture(k,o.list),M=2*Math.ceil(u.Vec3.magnitude(b.ref.value))*5;return r({},x,w,t,m.BaseGeometry.createValues(o,P),{aPosition:i.ValueCell.create(y.vertices),elements:i.ValueCell.create(y.indices),boundingSphere:i.ValueCell.create(A),invariantBoundingSphere:i.ValueCell.create(E),uIsoValue:i.ValueCell.create(o.isoValueNorm),uBboxMin:h,uBboxMax:v,uBboxSize:p,dMaxSteps:i.ValueCell.create(M),uTransform:g,uGridDim:b,dRenderMode:i.ValueCell.create(o.renderMode),tTransferTex:I,dGridTexType:i.ValueCell.create(s.ref.value.depth>0?"3d":"2d"),uGridTexDim:d,tGridTex:s})}e.create=function(e,t,n,r,a){var o=r.width,s=r.height,c=r.depth;return a?(i.ValueCell.update(a.gridDimension,t),i.ValueCell.update(a.gridTextureDim,u.Vec3.set(a.gridTextureDim.ref.value,o,s,c)),i.ValueCell.update(a.bboxMin,e.min),i.ValueCell.update(a.bboxMax,e.max),i.ValueCell.update(a.bboxSize,u.Vec3.sub(a.bboxSize.ref.value,e.max,e.min)),i.ValueCell.update(a.transform,n),a):{kind:"direct-volume",gridDimension:i.ValueCell.create(t),gridTexture:i.ValueCell.create(r),gridTextureDim:i.ValueCell.create(u.Vec3.create(o,s,c)),bboxMin:i.ValueCell.create(e.min),bboxMax:i.ValueCell.create(e.max),bboxSize:i.ValueCell.create(u.Vec3.sub(u.Vec3.zero(),e.max,e.min)),transform:i.ValueCell.create(n)}},e.createEmpty=t,e.Params=r({},m.BaseGeometry.Params,{isoValueNorm:o.ParamDefinition.Numeric(.22,{min:0,max:1,step:.01},{description:"Normalized Isolevel Value"}),renderMode:o.ParamDefinition.Select("volume",v),controlPoints:o.ParamDefinition.LineGraph([u.Vec2.create(.19,0),u.Vec2.create(.2,.05),u.Vec2.create(.25,.05),u.Vec2.create(.26,0),u.Vec2.create(.79,0),u.Vec2.create(.8,.05),u.Vec2.create(.85,.05),u.Vec2.create(.86,0)]),list:o.ParamDefinition.ColorScale("RedYellowBlue",h.ColorListOptions)}),e.Utils={Params:e.Params,createEmpty:t,createValues:n,createValuesSimple:function(t,i,a,u,s){var c=m.BaseGeometry.createSimple(a,u,s),l=r({},o.ParamDefinition.getDefaultValues(e.Params),i);return n(t,c.transform,c.locationIterator,c.theme,l)},updateValues:function(e,t){i.ValueCell.updateIfChanged(e.uIsoValue,t.isoValueNorm),i.ValueCell.updateIfChanged(e.uAlpha,t.alpha),i.ValueCell.updateIfChanged(e.dUseFog,t.useFog),i.ValueCell.updateIfChanged(e.dRenderMode,t.renderMode);var n=c.getControlPointsFromVec2Array(t.controlPoints);c.createTransferFunctionTexture(n,t.list,e.tTransferTex)},updateBoundingSphere:function(e,t){var n=C(e.uGridDim.ref.value,e.uTransform.ref.value,e.aTransform.ref.value,e.instanceCount.ref.value),r=n.boundingSphere,o=n.invariantBoundingSphere;a.Sphere3D.equals(r,e.boundingSphere.ref.value)||i.ValueCell.update(e.boundingSphere,r);a.Sphere3D.equals(o,e.invariantBoundingSphere.ref.value)||i.ValueCell.update(e.invariantBoundingSphere,o)},createRenderableState:function(e){var t=m.BaseGeometry.createRenderableState(e);return t.opaque=!1,t},updateRenderableState:function(e,t){m.BaseGeometry.updateRenderableState(e,t),e.opaque=!1}}}(t.DirectVolume||(t.DirectVolume={}));var b=u.Mat4.identity(),g=u.Mat4.identity(),_=u.Vec3.create(.5,.5,.5),S=new Float32Array(y.vertices.length);function C(e,t,n,r){return S.set(y.vertices),u.Mat4.fromTranslation(b,_),u.Mat4.mul(b,u.Mat4.fromScaling(g,e),b),u.Mat4.mul(b,t,b),d.transformPositionArray(b,S,0,S.length/3),p.calculateBoundingSphere(S,S.length/3,n,r)}},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0});var i=n(9),a=n(5),o=n(16),u=n(36),s=n(60);r(n(438)),r(n(439)),r(n(440)),r(n(441)),t.getPolymerRanges=function(e){switch(e.kind){case 0:return e.model.atomicHierarchy.polymerRanges;case 1:return e.model.coarseHierarchy.spheres.polymerRanges;case 2:return e.model.coarseHierarchy.gaussians.polymerRanges}},t.getGapRanges=function(e){switch(e.kind){case 0:return e.model.atomicHierarchy.gapRanges;case 1:return e.model.coarseHierarchy.spheres.gapRanges;case 2:return e.model.coarseHierarchy.gaussians.gapRanges}},function(e){e.fromGroup=function(e){var t=e.units[0].polymerElements,n=t.length,r=e.units.length,a=i.StructureElement.create();return u.LocationIterator(n,r,function(n,r){var i=e.units[r];return a.unit=i,a.element=t[n],a})}}(t.PolymerLocationIterator||(t.PolymerLocationIterator={})),function(e){e.fromGroup=function(e){var t=e.units[0].gapElements,n=t.length,r=e.units.length,a=i.StructureElement.create();return u.LocationIterator(n,r,function(n,r){var i=e.units[r];return a.unit=i,a.element=t[n],a})}}(t.PolymerGapLocationIterator||(t.PolymerGapLocationIterator={})),t.getPolymerElementLoci=function(e,t,n){var r=e.objectId,i=e.instanceId,a=e.groupId;if(n===r){var u=t.structure,c=t.group.units[i];return s.getResidueLoci(u,c,c.polymerElements[a])}return o.EmptyLoci},t.markPolymerElement=function(e,t,n){var r=!1;if(!i.StructureElement.isLoci(e))return!1;var o=t.structure,u=t.group;if(e.structure!==o)return!1;for(var s=u.units[0],c=s.polymerElements,l=s.model,f=s.elements,d=l.atomicHierarchy.residueAtomSegments,p=d.index,h=d.offsets,m=l.atomicHierarchy.derived.residue.traceElementIndex,y=c.length,v=function(e){var t=u.unitIndexMap.get(e.unit.id);void 0!==t&&a.OrderedSet.forEach(e.indices,function(i){var o=p[f[i]],u=a.OrderedSet.findPredecessorIndex(f,h[o]),s=a.OrderedSet.findPredecessorIndex(f,h[o+1]-1),c=a.Interval.ofRange(u,s);if(a.OrderedSet.isSubset(e.indices,c)){var l=m[o],d=a.OrderedSet.indexOf(e.unit.polymerElements,l);-1!==d&&n(a.Interval.ofSingleton(t*y+d))&&(r=!0)}})},b=0,g=e.elements;b<g.length;b++)v(g[b]);return r},t.getPolymerGapElementLoci=function(e,t,n){var r=e.objectId,u=e.instanceId,s=e.groupId;if(n===r){var c=t.structure,l=t.group.units[u],f=a.OrderedSet.indexOf(l.elements,l.gapElements[s]),d=a.OrderedSet.indexOf(l.elements,l.gapElements[s%2?s-1:s+1]);if(-1!==f&&-1!==d)return i.Link.Loci(c,[i.Link.Location(l,f,l,d),i.Link.Location(l,d,l,f)])}return o.EmptyLoci},t.markPolymerGapElement=function(e,t,n){var r=!1;if(!i.Link.isLoci(e))return!1;var o=t.structure,u=t.group;if(e.structure!==o)return!1;for(var s=u.units[0].gapElements.length,c=0,l=e.links;c<l.length;c++){var f=l[c],d=u.unitIndexMap.get(f.aUnit.id);if(void 0!==d){var p=a.OrderedSet.indexOf(f.aUnit.gapElements,f.aUnit.elements[f.aIndex]),h=a.OrderedSet.indexOf(f.bUnit.gapElements,f.bUnit.elements[f.bIndex]);-1!==p&&-1!==h&&n(a.Interval.ofSingleton(d*s+p))&&(r=!0)}}return r}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),i=n(23),a=n(9),o=n(3),u=n(29),s=n(54),c=n(146),l=n(36);t.LinkCylinderParams={linkScale:o.ParamDefinition.Numeric(.4,{min:0,max:1,step:.1}),linkSpacing:o.ParamDefinition.Numeric(1,{min:0,max:2,step:.01}),radialSegments:o.ParamDefinition.Numeric(16,{min:3,max:56,step:1})},t.DefaultLinkCylinderProps=o.ParamDefinition.getDefaultValues(t.LinkCylinderParams);var f=r.Vec3.zero(),d=r.Vec3.zero();function p(e,t,n,i){r.Vec3.normalize(f,r.Vec3.sub(f,t,n)),null!==i?r.Vec3.sub(d,t,i):r.Vec3.copy(d,t),r.Vec3.normalize(d,d);var a=r.Vec3.dot(f,d);return 1-Math.abs(a)<1e-5&&(r.Vec3.set(d,1,0,0),a=r.Vec3.dot(f,d),1-Math.abs(a)<1e-5&&(r.Vec3.set(d,0,1,0),a=r.Vec3.dot(f,d))),r.Vec3.setMagnitude(f,f,a),r.Vec3.sub(d,d,f),r.Vec3.normalize(e,d)}t.calculateShiftDir=p,t.createLinkCylinderMesh=function(e,t,n,a){var o=t.linkCount,l=t.referencePosition,f=t.position,d=t.order,h=t.flags,m=t.radius;if(!o)return u.Mesh.createEmpty(a);for(var y=n.linkScale,v=n.linkSpacing,b=n.radialSegments,g=2*b*o*2,_=s.MeshBuilder.createState(g,g/4,a),S=r.Vec3.zero(),C=r.Vec3.zero(),x=r.Vec3.zero(),w={radiusTop:1,radiusBottom:1,radialSegments:b},P=0,T=o;P<T;++P){f(S,C,P);var A=m(P),E=d(P),k=h(P);if(_.currentGroup=P,i.LinkType.is(k,2)||i.LinkType.is(k,4))w.radiusTop=w.radiusBottom=A/3,c.addFixedCountDashedCylinder(_,S,C,.5,7,w);else if(2===E||3===E){var I=A*(y/(.5*E)),M=(A-I)*v;p(x,S,C,l(P)),r.Vec3.setMagnitude(x,x,M),w.radiusTop=w.radiusBottom=I,3===E&&c.addCylinder(_,S,C,.5,w),c.addDoubleCylinder(_,S,C,.5,x,w)}else w.radiusTop=w.radiusBottom=A,c.addCylinder(_,S,C,.5,w)}return s.MeshBuilder.getMesh(_)},function(e){e.fromGroup=function(e){var t=e.units[0],n=a.Unit.isAtomic(t)?2*t.links.edgeCount:0,r=e.units.length,i=a.StructureElement.create();return l.LocationIterator(n,r,function(t,n){var r=e.units[n];return i.unit=r,i.element=r.elements[r.links.a[t]],i})},e.fromStructure=function(e){var t=e.links.bondCount,n=a.Link.Location();return l.LocationIterator(t,1,function(t){var r=e.links.bonds[t];return n.aUnit=r.unitA,n.aIndex=r.indexA,n.bUnit=r.unitB,n.bIndex=r.indexB,n},!0)}}(t.LinkIterator||(t.LinkIterator={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(39);!function(e){e.create=function(){var e=new a,t=function(){return e.create()};return t.dispose=function(){return e.dispose()},t.behavior=function(t){return e.behavior(t)},t}}(r||(r={})),t.RxEventHelper=r;var a=function(){function e(){this._eventList=[],this._disposed=!1}return e.prototype.create=function(){var e=new i.Subject;return this._eventList.push(e),e},e.prototype.behavior=function(e){var t=new i.BehaviorSubject(e);return this._eventList.push(t),t},e.prototype.dispose=function(){if(!this._disposed){for(var e=0,t=this._eventList;e<t.length;e++){t[e].complete()}this._disposed=!0}},e}()},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i,a=n(150),o=n(7);!function(e){function t(e,t,n,r){var i=r&&r.ref?r.ref:o.UUID.create22();return{parent:e,transformer:t,props:r&&r.props||{},ref:i,params:n,version:o.UUID.create22()}}function n(e){return e}e.RootRef="-=root=-",e.create=t,e.withParams=function(e,t){return r({},e,{params:t,version:o.UUID.create22()})},e.withParent=function(e,t){return r({},e,{parent:t,version:o.UUID.create22()})},e.withNewVersion=function(e){return r({},e,{version:o.UUID.create22()})},e.createRoot=function(n){return t(e.RootRef,a.StateTransformer.ROOT,{},{ref:e.RootRef,props:n})},e.toJSON=function(e){var t=e.transformer.definition.customSerialization?e.transformer.definition.customSerialization.toJSON:n;return{parent:e.parent,transformer:e.transformer.id,params:e.params?t(e.params):void 0,props:e.props,ref:e.ref,version:e.version}},e.fromJSON=function(e){var t=a.StateTransformer.get(e.transformer),r=t.definition.customSerialization?t.definition.customSerialization.toJSON:n;return{parent:e.parent,transformer:t,params:e.params?r(e.params):void 0,props:e.props,ref:e.ref,version:e.version}}}(i||(i={})),t.StateTransform=i},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var r=n(0),i=n(1);function a(){return function(e){return e.lift(new o(e))}}var o=function(){function e(e){this.connectable=e}return e.prototype.call=function(e,t){var n=this.connectable;n._refCount++;var r=new u(e,n),i=t.subscribe(r);return r.closed||(r.connection=n.connect()),i},e}(),u=function(e){function t(t,n){var r=e.call(this,t)||this;return r.connectable=n,r}return r.a(t,e),t.prototype._unsubscribe=function(){var e=this.connectable;if(e){this.connectable=null;var t=e._refCount;if(t<=0)this.connection=null;else if(e._refCount=t-1,t>1)this.connection=null;else{var n=this.connection,r=e._connection;this.connection=null,!r||n&&r!==n||r.unsubscribe()}}else this.connection=null},t}(i.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return l});var r=n(0),i=n(12),a=n(169),o=n(10),u=n(163),s=n(48),c=n(171),l=function(e){function t(t,n,r){void 0===t&&(t=Number.POSITIVE_INFINITY),void 0===n&&(n=Number.POSITIVE_INFINITY);var i=e.call(this)||this;return i.scheduler=r,i._events=[],i._infiniteTimeWindow=!1,i._bufferSize=t<1?1:t,i._windowTime=n<1?1:n,n===Number.POSITIVE_INFINITY?(i._infiniteTimeWindow=!0,i.next=i.nextInfiniteTimeWindow):i.next=i.nextTimeWindow,i}return r.a(t,e),t.prototype.nextInfiniteTimeWindow=function(t){var n=this._events;n.push(t),n.length>this._bufferSize&&n.shift(),e.prototype.next.call(this,t)},t.prototype.nextTimeWindow=function(t){this._events.push(new f(this._getNow(),t)),this._trimBufferThenGetEvents(),e.prototype.next.call(this,t)},t.prototype._subscribe=function(e){var t,n=this._infiniteTimeWindow,r=n?this._events:this._trimBufferThenGetEvents(),i=this.scheduler,a=r.length;if(this.closed)throw new s.a;if(this.isStopped||this.hasError?t=o.a.EMPTY:(this.observers.push(e),t=new c.a(this,e)),i&&e.add(e=new u.a(e,i)),n)for(var l=0;l<a&&!e.closed;l++)e.next(r[l]);else for(l=0;l<a&&!e.closed;l++)e.next(r[l].value);return this.hasError?e.error(this.thrownError):this.isStopped&&e.complete(),t},t.prototype._getNow=function(){return(this.scheduler||a.a).now()},t.prototype._trimBufferThenGetEvents=function(){for(var e=this._getNow(),t=this._bufferSize,n=this._windowTime,r=this._events,i=r.length,a=0;a<i&&!(e-r[a].time<n);)a++;return i>t&&(a=Math.max(a,i-t)),a>0&&r.splice(0,a),r},t}(i.a),f=function(){return function(e,t){this.time=e,this.value=t}}()},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var r=n(20),i=n(28),a=n(13),o=n(110);function u(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e[e.length-1];switch(Object(r.a)(n)?e.pop():n=void 0,e.length){case 0:return Object(a.b)(n);case 1:return n?Object(i.a)(e,n):Object(o.a)(e[0]);default:return Object(i.a)(e,n)}}},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var r=n(4);function i(e,t){return t?new r.a(function(n){return t.schedule(a,0,{error:e,subscriber:n})}):new r.a(function(t){return t.error(e)})}function a(e){var t=e.error;e.subscriber.error(t)}},function(e,t,n){"use strict";n.d(t,"b",function(){return l}),n.d(t,"a",function(){return f});var r=n(0),i=n(20),a=n(15),o=n(8),u=n(6),s=n(28),c={};function l(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=null,r=null;return Object(i.a)(e[e.length-1])&&(r=e.pop()),"function"==typeof e[e.length-1]&&(n=e.pop()),1===e.length&&Object(a.a)(e[0])&&(e=e[0]),Object(s.a)(e,r).lift(new f(n))}var f=function(){function e(e){this.resultSelector=e}return e.prototype.call=function(e,t){return t.subscribe(new d(e,this.resultSelector))},e}(),d=function(e){function t(t,n){var r=e.call(this,t)||this;return r.resultSelector=n,r.active=0,r.values=[],r.observables=[],r}return r.a(t,e),t.prototype._next=function(e){this.values.push(c),this.observables.push(e)},t.prototype._complete=function(){var e=this.observables,t=e.length;if(0===t)this.destination.complete();else{this.active=t,this.toRespond=t;for(var n=0;n<t;n++){var r=e[n];this.add(Object(u.a)(this,r,r,n))}}},t.prototype.notifyComplete=function(e){0==(this.active-=1)&&this.destination.complete()},t.prototype.notifyNext=function(e,t,n,r,i){var a=this.values,o=a[n],u=this.toRespond?o===c?--this.toRespond:this.toRespond:0;a[n]=t,0===u&&(this.resultSelector?this._tryResultSelector(a):this.destination.next(a.slice()))},t.prototype._tryResultSelector=function(e){var t;try{t=this.resultSelector.apply(this,e)}catch(e){return void this.destination.error(e)}this.destination.next(t)},t}(o.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var r=n(55),i=n(40);function a(e){return void 0===e&&(e=Number.POSITIVE_INFINITY),Object(r.a)(i.a,e)}},function(e,t,n){"use strict";n.d(t,"a",function(){return o});var r=n(4),i=n(25),a=n(13);function o(e){return new r.a(function(t){var n;try{n=e()}catch(e){return void t.error(e)}return(n?Object(i.a)(n):Object(a.b)()).subscribe(t)})}},function(e,t,n){"use strict";n.d(t,"b",function(){return l}),n.d(t,"a",function(){return f});var r=n(0),i=n(28),a=n(15),o=n(1),u=n(8),s=n(6),c=n(42);function l(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e[e.length-1];return"function"==typeof n&&e.pop(),Object(i.a)(e,void 0).lift(new f(n))}var f=function(){function e(e){this.resultSelector=e}return e.prototype.call=function(e,t){return t.subscribe(new d(e,this.resultSelector))},e}(),d=function(e){function t(t,n,r){void 0===r&&(r=Object.create(null));var i=e.call(this,t)||this;return i.iterators=[],i.active=0,i.resultSelector="function"==typeof n?n:null,i.values=r,i}return r.a(t,e),t.prototype._next=function(e){var t=this.iterators;Object(a.a)(e)?t.push(new h(e)):"function"==typeof e[c.a]?t.push(new p(e[c.a]())):t.push(new m(this.destination,this,e))},t.prototype._complete=function(){var e=this.iterators,t=e.length;if(this.unsubscribe(),0!==t){this.active=t;for(var n=0;n<t;n++){var r=e[n];if(r.stillUnsubscribed)this.destination.add(r.subscribe(r,n));else this.active--}}else this.destination.complete()},t.prototype.notifyInactive=function(){this.active--,0===this.active&&this.destination.complete()},t.prototype.checkIterators=function(){for(var e=this.iterators,t=e.length,n=this.destination,r=0;r<t;r++){if("function"==typeof(o=e[r]).hasValue&&!o.hasValue())return}var i=!1,a=[];for(r=0;r<t;r++){var o,u=(o=e[r]).next();if(o.hasCompleted()&&(i=!0),u.done)return void n.complete();a.push(u.value)}this.resultSelector?this._tryresultSelector(a):n.next(a),i&&n.complete()},t.prototype._tryresultSelector=function(e){var t;try{t=this.resultSelector.apply(this,e)}catch(e){return void this.destination.error(e)}this.destination.next(t)},t}(o.a),p=function(){function e(e){this.iterator=e,this.nextResult=e.next()}return e.prototype.hasValue=function(){return!0},e.prototype.next=function(){var e=this.nextResult;return this.nextResult=this.iterator.next(),e},e.prototype.hasCompleted=function(){var e=this.nextResult;return e&&e.done},e}(),h=function(){function e(e){this.array=e,this.index=0,this.length=0,this.length=e.length}return e.prototype[c.a]=function(){return this},e.prototype.next=function(e){var t=this.index++,n=this.array;return t<this.length?{value:n[t],done:!1}:{value:null,done:!0}},e.prototype.hasValue=function(){return this.array.length>this.index},e.prototype.hasCompleted=function(){return this.array.length===this.index},e}(),m=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.parent=n,i.observable=r,i.stillUnsubscribed=!0,i.buffer=[],i.isComplete=!1,i}return r.a(t,e),t.prototype[c.a]=function(){return this},t.prototype.next=function(){var e=this.buffer;return 0===e.length&&this.isComplete?{value:null,done:!0}:{value:e.shift(),done:!1}},t.prototype.hasValue=function(){return this.buffer.length>0},t.prototype.hasCompleted=function(){return 0===this.buffer.length&&this.isComplete},t.prototype.notifyComplete=function(){this.buffer.length>0?(this.isComplete=!0,this.parent.notifyInactive()):this.destination.complete()},t.prototype.notifyNext=function(e,t,n,r,i){this.buffer.push(t),this.parent.checkIterators()},t.prototype.subscribe=function(e,t){return Object(s.a)(this,this.observable,this,t)},t}(u.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var r=n(1);function i(e){for(;e;){var t=e,n=t.closed,i=t.destination,a=t.isStopped;if(n||a)return!1;e=i&&i instanceof r.a?i:null}return!0}},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var r=n(4);function i(e){var t=new r.a(function(t){t.next(e),t.complete()});return t._isScalar=!0,t.value=e,t}},function(e,t,n){"use strict";var r=n(0),i=1,a={};var o=function(e){var t=i++;return a[t]=e,Promise.resolve().then(function(){return function(e){var t=a[e];t&&t()}(t)}),t},u=function(e){delete a[e]},s=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r}return r.a(t,e),t.prototype.requestAsyncId=function(t,n,r){return void 0===r&&(r=0),null!==r&&r>0?e.prototype.requestAsyncId.call(this,t,n,r):(t.actions.push(this),t.scheduled||(t.scheduled=o(t.flush.bind(t,null))))},t.prototype.recycleAsyncId=function(t,n,r){if(void 0===r&&(r=0),null!==r&&r>0||null===r&&this.delay>0)return e.prototype.recycleAsyncId.call(this,t,n,r);0===t.actions.length&&(u(n),t.scheduled=void 0)},t}(n(65).a),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.a(t,e),t.prototype.flush=function(e){this.active=!0,this.scheduled=void 0;var t,n=this.actions,r=-1,i=n.length;e=e||n.shift();do{if(t=e.execute(e.state,e.delay))break}while(++r<i&&(e=n.shift()));if(this.active=!1,t){for(;++r<i&&(e=n.shift());)e.unsubscribe();throw t}},t}(n(63).a);n.d(t,"a",function(){return l});var l=new c(s)},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var r=n(31),i=n(67),a={closed:!0,next:function(e){},error:function(e){if(r.a.useDeprecatedSynchronousErrorHandling)throw e;Object(i.a)(e)},complete:function(){}}},function(e,t,n){"use strict";function r(e,t,n){return(e-t)/(n-t)}function i(e,t,n){return Math.max(t,Math.min(n,e))}function a(e){return i(e,0,1)}Object.defineProperty(t,"__esModule",{value:!0}),t.normalize=r,t.clamp=i,t.pclamp=function(e){return i(e,0,100)},t.saturate=a,t.damp=function(e,t){var n=e*t;return Math.abs(n)<.1?0:n},t.lerp=function(e,t,n){return e+(t-e)*n},t.spline=function(e,t,n,r,i,a){var o=(n-e)*a,u=(r-t)*a,s=i*i;return(2*t-2*n+o+u)*(i*s)+(-3*t+3*n-2*o-u)*s+o*i+t},t.quadraticBezier=function(e,t,n,r){var i=1-r;return i*i*e+2*i*r*t+r*r*n},t.smoothstep=function(e,t,n){return(n=a(r(n,e,t)))*n*(3-2*n)},t.smootherstep=function(e,t,n){return(n=a(r(n,e,t)))*n*n*(n*(6*n-15)+10)},t.smootheststep=function(e,t,n){return n=a(r(n,e,t)),-20*Math.pow(n,7)+70*Math.pow(n,6)-84*Math.pow(n,5)+35*Math.pow(n,4)},t.almostIdentity=function(e,t,n){if(e>t)return e;var r=e/t;return((2*n-t)*r+(2*t-3*n))*r*r+n}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.isSuperset=function(e,t){for(var n=0,r=Array.from(t);n<r.length;n++){var i=r[n];if(!e.has(i))return!1}return!0},e.union=function(e,t){for(var n=new Set(e),r=0,i=Array.from(t);r<i.length;r++){var a=i[r];n.add(a)}return n},e.unionMany=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(0===e.length)return new Set;if(1===e.length)return e[0];for(var n=new Set(e[0]),r=1;r<e.length;r++)for(var i=0,a=Array.from(e[r]);i<a.length;i++){var o=a[i];n.add(o)}return n},e.unionManyArrays=function(e){if(0===e.length)return new Set;for(var t=new Set(e[0]),n=1;n<e.length;n++)for(var r=0,i=e[n];r<i.length;r++){var a=i[r];t.add(a)}return t},e.intersection=function(e,t){for(var n=new Set,r=0,i=Array.from(t);r<i.length;r++){var a=i[r];e.has(a)&&n.add(a)}return n},e.difference=function(e,t){for(var n=new Set(e),r=0,i=Array.from(t);r<i.length;r++){var a=i[r];n.delete(a)}return n},e.areEqual=function(e,t){if(e.size!==t.size)return!1;for(var n=0,r=Array.from(t);n<r.length;n++){var i=r[n];if(!e.has(i))return!1}return!0}}(t.SetUtils||(t.SetUtils={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(349);!function(e){e.Empty=i.Empty,e.ofSingleton=function(e){return i.ofRange(e,e)},e.ofRange=i.ofRange,e.ofBounds=i.ofBounds,e.is=i.is,e.has=i.has,e.indexOf=i.indexOf,e.getAt=i.getAt,e.start=i.start,e.end=i.end,e.min=i.min,e.max=i.max,e.size=i.size,e.hashCode=i.hashCode,e.areEqual=i.areEqual,e.areIntersecting=i.areIntersecting,e.isSubInterval=i.isSubInterval,e.findPredecessorIndex=i.findPredecessorIndex,e.findPredecessorIndexInInterval=i.findPredecessorIndexInInterval,e.findRange=i.findRange,e.intersectionSize=i.intersectionSize,e.intersect=i.intersect}(r||(r={})),t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(5),a=n(78);!function(e){function t(e){return e}function n(e){throw new Error("Property only available for "+e+" models.")}e.create=function(e,t){return{kind:"element-location",unit:e,element:t||0}},e.property=t,e.atomicProperty=function(e){return t(function(t){return a.default.isAtomic(t.unit)?e(t):n("atomic")})},e.coarseProperty=function(e){return t(function(t){return a.default.isCoarse(t.unit)?e(t):n("coarse")})},e.Loci=function(e,t){return{kind:"element-loci",structure:e,elements:t}},e.isLoci=function(e){return!!e&&"element-loci"===e.kind},e.areLociEqual=function(e,t){if(e.elements.length!==t.elements.length)return!1;for(var n=0,r=e.elements.length;n<r;++n){var a=e.elements[n],o=t.elements[n];if(a.unit.id!==o.unit.id)return!1;if(!i.OrderedSet.areEqual(a.indices,o.indices))return!1}return!0},e.isLocation=function(e){return!!e&&"element-location"===e.kind},e.residueIndex=function(e){return a.default.isAtomic(e.unit)?e.unit.residueIndex[e.element]:-1},e.chainIndex=function(e){return a.default.isAtomic(e.unit)?e.unit.chainIndex[e.element]:-1},e.entityIndex=function(e){switch(e.unit.kind){case 0:return e.unit.model.atomicHierarchy.index.getEntityFromChain(e.unit.chainIndex[e.element]);case 1:return e.unit.model.coarseHierarchy.spheres.entityKey[e.element];case 2:return e.unit.model.coarseHierarchy.gaussians.entityKey[e.element]}}}(r||(r={})),t.default=r},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0});var i,a=n(23);r(n(238)),r(n(363)),r(n(375)),function(e){function t(e,t){return e.aIndex===t.aIndex&&e.bIndex===t.bIndex&&e.aUnit.id===t.aUnit.id&&e.bUnit.id===t.bUnit.id}e.Location=function(e,t,n,r){return{kind:"link-location",aUnit:e,aIndex:t,bUnit:n,bIndex:r}},e.isLocation=function(e){return!!e&&"link-location"===e.kind},e.areLocationsEqual=t,e.Loci=function(e,t){return{kind:"link-loci",structure:e,links:t}},e.isLoci=function(e){return!!e&&"link-loci"===e.kind},e.areLociEqual=function(e,n){if(e.links.length!==n.links.length)return!1;for(var r=0,i=e.links.length;r<i;++r)if(!t(e.links[r],n.links[r]))return!1;return!0},e.getType=function(e,t){if(t.aUnit===t.bUnit){var n=t.aUnit.links,r=n.getEdgeIndex(t.aIndex,t.bIndex);return r<0?a.LinkType.create(0):a.LinkType.create(n.edgeProps.flags[r])}var i=e.links.getBondFromLocation(t);return i?a.LinkType.create(i.flag):a.LinkType.create(0)},e.getOrder=function(e,t){if(t.aUnit===t.bUnit){var n=t.aUnit.links,r=n.getEdgeIndex(t.aIndex,t.bIndex);return r<0?0:n.edgeProps.order[r]}var i=e.links.getBondFromLocation(t);return i?i.order:0}}(i||(i={})),t.Link=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(362))},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(246)),r(n(388))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(21).Column.Schema,i=r.str,a=r.int,o=r.float,u=r.coord,s=r.Aliased,c=r.Matrix,l=r.Vector,f=r.List;t.mmCIF_Schema={atom_site:{auth_asym_id:i,auth_atom_id:i,auth_comp_id:i,auth_seq_id:a,B_iso_or_equiv:o,Cartn_x:u,Cartn_y:u,Cartn_z:u,group_PDB:s(i),id:a,label_alt_id:i,label_asym_id:i,label_atom_id:i,label_comp_id:i,label_entity_id:i,label_seq_id:a,occupancy:o,type_symbol:i,pdbx_PDB_ins_code:i,pdbx_PDB_model_num:a,pdbx_formal_charge:a,ihm_model_id:a},atom_sites:{entry_id:i,fract_transf_matrix:c(3,3),fract_transf_vector:l(3)},cell:{angle_alpha:o,angle_beta:o,angle_gamma:o,entry_id:i,length_a:o,length_b:o,length_c:o,Z_PDB:a,pdbx_unique_axis:i},chem_comp:{formula:i,formula_weight:o,id:i,mon_nstd_flag:s(i),name:i,type:s(i),pdbx_synonyms:f(";",function(e){return e})},chem_comp_bond:{atom_id_1:i,atom_id_2:i,comp_id:i,value_order:s(i),pdbx_ordinal:a,pdbx_stereo_config:s(i),pdbx_aromatic_flag:s(i)},entity:{details:i,formula_weight:o,id:i,src_method:s(i),type:s(i),pdbx_description:f(",",function(e){return e}),pdbx_number_of_molecules:o,pdbx_mutation:i,pdbx_fragment:i,pdbx_ec:f(",",function(e){return e})},entity_poly:{entity_id:i,nstd_linkage:s(i),nstd_monomer:s(i),type:s(i),pdbx_strand_id:f(",",function(e){return e}),pdbx_seq_one_letter_code:i,pdbx_seq_one_letter_code_can:i,pdbx_target_identifier:i},entity_poly_seq:{entity_id:i,hetero:s(i),mon_id:i,num:a},entry:{id:i},exptl:{entry_id:i,method:s(i)},struct:{entry_id:i,title:i},struct_asym:{details:i,entity_id:i,id:i,pdbx_modified:i,pdbx_blank_PDB_chainid_flag:s(i)},struct_conf:{beg_label_asym_id:i,beg_label_comp_id:i,beg_label_seq_id:a,beg_auth_asym_id:i,beg_auth_comp_id:i,beg_auth_seq_id:a,conf_type_id:s(i),details:i,end_label_asym_id:i,end_label_comp_id:i,end_label_seq_id:a,end_auth_asym_id:i,end_auth_comp_id:i,end_auth_seq_id:a,id:i,pdbx_beg_PDB_ins_code:i,pdbx_end_PDB_ins_code:i,pdbx_PDB_helix_class:i,pdbx_PDB_helix_length:a,pdbx_PDB_helix_id:i},struct_conn:{conn_type_id:s(i),details:i,id:i,ptnr1_label_asym_id:i,ptnr1_label_atom_id:i,ptnr1_label_comp_id:i,ptnr1_label_seq_id:a,ptnr1_auth_asym_id:i,ptnr1_auth_comp_id:i,ptnr1_auth_seq_id:a,ptnr1_symmetry:i,ptnr2_label_asym_id:i,ptnr2_label_atom_id:i,ptnr2_label_comp_id:i,ptnr2_label_seq_id:a,ptnr2_auth_asym_id:i,ptnr2_auth_comp_id:i,ptnr2_auth_seq_id:a,ptnr2_symmetry:i,pdbx_ptnr1_PDB_ins_code:i,pdbx_ptnr1_label_alt_id:i,pdbx_ptnr1_standard_comp_id:i,pdbx_ptnr2_PDB_ins_code:i,pdbx_ptnr2_label_alt_id:i,pdbx_ptnr3_PDB_ins_code:i,pdbx_ptnr3_label_alt_id:i,pdbx_ptnr3_label_asym_id:i,pdbx_ptnr3_label_atom_id:i,pdbx_ptnr3_label_comp_id:i,pdbx_ptnr3_label_seq_id:a,pdbx_PDB_id:i,pdbx_dist_value:o,pdbx_value_order:s(i)},struct_conn_type:{criteria:i,id:s(i),reference:i},struct_keywords:{entry_id:i,text:f(",",function(e){return e}),pdbx_keywords:i},struct_ncs_oper:{code:s(i),details:i,id:i,matrix:c(3,3),vector:l(3)},struct_sheet_range:{beg_label_asym_id:i,beg_label_comp_id:i,beg_label_seq_id:a,end_label_asym_id:i,end_label_comp_id:i,end_label_seq_id:a,beg_auth_asym_id:i,beg_auth_comp_id:i,beg_auth_seq_id:a,end_auth_asym_id:i,end_auth_comp_id:i,end_auth_seq_id:a,id:i,sheet_id:i,pdbx_beg_PDB_ins_code:i,pdbx_end_PDB_ins_code:i},struct_site:{details:i,id:i,pdbx_num_residues:a,pdbx_evidence_code:i,pdbx_auth_asym_id:i,pdbx_auth_comp_id:i,pdbx_auth_seq_id:i,pdbx_auth_ins_code:i},struct_site_gen:{details:i,id:i,label_alt_id:i,label_asym_id:i,label_atom_id:i,label_comp_id:i,label_seq_id:a,auth_asym_id:i,auth_comp_id:i,auth_seq_id:i,site_id:i,symmetry:i,pdbx_auth_ins_code:i,pdbx_num_res:a},symmetry:{entry_id:i,cell_setting:s(i),Int_Tables_number:a,space_group_name_Hall:i,"space_group_name_H-M":i},pdbx_nonpoly_scheme:{asym_id:i,entity_id:i,mon_id:i,pdb_strand_id:i,ndb_seq_num:i,pdb_seq_num:i,auth_seq_num:i,pdb_mon_id:i,auth_mon_id:i,pdb_ins_code:i},pdbx_chem_comp_identifier:{comp_id:i,identifier:i,type:s(i),program:i,program_version:i},pdbx_struct_mod_residue:{id:a,auth_asym_id:i,auth_comp_id:i,auth_seq_id:a,PDB_ins_code:i,label_asym_id:i,label_comp_id:i,label_seq_id:a,parent_comp_id:i,details:i},pdbx_struct_oper_list:{id:i,type:s(i),name:i,symmetry_operation:i,matrix:c(3,3),vector:l(3)},pdbx_struct_assembly:{method_details:i,oligomeric_details:i,oligomeric_count:a,details:i,id:i},pdbx_struct_assembly_gen:{asym_id_list:f(",",function(e){return e}),assembly_id:i,oper_expression:i},pdbx_reference_entity_list:{prd_id:i,ref_entity_id:i,type:i,details:i,component_id:a},pdbx_reference_entity_link:{link_id:a,prd_id:i,details:i,ref_entity_id_1:i,ref_entity_id_2:i,entity_seq_num_1:a,entity_seq_num_2:a,comp_id_1:i,comp_id_2:i,atom_id_1:i,atom_id_2:i,value_order:s(i),component_1:a,component_2:a,link_class:s(i)},pdbx_reference_entity_poly_link:{link_id:a,prd_id:i,ref_entity_id:i,component_id:a,entity_seq_num_1:a,entity_seq_num_2:a,comp_id_1:i,comp_id_2:i,atom_id_1:i,atom_id_2:i,value_order:s(i)},pdbx_molecule:{prd_id:i,instance_id:a,asym_id:i},pdbx_molecule_features:{prd_id:i,class:s(i),type:s(i),name:i,details:i},pdbx_entity_descriptor:{entity_id:i,descriptor:i,type:s(i),program:i,program_version:i,ordinal:a},ihm_starting_model_details:{starting_model_id:i,entity_id:i,entity_description:i,asym_id:i,seq_id_begin:a,seq_id_end:a,starting_model_source:s(i),starting_model_auth_asym_id:i,starting_model_sequence_offset:a,dataset_list_id:a},ihm_starting_comparative_models:{ordinal_id:a,starting_model_id:i,starting_model_auth_asym_id:i,starting_model_seq_id_begin:a,starting_model_seq_id_end:a,template_auth_asym_id:i,template_seq_id_begin:a,template_seq_id_end:a,template_sequence_identity:o,template_sequence_identity_denominator:s(a),template_dataset_list_id:a,alignment_file_id:a},ihm_starting_model_seq_dif:{ordinal_id:a,entity_id:i,asym_id:i,seq_id:a,comp_id:i,starting_model_id:i,db_asym_id:i,db_seq_id:a,db_comp_id:i,details:i},ihm_model_representation:{ordinal_id:a,representation_id:a,segment_id:a,entity_id:i,entity_description:i,entity_asym_id:i,seq_id_begin:a,seq_id_end:a,model_object_primitive:s(i),starting_model_id:i,model_mode:s(i),model_granularity:s(i),model_object_count:a},ihm_struct_assembly:{ordinal_id:a,assembly_id:a,parent_assembly_id:a,entity_description:i,entity_id:i,asym_id:i,seq_id_begin:a,seq_id_end:a},ihm_struct_assembly_details:{assembly_id:a,assembly_name:i,assembly_description:i},ihm_modeling_protocol:{ordinal_id:a,protocol_id:a,step_id:a,struct_assembly_id:a,dataset_group_id:a,struct_assembly_description:i,protocol_name:i,step_name:i,step_method:i,num_models_begin:a,num_models_end:a,multi_scale_flag:s(i),multi_state_flag:s(i),ordered_flag:s(i)},ihm_multi_state_modeling:{ordinal_id:a,state_id:a,state_group_id:a,population_fraction:o,state_type:i,state_name:i,model_group_id:a,experiment_type:s(i),details:i},ihm_modeling_post_process:{id:a,protocol_id:a,analysis_id:a,step_id:a,type:s(i),feature:s(i),num_models_begin:a,num_models_end:a},ihm_ensemble_info:{ensemble_id:a,ensemble_name:i,post_process_id:a,model_group_id:a,ensemble_clustering_method:s(i),ensemble_clustering_feature:s(i),num_ensemble_models:a,num_ensemble_models_deposited:a,ensemble_precision_value:o,ensemble_file_id:a},ihm_model_list:{ordinal_id:a,model_id:a,model_group_id:a,model_name:i,model_group_name:i,assembly_id:a,protocol_id:a,representation_id:a},ihm_model_representative:{id:a,model_group_id:a,model_id:a,selection_criteria:s(i)},ihm_dataset_list:{id:a,data_type:s(i),database_hosted:s(i)},ihm_dataset_group:{ordinal_id:a,group_id:a,dataset_list_id:a},ihm_related_datasets:{ordinal_id:a,dataset_list_id_derived:a,dataset_list_id_primary:a},ihm_dataset_related_db_reference:{id:a,dataset_list_id:a,db_name:s(i),accession_code:i,version:i,details:i},ihm_external_reference_info:{reference_id:a,reference_provider:i,reference_type:s(i),reference:i,refers_to:s(i),associated_url:i},ihm_external_files:{id:a,reference_id:a,file_path:i,content_type:s(i),file_size_bytes:o,details:i},ihm_dataset_external_reference:{id:a,dataset_list_id:a,file_id:a},ihm_localization_density_files:{id:a,file_id:a,ensemble_id:a,entity_id:i,seq_id_begin:a,seq_id_end:a,asym_id:i},ihm_predicted_contact_restraint:{id:a,group_id:a,entity_id_1:i,entity_id_2:i,asym_id_1:i,asym_id_2:i,comp_id_1:i,comp_id_2:i,seq_id_1:a,seq_id_2:a,atom_id_1:i,atom_id_2:i,distance_lower_limit:o,distance_upper_limit:o,probability:o,restraint_type:s(i),model_granularity:s(i),dataset_list_id:a,software_id:a},ihm_cross_link_list:{id:a,group_id:a,entity_description_1:i,entity_description_2:i,entity_id_1:i,entity_id_2:i,comp_id_1:i,comp_id_2:i,seq_id_1:a,seq_id_2:a,linker_type:s(i),dataset_list_id:a},ihm_cross_link_restraint:{id:a,group_id:a,entity_id_1:i,entity_id_2:i,asym_id_1:i,asym_id_2:i,comp_id_1:i,comp_id_2:i,seq_id_1:a,seq_id_2:a,atom_id_1:i,atom_id_2:i,restraint_type:s(i),conditional_crosslink_flag:s(i),model_granularity:s(i),distance_threshold:o,psi:o,sigma_1:o,sigma_2:o},ihm_cross_link_result_parameters:{ordinal_id:a,restraint_id:a,model_id:a,psi:o,sigma_1:o,sigma_2:o},ihm_2dem_class_average_restraint:{id:a,dataset_list_id:a,number_raw_micrographs:a,pixel_size_width:o,pixel_size_height:o,image_resolution:o,image_segment_flag:s(i),number_of_projections:a,struct_assembly_id:a,details:i},ihm_2dem_class_average_fitting:{ordinal_id:a,restraint_id:a,model_id:a,cross_correlation_coefficient:o,rot_matrix:c(3,3),tr_vector:l(3)},ihm_3dem_restraint:{ordinal_id:a,dataset_list_id:a,model_id:a,struct_assembly_id:a,fitting_method:i,number_of_gaussians:a,cross_correlation_coefficient:o},ihm_sas_restraint:{ordinal_id:a,dataset_list_id:a,model_id:a,struct_assembly_id:a,profile_segment_flag:s(i),fitting_atom_type:i,fitting_method:i,fitting_state:s(i),radius_of_gyration:o,chi_value:o,details:i},ihm_starting_model_coord:{ordinal_id:a,starting_model_id:i,group_PDB:s(i),id:a,type_symbol:i,entity_id:i,atom_id:i,comp_id:i,seq_id:a,asym_id:i,Cartn_x:o,Cartn_y:o,Cartn_z:o,B_iso_or_equiv:o},ihm_sphere_obj_site:{ordinal_id:a,entity_id:i,seq_id_begin:a,seq_id_end:a,asym_id:i,Cartn_x:o,Cartn_y:o,Cartn_z:o,object_radius:o,rmsf:o,model_id:a},ihm_gaussian_obj_site:{ordinal_id:a,entity_id:i,seq_id_begin:a,seq_id_end:a,asym_id:i,mean_Cartn_x:o,mean_Cartn_y:o,mean_Cartn_z:o,weight:o,covariance_matrix:c(3,3),model_id:a},ihm_gaussian_obj_ensemble:{ordinal_id:a,entity_id:i,seq_id_begin:a,seq_id_end:a,asym_id:i,mean_Cartn_x:o,mean_Cartn_y:o,mean_Cartn_z:o,weight:o,covariance_matrix:c(3,3),ensemble_id:a},ihm_feature_list:{feature_id:a,feature_type:s(i),entity_type:s(i)},ihm_poly_residue_feature:{ordinal_id:a,feature_id:a,entity_id:i,asym_id:i,comp_id_begin:i,comp_id_end:i,seq_id_begin:a,seq_id_end:a},ihm_derived_distance_restraint:{id:a,group_id:a,feature_id_1:a,feature_id_2:a,group_conditionality:s(i),random_exclusion_fraction:o,distance_upper_limit:o,restraint_type:s(i),dataset_list_id:a},pdbx_entity_branch_list:{entity_id:i,hetero:s(i),comp_id:i,num:a},pdbx_entity_branch_link:{link_id:a,details:i,entity_id:i,entity_branch_list_num_1:a,entity_branch_list_num_2:a,comp_id_1:i,comp_id_2:i,atom_id_1:i,leaving_atom_id_1:i,atom_stereo_config_1:s(i),atom_id_2:i,leaving_atom_id_2:i,atom_stereo_config_2:s(i),value_order:s(i)},pdbx_entity_branch:{entity_id:i,type:s(i)},pdbx_branch_scheme:{entity_id:i,hetero:s(i),asym_id:i,mon_id:i,num:a,auth_seq_num:i,auth_mon_id:i},pdbx_chem_comp_synonyms:{name:i,comp_id:i,provenance:s(i)},pdbx_chem_comp_related:{comp_id:i,related_comp_id:i,relationship_type:s(i),details:i}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(412))},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(7),a=n(95),o=n(58),u=n(51),s=n(72),c=n(256),l=n(3),f=n(52),d=n(19),p=n(59);function h(e,t,n,r,i){var a=f.calculateBoundingSphere(e,n,r,i),o=f.calculateBoundingSphere(t,n,r,i);return{boundingSphere:d.Sphere3D.addSphere(a.boundingSphere,o.boundingSphere),invariantBoundingSphere:d.Sphere3D.addSphere(a.invariantBoundingSphere,o.invariantBoundingSphere)}}!function(e){function t(e){var t=e?e.mappingBuffer.ref.value:new Float32Array(0),n=e?e.indexBuffer.ref.value:new Uint32Array(0),r=e?e.groupBuffer.ref.value:new Float32Array(0),a=e?e.startBuffer.ref.value:new Float32Array(0),o=e?e.endBuffer.ref.value:new Float32Array(0);return{kind:"lines",lineCount:0,mappingBuffer:e?i.ValueCell.update(e.mappingBuffer,t):i.ValueCell.create(t),indexBuffer:e?i.ValueCell.update(e.indexBuffer,n):i.ValueCell.create(n),groupBuffer:e?i.ValueCell.update(e.groupBuffer,r):i.ValueCell.create(r),startBuffer:e?i.ValueCell.update(e.startBuffer,a):i.ValueCell.create(a),endBuffer:e?i.ValueCell.update(e.endBuffer,o):i.ValueCell.create(o)}}function n(e,t,n,r){var o=e.startBuffer.ref.value;a.transformPositionArray(t,o,n,4*r),i.ValueCell.update(e.startBuffer,o);var u=e.endBuffer.ref.value;a.transformPositionArray(t,u,n,4*r),i.ValueCell.update(e.endBuffer,u)}function f(e,t,n,a,c){var l=n.instanceCount,f=n.groupCount,d=o.createColors(n,a.color),m=s.createSizes(n,a.size),y=u.createMarkers(l*f),v={drawCount:2*e.lineCount*3,groupCount:f,instanceCount:l},b=h(e.startBuffer.ref.value,e.endBuffer.ref.value,e.lineCount,t.aTransform.ref.value,t.instanceCount.ref.value),g=b.boundingSphere,_=b.invariantBoundingSphere;return r({aMapping:e.mappingBuffer,aGroup:e.groupBuffer,aStart:e.startBuffer,aEnd:e.endBuffer,elements:e.indexBuffer,boundingSphere:i.ValueCell.create(g),invariantBoundingSphere:i.ValueCell.create(_)},d,m,y,t,p.BaseGeometry.createValues(c,v),{uSizeFactor:i.ValueCell.create(c.sizeFactor),dLineSizeAttenuation:i.ValueCell.create(c.lineSizeAttenuation),dDoubleSided:i.ValueCell.create(!0),dFlipSided:i.ValueCell.create(!1)})}e.createEmpty=t,e.fromMesh=function(e,t){for(var n=e.vertexBuffer.ref.value,r=e.indexBuffer.ref.value,i=e.groupBuffer.ref.value,a=c.LinesBuilder.create(3*e.triangleCount,e.triangleCount/10,t),o=0,u=3*e.triangleCount;o<u;o+=3){var s=r[o],l=r[o+1],f=r[o+2],d=n[3*s],p=n[3*s+1],h=n[3*s+2],m=n[3*l],y=n[3*l+1],v=n[3*l+2],b=n[3*f],g=n[3*f+1],_=n[3*f+2];a.add(d,p,h,m,y,v,i[s]),a.add(d,p,h,b,g,_,i[s]),a.add(m,y,v,b,g,_,i[l])}return a.getLines()},e.transformImmediate=function(e,t){n(e,t,0,e.lineCount)},e.transformRangeImmediate=n,e.Params=r({},p.BaseGeometry.Params,{sizeFactor:l.ParamDefinition.Numeric(1,{min:0,max:10,step:.1}),lineSizeAttenuation:l.ParamDefinition.Boolean(!1)}),e.Utils={Params:e.Params,createEmpty:t,createValues:f,createValuesSimple:function(t,n,i,a,o){var u=p.BaseGeometry.createSimple(i,a,o),s=r({},l.ParamDefinition.getDefaultValues(e.Params),n);return f(t,u.transform,u.locationIterator,u.theme,s)},updateValues:function(e,t){p.BaseGeometry.updateValues(e,t),i.ValueCell.updateIfChanged(e.uSizeFactor,t.sizeFactor),i.ValueCell.updateIfChanged(e.dLineSizeAttenuation,t.lineSizeAttenuation)},updateBoundingSphere:function(e,t){var n=h(e.aStart.ref.value,e.aEnd.ref.value,t.lineCount,e.aTransform.ref.value,e.instanceCount.ref.value),r=n.boundingSphere,a=n.invariantBoundingSphere;d.Sphere3D.equals(r,e.boundingSphere.ref.value)||i.ValueCell.update(e.boundingSphere,r);d.Sphere3D.equals(a,e.invariantBoundingSphere.ref.value)||i.ValueCell.update(e.invariantBoundingSphere,a)},createRenderableState:p.BaseGeometry.createRenderableState,updateRenderableState:p.BaseGeometry.updateRenderableState}}(t.Lines||(t.Lines={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(7),i=n(9);!function(e){e.create=function(){return{updateTransform:!1,updateMatrix:!1,updateColor:!1,updateSize:!1,createGeometry:!1,createNew:!1}},e.reset=function(e){e.updateTransform=!1,e.updateMatrix=!1,e.updateColor=!1,e.updateSize=!1,e.createGeometry=!1,e.createNew=!1}}(t.VisualUpdateState||(t.VisualUpdateState={})),t.getQualityProps=function(e,t){var n=r.defaults(e.quality,"auto"),a=r.defaults(e.detail,1),o=r.defaults(e.radialSegments,12),u=r.defaults(e.linearSegments,8),s=r.defaults(e.resolution,2);if("auto"===n&&t instanceof i.Structure){var c=t.elementCount;t.isCoarse&&(c*=10),n=c>5e5?"lowest":c>3e5?"lower":c>1e5?"low":c>3e4?"medium":c>2e3?"high":"higher"}switch(n){case"highest":a=3,o=36,u=18,s=.3;break;case"higher":a=3,o=28,u=14,s=.5;break;case"high":a=2,o=20,u=10,s=1;break;case"medium":a=1,o=12,u=8,s=2;break;case"low":a=0,o=8,u=3,s=3;break;case"lower":a=0,o=4,u=2,s=5;break;case"lowest":a=0,o=2,u=1,s=8}return{detail:a,radialSegments:o,linearSegments:u,resolution:s}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(18),a=n(416),o=n(253),u=n(7),s=n(53),c=n(417),l=n(418),f=n(419),d=n(420),p=n(421),h=n(422),m=n(423),y=n(424),v=n(425),b=n(426),g=n(257),_=n(427);!function(e){e.EmptyFactory=function(){return e.Empty};var n=i.Color(13421772);e.Empty={factory:e.EmptyFactory,granularity:"uniform",color:function(){return n},props:{}},e.areEqual=function(e,t){return e.factory===t.factory&&u.deepEqual(e.props,t.props)},e.EmptyProvider={label:"",factory:e.EmptyFactory,getParams:function(){return{}},defaultValues:{},isApplicable:function(){return!0}},e.createRegistry=function(){return new s.ThemeRegistry(t.BuiltInColorThemes,e.EmptyProvider)}}(r||(r={})),t.ColorTheme=r,t.BuiltInColorThemes={"carbohydrate-symbol":a.CarbohydrateSymbolColorThemeProvider,"chain-id":c.ChainIdColorThemeProvider,"cross-link":l.CrossLinkColorThemeProvider,"element-index":f.ElementIndexColorThemeProvider,"element-symbol":d.ElementSymbolColorThemeProvider,"molecule-type":p.MoleculeTypeColorThemeProvider,"polymer-id":h.PolymerIdColorThemeProvider,"polymer-index":m.PolymerIndexColorThemeProvider,"residue-name":y.ResidueNameColorThemeProvider,"secondary-structure":v.SecondaryStructureColorThemeProvider,"sequence-id":b.SequenceIdColorThemeProvider,"shape-group":g.ShapeGroupColorThemeProvider,"unit-index":_.UnitIndexColorThemeProvider,uniform:o.UniformColorThemeProvider}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(2),a=n(82),o=n(52),u=n(7);!function(e){e.setVisibility=function(e,t){e&&(e.state.visible=t)},e.setPickable=function(e,t){e&&(e.state.pickable=t)},e.setTransform=function(e,t,n){if(e&&(t||n)){var r=e.values;t&&(i.Mat4.copy(r.matrix.ref.value,t),u.ValueCell.update(r.matrix,r.matrix.ref.value)),n?(r.extraTransform.ref.value.set(n),u.ValueCell.update(r.extraTransform,r.extraTransform.ref.value)):null===n&&(a.fillIdentityTransform(r.extraTransform.ref.value,r.instanceCount.ref.value),u.ValueCell.update(r.extraTransform,r.extraTransform.ref.value)),a.updateTransformData(r);var s=o.calculateTransformBoundingSphere(r.invariantBoundingSphere.ref.value,r.aTransform.ref.value,r.instanceCount.ref.value);u.ValueCell.update(r.boundingSphere,s)}}}(r||(r={})),t.Visual=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),i=n(54),a=n(207),o=new Map,u=r.Mat4.identity();t.addSphere=function(e,t,n,s){i.MeshBuilder.addPrimitive(e,function(e,t,n){return r.Mat4.scaleUniformly(e,r.Mat4.fromTranslation(e,t),n)}(u,t,n),function(e){var t=o.get(e);return void 0===t&&(t=a.Sphere(e),o.set(e,t)),t}(s))}},function(e,t,n){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.error=function(e,n){return void 0===n&&(n=-1),new t(e,n)},e.success=function(e,t){return void 0===t&&(t=[]),new n(e,t)};var t=function(){function e(e,t){this.message=e,this.line=t,this.isError=!0}return e.prototype.toString=function(){return this.line>=0?"[Line "+this.line+"] "+this.message:this.message},e}();e.Error=t;var n=function(){return function(e,t){this.result=e,this.warnings=t,this.isError=!1}}();e.Success=n}(r||(r={})),t.ReaderResult=r},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),a=this&&this.__assign||function(){return(a=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var o=n(2),u=n(18),s=n(50),c=n(35),l=n(159),f=n(3),d=n(151),p=n(24),h=n(547),m=n(549),y=n(216),v=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.render=function(){var e=this,t=this.props.params,n=this.props.values,r=Object.keys(t);return 0===r.length?null:p.createElement(p.Fragment,null,r.map(function(r){var i=t[r];if(i.isHidden)return null;var a=b(i);return a?p.createElement(a,{param:i,key:r,onChange:e.props.onChange,onEnter:e.props.onEnter,isDisabled:e.props.isDisabled,name:r,value:n[r]}):null}))},t}(p.PureComponent);function b(e){switch(e.type){case"value":return;case"boolean":return _;case"number":return void 0!==e.min&&void 0!==e.max?x:C;case"converted":return B;case"conditioned":return N;case"multi-select":return D;case"color":return k;case"color-scale":return M;case"vec3":return V;case"file":return O;case"select":return P;case"text":return w;case"interval":return void 0!==e.min&&void 0!==e.max?A:T;case"group":return R;case"mapped":return j;case"line-graph":return S;default:var t=e;return void console.warn(t+" has no associated UI component")}}t.ParameterControls=v;var g=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.update=function(e){this.props.onChange({param:this.props.param,name:this.props.name,value:e})},t.prototype.render=function(){var e=this.props.param.label||d.camelCaseToWords(this.props.name);return p.createElement("div",{className:"msp-control-row"},p.createElement("span",{title:this.props.param.description},e),p.createElement("div",null,this.renderControl()))},t}(p.PureComponent);t.SimpleParam=g;var _=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onClick=function(e){t.update(!t.props.value),e.currentTarget.blur()},t}return i(t,e),t.prototype.renderControl=function(){return p.createElement("button",{onClick:this.onClick,disabled:this.props.isDisabled},p.createElement("span",{className:"msp-icon msp-icon-"+(this.props.value?"ok":"off")}),this.props.value?"On":"Off")},t}(g);t.BoolControl=_;var S=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={isExpanded:!1,isOverPoint:!1,message:t.props.param.defaultValue.length+" points"},t.onHover=function(e){t.setState({isOverPoint:!t.state.isOverPoint}),e?t.setState({message:"("+e[0].toFixed(2)+", "+e[1].toFixed(2)+")"}):t.setState({message:t.props.value.length+" points"})},t.onDrag=function(e){t.setState({message:"("+e[0].toFixed(2)+", "+e[1].toFixed(2)+")"})},t.onChange=function(e){t.props.onChange({name:t.props.name,param:t.props.param,value:e})},t.toggleExpanded=function(e){t.setState({isExpanded:!t.state.isExpanded}),e.currentTarget.blur()},t}return i(t,e),t.prototype.render=function(){var e=this.props.param.label||d.camelCaseToWords(this.props.name);return p.createElement(p.Fragment,null,p.createElement("div",{className:"msp-control-row"},p.createElement("span",null,e),p.createElement("div",null,p.createElement("button",{onClick:this.toggleExpanded},""+this.state.message))),p.createElement("div",{className:"msp-control-offset",style:{display:this.state.isExpanded?"block":"none"}},p.createElement(h.default,{data:this.props.param.defaultValue,onChange:this.onChange,onHover:this.onHover,onDrag:this.onDrag})))},t}(p.PureComponent);t.LineGraphControl=S;var C=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={value:"0"},t.update=function(e){t.props.onChange({param:t.props.param,name:t.props.name,value:e})},t}return i(t,e),t.prototype.render=function(){var e=this.props.param.label||d.camelCaseToWords(this.props.name),t=this.props.param.label||d.camelCaseToWords(this.props.name);return p.createElement("div",{className:"msp-control-row"},p.createElement("span",{title:this.props.param.description},t),p.createElement("div",null,p.createElement(y.NumericInput,{value:this.props.value,onEnter:this.props.onEnter,placeholder:e,isDisabled:this.props.isDisabled,onChange:this.update})))},t}(p.PureComponent);t.NumberInputControl=C;var x=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onChange=function(e){t.update(e)},t}return i(t,e),t.prototype.renderControl=function(){return p.createElement(m.Slider,{value:this.props.value,min:this.props.param.min,max:this.props.param.max,step:this.props.param.step,onChange:this.onChange,disabled:this.props.isDisabled,onEnter:this.props.onEnter})},t}(g);t.NumberRangeControl=x;var w=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onChange=function(e){var n=e.target.value;n!==t.props.value&&t.update(n)},t.onKeyPress=function(e){t.props.onEnter&&(13!==e.keyCode&&13!==e.charCode||t.props.onEnter())},t}return i(t,e),t.prototype.renderControl=function(){var e=this.props.param.label||d.camelCaseToWords(this.props.name);return p.createElement("input",{type:"text",value:this.props.value||"",placeholder:e,onChange:this.onChange,onKeyPress:this.props.onEnter?this.onKeyPress:void 0,disabled:this.props.isDisabled})},t}(g);t.TextControl=w;var P=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onChange=function(e){"number"==typeof t.props.param.defaultValue?t.update(parseInt(e.target.value,10)):t.update(e.target.value)},t}return i(t,e),t.prototype.renderControl=function(){var e=this,t=void 0!==this.props.value&&!this.props.param.options.some(function(t){return t[0]===e.props.value});return p.createElement("select",{value:this.props.value||this.props.param.defaultValue,onChange:this.onChange,disabled:this.props.isDisabled},t&&p.createElement("option",{key:this.props.value,value:this.props.value},"[Invalid] "+this.props.value),this.props.param.options.map(function(e){var t=e[0],n=e[1];return p.createElement("option",{key:t,value:t},n)}))},t}(g);t.SelectControl=P;var T=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onChange=function(e){t.update(e)},t}return i(t,e),t.prototype.renderControl=function(){return p.createElement("span",null,"interval TODO")},t}(g);t.IntervalControl=T;var A=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onChange=function(e){t.update(e)},t}return i(t,e),t.prototype.renderControl=function(){return p.createElement(m.Slider2,{value:this.props.value,min:this.props.param.min,max:this.props.param.max,step:this.props.param.step,onChange:this.onChange,disabled:this.props.isDisabled,onEnter:this.props.onEnter})},t}(g);t.BoundedIntervalControl=A;var E=void 0;var k=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onChange=function(e){t.update(u.Color(parseInt(e.target.value)))},t}return i(t,e),t.prototype.stripStyle=function(){return{background:u.Color.toStyle(this.props.value),position:"absolute",bottom:"0",height:"4px",right:"0",left:"0"}},t.prototype.renderControl=function(){return p.createElement("div",{style:{position:"relative"}},p.createElement("select",{value:this.props.value,onChange:this.onChange},(e=this.props.value,c.ColorNamesValueMap.has(e)?null:p.createElement("option",{key:u.Color.toHexString(e),value:e,style:{background:""+u.Color.toStyle(e)}},u.Color.toRgbString(e))),E||(E=p.createElement(p.Fragment,null,Object.keys(c.ColorNames).map(function(e){return p.createElement("option",{key:e,value:c.ColorNames[e],style:{background:""+u.Color.toStyle(c.ColorNames[e])}},e)})))),p.createElement("div",{style:this.stripStyle()}));var e},t}(g);t.ColorControl=k;var I=l.memoize1(function(e){return"linear-gradient(to right, "+s.getColorListFromName(e).map(function(e){return u.Color.toStyle(e)}).join(", ")+")"}),M=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onChange=function(e){t.update(e.target.value)},t}return i(t,e),t.prototype.stripStyle=function(){return{background:I(this.props.value),position:"absolute",bottom:"0",height:"4px",right:"0",left:"0"}},t.prototype.renderControl=function(){return p.createElement("div",{style:{position:"relative"}},p.createElement("select",{value:this.props.value||"",onChange:this.onChange,disabled:this.props.isDisabled},this.props.param.options.map(function(e){var t=e[0],n=e[1];return p.createElement("option",{key:t,value:t},n)})),p.createElement("div",{style:this.stripStyle()}))},t}(g);t.ColorScaleControl=M;var V=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={isExpanded:!1},t.components={0:f.ParamDefinition.Numeric(0,void 0,{label:t.props.param.fieldLabels&&t.props.param.fieldLabels.x||"X"}),1:f.ParamDefinition.Numeric(0,void 0,{label:t.props.param.fieldLabels&&t.props.param.fieldLabels.y||"Y"}),2:f.ParamDefinition.Numeric(0,void 0,{label:t.props.param.fieldLabels&&t.props.param.fieldLabels.z||"Z"})},t.componentChange=function(e){var n=e.name,r=e.value,i=o.Vec3.copy(o.Vec3.zero(),t.props.value);i[+n]=r,t.change(i)},t.toggleExpanded=function(e){t.setState({isExpanded:!t.state.isExpanded}),e.currentTarget.blur()},t}return i(t,e),t.prototype.change=function(e){this.props.onChange({name:this.props.name,param:this.props.param,value:e})},t.prototype.render=function(){var e=this.props.value,t=this.props.param.label||d.camelCaseToWords(this.props.name),n="["+e[0].toFixed(2)+", "+e[1].toFixed(2)+", "+e[2].toFixed(2)+"]";return p.createElement(p.Fragment,null,p.createElement("div",{className:"msp-control-row"},p.createElement("span",null,t),p.createElement("div",null,p.createElement("button",{onClick:this.toggleExpanded},n))),p.createElement("div",{className:"msp-control-offset",style:{display:this.state.isExpanded?"block":"none"}},p.createElement(v,{params:this.components,values:e,onChange:this.componentChange,onEnter:this.props.onEnter})))},t}(p.PureComponent);t.Vec3Control=V;var O=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onChangeFile=function(e){t.change(e.target.files[0])},t}return i(t,e),t.prototype.change=function(e){this.props.onChange({name:this.props.name,param:this.props.param,value:e})},t.prototype.render=function(){var e=this.props.value;return p.createElement("div",{className:"msp-btn msp-btn-block msp-btn-action msp-loader-msp-btn-file",style:{marginTop:"1px"}},e?e.name:"Select a file..."," ",p.createElement("input",{disabled:this.props.isDisabled,onChange:this.onChangeFile,type:"file",multiple:!1,accept:this.props.param.accept}))},t}(p.PureComponent);t.FileControl=O;var D=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={isExpanded:!1},t.toggleExpanded=function(e){t.setState({isExpanded:!t.state.isExpanded}),e.currentTarget.blur()},t}return i(t,e),t.prototype.change=function(e){this.props.onChange({name:this.props.name,param:this.props.param,value:e})},t.prototype.toggle=function(e){var t=this;return function(n){t.props.value.indexOf(e)<0?t.change(t.props.value.concat(e)):t.change(t.props.value.filter(function(t){return t!==e})),n.currentTarget.blur()}},t.prototype.render=function(){var e=this,t=this.props.value,n=this.props.param.label||d.camelCaseToWords(this.props.name);return p.createElement(p.Fragment,null,p.createElement("div",{className:"msp-control-row"},p.createElement("span",null,n),p.createElement("div",null,p.createElement("button",{onClick:this.toggleExpanded},t.length+" of "+this.props.param.options.length))),p.createElement("div",{className:"msp-control-offset",style:{display:this.state.isExpanded?"block":"none"}},this.props.param.options.map(function(n){var r=n[0],i=n[1],a=t.indexOf(r)>=0;return p.createElement("div",{key:r,className:"msp-row"},p.createElement("button",{onClick:e.toggle(r),disabled:e.props.isDisabled},p.createElement("span",{style:{float:a?"left":"right"}},a?" "+i:i+" ")))})))},t}(p.PureComponent);t.MultiSelectControl=D;var R=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={isExpanded:!!t.props.param.isExpanded},t.onChangeParam=function(e){var n;t.change(a({},t.props.value,((n={})[e.name]=e.value,n)))},t.toggleExpanded=function(){return t.setState({isExpanded:!t.state.isExpanded})},t}return i(t,e),t.prototype.change=function(e){this.props.onChange({name:this.props.name,param:this.props.param,value:e})},t.prototype.render=function(){var e=this.props.param.params;if(0===Object.keys(e).length)return null;var t=this.props.param.label||d.camelCaseToWords(this.props.name),n=p.createElement(v,{params:e,onChange:this.onChangeParam,values:this.props.value,onEnter:this.props.onEnter,isDisabled:this.props.isDisabled});return this.props.param.isFlat?n:p.createElement("div",{className:"msp-control-group-wrapper"},p.createElement("div",{className:"msp-control-group-header"},p.createElement("button",{className:"msp-btn msp-btn-block",onClick:this.toggleExpanded},p.createElement("span",{className:"msp-icon msp-icon-"+(this.state.isExpanded?"collapse":"expand")}),t)),this.state.isExpanded&&p.createElement("div",{className:"msp-control-offset",style:{display:this.state.isExpanded?"block":"none"}},n))},t}(p.PureComponent);t.GroupControl=R;var j=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.valuesCache={},t.onChangeName=function(e){t.change({name:e.value,params:t.getValues(e.value)})},t.onChangeParam=function(e){t.setValues(t.props.value.name,e.value),t.change({name:t.props.value.name,params:e.value})},t}return i(t,e),t.prototype.setValues=function(e,t){this.valuesCache[e]=t},t.prototype.getValues=function(e){return e in this.valuesCache?this.valuesCache[e]:this.props.param.map(e).defaultValue},t.prototype.change=function(e){this.props.onChange({name:this.props.name,param:this.props.param,value:e})},t.prototype.render=function(){var e=this.props.value,t=this.props.param.map(e.name),n=this.props.param.label||d.camelCaseToWords(this.props.name),r=b(t),i=p.createElement(P,{param:this.props.param.select,isDisabled:this.props.isDisabled,onChange:this.onChangeName,onEnter:this.props.onEnter,name:n,value:e.name});return r?p.createElement("div",null,i,p.createElement(r,{param:t,value:e.params,name:n+" Properties",onChange:this.onChangeParam,onEnter:this.props.onEnter,isDisabled:this.props.isDisabled})):i},t}(p.PureComponent);t.MappedControl=j;var N=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onChangeCondition=function(e){t.change(t.props.param.conditionedValue(t.props.value,e.value))},t.onChangeParam=function(e){t.change(e.value)},t}return i(t,e),t.prototype.change=function(e){this.props.onChange({name:this.props.name,param:this.props.param,value:e})},t.prototype.render=function(){var e=this.props.value,t=this.props.param.conditionForValue(e),n=this.props.param.conditionParams[t],r=this.props.param.label||d.camelCaseToWords(this.props.name),i=b(n),a=p.createElement(P,{param:this.props.param.select,isDisabled:this.props.isDisabled,onChange:this.onChangeCondition,onEnter:this.props.onEnter,name:r+" Kind",value:t});return i?p.createElement("div",null,a,p.createElement(i,{param:n,value:e,name:r,onChange:this.onChangeParam,onEnter:this.props.onEnter,isDisabled:this.props.isDisabled})):a},t}(p.PureComponent);t.ConditionedControl=N;var B=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onChange=function(e){t.props.onChange({name:t.props.name,param:t.props.param,value:t.props.param.toValue(e.value)})},t}return i(t,e),t.prototype.render=function(){var e=this.props.param.fromValue(this.props.value),t=b(this.props.param.converted);return t?p.createElement(t,{param:this.props.param.converted,value:e,name:this.props.name,onChange:this.onChange,onEnter:this.props.onEnter,isDisabled:this.props.isDisabled}):null},t}(p.PureComponent);t.ConvertedControl=B},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var r=function(){function e(t,n){void 0===n&&(n=e.now),this.SchedulerAction=t,this.now=n}return e.prototype.schedule=function(e,t,n){return void 0===t&&(t=0),new this.SchedulerAction(this,e).schedule(n,t)},e.now=function(){return Date.now()},e}()},function(e,t,n){"use strict";n.d(t,"b",function(){return s}),n.d(t,"a",function(){return d});var r=n(0),i=n(1),a=n(10),o=n(4),u=n(12);function s(e,t,n,r){return function(i){return i.lift(new c(e,t,n,r))}}var c=function(){function e(e,t,n,r){this.keySelector=e,this.elementSelector=t,this.durationSelector=n,this.subjectSelector=r}return e.prototype.call=function(e,t){return t.subscribe(new l(e,this.keySelector,this.elementSelector,this.durationSelector,this.subjectSelector))},e}(),l=function(e){function t(t,n,r,i,a){var o=e.call(this,t)||this;return o.keySelector=n,o.elementSelector=r,o.durationSelector=i,o.subjectSelector=a,o.groups=null,o.attemptedToUnsubscribe=!1,o.count=0,o}return r.a(t,e),t.prototype._next=function(e){var t;try{t=this.keySelector(e)}catch(e){return void this.error(e)}this._group(e,t)},t.prototype._group=function(e,t){var n=this.groups;n||(n=this.groups=new Map);var r,i=n.get(t);if(this.elementSelector)try{r=this.elementSelector(e)}catch(e){this.error(e)}else r=e;if(!i){i=this.subjectSelector?this.subjectSelector():new u.a,n.set(t,i);var a=new d(t,i,this);if(this.destination.next(a),this.durationSelector){var o=void 0;try{o=this.durationSelector(new d(t,i))}catch(e){return void this.error(e)}this.add(o.subscribe(new f(t,i,this)))}}i.closed||i.next(r)},t.prototype._error=function(e){var t=this.groups;t&&(t.forEach(function(t,n){t.error(e)}),t.clear()),this.destination.error(e)},t.prototype._complete=function(){var e=this.groups;e&&(e.forEach(function(e,t){e.complete()}),e.clear()),this.destination.complete()},t.prototype.removeGroup=function(e){this.groups.delete(e)},t.prototype.unsubscribe=function(){this.closed||(this.attemptedToUnsubscribe=!0,0===this.count&&e.prototype.unsubscribe.call(this))},t}(i.a),f=function(e){function t(t,n,r){var i=e.call(this,n)||this;return i.key=t,i.group=n,i.parent=r,i}return r.a(t,e),t.prototype._next=function(e){this.complete()},t.prototype._unsubscribe=function(){var e=this.parent,t=this.key;this.key=this.parent=null,e&&e.removeGroup(t)},t}(i.a),d=function(e){function t(t,n,r){var i=e.call(this)||this;return i.key=t,i.groupSubject=n,i.refCountSubscription=r,i}return r.a(t,e),t.prototype._subscribe=function(e){var t=new a.a,n=this.refCountSubscription,r=this.groupSubject;return n&&!n.closed&&t.add(new p(n)),t.add(r.subscribe(e)),t},t}(o.a),p=function(e){function t(t){var n=e.call(this)||this;return n.parent=t,t.count++,n}return r.a(t,e),t.prototype.unsubscribe=function(){var t=this.parent;t.closed||this.closed||(e.prototype.unsubscribe.call(this),t.count-=1,0===t.count&&t.attemptedToUnsubscribe&&t.unsubscribe())},t}(a.a)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.degToRad=function(e){return.01745*e},t.radToDeg=function(e){return 57.29578*e}},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(2);!function(e){e.create=function(e,t,n,r){return{x:e,y:t,width:n,height:r}},e.clone=function(e){return r({},e)},e.copy=function(e,t){return Object.assign(e,t)},e.set=function(e,t,n,r,i){return e.x=t,e.y=n,e.width=r,e.height=i,e},e.toVec4=function(e,t){return e[0]=t.x,e[1]=t.y,e[2]=t.width,e[3]=t.height,e}}(t.Viewport||(t.Viewport={}));var a=i.Vec3.zero();t.cameraLookAt=function(e,t,n,r){if(i.Vec3.sub(a,r,e),i.Vec3.normalize(a,a),!i.Vec3.isZero(a)){var o=i.Vec3.dot(a,t);Math.abs(o-1)<1e-6?i.Vec3.scale(t,n,-1):Math.abs(o+1)<1e-6&&i.Vec3.copy(t,n),i.Vec3.copy(n,a),i.Vec3.cross(a,n,t),i.Vec3.normalize(a,a),i.Vec3.cross(t,a,n),i.Vec3.normalize(t,t)}};var o=0,u=1,s=i.Vec4.zero();t.cameraProject=function(e,t,n,r){var a=n.x,c=n.y,l=n.width,f=n.height;i.Vec4.set(s,t[0],t[1],t[2],1),i.Vec4.transformMat4(s,s,r);var d=s[3];return 0!==d&&(s[0]/=d,s[1]/=d,s[2]/=d),e[0]=a+l/2*s[0]+(0+l/2),e[1]=c+f/2*s[1]+(0+f/2),e[2]=(u-o)/2*s[2]+(u+o)/2,e[3]=0===d?0:1/d,e},t.cameraUnproject=function(e,t,n,r){var a=n.x,o=n.y,u=n.width,s=n.height,c=t[0]-a,l=s-t[1]-1-o,f=t[2];return e[0]=2*c/u-1,e[1]=2*l/s-1,e[2]=2*f-1,i.Vec3.transformMat4(e,e,r)}},function(e,t,n){"use strict";var r,i;Object.defineProperty(t,"__esModule",{value:!0});var a=n(18);t.SaccharideColors=a.ColorMap({Blue:37052,Green:42577,Yellow:16765952,Orange:16021792,Pink:16162465,Purple:10830745,LightBlue:9424105,Brown:10582605,Red:15539236,Secondary:15854817});var o=((r={})[0]="Hexose",r[1]="HexNAc",r[2]="Hexosamine",r[3]="Hexuronate",r[4]="Deoxyhexose",r[5]="DeoxyhexNAc",r[6]="Di-deoxyhexose",r[7]="Pentose",r[8]="Deoxynonulosonate",r[9]="Di-deoxynonulosonate",r[10]="Unknown",r[11]="Assigned",r);t.getSaccharideName=function(e){return o[e]};var u=((i={})[0]=0,i[1]=1,i[2]=2,i[3]=3,i[4]=4,i[5]=5,i[6]=6,i[7]=7,i[8]=8,i[9]=9,i[10]=10,i[11]=11,i);t.getSaccharideShape=function(e){return u[e]},t.UnknownSaccharideComponent={abbr:"Unk",name:"Unknown",color:t.SaccharideColors.Secondary,type:10};var s=[{abbr:"Glc",name:"Glucose",color:t.SaccharideColors.Blue,type:0},{abbr:"Man",name:"Mannose",color:t.SaccharideColors.Green,type:0},{abbr:"Gal",name:"Galactose",color:t.SaccharideColors.Yellow,type:0},{abbr:"Gul",name:"Gulose",color:t.SaccharideColors.Orange,type:0},{abbr:"Alt",name:"Altrose",color:t.SaccharideColors.Pink,type:0},{abbr:"All",name:"Allose",color:t.SaccharideColors.Purple,type:0},{abbr:"Tal",name:"Talose",color:t.SaccharideColors.LightBlue,type:0},{abbr:"Ido",name:"Idose",color:t.SaccharideColors.Brown,type:0},{abbr:"GlcNAc",name:"N-Acetyl Glucosamine",color:t.SaccharideColors.Blue,type:1},{abbr:"ManNAc",name:"N-Acetyl Mannosamine",color:t.SaccharideColors.Green,type:1},{abbr:"GalNAc",name:"N-Acetyl Galactosamine",color:t.SaccharideColors.Yellow,type:1},{abbr:"GulNAc",name:"N-Acetyl Gulosamine",color:t.SaccharideColors.Orange,type:1},{abbr:"AltNAc",name:"N-Acetyl Altrosamine",color:t.SaccharideColors.Pink,type:1},{abbr:"AllNAc",name:"N-Acetyl Allosamine",color:t.SaccharideColors.Purple,type:1},{abbr:"TalNAc",name:"N-Acetyl Talosamine",color:t.SaccharideColors.LightBlue,type:1},{abbr:"IdoNAc",name:"N-Acetyl Idosamine",color:t.SaccharideColors.Brown,type:1},{abbr:"GlcN",name:"Glucosamine",color:t.SaccharideColors.Blue,type:2},{abbr:"ManN",name:"Mannosamine",color:t.SaccharideColors.Green,type:2},{abbr:"GalN",name:"Galactosamine",color:t.SaccharideColors.Yellow,type:2},{abbr:"GulN",name:"Gulosamine",color:t.SaccharideColors.Orange,type:2},{abbr:"AltN",name:"Altrosamine",color:t.SaccharideColors.Pink,type:2},{abbr:"AllN",name:"Allosamine",color:t.SaccharideColors.Purple,type:2},{abbr:"TalN",name:"Talosamine",color:t.SaccharideColors.LightBlue,type:2},{abbr:"IdoN",name:"Idosamine",color:t.SaccharideColors.Brown,type:2},{abbr:"GlcA",name:"Glucuronic Acid",color:t.SaccharideColors.Blue,type:3},{abbr:"ManA",name:"Mannuronic Acid",color:t.SaccharideColors.Green,type:3},{abbr:"GalA",name:"Galacturonic Acid",color:t.SaccharideColors.Yellow,type:3},{abbr:"GulA",name:"Guluronic Acid",color:t.SaccharideColors.Orange,type:3},{abbr:"AltA",name:"Altruronic Acid",color:t.SaccharideColors.Pink,type:3},{abbr:"AllA",name:"Alluronic Acid",color:t.SaccharideColors.Purple,type:3},{abbr:"TalA",name:"Taluronic Acid",color:t.SaccharideColors.LightBlue,type:3},{abbr:"IdoA",name:"Iduronic Acid",color:t.SaccharideColors.Brown,type:3},{abbr:"Qui",name:"Quinovose",color:t.SaccharideColors.Blue,type:4},{abbr:"Rha",name:"Rhamnose",color:t.SaccharideColors.Green,type:4},{abbr:"6dGul",name:"6-Deoxy Gulose",color:t.SaccharideColors.Orange,type:4},{abbr:"6dAlt",name:"6-Deoxy Altrose",color:t.SaccharideColors.Pink,type:4},{abbr:"6dTal",name:"6-Deoxy Talose",color:t.SaccharideColors.LightBlue,type:4},{abbr:"Fuc",name:"Fucose",color:t.SaccharideColors.Red,type:4},{abbr:"QuiNAc",name:"N-Acetyl Quinovosamine",color:t.SaccharideColors.Blue,type:5},{abbr:"RhaNAc",name:"N-Acetyl Rhamnosamine",color:t.SaccharideColors.Green,type:5},{abbr:"6dAltNAc",name:"N-Acetyl 6-Deoxy Altrosamine",color:t.SaccharideColors.Pink,type:5},{abbr:"6dTalNAc",name:"N-Acetyl 6-Deoxy Talosamine",color:t.SaccharideColors.LightBlue,type:5},{abbr:"FucNAc",name:"N-Acetyl Fucosamine",color:t.SaccharideColors.Red,type:5},{abbr:"Oli",name:"Olivose",color:t.SaccharideColors.Blue,type:6},{abbr:"Tyv",name:"Tyvelose",color:t.SaccharideColors.Green,type:6},{abbr:"Abe",name:"Abequose",color:t.SaccharideColors.Orange,type:6},{abbr:"Par",name:"Paratose",color:t.SaccharideColors.Pink,type:6},{abbr:"Dig",name:"Digitoxose",color:t.SaccharideColors.Purple,type:6},{abbr:"Col",name:"Colitose",color:t.SaccharideColors.LightBlue,type:6},{abbr:"Ara",name:"Arabinose",color:t.SaccharideColors.Green,type:7},{abbr:"Lyx",name:"Lyxose",color:t.SaccharideColors.Yellow,type:7},{abbr:"Xyl",name:"Xylose",color:t.SaccharideColors.Orange,type:7},{abbr:"Rib",name:"Ribose",color:t.SaccharideColors.Pink,type:7},{abbr:"Kdn",name:"Keto-Deoxy Nonulonic Acid",color:t.SaccharideColors.Green,type:8},{abbr:"Neu5Ac",name:"N-Acetyl Neuraminic Acid",color:t.SaccharideColors.Purple,type:8},{abbr:"Neu5Gc",name:"N-Glycolyl Neuraminic Acid",color:t.SaccharideColors.LightBlue,type:8},{abbr:"Neu",name:"Neuraminic Acid",color:t.SaccharideColors.Brown,type:8},{abbr:"Sia",name:"Sialic acid",color:t.SaccharideColors.Red,type:8},{abbr:"Pse",name:"Pseudaminic Acid",color:t.SaccharideColors.Green,type:9},{abbr:"Leg",name:"Legionaminic Acid",color:t.SaccharideColors.Yellow,type:9},{abbr:"Aci",name:"Acinetaminic Acid",color:t.SaccharideColors.Pink,type:9},{abbr:"4eLeg",name:"4-Epilegionaminic Acid",color:t.SaccharideColors.LightBlue,type:9},{abbr:"Bac",name:"Bacillosamine",color:t.SaccharideColors.Blue,type:10},{abbr:"LDManHep",name:"L-Glycero-D-Manno Heptose",color:t.SaccharideColors.Green,type:10},{abbr:"Kdo",name:"Keto-Deoxy Octulonic Acid",color:t.SaccharideColors.Yellow,type:10},{abbr:"Dha",name:"3-Deoxy Lyxo-Heptulosaric Acid",color:t.SaccharideColors.Orange,type:10},{abbr:"DDManHep",name:"D-Glycero-D-Manno-Heptose",color:t.SaccharideColors.Pink,type:10},{abbr:"MurNAc",name:"N-Acetyl Muramic Acid",color:t.SaccharideColors.Purple,type:10},{abbr:"MurNGc",name:"N-Glycolyl Muramic Acid",color:t.SaccharideColors.LightBlue,type:10},{abbr:"Mur",name:"Muramic Acid",color:t.SaccharideColors.Brown,type:10},{abbr:"Api",name:"Apicose",color:t.SaccharideColors.Green,type:11},{abbr:"Fru",name:"Fructose",color:t.SaccharideColors.Green,type:11},{abbr:"Tag",name:"Tagatose",color:t.SaccharideColors.Yellow,type:11},{abbr:"Sor",name:"Sorbose",color:t.SaccharideColors.Orange,type:11},{abbr:"Psi",name:"Psicose",color:t.SaccharideColors.Pink,type:11}];t.SaccharidesSnfgMap=function(){for(var e=new Map,t=0,n=s.length;t<n;++t){var r=s[t];e.set(r.abbr,r)}return e}(),t.MonosaccharidesColorTable=[["Glc-family",t.SaccharideColors.Blue],["Man-family",t.SaccharideColors.Green],["Gal-family",t.SaccharideColors.Yellow],["Gul-family",t.SaccharideColors.Orange],["Alt-family",t.SaccharideColors.Pink],["All-family",t.SaccharideColors.Purple],["Tal-family",t.SaccharideColors.LightBlue],["Ido-family",t.SaccharideColors.Brown],["Fuc-family",t.SaccharideColors.Red],["Generic/Unknown/Secondary",t.SaccharideColors.Secondary]];var c={Glc:["GLC","BGC","BOG","TRE","MLR"],Man:["MAN","BMA"],Gal:["GAL","GLA","GXL"],Gul:["GUP","GL0"],Alt:["ALT"],All:["ALL","AFD"],Tal:["TAL"],Ido:["4N2"],GlcNAc:["NAG","NDG"],ManNAc:["NGA","A2G"],GulNAc:[],AltNAc:[],AllNAc:["NAA"],TalNAc:[],IdoNAc:["HSQ"],GlcN:["GCS","PA1","IDU","SGN","SUS"],ManN:["95Z"],GalN:["X6X","1GN"],GulN:[],AltN:[],AllN:[],TalN:[],IdoN:[],GlcA:["GCU","BDP"],ManA:["MAV","BEM"],GalA:["ADA","GTR"],GulA:["LGU"],AltA:[],AllA:[],TalA:["X0X","X1X"],IdoA:["IDR","IDS"],Qui:["G6D"],Rha:["RAM","RM4"],"6dGul":[],"6dAlt":[],"6dTal":[],Fuc:["FUC","FUL"],QuiNAc:[],RhaNAc:[],"6dAltNAc":[],"6dTalNAc":[],FucNAc:[],Oli:["DDA"],Tyv:["TYV"],Abe:["ABE"],Par:["PZU"],Dig:[],Col:[],Ara:["ARA","ARB"],Lyx:["LDY"],Xyl:["XYS","XYP"],Rib:["RIP","0MK"],Kdn:["KDN","KDM"],Neu5Ac:["SIA","SLB"],Neu5Gc:["NGC","NGE"],Neu:[],Sia:[],Pse:["6PZ"],Leg:[],Aci:[],"4eLeg":[],Bac:["B6D"],LDManHep:["GMH"],Kdo:["KDO"],Dha:[],DDManHep:[],MurNAc:["AMU"],MurNGc:[],Mur:["MUR"],Api:["XXM"],Fru:["BDF"],Tag:["T6T"],Sor:["SOE"],Psi:[]},l=["NGZ"];t.SaccharideCompIdMap=function(){for(var e=new Map,n=0,r=s.length;n<r;++n){var i=s[n],a=c[i.abbr];if(a)for(var o=0,u=a.length;o<u;++o)e.set(a[o],i)}for(n=0,r=l.length;n<r;++n)e.set(l[n],t.UnknownSaccharideComponent);return e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(90);function a(e){return 0}function o(e){return function(t){return e[t]}}function u(e){return 0===e[3]&&0===e[7]&&0===e[11]&&1===e[15]}function s(e,t){var n=e.matrix,r=t.x,i=t.y,a=t.z,o=n[0],s=n[4],c=n[8],l=n[12];return u(n)?function(e){return o*r[e]+s*i[e]+c*a[e]+l}:function(e){var t=r[e],u=i[e],f=a[e],d=n[3]*t+n[7]*u+n[11]*f+n[15]||1;return(o*t+s*u+c*f+l)/d}}function c(e,t){var n=e.matrix,r=t.x,i=t.y,a=t.z,o=n[1],s=n[5],c=n[9],l=n[13];return u(n)?function(e){return o*r[e]+s*i[e]+c*a[e]+l}:function(e){var t=r[e],u=i[e],f=a[e],d=n[3]*t+n[7]*u+n[11]*f+n[15]||1;return(o*t+s*u+c*f+l)/d}}function l(e,t){var n=e.matrix,r=t.x,i=t.y,a=t.z,o=n[2],s=n[6],c=n[10],l=n[14];return u(n)?function(e){return o*r[e]+s*i[e]+c*a[e]+l}:function(e){var t=r[e],u=i[e],f=a[e],d=n[3]*t+n[7]*u+n[11]*f+n[15]||1;return(o*t+s*u+c*f+l)/d}}!function(e){e.DefaultName="1_555",e.Default=n(e.DefaultName,i.Mat4.identity(),{id:"",operList:[]});var t=1e-4;function n(e,n,r,a,o){var u=o?i.Vec3.clone(o):i.Vec3.zero();if(a=a||"",i.Mat4.isIdentity(n))return{name:e,assembly:r,matrix:n,inverse:i.Mat4.identity(),isIdentity:!0,hkl:u,ncsId:a};if(!i.Mat4.isRotationAndTranslation(n,t))throw new Error("Symmetry operator ("+e+") must be a composition of rotation and translation.");return{name:e,assembly:r,matrix:n,inverse:i.Mat4.invert(i.Mat4.zero(),n),isIdentity:!1,hkl:u,ncsId:a}}e.create=n,e.checkIfRotationAndTranslation=function(e,n){for(var r=i.Mat4.identity(),a=0;a<3;a++)for(var o=0;o<3;o++)i.Mat4.setValue(r,a,o,i.Mat3.getValue(e,a,o));return i.Mat4.setTranslation(r,n),i.Mat4.isRotationAndTranslation(r,t)},e.ofRotationAndOffset=function(e,t,r,a){for(var o=i.Mat4.identity(),u=0;u<3;u++)for(var s=0;s<3;s++)i.Mat4.setValue(o,u,s,i.Mat3.getValue(t,u,s));return i.Mat4.setTranslation(o,r),n(e,o,{id:"",operList:[]},a)},e.compose=function(e,t){var r=i.Mat4.mul(i.Mat4.zero(),t.matrix,e.matrix);return n(t.name,r,t.assembly,t.ncsId,t.hkl)},e.createMapping=function(t,n,r){var i=e.createCoordinateMapper(e.Default,n),u=t.isIdentity?i:e.createCoordinateMapper(t,n),f=function(e,t){return e.isIdentity?{x:o(t.x),y:o(t.y),z:o(t.z)}:{x:s(e,t),y:c(e,t),z:l(e,t)}}(t,n);return{operator:t,invariantPosition:i,position:u,x:f.x,y:f.y,z:f.z,r:r||a}},e.createCoordinateMapper=function(e,t){return e.isIdentity?(r=(n=t).x,a=n.y,o=n.z,function(e,t){return t[0]=r[e],t[1]=a[e],t[2]=o[e],t}):function(e,t){var n=e.matrix,r=t.x,a=t.y,o=t.z;return u(n)?function(e,t){var i=r[e],u=a[e],s=o[e];return t[0]=n[0]*i+n[4]*u+n[8]*s+n[12],t[1]=n[1]*i+n[5]*u+n[9]*s+n[13],t[2]=n[2]*i+n[6]*u+n[10]*s+n[14],t}:function(e,t){return t[0]=r[e],t[1]=a[e],t[2]=o[e],i.Vec3.transformMat4(t,t,n),t}}(e,t);var n,r,a,o}}(r||(r={})),t.SymmetryOperator=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(90),i=function(){function e(){this.count=0,this.extremes=[r.Vec3.zero(),r.Vec3.zero(),r.Vec3.zero(),r.Vec3.zero(),r.Vec3.zero(),r.Vec3.zero()],this.u=r.Vec3.zero(),this.v=r.Vec3.zero(),this.tolerance=0,this.center=r.Vec3.zero(),this.radius=0,this.reset(0)}return e.prototype.reset=function(e){r.Vec3.set(this.center,0,0,0);for(var t=0;t<6;t++){var n=t%2==0?Number.MAX_VALUE:-Number.MAX_VALUE;r.Vec3.set(this.extremes[t],n,n,n)}this.radius=0,this.count=0,this.tolerance=e},e.prototype.boundaryStep=function(e,t){a(0,this.extremes[0],e,t),o(0,this.extremes[1],e,t),a(1,this.extremes[2],e,t),o(1,this.extremes[3],e,t),a(2,this.extremes[4],e,t),o(2,this.extremes[5],e,t),this.count++},e.prototype.finishBoundaryStep=function(){if(0!==this.count){for(var e=0,t=0,n=0,i=0;i<5;i++)for(var a=i+1;a<6;a++){var o=r.Vec3.squaredDistance(this.extremes[i],this.extremes[a]);o>e&&(e=o,t=i,n=a)}r.Vec3.add(this.center,this.extremes[t],this.extremes[n]),r.Vec3.scale(this.center,this.center,.5),this.radius=r.Vec3.distance(this.center,this.extremes[t])}},e.prototype.extendStep=function(e,t){var n=r.Vec3.distance(e,this.center);(1+this.tolerance)*this.radius>=t+n||(r.Vec3.sub(this.u,e,this.center),r.Vec3.normalize(this.u,this.u),r.Vec3.scale(this.v,this.u,-this.radius),r.Vec3.add(this.v,this.v,this.center),r.Vec3.scale(this.u,this.u,t+n),r.Vec3.add(this.u,this.u,this.center),r.Vec3.add(this.center,this.u,this.v),r.Vec3.scale(this.center,this.center,.5),this.radius=.5*(t+n+this.radius))},e.prototype.getBox=function(){r.Vec3.copy(this.u,this.extremes[0]),r.Vec3.copy(this.v,this.extremes[0]);for(var e=1;e<6;e++)r.Vec3.min(this.u,this.u,this.extremes[e]),r.Vec3.max(this.v,this.v,this.extremes[e]);return{min:r.Vec3.clone(this.u),max:r.Vec3.clone(this.v)}},e.prototype.getSphere=function(){return{center:r.Vec3.clone(this.center),radius:this.radius}},e}();function a(e,t,n,i){n[e]-i<t[e]&&(r.Vec3.copy(t,n),t[e]-=i)}function o(e,t,n,i){n[e]+i>t[e]&&(r.Vec3.copy(t,n),t[e]+=i)}t.BoundaryHelper=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(189),a=n(138);function o(e){return function(t,n){return n[e].value(t)}}function u(e){return function(t,n){return n[e].value(t).join(n[e].schema.separator)}}function s(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return function(n,r){var i;return(i=r[e].schema.space).get.apply(i,[r[e].value(n)].concat(t))}}function c(e){return function(t,n){return n[e].valueKind(t)}}function l(e,t){var n=[],r=c(e);if(1===t.rank)for(var i=t.dimensions[0],a=0;a<i;a++){var o=e+"["+(a+1)+"]";n.push({name:o,type:2,value:s(e,a),valueKind:r})}else if(2===t.rank){i=t.dimensions[0];var u=t.dimensions[1];for(a=0;a<i;a++)for(var l=0;l<u;l++){var f=e+"["+(a+1)+"]["+(l+1)+"]";n.push({name:f,type:2,value:s(e,a,l),valueKind:r})}}else{if(3!==t.rank)throw new Error("Tensors with rank > 3 or rank 0 are currently not supported.");var d=t.dimensions[0],p=t.dimensions[1],h=t.dimensions[2];for(a=0;a<d;a++)for(l=0;l<p;l++)for(var m=0;m<h;m++){var y=e+"["+(a+1)+"]["+(l+1)+"]["+(m+1)+"]";n.push({name:y,type:2,value:s(e,a,l,m),valueKind:r})}}return n}function f(e){for(var t=[],n=0,r=Object.keys(e);n<r.length;n++){var i=r[n],a=e[i];if("int"===a.valueType)t.push({name:i,type:1,value:o(i),valueKind:c(i)});else if("float"===a.valueType)t.push({name:i,type:2,value:o(i),valueKind:c(i)});else if("str"===a.valueType)t.push({name:i,type:0,value:o(i),valueKind:c(i)});else if("list"===a.valueType)t.push({name:i,type:0,value:u(i),valueKind:c(i)});else{if("tensor"!==a.valueType)throw new Error("Unknown valueType "+a.valueType);t.push.apply(t,l(i,a.space))}}return t}!function(e){function t(e,t,n){return{name:e,type:1,value:t,valueKind:n&&n.valueKind,defaultFormat:n?{encoder:n.encoder,typedArray:n.typedArray}:void 0,shouldInclude:n&&n.shouldInclude}}e.str=function(e,t,n){return{name:e,type:0,value:t,valueKind:n&&n.valueKind,defaultFormat:n&&n.encoder?{encoder:n.encoder}:void 0,shouldInclude:n&&n.shouldInclude}},e.int=t,e.float=function(e,t,n){return{name:e,type:2,value:t,valueKind:n&&n.valueKind,defaultFormat:n?{encoder:n.encoder,typedArray:n.typedArray,digitCount:void 0!==n.digitCount?n.digitCount:void 0}:void 0,shouldInclude:n&&n.shouldInclude}},e.index=function(e){return t(e,function(e,t,n){return n+1},{typedArray:Int32Array,encoder:a.ArrayEncoding.by(a.ArrayEncoding.delta).and(a.ArrayEncoding.runLength).and(a.ArrayEncoding.integerPacking)})};var n=function(){function t(){this.fields=[]}return t.prototype.index=function(t){return this.fields.push(e.index(t)),this},t.prototype.str=function(t,n,r){return this.fields.push(e.str(t,n,r)),this},t.prototype.int=function(t,n,r){return this.fields.push(e.int(t,n,r)),this},t.prototype.float=function(t,n,r){return this.fields.push(e.float(t,n,r)),this},t.prototype.many=function(e){for(var t=0;t<e.length;t++)this.fields.push(e[t]);return this},t.prototype.getFields=function(){return this.fields},t}();e.Builder=n,e.build=function(){return new n}}(t.Field||(t.Field={})),function(e){e.Empty={fields:[],source:[]},e.DefaultFilter={includeCategory:function(e){return!0},includeField:function(e,t){return!0}},e.DefaultFormatter={getFormat:function(e,t){}},e.ofTable=function(e,t){return t?{fields:f(e._schema),source:[{data:e,rowCount:t.length,keys:function(){return i.default.Array(t)}}]}:{fields:f(e._schema),source:[{data:e,rowCount:e._rowCount}]}}}(r=t.Category||(t.Category={})),function(e){function t(e,t,n){e.startDataBlock(t);for(var i=function(t){e.writeCategory({name:t,instance:function(){return r.ofTable(n[t])}})},a=0,o=n._tableNames;a<o.length;a++){i(o[a])}}e.writeDatabase=t,e.writeDatabaseCollection=function(e,n){for(var r=0,i=Object.keys(n);r<i.length;r++){var a=i[r];t(e,a,n[a])}}}(t.Encoder||(t.Encoder={}))},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0});var i=n(366);t.decode=i.default,r(n(240)),r(n(241)),r(n(192))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(34),i=n(225),a=r.idFactory();function o(e,t){var n=e.gl;switch(t){case"image-uint8":case"image-float32":return n.TEXTURE_2D}if(i.isWebGL2(n))switch(t){case"volume-uint8":case"volume-float32":return n.TEXTURE_3D}throw new Error("unknown texture kind")}function u(e,t){var n=e.gl;switch(t){case"alpha":return n.ALPHA;case"rgb":return n.RGB;case"rgba":return n.RGBA}}function s(e,t,n){var r=e.gl;if(e.isWebGL2)switch(t){case"alpha":switch(n){case"ubyte":return r.ALPHA;case"float":throw new Error("invalid format/type combination alpha/float")}case"rgb":switch(n){case"ubyte":return r.RGB;case"float":return r.RGB32F}case"rgba":switch(n){case"ubyte":return r.RGBA;case"float":return r.RGBA32F}}return u(e,t)}function c(e,t){var n=e.gl;switch(t){case"ubyte":return n.UNSIGNED_BYTE;case"float":return n.FLOAT}}function l(e,t){var n=e.gl;switch(t){case"nearest":return n.NEAREST;case"linear":return n.LINEAR}}function f(e,t){var n=e.gl;switch(t){case"depth":return n.DEPTH_ATTACHMENT;case"stencil":return n.STENCIL_ATTACHMENT;case"color0":case 0:return n.COLOR_ATTACHMENT0}if(i.isWebGL2(n))switch(t){case"color1":case 1:return n.COLOR_ATTACHMENT1;case"color2":case 2:return n.COLOR_ATTACHMENT2;case"color3":case 3:return n.COLOR_ATTACHMENT3;case"color4":case 4:return n.COLOR_ATTACHMENT4;case"color5":case 5:return n.COLOR_ATTACHMENT5;case"color6":case 6:return n.COLOR_ATTACHMENT6;case"color7":case 7:return n.COLOR_ATTACHMENT7}throw new Error("unknown texture attachment")}function d(e,t,n,r,i){var d=a(),p=e.gl,h=p.createTexture();if(null===h)throw new Error("Could not create WebGL texture");var m=o(e,t),y=l(e,i),v=u(e,n),b=s(e,n,r),g=c(e,r);p.bindTexture(m,h),p.texParameteri(m,p.TEXTURE_MAG_FILTER,y),p.texParameteri(m,p.TEXTURE_MIN_FILTER,y),p.texParameteri(m,p.TEXTURE_WRAP_S,p.CLAMP_TO_EDGE),p.texParameteri(m,p.TEXTURE_WRAP_T,p.CLAMP_TO_EDGE),p.bindTexture(m,null);var _=0,S=0,C=0,x=!1;return e.textureCount+=1,{id:d,target:m,format:v,internalFormat:b,type:g,get width(){return _},get height(){return S},get depth(){return C},define:function(e,t,n){if(_=e,S=t,C=n||0,p.bindTexture(m,h),m===p.TEXTURE_2D)p.texImage2D(m,0,b,_,S,0,v,g,null);else{if(m!==p.TEXTURE_3D||void 0===C)throw new Error("unknown texture target");p.texImage3D(m,0,b,_,S,C,0,v,g,null)}},load:function(e){if(p.bindTexture(m,h),p.pixelStorei(p.UNPACK_ALIGNMENT,1),p.pixelStorei(p.UNPACK_COLORSPACE_CONVERSION_WEBGL,p.NONE),p.pixelStorei(p.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),m===p.TEXTURE_2D){var t=e,n=t.array,r=t.width,i=t.height;_=r,S=i,p.texImage2D(m,0,b,_,S,0,v,g,n)}else{if(m!==p.TEXTURE_3D)throw new Error("unknown texture target");var a=e,o=(n=a.array,r=a.width,i=a.height,a.depth);_=r,S=i,C=o,p.texImage3D(m,0,b,_,S,C,0,v,g,n)}p.bindTexture(m,null)},bind:function(e){p.activeTexture(p.TEXTURE0+e),p.bindTexture(m,h)},unbind:function(e){p.activeTexture(p.TEXTURE0+e),p.bindTexture(m,null)},attachFramebuffer:function(t,n,r){if(t.bind(),m===p.TEXTURE_3D){if(void 0===r)throw new Error("need `layer` to attach 3D texture");p.framebufferTextureLayer(p.FRAMEBUFFER,f(e,n),h,0,r)}else p.framebufferTexture2D(p.FRAMEBUFFER,f(e,n),p.TEXTURE_2D,h,0)},detachFramebuffer:function(t,n){t.bind(),m===p.TEXTURE_3D?p.framebufferTextureLayer(p.FRAMEBUFFER,f(e,n),null,0,0):p.framebufferTexture2D(p.FRAMEBUFFER,f(e,n),p.TEXTURE_2D,null,0)},destroy:function(){x||(p.deleteTexture(h),x=!0,e.textureCount-=1)}}}t.getTarget=o,t.getFormat=u,t.getInternalFormat=s,t.getType=c,t.getFilter=l,t.getAttachment=f,t.createTexture=d,t.createTextures=function(e,t,n){var r={};return Object.keys(t).forEach(function(i,a){var o=t[i];if("texture"===o.type)if("texture"===o.kind)r[i]=n[i].ref.value;else{var u=d(e,o.kind,o.format,o.dataType,o.filter);u.load(n[i].ref.value),r[i]=u}}),r}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{s(r.next(e))}catch(e){a(e)}}function u(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,u)}s((r=r.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}};Object.defineProperty(t,"__esModule",{value:!0});var a,o=n(5),u=n(17),s=n(19),c=n(2),l=n(11),f=n(230),d=n(247),p=n(92),h=n(78);function m(e,t,n){var r=[],i=e.spacegroup;t[0]<=0&&n[0]>=0&&t[1]<=0&&n[1]>=0&&t[2]<=0&&n[2]>=0&&(r[0]=s.Spacegroup.getSymmetryOperator(i,0,0,0,0));for(var a=e.ncsOperators,o=a&&a.length||0,u=0;u<i.operators.length;u++)for(var l=t[0];l<=n[0];l++)for(var f=t[1];f<=n[1];f++)for(var d=t[2];d<=n[2];d++)if(0!==u||0!==l||0!==f||0!==d){var p=s.Spacegroup.getSymmetryOperator(i,u,l,f,d);if(o)for(var h=0;h<o;++h){var m=a[h],y=c.Mat4.mul(c.Mat4.zero(),p.matrix,m.matrix),v=s.SymmetryOperator.create(p.name+" "+m.name,y,p.assembly,m.ncsId,p.hkl);r[r.length]=v}else r[r.length]=p}return r}function y(e,t){for(var n=p.default.Builder(),r=e.units,i=0,a=t;i<a.length;i++)for(var o=a[i],u=0,s=r;u<s.length;u++){var c=s[u];n.addWithOperator(c,o)}return n.getStructure()}!function(e){function t(e,t){return e.invariantId===t.invariantId&&e.model.id===t.model.id&&o.SortedArray.areEqual(e.elements,t.elements)}function n(){return u.EquivalenceClasses(h.default.hashUnit,t)}e.buildAssembly=function(e,t){var n=this;return l.Task.create("Build Assembly",function(a){return r(n,void 0,void 0,function(){var n,r,a,o,u,s,c,l,h,m,y,v,b,g,_;return i(this,function(i){if(1!==(n=e.models).length)throw new Error("Can only build assemblies from structures based on 1 model.");if(!(r=f.ModelSymmetry.findAssembly(n[0],t)))throw new Error("Assembly '"+t+"' is not defined.");for(a=p.default.Builder(),o=new d.QueryContext(e),u=0,s=r.operatorGroups;u<s.length;u++)if(c=s[u],l=c.selector(o),0!==d.StructureSelection.structureCount(l))for(h=d.StructureSelection.unionStructure(l).units,m=0,y=c.operators;m<y.length;m++)for(v=y[m],b=0,g=h;b<g.length;b++)_=g[b],a.addWithOperator(_,v);return[2,a.getStructure()]})})})},e.builderSymmetryMates=function(e,t){return l.Task.create("Find Symmetry Mates",function(n){return function(e,t,n){return r(this,void 0,void 0,function(){var r,a,o,u,l,f,d,h,y,v,b,g,_,S,C,x,w,P;return i(this,function(i){switch(i.label){case 0:if(1!==(r=t.models).length)throw new Error("Can only build symmetries from structures based on 1 model.");return a=r[0].symmetry,o=a.spacegroup,s.SpacegroupCell.isZero(o.cell)?[2,t]:e.shouldUpdate?[4,e.update("Initialing...")]:[3,2];case 1:i.sent(),i.label=2;case 2:u=function(e){return void 0!==e._operators_333?e._operators_333:(e._operators_333=m(e,c.Vec3.create(-3,-3,-3),c.Vec3.create(3,3,3)),e._operators_333)}(a),l=t.lookup3d,f=p.default.Builder(),d=t.units,h=c.Vec3.zero(),y=0,v=u,i.label=3;case 3:if(!(y<v.length))return[3,6];for(b=v[y],g=0,_=d;g<_.length;g++)for(S=_[g],C=S.lookup3d.boundary.sphere,c.Vec3.transformMat4(h,C.center,b.matrix),x=l.findUnitIndices(h[0],h[1],h[2],C.radius+n),w=0,P=x.count;w<P;w++)d[x.indices[w]].lookup3d.check(h[0],h[1],h[2],C.radius+n)&&f.addWithOperator(S,b);return e.shouldUpdate?[4,e.update("Building symmetry...")]:[3,5];case 4:i.sent(),i.label=5;case 5:return y++,[3,3];case 6:return[2,f.getStructure()]}})})}(n,e,t)})},e.buildSymmetryRange=function(e,t,n){return l.Task.create("Build Symmetry",function(a){return function(e,t,n,a){return r(this,void 0,void 0,function(){var e,r,o;return i(this,function(i){if(1!==(e=t.models).length)throw new Error("Can only build symmetries from structures based on 1 model.");return r=e[0].symmetry.spacegroup,s.SpacegroupCell.isZero(r.cell)?[2,t]:(o=m(e[0].symmetry,n,a),[2,y(t,o)])})})}(0,e,t,n)})},e.buildNcs=function(e){return l.Task.create("Build NCS",function(t){return function(e,t){return r(this,void 0,void 0,function(){var e,n;return i(this,function(r){if(1!==(e=t.models).length)throw new Error("Can only build NCS from structures based on 1 model.");return(n=e[0].symmetry.ncsOperators)&&n.length?[2,y(t,n)]:[2,t]})})}(0,e)})},e.areUnitsEquivalent=t,e.UnitEquivalenceBuilder=n,e.computeTransformGroups=function(e){for(var t=n(),r=0,i=e.units;r<i.length;r++){var a=i[r];t.add(a.id,a)}for(var o=[],u=0,s=t.groups;u<s.length;u++){var c=s[u];o.push(h.default.SymmetryGroup(c.map(function(t){return e.unitMap.get(t)})))}return o},e.areTransformGroupsEquivalent=function(e,t){if(e.length!==t.length)return!1;for(var n=0,r=e.length;n<r;++n)if(e[n].hashCode!==t[n].hashCode)return!1;return!0}}(a||(a={})),t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(43),i=n(5);function a(e,t){this.setUnit(t,e)}function o(e,t){if(e===t)return!0;var n,r;e.units.length<t.units.length?(n=e,r=t):(n=t,r=e);for(var a=n.units,o=r.unitMap,u=0,s=a.length;u<s;u++){var c=a[u];if(o.has(c.id)){var l=o.get(c.id);if(i.SortedArray.areIntersecting(c.elements,l.elements))return!0}}return!1}t.structureUnion=function(e,t){if(0===t.length)return r.Structure.Empty;if(1===t.length)return t[0];for(var n=new Map,o=new Set,u=0,s=t;u<s.length;u++)for(var c=s[u].units,l=0,f=c.length;l<f;l++){var d=c[l];if(n.has(d.id)){if(o.has(d.id))continue;var p=i.SortedArray.union(n.get(d.id),d.elements);n.set(d.id,p),p.length===e.unitMap.get(d.id).elements.length&&o.add(d.id)}else n.set(d.id,d.elements),d.elements.length===e.unitMap.get(d.id).elements.length&&o.add(d.id)}var h=e.subsetBuilder(!0);return n.forEach(a,h),h.getStructure()},t.structureAreIntersecting=o,t.structureIntersect=function(e,t){if(e===t)return e;if(!o(e,t))return r.Structure.Empty;var n,a;e.units.length<t.units.length?(n=e,a=t):(n=t,a=e);for(var u=n.units,s=a.unitMap,c=[],l=0,f=u.length;l<f;l++){var d=u[l];if(s.has(d.id)){var p=s.get(d.id);if(i.SortedArray.areIntersecting(d.elements,p.elements)){var h=i.SortedArray.intersect(d.elements,p.elements);c[c.length]=d.getChild(h)}}}return r.Structure.create(c)},t.structureSubtract=function(e,t){if(e===t)return r.Structure.Empty;if(!o(e,t))return e;for(var n=e.units,a=t.unitMap,u=[],s=0,c=n.length;s<c;s++){var l=n[s];if(a.has(l.id)){var f=a.get(l.id),d=i.SortedArray.intersect(l.elements,f.elements);d.length>0&&(u[u.length]=l.getChild(d))}}return r.Structure.create(u)}},function(e,t,n){"use strict";function r(e,t,n){void 0===t&&(t=1),void 0===n&&(n=0);for(var r=e.length,i=0,a=n;a<r;a+=t)i+=e[a];return i}Object.defineProperty(t,"__esModule",{value:!0}),t.arrayMax=function(e){for(var t=-1/0,n=0,r=e.length;n<r;++n)e[n]>t&&(t=e[n]);return t},t.arrayMin=function(e){for(var t=1/0,n=0,r=e.length;n<r;++n)e[n]<t&&(t=e[n]);return t},t.arraySum=r,t.arrayMean=function(e,t,n){return void 0===t&&(t=1),void 0===n&&(n=0),r(e,t,n)/(e.length/t)},t.arrayRms=function(e){for(var t=e.length,n=0,r=0;r<t;++r){var i=e[r];n+=i*i}return Math.sqrt(n/t)},t.fillSerial=function(e,t){for(var n=0,r=t?Math.min(t,e.length):e.length;n<r;++n)e[n]=n;return e}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.polygon=function(e,t){for(var n=new Float32Array(2*e),r=e<=4?Math.sqrt(2)/2:.6,i=t?1:0,a=0,o=2*e;a<o;a+=2){var u=(a+i)/e*Math.PI;n[a]=Math.cos(u)*r,n[a+1]=Math.sin(u)*r}return n}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(254),a=n(53),o=n(199),u=n(7),s=n(258);!function(e){e.EmptyFactory=function(){return e.Empty},e.Empty={factory:e.EmptyFactory,granularity:"uniform",size:function(){return 1},props:{}},e.areEqual=function(e,t){return e.factory===t.factory&&u.deepEqual(e.props,t.props)},e.EmptyProvider={label:"",factory:e.EmptyFactory,getParams:function(){return{}},defaultValues:{},isApplicable:function(){return!0}},e.createRegistry=function(){return new a.ThemeRegistry(t.BuiltInSizeThemes,e.EmptyProvider)}}(r||(r={})),t.SizeTheme=r,t.BuiltInSizeThemes={physical:o.PhysicalSizeThemeProvider,"shape-group":s.ShapeGroupSizeThemeProvider,uniform:i.UniformSizeThemeProvider}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{s(r.next(e))}catch(e){a(e)}}function u(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,u)}s((r=r.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}};Object.defineProperty(t,"__esModule",{value:!0});var a=n(11),o=n(16),u=n(38),s=n(53),c=n(3),l=n(39);t.ComplexRepresentation=function(e,t,n,f){var d,p,h,m,y=0,v=new l.Subject,b=[],g=u.StructureRepresentationStateBuilder.create(),_=s.createEmptyTheme();return{label:e,get groupCount(){return d?d.groupCount:0},get props(){return m},get params(){return h},get state(){return g},get theme(){return _},renderObjects:b,updated:v,createOrUpdate:function(e,o){var u=this;return void 0===e&&(e={}),o&&o!==p&&(h=n(t,o),p=o,m||(m=c.ParamDefinition.getDefaultValues(h))),m=Object.assign({},m,e),a.Task.create("Creating or updating ComplexRepresentation",function(e){return r(u,void 0,void 0,function(){var n;return i(this,function(r){switch(r.label){case 0:return d||(d=f()),(n=d.createOrUpdate({webgl:t.webgl,runtime:e},_,m,o))?[4,n]:[3,2];case 1:r.sent(),r.label=2;case 2:return b.length=0,d&&d.renderObject&&b.push(d.renderObject),v.next(y++),[2]}})})})},setState:function(e){u.StructureRepresentationStateBuilder.update(g,e),void 0!==e.visible&&d&&d.setVisibility(e.visible&&null===g.unitTransforms),void 0!==e.pickable&&d&&d.setPickable(e.pickable),void 0!==e.transform&&d&&d.setTransform(e.transform),void 0!==e.unitTransforms&&d&&d.setVisibility(g.visible&&null===e.unitTransforms)},setTheme:function(e){_=e},getLoci:function(e){return d?d.getLoci(e):o.EmptyLoci},mark:function(e,t){return!!d&&d.mark(e,t)},destroy:function(){d&&d.destroy()}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),i=n(54),a=n(445),o=new Map,u=r.Vec3.create(0,1,0),s=r.Vec3.zero(),c=r.Vec3.zero(),l=r.Vec3.zero(),f=r.Mat4.zero(),d=r.Vec3.zero(),p=r.Vec3.zero();function h(e,t,n,i){return r.Vec3.setMagnitude(c,n,i/2),r.Vec3.add(l,t,c),r.Vec3.copy(p,u),r.Vec3.dot(c,p)<0&&r.Vec3.scale(p,p,-1),r.Vec3.makeRotation(e,p,c),r.Mat4.setTranslation(e,l)}function m(e){var t=JSON.stringify(e),n=o.get(t);return void 0===n&&(n=a.Cylinder(e),o.set(t,n)),n}t.addCylinder=function(e,t,n,a,o){var u=r.Vec3.distance(t,n)*a;o.height=u,r.Vec3.sub(s,n,t),h(f,t,s,u),i.MeshBuilder.addPrimitive(e,f,m(o))},t.addDoubleCylinder=function(e,t,n,a,o,u){var c=r.Vec3.distance(t,n)*a;u.height=c;var l=m(u);r.Vec3.sub(s,n,t),r.Vec3.add(d,t,o),h(f,d,s,c),i.MeshBuilder.addPrimitive(e,f,l),r.Vec3.sub(d,t,o),h(f,d,s,c),i.MeshBuilder.addPrimitive(e,f,l)},t.addFixedCountDashedCylinder=function(e,t,n,a,o,u){var c=Math.floor(o/2),l=1/o;if(a<1){var p=a/2/o;a+=o%2==1?p:-p}var y=r.Vec3.distance(t,n)*a;u.height=y*l;var v=m(u);r.Vec3.sub(s,n,t);for(var b=0;b<c;++b){var g=l*(2*b+1);r.Vec3.setMagnitude(s,s,y*g),r.Vec3.add(d,t,s),h(f,d,s,y*l),i.MeshBuilder.addPrimitive(e,f,v)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),i=n(9),a=n(16),o=n(5),u=n(207),s=n(54),c=n(126),l=n(36),f=n(451);t.createElementSphereMesh=function(e,t,n,a,o,l){var f=o.detail,d=o.sizeFactor,p=t.elements,h=p.length,m=h*u.sphereVertexCount(f),y=s.MeshBuilder.createState(m,m/2,l),v=r.Vec3.zero(),b=t.conformation.invariantPosition,g=i.StructureElement.create();g.unit=t;for(var _=0;_<h;_++)g.element=p[_],b(p[_],v),y.currentGroup=_,c.addSphere(y,v,a.size.size(g)*d,f);return s.MeshBuilder.getMesh(y)},t.createElementSphereImpostor=function(e,t,n,i,a,o){for(var u=t.elements,s=u.length,c=f.SpheresBuilder.create(s,s/2,o),l=r.Vec3.zero(),d=t.conformation.invariantPosition,p=0;p<s;p++)d(u[p],l),c.add(l[0],l[1],l[2],p);return c.getSpheres()},t.markElement=function(e,t,n){var r=!1;if(!i.StructureElement.isLoci(e))return!1;var a=t.structure,u=t.group;if(e.structure!==a)return!1;for(var s=u.elements.length,c=0,l=e.elements;c<l.length;c++){var f=l[c],d=u.unitIndexMap.get(f.unit.id);if(void 0!==d)if(o.Interval.is(f.indices)){var p=d*s+o.Interval.start(f.indices),h=d*s+o.Interval.end(f.indices);n(o.Interval.ofBounds(p,h))&&(r=!0)}else for(var m=0,y=f.indices.length;m<y;m++){var v=d*s+f.indices[m];n(o.Interval.ofSingleton(v))&&(r=!0)}}return r},t.getElementLoci=function(e,t,n){var r=e.objectId,u=e.instanceId,s=e.groupId;if(n===r){var c=t.structure,l=t.group.units[u],f=o.OrderedSet.ofSingleton(s);return i.StructureElement.Loci(c,[{unit:l,indices:f}])}return a.EmptyLoci},function(e){e.fromGroup=function(e){var t=e.elements.length,n=e.units.length,r=i.StructureElement.create();return l.LocationIterator(t,n,function(t,n){var i=e.units[n];return r.unit=i,r.element=i.elements[t],r})}}(t.StructureElementIterator||(t.StructureElementIterator={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(85));var r=n(476),i=n(477),a=n(478),o=n(479),u=n(273),s=n(481),c=n(482),l=n(503),f=n(504);t.BuiltInPluginBehaviors={State:r,Representation:i,Camera:a,Misc:o},t.PluginBehaviors={Representation:u,Camera:s,CustomProps:c,Animation:l,Labels:f}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i,a=n(7),o=n(27);!function(e){function t(e){var t;return(t=function(){function t(t,n){this.data=t,this.id=a.UUID.create22(),this.type=e,this.label=n&&n.label||e.name,this.description=n&&n.description}return t.is=function(t){return!!t&&e===t.type},t}()).type=e,t}e.factory=function(){return function(e){return t(e)}},e.create=t,e.Null={id:a.UUID.create22(),type:{name:"Null",typeClass:"Null"},data:void 0,label:"Null"}}(r||(r={})),t.StateObject=r,function(e){e.DefaultState={isHidden:!1,isCollapsed:!1},e.areStatesEqual=function(e,t){return e.isHidden!==t.isHidden||e.isCollapsed!==t.isCollapsed},e.isStateChange=function(e,t){return!!t&&(void 0!==t.isCollapsed&&e.isCollapsed!==t.isCollapsed||void 0!==t.isHidden&&e.isHidden!==t.isHidden)}}(i||(i={})),t.StateObjectCell=i;var u=function(){function e(e){this.state=e,this.version=""}return e.prototype.setQuery=function(e){this.query=o.StateSelection.compile(e)},e.prototype.update=function(){var e=this.state.select(this.query)[0],t=e?e.transform.version:void 0,n=this.cell!==e||this.version!==t;return this.cell=e,this.version=t||"",this.data=e.obj?e.obj.data:void 0,n},e}();t.StateObjectTracker=u},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i,a=n(100),o=n(265),u=n(151);!function(e){var t;e.is=function(e){return!!e&&"function"==typeof e.toAction&&"function"==typeof e.apply},function(e){e[e.Unchanged=0]="Unchanged",e[e.Updated=1]="Updated",e[e.Recreate=2]="Recreate"}(t=e.UpdateResult||(e.UpdateResult={}));var n,i=new Map,s=new Map;function c(e,t){var n=t.name,r=e+"."+n;if(i.has(r))throw new Error("A transform with id '"+n+"' is already registered. Please pick a unique identifier for your transforms and/or register them only once. This is to ensure that transforms can be serialized and replayed.");var u={apply:function(e,t,n){return a.StateTransform.create(e,u,t,n)},toAction:function(){return o.StateAction.fromTransformer(u)},namespace:e,id:r,definition:t};return i.set(r,u),function(e){for(var t=0,n=e.definition.from;t<n.length;t++){var r=n[t];s.has(r.type)?s.get(r.type).push(e):s.set(r.type,[e])}}(u),u}e.getAll=function(){return Array.from(i.values())},e.get=function(e){var t=i.get(e);if(!t)throw new Error("A transformer with signature '"+e+"' is not registered.");return t},e.fromType=function(e){return s.get(e)||[]},e.create=c,e.factory=function(e){return function(t){return c(e,t)}},e.builderFactory=function(e){return n.build(e)},function(e){e.build=function(e){return function(t){return function(e,t){return function(n){return c(e,r({name:t.name,from:t.from instanceof Array?t.from:[t.from],to:t.to instanceof Array?t.to:[t.to],display:"string"==typeof t.display?{name:t.display}:t.display?t.display:{name:u.capitalize(t.name.replace(/[-]/g," "))},params:"object"==typeof t.params?function(){return t.params}:t.params?t.params:void 0},n))}}(e,t)}}}(n=e.Builder||(e.Builder={})),e.build=function(e){return n.build(e)},e.ROOT=c("build-in",{name:"root",from:[],to:[],display:{name:"Root",description:"For internal use."},apply:function(){throw new Error("should never be applied")},update:function(){return t.Unchanged}})}(i||(i={})),t.StateTransformer=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=/^/gm;function i(e){return e.replace(/([a-z\xE0-\xFF])([A-Z\xC0\xDF])/g,"$1 $2")}function a(e){return e.toLowerCase().replace(/^\w|\s\w/g,t.upperCase)}function o(e){return e.replace(/_/g," ")}t.indentString=function(e,t,n){return 0===t?e:e.replace(r,n.repeat(t))},t.splitCamelCase=i,t.camelCaseToWords=function(e){return a(i(e))},t.lowerCase=function(e){return e.toLowerCase()},t.upperCase=function(e){return e.toUpperCase()},t.capitalize=a,t.splitSnakeCase=o,t.snakeCaseToWords=function(e){return a(o(e))},t.stringToWords=function(e){return a(i(o(e)))},t.substringStartsWith=function(e,t,n,r){var i=r.length;if(i>n-t)return!1;for(var a=0;a<i;a++)if(e.charCodeAt(t+a)!==r.charCodeAt(a))return!1;return!0}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(187),i=n(99),a=function(){function e(e){this._state=e}return Object.defineProperty(e.prototype,"ev",{get:function(){return this._ev||(this._ev=i.RxEventHelper.create())},enumerable:!0,configurable:!0}),e.prototype.updateState=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=this.state,i=r.shallowMergeArray(n,e);return i!==n&&(this._state=i,!0)},Object.defineProperty(e.prototype,"state",{get:function(){return this._state},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){this._ev&&this._ev.dispose()},e}();t.PluginComponent=a},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{s(r.next(e))}catch(e){a(e)}}function u(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,u)}s((r=r.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}};Object.defineProperty(t,"__esModule",{value:!0});var a,o=n(11),u=n(193);function s(e){throw"nyi"}function c(e,t,n,r){return new Promise(function(r,i){n.onerror=function(e){var t=e.target.error;i(t||"Failed.")},n.onabort=function(){return i(o.Task.Aborted(""))},n.onprogress=function(n){n.lengthComputable?e.update({message:t,isIndeterminate:!1,current:n.loaded,max:n.total}):e.update({message:t+" "+(n.loaded/1024/1024).toFixed(2)+" MB",isIndeterminate:!0})},n.onload=function(e){return r(e)}})}function l(e,t){var n=this,a=void 0;return o.Task.create("Read File",function(o){return r(n,void 0,void 0,function(){var n,l;return i(this,function(f){switch(f.label){case 0:return f.trys.push([0,,2,3]),a=new FileReader,(n=/\.gz$/i.test(e.name))||t?a.readAsArrayBuffer(e):a.readAsBinaryString(e),o.update({message:"Opening file...",canAbort:!0}),[4,c(o,"Reading...",a)];case 1:return l=f.sent(),[2,function(e,t,n,a){return r(this,void 0,void 0,function(){var r,o;return i(this,function(i){switch(i.label){case 0:return r=a.target.result,n?[4,e.update("Decompressing...")]:[3,2];case 1:return i.sent(),o=s(new Uint8Array(r)),t?[2,o]:[2,u.utf8Read(o,0,o.length)];case 2:return[2,t?new Uint8Array(r):r];case 3:return[2]}})})}(o,t,n,l)];case 2:return a=void 0,[7];case 3:return[2]}})})},function(){a&&a.abort()})}!function(e){e[e.None=0]="None",e[e.Gzip=1]="Gzip"}(a=t.DataCompressionMethod||(t.DataCompressionMethod={})),t.readStringFromFile=function(e){return l(e,!1)},t.readUint8ArrayFromFile=function(e){return l(e,!0)},t.readFromFile=function(e,t){return l(e,"binary"===t)},t.ajaxGetString=function(e,t){return p(t,e,!1,!1)},t.ajaxGetUint8Array=function(e,t){return p(t,e,!0,!1)},t.ajaxGet=function(e){return p(e.title,e.url,"binary"===e.type,e.compression===a.Gzip,e.body)};var f=function(){function e(){}return e.get=function(){return this.pool.length?this.pool.pop():new XMLHttpRequest},e.emptyFunc=function(){},e.deposit=function(t){this.pool.length<this.poolSize&&(t.onabort=e.emptyFunc,t.onerror=e.emptyFunc,t.onload=e.emptyFunc,t.onprogress=e.emptyFunc,this.pool.push(t))},e.pool=[],e.poolSize=15,e}();function d(e,t,n,a){return r(this,void 0,void 0,function(){var e,r,o,u;return i(this,function(i){if((e=a.target).status>=200&&e.status<400)return t?(r=new Uint8Array(a.target.response),f.deposit(a.target),n?[2,s()]:[2,r]):(o=a.target.responseText,f.deposit(a.target),[2,o]);throw u=e.statusText,f.deposit(a.target),u})})}function p(e,t,n,a,u){var s=this,l=void 0;return o.Task.create(e||"Download",function(e){return r(s,void 0,void 0,function(){var r;return i(this,function(i){switch(i.label){case 0:if(i.trys.push([0,,3,4]),!n&&a)throw"Decompress is only available when downloading binary data.";return(l=f.get()).open(u?"post":"get",t,!0),l.responseType=n?"arraybuffer":"text",l.send(u),e.update({message:"Waiting for server...",canAbort:!0}),[4,c(e,"Downloading...",l)];case 1:return r=i.sent(),[4,d(0,n,a,r)];case 2:return[2,i.sent()];case 3:return l=void 0,[7];case 4:return[2]}})})},function(){l&&l.abort()})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(21),i=n(211),a=n(484);function o(e,t,n,r){return{rowCount:t,name:e,fieldNames:n.slice(),getField:function(e){return r[e]}}}t.CifFile=function(e,t){return{name:t,blocks:e}},t.CifBlock=function(e,t,n,r){return void 0===r&&(r=[]),{categoryNames:e,header:n,categories:t,saveFrames:r}},t.CifSafeFrame=function(e,t,n){return{categoryNames:e,header:n,categories:t}},t.CifCategory=o,function(e){e.empty=function(e){return{rowCount:0,name:e,fieldNames:[],getField:function(e){}}},e.ofFields=function(e,t){var n=Object.keys(t);return{rowCount:n.length>0?t[n[0]].rowCount:0,name:e,fieldNames:n,getField:function(e){return t[e]}}}}(o=t.CifCategory||(t.CifCategory={})),function(e){function t(e){var t=e.length,n=function(t){var n=e[t];return n&&"."!==n&&"?"!==n?n:""},a=function(t){var n=e[t];return i.parseInt(n,0,n.length)||0},o=function(t){var n=e[t];return i.parseFloat(n,0,n.length)||0};return{__array:void 0,binaryEncoding:void 0,isDefined:!0,rowCount:t,str:n,int:a,float:o,valueKind:function(t){var n=e[t],r=n.length;if(r>1)return 0;if(0===r)return 1;var i=n.charCodeAt(0);return 46===i?1:63===i?2:0},areValuesEqual:function(t,n){return e[t]===e[n]},toStringArray:function(e){return r.ColumnHelpers.createAndFillArray(t,n,e)},toIntArray:function(e){return r.ColumnHelpers.createAndFillArray(t,a,e)},toFloatArray:function(e){return r.ColumnHelpers.createAndFillArray(t,o,e)}}}e.ofString=function(e){return t([e])},e.ofStrings=t,e.ofNumbers=function(e){var t=e.length,n=function(t){return""+e[t]},i=function(t){return e[t]};return{__array:void 0,binaryEncoding:void 0,isDefined:!0,rowCount:t,str:n,int:i,float:i,valueKind:function(e){return 0},areValuesEqual:function(t,n){return e[t]===e[n]},toStringArray:function(e){return r.ColumnHelpers.createAndFillArray(t,n,e)},toIntArray:function(e){return r.ColumnHelpers.createAndFillArray(t,i,e)},toFloatArray:function(e){return r.ColumnHelpers.createAndFillArray(t,i,e)}}},e.ofTokens=function(e){var t=e.data,n=e.indices,o=e.count,u=function(e){var r=t.substring(n[2*e],n[2*e+1]);return"."===r||"?"===r?"":r},s=function(e){return i.parseInt(t,n[2*e],n[2*e+1])||0},c=function(e){return i.parseFloat(t,n[2*e],n[2*e+1])||0};return{__array:void 0,binaryEncoding:void 0,isDefined:!0,rowCount:o,str:u,int:s,float:c,valueKind:function(e){var r=n[2*e],i=n[2*e+1]-r;if(i>1)return 0;if(0===i)return 1;var a=t.charCodeAt(r);return 46===a?1:63===a?2:0},areValuesEqual:a.areValuesEqualProvider(e),toStringArray:function(e){return r.ColumnHelpers.createAndFillArray(o,u,e)},toIntArray:function(e){return r.ColumnHelpers.createAndFillArray(o,s,e)},toFloatArray:function(e){return r.ColumnHelpers.createAndFillArray(o,c,e)}}}}(t.CifField||(t.CifField={})),t.getTensor=function(e,t,n,r,i){var a=n.create(),o=i?0:1;if(1===n.rank)for(var u=n.dimensions[0],s=0;s<u;s++){var c=e.getField(t+"["+(s+o)+"]");n.set(a,s,c?c.float(r):0)}else if(2===n.rank){u=n.dimensions[0];var l=n.dimensions[1];for(s=0;s<u;s++)for(var f=0;f<l;f++)c=e.getField(t+"["+(s+o)+"]["+(f+o)+"]"),n.set(a,s,f,c?c.float(r):0)}else{if(3!==n.rank)throw new Error("Tensors with rank > 3 or rank 0 are currently not supported.");var d=n.dimensions[0],p=n.dimensions[1],h=n.dimensions[2];for(s=0;s<d;s++)for(f=0;f<p;f++)for(var m=0;m<h;m++)c=e.getField(t+"["+(s+o)+"]["+(f+o)+"]["+(m+o)+"]"),n.set(a,s,f,m,c?c.float(r):0)}return a},t.getCifFieldType=function(e){for(var t=0,n=!1,a=0,o=0,u=e.rowCount;o<u;o++)if(0===e.valueKind(o)){var s=i.getNumberType(e.str(o));if(0!==s){if(1!==s){n=!0;break}t++}}else a++;return n||a===e.rowCount?r.Column.Schema.str:t>0?r.Column.Schema.float:r.Column.Schema.int}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(276);t.Argument=function(e,t){var n=t||{},r=n.description,i=void 0===r?void 0:r,a=n.isOptional,o=void 0!==a&&a,u=n.isRest,s=void 0!==u&&u,c=n.defaultValue;return{type:e,isOptional:o,isRest:s,defaultValue:void 0===c?void 0:c,description:i}},function(e){function t(e){return{kind:"dictionary",map:e,"@type":0}}e.None=t({}),e.Dictionary=t,e.List=function(e,t){var n=(t||{}).nonEmpty;return{kind:"list",type:e,nonEmpty:void 0!==n&&n,"@type":0}}}(r=t.Arguments||(t.Arguments={})),t.MSymbol=function(e,t,n,r){var a=function(e){return i.default.Apply(i.default.Symbol(a.id),e)};return a.info={namespace:"",name:e,description:r},a.id="",a.args=t,a.type=n,a},t.CustomPropSymbol=function(e,t,n,a){var o=function(e){return i.default.Apply(i.default.Symbol(o.id),e)};return o.info={namespace:e,name:t,description:a},o.id=e+"."+t,o.args=r.None,o.type=n,o},t.isSymbol=function(e){var t=e;return"function"==typeof t&&!!t.info&&!!t.args&&"string"==typeof t.info.namespace&&!!t.type}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{s(r.next(e))}catch(e){a(e)}}function u(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,u)}s((r=r.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}};Object.defineProperty(t,"__esModule",{value:!0});var a=n(491),o=n(44),u=n(21),s=n(137),c=n(210),l=n(75),f=n(279),d=n(11),p=n(500),h=n(153),m=u.Column.Schema,y=m.str,v=m.int,b=m.float,g=m.Aliased,_=m.Vector,S=m.List;function C(e){return function(t){var n=A.get(t.structures[0].model);return n?s.Category.ofTable(n.db[e]):o.CifWriter.Category.Empty}}function x(e){return{name:e,instance:C(e)}}function w(e){for(var t=A.Schema,n=[],r=[],i=[],a=[],o=1,s=0,c=0,l=e.length;c<l;++c){var f=e[c],d=f.pdbx_struct_assembly,p=f.rcsb_struct_symmetry;if(d&&p)for(var h=d.id,m=0,y=p.length;m<y;++m){var v=p[m];n.push({id:o,assembly_id:h,type:v.type,stoichiometry:v.stoichiometry,kind:v.kind,symbol:v.symbol,oligomeric_state:v.oligomeric_state});var b=v.clusters;if(b){for(var g=0,_=b.length;g<_;++g){var S=b[g],C=s+g;r.push({id:C,symmetry_id:o,avg_rmsd:S.avg_rmsd||0});for(var x=0,w=S.members.length;x<w;++x){var P=S.members[x];i.push({cluster_id:C,asym_id:P.asym_id,pdbx_struct_oper_list_ids:P.pdbx_struct_oper_list_ids||[]})}}s+=b.length}var T=v.rotation_axes;if(T)for(g=0,_=T.length;g<_;++g){var E=T[g];a.push({symmetry_id:o,order:E.order,start:E.start,end:E.end})}o+=1}}return u.Database.ofTables("assembly_symmetry",t,{rcsb_assembly_symmetry:u.Table.ofRows(t.rcsb_assembly_symmetry,n),rcsb_assembly_symmetry_cluster:u.Table.ofRows(t.rcsb_assembly_symmetry_cluster,r),rcsb_assembly_symmetry_cluster_member:u.Table.ofRows(t.rcsb_assembly_symmetry_cluster_member,i),rcsb_assembly_symmetry_axis:u.Table.ofRows(t.rcsb_assembly_symmetry_axis,a)})}function P(e){var t,n,r,i=A.Schema,a=c.toTable(i.rcsb_assembly_symmetry,e.sourceData.frame.categories.rcsb_assembly_symmetry_feature);return t=e.sourceData.frame.categoryNames.includes("rcsb_assembly_symmetry_cluster")?c.toTable(i.rcsb_assembly_symmetry_cluster,e.sourceData.frame.categories.rcsb_assembly_symmetry_cluster):c.toTable(i.rcsb_assembly_symmetry_cluster,l.CifCategory.empty),n=e.sourceData.frame.categoryNames.includes("rcsb_assembly_symmetry_cluster_member")?c.toTable(i.rcsb_assembly_symmetry_cluster_member,e.sourceData.frame.categories.rcsb_assembly_symmetry_cluster_member):c.toTable(i.rcsb_assembly_symmetry_cluster_member,l.CifCategory.empty),r=e.sourceData.frame.categoryNames.includes("rcsb_assembly_symmetry_axis")?c.toTable(i.rcsb_assembly_symmetry_axis,e.sourceData.frame.categories.rcsb_assembly_symmetry_axis):c.toTable(i.rcsb_assembly_symmetry_axis,l.CifCategory.empty),u.Database.ofTables("rcsb_assembly_symmetry",i,{rcsb_assembly_symmetry:a,rcsb_assembly_symmetry_cluster:t,rcsb_assembly_symmetry_cluster_member:n,rcsb_assembly_symmetry_axis:r})}var T={isStatic:!0,name:"rcsb_assembly_symmetry",cifExport:{prefix:"rcsb",categories:[f.PropertyWrapper.defaultInfoCategory("rcsb_assembly_symmetry_info",function(e){return f.PropertyWrapper.createInfo()}),x("rcsb_assembly_symmetry"),x("rcsb_assembly_symmetry_cluster"),x("rcsb_assembly_symmetry_cluster_member"),x("rcsb_assembly_symmetry_axis")]}};function A(e){var t=e.rcsb_assembly_symmetry,n=e.rcsb_assembly_symmetry_cluster,r=e.rcsb_assembly_symmetry_cluster_member,i=e.rcsb_assembly_symmetry_axis;return{"@type":"rcsb_assembly_symmetry",db:e,getSymmetries:function(e){return u.Table.pick(t,t._schema,function(n){return e.includes(t.assembly_id.value(n))})},getClusters:function(e){return u.Table.pick(n,n._schema,function(t){return n.symmetry_id.value(t)===e})},getClusterMembers:function(e){return u.Table.pick(r,r._schema,function(t){return r.cluster_id.value(t)===e})},getAxes:function(e){return u.Table.pick(i,i._schema,function(t){return i.symmetry_id.value(t)===e})}}}t.AssemblySymmetry=A;var E=new p.GraphQLClient(A.GraphQLEndpointURL,function(e,t,n){return h.ajaxGet({url:e,type:t,body:n})});!function(e){function t(t,n,o){return void 0===n&&(n=E),r(this,void 0,void 0,function(){var r,u,s,c;return i(this,function(i){switch(i.label){case 0:return t.customProperties.has(e.Descriptor)?[2,!0]:f.PropertyWrapper.tryGetInfoFromCif("rcsb_assembly_symmetry_info",t)?(r=P(t),[3,6]):[3,1];case 1:u=void 0,s={pdbId:t.label.toLowerCase()},i.label=2;case 2:return i.trys.push([2,4,,5]),[4,n.request(o||d.RuntimeContext.Synchronous,a.default,s)];case 3:return u=i.sent(),[3,5];case 4:return c=i.sent(),console.error(c),[2,!1];case 5:if(!u||!u.assemblies)return[2,!1];r=w(u.assemblies),i.label=6;case 6:return t.customProperties.add(e.Descriptor),t._staticPropertyData.__RCSBAssemblySymmetry__=e(r),[2,!0]}})})}function n(e){return e._staticPropertyData.__RCSBAssemblySymmetry__}e.is=function(e){return"rcsb_assembly_symmetry"===e["@type"]},e.GraphQLEndpointURL="//rest-dev.rcsb.org/graphql",e.Schema={rcsb_assembly_symmetry_info:{updated_datetime_utc:u.Column.Schema.str},rcsb_assembly_symmetry:{id:v,assembly_id:y,kind:g(y),stoichiometry:S(",",function(e){return e}),symbol:y,type:g(y),oligomeric_state:y},rcsb_assembly_symmetry_cluster:{id:v,symmetry_id:v,avg_rmsd:b},rcsb_assembly_symmetry_cluster_member:{cluster_id:v,asym_id:y,pdbx_struct_oper_list_ids:S(",",function(e){return e})},rcsb_assembly_symmetry_axis:{symmetry_id:v,order:v,start:_(3),end:_(3)}},e.Descriptor=T,e.attachFromCifOrAPI=t,e.createAttachTask=function(a){var o=this;return function(u){return d.Task.create("RCSB Assembly Symmetry",function(s){return r(o,void 0,void 0,function(){return i(this,function(r){switch(r.label){case 0:return n(u)?[2,!0]:[4,t(u,new p.GraphQLClient(e.GraphQLEndpointURL,a),s)];case 1:return[2,r.sent()]}})})})}},e.get=n}(A=t.AssemblySymmetry||(t.AssemblySymmetry={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(515),i=n(289),a=n(539),o=n(160);t.StateTransforms={Data:r,Model:i,Volume:a,Representation:o}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(7);!function(e){function t(e){var t=new DataView(e.buffer);return Object.assign(e.subarray(0),{readInt8:function(e){return t.getInt8(e)},readUInt8:function(e){return t.getUint8(e)},writeInt8:function(e,n){return t.setInt8(n,e)},writeUInt8:function(e,n){return t.setUint8(n,e)},readInt16LE:function(e){return t.getInt16(e,!0)},readInt32LE:function(e){return t.getInt32(e,!0)},readUInt16LE:function(e){return t.getUint16(e,!0)},readUInt32LE:function(e){return t.getUint32(e,!0)},readFloatLE:function(e){return t.getFloat32(e,!0)},readDoubleLE:function(e){return t.getFloat64(e,!0)},writeInt16LE:function(e,n){return t.setInt16(n,e,!0)},writeInt32LE:function(e,n){return t.setInt32(n,e,!0)},writeUInt16LE:function(e,n){return t.setUint16(n,e,!0)},writeUInt32LE:function(e,n){return t.setUint32(n,e,!0)},writeFloatLE:function(e,n){return t.setFloat32(n,e,!0)},writeDoubleLE:function(e,n){return t.setFloat64(n,e,!0)},readInt16BE:function(e){return t.getInt16(e,!1)},readInt32BE:function(e){return t.getInt32(e,!1)},readUInt16BE:function(e){return t.getUint16(e,!1)},readUInt32BE:function(e){return t.getUint32(e,!1)},readFloatBE:function(e){return t.getFloat32(e,!1)},readDoubleBE:function(e){return t.getFloat64(e,!1)},writeInt16BE:function(e,n){return t.setInt16(n,e,!1)},writeInt32BE:function(e,n){return t.setInt32(n,e,!1)},writeUInt16BE:function(e,n){return t.setUint16(n,e,!1)},writeUInt32BE:function(e,n){return t.setUint32(n,e,!1)},writeFloatBE:function(e,n){return t.setFloat32(n,e,!1)},writeDoubleBE:function(e,n){return t.setFloat64(n,e,!1)},copy:function(t,n,i,a){return n=r.defaults(n,0),i=r.defaults(i,0),a=r.defaults(a,e.length),t.set(e.subarray(i,a),n),a-i}})}function n(e,t,n,r,i){for(var a=0,o=n;a<o;a+=r)for(var u=0;u<r;u++)t[i+a+r-u-1]=e[i+a+u]}e.fromUint8Array=t,e.fromArrayBuffer=function(e){return t(new Uint8Array(e))},e.fromBuffer=function(e){return e},e.IsNativeEndianLittle=13330===new Uint16Array(new Uint8Array([18,52]).buffer)[0],e.flipByteOrder=n,e.flipByteOrderInPlace2=function(e,t,n){void 0===t&&(t=0);for(var r=new Int16Array(e,t,n),i=0,a=r.length;i<a;++i){var o=r[i];r[i]=(255&o)<<8|o>>8&255}},e.ensureLittleEndian=function(t,r,i,a,o){e.IsNativeEndianLittle||!i||a<=1||n(t,r,i,a,o)}}(t.SimpleBuffer||(t.SimpleBuffer={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.memoizeLatest=function(e){var t=void 0,n=void 0;return function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];if(!t||t.length!==r.length)return t=r,n=e.apply(void 0,r);for(var a=0,o=r.length;a<o;a++)if(r[a]!==t[a])return t=r,n=e.apply(void 0,r);return n}},t.memoize1=function(e){var t=new Map;return function(n){if(t.has(n))return t.get(n);var r=e(n);return t.set(n,r),r}}},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{s(r.next(e))}catch(e){a(e)}}function u(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,u)}s((r=r.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(27),u=n(11),s=n(26),c=n(26),l=n(3),f=n(53),d=n(9),p=n(273),h=n(86);!function(e){e.getDefaultParams=function(e,t,n,i){var a=e.structureRepresentation.registry.get(t),o={structure:n},u=e.structureRepresentation.themeCtx.colorThemeRegistry.get(a.defaultColorTheme).getParams(o),s=e.structureRepresentation.themeCtx.sizeThemeRegistry.get(a.defaultSizeTheme).getParams(o),c=l.ParamDefinition.getDefaultValues(a.getParams(e.structureRepresentation.themeCtx,n));return{type:{name:t,params:i?r({},c,i):c},colorTheme:{name:a.defaultColorTheme,params:l.ParamDefinition.getDefaultValues(u)},sizeTheme:{name:a.defaultSizeTheme,params:l.ParamDefinition.getDefaultValues(s)}}},e.getDefaultParamsStatic=function(e,t,n){var i=e.structureRepresentation.registry.get(t),a=e.structureRepresentation.themeCtx.colorThemeRegistry.get(i.defaultColorTheme).defaultValues,o=e.structureRepresentation.themeCtx.sizeThemeRegistry.get(i.defaultSizeTheme).defaultValues;return{type:{name:t,params:n?r({},i.defaultValues,n):i.defaultValues},colorTheme:{name:i.defaultColorTheme,params:a},sizeTheme:{name:i.defaultSizeTheme,params:o}}}}(t.StructureRepresentation3DHelpers||(t.StructureRepresentation3DHelpers={}));var m=s.PluginStateTransform.BuiltIn({name:"structure-representation-3d",display:"3D Representation",from:c.PluginStateObject.Molecule.Structure,to:c.PluginStateObject.Molecule.Representation3D,params:function(e,t){var n=t.structureRepresentation,r=n.registry,i=n.themeCtx,a=r.get(r.default.name);if(!e)return{type:l.ParamDefinition.Mapped(r.default.name,r.types,function(e){return l.ParamDefinition.Group(r.get(e).getParams(i,d.Structure.Empty))}),colorTheme:l.ParamDefinition.Mapped(a.defaultColorTheme,i.colorThemeRegistry.types,function(e){return l.ParamDefinition.Group(i.colorThemeRegistry.get(e).getParams({structure:d.Structure.Empty}))}),sizeTheme:l.ParamDefinition.Mapped(a.defaultSizeTheme,i.sizeThemeRegistry.types,function(e){return l.ParamDefinition.Group(i.sizeThemeRegistry.get(e).getParams({structure:d.Structure.Empty}))})};var o={structure:e.data};return{type:l.ParamDefinition.Mapped(r.default.name,r.types,function(t){return l.ParamDefinition.Group(r.get(t).getParams(i,e.data))}),colorTheme:l.ParamDefinition.Mapped(a.defaultColorTheme,i.colorThemeRegistry.getApplicableTypes(o),function(e){return l.ParamDefinition.Group(i.colorThemeRegistry.get(e).getParams(o))}),sizeTheme:l.ParamDefinition.Mapped(a.defaultSizeTheme,i.sizeThemeRegistry.types,function(e){return l.ParamDefinition.Group(i.sizeThemeRegistry.get(e).getParams(o))})}}})({canAutoUpdate:function(e){var t=e.oldParams,n=e.newParams;return t.type.name===n.type.name},apply:function(e,t){var n=this,o=e.a,s=e.params;return u.Task.create("Structure Representation",function(e){return i(n,void 0,void 0,function(){var n,i,u;return a(this,function(a){switch(a.label){case 0:return n=t.structureRepresentation.registry.get(s.type.name),i=s.type.params||{},(u=n.factory(r({webgl:t.canvas3d.webgl},t.structureRepresentation.themeCtx),n.getParams)).setTheme(f.createTheme(t.structureRepresentation.themeCtx,{structure:o.data},s)),[4,u.createOrUpdate(i,o.data).runInContext(e)];case 1:return a.sent(),[2,new c.PluginStateObject.Molecule.Representation3D(u,{label:n.label})]}})})})},update:function(e,t){var n=this,s=e.a,c=e.b,l=e.oldParams,d=e.newParams;return u.Task.create("Structure Representation",function(e){return i(n,void 0,void 0,function(){var n;return a(this,function(i){switch(i.label){case 0:return d.type.name!==l.type.name?[2,o.StateTransformer.UpdateResult.Recreate]:(n=r({},c.data.props,d.type.params),c.data.setTheme(f.createTheme(t.structureRepresentation.themeCtx,{structure:s.data},d)),[4,c.data.createOrUpdate(n,s.data).runInContext(e)]);case 1:return i.sent(),[2,o.StateTransformer.UpdateResult.Updated]}})})})}});t.StructureRepresentation3D=m;var y,v=s.PluginStateTransform.BuiltIn({name:"explode-structure-representation-3d",display:"Explode 3D Representation",from:c.PluginStateObject.Molecule.Representation3D,to:p.ExplodeRepresentation3D.Obj,params:p.ExplodeRepresentation3D.Params})({canAutoUpdate:function(){return!0},apply:function(e,t){var n=e.params;return new p.ExplodeRepresentation3D.Obj(new p.ExplodeRepresentation3D.Behavior(t,n),{label:"Explosion T = "+n.t.toFixed(2)})},update:function(e){var t=this,n=e.b,r=e.newParams;return u.Task.create("Update Explosion",function(){return i(t,void 0,void 0,function(){var e;return a(this,function(t){switch(t.label){case 0:return[4,n.data.update(r)];case 1:return e=t.sent(),n.label="Explosion T = "+r.t.toFixed(2),[2,e?o.StateTransformer.UpdateResult.Updated:o.StateTransformer.UpdateResult.Unchanged]}})})})}});t.ExplodeStructureRepresentation3D=v,function(e){e.getDefaultParams=function(e,t,n,i){var a=e.volumeRepresentation.registry.get(t),o={volume:n},u=e.volumeRepresentation.themeCtx.colorThemeRegistry.get(a.defaultColorTheme).getParams(o),s=e.volumeRepresentation.themeCtx.sizeThemeRegistry.get(a.defaultSizeTheme).getParams(o),c=l.ParamDefinition.getDefaultValues(a.getParams(e.volumeRepresentation.themeCtx,n));return{type:{name:t,params:i?r({},c,i):c},colorTheme:{name:a.defaultColorTheme,params:l.ParamDefinition.getDefaultValues(u)},sizeTheme:{name:a.defaultSizeTheme,params:l.ParamDefinition.getDefaultValues(s)}}},e.getDefaultParamsStatic=function(e,t,n,i,a,o,u){var s=e.volumeRepresentation.registry.get(t),c=e.volumeRepresentation.themeCtx.colorThemeRegistry.get(i||s.defaultColorTheme),l=e.volumeRepresentation.themeCtx.sizeThemeRegistry.get(o||s.defaultSizeTheme);return{type:{name:t,params:n?r({},s.defaultValues,n):s.defaultValues},colorTheme:{name:s.defaultColorTheme,params:a?r({},c.defaultValues,a):c.defaultValues},sizeTheme:{name:s.defaultSizeTheme,params:u?r({},l.defaultValues,u):l.defaultValues}}},e.getDescription=function(e){return e.isoValue&&h.VolumeIsoValue.toString(e.isoValue)}}(y=t.VolumeRepresentation3DHelpers||(t.VolumeRepresentation3DHelpers={}));var b=s.PluginStateTransform.BuiltIn({name:"volume-representation-3d",display:"3D Representation",from:c.PluginStateObject.Volume.Data,to:c.PluginStateObject.Volume.Representation3D,params:function(e,t){var n=t.volumeRepresentation,r=n.registry,i=n.themeCtx,a=r.get(r.default.name);if(!e)return{type:l.ParamDefinition.Mapped(r.default.name,r.types,function(e){return l.ParamDefinition.Group(r.get(e).getParams(i,h.VolumeData.One))}),colorTheme:l.ParamDefinition.Mapped(a.defaultColorTheme,i.colorThemeRegistry.types,function(e){return l.ParamDefinition.Group(i.colorThemeRegistry.get(e).getParams({volume:h.VolumeData.One}))}),sizeTheme:l.ParamDefinition.Mapped(a.defaultSizeTheme,i.sizeThemeRegistry.types,function(e){return l.ParamDefinition.Group(i.sizeThemeRegistry.get(e).getParams({volume:h.VolumeData.One}))})};var o={volume:e.data};return{type:l.ParamDefinition.Mapped(r.default.name,r.types,function(t){return l.ParamDefinition.Group(r.get(t).getParams(i,e.data))}),colorTheme:l.ParamDefinition.Mapped(a.defaultColorTheme,i.colorThemeRegistry.getApplicableTypes(o),function(e){return l.ParamDefinition.Group(i.colorThemeRegistry.get(e).getParams(o))}),sizeTheme:l.ParamDefinition.Mapped(a.defaultSizeTheme,i.sizeThemeRegistry.types,function(e){return l.ParamDefinition.Group(i.sizeThemeRegistry.get(e).getParams(o))})}}})({canAutoUpdate:function(e){var t=e.oldParams,n=e.newParams;return t.type.name===n.type.name},apply:function(e,t){var n=this,o=e.a,s=e.params;return u.Task.create("Volume Representation",function(e){return i(n,void 0,void 0,function(){var n,i,u;return a(this,function(a){switch(a.label){case 0:return n=t.volumeRepresentation.registry.get(s.type.name),i=s.type.params||{},(u=n.factory(r({webgl:t.canvas3d.webgl},t.volumeRepresentation.themeCtx),n.getParams)).setTheme(f.createTheme(t.volumeRepresentation.themeCtx,{volume:o.data},s)),[4,u.createOrUpdate(i,o.data).runInContext(e)];case 1:return a.sent(),[2,new c.PluginStateObject.Volume.Representation3D(u,{label:n.label,description:y.getDescription(i)})]}})})})},update:function(e,t){var n=this,s=e.a,c=e.b,l=e.oldParams,d=e.newParams;return u.Task.create("Volume Representation",function(e){return i(n,void 0,void 0,function(){var n;return a(this,function(i){switch(i.label){case 0:return d.type.name!==l.type.name?[2,o.StateTransformer.UpdateResult.Recreate]:(n=r({},c.data.props,d.type.params),c.data.setTheme(f.createTheme(t.volumeRepresentation.themeCtx,{volume:s.data},d)),[4,c.data.createOrUpdate(n,s.data).runInContext(e)]);case 1:return i.sent(),c.description=y.getDescription(n),[2,o.StateTransformer.UpdateResult.Updated]}})})})}});t.VolumeRepresentation3D=b},function(e,t,n){"use strict";n.d(t,"a",function(){return c}),n.d(t,"b",function(){return f});var r=n(0),i=n(12),a=n(4),o=n(1),u=n(10),s=n(101),c=function(e){function t(t,n){var r=e.call(this)||this;return r.source=t,r.subjectFactory=n,r._refCount=0,r._isComplete=!1,r}return r.a(t,e),t.prototype._subscribe=function(e){return this.getSubject().subscribe(e)},t.prototype.getSubject=function(){var e=this._subject;return e&&!e.isStopped||(this._subject=this.subjectFactory()),this._subject},t.prototype.connect=function(){var e=this._connection;return e||(this._isComplete=!1,(e=this._connection=new u.a).add(this.source.subscribe(new d(this.getSubject(),this))),e.closed?(this._connection=null,e=u.a.EMPTY):this._connection=e),e},t.prototype.refCount=function(){return Object(s.a)()(this)},t}(a.a),l=c.prototype,f={operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:l._subscribe},_isComplete:{value:l._isComplete,writable:!0},getSubject:{value:l.getSubject},connect:{value:l.connect},refCount:{value:l.refCount}},d=function(e){function t(t,n){var r=e.call(this,t)||this;return r.connectable=n,r}return r.a(t,e),t.prototype._error=function(t){this._unsubscribe(),e.prototype._error.call(this,t)},t.prototype._complete=function(){this.connectable._isComplete=!0,this._unsubscribe(),e.prototype._complete.call(this)},t.prototype._unsubscribe=function(){var e=this.connectable;if(e){this.connectable=null;var t=e._connection;e._refCount=0,e._subject=null,e._connection=null,t&&t.unsubscribe()}},t}(i.b);o.a},function(e,t,n){"use strict";n.d(t,"a",function(){return o});var r=n(0),i=n(12),a=n(48),o=function(e){function t(t){var n=e.call(this)||this;return n._value=t,n}return r.a(t,e),Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!0,configurable:!0}),t.prototype._subscribe=function(t){var n=e.prototype._subscribe.call(this,t);return n&&!n.closed&&t.next(this._value),n},t.prototype.getValue=function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new a.a;return this._value},t.prototype.next=function(t){e.prototype.next.call(this,this._value=t)},t}(i.a)},function(e,t,n){"use strict";n.d(t,"b",function(){return o}),n.d(t,"a",function(){return s});var r=n(0),i=n(1),a=n(41);function o(e,t){return void 0===t&&(t=0),function(n){return n.lift(new u(e,t))}}var u=function(){function e(e,t){void 0===t&&(t=0),this.scheduler=e,this.delay=t}return e.prototype.call=function(e,t){return t.subscribe(new s(e,this.scheduler,this.delay))},e}(),s=function(e){function t(t,n,r){void 0===r&&(r=0);var i=e.call(this,t)||this;return i.scheduler=n,i.delay=r,i}return r.a(t,e),t.dispatch=function(e){var t=e.notification,n=e.destination;t.observe(n),this.unsubscribe()},t.prototype.scheduleMessage=function(e){this.destination.add(this.scheduler.schedule(t.dispatch,this.delay,new c(e,this.destination)))},t.prototype._next=function(e){this.scheduleMessage(a.a.createNext(e))},t.prototype._error=function(e){this.scheduleMessage(a.a.createError(e)),this.unsubscribe()},t.prototype._complete=function(){this.scheduleMessage(a.a.createComplete()),this.unsubscribe()},t}(i.a),c=function(){return function(e,t){this.notification=e,this.destination=t}}()},function(e,t,n){"use strict";function r(){return Error.call(this),this.message="Timeout has occurred",this.name="TimeoutError",this}n.d(t,"a",function(){return i}),r.prototype=Object.create(Error.prototype);var i=r},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var r=n(106);function i(){return Object(r.a)(1)}},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var r=n(4),i=n(20),a=n(106),o=n(28);function u(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=Number.POSITIVE_INFINITY,u=null,s=e[e.length-1];return Object(i.a)(s)?(u=e.pop(),e.length>1&&"number"==typeof e[e.length-1]&&(n=e.pop())):"number"==typeof s&&(n=e.pop()),null===u&&1===e.length&&e[0]instanceof r.a?e[0]:Object(a.a)(n)(Object(o.a)(e,u))}},function(e,t,n){"use strict";n.d(t,"a",function(){return s});var r=n(0),i=n(15),a=n(28),o=n(8),u=n(6);function s(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(1===e.length){if(!Object(i.a)(e[0]))return e[0];e=e[0]}return Object(a.a)(e,void 0).lift(new c)}var c=function(){function e(){}return e.prototype.call=function(e,t){return t.subscribe(new l(e))},e}(),l=function(e){function t(t){var n=e.call(this,t)||this;return n.hasFirst=!1,n.observables=[],n.subscriptions=[],n}return r.a(t,e),t.prototype._next=function(e){this.observables.push(e)},t.prototype._complete=function(){var e=this.observables,t=e.length;if(0===t)this.destination.complete();else{for(var n=0;n<t&&!this.hasFirst;n++){var r=e[n],i=Object(u.a)(this,r,r,n);this.subscriptions&&this.subscriptions.push(i),this.add(i)}this.observables=null}},t.prototype.notifyNext=function(e,t,n,r,i){if(!this.hasFirst){this.hasFirst=!0;for(var a=0;a<this.subscriptions.length;a++)if(a!==n){var o=this.subscriptions[a];o.unsubscribe(),this.remove(o)}this.subscriptions=null}this.destination.next(t)},t}(o.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var r=n(4),i=n(14),a=n(66),o=n(20);function u(e,t,n){void 0===e&&(e=0);var u=-1;return Object(a.a)(t)?u=Number(t)<1?1:Number(t):Object(o.a)(t)&&(n=t),Object(o.a)(n)||(n=i.a),new r.a(function(t){var r=Object(a.a)(e)?e:+e-n.now();return n.schedule(s,r,{index:0,period:u,subscriber:t})})}function s(e){var t=e.index,n=e.period,r=e.subscriber;if(r.next(t),!r.closed){if(-1===n)return r.complete();e.index=t+1,this.schedule(e,n)}}},function(e,t,n){"use strict";var r=n(0),i=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r}return r.a(t,e),t.prototype.schedule=function(t,n){return void 0===n&&(n=0),n>0?e.prototype.schedule.call(this,t,n):(this.delay=n,this.state=t,this.scheduler.flush(this),this)},t.prototype.execute=function(t,n){return n>0||this.closed?e.prototype.execute.call(this,t,n):this._execute(t,n)},t.prototype.requestAsyncId=function(t,n,r){return void 0===r&&(r=0),null!==r&&r>0||null===r&&this.delay>0?e.prototype.requestAsyncId.call(this,t,n,r):t.flush(this)},t}(n(65).a),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.a(t,e),t}(n(63).a);n.d(t,"a",function(){return o});var o=new a(i)},function(e,t,n){"use strict";function r(e){return null!==e&&"object"==typeof e}n.d(t,"a",function(){return r})},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var r=n(0),i=function(e){function t(t,n){var r=e.call(this)||this;return r.subject=t,r.subscriber=n,r.closed=!1,r}return r.a(t,e),t.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var e=this.subject,t=e.observers;if(this.subject=null,t&&0!==t.length&&!e.isStopped&&!e.closed){var n=t.indexOf(this.subscriber);-1!==n&&t.splice(n,1)}}},t}(n(10).a)},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var r=function(e){return function(t){for(var n=0,r=e.length;n<r&&!t.closed;n++)t.next(e[n]);t.closed||t.complete()}}},function(e,t,n){"use strict";n.d(t,"a",function(){return p});var r=n(4),i=n(172),a=n(177),o=n(178),u=n(174),s=n(175),c=n(176),l=n(170),f=n(42),d=n(47),p=function(e){if(e instanceof r.a)return function(t){return e._isScalar?(t.next(e.value),void t.complete()):e.subscribe(t)};if(e&&"function"==typeof e[d.a])return Object(u.a)(e);if(Object(s.a)(e))return Object(i.a)(e);if(Object(c.a)(e))return Object(a.a)(e);if(e&&"function"==typeof e[f.a])return Object(o.a)(e);var t=Object(l.a)(e)?"an invalid object":"'"+e+"'";throw new TypeError("You provided "+t+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.")}},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var r=n(47),i=function(e){return function(t){var n=e[r.a]();if("function"!=typeof n.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return n.subscribe(t)}}},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var r=function(e){return e&&"number"==typeof e.length&&"function"!=typeof e}},function(e,t,n){"use strict";function r(e){return!!e&&"function"!=typeof e.subscribe&&"function"==typeof e.then}n.d(t,"a",function(){return r})},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var r=n(67),i=function(e){return function(t){return e.then(function(e){t.closed||(t.next(e),t.complete())},function(e){return t.error(e)}).then(null,r.a),t}}},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var r=n(42),i=function(e){return function(t){for(var n=e[r.a]();;){var i=n.next();if(i.done){t.complete();break}if(t.next(i.value),t.closed)break}return"function"==typeof n.return&&t.add(function(){n.return&&n.return()}),t}}},function(e,t){var n,r,i=e.exports={};function a(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function u(e){if(n===setTimeout)return setTimeout(e,0);if((n===a||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:a}catch(e){n=a}try{r="function"==typeof clearTimeout?clearTimeout:o}catch(e){r=o}}();var s,c=[],l=!1,f=-1;function d(){l&&s&&(l=!1,s.length?c=s.concat(c):f=-1,c.length&&p())}function p(){if(!l){var e=u(d);l=!0;for(var t=c.length;t;){for(s=c,c=[];++f<t;)s&&s[f].run();f=-1,t=c.length}s=null,l=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===o||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function h(e,t){this.fun=e,this.array=t}function m(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.push(new h(e,t)),1!==c.length||l||u(p)},h.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=m,i.addListener=m,i.once=m,i.off=m,i.removeListener=m,i.removeAllListeners=m,i.emit=m,i.prependListener=m,i.prependOnceListener=m,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(218),a=n(113);!function(e){function t(){var e=[.1,0,0];return e[0]=0,e}function n(e,n,r){var i=t();return i[0]=e,i[1]=n,i[2]=r,i}function r(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function o(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e}function u(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e}function s(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e}function c(e){var t=e[0],n=e[1],r=e[2];return t*t+n*n+r*r}function l(e,t){var n=t[0],r=t[1],i=t[2],a=n*n+r*r+i*i;return a>0&&(a=1/Math.sqrt(a),e[0]=t[0]*a,e[1]=t[1]*a,e[2]=t[2]*a),e}function f(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function d(e,t,n){var r=t[0],i=t[1],a=t[2],o=n[0],u=n[1],s=n[2];return e[0]=i*s-a*u,e[1]=a*o-r*s,e[2]=r*u-i*o,e}e.zero=t,e.clone=function(e){var n=t();return n[0]=e[0],n[1]=e[1],n[2]=e[2],n},e.hasNaN=function(e){return isNaN(e[0])||isNaN(e[1])||isNaN(e[2])},e.fromObj=function(e){return n(e.x,e.y,e.z)},e.toObj=function(e){return{x:e[0],y:e[1],z:e[2]}},e.fromArray=function(e,t,n){return e[0]=t[n+0],e[1]=t[n+1],e[2]=t[n+2],e},e.toArray=function(e,t,n){t[n+0]=e[0],t[n+1]=e[1],t[n+2]=e[2]},e.create=n,e.ofArray=function(e){var n=t();return n[0]=e[0],n[1]=e[1],n[2]=e[2],n},e.set=function(e,t,n,r){return e[0]=t,e[1]=n,e[2]=r,e},e.copy=r,e.add=o,e.sub=u,e.mul=function(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e},e.div=function(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e},e.scale=s,e.scaleAndAdd=function(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e},e.scaleAndSub=function(e,t,n,r){return e[0]=t[0]-n[0]*r,e[1]=t[1]-n[1]*r,e[2]=t[2]-n[2]*r,e},e.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e},e.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e},e.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e},e.min=function(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e},e.max=function(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e},e.distance=function(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2];return Math.sqrt(n*n+r*r+i*i)},e.squaredDistance=function(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2];return n*n+r*r+i*i},e.magnitude=function(e){var t=e[0],n=e[1],r=e[2];return Math.sqrt(t*t+n*n+r*r)},e.squaredMagnitude=c,e.setMagnitude=function(t,n,r){return e.scale(t,e.normalize(t,n),r)},e.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e},e.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e},e.normalize=l,e.dot=f,e.cross=d,e.lerp=function(e,t,n,r){var i=t[0],a=t[1],o=t[2];return e[0]=i+r*(n[0]-i),e[1]=a+r*(n[1]-a),e[2]=o+r*(n[2]-o),e};var p=e.zero();e.slerp=function(t,n,r,i){var o=a.clamp(e.dot(n,r),-1,1),u=Math.acos(o)*i;return e.scaleAndAdd(p,r,n,-o),e.normalize(p,p),e.add(t,e.scale(t,n,Math.cos(u)),e.scale(p,p,Math.sin(u)))},e.hermite=function(e,t,n,r,i,a){var o=a*a,u=o*(2*a-3)+1,s=o*(a-2)+a,c=o*(a-1),l=o*(3-2*a);return e[0]=t[0]*u+n[0]*s+r[0]*c+i[0]*l,e[1]=t[1]*u+n[1]*s+r[1]*c+i[1]*l,e[2]=t[2]*u+n[2]*s+r[2]*c+i[2]*l,e},e.bezier=function(e,t,n,r,i,a){var o=1-a,u=o*o,s=a*a,c=u*o,l=3*a*u,f=3*s*o,d=s*a;return e[0]=t[0]*c+n[0]*l+r[0]*f+i[0]*d,e[1]=t[1]*c+n[1]*l+r[1]*f+i[1]*d,e[2]=t[2]*c+n[2]*l+r[2]*f+i[2]*d,e},e.spline=function(e,t,n,r,i,o,u){return e[0]=a.spline(t[0],n[0],r[0],i[0],o,u),e[1]=a.spline(t[1],n[1],r[1],i[1],o,u),e[2]=a.spline(t[2],n[2],r[2],i[2],o,u),e},e.random=function(e,t){var n=2*Math.random()*Math.PI,r=2*Math.random()-1,i=Math.sqrt(1-r*r)*t;return e[0]=Math.cos(n)*i,e[1]=Math.sin(n)*i,e[2]=r*t,e},e.transformMat4=function(e,t,n){var r=t[0],i=t[1],a=t[2],o=1/(n[3]*r+n[7]*i+n[11]*a+n[15]||1);return e[0]=(n[0]*r+n[4]*i+n[8]*a+n[12])*o,e[1]=(n[1]*r+n[5]*i+n[9]*a+n[13])*o,e[2]=(n[2]*r+n[6]*i+n[10]*a+n[14])*o,e},e.transformMat4Offset=function(e,t,n,r,i,a){var o=t[0+i],u=t[1+i],s=t[2+i],c=1/(n[3+a]*o+n[7+a]*u+n[11+a]*s+n[15+a]||1);return e[0+r]=(n[0+a]*o+n[4+a]*u+n[8+a]*s+n[12+a])*c,e[1+r]=(n[1+a]*o+n[5+a]*u+n[9+a]*s+n[13+a])*c,e[2+r]=(n[2+a]*o+n[6+a]*u+n[10+a]*s+n[14+a])*c,e},e.transformMat3=function(e,t,n){var r=t[0],i=t[1],a=t[2];return e[0]=r*n[0]+i*n[3]+a*n[6],e[1]=r*n[1]+i*n[4]+a*n[7],e[2]=r*n[2]+i*n[5]+a*n[8],e},e.transformQuat=function(e,t,n){var r=t[0],i=t[1],a=t[2],o=n[0],u=n[1],s=n[2],c=n[3],l=c*r+u*a-s*i,f=c*i+s*r-o*a,d=c*a+o*i-u*r,p=-o*r-u*i-s*a;return e[0]=l*c+p*-o+f*-s-d*-u,e[1]=f*c+p*-u+d*-o-l*-s,e[2]=d*c+p*-s+l*-u-f*-o,e};var h=t(),m=t();function y(e,t){r(h,e),r(m,t),l(h,h),l(m,m);var n=f(h,m);return n>1?0:n<-1?Math.PI:Math.acos(n)}e.angle=y,e.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},e.equals=function(e,t){var n=e[0],r=e[1],i=e[2],a=t[0],o=t[1],u=t[2];return Math.abs(n-a)<=1e-6*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(r-o)<=1e-6*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(i-u)<=1e-6*Math.max(1,Math.abs(i),Math.abs(u))};var v=t();e.makeRotation=function(e,t,n){var r=y(t,n);if(Math.abs(r)<1e-4)return i.default.setIdentity(e);var a=d(v,t,n);return i.default.fromRotation(e,r,a)},e.isZero=function(e){return 0===e[0]&&0===e[1]&&0===e[2]},e.projectPointOnVector=function(e,t,n,i){u(e,r(e,t),i);var a=f(n,e)/c(n);return o(e,s(e,r(e,n),a),i)},e.orthogonalize=function(e,t,n){return l(e,d(e,d(e,t,n),t))};var b=t(),g=t();e.triangleNormal=function(e,t,n,r){return u(b,n,t),u(g,r,t),l(e,d(e,b,g))},e.toString=function(e){return"["+e[0]+" "+e[1]+" "+e[2]+"]"}}(r||(r={})),t.default=r},function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(76);!function(t){var n="undefined"!=typeof btoa?btoa:function(t){return e.from(t).toString("base64")},r=[];t.create22=function(){for(var e=+new Date+i.now(),t=0;t<16;t++)r[t]=String.fromCharCode((e+255*Math.random())%255|0),e=Math.floor(e/255);return n(r.join("")).replace(/\+/g,"-").replace(/\//g,"_").substr(0,22)},t.createv4=function(){var e=+new Date+i.now();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?n:3&n|8).toString(16)})}}(r||(r={})),t.default=r}).call(this,n(307).Buffer)},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{s(r.next(e))}catch(e){a(e)}}function u(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,u)}s((r=r.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}};Object.defineProperty(t,"__esModule",{value:!0});var a=n(313),o=n(336),u=n(225),s=n(226),c=n(11);function l(e){e.bindFramebuffer(e.FRAMEBUFFER,null)}t.getGLContext=function(e,t){function n(n){try{return e.getContext(n,t)}catch(e){return null}}return n("webgl2")||n("webgl")||n("experimental-webgl")};var f=new Uint8Array(4);function d(e,t,n){e.getSyncParameter(t,e.SYNC_STATUS)===e.SIGNALED?(e.deleteSync(t),n()):c.Scheduler.setImmediate(d,e,t,n)}function p(e,t){var n=e.fenceSync(e.SYNC_GPU_COMMANDS_COMPLETE,0);n?c.Scheduler.setImmediate(d,e,n,t):(console.warn("Could not create a WebGLSync object"),e.readPixels(0,0,1,1,e.RGBA,e.UNSIGNED_BYTE,f),t())}var h=!1;function m(e){e.readPixels(0,0,1,1,e.RGBA,e.UNSIGNED_BYTE,f)}t.createImageData=function(e,t,n){for(var r=4*t,i=n,a=new Uint8ClampedArray(t*n*4),o=0,u=i/2;o<u;++o)for(var s=0,c=r;s<c;++s){var l=o*r+s,f=(i-o-1)*r+s;a[l]=e[f],a[f]=e[l]}return new ImageData(a,t,n)},t.createContext=function(e){var t=this,n=u.getInstancedArrays(e);if(null===n)throw new Error('Could not find support for "instanced_arrays"');var c=u.getStandardDerivatives(e);if(null===c)throw new Error('Could not find support for "standard_derivatives"');var f=u.getBlendMinMax(e);if(null===f)throw new Error('Could not find support for "blend_minmax"');var d=u.getTextureFloat(e);if(null===d)throw new Error('Could not find support for "texture_float"');var y=u.getTextureFloatLinear(e);if(null===y)throw new Error('Could not find support for "texture_float_linear"');var v=u.getElementIndexUint(e);null===v&&console.warn('Could not find support for "element_index_uint"');var b=u.getVertexArrayObject(e);null===b&&console.log('Could not find support for "vertex_array_object"');var g=u.getFragDepth(e);null===g&&console.log('Could not find support for "frag_depth"');var _,S=o.createShaderCache(),C=a.createProgramCache(),x=s.createFramebufferCache(),w={maxTextureSize:e.getParameter(e.MAX_TEXTURE_SIZE),maxDrawBuffers:u.isWebGL2(e)?e.getParameter(e.MAX_DRAW_BUFFERS):0,maxVertexTextureImageUnits:e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS)};if(w.maxVertexTextureImageUnits<4)throw new Error('Need "MAX_VERTEX_TEXTURE_IMAGE_UNITS" >= 4');if(u.isWebGL2(e)){var P=e.createBuffer(),T=void 0,A=void 0,E=!1,k=function(){e.bindBuffer(e.PIXEL_PACK_BUFFER,P),e.getBufferSubData(e.PIXEL_PACK_BUFFER,0,T),e.bindBuffer(e.PIXEL_PACK_BUFFER,null),E=!1,A(),A=void 0,T=void 0};_=function(t,n,r,i,a){return new Promise(function(o,u){E?u("Can not call multiple readPixelsAsync at the same time"):(E=!0,e.bindBuffer(e.PIXEL_PACK_BUFFER,P),e.bufferData(e.PIXEL_PACK_BUFFER,r*i*4,e.STREAM_READ),e.readPixels(t,n,r,i,e.RGBA,e.UNSIGNED_BYTE,0),e.bindBuffer(e.PIXEL_PACK_BUFFER,null),A=o,T=a,p(e,k))})}}else _=function(n,a,o,u,s){return r(t,void 0,void 0,function(){return i(this,function(t){return e.readPixels(n,a,o,u,e.RGBA,e.UNSIGNED_BYTE,s),[2]})})};return{gl:e,isWebGL2:u.isWebGL2(e),extensions:{instancedArrays:n,standardDerivatives:c,blendMinMax:f,textureFloat:d,textureFloatLinear:y,elementIndexUint:v,vertexArrayObject:b,fragDepth:g},get pixelRatio(){return"undefined"!=typeof window?window.devicePixelRatio:1},shaderCache:S,programCache:C,framebufferCache:x,currentProgramId:-1,bufferCount:0,framebufferCount:0,renderbufferCount:0,textureCount:0,vaoCount:0,drawCount:0,instanceCount:0,instancedDrawCount:0,get maxTextureSize(){return w.maxTextureSize},get maxDrawBuffers(){return w.maxDrawBuffers},unbindFramebuffer:function(){return l(e)},readPixels:function(t,n,r,i,a){e.readPixels(t,n,r,i,e.RGBA,e.UNSIGNED_BYTE,a)},readPixelsAsync:_,waitForGpuCommandsComplete:function(){return function(e){return new Promise(function(t){u.isWebGL2(e)?p(e,t):(h||(console.info("Sync object not supported in WebGL"),h=!0),m(e),t())})}(e)},waitForGpuCommandsCompleteSync:function(){return m(e)},destroy:function(){!function(e){for(var t=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),n=0;n<t;++n)e.activeTexture(e.TEXTURE0+n),e.bindTexture(e.TEXTURE_2D,null),e.bindTexture(e.TEXTURE_CUBE_MAP,null);var r=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,r);var i=e.getParameter(e.MAX_VERTEX_ATTRIBS);for(n=0;n<i;++n)e.vertexAttribPointer(n,1,e.FLOAT,!1,0,0);e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),e.bindRenderbuffer(e.RENDERBUFFER,null),l(e)}(e),C.dispose(),S.dispose(),x.dispose()}}}},function(e,t,n){"use strict";function r(e,t){return void 0===t&&(t=0),{value:e,usageCount:t}}function i(e){return{free:function(){e.usageCount-=1},value:e.value}}Object.defineProperty(t,"__esModule",{value:!0}),t.createReference=r,t.createReferenceItem=i,t.createReferenceCache=function(e,t,n){var a=new Map;return{get:function(n,o){var u=e(o),s=a.get(u);return s||(s=r(t(n,o)),a.set(u,s)),s.usageCount+=1,i(s)},clear:function(){a.forEach(function(e,t){e.usageCount<=0&&(e.usageCount<0&&console.warn("Reference usageCount below zero."),n(e.value),a.delete(t))})},get count(){return a.size},dispose:function(){a.forEach(function(e){return n(e.value)}),a.clear()}}}},function(e,t,n){"use strict";function r(e,t,n){return e[t]-e[n]}function i(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function a(e,t,n,r){var i=n+r>>1;return t(e,n,r)>0?t(e,n,i)>0?t(e,i,r)>0?i:r:n:t(e,r,i)>0?t(e,i,n)>0?i:n:r}function o(e,t,n){var r=e.cmp,i=e.swap,o=e.data,u=e.parts,s=t+1,c=n;for(i(o,t,a(o,r,t,n));r(o,c,t)>0;)--c;for(var l=t+1;l<=c;l++){var f=r(o,l,t);if(f>0){for(i(o,l,c),--c;r(o,c,t)>0;)--c;l--}else 0===f&&(i(o,l,s),s++)}for(l=t;l<s;l++)i(o,l,t+c-l);u[0]=c-s+t+1,u[1]=c}function u(e,t,n){for(var r=e.data,i=e.cmp,a=e.swap,o=t+1;o<=n;o++)for(var u=o-1;u>=t&&i(r,u,u+1)>0;)a(r,u,u+1),u-=1}function s(e,t,n){for(var r=e.parts;t<n;){if(n-t<16)return void u(e,t,n);o(e,t,n);var i=r[0],a=r[1];i-t<n-a?(s(e,t,i-1),t=a+1):(s(e,a+1,n),n=i-1)}}function c(e,t,n,o){var u=n+1,s=o;i(e,n,a(e,r,n,o));for(var c=e[n];e[s]>c;)--s;for(var l=n+1;l<=s;l++){var f=e[l];if(f>c){for(i(e,l,s),--s;e[s]>c;)--s;l--}else f===c&&(i(e,l,u),++u)}for(l=n;l<u;l++)i(e,l,n+s-l);t[0]=s-u+n+1,t[1]=s}function l(e,t,n){for(var r=t+1;r<=n;r++){for(var i=e[r],a=r-1;a>=t&&e[a]>i;)e[a+1]=e[a],a-=1;e[a+1]=i}}function f(e,t,n,a){return void 0===a&&(a=r),a===r?function e(t,n,r,i){for(;r<i;){if(i-r<16)return void l(t,r,i);c(t,n,r,i);var a=n[0],o=n[1];a-r<i-o?(e(t,n,r,a-1),r=o+1):(e(t,n,o+1,i),i=a-1)}}(e,[0,0],t,n-1):s({data:e,cmp:a,swap:i,parts:[0,0]},t,n-1),e}Object.defineProperty(t,"__esModule",{value:!0}),t.arrayLess=r,t.arraySwap=i,t.sortArray=function(e,t){return void 0===t&&(t=r),f(e,0,e.length,t)},t.sortArrayRange=f,t.sort=function(e,t,n,r,i){return s({data:e,cmp:r,swap:i,parts:[0,0]},t,n-1),e}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{s(r.next(e))}catch(e){a(e)}}function u(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,u)}s((r=r.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}};Object.defineProperty(t,"__esModule",{value:!0});var a,o=n(337),u=n(229),s=n(34);!function(e){var t=function(){function e(e,t,n){this.name=e,this.f=t,this.onAbort=n,this.id=a()}return e.prototype.run=function(e,t){return e?o.ExecuteObservable(this,e,t||250):this.f(u.SyncRuntimeContext)},e.prototype.runAsChild=function(e,t){return e.isSynchronous?this.f(u.SyncRuntimeContext):o.ExecuteObservableChild(e,this,t)},e.prototype.runInContext=function(e){return e.isSynchronous?this.f(u.SyncRuntimeContext):o.ExecuteInContext(e,this)},e}();function n(e,n,r){return new t(e,n,r)}e.isAbort=function(e){return!!e&&!!e.isAborted},e.Aborted=function(e){return{isAborted:!0,reason:e}},e.create=n,e.constant=function(e,t){var a=this;return n(e,function(e){return r(a,void 0,void 0,function(){return i(this,function(e){return[2,t]})})})},e.fail=function(e,t){var a=this;return n(e,function(e){return r(a,void 0,void 0,function(){return i(this,function(e){throw new Error(t)})})})};var a=s.idFactory(0,1073741823)}(a||(a={})),t.Task=a},function(e,t,n){"use strict";function r(e){return e}Object.defineProperty(t,"__esModule",{value:!0}),t.Color=r,function(e){function t(e,t,n){return e<<16|t<<8|n}function n(e,t,n){return 255*e<<16|255*t<<8|255*n}e.toStyle=function(e){return"rgb("+(e>>16&255)+", "+(e>>8&255)+", "+(255&e)+")"},e.toHexString=function(e){return"0x"+("000000"+e.toString(16)).slice(-6)},e.toRgbString=function(t){return"RGB: "+e.toRgb(t).join(", ")},e.toRgb=function(e){return[e>>16&255,e>>8&255,255&e]},e.toRgbNormalized=function(e){return[(e>>16&255)/255,(e>>8&255)/255,(255&e)/255]},e.fromRgb=t,e.fromNormalizedRgb=n,e.fromArray=function(e,n){return t(e[n],e[n+1],e[n+2])},e.fromNormalizedArray=function(e,t){return n(e[t],e[t+1],e[t+2])},e.toArray=function(e,t,n){return t[n]=e>>16&255,t[n+1]=e>>8&255,t[n+2]=255&e,t},e.toArrayNormalized=function(e,t,n){return t[n]=(e>>16&255)/255,t[n+1]=(e>>8&255)/255,t[n+2]=(255&e)/255,t},e.interpolate=function(e,t,n){var r=e>>16&255,i=e>>8&255,a=255&e;return r+((t>>16&255)-r)*n<<16|i+((t>>8&255)-i)*n<<8|a+((255&t)-a)*n}}(r=t.Color||(t.Color={})),t.ColorTable=function(e){return e},t.ColorMap=function(e){return e}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Object.prototype.hasOwnProperty;function i(e,t){for(var n=!1,i=0,a=Object.keys(t);i<a.length;i++){var o=a[i];if(r.call(t,o)&&t[o]!==e[o]){n=!0;break}}return n?Object.assign({},e,t):e}function a(e,t){for(var n=e,r=0;r<t.length;r++)if(t[r]&&(n=i(e,t[r]))!==e){for(var a=r+1;a<t.length;a++)n=Object.assign(n,t[a]);break}return n}t.shallowMerge2=i,t.shallowEqual=function(e,t){if(!e)return!t;if(!t)return!1;var n=Object.keys(e);if(Object.keys(t).length!==n.length)return!1;for(var i=0,a=n;i<a.length;i++){var o=a[i];if(!r.call(e,o)||e[o]!==t[o])return!1}return!0},t.shallowMerge=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return a(e,t)},t.shallowMergeArray=a,t.deepClone=function e(t){if(null===t||"object"!=typeof t)return t;if(t instanceof Array){for(var n=[],i=0,a=t.length;i<a;i++)n[i]=e(t[i]);return n}if(t instanceof Object){for(var o in n={},t)r.call(t,o)&&(n[o]=e(t[o]));return n}throw new Error("Can't clone, type \""+typeof t+'" unsupported')}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(351);!function(e){e.Empty=i.Empty,e.ofUnsortedArray=i.ofUnsortedArray,e.ofSingleton=i.ofSingleton,e.ofSortedArray=i.ofSortedArray,e.ofRange=i.ofRange,e.ofBounds=function(e,t){return i.ofRange(e,t-1)},e.is=i.is,e.has=i.has,e.indexOf=i.indexOf,e.indexOfInInterval=i.indexOfInInterval,e.start=i.start,e.end=i.end,e.min=i.min,e.max=i.max,e.size=i.size,e.hashCode=i.hashCode,e.areEqual=i.areEqual,e.areIntersecting=i.areIntersecting,e.isSubset=i.isSubset,e.union=i.union,e.intersect=i.intersect,e.subtract=i.subtract,e.findPredecessorIndex=i.findPredecessorIndex,e.findPredecessorIndexInInterval=i.findPredecessorIndexInInterval,e.findRange=i.findRange,e.intersectionSize=i.intersectionSize,e.deduplicate=i.deduplicate,e.indicesOf=i.indicesOf}(r||(r={})),t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=function(){function e(e){this.xs=[],this.index=-1,this.length=0,this.hasNext=!1,this.length=e.length,this.hasNext=e.length>0,this.xs=e,this.index=-1,this.lastValue=e.length>0?e[0]:void 0}return e.prototype.move=function(){return++this.index,this.lastValue=this.xs[this.index],this.hasNext=this.index<this.length-1,this.lastValue},e}(),a=function(){function e(e,t){this.max=t,this.value=0,this.hasNext=!1,this.value=e-1,this.hasNext=t>=e}return e.prototype.move=function(){return++this.value,this.hasNext=this.value<this.max,this.value},e}(),o=function(){function e(e){this.value=e,this.hasNext=!0}return e.prototype.move=function(){return this.hasNext=!1,this.value},e}(),u=function(){function e(e,t){this.base=e,this.f=t,this.hasNext=!1,this.hasNext=e.hasNext}return e.prototype.move=function(){var e=this.f(this.base.move());return this.hasNext=this.base.hasNext,e},e}(),s=function(){function e(e,t){this.base=e,this.p=t,this.hasNext=this.findNext()}return e.prototype.move=function(){var e=this.next;return this.hasNext=this.findNext(),e},e.prototype.findNext=function(){for(;this.base.hasNext;)if(this.next=this.base.move(),this.p(this.next))return!0;return!1},e}();!function(e){e.Empty=new a(0,-1),e.Array=function(e){return new i(e)},e.Value=function(e){return new o(e)},e.Range=function(e,t){return new a(e,t)},e.map=function(e,t){return new u(e,t)},e.filter=function(e,t){return new s(e,t)},e.forEach=function(e,t,n){for(;e.hasNext;)if(t(e.move(),n))return n;return n}}(r||(r={})),t.default=r},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(359)),r(n(360)),r(n(361))},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(364)),r(n(243))},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i,a,o=n(241),u=n(368);t.classifyIntArray=function(e){return i.classify(e)},t.classifyFloatArray=function(e){return a.classify(e)},function(e){function t(e,t){return e>=0?Math.ceil((e+1)/t):Math.ceil((e+1)/(-t-1))}function n(e,n,r){var i=e.limit8,a=e.limit16;n.pack8+=t(r,i),n.pack16+=t(r,a),n.count+=1}function i(e,n){e.pack8+=t(n,127),e.pack16+=t(n,32767),e.count+=1}function a(e){return 4*e.count<2*e.pack16?{length:4*e.count,elem:4}:2*e.pack16<e.pack8?{length:2*e.pack16,elem:2}:{length:e.pack8,elem:1}}function u(e,t){for(var i={pack8:0,pack16:0,count:0},o=0,u=e.length;o<u;o++)n(t,i,e[o]);return r({},a(i),{kind:"pack"})}function s(e,t){for(var n={pack8:0,pack16:0,count:0},o=e[0],u=1,s=e.length;u<s;u++)i(n,e[u]-o),o=e[u];return r({},a(n),{kind:"delta"})}function c(e,t){for(var i={pack8:0,pack16:0,count:0},o=1,u=1,s=e.length;u<s;u++)e[u-1]!==e[u]?(n(t,i,e[u-1]),n(t,i,o),o=1):o++;return n(t,i,e[e.length-1]),n(t,i,o),r({},a(i),{kind:"rle"})}function l(e,t){for(var n={pack8:0,pack16:0,count:0},o=1,u=0,s=0,c=1,l=e.length;c<l;c++){var f=e[c]-u;s!==f?(i(n,s),i(n,o),o=1):o++,s=f,u=e[c]}return i(n,s),i(n,o),r({},a(n),{kind:"delta-rle"})}function f(e){var t=function(e){for(var t=!1,n=0,r=e.length;n<r;n++)if(e[n]<0){t=!0;break}return t?{signed:t,limit8:127,limit16:32767}:{signed:t,limit8:255,limit16:65535}}(e),n=[u(e,t),c(e,t),s(e),l(e)];return n.sort(function(e,t){return e.length-t.length}),n}e.getSize=f,e.classify=function(e){if(e.length<2)return o.ArrayEncoding.by(o.ArrayEncoding.byteArray);switch(f(e)[0].kind){case"pack":return o.ArrayEncoding.by(o.ArrayEncoding.integerPacking);case"rle":return o.ArrayEncoding.by(o.ArrayEncoding.runLength).and(o.ArrayEncoding.integerPacking);case"delta":return o.ArrayEncoding.by(o.ArrayEncoding.delta).and(o.ArrayEncoding.integerPacking);case"delta-rle":return o.ArrayEncoding.by(o.ArrayEncoding.delta).and(o.ArrayEncoding.runLength).and(o.ArrayEncoding.integerPacking)}throw new Error("should not happen :)")}}(i||(i={})),function(e){var t=1e-6;e.classify=function(e){var n=u.getArrayDigitCount(e,4,t),r=n.mantissaDigits,a=n.integerDigits;if(r<0||r+a>10)return o.ArrayEncoding.by(o.ArrayEncoding.byteArray);if(0===r)return i.classify(e);for(var s=function(e){for(var t=1,n=0;n<e;n++)t*=10;return t}(r),c=new Int32Array(e.length),l=0,f=e.length;l<f;l++)c[l]=Math.round(s*e[l]);var d=i.getSize(c)[0],p=o.ArrayEncoding.by(o.ArrayEncoding.fixedPoint(s));switch(d.kind){case"pack":return p.and(o.ArrayEncoding.integerPacking);case"rle":return p.and(o.ArrayEncoding.runLength).and(o.ArrayEncoding.integerPacking);case"delta":return p.and(o.ArrayEncoding.delta).and(o.ArrayEncoding.integerPacking);case"delta-rle":return p.and(o.ArrayEncoding.delta).and(o.ArrayEncoding.runLength).and(o.ArrayEncoding.integerPacking)}throw new Error("should not happen :)")}}(a||(a={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.utf8Write=function(e,t,n){for(var r=0,i=n.length;r<i;r++){var a=n.charCodeAt(r);if(a<128)e[t++]=a>>>0&127|0;else if(a<2048)e[t++]=a>>>6&31|192,e[t++]=a>>>0&63|128;else if(a<65536)e[t++]=a>>>12&15|224,e[t++]=a>>>6&63|128,e[t++]=a>>>0&63|128;else{if(!(a<1114112))throw new Error("bad codepoint "+a);e[t++]=a>>>18&7|240,e[t++]=a>>>12&63|128,e[t++]=a>>>6&63|128,e[t++]=a>>>0&63|128}}};var r=function(){for(var e=[],t=0;t<1024;t++)e[t]=String.fromCharCode(t);return e}();function i(e){throw new Error(e)}t.utf8Read=function(e,t,n){for(var a=r,o=void 0,u=[],s=0,c=t,l=t+n;c<l;c++){var f=e[c];0==(128&f)?u[s++]=a[f]:192==(224&f)?u[s++]=a[(15&f)<<6|63&e[++c]]:224==(240&f)?u[s++]=String.fromCharCode((15&f)<<12|(63&e[++c])<<6|(63&e[++c])<<0):240==(248&f)?u[s++]=String.fromCharCode((7&f)<<18|(63&e[++c])<<12|(63&e[++c])<<6|(63&e[++c])<<0):i("Invalid byte "+f.toString(16)),512===s&&((o=o||[])[o.length]=u.join(""),s=0)}return o?(s>0&&(o[o.length]=u.slice(0,s).join("")),o.join("")):u.slice(0,s).join("")},t.utf8ByteCount=function(e){for(var t=0,n=0,r=e.length;n<r;n++){var a=e.charCodeAt(n);a<128?t+=1:a<2048?t+=2:a<65536?t+=3:a<1114112?t+=4:i("bad codepoint "+a)}return t}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(376),a=function(){function e(e,t){this.unit=t,this.all=e}return Object.defineProperty(e.prototype,"index",{get:function(){return this._index?this._index:(this._index=i.createIndex(this.all),this._index)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"byFingerprint",{get:function(){return this._byFingerprint?this._byFingerprint:(this._byFingerprint=function(e,t){for(var n=new Map,i=0,a=0,o=t;a<o.length;a++){var u=o[a],s=r.fingerprint(e,u);n.has(s)?n.get(s).push(i):n.set(s,[i]),i++}return n}(this.unit,this.all),this._byFingerprint)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"elementRingIndices",{get:function(){return this.index.elementRingIndices},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ringComponentIndex",{get:function(){return this.index.ringComponentIndex},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ringComponents",{get:function(){return this.index.ringComponents},enumerable:!0,configurable:!0}),e}();function o(e,t){for(var n=e.elements,r=e.model.atomicHierarchy.residueAtomSegments.index,i=r[n[t[0]]],a=1,o=t.length;a<o;a++)if(i!==r[n[t[a]]])return-1;return i}function u(e,t,n){var r=e.byFingerprint.get(t);if(r)for(var i=0,a=r;i<a.length;i++){var u=a[i],s=o(e.unit,e.all[u]);s>=0&&(n.has(s)?n.get(s).push(u):n.set(s,[u]))}}t.UnitRings=a,function(e){function t(e){return i.getFingerprint(e)}e.fingerprint=function(e,n){for(var r=e.elements,i=e.model.atomicHierarchy.atoms.type_symbol,a=[],o=0,u=n.length;o<u;o++)a[a.length]=i.value(r[n[o]]);return t(a)},e.elementFingerprint=t}(r||(r={})),t.UnitRing=r,function(e){e.create=function(t){var n=i.computeRings(t);return new e(n,t)},e.byFingerprintAndResidue=function(e,t){for(var n=new Map,r=0,i=t;r<i.length;r++)u(e,i[r],n);return n}}(a||(a={})),t.UnitRings=a},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{s(r.next(e))}catch(e){a(e)}}function u(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,u)}s((r=r.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}};Object.defineProperty(t,"__esModule",{value:!0});var a=n(9),o=n(196),u=n(11),s=n(3),c=n(197),l=n(199);function f(e){var t=function(e){switch(e.kind){case 0:return e.model.atomicConformation;case 1:return e.model.coarseConformation.spheres;case 2:return e.model.coarseConformation.gaussians}}(e),n={indices:e.elements,x:t.x,y:t.y,z:t.z},r=a.StructureElement.create(e),i=l.PhysicalSizeTheme({},{});return{position:n,radius:function(e){return r.element=e,i.size(r)}}}function d(e,t,n){var a=this,s=f(e),c=s.position,l=s.radius;return u.Task.create("Gaussian Density",function(u){return r(a,void 0,void 0,function(){return i(this,function(r){switch(r.label){case 0:return[4,o.GaussianDensity(u,c,e.lookup3d.boundary.box,l,t,n)];case 1:return[2,r.sent()]}})})})}t.GaussianDensityParams={resolution:s.ParamDefinition.Numeric(1,{min:.1,max:10,step:.1}),radiusOffset:s.ParamDefinition.Numeric(0,{min:0,max:10,step:.1}),smoothness:s.ParamDefinition.Numeric(1.5,{min:.5,max:2.5,step:.1}),useGpu:s.ParamDefinition.Boolean(!1),ignoreCache:s.ParamDefinition.Boolean(!1)},t.DefaultGaussianDensityProps=s.ParamDefinition.getDefaultValues(t.GaussianDensityParams),t.computeUnitGaussianDensity=d,t.computeUnitGaussianDensityTexture=function(e,t,n,a){var o=this,s=f(e),l=s.position,d=s.radius;return u.Task.create("Gaussian Density",function(u){return r(o,void 0,void 0,function(){return i(this,function(r){switch(r.label){case 0:return[4,c.GaussianDensityTexture(u,n,l,e.lookup3d.boundary.box,d,t,a)];case 1:return[2,r.sent()]}})})})},t.computeUnitGaussianDensityCached=function(e,t,n,a,o){return r(this,void 0,void 0,function(){var r,u;return i(this,function(i){switch(i.label){case 0:return r=t.radiusOffset+"|"+t.resolution+"|"+t.smoothness,(u=n.get(r))&&!t.ignoreCache?[2,u]:[4,d(e,t,o).runInContext(a)];case 1:return u=i.sent(),t.ignoreCache||n.set(r,u),[2,u]}})})}},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{s(r.next(e))}catch(e){a(e)}}function u(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,u)}s((r=r.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(2),u=n(11),s=n(378),c="undefined"!=typeof document?n(197).GaussianDensityGPU:void 0;function l(e,t,n,r,o,u){return i(this,void 0,void 0,function(){return a(this,function(i){switch(i.label){case 0:if(!o.useGpu)return[3,2];if(!c)throw"GPU computation not supported on this platform";if(!u)throw"No WebGL context provided";return[4,c(e,t,n,r,o,u)];case 1:return[2,i.sent()];case 2:return[4,s.GaussianDensityCPU(e,t,n,r,o)];case 3:return[2,i.sent()]}})})}t.DefaultGaussianDensityGPUProps={resolution:1,radiusOffset:0,smoothness:1.5},t.DefaultGaussianDensityProps=r({},t.DefaultGaussianDensityGPUProps,{useGpu:!0}),t.getDelta=function(e,t){var n=o.Vec3.sub(o.Vec3.zero(),e.max,e.min),r=o.Vec3.zero();return o.Vec3.ceil(r,o.Vec3.scale(r,n,t)),o.Vec3.div(o.Vec3.zero(),n,r)},t.computeGaussianDensity=function(e,t,n,r){var o=this;return u.Task.create("Gaussian Density",function(u){return i(o,void 0,void 0,function(){return a(this,function(i){switch(i.label){case 0:return[4,l(u,e,t,n,r)];case 1:return[2,i.sent()]}})})})},t.GaussianDensity=l},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{s(r.next(e))}catch(e){a(e)}}function u(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,u)}s((r=r.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}};Object.defineProperty(t,"__esModule",{value:!0});var a=n(19),o=n(196),u=n(5),s=n(2),c=n(7),l=n(79),f=n(139),d=n(198),p="gaussian-density-gpu";function h(e,t,n,a,o,u,d){return r(this,void 0,void 0,function(){function r(e){e.attachFramebuffer(W,0);for(var t=0,n=0,r=0,i=0;i<V;++i)t>=j&&(t-=j,n+=M,r=0),L.viewport(r,n,I,M),c.ValueCell.update(G,i),c.ValueCell.update(q,r),c.ValueCell.update(H,n),F.render("draw"),++t,r+=I}var h,m,x,w,P,T,A,E,k,I,M,V,O,D,R,j,N,B,F,L,z,U,G,q,H,W;return i(this,function(i){switch(i.label){case 0:return h=u.smoothness,[4,y(e,n,a,o,u)];case 1:return m=i.sent(),x=m.drawCount,w=m.positions,P=m.radii,T=m.groups,A=m.delta,E=m.expandedBox,k=m.dim,I=k[0],M=k[1],V=k[2],O=C(t.maxTextureSize,k),D=O.texDimX,R=O.texDimY,j=O.texCols,(N=f.createTexture(t,"image-uint8","rgba","ubyte","nearest")).define(D,R),B=v(t,x,w,P,T,N,E,k,h),F=l.createRenderable(t,B),L=t.gl,z=t.framebufferCache,U=B.values,G=U.uCurrentSlice,q=U.uCurrentX,H=U.uCurrentY,(W=z.get(t,p).value).bind(),b(L),d||(d=f.createTexture(t,"image-uint8","rgba","ubyte","linear")),d.define(D,R),g(t,F),r(N),_(t,F),r(d),S(t,F),r(d),e.shouldUpdate?[4,e.update({message:"gpu gaussian density calculation"})]:[3,3];case 2:i.sent(),i.label=3;case 3:return[4,t.waitForGpuCommandsCompleteSync()];case 4:return i.sent(),[2,{texture:d,scale:s.Vec3.inverse(s.Vec3.zero(),A),bbox:E,dim:k}]}})})}function m(e,t,n,a,o,u,d){return r(this,void 0,void 0,function(){function r(e){for(var t=0;t<M;++t)c.ValueCell.update(N,t),e.attachFramebuffer(B,0,t),D.render("draw")}var h,m,C,x,w,P,T,A,E,k,I,M,V,O,D,R,j,N,B;return i(this,function(i){switch(i.label){case 0:return h=u.smoothness,[4,y(e,n,a,o,u)];case 1:return m=i.sent(),C=m.drawCount,x=m.positions,w=m.radii,P=m.groups,T=m.delta,A=m.expandedBox,E=m.dim,k=E[0],I=E[1],M=E[2],(V=f.createTexture(t,"volume-uint8","rgba","ubyte","nearest")).define(k,I,M),O=v(t,C,x,w,P,V,A,E,h),D=l.createRenderable(t,O),R=t.gl,j=t.framebufferCache,N=O.values.uCurrentSlice,(B=j.get(t,p).value).bind(),b(R),R.viewport(0,0,k,I),d||(d=f.createTexture(t,"volume-uint8","rgba","ubyte","linear")),d.define(k,I,M),g(t,D),r(V),_(t,D),r(d),S(t,D),r(d),[4,e.update({message:"gpu gaussian density calculation"})];case 2:return i.sent(),[4,t.waitForGpuCommandsCompleteSync()];case 3:return i.sent(),[2,{texture:d,scale:s.Vec3.inverse(s.Vec3.zero(),T),bbox:A,dim:E}]}})})}function y(e,t,n,c,l){return r(this,void 0,void 0,function(){var r,f,d,p,h,m,y,v,b,g,_,S,C,x,w,P,T,A,E;return i(this,function(i){switch(i.label){case 0:r=l.resolution,f=l.radiusOffset,d=t.indices,p=t.x,h=t.y,m=t.z,y=u.OrderedSet.size(d),v=new Float32Array(3*y),b=new Float32Array(y),g=new Float32Array(y),_=0,S=0,i.label=1;case 1:return S<y?(C=u.OrderedSet.getAt(d,S),v[3*S]=p[C],v[3*S+1]=h[C],v[3*S+2]=m[C],x=c(C)+f,_<x&&(_=x),b[S]=x,g[S]=S,S%1e4==0&&e.shouldUpdate?[4,e.update({message:"preparing density data",current:S,max:y})]:[3,3]):[3,4];case 2:i.sent(),i.label=3;case 3:return++S,[3,1];case 4:return w=2*_+r,P=a.Box3D.expand(a.Box3D.empty(),n,s.Vec3.create(w,w,w)),T=s.Vec3.sub(s.Vec3.zero(),P.max,P.min),A=o.getDelta(P,r),E=s.Vec3.zero(),s.Vec3.ceil(E,s.Vec3.mul(E,T,A)),[2,{drawCount:y,positions:v,radii:b,groups:g,delta:A,expandedBox:P,dim:E}]}})})}function v(e,t,n,r,i,a,o,u,f){var d=s.Vec3.sub(s.Vec3.zero(),o.max,o.min),p=C(e.maxTextureSize,u),h=p.texDimX,m=p.texDimY,y={drawCount:c.ValueCell.create(t),instanceCount:c.ValueCell.create(1),aRadius:c.ValueCell.create(r),aPosition:c.ValueCell.create(n),aGroup:c.ValueCell.create(i),uCurrentSlice:c.ValueCell.create(0),uCurrentX:c.ValueCell.create(0),uCurrentY:c.ValueCell.create(0),uBboxMin:c.ValueCell.create(o.min),uBboxMax:c.ValueCell.create(o.max),uBboxSize:c.ValueCell.create(d),uGridDim:c.ValueCell.create(u),uGridTexDim:c.ValueCell.create(s.Vec3.create(h,m,0)),uAlpha:c.ValueCell.create(f),tMinDistanceTex:c.ValueCell.create(a),dGridTexType:c.ValueCell.create(a.depth>0?"3d":"2d"),dCalcType:c.ValueCell.create("density")};return l.createRenderObject("gaussian-density",y,{visible:!0,pickable:!1,opaque:!0})}function b(e){e.disable(e.CULL_FACE),e.frontFace(e.CCW),e.cullFace(e.BACK),e.enable(e.BLEND)}function g(e,t){var n=e.gl;c.ValueCell.update(t.values.dCalcType,"minDistance"),t.update(),t.getProgram("draw").use(),n.blendFunc(n.ONE,n.ONE),n.blendEquation(e.extensions.blendMinMax.MAX)}function _(e,t){var n=e.gl;c.ValueCell.update(t.values.dCalcType,"density"),t.update(),t.getProgram("draw").use(),n.blendFunc(n.ONE,n.ONE),n.blendEquation(n.FUNC_ADD)}function S(e,t){var n=e.gl;c.ValueCell.update(t.values.dCalcType,"groupId"),t.update(),t.getProgram("draw").use(),n.blendFuncSeparate(n.ONE,n.ZERO,n.ZERO,n.ONE),n.blendEquation(n.FUNC_ADD)}function C(e,t){var n=0,r=t[1],i=1,a=t[2];return e<t[0]*t[2]?(a=Math.floor(e/t[0]),i=Math.ceil(t[2]/a),n=a*t[0],r*=i):n=t[0]*t[2],{texDimX:n,texDimY:r,texRows:i,texCols:a}}function x(e,t,n){return r(this,void 0,void 0,function(){var r,a,o,u,c,l,f,h,m,y,v,b,g,_,S,C,x,w,P,T,A;return i(this,function(i){for(r=e.framebufferCache,a=n[0],o=n[1],u=n[2],c=t.width,l=t.height,f=Math.floor(c/a),h=s.Tensor.Space(n,[2,1,0],Float32Array),m=h.create(),y=s.Tensor.create(h,m),v=h.create(),b=s.Tensor.create(h,v),g=new Uint8Array(c*l*4),(_=r.get(e,p).value).bind(),t.attachFramebuffer(_,0),e.readPixels(0,0,c,l,g),S=0,C=0,x=0,w=0;w<u;++w){for(C>=f&&(C=0,x+=o),P=0;P<o;++P)for(T=0;T<a;++T)A=4*(C*a+(P+x)*c+T),m[S]=g[A+3]/255,v[S]=d.decodeFloatRGB(g[A],g[A+1],g[A+2]),S++;C++}return[2,{field:y,idField:b}]})})}t.GaussianDensityGPU=function(e,t,n,a,o,u){return r(this,void 0,void 0,function(){var r,c,l,f,d,p,m,y,v;return i(this,function(i){switch(i.label){case 0:return[4,h(e,u,t,n,a,o)];case 1:return r=i.sent(),c=r.scale,l=r.bbox,f=r.texture,d=r.dim,[4,x(u,f,d)];case 2:return p=i.sent(),m=p.field,y=p.idField,v=s.Mat4.identity(),s.Mat4.fromScaling(v,c),s.Mat4.setTranslation(v,l.min),[2,{field:m,idField:y,transform:v}]}})})},t.GaussianDensityTexture=function(e,t,n,a,o,u,c){return r(this,void 0,void 0,function(){var r,l,f,d,p,y,v;return i(this,function(i){switch(i.label){case 0:return t.isWebGL2?[4,m(e,t,n,a,o,u,c)]:[3,2];case 1:return y=i.sent(),[3,4];case 2:return[4,h(e,t,n,a,o,u,c)];case 3:y=i.sent(),i.label=4;case 4:return l=(r=y).texture,f=r.scale,d=r.bbox,p=r.dim,v=s.Mat4.identity(),s.Mat4.fromScaling(v,f),s.Mat4.setTranslation(v,d.min),[2,{transform:v,texture:l,bbox:d,gridDimension:p}]}})})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(113),i=Math.log(10001);t.encodeFloatLog=function(e){return Math.log(e+1)/i},t.decodeFloatLog=function(e){return Math.exp(e*i)-1},t.encodeFloatRGB=function(e){var t=(e=r.clamp(e,0,16777215)+1)%256/255,n=(e=Math.floor(e/256))%256/255;return[(e=Math.floor(e/256))%256/255,n,t]},t.decodeFloatRGB=function(e,t,n){return 256*Math.floor(e)*256+256*Math.floor(t)+Math.floor(n)-1}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(9),i=n(119),a=n(3),o=1,u="Assigns a physical size.";function s(e){return t.PhysicalSizeThemeParams}function c(e,t){return r.Unit.isAtomic(e)?i.VdwRadius(e.model.atomicHierarchy.atoms.type_symbol.value(t)):r.Unit.isSpheres(e)?e.model.coarseConformation.spheres.radius[t]:0}function l(e,t){return{factory:l,granularity:"group",size:function(e){return r.StructureElement.isLocation(e)?c(e.unit,e.element):r.Link.isLocation(e)?c(e.aUnit,e.aUnit.elements[e.aIndex]):o},props:t,description:u}}t.PhysicalSizeThemeParams={},t.getPhysicalSizeThemeParams=s,t.getPhysicalRadius=c,t.PhysicalSizeTheme=l,t.PhysicalSizeThemeProvider={label:"Physical",factory:l,getParams:s,defaultValues:a.ParamDefinition.getDefaultValues(t.PhysicalSizeThemeParams),isApplicable:function(e){return!!e.structure}}},function(e,t,n){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.create=function(e,t,n){void 0===n&&(n=Float32Array);var r=e*t;return{data:new n(r),size:r,cols:e,rows:t}},e.fromArray=function(e,t,n){return{data:e,size:t*n,cols:t,rows:n}},e.transpose=function(e,t){for(var n=t.rows,r=t.cols,i=t.data,a=e.data,o=0,u=0,s=0;o<n;s+=1,u+=r,++o)for(var c=s,l=0;l<r;c+=n,l++)a[c]=i[u+l];return t},e.multiplyABt=function(e,t,n){for(var r=t.cols,i=t.rows,a=n.rows,o=t.data,u=n.data,s=e.data,c=0,l=0,f=0;c<i;l+=r,c++)for(var d=0,p=0;p<a;f++,p++){for(var h=0,m=l,y=0;y<r;m++,d++,y++)h+=o[m]*u[d];s[f]=h}return e},e.meanRows=function(e){for(var t=e.rows,n=e.cols,r=e.data,i=new Array(n),a=0;a<n;++a)i[a]=0;for(var o=0,u=0;o<t;++o)for(a=0;a<n;++a,++u)i[a]+=r[u];for(a=0;a<n;++a)i[a]/=t;return i},e.subRows=function(e,t){for(var n=e.rows,r=e.cols,i=e.data,a=0,o=0;a<n;++a)for(var u=0;u<r;++u,++o)i[o]-=t[u];return e}}(r||(r={})),t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(44),i=n(43),a=r.CifWriter.Field,o=r.CifWriter.Encodings,u=r.CifWriter.fields().str("group_PDB",i.StructureProperties.residue.group_PDB).index("id").str("type_symbol",i.StructureProperties.atom.type_symbol).str("label_atom_id",i.StructureProperties.atom.label_atom_id).str("label_comp_id",i.StructureProperties.residue.label_comp_id).int("label_seq_id",i.StructureProperties.residue.label_seq_id,{encoder:o.deltaRLE,valueKind:function(e,t){var n=e.unit.model;return n.atomicHierarchy.residues.label_seq_id.valueKind(n.atomicHierarchy.residueAtomSegments.index[e.element])}}).str("label_alt_id",i.StructureProperties.atom.label_alt_id).str("pdbx_PDB_ins_code",i.StructureProperties.residue.pdbx_PDB_ins_code).str("label_asym_id",i.StructureProperties.chain.label_asym_id).str("label_entity_id",i.StructureProperties.chain.label_entity_id).float("Cartn_x",i.StructureProperties.atom.x,{digitCount:3,encoder:o.fixedPoint3}).float("Cartn_y",i.StructureProperties.atom.y,{digitCount:3,encoder:o.fixedPoint3}).float("Cartn_z",i.StructureProperties.atom.z,{digitCount:3,encoder:o.fixedPoint3}).float("occupancy",i.StructureProperties.atom.occupancy,{digitCount:2,encoder:o.fixedPoint2}).int("pdbx_formal_charge",i.StructureProperties.atom.pdbx_formal_charge,{encoder:o.deltaRLE}).str("auth_atom_id",i.StructureProperties.atom.auth_atom_id).str("auth_comp_id",i.StructureProperties.residue.auth_comp_id).int("auth_seq_id",i.StructureProperties.residue.auth_seq_id,{encoder:o.deltaRLE}).str("auth_asym_id",i.StructureProperties.chain.auth_asym_id).int("pdbx_PDB_model_num",i.StructureProperties.unit.model_num,{encoder:o.deltaRLE}).str("operator_name",i.StructureProperties.unit.operator_name,{shouldInclude:function(e){return e.units.some(function(e){return!e.conformation.operator.isIdentity})}}).getFields();function s(e,t,n){return e&&t?e+"_"+n+"_"+t:e?e+"_"+n:t?n+"_"+t:n}function c(e,t){return function(n,r){return t(e(n,r))}}function l(e,t,n){n&&n.includeModelNum&&e.int("pdbx_PDB_model_num",c(t,i.StructureProperties.unit.model_num))}t._atom_site={name:"atom_site",instance:function(e){var t=e.structures;return{fields:u,source:t.map(function(e){return{data:e,rowCount:e.elementCount,keys:function(){return e.elementLocations()}}})}}},t.residueIdFields=function(e,t){var n=t&&t.prefix,a=t&&t.postfix,u=r.CifWriter.fields().str(s(n,a,"label_comp_id"),c(e,i.StructureProperties.residue.label_comp_id)).int(s(n,a,"label_seq_id"),c(e,i.StructureProperties.residue.label_seq_id),{encoder:o.deltaRLE,valueKind:function(t,n){var r=e(t,n),i=r.unit.model;return i.atomicHierarchy.residues.label_seq_id.valueKind(i.atomicHierarchy.residueAtomSegments.index[r.element])}}).str(s(n,a,"pdbx_PDB_ins_code"),c(e,i.StructureProperties.residue.pdbx_PDB_ins_code)).str(s(n,a,"label_asym_id"),c(e,i.StructureProperties.chain.label_asym_id)).str(s(n,a,"label_entity_id"),c(e,i.StructureProperties.chain.label_entity_id)).str(s(n,a,"auth_comp_id"),c(e,i.StructureProperties.residue.auth_comp_id)).int(s(n,a,"auth_seq_id"),c(e,i.StructureProperties.residue.auth_seq_id),{encoder:o.deltaRLE}).str(s(n,a,"auth_asym_id"),c(e,i.StructureProperties.chain.auth_asym_id));return l(u,e,t),u.getFields()},t.chainIdFields=function(e,t){var n=t&&t.prefix,r=t&&t.postfix,o=a.build().str(s(n,r,"label_asym_id"),c(e,i.StructureProperties.chain.label_asym_id)).str(s(n,r,"label_entity_id"),c(e,i.StructureProperties.chain.label_entity_id)).str(s(n,r,"auth_asym_id"),c(e,i.StructureProperties.chain.auth_asym_id));return l(o,e,t),o.getFields()},t.entityIdFields=function(e,t){var n=t&&t.prefix,r=t&&t.postfix,o=a.build().str(s(n,r,"label_entity_id"),c(e,i.StructureProperties.chain.label_entity_id));return l(o,e,t),o.getFields()},t.atomIdFields=function(e,t){var n=t&&t.prefix,a=t&&t.postfix,u=r.CifWriter.fields().str(s(n,a,"label_atom_id"),c(e,i.StructureProperties.atom.label_atom_id)).str(s(n,a,"label_comp_id"),c(e,i.StructureProperties.residue.label_comp_id)).int(s(n,a,"label_seq_id"),c(e,i.StructureProperties.residue.label_seq_id),{encoder:o.deltaRLE,valueKind:function(t,n){var r=e(t,n),i=r.unit.model;return i.atomicHierarchy.residues.label_seq_id.valueKind(i.atomicHierarchy.residueAtomSegments.index[r.element])}}).str(s(n,a,"label_alt_id"),c(e,i.StructureProperties.atom.label_alt_id)).str(s(n,a,"pdbx_PDB_ins_code"),c(e,i.StructureProperties.residue.pdbx_PDB_ins_code)).str(s(n,a,"label_asym_id"),c(e,i.StructureProperties.chain.label_asym_id)).str(s(n,a,"label_entity_id"),c(e,i.StructureProperties.chain.label_entity_id)).str(s(n,a,"auth_atom_id"),c(e,i.StructureProperties.atom.auth_atom_id)).str(s(n,a,"auth_comp_id"),c(e,i.StructureProperties.residue.auth_comp_id)).int(s(n,a,"auth_seq_id"),c(e,i.StructureProperties.residue.auth_seq_id),{encoder:o.deltaRLE}).str(s(n,a,"auth_asym_id"),c(e,i.StructureProperties.chain.auth_asym_id));return l(u,e,t),u.getFields()}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(114),i=n(45),a=n(17),o=n(44);function u(e){if(0===e.length)return[];if(1===e.length)return e[0].entityIndices;for(var t=i.UniqueArray.create(),n=0,r=e;n<r.length;n++)for(var o=0,u=r[n].entityIndices;o<u.length;o++){var s=u[o];i.UniqueArray.add(t,s,s)}return a.sortArray(t.array),t.array}t.getModelMmCifCategory=function(e,t){if("mmCIF"===e.sourceData.kind)return e.sourceData.data[t]},t.getUniqueResidueNamesFromStructures=function(e){return r.SetUtils.unionMany.apply(r.SetUtils,e.map(function(e){return e.uniqueResidueNames}))},t.getUniqueEntityIdsFromStructures=function(e){if(0===e.length)return new Set;var t=e[0].model.entities.data.id;return new Set(u(e).map(function(e){return t.value(e)}))},t.getUniqueEntityIndicesFromStructures=u,t.copy_mmCif_category=function(e,t){return{name:e,instance:function(n){var r=n.structures;if(t&&!t(r[0]))return o.CifWriter.Category.Empty;var i=r[0].model;if("mmCIF"!==i.sourceData.kind)return o.CifWriter.Category.Empty;var a=i.sourceData.data[e];return a&&a._rowCount?o.CifWriter.Category.ofTable(a):o.CifWriter.Category.Empty}}}},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(7),a=n(95),o=n(58),u=n(51),s=n(72),c=n(3),l=n(52),f=n(19),d=n(59);!function(e){function t(e){var t=e?e.centerBuffer.ref.value:new Float32Array(0),n=e?e.groupBuffer.ref.value:new Float32Array(0);return{kind:"points",pointCount:0,centerBuffer:e?i.ValueCell.update(e.centerBuffer,t):i.ValueCell.create(t),groupBuffer:e?i.ValueCell.update(e.groupBuffer,n):i.ValueCell.create(n)}}function n(e,t,n,r){var o=e.centerBuffer.ref.value;a.transformPositionArray(t,o,n,r),i.ValueCell.update(e.centerBuffer,o)}function p(e,t,n,a,c){var f=n.instanceCount,p=n.groupCount,h=o.createColors(n,a.color),m=s.createSizes(n,a.size),y=u.createMarkers(f*p),v={drawCount:e.pointCount,groupCount:p,instanceCount:f},b=l.calculateBoundingSphere(e.centerBuffer.ref.value,e.pointCount,t.aTransform.ref.value,t.instanceCount.ref.value),g=b.boundingSphere,_=b.invariantBoundingSphere;return r({aPosition:e.centerBuffer,aGroup:e.groupBuffer,boundingSphere:i.ValueCell.create(g),invariantBoundingSphere:i.ValueCell.create(_)},h,m,y,t,d.BaseGeometry.createValues(c,v),{uSizeFactor:i.ValueCell.create(c.sizeFactor),dPointSizeAttenuation:i.ValueCell.create(c.pointSizeAttenuation),dPointFilledCircle:i.ValueCell.create(c.pointFilledCircle),uPointEdgeBleach:i.ValueCell.create(c.pointEdgeBleach)})}function h(e,t){d.BaseGeometry.updateRenderableState(e,t),e.opaque=e.opaque&&(!t.pointFilledCircle||t.pointFilledCircle&&0===t.pointEdgeBleach)}e.createEmpty=t,e.transformImmediate=function(e,t){n(e,t,0,e.pointCount)},e.transformRangeImmediate=n,e.Params=r({},d.BaseGeometry.Params,{sizeFactor:c.ParamDefinition.Numeric(1,{min:0,max:10,step:.1}),pointSizeAttenuation:c.ParamDefinition.Boolean(!1),pointFilledCircle:c.ParamDefinition.Boolean(!1),pointEdgeBleach:c.ParamDefinition.Numeric(.2,{min:0,max:1,step:.05})}),e.Utils={Params:e.Params,createEmpty:t,createValues:p,createValuesSimple:function(t,n,i,a,o){var u=d.BaseGeometry.createSimple(i,a,o),s=r({},c.ParamDefinition.getDefaultValues(e.Params),n);return p(t,u.transform,u.locationIterator,u.theme,s)},updateValues:function(e,t){d.BaseGeometry.updateValues(e,t),i.ValueCell.updateIfChanged(e.uSizeFactor,t.sizeFactor),i.ValueCell.updateIfChanged(e.dPointSizeAttenuation,t.pointSizeAttenuation),i.ValueCell.updateIfChanged(e.dPointFilledCircle,t.pointFilledCircle),i.ValueCell.updateIfChanged(e.uPointEdgeBleach,t.pointEdgeBleach)},updateBoundingSphere:function(e,t){var n=l.calculateBoundingSphere(e.aPosition.ref.value,t.pointCount,e.aTransform.ref.value,e.instanceCount.ref.value),r=n.boundingSphere,a=n.invariantBoundingSphere;f.Sphere3D.equals(r,e.boundingSphere.ref.value)||i.ValueCell.update(e.boundingSphere,r);f.Sphere3D.equals(a,e.invariantBoundingSphere.ref.value)||i.ValueCell.update(e.invariantBoundingSphere,a)},createRenderableState:function(e){var t=d.BaseGeometry.createRenderableState(e);return h(t,e),t},updateRenderableState:h}}(t.Points||(t.Points={}))},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(3),a=n(7),o=n(58),u=n(72),s=n(51),c=n(35),l=n(19),f=n(52),d=n(18),p=n(2),h=n(255),m=n(113),y=n(59);function v(e,t,n,r){for(var i=0,a=0,o=0,u=4*n;o<u;++o){var s=2*o,c=Math.abs(e[s]);c>i&&(i=c);var l=Math.abs(e[s+1]);l>i&&(i=l);var f=Math.abs(t[o]);f>a&&(a=f)}return Math.max(a,r+r*i)}!function(e){function t(e){var t=e?e.fontTexture.ref.value:f.createTextureImage(0,1),n=e?e.centerBuffer.ref.value:new Float32Array(0),r=e?e.mappingBuffer.ref.value:new Float32Array(0),i=e?e.depthBuffer.ref.value:new Float32Array(0),o=e?e.indexBuffer.ref.value:new Uint32Array(0),u=e?e.groupBuffer.ref.value:new Float32Array(0),s=e?e.tcoordBuffer.ref.value:new Float32Array(0);return{kind:"text",charCount:0,fontTexture:e?a.ValueCell.update(e.fontTexture,t):a.ValueCell.create(t),centerBuffer:e?a.ValueCell.update(e.centerBuffer,n):a.ValueCell.create(n),mappingBuffer:e?a.ValueCell.update(e.mappingBuffer,r):a.ValueCell.create(r),depthBuffer:e?a.ValueCell.update(e.depthBuffer,i):a.ValueCell.create(i),indexBuffer:e?a.ValueCell.update(e.indexBuffer,o):a.ValueCell.create(o),groupBuffer:e?a.ValueCell.update(e.groupBuffer,u):a.ValueCell.create(u),tcoordBuffer:e?a.ValueCell.update(e.tcoordBuffer,s):a.ValueCell.create(s)}}function n(e,t,n,i,c){var l=n.instanceCount,h=n.groupCount;if(l!==t.instanceCount.ref.value)throw new Error("instanceCount values in TransformData and LocationIterator differ");var b=o.createColors(n,i.color),g=u.createSizes(n,i.size),_=s.createMarkers(l*h),S={drawCount:2*e.charCount*3,groupCount:h,instanceCount:l},C=v(e.mappingBuffer.ref.value,e.depthBuffer.ref.value,e.charCount,u.getMaxSize(g)),x=f.calculateBoundingSphere(e.centerBuffer.ref.value,4*e.charCount,t.aTransform.ref.value,l,C),w=x.boundingSphere,P=x.invariantBoundingSphere;return r({aPosition:e.centerBuffer,aMapping:e.mappingBuffer,aDepth:e.depthBuffer,aGroup:e.groupBuffer,elements:e.indexBuffer,boundingSphere:a.ValueCell.create(w),invariantBoundingSphere:a.ValueCell.create(P)},b,g,_,t,{aTexCoord:e.tcoordBuffer,tFont:e.fontTexture,padding:a.ValueCell.create(C)},y.BaseGeometry.createValues(c,S),{uSizeFactor:a.ValueCell.create(c.sizeFactor),uBorderWidth:a.ValueCell.create(m.clamp(c.borderWidth/2,0,.5)),uBorderColor:a.ValueCell.create(d.Color.toArrayNormalized(c.borderColor,p.Vec3.zero(),0)),uOffsetX:a.ValueCell.create(c.offsetX),uOffsetY:a.ValueCell.create(c.offsetY),uOffsetZ:a.ValueCell.create(c.offsetZ),uBackgroundColor:a.ValueCell.create(d.Color.toArrayNormalized(c.backgroundColor,p.Vec3.zero(),0)),uBackgroundOpacity:a.ValueCell.create(c.backgroundOpacity)})}function b(e,t){y.BaseGeometry.updateRenderableState(e,t),e.opaque=!1}e.createEmpty=t,e.Params=r({},y.BaseGeometry.Params,h.FontAtlasParams,{sizeFactor:i.ParamDefinition.Numeric(1,{min:0,max:10,step:.1}),borderWidth:i.ParamDefinition.Numeric(0,{min:0,max:.5,step:.01}),borderColor:i.ParamDefinition.Color(c.ColorNames.grey),offsetX:i.ParamDefinition.Numeric(0,{min:0,max:10,step:.1}),offsetY:i.ParamDefinition.Numeric(0,{min:0,max:10,step:.1}),offsetZ:i.ParamDefinition.Numeric(0,{min:0,max:10,step:.1}),background:i.ParamDefinition.Boolean(!1),backgroundMargin:i.ParamDefinition.Numeric(.2,{min:0,max:1,step:.01}),backgroundColor:i.ParamDefinition.Color(c.ColorNames.grey),backgroundOpacity:i.ParamDefinition.Numeric(1,{min:0,max:1,step:.01}),attachment:i.ParamDefinition.Select("middle-center",[["bottom-left","bottom-left"],["bottom-center","bottom-center"],["bottom-right","bottom-right"],["middle-left","middle-left"],["middle-center","middle-center"],["middle-right","middle-right"],["top-left","top-left"],["top-center","top-center"],["top-right","top-right"]])}),e.Utils={Params:e.Params,createEmpty:t,createValues:n,createValuesSimple:function(t,a,o,u,s){var c=y.BaseGeometry.createSimple(o,u,s),l=r({},i.ParamDefinition.getDefaultValues(e.Params),{props:a});return n(t,c.transform,c.locationIterator,c.theme,l)},updateValues:function(e,t){y.BaseGeometry.updateValues(e,t),a.ValueCell.updateIfChanged(e.uSizeFactor,t.sizeFactor),a.ValueCell.updateIfChanged(e.uBorderWidth,t.borderWidth),d.Color.fromNormalizedArray(e.uBorderColor.ref.value,0)!==t.borderColor&&(d.Color.toArrayNormalized(t.borderColor,e.uBorderColor.ref.value,0),a.ValueCell.update(e.uBorderColor,e.uBorderColor.ref.value));a.ValueCell.updateIfChanged(e.uOffsetX,t.offsetX),a.ValueCell.updateIfChanged(e.uOffsetY,t.offsetY),a.ValueCell.updateIfChanged(e.uOffsetZ,t.offsetZ),d.Color.fromNormalizedArray(e.uBackgroundColor.ref.value,0)!==t.backgroundColor&&(d.Color.toArrayNormalized(t.backgroundColor,e.uBackgroundColor.ref.value,0),a.ValueCell.update(e.uBackgroundColor,e.uBackgroundColor.ref.value));a.ValueCell.updateIfChanged(e.uBackgroundOpacity,t.backgroundOpacity)},updateBoundingSphere:function(e,t){var n=v(e.aMapping.ref.value,e.aDepth.ref.value,t.charCount,u.getMaxSize(e)),r=f.calculateBoundingSphere(e.aPosition.ref.value,4*t.charCount,e.aTransform.ref.value,e.instanceCount.ref.value,n),i=r.boundingSphere,o=r.invariantBoundingSphere;l.Sphere3D.equals(i,e.boundingSphere.ref.value)||a.ValueCell.update(e.boundingSphere,i);l.Sphere3D.equals(o,e.invariantBoundingSphere.ref.value)||a.ValueCell.update(e.invariantBoundingSphere,o);a.ValueCell.update(e.padding,n)},createRenderableState:function(e){var t=y.BaseGeometry.createRenderableState(e);return b(t,e),t},updateRenderableState:b}}(t.Text||(t.Text={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i,a=n(2),o=n(83),u=n(143),s=a.Vec3.zero(),c=a.Vec3.zero(),l=a.Vec3.zero(),f=a.Vec3.zero(),d=u.polygon(4,!0);function p(e){for(var t=o.PrimitiveBuilder(12),n=0;n<4;++n){var r=(n+1)%4;a.Vec3.set(s,d[2*n],d[2*n+1],-.5),a.Vec3.set(c,d[2*r],d[2*r+1],-.5),a.Vec3.set(l,d[2*r],d[2*r+1],.5),a.Vec3.set(f,d[2*n],d[2*n+1],.5),t.add(s,c,l),e||t.add(l,f,s)}return a.Vec3.set(s,d[0],d[1],-.5),a.Vec3.set(c,d[2],d[3],-.5),a.Vec3.set(l,d[4],d[5],-.5),a.Vec3.set(f,d[6],d[7],-.5),t.add(l,c,s),e||t.add(s,f,l),a.Vec3.set(s,d[0],d[1],.5),a.Vec3.set(c,d[2],d[3],.5),a.Vec3.set(l,d[4],d[5],.5),a.Vec3.set(f,d[6],d[7],.5),t.add(s,c,l),e||t.add(l,f,s),t.getPrimitive()}t.Box=function(){return r||(r=p(!1)),r},t.PerforatedBox=function(){return i||(i=p(!0)),i}},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(7),a=n(3),o=n(58),u=n(51),s=n(52),c=n(19),l=n(72),f=n(59);!function(e){function t(e){var t=e?e.centerBuffer.ref.value:new Float32Array(0),n=e?e.mappingBuffer.ref.value:new Float32Array(0),r=e?e.indexBuffer.ref.value:new Uint32Array(0),a=e?e.groupBuffer.ref.value:new Float32Array(0);return{kind:"spheres",sphereCount:0,centerBuffer:e?i.ValueCell.update(e.centerBuffer,t):i.ValueCell.create(t),mappingBuffer:e?i.ValueCell.update(e.mappingBuffer,n):i.ValueCell.create(n),indexBuffer:e?i.ValueCell.update(e.indexBuffer,r):i.ValueCell.create(r),groupBuffer:e?i.ValueCell.update(e.groupBuffer,a):i.ValueCell.create(a)}}function n(e,t,n,a,c){var d=n.instanceCount,p=n.groupCount;if(d!==t.instanceCount.ref.value)throw new Error("instanceCount values in TransformData and LocationIterator differ");var h=o.createColors(n,a.color),m=l.createSizes(n,a.size),y=u.createMarkers(d*p),v={drawCount:2*e.sphereCount*3,groupCount:p,instanceCount:d},b=l.getMaxSize(m),g=s.calculateBoundingSphere(e.centerBuffer.ref.value,4*e.sphereCount,t.aTransform.ref.value,d,b),_=g.boundingSphere,S=g.invariantBoundingSphere;return r({aPosition:e.centerBuffer,aMapping:e.mappingBuffer,aGroup:e.groupBuffer,elements:e.indexBuffer,boundingSphere:i.ValueCell.create(_),invariantBoundingSphere:i.ValueCell.create(S)},h,m,y,t,{padding:i.ValueCell.create(b)},f.BaseGeometry.createValues(c,v),{uSizeFactor:i.ValueCell.create(c.sizeFactor),dDoubleSided:i.ValueCell.create(c.doubleSided)})}e.createEmpty=t,e.Params=r({},f.BaseGeometry.Params,{sizeFactor:a.ParamDefinition.Numeric(1,{min:0,max:10,step:.1}),doubleSided:a.ParamDefinition.Boolean(!1)}),e.Utils={Params:e.Params,createEmpty:t,createValues:n,createValuesSimple:function(t,i,o,u,s){var c=f.BaseGeometry.createSimple(o,u,s),l=r({},a.ParamDefinition.getDefaultValues(e.Params),i);return n(t,c.transform,c.locationIterator,c.theme,l)},updateValues:function(e,t){f.BaseGeometry.updateValues(e,t),i.ValueCell.updateIfChanged(e.uSizeFactor,t.sizeFactor),i.ValueCell.updateIfChanged(e.dDoubleSided,t.doubleSided)},updateBoundingSphere:function(e,t){var n=l.getMaxSize(e),r=s.calculateBoundingSphere(e.aPosition.ref.value,4*t.sphereCount,e.aTransform.ref.value,e.instanceCount.ref.value,n),a=r.boundingSphere,o=r.invariantBoundingSphere;c.Sphere3D.equals(a,e.boundingSphere.ref.value)||i.ValueCell.update(e.boundingSphere,a);c.Sphere3D.equals(o,e.invariantBoundingSphere.ref.value)||i.ValueCell.update(e.invariantBoundingSphere,o);i.ValueCell.update(e.padding,n)},createRenderableState:f.BaseGeometry.createRenderableState,updateRenderableState:f.BaseGeometry.updateRenderableState}}(t.Spheres||(t.Spheres={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(433),i=n(434).Icosahedron(),a=i.vertices,o=i.indices;t.sphereVertexCount=function(e){return 10*Math.pow(Math.pow(2,e),2)+2},t.Sphere=function(e){return r.Polyhedron(a,o,{detail:e,radius:1})}},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{s(r.next(e))}catch(e){a(e)}}function u(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,u)}s((r=r.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(11),u=n(262),s=n(7),c=n(456);function l(e){return r({},e,{bottomLeft:s.defaults(e.bottomLeft,[0,0,0]),topRight:s.defaults(e.topRight,e.scalarField.space.dimensions)})}function f(e){return{dX:e.topRight[0]-e.bottomLeft[0],dY:e.topRight[1]-e.bottomLeft[1],dZ:e.topRight[2]-e.bottomLeft[2]}}t.computeMarchingCubesMesh=function(e,t){var n=this;return o.Task.create("Marching Cubes Mesh",function(r){return i(n,void 0,void 0,function(){var n,i,o,u,s,p,h;return a(this,function(a){switch(a.label){case 0:return n=l(e),i=f(n),o=i.dX,u=i.dY,s=i.dZ,p=Math.min(262144,Math.max(o*u*s/32,1024)),h=c.MarchinCubesMeshBuilder(p,t),[4,new d(r,h,n).run()];case 1:return a.sent(),[2,h.get()]}})})})},t.computeMarchingCubesLines=function(e,t){var n=this;return o.Task.create("Marching Cubes Lines",function(r){return i(n,void 0,void 0,function(){var n,i,o,u,s,p,h;return a(this,function(a){switch(a.label){case 0:return n=l(e),i=f(n),o=i.dX,u=i.dY,s=i.dZ,p=Math.min(262144,Math.max(o*u*s/32,1024)),h=c.MarchinCubesLinesBuilder(p,t),[4,new d(r,h,n).run()];case 1:return a.sent(),[2,h.get()]}})})})};var d=function(){function e(e,t,n){this.ctx=e,this.minX=0,this.minY=0,this.minZ=0,this.maxX=0,this.maxY=0,this.maxZ=0,this.state=new p(t,n),this.minX=n.bottomLeft[0],this.minY=n.bottomLeft[1],this.minZ=n.bottomLeft[2],this.maxX=n.topRight[0]-1,this.maxY=n.topRight[1]-1,this.maxZ=n.topRight[2]-1,this.size=(this.maxX-this.minX)*(this.maxY-this.minY)*(this.maxZ-this.minZ),this.sliceSize=(this.maxX-this.minX)*(this.maxY-this.minY)}return e.prototype.doSlices=function(){return i(this,void 0,void 0,function(){var e,t;return a(this,function(n){switch(n.label){case 0:e=0,this.edgeFilter=15,t=this.minZ,n.label=1;case 1:return t<this.maxZ?(this.slice(t),e+=this.sliceSize,this.ctx.shouldUpdate?[4,this.ctx.update({message:"Computing surface...",current:e,max:this.size})]:[3,3]):[3,4];case 2:n.sent(),n.label=3;case 3:return t++,this.edgeFilter&=-5,[3,1];case 4:return[2]}})})},e.prototype.slice=function(e){this.edgeFilter|=2;for(var t=this.minY;t<this.maxY;t++,this.edgeFilter&=-3){this.edgeFilter|=1;for(var n=this.minX;n<this.maxX;n++,this.edgeFilter&=-2)this.state.processCell(n,t,e,this.edgeFilter)}this.state.clearEdgeVertexIndexSlice(e)},e.prototype.run=function(){return i(this,void 0,void 0,function(){return a(this,function(e){switch(e.label){case 0:return[4,this.doSlices()];case 1:return e.sent(),[2]}})})},e}(),p=function(){function e(e,t){this.builder=e,this.vertList=[0,0,0,0,0,0,0,0,0,0,0,0],this.i=0,this.j=0,this.k=0;var n=t.scalarField.space.dimensions;this.nX=n[0],this.nY=n[1],this.nZ=n[2],this.isoLevel=t.isoLevel,this.scalarFieldGet=t.scalarField.space.get,this.scalarField=t.scalarField.data,t.idField&&(this.idField=t.idField.data,this.idFieldGet=t.idField.space.get),this.verticesOnEdges=new Int32Array(3*this.nX*this.nY*2)}return e.prototype.get3dOffsetFromEdgeInfo=function(e){return this.nX*((this.k+e.k)%2*this.nY+this.j+e.j)+this.i+e.i},e.prototype.clearEdgeVertexIndexSlice=function(e){for(var t=e%2==0?0:3*this.nX*this.nY,n=e%2==0?3*this.nX*this.nY:this.verticesOnEdges.length,r=t;r<n;r++)this.verticesOnEdges[r]=0},e.prototype.interpolate=function(e){var t=u.EdgeIdInfo[e],n=3*this.get3dOffsetFromEdgeInfo(t)+t.e,r=this.verticesOnEdges[n];if(r>0)return r-1;var i=u.CubeEdges[e],a=i.a,o=i.b,s=a.i+this.i,c=a.j+this.j,l=a.k+this.k,f=o.i+this.i,d=o.j+this.j,p=o.k+this.k,h=this.scalarFieldGet(this.scalarField,s,c,l),m=this.scalarFieldGet(this.scalarField,f,d,p),y=(this.isoLevel-h)/(h-m),v=this.builder.addVertex(s+y*(s-f),c+y*(c-d),l+y*(l-p));if(this.verticesOnEdges[n]=v+1,this.idField){var b=this.idFieldGet(this.idField,s,c,l),g=this.idFieldGet(this.idField,f,d,p),_=y<.5?b:g;_<0&&(_=y<.5?g:b),this.builder.addGroup(_)}else this.builder.addGroup(0);return v},e.prototype.get=function(e,t,n){return this.scalarFieldGet(this.scalarField,e,t,n)},e.prototype.processCell=function(e,t,n,r){var i=0;if(this.get(e,t,n)<this.isoLevel&&(i|=1),this.get(e+1,t,n)<this.isoLevel&&(i|=2),this.get(e+1,t+1,n)<this.isoLevel&&(i|=4),this.get(e,t+1,n)<this.isoLevel&&(i|=8),this.get(e,t,n+1)<this.isoLevel&&(i|=16),this.get(e+1,t,n+1)<this.isoLevel&&(i|=32),this.get(e+1,t+1,n+1)<this.isoLevel&&(i|=64),this.get(e,t+1,n+1)<this.isoLevel&&(i|=128),0!==i&&255!==i){this.i=e,this.j=t,this.k=n;var a=u.EdgeTable[i];(1&a)>0&&(this.vertList[0]=this.interpolate(0)),(2&a)>0&&(this.vertList[1]=this.interpolate(1)),(4&a)>0&&(this.vertList[2]=this.interpolate(2)),(8&a)>0&&(this.vertList[3]=this.interpolate(3)),(16&a)>0&&(this.vertList[4]=this.interpolate(4)),(32&a)>0&&(this.vertList[5]=this.interpolate(5)),(64&a)>0&&(this.vertList[6]=this.interpolate(6)),(128&a)>0&&(this.vertList[7]=this.interpolate(7)),(256&a)>0&&(this.vertList[8]=this.interpolate(8)),(512&a)>0&&(this.vertList[9]=this.interpolate(9)),(1024&a)>0&&(this.vertList[10]=this.interpolate(10)),(2048&a)>0&&(this.vertList[11]=this.interpolate(11));for(var o=u.TriTable[i],s=0;s<o.length;s+=3)this.builder.addTriangle(this.vertList,o[s],o[s+1],o[s+2],r)}},e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(264);t.StateTree=r.StateTree;var i=n(266);t.TransientTree=i.TransientTree},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(21),i=n(2),a=n(7),o=n(154);function u(e,t){return function(e,t){for(var n=Object.create(null),i=0,a=Object.keys(e);i<a.length;i++){var o=a[i];n[o]=l(o,e[o],t)}return r.Database.ofTables(t.header,e,n)}(e,t)}function s(e,t,n,r){return{schema:e,__array:t.__array,isDefined:t.isDefined,rowCount:t.rowCount,value:n,valueKind:t.valueKind,areValuesEqual:t.areValuesEqual,toArray:r}}t.toDatabaseCollection=function(e,t){for(var n={},r=0,i=t.blocks;r<i.length;r++){var a=i[r];n[a.header]=u(e,a)}return n},t.toDatabase=u,t.toTable=function(e,t){return new c(t,e,!0)};var c=function(){return function(e,t,n){this._isDefined=n;var u=Object.keys(t);this._rowCount=e.rowCount,this._columns=u,this._schema=t;for(var c=Object.create(null),l=function(n){Object.defineProperty(f,n,{get:function(){if(c[n])return c[n];var u=t[n];if("list"===u.valueType)c[n]=function(e,t,n){var i=e.separator,o=e.itemParse,u=t.getField(n),s=u?function(e){return u.str(e).split(i).map(function(e){return o(e.trim())}).filter(function(e){return!!e})}:function(e){return[]};return{schema:e,__array:void 0,isDefined:!!u,rowCount:t.rowCount,value:s,valueKind:u?u.valueKind:function(){return 1},areValuesEqual:function(e,t){return a.arrayEqual(s(e),s(t))},toArray:function(e){return r.ColumnHelpers.createAndFillArray(t.rowCount,s,e)}}}(u,e,n);else if("tensor"===u.valueType)c[n]=function(e,t,n){var a,u=e.space,s=t.fieldNames.indexOf(n+"[0]")>=0,c=s?0:1;switch(u.rank){case 1:a=n+"["+c+"]";break;case 2:a=n+"["+c+"]["+c+"]";break;case 3:a=n+"["+c+"]["+c+"]["+c+"]";break;default:throw new Error("Tensors with rank > 3 or rank 0 are currently not supported.")}var l=t.getField(a)||r.Column.Undefined(t.rowCount,e),f=function(e){return o.getTensor(t,n,u,e,s)};return{schema:e,__array:void 0,isDefined:l.isDefined,rowCount:t.rowCount,value:f,valueKind:l.valueKind,areValuesEqual:function(e,t){return i.Tensor.areEqualExact(f(e),f(t))},toArray:function(e){return r.ColumnHelpers.createAndFillArray(t.rowCount,f,e)}}}(u,e,n);else{var l=function(e){switch(e.valueType){case"str":return function(t,n,r){return s(e,t,t.str,t.toStringArray)};case"int":return function(t,n,r){return s(e,t,t.int,t.toIntArray)};case"float":return function(t,n,r){return s(e,t,t.float,t.toFloatArray)};case"list":throw new Error("Use createListColumn instead.");case"tensor":throw new Error("Use createTensorColumn instead.")}}(u),f=e.getField(n);c[n]=f?l(f,e,n):r.Column.Undefined(e.rowCount,u)}return c[n]},enumerable:!0,configurable:!1})},f=this,d=0,p=u;d<p.length;d++)l(p[d])}}();function l(e,t,n){var r=n.categories[e];return new c(r||o.CifCategory.empty(e),t,!!r)}},function(e,t,n){"use strict";function r(e,t,n){var r=t,i=0,a=1;for(45===e.charCodeAt(r)&&(a=-1,r++);r<n;r++){var o=e.charCodeAt(r)-48;if(o>9||o<0)return a*i|0;i=10*i+o|0}return a*i}function i(e,t,n,i){return 43===t.charCodeAt(n)&&n++,e*Math.pow(10,r(t,n,i))}function a(e,t,n){var r=t,a=1,o=0,u=0,s=1;for(45===e.charCodeAt(r)&&(a=-1,++r);r<n;){var c=e.charCodeAt(r)-48;if(!(c>=0&&c<10)){if(-2===c){for(++r;r<n;){if(!((c=e.charCodeAt(r)-48)>=0&&c<10))return 53===c||21===c?i(a*(o+u/s),e,r+1,n):a*(o+u/s);u=10*u+c,s*=10,++r}return a*(o+u/s)}if(53===c||21===c)return i(a*o,e,r+1,n);break}o=10*o+c,++r}return a*o}function o(e,t,n){return 43===e.charCodeAt(t)&&t++,function(e,t,n){for(45===e.charCodeAt(t)&&t++;t<n;t++){var r=e.charCodeAt(t)-48;if(r>9||r<0)return!1}return!0}(e,t,n)?1:2}Object.defineProperty(t,"__esModule",{value:!0}),t.parseIntSkipLeadingWhitespace=function(e,t,n){for(;t<n&&32===e.charCodeAt(t);)t++;return r(e,t,n)},t.parseInt=r,t.parseFloatSkipLeadingWhitespace=function(e,t,n){for(;t<n&&32===e.charCodeAt(t);)t++;return a(e,t,n)},t.parseFloat=a,t.getNumberType=function(e){var t=0,n=e.length;for(45===e.charCodeAt(t)&&++t;t<n;){var r=e.charCodeAt(t)-48;if(!(r>=0&&r<10)){if(-2===r){++t;for(var i=!1;t<n;){if(!((r=e.charCodeAt(t)-48)>=0&&r<10))return 53===r||21===r?o(e,t+1,n):2;i=!0,++t}return i?1:0}if(53===r||21===r)return o(e,t+1,n);break}++t}return t===n?0:2}},function(e,t,n){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),function(e){function t(e,t,n){return{kind:"value",namespace:e,name:t,parent:n}}function n(e,t,n,r){for(var i=Object.create(null),a=0,o=r;a<o.length;a++){i[o[a]]=!0}return{kind:"oneof",namespace:e,name:t,type:n,values:i}}e.Variable=function(e,t,n){return{kind:"variable",name:e,type:t,isConstraint:n}},e.Value=t,e.Container=function(e,t,n,r){return{kind:"container",namespace:e,name:t,child:n,alias:r}},e.Union=function(e){return{kind:"union",types:e}},e.OneOf=n,e.Any={kind:"any"},e.AnyValue={kind:"any-value"},e.Num=t("","Number"),e.Str=t("","String"),e.Bool=n("","Bool",e.Str,["true","false"]),e.oneOfValues=function(e){var t=e.values;return Object.keys(t).sort()}}(r||(r={})),t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(276),i=n(9),a=function(){function e(){this.map=new Map}return e.prototype.addSymbol=function(e){if(this.map.has(e.symbol.id))throw new Error("Symbol '"+e.symbol.id+"' already added.");this.map.set(e.symbol.id,e)},e.prototype.addCustomProp=function(e){if(e.symbols)for(var t=0,n=Object.keys(e.symbols);t<n.length;t++){var r=n[t];this.addSymbol(e.symbols[r])}},e.prototype.getRuntime=function(e){return this.map.get(e)},e}();t.QueryRuntimeTable=a,t.DefaultQueryRuntimeTable=new a;var o,u=function(){return function(e){this.table=e,this.constQueryContext=new i.QueryContext(i.Structure.Empty)}}();t.QueryCompilerCtx=u,function(e){e.Const=function(e){return{kind:"const",value:e}},e.Dynamic=function(e){return{kind:"dynamic",runtime:e}}}(t.QueryCompiledSymbol||(t.QueryCompiledSymbol={})),function(e){e.Const=function(e){return{isConst:!0,fn:function(t){return e}}},e.Dynamic=function(e){return{isConst:!1,fn:e}}}(o=t.CompiledQueryFn||(t.CompiledQueryFn={})),function(e){e.forEachEval=function(e,t,n,r){if("number"==typeof e.length)for(var i=0,a=e.length;i<a;i++)n(e[i](t),i,r);else{i=0;for(var o=0,u=Object.keys(e);o<u.length;o++)n(e[u[o]](t),i++,r)}return r}}(t.QueryRuntimeArguments||(t.QueryRuntimeArguments={})),function(e){e.Const=function(e,t){return new s(e,t,!0)},e.Dynamic=function(e,t){return new s(e,t,!1)}}(t.QuerySymbolRuntime||(t.QuerySymbolRuntime={}));var s=function(){function e(e,t,n){this.symbol=e,this.fn=t,this.isConst=n}return e.prototype.compile=function(e,t){var n,i=!1;if(t)if(r.default.isArgumentsArray(t)){n=[],i=!1;for(var a=0,u=t;a<u.length;a++){var s=l(e,u[a]);i=i&&s.isConst,n.push(s.fn)}}else{n=Object.create(null),i=!1;for(var f=0,d=Object.keys(t);f<d.length;f++){var p=d[f];s=l(e,t[p]);i=i&&s.isConst,n[p]=s.fn}}else n=void 0,i=!0;return this.isConst&&this.isConst&&i?o.Const(this.fn(e.constQueryContext,n)):o.Dynamic(c(this.fn,n))},e}();function c(e,t){return function(n){return e(n,t)}}function l(e,t){if(r.default.isLiteral(t))return o.Const(t);if(r.default.isSymbol(t)){var n=e.table.getRuntime(t.name);return n?n.compile(e):o.Const(t.name)}if(!r.default.isSymbol(t.head))throw new Error("Can only apply symbols.");var i=e.table.getRuntime(t.head.name);if(!i)throw new Error("Symbol '"+t.head.name+"' is not implemented.");return i.compile(e,t.args)}t.compile=function(e){return l(new u(t.DefaultQueryRuntimeTable),e).fn},n(486)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(155);function i(e){var t=/([a-z])([A-Z])([a-z]|$)/g;return e.replace(t,function(e,t,n,r){return t+"-"+n.toLocaleLowerCase()+r}).replace(t,function(e,t,n,r){return t+"-"+n.toLocaleLowerCase()+r})}t.symbol=function(e,t,n){return r.MSymbol("",e,t,n)},t.normalizeTable=function(e){!function e(t,n,a){if(r.isSymbol(a))return a.info.namespace=t,a.info.name=a.info.name||i(n),void(a.id=a.info.namespace+"."+a.info.name);for(var o=""+(a["@namespace"]||i(n)),u=t?t+"."+o:o,s=0,c=Object.keys(a);s<c.length;s++){var l=c[s];("object"==typeof a[l]||r.isSymbol(a[l]))&&e(u,l,a[l])}}("","",e)},t.symbolList=function(e){var t=[];return function e(t,n){if(r.isSymbol(t))n.push(t);else for(var i=0,a=Object.keys(t);i<a.length;i++){var o=a[i];("object"==typeof t[o]||r.isSymbol(t[o]))&&e(t[o],n)}}(e,t),t}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{s(r.next(e))}catch(e){a(e)}}function u(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,u)}s((r=r.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}};Object.defineProperty(t,"__esModule",{value:!0});var a,o=n(11);function u(e){return{data:e,position:0,length:e.length,lineNumber:1,tokenStart:0,tokenEnd:0}}t.Tokenizer=u,function(e){function t(e){return e.data.substring(e.tokenStart,e.tokenEnd)}function n(e){for(var t=e.data;e.position<e.length;)switch(t.charCodeAt(e.position)){case 10:return e.tokenEnd=e.position,++e.position,++e.lineNumber,!0;case 13:return e.tokenEnd=e.position,++e.position,++e.lineNumber,10===t.charCodeAt(e.position)&&++e.position,!0;default:++e.position}return e.tokenEnd=e.position,e.tokenStart!==e.tokenEnd}function u(e){return e.tokenStart=e.position,n(e)}function s(e,t,n){for(var r=0,i=0;i<t;i++){if(!u(e))return r;a.addUnchecked(n,e.tokenStart,e.tokenEnd),r++}return r}e.getTokenString=t,e.reset=function(e){e.position=0,e.lineNumber=1,e.tokenStart=0,e.tokenEnd=0},e.eatLine=n,e.markStart=function(e){e.tokenStart=e.position},e.markLine=u,e.readLine=function(e){return u(e),t(e)},e.readLines=function(e,t){var n=a.create(e.data,2*t);return s(e,t,n),n},e.readLinesAsync=function(e,t,n,u){return void 0===u&&(u=1e5),r(this,void 0,void 0,function(){var r,c,l;return i(this,function(i){switch(i.label){case 0:return r=e.length,c=a.create(e.data,2*t),l=0,[4,o.chunkedSubtask(n,u,e,function(e,n){var r=Math.min(t-l,e);return s(n,r,c),l+=r,r},function(e,t){return e.update({message:"Parsing...",current:t.position,max:r})})];case 1:return i.sent(),[2,c]}})})},e.readAllLines=function(t){for(var n=e(t),r=a.create(n.data,Math.max(t.length/80,2));u(n);)a.add(r,n.tokenStart,n.tokenEnd);return r},e.readAllLinesAsync=function(t,n,s){return void 0===s&&(s=1e5),r(this,void 0,void 0,function(){var r,c;return i(this,function(i){switch(i.label){case 0:return r=e(t),c=a.create(r.data,Math.max(t.length/80,2)),[4,o.chunkedSubtask(n,s,r,function(e,t){return function(e,t,n){for(var r=0,i=0;i<t;i++){if(!u(e))return r;a.add(n,e.tokenStart,e.tokenEnd),r++}}(t,e,c),t.position<t.length?e:0},function(e,t){return e.update({message:"Parsing...",current:t.position,max:length})})];case 1:return i.sent(),[2,c]}})})},e.eatValue=function(e){for(;e.position<e.length;)switch(e.data.charCodeAt(e.position)){case 9:case 10:case 13:case 32:return void(e.tokenEnd=e.position);default:++e.position}e.tokenEnd=e.position},e.skipWhitespace=function(e){for(var t=10;e.position<e.length;){var n=e.data.charCodeAt(e.position);switch(n){case 9:case 32:t=n,++e.position;break;case 10:13!==t&&++e.lineNumber,t=n,++e.position;break;case 13:t=n,++e.position,++e.lineNumber;break;default:return t}}return t},e.trim=function(e,t,n){for(var r=e.data,i=t,a=n-1,o=r.charCodeAt(i);(9===o||32===o)&&i<=a;)o=r.charCodeAt(++i);for(o=r.charCodeAt(a);(9===o||32===o)&&a>=i;)o=r.charCodeAt(--a);return e.tokenStart=i,e.tokenEnd=a+1,e.position=n,e}}(u||(u={})),t.Tokenizer=u,t.trimStr=function(e,t,n){for(var r=t,i=n-1,a=e.charCodeAt(r);(9===a||32===a)&&r<=i;)a=e.charCodeAt(++r);for(a=e.charCodeAt(i);(9===a||32===a)&&i>=r;)a=e.charCodeAt(--i);return e.substring(r,i+1)},function(e){function t(e,t,n){var r=e;r.offset>r.indicesLenMinus2&&function(e){var t=new Uint32Array(1.61*e.indices.length|0);t.set(e.indices),e.indices=t,e.indicesLenMinus2=t.length-2|0}(r),r.indices[r.offset++]=t,r.indices[r.offset++]=n,e.count++}e.add=t,e.addToken=function(e,n){t(e,n.tokenStart,n.tokenEnd)},e.addUnchecked=function(e,t,n){e.indices[e.offset++]=t,e.indices[e.offset++]=n,e.count++},e.create=function(e,t){return{data:e,indicesLenMinus2:(t=Math.max(10,t))-2|0,count:0,offset:0,indices:new Uint32Array(t)}}}(a=t.TokenBuilder||(t.TokenBuilder={}))},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var a=n(24),o=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={isExpanded:!!t.props.initialExpanded},t.toggleExpanded=function(){return t.setState({isExpanded:!t.state.isExpanded})},t}return i(t,e),t.prototype.render=function(){return a.createElement("div",{className:"msp-control-group-wrapper"},a.createElement("div",{className:"msp-control-group-header"},a.createElement("button",{className:"msp-btn msp-btn-block",onClick:this.toggleExpanded},a.createElement("span",{className:"msp-icon msp-icon-"+(this.state.isExpanded?"collapse":"expand")}),this.props.header)),this.state.isExpanded&&a.createElement("div",{className:"msp-control-offset",style:{display:this.state.isExpanded?"block":"none"}},this.props.children))},t}(a.Component);t.ControlGroup=o;var u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={value:"0"},t.input=a.createRef(),t.onChange=function(e){var n=+e.target.value;t.setState({value:e.target.value},function(){Number.isNaN(n)||n===t.props.value||t.props.onChange(n)})},t.onKeyPress=function(e){13!==e.keyCode&&13!==e.charCode||(t.props.blurOnEnter&&t.input.current&&t.input.current.blur(),t.props.onEnter&&t.props.onEnter())},t.onBlur=function(){t.setState({value:""+t.props.value}),t.props.onBlur&&t.props.onBlur()},t}return i(t,e),t.getDerivedStateFromProps=function(e,t){var n=+t.value;return Number.isNaN(n)||n===e.value?null:{value:""+e.value}},t.prototype.render=function(){return a.createElement("input",{type:"text",ref:this.input,onBlur:this.onBlur,value:this.state.value,placeholder:this.props.placeholder,onChange:this.onChange,onKeyPress:this.props.onEnter||this.props.blurOnEnter?this.onKeyPress:void 0,disabled:!!this.props.isDisabled})},t}(a.PureComponent);t.NumericInput=u},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{s(r.next(e))}catch(e){a(e)}}function u(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,u)}s((r=r.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}};Object.defineProperty(t,"__esModule",{value:!0});var o,u=n(39),s=n(76),c=n(2),l=n(306),f=n(312),d=n(344),p=n(133),h=n(345),m=n(182),y=n(32),v=n(428),b=n(259),g=n(16),_=n(18),S=n(260),C=n(3),x=n(432),w=n(198),P=n(114);t.Canvas3DParams={cameraMode:C.ParamDefinition.Select("perspective",[["perspective","Perspective"],["orthographic","Orthographic"]]),backgroundColor:C.ParamDefinition.Color(_.Color(0)),cameraClipDistance:C.ParamDefinition.Numeric(0,{min:0,max:50,step:.1},{description:"The distance between camera and scene at which to clip regardless of near clipping plane."}),clip:C.ParamDefinition.Interval([1,100],{min:1,max:100,step:1}),fog:C.ParamDefinition.Interval([50,100],{min:1,max:100,step:1}),pickingAlphaThreshold:C.ParamDefinition.Numeric(.5,{min:0,max:1,step:.01},{description:"The minimum opacity value needed for an object to be pickable."}),trackball:C.ParamDefinition.Group(d.TrackballControlsParams),debug:C.ParamDefinition.Group(x.DebugHelperParams)},function(e){e.create=function(e,n,o){void 0===o&&(o={});var _=r({},C.ParamDefinition.getDefaultValues(t.Canvas3DParams),o),T=new Map,A=new Map,E=new u.BehaviorSubject(0),k=s.now(),I=new u.BehaviorSubject(0),M=l.default.create(e),V=new S.Camera({near:.1,far:1e4,position:c.Vec3.create(0,0,10),mode:_.cameraMode}),O=m.getGLContext(e,{alpha:!1,antialias:!0,depth:!0,preserveDrawingBuffer:!0});if(null===O)throw new Error("Could not create a WebGL rendering context");var D=m.createContext(O),R=b.default.create(D),j=d.TrackballControls.create(M,V,_.trackball),N=f.default.create(D,V,{clearColor:_.backgroundColor}),B=.25/D.pixelRatio,F=Math.round(e.width*B),L=Math.round(e.height*B),z=v.createRenderTarget(D,F,L),U=v.createRenderTarget(D,F,L),G=v.createRenderTarget(D,F,L),q=!0,H=!1,W=!1,Y=!1,K=new x.BoundingSphereHelper(D,R,_.debug),X=-1,Q=-1,Z=-1,J=-1;function $(t,n){if(H||W)return!1;var r,i,a,o,u,s,l=!1;j.update(te),V.transition.inTransition||(r=c.Vec3.distance(V.state.position,V.state.target),i=Math.max(10,R.boundingSphere.radius),a=r-i*((50-_.clip[0])/50),o=r+i*(-(50-_.clip[1])/50),u=r-i*((50-_.fog[0])/50),s=r+i*(-(50-_.fog[1])/50),"perspective"===V.state.mode?(a=Math.max(.1,_.cameraClipDistance,a),o=Math.max(1,o),u=Math.max(.1,u),s=Math.max(1,s)):"orthographic"===V.state.mode&&_.cameraClipDistance>0&&(a=Math.max(_.cameraClipDistance,a)),a===X&&o===Q&&u===Z&&s===J||(V.setState({near:a,far:o,fogNear:u,fogFar:s}),X=a,Q=o,Z=u,J=s));var f=V.updateMatrices();if(n||f){switch(t){case"pick":N.setViewport(0,0,F,L),z.bind(),N.clear(),N.render(R,"pickObject"),U.bind(),N.clear(),N.render(R,"pickInstance"),G.bind(),N.clear(),N.render(R,"pickGroup");break;case"draw":D.unbindFramebuffer(),N.setViewport(0,0,e.width,e.height),N.clear(),N.render(R,t),K.isEnabled&&(K.syncVisibility(),N.render(K.scene,"draw")),q=!0}l=!0}return l&&f}var ee=!1,te=0;function ne(e){$("draw",!!e||ee)&&I.next(s.now()-k),ee=!1,Y=!1}function re(e){Y||(Y=!0,ee=!!e)}function ie(){q&&($("pick",!0),q=!1)}function ae(e){W=!0;var t=T.get(e),n=new Set;if(e.renderObjects.forEach(function(e){return n.add(e)}),t){if(!P.SetUtils.areEqual(n,t)){for(var r=0,i=Array.from(n);r<i.length;r++){var a=i[r];t.has(a)||R.add(a)}for(var o=0,u=Array.from(t);o<u.length;o++)a=u[o],n.has(a)||R.remove(a)}}else e.renderObjects.forEach(function(e){return R.add(e)});T.set(e,n),R.update(),K.isEnabled&&K.update(),W=!1,re(!0),E.next(T.size)}return oe(),{webgl:D,add:function(e){ae(e),A.set(e,e.updated.subscribe(function(t){e.state.syncManually||ae(e)}))},remove:function(e){var t=A.get(e);t&&t.unsubscribe();var n=T.get(e);n&&(W=!0,n.forEach(function(e){return R.remove(e)}),T.delete(e),R.update(),K.isEnabled&&K.update(),W=!1,re(!0),E.next(T.size))},update:function(){return R.update()},clear:function(){T.clear(),R.clear(),K.clear()},requestDraw:re,animate:function e(){te=s.now(),V.transition.tick(te),ne(!1),window.requestAnimationFrame(e)},pick:ie,identify:function(t,n){return i(this,void 0,void 0,function(){var r,i,o,u,s,c;return a(this,function(a){return H?[2]:(ie(),H=!0,t*=D.pixelRatio,n*=D.pixelRatio,n=e.height-n,r=new Uint8Array(4),i=Math.round(t*B),o=Math.round(n*B),z.bind(),D.readPixels(i,o,1,1,r),-1===(u=w.decodeFloatRGB(r[0],r[1],r[2]))?(H=!1,[2]):(U.bind(),D.readPixels(i,o,1,1,r),-1===(s=w.decodeFloatRGB(r[0],r[1],r[2]))?(H=!1,[2]):(G.bind(),D.readPixels(i,o,1,1,r),-1===(c=w.decodeFloatRGB(r[0],r[1],r[2]))?(H=!1,[2]):(H=!1,[2,{objectId:u,instanceId:s,groupId:c}]))))})})},mark:function(e,t,n){var r=!1;if(n?r=n.mark(e,t):T.forEach(function(n,i){r=i.mark(e,t)||r}),r){R.update(!0);var i=q;ne(!0),q=i}},getLoci:function(e){var t=g.EmptyLoci,n=y.Representation.Empty;return T.forEach(function(r,i){var a=i.getLoci(e);g.isEmptyLoci(a)||(g.isEmptyLoci(t)||console.warn("found another loci"),t=a,n=i)}),{loci:t,repr:n}},handleResize:oe,resetCamera:function(){V.focus(R.boundingSphere.center,R.boundingSphere.radius),re(!0)},camera:V,downloadScreenshot:function(){},getImageData:function(e){switch(e){case"draw":return N.getImageData();case"pickObject":return z.getImageData();case"pickInstance":return U.getImageData();case"pickGroup":return G.getImageData()}},didDraw:I,setProps:function(e){void 0!==e.cameraMode&&e.cameraMode!==V.state.mode&&V.setState({mode:e.cameraMode}),void 0!==e.backgroundColor&&e.backgroundColor!==N.props.clearColor&&N.setClearColor(e.backgroundColor),void 0!==e.cameraClipDistance&&(_.cameraClipDistance=e.cameraClipDistance),void 0!==e.clip&&(_.clip=[e.clip[0],e.clip[1]]),void 0!==e.fog&&(_.fog=[e.fog[0],e.fog[1]]),void 0!==e.pickingAlphaThreshold&&e.pickingAlphaThreshold!==N.props.pickingAlphaThreshold&&N.setPickingAlphaThreshold(e.pickingAlphaThreshold),e.trackball&&j.setProps(e.trackball),e.debug&&K.setProps(e.debug),re(!0)},get props(){return{cameraMode:V.state.mode,backgroundColor:N.props.clearColor,cameraClipDistance:_.cameraClipDistance,clip:_.clip,fog:_.fog,pickingAlphaThreshold:N.props.pickingAlphaThreshold,trackball:r({},j.props),debug:r({},K.props)}},get input(){return M},get stats(){return N.stats},dispose:function(){R.clear(),K.clear(),M.dispose(),j.dispose(),N.dispose(),V.dispose()}};function oe(){h.resizeCanvas(e,n),N.setViewport(0,0,e.width,e.height),p.Viewport.set(V.viewport,0,0,e.width,e.height),p.Viewport.set(j.viewport,0,0,e.width,e.height),B=.25/D.pixelRatio,F=Math.round(e.width*B),L=Math.round(e.height*B),z.setSize(F,L),U.setSize(F,L),G.setSize(F,L),re(!0)}}}(o||(o={})),t.Canvas3D=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(301),i=n(180),a=n(131);function o(){return o.zero()}!function(e){function t(){var e=[.1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];return e[0]=0,e}function n(){var e=t();return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function o(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function u(e){for(var t=0;t<16;t++)e[t]=0;return e}e.zero=t,e.identity=n,e.setIdentity=o,e.setZero=u,e.ofRows=function(e){for(var n=t(),r=0;r<4;r++)for(var i=e[r],a=0;a<4;a++)n[4*a+r]=i[a];return n};var s=n();function c(e,t,n){for(var r=0;r<16;r++)if(Math.abs(e[r]-t[r])>n)return!1;return!0}function l(e,t,n,r){e[4*n+t]=r}function f(e,t,n){var r=t[0],i=t[1],a=t[2],o=t[3],u=t[4],s=t[5],c=t[6],l=t[7],f=t[8],d=t[9],p=t[10],h=t[11],m=t[12],y=t[13],v=t[14],b=t[15],g=n[0],_=n[1],S=n[2],C=n[3];return e[0]=g*r+_*u+S*f+C*m,e[1]=g*i+_*s+S*d+C*y,e[2]=g*a+_*c+S*p+C*v,e[3]=g*o+_*l+S*h+C*b,g=n[4],_=n[5],S=n[6],C=n[7],e[4]=g*r+_*u+S*f+C*m,e[5]=g*i+_*s+S*d+C*y,e[6]=g*a+_*c+S*p+C*v,e[7]=g*o+_*l+S*h+C*b,g=n[8],_=n[9],S=n[10],C=n[11],e[8]=g*r+_*u+S*f+C*m,e[9]=g*i+_*s+S*d+C*y,e[10]=g*a+_*c+S*p+C*v,e[11]=g*o+_*l+S*h+C*b,g=n[12],_=n[13],S=n[14],C=n[15],e[12]=g*r+_*u+S*f+C*m,e[13]=g*i+_*s+S*d+C*y,e[14]=g*a+_*c+S*p+C*v,e[15]=g*o+_*l+S*h+C*b,e}e.isIdentity=function(e,t){return c(e,s,void 0===t?1e-6:t)},e.hasNaN=function(e){for(var t=0;t<16;t++)if(isNaN(e[t]))return!0;return!1},e.areEqual=c,e.setValue=l,e.getValue=function(e,t,n){return e[4*n+t]},e.toArray=function(e,t,n){t[n+0]=e[0],t[n+1]=e[1],t[n+2]=e[2],t[n+3]=e[3],t[n+4]=e[4],t[n+5]=e[5],t[n+6]=e[6],t[n+7]=e[7],t[n+8]=e[8],t[n+9]=e[9],t[n+10]=e[10],t[n+11]=e[11],t[n+12]=e[12],t[n+13]=e[13],t[n+14]=e[14],t[n+15]=e[15]},e.fromArray=function(e,t,n){return e[0]=t[n+0],e[1]=t[n+1],e[2]=t[n+2],e[3]=t[n+3],e[4]=t[n+4],e[5]=t[n+5],e[6]=t[n+6],e[7]=t[n+7],e[8]=t[n+8],e[9]=t[n+9],e[10]=t[n+10],e[11]=t[n+11],e[12]=t[n+12],e[13]=t[n+13],e[14]=t[n+14],e[15]=t[n+15],e},e.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},e.clone=function(t){return e.copy(e.zero(),t)},e.getTranslation=function(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e},e.getScaling=function(e,t){var n=t[0],r=t[1],i=t[2],a=t[4],o=t[5],u=t[6],s=t[8],c=t[9],l=t[10];return e[0]=Math.sqrt(n*n+r*r+i*i),e[1]=Math.sqrt(a*a+o*o+u*u),e[2]=Math.sqrt(s*s+c*c+l*l),e},e.getRotation=function(e,t){var n=t[0]+t[5]+t[10],r=0;return n>0?(r=2*Math.sqrt(n+1),e[3]=.25*r,e[0]=(t[6]-t[9])/r,e[1]=(t[8]-t[2])/r,e[2]=(t[1]-t[4])/r):t[0]>t[5]&&t[0]>t[10]?(r=2*Math.sqrt(1+t[0]-t[5]-t[10]),e[3]=(t[6]-t[9])/r,e[0]=.25*r,e[1]=(t[1]+t[4])/r,e[2]=(t[8]+t[2])/r):t[5]>t[10]?(r=2*Math.sqrt(1+t[5]-t[0]-t[10]),e[3]=(t[8]-t[2])/r,e[0]=(t[1]+t[4])/r,e[1]=.25*r,e[2]=(t[6]+t[9])/r):(r=2*Math.sqrt(1+t[10]-t[0]-t[5]),e[3]=(t[1]-t[4])/r,e[0]=(t[8]+t[2])/r,e[1]=(t[6]+t[9])/r,e[2]=.25*r),e},e.transpose=function(e,t){if(e===t){var n=t[1],r=t[2],i=t[3],a=t[6],o=t[7],u=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=n,e[6]=t[9],e[7]=t[13],e[8]=r,e[9]=a,e[11]=t[14],e[12]=i,e[13]=o,e[14]=u}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e},e.invert=function(e,t){var n=t[0],r=t[1],i=t[2],a=t[3],o=t[4],u=t[5],s=t[6],c=t[7],l=t[8],f=t[9],d=t[10],p=t[11],h=t[12],m=t[13],y=t[14],v=t[15],b=n*u-r*o,g=n*s-i*o,_=n*c-a*o,S=r*s-i*u,C=r*c-a*u,x=i*c-a*s,w=l*m-f*h,P=l*y-d*h,T=l*v-p*h,A=f*y-d*m,E=f*v-p*m,k=d*v-p*y,I=b*k-g*E+_*A+S*T-C*P+x*w;return I?(I=1/I,e[0]=(u*k-s*E+c*A)*I,e[1]=(i*E-r*k-a*A)*I,e[2]=(m*x-y*C+v*S)*I,e[3]=(d*C-f*x-p*S)*I,e[4]=(s*T-o*k-c*P)*I,e[5]=(n*k-i*T+a*P)*I,e[6]=(y*_-h*x-v*g)*I,e[7]=(l*x-d*_+p*g)*I,e[8]=(o*E-u*T+c*w)*I,e[9]=(r*T-n*E-a*w)*I,e[10]=(h*C-m*_+v*b)*I,e[11]=(f*_-l*C-p*b)*I,e[12]=(u*P-o*A-s*w)*I,e[13]=(n*A-r*P+i*w)*I,e[14]=(m*g-h*S-y*b)*I,e[15]=(l*S-f*g+d*b)*I,e):(console.warn("non-invertible matrix.",t),e)},e.mul=f,e.mulOffset=function(e,t,n,r,i,a){var o=t[0+i],u=t[1+i],s=t[2+i],c=t[3+i],l=t[4+i],f=t[5+i],d=t[6+i],p=t[7+i],h=t[8+i],m=t[9+i],y=t[10+i],v=t[11+i],b=t[12+i],g=t[13+i],_=t[14+i],S=t[15+i],C=n[0+a],x=n[1+a],w=n[2+a],P=n[3+a];return e[0+r]=C*o+x*l+w*h+P*b,e[1+r]=C*u+x*f+w*m+P*g,e[2+r]=C*s+x*d+w*y+P*_,e[3+r]=C*c+x*p+w*v+P*S,C=n[4+a],x=n[5+a],w=n[6+a],P=n[7+a],e[4+r]=C*o+x*l+w*h+P*b,e[5+r]=C*u+x*f+w*m+P*g,e[6+r]=C*s+x*d+w*y+P*_,e[7+r]=C*c+x*p+w*v+P*S,C=n[8+a],x=n[9+a],w=n[10+a],P=n[11+a],e[8+r]=C*o+x*l+w*h+P*b,e[9+r]=C*u+x*f+w*m+P*g,e[10+r]=C*s+x*d+w*y+P*_,e[11+r]=C*c+x*p+w*v+P*S,C=n[12+a],x=n[13+a],w=n[14+a],P=n[15+a],e[12+r]=C*o+x*l+w*h+P*b,e[13+r]=C*u+x*f+w*m+P*g,e[14+r]=C*s+x*d+w*y+P*_,e[15+r]=C*c+x*p+w*v+P*S,e},e.mul3=function(e,t,n,r){return f(e,f(e,t,n),r)},e.translate=function(e,t,n){var r,i,a,o,u,s,c,l,f,d,p,h,m=n[0],y=n[1],v=n[2];return t===e?(e[12]=t[0]*m+t[4]*y+t[8]*v+t[12],e[13]=t[1]*m+t[5]*y+t[9]*v+t[13],e[14]=t[2]*m+t[6]*y+t[10]*v+t[14],e[15]=t[3]*m+t[7]*y+t[11]*v+t[15]):(r=t[0],i=t[1],a=t[2],o=t[3],u=t[4],s=t[5],c=t[6],l=t[7],f=t[8],d=t[9],p=t[10],h=t[11],e[0]=r,e[1]=i,e[2]=a,e[3]=o,e[4]=u,e[5]=s,e[6]=c,e[7]=l,e[8]=f,e[9]=d,e[10]=p,e[11]=h,e[12]=r*m+u*y+f*v+t[12],e[13]=i*m+s*y+d*v+t[13],e[14]=a*m+c*y+p*v+t[14],e[15]=o*m+l*y+h*v+t[15]),e},e.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e},e.setTranslation=function(e,t){return e[12]=t[0],e[13]=t[1],e[14]=t[2],e},e.setAxes=function(e,t,n,r){return e[0]=n[0],e[4]=n[1],e[8]=n[2],e[1]=r[0],e[5]=r[1],e[9]=r[2],e[2]=t[0],e[6]=t[1],e[10]=t[2],e},e.rotate=function(t,n,r,i){var a,o,u,s,c,l,f,d,p,h,m,y,v,b,g,_,S,C,x,w,P,T,A,E,k=i[0],I=i[1],M=i[2],V=Math.sqrt(k*k+I*I+M*M);return Math.abs(V)<1e-6?e.identity():(k*=V=1/V,I*=V,M*=V,a=Math.sin(r),u=1-(o=Math.cos(r)),s=n[0],c=n[1],l=n[2],f=n[3],d=n[4],p=n[5],h=n[6],m=n[7],y=n[8],v=n[9],b=n[10],g=n[11],_=k*k*u+o,S=I*k*u+M*a,C=M*k*u-I*a,x=k*I*u-M*a,w=I*I*u+o,P=M*I*u+k*a,T=k*M*u+I*a,A=I*M*u-k*a,E=M*M*u+o,t[0]=s*_+d*S+y*C,t[1]=c*_+p*S+v*C,t[2]=l*_+h*S+b*C,t[3]=f*_+m*S+g*C,t[4]=s*x+d*w+y*P,t[5]=c*x+p*w+v*P,t[6]=l*x+h*w+b*P,t[7]=f*x+m*w+g*P,t[8]=s*T+d*A+y*E,t[9]=c*T+p*A+v*E,t[10]=l*T+h*A+b*E,t[11]=f*T+m*A+g*E,n!==t&&(t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15]),t)},e.fromRotation=function(e,t,n){var r,i,a,u=n[0],s=n[1],c=n[2],l=Math.sqrt(u*u+s*s+c*c);return Math.abs(l)<1e-6?o(e):(u*=l=1/l,s*=l,c*=l,r=Math.sin(t),a=1-(i=Math.cos(t)),e[0]=u*u*a+i,e[1]=s*u*a+c*r,e[2]=c*u*a-s*r,e[3]=0,e[4]=u*s*a-c*r,e[5]=s*s*a+i,e[6]=c*s*a+u*r,e[7]=0,e[8]=u*c*a+s*r,e[9]=s*c*a-u*r,e[10]=c*c*a+i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)},e.scale=function(e,t,n){var r=n[0],i=n[1],a=n[2];return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*a,e[9]=t[9]*a,e[10]=t[10]*a,e[11]=t[11]*a,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},e.scaleUniformly=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*n,e[9]=t[9]*n,e[10]=t[10]*n,e[11]=t[11]*n,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},e.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},e.fromUniformScaling=function(e,t){return e[0]=t,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},e.makeTable=function(e){for(var t="",n=0;n<4;n++){for(var r=0;r<4;r++)t+=e[4*r+n].toString(),r<3&&(t+=" ");n<3&&(t+="\n")}return t},e.determinant=function(e){var t=e[0],n=e[1],r=e[2],i=e[3],a=e[4],o=e[5],u=e[6],s=e[7],c=e[8],l=e[9],f=e[10],d=e[11],p=e[12],h=e[13],m=e[14],y=e[15];return(t*o-n*a)*(f*y-d*m)-(t*u-r*a)*(l*y-d*h)+(t*s-i*a)*(l*m-f*h)+(n*u-r*o)*(c*y-d*p)-(n*s-i*o)*(c*m-f*p)+(r*s-i*u)*(c*h-l*p)},e.isRotationAndTranslation=function(e,t){return function(e,t){var n=e[0],i=e[1],a=e[2],o=e[3],u=e[4],s=e[5],c=e[6],l=e[7],f=e[8],d=e[9],p=e[10],h=e[11],m=e[15];if(!(r.equalEps(m,1,t)&&r.equalEps(o,0,t)&&r.equalEps(l,0,t)&&r.equalEps(h,0,t)))return!1;var y=n*(s*p-c*d)-i*(u*p-c*f)+a*(u*d-s*f);return!!r.equalEps(y,1,t)}(e,void 0!==t?t:1e-6)},e.fromQuat=function(e,t){var n=t[0],r=t[1],i=t[2],a=t[3],o=n+n,u=r+r,s=i+i,c=n*o,l=r*o,f=r*u,d=i*o,p=i*u,h=i*s,m=a*o,y=a*u,v=a*s;return e[0]=1-f-h,e[1]=l+v,e[2]=d-y,e[3]=0,e[4]=l-v,e[5]=1-c-h,e[6]=p+m,e[7]=0,e[8]=d+y,e[9]=p-m,e[10]=1-c-f,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},e.frustum=function(e,t,n,r,i,a,o){var u=1/(n-t),s=1/(i-r),c=1/(a-o);return e[0]=2*a*u,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*a*s,e[6]=0,e[7]=0,e[8]=(n+t)*u,e[9]=(i+r)*s,e[10]=(o+a)*c,e[11]=-1,e[12]=0,e[13]=0,e[14]=o*a*2*c,e[15]=0,e},e.perspective=function(e,t,n,r,i){var a=1/Math.tan(t/2),o=1/(r-i);return e[0]=a/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=(i+r)*o,e[11]=-1,e[12]=0,e[13]=0,e[14]=2*i*r*o,e[15]=0,e},e.ortho=function(e,t,n,r,i,a,o){var u=1/(t-n),s=1/(r-i),c=1/(a-o);return e[0]=-2*u,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+n)*u,e[13]=(i+r)*s,e[14]=(o+a)*c,e[15]=1,e},e.lookAt=function(e,t,n,r){var i,a,u,s,c,l,f,d,p,h,m=t[0],y=t[1],v=t[2],b=r[0],g=r[1],_=r[2],S=n[0],C=n[1],x=n[2];return Math.abs(m-S)<1e-6&&Math.abs(y-C)<1e-6&&Math.abs(v-x)<1e-6?o(e):(f=m-S,d=y-C,p=v-x,i=g*(p*=h=1/Math.sqrt(f*f+d*d+p*p))-_*(d*=h),a=_*(f*=h)-b*p,u=b*d-g*f,(h=Math.sqrt(i*i+a*a+u*u))?(i*=h=1/h,a*=h,u*=h):(i=0,a=0,u=0),s=d*u-p*a,c=p*i-f*u,l=f*a-d*i,(h=Math.sqrt(s*s+c*c+l*l))?(s*=h=1/h,c*=h,l*=h):(s=0,c=0,l=0),e[0]=i,e[1]=s,e[2]=f,e[3]=0,e[4]=a,e[5]=c,e[6]=d,e[7]=0,e[8]=u,e[9]=l,e[10]=p,e[11]=0,e[12]=-(i*m+a*y+u*v),e[13]=-(s*m+c*y+l*v),e[14]=-(f*m+d*y+p*v),e[15]=1,e)},e.targetTo=function(e,t,n,r){var i=t[0],a=t[1],o=t[2],u=r[0],s=r[1],c=r[2],l=i-n[0],f=a-n[1],d=o-n[2],p=l*l+f*f+d*d;p>0&&(l*=p=1/Math.sqrt(p),f*=p,d*=p);var h=s*d-c*f,m=c*l-u*d,y=u*f-s*l;return(p=h*h+m*m+y*y)>0&&(h*=p=1/Math.sqrt(p),m*=p,y*=p),e[0]=h,e[1]=m,e[2]=y,e[3]=0,e[4]=f*y-d*m,e[5]=d*h-l*y,e[6]=l*m-f*h,e[7]=0,e[8]=l,e[9]=f,e[10]=d,e[11]=0,e[12]=i,e[13]=a,e[14]=o,e[15]=1,e},e.fromPermutation=function(e,t){u(e);for(var n=0;n<4;n++)l(e,n,t[n],1);return e},e.getMaxScaleOnAxis=function(e){var t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,r))},e.rotX90=e.fromRotation(e.identity(),a.degToRad(90),i.default.create(1,0,0)),e.rotX180=e.fromRotation(e.identity(),a.degToRad(180),i.default.create(1,0,0)),e.rotY90=e.fromRotation(e.identity(),a.degToRad(90),i.default.create(0,1,0)),e.rotY180=e.fromRotation(e.identity(),a.degToRad(180),i.default.create(0,1,0)),e.rotZ90=e.fromRotation(e.identity(),a.degToRad(90),i.default.create(0,0,1)),e.rotZ180=e.fromRotation(e.identity(),a.degToRad(180),i.default.create(0,0,1)),e.rotXY90=e.mul(e.identity(),e.rotX90,e.rotY90),e.rotZY90=e.mul(e.identity(),e.rotZ90,e.rotY90),e.rotZYZ90=e.mul(e.identity(),e.rotZY90,e.rotZ90),e.rotZ90X180=e.mul(e.identity(),e.rotZ90,e.rotX180),e.rotY90Z180=e.mul(e.identity(),e.rotY90,e.rotZ180)}(o||(o={})),t.default=o},function(e,t,n){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),function(e){function t(){var e=[.1,0,0,0,0,0,0,0,0];return e[0]=0,e}e.zero=t,e.identity=function(){var e=t();return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},e.setIdentity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},e.toArray=function(e,t,n){t[n+0]=e[0],t[n+1]=e[1],t[n+2]=e[2],t[n+3]=e[3],t[n+4]=e[4],t[n+5]=e[5],t[n+6]=e[6],t[n+7]=e[7],t[n+8]=e[8]},e.fromArray=function(e,t,n){return e[0]=t[n+0],e[1]=t[n+1],e[2]=t[n+2],e[3]=t[n+3],e[4]=t[n+4],e[5]=t[n+5],e[6]=t[n+6],e[7]=t[n+7],e[8]=t[n+8],e},e.fromMat4=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},e.hasNaN=function(e){for(var t=0;t<9;t++)if(isNaN(e[t]))return!0;return!1},e.clone=function(t){return e.copy(e.zero(),t)},e.setValue=function(e,t,n,r){e[3*n+t]=r},e.getValue=function(e,t,n){return e[3*n+t]},e.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},e.transpose=function(e,t){if(e===t){var n=t[1],r=t[2],i=t[5];e[1]=t[3],e[2]=t[6],e[3]=n,e[5]=t[7],e[6]=r,e[7]=i}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e},e.invert=function(e,t){var n=t[0],r=t[1],i=t[2],a=t[3],o=t[4],u=t[5],s=t[6],c=t[7],l=t[8],f=l*o-u*c,d=-l*a+u*s,p=c*a-o*s,h=n*f+r*d+i*p;return h?(h=1/h,e[0]=f*h,e[1]=(-l*r+i*c)*h,e[2]=(u*r-i*o)*h,e[3]=d*h,e[4]=(l*n-i*s)*h,e[5]=(-u*n+i*a)*h,e[6]=p*h,e[7]=(-c*n+r*s)*h,e[8]=(o*n-r*a)*h,e):(console.warn("non-invertible matrix.",t),e)},e.determinant=function(e){var t=e[0],n=e[1],r=e[2],i=e[3],a=e[4],o=e[5],u=e[6],s=e[7],c=e[8];return t*(c*a-o*s)+n*(-c*i+o*u)+r*(s*i-a*u)}}(r||(r={})),t.default=r},function(e,t,n){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.create=function(e){return e},e.has=function(e,t){return 0!=(e&t)},e.hasAll=function(e,t){return!!t&&(e&t)===t}}(r||(r={})),t.default=r},function(e,t,n){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.create=function(e){return void 0===e&&(e=512),{current:[],offset:0,capacity:e,chunks:[]}},e.getString=function(e){return e.chunks.length?(e.offset>0&&(e.chunks[e.chunks.length]=e.current.length===e.offset?e.current.join(""):e.current.slice(0,e.offset).join("")),e.chunks.join("")):e.current.length===e.offset?e.current.join(""):e.current.splice(0,e.offset).join("")},e.getChunks=function(e){return e.offset>0&&(e.current.length===e.offset?e.chunks[e.chunks.length]=e.current.join(""):e.chunks[e.chunks.length]=e.current.slice(0,e.offset).join(""),e.offset=0),e.chunks};var t=[];function n(e,n){n>0&&r(e,t[n])}function r(e,t){e.offset===e.capacity&&(e.chunks[e.chunks.length]=e.current.join(""),e.offset=0),e.current[e.offset++]=t}!function(){for(var e="",n=0;n<512;n++)t[n]=e,e+=" "}(),e.newline=function(e){r(e,"\n")},e.whitespace=n,e.whitespace1=function(e){r(e," ")},e.write=function(e,t){t&&(e.offset===e.capacity&&(e.chunks[e.chunks.length]=e.current.join(""),e.offset=0),e.current[e.offset++]=t)},e.writeSafe=r,e.writePadLeft=function(e,t,i){t?(n(e,i-t.length),r(e,t)):n(e,i)},e.writePadRight=function(e,t,i){if(t){var a=i-t.length;r(e,t),n(e,a)}else n(e,i)},e.writeInteger=function(e,t){r(e,""+t)},e.writeIntegerAndSpace=function(e,t){r(e,t+" ")},e.writeIntegerPadLeft=function(e,t,i){var a=""+t;n(e,i-a.length),r(e,a)},e.writeIntegerPadRight=function(e,t,i){var a=""+t,o=i-a.length;r(e,a),n(e,o)},e.writeFloat=function(e,t,n){r(e,""+Math.round(n*t)/n)},e.writeFloatPadLeft=function(e,t,i,a){var o=""+Math.round(i*t)/i;n(e,a-o.length),r(e,o)},e.writeFloatPadRight=function(e,t,i,a){var o=""+Math.round(i*t)/i,u=a-o.length;r(e,o),n(e,u)}}(r||(r={})),t.default=r},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i,a=n(223),o=n(184),u=n(7);!function(e){function t(e,t,n){var r=Object.create(null),i=Object.keys(t);r._rowCount=n.length,r._columns=i,r._schema=t;for(var o=0,u=i;o<u.length;o++){var s=u[o];r[s]=a.default.view(e[s],n)}return r}function n(e,t){for(var n=Object.create(null),r=e._columns,i=0;i<r.length;i++){var a=r[i];n[a]=e[a].value(t)}return n}e.is=function(e){return e&&"number"==typeof e._rowCount&&!!e._columns&&!!e._schema},e.pickColumns=function(e,t,n){void 0===n&&(n={});var r=Object.create(null),i=Object.keys(e);r._rowCount=t._rowCount,r._columns=i,r._schema=e;for(var a=0,o=i;a<o.length;a++){var u=o[a];if(t[u])r[u]=t[u];else{if(!n[u])throw Error("Cannot find column '"+u+"'.");r[u]=n[u]}}return r},e.ofColumns=function(e,t){var n=Object.keys(t),i=t[n[0]].rowCount;return r({_rowCount:i,_columns:n,_schema:e},t)},e.ofUndefinedColumns=function(e,t){var n=Object.create(null),r=Object.keys(e);n._rowCount=t,n._columns=r,n._schema=e;for(var i=0,o=r;i<o.length;i++){var u=o[i];n[u]=a.default.Undefined(t,e[u])}return n},e.ofRows=function(e,t){var n=Object.create(null),r=t.length,i=Object.keys(e);n._rowCount=r,n._columns=i,n._schema=e;for(var o=function(i){n[i]=a.default.ofLambda({rowCount:r,schema:e[i],value:function(e){return t[e][i]},valueKind:function(e){return void 0===t[e][i]?1:0}})},u=0,s=i;u<s.length;u++)o(s[u]);return n},e.ofArrays=function(e,t){var n=Object.create(null),r=Object.keys(e);n._rowCount=t[r[0]].length,n._columns=r,n._schema=e;for(var i=0,o=r;i<o.length;i++){var u=o[i];n[u]=void 0!==t[u]?a.default.ofArray({array:t[u],schema:e[u]}):a.default.Undefined(n._rowCount,e[u])}return n},e.view=t,e.pick=function(e,n,r){for(var i=[],a=0,o=e._rowCount;a<o;++a)r(a)&&i.push(a);return t(e,n,i)},e.window=function(e,t,n,r){if(0===n&&r===e._rowCount)return e;var i=Object.create(null),o=Object.keys(t);i._rowCount=r-n,i._columns=o,i._schema=t;for(var u=0,s=o;u<s.length;u++){var c=s[u];i[c]=a.default.window(e[c],n,r)}return i},e.concat=function(e,t){var n=Object.create(null),r=Object.keys(t);n._rowCount=0;for(var i=0,o=e;i<o.length;i++){var u=o[i];n._rowCount+=u._rowCount}for(var s={},c=0,l=r;c<l.length;c++)s[l[c]]=new Array(n._rowCount);n._columns=r,n._schema=t;for(var f=0,d=0,p=e;d<p.length;d++){u=p[d];for(var h=0,m=r;h<m.length;h++){var y=m[h];a.default.copyToArray(u[y],s[y],f)}f+=u._rowCount}for(var v=0,b=r;v<b.length;v++)n[y=b[v]]=a.default.ofArray({array:s[y],schema:t[y]});return n},e.columnToArray=function(e,t,n){e[t]=a.default.asArrayColumn(e[t],n)},e.sort=function(e,t){for(var n=new Int32Array(e._rowCount),r=0,i=n.length;r<i;r++)n[r]=r;o.sortArray(n,function(e,n,r){return t(n,r)});var u=!0;for(r=0,i=n.length;r<i;r++)if(n[r]!==r){u=!1;break}if(u)return e;var s=Object.create(null);s._rowCount=e._rowCount,s._columns=e._columns,s._schema=e._schema;for(var c=0,l=e._columns;c<l.length;c++){var f=l[c];s[f]=a.default.view(e[f],n,!1)}return s},e.areEqual=function(e,t){if(e._rowCount!==t._rowCount)return!1;if(e._columns.length!==t._columns.length)return!1;for(var n=0,r=e._columns;n<r.length;n++)if(!t[u=r[n]])return!1;for(var i=0,o=e._columns;i<o.length;i++){var u=o[i];if(!a.default.areEqual(e[u],t[u]))return!1}return!0},e.getRow=n,e.pickRow=function(e,t){for(var r=0,i=e._rowCount;r<i;++r)if(t(r))return n(e,r)},e.getRows=function(e){for(var t=[],r=e._rowCount,i=0;i<r;i++)t[i]=n(e,i);return t},e.formatToString=function(e){var t=u.StringBuilder.create(),n=e._columns,r=e._rowCount,i=1;u.StringBuilder.write(t,"|");for(var a=0;a<n.length;a++)u.StringBuilder.write(t,n[a]),u.StringBuilder.write(t,"|"),i+=n[a].length+1;u.StringBuilder.newline(t),u.StringBuilder.write(t,new Array(i+1).join("-")),u.StringBuilder.newline(t);for(var o=0;o<r;o++){for(u.StringBuilder.write(t,"|"),a=0;a<n.length;a++){var s=e[n[a]];0===s.valueKind(o)?(u.StringBuilder.write(t,s.value(o)),u.StringBuilder.write(t,"|")):u.StringBuilder.write(t,".|")}u.StringBuilder.newline(t)}return u.StringBuilder.getString(t)}}(i||(i={})),t.default=i},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i,a=n(224),o=n(2);function u(e,t,n,r){return{schema:n,__array:void 0,isDefined:0===r,rowCount:t,value:function(t){return e},valueKind:function(e){return r},toArray:function(n){for(var r=a.createArray(t,n).array,i=0,o=r.length;i<o;i++)r[i]=e;return r},areValuesEqual:function(e,t){return!0}}}function s(e){var t=e.array,n=e.schema,r=e.valueKind,i=t.length,o="str"===n.valueType?function(e){var n=t[e];return"string"==typeof n?n:""+n}:function(e){return t[e]},u=a.isTypedArray(t);return{schema:n,__array:t,isDefined:!0,rowCount:i,value:o,valueKind:r||function(e){return 0},toArray:"str"===n.valueType?function(e){for(var n=a.getArrayBounds(i,e),r=n.start,o=n.end,u=new(e&&void 0!==e.array?e.array:t.constructor)(o-r),s=0,c=o-r;s<c;s++){var l=t[r+s];u[s]="string"==typeof l?l:""+l}return u}:u?function(e){return a.typedArrayWindow(t,e)}:function(e){var n=a.getArrayBounds(i,e),r=n.start,o=n.end;if(0===r&&o===t.length)return t;for(var u=new(e&&void 0!==e.array?e.array:t.constructor)(o-r),s=0,c=o-r;s<c;s++)u[s]=t[r+s];return u},areValuesEqual:function(e,n){return t[e]===t[n]}}}function c(e,t,n){return e.isDefined?0===t&&n===e.rowCount?e:e.__array&&a.isTypedArray(e.__array)?function(e,t,n){return s({array:a.typedArrayWindow(e.__array,{start:t,end:n}),schema:e.schema,valueKind:e.valueKind})}(e,t,n):function(e,t,n){var r=e.value,i=e.valueKind,o=e.areValuesEqual,u=0===t?r:function(e){return r(e+t)},s=n-t;return{schema:e.schema,__array:void 0,isDefined:e.isDefined,rowCount:s,value:u,valueKind:0===t?i:function(e){return i(e+t)},toArray:function(e){for(var n=a.createArray(s,e).array,i=0,o=n.length;i<o;i++)n[i]=r(i+t);return n},areValuesEqual:0===t?o:function(e,n){return o(e+t,n+t)}}}(e,t,n):i.Undefined(n-t,e.schema)}!function(e){var t;function n(e,t){return u(t.T,e,t,1)}function i(e){return n=(t=e).value,r=t.valueKind,i=t.rowCount,{schema:t.schema,__array:void 0,isDefined:!0,rowCount:i,value:n,valueKind:r||function(e){return 0},toArray:function(e){for(var t=a.createArray(i,e),r=t.array,o=t.start,u=0,s=r.length;u<s;u++)r[u]=n(u+o);return r},areValuesEqual:function(e,t){return n(e)===n(t)}};var t,n,r,i}!function(e){function t(t,n){return void 0===n&&(n=e.float),{"@type":"tensor",T:t.create(),space:t,valueType:"tensor",baseType:n}}e.str={"@type":"str",T:"",valueType:"str"},e.int={"@type":"int",T:0,valueType:"int"},e.coord={"@type":"coord",T:0,valueType:"float"},e.float={"@type":"float",T:0,valueType:"float"},e.Str=function(e){return void 0===e&&(e=""),{"@type":"str",T:e,valueType:"str"}},e.Int=function(e){return void 0===e&&(e=0),{"@type":"int",T:e,valueType:"int"}},e.Float=function(e){return void 0===e&&(e=0),{"@type":"float",T:e,valueType:"float"}},e.Tensor=t,e.Vector=function(n,r){return void 0===r&&(r=e.float),t(o.Tensor.Vector(n,"int"===r["@type"]?Int32Array:Float64Array),r)},e.Matrix=function(n,r,i){return void 0===i&&(i=e.float),t(o.Tensor.ColumnMajorMatrix(n,r,"int"===i["@type"]?Int32Array:Float64Array),i)},e.Aliased=function(e,t){return void 0!==t?r({},e,{T:t}):e},e.List=function(e,t,n){return void 0===n&&(n=[]),{"@type":"list",T:n,separator:e,itemParse:t,valueType:"list"}}}(t=e.Schema||(e.Schema={})),e.is=function(e){return!!e&&!!e.schema&&!!e.value},e.Undefined=n,e.ofConst=function(e,t,n){return u(e,t,n,0)},e.ofLambda=i,e.range=function(e,n){return i({value:function(t){return t+e},rowCount:Math.max(n-e+1,0),schema:t.int})},e.ofArray=function(e){return s(e)},e.ofIntArray=function(e){return s({array:e,schema:t.int})},e.ofFloatArray=function(e){return s({array:e,schema:t.float})},e.ofStringArray=function(e){return s({array:e,schema:t.str})},e.window=function(e,t,n){return c(e,t,n)},e.view=function(e,t,n){return void 0===n&&(n=!0),i=t,o=n,(r=e).isDefined?o&&function(e,t){if(e.length!==t)return!1;for(var n=0,r=e.length;n<r;n++)if(e[n]!==n)return!1;return!0}(i,r.rowCount)?r:r.__array?function(e,t){for(var n=e.__array,r=new n.constructor(t.length),i=0,a=t.length;i<a;i++)r[i]=n[t[i]];return s({array:r,schema:e.schema,valueKind:e.valueKind})}(r,i):function(e,t){var n=e.value,r=e.valueKind,i=e.areValuesEqual,o=t.length;return{schema:e.schema,__array:void 0,isDefined:e.isDefined,rowCount:o,value:function(e){return n(t[e])},valueKind:function(e){return r(t[e])},toArray:function(e){for(var r=a.createArray(o,e).array,i=0,u=r.length;i<u;i++)r[i]=n(t[i]);return r},areValuesEqual:function(e,n){return i(t[e],t[n])}}}(r,i):r;var r,i,o},e.createFirstIndexMap=function(e){return function(e){for(var t=new Map,n=0,r=e.rowCount;n<r;n++){var i=e.value(n);t.has(i)||t.set(e.value(n),n)}return t}(e)},e.createIndexer=function(e){return function(e){for(var t=new Map,n=0,r=e.rowCount;n<r;n++){var i=e.value(n);t.has(i)||t.set(e.value(n),n)}return function(e){return t.has(e)?t.get(e):-1}}(e)},e.mapToArray=function(e,t,n){return function(e,t,n){for(var r=new n(e.rowCount),i=0,a=e.rowCount;i<a;i++)r[i]=t(e.value(i));return r}(e,t,n||Array)},e.areEqual=function(e,t){return function(e,t){return e===t||e.rowCount===t.rowCount&&e.isDefined===t.isDefined&&e.schema.valueType===t.schema.valueType&&(e.__array&&t.__array?function(e,t){for(var n=e.__array,r=t.__array,i=0,a=e.rowCount;i<a;i++)if(n[i]!==r[i])return!1;return!0}(e,t):function(e,t){for(var n=e.value,r=t.value,i=0,a=e.rowCount;i<a;i++)if(n(i)!==r(i))return!1;return!0}(e,t))}(e,t)},e.indicesOf=function(e,t){return function(e,t){for(var n=[],r=e.value,i=0,a=e.rowCount;i<a;i++)t(r(i))&&(n[n.length]=i);return n}(e,t)},e.asArrayColumn=function(e,t){return e.__array?e:e.isDefined?s({array:e.toArray({array:t}),schema:e.schema,valueKind:e.valueKind}):n(e.rowCount,e.schema)},e.copyToArray=function(e,t,n){if(void 0===n&&(n=0),e.isDefined){var r=e.__array;if(r)for(var i=0,a=r.length;i<a;i++)t[n+i]=r[i];else for(i=0,a=e.rowCount;i<a;i++)t[n+i]=e.value(i)}}}(i||(i={})),t.default=i},function(e,t,n){"use strict";function r(e,t){return{start:t&&void 0!==t.start?Math.max(Math.min(t.start,e-1),0):0,end:t&&void 0!==t.end?Math.min(t.end,e):e}}function i(e,t){var n=t&&void 0!==t.array?t.array:Array,i=r(e,t),a=i.start,o=i.end;return{array:new n(o-a),start:a,end:o}}function a(e,t,n){for(var r=0,i=t.length;r<i;r++)t[r]=e(n+r);return t}Object.defineProperty(t,"__esModule",{value:!0}),t.getArrayBounds=r,t.createArray=i,t.fillArrayValues=a,t.createAndFillArray=function(e,t,n){var r=i(e,n);return a(t,r.array,r.start)},t.isTypedArray=function(e){return!!e.buffer&&"number"==typeof e.byteLength&&"number"==typeof e.BYTES_PER_ELEMENT},t.typedArrayWindow=function(e,t){var n=e.constructor,i=e.buffer,a=e.length,o=e.byteOffset,u=e.BYTES_PER_ELEMENT,s=r(a,t),c=s.start,l=s.end;return 0===c&&l===a?e:new n(i,o+u*c,Math.min(a,l-c))}},function(e,t,n){"use strict";function r(e){return"undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext}Object.defineProperty(t,"__esModule",{value:!0}),t.isWebGL=function(e){return"undefined"!=typeof WebGLRenderingContext&&e instanceof WebGLRenderingContext},t.isWebGL2=r,t.getInstancedArrays=function(e){if(r(e))return{drawArraysInstanced:e.drawArraysInstanced.bind(e),drawElementsInstanced:e.drawElementsInstanced.bind(e),vertexAttribDivisor:e.vertexAttribDivisor.bind(e),VERTEX_ATTRIB_ARRAY_DIVISOR:e.VERTEX_ATTRIB_ARRAY_DIVISOR};var t=e.getExtension("ANGLE_instanced_arrays");return null===t?null:{drawArraysInstanced:t.drawArraysInstancedANGLE.bind(t),drawElementsInstanced:t.drawElementsInstancedANGLE.bind(t),vertexAttribDivisor:t.vertexAttribDivisorANGLE.bind(t),VERTEX_ATTRIB_ARRAY_DIVISOR:t.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE}},t.getStandardDerivatives=function(e){if(r(e))return{FRAGMENT_SHADER_DERIVATIVE_HINT:e.FRAGMENT_SHADER_DERIVATIVE_HINT};var t=e.getExtension("OES_standard_derivatives");if(null===t)throw new Error('Could not get "OES_standard_derivatives" extension');return{FRAGMENT_SHADER_DERIVATIVE_HINT:t.FRAGMENT_SHADER_DERIVATIVE_HINT_OES}},t.getElementIndexUint=function(e){return r(e)?{}:e.getExtension("OES_element_index_uint")},t.getVertexArrayObject=function(e){if(r(e))return{VERTEX_ARRAY_BINDING:e.VERTEX_ARRAY_BINDING,bindVertexArray:e.bindVertexArray.bind(e),createVertexArray:e.createVertexArray.bind(e),deleteVertexArray:e.deleteVertexArray.bind(e),isVertexArray:e.isVertexArray.bind(e)};var t=e.getExtension("OES_vertex_array_object");return null===t?null:{VERTEX_ARRAY_BINDING:t.VERTEX_ARRAY_BINDING_OES,bindVertexArray:t.bindVertexArrayOES.bind(t),createVertexArray:t.createVertexArrayOES.bind(t),deleteVertexArray:t.deleteVertexArrayOES.bind(t),isVertexArray:t.isVertexArrayOES.bind(t)}},t.getTextureFloat=function(e){return r(e)?{}:e.getExtension("OES_texture_float")},t.getTextureFloatLinear=function(e){return e.getExtension("OES_texture_float_linear")},t.getBlendMinMax=function(e){if(r(e))return{MIN:e.MIN,MAX:e.MAX};var t=e.getExtension("EXT_blend_minmax");return null===t?null:{MIN:t.MIN_EXT,MAX:t.MAX_EXT}},t.getFragDepth=function(e){return r(e)?{}:e.getExtension("EXT_frag_depth")}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(34),i=n(183),a=r.idFactory();function o(e){var t=e.gl,n=t.createFramebuffer();if(null===n)throw new Error("Could not create WebGL framebuffer");var r=!1;return e.framebufferCount+=1,{id:a(),bind:function(){return t.bindFramebuffer(t.FRAMEBUFFER,n)},destroy:function(){r||(t.deleteFramebuffer(n),r=!0,e.framebufferCount-=1)}}}t.createFramebuffer=o,t.createFramebufferCache=function(){return i.createReferenceCache(function(e){return e},function(e){return o(e)},function(e){e.destroy()})}},function(e,t,n){"use strict";(function(e,n,r){Object.defineProperty(t,"__esModule",{value:!0});var i=void 0!==n?"undefined"!=typeof window?{setImmediate:function(e){for(var t,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];return(t=window).setImmediate.apply(t,[e].concat(n))},clearImmediate:function(e){return window.clearImmediate(e)}}:{setImmediate:n,clearImmediate:r}:function(){var t,n,r,i,a,o,u,s=(t="undefined"!=typeof window&&window,n="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,t||void 0!==s&&s||n),c={},l="undefined"!=typeof document?document:void 0,f=1;function d(e){delete c[e]}function p(e){var t=c[e];d(e),function(e){var t=e.callback,n=e.args;switch(n.length){case 0:t();break;case 1:t(n[0]);break;case 2:t(n[0],n[1]);break;case 3:t(n[0],n[1],n[2]);break;default:t.apply(void 0,n)}}(t)}return void 0!==e&&"[object process]"==={}.toString.call(e)?r=function(t){e.nextTick(function(){p(t)})}:function(){if(s&&s.postMessage&&!s.importScripts){var e=!0,t=s.onmessage;return s.onmessage=function(){e=!1},s.postMessage("","*"),s.onmessage=t,e}}()?(o="setImmediate$"+Math.random()+"$",u=function(e){e.source===s&&"string"==typeof e.data&&0===e.data.indexOf(o)&&p(+e.data.slice(o.length))},window.addEventListener?window.addEventListener("message",u,!1):window.attachEvent("onmessage",u),r=function(e){window.postMessage(o+e,"*")}):"undefined"!=typeof MessageChannel?((a=new MessageChannel).port1.onmessage=function(e){p(e.data)},r=function(e){a.port2.postMessage(e)}):l&&"onreadystatechange"in l.createElement("script")?(i=l.documentElement,r=function(e){var t=l.createElement("script");t.onreadystatechange=function(){p(e),t.onreadystatechange=null,i.removeChild(t),t=null},i.appendChild(t)}):r=function(e){setTimeout(p,0,e)},{setImmediate:function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];"function"!=typeof e&&(e=new Function(""+e));var i={callback:e,args:t};return c[f]=i,r(f),f++},clearImmediate:d}}();function a(e){i.setImmediate(e)}var o={setImmediate:i.setImmediate,clearImmediate:i.clearImmediate,immediatePromise:function(){return new Promise(a)},delay:function(e,t){return void 0===t&&(t=void 0),new Promise(function(n){return setTimeout(n,e,t)})}};t.Scheduler=o}).call(this,n(179),n(228).setImmediate,n(228).clearImmediate)},function(e,t,n){(function(e){var r=void 0!==e&&e||"undefined"!=typeof self&&self||window,i=Function.prototype.apply;function a(e,t){this._id=e,this._clearFn=t}t.setTimeout=function(){return new a(i.call(setTimeout,r,arguments),clearTimeout)},t.setInterval=function(){return new a(i.call(setInterval,r,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},a.prototype.unref=a.prototype.ref=function(){},a.prototype.close=function(){this._clearFn.call(r,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout(function(){e._onTimeout&&e._onTimeout()},t))},n(338),t.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==e&&e.setImmediate||this&&this.setImmediate,t.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==e&&e.clearImmediate||this&&this.clearImmediate}).call(this,n(132))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){this.shouldUpdate=!1,this.isSynchronous=!0}return e.prototype.update=function(e,t){},e}();t.SynchronousRuntimeContext=r,t.SyncRuntimeContext=new r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(23);t.Types=r;var i=n(231);t.ModelSymmetry=i.ModelSymmetry;var a=n(236);t.StructureSequence=a.default,function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(190))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(17),a=n(19),o=function(){function e(e,t,n){this.operatorsProvider=n,this.id=e,this.details=t}return Object.defineProperty(e.prototype,"operatorGroups",{get:function(){return this._operators?this._operators:(this._operators=this.operatorsProvider(),this._operators)},enumerable:!0,configurable:!0}),e}();t.Assembly=o,function(e){e.create=function(t,n,r){return new e(t,n,r)}}(o=t.Assembly||(t.Assembly={})),t.Assembly=o,function(e){e.Default={assemblies:[],spacegroup:a.Spacegroup.ZeroP1,isNonStandardCrytalFrame:!1},e.findAssembly=function(e,t){var n=t.toLocaleLowerCase();return i.arrayFind(e.symmetry.assemblies,function(e){return e.id.toLowerCase()===n})}}(r||(r={})),t.ModelSymmetry=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.add=function(e,t,n){e.squaredDistances[e.count]=n,e.indices[e.count++]=t},e.reset=function(e){e.count=0},e.create=function(){return{count:0,indices:[],squaredDistances:[]}}}(t.Result||(t.Result={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(2),a=n(5);!function(e){function t(){return{min:i.Vec3.zero(),max:i.Vec3.zero()}}function n(e){return i.Vec3.set(e.min,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),i.Vec3.set(e.max,-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),e}function r(e,t){return i.Vec3.min(e.min,e.min,t),i.Vec3.max(e.max,e.max,t),e}e.create=function(e,t){return{min:e,max:t}},e.empty=t,e.clone=function(e){var n=t();return i.Vec3.copy(n.min,e.min),i.Vec3.copy(n.max,e.max),n},e.computeBounding=function(e){for(var t=i.Vec3.create(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),n=i.Vec3.create(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),r=e.x,o=e.y,u=e.z,s=e.indices,c=0,l=a.OrderedSet.size(s);c<l;c++){var f=a.OrderedSet.getAt(s,c);t[0]=Math.min(r[f],t[0]),t[1]=Math.min(o[f],t[1]),t[2]=Math.min(u[f],t[2]),n[0]=Math.max(r[f],n[0]),n[1]=Math.max(o[f],n[1]),n[2]=Math.max(u[f],n[2])}return{min:t,max:n}},e.size=function(e,t){return i.Vec3.sub(e,t.max,t.min)},e.setEmpty=n,e.add=r,e.expand=function(e,t,n){return i.Vec3.sub(e.min,t.min,n),i.Vec3.add(e.max,t.max,n),e};var o=i.Vec3.zero();e.transform=function(e,t,a){var u=t.min,s=u[0],c=u[1],l=u[2],f=t.max,d=f[0],p=f[1],h=f[2];return n(e),r(e,i.Vec3.transformMat4(o,i.Vec3.set(o,s,c,l),a)),r(e,i.Vec3.transformMat4(o,i.Vec3.set(o,s,c,h),a)),r(e,i.Vec3.transformMat4(o,i.Vec3.set(o,s,p,l),a)),r(e,i.Vec3.transformMat4(o,i.Vec3.set(o,s,p,h),a)),r(e,i.Vec3.transformMat4(o,i.Vec3.set(o,d,c,l),a)),r(e,i.Vec3.transformMat4(o,i.Vec3.set(o,d,c,h),a)),r(e,i.Vec3.transformMat4(o,i.Vec3.set(o,d,p,l),a)),r(e,i.Vec3.transformMat4(o,i.Vec3.set(o,d,p,h),a)),e}}(r||(r={})),t.Box3D=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(17);!function(e){e.Zero=0;var t,n,r=(t=new ArrayBuffer(8),n=new ArrayBuffer(8),{_int32:new Int32Array(t),_float64:new Float64Array(t),_int32_1:new Int32Array(n),_float64_1:new Float64Array(n)}),a=r._int32,o=r._float64,u=r._int32_1,s=r._float64_1;e.is=function(e){return"number"==typeof e},e.create=function(e,t){return a[0]=e,a[1]=t,o[0]},e.fst=function(e){return o[0]=e,a[0]},e.snd=function(e){return o[0]=e,a[1]},e.areEqual=function(e,t){return o[0]=e,s[0]=t,a[0]===u[0]&&a[1]===u[1]},e.compare=function(e,t){o[0]=e,s[0]=t;var n=a[0]-u[0];return 0!==n?n:a[1]-u[1]},e.compareInArray=function(e,t,n){o[0]=e[t],s[0]=e[n];var r=a[0]-u[0];return 0!==r?r:a[1]-u[1]},e.hashCode=function(e){return o[0]=e,i.hash2(a[0],a[1])}}(r||(r={})),t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(350),a=n(115);!function(e){e.Empty=i.Empty,e.ofSingleton=i.ofSingleton,e.ofRange=i.ofRange,e.ofBounds=i.ofBounds,e.ofSortedArray=i.ofSortedArray,e.has=i.has,e.indexOf=i.indexOf,e.getAt=i.getAt,e.min=i.min,e.max=i.max,e.start=i.start,e.end=i.end,e.size=i.size,e.hashCode=i.hashCode,e.areEqual=i.areEqual,e.areIntersecting=i.areIntersecting,e.isSubset=i.isSubset,e.union=i.union,e.intersect=i.intersect,e.subtract=i.subtract,e.findPredecessorIndex=i.findPredecessorIndex,e.findPredecessorIndexInInterval=i.findPredecessorIndexInInterval,e.findRange=i.findRange,e.intersectionSize=i.intersectionSize,e.forEach=function(e,t,n){return i.forEach(e,t,n)},e.isInterval=function(e){return a.default.is(e)},e.isSortedArray=function(e){return!a.default.is(e)},e.toArray=function(t){var n=[];return e.forEach(t,function(e){return n.push(e)}),n}}(r||(r={})),t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(21),a=n(237);!function(e){e.fromAtomicHierarchy=function(e,t,n){for(var r=t.residues,o=r.label_comp_id,u=r.label_seq_id,s=t.chainAtomSegments,c=t.residueAtomSegments,l={},f=[],d=0,p=t.chains._rowCount;d<p;d++){var h=t.index.getEntityFromChain(d);if(void 0===l[h]&&"polymer"===e.data.type.value(h)){var m=d;for(d++;d<p&&h===t.index.getEntityFromChain(d)&&"polymer"!==e.data.type.value(h);)d++;d--;var y=c.index[s.offsets[m]],v=c.index[s.offsets[d+1]],b=i.Column.window(o,y,v),g=i.Column.window(u,y,v);l[h]={entityId:e.data.id.value(h),compId:b,num:g,sequence:a.Sequence.ofResidueNames(b,g,n)},f.push(l[h])}}return{byEntityKey:l,sequences:f}}}(r||(r={})),t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(357))},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i,a=n(118);!function(e){e.Empty=a.IntAdjacencyGraph.create([],[],[],0,{flags:[],order:[]})}(i||(i={})),t.IntraUnitLinks=i;var o=function(){function e(t){this.map=t;var n=0,i=[],a=new Map,o=new Map;this.map.forEach(function(t){t.forEach(function(t){n+=t.bondCount,t.linkedElementIndices.forEach(function(n){t.getBonds(n).forEach(function(u){var s=t.unitA,c=t.unitB,l=e.getBondKey(n,s,u.indexB,c);a.set(l,i.length);var f=e.getElementKey(n,s),d=o.get(f);void 0===d?o.set(f,[i.length]):d.push(i.length),i.push(r({},u,{indexA:n,unitA:s,unitB:c}))})})})}),this.bondCount=n,this.bonds=i,this.bondKeyIndex=a,this.elementKeyIndex=o}return e.prototype.getLinkedUnits=function(e){return this.map.has(e.id)?this.map.get(e.id):u},e.prototype.getBondIndex=function(t,n,r,i){var a=e.getBondKey(t,n,r,i),o=this.bondKeyIndex.get(a);return void 0!==o?o:-1},e.prototype.getBond=function(e,t,n,r){var i=this.getBondIndex(e,t,n,r);return-1!==i?this.bonds[i]:void 0},e.prototype.getBondFromLocation=function(e){return this.getBond(e.aIndex,e.aUnit,e.bIndex,e.bUnit)},e.prototype.getBondIndices=function(t,n){return this.elementKeyIndex.get(e.getElementKey(t,n))||[]},e}();t.InterUnitBonds=o,function(e){var t=function(){function e(e,t,n,r,i){this.unitA=e,this.unitB=t,this.bondCount=n,this.linkedElementIndices=r,this.linkMap=i}return e.prototype.hasBonds=function(e){return this.linkMap.has(e)},e.prototype.getBonds=function(e){return this.linkMap.has(e)?this.linkMap.get(e):u},Object.defineProperty(e.prototype,"areUnitsOrdered",{get:function(){return this.unitA.id<this.unitB.id},enumerable:!0,configurable:!0}),e}();e.UnitPairBonds=t,e.getBondKey=function(e,t,n,r){return e+"|"+t.id+"|"+n+"|"+r.id},e.getElementKey=function(e,t){return e+"|"+t.id}}(o||(o={})),t.InterUnitBonds=o;var u=[]},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={H:0,h:0,D:0,d:0,T:0,t:0,He:2,HE:2,he:2,Li:3,LI:3,li:3,Be:4,BE:4,be:4,B:5,b:5,C:6,c:6,N:7,n:7,O:8,o:8,F:9,f:9,Ne:10,NE:10,ne:10,Na:11,NA:11,na:11,Mg:12,MG:12,mg:12,Al:13,AL:13,al:13,Si:14,SI:14,si:14,P:15,p:15,S:16,s:16,Cl:17,CL:17,cl:17,Ar:18,AR:18,ar:18,K:19,k:19,Ca:20,CA:20,ca:20,Sc:21,SC:21,sc:21,Ti:22,TI:22,ti:22,V:23,v:23,Cr:24,CR:24,cr:24,Mn:25,MN:25,mn:25,Fe:26,FE:26,fe:26,Co:27,CO:27,co:27,Ni:28,NI:28,ni:28,Cu:29,CU:29,cu:29,Zn:30,ZN:30,zn:30,Ga:31,GA:31,ga:31,Ge:32,GE:32,ge:32,As:33,AS:33,as:33,Se:34,SE:34,se:34,Br:35,BR:35,br:35,Kr:36,KR:36,kr:36,Rb:37,RB:37,rb:37,Sr:38,SR:38,sr:38,Y:39,y:39,Zr:40,ZR:40,zr:40,Nb:41,NB:41,nb:41,Mo:42,MO:42,mo:42,Tc:43,TC:43,tc:43,Ru:44,RU:44,ru:44,Rh:45,RH:45,rh:45,Pd:46,PD:46,pd:46,Ag:47,AG:47,ag:47,Cd:48,CD:48,cd:48,In:49,IN:49,in:49,Sn:50,SN:50,sn:50,Sb:51,SB:51,sb:51,Te:52,TE:52,te:52,I:53,i:53,Xe:54,XE:54,xe:54,Cs:55,CS:55,cs:55,Ba:56,BA:56,ba:56,La:57,LA:57,la:57,Ce:58,CE:58,ce:58,Pr:59,PR:59,pr:59,Nd:60,ND:60,nd:60,Pm:61,PM:61,pm:61,Sm:62,SM:62,sm:62,Eu:63,EU:63,eu:63,Gd:64,GD:64,gd:64,Tb:65,TB:65,tb:65,Dy:66,DY:66,dy:66,Ho:67,HO:67,ho:67,Er:68,ER:68,er:68,Tm:69,TM:69,tm:69,Yb:70,YB:70,yb:70,Lu:71,LU:71,lu:71,Hf:72,HF:72,hf:72,Ta:73,TA:73,ta:73,W:74,w:74,Re:75,RE:75,re:75,Os:76,OS:76,os:76,Ir:77,IR:77,ir:77,Pt:78,PT:78,pt:78,Au:79,AU:79,au:79,Hg:80,HG:80,hg:80,Tl:81,TL:81,tl:81,Pb:82,PB:82,pb:82,Bi:83,BI:83,bi:83,Po:84,PO:84,po:84,At:85,AT:85,at:85,Rn:86,RN:86,rn:86,Fr:87,FR:87,fr:87,Ra:88,RA:88,ra:88,Ac:89,AC:89,ac:89,Th:90,TH:90,th:90,Pa:91,PA:91,pa:91,U:92,u:92,Np:93,NP:93,np:93,Pu:94,PU:94,pu:94,Am:95,AM:95,am:95,Cm:96,CM:96,cm:96,Bk:97,BK:97,bk:97,Cf:98,CF:98,cf:98,Es:99,ES:99,es:99,Fm:100,FM:100,fm:100,Md:101,MD:101,md:101,No:102,NO:102,no:102,Lr:103,LR:103,lr:103,Rf:104,RF:104,rf:104,Db:105,DB:105,db:105,Sg:106,SG:106,sg:106,Bh:107,BH:107,bh:107,Hs:108,HS:108,hs:108,Mt:109,MT:109,mt:109},i={0:1.42,1:1.42,3:2.7,4:2.7,6:1.75,7:1.6,8:1.52,11:2.7,12:2.7,13:2.7,14:1.9,15:1.9,16:1.9,17:1.8,19:2.7,20:2.7,21:2.7,22:2.7,23:2.7,24:2.7,25:2.7,26:2.7,27:2.7,28:2.7,29:2.7,30:2.7,31:2.7,33:2.68,37:2.7,38:2.7,39:2.7,40:2.7,41:2.7,42:2.7,43:2.7,44:2.7,45:2.7,46:2.7,47:2.7,48:2.7,49:2.7,50:2.7,55:2.7,56:2.7,57:2.7,58:2.7,59:2.7,60:2.7,61:2.7,62:2.7,63:2.7,64:2.7,65:2.7,66:2.7,67:2.7,68:2.7,69:2.7,70:2.7,71:2.7,72:2.7,73:2.7,74:2.7,75:2.7,76:2.7,77:2.7,78:2.7,79:2.7,80:2.7,81:2.7,82:2.7,83:2.7,87:2.7,88:2.7,89:2.7,90:2.7,91:2.7,92:2.7,93:2.7,94:2.7,95:2.7,96:2.7,97:2.7,98:2.7,99:2.7,100:2.7,101:2.7,102:2.7,103:2.7,104:2.7,105:2.7,106:2.7,107:2.7,108:2.7,109:2.88},a={0:.8,20:1.31,27:1.3,35:1.3,44:1.05,54:1,60:1.84,72:1.88,84:1.75,85:1.56,86:1.76,98:1.6,99:1.68,100:1.63,112:1.55,113:1.59,114:1.36,129:1.45,144:1.6,170:1.4,180:1.55,202:2.4,222:2.24,224:1.91,225:1.98,243:2.02,269:2,293:1.9,480:2.3,512:2.3,544:2.3,612:2.1,629:1.54,665:1,813:2.6,854:2.27,894:1.93,896:2.1,937:2.05,938:2.06,981:1.62,1258:2.68,1309:2.33,1484:1,1763:2.14,1823:2.48,1882:2.1,1944:1.72,2380:2.34,3367:2.44,3733:2.11,3819:2.6,3821:2.36,4736:2.75,5724:2.73,5959:2.63,6519:2.84,6750:2.87,8991:2.81},o=2.001;t.MetalsSet=function(){for(var e=new Set,t=0,n=["LI","NA","K","RB","CS","FR","BE","MG","CA","SR","BA","RA","AL","GA","IN","SN","TL","PB","BI","SC","TI","V","CR","MN","FE","CO","NI","CU","ZN","Y","ZR","NB","MO","TC","RU","RH","PD","AG","CD","LA","HF","TA","W","RE","OS","IR","PT","AU","HG","AC","RF","DB","SG","BH","HS","MT","CE","PR","ND","PM","SM","EU","GD","TB","DY","HO","ER","TM","YB","LU","TH","PA","U","NP","PU","AM","CM","BK","CF","ES","FM","MD","NO","LR"];t<n.length;t++){var i=n[t];e.add(r[i])}return e}(),t.getElementIdx=function(e){var t=r[e];return void 0===t?-1:t},t.getElementPairThreshold=function(e,t){if(e<0||t<0)return-1;var n,r,i=a[(n=e,r=t,n<r?(n+r)*(n+r+1)/2+r:(n+r)*(n+r+1)/2+n)];return void 0===i?-1:i},t.getElementThreshold=function(e){if(e<0)return o;var t=i[e];return void 0===t?o:t};var u=r.H;t.isHydrogen=function(e){return e===u}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VERSION="0.3.0",function(e){e.getDataType=function(e){return e instanceof Int8Array?1:e instanceof Int16Array?2:e instanceof Int32Array?3:e instanceof Uint8Array?4:e instanceof Uint16Array?5:e instanceof Uint32Array?6:e instanceof Float32Array?32:e instanceof Float64Array?33:3},e.isSignedIntegerDataType=function(e){if(e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array)return!0;for(var t=0,n=e.length;t<n;t++)if(t<0)return!1;return!0}}(t.Encoding||(t.Encoding={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(17),a=n(240),o=n(192),u=function(){function e(e){this.providers=e}return e.prototype.and=function(t){return new e(this.providers.concat([t]))},e.prototype.encode=function(e){for(var t=[],n=0,r=this.providers;n<r.length;n++){var i=(0,r[n])(e);if(!i.encodings.length)throw new Error("Encodings must be non-empty.");e=i.data;for(var a=0,o=i.encodings;a<o.length;a++){var u=o[a];t.push(u)}}if(!(e instanceof Uint8Array))throw new Error("The encoding must result in a Uint8Array. Fix your encoding chain.");return{encoding:t,data:e}},e}();t.ArrayEncoderImpl=u,function(e){function t(e){return new u([e])}function n(e){switch(e.kind){case"ByteArray":return r.byteArray;case"FixedPoint":return r.fixedPoint(e.factor);case"IntervalQuantization":return r.intervalQuantizaiton(e.min,e.max,e.numSteps);case"RunLength":return r.runLength;case"Delta":return r.delta;case"IntegerPacking":return r.integerPacking;case"StringArray":return r.stringArray}}e.by=t,e.fromEncoding=function(e){for(var r=t(n(e[0])),i=1;i<e.length;i++)r=r.and(n(e[i]));return r}}(t.ArrayEncoder||(t.ArrayEncoder={})),function(e){var t,n;e.by=function(e){return new u([e])};var r=((t={})[2]=function(e,t,n){e.setInt16(2*t,n,!0)},t[5]=function(e,t,n){e.setUint16(2*t,n,!0)},t[3]=function(e,t,n){e.setInt32(4*t,n,!0)},t[6]=function(e,t,n){e.setUint32(4*t,n,!0)},t[32]=function(e,t,n){e.setFloat32(4*t,n,!0)},t[33]=function(e,t,n){e.setFloat64(8*t,n,!0)},t),s=((n={})[2]=2,n[5]=2,n[3]=4,n[6]=4,n[32]=4,n[33]=8,n);function c(e){var t=a.Encoding.getDataType(e);if(1===t)return function(e){return{encodings:[{kind:"ByteArray",type:1}],data:new Uint8Array(e.buffer,e.byteOffset)}}(e);if(4===t)return function(e){return{encodings:[{kind:"ByteArray",type:4}],data:e}}(e);for(var n=new Uint8Array(e.length*s[t]),i=r[t],o=new DataView(n.buffer),u=0,c=e.length;u<c;u++)i(o,u,e[u]);return{encodings:[{kind:"ByteArray",type:t}],data:n}}function l(e,t){for(var n=-t-1,r=0,i=0,a=e.length;i<a;i++){var o=e[i];0===o?r+=1:o>0?(r+=Math.ceil(o/t),o%t==0&&(r+=1)):(r+=Math.ceil(o/n),o%n==0&&(r+=1))}return r}e.byteArray=c,e.fixedPoint=function(e){return function(t){return function(e,t){for(var n=a.Encoding.getDataType(e),r=new Int32Array(e.length),i=0,o=e.length;i<o;i++)r[i]=Math.round(e[i]*t);return{encodings:[{kind:"FixedPoint",factor:t,srcType:n}],data:r}}(t,e)}},e.intervalQuantizaiton=function(e,t,n,r){return void 0===r&&(r=Int32Array),function(i){return function(e,t,n,r,i){var o=a.Encoding.getDataType(e);if(!e.length)return{encodings:[{kind:"IntervalQuantization",min:t,max:n,numSteps:r,srcType:o}],data:new Int32Array(0)};if(n<t){var u=t;t=n,n=u}for(var s=(n-t)/(r-1),c=new i(e.length),l=0,f=e.length;l<f;l++){var d=e[l];c[l]=d<=t?0:d>=n?r:0|Math.round((d-t)/s)}return{encodings:[{kind:"IntervalQuantization",min:t,max:n,numSteps:r,srcType:o}],data:c}}(i,e,t,n,r)}},e.runLength=function(e){var t=a.Encoding.getDataType(e);if(void 0===t&&(e=new Int32Array(e),t=3),!e.length)return{encodings:[{kind:"RunLength",srcType:t,srcSize:0}],data:new Int32Array(0)};for(var n=2,r=1,i=e.length;r<i;r++)e[r-1]!==e[r]&&(n+=2);var o=new Int32Array(n),u=0,s=1;for(r=1,i=e.length;r<i;r++)e[r-1]!==e[r]?(o[u]=e[r-1],o[u+1]=s,s=1,u+=2):++s;return o[u]=e[e.length-1],o[u+1]=s,{encodings:[{kind:"RunLength",srcType:t,srcSize:e.length}],data:o}},e.delta=function(e){if(!a.Encoding.isSignedIntegerDataType(e))throw new Error("Only signed integer types can be encoded using delta encoding.");var t=a.Encoding.getDataType(e);if(void 0===t&&(e=new Int32Array(e),t=3),!e.length)return{encodings:[{kind:"Delta",origin:0,srcType:t}],data:new e.constructor(0)};var n=new e.constructor(e.length),r=e[0];n[0]=e[0];for(var i=1,o=e.length;i<o;i++)n[i]=e[i]-e[i-1];return n[0]=0,{encodings:[{kind:"Delta",origin:r,srcType:t}],data:n}},e.integerPacking=function(e){var t=function(e){var t=function(e){for(var t=0,n=e.length;t<n;t++)if(e[t]<0)return!0;return!1}(e),n=l(e,t?127:255),r=l(e,t?32767:65535);return 4*e.length<2*r?{isSigned:t,size:e.length,bytesPerElement:4}:2*r<n?{isSigned:t,size:r,bytesPerElement:2}:{isSigned:t,size:n,bytesPerElement:1}}(e);return 4===t.bytesPerElement?c(e):function(e,t){for(var n=t.isSigned?1===t.bytesPerElement?127:32767:1===t.bytesPerElement?255:65535,r=-n-1,i=e.length,a=t.isSigned?1===t.bytesPerElement?new Int8Array(t.size):new Int16Array(t.size):1===t.bytesPerElement?new Uint8Array(t.size):new Uint16Array(t.size),o=0,u=0;u<i;u++){var s=e[u];if(s>=0)for(;s>=n;)a[o]=n,++o,s-=n;else for(;s<=r;)a[o]=r,++o,s-=r;a[o]=s,++o}var l=c(a);return{encodings:[{kind:"IntegerPacking",byteCount:t.bytesPerElement,isUnsigned:!t.isSigned,srcSize:i},l.encodings[0]],data:l.data}}(e,t)},e.stringArray=function(e){var t=Object.create(null),n=[],r=new Int32Array(e.length),a=i.ChunkedArray.create(Int32Array,1,Math.min(1024,e.length<32?e.length+1:Math.round(e.length/8)+1));i.ChunkedArray.add(a,0);for(var u=0,s=0,c=0,l=e;c<l.length;c++){var f=l[c];if(null!=f){var d=t[f];void 0===d&&(u+=f.length,n[d=n.length]=f,t[f]=d,i.ChunkedArray.add(a,u)),r[s++]=d}else r[s++]=-1}var p=i.ChunkedArray.compact(a),h=o.classifyIntArray(p).encode(p),m=o.classifyIntArray(r).encode(r);return{encodings:[{kind:"StringArray",dataEncoding:m.encoding,stringData:n.join(""),offsetEncoding:h.encoding,offsets:h.data}],data:m.data}}}(r=t.ArrayEncoding||(t.ArrayEncoding={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(369);t.getFieldDigitCount=function(e){return e.defaultFormat&&void 0!==e.defaultFormat.digitCount?Math.max(0,Math.min(e.defaultFormat.digitCount,16)):6},t.getIncludedFields=function(e){return e.fields.some(function(e){return!!e.shouldInclude})?e.fields.filter(function(t){return!t.shouldInclude||e.source.some(function(e){return t.shouldInclude(e.data)})}):e.fields},t.getCategoryInstanceData=function(e,t){var n=e.instance(t),i=n.source.filter(function(e){return e.rowCount>0});return i.length?{instance:n,rowCount:i.reduce(function(e,t){return e+t.rowCount},0),source:i.map(function(e){return{data:e.data,keys:function(){return e.keys?e.keys():r.Iterator.Range(0,e.rowCount-1)},rowCount:e.rowCount}})}:{instance:n,rowCount:0,source:[]}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(244),i=n(5),a=n(44);!function(e){function t(e,t){for(var n=e.units,r=0,a=n.length;r<a;r++)if(i.SortedArray.indexOf(n[r].elements,t)>=0)return!0;return!1}function n(e,t){return e<t?e+"-"+t:t+"-"+e}e.Descriptor={isStatic:!0,name:"struct_conn",cifExport:{prefix:"",categories:[{name:"struct_conn",instance:function(e){var n=e.structures[0],r=n.model,i=s(r);if(!i)return a.CifWriter.Category.Empty;var o=c(r);if(!o||0===o.entries.length)return a.CifWriter.Category.Empty;for(var u=new Set,l=[],f=0,d=o.entries;f<d.length;f++){for(var p=d[f],h=p.partners,m=!0,y=0,v=h.length;y<v;y++){var b=h[y].atomIndex;if(!u.has(b)){if(!t(n,b)){m=!1;break}u.add(b)}}m&&(l[l.length]=p.rowIndex)}return a.CifWriter.Category.ofTable(i,l)}}]}};var o=[],u=function(){function e(e){this.entries=e,this._residuePairIndex=void 0,this._atomIndex=void 0}return e.prototype.getResiduePairIndex=function(){if(this._residuePairIndex)return this._residuePairIndex;this._residuePairIndex=new Map;for(var e=0,t=this.entries;e<t.length;e++)for(var r=t[e],i=r.partners,a=i.length,o=0;o<a-1;o++)for(var u=o+o;u<a;u++){var s=n(i[o].residueIndex,i[u].residueIndex);this._residuePairIndex.has(s)?this._residuePairIndex.get(s).push(r):this._residuePairIndex.set(s,[r])}return this._residuePairIndex},e.prototype.getAtomIndex=function(){if(this._atomIndex)return this._atomIndex;this._atomIndex=new Map;for(var e=0,t=this.entries;e<t.length;e++)for(var n=t[e],r=0,i=n.partners;r<i.length;r++){var a=i[r].atomIndex;this._atomIndex.has(a)?this._atomIndex.get(a).push(n):this._atomIndex.set(a,[n])}return this._atomIndex},e.prototype.getResidueEntries=function(e,t){return this.getResiduePairIndex().get(n(e,t))||o},e.prototype.getAtomEntries=function(e){return this.getAtomIndex().get(e)||o},e}();function s(e){return e._staticPropertyData.__StructConnData__}function c(t){if(t._staticPropertyData[e.PropName])return t._staticPropertyData[e.PropName];if(t.customProperties.has(e.Descriptor)){for(var n=s(t),i=n.conn_type_id,a=n.pdbx_dist_value,o=n.pdbx_value_order,c={label_asym_id:n.ptnr1_label_asym_id,label_seq_id:n.ptnr1_label_seq_id,auth_seq_id:n.ptnr1_auth_seq_id,label_atom_id:n.ptnr1_label_atom_id,label_alt_id:n.pdbx_ptnr1_label_alt_id,ins_code:n.pdbx_ptnr1_PDB_ins_code,symmetry:n.ptnr1_symmetry},l={label_asym_id:n.ptnr2_label_asym_id,label_seq_id:n.ptnr2_label_seq_id,auth_seq_id:n.ptnr2_auth_seq_id,label_atom_id:n.ptnr2_label_atom_id,label_alt_id:n.pdbx_ptnr2_label_alt_id,ins_code:n.pdbx_ptnr2_PDB_ins_code,symmetry:n.ptnr2_symmetry},f=function(e,n){if(0===n.label_asym_id.valueKind(e)){var i=n.label_asym_id.value(e),a=t.atomicHierarchy.index.findResidue(r.findEntityIdByAsymId(t,i),i,n.auth_seq_id.value(e),n.ins_code.value(e));if(!(a<0)){var o=n.label_atom_id.value(e);if(o){var u=r.findAtomIndexByLabelName(t,a,o,n.label_alt_id.value(e));if(!(u<0))return{residueIndex:a,atomIndex:u,symmetry:n.symmetry.value(e)||"1_555"}}}}},d=function(e){var t=[],n=f(e,c);return n&&t.push(n),(n=f(e,l))&&t.push(n),t},p=[],h=0;h<n._rowCount;h++){var m=d(h);if(!(m.length<2)){var y=i.value(h),v=0,b=1;switch((o.value(h)||"").toLowerCase()){case"sing":b=1;break;case"doub":b=2;break;case"trip":b=3;break;case"quad":b=4}switch(y){case"covale":case"covale_base":case"covale_phosphate":case"covale_sugar":case"modres":v=1;break;case"disulf":v=17;break;case"hydrog":v=4;break;case"metalc":v=2;break;case"saltbr":v=8}p.push({rowIndex:h,flags:v,order:b,distance:a.value(h),partners:m})}}var g=new u(p);return t._staticPropertyData[e.PropName]=g,g}}e.attachFromMmCif=function(t){if(t.customProperties.has(e.Descriptor))return!0;if("mmCIF"!==t.sourceData.kind)return!1;var n=t.sourceData.data.struct_conn;return 0!==n._rowCount&&(t.customProperties.add(e.Descriptor),t._staticPropertyData.__StructConnData__=n,!0)},e.PropName="__StructConn__",e.get=c}(t.StructConn||(t.StructConn={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.findEntityIdByAsymId=function(e,t){if("mmCIF"!==e.sourceData.kind)return"";for(var n=e.sourceData.data.struct_asym,r=0,i=n._rowCount;r<i;++r)if(n.id.value(r)===t)return n.entity_id.value(r);return""},t.findAtomIndexByLabelName=function(e,t,n,r){for(var i=e.atomicHierarchy.residueAtomSegments.offsets,a=e.atomicHierarchy.atoms,o=a.label_atom_id,u=a.label_alt_id,s=i[t],c=i[t+1];s<c;++s)if(o.value(s)===n&&(!r||u.value(s)===r))return s;return-1}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(5),i=n(23);t.getNucleotideElements=function(e){for(var t=[],n=e.elements,a=e.model,o=a.atomicHierarchy,u=o.chainAtomSegments,s=o.residueAtomSegments,c=a.atomicHierarchy.derived.residue,l=c.moleculeType,f=c.traceElementIndex,d=r.Segmentation.transientSegments(u,n),p=r.Segmentation.transientSegments(s,n);d.hasNext;)for(p.setSegment(d.move());p.hasNext;){var h=p.move().index;if(i.isNucleic(l[h])){var m=f[h];t.push(-1===m?s.offsets[h]:m)}}return r.SortedArray.ofSortedArray(t)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(21),i=n(120);t.AtomsSchema={type_symbol:r.Column.Schema.Aliased(i.mmCIF_Schema.atom_site.type_symbol),label_atom_id:i.mmCIF_Schema.atom_site.label_atom_id,auth_atom_id:i.mmCIF_Schema.atom_site.auth_atom_id,label_alt_id:i.mmCIF_Schema.atom_site.label_alt_id,pdbx_formal_charge:i.mmCIF_Schema.atom_site.pdbx_formal_charge},t.ResiduesSchema={group_PDB:i.mmCIF_Schema.atom_site.group_PDB,label_comp_id:i.mmCIF_Schema.atom_site.label_comp_id,auth_comp_id:i.mmCIF_Schema.atom_site.auth_comp_id,label_seq_id:i.mmCIF_Schema.atom_site.label_seq_id,auth_seq_id:i.mmCIF_Schema.atom_site.auth_seq_id,pdbx_PDB_ins_code:i.mmCIF_Schema.atom_site.pdbx_PDB_ins_code},t.ChainsSchema={label_asym_id:i.mmCIF_Schema.atom_site.label_asym_id,auth_asym_id:i.mmCIF_Schema.atom_site.auth_asym_id,label_entity_id:i.mmCIF_Schema.atom_site.label_entity_id},function(e){e.EmptyResidueKey=function(){return{label_entity_id:"",label_asym_id:"",auth_seq_id:0,pdbx_PDB_ins_code:void 0}}}(t.AtomicIndex||(t.AtomicIndex={})),function(e){e.chainStartResidueIndex=function(e,t){return e.residueAtomSegments.index[e.chainAtomSegments.offsets[t]]},e.chainEndResidueIndexExcl=function(e,t){return e.residueAtomSegments.index[e.chainAtomSegments.offsets[t+1]-1]+1}}(t.AtomicHierarchy||(t.AtomicHierarchy={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(93);t.StructureSelection=r.StructureSelection;var i=n(392);t.StructureQuery=i.StructureQuery,function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(248));var a=n(249),o=n(393),u=n(395),s=n(396),c=n(397);t.Queries={generators:a,modifiers:o,combinators:u,pred:c.default,internal:s}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(43),i=n(76),a=n(117),o=function(){function e(e,t){void 0===t&&(t=0),this.currentElementStack=[],this.currentAtomicLinkStack=[],this.currentStructureStack=[],this.inputStructureStack=[],this.timeCreated=i.now(),this.element=r.StructureElement.create(),this.currentStructure=void 0,this.atomicLink=a.Link.Location(),this.inputStructure=e,this.timeoutMs=t}return e.prototype.setElement=function(e,t){this.element.unit=e,this.element.element=t},e.prototype.pushCurrentElement=function(){return this.currentElementStack[this.currentElementStack.length]=this.element,this.element=r.StructureElement.create(),this.element},e.prototype.popCurrentElement=function(){this.element=this.currentElementStack.pop()},e.prototype.pushCurrentLink=function(){return this.atomicLink&&this.currentAtomicLinkStack.push(this.atomicLink),this.atomicLink=a.Link.Location(),this.atomicLink},e.prototype.popCurrentLink=function(){this.currentAtomicLinkStack.length>0?this.atomicLink=this.currentAtomicLinkStack.pop():this.atomicLink=void 0},e.prototype.pushCurrentStructure=function(){this.currentStructure&&this.currentStructureStack.push(this.currentStructure)},e.prototype.popCurrentStructure=function(){this.currentStructureStack.length?this.currentStructure=this.currentStructureStack.pop():this.currentStructure=void 0},e.prototype.pushInputStructure=function(e){this.inputStructureStack.push(this.inputStructure),this.inputStructure=e},e.prototype.popInputStructure=function(){if(0===this.inputStructureStack.length)throw new Error("Must push before pop.");this.inputStructure=this.inputStructureStack.pop()},e.prototype.throwIfTimedOut=function(){if(0!==this.timeoutMs&&i.now()-this.timeCreated>this.timeoutMs)throw new Error("The query took too long to execute (> "+this.timeoutMs/1e3+"s).")},e}();t.QueryContext=o},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(93),a=n(43),o=n(5),u=n(250),s=n(92),c=n(45),l=n(141);function f(e){return!0}function d(e){return 0}function p(e){if(!(e&&(e.atomTest||e.residueTest||e.chainTest||e.entityTest||e.groupBy)))return t.all;if(e.atomTest&&!e.residueTest&&!e.chainTest&&!e.entityTest&&!e.groupBy)return n=e.atomTest,function(e){for(var t=e.inputStructure,r=t.units,a=e.pushCurrentElement(),o=t.subsetBuilder(!0),u=0,s=r;u<s.length;u++){var c=s[u];a.unit=c;var l=c.elements;o.beginUnit(c.id);for(var f=0,d=l.length;f<d;f++)a.element=l[f],n(e)&&o.addElement(a.element);o.commitUnit(),e.throwIfTimedOut()}return e.popCurrentElement(),i.StructureSelection.Singletons(t,o.getStructure())};var n,r={entityTest:e.entityTest||f,chainTest:e.chainTest||f,residueTest:e.residueTest||f,atomTest:e.atomTest||f,groupBy:e.groupBy||d};return e.groupBy?function(e){var t=e.entityTest,n=e.chainTest,r=e.residueTest,i=e.atomTest,a=e.groupBy;return function(e){for(var s=e.inputStructure,c=s.units,l=e.pushCurrentElement(),f=new u.LinearGroupingBuilder(s),d=0,p=c;d<p.length;d++){var h=p[d];if(0===h.kind){l.unit=h;for(var m=h.elements,y=o.Segmentation.transientSegments(h.model.atomicHierarchy.chainAtomSegments,m),v=o.Segmentation.transientSegments(h.model.atomicHierarchy.residueAtomSegments,m);y.hasNext;){var b=y.move();if(l.element=m[b.start],t(e)&&n(e))for(v.setSegment(b);v.hasNext;){var g=v.move();if(l.element=m[g.start],r(e))for(var _=g.start,S=g.end;_<S;_++)l.element=m[_],i(e)&&f.add(a(e),h.id,l.element)}}e.throwIfTimedOut()}}return e.popCurrentElement(),f.getSelection()}}(r):function(e){var t=e.entityTest,n=e.chainTest,r=e.residueTest,a=e.atomTest;return function(e){for(var u=e.inputStructure,s=u.units,c=e.pushCurrentElement(),l=u.subsetBuilder(!0),f=0,d=s;f<d.length;f++){var p=d[f];if(0===p.kind){c.unit=p;var h=p.elements;l.beginUnit(p.id);for(var m=o.Segmentation.transientSegments(p.model.atomicHierarchy.chainAtomSegments,h),y=o.Segmentation.transientSegments(p.model.atomicHierarchy.residueAtomSegments,h);m.hasNext;){var v=m.move();if(c.element=h[v.start],t(e)&&n(e))for(y.setSegment(v);y.hasNext;){var b=y.move();if(c.element=h[b.start],r(e))for(var g=b.start,_=b.end;g<_;g++)c.element=h[g],a(e)&&l.addElement(c.element)}}l.commitUnit(),e.throwIfTimedOut()}}return e.popCurrentElement(),i.StructureSelection.Singletons(u,l.getStructure())}}(r)}function h(e,t){for(var n=new Int32Array(t.length),r=0,i=t.length;r<i;r++)n[r]=e.elements[t[r]];return s.default.create([e.getChild(o.SortedArray.ofSortedArray(n))])}t.none=function(e){return i.StructureSelection.Sequence(e.inputStructure,[])},t.all=function(e){return i.StructureSelection.Singletons(e.inputStructure,e.inputStructure)},t.residues=function(e){return p(r({},e,{groupBy:function(e){return a.StructureProperties.residue.key(e.element)}}))},t.chains=function(e){return p(r({},e,{groupBy:function(e){return a.StructureProperties.chain.key(e.element)}}))},t.atoms=p,t.rings=function(e){return function(t){var n=t.inputStructure.units,r=i.StructureSelection.LinearBuilder(t.inputStructure);if(e&&0!==e.length){for(var o=c.UniqueArray.create(),u=0;u<e.length;u++)c.UniqueArray.add(o,e[u],e[u]);for(var s=0,l=n;s<l.length;s++)if(_=l[s],a.Unit.isAtomic(_))for(var f=_.rings,d=0,p=o.array;d<p.length;d++){var m=p[d];if(f.byFingerprint.has(m))for(var y=0,v=f.byFingerprint.get(m);y<v.length;y++)x=v[y],r.add(h(_,f.all[x]))}}else for(var b=0,g=n;b<g.length;b++){var _=g[b];if(a.Unit.isAtomic(_))for(var S=0,C=_.rings.all;S<C.length;S++){var x=C[S];r.add(h(_,x))}}return r.getSelection()}},t.querySelection=function(e,t,n){return void 0===n&&(n=!1),function(r){var a=e(r);if(0===i.StructureSelection.structureCount(a))return a;var o=n?l.structureSubtract(r.inputStructure,i.StructureSelection.unionStructure(a)):i.StructureSelection.unionStructure(a);if(0===o.elementCount)return i.StructureSelection.Empty(r.inputStructure);r.throwIfTimedOut(),r.pushInputStructure(o);var u=t(r);return r.popInputStructure(),i.StructureSelection.withInputStructure(u,r.inputStructure)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(43),i=n(93),a=n(45),o=n(141),u=function(){function e(e){this.source=e,this.set=a.HashSet(r.Structure.hashCode,r.Structure.areEqual),this.structures=[],this.allSingletons=!0}return e.prototype.add=function(e){e.elementCount&&(1!==e.elementCount&&(this.allSingletons=!1),this.set.add(e)&&(this.structures[this.structures.length]=e))},e.prototype.getSelection=function(){return this.allSingletons?i.StructureSelection.Singletons(this.source,o.structureUnion(this.source,this.structures)):i.StructureSelection.Sequence(this.source,this.structures)},e}();t.UniqueStructuresBuilder=u;var s=function(){function e(e){this.source=e,this.builders=[],this.builderMap=new Map}return e.prototype.add=function(e,t,n){var r=this.builderMap.get(e);r||(r=this.source.subsetBuilder(!0),this.builders[this.builders.length]=r,this.builderMap.set(e,r)),r.addToUnit(t,n)},e.prototype.allSingletons=function(){for(var e=0,t=this.builders.length;e<t;e++)if(this.builders[e].elementCount>1)return!1;return!0},e.prototype.singletonSelection=function(){for(var e=this.source.subsetBuilder(!0),t=r.StructureElement.create(),n=0,a=this.builders.length;n<a;n++)this.builders[n].setSingletonLocation(t),e.addToUnit(t.unit.id,t.element);return i.StructureSelection.Singletons(this.source,e.getStructure())},e.prototype.fullSelection=function(){for(var e=new Array(this.builders.length),t=0,n=this.builders.length;t<n;t++)e[t]=this.builders[t].getStructure();return i.StructureSelection.Sequence(this.source,e)},e.prototype.getSelection=function(){return 0===this.builders.length?i.StructureSelection.Empty(this.source):this.allSingletons()?this.singletonSelection():this.fullSelection()},e}();t.LinearGroupingBuilder=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=[];function i(e,t,n,r){return e+"|"+t.id+"|"+n+"|"+r.id}var a=function(){function e(e){this.pairs=e;var t=new Map;this.pairs.forEach(function(e,n){var r=i(e.indexA,e.unitA,e.indexB,e.unitB),a=t.get(r);a?a.push(n):t.set(r,[n])}),this.count=e.length,this.pairKeyIndices=t}return e.prototype.getPairIndices=function(e,t,n,a){var o=i(e,t,n,a),u=this.pairKeyIndices.get(o);return void 0!==u?u:r},e.prototype.getPairs=function(e,t,n,r){var i=this,a=this.getPairIndices(e,t,n,r);return a.length?a.map(function(e){return i.pairs[e]}):void 0},e}();t.PairRestraints=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(116),i=n(78),a=n(119),o={true:r.default.property(function(e){return!0}),false:r.default.property(function(e){return!1}),zero:r.default.property(function(e){return 0})};function u(){throw"Property only available for atomic models."}function s(e){if(e)throw"Property only available for coarse models ("+e+").";throw"Property only available for coarse models."}var c={key:r.default.property(function(e){return e.element}),x:r.default.property(function(e){return e.unit.conformation.x(e.element)}),y:r.default.property(function(e){return e.unit.conformation.y(e.element)}),z:r.default.property(function(e){return e.unit.conformation.z(e.element)}),id:r.default.property(function(e){return i.default.isAtomic(e.unit)?e.unit.model.atomicConformation.atomId.value(e.element):u()}),occupancy:r.default.property(function(e){return i.default.isAtomic(e.unit)?e.unit.model.atomicConformation.occupancy.value(e.element):u()}),B_iso_or_equiv:r.default.property(function(e){return i.default.isAtomic(e.unit)?e.unit.model.atomicConformation.B_iso_or_equiv.value(e.element):u()}),type_symbol:r.default.property(function(e){return i.default.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.type_symbol.value(e.element):u()}),label_atom_id:r.default.property(function(e){return i.default.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.label_atom_id.value(e.element):u()}),auth_atom_id:r.default.property(function(e){return i.default.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.auth_atom_id.value(e.element):u()}),label_alt_id:r.default.property(function(e){return i.default.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.label_alt_id.value(e.element):u()}),pdbx_formal_charge:r.default.property(function(e){return i.default.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.pdbx_formal_charge.value(e.element):u()}),vdw_radius:r.default.property(function(e){return i.default.isAtomic(e.unit)?a.VdwRadius(e.unit.model.atomicHierarchy.atoms.type_symbol.value(e.element)):u()})},l={key:r.default.property(function(e){return i.default.isAtomic(e.unit)?e.unit.residueIndex[e.element]:u()}),group_PDB:r.default.property(function(e){return i.default.isAtomic(e.unit)?e.unit.model.atomicHierarchy.residues.group_PDB.value(e.unit.residueIndex[e.element]):u()}),label_comp_id:r.default.property(function(e){return i.default.isAtomic(e.unit)?e.unit.model.atomicHierarchy.residues.label_comp_id.value(e.unit.residueIndex[e.element]):u()}),auth_comp_id:r.default.property(function(e){return i.default.isAtomic(e.unit)?e.unit.model.atomicHierarchy.residues.auth_comp_id.value(e.unit.residueIndex[e.element]):u()}),label_seq_id:r.default.property(function(e){return i.default.isAtomic(e.unit)?e.unit.model.atomicHierarchy.residues.label_seq_id.value(e.unit.residueIndex[e.element]):u()}),auth_seq_id:r.default.property(function(e){return i.default.isAtomic(e.unit)?e.unit.model.atomicHierarchy.residues.auth_seq_id.value(e.unit.residueIndex[e.element]):u()}),pdbx_PDB_ins_code:r.default.property(function(e){return i.default.isAtomic(e.unit)?e.unit.model.atomicHierarchy.residues.pdbx_PDB_ins_code.value(e.unit.residueIndex[e.element]):u()}),secondary_structure_type:r.default.property(function(e){return i.default.isAtomic(e.unit)?e.unit.model.properties.secondaryStructure.type[e.unit.residueIndex[e.element]]:u()}),secondary_structure_key:r.default.property(function(e){return i.default.isAtomic(e.unit)?e.unit.model.properties.secondaryStructure.key[e.unit.residueIndex[e.element]]:u()})},f={key:r.default.property(function(e){return i.default.isAtomic(e.unit)?e.unit.chainIndex[e.element]:u()}),label_asym_id:r.default.property(function(e){return i.default.isAtomic(e.unit)?e.unit.model.atomicHierarchy.chains.label_asym_id.value(e.unit.chainIndex[e.element]):u()}),auth_asym_id:r.default.property(function(e){return i.default.isAtomic(e.unit)?e.unit.model.atomicHierarchy.chains.auth_asym_id.value(e.unit.chainIndex[e.element]):u()}),label_entity_id:r.default.property(function(e){return i.default.isAtomic(e.unit)?e.unit.model.atomicHierarchy.chains.label_entity_id.value(e.unit.chainIndex[e.element]):u()})},d={key:c.key,entityKey:r.default.property(function(e){return i.default.isCoarse(e.unit)?e.unit.coarseElements.entityKey[e.element]:s()}),x:c.x,y:c.y,z:c.z,asym_id:r.default.property(function(e){return i.default.isCoarse(e.unit)?e.unit.coarseElements.asym_id.value(e.element):s()}),seq_id_begin:r.default.property(function(e){return i.default.isCoarse(e.unit)?e.unit.coarseElements.seq_id_begin.value(e.element):s()}),seq_id_end:r.default.property(function(e){return i.default.isCoarse(e.unit)?e.unit.coarseElements.seq_id_end.value(e.element):s()}),sphere_radius:r.default.property(function(e){return i.default.isSpheres(e.unit)?e.unit.coarseConformation.radius[e.element]:s("spheres")}),sphere_rmsf:r.default.property(function(e){return i.default.isSpheres(e.unit)?e.unit.coarseConformation.rmsf[e.element]:s("spheres")}),gaussian_weight:r.default.property(function(e){return i.default.isGaussians(e.unit)?e.unit.coarseConformation.weight[e.element]:s("gaussians")}),gaussian_covariance_matrix:r.default.property(function(e){return i.default.isGaussians(e.unit)?e.unit.coarseConformation.covariance_matrix[e.element]:s("gaussians")})},p=r.default.entityIndex,h={constant:o,atom:c,residue:l,chain:f,entity:{key:p,id:r.default.property(function(e){return e.unit.model.entities.data.id.value(p(e))}),type:r.default.property(function(e){return e.unit.model.entities.data.type.value(p(e))}),src_method:r.default.property(function(e){return e.unit.model.entities.data.src_method.value(p(e))}),pdbx_description:r.default.property(function(e){return e.unit.model.entities.data.pdbx_description.value(p(e))}),formula_weight:r.default.property(function(e){return e.unit.model.entities.data.formula_weight.value(p(e))}),pdbx_number_of_molecules:r.default.property(function(e){return e.unit.model.entities.data.pdbx_number_of_molecules.value(p(e))}),details:r.default.property(function(e){return e.unit.model.entities.data.details.value(p(e))}),pdbx_mutation:r.default.property(function(e){return e.unit.model.entities.data.pdbx_mutation.value(p(e))}),pdbx_fragment:r.default.property(function(e){return e.unit.model.entities.data.pdbx_fragment.value(p(e))}),pdbx_ec:r.default.property(function(e){return e.unit.model.entities.data.pdbx_ec.value(p(e))})},unit:{operator_name:r.default.property(function(e){return e.unit.conformation.operator.name}),model_num:r.default.property(function(e){return e.unit.model.modelNum})},coarse:d};t.default=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(18),i=n(3),a=n(35),o=r.Color(13421772),u="Gives everything the same, uniform color.";function s(e){return t.UniformColorThemeParams}function c(e,t){var n=t.value||o;return{factory:c,granularity:"uniform",color:function(){return n},props:t,description:u,legend:a.TableLegend([["uniform",n]])}}t.UniformColorThemeParams={value:i.ParamDefinition.Color(o)},t.getUniformColorThemeParams=s,t.UniformColorTheme=c,t.UniformColorThemeProvider={label:"Uniform",factory:c,getParams:s,defaultValues:i.ParamDefinition.getDefaultValues(t.UniformColorThemeParams),isApplicable:function(e){return!0}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),i="Gives everything the same, uniform size.";function a(e){return t.UniformSizeThemeParams}function o(e,t){var n=t.value;return{factory:o,granularity:"uniform",size:function(){return n},props:t,description:i}}t.UniformSizeThemeParams={value:r.ParamDefinition.Numeric(1,{min:0,max:20,step:.1})},t.getUniformSizeThemeParams=a,t.UniformSizeTheme=o,t.UniformSizeThemeProvider={label:"Uniform",factory:o,getParams:a,defaultValues:r.ParamDefinition.getDefaultValues(t.UniformSizeThemeParams),isApplicable:function(e){return!0}}},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(3),a=n(413),o=n(52),u={};t.getFontAtlas=function(e){var t=JSON.stringify(e);return void 0===u[t]&&(u[t]=new s(e)),u[t]},t.FontAtlasParams={fontFamily:i.ParamDefinition.Select("sans-serif",[["sans-serif","Sans Serif"],["monospace","Monospace"],["serif","Serif"],["cursive","Cursive"]]),fontQuality:i.ParamDefinition.Select(3,[[0,"lower"],[1,"low"],[2,"medium"],[3,"high"],[4,"higher"]]),fontStyle:i.ParamDefinition.Select("normal",[["normal","Normal"],["italic","Italic"],["oblique","Oblique"]]),fontVariant:i.ParamDefinition.Select("normal",[["normal","Normal"],["small-caps","Small Caps"]]),fontWeight:i.ParamDefinition.Select("normal",[["normal","Normal"],["bold","Bold"]])};var s=function(){function e(e){void 0===e&&(e={}),this.mapped={},this.scratchW=0,this.scratchH=0,this.currentX=0,this.currentY=0,this.cutoff=.5;var n=r({},i.ParamDefinition.getDefaultValues(t.FontAtlasParams),e);this.props=n;var a=32*(n.fontQuality+1);this.buffer=a/8,this.radius=a/3,this.lineHeight=Math.round(a+2*this.buffer+this.radius),this.maxWidth=Math.round(.75*this.lineHeight),this.texture=o.createTextureImage(350*this.lineHeight*this.maxWidth,1),this.scratchCanvas=document.createElement("canvas"),this.scratchCanvas.width=this.maxWidth,this.scratchCanvas.height=this.lineHeight,this.scratchContext=this.scratchCanvas.getContext("2d"),this.scratchContext.font=n.fontStyle+" "+n.fontVariant+" "+n.fontWeight+" "+a+"px "+n.fontFamily,this.scratchContext.fillStyle="black",this.scratchContext.textBaseline="middle",this.scratchData=new Uint8Array(this.lineHeight*this.maxWidth),this.gridOuter=new Float64Array(this.lineHeight*this.maxWidth),this.gridInner=new Float64Array(this.lineHeight*this.maxWidth),this.f=new Float64Array(Math.max(this.lineHeight,this.maxWidth)),this.d=new Float64Array(Math.max(this.lineHeight,this.maxWidth)),this.z=new Float64Array(Math.max(this.lineHeight,this.maxWidth)+1),this.v=new Int16Array(Math.max(this.lineHeight,this.maxWidth)),this.middle=Math.ceil(this.lineHeight/2),this.placeholder=this.get(String.fromCharCode(65533))}return e.prototype.get=function(e){if(void 0===this.mapped[e]){this.draw(e);var t=this.texture,n=t.array,r=t.width,i=t.height,a=this.scratchData;if(this.currentX+this.scratchW>r&&(this.currentX=0,this.currentY+=this.scratchH),this.currentY+this.scratchH>i)return console.warn("canvas to small"),this.placeholder;this.mapped[e]={x:this.currentX,y:this.currentY,w:this.scratchW,h:this.scratchH,nw:this.scratchW/this.lineHeight,nh:this.scratchH/this.lineHeight};for(var o=0;o<this.scratchH;++o)for(var u=0;u<this.scratchW;++u)n[r*(this.currentY+o)+this.currentX+u]=a[o*this.scratchW+u];this.currentX+=this.scratchW}return this.mapped[e]},e.prototype.draw=function(e){var t=this.lineHeight,n=this.scratchContext,r=this.scratchData,i=n.measureText(e),o=Math.min(this.maxWidth,Math.ceil(i.width+2*this.buffer)),u=o*t;n.clearRect(0,0,o,t),n.fillText(e,this.buffer,this.middle);for(var s=n.getImageData(0,0,o,t),c=0;c<u;c++){var l=s.data[4*c+3]/255;this.gridOuter[c]=1===l?0:0===l?Number.MAX_SAFE_INTEGER:Math.pow(Math.max(0,.5-l),2),this.gridInner[c]=1===l?Number.MAX_SAFE_INTEGER:0===l?0:Math.pow(Math.max(0,l-.5),2)}a.edt(this.gridOuter,o,t,this.f,this.d,this.v,this.z),a.edt(this.gridInner,o,t,this.f,this.d,this.v,this.z);for(c=0;c<u;c++){var f=this.gridOuter[c]-this.gridInner[c];r[c]=Math.max(0,Math.min(255,Math.round(255-255*(f/this.radius+this.cutoff))))}this.scratchW=o,this.scratchH=t},e}();t.FontAtlas=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(77),i=n(17);!function(e){e.create=function(e,t,n){void 0===e&&(e=2048),void 0===t&&(t=1024);var a=i.ChunkedArray.create(Float32Array,2,t,n?n.mappingBuffer.ref.value:e),o=i.ChunkedArray.create(Float32Array,1,t,n?n.groupBuffer.ref.value:e),u=i.ChunkedArray.create(Uint32Array,3,3*t,n?n.indexBuffer.ref.value:3*e),s=i.ChunkedArray.create(Float32Array,3,t,n?n.startBuffer.ref.value:e),c=i.ChunkedArray.create(Float32Array,3,t,n?n.endBuffer.ref.value:e);return{add:function(e,t,n,r,l,f,d){for(var p=a.elementCount,h=0;h<4;++h)i.ChunkedArray.add3(s,e,t,n),i.ChunkedArray.add3(c,r,l,f),i.ChunkedArray.add(o,d);i.ChunkedArray.add2(a,-1,1),i.ChunkedArray.add2(a,-1,-1),i.ChunkedArray.add2(a,1,1),i.ChunkedArray.add2(a,1,-1),i.ChunkedArray.add3(u,p,p+1,p+2),i.ChunkedArray.add3(u,p+1,p+3,p+2)},getLines:function(){var e=i.ChunkedArray.compact(a,!0),t=i.ChunkedArray.compact(u,!0),l=i.ChunkedArray.compact(o,!0),f=i.ChunkedArray.compact(s,!0),d=i.ChunkedArray.compact(c,!0);return{kind:"lines",lineCount:u.elementCount/2,mappingBuffer:n?r.ValueCell.update(n.mappingBuffer,e):r.ValueCell.create(e),indexBuffer:n?r.ValueCell.update(n.indexBuffer,t):r.ValueCell.create(t),groupBuffer:n?r.ValueCell.update(n.groupBuffer,l):r.ValueCell.create(l),startBuffer:n?r.ValueCell.update(n.startBuffer,f):r.ValueCell.create(f),endBuffer:n?r.ValueCell.update(n.endBuffer,d):r.ValueCell.create(d)}}}}}(t.LinesBuilder||(t.LinesBuilder={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(18),i=n(121),a=n(3),o=r.Color(13421772),u="Assigns colors as defined by the shape object.";function s(e){return t.ShapeGroupColorThemeParams}function c(e,t){return{factory:c,granularity:"groupInstance",color:function(e){return i.Shape.isLocation(e)?e.shape.getColor(e.group,e.instance):o},props:t,description:u}}t.ShapeGroupColorThemeParams={},t.getShapeGroupColorThemeParams=s,t.ShapeGroupColorTheme=c,t.ShapeGroupColorThemeProvider={label:"Shape Group",factory:c,getParams:s,defaultValues:a.ParamDefinition.getDefaultValues(t.ShapeGroupColorThemeParams),isApplicable:function(e){return!!e.shape}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(121),i=n(3),a=1,o="Assigns sizes as defined by the shape object.";function u(e){return t.ShapeGroupSizeThemeParams}function s(e,t){return{factory:s,granularity:"groupInstance",size:function(e){return r.Shape.isLocation(e)?e.shape.getSize(e.group,e.instance):a},props:t,description:o}}t.ShapeGroupSizeThemeParams={},t.getShapeGroupSizeThemeParams=u,t.ShapeGroupSizeTheme=s,t.ShapeGroupSizeThemeProvider={label:"Shape Group",factory:s,getParams:u,defaultValues:i.ParamDefinition.getDefaultValues(t.ShapeGroupSizeThemeParams),isApplicable:function(e){return!!e.shape}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(79),a=n(430),o=n(19),u=n(2),s=new(n(136).BoundaryHelper);function c(e,t){var n=e.getProgram("draw").id,r=t.getProgram("draw").id,i=e.values.boundingSphere.ref.value.center[2],a=e.values.boundingSphere.ref.value.center[2];return n!==r?n-r:i!==a?e.state.opaque?i-a:a-i:e.id-t.id}!function(e){e.create=function(e){var t=new Map,n=[],r=o.Sphere3D.zero(),l=!0,f=a.Object3D.create();return{get view(){return f.view},get position(){return f.position},get direction(){return f.direction},get up(){return f.up},update:function(e){a.Object3D.update(f);for(var t=0,r=n.length;t<r;++t)n[t].update();e||(l=!0)},add:function(r){if(t.has(r))console.warn("RenderObject with id '"+r.id+"' already present");else{var a=i.createRenderable(e,r);n.push(a),n.sort(c),t.set(r,a),l=!0}},remove:function(e){var r=t.get(e);r&&(r.dispose(),n.splice(n.indexOf(r),1),n.sort(c),t.delete(e),l=!0)},has:function(e){return t.has(e)},clear:function(){for(var e=0,r=n.length;e<r;++e)n[e].dispose();n.length=0,t.clear(),l=!0},forEach:function(e){t.forEach(e)},get count(){return n.length},renderables:n,get boundingSphere(){return l&&function(e,t){s.reset(.1);for(var n=0,r=e.length;n<r;++n){var i=e[n].values.boundingSphere.ref.value;i.radius&&s.boundaryStep(i.center,i.radius)}for(s.finishBoundaryStep(),n=0,r=e.length;n<r;++n){var a=e[n].values.boundingSphere.ref.value;a.radius&&s.extendStep(a.center,a.radius)}u.Vec3.copy(t.center,s.center),t.radius=s.radius}(n,r),l=!1,r}}}}(r||(r={})),t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),i=n(133),a=n(39),o=n(431),u=function(){function e(t,n){void 0===n&&(n=i.Viewport.create(-1,-1,1,1)),this.updatedViewProjection=new a.BehaviorSubject(this),this.view=r.Mat4.identity(),this.projection=r.Mat4.identity(),this.projectionView=r.Mat4.identity(),this.inverseProjectionView=r.Mat4.identity(),this.state=e.createDefaultSnapshot(),this.transition=new o.CameraTransitionManager(this),this.prevProjection=r.Mat4.identity(),this.prevView=r.Mat4.identity(),this.deltaDirection=r.Vec3.zero(),this.newPosition=r.Vec3.zero(),this.viewport=n,e.copySnapshot(this.state,t)}return Object.defineProperty(e.prototype,"position",{get:function(){return this.state.position},set:function(e){r.Vec3.copy(this.state.position,e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"direction",{get:function(){return this.state.direction},set:function(e){r.Vec3.copy(this.state.direction,e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"up",{get:function(){return this.state.up},set:function(e){r.Vec3.copy(this.state.up,e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"target",{get:function(){return this.state.target},set:function(e){r.Vec3.copy(this.state.target,e)},enumerable:!0,configurable:!0}),e.prototype.updateMatrices=function(){var e,t,n,i,a,o,u,c,l,f,d,p,h,m,y,v,b,g,_=this.state,S=2*Math.tan(_.fov/2)*r.Vec3.distance(_.position,_.target);switch(_.zoom=this.viewport.height/S,this.state.mode){case"orthographic":t=(e=this).viewport,n=e.state,i=n.zoom,a=n.near,o=n.far,u=(t.width-t.x)/-2,c=(t.width-t.x)/2,l=(t.height-t.y)/2,f=(t.height-t.y)/-2,y=(h=(c+u)/2)-(d=(c-u)/(2*i)),v=h+d,b=(m=(l+f)/2)+(p=(l-f)/(2*i)),g=m-p,r.Mat4.ortho(e.projection,y,v,g,b,Math.abs(a),Math.abs(o)),r.Vec3.add(s,e.position,e.direction),r.Mat4.lookAt(e.view,e.position,s,e.up);break;case"perspective":!function(e){var t=e.viewport.width/e.viewport.height,n=e.state,i=n.fov,a=n.near,o=n.far;r.Mat4.perspective(e.projection,i,t,Math.abs(a),Math.abs(o)),r.Vec3.add(s,e.position,e.direction),r.Mat4.lookAt(e.view,e.position,s,e.up)}(this);break;default:throw new Error("unknown camera mode")}var C=!r.Mat4.areEqual(this.projection,this.prevProjection,1e-6)||!r.Mat4.areEqual(this.view,this.prevView,1e-6);return r.Mat4.mul(this.projectionView,this.projection,this.view),r.Mat4.invert(this.inverseProjectionView,this.projectionView),C&&(r.Mat4.mul(this.projectionView,this.projection,this.view),r.Mat4.invert(this.inverseProjectionView,this.projectionView),r.Mat4.copy(this.prevView,this.view),r.Mat4.copy(this.prevProjection,this.projection),this.updatedViewProjection.next(this)),C},e.prototype.setState=function(e){this.transition.apply(e)},e.prototype.getSnapshot=function(){var t=e.createDefaultSnapshot();return e.copySnapshot(t,this.state),t},e.prototype.focus=function(e,t){var n=this.state.fov,i=this.viewport,a=i.width,o=i.height,u=o<a?1:a/o,s=r.Vec3.distance(this.state.position,e),c=Math.abs(t/u/Math.sin(n/2)),l=Math.abs(s-c);r.Vec3.sub(this.deltaDirection,this.state.position,e),r.Vec3.setMagnitude(this.deltaDirection,this.state.direction,l),s<c&&r.Vec3.negate(this.deltaDirection,this.deltaDirection),r.Vec3.add(this.newPosition,this.state.position,this.deltaDirection),this.setState({target:e,position:this.newPosition})},e.prototype.project=function(e,t){return i.cameraProject(e,t,this.viewport,this.projectionView)},e.prototype.unproject=function(e,t){return i.cameraUnproject(e,t,this.viewport,this.inverseProjectionView)},e.prototype.dispose=function(){this.updatedViewProjection.complete()},e}();t.Camera=u,function(e){e.createDefaultSnapshot=function(){return{mode:"perspective",position:r.Vec3.zero(),direction:r.Vec3.create(0,0,-1),up:r.Vec3.create(0,1,0),target:r.Vec3.create(0,0,0),near:.1,far:1e4,fogNear:.1,fogFar:1e4,fov:Math.PI/4,zoom:1}},e.copySnapshot=function(e,t){t&&(void 0!==t.mode&&(e.mode=t.mode),void 0!==t.position&&r.Vec3.copy(e.position,t.position),void 0!==t.direction&&r.Vec3.copy(e.direction,t.direction),void 0!==t.up&&r.Vec3.copy(e.up,t.up),void 0!==t.target&&r.Vec3.copy(e.target,t.target),void 0!==t.near&&(e.near=t.near),void 0!==t.far&&(e.far=t.far),void 0!==t.fogNear&&(e.fogNear=t.fogNear),void 0!==t.fogFar&&(e.fogFar=t.fogFar),void 0!==t.fov&&(e.fov=t.fov),void 0!==t.zoom&&(e.zoom=t.zoom))}}(u||(u={})),t.Camera=u;var s=r.Vec3.zero()},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(147),a=n(46),o=n(3);function u(){return a.UnitsSpheresVisual({defaultProps:o.ParamDefinition.getDefaultValues(t.ElementSphereParams),createGeometry:i.createElementSphereImpostor,createLocationIterator:i.StructureElementIterator.fromGroup,getLoci:i.getElementLoci,mark:i.markElement,setUpdateState:function(e,t,n){}})}function s(){return a.UnitsMeshVisual({defaultProps:o.ParamDefinition.getDefaultValues(t.ElementSphereParams),createGeometry:i.createElementSphereMesh,createLocationIterator:i.StructureElementIterator.fromGroup,getLoci:i.getElementLoci,mark:i.markElement,setUpdateState:function(e,t,n){e.createGeometry=t.sizeFactor!==n.sizeFactor||t.detail!==n.detail}})}t.ElementSphereParams=r({},a.UnitsMeshParams,a.UnitsSpheresParams,{sizeFactor:o.ParamDefinition.Numeric(1,{min:0,max:10,step:.1}),detail:o.ParamDefinition.Numeric(0,{min:0,max:3,step:1})}),t.getElementSphereVisual=function(e){return e&&e.extensions.fragDepth?u:s},t.ElementSphereImpostorVisual=u,t.ElementSphereMeshVisual=s},function(e,t,n){"use strict";function r(e,t,n){return{i:e,j:t,k:n}}function i(e,t){return{a:e,b:t}}Object.defineProperty(t,"__esModule",{value:!0}),t.Index=r,t.IndexPair=i,t.EdgesXY=[[],[0,3],[0,1],[1,3],[1,2],[0,1,1,2,2,3,0,3],[0,2],[2,3],[2,3],[0,2],[0,1,1,2,2,3,0,3],[1,2],[1,3],[0,1],[0,3],[]],t.EdgesXZ=[[],[0,8],[0,9],[9,8],[9,4],[0,9,9,4,4,8,0,8],[0,4],[4,8],[4,8],[0,4],[0,9,9,4,4,8,0,8],[9,4],[9,8],[0,9],[0,8],[]],t.EdgesYZ=[[],[3,8],[3,11],[11,8],[11,7],[3,11,11,7,7,8,3,8],[3,7],[7,8],[7,8],[3,7],[3,11,11,7,7,8,3,8],[11,7],[11,8],[3,11],[3,8],[]],t.CubeVertices=[r(0,0,0),r(1,0,0),r(1,1,0),r(0,1,0),r(0,0,1),r(1,0,1),r(1,1,1),r(0,1,1)],t.CubeEdges=[i(t.CubeVertices[0],t.CubeVertices[1]),i(t.CubeVertices[1],t.CubeVertices[2]),i(t.CubeVertices[2],t.CubeVertices[3]),i(t.CubeVertices[3],t.CubeVertices[0]),i(t.CubeVertices[4],t.CubeVertices[5]),i(t.CubeVertices[5],t.CubeVertices[6]),i(t.CubeVertices[6],t.CubeVertices[7]),i(t.CubeVertices[7],t.CubeVertices[4]),i(t.CubeVertices[0],t.CubeVertices[4]),i(t.CubeVertices[1],t.CubeVertices[5]),i(t.CubeVertices[2],t.CubeVertices[6]),i(t.CubeVertices[3],t.CubeVertices[7])],t.EdgeIdInfo=[{i:0,j:0,k:0,e:0},{i:1,j:0,k:0,e:1},{i:0,j:1,k:0,e:0},{i:0,j:0,k:0,e:1},{i:0,j:0,k:1,e:0},{i:1,j:0,k:1,e:1},{i:0,j:1,k:1,e:0},{i:0,j:0,k:1,e:1},{i:0,j:0,k:0,e:2},{i:1,j:0,k:0,e:2},{i:1,j:1,k:0,e:2},{i:0,j:1,k:0,e:2}],t.EdgeTable=[0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0],t.TriTable=[[],[0,8,3],[0,1,9],[1,8,3,9,8,1],[1,2,10],[0,8,3,1,2,10],[9,2,10,0,2,9],[2,8,3,2,10,8,10,9,8],[3,11,2],[0,11,2,8,11,0],[1,9,0,2,3,11],[1,11,2,1,9,11,9,8,11],[3,10,1,11,10,3],[0,10,1,0,8,10,8,11,10],[3,9,0,3,11,9,11,10,9],[9,8,10,10,8,11],[4,7,8],[4,3,0,7,3,4],[0,1,9,8,4,7],[4,1,9,4,7,1,7,3,1],[1,2,10,8,4,7],[3,4,7,3,0,4,1,2,10],[9,2,10,9,0,2,8,4,7],[2,10,9,2,9,7,2,7,3,7,9,4],[8,4,7,3,11,2],[11,4,7,11,2,4,2,0,4],[9,0,1,8,4,7,2,3,11],[4,7,11,9,4,11,9,11,2,9,2,1],[3,10,1,3,11,10,7,8,4],[1,11,10,1,4,11,1,0,4,7,11,4],[4,7,8,9,0,11,9,11,10,11,0,3],[4,7,11,4,11,9,9,11,10],[9,5,4],[9,5,4,0,8,3],[0,5,4,1,5,0],[8,5,4,8,3,5,3,1,5],[1,2,10,9,5,4],[3,0,8,1,2,10,4,9,5],[5,2,10,5,4,2,4,0,2],[2,10,5,3,2,5,3,5,4,3,4,8],[9,5,4,2,3,11],[0,11,2,0,8,11,4,9,5],[0,5,4,0,1,5,2,3,11],[2,1,5,2,5,8,2,8,11,4,8,5],[10,3,11,10,1,3,9,5,4],[4,9,5,0,8,1,8,10,1,8,11,10],[5,4,0,5,0,11,5,11,10,11,0,3],[5,4,8,5,8,10,10,8,11],[9,7,8,5,7,9],[9,3,0,9,5,3,5,7,3],[0,7,8,0,1,7,1,5,7],[1,5,3,3,5,7],[9,7,8,9,5,7,10,1,2],[10,1,2,9,5,0,5,3,0,5,7,3],[8,0,2,8,2,5,8,5,7,10,5,2],[2,10,5,2,5,3,3,5,7],[7,9,5,7,8,9,3,11,2],[9,5,7,9,7,2,9,2,0,2,7,11],[2,3,11,0,1,8,1,7,8,1,5,7],[11,2,1,11,1,7,7,1,5],[9,5,8,8,5,7,10,1,3,10,3,11],[5,7,0,5,0,9,7,11,0,1,0,10,11,10,0],[11,10,0,11,0,3,10,5,0,8,0,7,5,7,0],[11,10,5,7,11,5],[10,6,5],[0,8,3,5,10,6],[9,0,1,5,10,6],[1,8,3,1,9,8,5,10,6],[1,6,5,2,6,1],[1,6,5,1,2,6,3,0,8],[9,6,5,9,0,6,0,2,6],[5,9,8,5,8,2,5,2,6,3,2,8],[2,3,11,10,6,5],[11,0,8,11,2,0,10,6,5],[0,1,9,2,3,11,5,10,6],[5,10,6,1,9,2,9,11,2,9,8,11],[6,3,11,6,5,3,5,1,3],[0,8,11,0,11,5,0,5,1,5,11,6],[3,11,6,0,3,6,0,6,5,0,5,9],[6,5,9,6,9,11,11,9,8],[5,10,6,4,7,8],[4,3,0,4,7,3,6,5,10],[1,9,0,5,10,6,8,4,7],[10,6,5,1,9,7,1,7,3,7,9,4],[6,1,2,6,5,1,4,7,8],[1,2,5,5,2,6,3,0,4,3,4,7],[8,4,7,9,0,5,0,6,5,0,2,6],[7,3,9,7,9,4,3,2,9,5,9,6,2,6,9],[3,11,2,7,8,4,10,6,5],[5,10,6,4,7,2,4,2,0,2,7,11],[0,1,9,4,7,8,2,3,11,5,10,6],[9,2,1,9,11,2,9,4,11,7,11,4,5,10,6],[8,4,7,3,11,5,3,5,1,5,11,6],[5,1,11,5,11,6,1,0,11,7,11,4,0,4,11],[0,5,9,0,6,5,0,3,6,11,6,3,8,4,7],[6,5,9,6,9,11,4,7,9,7,11,9],[10,4,9,6,4,10],[4,10,6,4,9,10,0,8,3],[10,0,1,10,6,0,6,4,0],[8,3,1,8,1,6,8,6,4,6,1,10],[1,4,9,1,2,4,2,6,4],[3,0,8,1,2,9,2,4,9,2,6,4],[0,2,4,4,2,6],[8,3,2,8,2,4,4,2,6],[10,4,9,10,6,4,11,2,3],[0,8,2,2,8,11,4,9,10,4,10,6],[3,11,2,0,1,6,0,6,4,6,1,10],[6,4,1,6,1,10,4,8,1,2,1,11,8,11,1],[9,6,4,9,3,6,9,1,3,11,6,3],[8,11,1,8,1,0,11,6,1,9,1,4,6,4,1],[3,11,6,3,6,0,0,6,4],[6,4,8,11,6,8],[7,10,6,7,8,10,8,9,10],[0,7,3,0,10,7,0,9,10,6,7,10],[10,6,7,1,10,7,1,7,8,1,8,0],[10,6,7,10,7,1,1,7,3],[1,2,6,1,6,8,1,8,9,8,6,7],[2,6,9,2,9,1,6,7,9,0,9,3,7,3,9],[7,8,0,7,0,6,6,0,2],[7,3,2,6,7,2],[2,3,11,10,6,8,10,8,9,8,6,7],[2,0,7,2,7,11,0,9,7,6,7,10,9,10,7],[1,8,0,1,7,8,1,10,7,6,7,10,2,3,11],[11,2,1,11,1,7,10,6,1,6,7,1],[8,9,6,8,6,7,9,1,6,11,6,3,1,3,6],[0,9,1,11,6,7],[7,8,0,7,0,6,3,11,0,11,6,0],[7,11,6],[7,6,11],[3,0,8,11,7,6],[0,1,9,11,7,6],[8,1,9,8,3,1,11,7,6],[10,1,2,6,11,7],[1,2,10,3,0,8,6,11,7],[2,9,0,2,10,9,6,11,7],[6,11,7,2,10,3,10,8,3,10,9,8],[7,2,3,6,2,7],[7,0,8,7,6,0,6,2,0],[2,7,6,2,3,7,0,1,9],[1,6,2,1,8,6,1,9,8,8,7,6],[10,7,6,10,1,7,1,3,7],[10,7,6,1,7,10,1,8,7,1,0,8],[0,3,7,0,7,10,0,10,9,6,10,7],[7,6,10,7,10,8,8,10,9],[6,8,4,11,8,6],[3,6,11,3,0,6,0,4,6],[8,6,11,8,4,6,9,0,1],[9,4,6,9,6,3,9,3,1,11,3,6],[6,8,4,6,11,8,2,10,1],[1,2,10,3,0,11,0,6,11,0,4,6],[4,11,8,4,6,11,0,2,9,2,10,9],[10,9,3,10,3,2,9,4,3,11,3,6,4,6,3],[8,2,3,8,4,2,4,6,2],[0,4,2,4,6,2],[1,9,0,2,3,4,2,4,6,4,3,8],[1,9,4,1,4,2,2,4,6],[8,1,3,8,6,1,8,4,6,6,10,1],[10,1,0,10,0,6,6,0,4],[4,6,3,4,3,8,6,10,3,0,3,9,10,9,3],[10,9,4,6,10,4],[4,9,5,7,6,11],[0,8,3,4,9,5,11,7,6],[5,0,1,5,4,0,7,6,11],[11,7,6,8,3,4,3,5,4,3,1,5],[9,5,4,10,1,2,7,6,11],[6,11,7,1,2,10,0,8,3,4,9,5],[7,6,11,5,4,10,4,2,10,4,0,2],[3,4,8,3,5,4,3,2,5,10,5,2,11,7,6],[7,2,3,7,6,2,5,4,9],[9,5,4,0,8,6,0,6,2,6,8,7],[3,6,2,3,7,6,1,5,0,5,4,0],[6,2,8,6,8,7,2,1,8,4,8,5,1,5,8],[9,5,4,10,1,6,1,7,6,1,3,7],[1,6,10,1,7,6,1,0,7,8,7,0,9,5,4],[4,0,10,4,10,5,0,3,10,6,10,7,3,7,10],[7,6,10,7,10,8,5,4,10,4,8,10],[6,9,5,6,11,9,11,8,9],[3,6,11,0,6,3,0,5,6,0,9,5],[0,11,8,0,5,11,0,1,5,5,6,11],[6,11,3,6,3,5,5,3,1],[1,2,10,9,5,11,9,11,8,11,5,6],[0,11,3,0,6,11,0,9,6,5,6,9,1,2,10],[11,8,5,11,5,6,8,0,5,10,5,2,0,2,5],[6,11,3,6,3,5,2,10,3,10,5,3],[5,8,9,5,2,8,5,6,2,3,8,2],[9,5,6,9,6,0,0,6,2],[1,5,8,1,8,0,5,6,8,3,8,2,6,2,8],[1,5,6,2,1,6],[1,3,6,1,6,10,3,8,6,5,6,9,8,9,6],[10,1,0,10,0,6,9,5,0,5,6,0],[0,3,8,5,6,10],[10,5,6],[11,5,10,7,5,11],[11,5,10,11,7,5,8,3,0],[5,11,7,5,10,11,1,9,0],[10,7,5,10,11,7,9,8,1,8,3,1],[11,1,2,11,7,1,7,5,1],[0,8,3,1,2,7,1,7,5,7,2,11],[9,7,5,9,2,7,9,0,2,2,11,7],[7,5,2,7,2,11,5,9,2,3,2,8,9,8,2],[2,5,10,2,3,5,3,7,5],[8,2,0,8,5,2,8,7,5,10,2,5],[9,0,1,5,10,3,5,3,7,3,10,2],[9,8,2,9,2,1,8,7,2,10,2,5,7,5,2],[1,3,5,3,7,5],[0,8,7,0,7,1,1,7,5],[9,0,3,9,3,5,5,3,7],[9,8,7,5,9,7],[5,8,4,5,10,8,10,11,8],[5,0,4,5,11,0,5,10,11,11,3,0],[0,1,9,8,4,10,8,10,11,10,4,5],[10,11,4,10,4,5,11,3,4,9,4,1,3,1,4],[2,5,1,2,8,5,2,11,8,4,5,8],[0,4,11,0,11,3,4,5,11,2,11,1,5,1,11],[0,2,5,0,5,9,2,11,5,4,5,8,11,8,5],[9,4,5,2,11,3],[2,5,10,3,5,2,3,4,5,3,8,4],[5,10,2,5,2,4,4,2,0],[3,10,2,3,5,10,3,8,5,4,5,8,0,1,9],[5,10,2,5,2,4,1,9,2,9,4,2],[8,4,5,8,5,3,3,5,1],[0,4,5,1,0,5],[8,4,5,8,5,3,9,0,5,0,3,5],[9,4,5],[4,11,7,4,9,11,9,10,11],[0,8,3,4,9,7,9,11,7,9,10,11],[1,10,11,1,11,4,1,4,0,7,4,11],[3,1,4,3,4,8,1,10,4,7,4,11,10,11,4],[4,11,7,9,11,4,9,2,11,9,1,2],[9,7,4,9,11,7,9,1,11,2,11,1,0,8,3],[11,7,4,11,4,2,2,4,0],[11,7,4,11,4,2,8,3,4,3,2,4],[2,9,10,2,7,9,2,3,7,7,4,9],[9,10,7,9,7,4,10,2,7,8,7,0,2,0,7],[3,7,10,3,10,2,7,4,10,1,10,0,4,0,10],[1,10,2,8,7,4],[4,9,1,4,1,7,7,1,3],[4,9,1,4,1,7,0,8,1,8,7,1],[4,0,3,7,4,3],[4,8,7],[9,10,8,10,11,8],[3,0,9,3,9,11,11,9,10],[0,1,10,0,10,8,8,10,11],[3,1,10,11,3,10],[1,2,11,1,11,9,9,11,8],[3,0,9,3,9,11,1,2,9,2,11,9],[0,2,11,8,0,11],[3,2,11],[2,3,8,2,8,10,10,8,9],[9,10,2,0,9,2],[2,3,8,2,8,10,0,1,8,1,10,8],[1,10,2],[1,3,8,9,1,8],[0,9,1],[0,3,8],[]],t.AllowedContours=[[0,4,4,4,2,0,0,0,2,2,0,0],[4,0,4,4,0,8,0,0,0,8,8,0],[4,4,0,4,0,0,8,0,0,0,8,8],[4,4,4,0,0,0,0,1,1,0,0,1],[2,0,0,0,0,8,8,8,2,2,0,0],[0,8,0,0,8,0,8,8,0,8,8,0],[0,0,8,0,8,8,0,8,0,0,8,8],[0,0,0,1,8,8,8,0,1,0,0,1],[2,0,0,1,2,0,0,1,0,2,0,1],[2,8,0,0,2,8,0,0,2,0,8,0],[0,8,8,0,0,8,8,0,0,8,0,8],[0,0,8,1,0,0,8,1,1,0,8,0]]},function(e,t,n){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.message=function(e){return{type:"message",timestamp:new Date,message:e}},e.error=function(e){return{type:"error",timestamp:new Date,message:e}},e.warning=function(e){return{type:"warning",timestamp:new Date,message:e}},e.info=function(e){return{type:"info",timestamp:new Date,message:e}}}(r||(r={})),t.LogEntry=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(74),a=n(100),o=n(266),u=n(149);!function(e){var t=function(){function e(e,t,n){this.transforms=e,this.children=t,this.cellStates=n}return Object.defineProperty(e.prototype,"root",{get:function(){return this.transforms.get(a.StateTransform.RootRef)},enumerable:!0,configurable:!0}),e.prototype.asTransient=function(){return new o.TransientTree(this)},e}();function n(e,n,r){return new t(e,n,r)}function r(e){s(this,this.tree.transforms.get(e))}function s(e,t){var n=e.tree.children.get(t.ref);n&&n.size&&n.forEach(r,e),e.f(t,e.tree,e.state)}function c(e,t,n,r){var i={tree:e,state:n,f:r};return s(i,t),i.state}function l(e){f(this,this.tree.transforms.get(e))}function f(e,t){var n=e.f(t,e.tree,e.state);if("boolean"!=typeof n||n){var r=e.tree.children.get(t.ref);r&&r.size&&r.forEach(l,e)}}function d(e,t,n,r){var i={tree:e,state:n,f:r};return f(i,t),i.state}function p(e,t,n){n.push(e)}function h(e,t,n){n.push([a.StateTransform.toJSON(e),t.cellStates.get(e.ref)])}e.createEmpty=function(e){var t=e||a.StateTransform.createRoot();return n(i.Map([[t.ref,t]]),i.Map([[t.ref,i.OrderedSet()]]),i.Map([[t.ref,u.StateObjectCell.DefaultState]]))},e.create=n,e.doPostOrder=c,e.doPreOrder=d,e.subtreePostOrder=function(e,t){return c(e,t,[],p)},e.toJSON=function(e){var t=[];return d(e,e.root,t,h),{transforms:t}},e.fromJSON=function(e){for(var t=i.Map().asMutable(),r=i.Map().asMutable(),o=i.Map().asMutable(),u=0,s=e.transforms;u<s.length;u++){var c=s[u],l=a.StateTransform.fromJSON(c[0]);t.set(l.ref,l),o.set(l.ref,c[1]),r.has(l.ref)||r.set(l.ref,i.OrderedSet().asMutable()),l.ref!==l.parent&&r.get(l.parent).add(l.ref)}for(var f=0,d=e.transforms;f<d.length;f++){var p=(c=d[f])[0].ref;r.set(p,r.get(p).asImmutable())}return n(t.asImmutable(),r.asImmutable(),o.asImmutable())},e.dump=function(e){console.log({tr:e.transforms.keySeq().toArray(),tr1:e.transforms.valueSeq().toArray().map(function(e){return e.ref}),ch:e.children.keySeq().toArray(),cs:e.cellStates.keySeq().toArray()})}}(r||(r={})),t.StateTree=r},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i,a=n(7);!function(e){function t(e){var t={create:function(e){return{action:t,params:e}},id:a.UUID.create22(),definition:e};return t}var n;e.create=t,e.fromTransformer=function(e){var n=e.definition;return t({from:n.from,display:n.display,params:n.params,isApplicable:e.definition.isApplicable?function(t,n,r){return e.definition.isApplicable(t,r)}:void 0,run:function(t){var n=t.cell,r=t.state,i=t.params,a=r.build().to(n.transform.ref).apply(e,i);return r.updateTree(a)}})},function(e){e.build=function(e){return function(e){return function(n){return t(r({from:e.from instanceof Array?e.from:e.from?[e.from]:[],display:"string"==typeof e.display?{name:e.display}:e.display?e.display:{name:"Unnamed State Action"},params:"object"==typeof e.params?function(){return e.params}:e.params?e.params:void 0,isApplicable:e.isApplicable},"function"==typeof n?{run:n}:n))}}(e)}}(n=e.Builder||(e.Builder={})),e.build=n.build}(i||(i={})),t.StateAction=i},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(74),a=n(100),o=n(264),u=n(149),s=n(187),c=function(){function e(e){this.tree=e,this.transforms=this.tree.transforms,this.children=this.tree.children,this.cellStates=this.tree.cellStates,this.changedNodes=!1,this.changedChildren=!1,this.changedStates=!1,this._childMutations=void 0}return Object.defineProperty(e.prototype,"childMutations",{get:function(){return this._childMutations?this._childMutations:(this._childMutations=new Map,this._childMutations)},enumerable:!0,configurable:!0}),e.prototype.changeStates=function(){this.changedStates||(this.changedStates=!0,this.cellStates=this.cellStates.asMutable())},e.prototype.changeNodes=function(){this.changedNodes||(this.changedNodes=!0,this.transforms=this.transforms.asMutable())},e.prototype.changeChildren=function(){this.changedChildren||(this.changedChildren=!0,this.children=this.children.asMutable())},Object.defineProperty(e.prototype,"root",{get:function(){return this.transforms.get(a.StateTransform.RootRef)},enumerable:!0,configurable:!0}),e.prototype.asTransient=function(){return this.asImmutable().asTransient()},e.prototype.addChild=function(e,t){if(this.changeChildren(),this.childMutations.has(e))this.childMutations.get(e).add(t);else{var n=this.children.get(e).asMutable();n.add(t),this.children.set(e,n),this.childMutations.set(e,n)}},e.prototype.removeChild=function(e,t){if(this.changeChildren(),this.childMutations.has(e))this.childMutations.get(e).remove(t);else{var n=this.children.get(e).asMutable();n.remove(t),this.children.set(e,n),this.childMutations.set(e,n)}},e.prototype.clearRoot=function(){var e=a.StateTransform.RootRef;if(0!==this.children.get(e).size){this.changeChildren();var t=i.OrderedSet();this.children.set(e,t),this.childMutations.set(e,t)}},e.prototype.changeParent=function(e,t){f(this.transforms,e);var n=this.transforms.get(e);this.removeChild(n.parent,e),this.addChild(t,e),this.changeNodes(),this.transforms.set(e,a.StateTransform.withParent(n,t))},e.prototype.updateVersion=function(e){f(this.transforms,e);var t=this.transforms.get(e);this.changeNodes(),this.transforms.set(e,a.StateTransform.withNewVersion(t))},e.prototype.add=function(e,t){var n=e.ref;this.transforms.has(e.ref)&&(this.transforms.get(e.ref).parent!==e.parent&&function(e){throw new Error("Transform '"+e+"' is already present in the tree.")}(e.ref));var a=this.children.get(e.parent);return a||function(e){throw new Error("Parent '"+e+"' must be present in the tree.")}(e.parent),a.has(e.ref)||this.addChild(e.parent,e.ref),this.children.has(e.ref)||(this.changedChildren||(this.changedChildren=!0,this.children=this.children.asMutable()),this.children.set(e.ref,i.OrderedSet())),this.changeNodes(),this.transforms.set(n,e),this.cellStates.has(n)||(this.changeStates(),u.StateObjectCell.isStateChange(u.StateObjectCell.DefaultState,t)?this.cellStates.set(n,r({},u.StateObjectCell.DefaultState,t)):this.cellStates.set(n,u.StateObjectCell.DefaultState)),this},e.prototype.setParams=function(e,t){f(this.transforms,e);var n=this.transforms.get(e);return!s.shallowEqual(n.params,t)&&(this.changedNodes||(this.changedNodes=!0,this.transforms=this.transforms.asMutable()),this.transforms.set(n.ref,a.StateTransform.withParams(n,t)),!0)},e.prototype.updateCellState=function(e,t){f(this.transforms,e);var n=this.cellStates.get(e);return!!u.StateObjectCell.isStateChange(n,t)&&(this.changeStates(),this.cellStates.set(e,r({},n,t)),!0)},e.prototype.remove=function(e){var t=this.transforms.get(e);if(!t)return[];var n=o.StateTree.subtreePostOrder(this,t);if(e===a.StateTransform.RootRef){if(n.pop(),0===n.length)return n;this.clearRoot()}else{if(0===n.length)return n;this.removeChild(t.parent,t.ref)}this.changeNodes(),this.changeChildren(),this.changeStates();for(var r=0,i=n;r<i.length;r++){var u=i[r];this.transforms.delete(u.ref),this.children.delete(u.ref),this.cellStates.delete(u.ref),this._childMutations&&this._childMutations.delete(u.ref)}return n},e.prototype.asImmutable=function(){return this.changedNodes||this.changedChildren||this.changedStates||this._childMutations?(this._childMutations&&this._childMutations.forEach(l,this.children),o.StateTree.create(this.changedNodes?this.transforms.asImmutable():this.transforms,this.changedChildren?this.children.asImmutable():this.children,this.changedStates?this.cellStates.asImmutable():this.cellStates)):this.tree},e}();function l(e,t){this.set(t,e.asImmutable())}function f(e,t){if(!e.has(t))throw new Error("Node '"+t+"' is not present in the tree.")}t.TransientTree=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(209),a=n(100);!function(e){function t(e,t){return n(e)(t)}function n(e){var t=e||r.root;return void 0!==t.compile?t.compile():function(e){return void 0!==e.transform&&void 0!==e.status}(t)?r.byValue(t).compile():function(e){return"function"==typeof e}(t)?t:r.byRef(t).compile()}e.select=t,e.compile=n;var r,o={select:function(e){return t(this,e||this.state)}};function u(e,t){o[e]=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return t.call.apply(t,[void 0,this].concat(e))}}function s(e){return Object.create(o,{compile:{writable:!1,configurable:!1,value:e}})}function c(e,t){var r=n(e);return s(function(){return function(e){for(var n=[],i=0,a=r(e);i<a.length;i++)for(var o=a[i],u=0,s=t(o,e);u<s.length;u++){var c=s[u];n.push(c)}return n}})}function l(e,t){var r=n(e);return s(function(){return function(e){for(var n=[],i=0,a=r(e);i<a.length;i++){var o=a[i],u=t(o,e);u&&n.push(u)}return n}})}function f(e){var t=n(e);return s(function(){return function(e){for(var n=new Set,r=[],i=0,a=t(e);i<a.length;i++){var o=a[i];o&&(n.has(o.transform.ref)||(n.add(o.transform.ref),r.push(o)))}return r}})}function d(e){var t=n(e);return s(function(){return function(e){var n=t(e);return n.length?[n[0]]:[]}})}function p(e,t){return c(e,function(e){return t(e)?[e]:[]})}function h(e,t){return p(e,function(e){return e.status===t})}function m(e){return c(e,function(e,t){var n=[];return i.StateTree.doPreOrder(t.tree,t.tree.transforms.get(e.transform.ref),n,function(e,t,n){n.push(e.ref)}),n.map(function(e){return t.cells.get(e)})})}function y(e){return c(e,function(e,t){var n=[];return t.tree.children.get(e.transform.ref).forEach(function(e){return n.push(t.cells.get(e))}),n})}function v(e,t){return p(e,function(e){return!!e.obj&&e.obj.type===t.type})}function b(e,t){return f(l(e,function(e,n){return S(n.tree,n.cells,e.transform.ref,t)}))}function g(e,t){return f(l(e,function(e,n){return C(n.tree,n.cells,e.transform.ref,t)}))}function _(e){return f(l(e,function(e,t){return t.cells.get(t.tree.transforms.get(e.transform.ref).parent)}))}function S(e,t,n,r){for(var i=e.transforms.get(n),o=r.length;;){i=e.transforms.get(i.parent);var u=t.get(i.ref);if(!u.obj)return;for(var s=u.obj,c=0;c<o;c++)if(s.type===r[c].type)return t.get(i.ref);if(i.ref===a.StateTransform.RootRef)return}}function C(t,n,r,i){for(var a,o=r;;){var u=e.findAncestorOfType(t,n,o,i);if(!u)break;a=u,o=u.transform.ref}return a}!function(e){function t(e,t,n){var r=n.cells.get(e.ref);return!r||!r.obj||r.obj.type!==n.type||(n.roots.push(r),!1)}function n(e,t,n){var r=n.cells.get(e.ref);return r&&r.obj&&r.obj.type===n.type&&n.ret.push(r),!0}e.root=s(function(){return function(e){return[e.cells.get(e.tree.root.ref)]}}),e.byRef=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return s(function(){return function(t){for(var n=[],r=0,i=e;r<i.length;r++){var a=i[r],o=t.cells.get(a);o&&n.push(o)}return n}})},e.byValue=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return s(function(){return function(t){return e}})},e.rootsOfType=function(e){return s(function(){return function(n){var r={roots:[],cells:n.cells,type:e.type};return i.StateTree.doPreOrder(n.tree,n.tree.root,r,t),r.roots}})},e.ofType=function(e){return s(function(){return function(t){var r={ret:[],cells:t.cells,type:e.type};return i.StateTree.doPreOrder(t.tree,t.tree.root,r,n),r.ret}})}}(r=e.Generators||(e.Generators={})),u("flatMap",c),e.flatMap=c,u("mapEntity",l),e.mapEntity=l,u("unique",f),e.unique=f,u("first",d),e.first=d,u("filter",p),e.filter=p,u("withStatus",h),e.withStatus=h,u("subtree",m),e.subtree=m,u("children",y),e.children=y,u("ofType",v),e.ofType=v,u("ancestorOfType",b),e.ancestorOfType=b,u("rootOfType",g),e.rootOfType=g,u("parent",_),e.parent=_,e.findAncestorOfType=S,e.findRootOfType=C}(r||(r={})),t.StateSelection=r},function(e,t,n){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.is=function(e){return!!e&&"function"==typeof e.getTree},e.isTo=function(e){return!!e&&"function"==typeof e.getTree&&"string"==typeof e.ref};var t=function(){function e(e){this.state={tree:e.asTransient(),editInfo:{sourceTree:e,count:0,lastUpdate:void 0}}}return Object.defineProperty(e.prototype,"editInfo",{get:function(){return this.state.editInfo},enumerable:!0,configurable:!0}),e.prototype.to=function(e){return new n(this.state,e,this)},e.prototype.toRoot=function(){return new n(this.state,this.state.tree.root.ref,this)},e.prototype.delete=function(e){return this.editInfo.count++,this.state.tree.remove(e),this},e.prototype.getTree=function(){return this.state.tree.asImmutable()},e}();e.Root=t;var n=function(){function e(e,t,n){if(this.state=e,this.root=n,this.ref=t,!this.state.tree.transforms.has(t))throw new Error("Could not find node '"+t+"'.")}return Object.defineProperty(e.prototype,"editInfo",{get:function(){return this.state.editInfo},enumerable:!0,configurable:!0}),e.prototype.apply=function(t,n,r,i){var a=t.apply(this.ref,n,r);return this.state.tree.add(a,i),this.editInfo.count++,this.editInfo.lastUpdate=a.ref,new e(this.state,a.ref,this.root)},e.prototype.insert=function(t,n,r,i){var a=this.state.tree.children.get(this.ref).toArray(),o=t.apply(this.ref,n,r);this.state.tree.add(o,i);for(var u=0,s=a;u<s.length;u++){var c=s[u];this.state.tree.changeParent(c,o.ref)}return this.editInfo.count++,this.editInfo.lastUpdate=o.ref,new e(this.state,o.ref,this.root)},e.prototype.update=function(e,t){var n;t?n=t(this.state.tree.transforms.get(this.ref).params):n=e;return this.state.tree.setParams(this.ref,n)&&(this.editInfo.count++,this.editInfo.lastUpdate=this.ref),this.root},e.prototype.to=function(e){return this.root.to(e)},e.prototype.toRoot=function(){return this.root.toRoot()},e.prototype.delete=function(e){return this.root.delete(e)},e.prototype.getTree=function(){return this.state.tree.asImmutable()},e}();e.To=n}(r||(r={})),t.StateBuilder=r},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{s(r.next(e))}catch(e){a(e)}}function u(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,u)}s((r=r.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(45),u=n(99),s=n(7);function c(e){return new l(r({isImmediate:!1},e))}t.PluginCommand=c;var l=function(){function e(e){this.params=e,this.id=s.UUID.create22()}return e.prototype.dispatch=function(e,t){return e.commands.dispatch(this,t)},e.prototype.subscribe=function(e,t){return e.commands.subscribe(this,t)},e}();!function(e){var t=function(){function e(){this.subs=new Map,this.queue=o.LinkedList(),this.disposing=!1,this.ev=u.RxEventHelper.create(),this.behaviour={locked:this.ev.behavior(!1)},this.executing=!1}return e.prototype.lock=function(e){void 0===e&&(e=!0),this.behaviour.locked.next(e)},e.prototype.subscribe=function(e,t){var n=this,r=this.subs.get(e.id);return r||(r=[],this.subs.set(e.id,r)),r.push(t),{unsubscribe:function(){var r=n.subs.get(e.id);if(r){var i=r.indexOf(t);if(!(i<0)){for(var a=i+1;a<r.length;a++)r[a-1]=r[a];r.pop()}}}}},e.prototype.dispatch=function(e,t){var n=this;return new Promise(function(r,i){if(n.disposing)i("disposed");else if(n.subs.get(e.id)){var a={cmd:e,params:t,resolve:r,reject:i};e.params.isImmediate?n.resolve(a):(n.queue.addLast({cmd:e,params:t,resolve:r,reject:i}),n.next())}else r()})},e.prototype.dispose=function(){for(this.subs.clear();this.queue.count>0;)this.queue.removeFirst()},e.prototype.resolve=function(e){return i(this,void 0,void 0,function(){var t,n,r,i;return a(this,function(a){switch(a.label){case 0:if(!(t=this.subs.get(e.cmd.id))){try{e.resolve()}finally{e.cmd.params.isImmediate||this.disposing||this.next()}return[2]}a.label=1;case 1:a.trys.push([1,6,7,8]),e.cmd.params.isImmediate||(this.executing=!0),n=0,r=t,a.label=2;case 2:return n<r.length?[4,(0,r[n])(e.params)]:[3,5];case 3:a.sent(),a.label=4;case 4:return n++,[3,2];case 5:return e.resolve(),[3,8];case 6:return i=a.sent(),e.reject(i),[3,8];case 7:return e.cmd.params.isImmediate||(this.executing=!1,this.disposing||this.next()),[7];case 8:return[2]}})})},e.prototype.next=function(){return i(this,void 0,void 0,function(){var e;return a(this,function(t){return 0===this.queue.count||this.executing?[2]:(e=this.queue.removeFirst(),this.resolve(e),[2])})})},e}();e.Manager=t}(c||(c={})),t.PluginCommand=c},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var a=n(74),o=n(7),u=function(e){function t(){var t=e.call(this,{entries:a.OrderedMap()})||this;return t.events={changed:t.ev()},t}return i(t,e),t.prototype.getEntry=function(e){return this.state.entries.get(e)},t.prototype.remove=function(e){this.state.entries.has(e)&&(this.updateState({entries:this.state.entries.delete(e)}),this.events.changed.next())},t.prototype.add=function(e){this.updateState({entries:this.state.entries.set(e.id,e)}),this.events.changed.next()},t.prototype.clear=function(){0!==this.state.entries.size&&(this.updateState({entries:a.OrderedMap()}),this.events.changed.next())},t}(n(152).PluginComponent);t.PluginStateSnapshotManager=u,function(e){e.Entry=function(e,t,n){return{id:o.UUID.create22(),timestamp:(new Date).toLocaleString(),name:t,snapshot:e,description:n}}}(u||(u={})),t.PluginStateSnapshotManager=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.dateToUtcString=function(e){return e.toISOString().replace(/T/," ").replace(/\..+/,"")},t.getFormattedTime=function(){var e=new Date;return e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate()+"-"+e.getHours()+"-"+e.getMinutes()+"-"+e.getSeconds()}},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var a=n(74),o=n(7),u=function(e){function t(){var t=e.call(this,{entries:a.OrderedMap()})||this;return t.events={changed:t.ev()},t}return i(t,e),t.prototype.getEntry=function(e){return this.state.entries.get(e)},t.prototype.remove=function(e){this.state.entries.has(e)&&(this.updateState({entries:this.state.entries.delete(e)}),this.events.changed.next())},t.prototype.add=function(e){this.updateState({entries:this.state.entries.set(e.id,e)}),this.events.changed.next()},t.prototype.clear=function(){0!==this.state.entries.size&&(this.updateState({entries:a.OrderedMap()}),this.events.changed.next())},t.prototype.getStateSnapshot=function(){var e=[];return this.state.entries.forEach(function(t){return e.push(t)}),{entries:e}},t.prototype.setStateSnapshot=function(e){for(var t=a.OrderedMap().asMutable(),n=0,r=e.entries;n<r.length;n++){var i=r[n];t.set(i.id,i)}this.updateState({entries:t.asImmutable()}),this.events.changed.next()},t}(n(152).PluginComponent);t.CameraSnapshotManager=u,function(e){e.Entry=function(e,t,n){return{id:o.UUID.create22(),timestamp:(new Date).toLocaleString(),name:t,snapshot:e,description:n}}}(u||(u={})),t.CameraSnapshotManager=u},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var a=n(51),o=n(2),u=n(16),s=n(274),c=n(26),l=n(27),f=n(480),d=n(3),p=n(85);t.HighlightLoci=p.PluginBehavior.create({name:"representation-highlight-loci",category:"interaction",ctor:function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.register=function(){var e=this,t=u.EmptyLoci,n=void 0;this.subscribeObservable(this.ctx.behaviors.canvas.highlightLoci,function(r){e.ctx.canvas3d&&(r.repr===n&&u.Loci.areEqual(r.loci,t)||(e.ctx.canvas3d.mark(t,a.MarkerAction.RemoveHighlight,n),e.ctx.canvas3d.mark(r.loci,a.MarkerAction.Highlight,r.repr),t=r.loci,n=r.repr))})},t}(p.PluginBehavior.Handler),display:{name:"Highlight Loci on Canvas",group:"Representation"}}),t.SelectLoci=p.PluginBehavior.create({name:"representation-select-loci",category:"interaction",ctor:function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.register=function(){var e=this,t=u.EmptyLoci,n=void 0;this.subscribeObservable(this.ctx.behaviors.canvas.selectLoci,function(r){e.ctx.canvas3d&&(r.repr===n&&u.Loci.areEqual(r.loci,t)?e.ctx.canvas3d.mark(r.loci,a.MarkerAction.Toggle):(e.ctx.canvas3d.mark(t,a.MarkerAction.Deselect,n),e.ctx.canvas3d.mark(r.loci,a.MarkerAction.Select,r.repr),t=r.loci,n=r.repr))})},t}(p.PluginBehavior.Handler),display:{name:"Select Loci on Canvas",group:"Representation"}}),t.DefaultLociLabelProvider=p.PluginBehavior.create({name:"default-loci-label-provider",category:"interaction",ctor:function(){function e(e){this.ctx=e,this.f=f.labelFirst}return e.prototype.register=function(){this.ctx.lociLabels.addProvider(this.f)},e.prototype.unregister=function(){this.ctx.lociLabels.removeProvider(this.f)},e}(),display:{name:"Provide Default Loci Label",group:"Representation"}}),function(e){e.Params={t:d.ParamDefinition.Numeric(0,{min:0,max:1,step:.01})};var t=function(){function e(e,t){this.ctx=e,this.params=t,this.currentT=0,this.centerVec=o.Vec3.zero(),this.transVec=o.Vec3.zero(),this.transMat=o.Mat4.zero(),this.repr=new l.StateObjectTracker(e.state.dataState),this.structure=new l.StateObjectTracker(e.state.dataState)}return e.prototype.updateData=function(){var e=this.repr.update(),t=this.structure.update();return t&&this.structure.data&&(this.transforms=new s.StructureUnitTransforms(this.structure.data)),e||t},e.prototype.register=function(e){this.repr.setQuery(l.StateSelection.Generators.byRef(e).ancestorOfType([c.PluginStateObject.Molecule.Representation3D])),this.structure.setQuery(l.StateSelection.Generators.byRef(e).rootOfType([c.PluginStateObject.Molecule.Structure])),this.update(this.params)},e.prototype.update=function(e){if(!this.updateData()&&e.t===this.currentT)return!1;if(this.currentT=e.t,!this.structure.data||!this.repr.data)return!0;for(var t=this.structure.data,n=t.boundary.sphere,r=n.radius*e.t,i=0,a=t.units.length;i<a;i++){var u=t.units[i];o.Vec3.transformMat4(this.centerVec,u.lookup3d.boundary.sphere.center,u.conformation.operator.matrix),o.Vec3.sub(this.transVec,this.centerVec,n.center),o.Vec3.setMagnitude(this.transVec,this.transVec,r),o.Mat4.fromTranslation(this.transMat,this.transVec),this.transforms.setTransform(this.transMat,u)}return this.repr.data.setState({unitTransforms:this.transforms}),this.ctx.canvas3d.add(this.repr.data),this.ctx.canvas3d.requestDraw(!0),!0},e.prototype.unregister=function(){this.update({t:0}),this.repr.cell=void 0,this.structure.cell=void 0},e}();e.Behavior=t;var n=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t}(c.PluginStateObject.CreateBehavior({name:"Explode Representation3D Behavior"}));e.Obj=n}(t.ExplodeRepresentation3D||(t.ExplodeRepresentation3D={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),i=n(5),a=n(82),o=function(){function e(e){this.structure=e,this.groupUnitTransforms=[],this.unitOffsetMap=i.IntMap.Mutable(),this.groupIndexMap=i.IntMap.Mutable(),this.unitTransforms=new Float32Array(16*e.units.length),a.fillIdentityTransform(this.unitTransforms,e.units.length);for(var t=0,n=0,r=e.unitSymmetryGroups.length;n<r;++n){var o=e.unitSymmetryGroups[n];this.groupIndexMap.set(o.hashCode,n);var u=this.unitTransforms.subarray(t,t+16*o.units.length);this.groupUnitTransforms.push(u);for(var s=0,c=o.units.length;s<c;++s)this.unitOffsetMap.set(o.units[s].id,t+16*s);t+=16*o.units.length}}return e.prototype.setTransform=function(e,t){r.Mat4.toArray(e,this.unitTransforms,this.unitOffsetMap.get(t.id))},e.prototype.getTransform=function(e,t){return r.Mat4.fromArray(e,this.unitTransforms,this.unitOffsetMap.get(t.id))},e.prototype.getSymmetryGroupTransforms=function(e){return this.groupUnitTransforms[this.groupIndexMap.get(e.hashCode)]},e}();t.StructureUnitTransforms=o},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{s(r.next(e))}catch(e){a(e)}}function u(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,u)}s((r=r.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}};Object.defineProperty(t,"__esModule",{value:!0});var o,u=n(21),s=n(210),c=n(485),l=n(44),f=n(9),d=n(201),p=n(155),h=n(212),m=n(213),y=n(279),v=n(11);!function(e){function t(e){return e._dynamicPropertyData.__PDBeStructureQualityReport__}function n(e,t){e._dynamicPropertyData.__PDBeStructureQualityReport__=t}e.get=t,e.Schema={pdbe_structure_quality_report:{updated_datetime_utc:u.Column.Schema.str},pdbe_structure_quality_report_issues:r({id:u.Column.Schema.int},c.mmCIF_residueId_schema,{pdbx_PDB_model_num:u.Column.Schema.int,issue_type_group_id:u.Column.Schema.int}),pdbe_structure_quality_report_issue_types:{group_id:u.Column.Schema.int,issue_type:u.Column.Schema.str}},e.Descriptor=f.ModelPropertyDescriptor({isStatic:!1,name:"pdbe_structure_quality_report",cifExport:{prefix:"pdbe",context:function(e){return g(e)},categories:[y.PropertyWrapper.defaultInfoCategory("pdbe_structure_quality_report",function(e){return e.info}),{name:"pdbe_structure_quality_report_issues",instance:function(e){return{fields:b,source:e.models.map(function(e){return{data:e,rowCount:e.elements.length}})}}},{name:"pdbe_structure_quality_report_issue_types",instance:function(e){return l.CifWriter.Category.ofTable(e.issueTypes)}}]},symbols:{issueCount:m.QuerySymbolRuntime.Dynamic(p.CustomPropSymbol("pdbe","structure-quality.issue-count",h.default.Num),function(t){return e.getIssues(t.element).length})}}),e.createAttachTask=function(r,o){var u=this;return function(s){return v.Task.create("PDBe Structure Quality Report",function(c){return i(u,void 0,void 0,function(){var i,u,l,f,d;return a(this,function(a){switch(a.label){case 0:return t(s)?[2,!0]:(l=r(s),[4,o(l,"string").runInContext(c)]);case 1:return f=a.sent(),(d=JSON.parse(f)[s.label.toLowerCase()])?(u=y.PropertyWrapper.createInfo(),i=_(s,d),s.customProperties.add(e.Descriptor),n(s,{info:u,data:i}),[2,!1]):[2,!1]}})})})}},e.attachFromCifOrApi=function(r,o){return i(this,void 0,void 0,function(){var i,u,c;return a(this,function(a){switch(a.label){case 0:return t(r)?[2,!0]:(u=y.PropertyWrapper.tryGetInfoFromCif("pdbe_structure_quality_report",r))?(c=function(t){if("mmCIF"!==t.sourceData.kind)throw new Error("Data format must be mmCIF.");return{residues:s.toTable(e.Schema.pdbe_structure_quality_report_issues,t.sourceData.frame.categories.pdbe_structure_quality_report_issues),groups:s.toTable(e.Schema.pdbe_structure_quality_report_issue_types,t.sourceData.frame.categories.pdbe_structure_quality_report_issue_types)}}(r),i=function(e,t,n){for(var r=new Map,i=t.label_entity_id,a=t.label_asym_id,o=t.auth_seq_id,u=t.pdbx_PDB_ins_code,s=t.issue_type_group_id,c=t.pdbx_PDB_model_num,l=t._rowCount,d=function(e){for(var t=new Map,n=e.group_id,r=e.issue_type,i=0;i<e._rowCount;i++){var a=void 0,o=n.value(i);t.has(o)?a=t.get(o):(a=[],t.set(o,a)),a.push(r.value(i))}return t}(n),p=0;p<l;p++)if(c.value(p)===e.modelNum){var h=e.atomicHierarchy.index.findResidue(i.value(p),a.value(p),o.value(p),u.value(p));r.set(h,d.get(s.value(p)))}return f.IndexedCustomProperty.fromResidueMap(r)}(r,c.residues,c.groups),[3,4]):[3,1];case 1:return o.PDBe_apiSourceJson?[4,o.PDBe_apiSourceJson(r)]:[3,3];case 2:return(c=a.sent())?(u=y.PropertyWrapper.createInfo(),i=_(r,c),[3,4]):[2,!1];case 3:return[2,!1];case 4:return r.customProperties.add(e.Descriptor),n(r,{info:u,data:i}),[2,!0]}})})},e.getIssueMap=function(e){var n=t(e);return n&&n.data};var o=[];e.getIssues=function(t){if(!f.Unit.isAtomic(t.unit))return o;var n=e.get(t.unit.model);if(!n||!n.data)return o;var r=t.unit.residueIndex[t.element];return n.data.has(r)?n.data.get(r):o}}(o=t.StructureQualityReport||(t.StructureQualityReport={}));var b=l.CifWriter.fields().index("id").many(d.residueIdFields(function(e,t){return t.elements[e]},{includeModelNum:!0})).int("issue_type_group_id",function(e,t){return t.groupId[e]}).getFields();function g(e){for(var t=new Map,n=[],r=[],i=[],a=y.PropertyWrapper.createInfo(),s=0,c=e.structures;s<c.length;s++){var l=c[s],f=o.get(l.model);if(f&&(a=f.info),f&&f.data){var d=f.data.getElements(l),p=d.elements,h=d.property;if(0!==p.length){for(var m=[],v=0;v<p.length;v++){var b=h(v),g=b.join(",");if(!t.has(g)){var _=t.size+1;t.set(g,_);for(var S=0,C=b;S<C.length;S++){var x=C[S];r.push(_),i.push(x)}}m[v]=t.get(g)}n.push({elements:p,groupId:m})}}}return{info:a,models:n,issueTypes:u.Table.ofArrays(o.Schema.pdbe_structure_quality_report_issue_types,{group_id:r,issue_type:i})}}function _(e,t){var n=new Map;if(t.molecules){for(var r=0,i=t.molecules;r<i.length;r++)for(var a=i[r],o=a.entity_id.toString(),u=0,s=a.chains;u<s.length;u++)for(var c=s[u],l=c.struct_asym_id.toString(),d=0,p=c.models;d<p.length;d++){var h=p[d];if(+h.model_id.toString()===e.modelNum)for(var m=0,y=h.residues;m<y.length;m++){var v=y[m],b=v.author_residue_number,g=v.author_insertion_code||"",_=e.atomicHierarchy.index.findResidue(o,l,b,g);n.set(_,v.outlier_types)}}return f.IndexedCustomProperty.fromResidueMap(n)}}},function(e,t,n){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),function(e){function t(e){return!!e&&!!e.head&&"object"==typeof e}function n(e){return!!e&&"string"==typeof e.name}e.Symbol=function(e){return{name:e}},e.Apply=function(e,t){return t?{head:e,args:t}:{head:e}},e.isArgumentsArray=function(e){return!!e&&Array.isArray(e)},e.isArgumentsMap=function(e){return!!e&&!Array.isArray(e)},e.isLiteral=function(e){return!t(e)&&!n(e)},e.isApply=t,e.isSymbol=n}(r||(r={})),t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(278),i=n(487),a=n(214),o={core:r.default,structureQuery:i.default};t.MolScriptSymbolTable=o,a.normalizeTable(o),t.SymbolList=a.symbolList(o),t.SymbolMap=function(){for(var e=Object.create(null),n=0,r=t.SymbolList;n<r.length;n++){var i=r[n];e[i.id]=i}return e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(212),a=n(155),o=n(214);function u(e,t){return o.symbol(a.Arguments.Dictionary({0:a.Argument(e)}),e,t)}function s(e,t){return o.symbol(a.Arguments.List(e,{nonEmpty:!0}),e,t)}function c(e,t,n){return o.symbol(a.Arguments.Dictionary({0:a.Argument(e),1:a.Argument(e)}),t,n)}!function(e){e.AnyVar=i.default.Variable("a",i.default.Any),e.AnyValueVar=i.default.Variable("a",i.default.Any),e.ConstrainedVar=i.default.Variable("a",i.default.Any,!0),e.Regex=i.default.Value("Core","Regex"),e.Set=function(t){return i.default.Container("Core","Set",t||e.AnyValueVar)},e.List=function(t){return i.default.Container("Core","List",t||e.AnyVar)},e.Fn=function(t,n){return i.default.Container("Core","Fn",t||e.AnyVar,n)},e.Flags=function(e,t){return i.default.Container("Core","Flags",e,t)},e.BitFlags=e.Flags(i.default.Num,"BitFlags")}(r=t.Types||(t.Types={})),t.TTargs=a.Arguments.Dictionary({0:a.Argument(i.default.Num),1:a.Argument(i.default.Num)});a.Argument(i.default.Str);var l={"@header":"Language Primitives",type:{"@header":"Types",bool:o.symbol(a.Arguments.Dictionary({0:a.Argument(i.default.AnyValue)}),i.default.Bool,"Convert a value to boolean."),num:o.symbol(a.Arguments.Dictionary({0:a.Argument(i.default.AnyValue)}),i.default.Num,"Convert a value to number."),str:o.symbol(a.Arguments.Dictionary({0:a.Argument(i.default.AnyValue)}),i.default.Str,"Convert a value to string."),regex:o.symbol(a.Arguments.Dictionary({0:a.Argument(i.default.Str,{description:"Expression"}),1:a.Argument(i.default.Str,{isOptional:!0,description:"Flags, e.g. 'i' for ignore case"})}),r.Regex,"Creates a regular expression from a string using the ECMAscript syntax."),list:o.symbol(a.Arguments.List(r.AnyVar),r.List()),set:o.symbol(a.Arguments.List(r.AnyValueVar),r.Set()),bitflags:o.symbol(a.Arguments.Dictionary({0:a.Argument(i.default.Num)}),r.BitFlags,"Interpret a number as bitflags."),compositeKey:o.symbol(a.Arguments.List(i.default.AnyValue),i.default.AnyValue)},logic:{"@header":"Logic",not:u(i.default.Bool),and:s(i.default.Bool),or:s(i.default.Bool)},ctrl:{"@header":"Control",eval:o.symbol(a.Arguments.Dictionary({0:a.Argument(r.Fn(r.AnyVar))}),r.AnyVar,"Evaluate a function."),fn:o.symbol(a.Arguments.Dictionary({0:a.Argument(r.AnyVar)}),r.Fn(r.AnyVar),'Wrap an expression to a "lazy" function.'),if:o.symbol(a.Arguments.Dictionary({0:a.Argument(i.default.Bool,{description:"Condition"}),1:a.Argument(i.default.Variable("a",i.default.Any),{description:"If true"}),2:a.Argument(i.default.Variable("b",i.default.Any),{description:"If false"})}),i.default.Union([i.default.Variable("a",i.default.Any),i.default.Variable("b",i.default.Any)])),assoc:o.symbol(a.Arguments.Dictionary({0:a.Argument(i.default.Str,{description:"Name"}),1:a.Argument(i.default.Variable("a",i.default.Any),{description:"Value to assign"})}),i.default.Variable("a",i.default.Any))},rel:{"@header":"Relational",eq:c(i.default.Variable("a",i.default.AnyValue,!0),i.default.Bool),neq:c(i.default.Variable("a",i.default.AnyValue,!0),i.default.Bool),lt:c(i.default.Num,i.default.Bool),lte:c(i.default.Num,i.default.Bool),gr:c(i.default.Num,i.default.Bool),gre:c(i.default.Num,i.default.Bool),inRange:o.symbol(a.Arguments.Dictionary({0:a.Argument(i.default.Num,{description:"Value to test"}),1:a.Argument(i.default.Num,{description:"Minimum value"}),2:a.Argument(i.default.Num,{description:"Maximum value"})}),i.default.Bool,"Check if the value of the 1st argument is >= 2nd and <= 3rd.")},math:{"@header":"Math",add:s(i.default.Num),sub:s(i.default.Num),mult:s(i.default.Num),div:c(i.default.Num,i.default.Num),pow:c(i.default.Num,i.default.Num),mod:c(i.default.Num,i.default.Num),min:s(i.default.Num),max:s(i.default.Num),floor:u(i.default.Num),ceil:u(i.default.Num),roundInt:u(i.default.Num),abs:u(i.default.Num),sqrt:u(i.default.Num),sin:u(i.default.Num),cos:u(i.default.Num),tan:u(i.default.Num),asin:u(i.default.Num),acos:u(i.default.Num),atan:u(i.default.Num),sinh:u(i.default.Num),cosh:u(i.default.Num),tanh:u(i.default.Num),exp:u(i.default.Num),log:u(i.default.Num),log10:u(i.default.Num),atan2:c(i.default.Num,i.default.Num)},str:{"@header":"Strings",concat:s(i.default.Str),match:o.symbol(a.Arguments.Dictionary({0:a.Argument(r.Regex),1:a.Argument(i.default.Str)}),i.default.Bool)},list:{"@header":"Lists",getAt:o.symbol(a.Arguments.Dictionary({0:a.Argument(r.List()),1:a.Argument(i.default.Num)}),r.AnyVar)},set:{"@header":"Sets",has:o.symbol(a.Arguments.Dictionary({0:a.Argument(r.Set(r.ConstrainedVar)),1:a.Argument(r.ConstrainedVar)}),i.default.Bool,"Check if the the 1st argument includes the value of the 2nd."),isSubset:o.symbol(a.Arguments.Dictionary({0:a.Argument(r.Set(r.ConstrainedVar)),1:a.Argument(r.Set(r.ConstrainedVar))}),i.default.Bool,"Check if the the 1st argument is a subset of the 2nd.")},flags:{"@header":"Flags",hasAny:o.symbol(a.Arguments.Dictionary({0:a.Argument(r.Flags(r.ConstrainedVar)),1:a.Argument(r.Flags(r.ConstrainedVar))}),i.default.Bool,"Check if the the 1st argument has at least one of the 2nd one's flags."),hasAll:o.symbol(a.Arguments.Dictionary({0:a.Argument(r.Flags(r.ConstrainedVar)),1:a.Argument(r.Flags(r.ConstrainedVar))}),i.default.Bool,"Check if the the 1st argument has all 2nd one's flags.")}};o.normalizeTable(l),t.SymbolList=o.symbolList(l),t.SymbolMap=function(){for(var e=Object.create(null),n=0,r=t.SymbolList;n<r.length;n++){var i=r[n];e[i.id]=i}return e}(),t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(44),a=n(271);!function(e){e.createInfo=function(){return{timestamp_utc:a.dateToUtcString(new Date)}},e.defaultInfoCategory=function(e,n){return{name:e,instance:function(e){var r=n(e);return{fields:t,source:[{data:r,rowCount:1}]}}}};var t=[i.CifWriter.Field.str("updated_datetime_utc",function(e,t){return t.timestamp_utc})];e.tryGetInfoFromCif=function(e,t){if("mmCIF"===t.sourceData.kind&&t.sourceData.frame.categoryNames.includes(e)){var n=t.sourceData.frame.categories[e].getField("updated_datetime_utc");if(n&&0!==n.rowCount)return{timestamp_utc:n.str(0)||a.dateToUtcString(new Date)}}}}(r||(r={})),t.PropertyWrapper=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),i=n(156);function a(e){var t=new Set;return e.forEach(function(e){e.conformation.operator.assembly&&t.add(e.conformation.operator.assembly.id)}),Array.from(t)}t.getAssemblyIds=a,t.getSymmetrySelectParam=function(e){var t=r.ParamDefinition.Select(-1,[[-1,"No Symmetries"]]);if(e&&e.models[0].customProperties.has(i.AssemblySymmetry.Descriptor)){var n=i.AssemblySymmetry.get(e.models[0]),o=a(e.units),u=n.getSymmetries(o);if(u._rowCount){for(var s=[],c=0,l=u._rowCount;c<l;++c)s.push([u.id.value(c),u.assembly_id.value(c)+": "+u.symbol.value(c)+" "+u.kind.value(c)]);s.length&&(t.options=s,t.defaultValue=s[0][0])}}return t}},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var a=n(32),o=n(282),u=n(512),s=function(e){function n(){var n=e.call(this)||this;return Object.keys(t.BuiltInVolumeRepresentations).forEach(function(e){var r=t.BuiltInVolumeRepresentations[e];n.add(e,r)}),n}return i(n,e),n}(a.RepresentationRegistry);t.VolumeRepresentationRegistry=s,t.BuiltInVolumeRepresentations={isosurface:o.IsosurfaceRepresentationProvider,"direct-volume":u.DirectVolumeRepresentationProvider},t.BuiltInVolumeRepresentationsNames=Object.keys(t.BuiltInVolumeRepresentations),t.BuiltInVolumeRepresentationsOptions=t.BuiltInVolumeRepresentationsNames.map(function(e){return[e,e]})},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{s(r.next(e))}catch(e){a(e)}}function u(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,u)}s((r=r.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(86),u=n(283),s=n(16),c=n(3),l=n(29),f=n(208),d=n(36),p=n(32),h=n(71),m=n(122);function y(e){return c.ParamDefinition.Conditioned(e,{absolute:c.ParamDefinition.Converted(function(e){return o.VolumeIsoValue.toAbsolute(e,o.VolumeData.One.dataStats).absoluteValue},function(e){return o.VolumeIsoValue.absolute(e)},c.ParamDefinition.Numeric(.5,{min:-1,max:1,step:.01})),relative:c.ParamDefinition.Converted(function(e){return o.VolumeIsoValue.toRelative(e,o.VolumeData.One.dataStats).relativeValue},function(e){return o.VolumeIsoValue.relative(e)},c.ParamDefinition.Numeric(2,{min:-10,max:10,step:.01}))},function(e){return"absolute"===e.kind?"absolute":"relative"},function(e,t){return"absolute"===t?o.VolumeIsoValue.toAbsolute(e,o.VolumeData.One.dataStats):o.VolumeIsoValue.toRelative(e,o.VolumeData.One.dataStats)})}function v(e,t,n,r,u){return i(this,void 0,void 0,function(){var n,i;return a(this,function(a){switch(a.label){case 0:return e.runtime.update({message:"Marching cubes..."}),[4,f.computeMarchingCubesMesh({isoLevel:o.VolumeIsoValue.toAbsolute(r.isoValue,t.dataStats).absoluteValue,scalarField:t.data},u).runAsChild(e.runtime)];case 1:return n=a.sent(),i=o.VolumeData.getGridToCartesianTransform(t),e.runtime.update({message:"Transforming mesh..."}),l.Mesh.transformImmediate(n,i),l.Mesh.computeNormalsImmediate(n),[2,n]}})})}function b(){return u.VolumeVisual({defaultProps:c.ParamDefinition.getDefaultValues(t.IsosurfaceMeshParams),createGeometry:v,createLocationIterator:function(e){return d.LocationIterator(1,1,function(){return h.NullLocation})},getLoci:function(){return s.EmptyLoci},mark:function(){return!1},setUpdateState:function(e,t,n){t.isoValue!==n.isoValue&&(e.createGeometry=!0)},geometryUtils:l.Mesh.Utils})}function g(e,t,n,r,u){return i(this,void 0,void 0,function(){var n,i;return a(this,function(a){switch(a.label){case 0:return e.runtime.update({message:"Marching cubes..."}),[4,f.computeMarchingCubesLines({isoLevel:o.VolumeIsoValue.toAbsolute(r.isoValue,t.dataStats).absoluteValue,scalarField:t.data},u).runAsChild(e.runtime)];case 1:return n=a.sent(),i=o.VolumeData.getGridToCartesianTransform(t),m.Lines.transformImmediate(n,i),[2,n]}})})}function _(){return u.VolumeVisual({defaultProps:c.ParamDefinition.getDefaultValues(t.IsosurfaceWireframeParams),createGeometry:g,createLocationIterator:function(e){return d.LocationIterator(1,1,function(){return h.NullLocation})},getLoci:function(){return s.EmptyLoci},mark:function(){return!1},setUpdateState:function(e,t,n){t.isoValue!==n.isoValue&&(e.createGeometry=!0)},geometryUtils:m.Lines.Utils})}t.createIsoValueParam=y,t.IsoValueParam=y(o.VolumeIsoValue.relative(2)),t.VolumeIsosurfaceParams={isoValue:t.IsoValueParam},t.createVolumeIsosurfaceMesh=v,t.IsosurfaceMeshParams=r({},l.Mesh.Params,t.VolumeIsosurfaceParams),t.IsosurfaceMeshVisual=b,t.createVolumeIsosurfaceWireframe=g,t.IsosurfaceWireframeParams=r({},m.Lines.Params,t.VolumeIsosurfaceParams),t.IsosurfaceWireframeVisual=_;var S={solid:function(e,t){return u.VolumeRepresentation("Isosurface mesh",e,t,b)},wireframe:function(e,t){return u.VolumeRepresentation("Isosurface wireframe",e,t,_)}},C=Object.keys(S).map(function(e){return[e,e]});function x(e,n){var r=c.ParamDefinition.clone(t.IsosurfaceParams),i=n.dataStats,a=i.min,u=i.max,s=i.mean,l=i.sigma;return r.isoValue=c.ParamDefinition.Conditioned(o.VolumeIsoValue.relative(2),{absolute:c.ParamDefinition.Converted(function(e){return o.VolumeIsoValue.toAbsolute(e,i).absoluteValue},function(e){return o.VolumeIsoValue.absolute(e)},c.ParamDefinition.Numeric(s,{min:a,max:u,step:l/100})),relative:c.ParamDefinition.Converted(function(e){return o.VolumeIsoValue.toRelative(e,i).relativeValue},function(e){return o.VolumeIsoValue.relative(e)},c.ParamDefinition.Numeric(2,{min:Math.floor((a-s)/l),max:Math.ceil((u-s)/l),step:Math.ceil((u-a)/l)/100}))},function(e){return"absolute"===e.kind?"absolute":"relative"},function(e,t){return"absolute"===t?o.VolumeIsoValue.toAbsolute(e,i):o.VolumeIsoValue.toRelative(e,i)}),r}function w(e,t){return p.Representation.createMulti("Isosurface",e,t,p.Representation.StateBuilder,S)}t.IsosurfaceParams=r({},t.IsosurfaceMeshParams,t.IsosurfaceWireframeParams,{visuals:c.ParamDefinition.MultiSelect(["solid"],C)}),t.getIsosurfaceParams=x,t.IsosurfaceRepresentation=w,t.IsosurfaceRepresentationProvider={label:"Isosurface",description:"Displays an isosurface of volumetric data.",factory:w,getParams:x,defaultValues:c.ParamDefinition.getDefaultValues(t.IsosurfaceParams),defaultColorTheme:"uniform",defaultSizeTheme:"uniform"}},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{s(r.next(e))}catch(e){a(e)}}function u(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,u)}s((r=r.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(11),u=n(32),s=n(125),c=n(86),l=n(16),f=n(70),d=n(3),p=n(51),h=n(79),m=n(5),y=n(123),v=n(7),b=n(53),g=n(39),_=n(59),S=n(82),C=n(124),x=n(58),w=n(72);t.VolumeVisual=function(e){var t,n,r,o,u,d,g,_=e.defaultProps,P=e.createGeometry,T=e.createLocationIterator,A=e.getLoci,E=e.mark,k=e.setUpdateState,I=e.geometryUtils,M=I.updateValues,V=I.updateBoundingSphere,O=I.updateRenderableState,D=y.VisualUpdateState.create(),R=Object.assign({},_),j=b.createEmptyTheme();function N(e){if(D.createNew){if(g=T(o),!e)throw new Error("expected geometry to be given");t=function(e,t,n,r,i){var a=f.Geometry.getUtils(t),o=a.createValues,u=a.createRenderableState,s=o(t,S.createIdentityTransform(),n,r,i),c=u(i);return h.createRenderObject(t.kind,s,c)}(0,e,g,r,n)}else{if(!t)throw new Error("expected renderObject to be available");if(g.reset(),D.createGeometry){if(!e)throw new Error("expected geometry to be given");v.ValueCell.update(t.values.drawCount,f.Geometry.getDrawCount(e)),V(t.values,e)}D.updateSize&&"uSize"in t.values&&w.createSizes(g,r.size,t.values),D.updateColor&&x.createColors(g,r.color,t.values),M(t.values,n),O(t.state,n)}R=n,j=r,u=o,e&&(d=e)}return{get groupCount(){return g?g.count:0},get renderObject(){return t},createOrUpdate:function(e,s,l,f){return void 0===l&&(l={}),i(this,void 0,void 0,function(){var i;return a(this,function(a){return function(e,i,a){if(!a&&!u)throw new Error("missing volume");n=Object.assign({},R,i),r=e,o=a,y.VisualUpdateState.reset(D),t&&u&&c.VolumeData.areEquivalent(o,u)||(D.createNew=!0),D.createNew?D.createGeometry=!0:(k(D,n,R,r,j),C.ColorTheme.areEqual(e.color,j.color)||(D.updateColor=!0),D.createGeometry&&(D.updateColor=!0))}(s,l,f||u),D.createGeometry?[2,(i=P(e,o,r,n,d))instanceof Promise?i.then(N):N(i)]:(N(),[2])})})},getLoci:function(e){return t?A(e,t.id):l.EmptyLoci},mark:function(e,n){if(!t)return!1;var r=t.values.tMarker,i=g.groupCount,a=g.instanceCount;function o(e){var t=m.Interval.start(e),i=m.Interval.end(e);return p.applyMarkerAction(r.ref.value.array,t,i,n)}var u=!1;return(u=l.isEveryLoci(e)?o(m.Interval.ofBounds(0,i*a)):E(e,o))&&v.ValueCell.update(r,r.ref.value),u},setVisibility:function(e){s.Visual.setVisibility(t,e)},setPickable:function(e){s.Visual.setPickable(t,e)},setTransform:function(e,n){s.Visual.setTransform(t,e,n)},destroy:function(){t=void 0}}},t.VolumeParams=r({},_.BaseGeometry.Params),t.VolumeRepresentation=function(e,t,n,r){var s,c,f,p,h=0,m=new g.Subject,y=[],v=u.Representation.createState(),_=b.createEmptyTheme();return{label:e,get groupCount(){return s?s.groupCount:0},get props(){return p},get params(){return f},get state(){return v},get theme(){return _},renderObjects:y,updated:m,createOrUpdate:function(e,u){var l=this;return void 0===e&&(e={}),u&&u!==c&&(f=n(t,u),c=u,p||(p=d.ParamDefinition.getDefaultValues(f))),p=Object.assign({},p,e),o.Task.create("Creating or updating VolumeRepresentation",function(e){return i(l,void 0,void 0,function(){var n;return a(this,function(i){switch(i.label){case 0:return s||(s=r()),(n=s.createOrUpdate({webgl:t.webgl,runtime:e},_,p,u))?[4,n]:[3,2];case 1:i.sent(),i.label=2;case 2:return y.length=0,s&&s.renderObject&&y.push(s.renderObject),m.next(h++),[2]}})})})},setState:function(e){void 0!==e.visible&&s&&s.setVisibility(e.visible),void 0!==e.pickable&&s&&s.setPickable(e.pickable),void 0!==e.transform&&s&&s.setTransform(e.transform),u.Representation.updateState(v,e)},setTheme:function(e){_=e},getLoci:function(e){return s?s.getLoci(e):l.EmptyLoci},mark:function(e,t){return!!s&&s.mark(e,t)},destroy:function(){s&&s.destroy()}}}},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),a=this&&this.__assign||function(){return(a=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var o=n(3),u=n(152),s=n(37);t.PluginLayoutStateParams={isExpanded:o.ParamDefinition.Boolean(!1),showControls:o.ParamDefinition.Boolean(!0)};var c=function(e){function n(n){var r=e.call(this,a({},o.ParamDefinition.getDefaultValues(t.PluginLayoutStateParams),n.spec.initialLayout))||this;return r.context=n,r.events={updated:r.ev()},r.rootState=void 0,s.PluginCommands.Layout.Update.subscribe(n,function(e){return r.updateProps(e.state)}),"undefined"!=typeof document&&(r.expandedViewport=document.createElement("meta"),r.expandedViewport.name="viewport",r.expandedViewport.content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"),r}return i(n,e),n.prototype.updateProps=function(e){var t=!!this.state.isExpanded;this.updateState(e),this.root&&"boolean"==typeof e.isExpanded&&e.isExpanded!==t&&this.handleExpand(),this.events.updated.next()},n.prototype.setProps=function(e){this.updateState(e)},n.prototype.setRoot=function(e){this.root=e,this.state.isExpanded&&this.handleExpand()},n.prototype.getScrollElement=function(){return document.scrollingElement?document.scrollingElement:document.documentElement?document.documentElement:document.body},n.prototype.handleExpand=function(){try{var e=document.getElementsByTagName("body")[0],t=document.getElementsByTagName("head")[0];if(!e||!t)return;if(this.state.isExpanded){for(var n=t.children,r=!1,i=[],a=0;a<n.length;a++)n[a]===this.expandedViewport?r=!0:"viewport"===(n[a].name||"").toLowerCase()&&i.push(n[a]);for(var o=0,u=i;o<u.length;o++){var s=u[o];t.removeChild(s)}r||t.appendChild(this.expandedViewport);var c=e.style,l=(m=this.getScrollElement()).scrollLeft,f=m.scrollTop;this.rootState={top:c.top,bottom:c.bottom,right:c.right,left:c.left,scrollTop:f,scrollLeft:l,position:c.position,overflow:c.overflow,viewports:i,zindex:this.root.style.zIndex,width:c.width,height:c.height,maxWidth:c.maxWidth,maxHeight:c.maxHeight,margin:c.margin,marginLeft:c.marginLeft,marginRight:c.marginRight,marginTop:c.marginTop,marginBottom:c.marginBottom},c.overflow="hidden",c.position="fixed",c.top="0",c.bottom="0",c.right="0",c.left="0",c.width="100%",c.height="100%",c.maxWidth="100%",c.maxHeight="100%",c.margin="0",c.marginLeft="0",c.marginRight="0",c.marginTop="0",c.marginBottom="0"}else{for(n=t.children,a=0;a<n.length;a++)if(n[a]===this.expandedViewport){t.removeChild(this.expandedViewport);break}if(this.rootState){c=e.style;for(var d=this.rootState,p=0,h=d.viewports;p<h.length;p++){s=h[p];t.appendChild(s)}var m;c.top=d.top,c.bottom=d.bottom,c.left=d.left,c.right=d.right,c.width=d.width,c.height=d.height,c.maxWidth=d.maxWidth,c.maxHeight=d.maxHeight,c.margin=d.margin,c.marginLeft=d.marginLeft,c.marginRight=d.marginRight,c.marginTop=d.marginTop,c.marginBottom=d.marginBottom,c.position=d.position,c.overflow=d.overflow,(m=this.getScrollElement()).scrollTop=d.scrollTop,m.scrollLeft=d.scrollLeft,this.rootState=void 0,this.root.style.zIndex=d.zindex}}}catch(e){this.context.log.error("Layout change error, you might have to reload the page."),console.log("Layout change error, you might have to reload the page.",e)}},n}(u.PluginComponent);t.PluginLayout=c},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{s(r.next(e))}catch(e){a(e)}}function u(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,u)}s((r=r.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}},a=this;Object.defineProperty(t,"__esModule",{value:!0});var o=n(86),u=n(27),s=n(11),c=n(35),l=n(514),f=n(3),d=n(26),p=n(157),h=n(160),m=n(293),y=function(){function e(){this._list=[],this._map=new Map,this.add("ccp4",v),this.add("dsn6",b),this.add("dscif",g)}return Object.defineProperty(e.prototype,"default",{get:function(){return this._list[0]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"types",{get:function(){return this._list.map(function(e){return[e.name,e.provider.label]})},enumerable:!0,configurable:!0}),e.prototype.add=function(e,t){this._list.push({name:e,provider:t}),this._map.set(e,t)},e.prototype.remove=function(e){this._list.splice(this._list.findIndex(function(t){return t.name===e}),1),this._map.delete(e)},e.prototype.auto=function(e,t){for(var n=0,r=this.list.length;n<r;++n){var i=this._list[n].provider;if(i.isApplicable(e,t.data))return i}throw new Error("no compatible data format provider available")},e.prototype.get=function(e){if(this._map.has(e))return this._map.get(e);throw new Error("unknown data format name '"+e+"'")},Object.defineProperty(e.prototype,"list",{get:function(){return this._list},enumerable:!0,configurable:!0}),e}();t.DataFormatRegistry=y;var v={label:"CCP4/MRC/BRIX",description:"CCP4/MRC/BRIX",fileExtensions:["ccp4","mrc","map"],isApplicable:function(e,t){return"ccp4"===e.ext||"mrc"===e.ext||"map"===e.ext},getDefaultBuilder:function(e,t,n){return s.Task.create("CCP4/MRC/BRIX default builder",function(e){return r(a,void 0,void 0,function(){var r;return i(this,function(i){switch(i.label){case 0:return r=t.apply(p.StateTransforms.Data.ParseCcp4).apply(p.StateTransforms.Volume.VolumeFromCcp4).apply(p.StateTransforms.Representation.VolumeRepresentation3D),[4,n.updateTree(r).runInContext(e)];case 1:return i.sent(),[2]}})})})}},b={label:"DSN6/BRIX",description:"DSN6/BRIX",fileExtensions:["dsn6","brix"],isApplicable:function(e,t){return"dsn6"===e.ext||"brix"===e.ext},getDefaultBuilder:function(e,t,n){return s.Task.create("DSN6/BRIX default builder",function(e){return r(a,void 0,void 0,function(){var r;return i(this,function(i){switch(i.label){case 0:return r=t.apply(p.StateTransforms.Data.ParseDsn6).apply(p.StateTransforms.Volume.VolumeFromDsn6).apply(p.StateTransforms.Representation.VolumeRepresentation3D),[4,n.updateTree(r).runInContext(e)];case 1:return i.sent(),[2]}})})})}},g={label:"DensityServer CIF",description:"DensityServer CIF",fileExtensions:["cif"],isApplicable:function(e,t){return"cif"===e.ext},getDefaultBuilder:function(e,t,n){return s.Task.create("DensityServer CIF default builder",function(u){return r(a,void 0,void 0,function(){var r,a,s,l,f,d,m,y;return i(this,function(i){switch(i.label){case 0:return r=t.apply(p.StateTransforms.Data.ParseCif),[4,n.updateTree(r).runInContext(u)];case 1:if(a=i.sent(),s=n.build().to(r.ref),1===(l=a.data.blocks.slice(1)).length)f=s.apply(p.StateTransforms.Volume.VolumeFromDensityServerCif,{blockHeader:l[0].header}).apply(p.StateTransforms.Representation.VolumeRepresentation3D,h.VolumeRepresentation3DHelpers.getDefaultParamsStatic(e,"isosurface",{isoValue:o.VolumeIsoValue.relative(1.5),alpha:.3},"uniform",{value:c.ColorNames.teal}));else{if(2!==l.length)throw new Error("unknown number of blocks");f=s.apply(p.StateTransforms.Volume.VolumeFromDensityServerCif,{blockHeader:l[0].header}).apply(p.StateTransforms.Representation.VolumeRepresentation3D,h.VolumeRepresentation3DHelpers.getDefaultParamsStatic(e,"isosurface",{isoValue:o.VolumeIsoValue.relative(1.5),alpha:.3},"uniform",{value:c.ColorNames.blue})),d=f.to(r.ref).apply(p.StateTransforms.Volume.VolumeFromDensityServerCif,{blockHeader:l[1].header}),m=h.VolumeRepresentation3DHelpers.getDefaultParamsStatic(e,"isosurface",{isoValue:o.VolumeIsoValue.relative(3),alpha:.3},"uniform",{value:c.ColorNames.green}),f=d.apply(p.StateTransforms.Representation.VolumeRepresentation3D,m),y=h.VolumeRepresentation3DHelpers.getDefaultParamsStatic(e,"isosurface",{isoValue:o.VolumeIsoValue.relative(-3),alpha:.3},"uniform",{value:c.ColorNames.red}),f=f.to(d.ref).apply(p.StateTransforms.Representation.VolumeRepresentation3D,y)}return[4,n.updateTree(f).runInContext(u)];case 2:return i.sent(),[2]}})})})}};function _(e){var t=[],n=[["auto","Automatic"]];return e.list.forEach(function(e){var r=e.name,i=e.provider;t.push.apply(t,i.fileExtensions),n.push([r,i.label])}),{extensions:t,options:n}}t.OpenVolume=u.StateAction.build({display:{name:"Open Volume",description:"Load a volume from file and create its default visual"},from:d.PluginStateObject.Root,params:function(e,t){var n=_(t.dataFormat.registry),r=n.extensions,i=n.options;return{file:f.ParamDefinition.File({accept:r.map(function(e){return"."+e}).join(",")}),format:f.ParamDefinition.Select("auto",i),isBinary:f.ParamDefinition.Boolean(!0)}}})(function(e,t){var n=e.params,o=e.state;return s.Task.create("Open Volume",function(e){return r(a,void 0,void 0,function(){var r,a,u,s;return i(this,function(i){switch(i.label){case 0:return r=o.build().toRoot().apply(p.StateTransforms.Data.ReadFile,{file:n.file,isBinary:n.isBinary}),[4,o.updateTree(r).runInContext(e)];case 1:return a=i.sent(),u="auto"===n.format?t.dataFormat.registry.auto(l.getFileInfo(n.file),a):t.dataFormat.registry.get(n.format),s=o.build().to(r.ref),[4,u.getDefaultBuilder(t,s,o).runInContext(e)];case 2:return i.sent(),[2]}})})})});var S=u.StateAction.build({from:d.PluginStateObject.Root,display:{name:"Download Density",description:"Load a density from the provided source and create its default visual."},params:function(e,t){var n=_(t.dataFormat.registry).options;return{source:f.ParamDefinition.MappedStatic("rcsb",{pdbe:f.ParamDefinition.Group({id:f.ParamDefinition.Text("1tqn",{label:"Id"}),type:f.ParamDefinition.Select("2fofc",[["2fofc","2Fo-Fc"],["fofc","Fo-Fc"]])},{isFlat:!0}),"pdbe-emd-ds":f.ParamDefinition.Group({id:f.ParamDefinition.Text("emd-8004",{label:"Id"}),detail:f.ParamDefinition.Numeric(3,{min:0,max:10,step:1},{label:"Detail"})},{isFlat:!0}),"pdbe-xray-ds":f.ParamDefinition.Group({id:f.ParamDefinition.Text("1tqn",{label:"Id"}),detail:f.ParamDefinition.Numeric(3,{min:0,max:10,step:1},{label:"Detail"})},{isFlat:!0}),rcsb:f.ParamDefinition.Group({id:f.ParamDefinition.Text("1tqn",{label:"Id"}),type:f.ParamDefinition.Select("2fofc",[["2fofc","2Fo-Fc"],["fofc","Fo-Fc"]])},{isFlat:!0}),url:f.ParamDefinition.Group({url:f.ParamDefinition.Text(""),isBinary:f.ParamDefinition.Boolean(!1),format:f.ParamDefinition.Select("auto",n)},{isFlat:!0})},{options:[["pdbe","PDBe X-ray maps"],["pdbe-emd-ds","PDBe EMD Density Server"],["pdbe-xray-ds","PDBe X-ray Density Server"],["rcsb","RCSB X-ray maps"],["url","URL"]]})}}})(function(e,t){var n=e.params,o=e.state;return s.Task.create("Download Density",function(e){return r(a,void 0,void 0,function(){var r,a,u,s,c,f;return i(this,function(i){switch(i.label){case 0:switch((r=n.source).name){case"url":a=r.params;break;case"pdbe":a={url:"2fofc"===r.params.type?"http://www.ebi.ac.uk/pdbe/coordinates/files/"+r.params.id.toLowerCase()+".ccp4":"http://www.ebi.ac.uk/pdbe/coordinates/files/"+r.params.id.toLowerCase()+"_diff.ccp4",isBinary:!0,label:"PDBe X-ray map: "+r.params.id};break;case"pdbe-emd-ds":a={url:"https://www.ebi.ac.uk/pdbe/densities/emd/"+r.params.id.toLowerCase()+"/cell?detail="+r.params.detail,isBinary:!0,label:"PDBe EMD Density Server: "+r.params.id};break;case"pdbe-xray-ds":a={url:"https://www.ebi.ac.uk/pdbe/densities/x-ray/"+r.params.id.toLowerCase()+"/cell?detail="+r.params.detail,isBinary:!0,label:"PDBe X-ray Density Server: "+r.params.id};break;case"rcsb":a={url:"2fofc"===r.params.type?"https://edmaps.rcsb.org/maps/"+r.params.id.toLowerCase()+"_2fofc.dsn6":"https://edmaps.rcsb.org/maps/"+r.params.id.toLowerCase()+"_fofc.dsn6",isBinary:!0,label:"RCSB X-ray map: "+r.params.id};break;default:throw new Error(r.name+" not supported.")}return s=o.build().toRoot().apply(p.StateTransforms.Data.Download,a),[4,o.updateTree(s).runInContext(e)];case 1:switch(c=i.sent(),r.name){case"url":a=r.params,u="auto"===r.params.format?t.dataFormat.registry.auto(l.getFileInfo(a.url),c):t.dataFormat.registry.get(r.params.format);break;case"pdbe":u=t.dataFormat.registry.get("ccp4");break;case"pdbe-emd-ds":case"pdbe-xray-ds":u=t.dataFormat.registry.get("dscif");break;case"rcsb":u=t.dataFormat.registry.get("dsn6");break;default:throw new Error(r.name+" not supported.")}return f=o.build().to(s.ref),[4,u.getDefaultBuilder(t,f,o).runInContext(e)];case 2:return i.sent(),[2]}})})})});t.DownloadDensity=S,t.InitVolumeStreaming=u.StateAction.build({display:{name:"Volume Streaming"},from:d.PluginStateObject.Molecule.Structure,params:m.VolumeStreaming.Params})(function(e,t){var n=e.ref,r=e.state,i=e.params,a=r.build().to(n).apply(p.StateTransforms.Volume.VolumeStreamingBehavior,i);return a.apply(p.StateTransforms.Volume.VolumeStreamingVisual,{channel:"2FO-FC",level:"2fo-fc"},{props:{isGhost:!0}}),a.apply(p.StateTransforms.Volume.VolumeStreamingVisual,{channel:"FO-FC",level:"fo-fc(+ve)"},{props:{isGhost:!0}}),a.apply(p.StateTransforms.Volume.VolumeStreamingVisual,{channel:"FO-FC",level:"fo-fc(-ve)"},{props:{isGhost:!0}}),r.updateTree(a)})},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{s(r.next(e))}catch(e){a(e)}}function u(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,u)}s((r=r.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}};Object.defineProperty(t,"__esModule",{value:!0});var a=n(11),o=n(127),u=n(287),s=n(158),c=n(288);function l(e){return r(this,void 0,void 0,function(){var t,n,r,a,o,u;return i(this,function(i){switch(i.label){case 0:return 1024,[4,e.readBuffer(0,1024)];case 1:if(t=i.sent().buffer,"MAP "!==(n=String.fromCharCode(t.readUInt8(208),t.readUInt8(209),t.readUInt8(210),t.readUInt8(211))))throw new Error('ccp4 format error, missing "MAP " string');return r=[t.readUInt8(212),t.readUInt8(213)],a=!0,68!==r[0]&&65!==r[1]&&(a=!1),u=a?function(e){return t.readFloatLE(4*e)}:function(e){return t.readFloatBE(4*e)},[2,{header:{NC:(o=a?function(e){return t.readInt32LE(4*e)}:function(e){return t.readInt32BE(4*e)})(0),NR:o(1),NS:o(2),MODE:o(3),NCSTART:o(4),NRSTART:o(5),NSSTART:o(6),NX:o(7),NY:o(8),NZ:o(9),xLength:u(10),yLength:u(11),zLength:u(12),alpha:u(13),beta:u(14),gamma:u(15),MAPC:o(16),MAPR:o(17),MAPS:o(18),AMIN:u(19),AMAX:u(20),AMEAN:u(21),ISPG:o(22),NSYMBT:o(23),LSKFLG:o(24),SKWMAT:[],SKWTRN:[],userFlag1:o(39),userFlag2:o(40),originX:u(49),originY:u(50),originZ:u(51),MAP:n,MACHST:r,ARMS:u(54)},littleEndian:a}]}})})}function f(e,t,n,a,o,u){return r(this,void 0,void 0,function(){var r,s,l,f,d,h;return i(this,function(i){switch(i.label){case 0:return p(e)?(r=3*o,[4,n.readBuffer(a,t.readBuffer,o,r)]):[3,2];case 1:for(i.sent(),s=new Int8Array(t.valuesBuffer.buffer,r),l=(e.AMAX-e.AMIN)/255,f=.5*(e.AMIN+e.AMAX+l),d=0,h=o;d<h;++d)t.values[d]=l*s[d]+f;return[3,4];case 2:return[4,c.readTypedArray(t,n,a,o,0,u)];case 3:i.sent(),i.label=4;case 4:return[2]}})})}function d(e){switch(e){case 2:return c.TypedArrayValueType.Float32;case 1:return c.TypedArrayValueType.Int16;case 0:return c.TypedArrayValueType.Int8}throw new Error("ccp4 mode '"+e+"' unsupported")}function p(e){return-128===e.userFlag1&&127===e.userFlag2}function h(e){return p(e)?c.TypedArrayValueType.Float32:d(e.MODE)}function m(e){return 1024+e.NSYMBT}function y(e,t,n){return r(this,void 0,void 0,function(){var t,r,a,o,u,s,p,y,v,b;return i(this,function(i){switch(i.label){case 0:return[4,n.update({message:"Parsing CCP4/MRC/MAP file..."})];case 1:return i.sent(),[4,l(e)];case 2:return t=i.sent(),r=t.header,a=t.littleEndian,o=m(r),u=d(r.MODE),s=h(r),p=r.NC*r.NR*r.NS,y=c.getElementByteSize(u),v=p*y,b=c.createTypedArrayBufferContext(p,s),f(r,b,e,o,v,a),[2,{header:r,values:b.values}]}})})}function v(e,t){var n=this;return a.Task.create("Parse CCP4/MRC/MAP",function(t){return r(n,void 0,void 0,function(){var n,r,a;return i(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),r=(n=o.ReaderResult).success,[4,y(e,0,t)];case 1:return[2,r.apply(n,[i.sent()])];case 2:return a=i.sent(),[2,o.ReaderResult.error(a)];case 3:return[2]}})})})}t.readCcp4Header=l,t.readCcp4Slices=f,t.getCcp4ValueType=h,t.getCcp4DataOffset=m,t.parseFile=v,t.parse=function(e){return v(u.FileHandle.fromBuffer(s.SimpleBuffer.fromUint8Array(e)),e.length)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(7),i=n(158),a="undefined"==typeof document?n(516):void 0;!function(e){e.fromBuffer=function(e){return{readBuffer:function(t,n,a,o){var u,s;if("number"==typeof n){a=r.defaults(a,n);var c=t;u=(l=Math.min(e.length,c+a))-c,s=i.SimpleBuffer.fromUint8Array(new Uint8Array(e.buffer,c,l-c))}else{a=r.defaults(a,n.length),c=t;var l=Math.min(e.length,c+a);n.set(e.subarray(c,l),o),u=l-c,s=n}return a!==u&&console.warn("byteCount "+a+" and bytesRead "+u+" differ"),Promise.resolve({bytesRead:u,buffer:s})},writeBuffer:function(e,t,n){return n=r.defaults(n,t.length),console.error(".writeBuffer not implemented for FileHandle.fromBuffer"),Promise.resolve(0)},writeBufferSync:function(e,t,n){return n=r.defaults(n,t.length),console.error(".writeSync not implemented for FileHandle.fromBuffer"),0},close:r.noop}},e.fromDescriptor=function(e){if(void 0===a)throw new Error("fs module not available");return{readBuffer:function(t,n,o,u){return new Promise(function(s,c){var l;"number"==typeof n?(u=r.defaults(u,0),o=r.defaults(o,n),l=i.SimpleBuffer.fromArrayBuffer(new ArrayBuffer(n))):(u=r.defaults(u,0),o=r.defaults(o,n.length),l=n),a.read(e,l,u,o,t,function(e,t,n){e?c(e):(o!==t&&console.warn("byteCount "+o+" and bytesRead "+t+" differ"),s({bytesRead:t,buffer:n}))})})},writeBuffer:function(t,n,i){return i=r.defaults(i,n.length),new Promise(function(r,o){a.write(e,n,0,i,t,function(e,t){e?o(e):r(t)})})},writeBufferSync:function(t,n,i){return i=r.defaults(i,n.length),a.writeSync(e,n,0,i,t)},close:function(){try{void 0!==e&&a.close(e,r.noop)}catch(e){}}}}}(t.FileHandle||(t.FileHandle={}))},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{s(r.next(e))}catch(e){a(e)}}function u(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,u)}s((r=r.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}};Object.defineProperty(t,"__esModule",{value:!0});var a,o=n(158);function u(e){return e===a.Float32?4:e===a.Int16?2:1}function s(e,t,n,r){return void 0===n&&(n=0),e===a.Float32?new Float32Array(t,n,r):e===a.Int16?new Int16Array(t,n,r):new Int8Array(t,n,r)}!function(e){e.Float32="float32",e.Int8="int8",e.Int16="int16"}(a=t.TypedArrayValueType||(t.TypedArrayValueType={})),t.getElementByteSize=u,t.makeTypedArray=s,t.createTypedArray=function(e,t){switch(e){case a.Float32:return new Float32Array(new ArrayBuffer(4*t));case a.Int8:return new Int8Array(new ArrayBuffer(1*t));case a.Int16:return new Int16Array(new ArrayBuffer(2*t))}throw Error(e+" is not a supported value format.")},t.createTypedArrayBufferContext=function(e,t){var n=u(t),r=new ArrayBuffer(n*e),i=o.SimpleBuffer.fromArrayBuffer(r),a=o.SimpleBuffer.IsNativeEndianLittle?r:new ArrayBuffer(n*e);return{type:t,elementByteSize:n,readBuffer:i,valuesBuffer:new Uint8Array(a),values:s(t,a)}},t.readTypedArray=function(e,t,n,a,u,s){return r(this,void 0,void 0,function(){return i(this,function(r){switch(r.label){case 0:return[4,t.readBuffer(n,e.readBuffer,a,u)];case 1:return r.sent(),e.elementByteSize>1&&(void 0!==s&&s!==o.SimpleBuffer.IsNativeEndianLittle||!o.SimpleBuffer.IsNativeEndianLittle)&&o.SimpleBuffer.flipByteOrder(e.readBuffer,e.valuesBuffer,a,e.elementByteSize,u),[2,e.values]}})})}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{s(r.next(e))}catch(e){a(e)}}function u(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,u)}s((r=r.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}};Object.defineProperty(t,"__esModule",{value:!0});var a=n(518),o=n(2),u=n(519),s=n(534),c=n(9),l=n(538),f=n(213),d=n(27),p=n(11),h=n(3),m=n(151),y=n(26),v=y.PluginStateTransform.BuiltIn({name:"trajectory-from-mmcif",display:{name:"Trajectory from mmCIF",description:"Identify and create all separate models in the specified CIF data block"},from:y.PluginStateObject.Format.Cif,to:y.PluginStateObject.Molecule.Trajectory,params:function(e){if(!e)return{blockHeader:h.ParamDefinition.makeOptional(h.ParamDefinition.Text(void 0,{description:"Header of the block to parse. If none is specifed, the 1st data block in the file is used."}))};var t=e.data.blocks;return{blockHeader:h.ParamDefinition.makeOptional(h.ParamDefinition.Select(t[0]&&t[0].header,t.map(function(e){return[e.header,e.header]}),{description:"Header of the block to parse"}))}}})({isApplicable:function(e){return e.data.blocks.length>0},apply:function(e){var t=this,n=e.a,a=e.params;return p.Task.create("Parse mmCIF",function(e){return r(t,void 0,void 0,function(){var t,r,o,s;return i(this,function(i){switch(i.label){case 0:if(t=a.blockHeader||n.data.blocks[0].header,!(r=n.data.blocks.find(function(e){return e.header===t})))throw new Error("Data block '"+[t]+"' not found.");return[4,u.trajectoryFromMmCIF(r).runInContext(e)];case 1:if(0===(o=i.sent()).length)throw new Error("No models found.");return s={label:o[0].label,description:o.length+" model"+(1===o.length?"":"s")},[2,new y.PluginStateObject.Molecule.Trajectory(o,s)]}})})})}});t.TrajectoryFromMmCif=v;var b=y.PluginStateTransform.BuiltIn({name:"trajectory-from-pdb",display:{name:"Parse PDB",description:"Parse PDB string and create trajectory."},from:[y.PluginStateObject.Data.String],to:y.PluginStateObject.Molecule.Trajectory})({apply:function(e){var t=this,n=e.a;return p.Task.create("Parse PDB",function(e){return r(t,void 0,void 0,function(){var t,r,o;return i(this,function(i){switch(i.label){case 0:return[4,a.parsePDB(n.data).runInContext(e)];case 1:if((t=i.sent()).isError)throw new Error(t.message);return[4,s.trajectoryFromPDB(t.result).runInContext(e)];case 2:return r=i.sent(),o={label:r[0].label,description:r.length+" model"+(1===r.length?"":"s")},[2,new y.PluginStateObject.Molecule.Trajectory(r,o)]}})})})}});t.TrajectoryFromPDB=b;var g=function(e){return e+1},_=function(e){return e-1},S=y.PluginStateTransform.BuiltIn({name:"model-from-trajectory",display:{name:"Molecular Model",description:"Create a molecular model from specified index in a trajectory."},from:y.PluginStateObject.Molecule.Trajectory,to:y.PluginStateObject.Molecule.Model,params:function(e){return e?{modelIndex:h.ParamDefinition.Converted(g,_,h.ParamDefinition.Numeric(1,{min:1,max:e.data.length,step:1},{description:"Model Index"}))}:{modelIndex:h.ParamDefinition.Numeric(0,{},{description:"Zero-based index of the model"})}}})({isApplicable:function(e){return e.data.length>0},apply:function(e){var t=e.a,n=e.params;if(n.modelIndex<0||n.modelIndex>=t.data.length)throw new Error("Invalid modelIndex "+n.modelIndex);var r=t.data[n.modelIndex],i=1===t.data.length?{label:""+r.label}:{label:r.label+":"+r.modelNum,description:"Model "+r.modelNum+" of "+t.data.length};return new y.PluginStateObject.Molecule.Model(r,i)}});t.ModelFromTrajectory=S;var C=y.PluginStateTransform.BuiltIn({name:"structure-from-model",display:{name:"Structure from Model",description:"Create a molecular structure from the specified model."},from:y.PluginStateObject.Molecule.Model,to:y.PluginStateObject.Molecule.Structure})({apply:function(e){var t=e.a,n=c.Structure.ofModel(t.data),r={label:t.data.label,description:1===n.elementCount?"1 element":n.elementCount+" elements"};return new y.PluginStateObject.Molecule.Structure(n,r)}});function x(e){return 1===e.elementCount?"1 element":e.elementCount+" elements"}t.StructureFromModel=C;var w=y.PluginStateTransform.BuiltIn({name:"structure-assembly-from-model",display:{name:"Structure Assembly",description:"Create a molecular structure assembly."},from:y.PluginStateObject.Molecule.Model,to:y.PluginStateObject.Molecule.Structure,params:function(e){if(!e)return{id:h.ParamDefinition.makeOptional(h.ParamDefinition.Text("",{label:"Assembly Id",description:"Assembly Id. Value 'deposited' can be used to specify deposited asymmetric unit."}))};var t=e.data.symmetry.assemblies.map(function(e){return[e.id,e.id+": "+m.stringToWords(e.details)]});return t.push(["deposited","Deposited"]),{id:h.ParamDefinition.makeOptional(h.ParamDefinition.Select(t[0][0],t,{label:"Asm Id",description:"Assembly Id"}))}}})({apply:function(e,t){var n=this,a=e.a,o=e.params;return p.Task.create("Build Assembly",function(e){return r(n,void 0,void 0,function(){var n,r,u,s,l,f,d;return i(this,function(i){switch(i.label){case 0:return n=a.data,r=o.id,u=void 0,r||0===n.symmetry.assemblies.length||(r=n.symmetry.assemblies[0].id),0===n.symmetry.assemblies.length?"deposited"!==r&&t.log.warn("Model '"+a.label+"' has no assembly, returning deposited structure."):(u=c.ModelSymmetry.findAssembly(n,r||""))||t.log.warn("Model '"+a.label+"' has no assembly called '"+r+"', returning deposited structure."),s=c.Structure.ofModel(n),u?(r=u.id,[4,c.StructureSymmetry.buildAssembly(s,r).runInContext(e)]):(l={label:a.data.label,description:x(s)},[2,new y.PluginStateObject.Molecule.Structure(s,l)]);case 1:return f=i.sent(),d={label:"Assembly "+r,description:x(f)},[2,new y.PluginStateObject.Molecule.Structure(f,d)]}})})})}});t.StructureAssemblyFromModel=w;var P=y.PluginStateTransform.BuiltIn({name:"structure-symmetry-from-model",display:{name:"Structure Symmetry",description:"Create a molecular structure symmetry."},from:y.PluginStateObject.Molecule.Model,to:y.PluginStateObject.Molecule.Structure,params:function(e){return{ijkMin:h.ParamDefinition.Vec3(o.Vec3.create(-1,-1,-1),{label:"Min IJK",fieldLabels:{x:"I",y:"J",z:"K"}}),ijkMax:h.ParamDefinition.Vec3(o.Vec3.create(1,1,1),{label:"Max IJK",fieldLabels:{x:"I",y:"J",z:"K"}})}}})({apply:function(e,t){var n=this,a=e.a,o=e.params;return p.Task.create("Build Symmetry",function(e){return r(n,void 0,void 0,function(){var t,n,r,u,s,l;return i(this,function(i){switch(i.label){case 0:return t=o.ijkMin,n=o.ijkMax,r=a.data,u=c.Structure.ofModel(r),[4,c.StructureSymmetry.buildSymmetryRange(u,t,n).runInContext(e)];case 1:return s=i.sent(),l={label:"Symmetry ["+t+"] to ["+n+"]",description:x(s)},[2,new y.PluginStateObject.Molecule.Structure(s,l)]}})})})}});t.StructureSymmetryFromModel=P;var T=y.PluginStateTransform.BuiltIn({name:"structure-selection",display:{name:"Structure Selection",description:"Create a molecular structure from the specified query expression."},from:y.PluginStateObject.Molecule.Structure,to:y.PluginStateObject.Molecule.Structure,params:{query:h.ParamDefinition.Value(l.MolScriptBuilder.struct.generator.all,{isHidden:!0}),label:h.ParamDefinition.makeOptional(h.ParamDefinition.Text("",{isHidden:!0}))}})({apply:function(e){var t=e.a,n=e.params,r=f.compile(n.query)(new c.QueryContext(t.data)),i=c.StructureSelection.unionStructure(r),a={label:""+(n.label||"Selection"),description:x(i)};return new y.PluginStateObject.Molecule.Structure(i,a)}});t.StructureSelection=T;var A=["atomic-sequence","water","atomic-het","spheres"].map(function(e){return[e,e]}),E=y.PluginStateTransform.BuiltIn({name:"structure-complex-element",display:{name:"Complex Element",description:"Create a molecular structure from the specified model."},from:y.PluginStateObject.Molecule.Structure,to:y.PluginStateObject.Molecule.Structure,params:{type:h.ParamDefinition.Select("atomic-sequence",A,{isHidden:!0})}})({apply:function(e){var t,n,r=e.a,i=e.params;switch(i.type){case"atomic-sequence":t=c.Queries.internal.atomicSequence(),n="Sequence";break;case"water":t=c.Queries.internal.water(),n="Water";break;case"atomic-het":t=c.Queries.internal.atomicHet(),n="HET Groups/Ligands";break;case"spheres":t=c.Queries.internal.spheres(),n="Coarse Spheres";break;default:throw new Error(i.type+" is a not valid complex element.")}var a=t(new c.QueryContext(r.data)),o=c.StructureSelection.unionStructure(a);return 0===o.elementCount?d.StateObject.Null:new y.PluginStateObject.Molecule.Structure(o,{label:n,description:x(o)})}});t.StructureComplexElement=E;var k=y.PluginStateTransform.BuiltIn({name:"custom-model-properties",display:{name:"Custom Model Properties"},from:y.PluginStateObject.Molecule.Model,to:y.PluginStateObject.Molecule.Model,params:function(e,t){return e?{properties:t.customModelProperties.getSelect(e.data)}:{properties:h.ParamDefinition.MultiSelect([],[],{description:"A list of property descriptor ids."})}}})({apply:function(e,t){var n=this,a=e.a,o=e.params;return p.Task.create("Custom Props",function(e){return r(n,void 0,void 0,function(){return i(this,function(n){switch(n.label){case 0:return[4,I(a.data,t,e,o.properties)];case 1:return n.sent(),[2,new y.PluginStateObject.Molecule.Model(a.data,{label:"Props",description:o.properties.length+" Selected"})]}})})})}});function I(e,t,n,a){return r(this,void 0,void 0,function(){var r,o,u;return i(this,function(i){switch(i.label){case 0:r=0,o=a,i.label=1;case 1:return r<o.length?(u=o[r],[4,t.customModelProperties.get(u).attach(e).runInContext(n)]):[3,4];case 2:i.sent(),i.label=3;case 3:return r++,[3,1];case 4:return[2]}})})}t.CustomModelProperties=k},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(75);!function(e){e.mmCIF=function(e,t){return{kind:"mmCIF",data:t||i.default.schema.mmCIF(e),frame:e}}}(r||(r={})),t.ModelFormat=r},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{s(r.next(e))}catch(e){a(e)}}function u(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,u)}s((r=r.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(21),u=n(120),s=n(19),c=n(2),l=n(181),f=n(190),d=n(520),p=n(521),h=n(191),m=n(525),y=n(530),v=n(532),b=n(533),g=n(243),_=n(23),S=n(134),C=n(159);function x(e){var t=d.createAssemblies(e),n=function(e){var t=e.data,n=t.symmetry,r=t.cell;if(0===n._rowCount||0===r._rowCount)return s.Spacegroup.ZeroP1;var i=n["space_group_name_H-M"].value(0),a=s.SpacegroupCell.create(i,c.Vec3.create(r.length_a.value(0),r.length_b.value(0),r.length_c.value(0)),c.Vec3.scale(c.Vec3.zero(),c.Vec3.create(r.angle_alpha.value(0),r.angle_beta.value(0),r.angle_gamma.value(0)),Math.PI/180));return s.Spacegroup.create(a)}(e);return{assemblies:t,spacegroup:n,isNonStandardCrytalFrame:function(e,t){return e.data.atom_sites._rowCount,!1}(e),ncsOperators:w(e)}}function w(e){var t=e.data.struct_ncs_oper;if(0!==t._rowCount){for(var n=t.id,r=t.matrix,i=t.vector,a=u.mmCIF_Schema.struct_ncs_oper.matrix.space,o=u.mmCIF_Schema.struct_ncs_oper.vector.space,l=[],f=0;f<t._rowCount;f++){var d=c.Tensor.toMat3(a,r.value(f)),p=c.Tensor.toVec3(o,i.value(f));if(s.SymmetryOperator.checkIfRotationAndTranslation(d,p)){var h=n.value(f);l[l.length]=s.SymmetryOperator.ofRotationAndOffset("ncs_"+h,d,p,h)}}return l}}function P(e){for(var t=e.data.pdbx_struct_mod_residue,n=new Map,r=new Map,i=t.label_comp_id.isDefined?t.label_comp_id:t.auth_comp_id,a=t.parent_comp_id,o=t.details,u=0;u<t._rowCount;u++){var s=i.value(u);n.set(s,a.value(u)),r.set(s,o.value(u))}return{parentId:n,details:r}}function T(e){var t=new Map;if(e.data.chem_comp._rowCount>0)for(var n=e.data.chem_comp.id,r=0,i=n.rowCount;r<i;++r)t.set(n.value(r),o.Table.getRow(e.data.chem_comp,r));return t}function A(e){var t=new Map,n=e.data.pdbx_chem_comp_identifier;if(n._rowCount>0){for(var r=n.comp_id,i=n.type,a=n.identifier,o=0,u=n._rowCount;o<u;++o)if("SNFG CARB SYMBOL"===i.value(o)){var s=a.value(o),c=S.SaccharidesSnfgMap.get(s);c?t.set(r.value(o),c):console.warn("Unknown SNFG name '"+s+"'")}}else if(e.data.chem_comp._rowCount>0){var l=e.data.chem_comp,f=l.id;for(i=l.type,o=0,u=f.rowCount;o<u;++o){var d=f.value(o),p=i.value(o);S.SaccharideCompIdMap.has(d)?t.set(d,S.SaccharideCompIdMap.get(d)):t.has(d)||8!==_.getMoleculeType(p,d)||t.set(d,S.UnknownSaccharideComponent)}}else{var h=E(e);S.SaccharideCompIdMap.forEach(function(e,n){h.has(n)&&t.set(n,e)})}return t}t._parse_mmCif=function(e,t){return i(this,void 0,void 0,function(){var n,r;return a(this,function(i){switch(i.label){case 0:return n=function(e){return{modifiedResidues:P(e),chemicalComponentMap:T(e),saccharideComponentMap:A(e)}}(e),e.data.ihm_model_list._rowCount>0?[4,D(t,e,n)]:[3,2];case 1:return r=i.sent(),[3,4];case 2:return[4,V(t,e,n)];case 3:r=i.sent(),i.label=4;case 4:return[2,r]}})})};var E=C.memoize1(function(e){for(var t=new Set,n=e.data.atom_site,r=n.label_comp_id.isDefined?n.label_comp_id:n.auth_comp_id,i=0,a=r.rowCount;i<a;++i)t.add(r.value(i));return t});function k(e,t,n){var i=p.getAtomicHierarchyAndConformation(e,t.atom_site,t.entities,n),a=m.getIHMCoarse(t,n);return{id:l.default.create22(),label:t.model_name,sourceData:e,modelNum:t.model_id,entities:t.entities,symmetry:x(e),sequence:v.getSequence(e.data,t.entities,i.hierarchy,n.modifiedResidues.parentId),atomicHierarchy:i.hierarchy,atomicConformation:i.conformation,coarseHierarchy:a.hierarchy,coarseConformation:a.conformation,properties:r({secondaryStructure:y.getSecondaryStructure(e.data,i.hierarchy,i.conformation)},n),customProperties:new f.CustomProperties,_staticPropertyData:Object.create(null),_dynamicPropertyData:Object.create(null)}}function I(e){h.ComponentBond.attachFromMmCif(e),g.StructConn.attachFromMmCif(e)}function M(e,t){var n=e.rowCount;if(!e.isDefined)return n;for(var r=t+1;r<n&&e.areValuesEqual(t,r);)r++;return r}function V(e,t,n){return i(this,void 0,void 0,function(){var i,u,s,c,d,h,g;return a(this,function(a){switch(a.label){case 0:i=t.data.atom_site._rowCount,u={data:t.data.entity,getEntityIndex:o.Column.createIndexer(t.data.entity.id)},s=[],c=0,a.label=1;case 1:return c<i?(d=M(t.data.atom_site.pdbx_PDB_model_num,c),[4,b.sortAtomSite(e,t.data.atom_site,c,d)]):[3,3];case 2:return h=a.sent(),I(g=function(e,t,n,i,a){var o=p.getAtomicHierarchyAndConformation(e,t,n,i,a);if(a&&o.sameAsPrevious)return r({},a,{id:l.default.create22(),modelNum:t.pdbx_PDB_model_num.value(0),atomicConformation:o.conformation,_dynamicPropertyData:Object.create(null)});var u=m.EmptyIHMCoarse,s=0===e.data.entry.id.valueKind(0)?e.data.entry.id.value(0):e.data._name;return{id:l.default.create22(),label:s,sourceData:e,modelNum:t.pdbx_PDB_model_num.value(0),entities:n,symmetry:x(e),sequence:v.getSequence(e.data,n,o.hierarchy,i.modifiedResidues.parentId),atomicHierarchy:o.hierarchy,atomicConformation:o.conformation,coarseHierarchy:u.hierarchy,coarseConformation:u.conformation,properties:r({secondaryStructure:y.getSecondaryStructure(e.data,o.hierarchy,o.conformation)},i),customProperties:new f.CustomProperties,_staticPropertyData:Object.create(null),_dynamicPropertyData:Object.create(null)}}(t,h,u,n,s.length>0?s[s.length-1]:void 0)),s.push(g),c=d,[3,1];case 3:return[2,s]}})})}function O(e,t){for(var n=new Map,r=e._rowCount,i=0;i<r;){var a=M(t,i),u=t.value(i),s=o.Table.window(e,e._schema,i,a);n.set(u,s),i=a}return n}function D(e,t,n){return i(this,void 0,void 0,function(){var e,r,i,u,s,c,l,f,d,p,h,m;return a(this,function(a){if(e=t.data.ihm_model_list,r={data:t.data.entity,getEntityIndex:o.Column.createIndexer(t.data.entity.id)},!t.data.atom_site.ihm_model_id.isDefined)throw new Error("expected _atom_site.ihm_model_id to be defined");for(i=O(t.data.atom_site,t.data.atom_site.ihm_model_id),u=O(t.data.ihm_sphere_obj_site,t.data.ihm_sphere_obj_site.model_id),s=O(t.data.ihm_gaussian_obj_site,t.data.ihm_gaussian_obj_site.model_id),c=[],l=e.model_id,f=e.model_name,d=0;d<e._rowCount;d++)p=l.value(d),h={model_id:p,model_name:f.value(d),entities:r,atom_site:i.has(p)?i.get(p):o.Table.window(t.data.atom_site,t.data.atom_site._schema,0,0),ihm_sphere_obj_site:u.has(p)?u.get(p):o.Table.window(t.data.ihm_sphere_obj_site,t.data.ihm_sphere_obj_site._schema,0,0),ihm_gaussian_obj_site:s.has(p)?s.get(p):o.Table.window(t.data.ihm_gaussian_obj_site,t.data.ihm_gaussian_obj_site._schema,0,0)},I(m=k(t,h,n)),c.push(m);return[2,c]})})}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{s(r.next(e))}catch(e){a(e)}}function u(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,u)}s((r=r.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}};Object.defineProperty(t,"__esModule",{value:!0});var a=n(11),o=n(19),u=n(2);t.volumeFromDensityServerData=function(e){var t=this;return a.Task.create("Create Volume Data",function(n){return r(t,void 0,void 0,function(){var t,n,r,a,s,c,l,f,d,p;return i(this,function(i){return t=e.volume_data_3d_info,n=e.volume_data_3d,r=o.SpacegroupCell.create(t.spacegroup_number.value(0),u.Vec3.ofArray(t.spacegroup_cell_size.value(0)),u.Vec3.scale(u.Vec3.zero(),u.Vec3.ofArray(t.spacegroup_cell_angles.value(0)),Math.PI/180)),a=t.axis_order.value(0),s=u.Tensor.convertToCanonicalAxisIndicesFastToSlow(a),c=s(t.sample_count.value(0)),l=u.Tensor.Space(c,u.Tensor.invertAxisOrder(a),Float32Array),f=u.Tensor.create(l,u.Tensor.Data1(n.values.toArray({array:Float32Array}))),d=u.Vec3.ofArray(s(t.origin.value(0))),p=u.Vec3.ofArray(s(t.dimensions.value(0))),[2,{cell:r,fractionalBox:o.Box3D.create(d,u.Vec3.add(u.Vec3.zero(),d,p)),data:f,dataStats:{min:t.min_sampled.value(0),max:t.max_sampled.value(0),mean:t.mean_sampled.value(0),sigma:t.sigma_sampled.value(0)}}]})})})}},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),a=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{s(r.next(e))}catch(e){a(e)}}function u(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,u)}s((r=r.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}};Object.defineProperty(t,"__esModule",{value:!0});var u=n(75),s=n(19),c=n(2),l=n(292),f=n(86),d=n(26),p=n(282),h=n(18),m=n(542),y=n(3);!function(e){function t(e,t,n){return y.ParamDefinition.Group({color:y.ParamDefinition.Color(t),isoValue:p.createIsoValueParam(f.VolumeIsoValue.relative(n))},{label:e})}e.Params={id:y.ParamDefinition.Text("1tqn"),levels:y.ParamDefinition.MappedStatic("x-ray",{em:t("EM",h.Color(6524815),1.5),"x-ray":y.ParamDefinition.Group({"2fo-fc":t("2Fo-Fc",h.Color(3367602),1.5),"fo-fc(+ve)":t("Fo-Fc(+ve)",h.Color(3390259),3),"fo-fc(-ve)":t("Fo-Fc(-ve)",h.Color(12268339),-3)})}),box:y.ParamDefinition.MappedStatic("static-box",{"static-box":y.ParamDefinition.Group({bottomLeft:y.ParamDefinition.Vec3(c.Vec3.create(-22.4,-33.4,-21.6)),topRight:y.ParamDefinition.Vec3(c.Vec3.create(-7.1,-10,-.9))},{description:"Static box defined by cartesian coords."}),cell:y.ParamDefinition.Group({})}),detailLevel:y.ParamDefinition.Numeric(3,{min:0,max:7}),serverUrl:y.ParamDefinition.Text("https://webchem.ncbr.muni.cz/DensityServer")};var n=function(){function e(e,t,n){this.ctx=e,this.params=t,this.structure=n,this.cache=m.LRUCache.create(25),this.currentData={}}return e.prototype.queryData=function(e){return a(this,void 0,void 0,function(){var t,n,r,i,a;return o(this,function(o){switch(o.label){case 0:return t=this.params.serverUrl+"/"+this.params.levels.name+"/"+this.params.id,e?(n=e.min,r=e.max,t+="/box/"+n.map(function(e){return Math.round(1e3*e)/1e3}).join(",")+"/"+r.map(function(e){return Math.round(1e3*e)/1e3}).join(",")):t+="/cell",t+="?detail="+this.params.detailLevel,(i=m.LRUCache.get(this.cache,t))?[2,i]:[4,this.ctx.runTask(this.ctx.fetch(t,"binary"))];case 1:return a=o.sent(),[4,this.parseCif(a)];case 2:return(i=o.sent())?(m.LRUCache.set(this.cache,t,i),[2,i]):[2]}})})},e.prototype.parseCif=function(e){return a(this,void 0,void 0,function(){var t,n,r,i,a,s,c,f;return o(this,function(o){switch(o.label){case 0:return[4,this.ctx.runTask(u.default.parseBinary(e))];case 1:if((t=o.sent()).isError)return this.ctx.log.error("VolumeStreaming, parsing CIF: "+t.toString()),[2];if(t.result.blocks.length<2)return this.ctx.log.error("VolumeStreaming: Invalid data."),[2];n={},r=1,o.label=2;case 2:return r<t.result.blocks.length?(i=t.result.blocks[r],a=u.default.schema.densityServer(i),f=(c=this.ctx).runTask,[4,l.volumeFromDensityServerData(a)]):[3,6];case 3:return[4,f.apply(c,[o.sent()])];case 4:s=o.sent(),n[i.header]=s,o.label=5;case 5:return r++,[3,2];case 6:return[2,n]}})})},e.prototype.register=function(e){},e.prototype.update=function(e){return a(this,void 0,void 0,function(){var t,n;return o(this,function(r){switch(r.label){case 0:switch(this.params=e,t=void 0,e.box.name){case"static-box":t=s.Box3D.create(e.box.params.bottomLeft,e.box.params.topRight);break;case"cell":t="x-ray"===this.params.levels.name?this.structure.boundary.box:void 0}return[4,this.queryData(t)];case 1:return n=r.sent(),this.currentData=n||{},[2,!0]}})})},e.prototype.unregister=function(){},e}();e.Behavior=n;var r=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t}(d.PluginStateObject.CreateBehavior({name:"Volume Streaming"}));e.Obj=r}(t.VolumeStreaming||(t.VolumeStreaming={}))},function(e,t,n){"use strict";
/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var r=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable;e.exports=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},n=0;n<10;n++)t["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(t).map(function(e){return t[e]}).join(""))return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach(function(e){r[e]=e}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},r)).join("")}catch(e){return!1}}()?Object.assign:function(e,t){for(var n,o,u=function(e){if(null==e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}(e),s=1;s<arguments.length;s++){for(var c in n=Object(arguments[s]))i.call(n,c)&&(u[c]=n[c]);if(r){o=r(n);for(var l=0;l<o.length;l++)a.call(n,o[l])&&(u[o[l]]=n[o[l]])}}return u}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(27),i=n(3),a=n(26),o=n(157),u=n(160),s=n(289),c=r.StateAction.build({from:a.PluginStateObject.Root,display:{name:"Download Structure",description:"Load a structure from the provided source and create its default Assembly and visual."},params:{source:i.ParamDefinition.MappedStatic("bcif-static",{"pdbe-updated":i.ParamDefinition.Group({id:i.ParamDefinition.Text("1cbs",{label:"Id"}),supportProps:i.ParamDefinition.Boolean(!1)},{isFlat:!0}),rcsb:i.ParamDefinition.Group({id:i.ParamDefinition.Text("1tqn",{label:"Id"}),supportProps:i.ParamDefinition.Boolean(!1)},{isFlat:!0}),"bcif-static":i.ParamDefinition.Group({id:i.ParamDefinition.Text("1tqn",{label:"Id"}),supportProps:i.ParamDefinition.Boolean(!1)},{isFlat:!0}),url:i.ParamDefinition.Group({url:i.ParamDefinition.Text(""),format:i.ParamDefinition.Select("cif",[["cif","CIF"],["pdb","PDB"]]),isBinary:i.ParamDefinition.Boolean(!1),supportProps:i.ParamDefinition.Boolean(!1)},{isFlat:!0})},{options:[["pdbe-updated","PDBe Updated"],["rcsb","RCSB"],["bcif-static","BinaryCIF (static PDBe Updated)"],["url","URL"]]})}})(function(e,t){var n,r=e.params,i=e.state,a=i.build(),u=r.source;switch(u.name){case"url":n={url:u.params.url,isBinary:u.params.isBinary};break;case"pdbe-updated":n={url:"https://www.ebi.ac.uk/pdbe/static/entry/"+u.params.id.toLowerCase()+"_updated.cif",isBinary:!1,label:"PDBe: "+u.params.id};break;case"rcsb":n={url:"https://files.rcsb.org/download/"+u.params.id.toUpperCase()+".cif",isBinary:!1,label:"RCSB: "+u.params.id};break;case"bcif-static":n={url:"https://webchem.ncbr.muni.cz/ModelServer/static/bcif/"+u.params.id.toLowerCase(),isBinary:!0,label:"BinaryCIF: "+u.params.id};break;default:throw new Error(u.name+" not supported.")}var s=l(a.toRoot().apply(o.StateTransforms.Data.Download,n,{props:{isGhost:!0}}),"url"===u.name?u.params.format:"cif");return i.updateTree(f(t,s,r.source.params.supportProps))});function l(e,t){return void 0===t&&(t="cif"),("cif"===t?e.apply(o.StateTransforms.Data.ParseCif,void 0,{props:{isGhost:!0}}).apply(o.StateTransforms.Model.TrajectoryFromMmCif,void 0,{props:{isGhost:!0}}):e.apply(o.StateTransforms.Model.TrajectoryFromPDB,void 0,{props:{isGhost:!0}})).apply(o.StateTransforms.Model.ModelFromTrajectory,{modelIndex:0})}function f(e,t,n){var r=t;return n&&(r=r.apply(o.StateTransforms.Model.CustomModelProperties)),d(e,r.apply(o.StateTransforms.Model.StructureAssemblyFromModel)),r}function d(e,t){t.apply(o.StateTransforms.Model.StructureComplexElement,{type:"atomic-sequence"}).apply(o.StateTransforms.Representation.StructureRepresentation3D,u.StructureRepresentation3DHelpers.getDefaultParamsStatic(e,"cartoon")),t.apply(o.StateTransforms.Model.StructureComplexElement,{type:"atomic-het"}).apply(o.StateTransforms.Representation.StructureRepresentation3D,u.StructureRepresentation3DHelpers.getDefaultParamsStatic(e,"ball-and-stick")),t.apply(o.StateTransforms.Model.StructureComplexElement,{type:"water"}).apply(o.StateTransforms.Representation.StructureRepresentation3D,u.StructureRepresentation3DHelpers.getDefaultParamsStatic(e,"ball-and-stick",{alpha:.51})),t.apply(o.StateTransforms.Model.StructureComplexElement,{type:"spheres"}).apply(o.StateTransforms.Representation.StructureRepresentation3D,u.StructureRepresentation3DHelpers.getDefaultParamsStatic(e,"spacefill"))}t.DownloadStructure=c,t.OpenStructure=r.StateAction.build({display:{name:"Open Structure",description:"Load a structure from file and create its default Assembly and visual"},from:a.PluginStateObject.Root,params:{file:i.ParamDefinition.File({accept:".cif,.bcif"})}})(function(e,t){var n=e.params,r=e.state,i=l(r.build().toRoot().apply(o.StateTransforms.Data.ReadFile,{file:n.file,isBinary:/\.bcif$/i.test(n.file.name)}),"cif");return r.updateTree(f(t,i,!1))}),t.CreateComplexRepresentation=r.StateAction.build({display:{name:"Create Complex",description:"Split the structure into Sequence/Water/Ligands/... "},from:a.PluginStateObject.Molecule.Structure})(function(e,t){var n=e.ref,r=e.state,i=r.build().to(n);return d(t,i),r.updateTree(i)}),t.UpdateTrajectory=r.StateAction.build({display:{name:"Update Trajectory"},params:{action:i.ParamDefinition.Select("advance",[["advance","Advance"],["reset","Reset"]]),by:i.ParamDefinition.makeOptional(i.ParamDefinition.Numeric(1,{min:-1,max:1,step:1}))}})(function(e){var t=e.params,n=e.state,i=n.selectQ(function(e){return e.rootsOfType(a.PluginStateObject.Molecule.Model).filter(function(e){return e.transform.transformer===o.StateTransforms.Model.ModelFromTrajectory})}),u=n.build();if("reset"===t.action)for(var s=0,c=i;s<c.length;s++){var l=c[s];u.to(l.transform.ref).update(o.StateTransforms.Model.ModelFromTrajectory,function(){return{modelIndex:0}})}else for(var f=function(e){var i=r.StateSelection.findAncestorOfType(n.tree,n.cells,e.transform.ref,[a.PluginStateObject.Molecule.Trajectory]);if(!i||!i.obj)return"continue";var s=i.obj;u.to(e.transform.ref).update(o.StateTransforms.Model.ModelFromTrajectory,function(e){var n=(e.modelIndex+t.by)%s.data.length;return n<0&&(n+=s.data.length),{modelIndex:n}})},d=0,p=i;d<p.length;d++){f(l=p[d])}return n.updateTree(u)}),t.EnableModelCustomProps=r.StateAction.build({display:{name:"Custom Properties",description:"Enable the addition of custom properties to the model."},from:a.PluginStateObject.Molecule.Model,params:function(e,t){return e?{properties:t.customModelProperties.getSelect(e.data)}:{properties:i.ParamDefinition.MultiSelect([],[],{description:"A list of property descriptor ids."})}},isApplicable:function(e,t,n){return t.transformer!==s.CustomModelProperties}})(function(e,t){var n=e.ref,r=e.params,i=e.state,a=i.build().to(n).insert(s.CustomModelProperties,r);return i.updateTree(a)})},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var a=n(24),o=n(61),u=n(552),s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),Object.defineProperty(t.prototype,"current",{get:function(){return this.plugin.state.behavior.currentObject.value},enumerable:!0,configurable:!0}),t.prototype.componentDidMount=function(){var e=this;this.subscribe(this.plugin.state.behavior.currentObject,function(t){e.forceUpdate()}),this.subscribe(this.plugin.events.state.object.updated,function(t){var n=t.ref,r=t.state,i=e.current;i.ref===n&&i.state===r&&e.forceUpdate()})},t.prototype.render=function(){var e=this,t=this.props,n=t.state,r=t.nodeRef,i=n.cells.get(r);return n.actions.fromCell(i,this.plugin).map(function(t,i){return a.createElement(u.ApplyActionContol,{plugin:e.plugin,key:""+t.id,state:n,action:t,nodeRef:r})})},t}(o.PluginUIComponent);t.StateObjectActions=s},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),a=this&&this.__assign||function(){return(a=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{s(r.next(e))}catch(e){a(e)}}function u(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,u)}s((r=r.apply(e,t||[])).next())})},u=this&&this.__generator||function(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}};Object.defineProperty(t,"__esModule",{value:!0});var s=n(24),c=n(61),l=n(128),f=n(3),d=n(39),p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onChange=function(e){var n,r=e.name,i=e.value,o=a({},t.props.params,((n={})[r]=i,n));t.props.events.onChange(o,t.areInitial(o),t.validate(o))},t}return i(t,e),t.prototype.validate=function(e){},t.prototype.areInitial=function(e){return f.ParamDefinition.areEqual(this.props.info.params,e,this.props.info.initialValues)},t.prototype.render=function(){return s.createElement(l.ParameterControls,{params:this.props.info.params,values:this.props.params,onChange:this.onChange,onEnter:this.props.events.onEnter,isDisabled:this.props.isDisabled})},t}(c.PurePluginUIComponent);t.StateTransformParameters=p,function(e){function t(e){for(var t=0,n=Object.keys(e);t<n.length;t++){if(!e[n[t]].isHidden)return!1}return!0}e.infoFromAction=function(e,n,r,i){var a=n.cells.get(i).obj,o=r.definition.params?r.definition.params(a,e):{};return{initialValues:f.ParamDefinition.getDefaultValues(o),params:o,isEmpty:t(o)}},e.infoFromTransform=function(e,n,r){var i=n.cells.get(r.ref),a=i.params&&i.params.definition||{};return{initialValues:i.params&&i.params.values||{},params:a,isEmpty:t(a)}}}(p||(p={})),t.StateTransformParameters=p;var h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onEnter=function(){t.state.error||t.apply()},t.autoApplyHandle=void 0,t.events={onEnter:t.onEnter,onChange:function(e,n,r){t.clearAutoApply(),t.setState({params:e,isInitial:n,error:r&&r[0]},function(){n||t.state.error||!t.canAutoApply(e)||(t.clearAutoApply(),t.autoApplyHandle=setTimeout(t.apply,50))})}},t.apply=function(){return o(t,void 0,void 0,function(){return u(this,function(e){switch(e.label){case 0:this.clearAutoApply(),this.setState({busy:!0}),e.label=1;case 1:return e.trys.push([1,,3,4]),[4,this.applyAction()];case 2:return e.sent(),[3,4];case 3:return this.busy.next(!1),[7];case 4:return[2]}})})},t.refresh=function(){t.setState({params:t.getInfo().initialValues,isInitial:!0,error:void 0})},t.setDefault=function(){var e=t.getInfo(),n=f.ParamDefinition.getDefaultValues(e.params);t.setState({params:n,isInitial:f.ParamDefinition.areEqual(e.params,n,e.initialValues),error:void 0})},t.toggleExpanded=function(){t.setState({isCollapsed:!t.state.isCollapsed})},t}return i(t,e),t.prototype.clearAutoApply=function(){void 0!==this.autoApplyHandle&&(clearTimeout(this.autoApplyHandle),this.autoApplyHandle=void 0)},t.prototype.init=function(){var e=this;this.busy=new d.Subject,this.subscribe(this.busy,function(t){return e.setState({busy:t})})},t.prototype.render=function(){var e=this.getInfo(),t=e.isEmpty&&this.isUpdate(),n=this.getHeader(),r=this.getTransformerId(),i=this.plugin.customParamEditors.has(r)?this.plugin.customParamEditors.get(r):p,a=this.isUpdate()?t||this.state.isCollapsed?"msp-transform-update-wrapper-collapsed":"msp-transform-update-wrapper":"msp-transform-wrapper";return s.createElement("div",{className:a},s.createElement("div",{className:"msp-transform-header"},s.createElement("button",{className:"msp-btn msp-btn-block",onClick:this.toggleExpanded,title:n.description},n.name,!t&&this.state.isCollapsed&&this.isUpdate()&&s.createElement("small",null,"Click to Edit"))),!t&&!this.state.isCollapsed&&s.createElement(s.Fragment,null,s.createElement(i,{info:e,events:this.events,params:this.state.params,isDisabled:this.state.busy}),s.createElement("div",{className:"msp-transform-apply-wrap"},s.createElement("button",{className:"msp-btn msp-btn-block msp-transform-default-params",onClick:this.setDefault,disabled:this.state.busy,title:"Set default params"},""),s.createElement("button",{className:"msp-btn msp-btn-block msp-transform-refresh msp-form-control",title:"Refresh params",onClick:this.refresh,disabled:this.state.busy||this.state.isInitial}," Back"),s.createElement("div",{className:"msp-transform-apply"},s.createElement("button",{className:"msp-btn msp-btn-block msp-btn-commit msp-btn-commit-"+(this.canApply()?"on":"off"),onClick:this.apply,disabled:!this.canApply()},this.applyText())))))},t}(c.PurePluginUIComponent);t.TransformContolBase=h},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(299);n(567),n(568),i.createPlugin(document.getElementById("app"),r({},i.DefaultPluginSpec,{initialLayout:{isExpanded:!0,showControls:!0}}))},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{s(r.next(e))}catch(e){a(e)}}function u(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,u)}s((r=r.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}};Object.defineProperty(t,"__esModule",{value:!0});var a=n(300),o=n(544),u=n(24),s=n(559),c=n(37),l=n(563),f=n(157),d=n(148),p=n(564),h=n(566);t.DefaultPluginSpec={actions:[l.PluginSpec.Action(h.StateActions.Structure.DownloadStructure),l.PluginSpec.Action(h.StateActions.Volume.DownloadDensity),l.PluginSpec.Action(h.StateActions.Structure.OpenStructure),l.PluginSpec.Action(h.StateActions.Volume.OpenVolume),l.PluginSpec.Action(h.StateActions.Structure.CreateComplexRepresentation),l.PluginSpec.Action(h.StateActions.Structure.EnableModelCustomProps),l.PluginSpec.Action(h.StateActions.Volume.InitVolumeStreaming),l.PluginSpec.Action(f.StateTransforms.Data.Download),l.PluginSpec.Action(f.StateTransforms.Data.ParseCif),l.PluginSpec.Action(f.StateTransforms.Data.ParseCcp4),l.PluginSpec.Action(f.StateTransforms.Model.StructureAssemblyFromModel),l.PluginSpec.Action(f.StateTransforms.Model.StructureSymmetryFromModel),l.PluginSpec.Action(f.StateTransforms.Model.StructureFromModel),l.PluginSpec.Action(f.StateTransforms.Model.ModelFromTrajectory),l.PluginSpec.Action(f.StateTransforms.Volume.VolumeFromCcp4),l.PluginSpec.Action(f.StateTransforms.Representation.StructureRepresentation3D),l.PluginSpec.Action(f.StateTransforms.Representation.ExplodeStructureRepresentation3D),l.PluginSpec.Action(f.StateTransforms.Representation.VolumeRepresentation3D)],behaviors:[l.PluginSpec.Behavior(d.PluginBehaviors.Representation.HighlightLoci),l.PluginSpec.Behavior(d.PluginBehaviors.Representation.SelectLoci),l.PluginSpec.Behavior(d.PluginBehaviors.Representation.DefaultLociLabelProvider),l.PluginSpec.Behavior(d.PluginBehaviors.Camera.FocusLociOnSelect,{minRadius:20,extraRadius:4}),l.PluginSpec.Behavior(d.PluginBehaviors.Animation.StructureAnimation,{rotate:!1,rotateValue:0,explode:!1,explodeValue:0}),l.PluginSpec.Behavior(d.PluginBehaviors.Labels.SceneLabels),l.PluginSpec.Behavior(d.PluginBehaviors.CustomProps.PDBeStructureQualityReport,{autoAttach:!0}),l.PluginSpec.Behavior(d.PluginBehaviors.CustomProps.RCSBAssemblySymmetry,{autoAttach:!0})],animations:[p.AnimateModelIndex]},t.createPlugin=function(e,n){var l=new a.PluginContext(n||t.DefaultPluginSpec);return s.render(u.createElement(o.Plugin,{plugin:l}),e),function(e){r(this,void 0,void 0,function(){var t,n;return i(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),i=new RegExp("snapshot-url=([^&]+)[&]?","i"),(t=decodeURIComponent(((window.location.search||"").match(i)||[])[1]||""))?[4,c.PluginCommands.State.Snapshots.Fetch.dispatch(e,{url:t})]:[2];case 1:return r.sent(),[3,3];case 2:return n=r.sent(),e.log.error("Failed to load snapshot."),console.warn("Failed to load snapshot",n),[3,3];case 3:return[2]}var i})})}(l),l}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{s(r.next(e))}catch(e){a(e)}}function u(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,u)}s((r=r.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}};Object.defineProperty(t,"__esModule",{value:!0});var a=n(217),o=n(16),u=n(435),s=n(124),c=n(144),l=n(263),f=n(99),d=n(39),p=n(148),h=n(37),m=n(507),y=n(509),v=n(18),b=n(510),g=n(153),_=n(281),S=n(513),C=n(284),x=n(74),w=n(285),P=n(85),T=n(543),A=function(){function e(e){var t=this;this.spec=e,this.disposed=!1,this.ev=f.RxEventHelper.create(),this.tasks=new y.TaskManager,this.state=new m.PluginState(this),this.commands=new h.PluginCommand.Manager,this.events={state:{cell:{stateUpdated:d.merge(this.state.dataState.events.cell.stateUpdated,this.state.behaviorState.events.cell.stateUpdated),created:d.merge(this.state.dataState.events.cell.created,this.state.behaviorState.events.cell.created),removed:d.merge(this.state.dataState.events.cell.removed,this.state.behaviorState.events.cell.removed)},object:{created:d.merge(this.state.dataState.events.object.created,this.state.behaviorState.events.object.created),removed:d.merge(this.state.dataState.events.object.removed,this.state.behaviorState.events.object.removed),updated:d.merge(this.state.dataState.events.object.updated,this.state.behaviorState.events.object.updated)},cameraSnapshots:this.state.cameraSnapshots.events,snapshots:this.state.snapshots.events},log:this.ev(),task:this.tasks.events,labels:{highlight:this.ev()},canvad3d:{settingsUpdated:this.ev()}},this.behaviors={canvas:{highlightLoci:this.ev.behavior({loci:o.EmptyLoci}),selectLoci:this.ev.behavior({loci:o.EmptyLoci})},command:this.commands.behaviour},this.layout=new C.PluginLayout(this),this.structureRepresentation={registry:new u.StructureRepresentationRegistry,themeCtx:{colorThemeRegistry:s.ColorTheme.createRegistry(),sizeThemeRegistry:c.SizeTheme.createRegistry()}},this.volumeRepresentation={registry:new _.VolumeRepresentationRegistry,themeCtx:{colorThemeRegistry:s.ColorTheme.createRegistry(),sizeThemeRegistry:c.SizeTheme.createRegistry()}},this.dataFormat={registry:new w.DataFormatRegistry},this.customModelProperties=new T.CustomPropertyRegistry,this.customParamEditors=new Map,this.log={entries:x.List(),entry:function(e){return t.events.log.next(e)},error:function(e){return t.events.log.next(l.LogEntry.error(e))},message:function(e){return t.events.log.next(l.LogEntry.message(e))},info:function(e){return t.events.log.next(l.LogEntry.info(e))},warn:function(e){return t.events.log.next(l.LogEntry.warning(e))}},this.events.log.subscribe(function(e){return t.log.entries=t.log.entries.push(e)}),this.initBuiltInBehavior(),this.initBehaviors(),this.initDataActions(),this.initAnimations(),this.initCustomParamEditors(),this.lociLabels=new b.LociLabelManager(this),this.log.message("Mol* Plugin "+S.PLUGIN_VERSION+" ["+S.PLUGIN_VERSION_DATE.toLocaleString()+"]")}return e.prototype.initViewer=function(e,t){try{return this.layout.setRoot(t),this.spec.initialLayout&&this.layout.setProps(this.spec.initialLayout),this.canvas3d=a.Canvas3D.create(e,t),h.PluginCommands.Canvas3D.SetSettings.dispatch(this,{settings:{backgroundColor:v.Color(16579577)}}),this.canvas3d.animate(),!0}catch(e){return this.log.error(""+e),console.error(e),!1}},e.prototype.fetch=function(e,t,n){return void 0===t&&(t="string"),g.ajaxGet({url:e,type:t,body:n})},e.prototype.runTask=function(e){return this.tasks.run(e)},e.prototype.dispose=function(){this.disposed||(this.commands.dispose(),this.canvas3d.dispose(),this.ev.dispose(),this.state.dispose(),this.tasks.dispose(),this.layout.dispose(),this.disposed=!0)},e.prototype.applyTransform=function(e,t,n,r){var i=e.build().to(t).apply(n,r);return h.PluginCommands.State.Update.dispatch(this,{state:e,tree:i})},e.prototype.updateTransform=function(e,t,n){var r=e.build().to(t).update(n);return h.PluginCommands.State.Update.dispatch(this,{state:e,tree:r})},e.prototype.initBuiltInBehavior=function(){var e=this;p.BuiltInPluginBehaviors.State.registerDefault(this),p.BuiltInPluginBehaviors.Representation.registerDefault(this),p.BuiltInPluginBehaviors.Camera.registerDefault(this),p.BuiltInPluginBehaviors.Misc.registerDefault(this),d.merge(this.state.dataState.events.log,this.state.behaviorState.events.log).subscribe(function(t){return e.events.log.next(t)})},e.prototype.initBehaviors=function(){return r(this,void 0,void 0,function(){var e,t,n,r,a,o,u;return i(this,function(i){switch(i.label){case 0:for(e=this.state.behaviorState.build(),t=0,n=Object.keys(P.PluginBehavior.Categories);t<n.length;t++)r=n[t],e.toRoot().apply(P.PluginBehavior.CreateCategory,{label:P.PluginBehavior.Categories[r]},{ref:r,props:{isLocked:!0}});for(a=0,o=this.spec.behaviors;a<o.length;a++)u=o[a],e.to(P.PluginBehavior.getCategoryId(u.transformer)).apply(u.transformer,u.defaultParams,{ref:u.transformer.id});return[4,this.runTask(this.state.behaviorState.updateTree(e,!0))];case 1:return i.sent(),[2]}})})},e.prototype.initDataActions=function(){for(var e=0,t=this.spec.actions;e<t.length;e++){var n=t[e];this.state.dataState.actions.add(n.action)}},e.prototype.initAnimations=function(){if(this.spec.animations)for(var e=0,t=this.spec.animations;e<t.length;e++){var n=t[e];this.state.animation.register(n)}},e.prototype.initCustomParamEditors=function(){if(this.spec.customParamEditors)for(var e=0,t=this.spec.customParamEditors;e<t.length;e++){var n=t[e],r=n[0],i=n[1];this.customParamEditors.set(r.id,i)}},e}();t.PluginContext=A},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.equalEps=function(e,t,n){return Math.abs(e-t)<=n}},function(e,t,n){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),function(e){function t(){var e=[.1,0];return e[0]=0,e}e.zero=t,e.clone=function(e){var n=t();return n[0]=e[0],n[1]=e[1],n},e.create=function(e,n){var r=t();return r[0]=e,r[1]=n,r},e.hasNaN=function(e){return isNaN(e[0])||isNaN(e[1])},e.toArray=function(e,t,n){t[n+0]=e[0],t[n+1]=e[1]},e.fromArray=function(e,t,n){return e[0]=t[n+0],e[1]=t[n+1],e},e.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e},e.set=function(e,t,n){return e[0]=t,e[1]=n,e},e.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e},e.sub=function(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e},e.mul=function(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e},e.div=function(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e},e.scale=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e},e.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e},e.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e},e.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e},e.distance=function(e,t){var n=t[0]-e[0],r=t[1]-e[1];return Math.sqrt(n*n+r*r)},e.squaredDistance=function(e,t){var n=t[0]-e[0],r=t[1]-e[1];return n*n+r*r},e.magnitude=function(e){var t=e[0],n=e[1];return Math.sqrt(t*t+n*n)},e.squaredMagnitude=function(e){var t=e[0],n=e[1];return t*t+n*n},e.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e},e.areEqual=function(e,t){return e[0]===t[0]&&e[1]===t[1]}}(r||(r={})),t.default=r},function(e,t,n){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),function(e){function t(){var e=[.1,0,0,0];return e[0]=0,e}e.zero=t,e.clone=function(e){var n=t();return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n},e.create=function(e,n,r,i){var a=t();return a[0]=e,a[1]=n,a[2]=r,a[3]=i,a},e.hasNaN=function(e){return isNaN(e[0])||isNaN(e[1])||isNaN(e[2])||isNaN(e[3])},e.toArray=function(e,t,n){t[n+0]=e[0],t[n+1]=e[1],t[n+2]=e[2],t[n+3]=e[3]},e.fromArray=function(e,t,n){return e[0]=t[n+0],e[1]=t[n+1],e[2]=t[n+2],e[3]=t[n+3],e},e.toVec3Array=function(e,t,n){t[n+0]=e[0],t[n+1]=e[1],t[n+2]=e[2]},e.fromVec3Array=function(e,t,n){return e[0]=t[n+0],e[1]=t[n+1],e[2]=t[n+2],e[3]=0,e},e.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},e.set=function(e,t,n,r,i){return e[0]=t,e[1]=n,e[2]=r,e[3]=i,e},e.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e},e.distance=function(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2],a=t[3]-e[3];return Math.sqrt(n*n+r*r+i*i+a*a)},e.scale=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[4]=t[4]*n,e},e.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e},e.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e},e.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e},e.squaredDistance=function(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2],a=t[3]-e[3];return n*n+r*r+i*i+a*a},e.norm=function(e){var t=e[0],n=e[1],r=e[2],i=e[3];return Math.sqrt(t*t+n*n+r*r+i*i)},e.squaredNorm=function(e){var t=e[0],n=e[1],r=e[2],i=e[3];return t*t+n*n+r*r+i*i},e.transformMat4=function(e,t,n){var r=t[0],i=t[1],a=t[2],o=t[3];return e[0]=n[0]*r+n[4]*i+n[8]*a+n[12]*o,e[1]=n[1]*r+n[5]*i+n[9]*a+n[13]*o,e[2]=n[2]*r+n[6]*i+n[10]*a+n[14]*o,e[3]=n[3]*r+n[7]*i+n[11]*a+n[15]*o,e},e.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},e.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e},e.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},e.equals=function(e,t){var n=e[0],r=e[1],i=e[2],a=e[3],o=t[0],u=t[1],s=t[2],c=t[3];return Math.abs(n-o)<=1e-6*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(r-u)<=1e-6*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(i-s)<=1e-6*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(a-c)<=1e-6*Math.max(1,Math.abs(a),Math.abs(c))}}(r||(r={})),t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(219),i=n(180);function a(){return a.zero()}!function(e){function t(){var e=[.1,0,0,0];return e[0]=0,e}function n(){var e=t();return e[3]=1,e}function a(e,t,n){n*=.5;var r=Math.sin(n);return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=Math.cos(n),e}function o(e,t,n,r){var i,a,o,u,s,c=t[0],l=t[1],f=t[2],d=t[3],p=n[0],h=n[1],m=n[2],y=n[3];return(a=c*p+l*h+f*m+d*y)<0&&(a=-a,p=-p,h=-h,m=-m,y=-y),1-a>1e-6?(i=Math.acos(a),o=Math.sin(i),u=Math.sin((1-r)*i)/o,s=Math.sin(r*i)/o):(u=1-r,s=r),e[0]=u*c+s*p,e[1]=u*l+s*h,e[2]=u*f+s*m,e[3]=u*d+s*y,e}e.zero=t,e.identity=n,e.setIdentity=function(e){e[0]=0,e[1]=0,e[2]=0,e[3]=1},e.hasNaN=function(e){return isNaN(e[0])||isNaN(e[1])||isNaN(e[2])||isNaN(e[3])},e.create=function(e,t,r,i){var a=n();return a[0]=e,a[1]=t,a[2]=r,a[3]=i,a},e.setAxisAngle=a,e.getAxisAngle=function(e,t){var n=2*Math.acos(t[3]),r=Math.sin(n/2);return 0!==r?(e[0]=t[0]/r,e[1]=t[1]/r,e[2]=t[2]/r):(e[0]=1,e[1]=0,e[2]=0),n},e.multiply=function(e,t,n){var r=t[0],i=t[1],a=t[2],o=t[3],u=n[0],s=n[1],c=n[2],l=n[3];return e[0]=r*l+o*u+i*c-a*s,e[1]=i*l+o*s+a*u-r*c,e[2]=a*l+o*c+r*s-i*u,e[3]=o*l-r*u-i*s-a*c,e},e.rotateX=function(e,t,n){n*=.5;var r=t[0],i=t[1],a=t[2],o=t[3],u=Math.sin(n),s=Math.cos(n);return e[0]=r*s+o*u,e[1]=i*s+a*u,e[2]=a*s-i*u,e[3]=o*s-r*u,e},e.rotateY=function(e,t,n){n*=.5;var r=t[0],i=t[1],a=t[2],o=t[3],u=Math.sin(n),s=Math.cos(n);return e[0]=r*s-a*u,e[1]=i*s+o*u,e[2]=a*s+r*u,e[3]=o*s-i*u,e},e.rotateZ=function(e,t,n){n*=.5;var r=t[0],i=t[1],a=t[2],o=t[3],u=Math.sin(n),s=Math.cos(n);return e[0]=r*s+i*u,e[1]=i*s-r*u,e[2]=a*s+o*u,e[3]=o*s-a*u,e},e.calculateW=function(e,t){var n=t[0],r=t[1],i=t[2];return e[0]=n,e[1]=r,e[2]=i,e[3]=Math.sqrt(Math.abs(1-n*n-r*r-i*i)),e},e.slerp=o,e.invert=function(e,t){var n=t[0],r=t[1],i=t[2],a=t[3],o=n*n+r*r+i*i+a*a,u=o?1/o:0;return e[0]=-n*u,e[1]=-r*u,e[2]=-i*u,e[3]=a*u,e},e.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},e.fromMat3=function(e,t){var n,r=t[0]+t[4]+t[8];if(r>0)n=Math.sqrt(r+1),e[3]=.5*n,n=.5/n,e[0]=(t[5]-t[7])*n,e[1]=(t[6]-t[2])*n,e[2]=(t[1]-t[3])*n;else{var i=0;t[4]>t[0]&&(i=1),t[8]>t[3*i+i]&&(i=2);var a=(i+1)%3,o=(i+2)%3;n=Math.sqrt(t[3*i+i]-t[3*a+a]-t[3*o+o]+1),e[i]=.5*n,n=.5/n,e[3]=(t[3*a+o]-t[3*o+a])*n,e[a]=(t[3*a+i]+t[3*i+a])*n,e[o]=(t[3*o+i]+t[3*i+o])*n}return e};var u=i.default.zero();function s(e,t){var n=t[0],r=t[1],i=t[2],a=t[3],o=n*n+r*r+i*i+a*a;return o>0&&(o=1/Math.sqrt(o),e[0]=n*o,e[1]=r*o,e[2]=i*o,e[3]=a*o),e}e.fromUnitVec3=function(e,t,n){var r=i.default.dot(t,n)+1;return r<1e-6?(r=0,Math.abs(t[0])>Math.abs(t[2])?i.default.set(u,-t[1],t[0],0):i.default.set(u,0,-t[2],t[1])):i.default.cross(u,t,n),e[0]=u[0],e[1]=u[1],e[2]=u[2],e[3]=r,s(e,e),e},e.clone=function(e){var n=t();return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n},e.toArray=function(e,t,n){t[n+0]=e[0],t[n+1]=e[1],t[n+2]=e[2],t[n+3]=e[3]},e.fromArray=function(e,t,n){return e[0]=t[n+0],e[1]=t[n+1],e[2]=t[n+2],e[3]=t[n+3],e},e.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},e.set=function(e,t,n,r,i){return e[0]=t,e[1]=n,e[2]=r,e[3]=i,e},e.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e},e.normalize=s;var c=i.default.zero(),l=i.default.create(1,0,0),f=i.default.create(0,1,0);e.rotationTo=function(e,t,n){var r=i.default.dot(t,n);return r<-.999999?(i.default.cross(c,l,t),i.default.magnitude(c)<1e-6&&i.default.cross(c,f,t),i.default.normalize(c,c),a(e,c,Math.PI),e):r>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(i.default.cross(c,t,n),e[0]=c[0],e[1]=c[1],e[2]=c[2],e[3]=1+r,s(e,e))};var d=e.zero(),p=e.zero();e.sqlerp=function(e,t,n,r,i,a){return o(d,t,i,a),o(p,n,r,a),o(e,d,p,2*a*(1-a)),e};var h=r.default.zero();e.setAxes=function(t,n,r,i){return h[0]=r[0],h[3]=r[1],h[6]=r[2],h[1]=i[0],h[4]=i[1],h[7]=i[2],h[2]=-n[0],h[5]=-n[1],h[8]=-n[2],s(t,e.fromMat3(t,h))}}(a||(a={})),t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(90);!function(e){function t(e,t,r){var a=function(e,t,n){for(var r=[],i=0;i<t.length;i++)r[i]=t[t.length-i-1];var a=[1];for(i=1;i<e.length;i++)a[i]=e[r[i-1]];return{dimensions:e,axisOrderFastToSlow:r,axisOrderSlowToFast:t,accessDimensions:a,defaultCtor:n||Float64Array}}(e,t,r),o=function(e){var t=e.dimensions,n=e.axisOrderFastToSlow;switch(t.length){case 1:return{get:function(e,t){return e[t]},set:function(e,t,n){return e[t]=n},add:function(e,t,n){return e[t]+=n}};case 2:if(0===n[0]&&1===n[1]){var r=t[0];return{get:function(e,t,n){return e[n*r+t]},set:function(e,t,n,i){return e[n*r+t]=i},add:function(e,t,n,i){return e[n*r+t]+=i}}}if(1===n[0]&&0===n[1]){var a=t[1];return{get:function(e,t,n){return e[t*a+n]},set:function(e,t,n,r){return e[t*a+n]=r},add:function(e,t,n,r){return e[t*a+n]+=r}}}throw new Error("bad axis order");case 3:if(0===n[0]&&1===n[1]&&2===n[2]){var o=t[0],u=t[1],s=o*u;return{get:function(e,t,n,r){return e[t+n*o+r*s]},set:function(e,t,n,r,i){return e[t+n*o+r*s]=i},add:function(e,t,n,r,i){return e[t+n*o+r*s]+=i}}}if(0===n[0]&&2===n[1]&&1===n[2]){var c=t[0],u=t[2],l=c*u;return{get:function(e,t,n,r){return e[t+r*c+n*l]},set:function(e,t,n,r,i){return e[t+r*c+n*l]=i},add:function(e,t,n,r,i){return e[t+r*c+n*l]+=i}}}if(1===n[0]&&0===n[1]&&2===n[2]){var f=t[1],u=t[0],d=f*u;return{get:function(e,t,n,r){return e[n+t*f+r*d]},set:function(e,t,n,r,i){return e[n+t*f+r*d]=i},add:function(e,t,n,r,i){return e[n+t*f+r*d]+=i}}}if(1===n[0]&&2===n[1]&&0===n[2]){var p=t[1],u=t[2],h=p*u;return{get:function(e,t,n,r){return e[n+r*p+t*h]},set:function(e,t,n,r,i){return e[n+r*p+t*h]=i},add:function(e,t,n,r,i){return e[n+r*p+t*h]+=i}}}if(2===n[0]&&0===n[1]&&1===n[2]){var m=t[2],u=t[0],y=m*u;return{get:function(e,t,n,r){return e[r+t*m+n*y]},set:function(e,t,n,r,i){return e[r+t*m+n*y]=i},add:function(e,t,n,r,i){return e[r+t*m+n*y]+=i}}}if(2===n[0]&&1===n[1]&&0===n[2]){var v=t[2],u=t[1],b=v*u;return{get:function(e,t,n,r){return e[r+n*v+t*b]},set:function(e,t,n,r,i){return e[r+n*v+t*b]=i},add:function(e,t,n,r,i){return e[r+n*v+t*b]+=i}}}throw new Error("bad axis order");default:return{get:function(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];return t[i(e,n)]},set:function(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];return t[i(e,n)]=n[n.length-1]},add:function(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];return t[i(e,n)]+=n[n.length-1]}}}}(a),u=o.get,s=o.set,c=o.add;return{rank:e.length,dimensions:e,axisOrderSlowToFast:t,create:n(a),get:u,set:s,add:c}}function n(e){for(var t=e.dimensions,n=1,r=0,i=t.length;r<i;r++)n*=t[r];return function(t){return new(t||e.defaultCtor)(n)}}function i(e,t){for(var n=e.accessDimensions,r=e.axisOrderFastToSlow,i=n.length-1,a=n[i]*t[r[i]],o=i-1;o>=0;o--)a=(a+t[r[o]])*n[o];return a}function a(e,t){for(var n=[],r=0;r<e.length;r++)n[r]=e[t[r]];return n}e.create=function(e,t){return{space:e,data:t}},e.Space=t,e.Data1=function(e){return e},e.Vector=function(e,n){return t([e],[0],n)},e.ColumnMajorMatrix=function(e,n,r){return t([e,n],[1,0],r)},e.RowMajorMatrix=function(e,n,r){return t([e,n],[0,1],r)},e.toMat4=function(e,t){if(2!==e.rank)throw new Error("Invalid tensor rank");for(var n=r.Mat4.zero(),i=Math.min(4,e.dimensions[0]),a=Math.min(4,e.dimensions[1]),o=0;o<i;o++)for(var u=0;u<a;u++)r.Mat4.setValue(n,o,u,e.get(t,o,u));return n},e.toMat3=function(e,t){if(2!==e.rank)throw new Error("Invalid tensor rank");for(var n=r.Mat3.zero(),i=Math.min(3,e.dimensions[0]),a=Math.min(3,e.dimensions[1]),o=0;o<i;o++)for(var u=0;u<a;u++)r.Mat3.setValue(n,o,u,e.get(t,o,u));return n},e.toVec3=function(e,t){if(1!==e.rank)throw new Error("Invalid tensor rank");for(var n=r.Vec3.zero(),i=Math.min(3,e.dimensions[0]),a=0;a<i;a++)n[a]=t[a];return n},e.toVec4=function(e,t){if(1!==e.rank)throw new Error("Invalid tensor rank");for(var n=r.Vec4.zero(),i=Math.min(4,e.dimensions[0]),a=0;a<i;a++)n[a]=t[a];return n},e.areEqualExact=function(e,t){var n=e.length;if(n!==t.length)return!1;for(var r=0;r<n;r++)if(e[r]!==t[r])return!1;return!0},e.invertAxisOrder=function(e){for(var t=[],n=0;n<e.length;n++)t[n]=e[e.length-n-1];return t},e.convertToCanonicalAxisIndicesFastToSlow=function(e){for(var t=new Int32Array(e.length),n=0;n<e.length;n++)t[e[n]]=n;return function(e){return a(e,t)}},e.convertToCanonicalAxisIndicesSlowToFast=function(e){for(var t=new Int32Array(e.length),n=0;n<e.length;n++)t[e[e.length-n-1]]=n;return function(e){return a(e,t)}}}(t.Tensor||(t.Tensor={}))},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i,a=n(39),o=n(2),u=n(7);function s(e){if("object"==typeof e){if("buttons"in e)return e.buttons;if("which"in e){if(2===(t=e.which))return 4;if(3===t)return 2;if(t>0)return 1<<t-1}else if("button"in e){var t;if(1===(t=e.button))return 4;if(2===t)return 2;if(t>=0)return 1<<t}}return 0}t.DefaultInputObserverProps={noScroll:!0,noContextMenu:!0},function(e){e.has=u.BitFlags.has,e.create=u.BitFlags.create}(t.ButtonsType||(t.ButtonsType={})),function(e){e.create=function(e,n){void 0===n&&(n={});var i=r({},t.DefaultInputObserverProps,n),u=i.noScroll,c=i.noContextMenu,l=0,f=o.Vec2.zero(),d=o.Vec2.zero(),p=o.Vec2.zero(),h=o.Vec2.zero(),m=o.Vec2.zero(),y={shift:!1,alt:!1,control:!1,meta:!1},v=0,b=!1,g=0,_=new a.Subject,S=new a.Subject,C=new a.Subject,x=new a.Subject,w=new a.Subject,P=new a.Subject,T=new a.Subject,A=new a.Subject,E=new a.Subject;return e.addEventListener("contextmenu",k,!1),e.addEventListener("wheel",U,!1),e.addEventListener("mousedown",j,!1),window.addEventListener("mousemove",N,!1),window.addEventListener("mouseup",B,!1),e.addEventListener("mouseenter",G,!1),e.addEventListener("mouseleave",q,!1),e.addEventListener("touchstart",O,!1),e.addEventListener("touchmove",R,!1),e.addEventListener("touchend",D,!1),e.addEventListener("blur",I),e.addEventListener("keyup",M),e.addEventListener("keydown",M),e.addEventListener("keypress",M),window.addEventListener("resize",H,!1),{get noScroll(){return u},set noScroll(e){u=e},get noContextMenu(){return c},set noContextMenu(e){c=e},drag:_,interactionEnd:S,wheel:w,pinch:P,click:C,move:x,leave:A,enter:E,resize:T,dispose:function(){b||(b=!0,e.removeEventListener("contextmenu",k,!1),e.removeEventListener("wheel",U,!1),e.removeEventListener("mousedown",j,!1),window.removeEventListener("mousemove",N,!1),window.removeEventListener("mouseup",B,!1),e.removeEventListener("mouseenter",G,!1),e.removeEventListener("mouseleave",q,!1),e.removeEventListener("touchstart",O,!1),e.removeEventListener("touchmove",R,!1),e.removeEventListener("touchend",D,!1),e.removeEventListener("blur",I),e.removeEventListener("keyup",M),e.removeEventListener("keydown",M),e.removeEventListener("keypress",M),window.removeEventListener("resize",H,!1))}};function k(e){c&&e.preventDefault()}function I(){(g||y.shift||y.alt||y.meta||y.control)&&(g=0,y.shift=y.alt=y.control=y.meta=!1)}function M(e){"altKey"in e&&(y.alt=!!e.altKey),"shiftKey"in e&&(y.shift=!!e.shiftKey),"ctrlKey"in e&&(y.control=!!e.ctrlKey),"metaKey"in e&&(y.meta=!!e.metaKey)}function V(e){var t=e.touches[0],n=e.touches[1];return{clientX:(t.clientX+n.clientX)/2,clientY:(t.clientY+n.clientY)/2,pageX:(t.pageX+n.pageX)/2,pageY:(t.pageY+n.pageY)/2}}function O(e){1===e.touches.length?(g=1,L(e.touches[0])):e.touches.length>=2&&(g=2,L(V(e)),P.next({distance:l,delta:0,isStart:!0}))}function D(e){F()}function R(e){if(1===e.touches.length)g=1,z(e.touches[0]);else if(e.touches.length>=2){var t=function(e){var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY;return Math.sqrt(t*t+n*n)}(e);l-t<4?(g=2,z(V(e))):P.next({delta:l-t,distance:t,isStart:!1}),l=t}}function j(e){g=s(e),L(e)}function N(e){g=s(e),z(e)}function B(e){!function(e){if(v=0,Y(p,e),o.Vec2.distance(p,f)<4){var t=e.pageX,n=e.pageY,r=p[0],i=p[1];C.next({x:r,y:i,pageX:t,pageY:n,buttons:g,modifiers:y})}}(e),F()}function F(){S.next()}function L(e){Y(d,e),o.Vec2.copy(f,d),W(d)&&(v=1)}function z(t){Y(p,t);var n=t.pageX,r=t.pageY,i=p[0],a=p[1],u=W(p);if(x.next({x:i,y:a,pageX:n,pageY:r,buttons:g,modifiers:y,inside:u}),0!==v){var s;o.Vec2.div(h,o.Vec2.sub(h,p,d),((s=m)[0]=e.clientWidth,s[1]=e.clientHeight,s));var c=1===v,l=h[0],f=h[1];_.next({x:i,y:a,dx:l,dy:f,pageX:n,pageY:r,buttons:g,modifiers:y,isStart:c}),o.Vec2.copy(d,p),v=2}}function U(e){u&&e.preventDefault();var t=1;switch(e.deltaMode){case 0:t=1;break;case 1:t=40;break;case 2:t=800}var n=(e.deltaX||0)*t,r=(e.deltaY||0)*t,i=(e.deltaZ||0)*t;(n||r||i)&&w.next({dx:n,dy:r,dz:i,buttons:g,modifiers:y})}function G(e){E.next()}function q(e){A.next()}function H(e){T.next()}function W(t){if(e instanceof Window||e instanceof Document||e===document.body)return!0;var n=e.getBoundingClientRect();return t[0]>=0&&t[1]>=0&&t[0]<n.width&&t[1]<n.height}function Y(t,n){var r=n.clientX||0,i=n.clientY||0,a=e.getBoundingClientRect();return t[0]=r-a.left,t[1]=i-a.top,t}}}(i||(i={})),t.default=i},function(e,t,n){"use strict";(function(e){
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */
var r=n(308),i=n(309),a=n(310);function o(){return s.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function u(e,t){if(o()<t)throw new RangeError("Invalid typed array length");return s.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=s.prototype:(null===e&&(e=new s(t)),e.length=t),e}function s(e,t,n){if(!(s.TYPED_ARRAY_SUPPORT||this instanceof s))return new s(e,t,n);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return f(this,e)}return c(this,e,t,n)}function c(e,t,n,r){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,n,r){if(t.byteLength,n<0||t.byteLength<n)throw new RangeError("'offset' is out of bounds");if(t.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");t=void 0===n&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,n):new Uint8Array(t,n,r);s.TYPED_ARRAY_SUPPORT?(e=t).__proto__=s.prototype:e=d(e,t);return e}(e,t,n,r):"string"==typeof t?function(e,t,n){"string"==typeof n&&""!==n||(n="utf8");if(!s.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|h(t,n),i=(e=u(e,r)).write(t,n);i!==r&&(e=e.slice(0,i));return e}(e,t,n):function(e,t){if(s.isBuffer(t)){var n=0|p(t.length);return 0===(e=u(e,n)).length?e:(t.copy(e,0,0,n),e)}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(r=t.length)!=r?u(e,0):d(e,t);if("Buffer"===t.type&&a(t.data))return d(e,t.data)}var r;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function l(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function f(e,t){if(l(t),e=u(e,t<0?0:0|p(t)),!s.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function d(e,t){var n=t.length<0?0:0|p(t.length);e=u(e,n);for(var r=0;r<n;r+=1)e[r]=255&t[r];return e}function p(e){if(e>=o())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o().toString(16)+" bytes");return 0|e}function h(e,t){if(s.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var r=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return L(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return z(e).length;default:if(r)return L(e).length;t=(""+t).toLowerCase(),r=!0}}function m(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function y(e,t,n,r,i){if(0===e.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=i?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(i)return-1;n=e.length-1}else if(n<0){if(!i)return-1;n=0}if("string"==typeof t&&(t=s.from(t,r)),s.isBuffer(t))return 0===t.length?-1:v(e,t,n,r,i);if("number"==typeof t)return t&=255,s.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):v(e,[t],n,r,i);throw new TypeError("val must be string, number or Buffer")}function v(e,t,n,r,i){var a,o=1,u=e.length,s=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;o=2,u/=2,s/=2,n/=2}function c(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(i){var l=-1;for(a=n;a<u;a++)if(c(e,a)===c(t,-1===l?0:a-l)){if(-1===l&&(l=a),a-l+1===s)return l*o}else-1!==l&&(a-=a-l),l=-1}else for(n+s>u&&(n=u-s),a=n;a>=0;a--){for(var f=!0,d=0;d<s;d++)if(c(e,a+d)!==c(t,d)){f=!1;break}if(f)return a}return-1}function b(e,t,n,r){n=Number(n)||0;var i=e.length-n;r?(r=Number(r))>i&&(r=i):r=i;var a=t.length;if(a%2!=0)throw new TypeError("Invalid hex string");r>a/2&&(r=a/2);for(var o=0;o<r;++o){var u=parseInt(t.substr(2*o,2),16);if(isNaN(u))return o;e[n+o]=u}return o}function g(e,t,n,r){return U(L(t,e.length-n),e,n,r)}function _(e,t,n,r){return U(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}function S(e,t,n,r){return _(e,t,n,r)}function C(e,t,n,r){return U(z(t),e,n,r)}function x(e,t,n,r){return U(function(e,t){for(var n,r,i,a=[],o=0;o<e.length&&!((t-=2)<0);++o)n=e.charCodeAt(o),r=n>>8,i=n%256,a.push(i),a.push(r);return a}(t,e.length-n),e,n,r)}function w(e,t,n){return 0===t&&n===e.length?r.fromByteArray(e):r.fromByteArray(e.slice(t,n))}function P(e,t,n){n=Math.min(e.length,n);for(var r=[],i=t;i<n;){var a,o,u,s,c=e[i],l=null,f=c>239?4:c>223?3:c>191?2:1;if(i+f<=n)switch(f){case 1:c<128&&(l=c);break;case 2:128==(192&(a=e[i+1]))&&(s=(31&c)<<6|63&a)>127&&(l=s);break;case 3:a=e[i+1],o=e[i+2],128==(192&a)&&128==(192&o)&&(s=(15&c)<<12|(63&a)<<6|63&o)>2047&&(s<55296||s>57343)&&(l=s);break;case 4:a=e[i+1],o=e[i+2],u=e[i+3],128==(192&a)&&128==(192&o)&&128==(192&u)&&(s=(15&c)<<18|(63&a)<<12|(63&o)<<6|63&u)>65535&&s<1114112&&(l=s)}null===l?(l=65533,f=1):l>65535&&(l-=65536,r.push(l>>>10&1023|55296),l=56320|1023&l),r.push(l),i+=f}return function(e){var t=e.length;if(t<=T)return String.fromCharCode.apply(String,e);var n="",r=0;for(;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=T));return n}(r)}t.Buffer=s,t.SlowBuffer=function(e){+e!=e&&(e=0);return s.alloc(+e)},t.INSPECT_MAX_BYTES=50,s.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),t.kMaxLength=o(),s.poolSize=8192,s._augment=function(e){return e.__proto__=s.prototype,e},s.from=function(e,t,n){return c(null,e,t,n)},s.TYPED_ARRAY_SUPPORT&&(s.prototype.__proto__=Uint8Array.prototype,s.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&s[Symbol.species]===s&&Object.defineProperty(s,Symbol.species,{value:null,configurable:!0})),s.alloc=function(e,t,n){return function(e,t,n,r){return l(t),t<=0?u(e,t):void 0!==n?"string"==typeof r?u(e,t).fill(n,r):u(e,t).fill(n):u(e,t)}(null,e,t,n)},s.allocUnsafe=function(e){return f(null,e)},s.allocUnsafeSlow=function(e){return f(null,e)},s.isBuffer=function(e){return!(null==e||!e._isBuffer)},s.compare=function(e,t){if(!s.isBuffer(e)||!s.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,r=t.length,i=0,a=Math.min(n,r);i<a;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return n<r?-1:r<n?1:0},s.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},s.concat=function(e,t){if(!a(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return s.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var r=s.allocUnsafe(t),i=0;for(n=0;n<e.length;++n){var o=e[n];if(!s.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(r,i),i+=o.length}return r},s.byteLength=h,s.prototype._isBuffer=!0,s.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)m(this,t,t+1);return this},s.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)m(this,t,t+3),m(this,t+1,t+2);return this},s.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)m(this,t,t+7),m(this,t+1,t+6),m(this,t+2,t+5),m(this,t+3,t+4);return this},s.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?P(this,0,e):function(e,t,n){var r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return k(this,t,n);case"utf8":case"utf-8":return P(this,t,n);case"ascii":return A(this,t,n);case"latin1":case"binary":return E(this,t,n);case"base64":return w(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return I(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}.apply(this,arguments)},s.prototype.equals=function(e){if(!s.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===s.compare(this,e)},s.prototype.inspect=function(){var e="",n=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,n).match(/.{2}/g).join(" "),this.length>n&&(e+=" ... ")),"<Buffer "+e+">"},s.prototype.compare=function(e,t,n,r,i){if(!s.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),t<0||n>e.length||r<0||i>this.length)throw new RangeError("out of range index");if(r>=i&&t>=n)return 0;if(r>=i)return-1;if(t>=n)return 1;if(this===e)return 0;for(var a=(i>>>=0)-(r>>>=0),o=(n>>>=0)-(t>>>=0),u=Math.min(a,o),c=this.slice(r,i),l=e.slice(t,n),f=0;f<u;++f)if(c[f]!==l[f]){a=c[f],o=l[f];break}return a<o?-1:o<a?1:0},s.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},s.prototype.indexOf=function(e,t,n){return y(this,e,t,n,!0)},s.prototype.lastIndexOf=function(e,t,n){return y(this,e,t,n,!1)},s.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var i=this.length-t;if((void 0===n||n>i)&&(n=i),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var a=!1;;)switch(r){case"hex":return b(this,e,t,n);case"utf8":case"utf-8":return g(this,e,t,n);case"ascii":return _(this,e,t,n);case"latin1":case"binary":return S(this,e,t,n);case"base64":return C(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return x(this,e,t,n);default:if(a)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),a=!0}},s.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var T=4096;function A(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(127&e[i]);return r}function E(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(e[i]);return r}function k(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);for(var i="",a=t;a<n;++a)i+=F(e[a]);return i}function I(e,t,n){for(var r=e.slice(t,n),i="",a=0;a<r.length;a+=2)i+=String.fromCharCode(r[a]+256*r[a+1]);return i}function M(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function V(e,t,n,r,i,a){if(!s.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<a)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function O(e,t,n,r){t<0&&(t=65535+t+1);for(var i=0,a=Math.min(e.length-n,2);i<a;++i)e[n+i]=(t&255<<8*(r?i:1-i))>>>8*(r?i:1-i)}function D(e,t,n,r){t<0&&(t=4294967295+t+1);for(var i=0,a=Math.min(e.length-n,4);i<a;++i)e[n+i]=t>>>8*(r?i:3-i)&255}function R(e,t,n,r,i,a){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function j(e,t,n,r,a){return a||R(e,0,n,4),i.write(e,t,n,r,23,4),n+4}function N(e,t,n,r,a){return a||R(e,0,n,8),i.write(e,t,n,r,52,8),n+8}s.prototype.slice=function(e,t){var n,r=this.length;if((e=~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e),s.TYPED_ARRAY_SUPPORT)(n=this.subarray(e,t)).__proto__=s.prototype;else{var i=t-e;n=new s(i,void 0);for(var a=0;a<i;++a)n[a]=this[a+e]}return n},s.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||M(e,t,this.length);for(var r=this[e],i=1,a=0;++a<t&&(i*=256);)r+=this[e+a]*i;return r},s.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||M(e,t,this.length);for(var r=this[e+--t],i=1;t>0&&(i*=256);)r+=this[e+--t]*i;return r},s.prototype.readUInt8=function(e,t){return t||M(e,1,this.length),this[e]},s.prototype.readUInt16LE=function(e,t){return t||M(e,2,this.length),this[e]|this[e+1]<<8},s.prototype.readUInt16BE=function(e,t){return t||M(e,2,this.length),this[e]<<8|this[e+1]},s.prototype.readUInt32LE=function(e,t){return t||M(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},s.prototype.readUInt32BE=function(e,t){return t||M(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},s.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||M(e,t,this.length);for(var r=this[e],i=1,a=0;++a<t&&(i*=256);)r+=this[e+a]*i;return r>=(i*=128)&&(r-=Math.pow(2,8*t)),r},s.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||M(e,t,this.length);for(var r=t,i=1,a=this[e+--r];r>0&&(i*=256);)a+=this[e+--r]*i;return a>=(i*=128)&&(a-=Math.pow(2,8*t)),a},s.prototype.readInt8=function(e,t){return t||M(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},s.prototype.readInt16LE=function(e,t){t||M(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},s.prototype.readInt16BE=function(e,t){t||M(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},s.prototype.readInt32LE=function(e,t){return t||M(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},s.prototype.readInt32BE=function(e,t){return t||M(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},s.prototype.readFloatLE=function(e,t){return t||M(e,4,this.length),i.read(this,e,!0,23,4)},s.prototype.readFloatBE=function(e,t){return t||M(e,4,this.length),i.read(this,e,!1,23,4)},s.prototype.readDoubleLE=function(e,t){return t||M(e,8,this.length),i.read(this,e,!0,52,8)},s.prototype.readDoubleBE=function(e,t){return t||M(e,8,this.length),i.read(this,e,!1,52,8)},s.prototype.writeUIntLE=function(e,t,n,r){(e=+e,t|=0,n|=0,r)||V(this,e,t,n,Math.pow(2,8*n)-1,0);var i=1,a=0;for(this[t]=255&e;++a<n&&(i*=256);)this[t+a]=e/i&255;return t+n},s.prototype.writeUIntBE=function(e,t,n,r){(e=+e,t|=0,n|=0,r)||V(this,e,t,n,Math.pow(2,8*n)-1,0);var i=n-1,a=1;for(this[t+i]=255&e;--i>=0&&(a*=256);)this[t+i]=e/a&255;return t+n},s.prototype.writeUInt8=function(e,t,n){return e=+e,t|=0,n||V(this,e,t,1,255,0),s.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},s.prototype.writeUInt16LE=function(e,t,n){return e=+e,t|=0,n||V(this,e,t,2,65535,0),s.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):O(this,e,t,!0),t+2},s.prototype.writeUInt16BE=function(e,t,n){return e=+e,t|=0,n||V(this,e,t,2,65535,0),s.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):O(this,e,t,!1),t+2},s.prototype.writeUInt32LE=function(e,t,n){return e=+e,t|=0,n||V(this,e,t,4,4294967295,0),s.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):D(this,e,t,!0),t+4},s.prototype.writeUInt32BE=function(e,t,n){return e=+e,t|=0,n||V(this,e,t,4,4294967295,0),s.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):D(this,e,t,!1),t+4},s.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);V(this,e,t,n,i-1,-i)}var a=0,o=1,u=0;for(this[t]=255&e;++a<n&&(o*=256);)e<0&&0===u&&0!==this[t+a-1]&&(u=1),this[t+a]=(e/o>>0)-u&255;return t+n},s.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);V(this,e,t,n,i-1,-i)}var a=n-1,o=1,u=0;for(this[t+a]=255&e;--a>=0&&(o*=256);)e<0&&0===u&&0!==this[t+a+1]&&(u=1),this[t+a]=(e/o>>0)-u&255;return t+n},s.prototype.writeInt8=function(e,t,n){return e=+e,t|=0,n||V(this,e,t,1,127,-128),s.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},s.prototype.writeInt16LE=function(e,t,n){return e=+e,t|=0,n||V(this,e,t,2,32767,-32768),s.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):O(this,e,t,!0),t+2},s.prototype.writeInt16BE=function(e,t,n){return e=+e,t|=0,n||V(this,e,t,2,32767,-32768),s.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):O(this,e,t,!1),t+2},s.prototype.writeInt32LE=function(e,t,n){return e=+e,t|=0,n||V(this,e,t,4,2147483647,-2147483648),s.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):D(this,e,t,!0),t+4},s.prototype.writeInt32BE=function(e,t,n){return e=+e,t|=0,n||V(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),s.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):D(this,e,t,!1),t+4},s.prototype.writeFloatLE=function(e,t,n){return j(this,e,t,!0,n)},s.prototype.writeFloatBE=function(e,t,n){return j(this,e,t,!1,n)},s.prototype.writeDoubleLE=function(e,t,n){return N(this,e,t,!0,n)},s.prototype.writeDoubleBE=function(e,t,n){return N(this,e,t,!1,n)},s.prototype.copy=function(e,t,n,r){if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var i,a=r-n;if(this===e&&n<t&&t<r)for(i=a-1;i>=0;--i)e[i+t]=this[i+n];else if(a<1e3||!s.TYPED_ARRAY_SUPPORT)for(i=0;i<a;++i)e[i+t]=this[i+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+a),t);return a},s.prototype.fill=function(e,t,n,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),1===e.length){var i=e.charCodeAt(0);i<256&&(e=i)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!s.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var a;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(a=t;a<n;++a)this[a]=e;else{var o=s.isBuffer(e)?e:L(new s(e,r).toString()),u=o.length;for(a=0;a<n-t;++a)this[a+t]=o[a%u]}return this};var B=/[^+\/0-9A-Za-z-_]/g;function F(e){return e<16?"0"+e.toString(16):e.toString(16)}function L(e,t){var n;t=t||1/0;for(var r=e.length,i=null,a=[],o=0;o<r;++o){if((n=e.charCodeAt(o))>55295&&n<57344){if(!i){if(n>56319){(t-=3)>-1&&a.push(239,191,189);continue}if(o+1===r){(t-=3)>-1&&a.push(239,191,189);continue}i=n;continue}if(n<56320){(t-=3)>-1&&a.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(t-=3)>-1&&a.push(239,191,189);if(i=null,n<128){if((t-=1)<0)break;a.push(n)}else if(n<2048){if((t-=2)<0)break;a.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;a.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;a.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return a}function z(e){return r.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(B,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function U(e,t,n,r){for(var i=0;i<r&&!(i+n>=t.length||i>=e.length);++i)t[i+n]=e[i];return i}}).call(this,n(132))},function(e,t,n){"use strict";t.byteLength=function(e){var t=c(e),n=t[0],r=t[1];return 3*(n+r)/4-r},t.toByteArray=function(e){for(var t,n=c(e),r=n[0],o=n[1],u=new a(function(e,t,n){return 3*(t+n)/4-n}(0,r,o)),s=0,l=o>0?r-4:r,f=0;f<l;f+=4)t=i[e.charCodeAt(f)]<<18|i[e.charCodeAt(f+1)]<<12|i[e.charCodeAt(f+2)]<<6|i[e.charCodeAt(f+3)],u[s++]=t>>16&255,u[s++]=t>>8&255,u[s++]=255&t;2===o&&(t=i[e.charCodeAt(f)]<<2|i[e.charCodeAt(f+1)]>>4,u[s++]=255&t);1===o&&(t=i[e.charCodeAt(f)]<<10|i[e.charCodeAt(f+1)]<<4|i[e.charCodeAt(f+2)]>>2,u[s++]=t>>8&255,u[s++]=255&t);return u},t.fromByteArray=function(e){for(var t,n=e.length,i=n%3,a=[],o=0,u=n-i;o<u;o+=16383)a.push(l(e,o,o+16383>u?u:o+16383));1===i?(t=e[n-1],a.push(r[t>>2]+r[t<<4&63]+"==")):2===i&&(t=(e[n-2]<<8)+e[n-1],a.push(r[t>>10]+r[t>>4&63]+r[t<<2&63]+"="));return a.join("")};for(var r=[],i=[],a="undefined"!=typeof Uint8Array?Uint8Array:Array,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",u=0,s=o.length;u<s;++u)r[u]=o[u],i[o.charCodeAt(u)]=u;function c(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function l(e,t,n){for(var i,a,o=[],u=t;u<n;u+=3)i=(e[u]<<16&16711680)+(e[u+1]<<8&65280)+(255&e[u+2]),o.push(r[(a=i)>>18&63]+r[a>>12&63]+r[a>>6&63]+r[63&a]);return o.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},function(e,t){t.read=function(e,t,n,r,i){var a,o,u=8*i-r-1,s=(1<<u)-1,c=s>>1,l=-7,f=n?i-1:0,d=n?-1:1,p=e[t+f];for(f+=d,a=p&(1<<-l)-1,p>>=-l,l+=u;l>0;a=256*a+e[t+f],f+=d,l-=8);for(o=a&(1<<-l)-1,a>>=-l,l+=r;l>0;o=256*o+e[t+f],f+=d,l-=8);if(0===a)a=1-c;else{if(a===s)return o?NaN:1/0*(p?-1:1);o+=Math.pow(2,r),a-=c}return(p?-1:1)*o*Math.pow(2,a-r)},t.write=function(e,t,n,r,i,a){var o,u,s,c=8*a-i-1,l=(1<<c)-1,f=l>>1,d=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:a-1,h=r?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(u=isNaN(t)?1:0,o=l):(o=Math.floor(Math.log(t)/Math.LN2),t*(s=Math.pow(2,-o))<1&&(o--,s*=2),(t+=o+f>=1?d/s:d*Math.pow(2,1-f))*s>=2&&(o++,s/=2),o+f>=l?(u=0,o=l):o+f>=1?(u=(t*s-1)*Math.pow(2,i),o+=f):(u=t*Math.pow(2,f-1)*Math.pow(2,i),o=0));i>=8;e[n+p]=255&u,p+=h,u/=256,i-=8);for(o=o<<i|u,c+=i;c>0;e[n+p]=255&o,p+=h,o/=256,c-=8);e[n+p-h]|=128*m}},function(e,t){var n={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},function(e,t,n){"use strict";function r(e,t){return e-t}function i(e){return Array.prototype.sort.call(e,r),e}var a;Object.defineProperty(t,"__esModule",{value:!0}),t.sortAsc=i,function(e){var t=function(){function e(){this.size=0}return e.prototype.has=function(e){return!1},e.prototype.forEach=function(e,t){return t},e}(),n=function(){function e(e){this.idx=e,this.size=1}return e.prototype.has=function(e){return e===this.idx},e.prototype.forEach=function(e,t){return e(this.idx,t),t},e}(),r=function(){function e(e,t){this.mask=e,this.size=t,this.length=e.length}return e.prototype.has=function(e){return e<this.length&&!!this.mask[e]},e.prototype._forEach=function(e,t){for(var n=0;n<this.length;n++)this.mask[n]&&e(n,t)},e.prototype.forEach=function(e,t){return this._forEach(e,t),t},e}(),a=function(){function e(e){this.size=e}return e.prototype.has=function(e){return!0},e.prototype._forEach=function(e,t){for(var n=0;n<this.size;n++)e(n,t)},e.prototype.forEach=function(e,t){return this._forEach(e,t),t},e}(),o=function(){function e(e){this.set=e,this._flat=void 0,this.size=e.size}return e.prototype.has=function(e){return this.set.has(e)},e.prototype._forEach=function(e,t){for(var n=0,r=this.flatten();n<r.length;n++){e(r[n],t)}},e.prototype.flatten=function(){if(this._flat)return this._flat;var e=new Int32Array(this.size),t=0;return this.set.forEach(function(n){return e[t++]=n}),i(e),this._flat=e,this._flat},e.prototype.forEach=function(e,t){return this._forEach(e,t),t},e}();function u(e){return new o(e)}function s(e,t){return new r(e,t)}e.always=function(e){return new a(e)},e.never=new t,e.ofSet=u,e.singleton=function(e){return new n(e)},e.ofUniqueIndices=function(e){var i=e.length;if(0===i)return new t;if(1===i)return new n(e[0]);for(var u=0,s=0,c=e;s<c.length;s++)(p=c[s])>u&&(u=p);if(i===u)return new a(i);if(i/u<1/12){for(var l=new Set,f=0,d=e;f<d.length;f++){var p=d[f];l.add(p)}return new o(l)}for(var h=new Int8Array(u+1),m=0,y=e;m<y.length;m++)h[p=y[m]]=1;return new r(h,e.length)},e.ofMask=s,e.hasAny=function(e,t){for(var n=0,r=t;n<r.length;n++){var i=r[n];if(e.has(i))return!0}return!1},e.complement=function(e,t){var n=0,r=0;if(t.forEach(function(t){e.has(t)||(n++,t>r&&(r=t))}),n/r<1/12){var i=new Set;return t.forEach(function(t){e.has(t)||i.add(t)}),u(i)}var a=new Uint8Array(r+1);return t.forEach(function(t){e.has(t)||(a[t]=1)}),s(a,n)}}(a||(a={})),t.default=a},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i,a=n(133),o=n(182),u=n(2),s=n(18),c=n(7);t.DefaultRendererProps={clearColor:s.Color(0),viewport:a.Viewport.create(0,0,0,0),pickingAlphaThreshold:.5},function(e){e.create=function(e,n,i){void 0===i&&(i={});var l=e.gl,f=r({},t.DefaultRendererProps,i),d=f.clearColor,p=f.viewport,h=f.pickingAlphaThreshold,m=a.Viewport.clone(p),y=a.Viewport.toVec4(u.Vec4.zero(),m),v=u.Vec3.create(1,1,1),b=u.Vec3.create(.5,.5,.5),g=u.Vec3.create(0,0,0);function _(e){d=e;var t=s.Color.toRgbNormalized(e),n=t[0],r=t[1],i=t[2];l.clearColor(n,r,i,1),u.Vec3.set(g,n,r,i)}_(d);var S=u.Mat4.clone(n.view),C=u.Mat4.invert(u.Mat4.identity(),S),x=u.Mat4.clone(n.view),w=u.Mat4.invert(u.Mat4.identity(),x),P=u.Mat4.invert(u.Mat4.identity(),n.projection),T=u.Mat4.mul(u.Mat4.identity(),x,n.projection),A=u.Mat4.invert(u.Mat4.identity(),T),E={uModel:c.ValueCell.create(u.Mat4.identity()),uView:c.ValueCell.create(n.view),uInvView:c.ValueCell.create(C),uModelView:c.ValueCell.create(x),uInvModelView:c.ValueCell.create(w),uInvProjection:c.ValueCell.create(P),uProjection:c.ValueCell.create(u.Mat4.clone(n.projection)),uModelViewProjection:c.ValueCell.create(T),uInvModelViewProjection:c.ValueCell.create(A),uPixelRatio:c.ValueCell.create(e.pixelRatio),uViewportHeight:c.ValueCell.create(m.height),uViewport:c.ValueCell.create(y),uLightColor:c.ValueCell.create(v),uLightAmbient:c.ValueCell.create(b),uCameraPosition:c.ValueCell.create(u.Vec3.clone(n.state.position)),uFogNear:c.ValueCell.create(n.state.fogNear),uFogFar:c.ValueCell.create(n.state.fogFar),uFogColor:c.ValueCell.create(g),uPickingAlphaThreshold:c.ValueCell.create(h)},k=!0,I=function(t,n){var r=t.getProgram(n);t.state.visible&&(e.currentProgramId!==r.id&&(k=!0),r.use(),k&&(r.setUniforms(E),k=!1),t.values.dDoubleSided?t.values.dDoubleSided.ref.value?l.disable(l.CULL_FACE):l.enable(l.CULL_FACE):l.disable(l.CULL_FACE),t.values.dFlipSided&&t.values.dFlipSided.ref.value?(l.frontFace(l.CW),l.cullFace(l.FRONT)):(l.frontFace(l.CCW),l.cullFace(l.BACK)),t.render(n))};return{clear:function(){l.depthMask(!0),l.clear(l.COLOR_BUFFER_BIT|l.DEPTH_BUFFER_BIT)},render:function(e,t){c.ValueCell.update(E.uModel,e.view),c.ValueCell.update(E.uView,n.view),c.ValueCell.update(E.uInvView,u.Mat4.invert(C,n.view)),c.ValueCell.update(E.uModelView,u.Mat4.mul(x,e.view,n.view)),c.ValueCell.update(E.uInvModelView,u.Mat4.invert(w,x)),c.ValueCell.update(E.uProjection,n.projection),c.ValueCell.update(E.uInvProjection,u.Mat4.invert(P,n.projection)),c.ValueCell.update(E.uModelViewProjection,u.Mat4.mul(T,x,n.projection)),c.ValueCell.update(E.uInvModelViewProjection,u.Mat4.invert(A,T)),c.ValueCell.update(E.uCameraPosition,n.state.position),c.ValueCell.update(E.uFogFar,n.state.fogFar),c.ValueCell.update(E.uFogNear,n.state.fogNear),k=!0;var r=e.renderables;if("draw"===t){l.disable(l.BLEND),l.enable(l.DEPTH_TEST),l.depthMask(!0);for(var i=0,a=r.length;i<a;++i)(o=r[i]).state.opaque&&I(o,t);for(l.blendFunc(l.SRC_ALPHA,l.ONE_MINUS_SRC_ALPHA),l.enable(l.BLEND),i=0,a=r.length;i<a;++i){var o=r[i];l.depthMask(1===o.values.uAlpha.ref.value),o.state.opaque||I(o,t)}}else for(l.disable(l.BLEND),l.enable(l.DEPTH_TEST),l.depthMask(!0),i=0,a=r.length;i<a;++i)I(r[i],t);l.finish()},setClearColor:_,setPickingAlphaThreshold:function(e){h=e,c.ValueCell.update(E.uPickingAlphaThreshold,h)},setViewport:function(e,t,n,r){a.Viewport.set(m,e,t,n,r),l.viewport(e,t,n,r),c.ValueCell.update(E.uViewportHeight,r),c.ValueCell.update(E.uViewport,u.Vec4.set(y,e,t,n,r))},getImageData:function(){var t=m.width,n=m.height,r=new Uint8Array(t*n*4);return e.unbindFramebuffer(),e.readPixels(0,0,t,n,r),o.createImageData(r,t,n)},get props(){return{clearColor:d,pickingAlphaThreshold:h,viewport:m}},get stats(){return{programCount:e.programCache.count,shaderCount:e.shaderCache.count,bufferCount:e.bufferCount,framebufferCount:e.framebufferCount,renderbufferCount:e.renderbufferCount,textureCount:e.textureCount,vaoCount:e.vaoCount,drawCount:e.drawCount,instanceCount:e.instanceCount,instancedDrawCount:e.instancedDrawCount}},dispose:function(){}}}}(i||(i={})),t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(68),i=n(328),a=n(183),o=n(34),u=n(17),s=o.idFactory();function c(e,t){var n=e.gl,a=e.shaderCache,o=t.defineValues,u=t.shaderCode,c=t.schema,l=n.createProgram();if(null===l)throw new Error("Could not create WebGL program");var f=s(),d=r.addShaderDefines(e,o,u),p=a.get(e,{type:"vert",source:d.vert}),h=a.get(e,{type:"frag",source:d.frag});if(p.value.attach(l),h.value.attach(l),n.linkProgram(l),!n.getProgramParameter(l,n.LINK_STATUS))throw new Error("Could not compile WebGL program. \n\n"+n.getProgramInfoLog(l));var m=function(e,t,n){var r=e.gl,i={};return Object.keys(n).forEach(function(e){var a=n[e];if("attribute"===a.type){var o=r.getAttribLocation(t,e);i[e]=o}else"uniform"!==a.type&&"texture"!==a.type||(o=r.getUniformLocation(t,e),i[e]=o)}),i}(e,l,c),y=i.getUniformSetters(c),v=!1;return{id:f,use:function(){e.currentProgramId=f,n.useProgram(l)},setUniforms:function(e){for(var t=Object.keys(e),r=0,i=t.length;r<i;++r){var a=t[r],o=m[a],u=e[a];u&&y[a](n,o,u.ref.value)}},bindAttributes:function(e){for(var t=Object.keys(e),n=0,r=t.length;n<r;++n){var i=t[n],a=m[i];-1!==a&&e[i].bind(a)}},bindTextures:function(e){for(var t=Object.keys(e),r=0,i=t.length;r<i;++r){var a=t[r],o=m[a];e[a].bind(r),y[a](n,o,r)}},destroy:function(){v||(p.free(),h.free(),n.deleteProgram(l),v=!0)}}}t.createProgram=c,t.createProgramCache=function(){return a.createReferenceCache(function(e){var t=[e.shaderCode.id];return Object.keys(e.defineValues).forEach(function(n){var r=e.defineValues[n].ref.value;t.push(u.hashString(n),function(e){return"boolean"==typeof e?e?1:0:"number"==typeof e?e:u.hashString(e)}(r))}),u.hashFnv32a(t).toString()},function(e,t){return c(e,t)},function(e){e.destroy()})}},function(e,t){e.exports="/**\n * Copyright (c) 2018 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n */\n\nprecision highp float;\nprecision highp int;\n#define GLSLIFY 1\n\nuniform mat4 uProjection, uModel, uView;\nuniform vec3 uCameraPosition;\n\nuniform int uObjectId;\nuniform int uInstanceCount;\nuniform int uGroupCount;\n\nuniform vec2 uMarkerTexDim;\nuniform sampler2D tMarker;\nvarying float vMarker;\n\nvarying vec3 vViewPosition;\n\nfloat intDiv(float a, float b) { return float(int(a) / int(b)); }\nfloat intMod(float a, float b) { return a - b * float(int(a) / int(b)); }\n\n#if __VERSION__ != 300\n    // transpose\n\n    float transpose(const in float m) {\n        return m;\n    }\n\n    mat2 transpose(const in mat2 m) {\n        return mat2(\n            m[0][0], m[1][0],\n            m[0][1], m[1][1]\n        );\n    }\n\n    mat3 transpose(const in mat3 m) {\n        return mat3(\n            m[0][0], m[1][0], m[2][0],\n            m[0][1], m[1][1], m[2][1],\n            m[0][2], m[1][2], m[2][2]\n        );\n    }\n\n    mat4 transpose(const in mat4 m) {\n        return mat4(\n            m[0][0], m[1][0], m[2][0], m[3][0],\n            m[0][1], m[1][1], m[2][1], m[3][1],\n            m[0][2], m[1][2], m[2][2], m[3][2],\n            m[0][3], m[1][3], m[2][3], m[3][3]\n        );\n    }\n\n    float inverse(const in float m) {\n        return 1.0 / m;\n    }\n\n    // inverse\n\n    mat2 inverse(const in mat2 m) {\n        return mat2(m[1][1],-m[0][1],\n                -m[1][0], m[0][0]) / (m[0][0]*m[1][1] - m[0][1]*m[1][0]);\n    }\n\n    mat3 inverse(const in mat3 m) {\n        float a00 = m[0][0], a01 = m[0][1], a02 = m[0][2];\n        float a10 = m[1][0], a11 = m[1][1], a12 = m[1][2];\n        float a20 = m[2][0], a21 = m[2][1], a22 = m[2][2];\n\n        float b01 = a22 * a11 - a12 * a21;\n        float b11 = -a22 * a10 + a12 * a20;\n        float b21 = a21 * a10 - a11 * a20;\n\n        float det = a00 * b01 + a01 * b11 + a02 * b21;\n\n        return mat3(b01, (-a22 * a01 + a02 * a21), (a12 * a01 - a02 * a11),\n                    b11, (a22 * a00 - a02 * a20), (-a12 * a00 + a02 * a10),\n                    b21, (-a21 * a00 + a01 * a20), (a11 * a00 - a01 * a10)) / det;\n    }\n\n    mat4 inverse(const in mat4 m) {\n        float\n            a00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3],\n            a10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3],\n            a20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3],\n            a30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3],\n\n            b00 = a00 * a11 - a01 * a10,\n            b01 = a00 * a12 - a02 * a10,\n            b02 = a00 * a13 - a03 * a10,\n            b03 = a01 * a12 - a02 * a11,\n            b04 = a01 * a13 - a03 * a11,\n            b05 = a02 * a13 - a03 * a12,\n            b06 = a20 * a31 - a21 * a30,\n            b07 = a20 * a32 - a22 * a30,\n            b08 = a20 * a33 - a23 * a30,\n            b09 = a21 * a32 - a22 * a31,\n            b10 = a21 * a33 - a23 * a31,\n            b11 = a22 * a33 - a23 * a32,\n\n            det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n\n        return mat4(\n            a11 * b11 - a12 * b10 + a13 * b09,\n            a02 * b10 - a01 * b11 - a03 * b09,\n            a31 * b05 - a32 * b04 + a33 * b03,\n            a22 * b04 - a21 * b05 - a23 * b03,\n            a12 * b08 - a10 * b11 - a13 * b07,\n            a00 * b11 - a02 * b08 + a03 * b07,\n            a32 * b02 - a30 * b05 - a33 * b01,\n            a20 * b05 - a22 * b02 + a23 * b01,\n            a10 * b10 - a11 * b08 + a13 * b06,\n            a01 * b08 - a00 * b10 - a03 * b06,\n            a30 * b04 - a31 * b02 + a33 * b00,\n            a21 * b02 - a20 * b04 - a23 * b00,\n            a11 * b07 - a10 * b09 - a12 * b06,\n            a00 * b09 - a01 * b07 + a02 * b06,\n            a31 * b01 - a30 * b03 - a32 * b00,\n            a20 * b03 - a21 * b01 + a22 * b00) / det;\n    }\n#endif\n/**\n * Copyright (c) 2018 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n */\n\nvec4 readFromTexture (const in sampler2D tex, const in float i, const in vec2 dim) {\n    float x = intMod(i, dim.x);\n    float y = floor(intDiv(i, dim.x));\n    vec2 uv = (vec2(x, y) + 0.5) / dim;\n    return texture2D(tex, uv);\n}\n\n#if defined(dColorType_uniform)\n    uniform vec3 uColor;\n#elif defined(dColorType_attribute)\n    varying vec4 vColor;\n    attribute vec3 aColor;\n#elif defined(dColorType_instance) || defined(dColorType_group) || defined(dColorType_groupInstance)\n    varying vec4 vColor;\n    uniform vec2 uColorTexDim;\n    uniform sampler2D tColor;\n#elif defined(dColorType_objectPicking) || defined(dColorType_instancePicking) || defined(dColorType_groupPicking)\n    #if __VERSION__ != 300\n        varying vec4 vColor;\n    #else\n        flat out vec4 vColor;\n    #endif\n    /**\n * Copyright (c) 2018 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n */\n\nvec3 encodeFloatRGB(in float value) {\n    value = clamp(value, 0.0, 16777216.0 - 1.0) + 1.0;\n    vec3 c = vec3(0.0);\n    c.b = mod(value, 256.0);\n    value = floor(value / 256.0);\n    c.g = mod(value, 256.0);\n    value = floor(value / 256.0);\n    c.r = mod(value, 256.0);\n    return c / 255.0;\n}\n\n#endif\n#if defined(dSizeType_uniform)\n    uniform float uSize;\n#elif defined(dSizeType_attribute)\n    attribute float aSize;\n#elif defined(dSizeType_instance) || defined(dSizeType_group) || defined(dSizeType_groupInstance)\n    uniform vec2 uSizeTexDim;\n    uniform sampler2D tSize;\n    /**\n * Copyright (c) 2019 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n */\n\nconst float maxFloat = 10000.0; // NOTE constant also set in in encodeFloatLog and in TypeScript\nconst float floatLogFactor = log(maxFloat + 1.0);\nfloat decodeFloatLog(in float value) { return exp(value * floatLogFactor) - 1.0; }\n\n#endif\n\nuniform float uSizeFactor;\n\nuniform float uPixelRatio;\nuniform float uViewportHeight;\n\nattribute vec3 aPosition;\nattribute mat4 aTransform;\nattribute float aInstance;\nattribute float aGroup;\n\nvoid main(){\n    #if defined(dColorType_attribute)\n    vColor.rgb = aColor;\n#elif defined(dColorType_instance)\n    vColor.rgb = readFromTexture(tColor, aInstance, uColorTexDim).rgb;\n#elif defined(dColorType_group)\n    vColor.rgb = readFromTexture(tColor, aGroup, uColorTexDim).rgb;\n#elif defined(dColorType_groupInstance)\n    vColor.rgb = readFromTexture(tColor, aInstance * float(uGroupCount) + aGroup, uColorTexDim).rgb;\n#elif defined(dColorType_objectPicking)\n    vColor = vec4(encodeFloatRGB(float(uObjectId)), 1.0);\n#elif defined(dColorType_instancePicking)\n    vColor = vec4(encodeFloatRGB(aInstance), 1.0);\n#elif defined(dColorType_groupPicking)\n    vColor = vec4(encodeFloatRGB(aGroup), 1.0);\n#endif\n    vMarker = readFromTexture(tMarker, aInstance * float(uGroupCount) + aGroup, uMarkerTexDim).a;\n    mat4 modelView = uView * uModel * aTransform;\nvec4 mvPosition = modelView * vec4(aPosition, 1.0);\nvViewPosition = mvPosition.xyz;\ngl_Position = uProjection * mvPosition;\n    #if defined(dSizeType_uniform)\n    float size = uSize;\n#elif defined(dSizeType_attribute)\n    float size = aSize;\n#elif defined(dSizeType_instance)\n    float size = readFromTexture(tSize, aInstance, uSizeTexDim).a;\n#elif defined(dSizeType_group)\n    float size = readFromTexture(tSize, aGroup, uSizeTexDim).a;\n#elif defined(dSizeType_groupInstance)\n    float size = readFromTexture(tSize, aInstance * float(uGroupCount) + aGroup, uSizeTexDim).a;\n#endif\n\n#if defined(dSizeType_instance) || defined(dSizeType_group) || defined(dSizeType_groupInstance)\n    size = decodeFloatLog(size);\n#endif\n\nsize *= uSizeFactor;\n\n    #ifdef dPointSizeAttenuation\n        gl_PointSize = size * uPixelRatio * ((uViewportHeight / 2.0) / -mvPosition.z) * 5.0;\n    #else\n        gl_PointSize = size * uPixelRatio;\n    #endif\n\n    gl_Position = uProjection * mvPosition;\n}"},function(e,t){e.exports="/**\n * Copyright (c) 2018 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n */\n\nprecision highp float;\nprecision highp int;\n#define GLSLIFY 1\n\nuniform int uObjectId;\nuniform int uInstanceCount;\nuniform int uGroupCount;\n\nuniform vec3 uHighlightColor;\nuniform vec3 uSelectColor;\nvarying float vMarker;\n\nvarying vec3 vViewPosition;\n\nuniform float uFogNear;\nuniform float uFogFar;\nuniform vec3 uFogColor;\n\nuniform float uAlpha;\nuniform float uPickingAlphaThreshold;\nuniform int uPickable;\n\nfloat intDiv(float a, float b) { return float(int(a) / int(b)); }\nfloat intMod(float a, float b) { return a - b * float(int(a) / int(b)); }\n\n#if __VERSION__ != 300\n    // transpose\n\n    float transpose(const in float m) {\n        return m;\n    }\n\n    mat2 transpose(const in mat2 m) {\n        return mat2(\n            m[0][0], m[1][0],\n            m[0][1], m[1][1]\n        );\n    }\n\n    mat3 transpose(const in mat3 m) {\n        return mat3(\n            m[0][0], m[1][0], m[2][0],\n            m[0][1], m[1][1], m[2][1],\n            m[0][2], m[1][2], m[2][2]\n        );\n    }\n\n    mat4 transpose(const in mat4 m) {\n        return mat4(\n            m[0][0], m[1][0], m[2][0], m[3][0],\n            m[0][1], m[1][1], m[2][1], m[3][1],\n            m[0][2], m[1][2], m[2][2], m[3][2],\n            m[0][3], m[1][3], m[2][3], m[3][3]\n        );\n    }\n\n    float inverse(const in float m) {\n        return 1.0 / m;\n    }\n\n    // inverse\n\n    mat2 inverse(const in mat2 m) {\n        return mat2(m[1][1],-m[0][1],\n                -m[1][0], m[0][0]) / (m[0][0]*m[1][1] - m[0][1]*m[1][0]);\n    }\n\n    mat3 inverse(const in mat3 m) {\n        float a00 = m[0][0], a01 = m[0][1], a02 = m[0][2];\n        float a10 = m[1][0], a11 = m[1][1], a12 = m[1][2];\n        float a20 = m[2][0], a21 = m[2][1], a22 = m[2][2];\n\n        float b01 = a22 * a11 - a12 * a21;\n        float b11 = -a22 * a10 + a12 * a20;\n        float b21 = a21 * a10 - a11 * a20;\n\n        float det = a00 * b01 + a01 * b11 + a02 * b21;\n\n        return mat3(b01, (-a22 * a01 + a02 * a21), (a12 * a01 - a02 * a11),\n                    b11, (a22 * a00 - a02 * a20), (-a12 * a00 + a02 * a10),\n                    b21, (-a21 * a00 + a01 * a20), (a11 * a00 - a01 * a10)) / det;\n    }\n\n    mat4 inverse(const in mat4 m) {\n        float\n            a00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3],\n            a10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3],\n            a20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3],\n            a30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3],\n\n            b00 = a00 * a11 - a01 * a10,\n            b01 = a00 * a12 - a02 * a10,\n            b02 = a00 * a13 - a03 * a10,\n            b03 = a01 * a12 - a02 * a11,\n            b04 = a01 * a13 - a03 * a11,\n            b05 = a02 * a13 - a03 * a12,\n            b06 = a20 * a31 - a21 * a30,\n            b07 = a20 * a32 - a22 * a30,\n            b08 = a20 * a33 - a23 * a30,\n            b09 = a21 * a32 - a22 * a31,\n            b10 = a21 * a33 - a23 * a31,\n            b11 = a22 * a33 - a23 * a32,\n\n            det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n\n        return mat4(\n            a11 * b11 - a12 * b10 + a13 * b09,\n            a02 * b10 - a01 * b11 - a03 * b09,\n            a31 * b05 - a32 * b04 + a33 * b03,\n            a22 * b04 - a21 * b05 - a23 * b03,\n            a12 * b08 - a10 * b11 - a13 * b07,\n            a00 * b11 - a02 * b08 + a03 * b07,\n            a32 * b02 - a30 * b05 - a33 * b01,\n            a20 * b05 - a22 * b02 + a23 * b01,\n            a10 * b10 - a11 * b08 + a13 * b06,\n            a01 * b08 - a00 * b10 - a03 * b06,\n            a30 * b04 - a31 * b02 + a33 * b00,\n            a21 * b02 - a20 * b04 - a23 * b00,\n            a11 * b07 - a10 * b09 - a12 * b06,\n            a00 * b09 - a01 * b07 + a02 * b06,\n            a31 * b01 - a30 * b03 - a32 * b00,\n            a20 * b03 - a21 * b01 + a22 * b00) / det;\n    }\n#endif\n#if defined(dColorType_uniform)\n    uniform vec3 uColor;\n#elif defined(dColorType_attribute) || defined(dColorType_instance) || defined(dColorType_group) || defined(dColorType_groupInstance)\n    varying vec4 vColor;\n#elif defined(dColorType_objectPicking) || defined(dColorType_instancePicking) || defined(dColorType_groupPicking)\n    #if __VERSION__ != 300\n        varying vec4 vColor;\n    #else\n        flat in vec4 vColor;\n    #endif\n#endif\n\n#ifdef dPointFilledCircle\n    uniform float uPointEdgeBleach;\n#endif\n\nconst vec2 center = vec2(0.5);\nconst float radius = 0.5;\n\nvoid main(){\n    #if defined(dColorType_uniform)\n    vec4 material = vec4(uColor, uAlpha);\n#elif defined(dColorType_attribute) || defined(dColorType_instance) || defined(dColorType_group) || defined(dColorType_groupInstance)\n    vec4 material = vec4(vColor.rgb, uAlpha);\n#elif defined(dColorType_objectPicking) || defined(dColorType_instancePicking) || defined(dColorType_groupPicking)\n    vec4 material = uPickable == 1 ? vColor : vec4(0.0, 0.0, 0.0, 1.0); // set to empty picking id\n#endif\n\n    #if defined(dColorType_objectPicking) || defined(dColorType_instancePicking) || defined(dColorType_groupPicking)\n        if (uAlpha < uPickingAlphaThreshold)\n            discard; // ignore so the element below can be picked\n        gl_FragColor = material;\n    #else\n        gl_FragColor = material;\n\n        #ifdef dPointFilledCircle\n            float dist = distance(gl_PointCoord, center);\n            float alpha = 1.0 - smoothstep(radius - uPointEdgeBleach, radius, dist);\n            if (alpha < 0.0001) discard;\n            gl_FragColor.a *= alpha;\n        #endif\n\n        // only mark elements with an alpha above the picking threshold\nif (uAlpha >= uPickingAlphaThreshold) {\n    float marker = floor(vMarker * 255.0 + 0.5); // rounding required to work on some cards on win\n    if (marker > 0.1) {\n        if (intMod(marker, 2.0) > 0.1) {\n            gl_FragColor.rgb = mix(uHighlightColor, gl_FragColor.rgb, 0.3);\n        } else {\n            gl_FragColor.rgb = mix(uSelectColor, gl_FragColor.rgb, 0.3);\n        }\n    }\n}\n        #ifdef dUseFog\n\tfloat depth = length(vViewPosition);\n    float fogFactor = smoothstep(uFogNear, uFogFar, depth);\n\tgl_FragColor.rgb = mix(gl_FragColor.rgb, uFogColor, fogFactor);\n    float fogAlpha = (1.0 - fogFactor) * gl_FragColor.a;\n    if (fogAlpha < 0.01)\n        discard;\n    gl_FragColor = vec4(gl_FragColor.rgb, fogAlpha);\n#endif\n    #endif\n}"},function(e,t){e.exports='/**\n * Copyright (c) 2019 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n */\n\nprecision highp float;\nprecision highp int;\n#define GLSLIFY 1\n\nuniform mat4 uProjection, uModel, uView;\nuniform vec3 uCameraPosition;\n\nuniform int uObjectId;\nuniform int uInstanceCount;\nuniform int uGroupCount;\n\nuniform vec2 uMarkerTexDim;\nuniform sampler2D tMarker;\nvarying float vMarker;\n\nvarying vec3 vViewPosition;\n\nfloat intDiv(float a, float b) { return float(int(a) / int(b)); }\nfloat intMod(float a, float b) { return a - b * float(int(a) / int(b)); }\n\n#if __VERSION__ != 300\n    // transpose\n\n    float transpose(const in float m) {\n        return m;\n    }\n\n    mat2 transpose(const in mat2 m) {\n        return mat2(\n            m[0][0], m[1][0],\n            m[0][1], m[1][1]\n        );\n    }\n\n    mat3 transpose(const in mat3 m) {\n        return mat3(\n            m[0][0], m[1][0], m[2][0],\n            m[0][1], m[1][1], m[2][1],\n            m[0][2], m[1][2], m[2][2]\n        );\n    }\n\n    mat4 transpose(const in mat4 m) {\n        return mat4(\n            m[0][0], m[1][0], m[2][0], m[3][0],\n            m[0][1], m[1][1], m[2][1], m[3][1],\n            m[0][2], m[1][2], m[2][2], m[3][2],\n            m[0][3], m[1][3], m[2][3], m[3][3]\n        );\n    }\n\n    float inverse(const in float m) {\n        return 1.0 / m;\n    }\n\n    // inverse\n\n    mat2 inverse(const in mat2 m) {\n        return mat2(m[1][1],-m[0][1],\n                -m[1][0], m[0][0]) / (m[0][0]*m[1][1] - m[0][1]*m[1][0]);\n    }\n\n    mat3 inverse(const in mat3 m) {\n        float a00 = m[0][0], a01 = m[0][1], a02 = m[0][2];\n        float a10 = m[1][0], a11 = m[1][1], a12 = m[1][2];\n        float a20 = m[2][0], a21 = m[2][1], a22 = m[2][2];\n\n        float b01 = a22 * a11 - a12 * a21;\n        float b11 = -a22 * a10 + a12 * a20;\n        float b21 = a21 * a10 - a11 * a20;\n\n        float det = a00 * b01 + a01 * b11 + a02 * b21;\n\n        return mat3(b01, (-a22 * a01 + a02 * a21), (a12 * a01 - a02 * a11),\n                    b11, (a22 * a00 - a02 * a20), (-a12 * a00 + a02 * a10),\n                    b21, (-a21 * a00 + a01 * a20), (a11 * a00 - a01 * a10)) / det;\n    }\n\n    mat4 inverse(const in mat4 m) {\n        float\n            a00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3],\n            a10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3],\n            a20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3],\n            a30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3],\n\n            b00 = a00 * a11 - a01 * a10,\n            b01 = a00 * a12 - a02 * a10,\n            b02 = a00 * a13 - a03 * a10,\n            b03 = a01 * a12 - a02 * a11,\n            b04 = a01 * a13 - a03 * a11,\n            b05 = a02 * a13 - a03 * a12,\n            b06 = a20 * a31 - a21 * a30,\n            b07 = a20 * a32 - a22 * a30,\n            b08 = a20 * a33 - a23 * a30,\n            b09 = a21 * a32 - a22 * a31,\n            b10 = a21 * a33 - a23 * a31,\n            b11 = a22 * a33 - a23 * a32,\n\n            det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n\n        return mat4(\n            a11 * b11 - a12 * b10 + a13 * b09,\n            a02 * b10 - a01 * b11 - a03 * b09,\n            a31 * b05 - a32 * b04 + a33 * b03,\n            a22 * b04 - a21 * b05 - a23 * b03,\n            a12 * b08 - a10 * b11 - a13 * b07,\n            a00 * b11 - a02 * b08 + a03 * b07,\n            a32 * b02 - a30 * b05 - a33 * b01,\n            a20 * b05 - a22 * b02 + a23 * b01,\n            a10 * b10 - a11 * b08 + a13 * b06,\n            a01 * b08 - a00 * b10 - a03 * b06,\n            a30 * b04 - a31 * b02 + a33 * b00,\n            a21 * b02 - a20 * b04 - a23 * b00,\n            a11 * b07 - a10 * b09 - a12 * b06,\n            a00 * b09 - a01 * b07 + a02 * b06,\n            a31 * b01 - a30 * b03 - a32 * b00,\n            a20 * b03 - a21 * b01 + a22 * b00) / det;\n    }\n#endif\n/**\n * Copyright (c) 2018 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n */\n\nvec4 readFromTexture (const in sampler2D tex, const in float i, const in vec2 dim) {\n    float x = intMod(i, dim.x);\n    float y = floor(intDiv(i, dim.x));\n    vec2 uv = (vec2(x, y) + 0.5) / dim;\n    return texture2D(tex, uv);\n}\n\n#if defined(dColorType_uniform)\n    uniform vec3 uColor;\n#elif defined(dColorType_attribute)\n    varying vec4 vColor;\n    attribute vec3 aColor;\n#elif defined(dColorType_instance) || defined(dColorType_group) || defined(dColorType_groupInstance)\n    varying vec4 vColor;\n    uniform vec2 uColorTexDim;\n    uniform sampler2D tColor;\n#elif defined(dColorType_objectPicking) || defined(dColorType_instancePicking) || defined(dColorType_groupPicking)\n    #if __VERSION__ != 300\n        varying vec4 vColor;\n    #else\n        flat out vec4 vColor;\n    #endif\n    /**\n * Copyright (c) 2018 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n */\n\nvec3 encodeFloatRGB(in float value) {\n    value = clamp(value, 0.0, 16777216.0 - 1.0) + 1.0;\n    vec3 c = vec3(0.0);\n    c.b = mod(value, 256.0);\n    value = floor(value / 256.0);\n    c.g = mod(value, 256.0);\n    value = floor(value / 256.0);\n    c.r = mod(value, 256.0);\n    return c / 255.0;\n}\n\n#endif\n#if defined(dSizeType_uniform)\n    uniform float uSize;\n#elif defined(dSizeType_attribute)\n    attribute float aSize;\n#elif defined(dSizeType_instance) || defined(dSizeType_group) || defined(dSizeType_groupInstance)\n    uniform vec2 uSizeTexDim;\n    uniform sampler2D tSize;\n    /**\n * Copyright (c) 2019 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n */\n\nconst float maxFloat = 10000.0; // NOTE constant also set in in encodeFloatLog and in TypeScript\nconst float floatLogFactor = log(maxFloat + 1.0);\nfloat decodeFloatLog(in float value) { return exp(value * floatLogFactor) - 1.0; }\n\n#endif\n\nuniform float uSizeFactor;\n\nuniform mat4 uModelView;\nuniform mat4 uInvProjection;\n\nattribute vec3 aPosition;\nattribute vec2 aMapping;\nattribute mat4 aTransform;\nattribute float aInstance;\nattribute float aGroup;\n\nvarying float vRadius;\nvarying float vRadiusSq;\nvarying vec3 vPoint;\nvarying vec3 vPointViewPosition;\n\n/**\n * Copyright (c) 2019 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n */\n\nfloat matrixScale(in mat4 m){\n    vec4 r = m[0];\n    return sqrt(r[0] * r[0] + r[1] * r[1] + r[2] * r[2]);\n}\n\nconst mat4 D = mat4(\n    1.0, 0.0, 0.0, 0.0,\n    0.0, 1.0, 0.0, 0.0,\n    0.0, 0.0, 1.0, 0.0,\n    0.0, 0.0, 0.0, -1.0\n);\n\nmat4 transpose2(in mat4 inMatrix) {\n    vec4 i0 = inMatrix[0];\n    vec4 i1 = inMatrix[1];\n    vec4 i2 = inMatrix[2];\n    vec4 i3 = inMatrix[3];\n\n    mat4 outMatrix = mat4(\n        vec4(i0.x, i1.x, i2.x, i3.x),\n        vec4(i0.y, i1.y, i2.y, i3.y),\n        vec4(i0.z, i1.z, i2.z, i3.z),\n        vec4(i0.w, i1.w, i2.w, i3.w)\n    );\n    return outMatrix;\n}\n\n/**\n * Compute point size and center using the technique described in:\n * "GPU-Based Ray-Casting of Quadratic Surfaces" http://dl.acm.org/citation.cfm?id=2386396\n * by Christian Sigg, Tim Weyrich, Mario Botsch, Markus Gross.\n */\nvoid quadraticProjection(const in float radius, const in vec3 position){\n    vec2 xbc, ybc;\n\n    mat4 T = mat4(\n        radius, 0.0, 0.0, 0.0,\n        0.0, radius, 0.0, 0.0,\n        0.0, 0.0, radius, 0.0,\n        position.x, position.y, position.z, 1.0\n    );\n\n    mat4 R = transpose2(uProjection * uModelView * aTransform * T);\n    float A = dot(R[3], D * R[3]);\n    float B = -2.0 * dot(R[0], D * R[3]);\n    float C = dot(R[0], D * R[0]);\n    xbc[0] = (-B - sqrt(B * B - 4.0 * A * C)) / (2.0 * A);\n    xbc[1] = (-B + sqrt(B * B - 4.0 * A * C)) / (2.0 * A);\n    float sx = abs(xbc[0] - xbc[1]) * 0.5;\n\n    A = dot(R[3], D * R[3]);\n    B = -2.0 * dot(R[1], D * R[3]);\n    C = dot(R[1], D * R[1]);\n    ybc[0] = (-B - sqrt(B * B - 4.0 * A * C)) / (2.0 * A);\n    ybc[1] = (-B + sqrt(B * B - 4.0 * A * C)) / (2.0 * A);\n    float sy = abs(ybc[0] - ybc[1]) * 0.5;\n\n    gl_Position.xy = vec2(0.5 * (xbc.x + xbc.y), 0.5 * (ybc.x + ybc.y));\n    gl_Position.xy -= aMapping * vec2(sx, sy);\n    gl_Position.xy *= gl_Position.w;\n}\n\nvoid main(void){\n    #if defined(dColorType_attribute)\n    vColor.rgb = aColor;\n#elif defined(dColorType_instance)\n    vColor.rgb = readFromTexture(tColor, aInstance, uColorTexDim).rgb;\n#elif defined(dColorType_group)\n    vColor.rgb = readFromTexture(tColor, aGroup, uColorTexDim).rgb;\n#elif defined(dColorType_groupInstance)\n    vColor.rgb = readFromTexture(tColor, aInstance * float(uGroupCount) + aGroup, uColorTexDim).rgb;\n#elif defined(dColorType_objectPicking)\n    vColor = vec4(encodeFloatRGB(float(uObjectId)), 1.0);\n#elif defined(dColorType_instancePicking)\n    vColor = vec4(encodeFloatRGB(aInstance), 1.0);\n#elif defined(dColorType_groupPicking)\n    vColor = vec4(encodeFloatRGB(aGroup), 1.0);\n#endif\n    vMarker = readFromTexture(tMarker, aInstance * float(uGroupCount) + aGroup, uMarkerTexDim).a;\n    #if defined(dSizeType_uniform)\n    float size = uSize;\n#elif defined(dSizeType_attribute)\n    float size = aSize;\n#elif defined(dSizeType_instance)\n    float size = readFromTexture(tSize, aInstance, uSizeTexDim).a;\n#elif defined(dSizeType_group)\n    float size = readFromTexture(tSize, aGroup, uSizeTexDim).a;\n#elif defined(dSizeType_groupInstance)\n    float size = readFromTexture(tSize, aInstance * float(uGroupCount) + aGroup, uSizeTexDim).a;\n#endif\n\n#if defined(dSizeType_instance) || defined(dSizeType_group) || defined(dSizeType_groupInstance)\n    size = decodeFloatLog(size);\n#endif\n\nsize *= uSizeFactor;\n\n    vRadius = size * matrixScale(uModelView);\n\n    vec4 mvPosition = uModelView * aTransform * vec4(aPosition, 1.0);\n    mvPosition.z -= vRadius; // avoid clipping, added again in fragment shader\n\n    gl_Position = uProjection * vec4(mvPosition.xyz, 1.0);\n    quadraticProjection(size, aPosition);\n\n    vRadiusSq = vRadius * vRadius;\n    vec4 vPoint4 = uInvProjection * gl_Position;\n    vPoint = vPoint4.xyz / vPoint4.w;\n    vPointViewPosition = -mvPosition.xyz / mvPosition.w;\n}'},function(e,t){e.exports="/**\n * Copyright (c) 2019 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n */\n\nprecision highp float;\nprecision highp int;\n#define GLSLIFY 1\n\nuniform int uObjectId;\nuniform int uInstanceCount;\nuniform int uGroupCount;\n\nuniform vec3 uHighlightColor;\nuniform vec3 uSelectColor;\nvarying float vMarker;\n\nvarying vec3 vViewPosition;\n\nuniform float uFogNear;\nuniform float uFogFar;\nuniform vec3 uFogColor;\n\nuniform float uAlpha;\nuniform float uPickingAlphaThreshold;\nuniform int uPickable;\n\nfloat intDiv(float a, float b) { return float(int(a) / int(b)); }\nfloat intMod(float a, float b) { return a - b * float(int(a) / int(b)); }\n\n#if __VERSION__ != 300\n    // transpose\n\n    float transpose(const in float m) {\n        return m;\n    }\n\n    mat2 transpose(const in mat2 m) {\n        return mat2(\n            m[0][0], m[1][0],\n            m[0][1], m[1][1]\n        );\n    }\n\n    mat3 transpose(const in mat3 m) {\n        return mat3(\n            m[0][0], m[1][0], m[2][0],\n            m[0][1], m[1][1], m[2][1],\n            m[0][2], m[1][2], m[2][2]\n        );\n    }\n\n    mat4 transpose(const in mat4 m) {\n        return mat4(\n            m[0][0], m[1][0], m[2][0], m[3][0],\n            m[0][1], m[1][1], m[2][1], m[3][1],\n            m[0][2], m[1][2], m[2][2], m[3][2],\n            m[0][3], m[1][3], m[2][3], m[3][3]\n        );\n    }\n\n    float inverse(const in float m) {\n        return 1.0 / m;\n    }\n\n    // inverse\n\n    mat2 inverse(const in mat2 m) {\n        return mat2(m[1][1],-m[0][1],\n                -m[1][0], m[0][0]) / (m[0][0]*m[1][1] - m[0][1]*m[1][0]);\n    }\n\n    mat3 inverse(const in mat3 m) {\n        float a00 = m[0][0], a01 = m[0][1], a02 = m[0][2];\n        float a10 = m[1][0], a11 = m[1][1], a12 = m[1][2];\n        float a20 = m[2][0], a21 = m[2][1], a22 = m[2][2];\n\n        float b01 = a22 * a11 - a12 * a21;\n        float b11 = -a22 * a10 + a12 * a20;\n        float b21 = a21 * a10 - a11 * a20;\n\n        float det = a00 * b01 + a01 * b11 + a02 * b21;\n\n        return mat3(b01, (-a22 * a01 + a02 * a21), (a12 * a01 - a02 * a11),\n                    b11, (a22 * a00 - a02 * a20), (-a12 * a00 + a02 * a10),\n                    b21, (-a21 * a00 + a01 * a20), (a11 * a00 - a01 * a10)) / det;\n    }\n\n    mat4 inverse(const in mat4 m) {\n        float\n            a00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3],\n            a10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3],\n            a20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3],\n            a30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3],\n\n            b00 = a00 * a11 - a01 * a10,\n            b01 = a00 * a12 - a02 * a10,\n            b02 = a00 * a13 - a03 * a10,\n            b03 = a01 * a12 - a02 * a11,\n            b04 = a01 * a13 - a03 * a11,\n            b05 = a02 * a13 - a03 * a12,\n            b06 = a20 * a31 - a21 * a30,\n            b07 = a20 * a32 - a22 * a30,\n            b08 = a20 * a33 - a23 * a30,\n            b09 = a21 * a32 - a22 * a31,\n            b10 = a21 * a33 - a23 * a31,\n            b11 = a22 * a33 - a23 * a32,\n\n            det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n\n        return mat4(\n            a11 * b11 - a12 * b10 + a13 * b09,\n            a02 * b10 - a01 * b11 - a03 * b09,\n            a31 * b05 - a32 * b04 + a33 * b03,\n            a22 * b04 - a21 * b05 - a23 * b03,\n            a12 * b08 - a10 * b11 - a13 * b07,\n            a00 * b11 - a02 * b08 + a03 * b07,\n            a32 * b02 - a30 * b05 - a33 * b01,\n            a20 * b05 - a22 * b02 + a23 * b01,\n            a10 * b10 - a11 * b08 + a13 * b06,\n            a01 * b08 - a00 * b10 - a03 * b06,\n            a30 * b04 - a31 * b02 + a33 * b00,\n            a21 * b02 - a20 * b04 - a23 * b00,\n            a11 * b07 - a10 * b09 - a12 * b06,\n            a00 * b09 - a01 * b07 + a02 * b06,\n            a31 * b01 - a30 * b03 - a32 * b00,\n            a20 * b03 - a21 * b01 + a22 * b00) / det;\n    }\n#endif\n#if defined(dColorType_uniform)\n    uniform vec3 uColor;\n#elif defined(dColorType_attribute) || defined(dColorType_instance) || defined(dColorType_group) || defined(dColorType_groupInstance)\n    varying vec4 vColor;\n#elif defined(dColorType_objectPicking) || defined(dColorType_instancePicking) || defined(dColorType_groupPicking)\n    #if __VERSION__ != 300\n        varying vec4 vColor;\n    #else\n        flat in vec4 vColor;\n    #endif\n#endif\n\n// uniform vec3 uLightPosition;\nuniform vec3 uLightColor;\nuniform vec3 uLightAmbient;\nuniform mat4 uView;\n\nuniform mat4 uProjection;\n// uniform vec3 interiorColor;\n// uniform float interiorDarkening;\nvec3 interiorColor = vec3(1.0, 0.5, 0.5);\nfloat interiorDarkening = 0.0;\n\nuniform float clipNear;\n// uniform float ortho;\nfloat ortho = 0.0;\n\nvarying float vRadius;\nvarying float vRadiusSq;\nvarying vec3 vPoint;\nvarying vec3 vPointViewPosition;\n\n// by Tom Madams\n// Simple:\n// https://imdoingitwrong.wordpress.com/2011/01/31/light-attenuation/\n//\n// Improved\n// https://imdoingitwrong.wordpress.com/2011/02/10/improved-light-attenuation/\nfloat attenuation_0(const in float r, const in float f, const in float d) {\n    float denom = d / r + 1.0;\n    float attenuation = 1.0 / (denom*denom);\n    float t = (attenuation - f) / (1.0 - f);\n    return max(t, 0.0);\n}\n\n// (c) 2014 Mikola Lysenko. MIT License\n// https://github.com/glslify/glsl-specular-phong\n\nfloat phongSpecular(const in vec3 lightDirection, const in vec3 viewDirection, const in vec3 surfaceNormal, const in float shininess) {\n    //Calculate Phong power\n    vec3 R = -reflect(lightDirection, surfaceNormal);\n    return pow(max(0.0, dot(viewDirection, R)), shininess);\n}\n\n// (c) 2014 Mikola Lysenko. MIT License\n// https://github.com/glslify/glsl-diffuse-oren-nayar\n\n#define PI 3.14159265\n\nfloat orenNayarDiffuse(const in vec3 lightDirection, const in vec3 viewDirection, const in vec3 surfaceNormal, const in float roughness, const in float albedo) {\n    float LdotV = dot(lightDirection, viewDirection);\n    float NdotL = dot(lightDirection, surfaceNormal);\n    float NdotV = dot(surfaceNormal, viewDirection);\n\n    float s = LdotV - NdotL * NdotV;\n    float t = mix(1.0, max(NdotL, NdotV), step(0.0, s));\n\n    float sigma2 = roughness * roughness;\n    float A = 1.0 + sigma2 * (albedo / (sigma2 + 0.13) + 0.5 / (sigma2 + 0.33));\n    float B = 0.45 * sigma2 / (sigma2 + 0.09);\n\n    return albedo * max(0.0, NdotL) * (A + B * s / t) / PI;\n}\n\nconst float specularScale = 0.15;\nconst float shininess = 200.0;\nconst float roughness = 100.0;\nconst float albedo = 0.95;\n\nbool flag2 = false;\nbool interior = false;\nvec3 cameraPos;\nvec3 cameraNormal;\n\n// Calculate depth based on the given camera position.\nfloat calcDepth(in vec3 cameraPos){\n    vec2 clipZW = cameraPos.z * uProjection[2].zw + uProjection[3].zw;\n    return 0.5 + 0.5 * clipZW.x / clipZW.y;\n}\n\nfloat calcClip(in vec3 cameraPos) {\n    return dot(vec4(cameraPos, 1.0), vec4(0.0, 0.0, 1.0, clipNear - 0.5));\n}\n\nbool Impostor(out vec3 cameraPos, out vec3 cameraNormal){\n    vec3 cameraSpherePos = -vPointViewPosition;\n    cameraSpherePos.z += vRadius;\n\n    vec3 rayOrigin = mix(vec3(0.0, 0.0, 0.0), vPoint, ortho);\n    vec3 rayDirection = mix(normalize(vPoint), vec3(0.0, 0.0, 1.0), ortho);\n    vec3 cameraSphereDir = mix(cameraSpherePos, rayOrigin - cameraSpherePos, ortho);\n\n    float B = dot(rayDirection, cameraSphereDir);\n    float det = B * B + vRadiusSq - dot(cameraSphereDir, cameraSphereDir);\n\n    if(det < 0.0){\n        discard;\n        return false;\n    }\n\n    float sqrtDet = sqrt(det);\n    float posT = mix(B + sqrtDet, B + sqrtDet, ortho);\n    float negT = mix(B - sqrtDet, sqrtDet - B, ortho);\n\n    cameraPos = rayDirection * negT + rayOrigin;\n\n    #ifdef NEAR_CLIP\n        if(calcDepth(cameraPos) <= 0.0){\n            cameraPos = rayDirection * posT + rayOrigin;\n            interior = true;\n        }else if(calcClip(cameraPos) > 0.0){\n            cameraPos = rayDirection * posT + rayOrigin;\n            interior = true;\n            flag2 = true;\n        }\n    #else\n        if(calcDepth(cameraPos) <= 0.0){\n            cameraPos = rayDirection * posT + rayOrigin;\n            interior = true;\n        }\n    #endif\n\n    cameraNormal = normalize(cameraPos - cameraSpherePos);\n    cameraNormal *= float(!interior) * 2.0 - 1.0;\n\n    return !interior;\n}\n\nvoid main2(void){\n    gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);\n}\n\nvoid main(void){\n    bool flag = Impostor(cameraPos, cameraNormal);\n\n    #ifdef NEAR_CLIP\n        if(calcClip(cameraPos) > 0.0)\n            discard;\n    #endif\n\n    // FIXME not compatible with custom clipping plane\n    // Set the depth based on the new cameraPos.\n    gl_FragDepthEXT = calcDepth(cameraPos);\n    if(!flag){\n        // clamp to near clipping plane and add a tiny value to\n        // make spheres with a greater radius occlude smaller ones\n        #ifdef NEAR_CLIP\n            if( flag2 ){\n                gl_FragDepthEXT = max(0.0, calcDepth(vec3(-(clipNear - 0.5))) + (0.0000001 / vRadius));\n            }else if(gl_FragDepthEXT >= 0.0){\n                gl_FragDepthEXT = 0.0 + (0.0000001 / vRadius);\n            }\n        #else\n            if(gl_FragDepthEXT >= 0.0){\n                gl_FragDepthEXT = 0.0 + (0.0000001 / vRadius);\n            }\n        #endif\n    }\n\n    // bugfix (mac only?)\n    if (gl_FragDepthEXT < 0.0)\n        discard;\n    if (gl_FragDepthEXT > 1.0)\n        discard;\n\n    // material color\n    #if defined(dColorType_uniform)\n    vec4 material = vec4(uColor, uAlpha);\n#elif defined(dColorType_attribute) || defined(dColorType_instance) || defined(dColorType_group) || defined(dColorType_groupInstance)\n    vec4 material = vec4(vColor.rgb, uAlpha);\n#elif defined(dColorType_objectPicking) || defined(dColorType_instancePicking) || defined(dColorType_groupPicking)\n    vec4 material = uPickable == 1 ? vColor : vec4(0.0, 0.0, 0.0, 1.0); // set to empty picking id\n#endif\n\n    #if defined(dColorType_objectPicking) || defined(dColorType_instancePicking) || defined(dColorType_groupPicking)\n        if (uAlpha < uPickingAlphaThreshold)\n            discard; // ignore so the element below can be picked\n        gl_FragColor = material;\n    #else\n\n        vec3 vNormal = cameraNormal;\n        vec3 vViewPosition = -cameraPos;\n\n        // determine surface to light direction\n        // vec4 viewLightPosition = view * vec4(lightPosition, 1.0);\n        // vec3 lightVector = viewLightPosition.xyz - vViewPosition;\n        vec3 lightVector = vViewPosition;\n\n        vec3 L = normalize(lightVector); // light direction\n        vec3 V = normalize(vViewPosition); // eye direction\n\n        vec3 N = normalize(vNormal);\n        #ifdef dDoubleSided\n            N = N * (float(gl_FrontFacing) * 2.0 - 1.0);\n        #endif\n\n        // compute our diffuse & specular terms\n        float specular = phongSpecular(L, V, N, shininess) * specularScale;\n        vec3 diffuse = uLightColor * orenNayarDiffuse(L, V, N, roughness, albedo);\n        vec3 ambient = uLightAmbient;\n\n        // add the lighting\n        vec3 finalColor = material.rgb * (diffuse + ambient) + specular;\n\n        // gl_FragColor.rgb = N;\n        // gl_FragColor.a = 1.0;\n        // gl_FragColor.rgb = vec3(1.0, 0.0, 0.0);\n        gl_FragColor.rgb = finalColor;\n        gl_FragColor.a = material.a;\n\n        if(interior){\n            #ifdef USE_INTERIOR_COLOR\n                gl_FragColor.rgb = interiorColor;\n            #endif\n            gl_FragColor.rgb *= 1.0 - interiorDarkening;\n        }\n\n        // only mark elements with an alpha above the picking threshold\nif (uAlpha >= uPickingAlphaThreshold) {\n    float marker = floor(vMarker * 255.0 + 0.5); // rounding required to work on some cards on win\n    if (marker > 0.1) {\n        if (intMod(marker, 2.0) > 0.1) {\n            gl_FragColor.rgb = mix(uHighlightColor, gl_FragColor.rgb, 0.3);\n        } else {\n            gl_FragColor.rgb = mix(uSelectColor, gl_FragColor.rgb, 0.3);\n        }\n    }\n}\n        #ifdef dUseFog\n\tfloat depth = length(vViewPosition);\n    float fogFactor = smoothstep(uFogNear, uFogFar, depth);\n\tgl_FragColor.rgb = mix(gl_FragColor.rgb, uFogColor, fogFactor);\n    float fogAlpha = (1.0 - fogFactor) * gl_FragColor.a;\n    if (fogAlpha < 0.01)\n        discard;\n    gl_FragColor = vec4(gl_FragColor.rgb, fogAlpha);\n#endif\n    #endif\n}"},function(e,t){e.exports="/**\n * Copyright (c) 2019 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n */\n\nprecision highp float;\nprecision highp int;\n#define GLSLIFY 1\n\nuniform mat4 uProjection, uModel, uView;\nuniform vec3 uCameraPosition;\n\nuniform int uObjectId;\nuniform int uInstanceCount;\nuniform int uGroupCount;\n\nuniform vec2 uMarkerTexDim;\nuniform sampler2D tMarker;\nvarying float vMarker;\n\nvarying vec3 vViewPosition;\n\nfloat intDiv(float a, float b) { return float(int(a) / int(b)); }\nfloat intMod(float a, float b) { return a - b * float(int(a) / int(b)); }\n\n#if __VERSION__ != 300\n    // transpose\n\n    float transpose(const in float m) {\n        return m;\n    }\n\n    mat2 transpose(const in mat2 m) {\n        return mat2(\n            m[0][0], m[1][0],\n            m[0][1], m[1][1]\n        );\n    }\n\n    mat3 transpose(const in mat3 m) {\n        return mat3(\n            m[0][0], m[1][0], m[2][0],\n            m[0][1], m[1][1], m[2][1],\n            m[0][2], m[1][2], m[2][2]\n        );\n    }\n\n    mat4 transpose(const in mat4 m) {\n        return mat4(\n            m[0][0], m[1][0], m[2][0], m[3][0],\n            m[0][1], m[1][1], m[2][1], m[3][1],\n            m[0][2], m[1][2], m[2][2], m[3][2],\n            m[0][3], m[1][3], m[2][3], m[3][3]\n        );\n    }\n\n    float inverse(const in float m) {\n        return 1.0 / m;\n    }\n\n    // inverse\n\n    mat2 inverse(const in mat2 m) {\n        return mat2(m[1][1],-m[0][1],\n                -m[1][0], m[0][0]) / (m[0][0]*m[1][1] - m[0][1]*m[1][0]);\n    }\n\n    mat3 inverse(const in mat3 m) {\n        float a00 = m[0][0], a01 = m[0][1], a02 = m[0][2];\n        float a10 = m[1][0], a11 = m[1][1], a12 = m[1][2];\n        float a20 = m[2][0], a21 = m[2][1], a22 = m[2][2];\n\n        float b01 = a22 * a11 - a12 * a21;\n        float b11 = -a22 * a10 + a12 * a20;\n        float b21 = a21 * a10 - a11 * a20;\n\n        float det = a00 * b01 + a01 * b11 + a02 * b21;\n\n        return mat3(b01, (-a22 * a01 + a02 * a21), (a12 * a01 - a02 * a11),\n                    b11, (a22 * a00 - a02 * a20), (-a12 * a00 + a02 * a10),\n                    b21, (-a21 * a00 + a01 * a20), (a11 * a00 - a01 * a10)) / det;\n    }\n\n    mat4 inverse(const in mat4 m) {\n        float\n            a00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3],\n            a10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3],\n            a20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3],\n            a30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3],\n\n            b00 = a00 * a11 - a01 * a10,\n            b01 = a00 * a12 - a02 * a10,\n            b02 = a00 * a13 - a03 * a10,\n            b03 = a01 * a12 - a02 * a11,\n            b04 = a01 * a13 - a03 * a11,\n            b05 = a02 * a13 - a03 * a12,\n            b06 = a20 * a31 - a21 * a30,\n            b07 = a20 * a32 - a22 * a30,\n            b08 = a20 * a33 - a23 * a30,\n            b09 = a21 * a32 - a22 * a31,\n            b10 = a21 * a33 - a23 * a31,\n            b11 = a22 * a33 - a23 * a32,\n\n            det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n\n        return mat4(\n            a11 * b11 - a12 * b10 + a13 * b09,\n            a02 * b10 - a01 * b11 - a03 * b09,\n            a31 * b05 - a32 * b04 + a33 * b03,\n            a22 * b04 - a21 * b05 - a23 * b03,\n            a12 * b08 - a10 * b11 - a13 * b07,\n            a00 * b11 - a02 * b08 + a03 * b07,\n            a32 * b02 - a30 * b05 - a33 * b01,\n            a20 * b05 - a22 * b02 + a23 * b01,\n            a10 * b10 - a11 * b08 + a13 * b06,\n            a01 * b08 - a00 * b10 - a03 * b06,\n            a30 * b04 - a31 * b02 + a33 * b00,\n            a21 * b02 - a20 * b04 - a23 * b00,\n            a11 * b07 - a10 * b09 - a12 * b06,\n            a00 * b09 - a01 * b07 + a02 * b06,\n            a31 * b01 - a30 * b03 - a32 * b00,\n            a20 * b03 - a21 * b01 + a22 * b00) / det;\n    }\n#endif\n/**\n * Copyright (c) 2018 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n */\n\nvec4 readFromTexture (const in sampler2D tex, const in float i, const in vec2 dim) {\n    float x = intMod(i, dim.x);\n    float y = floor(intDiv(i, dim.x));\n    vec2 uv = (vec2(x, y) + 0.5) / dim;\n    return texture2D(tex, uv);\n}\n\n#if defined(dColorType_uniform)\n    uniform vec3 uColor;\n#elif defined(dColorType_attribute)\n    varying vec4 vColor;\n    attribute vec3 aColor;\n#elif defined(dColorType_instance) || defined(dColorType_group) || defined(dColorType_groupInstance)\n    varying vec4 vColor;\n    uniform vec2 uColorTexDim;\n    uniform sampler2D tColor;\n#elif defined(dColorType_objectPicking) || defined(dColorType_instancePicking) || defined(dColorType_groupPicking)\n    #if __VERSION__ != 300\n        varying vec4 vColor;\n    #else\n        flat out vec4 vColor;\n    #endif\n    /**\n * Copyright (c) 2018 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n */\n\nvec3 encodeFloatRGB(in float value) {\n    value = clamp(value, 0.0, 16777216.0 - 1.0) + 1.0;\n    vec3 c = vec3(0.0);\n    c.b = mod(value, 256.0);\n    value = floor(value / 256.0);\n    c.g = mod(value, 256.0);\n    value = floor(value / 256.0);\n    c.r = mod(value, 256.0);\n    return c / 255.0;\n}\n\n#endif\n#if defined(dSizeType_uniform)\n    uniform float uSize;\n#elif defined(dSizeType_attribute)\n    attribute float aSize;\n#elif defined(dSizeType_instance) || defined(dSizeType_group) || defined(dSizeType_groupInstance)\n    uniform vec2 uSizeTexDim;\n    uniform sampler2D tSize;\n    /**\n * Copyright (c) 2019 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n */\n\nconst float maxFloat = 10000.0; // NOTE constant also set in in encodeFloatLog and in TypeScript\nconst float floatLogFactor = log(maxFloat + 1.0);\nfloat decodeFloatLog(in float value) { return exp(value * floatLogFactor) - 1.0; }\n\n#endif\n\nuniform float uSizeFactor;\n\nuniform mat4 uModelView;\n\nattribute vec3 aPosition;\nattribute vec2 aMapping;\nattribute float aDepth;\nattribute vec2 aTexCoord;\nattribute mat4 aTransform;\nattribute float aInstance;\nattribute float aGroup;\n\nuniform float uOffsetX;\nuniform float uOffsetY;\nuniform float uOffsetZ;\n\n// uniform bool ortho;\nuniform float uPixelRatio;\nuniform float uViewportHeight;\n\nvarying vec2 vTexCoord;\n\n/**\n * Copyright (c) 2019 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n */\n\nfloat matrixScale(in mat4 m){\n    vec4 r = m[0];\n    return sqrt(r[0] * r[0] + r[1] * r[1] + r[2] * r[2]);\n}\n\nvoid main(void){\n    #if defined(dColorType_attribute)\n    vColor.rgb = aColor;\n#elif defined(dColorType_instance)\n    vColor.rgb = readFromTexture(tColor, aInstance, uColorTexDim).rgb;\n#elif defined(dColorType_group)\n    vColor.rgb = readFromTexture(tColor, aGroup, uColorTexDim).rgb;\n#elif defined(dColorType_groupInstance)\n    vColor.rgb = readFromTexture(tColor, aInstance * float(uGroupCount) + aGroup, uColorTexDim).rgb;\n#elif defined(dColorType_objectPicking)\n    vColor = vec4(encodeFloatRGB(float(uObjectId)), 1.0);\n#elif defined(dColorType_instancePicking)\n    vColor = vec4(encodeFloatRGB(aInstance), 1.0);\n#elif defined(dColorType_groupPicking)\n    vColor = vec4(encodeFloatRGB(aGroup), 1.0);\n#endif\n    vMarker = readFromTexture(tMarker, aInstance * float(uGroupCount) + aGroup, uMarkerTexDim).a;\n    #if defined(dSizeType_uniform)\n    float size = uSize;\n#elif defined(dSizeType_attribute)\n    float size = aSize;\n#elif defined(dSizeType_instance)\n    float size = readFromTexture(tSize, aInstance, uSizeTexDim).a;\n#elif defined(dSizeType_group)\n    float size = readFromTexture(tSize, aGroup, uSizeTexDim).a;\n#elif defined(dSizeType_groupInstance)\n    float size = readFromTexture(tSize, aInstance * float(uGroupCount) + aGroup, uSizeTexDim).a;\n#endif\n\n#if defined(dSizeType_instance) || defined(dSizeType_group) || defined(dSizeType_groupInstance)\n    size = decodeFloatLog(size);\n#endif\n\nsize *= uSizeFactor;\n\n    vTexCoord = aTexCoord;\n\n    float scale = matrixScale(uModelView);\n\n    float offsetX = uOffsetX * scale;\n    float offsetY = uOffsetY * scale;\n    float offsetZ = (uOffsetZ + aDepth * 0.95) * scale;\n\n    vec4 mvPosition = uModelView * aTransform * vec4(aPosition, 1.0);\n\n    // TODO\n    // #ifdef FIXED_SIZE\n    //     if (ortho) {\n    //         scale /= pixelRatio * ((uViewportHeight / 2.0) / -uCameraPosition.z) * 0.1;\n    //     } else {\n    //         scale /= pixelRatio * ((uViewportHeight / 2.0) / -mvPosition.z) * 0.1;\n    //     }\n    // #endif\n\n    vec4 mvCorner = vec4(mvPosition.xyz, 1.0);\n\n    if (vTexCoord.x == 10.0) { // indicates background plane\n        // move a bit to the back, tkaing ditsnace to camera into account to avoid z-fighting\n        offsetZ -= 0.001 * distance(uCameraPosition, (uProjection * mvCorner).xyz);\n    }\n\n    mvCorner.xy += aMapping * size * scale;\n    mvCorner.x += offsetX;\n    mvCorner.y += offsetY;\n\n    // TODO\n    // if(ortho){\n    //     mvCorner.xyz += normalize(-uCameraPosition) * offsetZ;\n    // } else {\n    //     mvCorner.xyz += normalize(-mvCorner.xyz) * offsetZ;\n    // }\n    mvCorner.xyz += normalize(-mvCorner.xyz) * offsetZ;\n\n    gl_Position = uProjection * mvCorner;\n\n    vViewPosition = -mvCorner.xyz;\n}"},function(e,t){e.exports="/**\n * Copyright (c) 2019 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n */\n\nprecision highp float;\nprecision highp int;\n#define GLSLIFY 1\n\nuniform int uObjectId;\nuniform int uInstanceCount;\nuniform int uGroupCount;\n\nuniform vec3 uHighlightColor;\nuniform vec3 uSelectColor;\nvarying float vMarker;\n\nvarying vec3 vViewPosition;\n\nuniform float uFogNear;\nuniform float uFogFar;\nuniform vec3 uFogColor;\n\nuniform float uAlpha;\nuniform float uPickingAlphaThreshold;\nuniform int uPickable;\n\nfloat intDiv(float a, float b) { return float(int(a) / int(b)); }\nfloat intMod(float a, float b) { return a - b * float(int(a) / int(b)); }\n\n#if __VERSION__ != 300\n    // transpose\n\n    float transpose(const in float m) {\n        return m;\n    }\n\n    mat2 transpose(const in mat2 m) {\n        return mat2(\n            m[0][0], m[1][0],\n            m[0][1], m[1][1]\n        );\n    }\n\n    mat3 transpose(const in mat3 m) {\n        return mat3(\n            m[0][0], m[1][0], m[2][0],\n            m[0][1], m[1][1], m[2][1],\n            m[0][2], m[1][2], m[2][2]\n        );\n    }\n\n    mat4 transpose(const in mat4 m) {\n        return mat4(\n            m[0][0], m[1][0], m[2][0], m[3][0],\n            m[0][1], m[1][1], m[2][1], m[3][1],\n            m[0][2], m[1][2], m[2][2], m[3][2],\n            m[0][3], m[1][3], m[2][3], m[3][3]\n        );\n    }\n\n    float inverse(const in float m) {\n        return 1.0 / m;\n    }\n\n    // inverse\n\n    mat2 inverse(const in mat2 m) {\n        return mat2(m[1][1],-m[0][1],\n                -m[1][0], m[0][0]) / (m[0][0]*m[1][1] - m[0][1]*m[1][0]);\n    }\n\n    mat3 inverse(const in mat3 m) {\n        float a00 = m[0][0], a01 = m[0][1], a02 = m[0][2];\n        float a10 = m[1][0], a11 = m[1][1], a12 = m[1][2];\n        float a20 = m[2][0], a21 = m[2][1], a22 = m[2][2];\n\n        float b01 = a22 * a11 - a12 * a21;\n        float b11 = -a22 * a10 + a12 * a20;\n        float b21 = a21 * a10 - a11 * a20;\n\n        float det = a00 * b01 + a01 * b11 + a02 * b21;\n\n        return mat3(b01, (-a22 * a01 + a02 * a21), (a12 * a01 - a02 * a11),\n                    b11, (a22 * a00 - a02 * a20), (-a12 * a00 + a02 * a10),\n                    b21, (-a21 * a00 + a01 * a20), (a11 * a00 - a01 * a10)) / det;\n    }\n\n    mat4 inverse(const in mat4 m) {\n        float\n            a00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3],\n            a10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3],\n            a20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3],\n            a30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3],\n\n            b00 = a00 * a11 - a01 * a10,\n            b01 = a00 * a12 - a02 * a10,\n            b02 = a00 * a13 - a03 * a10,\n            b03 = a01 * a12 - a02 * a11,\n            b04 = a01 * a13 - a03 * a11,\n            b05 = a02 * a13 - a03 * a12,\n            b06 = a20 * a31 - a21 * a30,\n            b07 = a20 * a32 - a22 * a30,\n            b08 = a20 * a33 - a23 * a30,\n            b09 = a21 * a32 - a22 * a31,\n            b10 = a21 * a33 - a23 * a31,\n            b11 = a22 * a33 - a23 * a32,\n\n            det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n\n        return mat4(\n            a11 * b11 - a12 * b10 + a13 * b09,\n            a02 * b10 - a01 * b11 - a03 * b09,\n            a31 * b05 - a32 * b04 + a33 * b03,\n            a22 * b04 - a21 * b05 - a23 * b03,\n            a12 * b08 - a10 * b11 - a13 * b07,\n            a00 * b11 - a02 * b08 + a03 * b07,\n            a32 * b02 - a30 * b05 - a33 * b01,\n            a20 * b05 - a22 * b02 + a23 * b01,\n            a10 * b10 - a11 * b08 + a13 * b06,\n            a01 * b08 - a00 * b10 - a03 * b06,\n            a30 * b04 - a31 * b02 + a33 * b00,\n            a21 * b02 - a20 * b04 - a23 * b00,\n            a11 * b07 - a10 * b09 - a12 * b06,\n            a00 * b09 - a01 * b07 + a02 * b06,\n            a31 * b01 - a30 * b03 - a32 * b00,\n            a20 * b03 - a21 * b01 + a22 * b00) / det;\n    }\n#endif\n#if defined(dColorType_uniform)\n    uniform vec3 uColor;\n#elif defined(dColorType_attribute) || defined(dColorType_instance) || defined(dColorType_group) || defined(dColorType_groupInstance)\n    varying vec4 vColor;\n#elif defined(dColorType_objectPicking) || defined(dColorType_instancePicking) || defined(dColorType_groupPicking)\n    #if __VERSION__ != 300\n        varying vec4 vColor;\n    #else\n        flat in vec4 vColor;\n    #endif\n#endif\n\nuniform sampler2D tFont;\n\nuniform vec3 uBorderColor;\nuniform float uBorderWidth;\nuniform vec3 uBackgroundColor;\nuniform float uBackgroundOpacity;\n\nvarying vec2 vTexCoord;\n\nconst float smoothness = 32.0;\nconst float gamma = 2.2;\n\nvoid main2(){\n    gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);\n}\n\nvoid main(){\n    #if defined(dColorType_uniform)\n    vec4 material = vec4(uColor, uAlpha);\n#elif defined(dColorType_attribute) || defined(dColorType_instance) || defined(dColorType_group) || defined(dColorType_groupInstance)\n    vec4 material = vec4(vColor.rgb, uAlpha);\n#elif defined(dColorType_objectPicking) || defined(dColorType_instancePicking) || defined(dColorType_groupPicking)\n    vec4 material = uPickable == 1 ? vColor : vec4(0.0, 0.0, 0.0, 1.0); // set to empty picking id\n#endif\n\n    if (vTexCoord.x > 1.0) {\n        gl_FragColor = vec4(uBackgroundColor, uBackgroundOpacity);\n    } else {\n        // retrieve signed distance\n        float sdf = texture2D(tFont, vTexCoord).a + uBorderWidth;\n\n        // perform adaptive anti-aliasing of the edges\n        float w = clamp(smoothness * (abs(dFdx(vTexCoord.x)) + abs(dFdy(vTexCoord.y))), 0.0, 0.5);\n        float a = smoothstep(0.5 - w, 0.5 + w, sdf);\n\n        // gamma correction for linear attenuation\n        a = pow(a, 1.0 / gamma);\n\n        if (a < 0.5) discard;\n        material.a *= a;\n\n        // add border\n        float t = 0.5 + uBorderWidth;\n        if (uBorderWidth > 0.0 && sdf < t) {\n            material.xyz = mix(uBorderColor, material.xyz, smoothstep(t - w, t, sdf));\n        }\n\n        gl_FragColor = material;\n    }\n\n    #if defined(dColorType_objectPicking) || defined(dColorType_instancePicking) || defined(dColorType_groupPicking)\n        if (uAlpha < uPickingAlphaThreshold)\n            discard; // ignore so the element below can be picked\n    #else\n        // only mark elements with an alpha above the picking threshold\nif (uAlpha >= uPickingAlphaThreshold) {\n    float marker = floor(vMarker * 255.0 + 0.5); // rounding required to work on some cards on win\n    if (marker > 0.1) {\n        if (intMod(marker, 2.0) > 0.1) {\n            gl_FragColor.rgb = mix(uHighlightColor, gl_FragColor.rgb, 0.3);\n        } else {\n            gl_FragColor.rgb = mix(uSelectColor, gl_FragColor.rgb, 0.3);\n        }\n    }\n}\n        #ifdef dUseFog\n\tfloat depth = length(vViewPosition);\n    float fogFactor = smoothstep(uFogNear, uFogFar, depth);\n\tgl_FragColor.rgb = mix(gl_FragColor.rgb, uFogColor, fogFactor);\n    float fogAlpha = (1.0 - fogFactor) * gl_FragColor.a;\n    if (fogAlpha < 0.01)\n        discard;\n    gl_FragColor = vec4(gl_FragColor.rgb, fogAlpha);\n#endif\n    #endif\n}"},function(e,t){e.exports="/**\n * Copyright (c) 2018 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n *\n * heavily based on code by WestLangley from https://github.com/WestLangley/three.js/blob/af28b2fb706ac109771ecad0a7447fad90ab3210/examples/js/lines/LineMaterial.js\n */\n\nprecision highp float;\nprecision highp int;\n#define GLSLIFY 1\n\nuniform mat4 uProjection, uModel, uView;\nuniform vec3 uCameraPosition;\n\nuniform int uObjectId;\nuniform int uInstanceCount;\nuniform int uGroupCount;\n\nuniform vec2 uMarkerTexDim;\nuniform sampler2D tMarker;\nvarying float vMarker;\n\nvarying vec3 vViewPosition;\n\nfloat intDiv(float a, float b) { return float(int(a) / int(b)); }\nfloat intMod(float a, float b) { return a - b * float(int(a) / int(b)); }\n\n#if __VERSION__ != 300\n    // transpose\n\n    float transpose(const in float m) {\n        return m;\n    }\n\n    mat2 transpose(const in mat2 m) {\n        return mat2(\n            m[0][0], m[1][0],\n            m[0][1], m[1][1]\n        );\n    }\n\n    mat3 transpose(const in mat3 m) {\n        return mat3(\n            m[0][0], m[1][0], m[2][0],\n            m[0][1], m[1][1], m[2][1],\n            m[0][2], m[1][2], m[2][2]\n        );\n    }\n\n    mat4 transpose(const in mat4 m) {\n        return mat4(\n            m[0][0], m[1][0], m[2][0], m[3][0],\n            m[0][1], m[1][1], m[2][1], m[3][1],\n            m[0][2], m[1][2], m[2][2], m[3][2],\n            m[0][3], m[1][3], m[2][3], m[3][3]\n        );\n    }\n\n    float inverse(const in float m) {\n        return 1.0 / m;\n    }\n\n    // inverse\n\n    mat2 inverse(const in mat2 m) {\n        return mat2(m[1][1],-m[0][1],\n                -m[1][0], m[0][0]) / (m[0][0]*m[1][1] - m[0][1]*m[1][0]);\n    }\n\n    mat3 inverse(const in mat3 m) {\n        float a00 = m[0][0], a01 = m[0][1], a02 = m[0][2];\n        float a10 = m[1][0], a11 = m[1][1], a12 = m[1][2];\n        float a20 = m[2][0], a21 = m[2][1], a22 = m[2][2];\n\n        float b01 = a22 * a11 - a12 * a21;\n        float b11 = -a22 * a10 + a12 * a20;\n        float b21 = a21 * a10 - a11 * a20;\n\n        float det = a00 * b01 + a01 * b11 + a02 * b21;\n\n        return mat3(b01, (-a22 * a01 + a02 * a21), (a12 * a01 - a02 * a11),\n                    b11, (a22 * a00 - a02 * a20), (-a12 * a00 + a02 * a10),\n                    b21, (-a21 * a00 + a01 * a20), (a11 * a00 - a01 * a10)) / det;\n    }\n\n    mat4 inverse(const in mat4 m) {\n        float\n            a00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3],\n            a10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3],\n            a20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3],\n            a30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3],\n\n            b00 = a00 * a11 - a01 * a10,\n            b01 = a00 * a12 - a02 * a10,\n            b02 = a00 * a13 - a03 * a10,\n            b03 = a01 * a12 - a02 * a11,\n            b04 = a01 * a13 - a03 * a11,\n            b05 = a02 * a13 - a03 * a12,\n            b06 = a20 * a31 - a21 * a30,\n            b07 = a20 * a32 - a22 * a30,\n            b08 = a20 * a33 - a23 * a30,\n            b09 = a21 * a32 - a22 * a31,\n            b10 = a21 * a33 - a23 * a31,\n            b11 = a22 * a33 - a23 * a32,\n\n            det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n\n        return mat4(\n            a11 * b11 - a12 * b10 + a13 * b09,\n            a02 * b10 - a01 * b11 - a03 * b09,\n            a31 * b05 - a32 * b04 + a33 * b03,\n            a22 * b04 - a21 * b05 - a23 * b03,\n            a12 * b08 - a10 * b11 - a13 * b07,\n            a00 * b11 - a02 * b08 + a03 * b07,\n            a32 * b02 - a30 * b05 - a33 * b01,\n            a20 * b05 - a22 * b02 + a23 * b01,\n            a10 * b10 - a11 * b08 + a13 * b06,\n            a01 * b08 - a00 * b10 - a03 * b06,\n            a30 * b04 - a31 * b02 + a33 * b00,\n            a21 * b02 - a20 * b04 - a23 * b00,\n            a11 * b07 - a10 * b09 - a12 * b06,\n            a00 * b09 - a01 * b07 + a02 * b06,\n            a31 * b01 - a30 * b03 - a32 * b00,\n            a20 * b03 - a21 * b01 + a22 * b00) / det;\n    }\n#endif\n/**\n * Copyright (c) 2018 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n */\n\nvec4 readFromTexture (const in sampler2D tex, const in float i, const in vec2 dim) {\n    float x = intMod(i, dim.x);\n    float y = floor(intDiv(i, dim.x));\n    vec2 uv = (vec2(x, y) + 0.5) / dim;\n    return texture2D(tex, uv);\n}\n\n#if defined(dColorType_uniform)\n    uniform vec3 uColor;\n#elif defined(dColorType_attribute)\n    varying vec4 vColor;\n    attribute vec3 aColor;\n#elif defined(dColorType_instance) || defined(dColorType_group) || defined(dColorType_groupInstance)\n    varying vec4 vColor;\n    uniform vec2 uColorTexDim;\n    uniform sampler2D tColor;\n#elif defined(dColorType_objectPicking) || defined(dColorType_instancePicking) || defined(dColorType_groupPicking)\n    #if __VERSION__ != 300\n        varying vec4 vColor;\n    #else\n        flat out vec4 vColor;\n    #endif\n    /**\n * Copyright (c) 2018 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n */\n\nvec3 encodeFloatRGB(in float value) {\n    value = clamp(value, 0.0, 16777216.0 - 1.0) + 1.0;\n    vec3 c = vec3(0.0);\n    c.b = mod(value, 256.0);\n    value = floor(value / 256.0);\n    c.g = mod(value, 256.0);\n    value = floor(value / 256.0);\n    c.r = mod(value, 256.0);\n    return c / 255.0;\n}\n\n#endif\n#if defined(dSizeType_uniform)\n    uniform float uSize;\n#elif defined(dSizeType_attribute)\n    attribute float aSize;\n#elif defined(dSizeType_instance) || defined(dSizeType_group) || defined(dSizeType_groupInstance)\n    uniform vec2 uSizeTexDim;\n    uniform sampler2D tSize;\n    /**\n * Copyright (c) 2019 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n */\n\nconst float maxFloat = 10000.0; // NOTE constant also set in in encodeFloatLog and in TypeScript\nconst float floatLogFactor = log(maxFloat + 1.0);\nfloat decodeFloatLog(in float value) { return exp(value * floatLogFactor) - 1.0; }\n\n#endif\n\nuniform float uSizeFactor;\n\nuniform float uPixelRatio;\nuniform float uViewportHeight;\n\nattribute vec3 aPosition;\nattribute mat4 aTransform;\nattribute float aInstance;\nattribute float aGroup;\n\nattribute vec2 aMapping;\nattribute vec3 aStart;\nattribute vec3 aEnd;\n\nvoid trimSegment(const in vec4 start, inout vec4 end) {\n    // trim end segment so it terminates between the camera plane and the near plane\n    // conservative estimate of the near plane\n    float a = uProjection[2][2];  // 3nd entry in 3th column\n    float b = uProjection[3][2];  // 3nd entry in 4th column\n    float nearEstimate = -0.5 * b / a;\n    float alpha = (nearEstimate - start.z) / (end.z - start.z);\n    end.xyz = mix(start.xyz, end.xyz, alpha);\n}\n\nvoid main(){\n    #if defined(dColorType_attribute)\n    vColor.rgb = aColor;\n#elif defined(dColorType_instance)\n    vColor.rgb = readFromTexture(tColor, aInstance, uColorTexDim).rgb;\n#elif defined(dColorType_group)\n    vColor.rgb = readFromTexture(tColor, aGroup, uColorTexDim).rgb;\n#elif defined(dColorType_groupInstance)\n    vColor.rgb = readFromTexture(tColor, aInstance * float(uGroupCount) + aGroup, uColorTexDim).rgb;\n#elif defined(dColorType_objectPicking)\n    vColor = vec4(encodeFloatRGB(float(uObjectId)), 1.0);\n#elif defined(dColorType_instancePicking)\n    vColor = vec4(encodeFloatRGB(aInstance), 1.0);\n#elif defined(dColorType_groupPicking)\n    vColor = vec4(encodeFloatRGB(aGroup), 1.0);\n#endif\n    vMarker = readFromTexture(tMarker, aInstance * float(uGroupCount) + aGroup, uMarkerTexDim).a;\n    #if defined(dSizeType_uniform)\n    float size = uSize;\n#elif defined(dSizeType_attribute)\n    float size = aSize;\n#elif defined(dSizeType_instance)\n    float size = readFromTexture(tSize, aInstance, uSizeTexDim).a;\n#elif defined(dSizeType_group)\n    float size = readFromTexture(tSize, aGroup, uSizeTexDim).a;\n#elif defined(dSizeType_groupInstance)\n    float size = readFromTexture(tSize, aInstance * float(uGroupCount) + aGroup, uSizeTexDim).a;\n#endif\n\n#if defined(dSizeType_instance) || defined(dSizeType_group) || defined(dSizeType_groupInstance)\n    size = decodeFloatLog(size);\n#endif\n\nsize *= uSizeFactor;\n\n    mat4 modelView = uView * uModel * aTransform;\n\n    // camera space\n    vec4 start = modelView * vec4(aStart, 1.0);\n    vec4 end = modelView * vec4(aEnd, 1.0);\n\n    // special case for perspective projection, and segments that terminate either in, or behind, the camera plane\n    // clearly the gpu firmware has a way of addressing this issue when projecting into ndc space\n    // but we need to perform ndc-space calculations in the shader, so we must address this issue directly\n    // perhaps there is a more elegant solution -- WestLangley\n    bool perspective = (uProjection[2][3] == -1.0); // 4th entry in the 3rd column\n    if (perspective) {\n        if (start.z < 0.0 && end.z >= 0.0) {\n            trimSegment(start, end);\n        } else if (end.z < 0.0 && start.z >= 0.0) {\n            trimSegment(end, start);\n        }\n    }\n\n    // clip space\n    vec4 clipStart = uProjection * start;\n    vec4 clipEnd = uProjection * end;\n\n    // ndc space\n    vec2 ndcStart = clipStart.xy / clipStart.w;\n    vec2 ndcEnd = clipEnd.xy / clipEnd.w;\n\n    // direction\n    vec2 dir = ndcEnd - ndcStart;\n\n    // account for clip-space aspect ratio\n    dir.x *= uPixelRatio;\n    dir = normalize(dir);\n\n    // perpendicular to dir\n    vec2 offset = vec2(dir.y, - dir.x);\n\n    // undo aspect ratio adjustment\n    dir.x /= uPixelRatio;\n    offset.x /= uPixelRatio;\n\n    // sign flip\n    if (aMapping.x < 0.0) offset *= -1.0;\n\n    // calculate linewidth\n    float linewidth;\n    #ifdef dLineSizeAttenuation\n        linewidth = size * uPixelRatio * ((uViewportHeight / 2.0) / -start.z) * 5.0;\n    #else\n        linewidth = size * uPixelRatio;\n    #endif\n\n    // adjust for linewidth\n    offset *= linewidth;\n\n    // adjust for clip-space to screen-space conversion\n    offset /= uViewportHeight;\n\n    // select end\n    vec4 clip = (aMapping.y < 0.5) ? clipStart : clipEnd;\n\n    // back to clip space\n    offset *= clip.w;\n    clip.xy += offset;\n    gl_Position = clip;\n}"},function(e,t){e.exports="/**\n * Copyright (c) 2018 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n */\n\nprecision highp float;\nprecision highp int;\n#define GLSLIFY 1\n\nuniform int uObjectId;\nuniform int uInstanceCount;\nuniform int uGroupCount;\n\nuniform vec3 uHighlightColor;\nuniform vec3 uSelectColor;\nvarying float vMarker;\n\nvarying vec3 vViewPosition;\n\nuniform float uFogNear;\nuniform float uFogFar;\nuniform vec3 uFogColor;\n\nuniform float uAlpha;\nuniform float uPickingAlphaThreshold;\nuniform int uPickable;\n\nfloat intDiv(float a, float b) { return float(int(a) / int(b)); }\nfloat intMod(float a, float b) { return a - b * float(int(a) / int(b)); }\n\n#if __VERSION__ != 300\n    // transpose\n\n    float transpose(const in float m) {\n        return m;\n    }\n\n    mat2 transpose(const in mat2 m) {\n        return mat2(\n            m[0][0], m[1][0],\n            m[0][1], m[1][1]\n        );\n    }\n\n    mat3 transpose(const in mat3 m) {\n        return mat3(\n            m[0][0], m[1][0], m[2][0],\n            m[0][1], m[1][1], m[2][1],\n            m[0][2], m[1][2], m[2][2]\n        );\n    }\n\n    mat4 transpose(const in mat4 m) {\n        return mat4(\n            m[0][0], m[1][0], m[2][0], m[3][0],\n            m[0][1], m[1][1], m[2][1], m[3][1],\n            m[0][2], m[1][2], m[2][2], m[3][2],\n            m[0][3], m[1][3], m[2][3], m[3][3]\n        );\n    }\n\n    float inverse(const in float m) {\n        return 1.0 / m;\n    }\n\n    // inverse\n\n    mat2 inverse(const in mat2 m) {\n        return mat2(m[1][1],-m[0][1],\n                -m[1][0], m[0][0]) / (m[0][0]*m[1][1] - m[0][1]*m[1][0]);\n    }\n\n    mat3 inverse(const in mat3 m) {\n        float a00 = m[0][0], a01 = m[0][1], a02 = m[0][2];\n        float a10 = m[1][0], a11 = m[1][1], a12 = m[1][2];\n        float a20 = m[2][0], a21 = m[2][1], a22 = m[2][2];\n\n        float b01 = a22 * a11 - a12 * a21;\n        float b11 = -a22 * a10 + a12 * a20;\n        float b21 = a21 * a10 - a11 * a20;\n\n        float det = a00 * b01 + a01 * b11 + a02 * b21;\n\n        return mat3(b01, (-a22 * a01 + a02 * a21), (a12 * a01 - a02 * a11),\n                    b11, (a22 * a00 - a02 * a20), (-a12 * a00 + a02 * a10),\n                    b21, (-a21 * a00 + a01 * a20), (a11 * a00 - a01 * a10)) / det;\n    }\n\n    mat4 inverse(const in mat4 m) {\n        float\n            a00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3],\n            a10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3],\n            a20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3],\n            a30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3],\n\n            b00 = a00 * a11 - a01 * a10,\n            b01 = a00 * a12 - a02 * a10,\n            b02 = a00 * a13 - a03 * a10,\n            b03 = a01 * a12 - a02 * a11,\n            b04 = a01 * a13 - a03 * a11,\n            b05 = a02 * a13 - a03 * a12,\n            b06 = a20 * a31 - a21 * a30,\n            b07 = a20 * a32 - a22 * a30,\n            b08 = a20 * a33 - a23 * a30,\n            b09 = a21 * a32 - a22 * a31,\n            b10 = a21 * a33 - a23 * a31,\n            b11 = a22 * a33 - a23 * a32,\n\n            det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n\n        return mat4(\n            a11 * b11 - a12 * b10 + a13 * b09,\n            a02 * b10 - a01 * b11 - a03 * b09,\n            a31 * b05 - a32 * b04 + a33 * b03,\n            a22 * b04 - a21 * b05 - a23 * b03,\n            a12 * b08 - a10 * b11 - a13 * b07,\n            a00 * b11 - a02 * b08 + a03 * b07,\n            a32 * b02 - a30 * b05 - a33 * b01,\n            a20 * b05 - a22 * b02 + a23 * b01,\n            a10 * b10 - a11 * b08 + a13 * b06,\n            a01 * b08 - a00 * b10 - a03 * b06,\n            a30 * b04 - a31 * b02 + a33 * b00,\n            a21 * b02 - a20 * b04 - a23 * b00,\n            a11 * b07 - a10 * b09 - a12 * b06,\n            a00 * b09 - a01 * b07 + a02 * b06,\n            a31 * b01 - a30 * b03 - a32 * b00,\n            a20 * b03 - a21 * b01 + a22 * b00) / det;\n    }\n#endif\n#if defined(dColorType_uniform)\n    uniform vec3 uColor;\n#elif defined(dColorType_attribute) || defined(dColorType_instance) || defined(dColorType_group) || defined(dColorType_groupInstance)\n    varying vec4 vColor;\n#elif defined(dColorType_objectPicking) || defined(dColorType_instancePicking) || defined(dColorType_groupPicking)\n    #if __VERSION__ != 300\n        varying vec4 vColor;\n    #else\n        flat in vec4 vColor;\n    #endif\n#endif\n\nvoid main(){\n    #if defined(dColorType_uniform)\n    vec4 material = vec4(uColor, uAlpha);\n#elif defined(dColorType_attribute) || defined(dColorType_instance) || defined(dColorType_group) || defined(dColorType_groupInstance)\n    vec4 material = vec4(vColor.rgb, uAlpha);\n#elif defined(dColorType_objectPicking) || defined(dColorType_instancePicking) || defined(dColorType_groupPicking)\n    vec4 material = uPickable == 1 ? vColor : vec4(0.0, 0.0, 0.0, 1.0); // set to empty picking id\n#endif\n\n    #if defined(dColorType_objectPicking) || defined(dColorType_instancePicking) || defined(dColorType_groupPicking)\n        if (uAlpha < uPickingAlphaThreshold)\n            discard; // ignore so the element below can be picked\n        gl_FragColor = material;\n    #else\n        gl_FragColor = material;\n\n        // only mark elements with an alpha above the picking threshold\nif (uAlpha >= uPickingAlphaThreshold) {\n    float marker = floor(vMarker * 255.0 + 0.5); // rounding required to work on some cards on win\n    if (marker > 0.1) {\n        if (intMod(marker, 2.0) > 0.1) {\n            gl_FragColor.rgb = mix(uHighlightColor, gl_FragColor.rgb, 0.3);\n        } else {\n            gl_FragColor.rgb = mix(uSelectColor, gl_FragColor.rgb, 0.3);\n        }\n    }\n}\n        #ifdef dUseFog\n\tfloat depth = length(vViewPosition);\n    float fogFactor = smoothstep(uFogNear, uFogFar, depth);\n\tgl_FragColor.rgb = mix(gl_FragColor.rgb, uFogColor, fogFactor);\n    float fogAlpha = (1.0 - fogFactor) * gl_FragColor.a;\n    if (fogAlpha < 0.01)\n        discard;\n    gl_FragColor = vec4(gl_FragColor.rgb, fogAlpha);\n#endif\n    #endif\n}"},function(e,t){e.exports="/**\n * Copyright (c) 2018 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n */\n\nprecision highp float;\nprecision highp int;\n#define GLSLIFY 1\n\nuniform mat4 uProjection, uModel, uView;\nuniform vec3 uCameraPosition;\n\nuniform int uObjectId;\nuniform int uInstanceCount;\nuniform int uGroupCount;\n\nuniform vec2 uMarkerTexDim;\nuniform sampler2D tMarker;\nvarying float vMarker;\n\nvarying vec3 vViewPosition;\n\nfloat intDiv(float a, float b) { return float(int(a) / int(b)); }\nfloat intMod(float a, float b) { return a - b * float(int(a) / int(b)); }\n\n#if __VERSION__ != 300\n    // transpose\n\n    float transpose(const in float m) {\n        return m;\n    }\n\n    mat2 transpose(const in mat2 m) {\n        return mat2(\n            m[0][0], m[1][0],\n            m[0][1], m[1][1]\n        );\n    }\n\n    mat3 transpose(const in mat3 m) {\n        return mat3(\n            m[0][0], m[1][0], m[2][0],\n            m[0][1], m[1][1], m[2][1],\n            m[0][2], m[1][2], m[2][2]\n        );\n    }\n\n    mat4 transpose(const in mat4 m) {\n        return mat4(\n            m[0][0], m[1][0], m[2][0], m[3][0],\n            m[0][1], m[1][1], m[2][1], m[3][1],\n            m[0][2], m[1][2], m[2][2], m[3][2],\n            m[0][3], m[1][3], m[2][3], m[3][3]\n        );\n    }\n\n    float inverse(const in float m) {\n        return 1.0 / m;\n    }\n\n    // inverse\n\n    mat2 inverse(const in mat2 m) {\n        return mat2(m[1][1],-m[0][1],\n                -m[1][0], m[0][0]) / (m[0][0]*m[1][1] - m[0][1]*m[1][0]);\n    }\n\n    mat3 inverse(const in mat3 m) {\n        float a00 = m[0][0], a01 = m[0][1], a02 = m[0][2];\n        float a10 = m[1][0], a11 = m[1][1], a12 = m[1][2];\n        float a20 = m[2][0], a21 = m[2][1], a22 = m[2][2];\n\n        float b01 = a22 * a11 - a12 * a21;\n        float b11 = -a22 * a10 + a12 * a20;\n        float b21 = a21 * a10 - a11 * a20;\n\n        float det = a00 * b01 + a01 * b11 + a02 * b21;\n\n        return mat3(b01, (-a22 * a01 + a02 * a21), (a12 * a01 - a02 * a11),\n                    b11, (a22 * a00 - a02 * a20), (-a12 * a00 + a02 * a10),\n                    b21, (-a21 * a00 + a01 * a20), (a11 * a00 - a01 * a10)) / det;\n    }\n\n    mat4 inverse(const in mat4 m) {\n        float\n            a00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3],\n            a10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3],\n            a20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3],\n            a30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3],\n\n            b00 = a00 * a11 - a01 * a10,\n            b01 = a00 * a12 - a02 * a10,\n            b02 = a00 * a13 - a03 * a10,\n            b03 = a01 * a12 - a02 * a11,\n            b04 = a01 * a13 - a03 * a11,\n            b05 = a02 * a13 - a03 * a12,\n            b06 = a20 * a31 - a21 * a30,\n            b07 = a20 * a32 - a22 * a30,\n            b08 = a20 * a33 - a23 * a30,\n            b09 = a21 * a32 - a22 * a31,\n            b10 = a21 * a33 - a23 * a31,\n            b11 = a22 * a33 - a23 * a32,\n\n            det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n\n        return mat4(\n            a11 * b11 - a12 * b10 + a13 * b09,\n            a02 * b10 - a01 * b11 - a03 * b09,\n            a31 * b05 - a32 * b04 + a33 * b03,\n            a22 * b04 - a21 * b05 - a23 * b03,\n            a12 * b08 - a10 * b11 - a13 * b07,\n            a00 * b11 - a02 * b08 + a03 * b07,\n            a32 * b02 - a30 * b05 - a33 * b01,\n            a20 * b05 - a22 * b02 + a23 * b01,\n            a10 * b10 - a11 * b08 + a13 * b06,\n            a01 * b08 - a00 * b10 - a03 * b06,\n            a30 * b04 - a31 * b02 + a33 * b00,\n            a21 * b02 - a20 * b04 - a23 * b00,\n            a11 * b07 - a10 * b09 - a12 * b06,\n            a00 * b09 - a01 * b07 + a02 * b06,\n            a31 * b01 - a30 * b03 - a32 * b00,\n            a20 * b03 - a21 * b01 + a22 * b00) / det;\n    }\n#endif\n/**\n * Copyright (c) 2018 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n */\n\nvec4 readFromTexture (const in sampler2D tex, const in float i, const in vec2 dim) {\n    float x = intMod(i, dim.x);\n    float y = floor(intDiv(i, dim.x));\n    vec2 uv = (vec2(x, y) + 0.5) / dim;\n    return texture2D(tex, uv);\n}\n\n#if defined(dColorType_uniform)\n    uniform vec3 uColor;\n#elif defined(dColorType_attribute)\n    varying vec4 vColor;\n    attribute vec3 aColor;\n#elif defined(dColorType_instance) || defined(dColorType_group) || defined(dColorType_groupInstance)\n    varying vec4 vColor;\n    uniform vec2 uColorTexDim;\n    uniform sampler2D tColor;\n#elif defined(dColorType_objectPicking) || defined(dColorType_instancePicking) || defined(dColorType_groupPicking)\n    #if __VERSION__ != 300\n        varying vec4 vColor;\n    #else\n        flat out vec4 vColor;\n    #endif\n    /**\n * Copyright (c) 2018 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n */\n\nvec3 encodeFloatRGB(in float value) {\n    value = clamp(value, 0.0, 16777216.0 - 1.0) + 1.0;\n    vec3 c = vec3(0.0);\n    c.b = mod(value, 256.0);\n    value = floor(value / 256.0);\n    c.g = mod(value, 256.0);\n    value = floor(value / 256.0);\n    c.r = mod(value, 256.0);\n    return c / 255.0;\n}\n\n#endif\n\nattribute vec3 aPosition;\nattribute mat4 aTransform;\nattribute float aInstance;\nattribute float aGroup;\n\n#ifndef dFlatShaded\n    attribute vec3 aNormal;\n    varying vec3 vNormal;\n#endif\n\nvoid main(){\n    #if defined(dColorType_attribute)\n    vColor.rgb = aColor;\n#elif defined(dColorType_instance)\n    vColor.rgb = readFromTexture(tColor, aInstance, uColorTexDim).rgb;\n#elif defined(dColorType_group)\n    vColor.rgb = readFromTexture(tColor, aGroup, uColorTexDim).rgb;\n#elif defined(dColorType_groupInstance)\n    vColor.rgb = readFromTexture(tColor, aInstance * float(uGroupCount) + aGroup, uColorTexDim).rgb;\n#elif defined(dColorType_objectPicking)\n    vColor = vec4(encodeFloatRGB(float(uObjectId)), 1.0);\n#elif defined(dColorType_instancePicking)\n    vColor = vec4(encodeFloatRGB(aInstance), 1.0);\n#elif defined(dColorType_groupPicking)\n    vColor = vec4(encodeFloatRGB(aGroup), 1.0);\n#endif\n    vMarker = readFromTexture(tMarker, aInstance * float(uGroupCount) + aGroup, uMarkerTexDim).a;\n    mat4 modelView = uView * uModel * aTransform;\nvec4 mvPosition = modelView * vec4(aPosition, 1.0);\nvViewPosition = mvPosition.xyz;\ngl_Position = uProjection * mvPosition;\n\n    #ifndef dFlatShaded\n        mat3 normalMatrix = transpose(inverse(mat3(modelView)));\n        vec3 transformedNormal = normalize(normalMatrix * normalize(aNormal));\n        #if defined(dFlipSided) && !defined(dDoubleSided) // TODO checking dDoubleSided should not be required, ASR\n            transformedNormal = -transformedNormal;\n        #endif\n        vNormal = transformedNormal;\n    #endif\n}"},function(e,t){e.exports="/**\n * Copyright (c) 2018 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n */\n\nprecision highp float;\nprecision highp int;\n#define GLSLIFY 1\n\nuniform int uObjectId;\nuniform int uInstanceCount;\nuniform int uGroupCount;\n\nuniform vec3 uHighlightColor;\nuniform vec3 uSelectColor;\nvarying float vMarker;\n\nvarying vec3 vViewPosition;\n\nuniform float uFogNear;\nuniform float uFogFar;\nuniform vec3 uFogColor;\n\nuniform float uAlpha;\nuniform float uPickingAlphaThreshold;\nuniform int uPickable;\n\nfloat intDiv(float a, float b) { return float(int(a) / int(b)); }\nfloat intMod(float a, float b) { return a - b * float(int(a) / int(b)); }\n\n#if __VERSION__ != 300\n    // transpose\n\n    float transpose(const in float m) {\n        return m;\n    }\n\n    mat2 transpose(const in mat2 m) {\n        return mat2(\n            m[0][0], m[1][0],\n            m[0][1], m[1][1]\n        );\n    }\n\n    mat3 transpose(const in mat3 m) {\n        return mat3(\n            m[0][0], m[1][0], m[2][0],\n            m[0][1], m[1][1], m[2][1],\n            m[0][2], m[1][2], m[2][2]\n        );\n    }\n\n    mat4 transpose(const in mat4 m) {\n        return mat4(\n            m[0][0], m[1][0], m[2][0], m[3][0],\n            m[0][1], m[1][1], m[2][1], m[3][1],\n            m[0][2], m[1][2], m[2][2], m[3][2],\n            m[0][3], m[1][3], m[2][3], m[3][3]\n        );\n    }\n\n    float inverse(const in float m) {\n        return 1.0 / m;\n    }\n\n    // inverse\n\n    mat2 inverse(const in mat2 m) {\n        return mat2(m[1][1],-m[0][1],\n                -m[1][0], m[0][0]) / (m[0][0]*m[1][1] - m[0][1]*m[1][0]);\n    }\n\n    mat3 inverse(const in mat3 m) {\n        float a00 = m[0][0], a01 = m[0][1], a02 = m[0][2];\n        float a10 = m[1][0], a11 = m[1][1], a12 = m[1][2];\n        float a20 = m[2][0], a21 = m[2][1], a22 = m[2][2];\n\n        float b01 = a22 * a11 - a12 * a21;\n        float b11 = -a22 * a10 + a12 * a20;\n        float b21 = a21 * a10 - a11 * a20;\n\n        float det = a00 * b01 + a01 * b11 + a02 * b21;\n\n        return mat3(b01, (-a22 * a01 + a02 * a21), (a12 * a01 - a02 * a11),\n                    b11, (a22 * a00 - a02 * a20), (-a12 * a00 + a02 * a10),\n                    b21, (-a21 * a00 + a01 * a20), (a11 * a00 - a01 * a10)) / det;\n    }\n\n    mat4 inverse(const in mat4 m) {\n        float\n            a00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3],\n            a10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3],\n            a20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3],\n            a30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3],\n\n            b00 = a00 * a11 - a01 * a10,\n            b01 = a00 * a12 - a02 * a10,\n            b02 = a00 * a13 - a03 * a10,\n            b03 = a01 * a12 - a02 * a11,\n            b04 = a01 * a13 - a03 * a11,\n            b05 = a02 * a13 - a03 * a12,\n            b06 = a20 * a31 - a21 * a30,\n            b07 = a20 * a32 - a22 * a30,\n            b08 = a20 * a33 - a23 * a30,\n            b09 = a21 * a32 - a22 * a31,\n            b10 = a21 * a33 - a23 * a31,\n            b11 = a22 * a33 - a23 * a32,\n\n            det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n\n        return mat4(\n            a11 * b11 - a12 * b10 + a13 * b09,\n            a02 * b10 - a01 * b11 - a03 * b09,\n            a31 * b05 - a32 * b04 + a33 * b03,\n            a22 * b04 - a21 * b05 - a23 * b03,\n            a12 * b08 - a10 * b11 - a13 * b07,\n            a00 * b11 - a02 * b08 + a03 * b07,\n            a32 * b02 - a30 * b05 - a33 * b01,\n            a20 * b05 - a22 * b02 + a23 * b01,\n            a10 * b10 - a11 * b08 + a13 * b06,\n            a01 * b08 - a00 * b10 - a03 * b06,\n            a30 * b04 - a31 * b02 + a33 * b00,\n            a21 * b02 - a20 * b04 - a23 * b00,\n            a11 * b07 - a10 * b09 - a12 * b06,\n            a00 * b09 - a01 * b07 + a02 * b06,\n            a31 * b01 - a30 * b03 - a32 * b00,\n            a20 * b03 - a21 * b01 + a22 * b00) / det;\n    }\n#endif\n#if defined(dColorType_uniform)\n    uniform vec3 uColor;\n#elif defined(dColorType_attribute) || defined(dColorType_instance) || defined(dColorType_group) || defined(dColorType_groupInstance)\n    varying vec4 vColor;\n#elif defined(dColorType_objectPicking) || defined(dColorType_instancePicking) || defined(dColorType_groupPicking)\n    #if __VERSION__ != 300\n        varying vec4 vColor;\n    #else\n        flat in vec4 vColor;\n    #endif\n#endif\n\n// uniform vec3 uLightPosition;\nuniform vec3 uLightColor;\nuniform vec3 uLightAmbient;\nuniform mat4 uView;\n\n#if !defined(dFlatShaded) || !defined(enabledStandardDerivatives)\n    varying vec3 vNormal;\n#endif\n\n// by Tom Madams\n// Simple:\n// https://imdoingitwrong.wordpress.com/2011/01/31/light-attenuation/\n//\n// Improved\n// https://imdoingitwrong.wordpress.com/2011/02/10/improved-light-attenuation/\nfloat attenuation_0(const in float r, const in float f, const in float d) {\n    float denom = d / r + 1.0;\n    float attenuation = 1.0 / (denom*denom);\n    float t = (attenuation - f) / (1.0 - f);\n    return max(t, 0.0);\n}\n\n// (c) 2014 Mikola Lysenko. MIT License\n// https://github.com/glslify/glsl-specular-phong\n\nfloat phongSpecular(const in vec3 lightDirection, const in vec3 viewDirection, const in vec3 surfaceNormal, const in float shininess) {\n    //Calculate Phong power\n    vec3 R = -reflect(lightDirection, surfaceNormal);\n    return pow(max(0.0, dot(viewDirection, R)), shininess);\n}\n\n// (c) 2014 Mikola Lysenko. MIT License\n// https://github.com/glslify/glsl-diffuse-oren-nayar\n\n#define PI 3.14159265\n\nfloat orenNayarDiffuse(const in vec3 lightDirection, const in vec3 viewDirection, const in vec3 surfaceNormal, const in float roughness, const in float albedo) {\n    float LdotV = dot(lightDirection, viewDirection);\n    float NdotL = dot(lightDirection, surfaceNormal);\n    float NdotV = dot(surfaceNormal, viewDirection);\n\n    float s = LdotV - NdotL * NdotV;\n    float t = mix(1.0, max(NdotL, NdotV), step(0.0, s));\n\n    float sigma2 = roughness * roughness;\n    float A = 1.0 + sigma2 * (albedo / (sigma2 + 0.13) + 0.5 / (sigma2 + 0.33));\n    float B = 0.45 * sigma2 / (sigma2 + 0.09);\n\n    return albedo * max(0.0, NdotL) * (A + B * s / t) / PI;\n}\n\nconst float specularScale = 0.15;\nconst float shininess = 200.0;\nconst float roughness = 100.0;\nconst float albedo = 0.95;\n\nvoid main() {\n    // material color\n    #if defined(dColorType_uniform)\n    vec4 material = vec4(uColor, uAlpha);\n#elif defined(dColorType_attribute) || defined(dColorType_instance) || defined(dColorType_group) || defined(dColorType_groupInstance)\n    vec4 material = vec4(vColor.rgb, uAlpha);\n#elif defined(dColorType_objectPicking) || defined(dColorType_instancePicking) || defined(dColorType_groupPicking)\n    vec4 material = uPickable == 1 ? vColor : vec4(0.0, 0.0, 0.0, 1.0); // set to empty picking id\n#endif\n\n    #if defined(dColorType_objectPicking) || defined(dColorType_instancePicking) || defined(dColorType_groupPicking)\n        if (uAlpha < uPickingAlphaThreshold)\n            discard; // ignore so the element below can be picked\n        gl_FragColor = material;\n    #else\n        // determine surface to light direction\n        // vec4 viewLightPosition = view * vec4(lightPosition, 1.0);\n        // vec3 lightVector = viewLightPosition.xyz - vViewPosition;\n        vec3 lightVector = vViewPosition;\n\n        vec3 L = normalize(lightVector); // light direction\n        vec3 V = normalize(vViewPosition); // eye direction\n\n        // surface normal\n        #if defined(dFlatShaded) && defined(enabledStandardDerivatives)\n            vec3 fdx = dFdx(vViewPosition);\n            vec3 fdy = dFdy(vViewPosition);\n            vec3 N = -normalize(cross(fdx, fdy));\n        #else\n            vec3 N = -normalize(vNormal);\n            #ifdef dDoubleSided\n                N = N * (float(gl_FrontFacing) * 2.0 - 1.0);\n            #endif\n        #endif\n\n        // compute our diffuse & specular terms\n        float specular = phongSpecular(L, V, N, shininess) * specularScale;\n        vec3 diffuse = uLightColor * orenNayarDiffuse(L, V, N, roughness, albedo);\n        vec3 ambient = uLightAmbient;\n\n        // add the lighting\n        vec3 finalColor = material.rgb * (diffuse + ambient) + specular;\n\n        // gl_FragColor.rgb = N;\n        // gl_FragColor.a = 1.0;\n        // gl_FragColor.rgb = vec3(1.0, 0.0, 0.0);\n        gl_FragColor.rgb = finalColor;\n        gl_FragColor.a = material.a;\n\n        // only mark elements with an alpha above the picking threshold\nif (uAlpha >= uPickingAlphaThreshold) {\n    float marker = floor(vMarker * 255.0 + 0.5); // rounding required to work on some cards on win\n    if (marker > 0.1) {\n        if (intMod(marker, 2.0) > 0.1) {\n            gl_FragColor.rgb = mix(uHighlightColor, gl_FragColor.rgb, 0.3);\n        } else {\n            gl_FragColor.rgb = mix(uSelectColor, gl_FragColor.rgb, 0.3);\n        }\n    }\n}\n        #ifdef dUseFog\n\tfloat depth = length(vViewPosition);\n    float fogFactor = smoothstep(uFogNear, uFogFar, depth);\n\tgl_FragColor.rgb = mix(gl_FragColor.rgb, uFogColor, fogFactor);\n    float fogAlpha = (1.0 - fogFactor) * gl_FragColor.a;\n    if (fogAlpha < 0.01)\n        discard;\n    gl_FragColor = vec4(gl_FragColor.rgb, fogAlpha);\n#endif\n    #endif\n}"},function(e,t){e.exports="/**\n * Copyright (c) 2018 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @author Michael Krone <michael.krone@uni-tuebingen.de>\n */\n\nprecision highp float;\n#define GLSLIFY 1\n\nattribute vec3 aPosition;\nattribute float aRadius;\n\nvarying vec3 vPosition;\nvarying float vRadius;\n\n#if defined(dCalcType_groupId)\n    attribute float aGroup;\n    varying float vGroup;\n#endif\n\nuniform vec3 uBboxSize;\nuniform vec3 uBboxMin;\nuniform vec3 uBboxMax;\nuniform vec3 uGridDim;\nuniform float uCurrentSlice;\n\nvoid main() {\n    vRadius = aRadius;\n    #if defined(dCalcType_groupId)\n        vGroup = aGroup;\n    #endif\n    float scale = max(uBboxSize.z, max(uBboxSize.x, uBboxSize.y));\n    gl_PointSize = (vRadius / scale) * max(uGridDim.x, uGridDim.y) * 6.0;\n    vPosition = (aPosition - uBboxMin) / uBboxSize;\n    gl_Position = vec4(vPosition * 2.0 - 1.0, 1.0);\n}"},function(e,t){e.exports="/**\n * Copyright (c) 2018 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @author Michael Krone <michael.krone@uni-tuebingen.de>\n */\n\nprecision highp float;\n\nvarying vec3 vPosition;\nvarying float vRadius;\n#if defined(dCalcType_groupId)\n    #if defined(dGridTexType_2d)\n        precision mediump sampler2D;\n        uniform sampler2D tMinDistanceTex;\n        uniform vec3 uGridTexDim;\n    #elif defined(dGridTexType_3d)\n        precision highp sampler3D;\n#define GLSLIFY 1\n\n        uniform sampler3D tMinDistanceTex;\n    #endif\n    varying float vGroup;\n#endif\n\nfloat intDiv(float a, float b) { return float(int(a) / int(b)); }\nfloat intMod(float a, float b) { return a - b * float(int(a) / int(b)); }\n\n#if __VERSION__ != 300\n    // transpose\n\n    float transpose(const in float m) {\n        return m;\n    }\n\n    mat2 transpose(const in mat2 m) {\n        return mat2(\n            m[0][0], m[1][0],\n            m[0][1], m[1][1]\n        );\n    }\n\n    mat3 transpose(const in mat3 m) {\n        return mat3(\n            m[0][0], m[1][0], m[2][0],\n            m[0][1], m[1][1], m[2][1],\n            m[0][2], m[1][2], m[2][2]\n        );\n    }\n\n    mat4 transpose(const in mat4 m) {\n        return mat4(\n            m[0][0], m[1][0], m[2][0], m[3][0],\n            m[0][1], m[1][1], m[2][1], m[3][1],\n            m[0][2], m[1][2], m[2][2], m[3][2],\n            m[0][3], m[1][3], m[2][3], m[3][3]\n        );\n    }\n\n    float inverse(const in float m) {\n        return 1.0 / m;\n    }\n\n    // inverse\n\n    mat2 inverse(const in mat2 m) {\n        return mat2(m[1][1],-m[0][1],\n                -m[1][0], m[0][0]) / (m[0][0]*m[1][1] - m[0][1]*m[1][0]);\n    }\n\n    mat3 inverse(const in mat3 m) {\n        float a00 = m[0][0], a01 = m[0][1], a02 = m[0][2];\n        float a10 = m[1][0], a11 = m[1][1], a12 = m[1][2];\n        float a20 = m[2][0], a21 = m[2][1], a22 = m[2][2];\n\n        float b01 = a22 * a11 - a12 * a21;\n        float b11 = -a22 * a10 + a12 * a20;\n        float b21 = a21 * a10 - a11 * a20;\n\n        float det = a00 * b01 + a01 * b11 + a02 * b21;\n\n        return mat3(b01, (-a22 * a01 + a02 * a21), (a12 * a01 - a02 * a11),\n                    b11, (a22 * a00 - a02 * a20), (-a12 * a00 + a02 * a10),\n                    b21, (-a21 * a00 + a01 * a20), (a11 * a00 - a01 * a10)) / det;\n    }\n\n    mat4 inverse(const in mat4 m) {\n        float\n            a00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3],\n            a10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3],\n            a20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3],\n            a30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3],\n\n            b00 = a00 * a11 - a01 * a10,\n            b01 = a00 * a12 - a02 * a10,\n            b02 = a00 * a13 - a03 * a10,\n            b03 = a01 * a12 - a02 * a11,\n            b04 = a01 * a13 - a03 * a11,\n            b05 = a02 * a13 - a03 * a12,\n            b06 = a20 * a31 - a21 * a30,\n            b07 = a20 * a32 - a22 * a30,\n            b08 = a20 * a33 - a23 * a30,\n            b09 = a21 * a32 - a22 * a31,\n            b10 = a21 * a33 - a23 * a31,\n            b11 = a22 * a33 - a23 * a32,\n\n            det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n\n        return mat4(\n            a11 * b11 - a12 * b10 + a13 * b09,\n            a02 * b10 - a01 * b11 - a03 * b09,\n            a31 * b05 - a32 * b04 + a33 * b03,\n            a22 * b04 - a21 * b05 - a23 * b03,\n            a12 * b08 - a10 * b11 - a13 * b07,\n            a00 * b11 - a02 * b08 + a03 * b07,\n            a32 * b02 - a30 * b05 - a33 * b01,\n            a20 * b05 - a22 * b02 + a23 * b01,\n            a10 * b10 - a11 * b08 + a13 * b06,\n            a01 * b08 - a00 * b10 - a03 * b06,\n            a30 * b04 - a31 * b02 + a33 * b00,\n            a21 * b02 - a20 * b04 - a23 * b00,\n            a11 * b07 - a10 * b09 - a12 * b06,\n            a00 * b09 - a01 * b07 + a02 * b06,\n            a31 * b01 - a30 * b03 - a32 * b00,\n            a20 * b03 - a21 * b01 + a22 * b00) / det;\n    }\n#endif\n/**\n * Copyright (c) 2019 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n */\n\nconst float maxFloat_0 = 10000.0; // NOTE constant also set in in decodeFloatLog and in TypeScript\nconst float floatLogFactor_0 = log(maxFloat_0 + 1.0);\nfloat encodeFloatLog(in float value) { return log(value + 1.0) / floatLogFactor_0; }\n\n/**\n * Copyright (c) 2019 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n */\n\nconst float maxFloat_1 = 10000.0; // NOTE constant also set in in encodeFloatLog and in TypeScript\nconst float floatLogFactor_1 = log(maxFloat_1 + 1.0);\nfloat decodeFloatLog(in float value) { return exp(value * floatLogFactor_1) - 1.0; }\n\n/**\n * Copyright (c) 2018 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n */\n\nvec3 encodeFloatRGB(in float value) {\n    value = clamp(value, 0.0, 16777216.0 - 1.0) + 1.0;\n    vec3 c = vec3(0.0);\n    c.b = mod(value, 256.0);\n    value = floor(value / 256.0);\n    c.g = mod(value, 256.0);\n    value = floor(value / 256.0);\n    c.r = mod(value, 256.0);\n    return c / 255.0;\n}\n\n/**\n * Copyright (c) 2017-2018 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @author Michael Krone <michael.krone@uni-tuebingen.de>\n */\n\nvec4 texture3dFrom2dNearest(sampler2D tex, vec3 pos, vec3 gridDim, vec2 texDim) {\n    float zSlice = floor(pos.z * gridDim.z + 0.5); // round to nearest z-slice\n    float column = intMod(zSlice * gridDim.x, texDim.x) / gridDim.x;\n    float row = floor(intDiv(zSlice * gridDim.x, texDim.x));\n    vec2 coord = (vec2(column * gridDim.x, row * gridDim.y) + (pos.xy * gridDim.xy)) / texDim;\n    return texture2D(tex, coord);\n}\n\nuniform vec3 uBboxSize;\nuniform vec3 uBboxMin;\nuniform vec3 uBboxMax;\nuniform vec3 uGridDim;\nuniform float uCurrentSlice;\nuniform float uCurrentX;\nuniform float uCurrentY;\nuniform float uAlpha;\n\n#if defined(dCalcType_groupId)\n    #if defined(dGridTexType_2d)\n        vec4 textureMinDist(vec3 pos) {\n            return texture3dFrom2dNearest(tMinDistanceTex, pos, uGridDim, uGridTexDim.xy);\n        }\n    #elif defined(dGridTexType_3d)\n        vec4 textureMinDist(vec3 pos) {\n            return texture(tMinDistanceTex, pos);\n        }\n    #endif\n#endif\n\nvoid main() {\n    vec2 v = gl_FragCoord.xy - vec2(uCurrentX, uCurrentY) - 0.5;\n    vec3 fragPos = vec3(v.x, v.y, uCurrentSlice) / uGridDim;\n    float dist = distance(fragPos * uBboxSize, vPosition * uBboxSize);\n\n    #if defined(dCalcType_density)\n        float radiusSq = vRadius * vRadius;\n        float density = exp(-uAlpha * ((dist * dist) / radiusSq));\n        gl_FragColor = vec4(density);\n    #elif defined(dCalcType_minDistance)\n        gl_FragColor.a = 1.0 - encodeFloatLog(dist);\n    #elif defined(dCalcType_groupId)\n        float minDistance = decodeFloatLog(1.0 - textureMinDist(fragPos).a);\n        // TODO verify `length(uBboxSize / uGridDim) * 2.0`\n        //      on some machines `* 2.0` is needed while on others `* 0.5` works\n        if (dist > minDistance + length(uBboxSize / uGridDim) * 0.5)\n            discard;\n        gl_FragColor.rgb = encodeFloatRGB(vGroup);\n    #endif\n}"},function(e,t){e.exports="/**\n * Copyright (c) 2017-2018 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @author Michael Krone <michael.krone@uni-tuebingen.de>\n */\n\nprecision highp float;\n#define GLSLIFY 1\n\nattribute vec3 aPosition;\nattribute mat4 aTransform;\nattribute float aInstance;\n\nvarying vec3 unitCoord;\nvarying vec3 origPos;\nvarying float instance;\n\nuniform vec3 uBboxSize;\nuniform vec3 uBboxMin;\nuniform vec3 uBboxMax;\nuniform vec3 uGridDim;\nuniform mat4 uTransform;\n\nuniform mat4 uModelView;\nuniform mat4 uProjection;\n\nvoid main() {\n    unitCoord = aPosition + vec3(0.5);\n    vec4 mvPosition = uModelView * uTransform * vec4(unitCoord * uGridDim, 1.0);\n    origPos = unitCoord * uBboxSize + uBboxMin;\n    instance = aInstance;\n    gl_Position = uProjection * mvPosition;\n\n    // clamp z position to clip space\n    if(gl_Position.z > gl_Position.w) {\n        gl_Position.z = gl_Position.w - 0.0001;\n    } else if(gl_Position.z < -gl_Position.w) {\n        gl_Position.z = -gl_Position.w + 0.0001;\n    }\n}"},function(e,t){e.exports="/**\n * Copyright (c) 2017-2018 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @author Michael Krone <michael.krone@uni-tuebingen.de>\n */\n\nprecision highp float;\n\nvarying vec3 unitCoord;\nvarying vec3 origPos;\nvarying float instance;\n\nuniform mat4 uInvView;\nuniform float uIsoValue;\nuniform vec3 uGridDim;\nuniform sampler2D tTransferTex;\n\nuniform int uObjectId;\nuniform int uInstanceCount;\nuniform int uGroupCount;\n\nuniform vec3 uHighlightColor;\nuniform vec3 uSelectColor;\nuniform vec2 uMarkerTexDim;\nuniform sampler2D tMarker;\n\nuniform float uAlpha;\nuniform float uPickingAlphaThreshold;\nuniform int uPickable;\n\n#if defined(dGridTexType_2d)\n    precision mediump sampler2D;\n    uniform sampler2D tGridTex;\n    uniform vec3 uGridTexDim;\n#elif defined(dGridTexType_3d)\n    precision mediump sampler3D;\n#define GLSLIFY 1\n\n    uniform sampler3D tGridTex;\n#endif\n\n#if defined(dColorType_uniform)\n    uniform vec3 uColor;\n#elif defined(dColorType_instance) || defined(dColorType_group) || defined(dColorType_groupInstance)\n    uniform vec2 uColorTexDim;\n    uniform sampler2D tColor;\n#endif\n\nfloat intDiv(float a, float b) { return float(int(a) / int(b)); }\nfloat intMod(float a, float b) { return a - b * float(int(a) / int(b)); }\n\n#if __VERSION__ != 300\n    // transpose\n\n    float transpose(const in float m) {\n        return m;\n    }\n\n    mat2 transpose(const in mat2 m) {\n        return mat2(\n            m[0][0], m[1][0],\n            m[0][1], m[1][1]\n        );\n    }\n\n    mat3 transpose(const in mat3 m) {\n        return mat3(\n            m[0][0], m[1][0], m[2][0],\n            m[0][1], m[1][1], m[2][1],\n            m[0][2], m[1][2], m[2][2]\n        );\n    }\n\n    mat4 transpose(const in mat4 m) {\n        return mat4(\n            m[0][0], m[1][0], m[2][0], m[3][0],\n            m[0][1], m[1][1], m[2][1], m[3][1],\n            m[0][2], m[1][2], m[2][2], m[3][2],\n            m[0][3], m[1][3], m[2][3], m[3][3]\n        );\n    }\n\n    float inverse(const in float m) {\n        return 1.0 / m;\n    }\n\n    // inverse\n\n    mat2 inverse(const in mat2 m) {\n        return mat2(m[1][1],-m[0][1],\n                -m[1][0], m[0][0]) / (m[0][0]*m[1][1] - m[0][1]*m[1][0]);\n    }\n\n    mat3 inverse(const in mat3 m) {\n        float a00 = m[0][0], a01 = m[0][1], a02 = m[0][2];\n        float a10 = m[1][0], a11 = m[1][1], a12 = m[1][2];\n        float a20 = m[2][0], a21 = m[2][1], a22 = m[2][2];\n\n        float b01 = a22 * a11 - a12 * a21;\n        float b11 = -a22 * a10 + a12 * a20;\n        float b21 = a21 * a10 - a11 * a20;\n\n        float det = a00 * b01 + a01 * b11 + a02 * b21;\n\n        return mat3(b01, (-a22 * a01 + a02 * a21), (a12 * a01 - a02 * a11),\n                    b11, (a22 * a00 - a02 * a20), (-a12 * a00 + a02 * a10),\n                    b21, (-a21 * a00 + a01 * a20), (a11 * a00 - a01 * a10)) / det;\n    }\n\n    mat4 inverse(const in mat4 m) {\n        float\n            a00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3],\n            a10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3],\n            a20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3],\n            a30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3],\n\n            b00 = a00 * a11 - a01 * a10,\n            b01 = a00 * a12 - a02 * a10,\n            b02 = a00 * a13 - a03 * a10,\n            b03 = a01 * a12 - a02 * a11,\n            b04 = a01 * a13 - a03 * a11,\n            b05 = a02 * a13 - a03 * a12,\n            b06 = a20 * a31 - a21 * a30,\n            b07 = a20 * a32 - a22 * a30,\n            b08 = a20 * a33 - a23 * a30,\n            b09 = a21 * a32 - a22 * a31,\n            b10 = a21 * a33 - a23 * a31,\n            b11 = a22 * a33 - a23 * a32,\n\n            det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n\n        return mat4(\n            a11 * b11 - a12 * b10 + a13 * b09,\n            a02 * b10 - a01 * b11 - a03 * b09,\n            a31 * b05 - a32 * b04 + a33 * b03,\n            a22 * b04 - a21 * b05 - a23 * b03,\n            a12 * b08 - a10 * b11 - a13 * b07,\n            a00 * b11 - a02 * b08 + a03 * b07,\n            a32 * b02 - a30 * b05 - a33 * b01,\n            a20 * b05 - a22 * b02 + a23 * b01,\n            a10 * b10 - a11 * b08 + a13 * b06,\n            a01 * b08 - a00 * b10 - a03 * b06,\n            a30 * b04 - a31 * b02 + a33 * b00,\n            a21 * b02 - a20 * b04 - a23 * b00,\n            a11 * b07 - a10 * b09 - a12 * b06,\n            a00 * b09 - a01 * b07 + a02 * b06,\n            a31 * b01 - a30 * b03 - a32 * b00,\n            a20 * b03 - a21 * b01 + a22 * b00) / det;\n    }\n#endif\n/**\n * Copyright (c) 2018 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n */\n\nvec4 readFromTexture (const in sampler2D tex_0, const in float i_0, const in vec2 dim) {\n    float x = intMod(i_0, dim.x);\n    float y = floor(intDiv(i_0, dim.x));\n    vec2 uv = (vec2(x, y) + 0.5) / dim;\n    return texture2D(tex_0, uv);\n}\n\n/**\n * Copyright (c) 2018 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n */\n\nvec3 encodeFloatRGB(in float value) {\n    value = clamp(value, 0.0, 16777216.0 - 1.0) + 1.0;\n    vec3 c = vec3(0.0);\n    c.b = mod(value, 256.0);\n    value = floor(value / 256.0);\n    c.g = mod(value, 256.0);\n    value = floor(value / 256.0);\n    c.r = mod(value, 256.0);\n    return c / 255.0;\n}\n\n/**\n * Copyright (c) 2018 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n */\n\nfloat decodeFloatRGB(const in vec3 rgb) {\n    return (rgb.r * 256.0 * 256.0 * 255.0 + rgb.g * 256.0 * 255.0 + rgb.b * 255.0) - 1.0;\n}\n\n/**\n * Copyright (c) 2017-2018 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @author Michael Krone <michael.krone@uni-tuebingen.de>\n */\n\nvec4 texture3dFrom2dNearest(sampler2D tex, vec3 pos, vec3 gridDim, vec2 texDim) {\n    float zSlice = floor(pos.z * gridDim.z + 0.5); // round to nearest z-slice\n    float column = intMod(zSlice * gridDim.x, texDim.x) / gridDim.x;\n    float row = floor(intDiv(zSlice * gridDim.x, texDim.x));\n    vec2 coord = (vec2(column * gridDim.x, row * gridDim.y) + (pos.xy * gridDim.xy)) / texDim;\n    return texture2D(tex, coord);\n}\n\n/**\n * Copyright (c) 2017-2018 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @author Michael Krone <michael.krone@uni-tuebingen.de>\n */\n\nvec4 texture3dFrom2dLinear(sampler2D tex, vec3 pos, vec3 gridDim, vec2 texDim) {\n    float zSlice0 = floor(pos.z * gridDim.z);\n    float column0 = intMod(zSlice0 * gridDim.x, texDim.x) / gridDim.x;\n    float row0 = floor(intDiv(zSlice0 * gridDim.x, texDim.x));\n    vec2 coord0 = (vec2(column0 * gridDim.x, row0 * gridDim.y) + (pos.xy * gridDim.xy)) / texDim;\n    vec4 color0 = texture2D(tex, coord0);\n\n    float zSlice1 = zSlice0 + 1.0;\n    float column1 = intMod(zSlice1 * gridDim.x, texDim.x) / gridDim.x;\n    float row1 = floor(intDiv(zSlice1 * gridDim.x, texDim.x));\n    vec2 coord1 = (vec2(column1 * gridDim.x, row1 * gridDim.y) + (pos.xy * gridDim.xy)) / texDim;\n    vec4 color1 = texture2D(tex, coord1);\n\n    float delta0 = abs((pos.z * gridDim.z) - zSlice0);\n    return mix(color0, color1, delta0);\n}\n\n// uniform vec3 uLightPosition;\nuniform vec3 uLightColor;\nuniform vec3 uLightAmbient;\nuniform mat4 uView;\n\n// by Tom Madams\n// Simple:\n// https://imdoingitwrong.wordpress.com/2011/01/31/light-attenuation/\n//\n// Improved\n// https://imdoingitwrong.wordpress.com/2011/02/10/improved-light-attenuation/\nfloat attenuation_0(const in float r, const in float f, const in float d) {\n    float denom = d / r + 1.0;\n    float attenuation = 1.0 / (denom*denom);\n    float t = (attenuation - f) / (1.0 - f);\n    return max(t, 0.0);\n}\n\n// (c) 2014 Mikola Lysenko. MIT License\n// https://github.com/glslify/glsl-specular-phong\n\nfloat phongSpecular(const in vec3 lightDirection, const in vec3 viewDirection, const in vec3 surfaceNormal, const in float shininess) {\n    //Calculate Phong power\n    vec3 R = -reflect(lightDirection, surfaceNormal);\n    return pow(max(0.0, dot(viewDirection, R)), shininess);\n}\n\n// (c) 2014 Mikola Lysenko. MIT License\n// https://github.com/glslify/glsl-diffuse-oren-nayar\n\n#define PI 3.14159265\n\nfloat orenNayarDiffuse(const in vec3 lightDirection, const in vec3 viewDirection, const in vec3 surfaceNormal, const in float roughness, const in float albedo) {\n    float LdotV = dot(lightDirection, viewDirection);\n    float NdotL = dot(lightDirection, surfaceNormal);\n    float NdotV = dot(surfaceNormal, viewDirection);\n\n    float s = LdotV - NdotL * NdotV;\n    float t = mix(1.0, max(NdotL, NdotV), step(0.0, s));\n\n    float sigma2 = roughness * roughness;\n    float A = 1.0 + sigma2 * (albedo / (sigma2 + 0.13) + 0.5 / (sigma2 + 0.33));\n    float B = 0.45 * sigma2 / (sigma2 + 0.09);\n\n    return albedo * max(0.0, NdotL) * (A + B * s / t) / PI;\n}\n\nconst float specularScale = 0.15;\nconst float shininess = 200.0;\nconst float roughness = 100.0;\nconst float albedo = 0.95;\n\n#if defined(dGridTexType_2d)\n    vec4 textureVal(vec3 pos) {\n        return texture3dFrom2dLinear(tGridTex, pos, uGridDim, uGridTexDim.xy);\n    }\n    vec4 textureGroup(vec3 pos) {\n        vec3 nearestPos = floor(pos * uGridDim + 0.5) / uGridDim + 0.5 / uGridDim;\n        return texture3dFrom2dNearest(tGridTex, nearestPos, uGridDim, uGridTexDim.xy);\n    }\n#elif defined(dGridTexType_3d)\n    vec4 textureVal(vec3 pos) {\n        return texture(tGridTex, pos);\n    }\n    vec4 textureGroup(vec3 pos) {\n        return texelFetch(tGridTex, ivec3(pos * uGridDim), 0);\n    }\n#endif\n\nvec4 transferFunction(float value) {\n    return texture2D(tTransferTex, vec2(value, 0.0));\n}\n\nconst float gradOffset = 0.5;\n\nvec4 raymarch(vec3 startLoc, vec3 step, vec3 viewDir) {\n    vec3 scaleVol = vec3(1.0) / uGridDim;\n    vec3 pos = startLoc;\n    float prevValue = -1.0;\n    float value = 0.0;\n    vec4 src = vec4(0.0);\n    vec4 dst = vec4(0.0);\n\n    #if defined(dRenderMode_isosurface)\n        vec3 isoPos;\n        float tmp;\n\n        vec3 color = vec3(0.45, 0.55, 0.8);\n        vec3 gradient = vec3(1.0);\n        vec3 dx = vec3(gradOffset * scaleVol.x, 0.0, 0.0);\n        vec3 dy = vec3(0.0, gradOffset * scaleVol.y, 0.0);\n        vec3 dz = vec3(0.0, 0.0, gradOffset * scaleVol.z);\n    #endif\n\n    for(int i = 0; i < dMaxSteps; ++i){\n        value = textureVal(pos).a; // current voxel value\n        if(pos.x > 1.01 || pos.y > 1.01 || pos.z > 1.01 || pos.x < -0.01 || pos.y < -0.01 || pos.z < -0.01)\n            break;\n\n        #if defined(dRenderMode_volume)\n            src = transferFunction(value);\n            src.rgb *= src.a;\n            dst = (1.0 - dst.a) * src + dst; // standard blending\n        #endif\n\n        #if defined(dRenderMode_isosurface)\n            if(prevValue > 0.0 && ( // there was a prev Value\n                (prevValue < uIsoValue && value > uIsoValue) || // entering isosurface\n                (prevValue > uIsoValue && value < uIsoValue) // leaving isosurface\n            )) {\n                tmp = ((prevValue - uIsoValue) / ((prevValue - uIsoValue) - (value - uIsoValue)));\n                isoPos = mix(pos - step, pos, tmp);\n\n                #if defined(dColorType_objectPicking) || defined(dColorType_instancePicking) || defined(dColorType_groupPicking)\n                    if (uAlpha < uPickingAlphaThreshold)\n                        discard; // ignore so the element below can be picked\n                    if (uPickable == 0)\n                        return vec4(0.0, 0.0, 0.0, 1.0); // set to empty picking id\n                #endif\n\n                #if defined(dColorType_objectPicking)\n                    return vec4(encodeFloatRGB(float(uObjectId)), 1.0);\n                #elif defined(dColorType_instancePicking)\n                    return vec4(encodeFloatRGB(instance), 1.0);\n                #elif defined(dColorType_groupPicking)\n                    float group = floor(decodeFloatRGB(textureGroup(isoPos).rgb) + 0.5);\n                    return vec4(encodeFloatRGB(group), 1.0);\n                #else\n                    // compute gradient by central differences\n                    gradient.x = textureVal(isoPos - dx).a - textureVal(isoPos + dx).a;\n                    gradient.y = textureVal(isoPos - dy).a - textureVal(isoPos + dy).a;\n                    gradient.z = textureVal(isoPos - dz).a - textureVal(isoPos + dz).a;\n                    gradient = normalize(gradient);\n                    float d = float(dot(gradient, viewDir) > 0.0);\n                    gradient = (2.0 * d - 1.0) * gradient;\n\n                    float group = floor(decodeFloatRGB(textureGroup(isoPos).rgb) + 0.5);\n\n                    #if defined(dColorType_instance)\n                        color = readFromTexture(tColor, instance, uColorTexDim).rgb;\n                    #elif defined(dColorType_group)\n                        color = readFromTexture(tColor, group, uColorTexDim).rgb;\n                    #elif defined(dColorType_groupInstance)\n                        color = readFromTexture(tColor, instance * float(uGroupCount) + group, uColorTexDim).rgb;\n                    #endif\n\n                    vec3 L = normalize(viewDir); // light direction\n                    vec3 V = normalize(viewDir); // eye direction\n                    vec3 N = normalize(gradient); // surface normal\n\n                    // compute our diffuse & specular terms\n                    float specular = phongSpecular(L, V, N, shininess) * specularScale;\n                    vec3 diffuse = uLightColor * orenNayarDiffuse(L, V, N, roughness, albedo);\n                    vec3 ambient = uLightAmbient;\n\n                    // add the lighting\n                    vec3 finalColor = color.rgb * (diffuse + ambient) + specular;\n\n                    src.rgb = finalColor;\n                    src.a = uAlpha;\n\n                    float marker = readFromTexture(tMarker, instance * float(uGroupCount) + group, uMarkerTexDim).a * 255.0;\n                    if (marker > 0.1) {\n                        if (mod(marker, 2.0) > 0.1) {\n                            src.rgb = mix(uHighlightColor, src.rgb, 0.3);\n                        } else {\n                            src.rgb = mix(uSelectColor, src.rgb, 0.3);\n                        }\n                    }\n\n                    // draw interior darker\n                    if( (prevValue - uIsoValue) > 0.0 ) {\n                        src.rgb *= 0.5;\n                    }\n\n                    src.rgb *= src.a;\n                    dst = (1.0 - dst.a) * src + dst; // standard blending\n                    if(dst.a >= 1.0) {\n                        break;\n                    }\n                #endif\n            }\n            prevValue = value;\n        #endif\n\n        pos += step;\n    }\n    return dst;\n}\n\nvoid main () {\n    vec3 cameraPos = uInvView[3].xyz / uInvView[3].w;\n\n    vec3 rayDir = normalize(origPos - cameraPos);\n    vec3 startLoc = unitCoord;\n    vec3 step = rayDir * (1.0 / uGridDim) * 0.1;\n\n    gl_FragColor = raymarch(startLoc, step, normalize(cameraPos));\n    if (length(gl_FragColor.rgb) < 0.00001) discard;\n    #if defined(dRenderMode_volume)\n        gl_FragColor.a *= uAlpha;\n    #endif\n}"},function(e,t,n){"use strict";function r(e,t,n){e.uniform1f(t,n)}function i(e,t,n){e.uniform1i(t,n)}function a(e,t,n){e.uniform2fv(t,n)}function o(e,t,n){e.uniform3fv(t,n)}function u(e,t,n){e.uniform4fv(t,n)}function s(e,t,n){e.uniformMatrix3fv(t,!1,n)}function c(e,t,n){e.uniformMatrix4fv(t,!1,n)}function l(e){switch(e){case"f":return r;case"i":case"t":return i;case"v2":return a;case"v3":return o;case"v4":return u;case"m3":return s;case"m4":return c}throw new Error("unknown uniform kind '"+e+"'")}Object.defineProperty(t,"__esModule",{value:!0}),t.setUniform=function(e,t,n,r){switch(n){case"f":e.uniform1f(t,r);break;case"i":case"t":e.uniform1i(t,r);break;case"v2":e.uniform2fv(t,r);break;case"v3":e.uniform3fv(t,r);break;case"v4":e.uniform4fv(t,r);break;case"m3":e.uniformMatrix3fv(t,!1,r);break;case"m4":e.uniformMatrix4fv(t,!1,r);break;default:console.error("unknown uniform kind '"+n+"'")}},t.getUniformSetters=function(e){var t={};return Object.keys(e).forEach(function(n){var r=e[n];"uniform"===r.type?t[n]=l(r.kind):"texture"===r.type&&(t[n]=l("t"))}),t}},function(e,t,n){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),function(e){function t(e){var t=e.growBy*e.elementSize;e.currentSize=t,e.currentIndex=0,e.currentChunk=new e.ctor(t),e.allocatedSize+=t,e.chunks[e.chunks.length]=e.currentChunk}function n(e,t){var n=e.ctor,r=e.chunks,i=e.currentIndex;if(!r.length)return new n(0);if(1===r.length&&(t||i===e.allocatedSize))return r[0];for(var a=0,o=0,u=r.length-1;o<u;o++)a+=r[o].length;var s=new n(a+=e.currentIndex),c=0;if(s.buffer)for(o=0,u=r.length-1;o<u;o++)s.set(r[o],c),c+=r[o].length;else for(o=0,u=r.length-1;o<u;o++){for(var l=r[o],f=0,d=l.length;f<d;f++)s[c+f]=l[f];c+=l.length}var p=r[r.length-1];if(s.buffer&&i>=e.currentSize)s.set(p,c);else for(f=0,d=p.length;f<d;f++)s[c+f]=p[f];return s}e.is=function(e){return e.creator&&e.chunkSize},e.add4=function(e,n,r,i,a){e.currentIndex>=e.currentSize&&t(e);var o=e.currentChunk;return o[e.currentIndex++]=n,o[e.currentIndex++]=r,o[e.currentIndex++]=i,o[e.currentIndex++]=a,e.elementCount++},e.add3=function(e,n,r,i){e.currentIndex>=e.currentSize&&t(e);var a=e.currentChunk;return a[e.currentIndex++]=n,a[e.currentIndex++]=r,a[e.currentIndex++]=i,e.elementCount++},e.add2=function(e,n,r){e.currentIndex>=e.currentSize&&t(e);var i=e.currentChunk;return i[e.currentIndex++]=n,i[e.currentIndex++]=r,e.elementCount++},e.add=function(e,n){return e.currentIndex>=e.currentSize&&t(e),e.currentChunk[e.currentIndex++]=n,e.elementCount++},e.addRepeat=function(e,n,r){for(var i=0;i<n;i++)e.currentIndex>=e.currentSize&&t(e),e.currentChunk[e.currentIndex++]=r,e.elementCount++;return e.elementCount},e.addMany=function(e,n){for(var r=e.elementSize,i=0,a=n.length;i<a;i+=r){e.currentIndex>=e.currentSize&&t(e);for(var o=e.currentChunk,u=0;u<r;u++)o[e.currentIndex++]=n[i+u];e.elementCount++}return e.elementCount},e.compact=function(e,t){return void 0===t&&(t=!1),n(e,t)},e._compact=n,e.create=function(e,t,n,r){var i={ctor:e,elementSize:t,growBy:Math.max(1,Math.ceil(n)),allocatedSize:0,elementCount:0,currentSize:0,currentChunk:void 0,currentIndex:0,chunks:[]};if(void 0===r)return i;if("number"==typeof r)return i.currentChunk=new e(r*t),i.allocatedSize=r*t,i.currentSize=i.currentChunk.length,i.chunks[0]=i.currentChunk,i;var a=r;if(a.length%t!=0)throw new Error("initialChunk length must be a multiple of the element size.");return i.currentChunk=a,i.allocatedSize=a.length,i.currentSize=a.length,i.chunks[0]=a,i}}(r||(r={})),t.ChunkedArray=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(184);function i(e,t,n){return e[t].key<e[n].key?-1:1}t.makeBuckets=function(e,t,n){var a=n&&n.start||0,o=n&&n.end||e.length;if(o-a<=0)throw new Error("Can only bucket non-empty collections.");return function(e,t,n,a,o){for(var u=new Map,s=[],c=t(e[0]),l=!0,f=a;f<o;f++){var d=t(e[f]);if(u.has(d))u.get(d).count++,c!==d&&(l=!1);else{var p={key:d,count:1,offset:f};u.set(d,p),s[s.length]=p}c=d}var h=new Int32Array(s.length+1);h[s.length]=o;var m=!0;if(n){f=1;for(var y=s.length;f<y;f++)if(s[f-1].key>s[f].key){m=!1;break}}if(l&&m){for(f=0;f<s.length;f++)h[f]=s[f].offset;return h}n&&!m&&r.sort(s,0,s.length,i,r.arraySwap);var v=0;for(f=0;f<s.length;f++){var b=s[f];b.offset=v,v+=b.count}var g=new Int32Array(o-a);for(f=a;f<o;f++)d=t(e[f]),g[(p=u.get(d)).offset++]=e[f];for(f=0,y=g.length;f<y;f++)e[f+a]=g[f];for(h[0]=a,f=1;f<s.length;f++)h[f]=s[f-1].offset+a;return h}(e,t,!(!n||!n.sort),a,o)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){this.getHash=e,this.areEqual=t,this.id=0,this.byHash=new Map,this.groups=[]}return e.prototype.createGroup=function(e,t){var n=this.id++,r=[e];return this.groups[n]=r,{id:n,keys:r,value:t}},e.prototype.add=function(e,t){var n=this.getHash(t);if(this.byHash.has(n)){for(var r=this.byHash.get(n),i=0,a=r.length;i<a;i++){var o=r[i];if(this.areEqual(t,o.value))return o.keys[o.keys.length]=e,o.value}var u=this.createGroup(e,t);return r[r.length]=u,u.value}u=this.createGroup(e,t);return this.byHash.set(n,[u]),u.value},e}();t.EquivalenceClassesImpl=r,t.EquivalenceClasses=function(e,t){return new r(e,t)}},function(e,t,n){"use strict";function r(e,t){return(e+t)*(e+t+1)/2+t}Object.defineProperty(t,"__esModule",{value:!0}),t.hash1=function(e){var t=e^e>>4;return t=(3735928559^t)+(t<<5),t^=t>>11},t.hash2=function(e,t){var n=23;return n=31*(n=31*n+e|0)+t|0,n=(3735928559^(n^=n>>4))+(n<<5),n^=n>>11},t.hash3=function(e,t,n){var r=23;return r=31*(r=31*(r=31*r+e|0)+t|0)+n|0,r=(3735928559^(r^=r>>4))+(r<<5),r^=r>>11},t.hash4=function(e,t,n,r){var i=23;return i=31*(i=31*(i=31*(i=31*i+e|0)+t|0)+n|0)+r|0,i=(3735928559^(i^=i>>4))+(i<<5),i^=i>>11},t.hashString=function(e){for(var t=0,n=0,r=e.length;n<r;n++)t=(t<<5)-t+e.charCodeAt(n++)|0;return t},t.cantorPairing=r,t.sortedCantorPairing=function(e,t){return e<t?r(e,t):r(t,e)},t.hashFnv32a=function(e){for(var t=2166136261,n=0,r=e.length;n<r;++n)t^=e[n],t+=(t<<1)+(t<<4)+(t<<7)+(t<<8)+(t<<24);return t>>>0}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(21),i=function(){function e(e){this.getKey=e,this.map=new Map,this.keys=[],this.groups=[]}return e.prototype.add=function(e){var t=this.getKey(e);if(this.map.has(t)){(n=this.map.get(t))[n.length]=e}else{var n=[e];this.map.set(t,n),this.keys[this.keys.length]=t,this.groups[this.groups.length]=n}},e.prototype.getGrouping=function(){return{keys:this.keys,groups:this.groups,map:this.map}},e}();function a(e){return new i(e)}t.Grouper=a,t.groupBy=function(e,t){var n=a(t);if(r.Column.is(e))for(var i=e.value,o=0,u=e.rowCount;o<u;o++)n.add(i(o));else for(o=0,u=e.length;o<u;o++)n.add(e[o]);return n.getGrouping()}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(222);!function(e){e.ofTables=function(e,t,n){var r=Object.keys(n),a=Object.create(null),o=[];a._name=e,a._tableNames=o,a._schema=t;for(var u=0,s=r;u<s.length;u++){var c=s[u];i.default.is(n[c])&&(a[c]=n[c],o[o.length]=c)}return a},e.getTablesAsRows=function(e){for(var t={},n=0,r=e._tableNames;n<r.length;n++){var a=r[n];t[a]=i.default.getRows(e[a])}return t}}(r||(r={})),t.default=r},function(e,t,n){"use strict";function r(e){var t=e.constructor;if(!t)throw new Error("data does not define a constructor and it should");return t}Object.defineProperty(t,"__esModule",{value:!0}),t.arrayFind=function(e,t){for(var n=0,r=e.length;n<r;n++)if(t(e[n]))return e[n]},t.iterableToArray=function(e){if(Array.from)return Array.from(e);for(var t=[];;){var n=e.next(),r=n.done,i=n.value;if(r)break;t[t.length]=i}return t},t.createRangeArray=function(e,t,n){for(var r=t-e+1,i=n?new n(r):new Int32Array(r),a=0;a<r;a++)i[a]=a+e;return i},t.arrayPickIndices=function(e,t){for(var n=new(r(e))(t.length),i=0,a=t.length;i<a;i++)n[i]=e[t[i]];return n},t.arrayGetCtor=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(183),i=n(34).idFactory();t.createShaderCache=function(){return r.createReferenceCache(function(e){return JSON.stringify(e)},function(e,t){return function(e,t){var n=e.gl,r=t.type,a=t.source,o=n.createShader("vert"===r?n.VERTEX_SHADER:n.FRAGMENT_SHADER);if(null===o)throw new Error("Error creating "+r+" shader");if(n.shaderSource(o,a),n.compileShader(o),!1===n.getShaderParameter(o,n.COMPILE_STATUS))throw console.warn("'"+r+"' shader info log '"+n.getShaderInfoLog(o)+"'\n"+function(e){for(var t=e.split("\n"),n=0;n<t.length;++n)t[n]=n+1+": "+t[n];return t.join("\n")}(a)),new Error("Error compiling "+r+" shader");return{id:i(),attach:function(e){n.attachShader(e,o)},destroy:function(){n.deleteShader(o)}}}(e,t)},function(e){e.destroy()})}},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{s(r.next(e))}catch(e){a(e)}}function u(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,u)}s((r=r.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(185),u=n(76),s=n(227),c=n(339);function l(e,t,n){void 0===n&&(n=250);var r=function(e,t,n){var r={abortRequested:!1,treeAborted:!1,reason:""};return{updateRateMs:n,lastNotified:u.now(),observer:t,abortToken:r,taskId:e.id,root:{progress:f(e),children:[]},tryAbort:(i=r,function(e){i.abortRequested=!0,i.reason=e||i.reason})};var i}(e,t,n);return h(e,new v(r,r.root))}function f(e){return{taskId:e.id,taskName:e.name,message:"",startedTime:0,canAbort:!0,isIndeterminate:!0,current:0,max:0}}function d(e){return{progress:r({},e.progress),children:e.children.map(d)}}function p(e){return e.progress.canAbort&&e.children.every(p)}function h(e,t){return i(this,void 0,void 0,function(){var n,r;return a(this,function(i){switch(i.label){case 0:c.UserTiming.markStart(e),t.node.progress.startedTime=u.now(),i.label=1;case 1:return i.trys.push([1,3,,7]),[4,e.f(t)];case 2:return n=i.sent(),c.UserTiming.markEnd(e),c.UserTiming.measure(e),t.info.abortToken.abortRequested&&m(t.info,t.node),[2,n];case 3:return r=i.sent(),o.Task.isAbort(r)?t.node.children.length>0?[4,new Promise(function(e){t.onChildrenFinished=e})]:[3,5]:[3,6];case 4:i.sent(),i.label=5;case 5:e.onAbort&&e.onAbort(),i.label=6;case 6:throw l.PRINT_ERRORS_TO_STD_ERR&&console.error(r),r;case 7:return[2]}})})}function m(e,t){throw e.abortToken.treeAborted||(e.abortToken.treeAborted=!0,function e(t){var n=t.progress;n.isIndeterminate=!0;n.canAbort=!1;n.message="Aborting...";for(var r=0,i=t.children;r<i.length;r++){var a=i[r];e(a)}}(e.root),y(e,u.now())),o.Task.Aborted(e.abortToken.reason)}function y(e,t){e.lastNotified=t;var n=function(e){return{root:d(e.root),canAbort:p(e.root),requestAbort:e.tryAbort}}(e);e.observer(n)}t.ExecuteObservable=l,t.ExecuteInContext=function(e,t){return h(t,e)},t.ExecuteObservableChild=function(e,t,n){return e.runChild(t,n)},function(e){e.PRINT_ERRORS_TO_STD_ERR=!1}(l=t.ExecuteObservable||(t.ExecuteObservable={}));var v=function(){function e(e,t){this.isSynchronous=!1,this.isExecuting=!0,this.lastUpdatedTime=0,this.onChildrenFinished=void 0,this.node=t,this.info=e}return e.prototype.checkAborted=function(){this.info.abortToken.abortRequested&&m(this.info,this.node)},Object.defineProperty(e.prototype,"shouldUpdate",{get:function(){return this.checkAborted(),u.now()-this.lastUpdatedTime>this.info.updateRateMs},enumerable:!0,configurable:!0}),e.prototype.updateProgress=function(e){if(this.checkAborted(),e){var t=this.node.progress;"string"==typeof e?(t.message=e,t.isIndeterminate=!0):(void 0!==e.canAbort&&(t.canAbort=e.canAbort),void 0!==e.message&&(t.message=e.message),void 0!==e.current&&(t.current=e.current),void 0!==e.max&&(t.max=e.max),t.isIndeterminate=void 0===t.current||void 0===t.max,void 0!==e.isIndeterminate&&(t.isIndeterminate=e.isIndeterminate))}},e.prototype.update=function(e,t){if(this.lastUpdatedTime=u.now(),this.updateProgress(e),!t)return y(this.info,this.lastUpdatedTime),this.checkAborted(),s.Scheduler.immediatePromise()},e.prototype.runChild=function(t,n){return i(this,void 0,void 0,function(){var r,i,u,s,c,l,d;return a(this,function(a){switch(a.label){case 0:this.updateProgress(n),r={progress:f(t),children:[]},(i=this.node.children).push(r),u=new e(this.info,r),a.label=1;case 1:return a.trys.push([1,3,4,5]),[4,h(t,u)];case 2:return[2,a.sent()];case 3:if(s=a.sent(),o.Task.isAbort(s))return[2,void 0];throw s;case 4:if((c=i.indexOf(r))>=0){for(l=c,d=i.length-1;l<d;l++)i[l]=i[l+1];i.pop()}return 0===i.length&&this.onChildrenFinished&&this.onChildrenFinished(),[7];case 5:return[2]}})})},e}()},function(e,t,n){(function(e,t){!function(e,n){"use strict";if(!e.setImmediate){var r,i,a,o,u,s=1,c={},l=!1,f=e.document,d=Object.getPrototypeOf&&Object.getPrototypeOf(e);d=d&&d.setTimeout?d:e,"[object process]"==={}.toString.call(e.process)?r=function(e){t.nextTick(function(){h(e)})}:!function(){if(e.postMessage&&!e.importScripts){var t=!0,n=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=n,t}}()?e.MessageChannel?((a=new MessageChannel).port1.onmessage=function(e){h(e.data)},r=function(e){a.port2.postMessage(e)}):f&&"onreadystatechange"in f.createElement("script")?(i=f.documentElement,r=function(e){var t=f.createElement("script");t.onreadystatechange=function(){h(e),t.onreadystatechange=null,i.removeChild(t),t=null},i.appendChild(t)}):r=function(e){setTimeout(h,0,e)}:(o="setImmediate$"+Math.random()+"$",u=function(t){t.source===e&&"string"==typeof t.data&&0===t.data.indexOf(o)&&h(+t.data.slice(o.length))},e.addEventListener?e.addEventListener("message",u,!1):e.attachEvent("onmessage",u),r=function(t){e.postMessage(o+t,"*")}),d.setImmediate=function(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),n=0;n<t.length;n++)t[n]=arguments[n+1];var i={callback:e,args:t};return c[s]=i,r(s),s++},d.clearImmediate=p}function p(e){delete c[e]}function h(e){if(l)setTimeout(h,0,e);else{var t=c[e];if(t){l=!0;try{!function(e){var t=e.callback,r=e.args;switch(r.length){case 0:t();break;case 1:t(r[0]);break;case 2:t(r[0],r[1]);break;case 3:t(r[0],r[1],r[2]);break;default:t.apply(n,r)}}(t)}finally{p(e),l=!1}}}}}("undefined"==typeof self?void 0===e?this:e:self)}).call(this,n(132),n(179))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r="undefined"!=typeof performance;!function(e){function t(e){return"startTask"+e.id}function n(e){return"endTask"+e.id}e.markStart=function(e){r&&performance.mark(t(e))},e.markEnd=function(e){r&&performance.mark(n(e))},e.measure=function(e){r&&performance.measure(e.name,t(e),n(e))}}(t.UserTiming||(t.UserTiming={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(229);!function(e){e.Synchronous=i.SyncRuntimeContext}(r||(r={})),t.RuntimeContext=r},function(e,t,n){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.format=function(e){return function e(t,n){void 0===n&&(n="");var r=t.progress;if(!t.children.length)return r.isIndeterminate?""+n+r.taskName+": "+r.message:""+n+r.taskName+": ["+r.current+"/"+r.max+"] "+r.message;var i=n+"  |_ ",a=t.children.map(function(t){return e(t,i)});return r.isIndeterminate?""+n+r.taskName+": "+r.message+"\n"+a.join("\n"):""+n+r.taskName+": ["+r.current+"/"+r.max+"] "+r.message+"\n"+a.join("\n")}(e.root)}}(r||(r={})),t.Progress=r},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{s(r.next(e))}catch(e){a(e)}}function u(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,u)}s((r=r.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}};Object.defineProperty(t,"__esModule",{value:!0});var a=n(185);t.MultistepTask=function(e,t,n,o){var u=this;return function(s){return a.Task.create(e,function(e){return r(u,void 0,void 0,function(){return i(this,function(r){return[2,n(s,function(n){return e.update({message:""+t[n],current:n+1,max:t.length})},e)]})})},o)}}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{s(r.next(e))}catch(e){a(e)}}function u(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,u)}s((r=r.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}};Object.defineProperty(t,"__esModule",{value:!0});var a=n(76);t.chunkedSubtask=function(e,t,n,o,u){return r(this,void 0,void 0,function(){var r,s,c,l,f,d,p;return i(this,function(i){switch(i.label){case 0:if(r=Math.max(t,0),s=0,c=0,e.isSynchronous)return o(Number.MAX_SAFE_INTEGER,n),[2,n];l=a.now(),f=0,d=0,i.label=1;case 1:return(f=o(r,n))>0?(s+=f,p=a.now()-l,d+=p,c+=p,e.shouldUpdate?[4,u(e,n,s)]:[3,3]):[3,4];case 2:i.sent(),r=Math.round(d*s/c)+1,l=a.now(),d=0,i.label=3;case 3:return[3,1];case 4:return e.shouldUpdate?[4,u(e,n,s)]:[3,6];case 5:i.sent(),i.label=6;case 6:return[2,n]}})})}},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i,a=n(2),o=n(133),u=n(3);t.TrackballControlsParams={noScroll:u.ParamDefinition.Boolean(!0,{isHidden:!0}),rotateSpeed:u.ParamDefinition.Numeric(5,{min:.1,max:10,step:.1}),zoomSpeed:u.ParamDefinition.Numeric(6,{min:.1,max:10,step:.1}),panSpeed:u.ParamDefinition.Numeric(.8,{min:.1,max:5,step:.1}),spin:u.ParamDefinition.Boolean(!1),spinSpeed:u.ParamDefinition.Numeric(1,{min:-100,max:100,step:1}),staticMoving:u.ParamDefinition.Boolean(!0,{isHidden:!0}),dynamicDampingFactor:u.ParamDefinition.Numeric(.2,{},{isHidden:!0}),minDistance:u.ParamDefinition.Numeric(.01,{},{isHidden:!0}),maxDistance:u.ParamDefinition.Numeric(1e150,{},{isHidden:!0})},function(e){e.create=function(e,n,i){void 0===i&&(i={});var s=r({},u.ParamDefinition.getDefaultValues(t.TrackballControlsParams),i),c={x:0,y:0,width:0,height:0},l=n.target,f=!1,d=e.drag.subscribe(function(e){var t=e.pageX,n=e.pageY,r=e.buttons,i=(e.modifiers,e.isStart);y=!0,i&&(1===r?(a.Vec2.copy(_,R(t,n)),a.Vec2.copy(g,_)):4===r?(a.Vec2.copy(x,O(t,n)),a.Vec2.copy(w,x)):2===r&&(a.Vec2.copy(A,O(t,n)),a.Vec2.copy(E,A))),1===r?(a.Vec2.copy(g,_),a.Vec2.copy(_,R(t,n))):4===r?a.Vec2.copy(w,O(t,n)):2===r&&a.Vec2.copy(E,O(t,n))}),p=e.interactionEnd.subscribe(function(){y=!1}),h=e.wheel.subscribe(function(e){var t=e.dy;x[1]-=1e-4*t}),m=e.pinch.subscribe(function(e){var t=e.distance,n=e.isStart;y=!0,n&&(P=t);var r=P/(T=t)*s.zoomSpeed;P=T,a.Vec3.scale(b,b,r)}),y=!1,v=a.Vec3.zero(),b=a.Vec3.zero(),g=a.Vec2.zero(),_=a.Vec2.zero(),S=a.Vec3.zero(),C=0,x=a.Vec2.zero(),w=a.Vec2.zero(),P=0,T=0,A=a.Vec2.zero(),E=a.Vec2.zero(),k=a.Vec3.clone(l),I=a.Vec3.clone(n.position),M=a.Vec3.clone(n.up),V=a.Vec2.zero();function O(e,t){return a.Vec2.set(V,(e-c.x)/c.width,(t-c.y)/c.height),V}var D=a.Vec2.zero();function R(e,t){return a.Vec2.set(D,(e-.5*c.width-c.x)/(.5*c.width),(c.height+2*(c.y-t))/c.width),D}var j=a.Vec3.zero(),N=a.Quat.zero(),B=a.Vec3.zero(),F=a.Vec3.zero(),L=a.Vec3.zero(),z=a.Vec3.zero(),U=a.Vec2.zero(),G=a.Vec3.zero(),q=a.Vec3.zero(),H=-1;function W(e){var t,r,i;H!==e&&(s.spin&&(t=e-H,r=(s.spinSpeed||0)/1e3,Y[0]=60*Math.min(Math.abs(t),125)/1e3*r,y||a.Vec2.add(_,g,Y)),a.Vec3.sub(b,n.position,l),function(){a.Vec3.set(z,_[0]-g[0],_[1]-g[1],0);var e=a.Vec3.magnitude(z);e?(a.Vec3.copy(b,n.position),a.Vec3.sub(b,b,l),a.Vec3.normalize(B,a.Vec3.copy(B,b)),a.Vec3.normalize(F,a.Vec3.copy(F,n.up)),a.Vec3.normalize(L,a.Vec3.cross(L,F,B)),a.Vec3.setMagnitude(F,F,_[1]-g[1]),a.Vec3.setMagnitude(L,L,_[0]-g[0]),a.Vec3.add(z,a.Vec3.copy(z,F),L),a.Vec3.normalize(j,a.Vec3.cross(j,z,b)),e*=s.rotateSpeed,a.Quat.setAxisAngle(N,j,e),a.Vec3.transformQuat(b,b,N),a.Vec3.transformQuat(n.up,n.up,N),a.Vec3.copy(S,j),C=e):!s.staticMoving&&C&&(C*=Math.sqrt(1-s.dynamicDampingFactor),a.Vec3.sub(b,a.Vec3.copy(b,n.position),l),a.Quat.setAxisAngle(N,S,C),a.Vec3.transformQuat(b,b,N),a.Vec3.transformQuat(n.up,n.up,N)),a.Vec2.copy(g,_)}(),1!=(i=1+(w[1]-x[1])*s.zoomSpeed)&&i>0&&a.Vec3.scale(b,b,i),s.staticMoving?a.Vec2.copy(x,w):x[1]+=(w[1]-x[1])*s.dynamicDampingFactor,a.Vec2.sub(U,a.Vec2.copy(U,E),A),a.Vec2.squaredMagnitude(U)&&(a.Vec2.scale(U,U,a.Vec3.magnitude(b)*s.panSpeed),a.Vec3.cross(q,a.Vec3.copy(q,b),n.up),a.Vec3.setMagnitude(q,q,U[0]),a.Vec3.setMagnitude(G,n.up,U[1]),a.Vec3.add(q,q,G),a.Vec3.add(n.position,n.position,q),a.Vec3.add(l,l,q),s.staticMoving?a.Vec2.copy(A,E):(a.Vec2.sub(U,E,A),a.Vec2.scale(U,U,s.dynamicDampingFactor),a.Vec2.add(A,A,U))),a.Vec3.add(n.position,l,b),a.Vec3.squaredMagnitude(b)>s.maxDistance*s.maxDistance&&(a.Vec3.setMagnitude(b,b,s.maxDistance),a.Vec3.add(n.position,l,b),a.Vec2.copy(x,w)),a.Vec3.squaredMagnitude(b)<s.minDistance*s.minDistance&&(a.Vec3.setMagnitude(b,b,s.minDistance),a.Vec3.add(n.position,l,b),a.Vec2.copy(x,w)),o.cameraLookAt(n.position,n.up,n.direction,l),a.Vec3.squaredDistance(v,n.position)>1e-6&&a.Vec3.copy(v,n.position),H=e)}var Y=a.Vec2.create(.005,0);return W(0),{viewport:c,get props(){return s},setProps:function(e){Object.assign(s,e)},update:W,reset:function(){a.Vec3.copy(l,k),a.Vec3.copy(n.position,I),a.Vec3.copy(n.up,M),a.Vec3.sub(b,n.position,l),o.cameraLookAt(n.position,n.up,n.direction,l),a.Vec3.copy(v,n.position)},dispose:function(){f||(f=!0,d.unsubscribe(),h.unsubscribe(),m.unsubscribe(),p.unsubscribe())}}}}(i||(i={})),t.TrackballControls=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.resizeCanvas=function(e,t){var n=window.innerWidth,r=window.innerHeight;if(t!==document.body){var i=t.getBoundingClientRect();n=i.right-i.left,r=i.bottom-i.top}e.width=window.devicePixelRatio*n,e.height=window.devicePixelRatio*r,Object.assign(e.style,{width:n+"px",height:r+"px"})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i,a=n(2),o=n(347),u=n(19);!function(e){function t(t,n,r){var i=o.getSpacegroupIndex(t);if(i<0)return console.warn("Unknown spacegroup '"+t+"', returning a 'P 1' with cellsize [1, 1, 1]"),e.Zero;var u=r[0],s=r[1],c=r[2],l=n[0],f=n[1],d=n[2],p=Math.cos(s),h=(Math.cos(u)-Math.cos(s)*Math.cos(c))/Math.sin(c),m=Math.sqrt(1-p*p-h*h),y=[l,0,0],v=[Math.cos(c)*f,Math.sin(c)*f,0],b=[p*d,h*d,m*d],g=a.Mat4.ofRows([[y[0],v[0],b[0],0],[0,v[1],b[1],0],[0,0,b[2],0],[0,0,0,1]]);return{index:i,size:n,anglesInRadians:r,toFractional:a.Mat4.invert(a.Mat4.zero(),g),fromFractional:g}}e.Zero=t("P 1",a.Vec3.create(1,1,1),a.Vec3.create(Math.PI/2,Math.PI/2,Math.PI/2)),e.isZero=function(e){return 0===e.index&&1===e.size[0]&&1===e.size[1]&&1===e.size[1]},e.create=t}(r||(r={})),t.SpacegroupCell=r,function(e){function t(e){var t=o.GroupData[e.index].map(function(e){return t=o.OperatorData[e],n=o.TransformData[t[0]],r=o.TransformData[t[1]],i=o.TransformData[t[2]],a.Mat4.ofRows([n,r,i,[0,0,0,1]]);var t,n,r,i});return{name:o.SpacegroupNames[e.index],cell:e,operators:t}}e.ZeroP1=t(r.Zero),e.create=t;var n=a.Vec3.zero(),i=a.Mat4.zero();function s(e,t,r,o,u,s){return n[0]=r,n[1]=o,n[2]=u,a.Mat4.fromTranslation(i,n),a.Mat4.mul(s,a.Mat4.mul(s,a.Mat4.mul(s,e.cell.fromFractional,i),e.operators[t]),e.cell.toFractional)}e.updateOperatorMatrix=s,e.getSymmetryOperator=function(e,t,n,r,i){var o=s(e,t,n,r,i,a.Mat4.zero());return u.SymmetryOperator.create(t+1+"_"+(5+n)+(5+r)+(5+i),o,{id:"",operList:[]},"",a.Vec3.create(n,r,i))}}(i||(i={})),t.Spacegroup=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TransformData=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[-1,0,0,0],[0,-1,0,0],[0,0,-1,0],[0,1,0,.5],[1,0,0,.5],[-1,0,0,.5],[0,0,1,.5],[0,-1,0,.5],[0,0,-1,.5],[1,0,0,.25],[0,-1,0,.25],[0,0,1,.25],[-1,0,0,.25],[0,1,0,.25],[0,-1,0,.75],[0,0,1,.75],[0,1,0,.75],[1,0,0,.75],[-1,0,0,.75],[0,0,-1,.25],[0,0,-1,.75],[1,-1,0,0],[-1,1,0,0],[0,0,1,.333333333333333],[0,0,1,.666666666666667],[1,0,0,.666666666666667],[0,1,0,.333333333333333],[0,-1,0,.666666666666667],[1,-1,0,.333333333333333],[-1,1,0,.666666666666667],[-1,0,0,.333333333333333],[1,0,0,.333333333333333],[0,1,0,.666666666666667],[0,-1,0,.333333333333333],[1,-1,0,.666666666666667],[-1,1,0,.333333333333333],[-1,0,0,.666666666666667],[0,0,-1,.333333333333333],[0,0,-1,.666666666666667],[0,0,1,.833333333333333],[0,0,1,.166666666666667],[0,0,-1,.833333333333333],[0,0,-1,.166666666666667]],t.OperatorData=[[0,1,2],[3,4,5],[3,1,5],[3,6,5],[7,6,2],[8,6,5],[0,4,2],[0,4,9],[7,10,2],[7,10,9],[0,10,2],[8,10,5],[3,1,11],[3,6,11],[0,10,9],[8,6,11],[3,4,2],[0,4,5],[3,4,9],[7,10,5],[8,4,9],[8,10,9],[8,10,2],[0,6,9],[3,10,9],[0,10,11],[7,1,9],[8,1,11],[7,4,11],[7,6,9],[7,10,11],[3,10,2],[8,1,5],[0,4,11],[3,1,2],[3,1,9],[7,4,2],[8,1,2],[8,1,9],[3,6,9],[7,4,9],[8,6,2],[8,6,9],[3,6,2],[12,13,14],[15,16,14],[12,17,18],[15,19,18],[20,13,18],[21,16,18],[20,17,14],[21,19,14],[0,1,5],[8,10,11],[7,6,11],[7,6,5],[8,4,2],[7,4,5],[7,1,5],[7,1,11],[0,10,5],[0,1,11],[0,6,11],[0,6,5],[3,10,11],[8,4,11],[15,13,22],[12,16,22],[15,17,23],[12,19,23],[21,13,23],[20,16,23],[21,17,22],[20,19,22],[4,0,2],[1,3,2],[4,0,14],[1,3,18],[4,0,9],[1,3,9],[4,0,18],[1,3,14],[10,7,9],[6,8,9],[4,7,14],[6,3,18],[10,0,18],[1,8,14],[1,3,5],[4,0,5],[6,8,11],[10,7,11],[1,3,11],[4,0,11],[10,7,2],[6,8,2],[3,10,22],[7,1,23],[8,4,23],[0,6,22],[1,0,5],[4,3,5],[1,0,23],[4,3,22],[10,7,14],[6,8,18],[8,6,22],[7,10,23],[4,3,11],[1,0,11],[1,0,22],[4,3,23],[10,7,18],[6,8,14],[8,6,23],[7,10,22],[6,7,11],[10,8,11],[8,1,23],[0,10,22],[3,6,22],[7,4,23],[4,3,2],[1,0,2],[10,8,2],[6,7,2],[4,3,9],[1,0,9],[10,8,9],[6,7,9],[4,8,14],[6,0,18],[10,3,18],[1,7,14],[4,8,18],[6,0,14],[10,3,14],[1,7,18],[6,7,5],[10,8,5],[6,8,5],[10,7,5],[8,1,22],[0,10,23],[3,6,23],[7,4,22],[4,24,2],[25,3,2],[4,24,26],[25,3,27],[4,24,27],[25,3,26],[28,29,26],[30,31,26],[32,33,26],[34,35,27],[36,37,27],[38,39,27],[2,0,1],[1,2,0],[1,25,5],[24,0,5],[39,36,40],[35,38,40],[37,34,40],[33,30,41],[29,32,41],[31,28,41],[5,3,4],[4,5,3],[25,1,5],[0,24,5],[24,4,5],[3,25,5],[4,3,41],[25,1,40],[24,4,41],[3,25,40],[4,3,40],[25,1,41],[24,4,40],[3,25,41],[35,34,40],[37,36,40],[39,38,40],[29,28,41],[31,30,41],[33,32,41],[3,5,4],[5,4,3],[25,1,2],[0,24,2],[24,4,2],[3,25,2],[25,1,9],[0,24,9],[24,4,9],[3,25,9],[30,33,26],[32,29,26],[28,31,26],[36,39,27],[38,35,27],[34,37,27],[0,2,1],[2,1,0],[30,33,42],[32,29,42],[28,31,42],[36,39,43],[38,35,43],[34,37,43],[7,9,6],[9,6,7],[25,1,11],[0,24,11],[24,4,11],[3,25,11],[35,34,44],[37,36,44],[39,38,44],[29,28,45],[31,30,45],[33,32,45],[8,11,10],[11,10,8],[1,25,2],[24,0,2],[1,25,42],[24,0,43],[1,25,43],[24,0,42],[1,25,27],[24,0,26],[1,25,26],[24,0,27],[1,25,9],[24,0,9],[4,24,5],[25,3,5],[4,24,11],[25,3,11],[1,0,40],[4,3,44],[0,24,45],[1,0,41],[4,3,45],[0,24,44],[0,24,40],[0,24,41],[2,3,4],[5,3,1],[5,0,4],[4,2,3],[1,5,3],[4,5,0],[2,7,6],[2,8,10],[5,8,6],[5,7,10],[1,9,7],[4,9,8],[1,11,8],[4,11,7],[9,0,6],[9,3,10],[11,3,6],[11,0,10],[6,2,7],[10,2,8],[6,5,8],[10,5,7],[9,7,1],[9,8,4],[11,8,1],[11,7,4],[6,9,0],[10,9,3],[6,11,3],[10,11,0],[9,7,6],[9,8,10],[11,8,6],[11,7,10],[6,9,7],[10,9,8],[6,11,8],[10,11,7],[2,3,10],[5,8,1],[11,0,4],[10,2,3],[1,5,8],[4,11,0],[5,0,1],[2,0,4],[2,3,1],[1,5,0],[4,2,0],[1,2,3],[11,8,10],[11,7,6],[9,7,10],[9,8,6],[10,11,8],[6,11,7],[10,9,7],[6,9,8],[5,8,10],[5,7,6],[2,7,10],[2,8,6],[4,11,8],[1,11,7],[4,9,7],[1,9,8],[11,3,10],[11,0,6],[9,0,10],[9,3,6],[10,5,8],[6,5,7],[10,2,7],[6,2,8],[11,8,4],[11,7,1],[9,7,4],[9,8,1],[10,11,3],[6,11,0],[10,9,0],[6,9,3],[22,15,13],[22,12,16],[14,12,13],[14,15,16],[13,22,15],[16,22,12],[13,14,12],[16,14,15],[22,21,17],[22,20,19],[14,20,17],[14,21,19],[13,23,21],[16,23,20],[13,18,20],[16,18,21],[23,15,17],[23,12,19],[18,12,17],[18,15,19],[17,22,21],[19,22,20],[17,14,20],[19,14,21],[23,21,13],[23,20,16],[18,20,13],[18,21,16],[17,23,15],[19,23,12],[17,18,12],[19,18,15],[5,0,6],[2,7,4],[9,3,1],[6,5,0],[4,2,7],[1,9,3],[0,2,4],[3,2,1],[0,5,1],[2,1,3],[2,4,0],[5,1,0],[7,9,10],[8,9,6],[7,11,6],[9,6,8],[9,10,7],[11,6,7],[1,7,11],[4,8,11],[1,8,9],[4,7,9],[0,9,10],[3,9,6],[3,11,10],[0,11,6],[2,6,8],[2,10,7],[5,6,7],[5,10,8],[6,0,11],[10,3,11],[6,3,9],[10,0,9],[7,2,10],[8,2,6],[8,5,10],[7,5,6],[9,1,8],[9,4,7],[11,1,7],[11,4,8],[7,9,4],[8,9,1],[8,11,4],[7,11,1],[9,6,3],[9,10,0],[11,6,0],[11,10,3],[19,12,23],[13,15,22],[16,21,18],[17,20,14],[20,14,17],[21,18,16],[15,22,13],[12,23,19],[18,16,21],[14,17,20],[23,19,12],[22,13,15],[19,20,22],[13,21,23],[16,15,14],[17,12,18],[20,18,13],[21,14,19],[15,23,17],[12,22,16],[18,19,15],[14,13,12],[23,16,20],[22,17,21],[16,12,22],[17,15,23],[19,21,14],[13,20,18],[12,14,13],[15,18,19],[21,22,17],[20,23,16],[14,16,15],[18,17,12],[22,19,20],[23,13,21],[16,20,23],[17,21,22],[19,15,18],[13,12,14],[12,18,17],[15,14,16],[21,23,13],[20,22,19],[14,19,21],[18,13,20],[22,16,12],[23,17,15],[19,12,22],[17,21,23],[16,15,18],[13,20,14],[20,14,13],[15,18,16],[21,23,17],[12,22,19],[18,16,15],[14,13,20],[22,19,12],[23,17,21],[3,2,4],[3,5,1],[0,5,4],[2,4,3],[5,1,3],[5,4,0],[1,7,9],[4,8,9],[1,8,11],[4,7,11],[0,9,6],[3,9,10],[3,11,6],[0,11,10],[2,6,7],[2,10,8],[5,6,8],[5,10,7],[6,0,9],[10,3,9],[6,3,11],[10,0,11],[7,2,6],[8,2,10],[8,5,6],[7,5,10],[9,1,7],[9,4,8],[11,1,8],[11,4,7],[7,9,1],[8,9,4],[8,11,1],[7,11,4],[9,6,0],[9,10,3],[11,6,3],[11,10,0],[8,9,10],[8,11,6],[7,11,10],[9,10,8],[11,6,8],[11,10,7],[6,0,2],[10,3,2],[6,3,5],[10,0,5],[7,2,1],[8,2,4],[8,5,1],[7,5,4],[9,1,0],[9,4,3],[11,1,3],[11,4,0],[1,7,2],[4,8,2],[1,8,5],[4,7,5],[0,9,1],[3,9,4],[3,11,1],[0,11,4],[2,6,0],[2,10,3],[5,6,3],[5,10,0],[0,2,6],[3,2,10],[3,5,6],[0,5,10],[2,1,7],[2,4,8],[5,1,8],[5,4,7],[16,12,14],[13,21,18],[19,15,23],[17,20,22],[12,14,16],[21,18,13],[15,23,19],[20,22,17],[14,16,12],[18,13,21],[23,19,15],[22,17,20],[19,20,18],[17,15,14],[16,21,22],[13,12,23],[20,18,19],[15,14,17],[21,22,16],[12,23,13],[18,19,20],[14,17,15],[22,16,21],[23,13,12],[6,0,5],[10,3,5],[6,3,2],[10,0,2],[7,2,4],[8,2,1],[8,5,4],[7,5,1],[9,1,3],[9,4,0],[11,1,0],[11,4,3],[1,7,5],[4,8,5],[1,8,2],[4,7,2],[0,9,4],[3,9,1],[3,11,4],[0,11,1],[2,6,3],[2,10,0],[5,6,0],[5,10,3],[0,2,10],[3,2,6],[3,5,10],[0,5,6],[2,1,8],[2,4,7],[5,1,7],[5,4,8],[21,17,23],[20,16,22],[12,13,18],[15,19,14],[23,21,17],[22,20,16],[18,12,13],[14,15,19],[17,23,21],[16,22,20],[13,18,12],[19,14,15],[21,13,22],[20,19,23],[12,17,14],[15,16,18],[23,15,13],[22,12,19],[18,20,17],[14,21,16],[17,22,15],[16,23,12],[13,14,20],[19,18,21],[15,17,22],[12,16,23],[20,13,14],[21,19,18],[22,21,13],[23,20,19],[14,12,17],[18,15,16],[13,23,15],[19,22,12],[17,18,20],[16,14,21],[15,13,23],[12,19,22],[20,17,18],[21,16,14],[22,15,17],[23,12,16],[14,20,13],[18,21,19],[13,22,21],[19,23,20],[17,14,12],[16,18,15],[6,5,3],[4,9,3],[9,3,4],[5,7,4],[4,5,7],[5,3,6]],t.GroupData=[[0],[0,1],[0,2],[0,3],[0,2,4,5],[0,6],[0,7],[0,6,4,8],[0,7,4,9],[0,6,2,1],[0,3,1,10],[0,6,2,1,4,8,5,11],[0,12,1,7],[0,1,13,14],[0,12,1,7,4,15,11,9],[0,16,2,17],[0,18,12,17],[0,16,5,19],[0,20,13,19],[0,18,12,17,4,21,15,19],[0,16,2,17,4,22,5,19],[0,16,2,17,23,24,13,25,26,20,27,28,4,22,5,19],[0,16,17,2,29,21,30,15],[0,20,13,19,29,31,32,33],[0,16,6,34],[0,18,7,34],[0,16,7,35],[0,16,36,37],[0,18,36,38],[0,16,14,39],[0,20,40,34],[0,16,8,41],[0,18,8,42],[0,16,9,42],[0,16,6,34,4,22,8,41],[0,18,7,34,4,21,9,41],[0,16,7,35,4,22,9,42],[0,16,6,34,23,24,14,39],[0,16,10,43,23,24,7,35],[0,16,36,37,23,24,9,42],[0,16,8,41,23,24,40,38],[0,16,6,34,23,24,14,39,26,20,40,38,4,22,8,41],[0,16,44,45,23,24,46,47,26,20,48,49,4,22,50,51],[0,16,6,34,29,21,9,42],[0,16,8,41,29,21,7,35],[0,16,36,37,29,21,14,39],[0,16,2,17,1,52,6,34],[0,16,2,17,53,54,9,42],[0,16,12,33,1,52,7,35],[0,16,2,17,11,55,8,41],[0,56,2,57,1,58,6,37],[0,56,15,25,1,58,9,39],[0,20,27,17,1,59,40,34],[0,56,12,28,1,58,7,38],[0,16,5,19,1,52,8,41],[0,22,13,28,1,55,14,38],[0,18,13,60,1,61,14,43],[0,16,15,30,1,52,9,42],[0,16,5,19,11,55,6,34],[0,21,12,19,1,54,7,41],[0,20,13,19,1,59,14,41],[0,20,3,30,1,59,10,42],[0,18,12,17,1,61,7,34,4,21,15,19,11,54,9,41],[0,24,13,17,1,62,14,34,4,20,27,19,11,59,40,41],[0,16,2,17,1,52,6,34,4,22,5,19,11,55,8,41],[0,16,12,33,1,52,7,35,4,22,15,30,11,55,9,42],[0,31,3,17,1,63,10,34,4,56,32,19,11,58,36,41],[0,22,2,19,64,59,14,38,4,16,5,17,65,62,40,39],[0,16,2,17,1,52,6,34,23,24,13,25,64,62,14,39,26,20,27,28,65,59,40,38,4,22,5,19,11,55,8,41],[0,16,2,17,66,67,44,45,23,24,13,25,68,69,46,47,26,20,27,28,70,71,48,49,4,22,5,19,72,73,50,51],[0,16,2,17,1,52,6,34,29,21,15,30,53,54,9,42],[0,16,5,19,1,52,8,41,29,21,12,33,53,54,7,35],[0,20,13,19,1,59,14,41,29,31,32,33,53,63,36,35],[0,31,3,17,1,63,10,34,29,20,27,30,53,59,40,42],[0,16,74,75],[0,18,76,77],[0,16,78,79],[0,18,80,81],[0,16,74,75,29,21,82,83],[0,21,84,85,29,16,86,87],[0,16,88,89],[0,16,88,89,29,21,90,91],[0,16,74,75,1,52,88,89],[0,16,78,79,1,52,92,93],[0,16,94,95,11,55,88,89],[0,16,82,83,53,54,88,89],[0,16,74,75,1,52,88,89,29,21,82,83,53,54,90,91],[0,21,84,85,96,97,88,91,29,16,86,87,98,99,90,89],[0,16,74,75,2,17,100,101],[0,16,94,95,5,19,100,101],[0,18,76,77,2,33,102,103],[0,18,104,105,106,107,100,108],[0,16,78,79,2,17,109,108],[0,16,82,83,15,30,100,101],[0,18,80,81,2,33,110,111],[0,18,112,113,114,115,100,108],[0,16,74,75,2,17,100,101,29,21,82,83,15,30,116,117],[0,21,84,85,118,119,116,101,29,16,86,87,120,121,100,117],[0,16,74,75,6,34,122,123],[0,16,74,75,8,41,124,125],[0,16,78,79,7,35,122,123],[0,16,82,83,9,42,122,123],[0,16,74,75,7,35,126,127],[0,16,74,75,9,42,128,129],[0,16,78,79,6,34,126,127],[0,16,78,79,8,41,128,129],[0,16,74,75,6,34,122,123,29,21,82,83,9,42,128,129],[0,16,74,75,7,35,126,127,29,21,82,83,8,41,124,125],[0,21,84,85,6,42,130,131,29,16,86,87,9,34,132,133],[0,21,84,85,7,41,134,135,29,16,86,87,8,35,136,137],[0,16,89,88,2,17,122,123],[0,16,89,88,12,33,126,127],[0,16,89,88,5,19,124,125],[0,16,89,88,15,30,128,129],[0,16,88,89,6,34,100,101],[0,16,89,88,7,35,109,108],[0,16,89,88,8,41,138,139],[0,16,89,88,9,42,116,117],[0,16,89,88,6,34,100,101,29,21,91,90,9,42,116,117],[0,16,89,88,7,35,109,108,29,21,91,90,8,41,138,139],[0,16,89,88,2,17,122,123,29,21,91,90,15,30,128,129],[0,16,89,88,118,121,132,131,29,21,91,90,120,119,130,133],[0,16,74,75,2,17,100,101,1,52,88,89,6,34,122,123],[0,16,74,75,12,33,109,108,1,52,88,89,7,35,126,127],[0,16,74,75,2,17,100,101,11,55,140,141,8,41,124,125],[0,16,74,75,2,17,100,101,53,54,90,91,9,42,128,129],[0,16,74,75,5,19,138,139,1,52,88,89,8,41,124,125],[0,16,74,75,15,30,116,117,1,52,88,89,9,42,128,129],[0,16,94,95,5,19,100,101,11,55,88,89,6,34,124,125],[0,16,94,95,15,30,109,108,11,55,88,89,7,35,128,129],[0,16,78,79,2,17,109,108,1,52,92,93,6,34,126,127],[0,16,78,79,12,33,100,101,1,52,92,93,7,35,122,123],[0,16,82,83,12,33,138,139,53,54,88,89,8,41,126,127],[0,16,82,83,2,17,116,117,53,54,88,89,9,42,122,123],[0,16,78,79,5,19,116,117,1,52,92,93,8,41,128,129],[0,16,82,83,15,30,100,101,1,52,90,91,9,42,122,123],[0,16,82,83,15,30,100,101,53,54,88,89,6,34,128,129],[0,16,82,83,5,19,109,108,53,54,88,89,7,35,124,125],[0,16,74,75,2,17,100,101,1,52,88,89,6,34,122,123,29,21,82,83,15,30,116,117,53,54,90,91,9,42,128,129],[0,16,74,75,12,33,109,108,1,52,88,89,7,35,126,127,29,21,82,83,5,19,138,139,53,54,90,91,8,41,124,125],[0,21,84,85,118,119,116,101,96,97,88,91,9,34,132,133,29,16,86,87,120,121,100,117,98,99,90,89,6,42,130,131],[0,21,84,85,142,143,138,108,96,97,88,91,8,35,136,137,29,16,86,87,144,145,109,139,98,99,90,89,7,41,134,135],[0,146,147],[0,148,149],[0,150,151],[0,146,147,152,153,154,155,156,157],[0,158,159],[0,146,147,1,160,161],[0,146,147,1,160,161,152,153,154,162,163,164,155,156,157,165,166,167],[0,158,159,1,168,169],[0,146,147,101,170,171],[0,146,147,100,172,173],[0,148,149,174,175,171],[0,148,149,100,176,177],[0,150,151,178,179,171],[0,150,151,100,180,181],[0,146,147,100,172,173,152,153,154,182,183,184,155,156,157,185,186,187],[0,158,159,101,188,189],[0,146,147,122,190,191],[0,146,147,123,192,193],[0,146,147,126,194,195],[0,146,147,127,196,197],[0,146,147,122,190,191,152,153,154,198,199,200,155,156,157,201,202,203],[0,158,159,123,204,205],[0,146,147,126,194,195,152,153,154,206,207,208,155,156,157,209,210,211],[0,158,159,129,212,213],[0,146,147,101,170,171,1,160,161,123,192,193],[0,146,147,108,214,215,1,160,161,127,196,197],[0,146,147,100,172,173,1,160,161,122,190,191],[0,146,147,109,216,217,1,160,161,126,194,195],[0,146,147,100,172,173,1,160,161,122,190,191,152,153,154,182,183,184,162,163,164,198,199,200,155,156,157,185,186,187,165,166,167,201,202,203],[0,158,159,101,188,189,1,168,169,123,204,205],[0,146,147,109,216,217,1,160,161,126,194,195,152,153,154,218,219,220,162,163,164,206,207,208,155,156,157,221,222,223,165,166,167,209,210,211],[0,158,159,117,224,225,1,168,169,129,212,213],[0,146,147,16,226,227],[0,148,149,18,228,229],[0,150,151,18,230,231],[0,150,151,16,232,233],[0,148,149,16,234,235],[0,146,147,18,236,237],[0,146,147,52,238,239],[0,146,147,16,226,227,1,160,161,52,238,239],[0,146,147,18,236,237,1,160,161,61,240,241],[0,146,147,16,226,227,100,172,173,101,170,171],[0,148,149,18,228,229,242,172,181,243,214,244],[0,150,151,18,230,231,245,172,177,246,214,247],[0,150,151,16,232,233,245,172,177,174,170,248],[0,148,149,16,234,235,242,172,181,178,170,249],[0,146,147,18,236,237,100,172,173,108,214,215],[0,146,147,16,226,227,122,190,191,123,192,193],[0,146,147,16,226,227,126,194,195,127,196,197],[0,146,147,18,236,237,126,194,195,123,192,193],[0,146,147,18,236,237,122,190,191,127,196,197],[0,146,147,52,238,239,122,190,191,101,170,171],[0,146,147,61,240,241,126,194,195,101,170,171],[0,146,147,52,238,239,100,172,173,123,192,193],[0,146,147,61,240,241,100,172,173,127,196,197],[0,146,147,16,226,227,100,172,173,101,170,171,1,160,161,52,239,238,122,190,191,123,192,193],[0,146,147,16,226,227,109,216,217,108,214,215,1,160,161,52,239,238,126,194,195,127,196,197],[0,146,147,18,236,237,109,216,217,101,170,171,1,160,161,61,241,240,126,194,195,123,192,193],[0,146,147,18,236,237,100,172,173,108,214,215,1,160,161,61,241,240,122,190,191,127,196,197],[0,16,2,17,158,250,251,252,159,253,254,255],[0,16,2,17,158,250,251,252,159,253,254,255,23,24,13,25,256,257,258,259,260,261,262,263,26,20,27,28,264,265,266,267,268,269,270,271,4,22,5,19,272,273,274,275,276,277,278,279],[0,16,2,17,158,250,251,252,159,253,254,255,29,21,15,30,280,281,282,283,284,285,286,287],[0,20,13,19,158,273,266,259,159,261,278,271],[0,20,13,19,158,273,266,259,159,261,278,271,29,31,32,33,280,288,289,290,284,291,292,293],[0,16,2,17,158,250,251,252,159,253,254,255,1,52,6,34,168,294,295,296,169,297,298,299],[0,16,2,17,158,250,251,252,159,253,254,255,53,54,9,42,300,301,302,303,304,305,306,307],[0,16,2,17,158,250,251,252,159,253,254,255,1,52,6,34,168,294,295,296,169,297,298,299,23,24,13,25,256,257,258,259,260,261,262,263,64,62,14,39,308,309,310,311,312,313,314,315,26,20,27,28,264,265,266,267,268,269,270,271,65,59,40,38,316,317,318,319,320,321,322,323,4,22,5,19,272,273,274,275,276,277,278,279,11,55,8,41,324,325,326,327,328,329,330,331],[0,16,2,17,158,250,251,252,159,253,254,255,66,67,44,45,332,333,334,335,336,337,338,339,23,24,13,25,256,257,258,259,260,261,262,263,68,69,46,47,340,341,342,343,344,345,346,347,26,20,27,28,264,265,266,267,268,269,270,271,70,71,48,49,348,349,350,351,352,353,354,355,4,22,5,19,272,273,274,275,276,277,278,279,72,73,50,51,356,357,358,359,360,361,362,363],[0,16,2,17,158,250,251,252,159,253,254,255,1,52,6,34,168,294,295,296,169,297,298,299,29,21,15,30,280,281,282,283,284,285,286,287,53,54,9,42,300,301,302,303,304,305,306,307],[0,20,13,19,158,273,266,259,159,261,278,271,1,59,14,41,168,325,318,311,169,313,330,323],[0,20,13,19,158,273,266,259,159,261,278,271,1,59,14,41,168,325,318,311,169,313,330,323,29,31,32,33,280,288,289,290,284,291,292,293,53,63,36,35,300,364,365,366,304,367,368,369],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189],[0,16,2,17,158,250,251,252,159,253,254,255,116,117,83,82,376,377,224,378,379,380,381,225],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,23,24,13,25,256,257,258,259,260,261,262,263,382,383,384,385,386,387,388,389,390,391,392,393,26,20,27,28,264,265,266,267,268,269,270,271,394,395,396,397,398,399,400,401,402,403,404,405,4,22,5,19,272,273,274,275,276,277,278,279,138,139,95,94,406,407,408,409,410,411,412,413],[0,24,5,28,158,265,258,275,159,277,270,263,414,415,416,417,418,419,420,421,422,423,424,425,23,16,27,19,256,273,251,267,260,269,278,255,426,427,428,429,430,431,432,433,434,435,436,437,26,22,13,17,264,250,274,259,268,261,254,279,438,439,440,441,442,443,444,445,446,447,448,449,4,20,2,25,272,257,266,252,276,253,262,271,450,451,452,453,454,455,456,457,458,459,460,461],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,29,21,15,30,280,281,282,283,284,285,286,287,116,117,83,82,376,377,224,378,379,380,381,225],[0,20,13,19,158,273,266,259,159,261,278,271,450,415,440,429,454,431,420,445,458,447,436,425],[0,20,13,19,158,273,266,259,159,261,278,271,462,463,464,465,466,467,468,469,470,471,472,473],[0,20,13,19,158,273,266,259,159,261,278,271,462,463,464,465,466,467,468,469,470,471,472,473,29,31,32,33,280,288,289,290,284,291,292,293,450,415,440,429,454,431,420,445,458,447,436,425],[0,16,2,17,158,250,251,252,159,253,254,255,123,122,88,89,204,474,475,476,205,477,478,479],[0,16,2,17,158,250,251,252,159,253,254,255,123,122,88,89,204,474,475,476,205,477,478,479,23,24,13,25,256,257,258,259,260,261,262,263,480,481,482,483,484,485,486,487,488,489,490,491,26,20,27,28,264,265,266,267,268,269,270,271,492,493,494,495,496,497,498,499,500,501,502,503,4,22,5,19,272,273,274,275,276,277,278,279,125,124,140,141,504,505,506,507,508,509,510,511],[0,16,2,17,158,250,251,252,159,253,254,255,123,122,88,89,204,474,475,476,205,477,478,479,29,21,15,30,280,281,282,283,284,285,286,287,129,128,90,91,212,512,513,514,213,515,516,517],[0,16,2,17,158,250,251,252,159,253,254,255,129,128,90,91,212,512,513,514,213,515,516,517],[0,16,2,17,158,250,251,252,159,253,254,255,129,128,90,91,212,512,513,514,213,515,516,517,23,24,13,25,256,257,258,259,260,261,262,263,518,519,520,521,522,523,524,525,526,527,528,529,26,20,27,28,264,265,266,267,268,269,270,271,530,531,532,533,534,535,536,537,538,539,540,541,4,22,5,19,272,273,274,275,276,277,278,279,127,126,92,93,542,543,544,545,546,547,548,549],[0,20,13,19,158,273,266,259,159,261,278,271,550,551,552,553,554,555,556,557,558,559,560,561,29,31,32,33,280,288,289,290,284,291,292,293,562,563,564,565,566,567,568,569,570,571,572,573],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,1,52,6,34,168,294,295,296,169,297,298,299,122,123,89,88,475,476,204,474,479,478,477,205],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,53,54,9,42,300,301,302,303,304,305,306,307,128,129,91,90,513,514,212,512,517,516,515,213],[0,16,2,17,158,250,251,252,159,253,254,255,116,117,83,82,376,377,224,378,379,380,381,225,1,52,6,34,168,294,295,296,169,297,298,299,128,129,91,90,513,514,212,512,517,516,515,213],[0,16,2,17,158,250,251,252,159,253,254,255,116,117,83,82,376,377,224,378,379,380,381,225,53,54,9,42,300,301,302,303,304,305,306,307,122,123,89,88,475,476,204,474,479,478,477,205],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,1,52,6,34,168,294,295,296,169,297,298,299,122,123,89,88,475,476,204,474,479,478,477,205,23,24,13,25,256,257,258,259,260,261,262,263,382,383,384,385,386,387,388,389,390,391,392,393,64,62,14,39,308,309,310,311,312,313,314,315,481,480,483,482,486,487,484,485,491,490,489,488,26,20,27,28,264,265,266,267,268,269,270,271,394,395,396,397,398,399,400,401,402,403,404,405,65,59,40,38,316,317,318,319,320,321,322,323,493,492,495,494,498,499,496,497,503,502,501,500,4,22,5,19,272,273,274,275,276,277,278,279,138,139,95,94,406,407,408,409,410,411,412,413,11,55,8,41,324,325,326,327,328,329,330,331,124,125,141,140,506,507,504,505,511,510,509,508],[0,16,2,17,158,250,251,252,159,253,254,255,116,117,83,82,376,377,224,378,379,380,381,225,1,52,6,34,168,294,295,296,169,297,298,299,128,129,91,90,513,514,212,512,517,516,515,213,23,24,13,25,256,257,258,259,260,261,262,263,574,575,576,577,578,579,580,581,582,583,584,585,64,62,14,39,308,309,310,311,312,313,314,315,519,518,521,520,524,525,522,523,529,528,527,526,26,20,27,28,264,265,266,267,268,269,270,271,586,587,588,589,590,591,592,593,594,595,596,597,65,59,40,38,316,317,318,319,320,321,322,323,531,530,533,532,536,537,534,535,541,540,539,538,4,22,5,19,272,273,274,275,276,277,278,279,109,108,79,78,598,599,600,601,602,603,604,605,11,55,8,41,324,325,326,327,328,329,330,331,126,127,93,92,544,545,542,543,549,548,547,546],[0,24,5,28,158,265,258,275,159,277,270,263,414,415,416,417,418,419,420,421,422,423,424,425,66,69,50,49,332,349,342,359,336,361,354,347,493,123,483,140,498,507,204,485,503,490,509,205,23,16,27,19,256,273,251,267,260,269,278,255,426,427,428,429,430,431,432,433,434,435,436,437,68,67,48,51,340,357,334,351,344,353,362,339,124,480,89,494,506,499,484,474,511,478,501,488,26,22,13,17,264,250,274,259,268,261,254,279,438,439,440,441,442,443,444,445,446,447,448,449,70,73,46,45,348,333,358,343,352,345,338,363,122,492,141,482,475,487,496,505,479,510,489,500,4,20,2,25,272,257,266,252,276,253,262,271,450,451,452,453,454,455,456,457,458,459,460,461,72,71,44,47,356,341,350,335,360,337,346,355,481,125,495,88,486,476,504,497,491,502,477,508],[0,24,5,28,158,265,258,275,159,277,270,263,414,415,416,417,418,419,420,421,422,423,424,425,606,607,608,609,610,611,612,613,614,615,616,617,531,129,521,92,536,545,212,523,541,528,547,213,23,16,27,19,256,273,251,267,260,269,278,255,426,427,428,429,430,431,432,433,434,435,436,437,618,619,620,621,622,623,624,625,626,627,628,629,126,518,91,532,544,537,522,512,549,516,539,526,26,22,13,17,264,250,274,259,268,261,254,279,438,439,440,441,442,443,444,445,446,447,448,449,630,631,632,633,634,635,636,637,638,639,640,641,128,530,93,520,513,525,534,543,517,548,527,538,4,20,2,25,272,257,266,252,276,253,262,271,450,451,452,453,454,455,456,457,458,459,460,461,642,643,644,645,646,647,648,649,650,651,652,653,519,127,533,90,524,514,542,535,529,540,515,546],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,1,52,6,34,168,294,295,296,169,297,298,299,122,123,89,88,475,476,204,474,479,478,477,205,29,21,15,30,280,281,282,283,284,285,286,287,116,117,83,82,376,377,224,378,379,380,381,225,53,54,9,42,300,301,302,303,304,305,306,307,128,129,91,90,513,514,212,512,517,516,515,213],[0,20,13,19,158,273,266,259,159,261,278,271,462,463,464,465,466,467,468,469,470,471,472,473,1,59,14,41,168,325,318,311,169,313,330,323,551,550,553,552,556,557,554,555,561,560,559,558,29,31,32,33,280,288,289,290,284,291,292,293,450,415,440,429,454,431,420,445,458,447,436,425,53,63,36,35,300,364,365,366,304,367,368,369,563,562,565,564,568,569,566,567,573,572,571,570],[0,16],[0,18],[0,16,26,20],[0,2,23,13],[0,3,4,32],[0,2,29,15],[0,3,29,27],[0,52],[0,63],[0,52,26,59],[0,63,26,54],[0,52,16,1],[0,18,1,61],[0,52,16,1,26,59,20,65],[0,31,1,63],[0,1,24,62],[0,31,1,63,26,21,65,54],[0,2,57,56],[0,60,3,16],[0,22,57,3],[0,2,28,20],[0,17,13,24],[0,20,19,13,4,24,17,27],[0,22,57,3,4,16,60,32],[0,22,57,3,23,20,30,12,26,24,33,15,4,16,60,32],[0,22,57,3,29,18,27,25],[0,22,3,57,1,55,10,37],[0,22,385,396,3,57,109,117],[0,22,57,3,159,279,654,655,158,274,656,657,29,18,25,27,284,658,262,269,280,659,257,267]],t.ZeroBasedSpacegroupNumbers={"P 1":0,"P -1":1,"P 1 2 1":2,"P 1 21 1":3,"C 1 2 1":4,"P 1 m 1":5,"P 1 c 1":6,"C 1 m 1":7,"C 1 c 1":8,"P 1 2/m 1":9,"P 1 21/m 1":10,"C 1 2/m 1":11,"P 1 2/c 1":12,"P 1 21/c 1":13,"C 1 2/c 1":14,"P 2 2 2":15,"P 2 2 21":16,"P 21 21 2":17,"P 21 21 21":18,"C 2 2 21":19,"C 2 2 2":20,"F 2 2 2":21,"I 2 2 2":22,"I 21 21 21":23,"P m m 2":24,"P m c 21":25,"P c c 2":26,"P m a 2":27,"P c a 21":28,"P n c 2":29,"P m n 21":30,"P b a 2":31,"P n a 21":32,"P n n 2":33,"C m m 2":34,"C m c 21":35,"C c c 2":36,"A m m 2":37,"A b m 2":38,"A m a 2":39,"A b a 2":40,"F m m 2":41,"F d d 2":42,"I m m 2":43,"I b a 2":44,"I m a 2":45,"P 2/m 2/m 2/m":46,"P m m m":46,"P 2/n 2/n 2/n":47,"P n n n":47,"P 2/c 2/c 2/m":48,"P c c m":48,"P 2/b 2/a 2/n":49,"P b a n":49,"P 21/m 2/m 2/a":50,"P m m a":50,"P 2/n 21/n 2/a":51,"P n n a":51,"P 2/m 2/n 21/a":52,"P m n a":52,"P 21/c 2/c 2/a":53,"P c c a":53,"P 21/b 21/a 2/m":54,"P b a m":54,"P 21/c 21/c 2/n":55,"P c c n":55,"P 2/b 21/c 21/m":56,"P b c m":56,"P 21/n 21/n 2/m":57,"P n n m":57,"P 21/m 21/m 2/n":58,"P m m n":58,"P 21/b 2/c 21/n":59,"P b c n":59,"P 21/b 21/c 21/a":60,"P b c a":60,"P 21/n 21/m 21/a":61,"P n m a":61,"C 2/m 2/c 21/m":62,"C m c m":62,"C 2/m 2/c 21/a":63,"C m c a":63,"C 2/m 2/m 2/m":64,"C m m m":64,"C 2/c 2/c 2/m":65,"C c c m":65,"C 2/m 2/m 2/a":66,"C m m a":66,"C 2/c 2/c 2/a":67,"C c c a":67,"F 2/m 2/m 2/m":68,"F m m m":68,"F 2/d 2/d 2/d":69,"F d d d":69,"I 2/m 2/m 2/m":70,"I m m m":70,"I 2/b 2/a 2/m":71,"I b a m":71,"I 21/b 21/c 21/a":72,"I b c a":72,"I 21/m 21/m 21/a":73,"I m m a":73,"P 4":74,"P 41":75,"P 42":76,"P 43":77,"I 4":78,"I 41":79,"P -4":80,"I -4":81,"P 4/m":82,"P 42/m":83,"P 4/n":84,"P 42/n":85,"I 4/m":86,"I 41/a":87,"P 4 2 2":88,"P 4 21 2":89,"P 41 2 2":90,"P 41 21 2":91,"P 42 2 2":92,"P 42 21 2":93,"P 43 2 2":94,"P 43 21 2":95,"I 4 2 2":96,"I 41 2 2":97,"P 4 m m":98,"P 4 b m":99,"P 42 c m":100,"P 42 n m":101,"P 4 c c":102,"P 4 n c":103,"P 42 m c":104,"P 42 b c":105,"I 4 m m":106,"I 4 c m":107,"I 41 m d":108,"I 41 c d":109,"P -4 2 m":110,"P -4 2 c":111,"P -4 21 m":112,"P -4 21 c":113,"P -4 m 2":114,"P -4 c 2":115,"P -4 b 2":116,"P -4 n 2":117,"I -4 m 2":118,"I -4 c 2":119,"I -4 2 m":120,"I -4 2 d":121,"P 4/m 2/m 2/m":122,"P4/m m m":122,"P 4/m 2/c 2/c":123,"P4/m c c":123,"P 4/n 2/b 2/m":124,"P4/n b m":124,"P 4/n 2/n 2/c":125,"P4/n n c":125,"P 4/m 21/b 2/m":126,"P4/m b m":126,"P 4/m 21/n 2/c":127,"P4/m n c":127,"P 4/n 21/m 2/m":128,"P4/n m m":128,"P 4/n 2/c 2/c":129,"P4/n c c":129,"P 42/m 2/m 2/c":130,"P42/m m c":130,"P 42/m 2/c 2/m":131,"P42/m c m":131,"P 42/n 2/b 2/c":132,"P42/n b c":132,"P 42/n 2/n 2/m":133,"P42/n n m":133,"P 42/m 21/b 2/c":134,"P42/m b c":134,"P 42/m 21/n 2/m":135,"P42/m n m":135,"P 42/n 21/m 2/c":136,"P42/n m c":136,"P 42/n 21/c 2/m":137,"P42/n c m":137,"I 4/m 2/m 2/m":138,"I4/m m m":138,"I 4/m 2/c 2/m":139,"I4/m c m":139,"I 41/a 2/m 2/d":140,"I41/a m d":140,"I 41/a 2/c 2/d":141,"I41/a c d":141,"P 3":142,"P 31":143,"P 32":144,"H 3":145,"R 3":146,"P -3":147,"H -3":148,"R -3":149,"P 3 1 2":150,"P 3 2 1":151,"P 31 1 2":152,"P 31 2 1":153,"P 32 1 2":154,"P 32 2 1":155,"H 3 2":156,"R 3 2":157,"P 3 m 1":158,"P 3 1 m":159,"P 3 c 1":160,"P 3 1 c":161,"H 3 m":162,"R 3 m":163,"H 3 c":164,"R 3 c":165,"P -3 1 2/m":166,"P -3 1 m":166,"P -3 1 2/c":167,"P -3 1 c":167,"P -3 2/m 1":168,"P -3 m 1":168,"P -3 2/c 1":169,"P -3 c 1":169,"H -3 2/m":170,"H -3 m":170,"R -3 2/m":171,"R -3 m":171,"H -3 2/c":172,"H -3 c":172,"R -3 2/c":173,"R -3 c":173,"P 6":174,"P 61":175,"P 65":176,"P 62":177,"P 64":178,"P 63":179,"P -6":180,"P 6/m":181,"P 63/m":182,"P 6 2 2":183,"P 61 2 2":184,"P 65 2 2":185,"P 62 2 2":186,"P 64 2 2":187,"P 63 2 2":188,"P 6 m m":189,"P 6 c c":190,"P 63 c m":191,"P 63 m c":192,"P -6 m 2":193,"P -6 c 2":194,"P -6 2 m":195,"P -6 2 c":196,"P 6/m 2/m 2/m":197,"P 6/m m m":197,"P 6/m 2/c 2/c":198,"P 6/m c c":198,"P 63/m 2/c 2/m":199,"P 63/m c m":199,"P 63/m 2/m 2/c":200,"P 63/m m c":200,"P 2 3":201,"F 2 3":202,"I 2 3":203,"P 21 3":204,"I 21 3":205,"P 2/m -3":206,"P m -3":206,"P 2/n -3":207,"P n -3":207,"F 2/m -3":208,"F m -3":208,"F 2/d -3":209,"F d -3":209,"I 2/m -3":210,"I m -3":210,"P 21/a -3":211,"P a -3":211,"I 21/a -3":212,"I a -3":212,"P 4 3 2":213,"P 42 3 2":214,"F 4 3 2":215,"F 41 3 2":216,"I 4 3 2":217,"P 43 3 2":218,"P 41 3 2":219,"I 41 3 2":220,"P -4 3 m":221,"F -4 3 m":222,"I -4 3 m":223,"P -4 3 n":224,"F -4 3 c":225,"I -4 3 d":226,"P 4/m -3 2/m":227,"P m -3 m":227,"P 4/n -3 2/n":228,"P n -3 n":228,"P 42/m -3 2/n":229,"P m -3 n":229,"P 42/n -3 2/m":230,"P n -3 m":230,"F 4/m -3 2/m":231,"F m -3 m":231,"F 4/m -3 2/c":232,"F m -3 c":232,"F 41/d -3 2/m":233,"F d -3 m":233,"F 41/d -3 2/c":234,"F d -3 c":234,"I 4/m -3 2/m":235,"I m -3 m":235,"I 41/a -3 2/d":236,"I a -3 d":236,"P 1 1 2":237,"P 1 1 21":238,"B 1 1 2":239,"B 2":239,"A 1 2 1":240,"C 1 21 1":241,"I 1 2 1":242,"I 2":242,"I 1 21 1":243,"P 1 1 m":244,"P 1 1 b":245,"B 1 1 m":246,"B 1 1 b":247,"P 1 1 2/m":248,"P 1 1 21/m":249,"B 1 1 2/m":250,"P 1 1 2/b":251,"P 1 1 21/b":252,"B 1 1 2/b":253,"P 21 2 2":254,"P 2 21 2":255,"P 21 21 2 (a)":256,"P 21 2 21":257,"P 2 21 21":258,"C 2 2 21a)":259,"C 2 2 2a":260,"F 2 2 2a":261,"I 2 2 2a":262,"P 21/m 21/m 2/n a":263,"P 42 21 2a":264,"I 2 3a":265},t.SpacegroupNames=function(){for(var e=Object.create(null),n=0,r=Object.keys(t.ZeroBasedSpacegroupNumbers);n<r.length;n++){var i=r[n];e[t.ZeroBasedSpacegroupNumbers[i]]=i}return e}(),t.getSpacegroupIndex=function(e){var n="number"==typeof e?e-1:t.ZeroBasedSpacegroupNumbers[e];return void 0===n||void 0===t.SpacegroupNames[n]?-1:n}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(232),i=n(233),a=n(2),o=n(5),u=n(136);t.GridLookup3D=function(e,t){return new s(e,t)};var s=function(){function e(e,t){var n=function(e,t){var n,r,u=function(e){var t=e.x,n=e.y,r=e.z,i=e.radius,u=e.indices,s=a.Vec3.zero();c.reset(0);for(var l=0,f=o.OrderedSet.size(u);l<f;l++){var d=o.OrderedSet.getAt(u,l);a.Vec3.set(s,t[d],n[d],r[d]),c.boundaryStep(s,i&&i[d]||0)}c.finishBoundaryStep();for(var l=0,f=o.OrderedSet.size(u);l<f;l++){var d=o.OrderedSet.getAt(u,l);a.Vec3.set(s,t[d],n[d],r[d]),c.extendStep(s,i&&i[d]||0)}return{boundingBox:c.getBox(),boundingSphere:c.getSphere()}}(e),s=u.boundingBox,l=u.boundingSphere,f=i.Box3D.expand(i.Box3D.empty(),s,a.Vec3.create(.5,.5,.5)),d=e.indices,p=a.Vec3.sub(a.Vec3.zero(),f.max,f.min),h=o.OrderedSet.size(d);if(t)r=[Math.ceil(p[0]/t[0]),Math.ceil(p[1]/t[1]),Math.ceil(p[2]/t[2])],n=t;else if(h>0){var m=Math.ceil(h/32),y=Math.pow(m/(p[0]*p[1]*p[2]),1/3);r=[Math.ceil(p[0]*y),Math.ceil(p[1]*y),Math.ceil(p[2]*y)],n=[p[0]/r[0],p[1]/r[1],p[2]/r[2]]}else n=p,r=[1,1,1];var v={x:e.x,y:e.y,z:e.z,indices:d,radius:e.radius};return function(e){for(var t=e.expandedBox,n=e.size,r=n[0],i=n[1],a=n[2],u=e.data,s=u.x,c=u.y,l=u.z,f=u.radius,d=u.indices,p=e.elementCount,h=e.delta,m=r*i*a,y=t.min,v=y[0],b=y[1],g=y[2],_=0,S=0,C=new Uint32Array(m),x=new Int32Array(p),w=0,P=o.OrderedSet.size(d);w<P;w++){var T=o.OrderedSet.getAt(d,w),A=Math.floor((s[T]-v)/h[0]),E=Math.floor((c[T]-b)/h[1]),k=Math.floor((l[T]-g)/h[2]),I=(A*i+E)*a+k;1===(C[I]+=1)&&(S+=1),x[w]=I}if(f)for(var w=0,P=o.OrderedSet.size(d);w<P;w++){var T=o.OrderedSet.getAt(d,w);f[T]>_&&(_=f[T])}for(var M=new Int32Array(S),T=0,V=0;T<m;T++){var O=C[T];O>0&&(C[T]=V+1,M[V]=O,V+=1)}for(var D=new Uint32Array(S),T=1;T<S;++T)D[T]+=D[T-1]+M[T-1];for(var R=new Int32Array(S),j=new Int32Array(p),T=0;T<p;T++){var N=C[x[T]];if(N>0){var B=N-1;j[D[B]+R[B]]=T,R[B]+=1}}return{size:e.size,bucketArray:j,bucketCounts:M,bucketOffset:D,grid:C,delta:h,min:e.expandedBox.min,data:e.data,maxRadius:_,expandedBox:e.expandedBox,boundingBox:e.boundingBox,boundingSphere:e.boundingSphere}}({size:r,data:v,expandedBox:f,boundingBox:s,boundingSphere:l,elementCount:h,delta:n})}(e,t);this.ctx={grid:n,x:.1,y:.1,z:.1,radius:.1,result:r.Result.create(),isCheck:!1},this.boundary={box:n.boundingBox,sphere:n.boundingSphere},this.buckets={offset:n.bucketOffset,count:n.bucketCounts,array:n.bucketArray}}return e.prototype.find=function(e,t,n,r){return this.ctx.x=e,this.ctx.y=t,this.ctx.z=n,this.ctx.radius=r,this.ctx.isCheck=!1,l(this.ctx),this.ctx.result},e.prototype.check=function(e,t,n,r){return this.ctx.x=e,this.ctx.y=t,this.ctx.z=n,this.ctx.radius=r,this.ctx.isCheck=!0,l(this.ctx)},e}();var c=new u.BoundaryHelper;function l(e){var t=e.grid,n=t.min,i=t.size,a=i[0],u=i[1],s=i[2],c=t.bucketOffset,l=t.bucketCounts,f=t.bucketArray,d=t.grid,p=t.data,h=p.x,m=p.y,y=p.z,v=p.indices,b=p.radius,g=t.delta,_=t.maxRadius,S=e.radius,C=e.isCheck,x=e.x,w=e.y,P=e.z,T=e.result,A=S+_,E=A*A;r.Result.reset(T);var k=Math.max(0,Math.floor((x-A-n[0])/g[0])),I=Math.max(0,Math.floor((w-A-n[1])/g[1])),M=Math.max(0,Math.floor((P-A-n[2])/g[2])),V=Math.min(a-1,Math.floor((x+A-n[0])/g[0])),O=Math.min(u-1,Math.floor((w+A-n[1])/g[1])),D=Math.min(s-1,Math.floor((P+A-n[2])/g[2]));if(k>V||I>O||M>D)return!1;for(var R=k;R<=V;R++)for(var j=I;j<=O;j++)for(var N=M;N<=D;N++){var B=d[(R*u+j)*s+N];if(0!==B)for(var F=B-1,L=c[F],z=L+l[F],U=L;U<z;U++){var G=o.OrderedSet.getAt(v,f[U]),q=h[G]-x,H=m[G]-w,W=y[G]-P,Y=q*q+H*H+W*W;if(Y<=E){if(_>0&&Math.sqrt(Y)-b[G]>S)continue;if(C)return!0;r.Result.add(T,f[U],Y)}}}return T.count>0}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(234);function i(e,t){return t<=e?r.default.create(e,e):r.default.create(e,t)}function a(e){return r.default.snd(e)-1}function o(e){return r.default.snd(e)-r.default.fst(e)}function u(e,n){var r=o(e),i=o(n);return 0===r&&0===i||r>0&&i>0&&a(e)>=t.min(n)&&t.min(e)<=a(n)}function s(e,n){var r=t.start(e);if(n<=r)return 0;var i=t.end(e);return n>=i?i-r:n-r}function c(e,t,n){return i(s(e,t),s(e,n+1))}t.Empty=r.default.Zero,t.ofRange=function(e,t){return t<e?r.default.create(e,e):r.default.create(e,t+1)},t.ofBounds=i,t.is=r.default.is,t.start=r.default.fst,t.end=r.default.snd,t.min=r.default.fst,t.max=a,t.size=o,t.hashCode=r.default.hashCode,t.has=function(e,t){return r.default.fst(e)<=t&&t<r.default.snd(e)},t.indexOf=function(e,n){var r=t.start(e);return n>=r&&n<t.end(e)?n-r:-1},t.getAt=function(e,t){return r.default.fst(e)+t},t.areEqual=r.default.areEqual,t.areIntersecting=u,t.isSubInterval=function(e,n){return o(e)?!o(n)||t.start(e)<=t.start(n)&&t.end(e)>=t.end(n):0===o(n)},t.findPredecessorIndex=s,t.findPredecessorIndexInInterval=function(e,n,r){var i=t.start(r),a=t.start(e);if(n<=i+a)return i;var o=t.end(r);return n>=o+a?o:n-a},t.findRange=c,t.intersect=function(e,n){return u(e,n)?i(Math.max(t.start(e),t.start(n)),Math.min(t.end(e),t.end(n))):t.Empty},t.intersectionSize=function(e,n){return o(c(e,t.min(n),a(n)))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(188),i=n(115);function a(e){return e.length?e[e.length-1]-e[0]+1===e.length?i.default.ofRange(e[0],e[e.length-1]):e:t.Empty}function o(e){return i.default.is(e)?i.default.size(e):r.default.size(e)}function u(e){return i.default.is(e)?i.default.min(e):r.default.min(e)}function s(e){return i.default.is(e)?i.default.max(e):r.default.max(e)}function c(e,t){return i.default.size(e)===r.default.size(t)&&i.default.start(e)===r.default.start(t)&&i.default.end(e)===r.default.end(t)}function l(e,t){return 0!==e.length&&0!==i.default.size(r.default.findRange(e,i.default.min(t),i.default.max(t)))}function f(e,t){return o(e)?!o(t)||u(e)<=u(t)&&s(e)>=s(t):0===o(t)}function d(e,t){var n=i.default.size(t);if(!n)return e;if(f(t,e))return t;for(var o=i.default.min(t),u=i.default.max(t),s=r.default.findRange(e,o,u),c=i.default.start(s),l=i.default.end(s),d=new Int32Array(c+(e.length-l)+n),p=0,h=0;h<c;h++)d[p++]=e[h];for(h=o;h<=u;h++)d[p++]=h;h=l;for(var m=e.length;h<m;h++)d[p]=e[h];return a(d)}function p(e,t){if(!i.default.size(t))return 0;var n=r.default.findRange(e,i.default.min(t),i.default.max(t));return i.default.end(n)-i.default.start(n)}function h(e,n){if(!i.default.size(n))return t.Empty;var o=r.default.findRange(e,i.default.min(n),i.default.max(n)),u=i.default.start(o),s=i.default.end(o),c=s-u;if(!c)return t.Empty;if(c===e.length)return e;for(var l=new Int32Array(c),f=0,d=u;d<s;d++)l[f++]=e[d];return a(l)}t.Empty=i.default.Empty,t.ofSingleton=i.default.ofSingleton,t.ofRange=i.default.ofRange,t.ofBounds=i.default.ofBounds,t.ofSortedArray=a,t.size=o,t.has=function(e,t){return i.default.is(e)?i.default.has(e,t):r.default.has(e,t)},t.indexOf=function(e,t){return i.default.is(e)?i.default.indexOf(e,t):r.default.indexOf(e,t)},t.getAt=function(e,t){return i.default.is(e)?i.default.getAt(e,t):e[t]},t.min=u,t.max=s,t.start=function(e){return i.default.is(e)?i.default.start(e):r.default.start(e)},t.end=function(e){return i.default.is(e)?i.default.end(e):r.default.end(e)},t.hashCode=function(e){return i.default.is(e)?i.default.hashCode(e):r.default.hashCode(e)},t.areEqual=function(e,t){return i.default.is(e)?i.default.is(t)?i.default.areEqual(e,t):c(e,t):i.default.is(t)?c(t,e):r.default.areEqual(e,t)},t.areIntersecting=function(e,t){return i.default.is(e)?i.default.is(t)?i.default.areIntersecting(e,t):l(t,e):i.default.is(t)?l(e,t):r.default.areIntersecting(e,t)},t.isSubset=function(e,t){return i.default.is(e)?i.default.is(t)?i.default.isSubInterval(e,t):function(e,t){var n=i.default.min(e),a=i.default.max(e);if(a-n+1==0)return!1;var o=r.default.min(t),u=r.default.max(t);return o>=n&&a<=u}(e,t):i.default.is(t)?function(e,t){var n=i.default.min(t),a=i.default.max(t);if(a-n+1==0)return!0;var o=r.default.min(e),u=r.default.max(e);if(n<o||a>u)return!1;var s=r.default.findRange(e,n,a);return i.default.size(s)===i.default.size(t)}(e,t):r.default.isSubset(e,t)},t.findPredecessorIndex=function(e,t){return i.default.is(e)?i.default.findPredecessorIndex(e,t):r.default.findPredecessorIndex(e,t)},t.findPredecessorIndexInInterval=function(e,t,n){return i.default.is(e)?i.default.findPredecessorIndexInInterval(e,t,n):r.default.findPredecessorIndexInInterval(e,t,n)},t.findRange=function(e,t,n){return i.default.is(e)?i.default.findRange(e,t,n):r.default.findRange(e,t,n)},t.intersectionSize=function(e,t){return i.default.is(e)?i.default.is(t)?i.default.intersectionSize(e,t):p(t,e):i.default.is(t)?p(e,t):r.default.intersectionSize(e,t)},t.union=function(e,t){return i.default.is(e)?i.default.is(t)?function(e,t){if(i.default.areEqual(e,t))return e;var n=i.default.size(e),r=i.default.size(t);if(!r)return e;if(!n)return t;var c,l,f,d,p=i.default.min(e),h=i.default.min(t);if(function(e,t){var n=o(e),r=o(t);return 0===n&&0===r||n>0&&r>0&&s(e)>=u(t)&&u(e)<=s(t)}(e,t))return i.default.ofRange(Math.min(p,h),Math.max(i.default.max(e),i.default.max(t)));p<h?(c=n,l=p,f=r,d=h):(c=r,l=h,f=n,d=p);for(var m=new Int32Array(n+r),y=0;y<c;y++)m[y]=y+l;for(var y=0;y<f;y++)m[y+c]=y+d;return a(m)}(e,t):d(t,e):i.default.is(t)?d(e,t):a(r.default.union(e,t))},t.intersect=function(e,t){return i.default.is(e)?i.default.is(t)?i.default.intersect(e,t):h(t,e):i.default.is(t)?h(e,t):a(r.default.intersect(e,t))},t.subtract=function(e,n){return i.default.is(e)?i.default.is(n)?function(e,n){if(i.default.areEqual(e,n))return t.Empty;if(!i.default.areIntersecting(e,n))return e;var r=i.default.min(e),o=i.default.max(e),u=i.default.min(n),s=i.default.max(n);if(o<r||s<u)return e;if(i.default.isSubInterval(n,e))return t.Empty;if(i.default.isSubInterval(e,n)){var c=u-r,l=o-s;if(c<=0)return i.default.ofRange(s+1,s+l);if(l<=0)return i.default.ofRange(r,r+c-1);for(var f=new Int32Array(c+l),d=0,p=0;p<c;p++)f[d++]=r+p;for(var p=1;p<=l;p++)f[d++]=s+p;return a(f)}return r<u?i.default.ofRange(r,u-1):i.default.ofRange(s+1,o)}(e,n):function(e,n){var o=i.default.min(e),u=i.default.max(e);if(u<o)return e;var s=u-o+1,c=r.default.findRange(n,o,u),l=i.default.start(c),f=i.default.end(c),d=f-l;if(0===d)return e;var p=s-d;if(p<=0)return t.Empty;for(var h=new Int32Array(p),m=n.length-1,y=n[Math.min(l,m)],v=n[Math.min(f,m)],b=0,g=o;g<y;g++)h[b++]=g;for(var g=y;g<=v;g++)r.default.indexOfInInterval(n,g,c)<0&&(h[b++]=g);for(var g=v+1;g<=u;g++)h[b++]=g;return a(h)}(e,n):i.default.is(n)?function(e,n){var o=i.default.min(n),u=i.default.max(n);if(u<o)return e;var s=r.default.findRange(e,o,u),c=i.default.start(s),l=i.default.end(s),f=e.length-(l-c);if(f<=0)return t.Empty;if(f===e.length)return e;for(var d=new Int32Array(f),p=0,h=0;h<c;h++)d[p++]=e[h];for(var h=l,m=e.length;h<m;h++)d[p++]=e[h];return a(d)}(e,n):a(r.default.subtract(e,n))},t.forEach=function(e,t,n){if(i.default.is(e))for(var r=i.default.min(e),a=r,o=i.default.max(e);a<=o;a++)t(a,a-r,n);else for(a=0,o=e.length;a<o;a++)t(e[a],a,n);return n}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(17),i=n(115);function a(e){return e}function o(e){return e[0]}function u(e){return e[e.length-1]+1}function s(e){return e.length}function c(e,t){var n=e.length;return 0===n?-1:e[0]<=t&&t<=e[n-1]?f(e,t,0,n):-1}function l(e,t){var n=e.length;return t<=e[0]?0:t>e[n-1]?n:d(e,t,0,n)}function f(e,t,n,r){for(var i=n,a=r-1;i<=a;){if(i+11>a){for(var o=i;o<=a;o++)if(t===e[o])return o;return-1}var u=i+a>>1,s=e[u];if(t<s)a=u-1;else{if(!(t>s))return u;i=u+1}}return-1}function d(e,t,n,r){for(var i=n,a=r-1;i<a;){if(i+11>a){for(var o=i;o<=a;o++)if(t<=e[o])return o;return a+1}var u=i+a>>1,s=e[u];if(t<s)a=u-1;else{if(!(t>s))return u;i=u+1}}return i>a?a+1:e[i]>=t?i:i+1}function p(e,t,n,r,i,a){for(var o=n,u=r,s=0;o<i&&u<a;){var c=e[o],l=t[u];c<l?o++:c>l?u++:(o++,u++,s++)}return s}t.Empty=[],t.ofSingleton=function(e){return[e]},t.ofSortedArray=a,t.ofUnsortedArray=function(e){return r.sortArray(e),e},t.ofRange=function(e,t){if(t<e)return[];for(var n=new Int32Array(t-e+1),r=e;r<=t;r++)n[r-e]=r;return n},t.is=function(e){return e&&(Array.isArray(e)||!!e.buffer)},t.start=o,t.end=u,t.min=function(e){return e[0]},t.max=function(e){return e[e.length-1]},t.size=s,t.hashCode=function(e){var t=e.length;return t?t>2?r.hash4(t,e[0],e[t-1],e[t<<1]):r.hash3(t,e[0],e[t-1]):0},t.indexOf=c,t.indexOfInInterval=function(e,t,n){var r=e.length,a=i.default.start(n),o=i.default.end(n);return 0===r||o<=a?-1:e[a]<=t&&t<=e[o-1]?f(e,t,a,o):-1},t.has=function(e,t){return c(e,t)>=0},t.getAt=function(e,t){return e[t]},t.areEqual=function(e,t){if(e===t)return!0;var n=e.length;if(n!==t.length||e[0]!==t[0]||e[n-1]!==t[n-1])return!1;for(var r=0;r<n;r++)if(e[r]!==t[r])return!1;return!0},t.findPredecessorIndex=l,t.findPredecessorIndexInInterval=function(e,t,n){var r=i.default.start(n),a=i.default.end(n),o=e[r];return t<=o?r:a>r&&t>e[a-1]?a:t-o<=11?function(e,t,n,r){for(var i=n;i<r;i++)if(t<=e[i])return i;return r}(e,t,r+1,a):d(e,t,r,a)},t.findRange=function(e,t,n){return i.default.ofBounds(l(e,t),l(e,n+1))},t.areIntersecting=function(e,t){if(e===t)return!0;for(var n=m(e,t),r=n.startI,i=n.startJ,a=n.endI,o=n.endJ;r<a&&i<o;){var u=e[r],s=t[i];if(u<s)r++;else{if(!(u>s))return!0;i++}}return!1},t.isSubset=function(e,t){if(e===t)return!0;var n=t.length,r=m(e,t),i=r.startI,a=r.startJ,o=r.endI,u=r.endJ;if(u-a<n||o-i<n)return!1;for(var s=0;i<o&&a<u;){var c=e[i],l=t[a];c<l?i++:c>l?a++:(i++,a++,s++)}return s===n},t.union=function(e,t){if(e===t)return e;var n=m(e,t),r=n.startI,i=n.startJ,o=n.endI,u=n.endJ,s=p(e,t,r,i,o,u),c=e.length,l=t.length;if(s===c&&s===l||s===l)return e;if(s===c)return t;for(var f=new Int32Array(c+l-s),d=0,h=0;h<r;h++)f[d++]=e[h];for(h=0;h<i;h++)f[d++]=t[h];for(var y=r,v=i;y<o&&v<u;){var b=e[y],g=t[v];b<g?(f[d++]=b,y++):b>g?(f[d++]=g,v++):(f[d++]=b,y++,v++)}for(;y<c;y++)f[d++]=e[y];for(;v<l;v++)f[d++]=t[v];return a(f)},t.intersectionSize=function(e,t){if(e===t)return s(e);var n=m(e,t);return p(e,t,n.startI,n.startJ,n.endI,n.endJ)},t.intersect=function(e,n){if(e===n)return e;var r=m(e,n),i=r.startI,o=r.startJ,u=r.endI,s=r.endJ,c=p(e,n,i,o,u,s),l=e.length,f=n.length;if(!c)return t.Empty;if(c===l&&c===f||c===f)return n;if(c===l)return e;for(var d=new Int32Array(c),h=0,y=i,v=o;y<u&&v<s;){var b=e[y],g=n[v];b<g?y++:b>g?v++:(d[h++]=b,y++,v++)}return a(d)},t.subtract=function(e,n){if(e===n)return t.Empty;for(var r=e.length,i=m(e,n),o=i.startI,u=i.startJ,s=i.endI,c=i.endJ,l=o,f=u,d=0;l<s&&f<c;)(v=e[l])<(b=n[f])?l++:v>b?f++:(l++,f++,d++);if(!d)return e;if(d>=r)return t.Empty;for(var p=new Int32Array(r-d),h=0,y=0;y<o;y++)p[h++]=e[y];for(l=o,f=u;l<s&&f<c;){var v,b;(v=e[l])<(b=n[f])?(p[h++]=v,l++):v>b?f++:(l++,f++)}for(;l<r;l++)p[h++]=e[l];return a(p)},t.deduplicate=function(e){if(e.length<2)return e;for(var t=1,n=0,r=e.length-1;n<r;n++)e[n]!==e[n+1]&&t++;if(t===e.length)return e;var i=new Int32Array(t),a=0;for(n=0,r=e.length-1;n<r;n++)e[n]!==e[n+1]&&(i[a++]=e[n]);return i[a]=e[e.length-1],i},t.indicesOf=function(e,n){if(e===n)return a(r.createRangeArray(0,e.length-1));for(var i=m(e,n),o=i.startI,u=i.startJ,s=i.endI,c=i.endJ,l=o,f=u,d=0;l<s&&f<c;)(v=e[l])<(b=n[f])?l++:v>b?f++:(l++,f++,d++);var p=e.length;if(!d)return t.Empty;if(d===p)return a(r.createRangeArray(0,e.length-1));var h=new Int32Array(d),y=0;for(l=o,f=u;l<s&&f<c;){var v,b;(v=e[l])<(b=n[f])?l++:v>b?f++:(h[y++]=l,l++,f++)}return a(h)};var h={startI:0,startJ:0,endI:0,endJ:0};function m(e,t){var n=e.length,r=t.length,i=n/r;return n>=128||r>=128||i<=.34||i>=2.99?(h.startI=l(e,o(t)),h.startJ=l(t,o(e)),h.endI=l(e,u(t)),h.endJ=l(t,u(e))):(h.startI=0,h.startJ=0,h.endI=n,h.endJ=r),h}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(353);!function(e){e.create=i.create,e.ofOffsets=i.ofOffsets,e.count=i.count,e.getSegment=i.getSegment,e.projectValue=i.projectValue,e.transientSegments=i.segments}(r||(r={})),t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(235),i=n(115),a=n(188);function o(e){for(var t=a.default.ofSortedArray(e),n=a.default.max(t),r=new Int32Array(n),i=0,o=e.length-1;i<o;i++)for(var u=e[i],s=e[i+1];u<s;u++)r[u]=i;return{offsets:t,index:r,count:e.length-1}}t.create=o,t.ofOffsets=function(e,t){for(var n=i.default.start(t),r=new Int32Array(e.length+1),a=0,u=e.length;a<u;a++)r[a]=e[a]-n;return r[e.length]=i.default.end(t)-n,o(r)},t.count=function(e){return e.count},t.getSegment=function(e,t){return e.index[t]},t.projectValue=function(e,t,n){var i=e.offsets,a=n>=r.default.max(i)?-1:r.default.findPredecessorIndex(i,n-1);return r.default.findRange(t,r.default.getAt(i,a),r.default.getAt(i,a+1)-1)};var u=function(){function e(e,t,n,r){this.segments=e,this.segmentMap=t,this.set=n,this.segmentMin=0,this.segmentMax=0,this.setRange=i.default.Empty,this.value={index:0,start:0,end:0},this.hasNext=!1,this.setRange=r,this.updateSegmentRange()}return e.prototype.move=function(){for(;this.hasNext;){if(this.updateValue()){this.value.index=this.segmentMin++,this.hasNext=this.segmentMax>=this.segmentMin&&i.default.size(this.setRange)>0;break}this.updateSegmentRange()}return this.value},e.prototype.updateValue=function(){var e=this.segments[this.segmentMin+1],t=r.default.findPredecessorIndexInInterval(this.set,e,this.setRange);return this.value.start=i.default.start(this.setRange),this.value.end=t,this.setRange=i.default.ofBounds(t,i.default.end(this.setRange)),t>this.value.start},e.prototype.updateSegmentRange=function(){var e=i.default.min(this.setRange),t=i.default.max(this.setRange);t<e?this.hasNext=!1:(this.segmentMin=this.segmentMap[r.default.getAt(this.set,e)],this.segmentMax=this.segmentMap[r.default.getAt(this.set,t)],this.hasNext=this.segmentMax>=this.segmentMin)},e.prototype.setSegment=function(e){this.setRange=i.default.ofBounds(e.start,e.end),this.updateSegmentRange()},e}();t.SegmentIterator=u,t.segments=function(e,t,n){var a=void 0!==n?i.default.ofBounds(n.start,n.end):i.default.ofBounds(0,r.default.size(t));return new u(e.offsets,e.index,t,a)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.head=e>0?0:-1,this.prev=new Int32Array(e),this.next=new Int32Array(e);for(var t=0;t<e;t++)this.next[t]=t+1,this.prev[t]=t-1;this.prev[0]=-1,this.next[e-1]=-1}return e.prototype.remove=function(e){var t=this.prev,n=this.next,r=t[e],i=n[e];r>=0&&(n[r]=i,t[e]=-1),i>=0&&(t[i]=r,n[e]=-1),e===this.head&&(this.head=r<0?i:r)},e.prototype.has=function(e){return this.prev[e]>=0||this.next[e]>=0||this.head===e},e}();t.default=function(e){return new r(e)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(17);!function(e){function t(){return new Map}e.Empty=new Map,e.keyArray=function(e){return i.iterableToArray(e.keys())},e.Mutable=t,e.asImmutable=function(e){return e},e.copy=function(e){for(var n=t(),r=e.keys();;){var i=r.next(),a=i.done,o=i.value;if(a)break;n.set(o,e.get(o))}return n},e.addFrom=function(e,t){for(var n=t.keys();;){var r=n.next(),i=r.done,a=r.value;if(i)break;e.set(a,t.get(a))}return e}}(r||(r={})),t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(2),a=n(5);!function(e){function t(){return{center:i.Vec3.zero(),radius:0}}e.create=function(e,t){return{center:e,radius:t}},e.zero=t,e.clone=function(e){var n=t();return i.Vec3.copy(n.center,e.center),n.radius=e.radius,n},e.copy=function(e,t){return i.Vec3.copy(e.center,t.center),e.radius=t.radius,e},e.computeBounding=function(e){for(var t=e.x,n=e.y,r=e.z,o=e.indices,u=0,s=0,c=0,l=0,f=a.OrderedSet.size(o),d=0;d<f;d++)u+=t[p=a.OrderedSet.getAt(o,d)],s+=n[p],c+=r[p];for(f>0&&(u/=f,s/=f,c/=f),d=0;d<f;d++){var p,h=t[p=a.OrderedSet.getAt(o,d)]-u,m=n[p]-s,y=r[p]-c,v=h*h+m*m+y*y;v>l&&(l=v)}return{center:i.Vec3.create(u,s,c),radius:Math.sqrt(l)}},e.transform=function(e,t,n){return i.Vec3.transformMat4(e.center,t.center,n),e.radius=t.radius*i.Mat4.getMaxScaleOnAxis(n),e},e.toArray=function(e,t,n){i.Vec3.toArray(e.center,t,n),t[n+3]=e.radius},e.fromArray=function(e,t,n){return i.Vec3.fromArray(e.center,t,n),e.radius=t[n+3],e},e.addSphere=function(e,t){return e.radius=Math.max(e.radius,i.Vec3.distance(e.center,t.center)+t.radius),e},e.expand=function(e,t,n){return e.radius=t.radius+n,e},e.exactEquals=function(e,t){return e.radius===t.radius&&i.Vec3.exactEquals(e.center,t.center)},e.equals=function(e,t){var n=e.radius,r=t.radius;return Math.abs(n-r)<=1e-6*Math.max(1,Math.abs(n),Math.abs(r))&&i.Vec3.equals(e.center,t.center)}}(r||(r={})),t.Sphere3D=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(358);!function(e){e.create=function(e,t,n){return void 0===n&&(n=0),{kind:e,sequence:t,offset:n}},e.getSequenceString=function(e){return e.sequence},e.ofResidueNames=function(e,n,r){if(0===n.rowCount)throw new Error("cannot be empty");var a=function(e){for(var t=0,n=Math.min(e.rowCount,10);t<n;t++){var r=e.value(t)||"";if("X"!==i.getProteinOneLetterCode(r))return{kind:"protein",code:i.getProteinOneLetterCode};if("X"!==i.getRnaOneLetterCode(r))return{kind:"RNA",code:i.getRnaOneLetterCode};if("X"!==i.getDnaOneLetterCode(r))return{kind:"DNA",code:i.getDnaOneLetterCode}}return{kind:"generic",code:function(e){return"X"}}}(e),o=a.kind,u=a.code;return r&&0!==r.size?new t(o,e,n,function(e,t){return function(n){var r=e(n);return"X"===r&&t.has(n)?e(t.get(n)):r}}(u,r)):new t(o,e,n,u)};var t=function(){function e(e,t,n,r){this.kind=e,this.residueName=t,this.seqId=n,this.code=r,this._offset=0,this._seq=void 0}return Object.defineProperty(e.prototype,"offset",{get:function(){return void 0!==this._seq?this._offset:(this.create(),this._offset)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sequence",{get:function(){return void 0!==this._seq?this._seq:(this.create(),this._seq)},enumerable:!0,configurable:!0}),e.prototype.create=function(){for(var e=0,t=Number.MAX_SAFE_INTEGER,n=0,r=this.seqId.rowCount;n<r;n++){var i=this.seqId.value(n);e<i&&(e=i),i<t&&(t=i)}var a=e-t+1,o=new Array(e+1);for(n=0;n<a;n++)o[n]="-";for(n=0,r=this.seqId.rowCount;n<r;n++)o[this.seqId.value(n)-t]=this.code(this.residueName.value(n)||"");this._seq=o.join(""),this._offset=t-1},e}()}(r||(r={})),t.Sequence=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={HIS:"H",ARG:"R",LYS:"K",ILE:"I",PHE:"F",LEU:"L",TRP:"W",ALA:"A",MET:"M",PRO:"P",CYS:"C",ASN:"N",VAL:"V",GLY:"G",SER:"S",GLN:"Q",TYR:"Y",ASP:"D",GLU:"E",THR:"T",SEC:"U",PYL:"O"},i={DA:"A",DC:"C",DG:"G",DT:"T",DU:"U"},a={A:"A",C:"C",G:"G",T:"T",U:"U"};t.getProteinOneLetterCode=function(e){return r[e]||"X"},t.getRnaOneLetterCode=function(e){return a[e]||"X"},t.getDnaOneLetterCode=function(e){return i[e]||"X"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(7);function i(e){return e}t.ModelPropertyDescriptor=i,function(e){e.getUUID=function(e){return e.__key||(e.__key=r.UUID.create22()),e.__key}}(i||(i={})),t.ModelPropertyDescriptor=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){this._list=[],this._set=new Set}return Object.defineProperty(e.prototype,"all",{get:function(){return this._list},enumerable:!0,configurable:!0}),e.prototype.add=function(e){this._set.has(e)||(this._list.push(e),this._set.add(e))},e.prototype.has=function(e){return this._set.has(e)},e}();t.CustomProperties=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(43),i=n(5),a=n(7);function o(e){for(var t=new Map,n=0,r=e.length;n<r;n++)t.set(n,e[n]);return t}!function(e){e.getCifDataSource=function(e,t,n){if(!t)return{rowCount:0};if(n&&n[t.id])return n[t.id];var r=t.getElements(e),i={data:r,rowCount:r.elements.length};return n&&(n[t.id]=i),i},e.fromAtomMap=function(e){return new s(e)},e.fromAtomArray=function(e){return new s(o(e))};var t=function(e){return e.atomicHierarchy.residueAtomSegments};e.fromResidueMap=function(e){return new u("residue",e,t,0)},e.fromResidueArray=function(e){return new u("residue",o(e),t,0)};var n=function(e){return e.atomicHierarchy.chainAtomSegments};e.fromChainMap=function(e){return new u("chain",e,n,0)},e.fromChainArray=function(e){return new u("chain",o(e),n,0)},e.fromEntityMap=function(e){return new c(e)}}(t.IndexedCustomProperty||(t.IndexedCustomProperty={}));var u=function(){function e(e,t,n,r){this.level=e,this.map=t,this.segmentGetter=n,this.id=a.UUID.create22(),this.kind=r}return e.prototype.has=function(e){return this.map.has(e)},e.prototype.get=function(e){return this.map.get(e)},e.prototype.getStructureElements=function(e){var t=e.models;if(1!==t.length)throw new Error("Only works on structures with a single model.");for(var n=new Set,a=e.unitSymmetryGroups,o=[],u=this.segmentGetter(t[0]),s=0,c=a;s<c.length;s++){var l=c[s].units[0];if(l.kind===this.kind)for(var f=i.Segmentation.transientSegments(u,l.elements);f.hasNext;){var d=f.move();this.has(d.index)&&!n.has(d.index)&&(n.add(d.index),o[o.length]=r.StructureElement.create(l,l.elements[d.start]))}}return o.sort(function(e,t){return e.element-t.element}),o},e.prototype.getElements=function(e){var t=this,n=this.segmentGetter(e.model).index,r=this.getStructureElements(e);return{elements:r,property:function(e){return t.get(n[r[e].element])}}},e}(),s=function(){function e(e){this.map=e,this.id=a.UUID.create22(),this.level="atom",this.kind=0}return e.prototype.has=function(e){return this.map.has(e)},e.prototype.get=function(e){return this.map.get(e)},e.prototype.getStructureElements=function(e){if(1!==e.models.length)throw new Error("Only works on structures with a single model.");for(var t=new Set,n=[],i=0,a=e.unitSymmetryGroups;i<a.length;i++){var o=a[i].units[0];if(o.kind===this.kind)for(var u=o.elements,s=0,c=u.length;s<c;s++){var l=u[s];this.has(l)&&!t.has(l)&&(t.add(u[s]),n[n.length]=r.StructureElement.create(o,l))}}return n.sort(function(e,t){return e.element-t.element}),n},e.prototype.getElements=function(e){var t=this,n=this.getStructureElements(e);return{elements:n,property:function(e){return t.get(n[e].element)}}},e}(),c=function(){function e(e){this.map=e,this.id=a.UUID.create22(),this.level="entity",this.kind=0}return e.prototype.has=function(e){return this.map.has(e)},e.prototype.get=function(e){return this.map.get(e)},e.prototype.getStructureElements=function(e){var t=e.models;if(1!==t.length)throw new Error("Only works on structures with a single model.");for(var n=t[0].atomicHierarchy.index,a=new Set,o=e.unitSymmetryGroups,u=[],s=t[0].atomicHierarchy.chainAtomSegments,c=0,l=o;c<l.length;c++){var f=l[c].units[0];if(f.kind===this.kind)for(var d=i.Segmentation.transientSegments(s,f.elements);d.hasNext;){var p=d.move(),h=n.getEntityFromChain(p.index);this.has(h)&&!a.has(h)&&(a.add(h),u[u.length]=r.StructureElement.create(f,f.elements[p.start]))}}return u.sort(function(e,t){return e.element-t.element}),u},e.prototype.getElements=function(e){var t=this,n=this.getStructureElements(e),r=e.model.atomicHierarchy.chainAtomSegments.index,i=e.model.atomicHierarchy.index;return{elements:n,property:function(e){return t.get(i.getEntityFromChain(r[n[e].element]))}}},e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(17),i=n(5);!function(e){var t=function(){function e(e,t,n,r,i){this.offset=e,this.a=t,this.b=n,this.edgeCount=r,this.vertexCount=e.length-1,this.edgeProps=i||{}}return e.prototype.getEdgeIndex=function(e,t){var n,r;e<t?(n=e,r=t):(n=t,r=e);for(var i=this.offset[n],a=this.offset[n+1];i<a;i++)if(this.b[i]===r)return i;return-1},e.prototype.getDirectedEdgeIndex=function(e,t){for(var n=this.offset[e],r=this.offset[e+1];n<r;n++)if(this.b[n]===t)return n;return-1},e.prototype.getVertexEdgeCount=function(e){return this.offset[e+1]-this.offset[e]},e}();function n(e,n,r,i,a){return new t(e,n,r,i,a)}e.create=n;var a=function(){function e(e,t,n){this.vertexCount=e,this.xs=t,this.ys=n,this.current=0,this.curA=0,this.curB=0,this.edgeCount=t.length,this.offsets=new Int32Array(this.vertexCount+1),this.bucketFill=new Int32Array(this.vertexCount);for(var r=new Int32Array(this.vertexCount),i=0,a=this.xs.length;i<a;i++)r[this.xs[i]]++;for(i=0,a=this.ys.length;i<a;i++)r[this.ys[i]]++;var o=0;for(i=0;i<this.vertexCount;i++)this.offsets[i]=o,o+=r[i];this.offsets[this.vertexCount]=o,this.slotCount=o,this.a=new Int32Array(o),this.b=new Int32Array(o)}return e.prototype.createGraph=function(e){return n(this.offsets,this.a,this.b,this.edgeCount,e)},e.prototype.addNextEdge=function(){var e=this.xs[this.current],t=this.ys[this.current],n=this.offsets[e]+this.bucketFill[e],r=this.offsets[t]+this.bucketFill[t];this.a[n]=e,this.b[n]=t,this.bucketFill[e]++,this.a[r]=t,this.b[r]=e,this.bucketFill[t]++,this.current++,this.curA=n,this.curB=r},e.prototype.addAllEdges=function(){for(var e=0;e<this.edgeCount;e++)this.addNextEdge()},e.prototype.assignProperty=function(e,t){e[this.curA]=t,e[this.curB]=t},e}();e.EdgeBuilder=a;var o=function(){function e(e,t,n){this.vertexCount=e,this.xs=t,this.ys=n,this.current=0,this.curA=0,this.edgeCount=t.length,this.offsets=new Int32Array(this.vertexCount+1),this.bucketFill=new Int32Array(this.vertexCount);for(var r=new Int32Array(this.vertexCount),i=0,a=this.xs.length;i<a;i++)r[this.xs[i]]++;var o=0;for(i=0;i<this.vertexCount;i++)this.offsets[i]=o,o+=r[i];this.offsets[this.vertexCount]=o,this.slotCount=o,this.a=new Int32Array(o),this.b=new Int32Array(o)}return e.prototype.createGraph=function(e){return n(this.offsets,this.a,this.b,this.edgeCount,e)},e.prototype.addNextEdge=function(){var e=this.xs[this.current],t=this.ys[this.current],n=this.offsets[e]+this.bucketFill[e];this.a[n]=e,this.b[n]=t,this.bucketFill[e]++,this.current++,this.curA=n},e.prototype.addAllEdges=function(){for(var e=0;e<this.edgeCount;e++)this.addNextEdge()},e.prototype.assignProperty=function(e,t){e[this.curA]=t},e}();e.DirectedEdgeBuilder=o;var u=function(){function e(e){this.vertexCount=e,this.xs=[],this.ys=[],this.included=new Set}return e.prototype.addEdge=function(e,t){var n=e,i=t;e>t&&(n=t,i=e);var a=r.cantorPairing(n,i);return!this.included.has(a)&&(this.included.add(a),this.xs[this.xs.length]=n,this.ys[this.ys.length]=i,!0)},e.prototype.getGraph=function(){return s(this.vertexCount,this.xs,this.ys)},e.prototype.getEdgeBuiler=function(){return new a(this.vertexCount,this.xs,this.ys)},e}();function s(t,n,r){var i=new e.EdgeBuilder(t,n,r);return i.addAllEdges(),i.createGraph()}e.UniqueEdgeBuilder=u,e.fromVertexPairs=s,e.induceByVertices=function(e,t){for(var i=e.b,a=e.offset,o=e.vertexCount,u=e.edgeProps,s=new Int32Array(o),c=0,l=t.length;c<l;c++)s[t[c]]=c+1;var f=0;for(c=0;c<o;c++)if(0!==s[c])for(var d=a[c],p=a[c+1];d<p;d++)i[d]>c&&0!==s[i[d]]&&f++;var h=new Int32Array(t.length+1),m=new Int32Array(2*f),y=new Int32Array(2*f),v=new Int32Array(2*f),b=0,g=0;for(c=0;c<o;c++)if(0!==s[c]){var _=s[c]-1;for(d=a[c],p=a[c+1];d<p;d++){var S=s[i[d]];0!==S&&(y[b]=_,v[b]=S-1,m[b]=d,b++)}h[++g]=b}for(var C={},x=0,w=Object.keys(u);x<w.length;x++){var P=w[x];C[P]=r.arrayPickIndices(u[P],m)}return n(h,y,v,f,C)},e.connectedComponents=function(e){var t=e.vertexCount;if(0===t)return{componentCount:0,componentIndex:new Int32Array(0)};if(0===e.edgeCount){for(var n=new Int32Array(t),r=0,a=t;r<a;r++)n[r]=r;return{componentCount:t,componentIndex:n}}var o=new Int32Array(t);for(r=0,a=t;r<a;r++)o[r]=-1;var u=0;o[0]=u;var s=e.offset,c=e.b,l=[0],f=i.LinkedIndex(t);for(f.remove(0);l.length>0;){for(var d=l.pop(),p=o[d],h=s[d],m=s[d+1];h<m;h++){var y=c[h];f.has(y)&&(f.remove(y),l.push(y),o[y]=p)}0===l.length&&f.head>=0&&(l.push(f.head),o[f.head]=++u,f.remove(f.head))}return{componentCount:t,componentIndex:o}},e.areVertexSetsConnected=function(e,t,n,r){if(i.SortedArray.areIntersecting(t,n))return!0;if(r<1)return!1;for(var a=new Set,o=0,u=t.length;o<u;++o)a.add(t[o]);return function e(t,n,r,a,o){for(var u=t.b,s=t.offset,c=[],l=0,f=n.length;l<f;++l)for(var d=n[l],p=s[d],h=s[d+1];p<h;++p){var m=u[p];if(!o.has(m)){if(i.SortedArray.has(r,m))return!0;o.add(m),c[c.length]=m}}return a>1&&e(t,c,r,a-1,o)}(e,t,n,r,a)}}(t.IntAdjacencyGraph||(t.IntAdjacencyGraph={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(118),i=n(239),a=n(5),o=n(191);function u(e,t){for(var n=e.model.atomicConformation,u=n.x,s=n.y,c=n.z,l=e.elements.length,f=e.elements,d=e.residueIndex,p=e.model.atomicHierarchy.atoms,h=p.type_symbol,m=p.label_atom_id,y=p.label_alt_id,v=e.model.atomicHierarchy.residues.label_comp_id,b=e.lookup3d,g="mmCIF"===e.model.sourceData.kind?o.StructConn.get(e.model):void 0,_="mmCIF"===e.model.sourceData.kind?o.ComponentBond.get(e.model):void 0,S=[],C=[],x=[],w=[],P=-1,T=void 0,A=0;A<l;A++){var E=f[A],k=d[E];if(!t.forceCompute&&k!==P){var I=v.value(k);T=_&&_.entries.has(I)?_.entries.get(I).map:void 0}P=k;var M=T?T.get(m.value(E)):void 0,V=i.getElementIdx(h.value(E)),O=b.find(u[E],s[E],c[E],4),D=O.indices,R=O.count,j=O.squaredDistances,N=i.isHydrogen(V),B=i.getElementThreshold(V),F=y.value(E),L=i.MetalsSet.has(V),z=t.forceCompute?void 0:g&&g.getAtomEntries(E);if(z)for(var U=0,G=z;U<G.length;U++){if(!((oe=G[U]).distance<4))for(var q=0,H=oe.partners;q<H.length;q++){var W=H[q];(K=a.SortedArray.indexOf(e.elements,W.atomIndex))<0||(S[S.length]=A,C[C.length]=K,x[x.length]=oe.flags,w[w.length]=oe.order)}}for(var Y=0;Y<R;Y++){var K,X=f[K=D[Y]];if(!(X<=E)){var Q=y.value(X);if(!F||!Q||F===Q){var Z=i.getElementIdx(h.value(X)),J=L||i.MetalsSet.has(Z);if(k===d[X]&&M){var $=M.get(m.value(X));if($){S[S.length]=A,C[C.length]=K,w[w.length]=$.order;var ee=$.flags;J&&(1|ee&&(ee^=1),ee|=2),x[x.length]=ee}}else{var te=i.isHydrogen(Z);if(!N||!te){var ne=Math.sqrt(j[Y]);if(0!==ne){if(z&&z.length){for(var re=!1,ie=0,ae=z;ie<ae.length;ie++){for(var oe,ue=0,se=(oe=ae[ie]).partners;ue<se.length;ue++){if((W=se[ue]).atomIndex===X){S[S.length]=A,C[C.length]=K,x[x.length]=oe.flags,w[w.length]=oe.order,re=!0;break}}if(re)break}if(re)continue}if(N||te)ne<t.maxHbondLength&&(S[S.length]=A,C[C.length]=K,w[w.length]=1,x[x.length]=65);else{var ce=i.getElementPairThreshold(V,Z);ne<=(ce>0?ce:Z<0?B:Math.max(B,i.getElementThreshold(Z)))&&(S[S.length]=A,C[C.length]=K,w[w.length]=1,x[x.length]=64|(J?2:1))}}}}}}}}return function(e,t,n,i,a){for(var o=new r.IntAdjacencyGraph.EdgeBuilder(a,e,t),u=new Uint16Array(o.slotCount),s=new Int8Array(o.slotCount),c=0,l=o.edgeCount;c<l;c++)o.addNextEdge(),o.assignProperty(u,i[c]),o.assignProperty(s,n[c]);return o.createGraph({flags:u,order:s})}(S,C,w,x,l)}t.computeIntraUnitBonds=function(e,t){return u(e,{maxHbondLength:t&&t.maxHbondLength||1.15,forceCompute:!(!t||!t.forceCompute)})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(9),i=n(5),a=n(44);!function(e){e.Descriptor={isStatic:!0,name:"chem_comp_bond",cifExport:{prefix:"",categories:[{name:"chem_comp_bond",instance:function(e){var t=u(e.structures[0].model);if(!t)return a.CifWriter.Category.Empty;for(var n=function(e){for(var t=r.StructureProperties.residue.label_comp_id,n=new Set,a=r.StructureElement.create(),o=0,u=e.units;o<u.length;o++){var s=u[o];if(r.Unit.isAtomic(s)){var c=i.Segmentation.transientSegments(s.model.atomicHierarchy.residueAtomSegments,s.elements);for(a.unit=s;c.hasNext;){var l=c.move();a.element=s.elements[l.start],n.add(t(a))}}}return n}(e.structures[0]),o=t.comp_id,s=t._rowCount,c=[],l=0;l<s;l++)n.has(o.value(l))&&(c[c.length]=l);return a.CifWriter.Category.ofTable(t,c)}}]}},e.attachFromMmCif=function(t){if(t.customProperties.has(e.Descriptor))return!0;if("mmCIF"!==t.sourceData.kind)return!1;var n=t.sourceData.data.chem_comp_bond;return 0!==n._rowCount&&(t.customProperties.add(e.Descriptor),t._staticPropertyData.__ComponentBondData__=n,!0)},e.attachFromExternalData=function(t,n,r){return void 0===r&&(r=!1),!(r||!t.customProperties.has(e.Descriptor))||(t._staticPropertyData.__ComponentBondData__&&delete t._staticPropertyData.__ComponentBondData__,t.customProperties.add(e.Descriptor),t._staticPropertyData[e.PropName]=n,!0)};var t=function(){function e(){this.entries=new Map}return e.prototype.addEntry=function(e){var t=new n(e);return this.entries.set(e,t),t},e}();e.ComponentBondImpl=t;var n=function(){function e(e){this.id=e,this.map=new Map}return e.prototype.add=function(e,t,n,r,i){void 0===i&&(i=!0);var a=this.map.get(e);if(void 0!==a){void 0===a.get(t)&&a.set(t,{order:n,flags:r})}else{var o=new Map;o.set(t,{order:n,flags:r}),this.map.set(e,o)}i&&this.add(t,e,n,r,!1)},e}();function o(e){for(var n=e.comp_id,r=e.atom_id_1,i=e.atom_id_2,a=e.value_order,o=e.pdbx_aromatic_flag,u=e._rowCount,s=new t,c=s.addEntry(n.value(0)),l=0;l<u;l++){var f=n.value(l),d=r.value(l),p=i.value(l),h=a.value(l),m="Y"===o.value(l);c.id!==f&&(c=s.addEntry(f));var y=1,v=1;switch(m&&(y|=32),h.toLowerCase()){case"doub":case"delo":v=2;break;case"trip":v=3;break;case"quad":v=4}c.add(d,p,v,y)}return s}function u(e){return e._staticPropertyData.__ComponentBondData__}e.Entry=n,e.parseChemCompBond=o,e.PropName="__ComponentBond__",e.get=function(t){if(t._staticPropertyData[e.PropName])return t._staticPropertyData[e.PropName];if(t.customProperties.has(e.Descriptor)){var n=u(t);if(n){var r=o(n);return t._staticPropertyData[e.PropName]=r,r}}}}(t.ComponentBond||(t.ComponentBond={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(221),i=n(137),a=n(242),o=function(){function e(){this.builder=r.default.create(),this.encoded=!1,this.dataBlockCreated=!1,this.filter=i.Category.DefaultFilter,this.formatter=i.Category.DefaultFormatter}return e.prototype.setFilter=function(e){this.filter=e||i.Category.DefaultFilter},e.prototype.setFormatter=function(e){this.formatter=e||i.Category.DefaultFormatter},e.prototype.startDataBlock=function(e){this.dataBlockCreated=!0,r.default.write(this.builder,"data_"+(e||"").replace(/[ \n\t]/g,"").toUpperCase()+"\n#\n")},e.prototype.writeCategory=function(e,t){if(this.encoded)throw new Error("The writer contents have already been encoded, no more writing.");if(!this.dataBlockCreated)throw new Error("No data block created.");if(this.filter.includeCategory(e.name)){var n=a.getCategoryInstanceData(e,t),o=n.instance,l=n.rowCount,f=n.source;l&&(1===l?function(e,t,n,i,o,c){var l=a.getIncludedFields(t),f=n[0],d=f.data,p=l.reduce(function(t,n){return o.includeField(e.name,n.name)?Math.max(t,n.name.length):0},0);if(0===p)return;p+=e.name.length+6;for(var h=f.keys().move(),m=s(e.name,t.fields,c),y=0;y<l.length;y++){var v=l[y];if(o.includeField(e.name,v.name)){r.default.writePadRight(i,"_"+e.name+"."+v.name,p);var b=u(i,d,h,v,m[y],0);b||r.default.newline(i)}}r.default.write(i,"#\n")}(e,o,f,this.builder,this.filter,this.formatter):function(e,t,n,o,l,f){var d=a.getIncludedFields(t),p=l===i.Category.DefaultFilter?d:d.filter(function(t){return l.includeField(e.name,t.name)}),h=p.length;if(0===h)return;var m=s(e.name,p,f);c(o,"loop_");for(var y=0;y<h;y++)c(o,"_"+e.name+"."+p[y].name);for(var v=0,b=0;b<n.length;b++){var g=n[b],_=g.data;if(0!==g.rowCount)for(var S=g.keys();S.hasNext;){for(var C=S.move(),x=!1,w=0;w<h;w++)x=u(o,_,C,p[w],m[w],v);x||r.default.newline(o),v++}}r.default.write(o,"#\n")}(e,o,f,this.builder,this.filter,this.formatter))}},e.prototype.encode=function(){this.encoded=!0},e.prototype.writeTo=function(e){for(var t=r.default.getChunks(this.builder),n=0,i=t.length;n<i;n++)e.writeString(t[n])},e.prototype.getData=function(){return r.default.getString(this.builder)},e}();function u(e,t,n,i,a,o){var u,s=i.valueKind,c=s?s(n,t):0;if(0!==c)1===c?function(e){r.default.writeSafe(e,". ")}(e):function(e){r.default.writeSafe(e,"? ")}(e);else{var f=i.value(n,t,o),d=i.type;if(0===d)return"string"==typeof(u=f)&&u.indexOf("\n")>=0?(l(e,f),!0):function(e,t){if(!t)return r.default.writeSafe(e,". "),!1;for(var n=95===t.charCodeAt(0),i="'",a="' ",o=!1,u=!1,s=!1,c=0,f=t.length-1;c<f;c++){var d=t.charCodeAt(c);switch(d){case 9:o=!0;break;case 10:return l(e,t),!0;case 32:o=!0;break;case 34:if(u)return l(e,t),!0;s=!0,n=!0,i="'",a="' ";break;case 39:if(s)return l(e,t),!0;n=!0,u=!0,i='"',a='" '}}var p=t.charCodeAt(0);n||35!==p&&36!==p&&59!==p&&91!==p&&93!==p&&!o||(i="'",a="' ",n=!0);n?(r.default.writeSafe(e,i),r.default.writeSafe(e,t),r.default.writeSafe(e,a)):(r.default.writeSafe(e,t),r.default.writeSafe(e," "));return!1}(e,f);1===d?function(e,t){r.default.writeInteger(e,t),r.default.whitespace1(e)}(e,f):function(e,t,n){r.default.writeFloat(e,t,n),r.default.whitespace1(e)}(e,f,a)}return!1}function s(e,t,n){for(var r=[],i=0,o=t;i<o.length;i++){var u=o[i],s=n.getFormat(e,u.name);s&&void 0!==s.digitCount?r[r.length]=2===u.type?Math.pow(10,Math.max(0,Math.min(s.digitCount,15))):0:r[r.length]=2===u.type?Math.pow(10,a.getFieldDigitCount(u)):0}return r}function c(e,t){r.default.write(e,t),r.default.newline(e)}function l(e,t){r.default.writeSafe(e,"\n;"+t),r.default.writeSafe(e,"\n;\n")}t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(367);function i(e){for(var t=e.data,n=e.encoding.length-1;n>=0;n--)t=a(t,e.encoding[n]);return t}function a(e,t){switch(t.kind){case"ByteArray":switch(t.type){case 4:return e;case 1:return function(e){return new Int8Array(e.buffer,e.byteOffset)}(e);case 2:return function(e){return s(e,2,Int16Array)}(e);case 5:return function(e){return s(e,2,Uint16Array)}(e);case 3:return function(e){return s(e,4,Int32Array)}(e);case 6:return function(e){return s(e,4,Uint32Array)}(e);case 32:return function(e){return s(e,4,Float32Array)}(e);case 33:return function(e){return s(e,8,Float64Array)}(e);default:throw new Error("Unsupported ByteArray type.")}case"FixedPoint":return function(e,t){for(var n=e.length,r=u(t.srcType,n),i=1/t.factor,a=0;a<n;a++)r[a]=i*e[a];return r}(e,t);case"IntervalQuantization":return function(e,t){for(var n=e.length,r=u(t.srcType,n),i=(t.max-t.min)/(t.numSteps-1),a=t.min,o=0;o<n;o++)r[o]=a+i*e[o];return r}(e,t);case"RunLength":return function(e,t){for(var n=o(t.srcType,t.srcSize),r=0,i=0,a=e.length;i<a;i+=2)for(var u=e[i],s=e[i+1],c=0;c<s;++c)n[r++]=u;return n}(e,t);case"Delta":return function(e,t){var n=e.length,r=o(t.srcType,n);if(!n)return e;r[0]=e[0]+(0|t.origin);for(var i=1;i<n;++i)r[i]=e[i]+r[i-1];return r}(e,t);case"IntegerPacking":return function(e,t){return e.length===t.srcSize?e:t.isUnsigned?function(e,t){for(var n=1===t.byteCount?255:65535,r=e.length,i=new Int32Array(t.srcSize),a=0,o=0;a<r;){for(var u=0,s=e[a];s===n;)u+=s,s=e[++a];u+=s,i[o]=u,a++,o++}return i}(e,t):function(e,t){for(var n=1===t.byteCount?127:32767,r=-n-1,i=e.length,a=new Int32Array(t.srcSize),o=0,u=0;o<i;){for(var s=0,c=e[o];c===n||c===r;)s+=c,c=e[++o];s+=c,a[u]=s,o++,u++}return a}(e,t)}(e,t);case"StringArray":return function(e,t){var n=i({encoding:t.offsetEncoding,data:t.offsets}),r=i({encoding:t.dataEncoding,data:e}),a=t.stringData,o=new Array(n.length);o[0]="";for(var u=1,s=n.length;u<s;u++)o[u]=a.substring(n[u-1],n[u]);for(var c=0,l=new Array(r.length),u=0,s=r.length;u<s;u++)l[c++]=o[r[u]+1];return l}(e,t)}}function o(e,t){switch(e){case 1:return new Int8Array(t);case 2:return new Int16Array(t);case 3:return new Int32Array(t);case 4:return new Uint8Array(t);case 5:return new Uint16Array(t);case 6:return new Uint32Array(t);default:throw new Error("Unsupported integer data type.")}}function u(e,t){switch(e){case 32:return new Float32Array(t);case 33:return new Float64Array(t);default:throw new Error("Unsupported floating data type.")}}function s(e,t,n){return r.IsNativeEndianLittle?new n(e.buffer):new n(r.flipByteOrder(e,t))}t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IsNativeEndianLittle=13330===new Uint16Array(new Uint8Array([18,52]).buffer)[0],t.flipByteOrder=function(e,t){for(var n=new ArrayBuffer(e.length),r=new Uint8Array(n),i=0,a=e.length;i<a;i+=t)for(var o=0;o<t;o++)r[i+t-o-1]=e[i+o];return n}},function(e,t,n){"use strict";function r(e,t,n){var r,i=1;for(r=0;r<t;r++){var a=i*e;if(Math.abs(Math.round(a)-a)<=n)return r;i*=10}return-1}Object.defineProperty(t,"__esModule",{value:!0}),t.getMantissaMultiplier=r,t.integerDigitCount=function(e,t){return Math.abs(e)<t?0:Math.floor(Math.log10(Math.abs(e)))+1},t.getArrayDigitCount=function(e,t,n){for(var i=1,a=0,o=0,u=e.length;o<u;o++){if(i>=0){var s=r(e[o],t,n);s<0?i=-1:s>i&&(i=s)}var c=Math.abs(e[o]);if(c>n){var l=Math.floor(Math.log10(Math.abs(c)))+1;l>a&&(a=l)}}return{mantissaDigits:i,integerDigits:a}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(21);t.DB=r;var i=n(5);t.Int=i;var a=n(189);t.Iterator=a.default;var o=n(17);t.Util=o;var u=n(45);t.Generic=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){this.getHash=e,this.areEqual=t,this.size=0,this.byHash=new Map}return e.prototype.add=function(e){var t=this.getHash(e);if(this.byHash.has(t)){for(var n=this.byHash.get(t),r=0,i=n.length;r<i;r++)if(this.areEqual(e,n[r]))return!1;return n[n.length]=e,this.size++,!0}return this.byHash.set(t,[e]),this.size++,!0},e.prototype.has=function(e){var t=this.getHash(e);if(!this.byHash.has(t))return!1;for(var n=this.byHash.get(t),r=0,i=n.length;r<i;r++)if(this.areEqual(e,n[r]))return!0;return!1},e}();t.HashSet=function(e,t){return new r(e,t)}},function(e,t,n){"use strict";function r(e){return{previous:null,next:null,inList:!0,value:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.LinkedList=function(){return new i};var i=function(){function e(){this.count=0,this.first=null,this.last=null}return e.prototype.addFirst=function(e){var t=r(e);return t.inList=!0,this.first&&(this.first.previous=t),t.next=this.first,this.first=t,this.count++,this.last||(this.last=t),t},e.prototype.addLast=function(e){var t=r(e);return null!==this.last&&(this.last.next=t),t.previous=this.last,this.last=t,null===this.first&&(this.first=t),t.inList=!0,this.count++,t},e.prototype.removeFirst=function(){var e=this.first;if(e)return this.remove(e),e.value},e.prototype.removeLast=function(){var e=this.last;if(e)return this.remove(e),e.value},e.prototype.remove=function(e){e.inList&&(e.inList=!1,null!==e.previous?e.previous.next=e.next:null===e.previous&&(this.first=e.next),null!==e.next?e.next.previous=e.previous:null===e.next&&(this.last=e.previous),e.next=null,e.previous=null,this.count--)},e.prototype.find=function(e){for(var t=this.first;null!==t;){if(t.value===e)return t;t=t.next}},e}()},function(e,t,n){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.create=function(){return{keys:new Set,array:[]}},e.add=function(e,t,n){var r=e.keys,i=e.array;return!r.has(t)&&(r.add(t),i[i.length]=n,!0)}}(r||(r={})),t.UniqueArray=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(374),i=n(138),a=n(137),o=n(242),u=n(192),s=function(){function e(e,t,n){this.encodingProvider=t,this.autoClassify=n,this.dataBlocks=[],this.filter=a.Category.DefaultFilter,this.formatter=a.Category.DefaultFormatter,this.data={encoder:e,version:i.VERSION,dataBlocks:this.dataBlocks}}return e.prototype.setFilter=function(e){this.filter=e||a.Category.DefaultFilter},e.prototype.setFormatter=function(e){this.formatter=e||a.Category.DefaultFormatter},e.prototype.startDataBlock=function(e){this.dataBlocks.push({header:(e||"").replace(/[ \n\t]/g,"").toUpperCase(),categories:[]})},e.prototype.writeCategory=function(e,t){if(!this.data)throw new Error("The writer contents have already been encoded, no more writing.");if(!this.dataBlocks.length)throw new Error("No data block created.");if(this.filter.includeCategory(e.name)){var n=o.getCategoryInstanceData(e,t),r=n.instance,i=n.rowCount,a=n.source;if(i){for(var u={name:"_"+e.name,columns:[],rowCount:i},s=0,l=o.getIncludedFields(r);s<l.length;s++){var f=l[s];if(this.filter.includeField(e.name,f.name)){var d=this.formatter.getFormat(e.name,f.name);u.columns.push(c(e.name,f,a,i,d,this.encodingProvider,this.autoClassify))}}u.columns.length&&this.dataBlocks[this.dataBlocks.length-1].categories.push(u)}}},e.prototype.encode=function(){this.encodedData||(this.encodedData=r.default(this.data),this.data=null,this.dataBlocks=null)},e.prototype.writeTo=function(e){e.writeBinary(this.encodedData)},e.prototype.getData=function(){return this.encode(),this.encodedData},e}();function c(e,t,n,r,a,o,s){var c=function(e,t,n,r){for(var i=0===e.type,a=new t(n),o=new Uint8Array(n),u=e.valueKind,s=e.value,c=!0,l=0,f=0;f<r.length;f++)for(var d=r[f].data,p=r[f].keys();p.hasNext;){var h=p.move(),m=u?u(h,d):0;0!==m?(o[l]=m,i&&(a[l]=""),c=!1):(o[l]=0,a[l]=s(h,d,l)),l++}return{array:a,allPresent:c,mask:o}}(t,function(e,t){return t&&t.typedArray?t.typedArray:e.defaultFormat&&e.defaultFormat.typedArray?e.defaultFormat.typedArray:0===e.type?Array:1===e.type?Int32Array:Float64Array}(t,a),r,n),l=c.array,f=c.allPresent,d=c.mask,p=function(e,t,n,r){return n&&n.encoder?n.encoder:t.defaultFormat&&t.defaultFormat.encoder?t.defaultFormat.encoder:r?r.get(e,t.name):void 0}(e,t,a,o);p||(s?p=function(e,t){return 0===e?i.ArrayEncoder.by(i.ArrayEncoding.stringArray):1===e?u.classifyIntArray(t):u.classifyFloatArray(t)}(t.type,l):p=0===t.type?i.ArrayEncoder.by(i.ArrayEncoding.stringArray):i.ArrayEncoder.by(i.ArrayEncoding.byteArray));var h=p.encode(l),m=void 0;if(!f){var y=i.ArrayEncoder.by(i.ArrayEncoding.runLength).and(i.ArrayEncoding.byteArray).encode(d);m=y.data.length<d.length?y:i.ArrayEncoder.by(i.ArrayEncoding.byteArray).encode(d)}return{name:t.name,data:h,mask:m}}t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(193);t.default=function(e){var t=new ArrayBuffer(function e(t){var n=typeof t;if("string"===n){var i=r.utf8ByteCount(t);if(i<32)return 1+i;if(i<256)return 2+i;if(i<65536)return 3+i;if(i<4294967296)return 5+i}if(t instanceof Uint8Array){var a=t.byteLength;if(a<256)return 2+a;if(a<65536)return 3+a;if(a<4294967296)return 5+a}if("number"===n){if(Math.floor(t)!==t)return 9;if(t>=0){if(t<128)return 1;if(t<256)return 2;if(t<65536)return 3;if(t<4294967296)return 5;throw new Error("Number too big 0x"+t.toString(16))}if(t>=-32)return 1;if(t>=-128)return 2;if(t>=-32768)return 3;if(t>=-2147483648)return 5;throw new Error("Number too small -0x"+t.toString(16).substr(1))}if("boolean"===n||null==t)return 1;if("object"===n){var o,u=0;if(Array.isArray(t)){o=t.length;for(var s=0;s<o;s++)u+=e(t[s])}else{var c=Object.keys(t);o=c.length;for(var s=0;s<o;s++){var l=c[s];u+=e(l)+e(t[l])}}if(o<16)return 1+u;if(o<65536)return 3+u;if(o<4294967296)return 5+u;throw new Error("Array or object too long 0x"+o.toString(16))}throw new Error("Unknown type "+n)}(e)),n=new DataView(t),i=new Uint8Array(t);return function e(t,n,i,a){var o=typeof t;if("string"===o){var u=r.utf8ByteCount(t);if(u<32)return n.setUint8(a,160|u),r.utf8Write(i,a+1,t),1+u;if(u<256)return n.setUint8(a,217),n.setUint8(a+1,u),r.utf8Write(i,a+2,t),2+u;if(u<65536)return n.setUint8(a,218),n.setUint16(a+1,u),r.utf8Write(i,a+3,t),3+u;if(u<4294967296)return n.setUint8(a,219),n.setUint32(a+1,u),r.utf8Write(i,a+5,t),5+u}if(t instanceof Uint8Array){var s=t.byteLength,c=new Uint8Array(n.buffer);if(s<256)return n.setUint8(a,196),n.setUint8(a+1,s),c.set(t,a+2),2+s;if(s<65536)return n.setUint8(a,197),n.setUint16(a+1,s),c.set(t,a+3),3+s;if(s<4294967296)return n.setUint8(a,198),n.setUint32(a+1,s),c.set(t,a+5),5+s}if("number"===o){if(!isFinite(t))throw new Error("Number not finite: "+t);if(Math.floor(t)!==t)return n.setUint8(a,203),n.setFloat64(a+1,t),9;if(t>=0){if(t<128)return n.setUint8(a,t),1;if(t<256)return n.setUint8(a,204),n.setUint8(a+1,t),2;if(t<65536)return n.setUint8(a,205),n.setUint16(a+1,t),3;if(t<4294967296)return n.setUint8(a,206),n.setUint32(a+1,t),5;throw new Error("Number too big 0x"+t.toString(16))}if(t>=-32)return n.setInt8(a,t),1;if(t>=-128)return n.setUint8(a,208),n.setInt8(a+1,t),2;if(t>=-32768)return n.setUint8(a,209),n.setInt16(a+1,t),3;if(t>=-2147483648)return n.setUint8(a,210),n.setInt32(a+1,t),5;throw new Error("Number too small -0x"+(-t).toString(16).substr(1))}if(null==t)return n.setUint8(a,192),1;if("boolean"===o)return n.setUint8(a,t?195:194),1;if("object"===o){var l,f=0,d=Array.isArray(t),p=void 0;if(d?l=t.length:(p=Object.keys(t),l=p.length),l<16?(n.setUint8(a,l|(d?144:128)),f=1):l<65536?(n.setUint8(a,d?220:222),n.setUint16(a+1,l),f=3):l<4294967296&&(n.setUint8(a,d?221:223),n.setUint32(a+1,l),f=5),d)for(var h=0;h<l;h++)f+=e(t[h],n,i,a+f);else for(var h=0,m=p.length;h<m;h++){var y=p[h];f+=e(y,n,i,a+f),f+=e(t[y],n,i,a+f)}return f}throw new Error("Unknown type "+o)}(e,n,i,0),i}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(78),i=n(239),a=n(238),o=n(45),u=n(5),s=n(2),c=n(191),l=4;function f(e,t,n){e.has(t)?e.get(t).push(n):e.set(t,[n])}function d(e,t,n,r,i){f(i.mapAB,e,{indexB:t,order:n,flag:r}),f(i.mapBA,t,{indexB:e,order:n,flag:r}),o.UniqueArray.add(i.bondedA,e,e),o.UniqueArray.add(i.bondedB,t,t)}var p=s.Mat4.zero();function h(e,t,n,r){for(var h={mapAB:new Map,mapBA:new Map,bondedA:o.UniqueArray.create(),bondedB:o.UniqueArray.create()},m=0,y=e.elements,v=e.model.atomicConformation,b=v.x,g=v.y,_=v.z,S=t.elements,C=e.elements.length,x=e.model.atomicHierarchy.atoms,w=x.type_symbol,P=x.label_alt_id,T=t.model.atomicHierarchy.atoms,A=T.type_symbol,E=T.label_alt_id,k=t.lookup3d,I=e.model===t.model&&"mmCIF"===e.model.sourceData.kind?c.StructConn.get(e.model):void 0,M=s.Mat4.mul(p,t.conformation.operator.inverse,e.conformation.operator.matrix),V=!s.Mat4.isIdentity(M),O=s.Vec3.zero(),D=k.boundary.sphere,R=D.center,j=D.radius,N=(j+l)*(j+l),B=0;B<C;B++){var F=y[B];if(s.Vec3.set(O,b[F],g[F],_[F]),V&&s.Vec3.transformMat4(O,O,M),!(s.Vec3.squaredDistance(O,R)>N)){var L=n.forceCompute?void 0:I&&I.getAtomEntries(F);if(L&&L.length)for(var z=0,U=L;z<U.length;z++){if(!((de=U[z]).distance<l))for(var G=0,q=de.partners;G<q.length;G++){var H=q[G];(ne=u.SortedArray.indexOf(t.elements,H.atomIndex))<0||(d(B,ne,de.order,de.flags,h),m++)}}var W=k.find(O[0],O[1],O[2],l),Y=W.indices,K=W.count,X=W.squaredDistances;if(0!==K)for(var Q=i.getElementIdx(w.value(F)),Z=i.isHydrogen(Q),J=i.getElementThreshold(Q),$=P.value(F),ee=i.MetalsSet.has(Q),te=0;te<K;te++){var ne,re=S[ne=Y[te]],ie=E.value(re);if(!$||!ie||$===ie){var ae=i.getElementIdx(A.value(re)),oe=ee||i.MetalsSet.has(ae),ue=i.isHydrogen(ae);if(!Z||!ue){var se=Math.sqrt(X[te]);if(0!==se){if(L&&L.length){for(var ce=!1,le=0,fe=L;le<fe.length;le++){for(var de,pe=0,he=(de=fe[le]).partners;pe<he.length;pe++){if((H=he[pe]).atomIndex===re){d(B,ne,de.order,de.flags,h),m++,ce=!0;break}}if(ce)break}if(ce)continue}if(Z||ue)se<n.maxHbondLength&&(d(B,ne,1,65,h),m++);else{var me=i.getElementPairThreshold(Q,ae);se<=(me>0?me:ae<0?J:Math.max(J,i.getElementThreshold(ae)))&&(d(B,ne,1,64|(oe?2:1),h),m++)}}}}}}}return m&&(f(r,e.id,new a.InterUnitBonds.UnitPairBonds(e,t,m,h.bondedA.array,h.mapAB)),f(r,t.id,new a.InterUnitBonds.UnitPairBonds(t,e,m,h.bondedB.array,h.mapBA))),m}t.computeInterUnitBonds=function(e,t){return function(e,t){var n=new Map;if(!e.units.some(function(e){return r.default.isAtomic(e)}))return new a.InterUnitBonds(n);for(var i=e.lookup3d,o=s.Vec3.zero(),u=0,c=e.units;u<c.length;u++){var f=c[u];if(r.default.isAtomic(f)){var d=f.lookup3d.boundary.sphere;s.Vec3.transformMat4(o,d.center,f.conformation.operator.matrix);for(var p=i.findUnitIndices(o[0],o[1],o[2],d.radius+l),m=0;m<p.count;m++){var y=e.units[p.indices[m]];!r.default.isAtomic(y)||f.id>=y.id||(y.elements.length>=f.elements.length?h(f,y,t,n):h(y,f,t,n))}}}return new a.InterUnitBonds(n)}(e,{maxHbondLength:t&&t.maxHbondLength||1.15,forceCompute:!(!t||!t.forceCompute)})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(5),i=n(118),a=n(23),o=n(17);function u(e,t,n){var r=e.visited;if(e.startVertex=t,e.endVertex=n,!(e.endVertex-e.startVertex<3)){!function(e){e.count=e.endVertex-e.startVertex;for(var t=e.visited,n=e.pred,r=e.color,i=0;i<e.count;i++)t[i]=-1,n[i]=-1,r[i]=0;e.currentColor=0}(e);for(var i=0;i<e.count;i++)r[i]>=0||c(e,i)}}function s(e,t,n){if(!(n<t)){for(var i=e.pred,a=e.color,u=e.left,s=e.right,c=++e.currentColor,l=t,f=0;f<4&&(a[l]=c,!((l=i[l])<0));f++);var d=0,p=0,h=!1,m=0;l=n;for(f=0;f<4;f++){if(a[l]===c){m=l,h=!0;break}if(s[p++]=l,(l=i[l])<0)break}if(h){l=t;for(f=0;f<4&&(u[d++]=l,m!==l)&&!((l=i[l])<0);f++);var y=new Int32Array(d+p),v=0;for(f=0;f<d;f++)y[v++]=e.startVertex+u[f];for(f=p-1;f>=0;f--)y[v++]=e.startVertex+s[f];o.sortArray(y),e.rings.push(r.SortedArray.ofSortedArray(y))}}}function c(e,t){var n=e.bonds,r=e.startVertex,i=e.endVertex,o=e.visited,u=e.queue,c=e.pred,l=n.b,f=n.edgeProps.flags,d=n.offset;o[t]=1,u[0]=t;for(var p=0,h=1;p<h;)for(var m=u[p++],y=r+m,v=d[y],b=d[y+1],g=v;g<b;g++){var _=l[g];if(!(_<r||_>=i)&&a.LinkType.isCovalent(f[g])){var S=_-r;o[S]>0?c[S]!==m&&c[m]!==S&&s(e,m,S):(o[S]=1,u[h++]=S,c[S]=m)}}}function l(e){for(var t=e.length,n=new Int32Array(2*t),r=0;r<n.length;r++)n[r]=-1;for(var i="",a="",o=0,u=1;u<n.length;u++){for(r=n[u-o-1];-1!==r&&(i=e[u%t])!==(a=e[(o+r+1)%t]);)i<a&&(o=u-r-1),r=n[r];-1===r&&(i=e[u%t])!==(a=e[(o+r+1)%t])?(i<a&&(o=u),n[u-o]=-1):n[u-o]=r+1}return o}function f(e,t){var n,r=e.length,i=[];for(n=0;n<r-1;n++)i.push(e[(n+t)%r]),i.push("-");return i.push(e[(n+t)%r]),i.join("")}t.computeRings=function(e){for(var t=function(e,t){return{startVertex:0,endVertex:0,count:0,visited:new Int32Array(t),queue:new Int32Array(t),pred:new Int32Array(t),left:new Int32Array(4),right:new Int32Array(4),color:new Int32Array(t),currentColor:0,rings:[],unit:e,bonds:e.links}}(e,function(e){for(var t=r.Segmentation.transientSegments(e.model.atomicHierarchy.residueAtomSegments,e.elements),n=0;t.hasNext;){var i=t.move();n=Math.max(n,i.end-i.start)}return n}(e)),n=r.Segmentation.transientSegments(e.model.atomicHierarchy.residueAtomSegments,e.elements);n.hasNext;){var i=n.move();u(t,i.start,i.end)}return t.rings},t.getFingerprint=function(e){for(var t=e.length,n=new Array(t),r=0;r<t;r++)n[r]=e[t-r-1];var i=l(e),a=l(n),o=!1;for(r=0;r<t;r++){var u=e[(r+i)%t],s=n[(r+a)%t];if(u!==s){o=u<s;break}}return o?f(e,i):f(n,a)},t.createIndex=function(e){for(var t=new Map,n=0,r=e.length;n<r;n++)for(var a=0,o=(c=e[n]).length;a<o;a++){var u=c[a];t.has(u)?t.get(u).push(n):t.set(u,[n])}var s=new i.IntAdjacencyGraph.UniqueEdgeBuilder(e.length);for(n=0,r=e.length;n<r;n++){var c;for(a=0,o=(c=e[n]).length;a<o;a++){u=c[a];var l=t.get(u);if(1!==l.length)for(var f=0,d=l.length;f<d;f++){var p=l[f];n>=p||s.addEdge(n,p)}}}var h=i.IntAdjacencyGraph.connectedComponents(s.getGraph()),m=h.componentIndex,y=[];for(a=0;a<h.componentCount;a++)y[a]=[];for(n=0,r=e.length;n<r;n++)y[m[n]].push(n);return{elementRingIndices:t,ringComponentIndex:m,ringComponents:y}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(9),i=n(5),a=n(91);t.getAtomicPolymerElements=function(e){for(var t=[],n=e.elements,r=e.model,o=e.model.atomicHierarchy.residueAtomSegments,u=r.atomicHierarchy.derived.residue.traceElementIndex,s=a.default.transientSegments(e.model.atomicHierarchy.polymerRanges,n),c=i.Segmentation.transientSegments(o,n);s.hasNext;){var l=s.move();for(c.setSegment(l);c.hasNext;){var f=c.move(),d=f.start,p=f.end,h=f.index;if(i.OrderedSet.areIntersecting(i.Interval.ofRange(n[d],n[p-1]),n)){var m=u[h];t.push(-1===m?o.offsets[h]:m)}}}return i.SortedArray.ofSortedArray(t)},t.getCoarsePolymerElements=function(e){for(var t=[],n=e.elements,o=e.model.coarseHierarchy,u=o.spheres,s=o.gaussians,c=r.Unit.isSpheres(e)?u.polymerRanges:s.polymerRanges,l=a.default.transientSegments(c,n);l.hasNext;)for(var f=l.move(),d=f.start,p=f.end,h=d;h<p;++h)t.push(n[h]);return i.SortedArray.ofSortedArray(t)},t.getAtomicGapElements=function(e){for(var t=[],n=e.elements,r=e.model,o=e.residueIndex,u=e.model.atomicHierarchy.residueAtomSegments,s=r.atomicHierarchy.derived.residue.traceElementIndex,c=a.default.transientSegments(e.model.atomicHierarchy.gapRanges,e.elements);c.hasNext;){var l=c.move(),f=o[n[l.start]],d=o[n[l.end-1]],p=s[f],h=s[d];t.push(-1===p?u.offsets[f]:p),t.push(-1===h?u.offsets[d]:h)}return i.SortedArray.ofSortedArray(t)},t.getCoarseGapElements=function(e){for(var t=[],n=e.elements,o=e.model.coarseHierarchy,u=o.spheres,s=o.gaussians,c=r.Unit.isSpheres(e)?u.gapRanges:s.gapRanges,l=a.default.transientSegments(c,n);l.hasNext;){var f=l.move(),d=f.start,p=f.end;t.push(n[d],n[p-1])}return i.SortedArray.ofSortedArray(t)}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{s(r.next(e))}catch(e){a(e)}}function u(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,u)}s((r=r.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}};Object.defineProperty(t,"__esModule",{value:!0});var a=n(19),o=n(2),u=n(5),s=n(196);t.GaussianDensityCPU=function(e,t,n,c,l){return r(this,void 0,void 0,function(){var r,f,d,p,h,m,y,v,b,g,_,S,C,x,w,P,T,A,E,k,I,M,V,O,D,R,j,N,B,F,L,z,U,G,q,H,W,Y,K,X,Q,Z,J,$,ee,te,ne,re,ie,ae,oe,ue,se;return i(this,function(i){switch(i.label){case 0:r=l.resolution,f=l.radiusOffset,d=l.smoothness,p=t.indices,h=t.x,m=t.y,y=t.z,v=u.OrderedSet.size(p),b=o.Vec3.zero(),g=o.Vec3.zero(),_=0,U=0,i.label=1;case 1:return U<v?(S=c(u.OrderedSet.getAt(p,U))+f,_<S&&(_=S),U%1e4==0&&e.shouldUpdate?[4,e.update({message:"calculating max radius",current:U,max:v})]:[3,3]):[3,4];case 2:i.sent(),i.label=3;case 3:return++U,[3,1];case 4:C=2*_+r,x=a.Box3D.expand(a.Box3D.empty(),n,o.Vec3.create(C,C,C)),w=o.Vec3.sub(o.Vec3.zero(),x.max,x.min),P=x.min,T=s.getDelta(a.Box3D.expand(a.Box3D.empty(),n,o.Vec3.create(C,C,C)),r),A=o.Vec3.zero(),o.Vec3.ceil(A,o.Vec3.mul(A,w,T)),E=o.Tensor.Space(A,[0,1,2],Float32Array),k=E.create(),I=o.Tensor.create(E,k),M=E.create(),V=o.Tensor.create(E,M),O=E.create(),D=o.Vec3.zero(),R=d,j=2*_,N=o.Vec3.create(j,j,j),o.Vec3.mul(N,N,T),B=Math.ceil(1e4/(N[0]*N[1]*N[2])),F=o.Vec3.zero(),L=o.Vec3.zero(),z=1/Math.max.apply(Math,T),U=0,i.label=5;case 5:if(!(U<v))return[3,8];for(G=u.OrderedSet.getAt(p,U),o.Vec3.set(b,h[G],m[G],y[G]),o.Vec3.sub(b,b,P),o.Vec3.mul(D,b,T),q=c(G)+f,H=q*q,W=f+2*q+z,Y=o.Vec3.create(W,W,W),o.Vec3.mul(Y,Y,T),K=W*W,X=o.Vec3.floor(F,o.Vec3.sub(F,D,Y)),Q=X[0],Z=X[1],J=X[2],$=o.Vec3.ceil(L,o.Vec3.add(L,D,Y)),ee=$[0],te=$[1],ne=$[2],re=Q;re<ee;++re)for(ie=Z;ie<te;++ie)for(ae=J;ae<ne;++ae)o.Vec3.set(g,re,ie,ae),o.Vec3.div(g,g,T),(oe=o.Vec3.squaredDistance(g,b))<=K&&(ue=Math.exp(oe/H*-R),E.add(k,re,ie,ae,ue),ue>E.get(O,re,ie,ae)&&(E.set(O,re,ie,ae,ue),E.set(M,re,ie,ae,U)));return U%B==0&&e.shouldUpdate?[4,e.update({message:"filling density grid",current:U,max:v})]:[3,7];case 6:i.sent(),i.label=7;case 7:return++U,[3,5];case 8:return se=o.Mat4.identity(),o.Mat4.fromScaling(se,o.Vec3.inverse(o.Vec3.zero(),T)),o.Mat4.setTranslation(se,x.min),[2,{field:I,idField:V,transform:se}]}})})}},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(80),a=n(81),o=n(69),u=n(68);t.GaussianDensitySchema={drawCount:o.ValueSpec("number"),instanceCount:o.ValueSpec("number"),aRadius:o.AttributeSpec("float32",1,0),aPosition:o.AttributeSpec("float32",3,0),aGroup:o.AttributeSpec("float32",1,0),uCurrentSlice:o.UniformSpec("f"),uCurrentX:o.UniformSpec("f"),uCurrentY:o.UniformSpec("f"),uBboxMin:o.UniformSpec("v3"),uBboxMax:o.UniformSpec("v3"),uBboxSize:o.UniformSpec("v3"),uGridDim:o.UniformSpec("v3"),uGridTexDim:o.UniformSpec("v3"),uAlpha:o.UniformSpec("f"),tMinDistanceTex:o.TextureSpec("texture","rgba","ubyte","nearest"),dGridTexType:o.DefineSpec("string",["2d","3d"]),dCalcType:o.DefineSpec("string",["density","minDistance","groupId"])},t.GaussianDensityRenderable=function(e,n,o,s){var c=r({},t.GaussianDensitySchema),l=u.GaussianDensityShaderCode,f=a.createRenderItem(e,"points",l,c,o);return i.createRenderable(f,o,s)}},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(34).idFactory();function a(e,t){var n=e.gl;switch(t){case"static":return n.STATIC_DRAW;case"dynamic":return n.DYNAMIC_DRAW;case"stream":return n.STREAM_DRAW}}function o(e,t){var n=e.gl;switch(t){case"attribute":return n.ARRAY_BUFFER;case"elements":return n.ELEMENT_ARRAY_BUFFER}}function u(e,t,n,r,u){var s=e.gl,c=s.createBuffer();if(null===c)throw new Error("Could not create WebGL buffer");var l=a(e,r),f=o(e,u),d=function(e,t){var n=e.gl;if(t instanceof Uint8Array)return n.UNSIGNED_BYTE;if(t instanceof Int8Array)return n.BYTE;if(t instanceof Uint16Array)return n.UNSIGNED_SHORT;if(t instanceof Int16Array)return n.SHORT;if(t instanceof Uint32Array)return n.UNSIGNED_INT;if(t instanceof Int32Array)return n.INT;if(t instanceof Float32Array)return n.FLOAT;throw new Error("Should nevver happen")}(e,t),p=t.BYTES_PER_ELEMENT,h=t.length,m=Math.floor(h/n);function y(e){s.bindBuffer(f,c),s.bufferData(f,e,l)}y(t);var v=!1;return e.bufferCount+=1,{id:i(),_buffer:c,_usageHint:l,_bufferType:f,_dataType:d,_bpe:p,get itemSize(){return n},get itemCount(){return m},get length(){return h},updateData:y,updateSubData:function(e,t,n){s.bindBuffer(f,c),s.bufferSubData(f,t*p,e.subarray(t,t+n))},destroy:function(){v||(s.deleteBuffer(c),v=!0,e.bufferCount-=1)}}}function s(e,t,n,i,a){void 0===a&&(a="dynamic");var o=e.gl,s=e.extensions.instancedArrays,c=u(e,t,n,a,"attribute"),l=c._buffer,f=c._bufferType,d=c._dataType,p=c._bpe;return r({},c,{bind:function(e){if(o.bindBuffer(f,l),16===n)for(var t=0;t<4;++t)o.enableVertexAttribArray(e+t),o.vertexAttribPointer(e+t,4,d,!1,16*p,4*t*p),s.vertexAttribDivisor(e+t,i);else o.enableVertexAttribArray(e),o.vertexAttribPointer(e,n,d,!1,0,0),s.vertexAttribDivisor(e,i)}})}t.getUsageHint=a,t.getDataType=function(e,t){var n=e.gl;switch(t){case"uint8":return n.UNSIGNED_BYTE;case"int8":return n.BYTE;case"uint16":return n.UNSIGNED_SHORT;case"int16":return n.SHORT;case"uint32":return n.UNSIGNED_INT;case"int32":return n.INT;case"float32":return n.FLOAT}},t.getBufferType=o,t.createBuffer=u,t.createAttributeBuffer=s,t.createAttributeBuffers=function(e,t,n){var r={};return Object.keys(t).forEach(function(i){var a=t[i];"attribute"===a.type&&(r[i]=s(e,n[i].ref.value,a.itemSize,a.divisor))}),r},t.createElementsBuffer=function(e,t,n){void 0===n&&(n="static");var i=e.gl,a=u(e,t,1,n,"elements"),o=a._buffer;return r({},a,{bind:function(){i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,o)}})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createVertexArray=function(e,t,n,r){var i=e.extensions.vertexArrayObject,a=null;return i&&(a=i.createVertexArray(),i.bindVertexArray(a),r&&r.bind(),t.bindAttributes(n),e.vaoCount+=1,i.bindVertexArray(null)),a},t.updateVertexArray=function(e,t,n,r,i){var a=e.extensions.vertexArrayObject;a&&t&&(a.bindVertexArray(t),i&&i.bind(),n.bindAttributes(r),a.bindVertexArray(null))},t.deleteVertexArray=function(e,t){var n=e.extensions.vertexArrayObject;n&&t&&(n.deleteVertexArray(t),e.vaoCount-=1)}},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(80),a=n(81),o=n(69),u=n(68),s=n(7);t.DirectVolumeSchema={uColor:o.UniformSpec("v3"),uColorTexDim:o.UniformSpec("v2"),tColor:o.TextureSpec("image-uint8","rgb","ubyte","nearest"),dColorType:o.DefineSpec("string",["uniform","instance","group","group_instance"]),uMarkerTexDim:o.UniformSpec("v2"),tMarker:o.TextureSpec("image-uint8","alpha","ubyte","nearest"),uInstanceCount:o.UniformSpec("i"),uGroupCount:o.UniformSpec("i"),aInstance:o.AttributeSpec("float32",1,1),aTransform:o.AttributeSpec("float32",16,1),drawCount:o.ValueSpec("number"),instanceCount:o.ValueSpec("number"),matrix:o.ValueSpec("m4"),transform:o.ValueSpec("float32"),extraTransform:o.ValueSpec("float32"),boundingSphere:o.ValueSpec("sphere"),invariantBoundingSphere:o.ValueSpec("sphere"),aPosition:o.AttributeSpec("float32",3,0),elements:o.ElementsSpec("uint32"),uAlpha:o.UniformSpec("f"),uHighlightColor:o.UniformSpec("v3"),uSelectColor:o.UniformSpec("v3"),dUseFog:o.DefineSpec("boolean"),uIsoValue:o.UniformSpec("f"),uBboxMin:o.UniformSpec("v3"),uBboxMax:o.UniformSpec("v3"),uBboxSize:o.UniformSpec("v3"),dMaxSteps:o.DefineSpec("number"),uTransform:o.UniformSpec("m4"),uGridDim:o.UniformSpec("v3"),dRenderMode:o.DefineSpec("string",["isosurface","volume"]),tTransferTex:o.TextureSpec("image-uint8","rgba","ubyte","linear"),dGridTexType:o.DefineSpec("string",["2d","3d"]),uGridTexDim:o.UniformSpec("v3"),tGridTex:o.TextureSpec("texture","rgba","ubyte","linear")},t.DirectVolumeRenderable=function(e,n,c,l){var f=r({},o.GlobalUniformSchema,o.InternalSchema,t.DirectVolumeSchema),d={uObjectId:s.ValueCell.create(n),uPickable:s.ValueCell.create(l.pickable?1:0)},p=u.DirectVolumeShaderCode,h=a.createRenderItem(e,"triangles",p,f,r({},c,d));return i.createRenderable(h,c,l)}},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(80),a=n(81),o=n(69),u=n(68),s=n(7);t.MeshSchema=r({},o.BaseSchema,{aPosition:o.AttributeSpec("float32",3,0),aNormal:o.AttributeSpec("float32",3,0),elements:o.ElementsSpec("uint32"),dFlatShaded:o.DefineSpec("boolean"),dDoubleSided:o.DefineSpec("boolean"),dFlipSided:o.DefineSpec("boolean")}),t.MeshRenderable=function(e,n,c,l){var f=r({},o.GlobalUniformSchema,o.InternalSchema,t.MeshSchema),d={uObjectId:s.ValueCell.create(n),uPickable:s.ValueCell.create(l.pickable?1:0)},p=u.MeshShaderCode,h=a.createRenderItem(e,"triangles",p,f,r({},c,d));return i.createRenderable(h,c,l)}},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(80),a=n(81),o=n(69),u=n(68),s=n(7);t.PointsSchema=r({},o.BaseSchema,o.SizeSchema,{aPosition:o.AttributeSpec("float32",3,0),dPointSizeAttenuation:o.DefineSpec("boolean"),dPointFilledCircle:o.DefineSpec("boolean"),uPointEdgeBleach:o.UniformSpec("f")}),t.PointsRenderable=function(e,n,c,l){var f=r({},o.GlobalUniformSchema,o.InternalSchema,t.PointsSchema),d={uObjectId:s.ValueCell.create(n),uPickable:s.ValueCell.create(l.pickable?1:0)},p=u.PointsShaderCode,h=a.createRenderItem(e,"points",p,f,r({},c,d));return i.createRenderable(h,c,l)}},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(80),a=n(81),o=n(69),u=n(7),s=n(68);t.LinesSchema=r({},o.BaseSchema,o.SizeSchema,{aMapping:o.AttributeSpec("float32",2,0),aStart:o.AttributeSpec("float32",3,0),aEnd:o.AttributeSpec("float32",3,0),elements:o.ElementsSpec("uint32"),dLineSizeAttenuation:o.DefineSpec("boolean"),dDoubleSided:o.DefineSpec("boolean"),dFlipSided:o.DefineSpec("boolean")}),t.LinesRenderable=function(e,n,c,l){var f=r({},o.GlobalUniformSchema,o.InternalSchema,t.LinesSchema),d={uObjectId:u.ValueCell.create(n),uPickable:u.ValueCell.create(l.pickable?1:0)},p=s.LinesShaderCode,h=a.createRenderItem(e,"triangles",p,f,r({},c,d));return i.createRenderable(h,c,l)}},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(80),a=n(81),o=n(69),u=n(68),s=n(7);t.SpheresSchema=r({},o.BaseSchema,o.SizeSchema,{aPosition:o.AttributeSpec("float32",3,0),aMapping:o.AttributeSpec("float32",2,0),elements:o.ElementsSpec("uint32"),padding:o.ValueSpec("number"),dDoubleSided:o.DefineSpec("boolean")}),t.SpheresRenderable=function(e,n,c,l){var f=r({},o.GlobalUniformSchema,o.InternalSchema,t.SpheresSchema),d={uObjectId:s.ValueCell.create(n),uPickable:s.ValueCell.create(l.pickable?1:0)},p=u.SpheresShaderCode,h=a.createRenderItem(e,"triangles",p,f,r({},c,d));return i.createRenderable(h,c,l)}},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(80),a=n(81),o=n(69),u=n(68),s=n(7);t.TextSchema=r({},o.BaseSchema,o.SizeSchema,{aPosition:o.AttributeSpec("float32",3,0),aMapping:o.AttributeSpec("float32",2,0),aDepth:o.AttributeSpec("float32",1,0),elements:o.ElementsSpec("uint32"),aTexCoord:o.AttributeSpec("float32",2,0),tFont:o.TextureSpec("image-uint8","alpha","ubyte","linear"),padding:o.ValueSpec("number"),uBorderWidth:o.UniformSpec("f"),uBorderColor:o.UniformSpec("v3"),uOffsetX:o.UniformSpec("f"),uOffsetY:o.UniformSpec("f"),uOffsetZ:o.UniformSpec("f"),uBackgroundColor:o.UniformSpec("v3"),uBackgroundOpacity:o.UniformSpec("f")}),t.TextRenderable=function(e,n,c,l){var f=r({},o.GlobalUniformSchema,o.InternalSchema,t.TextSchema),d={uObjectId:s.ValueCell.create(n),uPickable:s.ValueCell.create(l.pickable?1:0)},p=u.TextShaderCode,h=a.createRenderItem(e,"triangles",p,f,r({},c,d));return i.createRenderable(h,c,l)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AtomicNumbers={H:1,D:1,T:1,HE:2,LI:3,BE:4,B:5,C:6,N:7,O:8,F:9,NE:10,NA:11,MG:12,AL:13,SI:14,P:15,S:16,CL:17,AR:18,K:19,CA:20,SC:21,TI:22,V:23,CR:24,MN:25,FE:26,CO:27,NI:28,CU:29,ZN:30,GA:31,GE:32,AS:33,SE:34,BR:35,KR:36,RB:37,SR:38,Y:39,ZR:40,NB:41,MO:42,TC:43,RU:44,RH:45,PD:46,AG:47,CD:48,IN:49,SN:50,SB:51,TE:52,I:53,XE:54,CS:55,BA:56,LA:57,CE:58,PR:59,ND:60,PM:61,SM:62,EU:63,GD:64,TB:65,DY:66,HO:67,ER:68,TM:69,YB:70,LU:71,HF:72,TA:73,W:74,RE:75,OS:76,IR:77,PT:78,AU:79,HG:80,TL:81,PB:82,BI:83,PO:84,AT:85,RN:86,FR:87,RA:88,AC:89,TH:90,PA:91,U:92,NP:93,PU:94,AM:95,CM:96,BK:97,CF:98,ES:99,FM:100,MD:101,NO:102,LR:103,RF:104,DB:105,SG:106,BH:107,HS:108,MT:109},t.ElementVdwRadii={1:1.1,2:1.4,3:1.81,4:1.53,5:1.92,6:1.7,7:1.55,8:1.52,9:1.47,10:1.54,11:2.27,12:1.73,13:1.84,14:2.1,15:1.8,16:1.8,17:1.75,18:1.88,19:2.75,20:2.31,21:2.3,22:2.15,23:2.05,24:2.05,25:2.05,26:2.05,27:2,28:2,29:2,30:2.1,31:1.87,32:2.11,33:1.85,34:1.9,35:1.83,36:2.02,37:3.03,38:2.49,39:2.4,40:2.3,41:2.15,42:2.1,43:2.05,44:2.05,45:2,46:2.05,47:2.1,48:2.2,49:2.2,50:1.93,51:2.17,52:2.06,53:1.98,54:2.16,55:3.43,56:2.68,57:2.5,58:2.48,59:2.47,60:2.45,61:2.43,62:2.42,63:2.4,64:2.38,65:2.37,66:2.35,67:2.33,68:2.32,69:2.3,70:2.28,71:2.27,72:2.25,73:2.2,74:2.1,75:2.05,76:2,77:2,78:2.05,79:2.1,80:2.05,81:1.96,82:2.02,83:2.07,84:1.97,85:2.02,86:2.2,87:3.48,88:2.83,89:2,90:2.4,91:2,92:2.3,93:2,94:2,95:2,96:2,97:2,98:2,99:2,100:2,101:2,102:2,103:2,104:2,105:2,106:2,107:2,108:2,109:2},t.ElementAtomWeights={1:1.008,2:4.0026,3:6.94,4:9.0122,5:10.81,6:10.81,7:14.007,8:15.999,9:18.998,10:20.18,11:22.99,12:24.305,13:26.982,14:28.085,15:30.974,16:32.06,17:35.45,18:39.948,19:39.098,20:40.078,21:44.956,22:47.867,23:50.942,24:51.996,25:54.938,26:55.845,27:58.933,28:58.693,29:63.546,30:65.38,31:69.723,32:72.63,33:74.922,34:78.971,35:79.904,36:83.798,37:85.468,38:87.62,39:88.906,40:91.224,41:92.906,42:95.95,43:96.906,44:101.07,45:102.91,46:106.42,47:107.87,48:112.41,49:114.82,50:118.71,51:121.76,52:127.6,53:127.6,54:131.29,55:132.91,56:137.33,57:138.91,58:140.12,59:140.91,60:144.24,61:144.912,62:150.36,63:151.96,64:157.25,65:158.93,66:162.5,67:164.93,68:167.26,69:168.93,70:173.05,71:174.97,72:178.49,73:180.95,74:183.84,75:186.21,76:190.23,77:192.22,78:195.08,79:196.97,80:200.59,81:204.38,82:207.2,83:208.98,84:1.97,85:2.02,86:2.2,87:3.48,88:2.83,89:2,90:232.04,91:231.04,92:238.03,93:237.048,94:244.064,95:243.061,96:247.07,97:247.07,98:251.079,99:252.083,100:257.095,101:258.098,102:259.101,103:262.11,104:267.122,105:270.131,106:271.134,107:270.133,108:270.134,109:278.156},t.DefaultVdwRadius=1.7,t.DefaultAtomWeight=10.81,t.DefaultAtomNumber=0,t.VdwRadius=function(e){var n=t.AtomicNumbers[e];return void 0===n?t.DefaultVdwRadius:t.ElementVdwRadii[n]},t.AtomWeight=function(e){var n=t.AtomicNumbers[e];return void 0===n?t.DefaultAtomWeight:t.ElementAtomWeights[n]},t.AtomNumber=function(e){var n=t.AtomicNumbers[e];return void 0===n?t.DefaultAtomNumber:n}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(19),i=n(2),a=n(390),o=n(5),u=n(116),s=function(){function e(e){this.structure=e,this.pivot=i.Vec3.zero(),this._boundary=void 0;for(var t=e.units,n=t.length,a=new Float32Array(n),u=new Float32Array(n),s=new Float32Array(n),c=new Float32Array(n),l=i.Vec3.zero(),f=0;f<n;f++){var d=t[f],p=d.lookup3d.boundary.sphere;i.Vec3.transformMat4(l,p.center,d.conformation.operator.matrix),a[f]=l[0],u[f]=l[1],s[f]=l[2],c[f]=p.radius}this.unitLookup=r.GridLookup3D({x:a,y:u,z:s,radius:c,indices:o.OrderedSet.ofBounds(0,n)})}return e.prototype.findUnitIndices=function(e,t,n,r){return this.unitLookup.find(e,t,n,r)},e.prototype.findIntoBuilder=function(e,t,n,r,a){var o=this.structure.units,u=this.unitLookup.find(e,t,n,r);if(0!==u.count)for(var s=0,c=u.count;s<c;s++){var l=o[u.indices[s]];i.Vec3.set(this.pivot,e,t,n),l.conformation.operator.isIdentity||i.Vec3.transformMat4(this.pivot,this.pivot,l.conformation.operator.inverse);var f=l.lookup3d.find(this.pivot[0],this.pivot[1],this.pivot[2],r);if(0!==f.count){var d=l.elements;a.beginUnit(l.id);for(var p=0,h=f.count;p<h;p++)a.addElement(d[f.indices[p]]);a.commitUnit()}}},e.prototype.findIntoBuilderWithRadius=function(e,t,n,r,a,o,s,c){var l=this.structure.units,f=this.unitLookup.find(e,t,n,o);if(0!==f.count)for(var d=u.default.create(),p=r+a+o,h=0,m=f.count;h<m;h++){var y=l[f.indices[h]];i.Vec3.set(this.pivot,e,t,n),y.conformation.operator.isIdentity||i.Vec3.transformMat4(this.pivot,this.pivot,y.conformation.operator.inverse);var v=y.lookup3d.find(this.pivot[0],this.pivot[1],this.pivot[2],p);if(0!==v.count){var b=y.elements;d.unit=y,c.beginUnit(y.id);for(var g=0,_=v.count;g<_;g++){d.element=b[v.indices[g]];var S=s(d);Math.sqrt(v.squaredDistances[g])-r-S>o||c.addElement(b[v.indices[g]])}c.commitUnit()}}},e.prototype.check=function(e,t,n,r){var a=this.structure.units,o=this.unitLookup.find(e,t,n,r);if(0===o.count)return!1;for(var u=0,s=o.count;u<s;u++){var c=a[o.indices[u]];if(i.Vec3.set(this.pivot,e,t,n),c.conformation.operator.isIdentity||i.Vec3.transformMat4(this.pivot,this.pivot,c.conformation.operator.inverse),c.lookup3d.check(this.pivot[0],this.pivot[1],this.pivot[2],r))return!0}return!1},Object.defineProperty(e.prototype,"boundary",{get:function(){return this._boundary?this._boundary:(this._boundary=a.computeStructureBoundary(this.structure),this._boundary)},enumerable:!0,configurable:!0}),e}();t.StructureLookup3D=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(19),i=n(136),a=n(2),o=r.Box3D.empty(),u=r.Sphere3D.zero(),s=new i.BoundaryHelper;t.computeStructureBoundary=function(e){var t=a.Vec3.create(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),n=a.Vec3.create(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),i=e.units;s.reset(0);for(var c=0,l=i.length;c<l;c++){var f=(d=i[c]).lookup3d.boundary;(p=d.conformation.operator).isIdentity?(a.Vec3.min(t,t,f.box.min),a.Vec3.max(n,n,f.box.max),s.boundaryStep(f.sphere.center,f.sphere.radius)):(r.Box3D.transform(o,f.box,p.matrix),a.Vec3.min(t,t,o.min),a.Vec3.max(n,n,o.max),r.Sphere3D.transform(u,f.sphere,p.matrix),s.boundaryStep(u.center,u.radius))}for(s.finishBoundaryStep(),c=0,l=i.length;c<l;c++){var d,p;f=(d=i[c]).lookup3d.boundary,(p=d.conformation.operator).isIdentity?s.extendStep(f.sphere.center,f.sphere.radius):(r.Sphere3D.transform(u,f.sphere,p.matrix),s.extendStep(u.center,u.radius))}return{box:{min:t,max:n},sphere:s.getSphere()}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(5),i=n(17),a=n(140),o=n(92),u=function(){function e(e,t){this.parent=e,this.isSorted=t,this.ids=[],this.unitMap=r.IntMap.Mutable(),this.parentId=-1,this.currentUnit=[],this.elementCount=0}return e.prototype.addToUnit=function(e,t){var n=this.unitMap.get(e);n?n[n.length]=t:(this.unitMap.set(e,[t]),this.ids[this.ids.length]=e),this.elementCount++},e.prototype.beginUnit=function(e){this.parentId=e,this.currentUnit=this.currentUnit.length>0?[]:this.currentUnit},e.prototype.addElement=function(e){this.currentUnit[this.currentUnit.length]=e,this.elementCount++},e.prototype.commitUnit=function(){0!==this.currentUnit.length&&(this.ids[this.ids.length]=this.parentId,this.unitMap.set(this.parentId,this.currentUnit),this.parentId=-1)},e.prototype.setUnit=function(e,t){this.ids[this.ids.length]=e,this.unitMap.set(e,t),this.elementCount+=t.length},e.prototype._getStructure=function(e){if(this.isEmpty)return o.default.Empty;var t=[];i.sortArray(this.ids);for(var n=a.default.UnitEquivalenceBuilder(),u=0,s=this.ids.length;u<s;u++){var c=this.ids[u],l=this.parent.unitMap.get(c),f=this.unitMap.get(c),d=!1;e&&(this.isSorted||i.sortArray(f),f=r.SortedArray.deduplicate(r.SortedArray.ofSortedArray(this.currentUnit)),d=!0);var p=f.length;if(f.length!==l.elements.length){!this.isSorted&&!d&&p>1&&i.sortArray(f);var h=l.getChild(r.SortedArray.ofSortedArray(f)),m=n.add(h.id,h);h!==m&&(h=m.applyOperator(h.id,h.conformation.operator,!0)),t[t.length]=h}else t[t.length]=l,n.add(l.id,l)}return o.default.create(t)},e.prototype.getStructure=function(){return this._getStructure(!1)},e.prototype.getStructureDeduplicate=function(){return this._getStructure(!0)},e.prototype.setSingletonLocation=function(e){var t=this.ids[0];e.unit=this.parent.unitMap.get(t),e.element=this.unitMap.get(t)[0]},Object.defineProperty(e.prototype,"isEmpty",{get:function(){return 0===this.elementCount},enumerable:!0,configurable:!0}),e}();t.StructureSubsetBuilder=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(248);!function(e){e.run=function(e,t,n){return void 0===n&&(n=0),e(new i.QueryContext(t,n))}}(r||(r={})),t.StructureQuery=r},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(5),a=n(93),o=n(250),u=n(394),s=n(141),c=n(45);function l(e,t,n){for(var r=t.subsetBuilder(!0),a=0,o=n.units;a<o.length;a++){var u=o[a];if(0===u.kind){var s=u.model.atomicHierarchy.residueAtomSegments,c=u.elements;r.beginUnit(u.id);for(var l=i.Segmentation.transientSegments(s,c);l.hasNext;)for(var f=l.move().index,d=s.offsets[f],p=s.offsets[f+1];d<p;d++)r.addElement(d);r.commitUnit(),e.throwIfTimedOut()}else r.setUnit(u.id,u.elements)}return r.getStructure()}function f(e,t,n,r){for(var i=new u.StructureUniqueSubsetBuilder(t),a=t.lookup3d,o=r.radius,s=0,c=n.units;s<c.length;s++){for(var f=c[s],d=f.conformation,p=d.x,h=d.y,m=d.z,y=f.elements,v=0,b=y.length;v<b;v++){var g=y[v];a.findIntoBuilder(p(g),h(g),m(g),o,i)}e.throwIfTimedOut()}return r.wholeResidues?l(e,t,i.getStructure()):i.getStructure()}function d(e,t,n,r){var i=new u.StructureUniqueSubsetBuilder(t),a=t.lookup3d,o=r.elementRadius,s=r.elementRadiusClosure,c=r.sourceMaxRadius,f=r.radius;e.pushCurrentElement();for(var d=0,p=n.units;d<p.length;d++){var h=p[d];e.element.unit=h;for(var m=h.conformation,y=m.x,v=m.y,b=m.z,g=h.elements,_=0,S=g.length;_<S;_++){var C=g[_];e.element.element=C;var x=o(e);a.findIntoBuilderWithRadius(y(C),v(C),b(C),x,c,f,s,i)}e.throwIfTimedOut()}return e.popCurrentElement(),r.wholeResidues?l(e,t,i.getStructure()):i.getStructure()}function p(e,t){return function(n){return e.element.unit=n.unit,e.element.element=n.element,t(e)}}function h(e,t){for(var n=0,r=0,i=e.inputStructure.units;r<i.length;r++){var a=i[r];e.element.unit=a;for(var o=a.elements,u=0,s=o.length;u<s;u++){var c=o[u];e.element.element=c;var l=t(e);l>n&&(n=l)}}return e.throwIfTimedOut(),n}t.wholeResidues=function(e){return function(t){var n=e(t);if(a.StructureSelection.isSingleton(n))return a.StructureSelection.Singletons(t.inputStructure,l(t,t.inputStructure,n.structure));for(var r=new o.UniqueStructuresBuilder(t.inputStructure),i=0,u=n.structures;i<u.length;i++){var s=u[i];r.add(l(t,t.inputStructure,s))}return r.getSelection()}},t.includeSurroundings=function(e,t){return function(n){var i=e(n);if(t.elementRadius){var u=r({},t,{elementRadius:t.elementRadius,elementRadiusClosure:p(n,t.elementRadius),sourceMaxRadius:h(n,t.elementRadius)});if(a.StructureSelection.isSingleton(i)){var s=d(n,n.inputStructure,i.structure,u);return a.StructureSelection.Singletons(n.inputStructure,s)}for(var c=new o.UniqueStructuresBuilder(n.inputStructure),l=0,m=i.structures;l<m.length;l++){var y=m[l];c.add(d(n,n.inputStructure,y,u))}return c.getSelection()}if(a.StructureSelection.isSingleton(i))return s=f(n,n.inputStructure,i.structure,t),a.StructureSelection.Singletons(n.inputStructure,s);c=new o.UniqueStructuresBuilder(n.inputStructure);for(var v=0,b=i.structures;v<b.length;v++)y=b[v],c.add(f(n,n.inputStructure,y,t));return c.getSelection()}},t.querySelection=function(e,t){return function(n){var r=e(n);if(0===a.StructureSelection.structureCount(r))return r;var i=a.StructureSelection.UniqueBuilder(n.inputStructure),o=function(e){return i.add(e)};return a.StructureSelection.forEach(r,function(e,r){n.pushInputStructure(e),a.StructureSelection.forEach(t(n),o),n.popInputStructure(),r%10==0&&n.throwIfTimedOut()}),i.getSelection()}},t.intersectBy=function(e,t){return function(n){var r=e(n);if(0===a.StructureSelection.structureCount(r))return r;var i=t(n);if(0===a.StructureSelection.structureCount(i))return a.StructureSelection.Empty(n.inputStructure);var o=a.StructureSelection.unionStructure(i),u=a.StructureSelection.UniqueBuilder(n.inputStructure);return a.StructureSelection.forEach(r,function(e,t){var r=s.structureIntersect(o,e);0!==r.elementCount&&u.add(r),t%50==0&&n.throwIfTimedOut()}),u.getSelection()}},t.exceptBy=function(e,t){return function(n){var r=e(n);if(0===a.StructureSelection.structureCount(r))return r;var i=t(n);if(0===a.StructureSelection.structureCount(i))return a.StructureSelection.Empty(n.inputStructure);var o=a.StructureSelection.unionStructure(i),u=a.StructureSelection.UniqueBuilder(n.inputStructure);return a.StructureSelection.forEach(r,function(e,t){var r=s.structureSubtract(e,o);0!==r.elementCount&&u.add(r),t%50==0&&n.throwIfTimedOut()}),u.getSelection()}},t.union=function(e){return function(t){var n=a.StructureSelection.LinearBuilder(t.inputStructure);return n.add(a.StructureSelection.unionStructure(e(t))),n.getSelection()}},t.expandProperty=function(e,t){return function(n){var r=e(n),i=new Map,o=[];n.pushCurrentElement(),a.StructureSelection.forEach(r,function(e,r){for(var a=0,u=e.units;a<u.length;a++){var s=u[a];n.element.unit=s;for(var l=s.elements,f=0,d=l.length;f<d;f++){n.element.element=l[f];var p=t(n),h=void 0;i.has(p)?h=i.get(p):(h=c.UniqueArray.create(),i.set(p,h)),c.UniqueArray.add(h,r,r)}}o[r]=n.inputStructure.subsetBuilder(!0),r%10==0&&n.throwIfTimedOut()});for(var u=0,s=n.inputStructure.units;u<s.length;u++){var l=s[u];n.element.unit=l;for(var f=l.elements,d=0,p=f.length;d<p;d++){n.element.element=f[d];var h=t(n);if(i.has(h))for(var m=i.get(h).array,y=0,v=m.length;y<v;y++)o[m[d]].addToUnit(l.id,f[d])}}n.popCurrentElement();for(var b=a.StructureSelection.UniqueBuilder(n.inputStructure),g=0,_=o;g<_.length;g++){var S=_[g];b.add(S.getStructure())}return b.getSelection()}},t.includeConnected=function(e){return e.query,e.layerCount,e.wholeResidues,e.bondTest,function(e){return 0}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(5),i=n(17),a=n(140),o=n(92),u=n(45),s=function(){function e(e){this.parent=e,this.ids=[],this.unitMap=r.IntMap.Mutable(),this.parentId=-1,this.currentUnit=u.UniqueArray.create(),this.elementCount=0}return e.prototype.addToUnit=function(e,t){var n=this.unitMap.get(e);if(n)u.UniqueArray.add(n,t,t)&&this.elementCount++;else{var r=u.UniqueArray.create();u.UniqueArray.add(r,t,t),this.unitMap.set(e,r),this.ids[this.ids.length]=e,this.elementCount++}},e.prototype.beginUnit=function(e){this.parentId=e,this.unitMap.has(e)?this.currentUnit=this.unitMap.get(e):this.currentUnit=this.currentUnit.array.length>0?u.UniqueArray.create():this.currentUnit},e.prototype.addElement=function(e){u.UniqueArray.add(this.currentUnit,e,e)&&this.elementCount++},e.prototype.commitUnit=function(){0===this.currentUnit.array.length||this.unitMap.has(this.parentId)||(this.ids[this.ids.length]=this.parentId,this.unitMap.set(this.parentId,this.currentUnit),this.parentId=-1)},e.prototype.getStructure=function(){if(this.isEmpty)return o.default.Empty;var e=[];i.sortArray(this.ids);for(var t=a.default.UnitEquivalenceBuilder(),n=0,u=this.ids.length;n<u;n++){var s=this.ids[n],c=this.parent.unitMap.get(s),l=this.unitMap.get(s).array,f=l.length;if(l.length!==c.elements.length){f>1&&i.sortArray(l);var d=c.getChild(r.SortedArray.ofSortedArray(l)),p=t.add(d.id,d);d!==p&&(d=p.applyOperator(d.id,d.conformation.operator,!0)),e[e.length]=d}else e[e.length]=c,t.add(c.id,c)}return o.default.create(e)},Object.defineProperty(e.prototype,"isEmpty",{get:function(){return 0===this.elementCount},enumerable:!0,configurable:!0}),e}();t.StructureUniqueSubsetBuilder=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(93),i=n(249),a=n(45),o=n(43);t.merge=function(e){return 0===e.length?i.none:1===e.length?e[0]:function(t){for(var n=r.StructureSelection.UniqueBuilder(t.inputStructure),i=function(i){r.StructureSelection.forEach(e[i](t),function(e,r){n.add(e),i%100&&t.throwIfTimedOut()})},a=0;a<e.length;a++)i(a);return n.getSelection()}},t.intersect=function(e){return 0===e.length?i.none:1===e.length?e[0]:function(t){for(var n=[],i=0;i<e.length;i++)n.push(e[i](t));var u=0,s=r.StructureSelection.structureCount(n[0]);for(i=1;i<n.length;i++){var c=r.StructureSelection.structureCount(n[i]);c<s&&(u=i,s=c)}t.throwIfTimedOut();var l=a.HashSet(function(e){return e.hashCode},o.Structure.areEqual);r.StructureSelection.forEach(n[u],function(e){return l.add(e)});for(var f=r.StructureSelection.UniqueBuilder(t.inputStructure),d=0;d<n.length;d++)d!==u&&(r.StructureSelection.forEach(n[d],function(e){l.has(e)&&f.add(e)}),t.throwIfTimedOut());return f.getSelection()}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(5),i=n(116),a=n(43),o=n(92),u=n(93);t.atomicSequence=function(){return function(e){for(var t=e.inputStructure,n=i.default.create(),s=[],c=0,l=t.units;c<l.length;c++){var f=l[c];if(0===f.kind){n.unit=f;var d=f.elements;if(n.element=d[0],"polymer"===a.StructureProperties.entity.type(n)){for(var p=r.Segmentation.transientSegments(f.model.atomicHierarchy.residueAtomSegments,d),h=0;p.hasNext;)h++,p.move();h<8||s.push(f)}}}return u.StructureSelection.Singletons(t,new o.default(s))}},t.water=function(){return function(e){for(var t=e.inputStructure,n=i.default.create(),r=[],s=0,c=t.units;s<c.length;s++){var l=c[s];if(0===l.kind){n.unit=l;var f=l.elements;n.element=f[0],"water"===a.StructureProperties.entity.type(n)&&r.push(l)}}return u.StructureSelection.Singletons(t,new o.default(r))}},t.atomicHet=function(){return function(e){for(var t=e.inputStructure,n=i.default.create(),s=[],c=0,l=t.units;c<l.length;c++){var f=l[c];if(0===f.kind){n.unit=f;var d=f.elements;if(n.element=d[0],"water"!==a.StructureProperties.entity.type(n)){if("polymer"===a.StructureProperties.entity.type(n)){for(var p=r.Segmentation.transientSegments(f.model.atomicHierarchy.residueAtomSegments,d),h=0;p.hasNext;)h++,p.move();if(h>=8)continue}s.push(f)}}}return u.StructureSelection.Singletons(t,new o.default(s))}},t.spheres=function(){return function(e){for(var t=e.inputStructure,n=[],r=0,i=t.units;r<i.length;r++){var a=i[r];1===a.kind&&n.push(a)}return u.StructureSelection.Singletons(t,new o.default(n))}}},function(e,t,n){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),function(e){function t(e){return!0}function n(e){return!1}e.eq=function(e,t){return function(n){return e(n)===t}},e.lt=function(e,t){return function(n){return e(n)<t}},e.lte=function(e,t){return function(n){return e(n)<=t}},e.gt=function(e,t){return function(n){return e(n)>t}},e.gte=function(e,t){return function(n){return e(n)>=t}},e.inSet=function(e,t){if((a=t)&&a.has)return function(n){return t.has(e(n))};if(0===t.length)return n;for(var r=new Set,i=0;i<t.length;i++)r.add(t[i]);return function(t){return r.has(e(t))};var a},e.and=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];switch(e.length){case 0:return t;case 1:return e[0];case 2:var r=e[0],i=e[1];return function(e){return r(e)&&i(e)};case 3:var a=e[0],o=e[1],u=e[2];return function(e){return a(e)&&o(e)&&u(e)};case 4:var s=e[0],c=e[1],l=e[2],f=e[3];return function(e){return s(e)&&c(e)&&l(e)&&f(e)};case 5:var d=e[0],p=e[1],h=e[2],m=e[3],y=e[4];return function(e){return d(e)&&p(e)&&h(e)&&m(e)&&y(e)};case 6:var v=e[0],b=e[1],g=e[2],_=e[3],S=e[4],C=e[5];return function(e){return v(e)&&b(e)&&g(e)&&_(e)&&S(e)&&C(e)};default:var x=e.length;return function(t){for(var n=0;n<x;n++)if(!e[n])return!1;return!0}}},e.or=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];switch(e.length){case 0:return n;case 1:return e[0];case 2:var r=e[0],i=e[1];return function(e){return r(e)||i(e)};case 3:var a=e[0],o=e[1],u=e[2];return function(e){return a(e)||o(e)||u(e)};case 4:var s=e[0],c=e[1],l=e[2],f=e[3];return function(e){return s(e)||c(e)||l(e)||f(e)};case 5:var d=e[0],p=e[1],h=e[2],m=e[3],y=e[4];return function(e){return d(e)||p(e)||h(e)||m(e)||y(e)};case 6:var v=e[0],b=e[1],g=e[2],_=e[3],S=e[4],C=e[5];return function(e){return v(e)||b(e)||g(e)||_(e)||S(e)||C(e)};default:var x=e.length;return function(t){for(var n=0;n<x;n++)if(e[n])return!0;return!1}}}}(r||(r={})),t.default=r},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(251)),r(n(399))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(251),i=n(400);function a(e,t,n){for(var r=t.elements,i=r.length,a=t.kind,o=function(t){var i=r[t];n.getIndicesByElement(i,a).forEach(function(n){return e.set(n,t)})},u=0;u<i;u++)o(u)}function o(e,t,n){if(t.model===n.model&&"mmCIF"===t.model.sourceData.kind){var r=i.IHMCrossLinkRestraint.fromModel(t.model);if(r){var o=new Map,u=new Map;a(o,t,r),a(u,n,r),o.forEach(function(i,a){var o=u.get(a);void 0!==o&&e.push(s(t,i,n,o,r,a),s(n,o,t,i,r,a))})}}}function u(e,t){if("mmCIF"===t.model.sourceData.kind){var n=i.IHMCrossLinkRestraint.fromModel(t.model);if(n){for(var r=t.elements,a=r.length,o=t.kind,u=new Map,c=function(e){var t=r[e];n.getIndicesByElement(t,o).forEach(function(t){var n=u.get(t);n?n.push(e):u.set(t,[e])})},l=0;l<a;l++)c(l);u.forEach(function(r,i){if(!(r.length<2)){var a=r[0],o=r[1];e.push(s(t,a,t,o,n,i),s(t,o,t,a,n,i))}})}}}function s(e,t,n,r,i,a){return{unitA:e,indexA:t,unitB:n,indexB:r,restraintType:i.data.restraint_type.value(a),distanceThreshold:i.data.distance_threshold.value(a),psi:i.data.psi.value(a),sigma1:i.data.sigma_1.value(a),sigma2:i.data.sigma_2.value(a)}}t.extractCrossLinkRestraints=function(e){for(var t=[],n=e.units.length,i=0;i<n;++i){var a=e.units[i];u(t,a);for(var s=i+1;s<n;++s)o(t,a,e.units[s])}return new r.PairRestraints(t)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(401))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(244);!function(e){e.PropName="__CrossLinkRestraint__",e.fromModel=function(t){if(t._staticPropertyData[e.PropName])return t._staticPropertyData[e.PropName];if("mmCIF"===t.sourceData.kind){var n=t.sourceData.data.ihm_cross_link_restraint;if(n._rowCount){for(var i={entity_id:n.entity_id_1,asym_id:n.asym_id_1,seq_id:n.seq_id_1,atom_id:n.atom_id_1},a={entity_id:n.entity_id_2,asym_id:n.asym_id_2,seq_id:n.seq_id_2,atom_id:n.atom_id_2},o=new Map,u=new Map,s=new Map,c=[],l=0;l<n._rowCount;++l)p(l,i),p(l,a);var f={getIndicesByElement:function(e,t){var n=function(e){switch(e){case 0:return o;case 1:return u;case 2:return s}}(t).get(e);return void 0!==n?n:c},data:n};return t._staticPropertyData[e.PropName]=f,f}}function d(e,t,n){var r=e.get(t);r?r.push(n):e.set(t,[n])}function p(e,i){var a=i.entity_id.value(e),c=i.asym_id.value(e),l=i.seq_id.value(e);if("by-atom"===n.model_granularity.value(e)){var f=function(e,t,n,i,a){if(!e.atomicHierarchy.atoms.auth_atom_id.isDefined)return-1;var o=e.atomicHierarchy.index.findResidue(t,n,i);return o<0?-1:r.findAtomIndexByLabelName(e,o,a,"")}(t,a,c,l,i.atom_id.value(e));f>=0&&d(o,f,e)}else if(t.coarseHierarchy.isDefined){var p=t.coarseHierarchy.spheres.findSequenceKey(a,c,l);if(p>=0)d(u,p,e);else{var h=t.coarseHierarchy.gaussians.findSequenceKey(a,c,l);h>=0&&d(s,h,e)}}}}}(t.IHMCrossLinkRestraint||(t.IHMCrossLinkRestraint={}))},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(5),a=n(403),o=n(118),u=n(2),s=n(404),c=n(142),l=n(23),f=n(94),d=n(78),p=n(406),h=n(194),m=l.ElementSymbol("C"),y=l.ElementSymbol("O"),v=[h.UnitRing.elementFingerprint([m,m,m,m,m,y]),h.UnitRing.elementFingerprint([m,m,m,m,y])];function b(e,t){for(var n=-1,r=-1,i=-1,a=-1,o=e.elements,u=e.model.atomicHierarchy.atoms,s=u.type_symbol,c=u.label_atom_id,l=e.links,f=l.b,d=l.offset,p=0,h=t.length;p<h;++p){var v=o[t[p]];if(s.value(v)===m){for(var b=0,g=0,_=d[t[p]],S=d[t[p]+1];_<S;++_){var C=o[f[_]],x=s.value(C);x===y?++b:x===m&&++g}if(2===b){n=v;break}1===b&&1===g?r=v:c.value(v).startsWith("C1")?i=v:a=v}}return-1!==n?n:-1!==r?r:-1!==i?i:-1!==a?a:o[t[0]]}function g(e,t){for(var n=e.elements,r=e.model.atomicHierarchy.atoms.label_alt_id,i=0,a=t.length;i<a;++i){var o=n[t[i]],u=r.value(o);if(u)return u}return""}function _(e,t,n,r){var i=t.conformation.position;return u.Vec3.normalize(e,u.Vec3.sub(e,r,i(n,e))),e}function S(e,t){var n=e.elements;return e.model.atomicHierarchy.atoms.label_atom_id.value(n[t])}function C(e,t){if(t&&t.length){for(var n=new Set,r=a.combinations(c.fillSerial(new Array(t.length)),2),o=0,u=r.length;o<u;++o){var s=r[o],l=e.all[t[s[0]]],f=e.all[t[s[1]]];i.SortedArray.areIntersecting(l,f)&&(n.add(t[s[0]]),n.add(t[s[1]]))}if(n.size){var d=[];for(o=0,u=t.length;o<u;++o)n.has(t[o])||d.push(t[o]);return d}return t}}function x(e,t){return t.properties.saccharideComponentMap.get(e)}t.computeCarbohydrates=function(e){if(0===e.models.reduce(function(e,t){return e+t.properties.saccharideComponentMap.size},0))return p.EmptyCarbohydrates;var t=[],n=[],l=[],m=[],y=new Map;function w(e,t,n){return e+"|"+t+"|"+n}function P(e,t){u.Vec3.sub(l[e].geometry.direction,l[t].geometry.center,l[e].geometry.center),u.Vec3.normalize(l[e].geometry.direction,l[e].geometry.direction)}var T=u.Vec3.zero();function A(e,t,n){var r=n.conformation.position,i=l[e].geometry;u.Vec3.sub(i.direction,r(n.elements[t],T),i.center),u.Vec3.normalize(i.direction,i.direction)}for(var E=0,k=e.units.length;E<k;++E){var I=e.units[E];if(d.default.isAtomic(I))for(var M=I.model,V=M.atomicHierarchy,O=V.chainAtomSegments,D=V.residueAtomSegments,R=V.residues.label_comp_id,j=i.Segmentation.transientSegments(O,I.elements),N=i.Segmentation.transientSegments(D,I.elements),B=void 0;j.hasNext;)for(N.setSegment(j.move());N.hasNext;){var F=N.move().index,L=x(R.value(F),M);if(L){B||(B=h.UnitRings.byFingerprintAndResidue(I.rings,v));var z=C(I.rings,B.get(F));if(z&&z.length){for(var U=I.rings,G=[],q=0,H=z.length;q<H;++q){var W=U.all[z[q]],Y=b(I,W),K=new s.default(f.getPositionMatrix(I,W)),X=u.Vec3.copy(u.Vec3.zero(),K.center),Q=u.Vec3.copy(u.Vec3.zero(),K.normVecC),Z=_(u.Vec3.zero(),I,Y,X);u.Vec3.orthogonalize(Z,Q,Z);var J=g(I,W),$=l.length;G.push($),y.set(w(F,I.id,J),$),l.push({geometry:{center:X,normal:Q,direction:Z},component:L,unit:I,residueIndex:F,anomericCarbon:Y,ringAltId:J})}var ee=a.combinations(c.fillSerial(new Array(z.length)),2);for(q=0,H=ee.length;q<H;++q){var te=ee[q],ne=U.all[z[te[0]]],re=U.all[z[te[1]]];if(o.IntAdjacencyGraph.areVertexSetsConnected(I.links,ne,re,3)){var ie=G[te[0]],ae=G[te[1]];l[ie].ringAltId===l[ae].ringAltId&&(P(ie,ae),P(ae,ie),t.push({carbohydrateIndexA:ie,carbohydrateIndexB:ae}),t.push({carbohydrateIndexA:ae,carbohydrateIndexB:ie}))}}}else m.push({unit:I,residueIndex:F,component:L})}}}function oe(e,t){return y.get(w(e.getResidueIndex(t),e.id,function(e,t){var n=e.elements;return e.model.atomicHierarchy.atoms.label_alt_id.value(n[t])}(e,t)))}for(E=0,k=l.length;E<k;++E){var ue=l[E],se=(I=ue.unit,F=ue.residueIndex,Y=ue.anomericCarbon,I.links),ce=se.offset,le=se.b,fe=i.SortedArray.indexOf(I.elements,Y);for(q=ce[fe],H=ce[fe+1];q<H;++q){var de=le[q];if(F!==I.getResidueIndex(de)){var pe=oe(I,de);void 0!==pe&&pe!==E&&(P(E,pe),t.push({carbohydrateIndexA:E,carbohydrateIndexB:pe}),t.push({carbohydrateIndexA:pe,carbohydrateIndexB:E}))}}}for(E=0,k=e.units.length;E<k;++E)I=e.units[E],d.default.isAtomic(I)&&e.links.getLinkedUnits(I).forEach(function(e){e.linkedElementIndices.forEach(function(r){e.getBonds(r).forEach(function(i){var a=e.unitA,o=e.unitB,u=i.indexB,s=oe(a,r),c=oe(o,u);if(void 0!==s&&void 0!==c)((l=S(a,r)).startsWith("O1")||l.startsWith("C1"))&&P(s,c),t.push({carbohydrateIndexA:s,carbohydrateIndexB:c});else if(void 0!==s){var l;((l=S(a,r)).startsWith("O1")||l.startsWith("C1"))&&A(s,u,o),n.push({carbohydrateIndex:s,elementIndex:u,elementUnit:o,fromCarbohydrate:!0})}else void 0!==c&&n.push({carbohydrateIndex:c,elementIndex:r,elementUnit:a,fromCarbohydrate:!1})})})});return r({links:t,terminalLinks:n,elements:l,partialElements:m},function(e,t,n){function r(e,t){return e.id+"|"+t}for(var i=new Map,a=0,o=e.length;a<o;++a){var u=e[a],s=u.unit,c=u.anomericCarbon;i.set(r(s,c),a)}function l(e,t,n,r){return e.id+"|"+t+"|"+n.id+"|"+r}for(var f=new Map,a=0,o=t.length;a<o;++a){var d=t[a],p=e[d.carbohydrateIndexA],h=p.unit,m=p.anomericCarbon,y=e[d.carbohydrateIndexB],v=y.unit,b=y.anomericCarbon;f.set(l(h,m,v,b),a)}function g(e,t){return e.id+"|"+t}for(var _=new Map,a=0,o=t.length;a<o;++a){var d=t[a],S=e[d.carbohydrateIndexA],s=S.unit,c=S.anomericCarbon,C=g(s,c),x=_.get(C);void 0===x?_.set(C,[a]):x.push(a)}function w(e,t,n,r){return e.id+"|"+t+"|"+n.id+"|"+r}for(var P=new Map,a=0,o=n.length;a<o;++a){var T=n[a],A=T.fromCarbohydrate,E=T.carbohydrateIndex,k=T.elementUnit,I=T.elementIndex,M=e[E],s=M.unit,c=M.anomericCarbon;A?P.set(w(s,c,k,k.elements[I]),a):P.set(w(k,k.elements[I],s,c),a)}function V(e,t){return e.id+"|"+t}for(var O=new Map,a=0,o=n.length;a<o;++a){var D=n[a],A=D.fromCarbohydrate,E=D.carbohydrateIndex,k=D.elementUnit,I=D.elementIndex,R=e[E],s=R.unit,c=R.anomericCarbon,C=void 0;C=A?V(s,c):V(k,k.elements[I]);var x=O.get(C);void 0===x?O.set(C,[a]):x.push(a)}function j(e,t){return e.id+"|"+t}for(var N=new Map,a=0,o=e.length;a<o;++a){var B=e[a],s=B.unit,c=B.anomericCarbon,F=s.model.atomicHierarchy.residueAtomSegments.index[c];N.set(j(s,F),c)}return{getElementIndex:function(e,t){return i.get(r(e,t))},getLinkIndex:function(e,t,n,r){return f.get(l(e,t,n,r))},getLinkIndices:function(e,t){return _.get(g(e,t))||[]},getTerminalLinkIndex:function(e,t,n,r){return P.get(w(e,t,n,r))},getTerminalLinkIndices:function(e,t){return O.get(V(e,t))||[]},getAnomericCarbon:function(e,t){return N.get(j(e,t))}}}(l,t,n))}},function(e,t,n){"use strict";function r(e,t){for(var n=1;t--;)n*=e--;return n}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){var n,i;this.array=e,this.hasNext=!1,this.index=(1<<t)-1,this.size=(n=e.length,(i=t)>n?0:r(n,i)/r(i,i)),this.maxIndex=1<<e.length,this.value=new Array(t),this.hasNext=t>0&&t<=e.length}return e.prototype.move=function(){if(this.hasNext){for(var e=0,t=0,n=this.index;n;n>>>=1,e++)1&n&&(this.value[t++]=this.array[e]);this.index=function(e){var t=e&-e,n=e+t;return n|((n&-n)/t>>1)-1}(this.index),this.hasNext=this.index<this.maxIndex}return this.value},e}();t.CombinationIterator=i,t.combinations=function(e,t){for(var n=[],r=new i(e,t);r.hasNext;)n.push(r.move().slice());return n}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(200),i=n(90),a=n(405),o=function(){return function(e){var t=e.rows,n=t/3,o=r.default.create(t,3),u=r.default.create(3,3),s=r.default.create(1,3),c=r.default.create(3,3),l=r.default.create(3,3),f=r.default.meanRows(e);r.default.subRows(e,f),r.default.transpose(o,e),r.default.multiplyABt(u,o,o),a.svd(u,s,c,l);var d=i.Vec3.create(f[0],f[1],f[2]),p=i.Vec3.create(c.data[0],c.data[3],c.data[6]),h=i.Vec3.create(c.data[1],c.data[4],c.data[7]),m=i.Vec3.create(c.data[2],c.data[5],c.data[8]),y=i.Vec3.scale(i.Vec3.zero(),p,Math.sqrt(s.data[0]/n)),v=i.Vec3.scale(i.Vec3.zero(),h,Math.sqrt(s.data[1]/n)),b=i.Vec3.scale(i.Vec3.zero(),m,Math.sqrt(s.data[2]/n));this.begA=i.Vec3.sub(i.Vec3.clone(d),d,y),this.endA=i.Vec3.add(i.Vec3.clone(d),d,y),this.begB=i.Vec3.sub(i.Vec3.clone(d),d,v),this.endB=i.Vec3.add(i.Vec3.clone(d),d,v),this.begC=i.Vec3.sub(i.Vec3.clone(d),d,b),this.endC=i.Vec3.add(i.Vec3.clone(d),d,b),this.center=d,this.vecA=y,this.vecB=v,this.vecC=b,this.normVecA=p,this.normVecB=h,this.normVecC=m}}();t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(200);function i(e,t,n,r){r=e[t],e[t]=e[n],e[n]=r}function a(e,t){return(e=Math.abs(e))>(t=Math.abs(t))?(t/=e,e*Math.sqrt(1+t*t)):t>0?(e/=t,t*Math.sqrt(1+e*e)):0}t.swap=i,t.hypot=a;var o=1.192092896e-7,u=1e-37;function s(e,t,n,r,s,c,l,f){for(var d=2*o,p=u,h=0,m=0,y=0,v=0,b=Math.max(c,30),g=0,_=0,S=0,C=0,x=0,w=0,P=0,T=0,A=0,E=0,k=0,I=0,M=0,V=0,O=0,D=0,R=0,j=4660,N=0,B=0,F=0,L=new Float64Array(l<<3);h<l;h++){for(y=0,k=0;y<c;y++)k+=(T=e[h*t+y])*T;if(L[h]=k,r){for(y=0;y<l;y++)r[h*s+y]=0;r[h*s+h]=1}}for(;v<b;v++){for(x=0,h=0;h<l-1;h++)for(m=h+1;m<l;m++){for(g=h*t|0,_=m*t|0,O=L[h],D=0,R=L[m],y=2,D+=e[g]*e[_],D+=e[g+1]*e[_+1];y<c;y++)D+=e[g+y]*e[_+y];if(!(Math.abs(D)<=d*Math.sqrt(O*R))){for(M=a(D*=2,I=O-R),I<0?(V=.5*(M-I),w=D/(M*(P=Math.sqrt(V/M))*2)):P=D/(M*(w=Math.sqrt((M+I)/(2*M)))*2),O=0,R=0,y=2,A=w*e[g]+P*e[_],E=-P*e[g]+w*e[_],e[g]=A,e[_]=E,O+=A*A,R+=E*E,A=w*e[g+1]+P*e[_+1],E=-P*e[g+1]+w*e[_+1],e[g+1]=A,e[_+1]=E,O+=A*A,R+=E*E;y<c;y++)A=w*e[g+y]+P*e[_+y],E=-P*e[g+y]+w*e[_+y],e[g+y]=A,e[_+y]=E,O+=A*A,R+=E*E;if(L[h]=O,L[m]=R,x=1,r)for(C=m*s|0,y=2,A=w*r[S=h*s|0]+P*r[C],E=-P*r[S]+w*r[C],r[S]=A,r[C]=E,A=w*r[S+1]+P*r[C+1],E=-P*r[S+1]+w*r[C+1],r[S+1]=A,r[C+1]=E;y<l;y++)A=w*r[S+y]+P*r[C+y],E=-P*r[S+y]+w*r[C+y],r[S+y]=A,r[C+y]=E}}if(0===x)break}for(h=0;h<l;h++){for(y=0,k=0;y<c;y++)k+=(T=e[h*t+y])*T;L[h]=Math.sqrt(k)}for(h=0;h<l-1;h++){for(m=h,y=h+1;y<l;y++)L[m]<L[y]&&(m=y);if(h!==m&&(i(L,h,m,k),r)){for(y=0;y<c;y++)i(e,h*t+y,m*t+y,T);for(y=0;y<l;y++)i(r,h*s+y,m*s+y,T)}}for(h=0;h<l;h++)n[h]=L[h];if(r)for(h=0;h<f;h++){for(k=h<l?L[h]:0;k<=p;){for(B=1/c,y=0;y<c;y++)N=0!=(256&(j=214013*j+2531011)>>16)?B:-B,e[h*t+y]=N;for(v=0;v<2;v++)for(m=0;m<h;m++){for(k=0,y=0;y<c;y++)k+=e[h*t+y]*e[m*t+y];for(F=0,y=0;y<c;y++)T=e[h*t+y]-k*e[m*t+y],e[h*t+y]=T,F+=Math.abs(T);for(F=F?1/F:0,y=0;y<c;y++)e[h*t+y]*=F}for(k=0,y=0;y<c;y++)k+=(T=e[h*t+y])*T;k=Math.sqrt(k)}for(P=1/k,y=0;y<c;y++)e[h*t+y]*=P}}t.JacobiSVDImpl=s,t.svd=function(e,t,n,i){var a=0,o=0,u=e.rows,c=e.cols,l=u,f=c;l<f&&(a=1,o=l,l=f,f=o);var d=r.default.create(l,l),p=r.default.create(1,f),h=r.default.create(f,f);if(0===a)r.default.transpose(d,e);else{for(o=0;o<c*u;o++)d.data[o]=e.data[o];for(;o<f*l;o++)d.data[o]=0}if(s(d.data,l,p.data,h.data,f,l,f,l),t){for(o=0;o<f;o++)t.data[o]=p.data[o];for(;o<c;o++)t.data[o]=0}0===a?(n&&r.default.transpose(n,d),i&&r.default.transpose(i,h)):(n&&r.default.transpose(n,h),i&&r.default.transpose(i,d))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=[];t.EmptyCarbohydrates={links:r,terminalLinks:r,elements:r,partialElements:r,getElementIndex:function(){},getLinkIndex:function(){},getLinkIndices:function(){return r},getTerminalLinkIndex:function(){},getTerminalLinkIndices:function(){return r},getAnomericCarbon:function(){}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(44),a=n(201),o=i.CifWriter.Category,u=n(408),s=n(409),c=n(410),l=n(202),f=n(411),d=n(190);!function(e){e.create=function(e){var t=Array.isArray(e)?e:[e];return{structures:t,firstModel:t[0].model,cache:Object.create(null)}}}(r=t.CifExportContext||(t.CifExportContext={}));var p={name:"entity",instance:function(e){var t=e.structures,n=l.getUniqueEntityIndicesFromStructures(t);return o.ofTable(t[0].model.entities.data,n)}};function h(e){return e.units.every(function(e){return e.conformation.operator.isIdentity})}var m,y=[l.copy_mmCif_category("entry"),l.copy_mmCif_category("exptl"),p,l.copy_mmCif_category("cell",h),l.copy_mmCif_category("symmetry",h),l.copy_mmCif_category("pdbx_struct_assembly",h),l.copy_mmCif_category("pdbx_struct_assembly_gen",h),l.copy_mmCif_category("pdbx_struct_oper_list",h),u._struct_conf,u._struct_sheet_range,f._struct_asym,f._entity_poly,f._entity_poly_seq,l.copy_mmCif_category("pdbx_entity_branch"),l.copy_mmCif_category("pdbx_entity_branch_link"),l.copy_mmCif_category("pdbx_branch_scheme"),c._chem_comp,c._pdbx_chem_comp_identifier,l.copy_mmCif_category("atom_sites"),c._pdbx_nonpoly_scheme,s._pdbx_struct_mod_residue,a._atom_site];function v(e,t,n){var i=(Array.isArray(t)?t[0]:t).models;if(1!==i.length)throw"Can't export stucture composed from multiple models.";for(var a=n||{},o=n&&n.exportCtx?n.exportCtx:r.create(t),u=0,s=y;u<s.length;u++){var c=s[u];a.skipCategoryNames&&a.skipCategoryNames.has(c.name)||e.writeCategory(c,o)}for(var l=0,f=i[0].customProperties.all;l<f.length;l++){var p=f[l];if(p.cifExport&&0!==p.cifExport.categories.length){var h=p.cifExport.prefix,m=p.cifExport.categories,v=o;if(p.cifExport.context){var b=d.ModelPropertyDescriptor.getUUID(p);o.cache[b+"__ctx"]?v=o.cache[b+"__ctx"]:(v=p.cifExport.context(o)||o,o.cache[b+"__ctx"]=v)}for(var g=0,_=m;g<_.length;g++){c=_[g];if(!a.skipCategoryNames||!a.skipCategoryNames.has(c.name)){if(0!==c.name.indexOf(h))throw new Error("Custom category '"+c.name+"' name must start with prefix '"+h+".'");e.writeCategory(c,v)}}}}}!function(e){e.AtomSitePositionsFieldNames=new Set(["id","Cartn_x","Cartn_y","Cartn_z"])}(m||(m={})),t.mmCIF_Export_Filters={onlyPositions:{includeCategory:function(e){return"atom_site"===e},includeField:function(e,t){return m.AtomSitePositionsFieldNames.has(t)}}},t.encode_mmCIF_categories=v,t.default=function(e,t,n){void 0===n&&(n=!1);var r=i.CifWriter.createEncoder({binary:n});return r.startDataBlock(e),v(r,t),r.getData()}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(5),i=n(44),a=n(43),o=i.CifWriter.Field,u=n(201);function s(e,t){var n=e.element,r=t.element;return n.sheet_id<r.sheet_id?-1:n.sheet_id===r.sheet_id?e.start.element-t.start.element:1}t._struct_conf={name:"struct_conf",instance:function(e){var t=f(e,"helix");return{fields:c,source:[{data:t,rowCount:t.length}]}}},t._struct_sheet_range={name:"struct_sheet_range",instance:function(e){var t=f(e,"sheet").sort(s);return{fields:l,source:[{data:t,rowCount:t.length}]}}};var c=[o.str("conf_type_id",function(e,t){return t[e].element.type_id}),o.str("id",function(e,t,n){return""+t[e].element.type_id+(n+1)})].concat(u.residueIdFields(function(e,t){return t[e].start},{prefix:"beg"}),u.residueIdFields(function(e,t){return t[e].end},{prefix:"end"}),[o.str("pdbx_PDB_helix_class",function(e,t){return t[e].element.helix_class}),o.str("details",function(e,t){return t[e].element.details||""},{valueKind:function(e,t){return t[e].element.details?0:2}}),o.int("pdbx_PDB_helix_class",function(e,t){return t[e].length})]),l=[o.str("sheet_id",function(e,t){return t[e].element.sheet_id}),o.index("id")].concat(u.residueIdFields(function(e,t){return t[e].start},{prefix:"beg"}),u.residueIdFields(function(e,t){return t[e].end},{prefix:"end"}),[o.str("symmetry",function(e,t){return""},{valueKind:function(e,t){return 2}})]);function f(e,t){for(var n=e.structures[0].model.properties.secondaryStructure,i=n.key,o=n.elements,u=[],s=0,c=e.structures[0].units;s<c.length;s++){var l=c[s];if(a.Unit.isAtomic(l)&&l.conformation.operator.isIdentity)for(var f=l.model.atomicHierarchy.residueAtomSegments,d=r.Segmentation.transientSegments(f,l.elements),p=void 0,h=!0;d.hasNext;){h&&(p=d.move());var m=p.index,y=i[m],v=o[y];if(v.kind===t){for(var b=m;d.hasNext;)if(b=p.index,y!==i[(p=d.move()).index]){h=!1,u[u.length]={start:a.StructureElement.create(l,f.offsets[m]),end:a.StructureElement.create(l,f.offsets[b]),length:b-m+1,element:v};break}}else h=!0}}return u}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(5),i=n(44),a=n(9),o=i.CifWriter.Field,u=[o.index("id"),o.str("label_comp_id",function(e,t){return a.StructureProperties.residue.label_comp_id(t[e])}),o.int("label_seq_id",function(e,t){return a.StructureProperties.residue.label_seq_id(t[e])}),o.str("pdbx_PDB_ins_code",function(e,t){return a.StructureProperties.residue.pdbx_PDB_ins_code(t[e])}),o.str("label_asym_id",function(e,t){return a.StructureProperties.chain.label_asym_id(t[e])}),o.str("label_entity_id",function(e,t){return a.StructureProperties.chain.label_entity_id(t[e])}),o.str("auth_comp_id",function(e,t){return a.StructureProperties.residue.auth_comp_id(t[e])}),o.int("auth_seq_id",function(e,t){return a.StructureProperties.residue.auth_seq_id(t[e])}),o.str("auth_asym_id",function(e,t){return a.StructureProperties.chain.auth_asym_id(t[e])}),o.str("parent_comp_id",function(e,t){return t[e].unit.model.properties.modifiedResidues.parentId.get(a.StructureProperties.residue.label_comp_id(t[e]))}),o.str("details",function(e,t){return t[e].unit.model.properties.modifiedResidues.details.get(a.StructureProperties.residue.label_comp_id(t[e]))})];t._pdbx_struct_mod_residue={name:"pdbx_struct_mod_residue",instance:function(e){var t=function(e){var t=e.structures[0],n=t.model.properties.modifiedResidues.parentId;if(!n.size)return[];for(var i=[],o=a.StructureProperties.residue.label_comp_id,u=a.StructureElement.create(),s=0,c=t.units;s<c.length;s++){var l=c[s];if(a.Unit.isAtomic(l)&&l.conformation.operator.isIdentity){var f=r.Segmentation.transientSegments(l.model.atomicHierarchy.residueAtomSegments,l.elements);for(u.unit=l;f.hasNext;){var d=f.move();u.element=l.elements[d.start];var p=o(u);n.has(p)&&(i[i.length]=a.StructureElement.create(u.unit,u.element))}}}return i}(e);return{fields:u,source:[{data:t,rowCount:t.length}]}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(21),i=n(44),a=n(202),o=i.CifWriter.Category;t._chem_comp={name:"chem_comp",instance:function(e){e.firstModel;var t=e.structures,n=e.cache,i=a.getModelMmCifCategory(t[0].model,"chem_comp");if(!i)return o.Empty;var u=i.id,s=n.uniqueResidueNames||(n.uniqueResidueNames=a.getUniqueResidueNamesFromStructures(t)),c=r.Column.indicesOf(u,function(e){return s.has(e)});return o.ofTable(i,c)}},t._pdbx_chem_comp_identifier={name:"pdbx_chem_comp_identifier",instance:function(e){var t=e.firstModel,n=e.structures,i=e.cache,u=a.getModelMmCifCategory(t,"pdbx_chem_comp_identifier");if(!u)return o.Empty;var s=u.comp_id,c=i.uniqueResidueNames||(i.uniqueResidueNames=a.getUniqueResidueNamesFromStructures(n)),l=r.Column.indicesOf(s,function(e){return c.has(e)});return o.ofTable(u,l)}},t._pdbx_nonpoly_scheme={name:"pdbx_nonpoly_scheme",instance:function(e){var t=e.firstModel,n=(e.structures,e.cache,a.getModelMmCifCategory(t,"pdbx_nonpoly_scheme"));return n?o.ofTable(n):o.Empty}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(21),i=n(44),a=n(202),o=i.CifWriter.Category;function u(e){return{name:e,instance:function(t){var n=t.structures,i=t.cache;return function(e,t,n){var i=a.getModelMmCifCategory(e[0].model,t);if(!i)return o.Empty;var u=i.entity_id,s=n.uniqueEntityIds||(n.uniqueEntityIds=a.getUniqueEntityIdsFromStructures(e)),c=r.Column.indicesOf(u,function(e){return s.has(e)});return o.ofTable(i,c)}(n,e,i)}}}t._struct_asym=u("struct_asym"),t._entity_poly=u("entity_poly"),t._entity_poly_seq=u("entity_poly_seq")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(7),i=n(5),a=n(70),o=n(2);!function(e){e.create=function(e,t,n,i,u,s){return{id:r.UUID.create22(),name:e,geometry:t,transforms:s||[o.Mat4.identity()],get groupCount(){return a.Geometry.getGroupCount(t)},getColor:n,getSize:i,getLabel:u}},e.Location=function(e,t,n){return{kind:"group-location",shape:e,group:t||0,instance:n||0}},e.isLocation=function(e){return!!e&&"group-location"===e.kind},e.Loci=function(e,t,n){return{kind:"group-loci",shape:e,groups:t,instance:n}},e.isLoci=function(e){return!!e&&"group-loci"===e.kind},e.areLociEqual=function(e,t){if(e.shape!==t.shape)return!1;if(e.groups.length!==t.groups.length)return!1;if(e.instance!==t.instance)return!1;for(var n=0,r=e.groups.length;n<r;++n){var a=e.groups[n],o=t.groups[n];if(!i.OrderedSet.areEqual(a.ids,o.ids))return!1}return!0}}(t.Shape||(t.Shape={}))},function(e,t,n){"use strict";function r(e,t,n,r,i){n[0]=0,r[0]=Number.MIN_SAFE_INTEGER,r[1]=Number.MAX_SAFE_INTEGER;for(var a=1,o=0;a<i;a++){for(var u=(e[a]+a*a-(e[n[o]]+n[o]*n[o]))/(2*a-2*n[o]);u<=r[o];)o--,u=(e[a]+a*a-(e[n[o]]+n[o]*n[o]))/(2*a-2*n[o]);n[++o]=a,r[o]=u,r[o+1]=Number.MAX_SAFE_INTEGER}for(a=0,o=0;a<i;a++){for(;r[o+1]<a;)o++;t[a]=(a-n[o])*(a-n[o])+e[n[o]]}}Object.defineProperty(t,"__esModule",{value:!0}),t.edt=function(e,t,n,i,a,o,u){for(var s=0;s<t;s++){for(var c=0;c<n;c++)i[c]=e[c*t+s];for(r(i,a,o,u,n),c=0;c<n;c++)e[c*t+s]=a[c]}for(c=0;c<n;c++){for(s=0;s<t;s++)i[s]=e[c*t+s];for(r(i,a,o,u,t),s=0;s<t;s++)e[c*t+s]=Math.sqrt(a[s])}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(113),i=n(18),a=n(7);t.getControlPointsFromString=function(e){return e.split(/\s*,\s*/).map(function(e){var t=e.split(/\s*:\s*/);return{x:parseFloat(t[0]),alpha:parseFloat(t[1])}})},t.getControlPointsFromVec2Array=function(e){return e.map(function(e){return{x:e[0],alpha:e[1]}})},t.createTransferFunctionTexture=function(e,t,n){for(var o,u,s,c,l,f,d=[{x:0,alpha:0},{x:0,alpha:0}].concat(e,[{x:1,alpha:0},{x:1,alpha:0}]),p=i.ColorScale.create({domain:[0,1],listOrName:t}),h=n?n.ref.value.array:new Uint8Array(1024),m=0,y=e.length+1,v=0;v<y;++v){o=d[v+1].x,u=d[v+2].x,s=d[v].alpha,c=d[v+1].alpha,l=d[v+2].alpha,f=d[v+3].alpha;for(var b=Math.round(256*(u-o)),g=0;g<b;++g){var _=g/b;h[4*m+3]=Math.max(0,255*r.spline(s,c,l,f,_,.5)),p.colorToArray(m/255,h,4*m),++m}}var S={array:h,width:256,height:1};return n?(a.ValueCell.update(n,S),n):a.ValueCell.create(S)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(90),i=function(){function e(){this.count=0,this.center=r.Vec3.zero(),this.radiusSq=0}return e.prototype.reset=function(){r.Vec3.set(this.center,0,0,0),this.radiusSq=0,this.count=0},e.prototype.includeStep=function(e){r.Vec3.add(this.center,this.center,e),this.count++},e.prototype.finishedIncludeStep=function(){0!==this.count&&r.Vec3.scale(this.center,this.center,1/this.count)},e.prototype.radiusStep=function(e){var t=r.Vec3.squaredDistance(e,this.center);t>this.radiusSq&&(this.radiusSq=t)},e}();t.CentroidHelper=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(9),i=n(134),a=n(18),o=n(3),u=n(35),s=a.Color(13421772),c="Assigns colors according to the Symbol Nomenclature for Glycans (SNFG).";function l(e){return t.CarbohydrateSymbolColorThemeParams}function f(e,t){var n;if(e.structure){var a=e.structure.carbohydrates,o=a.elements,l=a.getElementIndex,d=a.getAnomericCarbon,p=function(e,t){var n=e.model.atomicHierarchy.residueAtomSegments.index[t],r=d(e,n);if(void 0!==r){var i=l(e,r);if(void 0!==i)return o[i].component.color}return s};n=function(e,t){return t?i.SaccharideColors.Secondary:r.StructureElement.isLocation(e)?p(e.unit,e.element):r.Link.isLocation(e)?p(e.aUnit,e.aUnit.elements[e.aIndex]):s}}else n=function(){return s};return{factory:f,granularity:"group",color:n,props:t,description:c,legend:u.TableLegend(i.MonosaccharidesColorTable)}}t.CarbohydrateSymbolColorThemeParams={},t.getCarbohydrateSymbolColorThemeParams=l,t.CarbohydrateSymbolColorTheme=f,t.CarbohydrateSymbolColorThemeProvider={label:"Carbohydrate Symbol",factory:f,getParams:l,defaultValues:o.ParamDefinition.getDefaultValues(t.CarbohydrateSymbolColorThemeParams),isApplicable:function(e){return!!e.structure}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(9),i=n(18),a=n(3),o=n(50),u=i.Color(13421772),s="Gives every chain a color based on its `asym_id` value.";function c(e){return t.ChainIdColorThemeParams}function l(e){switch(e.kind){case 0:return r.StructureProperties.chain.label_asym_id;case 1:case 2:return r.StructureProperties.coarse.asym_id}}function f(e,t){for(var n=e.size,r=0,i=t.rowCount;r<i;++r){var a=t.value(r);e.has(a)||(e.set(a,n),n+=1)}}function d(e,t){var n,a=i.ColorScale.create({listOrName:t.list,minLabel:"Start",maxLabel:"End"});if(e.structure){for(var o=r.StructureElement.create(),c=e.structure.models,p=new Map,h=0,m=c.length;h<m;++h){var y=c[h];f(p,y.atomicHierarchy.chains.label_asym_id),y.coarseHierarchy.isDefined&&(f(p,y.coarseHierarchy.spheres.asym_id),f(p,y.coarseHierarchy.gaussians.asym_id))}a.setDomain(0,p.size-1);var v=a.color;n=function(e){if(r.StructureElement.isLocation(e)){var t=l(e.unit);return v(p.get(t(e))||0)}if(r.Link.isLocation(e)){t=l(e.aUnit);return o.unit=e.aUnit,o.element=e.aUnit.elements[e.aIndex],v(p.get(t(o))||0)}return u}}else n=function(){return u};return{factory:d,granularity:"group",color:n,props:t,description:s,legend:a?a.legend:void 0}}t.ChainIdColorThemeParams={list:a.ParamDefinition.ColorScale("RedYellowBlue",o.ColorListOptions)},t.getChainIdColorThemeParams=c,t.ChainIdColorTheme=d,t.ChainIdColorThemeProvider={label:"Chain Id",factory:d,getParams:c,defaultValues:a.ParamDefinition.getDefaultValues(t.ChainIdColorThemeParams),isApplicable:function(e){return!!e.structure}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(9),i=n(18),a=n(2),o=n(3),u=n(50),s=i.Color(13421772),c="Colors cross-links by the deviation of the observed distance versus the modeled distance (e.g. `ihm_cross_link_restraint.distance_threshold`).";function l(e){return t.CrossLinkColorThemeParams}t.CrossLinkColorThemeParams={domain:o.ParamDefinition.Interval([-10,10]),list:o.ParamDefinition.ColorScale("RedGrey",u.ColorListOptions)},t.getCrossLinkColorThemeParams=l;var f=a.Vec3.zero(),d=a.Vec3.zero();function p(e,t){var n,o=void 0;if(e.structure){var u=e.structure.crossLinkRestraints,l=(o=i.ColorScale.create({domain:t.domain,listOrName:t.list})).color;n=function(e){if(r.Link.isLocation(e)){var t=u.getPairs(e.aIndex,e.aUnit,e.bIndex,e.bUnit);if(t)return l(((n=e).aUnit.conformation.position(n.aUnit.elements[n.aIndex],f),n.bUnit.conformation.position(n.bUnit.elements[n.bIndex],d),a.Vec3.distance(f,d)-t[0].distanceThreshold))}var n;return s}}else n=function(){return s};return{factory:p,granularity:"group",color:n,props:t,description:c,legend:o?o.legend:void 0}}t.CrossLinkColorTheme=p,t.CrossLinkColorThemeProvider={label:"Cross Link",factory:p,getParams:l,defaultValues:o.ParamDefinition.getDefaultValues(t.CrossLinkColorThemeParams),isApplicable:function(e){return!!e.structure}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(18),i=n(9),a=n(5),o=n(3),u=n(50),s=r.Color(13421772),c="Gives every element (atom or coarse sphere/gaussian) a unique color based on the position (index) of the element in the list of elements in the structure.";function l(e){return t.ElementIndexColorThemeParams}function f(e,t){var n,o=r.ColorScale.create({listOrName:t.list,minLabel:"Start",maxLabel:"End"});if(e.structure){for(var u=e.structure.units,l=u.length,d=new Map,p=new Map,h=0,m=0;m<l;++m)d.set(m,h),h+=u[m].elements.length,p.set(u[m].id,m);o.setDomain(0,h-1);var y=o.color;n=function(e){if(i.StructureElement.isLocation(e)){var t=p.get(e.unit.id),n=a.OrderedSet.findPredecessorIndex(e.unit.elements,e.element);return y(d.get(t)+n)}if(i.Link.isLocation(e)){t=p.get(e.aUnit.id);return y(d.get(t)+e.aIndex)}return s}}else n=function(){return s};return{factory:f,granularity:"groupInstance",color:n,props:t,description:c,legend:o?o.legend:void 0}}t.ElementIndexColorThemeParams={list:o.ParamDefinition.ColorScale("RedYellowBlue",u.ColorListOptions)},t.getElementIndexColorThemeParams=l,t.ElementIndexColorTheme=f,t.ElementIndexColorThemeProvider={label:"Element Index",factory:f,getParams:l,defaultValues:o.ParamDefinition.getDefaultValues(t.ElementIndexColorThemeParams),isApplicable:function(e){return!!e.structure}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(18),i=n(9),a=n(3),o=n(35);t.ElementSymbolColors=r.ColorMap({H:16777215,D:16777152,T:16777120,HE:14286847,LI:13402367,BE:12779264,B:16758197,C:9474192,N:3166456,O:16715021,F:9494608,NE:11789301,NA:11230450,MG:9109248,AL:12560038,SI:1578e4,P:16744448,S:16777008,CL:2093087,AR:8442339,K:9388244,CA:4062976,SC:15132390,TI:12567239,V:10921643,CR:9083335,MN:10255047,FE:14706227,CO:15765664,NI:5296208,CU:13140019,ZN:8224944,GA:12750735,GE:6721423,AS:12419299,SE:16752896,BR:10889513,KR:6076625,RB:7351984,SR:65280,Y:9764863,ZR:9756896,NB:7586505,MO:5551541,TC:3907230,RU:2396047,RH:687500,PD:27013,AG:12632256,CD:16767375,IN:10909043,SN:6717568,SB:10380213,TE:13924864,I:9699476,XE:9699476,CS:5707663,BA:51456,LA:7394559,CE:16777159,PR:14286791,ND:13107143,PM:10747847,SM:9437127,EU:6422471,GD:4587463,TB:3211207,DY:2097095,HO:65436,ER:58997,TM:54354,YB:48952,LU:43812,HF:5096191,TA:5089023,W:2200790,RE:2522539,OS:2516630,IR:1528967,PT:13684960,AU:16765219,HG:12105936,TL:10900557,PB:5724513,BI:10375093,PO:11230208,AT:7688005,RN:4358806,FR:4325478,RA:32e3,AC:7384058,TH:47871,PA:41471,U:36863,NP:33023,PU:27647,AM:5528818,CM:7888099,BK:9064419,CF:10565332,ES:11739092,FM:11739066,MD:11734438,NO:12389767,LR:13041766,RF:13369433,DB:13697103,SG:14221381,BH:14680120,HS:15073326,MT:15400998,DS:16777215,RG:16777215,CN:16777215,UUT:16777215,FL:16777215,UUP:16777215,LV:16777215,UUH:16777215});var u=r.Color(16777215),s="Assigns a color to every atom according to its chemical element.";function c(e){return t.ElementSymbolColorThemeParams}function l(e){var n=t.ElementSymbolColors[e];return void 0===n?u:n}function f(e,n){return{factory:f,granularity:"group",color:function(e){if(i.StructureElement.isLocation(e)){if(i.Unit.isAtomic(e.unit))return l(e.unit.model.atomicHierarchy.atoms.type_symbol.value(e.element))}else if(i.Link.isLocation(e)&&i.Unit.isAtomic(e.aUnit))return l(e.aUnit.model.atomicHierarchy.atoms.type_symbol.value(e.aUnit.elements[e.aIndex]));return u},props:n,description:s,legend:o.TableLegend(Object.keys(t.ElementSymbolColors).map(function(e){return[e,t.ElementSymbolColors[e]]}))}}t.ElementSymbolColorThemeParams={},t.getElementSymbolColorThemeParams=c,t.elementSymbolColor=l,t.ElementSymbolColorTheme=f,t.ElementSymbolColorThemeProvider={label:"Element Symbol",factory:f,getParams:c,defaultValues:a.ParamDefinition.getDefaultValues(t.ElementSymbolColorThemeParams),isApplicable:function(e){return!!e.structure}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(18),i=n(9),a=n(94),o=n(3),u=n(35),s=r.ColorMap({water:3697840,ion:15729279,protein:12496596,RNA:16629894,DNA:12540695,PNA:4367514,saccharide:8374655}),c=r.Color(16777113),l="Assigns a color based on the molecule type of a residue.";function f(e){return t.MoleculeTypeColorThemeParams}function d(e,t){switch(a.getElementMoleculeType(e,t)){case 2:return s.water;case 3:return s.ion;case 4:return s.protein;case 5:return s.RNA;case 6:return s.DNA;case 7:return s.PNA;case 8:return s.saccharide}return c}function p(e,t){return{factory:p,granularity:"group",color:function(e){return i.StructureElement.isLocation(e)?d(e.unit,e.element):i.Link.isLocation(e)?d(e.aUnit,e.aUnit.elements[e.aIndex]):c},props:t,description:l,legend:u.TableLegend(Object.keys(s).map(function(e){return[e,s[e]]}).concat([["Other/unknown",c]]))}}t.MoleculeTypeColorThemeParams={},t.getMoleculeTypeColorThemeParams=f,t.moleculeTypeColor=d,t.MoleculeTypeColorTheme=p,t.MoleculeTypeColorThemeProvider={label:"Molecule Type",factory:p,getParams:f,defaultValues:o.ParamDefinition.getDefaultValues(t.MoleculeTypeColorThemeParams),isApplicable:function(e){return!!e.structure}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(9),i=n(18),a=n(3),o=n(50),u=i.Color(13421772),s="Gives every polymer chain a color based on its `asym_id` value.";function c(e){return t.PolymerIdColorThemeParams}function l(e){switch(e.kind){case 0:return r.StructureProperties.chain.label_asym_id;case 1:case 2:return r.StructureProperties.coarse.asym_id}}function f(e,t,n,r){for(var i=e.size,a=0,o=t.rowCount;a<o;++a){var u=n.value(a),s=r.getEntityIndex(u);if("polymer"===r.data.type.value(s)){var c=t.value(a);e.has(c)||(e.set(c,i),i+=1)}}}function d(e,t){var n,a=i.ColorScale.create({listOrName:t.list,minLabel:"Start",maxLabel:"End"});if(e.structure){for(var o=r.StructureElement.create(),c=e.structure.models,p=new Map,h=0,m=c.length;h<m;++h)for(var y=0,v=c.length;y<v;++y){var b=c[y];f(p,b.atomicHierarchy.chains.label_asym_id,b.atomicHierarchy.chains.label_entity_id,b.entities),b.coarseHierarchy.isDefined&&(f(p,b.coarseHierarchy.spheres.asym_id,b.coarseHierarchy.spheres.entity_id,b.entities),f(p,b.coarseHierarchy.gaussians.asym_id,b.coarseHierarchy.spheres.entity_id,b.entities))}a.setDomain(0,p.size-1);var g=a.color;n=function(e){if(r.StructureElement.isLocation(e)){var t=l(e.unit);return g(p.get(t(e))||0)}if(r.Link.isLocation(e)){t=l(e.aUnit);return o.unit=e.aUnit,o.element=e.aUnit.elements[e.aIndex],g(p.get(t(o))||0)}return u}}else n=function(){return u};return{factory:d,granularity:"group",color:n,props:t,description:s,legend:a?a.legend:void 0}}t.PolymerIdColorThemeParams={list:a.ParamDefinition.ColorScale("RedYellowBlue",o.ColorListOptions)},t.getPolymerIdColorThemeParams=c,t.PolymerIdColorTheme=d,t.PolymerIdColorThemeProvider={label:"Polymer Id",factory:d,getParams:c,defaultValues:a.ParamDefinition.getDefaultValues(t.PolymerIdColorThemeParams),isApplicable:function(e){return!!e.structure}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(18),i=n(9),a=n(3),o=n(50),u=r.Color(13421772),s="Gives every polymer a unique color based on the position (index) of the polymer in the list of polymers in the structure.";function c(e){return t.PolymerIndexColorThemeParams}function l(e,t){var n,a=r.ColorScale.create({listOrName:t.list,minLabel:"Start",maxLabel:"End"});if(e.structure){for(var o=e.structure.units,c=0,f=0,d=o.length;f<d;++f)o[f].polymerElements.length>0&&++c;a.setDomain(0,c-1);var p=new Map,h=(f=0,0);for(d=o.length;f<d;++f)o[f].polymerElements.length>0&&(p.set(o[f].id,a.color(h)),++h);n=function(e){var t;return i.StructureElement.isLocation(e)?t=p.get(e.unit.id):i.Link.isLocation(e)&&(t=p.get(e.aUnit.id)),void 0!==t?t:u}}else n=function(){return u};return{factory:l,granularity:"instance",color:n,props:t,description:s,legend:a?a.legend:void 0}}t.PolymerIndexColorThemeParams={list:a.ParamDefinition.ColorScale("RedYellowBlue",o.ColorListOptions)},t.getPolymerIndexColorThemeParams=c,t.PolymerIndexColorTheme=l,t.PolymerIndexColorThemeProvider={label:"Polymer Index",factory:l,getParams:c,defaultValues:a.ParamDefinition.getDefaultValues(t.PolymerIndexColorThemeParams),isApplicable:function(e){return!!e.structure}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(18),i=n(9),a=n(3),o=n(35),u=r.ColorMap({ALA:9240460,ARG:124,ASN:16743536,ASP:10485826,CYS:16777072,GLN:16731212,GLU:6684672,GLY:15658734,HIS:7368959,ILE:19456,LEU:4546117,LYS:4671416,MET:12099650,PHE:5459026,PRO:5395026,SER:16740418,THR:12078080,TRP:5195264,TYR:9203788,VAL:16747775,A:14423100,G:3329330,I:10145074,C:16766720,T:4286945,U:4251856,DA:14423100,DG:3329330,DI:10145074,DC:16766720,DT:4286945,DU:4251856,APN:14423100,GPN:3329330,CPN:16766720,TPN:4286945}),s=r.Color(16711935),c="Assigns a color to every residue according to its name.";function l(e){return t.ResidueNameColorThemeParams}function f(e){var t=u[e];return void 0===t?s:t}function d(e,t){var n=e.model.properties.modifiedResidues,r=e.model.atomicHierarchy.residues.auth_comp_id.value(e.residueIndex[t]),i=n.parentId.get(r);return void 0===i?r:i}function p(e,t){var n=e.coarseElements.seq_id_begin.value(t);if(n===e.coarseElements.seq_id_end.value(t)){var r=e.model.properties.modifiedResidues,i=e.coarseElements.entityKey[t],a=e.model.sequence.byEntityKey[i].compId.value(n-1),o=r.parentId.get(a);return void 0===o?a:o}}function h(e,t){return{factory:h,granularity:"group",color:function(e){if(i.StructureElement.isLocation(e)){if(i.Unit.isAtomic(e.unit))return f(d(e.unit,e.element));if(t=p(e.unit,e.element))return f(t)}else if(i.Link.isLocation(e)){if(i.Unit.isAtomic(e.aUnit))return f(d(e.aUnit,e.aUnit.elements[e.aIndex]));var t;if(t=p(e.aUnit,e.aUnit.elements[e.aIndex]))return f(t)}return s},props:t,description:c,legend:o.TableLegend(Object.keys(u).map(function(e){return[e,u[e]]}).concat([["Unknown",s]]))}}t.ResidueNameColorThemeParams={},t.getResidueNameColorThemeParams=l,t.residueNameColor=f,t.ResidueNameColorTheme=h,t.ResidueNameColorThemeProvider={label:"Residue Name",factory:h,getParams:l,defaultValues:a.ParamDefinition.getDefaultValues(t.ResidueNameColorThemeParams),isApplicable:function(e){return!!e.structure}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(18),i=n(9),a=n(23),o=n(94),u=n(3),s=n(35),c=r.ColorMap({alphaHelix:16711808,threeTenHelix:10485888,piHelix:6291584,betaTurn:6324479,betaStrand:16762880,coil:16777215,dna:11403518,rna:16580962,carbohydrate:10921722}),l=r.Color(8421504),f="Assigns a color based on the type of secondary structure and basic molecule type.";function d(e){return t.SecondaryStructureColorThemeParams}function p(e,t){var n=a.SecondaryStructureType.create(0);if(i.Unit.isAtomic(e)&&(n=e.model.properties.secondaryStructure.type[e.residueIndex[t]]),a.SecondaryStructureType.is(n,2))return a.SecondaryStructureType.is(n,1024)?c.threeTenHelix:a.SecondaryStructureType.is(n,16384)?c.piHelix:c.alphaHelix;if(a.SecondaryStructureType.is(n,4))return c.betaStrand;if(a.SecondaryStructureType.is(n,8))return c.coil;var r=o.getElementMoleculeType(e,t);return 6===r?c.dna:5===r?c.rna:8===r?c.carbohydrate:4===r?c.coil:l}function h(e,t){return{factory:h,granularity:"group",color:function(e){return i.StructureElement.isLocation(e)?p(e.unit,e.element):i.Link.isLocation(e)?p(e.aUnit,e.aUnit.elements[e.aIndex]):l},props:t,description:f,legend:s.TableLegend(Object.keys(c).map(function(e){return[e,c[e]]}).concat([["Other",l]]))}}t.SecondaryStructureColorThemeParams={},t.getSecondaryStructureColorThemeParams=d,t.secondaryStructureColor=p,t.SecondaryStructureColorTheme=h,t.SecondaryStructureColorThemeProvider={label:"Secondary Structure",factory:h,getParams:d,defaultValues:u.ParamDefinition.getDefaultValues(t.SecondaryStructureColorThemeParams),isApplicable:function(e){return!!e.structure}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(9),i=n(18),a=n(3),o=n(50),u=i.Color(13421772),s="Gives every polymer residue a color based on its `seq_id` value.";function c(e){return t.SequenceIdColorThemeParams}function l(e,t){var n=e.model;switch(e.kind){case 0:var r=n.atomicHierarchy.residueAtomSegments.index[t];return n.atomicHierarchy.residues.label_seq_id.value(r);case 1:return Math.round((n.coarseHierarchy.spheres.seq_id_begin.value(t)+n.coarseHierarchy.spheres.seq_id_end.value(t))/2);case 2:return Math.round((n.coarseHierarchy.gaussians.seq_id_begin.value(t)+n.coarseHierarchy.gaussians.seq_id_end.value(t))/2)}}function f(e,t){var n=e.model,r="";switch(e.kind){case 0:var i=n.atomicHierarchy.chainAtomSegments.index[t];r=n.atomicHierarchy.chains.label_entity_id.value(i);break;case 1:r=n.coarseHierarchy.spheres.entity_id.value(t);break;case 2:r=n.coarseHierarchy.gaussians.entity_id.value(t)}if(""===r)return 0;var a=n.entities.getEntityIndex(r);return-1===a?0:n.sequence.byEntityKey[a].sequence.sequence.length}function d(e,t){var n=i.ColorScale.create({listOrName:t.list,minLabel:"Start",maxLabel:"End"});return{factory:d,granularity:"group",color:function(e){if(r.StructureElement.isLocation(e)){var t=e.unit,i=e.element;if((a=l(t,i))>0)return n.setDomain(0,f(t,i)-1),n.color(a)}else if(r.Link.isLocation(e)){var a,o=e.aUnit,s=e.aIndex;if((a=l(o,o.elements[s]))>0)return n.setDomain(0,f(o,o.elements[s])-1),n.color(a)}return u},props:t,description:s,legend:n?n.legend:void 0}}t.SequenceIdColorThemeParams={list:a.ParamDefinition.ColorScale("Rainbow",o.ColorListOptions)},t.getSequenceIdColorThemeParams=c,t.SequenceIdColorTheme=d,t.SequenceIdColorThemeProvider={label:"Sequence Id",factory:d,getParams:c,defaultValues:a.ParamDefinition.getDefaultValues(t.SequenceIdColorThemeParams),isApplicable:function(e){return!!e.structure}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(18),i=n(9),a=n(3),o=n(50),u=r.Color(13421772),s="Gives every unit (single chain or collection of single elements) a unique color based on the position (index) of the unit in the list of units in the structure.";function c(e){return t.UnitIndexColorThemeParams}function l(e,t){var n,a=r.ColorScale.create({listOrName:t.list,minLabel:"Start",maxLabel:"End"});if(e.structure){var o=e.structure.units;a.setDomain(0,o.length-1);for(var c=new Map,f=0,d=o.length;f<d;++f)c.set(o[f].id,a.color(f));n=function(e){return i.StructureElement.isLocation(e)?c.get(e.unit.id):i.Link.isLocation(e)?c.get(e.aUnit.id):u}}else n=function(){return u};return{factory:l,granularity:"instance",color:n,props:t,description:s,legend:a?a.legend:void 0}}t.UnitIndexColorThemeParams={list:a.ParamDefinition.ColorScale("RedYellowBlue",o.ColorListOptions)},t.getUnitIndexColorThemeParams=c,t.UnitIndexColorTheme=l,t.UnitIndexColorThemeProvider={label:"Unit Index",factory:l,getParams:c,defaultValues:a.ParamDefinition.getDefaultValues(t.UnitIndexColorThemeParams),isApplicable:function(e){return!!e.structure}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(182),i=n(34),a=n(139),o=n(226),u=n(429),s=i.idFactory();t.createRenderTarget=function(e,t,n){var i=e.gl,c={array:new Uint8Array(t*n*4),width:t,height:n},l=a.createTexture(e,"image-uint8","rgba","ubyte","linear");l.load(c);var f=o.createFramebuffer(e);l.attachFramebuffer(f,"color0");var d=u.createRenderbuffer(e,"depth16","depth",t,n),p=!1;function h(t,n,r,i,a){f.bind(),e.readPixels(t,n,r,i,a)}function m(){return h(0,0,t,n,c.array),c.array}return{id:s(),get width(){return t},get height(){return n},image:c,texture:l,bind:function(){f.bind(),i.viewport(0,0,t,n)},setSize:function(e,r){t=e,n=r,c.array=new Uint8Array(t*n*4),c.width=t,c.height=n,l.load(c),d.setSize(t,n)},readBuffer:h,getBuffer:m,getImageData:function(){return r.createImageData(m(),t,n)},destroy:function(){p||(l.destroy(),f.destroy(),d.destroy(),p=!0)}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(34).idFactory();function i(e,t){var n=e.gl;switch(t){case"depth16":return n.DEPTH_COMPONENT16;case"stencil8":return n.STENCIL_INDEX8;case"rgba4":return n.RGBA4;case"depth-stencil":return n.DEPTH_STENCIL}}function a(e,t){var n=e.gl;switch(t){case"depth":return n.DEPTH_ATTACHMENT;case"stencil":return n.STENCIL_ATTACHMENT;case"depth-stencil":return n.DEPTH_STENCIL_ATTACHMENT;case"color0":return n.COLOR_ATTACHMENT0}}t.getFormat=i,t.getAttachment=a,t.createRenderbuffer=function(e,t,n,o,u){var s=e.gl,c=s.createRenderbuffer();if(null===c)throw new Error("Could not create WebGL renderbuffer");var l=function(){return s.bindRenderbuffer(s.RENDERBUFFER,c)},f=i(e,t),d=a(e,n);l(),s.renderbufferStorage(s.RENDERBUFFER,f,o,u),s.framebufferRenderbuffer(s.FRAMEBUFFER,d,s.RENDERBUFFER,c);var p=!1;return e.renderbufferCount+=1,{id:r(),bind:l,setSize:function(e,t){l(),s.renderbufferStorage(s.RENDERBUFFER,f,e,t)},destroy:function(){p||(s.deleteRenderbuffer(c),p=!0,e.framebufferCount-=1)}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2);!function(e){e.create=function(){return{view:r.Mat4.identity(),position:r.Vec3.create(0,0,0),direction:r.Vec3.create(0,0,-1),up:r.Vec3.create(0,1,0)}};var t=r.Vec3.zero();e.update=function(e){r.Vec3.add(t,e.position,e.direction),r.Mat4.lookAt(e.view,e.position,t,e.up)}}(t.Object3D||(t.Object3D={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(260),i=n(2),a=n(113),o=function(){function e(t){this.camera=t,this.t=0,this.func=e.defaultTransition,this.start=0,this.inTransition=!1,this.durationMs=0,this.source=r.Camera.createDefaultSnapshot(),this.target=r.Camera.createDefaultSnapshot(),this.current=r.Camera.createDefaultSnapshot()}return e.prototype.apply=function(t,n,i){void 0===n&&(n=0),n<=0||t.mode!==this.camera.state.mode?this.finish(t):(r.Camera.copySnapshot(this.source,this.camera.state),r.Camera.copySnapshot(this.target,this.camera.state),r.Camera.copySnapshot(this.target,t),this.inTransition=!0,this.func=i||e.defaultTransition,this.start=this.t,this.durationMs=n)},e.prototype.tick=function(e){this.t=e,this.update()},e.prototype.finish=function(e){r.Camera.copySnapshot(this.camera.state,e),this.inTransition=!1},e.prototype.update=function(){if(this.inTransition){var e=Math.min((this.t-this.start)/this.durationMs,1);1!==e?(this.func(this.current,e,this.source,this.target),r.Camera.copySnapshot(this.camera.state,this.current)):this.finish(this.target)}},e}();t.CameraTransitionManager=o,function(e){e.defaultTransition=function(e,t,n,o){r.Camera.copySnapshot(e,o);var u=i.Quat.identity();i.Quat.slerp(u,u,i.Quat.rotationTo(i.Quat.zero(),n.direction,o.direction),t),i.Vec3.transformQuat(e.direction,n.direction,u),i.Quat.setIdentity(u),i.Quat.slerp(u,u,i.Quat.rotationTo(i.Quat.zero(),n.up,o.up),t),i.Vec3.transformQuat(e.up,n.up,u),i.Vec3.lerp(e.target,n.target,o.target,t);var s=-a.lerp(i.Vec3.distance(n.position,n.target),i.Vec3.distance(o.position,o.target),t);i.Vec3.scale(e.position,e.direction,s),i.Vec3.add(e.position,e.position,e.target),e.zoom=a.lerp(n.zoom,o.zoom,t),e.fov=a.lerp(n.fov,o.fov,t),e.near=a.lerp(n.near,o.near,t),e.far=a.lerp(n.far,o.far,t),e.fogNear=a.lerp(n.fogNear,o.fogNear,t),e.fogFar=a.lerp(n.fogFar,o.fogFar,t)}}(o||(o={})),t.CameraTransitionManager=o},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(79),a=n(54),o=n(126),u=n(29),s=n(3),c=n(259),l=n(19),f=n(35),d=n(207),p=n(7),h=n(70);t.DebugHelperParams={sceneBoundingSpheres:s.ParamDefinition.Boolean(!1,{description:"Show scene bounding spheres."}),objectBoundingSpheres:s.ParamDefinition.Boolean(!1,{description:"Show bounding spheres of render objects."}),instanceBoundingSpheres:s.ParamDefinition.Boolean(!1,{description:"Show bounding spheres of instances."})};var m=function(){function e(e,n,i){this.objectsData=new Map,this.instancesData=new Map,this.scene=c.default.create(e),this.parent=n,this._props=r({},s.ParamDefinition.getDefaultValues(t.DebugHelperParams),i)}return e.prototype.update=function(){var e=this,t=y(this.scene,this.parent.boundingSphere,this.sceneData,f.ColorNames.grey);t&&(this.sceneData=t),this.parent.forEach(function(t,n){var r=e.objectsData.get(n),i=y(e.scene,t.values.boundingSphere.ref.value,r,f.ColorNames.tomato);if(i&&e.objectsData.set(n,i),"mesh"===n.type||"lines"===n.type||"points"===n.type){var a=e.instancesData.get(n),o=y(e.scene,t.values.invariantBoundingSphere.ref.value,a,f.ColorNames.skyblue,{aTransform:n.values.aTransform,matrix:n.values.matrix,transform:n.values.transform,extraTransform:n.values.extraTransform,uInstanceCount:n.values.uInstanceCount,instanceCount:n.values.instanceCount,aInstance:n.values.aInstance});o&&e.instancesData.set(n,o)}}),this.objectsData.forEach(function(t,n){e.parent.has(n)||(e.scene.remove(t.renderObject),e.objectsData.delete(n))}),this.instancesData.forEach(function(t,n){e.parent.has(n)||(e.scene.remove(t.renderObject),e.instancesData.delete(n))}),this.scene.update()},e.prototype.syncVisibility=function(){var e=this;this.sceneData&&(this.sceneData.renderObject.state.visible=this._props.sceneBoundingSpheres),this.parent.forEach(function(t,n){var r=e.objectsData.get(n);r&&(r.renderObject.state.visible=n.state.visible&&e._props.objectBoundingSpheres);var i=e.instancesData.get(n);i&&(i.renderObject.state.visible=n.state.visible&&e._props.instanceBoundingSpheres)})},e.prototype.clear=function(){this.sceneData=void 0,this.objectsData.clear(),this.scene.clear()},Object.defineProperty(e.prototype,"isEnabled",{get:function(){return this._props.sceneBoundingSpheres||this._props.objectBoundingSpheres||this._props.instanceBoundingSpheres},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"props",{get:function(){return this._props},enumerable:!0,configurable:!0}),e.prototype.setProps=function(e){Object.assign(this._props,e),this.isEnabled&&this.update()},e}();function y(e,t,n,r,s){if(!n||!l.Sphere3D.equals(n.boundingSphere,t)){var c=function(e,t){var n=d.sphereVertexCount(2),r=a.MeshBuilder.createState(n,n/2,t);e.radius&&o.addSphere(r,e.center,e.radius,2);return a.MeshBuilder.getMesh(r)}(t,n&&n.mesh),f=n?n.renderObject:function(e,t,n){var r=u.Mesh.Utils.createValuesSimple(e,{alpha:.1,doubleSided:!1},t,1,n);return i.createRenderObject("mesh",r,{visible:!0,pickable:!1,opaque:!1})}(c,r,s);return n?p.ValueCell.update(f.values.drawCount,h.Geometry.getDrawCount(c)):e.add(f),{boundingSphere:l.Sphere3D.clone(t),renderObject:f,mesh:c}}}t.BoundingSphereHelper=m},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),a=n(95);t.DefaultPolyhedronProps={radius:1,detail:0},t.Polyhedron=function(e,n,o){var u=r({},t.DefaultPolyhedronProps,o),s=u.radius,c=u.detail,l=function(){var e=[],t=[],n=new Map;function r(t){var r=t[0].toFixed(5)+"|"+t[1].toFixed(5)+"|"+t[2].toFixed(5),i=n.get(r);return void 0===i&&(i=e.length/3,n.set(r,i),e.push.apply(e,t)),i}return{vertices:e,indices:t,add:function(e,n,i){t.push(r(e),r(n),r(i))}}}(),f=l.vertices,d=l.indices;!function(t){for(var r=i.Vec3.zero(),a=i.Vec3.zero(),o=i.Vec3.zero(),u=0;u<n.length;u+=3)i.Vec3.fromArray(r,e,3*n[u+0]),i.Vec3.fromArray(a,e,3*n[u+1]),i.Vec3.fromArray(o,e,3*n[u+2]),h(r,a,o,t)}(c),a.appplyRadius(f,s);var p=new Float32Array(f.length);return a.computeIndexedVertexNormals(f,d,p),{vertices:new Float32Array(f),normals:new Float32Array(p),indices:new Uint32Array(d)};function h(e,t,n,r){for(var a=Math.pow(2,r),o=[],u=0;u<=a;++u){o[u]=[];var s=i.Vec3.zero();i.Vec3.lerp(s,e,n,u/a);var c=i.Vec3.zero();i.Vec3.lerp(c,t,n,u/a);for(var f=a-u,d=0;d<=f;++d)if(0===d&&u===a)o[u][d]=s;else{var p=i.Vec3.zero();i.Vec3.lerp(p,s,c,d/f),o[u][d]=p}}for(u=0;u<a;++u)for(d=0;d<2*(a-u)-1;++d){var h=Math.floor(d/2);d%2==0?(l.add,l.add(o[u][h+1],o[u+1][h],o[u][h])):l.add(o[u][h+1],o[u+1][h+1],o[u+1][h])}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(83),i=(1+Math.sqrt(5))/2,a=[-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1],o=r.createPrimitive(a,[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]);t.Icosahedron=function(){return o}},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var a=n(32),o=n(436),u=n(450),s=n(454),c=n(458),l=n(460),f=n(468),d=n(469),p=n(471),h=function(e){function n(){var n=e.call(this)||this;return Object.keys(t.BuiltInStructureRepresentations).forEach(function(e){var r=t.BuiltInStructureRepresentations[e];n.add(e,r)}),n}return i(n,e),n}(a.RepresentationRegistry);t.StructureRepresentationRegistry=h,t.BuiltInStructureRepresentations={cartoon:o.CartoonRepresentationProvider,"ball-and-stick":u.BallAndStickRepresentationProvider,carbohydrate:l.CarbohydrateRepresentationProvider,"distance-restraint":d.DistanceRestraintRepresentationProvider,"molecular-surface":s.MolecularSurfaceRepresentationProvider,"molecular-volume":c.MolecularVolumeRepresentationProvider,point:p.PointRepresentationProvider,spacefill:f.SpacefillRepresentationProvider},t.BuiltInStructureRepresentationsNames=Object.keys(t.BuiltInStructureRepresentations),t.BuiltInStructureRepresentationsOptions=t.BuiltInStructureRepresentationsNames.map(function(e){return[e,e]})},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(437),a=n(444),o=n(446),u=n(3),s=n(84),c=n(38),l=n(32),f=n(448),d=n(9),p={"polymer-trace":function(e,t){return s.UnitsRepresentation("Polymer trace mesh",e,t,i.PolymerTraceVisual)},"polymer-gap":function(e,t){return s.UnitsRepresentation("Polymer gap cylinder",e,t,a.PolymerGapVisual)},"nucleotide-block":function(e,t){return s.UnitsRepresentation("Nucleotide block mesh",e,t,o.NucleotideBlockVisual)},"direction-wedge":function(e,t){return s.UnitsRepresentation("Polymer direction wedge",e,t,f.PolymerDirectionVisual)}},h=Object.keys(p).map(function(e){return[e,e]});function m(e,n){var r=u.ParamDefinition.clone(t.CartoonParams),i=!1,a=!1;return n.units.forEach(function(e){!i&&d.Unit.isAtomic(e)&&e.nucleotideElements.length&&(i=!0),!a&&e.gapElements.length&&(a=!0)}),r.visuals.defaultValue=["polymer-trace"],i&&r.visuals.defaultValue.push("nucleotide-block"),a&&r.visuals.defaultValue.push("polymer-gap"),r}function y(e,t){return l.Representation.createMulti("Cartoon",e,t,c.StructureRepresentationStateBuilder,p)}t.CartoonParams=r({},i.PolymerTraceParams,a.PolymerGapParams,o.NucleotideBlockParams,f.PolymerDirectionParams,{sizeFactor:u.ParamDefinition.Numeric(.2,{min:0,max:10,step:.01}),visuals:u.ParamDefinition.MultiSelect(["polymer-trace","polymer-gap","nucleotide-block"],h)}),t.getCartoonParams=m,t.CartoonRepresentation=y,t.CartoonRepresentationProvider={label:"Cartoon",description:"Displays a ribbon smoothly following the trace atoms of polymers.",factory:y,getParams:m,defaultValues:u.ParamDefinition.getDefaultValues(t.CartoonParams),defaultColorTheme:"polymer-id",defaultSizeTheme:"uniform"}},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(9),a=n(97),o=n(23),u=n(46),s=n(3),c=n(29),l=n(54),f=n(442),d=n(443);function p(e,t,n,r,u,s){var p,h=t.polymerElements.length;if(!h)return c.Mesh.createEmpty(s);for(var m=u.sizeFactor,y=u.linearSegments,v=u.radialSegments,b=u.aspectRatio,g=u.arrowFactor,_=y*v*h+(v+1)*h*2,S=l.MeshBuilder.createState(_,_/10,s),C=i.Unit.isCoarse(t),x=a.createCurveSegmentState(y),w=x.curvePoints,P=x.normalVectors,T=x.binormalVectors,A=0,E=a.PolymerTraceIterator(t);E.hasNext;){var k=E.move();S.currentGroup=A;var I=o.isNucleic(k.moleculeType),M=o.SecondaryStructureType.is(k.secStrucType,4),V=o.SecondaryStructureType.is(k.secStrucType,2),O=I?.5:.9,D=I?.3:.5;a.interpolateCurveSegment(x,k,O,D);var R=r.size.size(k.center)*m;if(C&&(R*=b/2),M){var j=R*b,N=k.secStrucLast?j*g:0;f.addSheet(S,w,P,T,y,R,j,N,k.secStrucFirst,k.secStrucLast)}else{j=void 0;V?j=R*b:I?(R=(p=[j=R*b,R])[0],j=p[1]):j=R,d.addTube(S,w,P,T,y,v,R,j,1,k.secStrucFirst,k.secStrucLast)}++A}return l.MeshBuilder.getMesh(S)}t.PolymerTraceMeshParams={sizeFactor:s.ParamDefinition.Numeric(.2,{min:0,max:10,step:.01}),linearSegments:s.ParamDefinition.Numeric(8,{min:1,max:48,step:1}),radialSegments:s.ParamDefinition.Numeric(16,{min:3,max:56,step:1}),aspectRatio:s.ParamDefinition.Numeric(5,{min:.1,max:5,step:.1}),arrowFactor:s.ParamDefinition.Numeric(1.5,{min:.1,max:5,step:.1})},t.DefaultPolymerTraceMeshProps=s.ParamDefinition.getDefaultValues(t.PolymerTraceMeshParams),t.PolymerTraceParams=r({},u.UnitsMeshParams,t.PolymerTraceMeshParams),t.PolymerTraceVisual=function(){return u.UnitsMeshVisual({defaultProps:s.ParamDefinition.getDefaultValues(t.PolymerTraceParams),createGeometry:p,createLocationIterator:a.PolymerLocationIterator.fromGroup,getLoci:a.getPolymerElementLoci,mark:a.markPolymerElement,setUpdateState:function(e,t,n){e.createGeometry=t.sizeFactor!==n.sizeFactor||t.linearSegments!==n.linearSegments||t.radialSegments!==n.radialSegments||t.aspectRatio!==n.aspectRatio||t.arrowFactor!==n.arrowFactor}})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(9),i=n(5),a=n(91),o=n(97);function u(e){return{centerA:r.StructureElement.create(e),centerB:r.StructureElement.create(e)}}t.PolymerBackboneIterator=function(e){switch(e.kind){case 0:return new s(e);case 1:case 2:return new c(e)}};var s=function(){function e(e){this.unit=e,this.state=0,this.hasNext=!1,this.traceElementIndex=e.model.atomicHierarchy.derived.residue.traceElementIndex,this.polymerIt=a.default.transientSegments(o.getPolymerRanges(e),e.elements),this.residueIt=i.Segmentation.transientSegments(e.model.atomicHierarchy.residueAtomSegments,e.elements),this.value=u(e),this.hasNext=this.residueIt.hasNext&&this.polymerIt.hasNext}return e.prototype.move=function(){if(0===this.state)for(;this.polymerIt.hasNext;)if(this.residueIt.setSegment(this.polymerIt.move()),this.residueIt.hasNext){this.residueSegment=this.residueIt.move(),this.value.centerB.element=this.traceElementIndex[this.residueSegment.index],this.state=2;break}if(2===this.state)this.residueSegment=this.residueIt.move(),this.value.centerA.element=this.value.centerB.element,this.value.centerB.element=this.traceElementIndex[this.residueSegment.index],this.residueIt.hasNext||(this.unit.model.atomicHierarchy.cyclicPolymerMap.has(this.residueSegment.index)?this.state=3:this.state=0);else if(3===this.state){var e=this.unit.model.atomicHierarchy.cyclicPolymerMap;this.value.centerA.element=this.value.centerB.element,this.value.centerB.element=this.traceElementIndex[e.get(this.residueSegment.index)],this.state=0}return this.hasNext=this.residueIt.hasNext||this.polymerIt.hasNext||3===this.state,this.value},e}();t.AtomicPolymerBackboneIterator=s;var c=function(){function e(e){this.unit=e,this.state=0,this.hasNext=!1,this.polymerIt=a.default.transientSegments(o.getPolymerRanges(e),e.elements),this.value=u(e),this.hasNext=this.polymerIt.hasNext}return e.prototype.move=function(){return 0===this.state&&this.polymerIt.hasNext&&(this.polymerSegment=this.polymerIt.move(),this.elementIndex=this.polymerSegment.start,this.elementIndex+1<this.polymerSegment.end?(this.value.centerB.element=this.unit.elements[this.elementIndex],this.state=1):this.state=0),1===this.state&&(this.elementIndex+=1,this.value.centerA.element=this.value.centerB.element,this.value.centerB.element=this.unit.elements[this.elementIndex],this.elementIndex+1>=this.polymerSegment.end&&(this.state=0)),this.hasNext=this.elementIndex+1<this.polymerSegment.end||this.polymerIt.hasNext,this.value},e}();t.CoarsePolymerBackboneIterator=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(9),i=n(91),a=n(97);function o(e){return{centerA:r.StructureElement.create(e),centerB:r.StructureElement.create(e)}}t.PolymerGapIterator=function(e){switch(e.kind){case 0:return new u(e);case 1:case 2:return new s(e)}};var u=function(){function e(e){this.unit=e,this.hasNext=!1,this.traceElementIndex=e.model.atomicHierarchy.derived.residue.traceElementIndex,this.gapIt=i.default.transientSegments(a.getGapRanges(e),e.elements),this.value=o(e),this.hasNext=this.gapIt.hasNext}return e.prototype.move=function(){var e=this.unit,t=e.elements,n=e.residueIndex,r=this.gapIt.move();return this.value.centerA.element=this.traceElementIndex[n[t[r.start]]],this.value.centerB.element=this.traceElementIndex[n[t[r.end-1]]],this.hasNext=this.gapIt.hasNext,this.value},e}();t.AtomicPolymerGapIterator=u;var s=function(){function e(e){this.unit=e,this.hasNext=!1,this.gapIt=i.default.transientSegments(a.getGapRanges(e),e.elements),this.value=o(e),this.hasNext=this.gapIt.hasNext}return e.prototype.move=function(){var e=this.gapIt.move();return this.value.centerA.element=this.unit.elements[e.start],this.value.centerB.element=this.unit.elements[e.end-1],this.hasNext=this.gapIt.hasNext,this.value},e}();t.CoarsePolymerGapIterator=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(9),i=n(5),a=n(23),o=n(2),u=n(91),s=n(97);t.PolymerTraceIterator=function(e){switch(e.kind){case 0:return new f(e);case 1:case 2:return new d(e)}};var c=a.SecondaryStructureType.create(268435456);function l(e){return{center:r.StructureElement.create(e),first:!1,last:!1,secStrucFirst:!1,secStrucLast:!1,secStrucType:c,moleculeType:0,p0:o.Vec3.zero(),p1:o.Vec3.zero(),p2:o.Vec3.zero(),p3:o.Vec3.zero(),p4:o.Vec3.zero(),d12:o.Vec3.create(1,0,0),d23:o.Vec3.create(1,0,0)}}var f=function(){function e(e){this.unit=e,this.state=0,this.p0=o.Vec3.zero(),this.p1=o.Vec3.zero(),this.p2=o.Vec3.zero(),this.p3=o.Vec3.zero(),this.p4=o.Vec3.zero(),this.p5=o.Vec3.zero(),this.p6=o.Vec3.zero(),this.v12=o.Vec3.zero(),this.v23=o.Vec3.zero(),this.hasNext=!1,this.atomicConformation=e.model.atomicConformation,this.residueAtomSegments=e.model.atomicHierarchy.residueAtomSegments,this.traceElementIndex=e.model.atomicHierarchy.derived.residue.traceElementIndex,this.directionElementIndex=e.model.atomicHierarchy.derived.residue.directionElementIndex,this.moleculeType=e.model.atomicHierarchy.derived.residue.moleculeType,this.cyclicPolymerMap=e.model.atomicHierarchy.cyclicPolymerMap,this.secondaryStructureType=e.model.properties.secondaryStructure.type,this.polymerIt=u.default.transientSegments(s.getPolymerRanges(e),e.elements),this.residueIt=i.Segmentation.transientSegments(this.residueAtomSegments,e.elements),this.value=l(e),this.hasNext=this.residueIt.hasNext&&this.polymerIt.hasNext}return e.prototype.pos=function(e,t){e[0]=this.atomicConformation.x[t],e[1]=this.atomicConformation.y[t],e[2]=this.atomicConformation.z[t]},e.prototype.updateResidueSegmentRange=function(e){var t=this.residueAtomSegments.index;this.residueSegmentMin=t[this.unit.elements[e.start]],this.residueSegmentMax=t[this.unit.elements[e.end-1]]},e.prototype.getResidueIndex=function(e){if(e<this.residueSegmentMin)e=void 0!==(t=this.cyclicPolymerMap.get(this.residueSegmentMin))?t-(this.residueSegmentMin-e-1):this.residueSegmentMin;else if(e>this.residueSegmentMax){var t;e=void 0!==(t=this.cyclicPolymerMap.get(this.residueSegmentMax))?t+(e-this.residueSegmentMax-1):this.residueSegmentMax}return e},e.prototype.setControlPoint=function(e,t,n,r,i){var u=this.secondaryStructureType[i];a.SecondaryStructureType.is(u,4)?o.Vec3.scale(e,o.Vec3.add(e,t,o.Vec3.add(e,r,o.Vec3.add(e,n,n))),.25):o.Vec3.copy(e,n)},e.prototype.move=function(){var e=this.residueIt,t=this.polymerIt,n=this.value;if(0===this.state)for(;t.hasNext;)if(this.polymerSegment=t.move(),e.setSegment(this.polymerSegment),this.updateResidueSegmentRange(this.polymerSegment),e.hasNext){this.state=1,this.currSecStrucType=c,this.nextSecStrucType=this.secondaryStructureType[this.residueSegmentMin];break}if(1===this.state){var r=e.move().index;this.prevSecStrucType=this.currSecStrucType,this.currSecStrucType=this.nextSecStrucType,this.nextSecStrucType=e.hasNext?this.secondaryStructureType[r+1]:c,n.secStrucType=this.currSecStrucType,n.center.element=this.traceElementIndex[r],n.first=r===this.residueSegmentMin,n.last=r===this.residueSegmentMax,n.secStrucFirst=this.prevSecStrucType!==this.currSecStrucType,n.secStrucLast=this.currSecStrucType!==this.nextSecStrucType,n.moleculeType=this.moleculeType[r],n.first?(this.pos(this.p0,this.traceElementIndex[this.getResidueIndex(r-3)]),this.pos(this.p1,this.traceElementIndex[this.getResidueIndex(r-2)]),this.pos(this.p2,this.traceElementIndex[this.getResidueIndex(r-1)]),this.pos(this.p3,n.center.element),this.pos(this.p4,this.traceElementIndex[this.getResidueIndex(r+1)]),this.pos(this.p5,this.traceElementIndex[this.getResidueIndex(r+2)]),this.pos(this.v12,this.directionElementIndex[this.getResidueIndex(r-1)])):(o.Vec3.copy(this.p0,this.p1),o.Vec3.copy(this.p1,this.p2),o.Vec3.copy(this.p2,this.p3),o.Vec3.copy(this.p3,this.p4),o.Vec3.copy(this.p4,this.p5),o.Vec3.copy(this.p5,this.p6),o.Vec3.copy(this.v12,this.v23)),this.pos(this.p6,this.traceElementIndex[this.getResidueIndex(r+3)]),this.pos(this.v23,this.directionElementIndex[r]),this.setControlPoint(n.p0,this.p0,this.p1,this.p2,r-2),this.setControlPoint(n.p1,this.p1,this.p2,this.p3,r-1),this.setControlPoint(n.p2,this.p2,this.p3,this.p4,r),this.setControlPoint(n.p3,this.p3,this.p4,this.p5,r+1),this.setControlPoint(n.p4,this.p4,this.p5,this.p6,r+2),o.Vec3.copy(n.d12,this.v12),o.Vec3.copy(n.d23,this.v23),e.hasNext||(this.state=0)}return this.hasNext=e.hasNext||t.hasNext,this.value},e}();t.AtomicPolymerTraceIterator=f;var d=function(){function e(e){switch(this.unit=e,this.state=0,this.hasNext=!1,this.polymerIt=u.default.transientSegments(s.getPolymerRanges(e),e.elements),this.value=l(e),e.kind){case 1:this.conformation=e.model.coarseConformation.spheres;break;case 2:this.conformation=e.model.coarseConformation.gaussians}this.hasNext=this.polymerIt.hasNext}return e.prototype.pos=function(e,t){t=Math.min(Math.max(this.polymerSegment.start,t),this.polymerSegment.end-1);var n=this.unit.elements[t];e[0]=this.conformation.x[n],e[1]=this.conformation.y[n],e[2]=this.conformation.z[n]},e.prototype.move=function(){if(0===this.state)for(;this.polymerIt.hasNext;)if(this.polymerSegment=this.polymerIt.move(),this.elementIndex=this.polymerSegment.start,this.elementIndex+1<this.polymerSegment.end){this.state=1;break}return 1===this.state&&(this.elementIndex+=1,this.value.center.element=this.value.center.unit.elements[this.elementIndex],this.pos(this.value.p0,this.elementIndex-2),this.pos(this.value.p1,this.elementIndex-1),this.pos(this.value.p2,this.elementIndex),this.pos(this.value.p3,this.elementIndex+1),this.pos(this.value.p4,this.elementIndex+2),this.value.first=this.elementIndex===this.polymerSegment.start,this.value.last=this.elementIndex===this.polymerSegment.end-1,this.elementIndex+1>=this.polymerSegment.end&&(this.state=0)),this.hasNext=this.elementIndex+1<this.polymerSegment.end||this.polymerIt.hasNext,this.value},e}();t.CoarsePolymerTraceIterator=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2);t.createCurveSegmentState=function(e){var t=3*(e+1);return{curvePoints:new Float32Array(t),tangentVectors:new Float32Array(t),normalVectors:new Float32Array(t),binormalVectors:new Float32Array(t),linearSegments:e}},t.interpolateCurveSegment=function(e,t,n,r){u(e,t,n,r),g(e,t)};var i=r.Vec3.zero(),a=r.Vec3.zero(),o=r.Vec3.zero();function u(e,t,n,u){for(var s=e.curvePoints,l=e.tangentVectors,f=e.linearSegments,d=t.p0,p=t.p1,h=t.p2,m=t.p3,y=t.p4,v=1-u,b=0;b<=f;++b){var g=1*b/f;g<v?(r.Vec3.spline(o,d,p,h,m,g+u,n),r.Vec3.spline(i,d,p,h,m,g+u+.01,n),r.Vec3.spline(a,d,p,h,m,g+u-.01,n)):(r.Vec3.spline(o,p,h,m,y,g-v,n),r.Vec3.spline(i,p,h,m,y,g-v+.01,n),r.Vec3.spline(a,p,h,m,y,g-v-.01,n)),r.Vec3.toArray(o,s,3*b),r.Vec3.normalize(c,r.Vec3.sub(c,i,a)),r.Vec3.toArray(c,l,3*b)}}t.interpolatePointsAndTangents=u;var s=r.Vec3.zero(),c=r.Vec3.zero(),l=r.Vec3.zero(),f=r.Vec3.zero(),d=r.Vec3.zero(),p=r.Vec3.zero(),h=r.Vec3.zero(),m=r.Vec3.zero(),y=r.Vec3.zero(),v=r.Vec3.zero(),b=r.Vec3.zero();function g(e,t){var n=e.curvePoints,i=e.tangentVectors,a=e.normalVectors,o=e.binormalVectors,u=t.d12,g=t.d23,_=n.length/3;r.Vec3.fromArray(p,n,0),r.Vec3.fromArray(h,n,3*(_-1)),r.Vec3.fromArray(m,i,0),r.Vec3.fromArray(y,i,3*(_-1)),r.Vec3.orthogonalize(v,m,r.Vec3.sub(s,p,u)),r.Vec3.orthogonalize(b,y,r.Vec3.sub(s,h,g)),r.Vec3.dot(v,b)<0&&r.Vec3.scale(b,b,-1),r.Vec3.copy(d,v);for(var S=0;S<_;++S){var C=0===S?0:1/(_-S);r.Vec3.fromArray(c,i,3*S),r.Vec3.orthogonalize(l,c,r.Vec3.slerp(s,d,b,C)),r.Vec3.toArray(l,a,3*S),r.Vec3.copy(d,l),r.Vec3.normalize(f,r.Vec3.cross(f,c,l)),r.Vec3.toArray(f,o,3*S)}}t.interpolateNormals=g},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),i=n(17),a=r.Vec3.zero(),o=r.Vec3.zero(),u=r.Vec3.zero(),s=r.Vec3.zero(),c=r.Vec3.zero(),l=r.Vec3.zero(),f=r.Vec3.zero(),d=r.Vec3.zero(),p=r.Vec3.zero(),h=r.Vec3.zero(),m=r.Vec3.zero(),y=r.Vec3.zero(),v=r.Vec3.zero(),b=r.Vec3.zero(),g=r.Vec3.zero();function _(e,t,n,a,o,u,d,m){var _=t.vertices,S=t.normals,C=t.indices,x=_.elementCount;r.Vec3.fromArray(f,a,e),r.Vec3.scale(f,f,d),r.Vec3.fromArray(l,a,e),r.Vec3.scale(l,l,m),r.Vec3.fromArray(s,o,e),r.Vec3.scale(s,s,u),r.Vec3.fromArray(p,n,e),r.Vec3.add(y,r.Vec3.add(y,p,s),l),r.Vec3.sub(v,r.Vec3.add(v,p,s),f),r.Vec3.sub(b,r.Vec3.sub(b,p,s),f),r.Vec3.add(g,r.Vec3.sub(g,p,s),l),d<m?(i.ChunkedArray.add3(_,g[0],g[1],g[2]),i.ChunkedArray.add3(_,b[0],b[1],b[2]),i.ChunkedArray.add3(_,v[0],v[1],v[2]),i.ChunkedArray.add3(_,y[0],y[1],y[2]),r.Vec3.copy(c,l)):(i.ChunkedArray.add3(_,y[0],y[1],y[2]),i.ChunkedArray.add3(_,v[0],v[1],v[2]),i.ChunkedArray.add3(_,b[0],b[1],b[2]),i.ChunkedArray.add3(_,g[0],g[1],g[2]),r.Vec3.copy(c,f)),r.Vec3.cross(h,s,c);for(var w=0;w<4;++w)i.ChunkedArray.add3(S,h[0],h[1],h[2]);i.ChunkedArray.add3(C,x+2,x+1,x),i.ChunkedArray.add3(C,x,x+3,x+2)}t.addSheet=function(e,t,n,l,f,y,v,b,g,S){var C=e.currentGroup,x=e.vertices,w=e.normals,P=e.indices,T=e.groups,A=x.elementCount,E=0;b>0&&(r.Vec3.fromArray(a,t,0),r.Vec3.fromArray(o,t,3*f),E=b/r.Vec3.magnitude(r.Vec3.sub(u,o,a)));for(var k=0;k<=f;++k){var I=0===b?v:b*(1-k/f),M=3*k;r.Vec3.fromArray(c,n,M),r.Vec3.scale(c,c,I),r.Vec3.fromArray(s,l,M),r.Vec3.scale(s,s,y),b>0&&(r.Vec3.fromArray(a,n,M),r.Vec3.fromArray(o,l,M),r.Vec3.scale(d,r.Vec3.cross(d,a,o),E)),r.Vec3.fromArray(p,t,M),r.Vec3.fromArray(h,n,M),r.Vec3.fromArray(m,l,M),r.Vec3.add(a,r.Vec3.add(a,p,s),c),r.Vec3.copy(o,h),i.ChunkedArray.add3(x,a[0],a[1],a[2]),i.ChunkedArray.add3(w,o[0],o[1],o[2]),r.Vec3.add(a,r.Vec3.sub(a,p,s),c),i.ChunkedArray.add3(x,a[0],a[1],a[2]),i.ChunkedArray.add3(w,o[0],o[1],o[2]),r.Vec3.add(o,r.Vec3.negate(o,m),d),i.ChunkedArray.add3(x,a[0],a[1],a[2]),i.ChunkedArray.add3(w,o[0],o[1],o[2]),r.Vec3.sub(a,r.Vec3.sub(a,p,s),c),i.ChunkedArray.add3(x,a[0],a[1],a[2]),i.ChunkedArray.add3(w,o[0],o[1],o[2]),r.Vec3.negate(o,h),i.ChunkedArray.add3(x,a[0],a[1],a[2]),i.ChunkedArray.add3(w,o[0],o[1],o[2]),r.Vec3.sub(a,r.Vec3.add(a,p,s),c),i.ChunkedArray.add3(x,a[0],a[1],a[2]),i.ChunkedArray.add3(w,o[0],o[1],o[2]),r.Vec3.add(o,m,d),i.ChunkedArray.add3(x,a[0],a[1],a[2]),i.ChunkedArray.add3(w,o[0],o[1],o[2]),r.Vec3.add(a,r.Vec3.add(a,p,s),c),i.ChunkedArray.add3(x,a[0],a[1],a[2]),i.ChunkedArray.add3(w,o[0],o[1],o[2])}for(k=0;k<f;++k)for(var V=0;V<4;V++)i.ChunkedArray.add3(P,A+8*k+2*V,A+8*(k+1)+2*V+1,A+8*k+2*V+1),i.ChunkedArray.add3(P,A+8*k+2*V,A+8*(k+1)+2*V,A+8*(k+1)+2*V+1);if(g){var O=0===b?v:b;_(0,e,t,n,l,y,O,O)}else b>0&&(_(0,e,t,n,l,y,b,-v),_(0,e,t,n,l,y,-b,v));S&&0===b&&_(3*f,e,t,n,l,y,v,v),k=0;for(var D=8*(f+1)+(g?4:b>0?8:0)+(S&&0===b?4:0);k<D;++k)i.ChunkedArray.add(T,C)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),i=n(17),a=r.Vec3.zero(),o=r.Vec3.zero(),u=r.Vec3.zero(),s=r.Vec3.zero(),c=r.Vec3.zero();function l(e,t,n,r,i,a){e[0]=t[0]*i+n[0]*a+r[0],e[1]=t[1]*i+n[1]*a+r[1],e[2]=t[2]*i+n[2]*a+r[2]}t.addTube=function(e,t,n,f,d,p,h,m,y,v,b){for(var g,_,S,C,x,w=e.currentGroup,P=e.vertices,T=e.normals,A=e.indices,E=e.groups,k=P.elementCount,I=1/d,M=0;M<=d;++M){var V=3*M;r.Vec3.fromArray(s,n,V),r.Vec3.fromArray(c,f,V),r.Vec3.fromArray(u,t,V);for(var O=I*M-.5,D=1+(y-1)*(Math.cos(2*Math.PI*O)+1),R=D*h,j=D*m,N=0;N<p;++N){var B=2*Math.PI*N/p;l(o,s,c,u,j*Math.cos(B),R*Math.sin(B)),g=a,_=s,S=c,C=R*Math.cos(B),x=j*Math.sin(B),g[0]=_[0]*C+S[0]*x,g[1]=_[1]*C+S[1]*x,g[2]=_[2]*C+S[2]*x,r.Vec3.normalize(a,a),i.ChunkedArray.add3(P,o[0],o[1],o[2]),i.ChunkedArray.add3(T,a[0],a[1],a[2])}}for(M=0;M<d;++M)for(N=0;N<p;++N)i.ChunkedArray.add3(A,k+M*p+(N+1)%p,k+(M+1)*p+(N+1)%p,k+M*p+N),i.ChunkedArray.add3(A,k+(M+1)*p+(N+1)%p,k+(M+1)*p+N,k+M*p+N);if(v){var F=0,L=P.elementCount;for(r.Vec3.fromArray(s,n,F),r.Vec3.fromArray(c,f,F),r.Vec3.fromArray(u,t,F),r.Vec3.cross(a,c,s),i.ChunkedArray.add3(P,u[0],u[1],u[2]),i.ChunkedArray.add3(T,a[0],a[1],a[2]),k=P.elementCount,M=0;M<p;++M)B=2*Math.PI*M/p,l(o,s,c,u,m*Math.cos(B),h*Math.sin(B)),i.ChunkedArray.add3(P,o[0],o[1],o[2]),i.ChunkedArray.add3(T,a[0],a[1],a[2]),i.ChunkedArray.add3(A,k+(M+1)%p,k+M,L)}if(b)for(F=3*d,L=P.elementCount,r.Vec3.fromArray(s,n,F),r.Vec3.fromArray(c,f,F),r.Vec3.fromArray(u,t,F),r.Vec3.cross(a,s,c),i.ChunkedArray.add3(P,u[0],u[1],u[2]),i.ChunkedArray.add3(T,a[0],a[1],a[2]),k=P.elementCount,M=0;M<p;++M)B=2*Math.PI*M/p,l(o,s,c,u,m*Math.cos(B),h*Math.sin(B)),i.ChunkedArray.add3(P,o[0],o[1],o[2]),i.ChunkedArray.add3(T,a[0],a[1],a[2]),i.ChunkedArray.add3(A,k+M,k+(M+1)%p,L);var z=(d+1)*p+(v?p+1:0)+(b?p+1:0);i.ChunkedArray.addRepeat(E,z,w)}},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(97),a=n(2),o=n(46),u=n(3),s=n(98),c=n(29),l=n(54),f=n(126),d=n(146),p=10;function h(e,t,n,r,o,u){var s=t.gapElements.length;if(!s)return c.Mesh.createEmpty(u);for(var h=o.sizeFactor,m=o.radialSegments,y=p*m*2*s*2,v=l.MeshBuilder.createState(y,y/10,u),b=t.conformation.invariantPosition,g=a.Vec3.zero(),_=a.Vec3.zero(),S={radiusTop:1,radiusBottom:1,topCap:!0,bottomCap:!0,radialSegments:m},C=0,x=i.PolymerGapIterator(t);x.hasNext;){var w=x.move(),P=w.centerA,T=w.centerB;P.element===T.element?(v.currentGroup=C,b(P.element,g),f.addSphere(v,g,.6,0)):(b(P.element,g),b(T.element,_),S.radiusTop=S.radiusBottom=r.size.size(P)*h,v.currentGroup=C,d.addFixedCountDashedCylinder(v,g,_,.5,p,S),S.radiusTop=S.radiusBottom=r.size.size(T)*h,v.currentGroup=C+1,d.addFixedCountDashedCylinder(v,_,g,.5,p,S)),C+=2}return l.MeshBuilder.getMesh(v)}t.PolymerGapCylinderParams={sizeFactor:u.ParamDefinition.Numeric(.2,{min:0,max:10,step:.01}),radialSegments:u.ParamDefinition.Numeric(16,{min:3,max:56,step:1})},t.DefaultPolymerGapCylinderProps=u.ParamDefinition.getDefaultValues(t.PolymerGapCylinderParams),t.InterUnitLinkParams=r({},o.UnitsMeshParams,s.LinkCylinderParams),t.DefaultIntraUnitLinkProps=u.ParamDefinition.getDefaultValues(t.InterUnitLinkParams),t.PolymerGapParams=r({},o.UnitsMeshParams,t.PolymerGapCylinderParams),t.PolymerGapVisual=function(){return o.UnitsMeshVisual({defaultProps:u.ParamDefinition.getDefaultValues(t.PolymerGapParams),createGeometry:h,createLocationIterator:i.PolymerGapLocationIterator.fromGroup,getLoci:i.getPolymerGapElementLoci,mark:i.markPolymerGapElement,setUpdateState:function(e,t,n){e.createGeometry=t.sizeFactor!==n.sizeFactor||t.radialSegments!==n.radialSegments}})}},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(2);t.DefaultCylinderProps={radiusTop:1,radiusBottom:1,height:1,radialSegments:8,heightSegments:1,topCap:!1,bottomCap:!1,thetaStart:0,thetaLength:2*Math.PI},t.Cylinder=function(e){var n=r({},t.DefaultCylinderProps,e),a=n.radiusTop,o=n.radiusBottom,u=n.height,s=n.radialSegments,c=n.heightSegments,l=n.topCap,f=n.bottomCap,d=n.thetaStart,p=n.thetaLength,h=[],m=[],y=[],v=0,b=[],g=u/2;return function(){for(var e=i.Vec3.zero(),t=(o-a)/u,n=0;n<=c;++n){for(var r=[],l=n/c,f=l*(o-a)+a,_=0;_<=s;++_){var S=_/s,C=S*p+d,x=Math.sin(C),w=Math.cos(C);m.push(f*x,-l*u+g,f*w),i.Vec3.normalize(e,i.Vec3.set(e,x,t,w)),y.push.apply(y,e),r.push(v++)}b.push(r)}for(var _=0;_<s;++_)for(var n=0;n<c;++n){var P=b[n][_],T=b[n+1][_],A=b[n+1][_+1],E=b[n][_+1];h.push(P,T,E),h.push(T,A,E)}}(),l&&a>0&&_(!0),f&&o>0&&_(!1),{vertices:new Float32Array(m),normals:new Float32Array(y),indices:new Uint32Array(h)};function _(e){for(var t=!0===e?a:o,n=!0===e?1:-1,r=v,i=1;i<=s;++i)m.push(0,g*n,0),y.push(0,n,0),++v;var u=v;for(i=0;i<=s;++i){var c=i/s*p+d,l=Math.cos(c),f=Math.sin(c);m.push(t*f,g*n,t*l),y.push(0,n,0),++v}for(i=0;i<s;++i){var b=r+i,_=u+i;!0===e?h.push(_,_+1,b):h.push(_+1,_,b)}}}},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(9),a=n(2),o=n(5),u=n(23),s=n(46),c=n(447),l=n(3),f=n(205),d=n(29),p=n(54),h=n(146),m=a.Vec3.zero(),y=a.Vec3.zero(),v=a.Vec3.zero(),b=a.Vec3.zero(),g=a.Vec3.zero(),_=a.Vec3.zero(),S=a.Vec3.zero(),C=a.Vec3.zero(),x=a.Vec3.zero(),w=a.Vec3.zero(),P=a.Mat4.identity(),T=a.Vec3.zero(),A=f.Box();function E(e,t,n,r,s,c){if(!i.Unit.isAtomic(t))return d.Mesh.createEmpty(c);var l=t.nucleotideElements.length;if(!l)return d.Mesh.createEmpty(c);for(var f=s.sizeFactor,E=s.radialSegments,k=l*(A.vertices.length/3+2*E),I=p.MeshBuilder.createState(k,k/4,c),M=t.elements,V=t.model,O=V.properties.modifiedResidues,D=V.atomicHierarchy,R=D.chainAtomSegments,j=D.residueAtomSegments,N=D.residues,B=D.index,F=V.atomicHierarchy.derived.residue,L=F.moleculeType,z=F.traceElementIndex,U=N.label_comp_id,G=t.conformation.invariantPosition,q=o.Segmentation.transientSegments(R,M),H=o.Segmentation.transientSegments(j,M),W={radiusTop:1*f,radiusBottom:1*f,radialSegments:E},Y=0;q.hasNext;)for(H.setSegment(q.move());H.hasNext;){var K=H.move().index;if(u.isNucleic(L[K])){var X=U.value(K),Q=O.parentId.get(X);void 0!==Q&&(X=Q);var Z=-1,J=-1,$=-1,ee=-1,te=-1,ne=-1,re=4.5,ie=2.5*f;u.isPurinBase(X)?(re=4.5,Z=B.findAtomOnResidue(K,"N1"),J=B.findAtomOnResidue(K,"C4"),$=B.findAtomOnResidue(K,"C6"),ee=B.findAtomOnResidue(K,"C2"),te=B.findAtomOnResidue(K,"N9"),ne=z[K]):u.isPyrimidineBase(X)&&(re=3,Z=B.findAtomOnResidue(K,"N3"),J=B.findAtomOnResidue(K,"C6"),$=B.findAtomOnResidue(K,"C4"),ee=B.findAtomOnResidue(K,"C2"),te=B.findAtomOnResidue(K,"N1"),ne=z[K]),-1!==te&&-1!==ne&&(G(te,g),G(ne,_),I.currentGroup=Y,h.addCylinder(I,g,_,1,W),-1!==Z&&-1!==J&&-1!==$&&-1!==ee&&(G(Z,m),G(J,y),G($,v),G(ee,b),a.Vec3.normalize(S,a.Vec3.sub(S,y,m)),a.Vec3.normalize(C,a.Vec3.sub(C,b,v)),a.Vec3.normalize(x,a.Vec3.cross(x,S,C)),a.Mat4.targetTo(P,m,y,x),a.Vec3.scaleAndAdd(w,m,S,re/2-.2),a.Mat4.scale(P,P,a.Vec3.set(T,4.5,ie,re)),a.Mat4.setTranslation(P,w),p.MeshBuilder.addPrimitive(I,P,A))),++Y}}return p.MeshBuilder.getMesh(I)}t.NucleotideBlockMeshParams={sizeFactor:l.ParamDefinition.Numeric(.2,{min:0,max:10,step:.01}),radialSegments:l.ParamDefinition.Numeric(16,{min:3,max:56,step:1})},t.DefaultNucleotideBlockMeshProps=l.ParamDefinition.getDefaultValues(t.NucleotideBlockMeshParams),t.NucleotideBlockParams=r({},s.UnitsMeshParams,t.NucleotideBlockMeshParams),t.NucleotideBlockVisual=function(){return s.UnitsMeshVisual({defaultProps:l.ParamDefinition.getDefaultValues(t.NucleotideBlockParams),createGeometry:E,createLocationIterator:c.NucleotideLocationIterator.fromGroup,getLoci:c.getNucleotideElementLoci,mark:c.markNucleotideElement,setUpdateState:function(e,t,n){e.createGeometry=t.sizeFactor!==n.sizeFactor||t.radialSegments!==n.radialSegments}})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(9),i=n(245),a=n(16),o=n(5),u=n(36),s=n(60);!function(e){e.fromGroup=function(e){var t=e.units[0],n=r.Unit.isAtomic(t)?i.getNucleotideElements(t):[],a=n.length,o=e.units.length,s=r.StructureElement.create();return u.LocationIterator(a,o,function(t,r){var i=e.units[r];return s.unit=i,s.element=n[t],s})}}(t.NucleotideLocationIterator||(t.NucleotideLocationIterator={})),t.getNucleotideElementLoci=function(e,t,n){var r=e.objectId,i=e.instanceId,o=e.groupId;if(n===r){var u=t.structure,c=t.group.units[i];return s.getResidueLoci(u,c,c.polymerElements[o])}return a.EmptyLoci},t.markNucleotideElement=function(e,t,n){var i=!1;if(!r.StructureElement.isLoci(e))return!1;var a=t.structure,u=t.group;if(e.structure!==a)return!1;var s=u.units[0];if(!r.Unit.isAtomic(s))return!1;for(var c=s.nucleotideElements,l=s.model,f=s.elements,d=l.atomicHierarchy.residueAtomSegments,p=d.index,h=d.offsets,m=l.atomicHierarchy.derived.residue.traceElementIndex,y=c.length,v=function(e){var t=u.unitIndexMap.get(e.unit.id),a=e.unit;void 0!==t&&r.Unit.isAtomic(a)&&o.OrderedSet.forEach(e.indices,function(r){var u=p[f[r]],s=o.OrderedSet.findPredecessorIndex(f,h[u]),c=o.OrderedSet.findPredecessorIndex(f,h[u+1]-1),l=o.Interval.ofRange(s,c);if(o.OrderedSet.isSubset(e.indices,l)){var d=m[u],v=o.OrderedSet.indexOf(a.nucleotideElements,d);-1!==v&&n(o.Interval.ofSingleton(t*y+v))&&(i=!0)}})},b=0,g=e.elements;b<g.length;b++)v(g[b]);return i}},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(97),a=n(2),o=n(23),u=n(46),s=n(3),c=n(449),l=n(29),f=n(54),d=a.Mat4.identity(),p=a.Vec3.zero(),h=a.Vec3.zero(),m=a.Vec3.zero(),y=a.Vec3.zero(),v=4,b=4,g=6,_=c.Wedge();function S(e,t,n,r,u,s){var c=t.polymerElements.length;if(!c)return l.Mesh.createEmpty(s);for(var S=u.sizeFactor,C=24*c,x=f.MeshBuilder.createState(C,C/10,s),w=i.createCurveSegmentState(1),P=w.normalVectors,T=w.binormalVectors,A=0,E=i.PolymerTraceIterator(t);E.hasNext;){var k=E.move();x.currentGroup=A;var I=o.isNucleic(k.moleculeType),M=o.SecondaryStructureType.is(k.secStrucType,4),V=I||M?.5:.9,O=I?.3:.5;if(i.interpolateCurveSegment(w,k,V,O),M&&!k.secStrucLast||!M){var D=r.size.size(k.center)*S,R=v*D,j=b*D,N=g*D,B=I?T:P;a.Vec3.fromArray(h,B,0),a.Vec3.fromArray(m,B,3),a.Vec3.normalize(y,a.Vec3.add(y,h,m)),a.Mat4.targetTo(d,k.p3,k.p1,y),a.Mat4.mul(d,d,a.Mat4.rotY90Z180),a.Mat4.scale(d,d,a.Vec3.set(p,N,j,R)),a.Mat4.setTranslation(d,k.p2),f.MeshBuilder.addPrimitive(x,d,_)}++A}return f.MeshBuilder.getMesh(x)}t.PolymerDirectionWedgeParams={sizeFactor:s.ParamDefinition.Numeric(.2,{min:0,max:10,step:.01})},t.DefaultPolymerDirectionWedgeProps=s.ParamDefinition.getDefaultValues(t.PolymerDirectionWedgeParams),t.PolymerDirectionParams=r({},u.UnitsMeshParams,t.PolymerDirectionWedgeParams),t.PolymerDirectionVisual=function(){return u.UnitsMeshVisual({defaultProps:s.ParamDefinition.getDefaultValues(t.PolymerDirectionParams),createGeometry:S,createLocationIterator:i.PolymerLocationIterator.fromGroup,getLoci:i.getPolymerElementLoci,mark:i.markPolymerElement,setUpdateState:function(e,t,n){e.createGeometry=t.sizeFactor!==n.sizeFactor}})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(2),a=n(83),o=n(143),u=i.Vec3.zero(),s=i.Vec3.zero(),c=i.Vec3.zero(),l=i.Vec3.zero(),f=o.polygon(3,!1);function d(){for(var e=a.PrimitiveBuilder(8),t=0;t<3;++t){var n=(t+1)%3;i.Vec3.set(u,f[2*t],f[2*t+1],-.5),i.Vec3.set(s,f[2*n],f[2*n+1],-.5),i.Vec3.set(c,f[2*n],f[2*n+1],.5),i.Vec3.set(l,f[2*t],f[2*t+1],.5),e.add(u,s,c),e.add(c,l,u)}return i.Vec3.set(u,f[0],f[1],-.5),i.Vec3.set(s,f[2],f[3],-.5),i.Vec3.set(c,f[4],f[5],-.5),e.add(c,s,u),i.Vec3.set(u,f[0],f[1],.5),i.Vec3.set(s,f[2],f[3],.5),i.Vec3.set(c,f[4],f[5],.5),e.add(u,s,c),e.getPrimitive()}t.createWedge=d,t.Wedge=function(){return r||(r=d()),r}},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(261),a=n(452),o=n(453),u=n(3),s=n(84),c=n(145),l=n(38),f=n(32),d=n(60),p={"element-sphere":function(e,t){return s.UnitsRepresentation("Element sphere mesh",e,t,i.getElementSphereVisual(e.webgl))},"intra-link":function(e,t){return s.UnitsRepresentation("Intra-unit link cylinder",e,t,a.IntraUnitLinkVisual)},"inter-link":function(e,t){return c.ComplexRepresentation("Inter-unit link cylinder",e,t,o.InterUnitLinkVisual)}},h=Object.keys(p).map(function(e){return[e,e]});function m(e,n){return u.ParamDefinition.clone(t.BallAndStickParams)}function y(e,t){return f.Representation.createMulti("Ball & Stick",e,t,l.StructureRepresentationStateBuilder,p)}t.BallAndStickParams=r({},i.ElementSphereParams,a.IntraUnitLinkParams,o.InterUnitLinkParams,{unitKinds:u.ParamDefinition.MultiSelect(["atomic"],d.UnitKindOptions),sizeFactor:u.ParamDefinition.Numeric(.3,{min:.01,max:10,step:.01}),sizeAspectRatio:u.ParamDefinition.Numeric(2/3,{min:.01,max:3,step:.01}),visuals:u.ParamDefinition.MultiSelect(["element-sphere","intra-link","inter-link"],h)}),t.getBallAndStickParams=m,t.BallAndStickRepresentation=y,t.BallAndStickRepresentationProvider={label:"Ball & Stick",description:"Displays atoms as spheres and bonds as cylinders.",factory:y,getParams:m,defaultValues:u.ParamDefinition.getDefaultValues(t.BallAndStickParams),defaultColorTheme:"element-symbol",defaultSizeTheme:"uniform"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(77),i=n(17),a=new Float32Array([-1,1,-1,-1,1,1,1,-1]),o=new Uint16Array([0,1,2,1,3,2]);!function(e){e.create=function(e,t,n){void 0===e&&(e=2048),void 0===t&&(t=1024),e*=4,t*=4;var u=i.ChunkedArray.create(Float32Array,3,t,n?n.centerBuffer.ref.value:e),s=i.ChunkedArray.create(Float32Array,2,t,n?n.mappingBuffer.ref.value:e),c=i.ChunkedArray.create(Uint32Array,3,t/2,n?n.indexBuffer.ref.value:e/2),l=i.ChunkedArray.create(Float32Array,1,t,n?n.groupBuffer.ref.value:e);return{add:function(e,t,n,r){for(var f=u.elementCount,d=0;d<4;++d)i.ChunkedArray.add3(u,e,t,n),i.ChunkedArray.add2(s,a[2*d],a[2*d+1]),i.ChunkedArray.add(l,r);i.ChunkedArray.add3(c,f+o[0],f+o[1],f+o[2]),i.ChunkedArray.add3(c,f+o[3],f+o[4],f+o[5])},getSpheres:function(){var e=i.ChunkedArray.compact(u,!0),t=i.ChunkedArray.compact(s,!0),a=i.ChunkedArray.compact(c,!0),o=i.ChunkedArray.compact(l,!0);return{kind:"spheres",sphereCount:u.elementCount/4,centerBuffer:n?r.ValueCell.update(n.centerBuffer,e):r.ValueCell.create(e),mappingBuffer:n?r.ValueCell.update(n.mappingBuffer,t):r.ValueCell.create(t),indexBuffer:n?r.ValueCell.update(n.indexBuffer,a):r.ValueCell.create(a),groupBuffer:n?r.ValueCell.update(n.groupBuffer,o):r.ValueCell.create(o)}}}}}(t.SpheresBuilder||(t.SpheresBuilder={}))},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(9),a=n(98),o=n(2),u=n(16),s=n(46),c=n(5),l=n(7),f=n(3),d=n(29);function p(e,t,n,r,u,s){if(!i.Unit.isAtomic(t))return d.Mesh.createEmpty(s);var c=i.StructureElement.create(t),f=t.elements,p=t.links,h=p.edgeCount,m=p.a,y=p.b,v=p.edgeProps,b=p.offset,g=v.order,_=v.flags,S=u.sizeFactor,C=u.sizeAspectRatio;if(!h)return d.Mesh.createEmpty(s);var x=o.Vec3.zero(),w=t.conformation.invariantPosition,P={linkCount:2*h,referencePosition:function(e){var t,n=m[e],r=y[e];n>r&&(n=(t=[r,n])[0],r=t[1]);for(var i=b[n],a=b[n+1];i<a;++i)if(y[i]!==r)return w(f[y[i]],x);for(i=b[r],a=b[r+1];i<a;++i)if(m[i]!==n)return w(f[m[i]],x);return null},position:function(e,t,n){w(f[m[n]],e),w(f[y[n]],t)},order:function(e){return g[e]},flags:function(e){return l.BitFlags.create(_[e])},radius:function(e){return c.element=f[m[e]],r.size.size(c)*S*C}};return a.createLinkCylinderMesh(e,P,u,s)}function h(e,t,n){var r=e.objectId,a=e.instanceId,o=e.groupId;if(n===r){var s=t.structure,c=t.group.units[a];if(i.Unit.isAtomic(c))return i.Link.Loci(s,[i.Link.Location(c,c.links.a[o],c,c.links.b[o]),i.Link.Location(c,c.links.b[o],c,c.links.a[o])])}return u.EmptyLoci}function m(e,t,n){var r=!1;if(i.Link.isLoci(e)){var a=t.structure,o=t.group;if(e.structure!==a)return!1;var u=o.units[0];if(!i.Unit.isAtomic(u))return!1;for(var s=2*u.links.edgeCount,l=0,f=e.links;l<f.length;l++){var d=f[l],p=o.unitIndexMap.get(d.aUnit.id);if(void 0!==p){var h=u.links.getDirectedEdgeIndex(d.aIndex,d.bIndex);-1!==h&&n(c.Interval.ofSingleton(p*s+h))&&(r=!0)}}}else if(i.StructureElement.isLoci(e)){a=t.structure,o=t.group;if(e.structure!==a)return!1;u=o.units[0];if(!i.Unit.isAtomic(u))return!1;for(var m=2*u.links.edgeCount,y=function(e){var t=o.unitIndexMap.get(e.unit.id);if(void 0!==t){var i=u.links,a=i.offset,s=i.b;c.OrderedSet.forEach(e.indices,function(i){for(var o=a[i],u=a[i+1];o<u;o++)c.OrderedSet.has(e.indices,s[o])&&n(c.Interval.ofSingleton(t*m+o))&&(r=!0)})}},v=0,b=e.elements;v<b.length;v++){y(b[v])}}return r}t.IntraUnitLinkParams=r({},s.UnitsMeshParams,a.LinkCylinderParams,{sizeFactor:f.ParamDefinition.Numeric(.3,{min:0,max:10,step:.01}),sizeAspectRatio:f.ParamDefinition.Numeric(2/3,{min:0,max:3,step:.01})}),t.IntraUnitLinkVisual=function(){return s.UnitsMeshVisual({defaultProps:f.ParamDefinition.getDefaultValues(t.IntraUnitLinkParams),createGeometry:p,createLocationIterator:a.LinkIterator.fromGroup,getLoci:h,mark:m,setUpdateState:function(e,t,n){e.createGeometry=t.sizeFactor!==n.sizeFactor||t.sizeAspectRatio!==n.sizeAspectRatio||t.radialSegments!==n.radialSegments||t.linkScale!==n.linkScale||t.linkSpacing!==n.linkSpacing}})}},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(9),a=n(98),o=n(16),u=n(73),s=n(5),c=n(7),l=n(3),f=n(29);function d(e,t,n,r,o){var u=t.links,s=u.bondCount,l=u.bonds,d=r.sizeFactor,p=r.sizeAspectRatio;if(!s)return f.Mesh.createEmpty(o);var h=i.StructureElement.create(),m={linkCount:s,referencePosition:function(e){return null},position:function(e,t,n){var r=l[n],i=r.unitA,a=r.unitB;i.conformation.position(i.elements[r.indexA],e),a.conformation.position(a.elements[r.indexB],t)},order:function(e){return l[e].order},flags:function(e){return c.BitFlags.create(l[e].flag)},radius:function(e){var t=l[e];return h.unit=t.unitA,h.element=t.unitA.elements[t.indexA],n.size.size(h)*d*p}};return a.createLinkCylinderMesh(e,m,r,o)}function p(e,t,n){var r=e.objectId,a=e.groupId;if(n===r){var u=t.links.bonds[a];return i.Link.Loci(t,[i.Link.Location(u.unitA,u.indexA,u.unitB,u.indexB),i.Link.Location(u.unitB,u.indexB,u.unitA,u.indexA)])}return o.EmptyLoci}function h(e,t,n){var r=!1;if(i.Link.isLoci(e)){if(e.structure!==t)return!1;for(var a=0,o=e.links;a<o.length;a++){var u=o[a],c=t.links.getBondIndex(u.aIndex,u.aUnit,u.bIndex,u.bUnit);-1!==c&&n(s.Interval.ofSingleton(c))&&(r=!0)}}else if(i.StructureElement.isLoci(e)){if(e.structure!==t)return!1;for(var l=function(e){s.OrderedSet.forEach(e.indices,function(i){for(var a=t.links.getBondIndices(i,e.unit),o=0,u=a.length;o<u;++o)n(s.Interval.ofSingleton(a[o]))&&(r=!0)})},f=0,d=e.elements;f<d.length;f++){l(d[f])}}return r}t.InterUnitLinkParams=r({},u.ComplexMeshParams,a.LinkCylinderParams,{sizeFactor:l.ParamDefinition.Numeric(.3,{min:0,max:10,step:.01}),sizeAspectRatio:l.ParamDefinition.Numeric(2/3,{min:0,max:3,step:.01})}),t.InterUnitLinkVisual=function(){return u.ComplexMeshVisual({defaultProps:l.ParamDefinition.getDefaultValues(t.InterUnitLinkParams),createGeometry:d,createLocationIterator:a.LinkIterator.fromStructure,getLoci:p,mark:h,setUpdateState:function(e,t,n){e.createGeometry=t.sizeFactor!==n.sizeFactor||t.sizeAspectRatio!==n.sizeAspectRatio||t.radialSegments!==n.radialSegments||t.linkScale!==n.linkScale||t.linkSpacing!==n.linkSpacing}})}},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(455),a=n(84),o=n(457),u=n(3),s=n(38),c=n(32),l={"gaussian-surface":function(e,t){return a.UnitsRepresentation("Gaussian surface",e,t,i.GaussianSurfaceVisual)},"gaussian-wireframe":function(e,t){return a.UnitsRepresentation("Gaussian wireframe",e,t,o.GaussianWireframeVisual)}},f=Object.keys(l).map(function(e){return[e,e]});function d(e,n){return u.ParamDefinition.clone(t.MolecularSurfaceParams)}function p(e,t){return c.Representation.createMulti("Molecular Surface",e,t,s.StructureRepresentationStateBuilder,l)}t.MolecularSurfaceParams=r({},i.GaussianSurfaceParams,o.GaussianWireframeParams,{visuals:u.ParamDefinition.MultiSelect(["gaussian-surface"],f)}),t.getMolecularSurfaceParams=d,t.MolecularSurfaceRepresentation=p,t.MolecularSurfaceRepresentationProvider={label:"Molecular Surface",description:"Displays a gaussian molecular surface.",factory:p,getParams:d,defaultValues:u.ParamDefinition.getDefaultValues(t.MolecularSurfaceParams),defaultColorTheme:"polymer-id",defaultSizeTheme:"uniform"}},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{s(r.next(e))}catch(e){a(e)}}function u(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,u)}s((r=r.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(46),u=n(147),s=n(195),c=n(3),l=n(29),f=n(208);function d(e,t,n,r,o,u){return i(this,void 0,void 0,function(){var n,r,i,s,c,d,p;return a(this,function(a){switch(a.label){case 0:return n=o.smoothness,[4,t.computeGaussianDensity(o,e.runtime,e.webgl)];case 1:return r=a.sent(),i=r.transform,s=r.field,c=r.idField,d={isoLevel:Math.exp(-n),scalarField:s,idField:c},[4,f.computeMarchingCubesMesh(d,u).runAsChild(e.runtime)];case 2:return p=a.sent(),l.Mesh.transformImmediate(p,i),l.Mesh.computeNormalsImmediate(p),l.Mesh.uniformTriangleGroup(p),[2,p]}})})}t.GaussianSurfaceParams=r({},o.UnitsMeshParams,s.GaussianDensityParams),t.GaussianSurfaceVisual=function(){return o.UnitsMeshVisual({defaultProps:c.ParamDefinition.getDefaultValues(t.GaussianSurfaceParams),createGeometry:d,createLocationIterator:u.StructureElementIterator.fromGroup,getLoci:u.getElementLoci,mark:u.markElement,setUpdateState:function(e,t,n){t.resolution!==n.resolution&&(e.createGeometry=!0),t.radiusOffset!==n.radiusOffset&&(e.createGeometry=!0),t.smoothness!==n.smoothness&&(e.createGeometry=!0),t.useGpu!==n.useGpu&&(e.createGeometry=!0),t.ignoreCache!==n.ignoreCache&&(e.createGeometry=!0)}})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(17),i=n(7),a=n(262),o=n(256);t.MarchinCubesMeshBuilder=function(e,t){var n=Math.min(65536,4*e),a=r.ChunkedArray.create(Float32Array,3,e,t&&t.vertexBuffer.ref.value),o=r.ChunkedArray.create(Float32Array,1,e,t&&t.groupBuffer.ref.value),u=r.ChunkedArray.create(Uint32Array,3,n,t&&t.indexBuffer.ref.value),s=0,c=0;return{addVertex:function(e,t,n){return++s,r.ChunkedArray.add3(a,e,t,n)},addGroup:function(e){r.ChunkedArray.add(o,e)},addTriangle:function(e,t,n,i){++c,r.ChunkedArray.add3(u,e[t],e[n],e[i])},get:function(){var e=r.ChunkedArray.compact(a,!0),n=r.ChunkedArray.compact(u,!0),l=r.ChunkedArray.compact(o,!0);return{kind:"mesh",vertexCount:s,triangleCount:c,vertexBuffer:t?i.ValueCell.update(t.vertexBuffer,e):i.ValueCell.create(e),groupBuffer:t?i.ValueCell.update(t.groupBuffer,l):i.ValueCell.create(l),indexBuffer:t?i.ValueCell.update(t.indexBuffer,n):i.ValueCell.create(n),normalBuffer:t?t.normalBuffer:i.ValueCell.create(new Float32Array(0)),normalsComputed:!1}}}},t.MarchinCubesLinesBuilder=function(e,t){var n=r.ChunkedArray.create(Float32Array,3,e),i=r.ChunkedArray.create(Float32Array,1,e),u=r.ChunkedArray.create(Float32Array,2,e),s=0;return{addVertex:function(e,t,i){return r.ChunkedArray.add3(n,e,t,i)},addGroup:function(e){r.ChunkedArray.add(i,e)},addTriangle:function(e,t,n,i,o){a.AllowedContours[t][n]&o&&(++s,r.ChunkedArray.add2(u,e[t],e[n])),a.AllowedContours[n][i]&o&&(++s,r.ChunkedArray.add2(u,e[n],e[i])),a.AllowedContours[t][i]&o&&(++s,r.ChunkedArray.add2(u,e[t],e[i]))},get:function(){for(var e=r.ChunkedArray.compact(n,!0),a=r.ChunkedArray.compact(u,!0),c=r.ChunkedArray.compact(i,!0),l=o.LinesBuilder.create(s,s/10,t),f=0;f<s;++f){var d=a[2*f],p=a[2*f+1];l.add(e[3*d],e[3*d+1],e[3*d+2],e[3*p],e[3*p+1],e[3*p+2],c[d])}return l.getLines()}}}},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{s(r.next(e))}catch(e){a(e)}}function u(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,u)}s((r=r.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(46),u=n(147),s=n(195),c=n(3),l=n(122),f=n(208);function d(e,t,n,r,o,u){return i(this,void 0,void 0,function(){var n,r,i,s,c,d,p;return a(this,function(a){switch(a.label){case 0:return n=o.smoothness,[4,t.computeGaussianDensity(o,e.runtime)];case 1:return r=a.sent(),i=r.transform,s=r.field,c=r.idField,d={isoLevel:Math.exp(-n),scalarField:s,idField:c},[4,f.computeMarchingCubesLines(d,u).runAsChild(e.runtime)];case 2:return p=a.sent(),l.Lines.transformImmediate(p,i),[2,p]}})})}t.GaussianWireframeParams=r({},o.UnitsLinesParams,s.GaussianDensityParams,{lineSizeAttenuation:c.ParamDefinition.Boolean(!1)}),t.GaussianWireframeVisual=function(){return o.UnitsLinesVisual({defaultProps:c.ParamDefinition.getDefaultValues(t.GaussianWireframeParams),createGeometry:d,createLocationIterator:u.StructureElementIterator.fromGroup,getLoci:u.getElementLoci,mark:u.markElement,setUpdateState:function(e,t,n){t.resolution!==n.resolution&&(e.createGeometry=!0),t.radiusOffset!==n.radiusOffset&&(e.createGeometry=!0),t.smoothness!==n.smoothness&&(e.createGeometry=!0),t.useGpu!==n.useGpu&&(e.createGeometry=!0),t.ignoreCache!==n.ignoreCache&&(e.createGeometry=!0)}})}},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(3),a=n(459),o=n(38),u=n(32),s={"gaussian-volume":function(e,t){return o.ComplexRepresentation("Gaussian volume",e,t,a.GaussianDensityVolumeVisual)}};function c(e,n){return i.ParamDefinition.clone(t.MolecularVolumeParams)}function l(e,t){return u.Representation.createMulti("Molecular Volume",e,t,o.StructureRepresentationStateBuilder,s)}t.MolecularVolumeParams=r({},a.GaussianDensityVolumeParams),t.getMolecularVolumeParams=c,t.MolecularVolumeRepresentation=l,t.MolecularVolumeRepresentationProvider={label:"Molecular Volume",description:"Displays a gaussian molecular density using direct volume rendering.",factory:l,getParams:c,defaultValues:i.ParamDefinition.getDefaultValues(t.MolecularVolumeParams),defaultColorTheme:"polymer-id",defaultSizeTheme:"uniform"}},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{s(r.next(e))}catch(e){a(e)}}function u(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,u)}s((r=r.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(9),u=n(3),s=n(96),c=n(73),l=n(16),f=n(71),d=n(36),p=n(197),h=n(11),m=n(5),y=n(199);function v(e,t,n,r){var u=this,s=function(e){for(var t=e.elementCount,n=new Float32Array(t),r=new Float32Array(t),i=new Float32Array(t),a=new Float32Array(t),u=o.StructureElement.create(),s=y.PhysicalSizeTheme({},{}),c=0,l=0,f=e.units.length;l<f;++l){var d=e.units[l],p=d.elements,h=d.conformation,v=h.x,b=h.y,g=h.z;u.unit=d;for(var _=0,S=p.length;_<S;++_){var C=p[_];n[c+_]=v(C),r[c+_]=b(C),i[c+_]=g(C),u.element=C,a[c+_]=s.size(u)}c+=p.length}return{position:{indices:m.OrderedSet.ofRange(0,t),x:n,y:r,z:i},radius:function(e){return a[e]}}}(e),c=s.position,l=s.radius;return h.Task.create("Gaussian Density",function(o){return i(u,void 0,void 0,function(){return a(this,function(i){switch(i.label){case 0:return[4,p.GaussianDensityTexture(o,n,c,e.lookup3d.boundary.box,l,t,r)];case 1:return[2,i.sent()]}})})})}function b(e,t,n,o,u){return i(this,void 0,void 0,function(){var n,i,c,l,f,d,p,h,m;return a(this,function(a){switch(a.label){case 0:if(n=e.runtime,void 0===(i=e.webgl))throw new Error("createGaussianDensityVolume requires `webgl` object in VisualContext");return c=r({},o,{useGpu:!0}),l=u?u.gridTexture.ref.value:void 0,[4,v(t,c,i,l).runInContext(n)];case 1:return f=a.sent(),d=f.transform,p=f.texture,h=f.bbox,m=f.gridDimension,[2,s.DirectVolume.create(h,m,d,p,u)]}})})}t.GaussianDensityVolumeParams=r({},c.ComplexDirectVolumeParams,{resolution:u.ParamDefinition.Numeric(1,{min:.1,max:10,step:.1}),radiusOffset:u.ParamDefinition.Numeric(0,{min:0,max:10,step:.1}),smoothness:u.ParamDefinition.Numeric(1.5,{min:.5,max:2.5,step:.1})}),t.GaussianDensityVolumeVisual=function(){return c.ComplexDirectVolumeVisual({defaultProps:u.ParamDefinition.getDefaultValues(t.GaussianDensityVolumeParams),createGeometry:b,createLocationIterator:function(e){return d.LocationIterator(e.elementCount,1,function(){return f.NullLocation})},getLoci:function(){return l.EmptyLoci},mark:function(){return!1},setUpdateState:function(e,t,n){t.resolution!==n.resolution&&(e.createGeometry=!0),t.radiusOffset!==n.radiusOffset&&(e.createGeometry=!0),t.smoothness!==n.smoothness&&(e.createGeometry=!0,t.isoValueNorm=Math.exp(-t.smoothness))}})}},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(461),a=n(466),o=n(467),u=n(3),s=n(145),c=n(38),l=n(32),f={"carbohydrate-symbol":function(e,t){return s.ComplexRepresentation("Carbohydrate symbol mesh",e,t,i.CarbohydrateSymbolVisual)},"carbohydrate-link":function(e,t){return s.ComplexRepresentation("Carbohydrate link cylinder",e,t,a.CarbohydrateLinkVisual)},"carbohydrate-terminal-link":function(e,t){return s.ComplexRepresentation("Carbohydrate terminal link cylinder",e,t,o.CarbohydrateTerminalLinkVisual)}},d=Object.keys(f).map(function(e){return[e,e]});function p(e,n){return u.ParamDefinition.clone(t.CarbohydrateParams)}function h(e,t){return l.Representation.createMulti("Carbohydrate",e,t,c.StructureRepresentationStateBuilder,f)}t.CarbohydrateParams=r({},i.CarbohydrateSymbolParams,a.CarbohydrateLinkParams,o.CarbohydrateTerminalLinkParams,{visuals:u.ParamDefinition.MultiSelect(["carbohydrate-symbol","carbohydrate-link","carbohydrate-terminal-link"],d)}),t.getCarbohydrateParams=p,t.CarbohydrateRepresentation=h,t.CarbohydrateRepresentationProvider={label:"Carbohydrate",description:"Displays carbohydrate symbols (3D SNFG).",factory:h,getParams:p,defaultValues:u.ParamDefinition.getDefaultValues(t.CarbohydrateParams),defaultColorTheme:"carbohydrate-symbol",defaultSizeTheme:"uniform"}},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),a=n(205),o=n(462),u=n(463),s=n(464),c=n(465),l=n(9),f=n(54),d=n(134),p=n(126),h=n(73),m=n(3),y=n(36),v=n(5),b=n(16),g=n(60),_=i.Mat4.identity(),S=i.Vec3.zero(),C=i.Vec3.zero(),x=1.612,w=a.Box(),P=a.PerforatedBox(),T=o.OctagonalPyramid(),A=o.PerforatedOctagonalPyramid(),E=u.Star({outerRadius:1,innerRadius:.5,thickness:.5,pointCount:5}),k=s.Octahedron(),I=s.PerforatedOctahedron(),M=c.DiamondPrism(),V=c.PentagonalPrism(),O=c.HexagonalPrism();function D(e,t,n,r,a){for(var o=f.MeshBuilder.createState(256,128,a),u=r.detail,s=r.sizeFactor,c=t.carbohydrates,h=c.elements.length,m=l.StructureElement.create(),y=0;y<h;++y){var v=c.elements[y],b=d.getSaccharideShape(v.component.type);m.unit=v.unit,m.element=v.unit.elements[v.anomericCarbon];var g=n.size.size(m),D=g*s,R=g*s*x,j=v.geometry,N=j.center,B=j.normal,F=j.direction;switch(i.Vec3.add(C,N,F),i.Mat4.targetTo(_,N,C,B),i.Mat4.setTranslation(_,N),o.currentGroup=2*y,b){case 0:p.addSphere(o,N,D,u);break;case 1:i.Mat4.scaleUniformly(_,_,R),f.MeshBuilder.addPrimitive(o,_,w);break;case 2:i.Mat4.scaleUniformly(_,_,R),f.MeshBuilder.addPrimitive(o,_,P),i.Mat4.mul(_,_,i.Mat4.rotZ90X180),o.currentGroup=2*y+1,f.MeshBuilder.addPrimitive(o,_,P);break;case 4:i.Mat4.scaleUniformly(_,_,1.2*R),f.MeshBuilder.addPrimitive(o,_,T);break;case 5:i.Mat4.scaleUniformly(_,_,1.2*R),f.MeshBuilder.addPrimitive(o,_,A),i.Mat4.mul(_,_,i.Mat4.rotZ90),o.currentGroup=2*y+1,f.MeshBuilder.addPrimitive(o,_,A);break;case 6:i.Mat4.mul(_,_,i.Mat4.rotZY90),i.Mat4.scale(_,_,i.Vec3.set(S,R,R,R/2)),f.MeshBuilder.addPrimitive(o,_,w);break;case 7:i.Mat4.scaleUniformly(_,_,R),i.Mat4.mul(_,_,i.Mat4.rotZY90),f.MeshBuilder.addPrimitive(o,_,E);break;case 8:i.Mat4.mul(_,_,i.Mat4.rotZY90),i.Mat4.scale(_,_,i.Vec3.set(S,1.4*R,1.4*R,1.4*R)),f.MeshBuilder.addPrimitive(o,_,k);break;case 3:i.Mat4.mul(_,_,i.Mat4.rotZY90),i.Mat4.scale(_,_,i.Vec3.set(S,1.4*R,1.4*R,1.4*R)),f.MeshBuilder.addPrimitive(o,_,I),i.Mat4.mul(_,_,i.Mat4.rotY90),o.currentGroup=2*y+1,f.MeshBuilder.addPrimitive(o,_,I);break;case 9:i.Mat4.mul(_,_,i.Mat4.rotZY90),i.Mat4.scale(_,_,i.Vec3.set(S,R,R/2,R/2)),f.MeshBuilder.addPrimitive(o,_,M);break;case 11:i.Mat4.mul(_,_,i.Mat4.rotZY90),i.Mat4.scale(_,_,i.Vec3.set(S,R,R,R/2)),f.MeshBuilder.addPrimitive(o,_,V);break;case 10:default:i.Mat4.mul(_,_,i.Mat4.rotZYZ90),i.Mat4.scale(_,_,i.Vec3.set(S,R/1.5,R,R/2)),f.MeshBuilder.addPrimitive(o,_,O)}}return f.MeshBuilder.getMesh(o)}function R(e){var t=e.carbohydrates.elements,n=2*t.length,r=l.StructureElement.create();return y.LocationIterator(n,1,function(e,n){var i=t[Math.floor(e/2)];return r.unit=i.unit,r.element=i.anomericCarbon,r},!0,function(e,t){return e%2==1})}function j(e,t,n){var r=e.objectId,i=e.groupId;if(n===r){var a=t.carbohydrates.elements[Math.floor(i/2)];return g.getResidueLoci(t,a.unit,a.anomericCarbon)}return b.EmptyLoci}function N(e,t,n){var r=t.carbohydrates,i=r.getElementIndex,a=r.getAnomericCarbon,o=!1;if(l.StructureElement.isLoci(e))for(var u=function(e){v.OrderedSet.forEach(e.indices,function(t){var r=e.unit,u=r.model,s=r.elements,c=u.atomicHierarchy.residueAtomSegments,l=c.index,f=c.offsets,d=l[s[t]],p=v.OrderedSet.findPredecessorIndex(s,f[d]),h=v.OrderedSet.findPredecessorIndex(s,f[d+1]-1),m=v.Interval.ofRange(p,h);if(v.OrderedSet.isSubset(e.indices,m)){var y=a(e.unit,d);if(void 0!==y){var b=i(e.unit,y);void 0!==b&&n(v.Interval.ofBounds(2*b,2*b+2))&&(o=!0)}}})},s=0,c=e.elements;s<c.length;s++){u(c[s])}return o}t.CarbohydrateSymbolParams=r({},h.ComplexMeshParams,{detail:m.ParamDefinition.Numeric(0,{min:0,max:3,step:1}),sizeFactor:m.ParamDefinition.Numeric(1.75,{min:0,max:10,step:.01})}),t.CarbohydrateSymbolVisual=function(){return h.ComplexMeshVisual({defaultProps:m.ParamDefinition.getDefaultValues(t.CarbohydrateSymbolParams),createGeometry:D,createLocationIterator:R,getLoci:j,mark:N,setUpdateState:function(e,t,n){e.createGeometry=t.sizeFactor!==n.sizeFactor||t.detail!==n.detail}})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i,a=n(2),o=n(83),u=n(143),s=a.Vec3.create(0,0,-.5),c=a.Vec3.create(0,0,.5),l=a.Vec3.zero(),f=a.Vec3.zero(),d=a.Vec3.zero(),p=a.Vec3.zero();function h(e){for(var t=e.length/2,n=2*(3===t?1:4===t?2:t)+2*t,r=o.PrimitiveBuilder(n),i=0;i<t;++i){var u=(i+1)%t;a.Vec3.set(l,e[2*i],e[2*i+1],-.5),a.Vec3.set(f,e[2*u],e[2*u+1],-.5),r.add(l,f,c)}if(3===t)a.Vec3.set(l,e[0],e[1],-.5),a.Vec3.set(f,e[2],e[3],-.5),a.Vec3.set(d,e[4],e[5],-.5),r.add(d,f,l);else if(4===t)a.Vec3.set(l,e[0],e[1],-.5),a.Vec3.set(f,e[2],e[3],-.5),a.Vec3.set(d,e[4],e[5],-.5),a.Vec3.set(p,e[6],e[7],-.5),r.add(d,f,l),r.add(l,p,d);else for(i=0;i<t;++i){u=(i+1)%t;a.Vec3.set(l,e[2*i],e[2*i+1],-.5),a.Vec3.set(f,e[2*u],e[2*u+1],-.5),r.add(s,f,l)}return r.getPrimitive()}t.Pyramid=h,t.OctagonalPyramid=function(){return r||(r=h(u.polygon(8,!0))),r},t.PerforatedOctagonalPyramid=function(){if(!i){for(var e=u.polygon(8,!0),t=new Float32Array(30),n=0;n<8;++n)t[3*n]=e[2*n],t[3*n+1]=e[2*n+1],t[3*n+2]=-.5;t[24]=0,t[25]=0,t[26]=-.5,t[27]=0,t[28]=0,t[29]=.5,i=o.createPrimitive(t,[0,1,8,1,2,8,4,5,8,5,6,8,2,3,9,3,4,9,6,7,9,7,0,9])}return i}},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),a=n(83);t.DefaultStarProps={pointCount:5,outerRadius:1,innerRadius:.5,thickness:.3};var o=i.Vec3.zero(),u=i.Vec3.zero(),s=i.Vec3.zero(),c=i.Vec3.zero(),l=i.Vec3.zero();t.Star=function(e){for(var n=r({},t.DefaultStarProps,e),f=n.outerRadius,d=n.innerRadius,p=n.thickness,h=n.pointCount,m=2*h*2,y=a.PrimitiveBuilder(m),v=new Float32Array(2*h),b=new Float32Array(2*h),g=0;g<h;++g){var _=2*g,S=2*g+1,C=(_+1)/h*Math.PI,x=(S+1)/h*Math.PI;b[_]=Math.cos(C)*f,b[S]=Math.sin(C)*f,v[_]=Math.cos(x)*d,v[S]=Math.sin(x)*d}for(i.Vec3.set(o,0,0,p/2),i.Vec3.set(u,0,0,-p/2),g=0;g<h;++g){var w=(g+1)%h;i.Vec3.set(s,b[2*g],b[2*g+1],0),i.Vec3.set(c,v[2*g],v[2*g+1],0),i.Vec3.set(l,b[2*w],b[2*w+1],0),y.add(o,s,c),y.add(c,s,u),y.add(o,c,l),y.add(l,c,u)}return y.getPrimitive()}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(83);t.octahedronVertices=[.5,0,0,-.5,0,0,0,.5,0,0,-.5,0,0,0,.5,0,0,-.5],t.octahedronIndices=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],t.perforatedOctahedronIndices=[0,2,4,0,4,3,1,2,5,1,5,3];var i=r.createPrimitive(t.octahedronVertices,t.octahedronIndices),a=r.createPrimitive(t.octahedronVertices,t.perforatedOctahedronIndices);t.Octahedron=function(){return i},t.PerforatedOctahedron=function(){return a}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i,a,o=n(2),u=n(83),s=n(143),c=o.Vec3.create(0,0,-.5),l=o.Vec3.create(0,0,.5),f=o.Vec3.zero(),d=o.Vec3.zero(),p=o.Vec3.zero(),h=o.Vec3.zero();function m(e){var t=e.length/2;if(t<4)throw new Error("need at least 5 points to build a prism");for(var n=4*t,r=u.PrimitiveBuilder(n),i=0;i<t;++i){var a=(i+1)%t;o.Vec3.set(f,e[2*i],e[2*i+1],-.5),o.Vec3.set(d,e[2*a],e[2*a+1],-.5),o.Vec3.set(p,e[2*a],e[2*a+1],.5),o.Vec3.set(h,e[2*i],e[2*i+1],.5),r.add(f,d,p),r.add(p,h,f)}for(i=0;i<t;++i){a=(i+1)%t;o.Vec3.set(f,e[2*i],e[2*i+1],-.5),o.Vec3.set(d,e[2*a],e[2*a+1],-.5),r.add(c,d,f),o.Vec3.set(f,e[2*i],e[2*i+1],.5),o.Vec3.set(d,e[2*a],e[2*a+1],.5),r.add(f,d,l)}return r.getPrimitive()}t.Prism=m,t.DiamondPrism=function(){return r||(r=m(s.polygon(4,!1))),r},t.PentagonalPrism=function(){return i||(i=m(s.polygon(5,!1))),i},t.HexagonalPrism=function(){return a||(a=m(s.polygon(6,!0))),a}},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(9),a=n(16),o=n(2),u=n(98),s=n(5),c=n(73),l=n(7),f=n(46),d=n(3),p=n(36);function h(e,t,n,r,a){var s=t.carbohydrates,c=s.links,f=s.elements,d=r.linkSizeFactor,p=i.StructureElement.create(),h={linkCount:c.length,referencePosition:function(e){return null},position:function(e,t,n){var r=c[n];o.Vec3.copy(e,f[r.carbohydrateIndexA].geometry.center),o.Vec3.copy(t,f[r.carbohydrateIndexB].geometry.center)},order:function(e){return 1},flags:function(e){return l.BitFlags.create(0)},radius:function(e){var t=c[e];return p.unit=f[t.carbohydrateIndexA].unit,p.element=f[t.carbohydrateIndexA].anomericCarbon,n.size.size(p)*d}};return u.createLinkCylinderMesh(e,h,r,a)}function m(e){var t=e.carbohydrates,n=t.elements,r=t.links,a=r.length,o=i.Link.Location();return p.LocationIterator(a,1,function(e){var t=r[e],i=n[t.carbohydrateIndexA],a=n[t.carbohydrateIndexB],u=s.OrderedSet.indexOf(i.unit.elements,i.anomericCarbon),c=s.OrderedSet.indexOf(a.unit.elements,a.anomericCarbon);return o.aUnit=i.unit,o.aIndex=u,o.bUnit=a.unit,o.bIndex=c,o},!0)}function y(e,t,n){var r=e.objectId,o=e.groupId;if(n===r){var u=t.carbohydrates,c=u.links,l=u.elements,f=c[o],d=l[f.carbohydrateIndexA],p=l[f.carbohydrateIndexB],h=s.OrderedSet.indexOf(d.unit.elements,d.anomericCarbon),m=s.OrderedSet.indexOf(p.unit.elements,p.anomericCarbon);if(-1!==h&&-1!==m)return i.Link.Loci(t,[i.Link.Location(d.unit,h,p.unit,m),i.Link.Location(p.unit,m,d.unit,h)])}return a.EmptyLoci}function v(e,t,n){var r=!1;if(i.Link.isLoci(e)){if(e.structure!==t)return!1;for(var a=t.carbohydrates.getLinkIndex,o=0,u=e.links;o<u.length;o++){var c=u[o],l=a(c.aUnit,c.aUnit.elements[c.aIndex],c.bUnit,c.bUnit.elements[c.bIndex]);void 0!==l&&n(s.Interval.ofSingleton(l))&&(r=!0)}}else if(i.StructureElement.isLoci(e)){if(e.structure!==t)return!1;for(var f=t.carbohydrates,d=f.getElementIndex,p=f.getLinkIndices,h=f.elements,m=function(e){s.OrderedSet.forEach(e.indices,function(t){var i=d(e.unit,e.unit.elements[t]);if(void 0!==i)for(var a=h[i],o=p(a.unit,a.anomericCarbon),u=0,c=o.length;u<c;++u)n(s.Interval.ofSingleton(o[u]))&&(r=!0)})},y=0,v=e.elements;y<v.length;y++){m(v[y])}}return r}t.CarbohydrateLinkParams=r({},f.UnitsMeshParams,u.LinkCylinderParams,{linkSizeFactor:d.ParamDefinition.Numeric(.3,{min:0,max:3,step:.01})}),t.CarbohydrateLinkVisual=function(){return c.ComplexMeshVisual({defaultProps:d.ParamDefinition.getDefaultValues(t.CarbohydrateLinkParams),createGeometry:h,createLocationIterator:m,getLoci:y,mark:v,setUpdateState:function(e,t,n){e.createGeometry=t.linkSizeFactor!==n.linkSizeFactor||t.radialSegments!==n.radialSegments}})}},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(9),a=n(16),o=n(2),u=n(98),s=n(5),c=n(73),l=n(7),f=n(46),d=n(3),p=n(36);function h(e,t,n,r,a){var s=t.carbohydrates,c=s.terminalLinks,f=s.elements,d=r.linkSizeFactor,p=i.StructureElement.create(),h={linkCount:c.length,referencePosition:function(e){return null},position:function(e,t,n){var r=c[n];r.fromCarbohydrate?(o.Vec3.copy(e,f[r.carbohydrateIndex].geometry.center),r.elementUnit.conformation.position(r.elementUnit.elements[r.elementIndex],t)):(r.elementUnit.conformation.position(r.elementUnit.elements[r.elementIndex],e),o.Vec3.copy(t,f[r.carbohydrateIndex].geometry.center))},order:function(e){return 1},flags:function(e){return l.BitFlags.create(0)},radius:function(e){var t=c[e];return t.fromCarbohydrate?(p.unit=f[t.carbohydrateIndex].unit,p.element=f[t.carbohydrateIndex].anomericCarbon):(p.unit=t.elementUnit,p.element=t.elementUnit.elements[t.elementIndex]),n.size.size(p)*d}};return u.createLinkCylinderMesh(e,h,r,a)}function m(e){var t=e.carbohydrates,n=t.elements,r=t.terminalLinks,a=r.length,o=i.Link.Location();return p.LocationIterator(a,1,function(e){var t=r[e],i=n[t.carbohydrateIndex],a=s.OrderedSet.indexOf(i.unit.elements,i.anomericCarbon);return t.fromCarbohydrate?(o.aUnit=i.unit,o.aIndex=a,o.bUnit=t.elementUnit,o.bIndex=t.elementIndex):(o.aUnit=t.elementUnit,o.aIndex=t.elementIndex,o.bUnit=i.unit,o.bIndex=a),o},!0)}function y(e,t,n){var r=e.objectId,o=e.groupId;if(n===r){var u=t.carbohydrates,c=u.terminalLinks,l=u.elements,f=c[o],d=l[f.carbohydrateIndex],p=s.OrderedSet.indexOf(d.unit.elements,d.anomericCarbon);return i.Link.Loci(t,[i.Link.Location(d.unit,p,f.elementUnit,f.elementIndex),i.Link.Location(f.elementUnit,f.elementIndex,d.unit,p)])}return a.EmptyLoci}function v(e,t,n){var r=t.carbohydrates.getTerminalLinkIndex,a=!1;if(i.Link.isLoci(e))for(var o=0,u=e.links;o<u.length;o++){var c=u[o],l=r(c.aUnit,c.aUnit.elements[c.aIndex],c.bUnit,c.bUnit.elements[c.bIndex]);void 0!==l&&n(s.Interval.ofSingleton(l))&&(a=!0)}else if(i.StructureElement.isLoci(e)){if(e.structure!==t)return!1;for(var f=t.carbohydrates,d=f.getElementIndex,p=f.getTerminalLinkIndices,h=f.elements,m=function(e){s.OrderedSet.forEach(e.indices,function(t){var r=d(e.unit,e.unit.elements[t]);if(void 0!==r)for(var i=h[r],o=p(i.unit,i.anomericCarbon),u=0,c=o.length;u<c;++u)n(s.Interval.ofSingleton(o[u]))&&(a=!0)})},y=0,v=e.elements;y<v.length;y++){m(v[y])}}return a}t.CarbohydrateTerminalLinkParams=r({},f.UnitsMeshParams,u.LinkCylinderParams,{linkSizeFactor:d.ParamDefinition.Numeric(.3,{min:0,max:3,step:.01})}),t.CarbohydrateTerminalLinkVisual=function(){return c.ComplexMeshVisual({defaultProps:d.ParamDefinition.getDefaultValues(t.CarbohydrateTerminalLinkParams),createGeometry:h,createLocationIterator:m,getLoci:y,mark:v,setUpdateState:function(e,t,n){e.createGeometry=t.linkSizeFactor!==n.linkSizeFactor||t.radialSegments!==n.radialSegments}})}},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(261),a=n(84),o=n(3),u=n(38),s=n(32),c=n(60),l={"element-sphere":function(e,t){return a.UnitsRepresentation("Sphere mesh",e,t,i.getElementSphereVisual(e.webgl))}};function f(e,n){return o.ParamDefinition.clone(t.SpacefillParams)}function d(e,t){return s.Representation.createMulti("Spacefill",e,t,u.StructureRepresentationStateBuilder,l)}t.SpacefillParams=r({},i.ElementSphereParams,{unitKinds:o.ParamDefinition.MultiSelect(["atomic","spheres"],c.UnitKindOptions)}),t.getSpacefillParams=f,t.SpacefillRepresentation=d,t.SpacefillRepresentationProvider={label:"Spacefill",description:"Displays atomic/coarse elements as spheres.",factory:d,getParams:f,defaultValues:o.ParamDefinition.getDefaultValues(t.SpacefillParams),defaultColorTheme:"element-symbol",defaultSizeTheme:"physical"}},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(470),a=n(3),o=n(145),u=n(38),s=n(32),c=n(60),l={"distance-restraint":function(e,t){return o.ComplexRepresentation("Cross-link restraint",e,t,i.CrossLinkRestraintVisual)}};function f(e,n){return a.ParamDefinition.clone(t.DistanceRestraintParams)}function d(e,t){return s.Representation.createMulti("DistanceRestraint",e,t,u.StructureRepresentationStateBuilder,l)}t.DistanceRestraintParams=r({},i.CrossLinkRestraintParams,{unitKinds:a.ParamDefinition.MultiSelect(["atomic","spheres"],c.UnitKindOptions)}),t.getDistanceRestraintParams=f,t.DistanceRestraintRepresentation=d,t.DistanceRestraintRepresentationProvider={label:"Distance Restraint",description:"Displays cross-link distance restraints.",factory:d,getParams:f,defaultValues:a.ParamDefinition.getDefaultValues(t.DistanceRestraintParams),defaultColorTheme:"cross-link",defaultSizeTheme:"uniform"}},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(9),a=n(98),o=n(16),u=n(73),s=n(5),c=n(7),l=n(3),f=n(29),d=n(36);function p(e,t,n,r,o){var u=t.crossLinkRestraints;if(!u.count)return f.Mesh.createEmpty(o);var s=r.sizeFactor,l=i.StructureElement.create(),d={linkCount:u.count,referencePosition:function(){return null},position:function(e,t,n){var r=u.pairs[n],i=r.unitA,a=r.unitB;i.conformation.position(i.elements[r.indexA],e),a.conformation.position(a.elements[r.indexB],t)},order:function(){return 1},flags:function(){return c.BitFlags.create(0)},radius:function(e){var t=u.pairs[e];return l.unit=t.unitA,l.element=t.unitA.elements[t.indexA],n.size.size(l)*s}};return a.createLinkCylinderMesh(e,d,r,o)}function h(e){var t=e.crossLinkRestraints.pairs,n=t.length,r=i.Link.Location();return d.LocationIterator(n,1,function(e){var n=t[e];return r.aUnit=n.unitA,r.aIndex=n.indexA,r.bUnit=n.unitB,r.bIndex=n.indexB,r},!0)}function m(e,t,n){var r=e.objectId,a=e.groupId;if(n===r){var u=t.crossLinkRestraints.pairs[a];if(u)return i.Link.Loci(t,[i.Link.Location(u.unitA,u.indexA,u.unitB,u.indexB),i.Link.Location(u.unitB,u.indexB,u.unitA,u.indexA)])}return o.EmptyLoci}function y(e,t,n){var r=t.crossLinkRestraints,a=!1;if(i.Link.isLoci(e))for(var o=0,u=e.links;o<u.length;o++){var c=u[o],l=r.getPairIndices(c.aIndex,c.aUnit,c.bIndex,c.bUnit);if(l)for(var f=0,d=l.length;f<d;++f)n(s.Interval.ofSingleton(l[f]))&&(a=!0)}return a}t.CrossLinkRestraintParams=r({},u.ComplexMeshParams,a.LinkCylinderParams,{sizeFactor:l.ParamDefinition.Numeric(1,{min:0,max:10,step:.1})}),t.CrossLinkRestraintVisual=function(){return u.ComplexMeshVisual({defaultProps:l.ParamDefinition.getDefaultValues(t.CrossLinkRestraintParams),createGeometry:p,createLocationIterator:h,getLoci:m,mark:y,setUpdateState:function(e,t,n){e.createGeometry=t.sizeFactor!==n.sizeFactor||t.radialSegments!==n.radialSegments}})}},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(472),a=n(84),o=n(3),u=n(38),s=n(32),c=n(60),l={"element-point":function(e,t){return a.UnitsRepresentation("Points",e,t,i.ElementPointVisual)}};function f(e,n){return o.ParamDefinition.clone(t.PointParams)}function d(e,t){return s.Representation.createMulti("Point",e,t,u.StructureRepresentationStateBuilder,l)}t.PointParams=r({},i.ElementPointParams,{unitKinds:o.ParamDefinition.MultiSelect(["atomic","spheres"],c.UnitKindOptions)}),t.getPointParams=f,t.PointRepresentation=d,t.PointRepresentationProvider={label:"Point",description:"Displays elements (atoms, coarse spheres) as spheres.",factory:d,getParams:f,defaultValues:o.ParamDefinition.getDefaultValues(t.PointParams),defaultColorTheme:"element-symbol",defaultSizeTheme:"physical"}},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(147),a=n(2),o=n(46),u=n(3),s=n(473);function c(e,t,n,r,i,o){for(var u=t.elements,c=u.length,l=s.PointsBuilder.create(c,c/10,o),f=t.conformation.invariantPosition,d=a.Vec3.zero(),p=0;p<c;++p)f(u[p],d),l.add(d[0],d[1],d[2],p);return l.getPoints()}t.ElementPointParams=r({},o.UnitsPointsParams,{pointSizeAttenuation:u.ParamDefinition.Boolean(!1)}),t.createElementPoint=c,t.ElementPointVisual=function(){return o.UnitsPointsVisual({defaultProps:u.ParamDefinition.getDefaultValues(t.ElementPointParams),createGeometry:c,createLocationIterator:i.StructureElementIterator.fromGroup,getLoci:i.getElementLoci,mark:i.markElement,setUpdateState:function(e,t,n){}})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(77),i=n(17);!function(e){e.create=function(e,t,n){void 0===e&&(e=2048),void 0===t&&(t=1024);var a=i.ChunkedArray.create(Float32Array,3,t,n?n.centerBuffer.ref.value:e),o=i.ChunkedArray.create(Float32Array,1,t,n?n.groupBuffer.ref.value:e);return{add:function(e,t,n,r){i.ChunkedArray.add3(a,e,t,n),i.ChunkedArray.add(o,r)},getPoints:function(){var e=i.ChunkedArray.compact(a,!0),t=i.ChunkedArray.compact(o,!0);return{kind:"points",pointCount:a.elementCount,centerBuffer:n?r.ValueCell.update(n.centerBuffer,e):r.ValueCell.create(e),groupBuffer:n?r.ValueCell.update(n.groupBuffer,t):r.ValueCell.create(t)}}}}}(t.PointsBuilder||(t.PointsBuilder={}))},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{s(r.next(e))}catch(e){a(e)}}function u(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,u)}s((r=r.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}};Object.defineProperty(t,"__esModule",{value:!0});var a=n(149),o=n(209),u=n(100),s=n(150),c=n(11),l=n(267),f=n(99),d=n(268),p=n(475),h=n(263),m=n(76),y=n(3),v=function(){function e(e,t){this.errorFree=!0,this.transformCache=new Map,this.ev=f.RxEventHelper.create(),this.globalContext=void 0,this.events={cell:{stateUpdated:this.ev(),created:this.ev(),removed:this.ev()},object:{updated:this.ev(),created:this.ev(),removed:this.ev()},log:this.ev(),changed:this.ev()},this.behaviors={currentObject:this.ev.behavior({state:this,ref:u.StateTransform.RootRef})},this.actions=new p.StateActionManager,this.cells=new Map,this._tree=o.StateTree.createEmpty(u.StateTransform.createRoot(t&&t.rootProps)).asTransient();var n=this._tree.root;this.cells.set(n.ref,{transform:n,sourceRef:void 0,obj:e,status:"ok",errorText:void 0,params:{definition:{},values:{}}}),this.globalContext=t&&t.globalContext}return Object.defineProperty(e.prototype,"tree",{get:function(){return this._tree},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"transforms",{get:function(){return this._tree.transforms},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cellStates",{get:function(){return this._tree.cellStates},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"current",{get:function(){return this.behaviors.currentObject.value.ref},enumerable:!0,configurable:!0}),e.prototype.build=function(){return new d.StateBuilder.Root(this._tree)},e.prototype.getSnapshot=function(){return{tree:o.StateTree.toJSON(this._tree)}},e.prototype.setSnapshot=function(e){var t=o.StateTree.fromJSON(e.tree);return this.updateTree(t)},e.prototype.setCurrent=function(e){this.behaviors.currentObject.next({state:this,ref:e})},e.prototype.updateCellState=function(e,t){var n="function"==typeof t?t(this.tree.cellStates.get(e)):t;this._tree.updateCellState(e,n)&&this.events.cell.stateUpdated.next({state:this,ref:e,cellState:this.tree.cellStates.get(e)})},e.prototype.dispose=function(){this.ev.dispose()},e.prototype.select=function(e){return l.StateSelection.select(e,this)},e.prototype.selectQ=function(e){return"string"==typeof e?l.StateSelection.select(e,this):l.StateSelection.select(e(l.StateSelection.Generators),this)},e.prototype.applyAction=function(e,t,n){var r=this;return void 0===n&&(n=u.StateTransform.RootRef),c.Task.create("Apply Action",function(i){var a=r.cells.get(n);if(!a)throw new Error("'"+n+"' does not exist.");if("ok"!==a.status)throw new Error("Action cannot be applied to a cell with status '"+a.status+"'");return I(e.definition.run({ref:n,cell:a,a:a.obj,params:t,state:r},r.globalContext),i)})},e.prototype.updateTree=function(e,t){var n=this;return void 0===t&&(t=!1),c.Task.create("Update Tree",function(a){return r(n,void 0,void 0,function(){var n,r;return i(this,function(i){switch(i.label){case 0:n=!1,i.label=1;case 1:return i.trys.push([1,,3,4]),[4,b(this.updateTreeAndCreateCtx(e,a,t))];case 2:return n=i.sent(),d.StateBuilder.isTo(e)?[2,(r=this.select(e.ref)[0])&&r.obj]:[3,4];case 3:return n&&this.events.changed.next(),[7];case 4:return[2]}})})})},e.prototype.updateTreeAndCreateCtx=function(e,t,n){var r=(d.StateBuilder.is(e)?e.getTree():e).asTransient(),i=this._tree;this._tree=r;var a={parent:this,editInfo:d.StateBuilder.is(e)?e.editInfo:void 0,errorFree:this.errorFree,taskCtx:t,oldTree:i,tree:r,cells:this.cells,transformCache:this.transformCache,results:[],silent:n,changed:!1,hadError:!1,newCurrent:void 0};return this.errorFree=!0,a},e}();function b(e){return r(this,void 0,void 0,function(){var t,n,r,u,s,c,l,f,d,p,h,m,y,v,b,C,T,k,I,M,V,O,D,R,j,N,B,F;return i(this,function(i){switch(i.label){case 0:if(t=!!(e.errorFree&&e.editInfo&&1===e.editInfo.count&&e.editInfo.lastUpdate&&e.editInfo.sourceTree===e.oldTree),r=[],t)n=[],u=[e.editInfo.lastUpdate];else{for(n=function(e){var t={newTree:e.tree,cells:e.cells,deletes:[]};return o.StateTree.doPostOrder(e.oldTree,e.oldTree.root,t,_),t.deletes}(e),B=e.parent.current,s=!1,c=0,l=n;c<l.length;c++)if((T=l[c])===B){s=!0;break}for(s&&(f=P(e.oldTree,B,n,e.cells),e.parent.setCurrent(f)),d=0,p=n;d<p.length;d++)T=p[d],h=e.cells.has(T)?e.cells.get(T).obj:void 0,e.cells.delete(T),e.transformCache.delete(T),r.push(h);L=e.cells,z=e.tree,U={roots:[],cells:L},o.StateTree.doPreOrder(z,z.root,U,g),u=U.roots}for(m=function(e,t){for(var n={ctx:e,added:[]},r=0,i=t;r<i.length;r++){var a=i[r];o.StateTree.doPreOrder(e.tree,e.tree.transforms.get(a),n,w)}return n.added}(e,u),e.editInfo||function(e){o.StateTree.doPreOrder(e.tree,e.tree.root,e.oldTree.cellStates,S)}(e),y=0,v=m;y<v.length;y++)b=v[y],e.parent.events.cell.created.next({state:e.parent,ref:b.transform.ref,cell:b});for(C=0;C<n.length;C++)T=n[C],k=e.oldTree.transforms.get(T).parent,e.parent.events.object.removed.next({state:e.parent,ref:T,obj:r[C]}),e.parent.events.cell.removed.next({state:e.parent,ref:T,parent:k});r.length&&(r=[]),function(e,t){for(var n=0,r=t;n<r.length;n++){var i=r[n];o.StateTree.doPreOrder(e.tree,e.tree.transforms.get(i),e,x)}}(e,u),I=0,M=u,i.label=1;case 1:return I<M.length?(V=M[I],[4,E(e,V)]):[3,4];case 2:i.sent(),i.label=3;case 3:return I++,[3,1];case 4:for(O=e.newCurrent,D=0,R=e.results;D<R.length;D++)"created"===(j=R[D]).action?(e.parent.events.object.created.next({state:e.parent,ref:j.ref,obj:j.obj}),e.newCurrent||(N=e.tree.transforms.get(j.ref)).props&&N.props.isGhost||j.obj===a.StateObject.Null||(O=j.ref)):"updated"===j.action?e.parent.events.object.updated.next({state:e.parent,ref:j.ref,action:"in-place",obj:j.obj}):"replaced"===j.action&&e.parent.events.object.updated.next({state:e.parent,ref:j.ref,action:"recreate",obj:j.obj,oldObj:j.oldObj});return O?e.parent.setCurrent(O):(B=e.parent.current,(F=e.cells.get(B))&&(F.obj===a.StateObject.Null||"error"===F.status&&F.errorText===A)&&(O=P(e.oldTree,B,[],e.cells),e.parent.setCurrent(O))),[2,n.length>0||u.length>0||e.changed]}var L,z,U})})}function g(e,t,n){var r=n.cells.get(e.ref);return r&&r.transform.version===e.version&&"error"!==r.status?!r||r.obj!==a.StateObject.Null:(n.roots.push(e.ref),!1)}function _(e,t,n){!n.newTree.transforms.has(e.ref)&&n.cells.has(e.ref)&&n.deletes.push(e.ref)}function S(e,t,n){n.has(e.ref)&&t.updateCellState(e.ref,n.get(e.ref))}function C(e,t,n,r){var i=e.cells.get(t),a=i.status!==n;i.status=n,i.errorText=r,a&&e.parent.events.cell.stateUpdated.next({state:e.parent,ref:t,cellState:e.tree.cellStates.get(t)})}function x(e,t,n){n.cells.get(e.ref).transform=e,C(n,e.ref,"pending")}function w(e,t,n){var r=n.ctx,i=n.added;if(!r.cells.has(e.ref)){var a={transform:e,sourceRef:void 0,status:"pending",errorText:void 0,params:void 0};r.cells.set(e.ref,a),i.push(a)}}function P(e,t,n,r){return function e(t,n,r,i){if(n===u.StateTransform.RootRef)return n;var o=t.transforms.get(n);var s=t.children.get(o.parent).values();var c=void 0,l=!1;for(;;){var f=s.next();if(f.done)break;if(!r.has(f.value)){var d=i.get(f.value);if(d&&"error"!==d.status&&d.obj!==a.StateObject.Null){var p=t.transforms.get(f.value);if(!p.props||!p.props.isGhost)if(f.value!==n){if(l)return p.ref;c=p.ref}else l=!0,r.has(n)||(c=n)}}}if(c)return c;return e(t,o.parent,r,i)}(e,t,new Set(n),r)}function T(e,t,n,r){r||(e.hadError=!0,e.parent.errorFree=!1);var i=e.cells.get(t);if(n?(C(e,t,"error",n),r||e.parent.events.log.next({type:"error",timestamp:new Date,message:n})):i.params=void 0,i.obj){var a=i.obj;i.obj=void 0,e.parent.events.object.removed.next({state:e.parent,ref:t,obj:a}),e.transformCache.delete(t)}for(var o=e.tree.children.get(t).values();;){var u=o.next();if(u.done)return;T(e,u.value,void 0,r)}}t.State=v,function(e){e.create=function(t,n){return new e(t,n)}}(v||(v={})),t.State=v;var A="Parent is null";function E(e,t){return r(this,void 0,void 0,function(){var n,r,o,u,s,c,l;return i(this,function(i){switch(i.label){case 0:C(e,t,"processing"),n=!1,i.label=1;case 1:return i.trys.push([1,3,,4]),r=m.now(),[4,k(e,t)];case 2:return o=i.sent(),u=m.now()-r,"none"!==o.action&&(e.changed=!0),C(e,t,"ok"),e.results.push(o),"created"===o.action?(n=o.obj===a.StateObject.Null)||e.silent||e.parent.events.log.next(h.LogEntry.info("Created "+o.obj.label+" in "+m.formatTimespan(u)+".")):"updated"===o.action?(n=o.obj===a.StateObject.Null)||e.silent||e.parent.events.log.next(h.LogEntry.info("Updated "+o.obj.label+" in "+m.formatTimespan(u)+".")):"replaced"===o.action&&((n=o.obj===a.StateObject.Null)||e.silent||e.parent.events.log.next(h.LogEntry.info("Updated "+o.obj.label+" in "+m.formatTimespan(u)+"."))),[3,4];case 3:return s=i.sent(),e.changed=!0,e.hadError||(e.newCurrent=t),T(e,t,""+s,!1),console.error(s),[2];case 4:c=e.tree.children.get(t).values(),i.label=5;case 5:return(l=c.next()).done?[2]:n?(T(e,l.value,void 0,!0),[3,8]):[3,6];case 6:return[4,E(e,l.value)];case 7:i.sent(),i.label=8;case 8:return[3,5];case 9:return[2]}})})}function k(e,t){return r(this,void 0,void 0,function(){var n,r,o,c,f,d,p,h,m,v,b,g,_;return i(this,function(i){switch(i.label){case 0:if(n=e.oldTree,r=e.tree,o=e.cells.get(t),c=o.transform,o.transform.ref===u.StateTransform.RootRef)return[2,{action:"none"}];if(!(f=l.StateSelection.findAncestorOfType(r,e.cells,t,c.transformer.definition.from)))throw new Error("No suitable parent found for '"+t+"'");return d=f.obj,o.sourceRef=f.transform.ref,p=function(e,t,n){var r=t.transformer.definition.params,i=r?r(n,e.parent.globalContext):{};return{definition:i,values:t.params?t.params:y.ParamDefinition.getDefaultValues(i)}}(e,c,d),n.transforms.has(t)&&o.params?[3,2]:(o.params=p,[4,M(e,t,c.transformer,d,p.values)]);case 1:return h=i.sent(),o.obj=h,[2,{ref:t,action:"created",obj:h}];case 2:return m=o.params.values,v=p.values,o.params=p,o.obj&&o.obj!==a.StateObject.Null?[4,V(e,t,c.transformer,d,o.obj,m,v)]:[3,4];case 3:return b=i.sent(),[3,5];case 4:b=s.StateTransformer.UpdateResult.Recreate,i.label=5;case 5:switch(b){case s.StateTransformer.UpdateResult.Recreate:return[3,6];case s.StateTransformer.UpdateResult.Updated:return[3,8]}return[3,9];case 6:return g=o.obj,[4,M(e,t,c.transformer,d,v)];case 7:return _=i.sent(),o.obj=_,[2,{ref:t,action:"replaced",oldObj:g,obj:_}];case 8:return[2,{ref:t,action:"updated",obj:o.obj}];case 9:return[2,{action:"none"}]}})})}function I(e,t){return"function"==typeof e.runInContext?e.runInContext(t):e}function M(e,t,n,r,i){var a=Object.create(null);return e.transformCache.set(t,a),I(n.definition.apply({a:r,params:i,cache:a},e.parent.globalContext),e.taskCtx)}function V(e,t,n,a,o,u,c){return r(this,void 0,void 0,function(){var r;return i(this,function(i){return n.definition.update?((r=e.transformCache.get(t))||(r=Object.create(null),e.transformCache.set(t,r)),[2,I(n.definition.update({a:a,oldParams:u,b:o,newParams:c,cache:r},e.parent.globalContext),e.taskCtx)]):[2,s.StateTransformer.UpdateResult.Recreate]})})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(150),i=function(){function e(){this.actions=new Map,this.fromTypeIndex=new Map}return e.prototype.add=function(e){var t=r.StateTransformer.is(e)?e.toAction():e;if(this.actions.has(t.id))return this;this.actions.set(t.id,t);for(var n=0,i=t.definition.from;n<i.length;n++){var a=i[n];this.fromTypeIndex.has(a.type)?this.fromTypeIndex.get(a.type).push(t):this.fromTypeIndex.set(a.type,[t])}return this},e.prototype.fromCell=function(e,t){var n=e.obj;if(!n)return[];var r=this.fromTypeIndex.get(n.type);if(!r)return[];for(var i=!1,a=0,o=r;a<o.length;a++){if((l=o[a]).definition.isApplicable){i=!0;break}}if(!i)return r;for(var u=[],s=0,c=r;s<c.length;s++){var l;(l=c[s]).definition.isApplicable?l.definition.isApplicable(n,e.transform,t)&&u.push(l):u.push(l)}return u},e}();t.StateActionManager=i},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{s(r.next(e))}catch(e){a(e)}}function u(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,u)}s((r=r.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}};Object.defineProperty(t,"__esModule",{value:!0});var a=n(37),o=n(27),u=n(270),s=n(26),c=n(16),l=n(9),f=n(271),d=n(153);function p(e){e.events.state.object.created.subscribe(function(e){s.PluginStateObject.isBehavior(e.obj)&&e.obj.data.register(e.ref)}),e.events.state.object.removed.subscribe(function(e){s.PluginStateObject.isBehavior(e.obj)&&e.obj.data.unregister()}),e.events.state.object.updated.subscribe(function(e){"recreate"===e.action&&(e.oldObj&&s.PluginStateObject.isBehavior(e.oldObj)&&e.oldObj.data.unregister(),e.obj&&s.PluginStateObject.isBehavior(e.obj)&&e.obj.data.register(e.ref))})}function h(e){a.PluginCommands.State.SetCurrentObject.subscribe(e,function(e){var t=e.state,n=e.ref;return t.setCurrent(n)})}function m(e){a.PluginCommands.State.Update.subscribe(e,function(t){var n=t.state,r=t.tree,i=t.doNotLogTiming;return e.runTask(n.updateTree(r,i))})}function y(e){a.PluginCommands.State.ApplyAction.subscribe(e,function(t){var n=t.state,r=t.action,i=t.ref;return e.runTask(n.applyAction(r.action,r.params,i))})}function v(e){function t(t,n){var r=t.build().delete(n).getTree();return e.runTask(t.updateTree(r))}a.PluginCommands.State.RemoveObject.subscribe(e,function(e){var n=e.state,r=e.ref;if(e.removeParentGhosts){var i=n.tree,a=i.transforms.get(r);if(a.parent===r)return t(n,r);for(;;){var o=i.children.get(a.parent);if(a.parent===a.ref||o.size>1)return t(n,a.ref);var u=i.transforms.get(a.parent);if(!u.props||!u.props.isGhost)return t(n,a.ref);a=u}}else t(n,r)})}function b(e){a.PluginCommands.State.ToggleExpanded.subscribe(e,function(e){var t=e.state,n=e.ref;return t.updateCellState(n,function(e){return{isCollapsed:!e.isCollapsed}})})}function g(e){a.PluginCommands.State.ToggleVisibility.subscribe(e,function(e){var t=e.state,n=e.ref;return function(e,t,n){o.StateTree.doPreOrder(e.tree,e.transforms.get(t),{state:e,value:n},_)}(t,n,!t.cellStates.get(n).isHidden)})}function _(e,t,n){n.state.updateCellState(e.ref,{isHidden:n.value})}function S(e){a.PluginCommands.State.Highlight.subscribe(e,function(t){var n=t.state,r=t.ref,i=n.select(r)[0],a=i&&s.PluginStateObject.isRepresentation3D(i.obj)?i.obj.data:void 0;i&&i.obj&&i.obj.type===s.PluginStateObject.Molecule.Structure.type?e.behaviors.canvas.highlightLoci.next({loci:l.Structure.Loci(i.obj.data)}):a&&e.behaviors.canvas.highlightLoci.next({loci:c.EveryLoci,repr:a})})}function C(e){a.PluginCommands.State.ClearHighlight.subscribe(e,function(t){t.state,t.ref;e.behaviors.canvas.highlightLoci.next({loci:c.EmptyLoci})})}function x(e){var t=this;a.PluginCommands.State.Snapshots.Clear.subscribe(e,function(){e.state.snapshots.clear()}),a.PluginCommands.State.Snapshots.Remove.subscribe(e,function(t){var n=t.id;e.state.snapshots.remove(n)}),a.PluginCommands.State.Snapshots.Add.subscribe(e,function(t){var n=t.name,r=t.description,i=u.PluginStateSnapshotManager.Entry(e.state.getSnapshot(),n,r);e.state.snapshots.add(i)}),a.PluginCommands.State.Snapshots.Apply.subscribe(e,function(t){var n=t.id,r=e.state.snapshots.getEntry(n);return e.state.setSnapshot(r.snapshot)}),a.PluginCommands.State.Snapshots.Upload.subscribe(e,function(t){var n=t.name,r=t.description,i=t.serverUrl;return fetch(i+"/set?name="+encodeURIComponent(n||"")+"&description="+encodeURIComponent(r||""),{method:"POST",mode:"cors",referrer:"no-referrer",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify(e.state.getSnapshot())})}),a.PluginCommands.State.Snapshots.Fetch.subscribe(e,function(n){var a=n.url;return r(t,void 0,void 0,function(){var t;return i(this,function(n){switch(n.label){case 0:return[4,fetch(a,{referrer:"no-referrer"})];case 1:return[4,n.sent().json()];case 2:return t=n.sent(),[2,e.state.setSnapshot(t.data)]}})})}),a.PluginCommands.State.Snapshots.DownloadToFile.subscribe(e,function(t){var n=t.name,r=document.createElement("a"),i=JSON.stringify(e.state.getSnapshot(),null,2);r.setAttribute("href","data:application/json;charset=utf-8,"+encodeURIComponent(i)),r.setAttribute("download","mol-star_state_"+(n||f.getFormattedTime())+".json"),r.style.display="none",document.body.appendChild(r),r.click(),document.body.removeChild(r)}),a.PluginCommands.State.Snapshots.OpenFile.subscribe(e,function(n){var a=n.file;return r(t,void 0,void 0,function(){var t,n,r;return i(this,function(i){switch(i.label){case 0:return i.trys.push([0,3,,4]),[4,d.readFromFile(a,"string").run()];case 1:return t=i.sent(),n=JSON.parse(t),[4,e.state.setSnapshot(n)];case 2:return i.sent(),[3,4];case 3:return r=i.sent(),e.log.error("Reading JSON state: "+r),[3,4];case 4:return[2]}})})})}t.registerDefault=function(e){p(e),h(e),m(e),y(e),v(e),b(e),g(e),S(e),C(e),x(e)},t.SyncBehaviors=p,t.SetCurrentObject=h,t.Update=m,t.ApplyAction=y,t.RemoveObject=v,t.ToggleExpanded=b,t.ToggleVisibility=g,t.Highlight=S,t.ClearHighlight=C,t.Snapshots=x},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(26);function i(e){var t=e.state.dataState.events;t.object.created.subscribe(function(t){r.PluginStateObject.isRepresentation3D(t.obj)&&(o(t,t.obj.data),t.obj.data.setState({syncManually:!0}),e.canvas3d.add(t.obj.data),e.canvas3d.resetCamera())}),t.object.updated.subscribe(function(t){t.oldObj&&r.PluginStateObject.isRepresentation3D(t.oldObj)&&(e.canvas3d.remove(t.oldObj.data),e.canvas3d.requestDraw(!0),t.oldObj.data.destroy()),r.PluginStateObject.isRepresentation3D(t.obj)&&(o(t,t.obj.data),"recreate"===t.action&&t.obj.data.setState({syncManually:!0}),e.canvas3d.add(t.obj.data))}),t.object.removed.subscribe(function(t){r.PluginStateObject.isRepresentation3D(t.obj)&&(e.canvas3d.remove(t.obj.data),e.canvas3d.requestDraw(!0),t.obj.data.destroy())})}function a(e){e.state.dataState.events.cell.stateUpdated.subscribe(function(t){var n=t.state.cells.get(t.ref);r.PluginStateObject.isRepresentation3D(n.obj)&&(o(t,n.obj.data),e.canvas3d.requestDraw(!0))})}function o(e,t){t.setState({visible:!e.state.cellStates.get(e.ref).isHidden})}t.registerDefault=function(e){i(e),a(e)},t.SyncRepresentationToCanvas=i,t.UpdateRepresentationVisibility=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(37),i=n(272);function a(e){r.PluginCommands.Camera.Reset.subscribe(e,function(){e.canvas3d.resetCamera()})}function o(e){r.PluginCommands.Camera.SetSnapshot.subscribe(e,function(t){var n=t.snapshot,r=t.durationMs;e.canvas3d.camera.transition.apply(n,r)})}function u(e){r.PluginCommands.Camera.Snapshots.Clear.subscribe(e,function(){e.state.cameraSnapshots.clear()}),r.PluginCommands.Camera.Snapshots.Remove.subscribe(e,function(t){var n=t.id;e.state.cameraSnapshots.remove(n)}),r.PluginCommands.Camera.Snapshots.Add.subscribe(e,function(t){var n=t.name,r=t.description,a=i.CameraSnapshotManager.Entry(e.canvas3d.camera.getSnapshot(),n,r);e.state.cameraSnapshots.add(a)}),r.PluginCommands.Camera.Snapshots.Apply.subscribe(e,function(t){var n=t.id,i=e.state.cameraSnapshots.getEntry(n);return r.PluginCommands.Camera.SetSnapshot.dispatch(e,{snapshot:i.snapshot,durationMs:200})})}t.registerDefault=function(e){a(e),o(e),u(e)},t.Reset=a,t.SetSnapshot=o,t.Snapshots=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(37);function i(e){r.PluginCommands.Canvas3D.SetSettings.subscribe(e,function(t){e.canvas3d.setProps(t.settings),e.events.canvad3d.settingsUpdated.next()})}t.registerDefault=function(e){i(e)},t.Canvas3DSetSettings=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i,a=n(9),o=n(5);function u(e,t,n){e.unit=t,e.element=t.elements[n]}function s(e){return r||(r=a.StructureElement.create()),i||(i=a.StructureElement.create()),u(r,e.aUnit,e.aIndex),u(i,e.bUnit,e.bIndex),c(r)+" - "+c(i)}function c(e){var t=e.unit.model.label,n=e.unit.conformation.operator.name,r="";if(a.Unit.isAtomic(e.unit)){var i=a.StructureProperties.chain.auth_asym_id(e),o=a.StructureProperties.residue.auth_seq_id(e),u=a.StructureProperties.residue.auth_comp_id(e),s=a.StructureProperties.atom.auth_atom_id(e),c=a.StructureProperties.atom.label_alt_id(e);r="["+u+"]"+o+":"+i+"."+s+(c?"%"+c:"")}else if(a.Unit.isCoarse(e.unit)){i=a.StructureProperties.coarse.asym_id(e);var l=a.StructureProperties.coarse.seq_id_begin(e),f=a.StructureProperties.coarse.seq_id_end(e);if(l===f){var d=a.StructureProperties.coarse.entityKey(e);r="["+(u=e.unit.model.sequence.byEntityKey[d].compId.value(l-1))+"]"+l+":"+i}else r=l+"-"+f+":"+i}else r="unknown";return t+" "+n+" "+r}t.labelFirst=function(e){switch(e.kind){case"structure-loci":return e.structure.models.map(function(e){return e.label}).join(", ");case"element-loci":var t=e.elements[0];if(t){var n=t.unit.elements[o.OrderedSet.getAt(t.indices,0)];return c(a.StructureElement.create(t.unit,n))}return"Unknown";case"link-loci":var r=e.links[0];return r?s(r):"Unknown";case"group-loci":var i=e.groups[0];return i?e.shape.getLabel(o.OrderedSet.getAt(i.ids,0),e.instance):"Unknown";case"every-loci":return"Everything";case"empty-loci":return"Nothing";case"data-loci":return""}},t.linkLabel=s,t.elementLabel=c},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var a=n(16),o=n(3),u=n(85);t.FocusLociOnSelect=u.PluginBehavior.create({name:"focus-loci-on-select",category:"interaction",ctor:function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.register=function(){var e=this;this.subscribeObservable(this.ctx.behaviors.canvas.selectLoci,function(t){if(e.ctx.canvas3d){var n=a.Loci.getBoundingSphere(t.loci);n&&e.ctx.canvas3d.camera.focus(n.center,Math.max(n.radius+e.params.extraRadius,e.params.minRadius))}})},t}(u.PluginBehavior.Handler),params:function(){return{minRadius:o.ParamDefinition.Numeric(10,{min:1,max:50,step:1}),extraRadius:o.ParamDefinition.Numeric(4,{min:1,max:50,step:1},{description:"Value added to the boundning sphere radius of the Loci."})}},display:{name:"Focus Loci on Select",group:"Camera"}})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(483);t.PDBeStructureQualityReport=r.PDBeStructureQualityReport;var i=n(490);t.RCSBAssemblySymmetry=i.RCSBAssemblySymmetry},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var a=n(5),o=n(275),u=n(489),s=n(9),c=n(3),l=n(85);function f(e){switch(e.kind){case"element-loci":var t=e.elements[0],n=t.unit;if(!n.model.customProperties.has(o.StructureQualityReport.Descriptor))return;var r=s.StructureElement.create(n,n.elements[a.OrderedSet.getAt(t.indices,0)]),i=o.StructureQualityReport.getIssues(r);return 0===i.length?"PDBe Validation: No Issues":"PDBe Validation: "+i.join(", ");default:return}}t.PDBeStructureQualityReport=l.PluginBehavior.create({name:"pdbe-structure-quality-report-prop",category:"custom-props",display:{name:"PDBe Structure Quality Report",group:"Custom Props"},ctor:function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.attach=o.StructureQualityReport.createAttachTask(function(e){return"https://www.ebi.ac.uk/pdbe/api/validation/residuewise_outlier_summary/entry/"+e.label.toLowerCase()},t.ctx.fetch),t.provider={option:[o.StructureQualityReport.Descriptor.name,"PDBe Structure Quality Report"],descriptor:o.StructureQualityReport.Descriptor,defaultSelected:t.params.autoAttach,attachableTo:function(){return!0},attach:t.attach},t}return i(t,e),t.prototype.register=function(){this.ctx.customModelProperties.register(this.provider),this.ctx.lociLabels.addProvider(f),this.ctx.structureRepresentation.themeCtx.colorThemeRegistry.add("pdbe-structure-quality-report",{label:"PDBe Structure Quality Report",factory:u.StructureQualityReportColorTheme,getParams:function(){return{}},defaultValues:{},isApplicable:function(e){return!!e.structure&&!e.structure.isEmpty&&e.structure.models[0].customProperties.has(o.StructureQualityReport.Descriptor)}})},t.prototype.update=function(e){var t=this.params.autoAttach!==e.autoAttach;return this.params.autoAttach=e.autoAttach,this.provider.defaultSelected=e.autoAttach,t},t.prototype.unregister=function(){this.ctx.customModelProperties.unregister(o.StructureQualityReport.Descriptor.name),this.ctx.lociLabels.removeProvider(f),this.ctx.structureRepresentation.themeCtx.colorThemeRegistry.remove("pdbe-structure-quality-report")},t}(l.PluginBehavior.Handler),params:function(){return{autoAttach:c.ParamDefinition.Boolean(!1)}}})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(21),i=n(211);function a(e,t){var n=e.data,a=e.indices,u=e.count,s=t.valueType,c="str"===s?function(e){return n.substring(a[2*e],a[2*e+1])}:"int"===s?function(e){return i.parseInt(n,a[2*e],a[2*e+1])||0}:function(e){return i.parseFloat(n,a[2*e],a[2*e+1])||0};return{schema:t,__array:void 0,isDefined:!0,rowCount:u,value:c,valueKind:function(e){return 0},toArray:function(e){return r.ColumnHelpers.createAndFillArray(u,c,e)},areValuesEqual:o(e)}}function o(e){var t=e.data,n=e.indices;return function(e,r){var i=n[2*e],a=n[2*r],o=n[2*e+1]-i;if(o!==n[2*r+1]-a)return!1;for(var u=0;u<o;u++)if(t.charCodeAt(u+i)!==t.charCodeAt(u+a))return!1;return!0}}t.default=function(e){return function(t){return a(e,t)}},t.TokenColumn=a,t.areValuesEqualProvider=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(120);t.mmCIF_residueId_schema={label_comp_id:r.mmCIF_Schema.atom_site.label_comp_id,label_seq_id:r.mmCIF_Schema.atom_site.label_seq_id,pdbx_PDB_ins_code:r.mmCIF_Schema.atom_site.pdbx_PDB_ins_code,label_asym_id:r.mmCIF_Schema.atom_site.label_asym_id,label_entity_id:r.mmCIF_Schema.atom_site.label_entity_id,auth_comp_id:r.mmCIF_Schema.atom_site.auth_atom_id,auth_seq_id:r.mmCIF_Schema.atom_site.auth_seq_id,auth_asym_id:r.mmCIF_Schema.atom_site.auth_asym_id}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(277),i=n(213),a=n(9),o=n(23),u=n(114),s=n(488),c=n(119),l=n(17),f=i.QuerySymbolRuntime.Const,d=i.QuerySymbolRuntime.Dynamic,p=[f(r.MolScriptSymbolTable.core.type.bool,function(e,t){return!!t[0](e)}),f(r.MolScriptSymbolTable.core.type.num,function(e,t){return+t[0](e)}),f(r.MolScriptSymbolTable.core.type.str,function(e,t){return""+t[0](e)}),f(r.MolScriptSymbolTable.core.type.list,function(e,t){return i.QueryRuntimeArguments.forEachEval(t,e,function(e,t,n){return n[t]=e},[])}),f(r.MolScriptSymbolTable.core.type.set,function(e,t){return i.QueryRuntimeArguments.forEachEval(t,e,function(e,t,n){return n.add(e)},new Set)}),f(r.MolScriptSymbolTable.core.type.regex,function(e,t){return new RegExp(t[0](e),t[1]&&t[1](e)||"")}),f(r.MolScriptSymbolTable.core.type.bitflags,function(e,t){return+t[0](e)}),f(r.MolScriptSymbolTable.core.type.compositeKey,function(e,t){return i.QueryRuntimeArguments.forEachEval(t,e,function(e,t,n){return n[t]=""+e},[]).join("-")}),f(r.MolScriptSymbolTable.core.logic.not,function(e,t){return!t[0](e)}),f(r.MolScriptSymbolTable.core.logic.and,function(e,t){if("number"==typeof t.length){for(var n=0,r=t.length;n<r;n++)if(!t[n](e))return!1}else for(var i=0,a=Object.keys(t);i<a.length;i++){if(!t[a[i]](e))return!1}return!0}),f(r.MolScriptSymbolTable.core.logic.or,function(e,t){if("number"==typeof t.length){for(var n=0,r=t.length;n<r;n++)if(t[n](e))return!0}else for(var i=0,a=Object.keys(t);i<a.length;i++){if(t[a[i]](e))return!0}return!1}),f(r.MolScriptSymbolTable.core.rel.eq,function(e,t){return t[0](e)===t[1](e)}),f(r.MolScriptSymbolTable.core.rel.neq,function(e,t){return t[0](e)!==t[1](e)}),f(r.MolScriptSymbolTable.core.rel.lt,function(e,t){return t[0](e)<t[1](e)}),f(r.MolScriptSymbolTable.core.rel.lte,function(e,t){return t[0](e)<=t[1](e)}),f(r.MolScriptSymbolTable.core.rel.gr,function(e,t){return t[0](e)>t[1](e)}),f(r.MolScriptSymbolTable.core.rel.gre,function(e,t){return t[0](e)>=t[1](e)}),f(r.MolScriptSymbolTable.core.rel.inRange,function(e,t){var n=t[0](e);return n>=t[1](e)&&n<=t[2](e)}),f(r.MolScriptSymbolTable.core.math.add,function(e,t){var n=0;if("number"==typeof t.length)for(var r=0,i=t.length;r<i;r++)n+=t[r](e);else for(var a=0,o=Object.keys(t);a<o.length;a++){n+=t[o[a]](e)}return n}),f(r.MolScriptSymbolTable.core.math.sub,function(e,t){var n=0;if("number"==typeof t.length){if(1===t.length)return-t[0](e);n=t[0](e)||0;for(var r=1,i=t.length;r<i;r++)n-=t[r](e)}else{var a=Object.keys(t);1===a.length&&(n=t[a[0]](e)||0);for(r=1,i=a.length;r<i;r++)n-=t[a[r]](e)}return n}),f(r.MolScriptSymbolTable.core.math.mult,function(e,t){var n=1;if("number"==typeof t.length)for(var r=0,i=t.length;r<i;r++)n*=t[r](e);else for(var a=0,o=Object.keys(t);a<o.length;a++){n*=t[o[a]](e)}return n}),f(r.MolScriptSymbolTable.core.math.div,function(e,t){return t[0](e)/t[1](e)}),f(r.MolScriptSymbolTable.core.math.pow,function(e,t){return Math.pow(t[0](e),t[1](e))}),f(r.MolScriptSymbolTable.core.math.mod,function(e,t){return t[0](e)%t[1](e)}),f(r.MolScriptSymbolTable.core.math.min,function(e,t){var n=Number.POSITIVE_INFINITY;if("number"==typeof t.length)for(var r=0,i=t.length;r<i;r++)n=Math.min(t[r](e),n);else for(var a=0,o=Object.keys(t);a<o.length;a++){var u=o[a];n=Math.min(t[u](e),n)}return n}),f(r.MolScriptSymbolTable.core.math.max,function(e,t){var n=Number.NEGATIVE_INFINITY;if("number"==typeof t.length)for(var r=0,i=t.length;r<i;r++)n=Math.max(t[r](e),n);else for(var a=0,o=Object.keys(t);a<o.length;a++){var u=o[a];n=Math.max(t[u](e),n)}return n}),f(r.MolScriptSymbolTable.core.math.floor,function(e,t){return Math.floor(t[0](e))}),f(r.MolScriptSymbolTable.core.math.ceil,function(e,t){return Math.ceil(t[0](e))}),f(r.MolScriptSymbolTable.core.math.roundInt,function(e,t){return Math.round(t[0](e))}),f(r.MolScriptSymbolTable.core.math.abs,function(e,t){return Math.abs(t[0](e))}),f(r.MolScriptSymbolTable.core.math.sqrt,function(e,t){return Math.sqrt(t[0](e))}),f(r.MolScriptSymbolTable.core.math.sin,function(e,t){return Math.sin(t[0](e))}),f(r.MolScriptSymbolTable.core.math.cos,function(e,t){return Math.cos(t[0](e))}),f(r.MolScriptSymbolTable.core.math.tan,function(e,t){return Math.tan(t[0](e))}),f(r.MolScriptSymbolTable.core.math.asin,function(e,t){return Math.asin(t[0](e))}),f(r.MolScriptSymbolTable.core.math.acos,function(e,t){return Math.acos(t[0](e))}),f(r.MolScriptSymbolTable.core.math.atan,function(e,t){return Math.atan(t[0](e))}),f(r.MolScriptSymbolTable.core.math.sinh,function(e,t){return Math.sinh(t[0](e))}),f(r.MolScriptSymbolTable.core.math.cosh,function(e,t){return Math.cosh(t[0](e))}),f(r.MolScriptSymbolTable.core.math.tanh,function(e,t){return Math.tanh(t[0](e))}),f(r.MolScriptSymbolTable.core.math.exp,function(e,t){return Math.exp(t[0](e))}),f(r.MolScriptSymbolTable.core.math.log,function(e,t){return Math.log(t[0](e))}),f(r.MolScriptSymbolTable.core.math.log10,function(e,t){return Math.log10(t[0](e))}),f(r.MolScriptSymbolTable.core.math.atan2,function(e,t){return Math.atan2(t[0](e),t[1](e))}),f(r.MolScriptSymbolTable.core.str.match,function(e,t){return t[0](e).test(t[1](e))}),f(r.MolScriptSymbolTable.core.str.concat,function(e,t){var n=[];if("number"==typeof t.length)for(var r=0,i=t.length;r<i;r++)n.push(t[r](e).toString());else for(var a=0,o=Object.keys(t);a<o.length;a++){var u=o[a];n.push(t[u](e).toString())}return n.join("")}),f(r.MolScriptSymbolTable.core.list.getAt,function(e,t){return t[0](e)[t[1](e)]}),f(r.MolScriptSymbolTable.core.set.has,function(e,t){return t[0](e).has(t[1](e))}),f(r.MolScriptSymbolTable.core.set.isSubset,function(e,t){return u.SetUtils.isSuperset(t[1](e),t[0](e))}),f(r.MolScriptSymbolTable.core.flags.hasAny,function(e,t){var n=t[1](e),r=t[0](e);return n?0!=(r&n):!!r}),f(r.MolScriptSymbolTable.core.flags.hasAll,function(e,t){var n=t[1](e),r=t[0](e);return n?(r&n)===n:!r}),f(r.MolScriptSymbolTable.structureQuery.type.elementSymbol,function(e,t){return o.ElementSymbol(t[0](e))}),f(r.MolScriptSymbolTable.structureQuery.type.atomName,function(e,t){return s.default(t[0](e))}),f(r.MolScriptSymbolTable.structureQuery.slot.element,function(e,t){return e.element}),d(r.MolScriptSymbolTable.structureQuery.generator.atomGroups,function(e,t){return a.Queries.generators.atoms({entityTest:t["entity-test"],chainTest:t["chain-test"],residueTest:t["residue-test"],atomTest:t["atom-test"],groupBy:t["group-by"]})(e)}),d(r.MolScriptSymbolTable.structureQuery.atomProperty.core.elementSymbol,h(a.StructureProperties.atom.type_symbol)),d(r.MolScriptSymbolTable.structureQuery.atomProperty.core.vdw,function(e,t){return c.VdwRadius(a.StructureProperties.atom.type_symbol(e.element))}),d(r.MolScriptSymbolTable.structureQuery.atomProperty.core.mass,function(e,t){return c.AtomWeight(a.StructureProperties.atom.type_symbol(e.element))}),d(r.MolScriptSymbolTable.structureQuery.atomProperty.core.atomicNumber,function(e,t){return c.AtomNumber(a.StructureProperties.atom.type_symbol(e.element))}),d(r.MolScriptSymbolTable.structureQuery.atomProperty.core.x,h(a.StructureProperties.atom.x)),d(r.MolScriptSymbolTable.structureQuery.atomProperty.core.y,h(a.StructureProperties.atom.y)),d(r.MolScriptSymbolTable.structureQuery.atomProperty.core.z,h(a.StructureProperties.atom.z)),d(r.MolScriptSymbolTable.structureQuery.atomProperty.core.atomKey,function(e,t){return l.cantorPairing(e.element.unit.id,e.element.element)}),d(r.MolScriptSymbolTable.structureQuery.atomProperty.macromolecular.residueKey,function(e,t){return a.StructureElement.residueIndex(e.element)}),d(r.MolScriptSymbolTable.structureQuery.atomProperty.macromolecular.chainKey,function(e,t){return a.StructureElement.chainIndex(e.element)}),d(r.MolScriptSymbolTable.structureQuery.atomProperty.macromolecular.entityKey,function(e,t){return a.StructureElement.entityIndex(e.element)}),d(r.MolScriptSymbolTable.structureQuery.atomProperty.macromolecular.id,h(a.StructureProperties.atom.id)),d(r.MolScriptSymbolTable.structureQuery.atomProperty.macromolecular.isHet,function(e,t){return"ATOM"!==a.StructureProperties.residue.group_PDB(e.element)}),d(r.MolScriptSymbolTable.structureQuery.atomProperty.macromolecular.label_atom_id,h(a.StructureProperties.atom.label_atom_id)),d(r.MolScriptSymbolTable.structureQuery.atomProperty.macromolecular.label_alt_id,h(a.StructureProperties.atom.label_alt_id)),d(r.MolScriptSymbolTable.structureQuery.atomProperty.macromolecular.label_asym_id,h(a.StructureProperties.chain.label_asym_id)),d(r.MolScriptSymbolTable.structureQuery.atomProperty.macromolecular.label_comp_id,h(a.StructureProperties.residue.label_comp_id)),d(r.MolScriptSymbolTable.structureQuery.atomProperty.macromolecular.label_seq_id,h(a.StructureProperties.residue.label_seq_id)),d(r.MolScriptSymbolTable.structureQuery.atomProperty.macromolecular.label_entity_id,h(a.StructureProperties.entity.id)),d(r.MolScriptSymbolTable.structureQuery.atomProperty.macromolecular.auth_atom_id,h(a.StructureProperties.atom.auth_atom_id)),d(r.MolScriptSymbolTable.structureQuery.atomProperty.macromolecular.auth_asym_id,h(a.StructureProperties.chain.auth_asym_id)),d(r.MolScriptSymbolTable.structureQuery.atomProperty.macromolecular.auth_comp_id,h(a.StructureProperties.residue.auth_comp_id)),d(r.MolScriptSymbolTable.structureQuery.atomProperty.macromolecular.auth_seq_id,h(a.StructureProperties.residue.auth_seq_id)),d(r.MolScriptSymbolTable.structureQuery.atomProperty.macromolecular.pdbx_PDB_ins_code,h(a.StructureProperties.residue.pdbx_PDB_ins_code)),d(r.MolScriptSymbolTable.structureQuery.atomProperty.macromolecular.pdbx_formal_charge,h(a.StructureProperties.atom.pdbx_formal_charge)),d(r.MolScriptSymbolTable.structureQuery.atomProperty.macromolecular.occupancy,h(a.StructureProperties.atom.occupancy)),d(r.MolScriptSymbolTable.structureQuery.atomProperty.macromolecular.B_iso_or_equiv,h(a.StructureProperties.atom.B_iso_or_equiv)),d(r.MolScriptSymbolTable.structureQuery.atomProperty.macromolecular.entityType,h(a.StructureProperties.entity.type)),d(r.MolScriptSymbolTable.structureQuery.atomProperty.macromolecular.isModified,function(e,t){return e.element.unit.model.properties.modifiedResidues.parentId.has(a.StructureProperties.residue.label_comp_id(e.element))}),d(r.MolScriptSymbolTable.structureQuery.atomProperty.macromolecular.modifiedParentName,function(e,t){var n=a.StructureProperties.residue.label_comp_id(e.element);return e.element.unit.model.properties.modifiedResidues.parentId.get(n)||n})];function h(e){return function(t,n){return e(t.element)}}!function(){for(var e=0,t=p;e<t.length;e++){var n=t[e];i.DefaultQueryRuntimeTable.addSymbol(n)}}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(212),a=n(278),o=n(155),u=n(214);!function(e){e.ElementSymbol=i.default.Value("Structure","ElementSymbol"),e.AtomName=i.default.Value("Structure","AtomName"),e.BondFlag=i.default.OneOf("Structure","BondFlag",i.default.Str,["covalent","metallic","ion","hydrogen","sulfide","computed","aromatic"]),e.BondFlags=a.Types.Flags(e.BondFlag,"BondFlags"),e.SecondaryStructureFlag=i.default.OneOf("Structure","SecondaryStructureFlag",i.default.Str,["alpha","beta","3-10","pi","sheet","strand","helix","turn","none"]),e.SecondaryStructureFlags=a.Types.Flags(e.SecondaryStructureFlag,"SecondaryStructureFlag"),e.RingFingerprint=i.default.Value("Structure","RingFingerprint"),e.EntityType=i.default.OneOf("Structure","EntityType",i.default.Str,["polymer","non-polymer","water","unknown"]),e.ResidueId=i.default.Value("Structure","ResidueId"),e.ElementSet=i.default.Value("Structure","ElementSet"),e.ElementSelection=i.default.Value("Structure","ElementSelection"),e.ElementReference=i.default.Value("Structure","ElementReference"),e.ElementSelectionQuery=a.Types.Fn(e.ElementSelection,"ElementSelectionQuery")}(r=t.Types||(t.Types={}));var s={"@header":"Types",elementSymbol:u.symbol(o.Arguments.Dictionary({0:o.Argument(i.default.Str)}),r.ElementSymbol,"Create element symbol representation from a string value."),atomName:u.symbol(o.Arguments.Dictionary({0:o.Argument(i.default.AnyValue)}),r.AtomName,"Convert a value to an atom name."),entityType:u.symbol(o.Arguments.Dictionary({0:o.Argument(r.EntityType)}),r.EntityType,"Create normalized representation of entity type: "+i.default.oneOfValues(r.EntityType).join(", ")+"."),bondFlags:u.symbol(o.Arguments.List(r.BondFlag),r.BondFlags,"Create bond flags representation from a list of strings. Allowed flags: "+i.default.oneOfValues(r.BondFlag).join(", ")+"."),ringFingerprint:u.symbol(o.Arguments.List(r.ElementSymbol,{nonEmpty:!0}),r.RingFingerprint,"Create ring fingerprint from the supplied atom element list."),secondaryStructureFlags:u.symbol(o.Arguments.List(r.SecondaryStructureFlag),r.SecondaryStructureFlags,"Create secondary structure flags representation from a list of strings. Allowed flags: "+i.default.oneOfValues(r.SecondaryStructureFlag).join(", ")+"."),authResidueId:u.symbol(o.Arguments.Dictionary({0:o.Argument(i.default.Str,{description:"auth_asym_id"}),1:o.Argument(i.default.Num,{description:"auth_seq_id"}),2:o.Argument(i.default.Str,{description:"pdbx_PDB_ins_code",isOptional:!0})}),r.ResidueId,'Residue identifier based on "auth_" annotation.'),labelResidueId:u.symbol(o.Arguments.Dictionary({0:o.Argument(i.default.Str,{description:"label_entity_id"}),1:o.Argument(i.default.Str,{description:"label_asym_id"}),2:o.Argument(i.default.Num,{description:"label_seq_id"}),3:o.Argument(i.default.Str,{description:"pdbx_PDB_ins_code",isOptional:!0})}),r.ResidueId,'Residue identifier based on mmCIF\'s "label_" annotation.')},c={"@header":"Iteration Slots",element:u.symbol(o.Arguments.None,r.ElementReference,"A reference to the current element."),elementSetReduce:u.symbol(o.Arguments.None,i.default.Variable("a",i.default.AnyValue,!0),"Current value of the element set reducer.")},l={"@header":"Generators",all:u.symbol(o.Arguments.None,r.ElementSelectionQuery,"The entire structure."),atomGroups:u.symbol(o.Arguments.Dictionary({"entity-test":o.Argument(i.default.Bool,{isOptional:!0,defaultValue:!0,description:"Test for the 1st atom of every entity"}),"chain-test":o.Argument(i.default.Bool,{isOptional:!0,defaultValue:!0,description:"Test for the 1st atom of every chain"}),"residue-test":o.Argument(i.default.Bool,{isOptional:!0,defaultValue:!0,description:"Test for the 1st atom every residue"}),"atom-test":o.Argument(i.default.Bool,{isOptional:!0,defaultValue:!0}),"group-by":o.Argument(i.default.Any,{isOptional:!0,defaultValue:"atom-key",description:"Group atoms to sets based on this property. Default: each atom has its own set"})}),r.ElementSelectionQuery,"Return all atoms for which the tests are satisfied, grouped into sets."),rings:u.symbol(o.Arguments.List(r.RingFingerprint),r.ElementSelectionQuery,"Return rings with the specified fingerprint(s). If no fingerprints are given, return all rings."),queryInSelection:u.symbol(o.Arguments.Dictionary({0:o.Argument(r.ElementSelectionQuery),query:o.Argument(r.ElementSelectionQuery),"in-complement":o.Argument(i.default.Bool,{isOptional:!0,defaultValue:!1})}),r.ElementSelectionQuery,"Executes query only on atoms that are in the source selection."),empty:u.symbol(o.Arguments.None,r.ElementSelectionQuery,"Nada.")},f={"@header":"Selection Modifications",queryEach:u.symbol(o.Arguments.Dictionary({0:o.Argument(r.ElementSelectionQuery),query:o.Argument(r.ElementSelectionQuery)}),r.ElementSelectionQuery,"Query every atom set in the input selection separately."),intersectBy:u.symbol(o.Arguments.Dictionary({0:o.Argument(r.ElementSelectionQuery),by:o.Argument(r.ElementSelectionQuery)}),r.ElementSelectionQuery,"Intersect each atom set from the first sequence from atoms in the second one."),exceptBy:u.symbol(o.Arguments.Dictionary({0:o.Argument(r.ElementSelectionQuery),by:o.Argument(r.ElementSelectionQuery)}),r.ElementSelectionQuery,"Remove all atoms from 'selection' that occur in 'by'."),unionBy:u.symbol(o.Arguments.Dictionary({0:o.Argument(r.ElementSelectionQuery),by:o.Argument(r.ElementSelectionQuery)}),r.ElementSelectionQuery,"For each atom set A in the orginal sequence, combine all atoms sets in the target selection that intersect with A."),union:u.symbol(o.Arguments.Dictionary({0:o.Argument(r.ElementSelectionQuery)}),r.ElementSelectionQuery,"Collects all atom sets in the sequence into a single atom set."),cluster:u.symbol(o.Arguments.Dictionary({0:o.Argument(r.ElementSelectionQuery),"min-distance":o.Argument(i.default.Num,{isOptional:!0,defaultValue:0}),"max-distance":o.Argument(i.default.Num),"min-size":o.Argument(i.default.Num,{description:"Minimal number of sets to merge, must be at least 2",isOptional:!0,defaultValue:2}),"max-size":o.Argument(i.default.Num,{description:"Maximal number of sets to merge, if not set, no limit",isOptional:!0})}),r.ElementSelectionQuery,"Combines atom sets that have mutual distance in the interval [min-radius, max-radius]. Minimum/maximum size determines how many atom sets can be combined."),includeSurroundings:u.symbol(o.Arguments.Dictionary({0:o.Argument(r.ElementSelectionQuery),radius:o.Argument(i.default.Num),"atom-radius":o.Argument(i.default.Num,{isOptional:!0,defaultValue:0,description:"Value added to each atom before the distance check, for example VDW radius. Using this argument is computationally demanding."}),"as-whole-residues":o.Argument(i.default.Bool,{isOptional:!0})}),r.ElementSelectionQuery,"For each atom set in the selection, include all surrouding atoms/residues that are within the specified radius."),includeConnected:u.symbol(o.Arguments.Dictionary({0:o.Argument(r.ElementSelectionQuery),"bond-test":o.Argument(i.default.Bool,{isOptional:!0,defaultValue:"true for covalent bonds"}),"layer-count":o.Argument(i.default.Num,{isOptional:!0,defaultValue:1,description:"Number of bonded layers to include."}),"as-whole-residues":o.Argument(i.default.Bool,{isOptional:!0})}),r.ElementSelectionQuery,"Pick all atom sets that are connected to the target."),expandProperty:u.symbol(o.Arguments.Dictionary({0:o.Argument(r.ElementSelectionQuery),property:o.Argument(i.default.AnyValue)}),r.ElementSelectionQuery,"To each atom set in the selection, add all atoms that have the same property value that was already present in the set.")},d={"@header":"Selection Filters",pick:u.symbol(o.Arguments.Dictionary({0:o.Argument(r.ElementSelectionQuery),test:o.Argument(i.default.Bool)}),r.ElementSelectionQuery,"Pick all atom sets that satisfy the test."),withSameAtomProperties:u.symbol(o.Arguments.Dictionary({0:o.Argument(r.ElementSelectionQuery),source:o.Argument(r.ElementSelectionQuery),property:o.Argument(i.default.Any)}),r.ElementSelectionQuery,"Pick all atom sets for which the set of given atom properties is a subset of the source properties."),intersectedBy:u.symbol(o.Arguments.Dictionary({0:o.Argument(r.ElementSelectionQuery),by:o.Argument(r.ElementSelectionQuery)}),r.ElementSelectionQuery,"Pick all atom sets that have non-zero intersection with the target."),within:u.symbol(o.Arguments.Dictionary({0:o.Argument(r.ElementSelectionQuery),target:o.Argument(r.ElementSelectionQuery),"min-radius":o.Argument(i.default.Num,{isOptional:!0,defaultValue:0}),"max-radius":o.Argument(i.default.Num),"atom-radius":o.Argument(i.default.Num,{isOptional:!0,defaultValue:0,description:"Value added to each atom before the distance check, for example VDW radius. Using this argument is computationally demanding."}),invert:o.Argument(i.default.Bool,{isOptional:!0,defaultValue:!1,description:"If true, pick only atom sets that are further than the specified radius."})}),r.ElementSelectionQuery,"Pick all atom sets from selection that have any atom within the radius of any atom from target."),isConnectedTo:u.symbol(o.Arguments.Dictionary({0:o.Argument(r.ElementSelectionQuery),target:o.Argument(r.ElementSelectionQuery),"bond-test":o.Argument(i.default.Bool,{isOptional:!0,defaultValue:"true for covalent bonds"}),disjunct:o.Argument(i.default.Bool,{isOptional:!0,defaultValue:!0,description:"If true, there must exist a bond to an atom that lies outside the given atom set to pass test."}),invert:o.Argument(i.default.Bool,{isOptional:!0,defaultValue:!1,description:"If true, return atom sets that are not connected."})}),r.ElementSelectionQuery,"Pick all atom sets that are connected to the target.")},p={"@header":"Selection Combinators",intersect:u.symbol(o.Arguments.List(r.ElementSelectionQuery),r.ElementSelectionQuery,"Return all unique atom sets that appear in all of the source selections."),merge:u.symbol(o.Arguments.List(r.ElementSelectionQuery),r.ElementSelectionQuery,"Merges multiple selections into a single one. Only unique atom sets are kept."),distanceCluster:u.symbol(o.Arguments.Dictionary({matrix:o.Argument(a.Types.List(a.Types.List(i.default.Num)),{description:"Distance matrix, represented as list of rows (num[][])). Lower triangle is min distance, upper triangle is max distance."}),selections:o.Argument(a.Types.List(r.ElementSelectionQuery),{description:"A list of held selections."})}),r.ElementSelectionQuery,"Pick combinations of atom sets from the source sequences that are mutually within distances specified by a matrix.")},h={"@header":"Atom Sets",atomCount:u.symbol(o.Arguments.None,i.default.Num),countQuery:u.symbol(o.Arguments.Dictionary({0:o.Argument(r.ElementSelectionQuery)}),i.default.Num,"Counts the number of occurences of a specific query inside the current atom set."),reduce:u.symbol(o.Arguments.Dictionary({initial:o.Argument(i.default.Variable("a",i.default.AnyValue,!0),{description:"Initial value assigned to slot.atom-set-reduce. Current atom is set to the 1st atom of the current set for this."}),value:o.Argument(i.default.Variable("a",i.default.AnyValue,!0),{description:"Expression executed for each atom in the set"})}),i.default.Variable("a",i.default.AnyValue,!0),"Execute the value expression for each atom in the current atom set and return the result. Works the same way as Array.reduce in JavaScript (``result = value(value(...value(initial)))``)"),propertySet:u.symbol(o.Arguments.Dictionary({0:o.Argument(a.Types.ConstrainedVar)}),a.Types.Set(a.Types.ConstrainedVar),"Returns a set with all values of the given property in the current atom set.")},m={"@header":"Atom Properties",core:{"@header":"Core Properties",elementSymbol:v(r.ElementSymbol),vdw:v(i.default.Num,"Van der Waals radius"),mass:v(i.default.Num,"Atomic weight"),atomicNumber:v(i.default.Num,"Atomic number"),x:v(i.default.Num,"Cartesian X coordinate"),y:v(i.default.Num,"Cartesian Y coordinate"),z:v(i.default.Num,"Cartesian Z coordinate"),atomKey:v(i.default.AnyValue,"Unique value for each atom. Main use case is grouping of atoms."),bondCount:u.symbol(o.Arguments.Dictionary({0:o.Argument(r.ElementReference,{isOptional:!0,defaultValue:"slot.current-atom"}),flags:o.Argument(r.BondFlags,{isOptional:!0,defaultValue:"covalent"})}),i.default.Num,"Number of bonds (by default only covalent bonds are counted).")},topology:{connectedComponentKey:v(i.default.AnyValue,"Unique value for each connected component.")},macromolecular:{"@header":"Macromolecular Properties (derived from the mmCIF format)",authResidueId:v(r.ResidueId,"type.auth-residue-id symbol executed on current atom's residue"),labelResidueId:v(r.ResidueId,"type.label-residue-id symbol executed on current atom's residue"),residueKey:v(i.default.AnyValue,"Unique value for each tuple ``(label_entity_id,auth_asym_id,auth_seq_id,pdbx_PDB_ins_code)``, main use case is grouping of atoms"),chainKey:v(i.default.AnyValue,"Unique value for each tuple ``(label_entity_id,auth_asym_id)``, main use case is grouping of atoms"),entityKey:v(i.default.AnyValue,"Unique value for each tuple ``label_entity_id``, main use case is grouping of atoms"),isHet:v(i.default.Bool,"Equivalent to atom_site.group_PDB !== ATOM"),id:v(i.default.Num,"_atom_site.id"),label_atom_id:v(r.AtomName),label_alt_id:v(i.default.Str),label_comp_id:v(i.default.Str),label_asym_id:v(i.default.Str),label_entity_id:v(i.default.Str),label_seq_id:v(i.default.Num),auth_atom_id:v(r.AtomName),auth_comp_id:v(i.default.Str),auth_asym_id:v(i.default.Str),auth_seq_id:v(i.default.Num),pdbx_PDB_ins_code:v(i.default.Str),pdbx_formal_charge:v(i.default.Num),occupancy:v(i.default.Num),B_iso_or_equiv:v(i.default.Num),entityType:v(r.EntityType,"Type of the entity as defined in mmCIF (polymer, non-polymer, water, unknown)"),secondaryStructureKey:v(i.default.AnyValue,"Unique value for each secondary structure element."),secondaryStructureFlags:v(r.SecondaryStructureFlags),isModified:v(i.default.Bool,"True if the atom bolongs to modification of a standard residue."),modifiedParentName:v(i.default.Str,"'3-letter' code of the modifed parent residue.")}},y={"@header":"Bond Properties",flags:b(r.BondFlags),order:b(i.default.Num)};function v(e,t){return u.symbol(o.Arguments.Dictionary({0:o.Argument(r.ElementReference,{isOptional:!0,defaultValue:"slot.current-atom"})}),e,t)}function b(e,t){return u.symbol(o.Arguments.None,e,t)}t.default={"@header":"Structure Queries",type:s,slot:c,generator:l,modifier:f,filter:d,combinator:p,atomSet:h,atomProperty:m,bondProperty:y}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return e?"string"==typeof e?e.toUpperCase():(""+e).toUpperCase():""}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(275),i=n(9),a=n(18),o=n(35),u=[a.Color.fromRgb(170,170,170),a.Color.fromRgb(0,255,0),a.Color.fromRgb(255,255,0),a.Color.fromRgb(255,128,0),a.Color.fromRgb(255,0,0)],s=[["No Issues",u[1]],["One Issue",u[2]],["Two Issues",u[3]],["Three Or More Issues",u[4]],["Not Applicable",u[9]]];t.StructureQualityReportColorTheme=function e(t,n){var a;if(t.structure&&!t.structure.isEmpty&&t.structure.models[0].customProperties.has(r.StructureQualityReport.Descriptor)){var c=r.StructureQualityReport.getIssues;a=function(e){return i.StructureElement.isLocation(e)?u[Math.min(3,c(e).length)+1]:u[0]}}else a=function(){return u[0]};return{factory:e,granularity:"group",color:a,props:n,description:"Assigns residue colors according to the number of issues in the PDBe Validation Report.",legend:o.TableLegend(s)}}},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var a=n(148),o=n(3),u=n(156),s=n(501),c=n(502),l=n(16),f=n(5),d=n(21);function p(e){if(l.isDataLoci(e)&&u.AssemblySymmetry.is(e.data)&&"axes"===e.tag){var t=e.data.db,n=t.rcsb_assembly_symmetry_axis,r=t.rcsb_assembly_symmetry,i=[];return f.OrderedSet.forEach(e.indices,function(e){var t=n.symmetry_id.value(e),a=d.Table.pickRow(r,function(e){return r.id.value(e)===t});a&&i.push("Axis of order "+n.order.value(e)+" for "+a.kind+" "+a.type.toLowerCase()+" symmetry")}),i.length?i.join(", "):void 0}}t.RCSBAssemblySymmetry=a.PluginBehavior.create({name:"rcsb-assembly-symmetry-prop",category:"custom-props",display:{name:"RCSB Assembly Symmetry",group:"Custom Props"},ctor:function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.attach=u.AssemblySymmetry.createAttachTask(t.ctx.fetch),t.provider={option:[u.AssemblySymmetry.Descriptor.name,"RCSB Assembly Symmetry"],descriptor:u.AssemblySymmetry.Descriptor,defaultSelected:t.params.autoAttach,attachableTo:function(){return!0},attach:t.attach},t}return i(t,e),t.prototype.register=function(){this.ctx.customModelProperties.register(this.provider),this.ctx.lociLabels.addProvider(p),this.ctx.structureRepresentation.themeCtx.colorThemeRegistry.add("rcsb-assembly-symmetry-cluster",s.AssemblySymmetryClusterColorThemeProvider),this.ctx.structureRepresentation.registry.add("rcsb-assembly-symmetry-axes",c.AssemblySymmetryAxesRepresentationProvider)},t.prototype.update=function(e){var t=this.params.autoAttach!==e.autoAttach;return this.params.autoAttach=e.autoAttach,this.provider.defaultSelected=e.autoAttach,t},t.prototype.unregister=function(){this.ctx.customModelProperties.unregister(u.AssemblySymmetry.Descriptor.name),this.ctx.lociLabels.removeProvider(p),this.ctx.structureRepresentation.themeCtx.colorThemeRegistry.remove("rcsb-assembly-symmetry-cluster"),this.ctx.structureRepresentation.registry.remove("rcsb-assembly-symmetry-axes")},t}(a.PluginBehavior.Handler),params:function(){return{autoAttach:o.ParamDefinition.Boolean(!1)}}})},function(e,t,n){"use strict";var r,i=this&&this.__makeTemplateObject||function(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e};Object.defineProperty(t,"__esModule",{value:!0}),t.default=(r||(r=i(["query AssemblySymmetry($pdbId: String!) {\n    assemblies(pdbId: $pdbId) {\n        pdbx_struct_assembly {\n            id\n        }\n        rcsb_struct_symmetry {\n            clusters {\n                avg_rmsd\n                members {\n                    asym_id\n                    pdbx_struct_oper_list_ids\n                }\n            }\n            kind\n            oligomeric_state\n            rotation_axes {\n                start\n                end\n                order\n            }\n            stoichiometry\n            symbol\n            type\n        }\n    }\n}"],["query AssemblySymmetry($pdbId: String!) {\n    assemblies(pdbId: $pdbId) {\n        pdbx_struct_assembly {\n            id\n        }\n        rcsb_struct_symmetry {\n            clusters {\n                avg_rmsd\n                members {\n                    asym_id\n                    pdbx_struct_oper_list_ids\n                }\n            }\n            kind\n            oligomeric_state\n            rotation_axes {\n                start\n                end\n                order\n            }\n            stoichiometry\n            symbol\n            type\n        }\n    }\n}"]))).raw.join("")},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{s(r.next(e))}catch(e){a(e)}}function u(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,u)}s((r=r.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}};Object.defineProperty(t,"__esModule",{value:!0});var a=n(154),o=n(215),u=n(127),s=n(11);function c(e){for(;e.position<e.length;)switch(e.data.charCodeAt(e.position)){case 9:case 10:case 13:case 32:return void(e.tokenEnd=e.position);default:++e.position}e.tokenEnd=e.position}function l(e,t,n){var r,i=n-t,a=e.tokenStart-t,o=e.tokenEnd-e.tokenStart;if(o<i)return!1;for(r=t;r<n;++r)if(e.data.charCodeAt(r)!==e.data.charCodeAt(r+a))return!1;return i===o||46===e.data.charCodeAt(r+a)}function f(e){var t;for(t=e.tokenStart;t<e.tokenEnd;++t)if(46===e.data.charCodeAt(t))return t;return t}function d(e,t){return e.data.substring(e.tokenStart,t)}function p(e){return e.data.substring(e.tokenStart,e.tokenEnd)}function h(e){var t=function(e){for(var t=10;e.position<e.length;){var n=e.data.charCodeAt(e.position);switch(n){case 9:case 32:t=n,++e.position;break;case 10:13!==t&&++e.lineNumber,t=n,++e.position;break;case 13:t=n,++e.position,++e.lineNumber;break;default:return t}}return t}(e);if(e.position>=e.length)e.tokenType=6;else{e.tokenStart=e.position,e.tokenEnd=e.position,e.isEscaped=!1;var n=e.data.charCodeAt(e.position);switch(n){case 35:!function(e){for(;e.position<e.length;){var t=e.data.charCodeAt(e.position);if(10===t||13===t)return;++e.position}}(e),e.tokenType=5;break;case 34:case 39:!function(e,t){var n,r;for(++e.position;e.position<e.length;)if((r=e.data.charCodeAt(e.position))===t)switch(n=e.data.charCodeAt(e.position+1)){case 9:case 10:case 13:case 32:return e.tokenStart++,e.tokenEnd=e.position,e.isEscaped=!0,void++e.position;default:if(void 0===n)return e.tokenStart++,e.tokenEnd=e.position,e.isEscaped=!0,void++e.position;++e.position}else{if(10===r||13===r)return void(e.tokenEnd=e.position);++e.position}e.tokenEnd=e.position}(e,n),e.tokenType=3;break;case 59:10===t||13===t?function(e){for(var t,n=59,r=e.position+1;r<e.length;){if(59===(t=e.data.charCodeAt(r))&&(10===n||13===n)){for(e.position=r+1,e.tokenStart++,r--,t=e.data.charCodeAt(r);10===t||13===t;)r--,t=e.data.charCodeAt(r);return e.tokenEnd=r+1,void(e.isEscaped=!0)}13===t?e.lineNumber++:10===t&&13!==n&&e.lineNumber++,n=t,++r}e.position=r}(e):c(e),e.tokenType=3;break;default:c(e),e.isEscaped?e.tokenType=3:95===e.data.charCodeAt(e.tokenStart)?e.tokenType=4:e.tokenEnd-e.tokenStart>=5&&95===e.data.charCodeAt(e.tokenStart+4)?!function(e){var t=e.data.charCodeAt(e.tokenStart);return!(68!==t&&100!==t||65!==(t=e.data.charCodeAt(e.tokenStart+1))&&97!==t||84!==(t=e.data.charCodeAt(e.tokenStart+2))&&116!==t||65!==(t=e.data.charCodeAt(e.tokenStart+3))&&97!==t)}(e)?!function(e){var t=e.data.charCodeAt(e.tokenStart);return!(83!==t&&115!==t||65!==(t=e.data.charCodeAt(e.tokenStart+1))&&97!==t||86!==(t=e.data.charCodeAt(e.tokenStart+2))&&118!==t||69!==(t=e.data.charCodeAt(e.tokenStart+3))&&101!==t)}(e)?!function(e){if(e.tokenEnd-e.tokenStart!=5)return!1;var t=e.data.charCodeAt(e.tokenStart);return!(76!==t&&108!==t||79!==(t=e.data.charCodeAt(e.tokenStart+1))&&111!==t||79!==(t=e.data.charCodeAt(e.tokenStart+2))&&111!==t||80!==(t=e.data.charCodeAt(e.tokenStart+3))&&112!==t)}(e)?e.tokenType=3:e.tokenType=2:e.tokenType=1:e.tokenType=0:e.tokenType=3}}}function m(e){for(h(e);5===e.tokenType;)h(e)}function y(){return{categoryNames:[],categories:Object.create(null)}}function v(e,t){for(var n=t.tokenizer,r=t.tokens,i=t.fieldCount,a=t.tokenCount,u=0;3===n.tokenType&&u<e;)o.TokenBuilder.add(r[a++%i],n.tokenStart,n.tokenEnd),m(n),u++;return t.tokenCount=a,u}function b(e,t){return e.update({message:"Parsing...",current:t.tokenizer.position,max:t.tokenizer.data.length})}function g(e,t){return r(this,void 0,void 0,function(){var n,r,u,c,l,h,y,g,_,S,C;return i(this,function(i){switch(i.label){case 0:for(n=e.lineNumber,m(e),r=d(e,f(e)),u=[];4===e.tokenType;)u[u.length]=p(e).substring(r.length+1),m(e);for(c="_atom_site"===r?e.data.length/100|0:32,l=[],h=u.length,S=0;S<h;S++)l[S]=o.TokenBuilder.create(e.data,c);return y={fieldCount:h,tokenCount:0,tokenizer:e,tokens:l},[4,s.chunkedSubtask(e.runtimeCtx,1e6,y,v,b)];case 1:if(i.sent(),y.tokenCount%h!=0)return[2,{hasError:!0,errorLine:e.lineNumber,errorMessage:"The number of values for loop starting at line "+n+" is not a multiple of the number of columns."}];for(g=y.tokenCount/h|0,_=Object.create(null),S=0;S<h;S++)_[u[S]]=a.CifField.ofTokens(l[S]);return C=r.substr(1),t.categories[C]=a.CifCategory(C,g,u,_),t.categoryNames.push(C),[2,{hasError:!1,errorLine:0,errorMessage:""}]}})})}function _(e,t){return u.ReaderResult.error(t,e)}function S(e){return u.ReaderResult.success(e)}function C(e,t){return r(this,void 0,void 0,function(){var n,r,o,u,s,c,h,v,b,C,x;return i(this,function(i){switch(i.label){case 0:n=[],r=function(e,t){return{data:e,length:e.length,position:0,tokenStart:0,tokenEnd:0,tokenType:6,lineNumber:1,isEscaped:!1,runtimeCtx:t}}(e,t),o="",u=y(),s=!1,c=[],h=y(),v=a.CifSafeFrame(h.categoryNames,h.categories,""),t.update({message:"Parsing...",current:0,max:e.length}),m(r),i.label=1;case 1:return 6===r.tokenType?[3,7]:0!==(b=r.tokenType)?[3,2]:s?[2,_(r.lineNumber,"Unexpected data block inside a save frame.")]:(u.categoryNames.length>0&&n.push(a.CifBlock(u.categoryNames,u.categories,o,c)),o=e.substring(r.tokenStart+5,r.tokenEnd),u=y(),c=[],m(r),[3,6]);case 2:if(1!==b)return[3,3];if(0===e.substring(r.tokenStart+5,r.tokenEnd).length)h.categoryNames.length>0&&(c[c.length]=v),s=!1;else{if(s)return[2,_(r.lineNumber,"Save frames cannot be nested.")];s=!0,C=e.substring(r.tokenStart+5,r.tokenEnd),h=y(),v=a.CifSafeFrame(h.categoryNames,h.categories,C)}return m(r),[3,6];case 3:return 2!==b?[3,5]:[4,g(r,s?h:u)];case 4:return(x=i.sent()).hasError?[2,_(x.errorLine,x.errorMessage)]:[3,6];case 5:if(4!==b)return[2,_(r.lineNumber,"Unexpected token. Expected data_, loop_, or data name.")];if((x=function(e,t){for(var n=e.tokenStart,r=f(e),i=d(e,r),o=Object.create(null),u=[],s=!0;s;){if(4!==e.tokenType||!l(e,n,r)){s=!1;break}var c=p(e).substring(i.length+1);if(m(e),3!==e.tokenType)return{hasError:!0,errorLine:e.lineNumber,errorMessage:"Expected value."};o[c]=a.CifField.ofTokens({data:e.data,indices:[e.tokenStart,e.tokenEnd],count:1}),u[u.length]=c,m(e)}var h=i.substr(1);return t.categories[h]=a.CifCategory(h,1,u,o),t.categoryNames.push(h),{hasError:!1,errorLine:0,errorMessage:""}}(r,s?h:u)).hasError)return[2,_(x.errorLine,x.errorMessage)];i.label=6;case 6:return[3,1];case 7:return s?[2,_(r.lineNumber,"Unfinished save frame ("+v.header+").")]:((u.categoryNames.length>0||c.length>0)&&n.push(a.CifBlock(u.categoryNames,u.categories,o,c)),[2,S(a.CifFile(n))])}})})}t.default=function(e){var t=this;return s.Task.create("Parse CIF",function(n){return r(t,void 0,void 0,function(){return i(this,function(t){switch(t.label){case 0:return[4,C(e,n)];case 1:return[2,t.sent()]}})})})}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{s(r.next(e))}catch(e){a(e)}}function u(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,u)}s((r=r.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}};Object.defineProperty(t,"__esModule",{value:!0});var a=n(154),o=n(494),u=n(127),s=n(495),c=n(11);function l(e){for(var t=Object.create(null),n=Object.create(null),r=0,i=e.columns;r<i.length;r++){var a=i[r];t[a.name]=a}return{rowCount:e.rowCount,name:e.name.substr(1),fieldNames:e.columns.map(function(e){return e.name}),getField:function(e){var r=t[e];if(r)return n[e]?n[e]:(n[e]=o.default(r),n[e])}}}t.default=function(e){var t=this;return c.Task.create("Parse BinaryCIF",function(n){return r(t,void 0,void 0,function(){var t,n,r;return i(this,function(i){t=[0,3];try{return n=s.default(e),function(e,t){for(var n=0;n<2;n++)if(e[n]>t[n])return!1;return!0}(t,n.version.match(/(\d)\.(\d)\.\d/).slice(1).map(function(e){return+e}))?(r=a.CifFile(n.dataBlocks.map(function(e){for(var t=Object.create(null),n=0,r=e.categories;n<r.length;n++){var i=r[n];t[i.name.substr(1)]=l(i)}return a.CifBlock(e.categories.map(function(e){return e.name.substr(1)}),t,e.header)})),[2,u.ReaderResult.success(r)]):[2,u.ReaderResult.error("Unsupported format version. Current "+n.version+", required "+t.join(".")+".")]}catch(e){return[2,u.ReaderResult.error(""+e)]}return[2]})})})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(21),i=n(138),a=n(211);t.default=function(e){var t=e.mask?i.decode(e.mask):void 0,n=i.decode(e.data),o=r.ColumnHelpers.isTypedArray(n),u=o?t?function(e){return 0===t[e]?""+n[e]:""}:function(e){return""+n[e]}:t?function(e){return 0===t[e]?n[e]:""}:function(e){return n[e]},s=o?function(e){return n[e]}:function(e){var t=n[e];return a.parseInt(t,0,t.length)},c=o?function(e){return n[e]}:function(e){var t=n[e];return a.parseFloat(t,0,t.length)},l=t?function(e){return t[e]}:function(e){return 0},f=n.length;return{__array:n,binaryEncoding:e.data.encoding,isDefined:!0,rowCount:f,str:u,int:s,float:c,valueKind:l,areValuesEqual:function(e,t){return n[e]===n[t]},toStringArray:function(e){return r.ColumnHelpers.createAndFillArray(f,u,e)},toIntArray:o?function(e){return r.ColumnHelpers.typedArrayWindow(n,e)}:function(e){return r.ColumnHelpers.createAndFillArray(f,s,e)},toFloatArray:o?function(e){return r.ColumnHelpers.typedArrayWindow(n,e)}:function(e){return r.ColumnHelpers.createAndFillArray(f,c,e)}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(193);function i(e,t){for(var n={},r=0;r<t;r++){n[s(e)]=s(e)}return n}function a(e,t){for(var n=new Uint8Array(t),r=e.offset,i=0;i<t;i++)n[i]=e.buffer[i+r];return e.offset+=t,n}function o(e,t){var n=r.utf8Read(e.buffer,e.offset,t);return e.offset+=t,n}function u(e,t){for(var n=new Array(t),r=0;r<t;r++)n[r]=s(e);return n}function s(e){var t,n,r=e.buffer[e.offset];if(0==(128&r))return e.offset++,r;if(128==(240&r))return n=15&r,e.offset++,i(e,n);if(144==(240&r))return n=15&r,e.offset++,u(e,n);if(160==(224&r))return n=31&r,e.offset++,o(e,n);if(224==(224&r))return t=e.dataView.getInt8(e.offset),e.offset++,t;switch(r){case 192:return e.offset++,null;case 194:return e.offset++,!1;case 195:return e.offset++,!0;case 196:return n=e.dataView.getUint8(e.offset+1),e.offset+=2,a(e,n);case 197:return n=e.dataView.getUint16(e.offset+1),e.offset+=3,a(e,n);case 198:return n=e.dataView.getUint32(e.offset+1),e.offset+=5,a(e,n);case 202:return t=e.dataView.getFloat32(e.offset+1),e.offset+=5,t;case 203:return t=e.dataView.getFloat64(e.offset+1),e.offset+=9,t;case 204:return t=e.buffer[e.offset+1],e.offset+=2,t;case 205:return t=e.dataView.getUint16(e.offset+1),e.offset+=3,t;case 206:return t=e.dataView.getUint32(e.offset+1),e.offset+=5,t;case 208:return t=e.dataView.getInt8(e.offset+1),e.offset+=2,t;case 209:return t=e.dataView.getInt16(e.offset+1),e.offset+=3,t;case 210:return t=e.dataView.getInt32(e.offset+1),e.offset+=5,t;case 217:return n=e.dataView.getUint8(e.offset+1),e.offset+=2,o(e,n);case 218:return n=e.dataView.getUint16(e.offset+1),e.offset+=3,o(e,n);case 219:return n=e.dataView.getUint32(e.offset+1),e.offset+=5,o(e,n);case 220:return n=e.dataView.getUint16(e.offset+1),e.offset+=3,u(e,n);case 221:return n=e.dataView.getUint32(e.offset+1),e.offset+=5,u(e,n);case 222:return n=e.dataView.getUint16(e.offset+1),e.offset+=3,i(e,n);case 223:return n=e.dataView.getUint32(e.offset+1),e.offset+=5,i(e,n)}throw new Error("Unknown type 0x"+r.toString(16))}t.default=function(e){return s({buffer:e,offset:0,dataView:new DataView(e.buffer)})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(21).Column.Schema,i=r.str,a=r.float,o=r.List,u=r.Aliased,s=r.int,c=r.coord;t.CCD_Schema={chem_comp:{formula:i,formula_weight:a,id:i,mon_nstd_parent_comp_id:o(",",function(e){return e}),name:i,one_letter_code:i,three_letter_code:i,type:u(i),pdbx_synonyms:o(";",function(e){return e}),pdbx_type:i,pdbx_ambiguous_flag:i,pdbx_replaced_by:i,pdbx_replaces:i,pdbx_formal_charge:s,pdbx_model_coordinates_details:i,pdbx_model_coordinates_db_code:i,pdbx_ideal_coordinates_details:i,pdbx_ideal_coordinates_missing_flag:u(i),pdbx_model_coordinates_missing_flag:u(i),pdbx_initial_date:i,pdbx_modified_date:i,pdbx_processing_site:u(i)},chem_comp_atom:{alt_atom_id:i,atom_id:i,charge:s,model_Cartn_x:c,model_Cartn_y:c,model_Cartn_z:c,comp_id:i,type_symbol:i,pdbx_align:s,pdbx_ordinal:s,pdbx_model_Cartn_x_ideal:c,pdbx_model_Cartn_y_ideal:c,pdbx_model_Cartn_z_ideal:c,pdbx_stereo_config:u(i),pdbx_aromatic_flag:u(i),pdbx_leaving_atom_flag:u(i)},chem_comp_bond:{atom_id_1:i,atom_id_2:i,comp_id:i,value_order:u(i),pdbx_ordinal:s,pdbx_stereo_config:u(i),pdbx_aromatic_flag:u(i)},pdbx_chem_comp_descriptor:{comp_id:i,descriptor:i,type:u(i),program:i,program_version:i},pdbx_chem_comp_identifier:{comp_id:i,identifier:i,type:u(i),program:i,program_version:i}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(21).Column.Schema,i=r.str,a=r.float,o=r.Aliased,u=r.int;t.BIRD_Schema={pdbx_reference_molecule:{prd_id:i,formula_weight:a,formula:i,type:o(i),type_evidence_code:i,class:o(i),class_evidence_code:i,name:i,represent_as:o(i),chem_comp_id:i,description:i,representative_PDB_id_code:i,release_status:o(i),replaces:i,replaced_by:i},pdbx_reference_entity_list:{prd_id:i,ref_entity_id:i,type:i,details:i,component_id:u},pdbx_reference_entity_nonpoly:{prd_id:i,ref_entity_id:i,name:i,chem_comp_id:i},pdbx_reference_entity_link:{link_id:u,prd_id:i,details:i,ref_entity_id_1:i,ref_entity_id_2:i,entity_seq_num_1:u,entity_seq_num_2:u,comp_id_1:i,comp_id_2:i,atom_id_1:i,atom_id_2:i,value_order:o(i),component_1:u,component_2:u,link_class:o(i)},pdbx_reference_entity_poly_link:{link_id:u,prd_id:i,ref_entity_id:i,component_id:u,entity_seq_num_1:u,entity_seq_num_2:u,comp_id_1:i,comp_id_2:i,atom_id_1:i,atom_id_2:i,value_order:o(i)},pdbx_reference_entity_poly:{prd_id:i,ref_entity_id:i,type:o(i),db_code:i,db_name:i},pdbx_reference_entity_poly_seq:{prd_id:i,ref_entity_id:i,mon_id:i,parent_mon_id:i,num:u,observed:o(i),hetero:o(i)},pdbx_reference_entity_sequence:{prd_id:i,ref_entity_id:i,type:i,NRP_flag:o(i),one_letter_codes:i},pdbx_reference_entity_src_nat:{prd_id:i,ref_entity_id:i,ordinal:u,organism_scientific:i,taxid:i,db_code:i,db_name:i},pdbx_prd_audit:{prd_id:i,date:i,processing_site:o(i),action_type:o(i)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(21).Column.Schema,i=r.str,a={id:i,description:i},o={title:i,datablock_id:i,version:i},u={version:i,update:i,revision:i},s={id:i,description:i},c={id:i,parent_id:i,description:i},l={code:i,primitive_code:i,construct:i,detail:i},f={code:i,detail:i},d={from_code:i,to_code:i,operator:i,factor:r.float};t.dic_Schema={datablock:a,dictionary:o,dictionary_history:u,sub_category:s,category_group_list:c,item_type_list:l,item_units_list:f,item_units_conversion:d}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(21).Column.Schema,i=r.str,a=r.int,o=r.float,u=r.Aliased,s=r.Vector;t.DensityServer_Header_Schema={density_server_result:{server_version:i,datetime_utc:i,guid:i,is_empty:u(i),has_error:u(i),error:i,query_source_id:i,query_type:u(i),query_box_type:u(i),query_box_a:s(3),query_box_b:s(3)}},t.DensityServer_Data_Schema={volume_data_3d_info:{name:i,axis_order:s(3,a),origin:s(3),dimensions:s(3),sample_rate:a,sample_count:s(3,a),spacegroup_number:a,spacegroup_cell_size:s(3),spacegroup_cell_angles:s(3),mean_source:o,mean_sampled:o,sigma_source:o,sigma_sampled:o,min_source:o,min_sampled:o,max_source:o,max_sampled:o},volume_data_3d:{values:o}}},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),a=this&&this.__assign||function(){return(a=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{s(r.next(e))}catch(e){a(e)}}function u(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,u)}s((r=r.apply(e,t||[])).next())})},u=this&&this.__generator||function(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}};Object.defineProperty(t,"__esModule",{value:!0});var s=function(e){function t(n,r){var i=this,a=t.extractMessage(n)+": "+JSON.stringify({response:n,request:r});return(i=e.call(this,a)||this).response=n,i.request=r,"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(i,t),i}return i(t,e),t.extractMessage=function(e){try{return e.errors[0].message}catch(t){return"GraphQL Error (Code: "+e.status+")"}},t}(Error);t.ClientError=s;var c=function(){function e(e,t){this.url=e,this.fetch=t,this.url=e}return e.prototype.request=function(e,t,n){return o(this,void 0,void 0,function(){var r,i,o;return u(this,function(u){switch(u.label){case 0:return r=JSON.stringify({query:t,variables:n||void 0}),[4,this.fetch(this.url,"string",r).runInContext(e)];case 1:if(i=u.sent(),!(o=JSON.parse(i)).errors&&o.data)return[2,o.data];throw new s(a({},"string"==typeof o?{error:o}:o),{query:t,variables:n})}})})},e}();t.GraphQLClient=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),i=n(21),a=n(156),o=n(18),u=n(9),s=n(50),c=n(280),l=o.Color(13421772);function f(e,t,n){return e+"-"+t+"-"+n.join("|")}function d(e){var n=r.ParamDefinition.clone(t.AssemblySymmetryClusterColorThemeParams);return n.symmetryId=c.getSymmetrySelectParam(e.structure),n}function p(e,t){var n=function(){return l},r=t.symmetryId;if(e.structure&&!e.structure.isEmpty&&e.structure.models[0].customProperties.has(a.AssemblySymmetry.Descriptor)){var s=a.AssemblySymmetry.get(e.structure.models[0]),c=s.db.rcsb_assembly_symmetry,d=i.Table.pickRow(c,function(e){return c.id.value(e)===r});if(d){var h=s.getClusters(r);if(h._rowCount){for(var m=new Map,y=0,v=h._rowCount;y<v;++y)for(var b=s.getClusterMembers(h.id.value(y)),g=0,_=b._rowCount;g<_;++g){var S=b.asym_id.value(g),C=b.pdbx_struct_oper_list_ids.value(g);0===C.length&&C.push("1"),m.set(f(d.assembly_id,S,C),y)}var x=o.ColorScale.create({listOrName:t.list,domain:[0,h._rowCount-1]});n=function(e){if(u.StructureElement.isLocation(e)){var t=e.unit.conformation.operator.assembly;if(t&&t.id===d.assembly_id){var n=function(e){switch(e.kind){case 0:return u.StructureProperties.chain.label_asym_id;case 1:case 2:return u.StructureProperties.coarse.asym_id}}(e.unit)(e),r=m.get(f(t.id,n,t.operList));return void 0!==r?x.color(r):l}}return l}}}}return{factory:p,granularity:"instance",color:n,props:t,description:"Assigns chain colors according to assembly symmetry cluster membership."}}t.AssemblySymmetryClusterColorThemeParams={list:r.ParamDefinition.Select("Viridis",s.ColorListOptions),symmetryId:c.getSymmetrySelectParam()},t.getAssemblySymmetryClusterColorThemeParams=d,t.AssemblySymmetryClusterColorTheme=p,t.AssemblySymmetryClusterColorThemeProvider={label:"RCSB Assembly Symmetry Cluster",factory:p,getParams:d,defaultValues:r.ParamDefinition.getDefaultValues(t.AssemblySymmetryClusterColorThemeParams),isApplicable:function(e){return!!e.structure&&!e.structure.isEmpty&&e.structure.models[0].customProperties.has(a.AssemblySymmetry.Descriptor)}}},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(3),a=n(38),o=n(156),u=n(21),s=n(54),c=n(2),l=n(126),f=n(146),d=n(73),p=n(29),h=n(16),m=n(36),y=n(71),v=n(5),b=n(280);function g(e,n){var r=i.ParamDefinition.clone(t.AssemblySymmetryAxesParams);return r.symmetryId=b.getSymmetrySelectParam(n),r.unitKinds.isHidden=!0,r}function _(e,t){return a.ComplexRepresentation("RCSB Assembly Symmetry Axes",e,t,S)}function S(){return d.ComplexMeshVisual({defaultProps:i.ParamDefinition.getDefaultValues(t.AssemblySymmetryAxesParams),createGeometry:P,createLocationIterator:C,getLoci:x,mark:w,setUpdateState:function(e,t,n){e.createGeometry=t.sizeFactor!==n.sizeFactor||t.detail!==n.detail||t.symmetryId!==n.symmetryId}})}function C(e){var t=o.AssemblySymmetry.get(e.models[0]),n=t?t.db.rcsb_assembly_symmetry_axis._rowCount:0;return m.LocationIterator(n,1,function(){return y.NullLocation})}function x(e,t,n){var r=e.objectId,i=e.groupId;if(n===r){var a=o.AssemblySymmetry.get(t.models[0]);if(a)return h.createDataLoci(a,"axes",v.OrderedSet.ofSingleton(i))}return h.EmptyLoci}function w(e,t,n){var r=!1;if(!h.isDataLoci(e)||"axes"!==e.tag)return!1;var i=o.AssemblySymmetry.get(t.models[0]);return!(!i||e.data!==i)&&(v.OrderedSet.forEach(e.indices,function(e){n(v.Interval.ofSingleton(e))&&(r=!0)}),r)}function P(e,t,n,r,i){var a=r.symmetryId,d=r.sizeFactor,h=o.AssemblySymmetry.get(t.models[0]);if(!h)return p.Mesh.createEmpty(i);var m=h.db.rcsb_assembly_symmetry,y=u.Table.pickRow(m,function(e){return m.id.value(e)===a});if(!y)return p.Mesh.createEmpty(i);if(!b.getAssemblyIds(t.units).includes(y.assembly_id))return p.Mesh.createEmpty(i);for(var v=h.db.rcsb_assembly_symmetry_axis,g=o.AssemblySymmetry.Schema.rcsb_assembly_symmetry_axis.start.space,_=1*d,S={radiusTop:_,radiusBottom:_},C=s.MeshBuilder.createState(256,128,i),x=0,w=v._rowCount;x<w;++x)if(v.symmetry_id.value(x)===a){var P=c.Tensor.toVec3(g,v.start.value(x)),T=c.Tensor.toVec3(g,v.end.value(x));C.currentGroup=x,l.addSphere(C,P,_,2),l.addSphere(C,T,_,2),f.addCylinder(C,P,T,1,S)}return s.MeshBuilder.getMesh(C)}t.AssemblySymmetryAxesParams=r({symmetryId:b.getSymmetrySelectParam(),sizeFactor:i.ParamDefinition.Numeric(.4,{min:0,max:3,step:.01})},d.ComplexMeshParams,{radialSegments:i.ParamDefinition.Numeric(16,{min:3,max:56,step:1}),detail:i.ParamDefinition.Numeric(0,{min:0,max:3,step:1})}),t.getAssemblySymmetryAxesParams=g,t.AssemblySymmetryAxesRepresentation=_,t.AssemblySymmetryAxesRepresentationProvider={label:"RCSB Assembly Symmetry Axes",description:"Displays assembly symmetry axes.",factory:_,getParams:g,defaultValues:i.ParamDefinition.getDefaultValues(t.AssemblySymmetryAxesParams),defaultColorTheme:"uniform",defaultSizeTheme:"uniform"},t.AssemblySymmetryAxesVisual=S,t.createAssemblySymmetryAxesMesh=P},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var a=n(85),o=n(3),u=n(131),s=n(2),c=n(26),l=n(27),f=n(274),d={rotate:o.ParamDefinition.Boolean(!1),rotateValue:o.ParamDefinition.Numeric(0,{min:0,max:360,step:.1}),explode:o.ParamDefinition.Boolean(!1),explodeValue:o.ParamDefinition.Numeric(0,{min:0,max:100,step:.1})};function p(e,t){return t.select(l.StateSelection.Generators.byValue(e).rootOfType([c.PluginStateObject.Molecule.Structure]))[0]}t.StructureAnimation=a.PluginBehavior.create({name:"structure-animation",category:"representation",display:{name:"Structure Animation",group:"Animation"},canAutoUpdate:function(){return!0},ctor:function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.ctx=t,r.params=n,r.tmpMat=s.Mat4.identity(),r.rotMat=s.Mat4.identity(),r.transMat=s.Mat4.identity(),r.animMat=s.Mat4.identity(),r.transVec=s.Vec3.zero(),r.rotVec=s.Vec3.create(0,1,0),r.centerVec=s.Vec3.zero(),r.rotateAnimHandle=-1,r.explodeAnimHandle=-1,r.updatedUnitTransforms=new Set,r.structureUnitTransforms=new Map,r.update(n),r}return i(t,e),t.prototype.getUnitTransforms=function(e){var t=this.structureUnitTransforms.get(e.id);return t||(t=new f.StructureUnitTransforms(e.data),this.structureUnitTransforms.set(e.id,t)),t},t.prototype.rotate=function(e){this.updatedUnitTransforms.clear();var t=this.ctx.state.dataState,n=t.selectQ(function(e){return e.rootsOfType(c.PluginStateObject.Molecule.Representation3D)});s.Mat4.rotate(this.rotMat,this.tmpMat,e,this.rotVec);for(var r=0,i=n;r<i.length;r++){var a=i[r];if(!c.PluginStateObject.isRepresentation3D(a.obj))return;var o=p(a,t);if(o&&c.PluginStateObject.Molecule.Structure.is(o.obj)){var u=this.getUnitTransforms(o.obj);if(!this.updatedUnitTransforms.has(o.obj)){for(var l=0,f=o.obj.data.units.length;l<f;++l){var d=o.obj.data.units[l];s.Vec3.transformMat4(this.centerVec,d.lookup3d.boundary.sphere.center,d.conformation.operator.matrix),s.Vec3.negate(this.transVec,s.Vec3.copy(this.transVec,this.centerVec)),s.Mat4.fromTranslation(this.transMat,this.transVec),s.Mat4.mul(this.animMat,this.rotMat,this.transMat),s.Vec3.copy(this.transVec,this.centerVec),s.Mat4.fromTranslation(this.transMat,this.transVec),s.Mat4.mul(this.animMat,this.transMat,this.animMat),u.setTransform(this.animMat,d)}this.updatedUnitTransforms.add(o.obj)}a.obj.data.setState({unitTransforms:u}),this.ctx.canvas3d.add(a.obj.data)}}this.ctx.canvas3d.requestDraw(!0)},t.prototype.animateRotate=function(e){var t=this;if(e){var n=function(e){t.rotate(u.degToRad(e/10%360)),t.rotateAnimHandle=requestAnimationFrame(n)};this.rotateAnimHandle=requestAnimationFrame(n)}else cancelAnimationFrame(this.rotateAnimHandle)},t.prototype.explode=function(e){this.updatedUnitTransforms.clear();for(var t=this.ctx.state.dataState,n=0,r=t.selectQ(function(e){return e.rootsOfType(c.PluginStateObject.Molecule.Representation3D)});n<r.length;n++){var i=r[n];if(!c.PluginStateObject.isRepresentation3D(i.obj))return;var a=p(i,t);if(a&&c.PluginStateObject.Molecule.Structure.is(a.obj)){var o=this.getUnitTransforms(a.obj),u=a.obj.data.boundary.sphere.radius*(e/100);if(!this.updatedUnitTransforms.has(a.obj)){for(var l=0,f=a.obj.data.units.length;l<f;++l){var d=a.obj.data.units[l];s.Vec3.transformMat4(this.centerVec,d.lookup3d.boundary.sphere.center,d.conformation.operator.matrix),s.Vec3.sub(this.transVec,this.centerVec,a.obj.data.boundary.sphere.center),s.Vec3.setMagnitude(this.transVec,this.transVec,u),s.Mat4.fromTranslation(this.animMat,this.transVec),o.setTransform(this.animMat,d)}this.updatedUnitTransforms.add(a.obj)}i.obj.data.setState({unitTransforms:o}),this.ctx.canvas3d.add(i.obj.data)}}this.ctx.canvas3d.requestDraw(!0)},t.prototype.animateExplode=function(e){var t=this;if(e){var n=function(e){t.explode(50*(Math.sin(.001*e)+1)),t.explodeAnimHandle=requestAnimationFrame(n)};this.explodeAnimHandle=requestAnimationFrame(n)}else cancelAnimationFrame(this.explodeAnimHandle)},t.prototype.register=function(){},t.prototype.update=function(e){var t=!o.ParamDefinition.areEqual(d,this.params,e);return this.params.rotate!==e.rotate&&(this.params.rotate=e.rotate,this.animateRotate(this.params.rotate)),this.params.explode!==e.explode&&(this.params.explode=e.explode,this.animateExplode(this.params.explode)),this.params.rotateValue!==e.rotateValue&&(this.params.rotateValue=e.rotateValue,this.rotate(u.degToRad(this.params.rotateValue))),this.params.explodeValue!==e.explodeValue&&(this.params.explodeValue=e.explodeValue,this.explode(this.params.explodeValue)),t},t.prototype.unregister=function(){cancelAnimationFrame(this.rotateAnimHandle),cancelAnimationFrame(this.explodeAnimHandle)},t}(a.PluginBehavior.Handler),params:function(){return d}})},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),a=this&&this.__assign||function(){return(a=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{s(r.next(e))}catch(e){a(e)}}function u(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,u)}s((r=r.apply(e,t||[])).next())})},u=this&&this.__generator||function(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}};Object.defineProperty(t,"__esModule",{value:!0});var s=n(85),c=n(3),l=n(2),f=n(26),d=n(27),p=n(121),h=n(204),m=n(505),y=n(35),v=n(506),b=n(9),g=n(114),_=n(7),S=n(94);function C(e,t){for(var n;;){var r=d.StateSelection.findAncestorOfType(t.tree,t.cells,e.transform.ref,[f.PluginStateObject.Molecule.Structure]);if(!r)break;n=r,e=r}return n||(f.PluginStateObject.Molecule.Structure.is(e.obj)?e:void 0)}function x(e){switch(e.kind){case 0:return b.StructureProperties.chain.auth_asym_id;case 1:case 2:return b.StructureProperties.coarse.asym_id}}t.SceneLabelsParams=a({},h.Text.Params,{background:c.ParamDefinition.Boolean(!0),backgroundMargin:c.ParamDefinition.Numeric(.2,{min:0,max:1,step:.01}),backgroundColor:c.ParamDefinition.Color(y.ColorNames.snow),backgroundOpacity:c.ParamDefinition.Numeric(.9,{min:0,max:1,step:.01}),levels:c.ParamDefinition.MultiSelect([],[["structure","structure"],["polymer","polymer"],["ligand","ligand"]])}),t.SceneLabels=s.PluginBehavior.create({name:"scene-labels",category:"representation",display:{name:"Scene Labels",group:"Labels"},canAutoUpdate:function(){return!0},ctor:function(e){function n(t,n){var r=e.call(this,t,n)||this;return r.ctx=t,r.params=n,r.data={transforms:[l.Mat4.identity()],texts:[],positions:[],sizes:[],depths:[]},r.geo=h.Text.createEmpty(),r.structures=new Set,r.triggerUpdate=function(){return o(r,void 0,void 0,function(){return u(this,function(e){switch(e.label){case 0:return[4,this.update(this.params)];case 1:return e.sent(),[2]}})})},r.getColor=function(){return y.ColorNames.dimgrey},r.getSize=function(e){return r.data.sizes[e]},r.getLabel=function(){return""},r.getLabelsShape=function(e,t,n,i){return r.geo=function(e,t,n){for(var r=e.texts,i=e.positions,a=e.depths,o=v.TextBuilder.create(t,10*r.length,10*r.length/2,n),u=0,s=r.length;u<s;++u){var c=i[u];o.add(r[u],c[0],c[1],c[2],a[u],u)}return o.getText()}(t,n,r.geo),p.Shape.create("Scene Labels",r.geo,r.getColor,r.getSize,r.getLabel,t.transforms)},r.repr=m.ShapeRepresentation(r.getLabelsShape,h.Text.Utils),t.events.state.object.created.subscribe(r.triggerUpdate),t.events.state.object.removed.subscribe(r.triggerUpdate),t.events.state.object.updated.subscribe(r.triggerUpdate),t.events.state.cell.stateUpdated.subscribe(r.triggerUpdate),r}return i(n,e),n.prototype.updateStructures=function(e){for(var t=this.ctx.state.dataState,n=t.selectQ(function(e){return e.rootsOfType(f.PluginStateObject.Molecule.Structure)}),r=new Set,i=0,a=n;i<a.length;i++){var o=a[i],u=C(o,t);u&&f.PluginStateObject.Molecule.Structure.is(u.obj)&&(t.cellStates.get(o.transform.ref).isHidden||r.add(u.obj))}return!g.SetUtils.areEqual(r,this.structures)&&(this.structures=r,!0)},n.prototype.updateLabels=function(e){var t=b.StructureElement.create(),n=this.data,r=n.texts,i=n.positions,a=n.sizes,o=n.depths;r.length=0,i.length=0,a.length=0,o.length=0,this.structures.forEach(function(n){e.levels.includes("structure")&&(r.push(""+n.data.model.label),i.push(n.data.boundary.sphere.center),a.push(n.data.boundary.sphere.radius/10),o.push(n.data.boundary.sphere.radius));for(var u=0,s=n.data.units.length;u<s;++u){var c="",f=n.data.units[u];if(t.unit=f,t.element=f.elements[0],e.levels.includes("polymer")&&f.polymerElements.length&&(c=b.StructureProperties.entity.pdbx_description(t).join(", ")+" ("+x(f)(t)+")"),e.levels.includes("ligand")&&!f.polymerElements.length){var d=S.getElementMoleculeType(f,f.elements[0]);1!==d&&8!==d||(c=b.StructureProperties.entity.pdbx_description(t).join(", ")+" ("+x(f)(t)+")")}if(c){r.push(c);var p=f.lookup3d.boundary.sphere,h=p.center,m=p.radius,y=l.Vec3.transformMat4(l.Vec3.zero(),h,f.conformation.operator.matrix);i.push(y),a.push(Math.max(2,m/10)),o.push(m)}}})},n.prototype.register=function(){},n.prototype.update=function(e){return o(this,void 0,void 0,function(){var n;return u(this,function(r){switch(r.label){case 0:return n=!1,!this.updateStructures(e)&&_.arrayEqual(this.params.levels,e.levels)?[3,2]:(this.updateLabels(e),[4,this.repr.createOrUpdate(e,this.data).run()]);case 1:return r.sent(),n=!0,[3,4];case 2:return c.ParamDefinition.areEqual(t.SceneLabelsParams,this.params,e)?[3,4]:[4,this.repr.createOrUpdate(e).run()];case 3:r.sent(),n=!0,r.label=4;case 4:return n&&(Object.assign(this.params,e),this.ctx.canvas3d.add(this.repr)),[2,n]}})})},n.prototype.unregister=function(){},n}(s.PluginBehavior.Handler),params:function(){return t.SceneLabelsParams}})},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{s(r.next(e))}catch(e){a(e)}}function u(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,u)}s((r=r.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}};Object.defineProperty(t,"__esModule",{value:!0});var a,o=n(11),u=n(79),s=n(32),c=n(16),l=n(7),f=n(121),d=n(5),p=n(3),h=n(82),m=n(51),y=n(36),v=n(53),b=n(39),g=n(70),_=n(257),S=n(58),C=n(123),x=n(2),w=n(125),P=n(72),T=n(258);function A(e,t){for(var n=t&&t.aTransform.ref.value.length>=16*e.length?t.aTransform.ref.value:new Float32Array(16*e.length),r=0,i=e.length;r<i;++r)x.Mat4.toArray(e[r],n,16*r);return h.createTransform(n,e.length,t)}t.ShapeRepresentation=function(e,t){var n,h,y,x=0,E=new b.Subject,k=s.Representation.createState(),I=[],M=v.createEmptyTheme(),V=p.ParamDefinition.getDefaultValues(t.Params),O=C.VisualUpdateState.create();return{label:"Shape geometry",get groupCount(){return y?y.count:0},get props(){return V},get params(){},get state(){return k},get theme(){return M},renderObjects:I,updated:E,createOrUpdate:function(s,c){var f=this;return void 0===s&&(s={}),o.Task.create("ShapeRepresentation.create",function(o){return r(f,void 0,void 0,function(){var r,f,d,p,v,b,w,k;return i(this,function(i){switch(i.label){case 0:return r=Object.assign(V,s),c?[4,e(o,c,r,h)]:[3,2];case 1:return d=i.sent(),[3,3];case 2:d=void 0,i.label=3;case 3:if(function(e,t){void 0===e&&(e={}),C.VisualUpdateState.reset(O),(t||h)&&(t&&!h?O.createNew=!0:t&&h&&t.id===h.id?(O.updateColor=!0,O.updateTransform=!0):t&&h&&t.id!==h.id?(O.updateTransform=!0,O.createGeometry=!0):t&&console.warn("unexpected state"),O.updateTransform&&(O.updateColor=!0,O.updateSize=!0),O.createGeometry&&(O.updateColor=!0,O.updateSize=!0))}(s,f=d),f&&(h=f,M.color=_.ShapeGroupColorTheme({shape:h},{}),M.size=T.ShapeGroupSizeTheme({shape:h},{})),O.createNew)I.length=0,y=a.fromShape(h),p=A(h.transforms),v=t.createValues(h.geometry,p,y,M,r),b=t.createRenderableState(r),(n=u.createRenderObject(h.geometry.kind,v,b))&&I.push(n);else{if(!n)throw new Error("expected renderObject to be available");O.updateTransform&&(A(h.transforms,n.values),y=a.fromShape(h),w=y.instanceCount,k=y.groupCount,m.createMarkers(w*k,n.values)),O.createGeometry&&l.ValueCell.update(n.values.drawCount,g.Geometry.getDrawCount(h.geometry)),(O.updateTransform||O.createGeometry)&&t.updateBoundingSphere(n.values,h.geometry),O.updateColor&&S.createColors(y,M.color,n.values),O.updateSize&&"uSize"in n.values&&P.createSizes(y,M.size,n.values),t.updateValues(n.values,r),t.updateRenderableState(n.state,r)}return V=r,E.next(x++),[2]}})})})},getLoci:function(e){var t=e.objectId,r=e.groupId,i=e.instanceId;return n&&n.id===t?f.Shape.Loci(h,[{ids:d.OrderedSet.ofSingleton(r)}],i):c.EmptyLoci},mark:function(e,t){if(!n)return!1;var r=n.values.tMarker,i=!1,a=y.groupCount,o=y.count;if(c.isEveryLoci(e))m.applyMarkerAction(r.ref.value.array,0,o,t)&&(i=!0);else if(f.Shape.isLoci(e))for(var u=e.instance,s=0,p=e.groups;s<p.length;s++){var h=p[s];if(d.Interval.is(h.ids)){var v=u*a+d.Interval.start(h.ids),b=u*a+d.Interval.end(h.ids);m.applyMarkerAction(r.ref.value.array,v,b,t)&&(i=!0)}else for(var g=0,_=h.ids.length;g<_;g++){var S=u*a+h.ids[g];m.applyMarkerAction(r.ref.value.array,S,S+1,t)&&(i=!0)}}return i&&l.ValueCell.update(r,r.ref.value),i},setState:function(e){n&&(void 0!==e.visible&&w.Visual.setVisibility(n,e.visible),void 0!==e.pickable&&w.Visual.setPickable(n,e.pickable),void 0!==e.transform&&w.Visual.setTransform(n,e.transform)),s.Representation.updateState(k,e)},setTheme:function(e){console.warn("The `ShapeRepresentation` theme is fixed to `ShapeGroupColorTheme` and `ShapeGroupSizeTheme`. Colors are taken from `Shape.getColor` and sizes from `Shape.getSize`")},destroy:function(){I.length=0,n=void 0}}},function(e){e.fromShape=function(e){var t=e.transforms.length,n=f.Shape.Location(e);return y.LocationIterator(e.groupCount,t,function(e,t){return n.group=e,n.instance=t,n})}}(a=t.ShapeGroupIterator||(t.ShapeGroupIterator={}))},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(3),a=n(77),o=n(17),u=n(204),s=n(255),c=new Uint16Array([0,1,2,1,3,2]);!function(e){e.create=function(e,t,n,l){void 0===e&&(e={}),void 0===t&&(t=2048),void 0===n&&(n=1024),t*=2,n*=2;var f=o.ChunkedArray.create(Float32Array,3,n,l?l.centerBuffer.ref.value:t),d=o.ChunkedArray.create(Float32Array,2,n,l?l.mappingBuffer.ref.value:t),p=o.ChunkedArray.create(Float32Array,1,n,l?l.depthBuffer.ref.value:t),h=o.ChunkedArray.create(Uint32Array,3,n,l?l.indexBuffer.ref.value:t),m=o.ChunkedArray.create(Float32Array,1,n,l?l.groupBuffer.ref.value:t),y=o.ChunkedArray.create(Float32Array,2,n,l?l.tcoordBuffer.ref.value:t),v=r({},i.ParamDefinition.getDefaultValues(u.Text.Params),e),b=v.attachment,g=v.background,_=v.backgroundMargin,S=s.getFontAtlas(v),C=.4*_,x=S.buffer/S.lineHeight;return{add:function(e,t,n,r,i,a){for(var u,s,l=0,v=e.length,_=0;_<v;++_)l+=(T=S.get(e[_])).nw-2*x;if(u=b.startsWith("top")?.8:b.startsWith("middle")?.4:0,s=b.endsWith("right")?l:b.endsWith("center")?l/2:0,g){o.ChunkedArray.add2(d,-l+s-C-.1,u+C),o.ChunkedArray.add2(d,-l+s-C-.1,-u-C),o.ChunkedArray.add2(d,l-s+C+.1,u+C),o.ChunkedArray.add2(d,l-s+C+.1,-u-C);for(var w=f.elementCount,P=0;P<4;++P)o.ChunkedArray.add2(y,10,10),o.ChunkedArray.add3(f,t,n,r),o.ChunkedArray.add(p,i),o.ChunkedArray.add(m,a);o.ChunkedArray.add3(h,w+c[0],w+c[1],w+c[2]),o.ChunkedArray.add3(h,w+c[3],w+c[4],w+c[5])}for(s+=x,u+=x,l=0,_=0;_<v;++_){var T=S.get(e[_]);o.ChunkedArray.add2(d,l-s,T.nh-u),o.ChunkedArray.add2(d,l-s,-u),o.ChunkedArray.add2(d,l+T.nw-s,T.nh-u),o.ChunkedArray.add2(d,l+T.nw-s,-u);var A=S.texture.width,E=S.texture.height;for(o.ChunkedArray.add2(y,T.x/A,T.y/E),o.ChunkedArray.add2(y,T.x/A,(T.y+T.h)/E),o.ChunkedArray.add2(y,(T.x+T.w)/A,T.y/E),o.ChunkedArray.add2(y,(T.x+T.w)/A,(T.y+T.h)/E),l+=T.nw-2*x,w=f.elementCount,P=0;P<4;++P)o.ChunkedArray.add3(f,t,n,r),o.ChunkedArray.add(p,i),o.ChunkedArray.add(m,a);o.ChunkedArray.add3(h,w+c[0],w+c[1],w+c[2]),o.ChunkedArray.add3(h,w+c[3],w+c[4],w+c[5])}},getText:function(){var e=S.texture,t=o.ChunkedArray.compact(f,!0),n=o.ChunkedArray.compact(d,!0),r=o.ChunkedArray.compact(p,!0),i=o.ChunkedArray.compact(h,!0),u=o.ChunkedArray.compact(m,!0),s=o.ChunkedArray.compact(y,!0);return{kind:"text",charCount:h.elementCount/2,fontTexture:l?a.ValueCell.update(l.fontTexture,e):a.ValueCell.create(e),centerBuffer:l?a.ValueCell.update(l.centerBuffer,t):a.ValueCell.create(t),mappingBuffer:l?a.ValueCell.update(l.mappingBuffer,n):a.ValueCell.create(n),depthBuffer:l?a.ValueCell.update(l.depthBuffer,r):a.ValueCell.create(r),indexBuffer:l?a.ValueCell.update(l.indexBuffer,i):a.ValueCell.create(i),groupBuffer:l?a.ValueCell.update(l.groupBuffer,u):a.ValueCell.create(u),tcoordBuffer:l?a.ValueCell.update(l.tcoordBuffer,s):a.ValueCell.create(s)}}}}}(t.TextBuilder||(t.TextBuilder={}))},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{s(r.next(e))}catch(e){a(e)}}function u(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,u)}s((r=r.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}};Object.defineProperty(t,"__esModule",{value:!0});var a=n(27),o=n(26),u=n(148),s=n(272),c=n(270),l=n(99),f=n(37),d=n(508),p=function(){function e(e){var t=this;this.plugin=e,this.ev=l.RxEventHelper.create(),this.cameraSnapshots=new s.CameraSnapshotManager,this.snapshots=new c.PluginStateSnapshotManager,this.behavior={kind:this.ev.behavior("data"),currentObject:this.ev.behavior({})},this.dataState=a.State.create(new o.PluginStateObject.Root({}),{globalContext:e}),this.behaviorState=a.State.create(new u.PluginBehavior.Root({}),{globalContext:e,rootProps:{isLocked:!0}}),this.dataState.behaviors.currentObject.subscribe(function(e){"data"===t.behavior.kind.value&&t.behavior.currentObject.next(e)}),this.behaviorState.behaviors.currentObject.subscribe(function(e){"behavior"===t.behavior.kind.value&&t.behavior.currentObject.next(e)}),this.behavior.currentObject.next(this.dataState.behaviors.currentObject.value),this.animation=new d.PluginAnimationManager(e)}return e.prototype.setKind=function(e){e!==this.behavior.kind.value&&(this.behavior.kind.next(e),this.behavior.currentObject.next("data"===e?this.dataState.behaviors.currentObject.value:this.behaviorState.behaviors.currentObject.value))},e.prototype.getSnapshot=function(){return{data:this.dataState.getSnapshot(),behaviour:this.behaviorState.getSnapshot(),animation:this.animation.getSnapshot(),cameraSnapshots:this.cameraSnapshots.getStateSnapshot(),canvas3d:{camera:this.plugin.canvas3d.camera.getSnapshot(),viewport:this.plugin.canvas3d.props}}},e.prototype.setSnapshot=function(e){return r(this,void 0,void 0,function(){return i(this,function(t){switch(t.label){case 0:return e.behaviour?[4,this.plugin.runTask(this.behaviorState.setSnapshot(e.behaviour))]:[3,2];case 1:t.sent(),t.label=2;case 2:return e.data?[4,this.plugin.runTask(this.dataState.setSnapshot(e.data))]:[3,4];case 3:t.sent(),t.label=4;case 4:return e.cameraSnapshots&&this.cameraSnapshots.setStateSnapshot(e.cameraSnapshots),e.canvas3d&&(e.canvas3d.viewport&&f.PluginCommands.Canvas3D.SetSettings.dispatch(this.plugin,{settings:e.canvas3d.viewport||{}}),e.canvas3d.camera&&this.plugin.canvas3d.camera.setState(e.canvas3d.camera)),this.plugin.canvas3d.requestDraw(!0),e.animation&&this.animation.setSnapshot(e.animation),[2]}})})},e.prototype.dispose=function(){this.ev.dispose(),this.dataState.dispose(),this.behaviorState.dispose(),this.cameraSnapshots.dispose(),this.animation.dispose()},e}();t.PluginState=p},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),a=this&&this.__assign||function(){return(a=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{s(r.next(e))}catch(e){a(e)}}function u(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,u)}s((r=r.apply(e,t||[])).next())})},u=this&&this.__generator||function(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}};Object.defineProperty(t,"__esModule",{value:!0});var s=n(152),c=n(3),l=function(e){function t(t){var n=e.call(this,{params:{current:""},animationState:"stopped"})||this;return n.context=t,n.map=new Map,n.animations=[],n._params=void 0,n.events={updated:n.ev()},n._frame=void 0,n.animate=function(e){return o(n,void 0,void 0,function(){var t;return u(this,function(n){switch(n.label){case 0:return this._frame=void 0,this._current.startedTime<0&&(this._current.startedTime=e),[4,this._current.anim.apply(this._current.state,{lastApplied:this._current.lastTime,current:e-this._current.startedTime},{params:this._current.paramValues,plugin:this.context})];case 1:return"finished"===(t=n.sent()).kind?this.stop():"next"===t.kind?(this._current.state=t.state,this._current.lastTime=e-this._current.startedTime,"playing"===this.state.animationState&&(this._frame=requestAnimationFrame(this.animate))):"skip"===t.kind&&"playing"===this.state.animationState&&(this._frame=requestAnimationFrame(this.animate)),[2]}})})},n}return i(t,e),Object.defineProperty(t.prototype,"isEmpty",{get:function(){return 0===this.animations.length},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"current",{get:function(){return this._current},enumerable:!0,configurable:!0}),t.prototype.triggerUpdate=function(){this.events.updated.next()},t.prototype.getParams=function(){return this._params||(this._params={current:c.ParamDefinition.Select(this.animations[0]&&this.animations[0].name,this.animations.map(function(e){return[e.name,e.display.name]}),{label:"Animation"})}),this._params},t.prototype.updateParams=function(e){this.updateState({params:a({},this.state.params,e)});var t=this.map.get(this.state.params.current),n=t.params(this.context);this._current={anim:t,params:n,paramValues:c.ParamDefinition.getDefaultValues(n),state:{},startedTime:-1,lastTime:0},this.triggerUpdate()},t.prototype.updateCurrentParams=function(e){this._current.paramValues=a({},this._current.paramValues,e),this.triggerUpdate()},t.prototype.register=function(e){this.map.has(e.name)?this.context.log.error("Animation '"+e.name+"' is already registered."):(this._params=void 0,this.map.set(e.name,e),this.animations.push(e),1===this.animations.length?this.updateParams({current:e.name}):this.triggerUpdate())},t.prototype.play=function(e,t){this.stop(),this.map.has(e.name)||this.register(e),this.updateParams({current:e.name}),this.updateCurrentParams(t),this.start()},t.prototype.start=function(){this.updateState({animationState:"playing"}),this.triggerUpdate(),this._current.lastTime=0,this._current.startedTime=-1,this._current.state=this._current.anim.initialState(this._current.paramValues,this.context),requestAnimationFrame(this.animate)},t.prototype.stop=function(){void 0!==this._frame&&cancelAnimationFrame(this._frame),this.updateState({animationState:"stopped"}),this.triggerUpdate()},Object.defineProperty(t.prototype,"isAnimating",{get:function(){return"playing"===this.state.animationState},enumerable:!0,configurable:!0}),t.prototype.getSnapshot=function(){return this.current?{state:this.state,current:{paramValues:this._current.paramValues,state:this._current.anim.stateSerialization?this._current.anim.stateSerialization.toJSON(this._current.state):this._current.state}}:{state:this.state}},t.prototype.setSnapshot=function(e){this.updateState({animationState:e.state.animationState}),this.updateParams(e.state.params),e.current&&(this.current.paramValues=e.current.paramValues,this.current.state=this._current.anim.stateSerialization?this._current.anim.stateSerialization.fromJSON(e.current.state):e.current.state,this.triggerUpdate(),"playing"===this.state.animationState&&this.resume())},t.prototype.resume=function(){this._current.lastTime=0,this._current.startedTime=-1,requestAnimationFrame(this.animate)},t}(s.PluginComponent);t.PluginAnimationManager=l},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{s(r.next(e))}catch(e){a(e)}}function u(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,u)}s((r=r.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}};Object.defineProperty(t,"__esModule",{value:!0});var a=n(11),o=n(99),u=n(76),s=function(){function e(){this.ev=o.RxEventHelper.create(),this.id=0,this.events={progress:this.ev(),finished:this.ev()}}return e.prototype.track=function(e){var t=this;return function(n){var r=u.now()-n.root.progress.startedTime;n.root.progress.startedTime,t.events.progress.next({id:e,level:r<250?"none":r<1500?"background":"overlay",progress:n})}},e.prototype.run=function(e){return r(this,void 0,void 0,function(){var t;return i(this,function(n){switch(n.label){case 0:t=this.id++,n.label=1;case 1:return n.trys.push([1,,3,4]),[4,e.run(this.track(t),100)];case 2:return[2,n.sent()];case 3:return this.events.finished.next({id:t}),[7];case 4:return[2]}})})},e.prototype.dispose=function(){this.ev.dispose()},e}();t.TaskManager=s,function(e){e.testTask=function(e){var t=this;return a.Task.create("Test",function(n){return r(t,void 0,void 0,function(){var t;return i(this,function(r){switch(r.label){case 0:t=0,r.label=1;case 1:return t<e?[4,(i=100+200*Math.random(),new Promise(function(e){return setTimeout(e,i)}))]:[3,5];case 2:return r.sent(),n.shouldUpdate?[4,n.update({message:"Step "+t,current:t,max:e,isIndeterminate:!1})]:[3,4];case 3:r.sent(),r.label=4;case 4:return t++,[3,1];case 5:return[2]}var i})})})}}(s||(s={})),t.TaskManager=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){var t=this;this.ctx=e,this.providers=[],this.empty=[],e.behaviors.canvas.highlightLoci.subscribe(function(n){return e.events.labels.highlight.next({entries:t.getInfo(n.loci,n.repr)})})}return e.prototype.addProvider=function(e){this.providers.push(e)},e.prototype.removeProvider=function(e){this.providers=this.providers.filter(function(t){return t!==e})},e.prototype.getInfo=function(e,t){if(!e||"empty-loci"===e.kind)return this.empty;for(var n=[],r=0,i=this.providers;r<i.length;r++){var a=(0,i[r])(e,t);a&&n.push(a)}return n},e}();t.LociLabelManager=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i,a=n(19),o=n(2);!function(e){e.One={cell:a.SpacegroupCell.Zero,fractionalBox:a.Box3D.empty(),data:o.Tensor.create(o.Tensor.Space([1,1,1],[0,1,2]),o.Tensor.Data1([0])),dataStats:{min:0,max:0,mean:0,sigma:0}};var t=o.Mat4.zero(),n=o.Mat4.zero();e.getGridToCartesianTransform=function(e){var r=e.data.space,i=o.Mat4.fromScaling(t,o.Vec3.div(o.Vec3.zero(),a.Box3D.size(o.Vec3.zero(),e.fractionalBox),o.Vec3.ofArray(r.dimensions))),u=o.Mat4.fromTranslation(n,e.fractionalBox.min);return o.Mat4.mul3(o.Mat4.zero(),e.cell.fromFractional,u,i)},e.areEquivalent=function(e,t){return e===t}}(r||(r={})),t.VolumeData=r,function(e){e.absolute=function(e){return{kind:"absolute",absoluteValue:e}},e.relative=function(e){return{kind:"relative",relativeValue:e}},e.calcAbsolute=function(e,t){return t*e.sigma+e.mean},e.calcRelative=function(e,t){return 0===e.sigma?0:(t-e.mean)/e.sigma},e.toAbsolute=function(t,n){return"absolute"===t.kind?t:{kind:"absolute",absoluteValue:e.calcAbsolute(n,t.relativeValue)}},e.toRelative=function(t,n){return"relative"===t.kind?t:{kind:"relative",relativeValue:e.calcRelative(n,t.absoluteValue)}},e.toString=function(e){return"relative"===e.kind?e.relativeValue+" ":""+e.absoluteValue}}(i||(i={})),t.VolumeIsoValue=i},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{s(r.next(e))}catch(e){a(e)}}function u(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,u)}s((r=r.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(86),u=n(283),s=n(16),c=n(3),l=n(2),f=n(19),d=n(139),p=n(36),h=n(96),m=n(59),y=n(71);function v(e,t){var n=f.Box3D.empty();return f.Box3D.add(n,e),f.Box3D.transform(n,n,t),n}function b(e,t){var n=e.data,r=e.dataStats,i=n.space,a=n.data,o=i.dimensions,u=i.get,s=function(e,t){var n=0,r=e[1],i=1,a=e[0];return t<e[0]*e[2]?(a=Math.floor(t/e[0]),i=Math.ceil(e[2]/a),n=a*e[0],r*=i):n=e[0]*e[2],{width:n+=a,height:r+=i,columns:a,rows:i}}(o,t),c=s.width,l=s.height,f=s.columns,d=s.rows,p=new Uint8Array(c*l*4),h={array:p,width:c,height:l},m=o[0],y=o[1],v=o[2],b=m+1,g=y+1;function _(e,t,n,i){var a=Math.floor(i*b%c/b),o=Math.floor(i*b/c);p[4*(o*g*c+n*c+(a*b+t))+3]=(e-r.min)/(r.max-r.min)*255}console.log("dim",o),console.log("layout",{width:c,height:l,columns:f,rows:d});for(var S=0;S<v;++S)for(var C=0;C<y;++C)for(var x=0;x<m;++x)_(u(a,x,C,S),x,C,S);return h}function g(e,t,n,r){var i=n.data.space.dimensions,a=b(n,t.maxTextureSize),u=o.VolumeData.getGridToCartesianTransform(n),s=v(i,u),c=l.Vec3.create(i[0],i[1],i[2]);c[0]+=1,c[0]+=1;var f=r?r.gridTexture.ref.value:d.createTexture(t,"image-uint8","rgba","ubyte","linear");return f.load(a),h.DirectVolume.create(s,c,u,f,r)}function _(e,t,n,r){var i=n.data.space.dimensions,a=function(e){for(var t=e.data,n=e.dataStats,r=t.space,i=t.data,a=r.dimensions,o=a[0],u=a[1],s=a[2],c=r.get,l=new Uint8Array(o*u*s*4),f={array:l,width:o,height:u,depth:s},d=0,p=0;p<s;++p)for(var h=0;h<u;++h)for(var m=0;m<o;++m)d<100&&console.log(c(i,m,h,p),(c(i,m,h,p)-n.min)/(n.max-n.min)*255),l[d+3]=(c(i,m,h,p)-n.min)/(n.max-n.min)*255,d+=4;return f}(n),u=o.VolumeData.getGridToCartesianTransform(n),s=v(i,u),c=r?r.gridTexture.ref.value:d.createTexture(t,"volume-uint8","rgba","ubyte","linear");return c.load(a),h.DirectVolume.create(s,i,u,c,r)}function S(e,t,n,r,o){return i(this,void 0,void 0,function(){var n,r;return a(this,function(i){switch(i.label){case 0:if(e.runtime,void 0===(n=e.webgl))throw new Error("DirectVolumeVisual requires `webgl` in props");return n.isWebGL2?[4,_(0,n,t,o)]:[3,2];case 1:return r=i.sent(),[3,4];case 2:return[4,g(0,n,t,o)];case 3:r=i.sent(),i.label=4;case 4:return[2,r]}})})}function C(e,n){return c.ParamDefinition.clone(t.DirectVolumeParams)}function x(){return u.VolumeVisual({defaultProps:c.ParamDefinition.getDefaultValues(t.DirectVolumeParams),createGeometry:S,createLocationIterator:function(e){return p.LocationIterator(1,1,function(){return y.NullLocation})},getLoci:function(){return s.EmptyLoci},mark:function(){return!1},setUpdateState:function(e,t,n){},geometryUtils:h.DirectVolume.Utils})}function w(e,t){return u.VolumeRepresentation("Direct Volume",e,t,x)}t.createDirectVolume2d=g,t.createDirectVolume3d=_,t.createDirectVolume=S,t.DirectVolumeParams=r({},m.BaseGeometry.Params,h.DirectVolume.Params),t.getDirectVolumeParams=C,t.DirectVolumeVisual=x,t.DirectVolumeRepresentation=w,t.DirectVolumeRepresentationProvider={label:"Direct Volume",description:"Direct volume rendering of volumetric data.",factory:w,getParams:C,defaultValues:c.ParamDefinition.getDefaultValues(t.DirectVolumeParams),defaultColorTheme:"uniform",defaultSizeTheme:"uniform"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PLUGIN_VERSION="0.5.0",t.PLUGIN_VERSION_TIMESTAMP=1551025445408,t.PLUGIN_VERSION_DATE=new Date(t.PLUGIN_VERSION_TIMESTAMP)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=["gz","zip"],i=["bcif","ccp4","dcd"];t.getFileInfo=function(e){var t,n,a="",o=(t=e instanceof File?e.name:e instanceof Blob?"":e).lastIndexOf("?"),u=-1!==o?t.substring(o):"",s=(t=t.substring(0,-1===o?t.length:o)).replace(/^.*[\\\/]/,""),c=s.substring(0,s.lastIndexOf(".")),l=s.split("."),f=l.length>1?(l.pop()||"").toLowerCase():"",d=t.match(/^(.+):\/\/(.+)$/);d&&(a=d[1].toLowerCase(),t=d[2]||"");var p=t.substring(0,t.lastIndexOf("/")+1);if(r.includes(f)){n=f;var h=t.length-f.length-1;f=(t.substr(0,h).split(".").pop()||"").toLowerCase();var m=c.length-f.length-1;c=c.substr(0,m)}else n=!1;return{path:t,name:s,ext:f,base:c,dir:p,compressed:n,binary:i.includes(f),protocol:a,query:u,src:e}}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{s(r.next(e))}catch(e){a(e)}}function u(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,u)}s((r=r.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}};Object.defineProperty(t,"__esModule",{value:!0});var a=n(26),o=n(26),u=n(11),s=n(75),c=n(3),l=n(27),f=n(153),d=n(286),p=n(517),h=a.PluginStateTransform.BuiltIn({name:"download",display:{name:"Download",description:"Download string or binary data from the specified URL"},from:[o.PluginStateObject.Root],to:[o.PluginStateObject.Data.String,o.PluginStateObject.Data.Binary],params:{url:c.ParamDefinition.Text("https://www.ebi.ac.uk/pdbe/static/entry/1cbs_updated.cif",{description:"Resource URL. Must be the same domain or support CORS."}),label:c.ParamDefinition.makeOptional(c.ParamDefinition.Text("")),isBinary:c.ParamDefinition.makeOptional(c.ParamDefinition.Boolean(!1,{description:"If true, download data as binary (string otherwise)"}))}})({apply:function(e,t){var n=this,a=e.params;return u.Task.create("Download",function(e){return r(n,void 0,void 0,function(){var n;return i(this,function(r){switch(r.label){case 0:return[4,t.fetch(a.url,a.isBinary?"binary":"string").runInContext(e)];case 1:return n=r.sent(),[2,a.isBinary?new o.PluginStateObject.Data.Binary(n,{label:a.label?a.label:a.url}):new o.PluginStateObject.Data.String(n,{label:a.label?a.label:a.url})]}})})})},update:function(e){var t=e.oldParams,n=e.newParams,r=e.b;return t.url!==n.url||t.isBinary!==n.isBinary?l.StateTransformer.UpdateResult.Recreate:t.label!==n.label?(r.label=n.label||n.url,l.StateTransformer.UpdateResult.Updated):l.StateTransformer.UpdateResult.Unchanged}});t.Download=h;var m=a.PluginStateTransform.BuiltIn({name:"read-file",display:{name:"Read File",description:"Read string or binary data from the specified file"},from:o.PluginStateObject.Root,to:[o.PluginStateObject.Data.String,o.PluginStateObject.Data.Binary],params:{file:c.ParamDefinition.File(),label:c.ParamDefinition.makeOptional(c.ParamDefinition.Text("")),isBinary:c.ParamDefinition.makeOptional(c.ParamDefinition.Boolean(!1,{description:"If true, open file as as binary (string otherwise)"}))}})({apply:function(e){var t=this,n=e.params;return u.Task.create("Open File",function(e){return r(t,void 0,void 0,function(){var t;return i(this,function(r){switch(r.label){case 0:return[4,f.readFromFile(n.file,n.isBinary?"binary":"string").runInContext(e)];case 1:return t=r.sent(),[2,n.isBinary?new o.PluginStateObject.Data.Binary(t,{label:n.label?n.label:n.file.name}):new o.PluginStateObject.Data.String(t,{label:n.label?n.label:n.file.name})]}})})})},update:function(e){var t=e.oldParams,n=e.newParams,r=e.b;return t.label!==n.label?(r.label=n.label||t.file.name,l.StateTransformer.UpdateResult.Updated):l.StateTransformer.UpdateResult.Unchanged},isSerializable:function(){return{isSerializable:!1,reason:"Cannot serialize user loaded files."}}});t.ReadFile=m;var y=a.PluginStateTransform.BuiltIn({name:"parse-cif",display:{name:"Parse CIF",description:"Parse CIF from String or Binary data"},from:[o.PluginStateObject.Data.String,o.PluginStateObject.Data.Binary],to:o.PluginStateObject.Format.Cif})({apply:function(e){var t=this,n=e.a;return u.Task.create("Parse CIF",function(e){return r(t,void 0,void 0,function(){var t;return i(this,function(r){switch(r.label){case 0:return[4,(o.PluginStateObject.Data.String.is(n)?s.default.parse(n.data):s.default.parseBinary(n.data)).runInContext(e)];case 1:if((t=r.sent()).isError)throw new Error(t.message);return[2,new o.PluginStateObject.Format.Cif(t.result)]}})})})}});t.ParseCif=y;var v=a.PluginStateTransform.BuiltIn({name:"parse-ccp4",display:{name:"Parse CCP4/MRC/MAP",description:"Parse CCP4/MRC/MAP from Binary data"},from:[o.PluginStateObject.Data.Binary],to:o.PluginStateObject.Format.Ccp4})({apply:function(e){var t=this,n=e.a;return u.Task.create("Parse CCP4/MRC/MAP",function(e){return r(t,void 0,void 0,function(){var t;return i(this,function(r){switch(r.label){case 0:return[4,d.parse(n.data).runInContext(e)];case 1:if((t=r.sent()).isError)throw new Error(t.message);return[2,new o.PluginStateObject.Format.Ccp4(t.result)]}})})})}});t.ParseCcp4=v;var b=a.PluginStateTransform.BuiltIn({name:"parse-dsn6",display:{name:"Parse DSN6/BRIX",description:"Parse CCP4/BRIX from Binary data"},from:[o.PluginStateObject.Data.Binary],to:o.PluginStateObject.Format.Dsn6})({apply:function(e){var t=this,n=e.a;return u.Task.create("Parse DSN6/BRIX",function(e){return r(t,void 0,void 0,function(){var t;return i(this,function(r){switch(r.label){case 0:return[4,p.parse(n.data).runInContext(e)];case 1:if((t=r.sent()).isError)throw new Error(t.message);return[2,new o.PluginStateObject.Format.Dsn6(t.result)]}})})})}});t.ParseDsn6=b},function(e,t){},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{s(r.next(e))}catch(e){a(e)}}function u(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,u)}s((r=r.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}};Object.defineProperty(t,"__esModule",{value:!0});var a=n(11),o=n(127),u=n(287),s=n(158);function c(e){var t=e.xExtent,n=e.yExtent,r=e.zExtent;return{xBlocks:Math.ceil(t/8),yBlocks:Math.ceil(n/8),zBlocks:Math.ceil(r/8)}}function l(e){return r(this,void 0,void 0,function(){var n,r,a,o;return i(this,function(i){switch(i.label){case 0:return[4,e.readBuffer(0,t.dsn6HeaderSize)];case 1:return n=i.sent().buffer,r=String.fromCharCode.apply(null,n),a=r.startsWith(":-)"),o=a||100===n.readInt16LE(36),[2,{header:a?(u=r,{xStart:parseInt(u.substr(10,5)),yStart:parseInt(u.substr(15,5)),zStart:parseInt(u.substr(20,5)),xExtent:parseInt(u.substr(32,5)),yExtent:parseInt(u.substr(38,5)),zExtent:parseInt(u.substr(42,5)),xRate:parseInt(u.substr(52,5)),yRate:parseInt(u.substr(58,5)),zRate:parseInt(u.substr(62,5)),xlen:parseFloat(u.substr(73,10)),ylen:parseFloat(u.substr(83,10)),zlen:parseFloat(u.substr(93,10)),alpha:parseFloat(u.substr(103,10)),beta:parseFloat(u.substr(113,10)),gamma:parseFloat(u.substr(123,10)),divisor:parseFloat(u.substr(138,12)),summand:parseInt(u.substr(155,8)),sigma:parseFloat(u.substr(170,12))}):function(e,t){var n=t?function(t){return e.readInt16LE(2*t)}:function(t){return e.readInt16BE(2*t)},r=1/n(17);return{xStart:n(0),yStart:n(1),zStart:n(2),xExtent:n(3),yExtent:n(4),zExtent:n(5),xRate:n(6),yRate:n(7),zRate:n(8),xlen:n(9)*r,ylen:n(10)*r,zlen:n(11)*r,alpha:n(12)*r,beta:n(13)*r,gamma:n(14)*r,divisor:n(15)/100,summand:n(16),sigma:void 0}}(n,o),littleEndian:o}]}var u})})}function f(e,t,n,a){return r(this,void 0,void 0,function(){var r,o,u,l,f,d,p,h,m,y,v,b,g,_,S,C,x,w,P;return i(this,function(i){for(a||s.SimpleBuffer.flipByteOrderInPlace2(t.buffer),r=e.divisor,o=e.summand,u=e.xExtent,l=e.yExtent,f=e.zExtent,d=c(e),p=d.xBlocks,h=d.yBlocks,m=d.zBlocks,y=0,v=0;v<m;++v)for(b=0;b<h;++b)for(g=0;g<p;++g)for(_=0;_<8;++_)for(S=8*v+_,C=0;C<8;++C)for(x=8*b+C,w=0;w<8;++w){if(!((P=8*g+w)<u&&x<l&&S<f)){y+=8-w;break}n[(P*l+x)*f+S]=(t[y]-o)/r,++y}return[2]})})}function d(e){var t=e.xExtent,n=e.yExtent,r=e.zExtent,i=c(e),a=8*i.xBlocks*i.yBlocks*8*i.zBlocks*8;return{count:a,byteCount:1*a,valueCount:t*n*r}}function p(e,n,a){return r(this,void 0,void 0,function(){var r,o,u,s,c,p;return i(this,function(i){switch(i.label){case 0:return[4,a.update({message:"Parsing DSN6/BRIX file..."})];case 1:return i.sent(),[4,l(e)];case 2:return r=i.sent(),o=r.header,u=r.littleEndian,[4,e.readBuffer(t.dsn6HeaderSize,n-t.dsn6HeaderSize)];case 3:return s=i.sent().buffer,c=d(o).valueCount,p=new Float32Array(c),[4,f(o,s,p,u)];case 4:return i.sent(),[2,{header:o,values:p}]}})})}function h(e,t){var n=this;return a.Task.create("Parse DSN6/BRIX",function(a){return r(n,void 0,void 0,function(){var n,r,u;return i(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),r=(n=o.ReaderResult).success,[4,p(e,t,a)];case 1:return[2,r.apply(n,[i.sent()])];case 2:return u=i.sent(),[2,o.ReaderResult.error(u)];case 3:return[2]}})})})}t.dsn6HeaderSize=512,t.readDsn6Header=l,t.parseDsn6Values=f,t.getDsn6Counts=d,t.parseFile=h,t.parse=function(e){return h(u.FileHandle.fromBuffer(s.SimpleBuffer.fromUint8Array(e)),e.length)}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{s(r.next(e))}catch(e){a(e)}}function u(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,u)}s((r=r.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}};Object.defineProperty(t,"__esModule",{value:!0});var a=n(11),o=n(127),u=n(215);t.parsePDB=function(e,t){var n=this;return a.Task.create("Parse PDB",function(a){return r(n,void 0,void 0,function(){var n,r,s;return i(this,function(i){switch(i.label){case 0:return r=(n=o.ReaderResult).success,s={id:t},[4,u.Tokenizer.readAllLinesAsync(e,a)];case 1:return[2,r.apply(n,[(s.lines=i.sent(),s)])]}})})})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(11),i=n(290),a=n(291);t.trajectoryFromMmCIF=function(e){return r.Task.create("Create mmCIF Model",function(t){return a._parse_mmCif(i.ModelFormat.mmCIF(e),t)})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),i=n(135),a=n(231),o=n(9),u=n(9);function s(e,t,n){for(var r=e.data,s=r.pdbx_struct_assembly,d=r.pdbx_struct_assembly_gen,p=s.id.value(t),h=s.details.value(t),m=[],y=d.assembly_id,v=d.oper_expression,b=d.asym_id_list,g=0,_=d._rowCount;g<_;g++)y.value(g)===p&&(m[m.length]={assemblyId:p,expression:v.value(g),asymIds:b.value(g)});return a.Assembly.create(p,h,function(e,t){return function(){for(var n=[],r=0,a=0;a<e.length;a++){var s=e[a],d=f(s.expression),p=c(d),h=l(t,p,r,s.assemblyId),m=o.Queries.generators.atoms({chainTest:o.Queries.pred.and(o.Queries.pred.eq(function(e){return u.StructureProperties.unit.operator_name(e.element)},i.SymmetryOperator.DefaultName),o.Queries.pred.inSet(function(e){return u.StructureProperties.chain.label_asym_id(e.element)},s.asymIds))});n[n.length]={selector:m,operators:h},r+=h.length}return n}}(m,n))}function c(e){for(var t=[],n=[],r=0;r<e.length;r++)n[r]="";return function e(t,n,r,i){if(r<0)return void(n[n.length]=i.slice(0));var a=t[r],o=a.length;for(var u=0;u<o;u++)i[r]=a[u],e(t,n,r-1,i)}(e,t,e.length-1,n),t}function l(e,t,n,a){for(var o=[],u=n,s=0,c=t;s<c.length;s++){for(var l=c[s],f=r.Mat4.identity(),d=0;d<l.length;d++)r.Mat4.mul(f,f,e.get(l[d]));u++,o[o.length]=i.SymmetryOperator.create("A-"+u,f,{id:a,operList:l})}return o}function f(e){for(var t,n=/\(?([^\(\)]+)\)?]*/g,r=[],i=[];t=n.exec(e);)r[r.length]=t[1];return r.forEach(function(e){var t=[];e.split(",").forEach(function(e){var n=e.indexOf("-");if(n>0)for(var r=parseInt(e.substring(0,n)),i=parseInt(e.substr(n+1)),a=r;a<=i;a++)t[t.length]=a.toString();else t[t.length]=e.trim()}),i[i.length]=t}),i}t.createAssemblies=function(e){var t=e.data.pdbx_struct_assembly;if(!t._rowCount)return[];for(var n=function(e){for(var t=e.data.pdbx_struct_oper_list,n=t.id,i=t.matrix,a=t.vector,o=t._schema,u=new Map,s=0,c=t._rowCount;s<c;s++){var l=r.Tensor.toMat4(o.matrix.space,i.value(s)),f=r.Tensor.toVec3(o.vector.space,a.value(s));r.Mat4.setTranslation(l,f),r.Mat4.setValue(l,3,3,1),u.set(n.value(s),l)}return u}(e),i=[],a=0;a<t._rowCount;a++)i[i.length]=s(e,a,n);return i}},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(21),a=n(5),o=n(181),u=n(119),s=n(522),c=n(23),l=n(523),f=n(524);function d(e){return{id:o.default.create22(),atomId:e.id,occupancy:e.occupancy,B_iso_or_equiv:e.B_iso_or_equiv,x:e.Cartn_x.toArray({array:Float32Array}),y:e.Cartn_y.toArray({array:Float32Array}),z:e.Cartn_z.toArray({array:Float32Array})}}t.getAtomicHierarchyAndConformation=function(e,t,n,o,p){var h,m,y=function(e){if(0===e._rowCount)return{residues:[],chains:[]};for(var t=e._rowCount,n=[0],r=[0],i=e.label_entity_id,a=e.label_asym_id,o=e.label_seq_id,u=e.auth_seq_id,s=e.pdbx_PDB_ins_code,c=e.label_comp_id,l=1;l<t;l++){var f=!i.areValuesEqual(l-1,l)||!a.areValuesEqual(l-1,l);(f||!o.areValuesEqual(l-1,l)||!u.areValuesEqual(l-1,l)||!s.areValuesEqual(l-1,l)||!c.areValuesEqual(l-1,l))&&(n[n.length]=l),f&&(r[r.length]=l)}return{residues:n,chains:r}}(t),v=function(e,t){var n=i.Table.ofColumns(u.AtomsSchema,{type_symbol:i.Column.ofArray({array:i.Column.mapToArray(e.type_symbol,c.ElementSymbol),schema:i.Column.Schema.Aliased(i.Column.Schema.str)}),label_atom_id:e.label_atom_id,auth_atom_id:e.auth_atom_id,label_alt_id:e.label_alt_id,pdbx_formal_charge:e.pdbx_formal_charge}),r=i.Table.view(e,u.ResiduesSchema,t.residues);return i.Table.columnToArray(r,"label_seq_id",Int32Array),i.Table.columnToArray(r,"auth_seq_id",Int32Array),{atoms:n,residues:r,chains:i.Table.view(e,u.ChainsSchema,t.chains)}}(t,y);if(p&&(h=p.atomicHierarchy,m=v,i.Table.areEqual(h.chains,m.chains)&&i.Table.areEqual(h.residues,m.residues)&&i.Table.areEqual(h.atoms,m.atoms)))return{sameAsPrevious:!0,hierarchy:p.atomicHierarchy,conformation:d(t)};var b=d(t),g={residueAtomSegments:a.Segmentation.ofOffsets(y.residues,a.Interval.ofBounds(0,t._rowCount)),chainAtomSegments:a.Segmentation.ofOffsets(y.chains,a.Interval.ofBounds(0,t._rowCount))},_=s.getAtomicIndex(v,n,g),S=f.getAtomicDerivedData(v,_,o.chemicalComponentMap),C=l.getAtomicRanges(v,g,b,S.residue.moleculeType);return{sameAsPrevious:!1,hierarchy:r({},v,g,C,{index:_,derived:S}),conformation:b}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(5),i=n(246),a=n(17);function o(e,t){return t?1===t.length?a.cantorPairing(t.charCodeAt(0),e):2===t.length?a.cantorPairing(t.charCodeAt(0),a.cantorPairing(t.charCodeAt(1),e)):e+" "+t:e}function u(e,t,n,r){if(e.has(t)){(i=e.get(t)).has(n)||i.set(n,r)}else{var i=new Map;e.set(t,i),i.set(n,r)}}function s(e){throw new Error("Missing entity entry for entity id '"+e+"'.")}var c=i.AtomicIndex.EmptyResidueKey(),l=function(){function e(e){this.map=e,this.entityIndex=e.entities.getEntityIndex,this.residueOffsets=this.map.segments.residueAtomSegments.offsets}return e.prototype.getEntityFromChain=function(e){return this.map.chain_index_entity_index[e]},e.prototype.findChainLabel=function(e){var t=this.entityIndex(e.label_entity_id);if(t<0||!this.map.entity_index_label_asym_id.has(t))return-1;var n=this.map.entity_index_label_asym_id.get(t);return n&&n.has(e.label_asym_id)?n.get(e.label_asym_id):-1},e.prototype.findChainAuth=function(e){return this.map.auth_asym_id.has(e.auth_asym_id)?this.map.auth_asym_id.get(e.auth_asym_id):-1},e.prototype.findResidue=function(e,t,n,r){var i;1===arguments.length?i=e:(c.label_entity_id=e,c.label_asym_id=t,c.auth_seq_id=n,c.pdbx_PDB_ins_code=r,i=c);var a=this.findChainLabel(i);if(a<0)return-1;var u=this.map.chain_index_auth_seq_id.get(a),s=o(i.auth_seq_id,i.pdbx_PDB_ins_code||"");return u.has(s)?u.get(s):-1},e.prototype.findResidueAuth=function(e){var t=this.findChainAuth(e);if(t<0)return-1;var n=this.map.chain_index_auth_seq_id.get(t),r=o(e.auth_seq_id,e.pdbx_PDB_ins_code||"");return n.has(r)?n.get(r):-1},e.prototype.findResidueInsertion=function(e){var t=this.findChainLabel(e);if(t<0)return-1;var n=this.map.chain_index_label_seq_id.get(t),a=o(e.label_seq_id,e.pdbx_PDB_ins_code||"");if(n.has(a))return n.get(a);var u=r.SortedArray.findPredecessorIndex(this.map.label_seq_id,e.label_seq_id),s=i.AtomicHierarchy.chainStartResidueIndex(this.map.segments,t);if(u<s)return s;var c=i.AtomicHierarchy.chainEndResidueIndexExcl(this.map.segments,t)-1;return u>=c?c:u},e.prototype.findAtom=function(e){var t=this.findResidue(e);return t<0?-1:void 0===e.label_alt_id?f(this.residueOffsets[t],this.residueOffsets[t+1],this.map.label_atom_id,e.label_atom_id):d(this.residueOffsets[t],this.residueOffsets[t+1],this.map.label_atom_id,this.map.label_alt_id,e.label_atom_id,e.label_alt_id)},e.prototype.findAtomAuth=function(e){var t=this.findResidueAuth(e);return t<0?-1:void 0===e.label_alt_id?f(this.residueOffsets[t],this.residueOffsets[t+1],this.map.auth_atom_id,e.auth_atom_id):d(this.residueOffsets[t],this.residueOffsets[t+1],this.map.auth_atom_id,this.map.label_alt_id,e.auth_atom_id,e.label_alt_id)},e.prototype.findAtomOnResidue=function(e,t,n){return void 0===n?f(this.residueOffsets[e],this.residueOffsets[e+1],this.map.label_atom_id,t):d(this.residueOffsets[e],this.residueOffsets[e+1],this.map.label_atom_id,this.map.label_alt_id,t,n)},e}();function f(e,t,n,r){for(var i=e;i<t;i++)if(n.value(i)===r)return i;return-1}function d(e,t,n,r,i,a){for(var o=e;o<t;o++)if(n.value(o)===i&&r.value(o)===a)return o;return-1}t.getAtomicIndex=function(e,t,n){for(var i=function(e,t,n){return{entities:e,segments:n,label_seq_id:r.SortedArray.ofSortedArray(t.residues.label_seq_id.toArray({array:Int32Array})),label_atom_id:t.atoms.label_atom_id,auth_atom_id:t.atoms.auth_atom_id,label_alt_id:t.atoms.label_alt_id,chain_index_entity_index:new Int32Array(t.chains._rowCount),entity_index_label_asym_id:new Map,chain_index_label_seq_id:new Map,auth_asym_id:new Map,chain_index_auth_seq_id:new Map}}(t,e,n),a=e.residues,c=a.label_seq_id,f=a.auth_seq_id,d=a.pdbx_PDB_ins_code,p=e.chains,h=p.label_entity_id,m=p.label_asym_id,y=p.auth_asym_id,v=r.Interval.ofBounds(0,e.atoms._rowCount),b=r.Segmentation.transientSegments(n.chainAtomSegments,v);b.hasNext;){var g=b.move(),_=g.index,S=t.getEntityIndex(h.value(_));S<0&&s(h.value(_)),i.chain_index_entity_index[_]=S;var C=y.value(_);i.auth_asym_id.has(C)||i.auth_asym_id.set(C,_),u(i.entity_index_label_asym_id,S,m.value(_),_);var x=new Map,w=new Map;i.chain_index_label_seq_id.set(_,x),i.chain_index_auth_seq_id.set(_,w);for(var P=r.Segmentation.transientSegments(n.residueAtomSegments,v,g);P.hasNext;){var T=P.move().index,A=d.value(T);x.set(o(c.value(T),A),T),w.set(o(f.value(T),A),T)}}return new l(i)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(5),i=n(91),a=n(23),o=n(94),u=n(2);function s(e,t,n,r){for(var i=r.residueAtomSegments.offsets,a=n.atoms.label_atom_id,o=i[e],u=i[e+1];o<u;o++)if(a.value(o)===t)return o;return i[e]}function c(e,t,n,r,i,c){var l=c[e],f=c[t];if(!a.isPolymer(l)||!a.isPolymer(f))return!1;var d=o.getAtomIdForAtomRole(l,"backboneStart"),p=o.getAtomIdForAtomRole(f,"backboneEnd"),h=s(e,d,n,r),m=s(t,p,n,r),y=i.x,v=i.y,b=i.z,g=u.Vec3.create(y[h],v[h],b[h]),_=u.Vec3.create(y[m],v[m],b[m]);return u.Vec3.distance(g,_)<10}t.getAtomicRanges=function(e,t,n,o){for(var u,s,l,f,d=[],p=[],h=new Map,m=r.Segmentation.transientSegments(t.chainAtomSegments,r.Interval.ofBounds(0,e.atoms._rowCount)),y=r.Segmentation.transientSegments(t.residueAtomSegments,r.Interval.ofBounds(0,e.atoms._rowCount)),v=e.residues.label_seq_id;m.hasNext;){var b=m.move();y.setSegment(b),u=-1,s=-1,l=-1,f=-1;var g=t.residueAtomSegments.index[b.start],_=t.residueAtomSegments.index[b.end-1];for(c(g,_,e,t,n,o)&&(h.set(g,_),h.set(_,g));y.hasNext;){var S=y.move(),C=S.index,x=v.value(C);a.isPolymer(o[C])?-1!==f?x!==u+1?(d.push(f,l-1),p.push(s,S.end-1),f=S.start):y.hasNext?c(t.residueAtomSegments.index[S.start],t.residueAtomSegments.index[l-1],e,t,n,o)||(d.push(f,l-1),f=S.start):d.push(f,S.end-1):f=S.start:-1!==f&&(d.push(f,l-1),f=-1),s=S.start,l=S.end,u=x}}return{polymerRanges:i.default.ofSortedRanges(d),gapRanges:i.default.ofSortedRanges(p),cyclicPolymerMap:h}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(23),i=n(94);t.getAtomicDerivedData=function(e,t,n){for(var a=e.residues,o=a.label_comp_id,u=a._rowCount,s=new Uint32Array(u),c=new Uint32Array(u),l=new Uint8Array(u),f=new Map,d=0;d<u;++d){var p=o.value(d),h=n,m=void 0;f.has(p)?m=f.get(p):h.has(p)?(m=r.getMoleculeType(h.get(p).type,p),f.set(p,m)):(m=r.getMoleculeType(r.getComponentType(p),p),f.set(p,m)),l[d]=m;var y=i.getAtomIdForAtomRole(m,"trace");s[d]=t.findAtomOnResidue(d,y);var v=i.getAtomIdForAtomRole(m,"direction");c[d]=t.findAtomOnResidue(d,v)}return{residue:{traceElementIndex:s,directionElementIndex:c,moleculeType:l}}}},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(120),a=n(526),o=n(528),u=n(7),s=n(5),c=n(2),l=n(529);function f(e){var t=e.entity_id,n=e.seq_id_begin,i=e.seq_id_end,a=e.asym_id;return r({count:t.rowCount,entity_id:t,asym_id:a,seq_id_begin:n,seq_id_end:i},function(e,t,n){for(var r=[0],i=1,a=e.rowCount;i<a;i++)!e.areValuesEqual(i-1,i)&&(r[r.length]=i);return{chainElementSegments:s.Segmentation.ofOffsets(r,s.Interval.ofBounds(0,e.rowCount))}}(a))}t.EmptyIHMCoarse={hierarchy:a.CoarseHierarchy.Empty,conformation:void 0},t.getIHMCoarse=function(e,n){var a=e.ihm_sphere_obj_site,s=e.ihm_gaussian_obj_site;if(0===a._rowCount&&0===s._rowCount)return t.EmptyIHMCoarse;var d=f(a),p=function(e){return{x:e.Cartn_x.toArray({array:Float32Array}),y:e.Cartn_y.toArray({array:Float32Array}),z:e.Cartn_z.toArray({array:Float32Array}),radius:e.object_radius.toArray({array:Float32Array}),rmsf:e.rmsf.toArray({array:Float32Array})}}(a),h=o.getCoarseKeys(d,e.entities),m=l.getCoarseRanges(d,n.chemicalComponentMap),y=f(s),v=function(e){for(var t=i.mmCIF_Schema.ihm_gaussian_obj_site.covariance_matrix.space,n=[],r=e.covariance_matrix,a=0,o=r.rowCount;a<o;a++)n[a]=c.Tensor.toMat3(t,r.value(a));return{x:e.mean_Cartn_x.toArray({array:Float32Array}),y:e.mean_Cartn_y.toArray({array:Float32Array}),z:e.mean_Cartn_z.toArray({array:Float32Array}),weight:e.weight.toArray({array:Float32Array}),covariance_matrix:n}}(s),b=o.getCoarseKeys(y,e.entities),g=l.getCoarseRanges(y,n.chemicalComponentMap);return{hierarchy:{isDefined:!0,spheres:r({},d,h,m),gaussians:r({},y,b,g)},conformation:{id:u.UUID.create22(),spheres:p,gaussians:v}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(527))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.Empty={isDefined:!1}}(t.CoarseHierarchy||(t.CoarseHierarchy={}))},function(e,t,n){"use strict";function r(e,t,n){if(e.has(t))return e.get(t);var r=n.index++;return e.set(t,r),r}function i(e,t){if(e.has(t))return e.get(t);var n=new Map;return e.set(t,n),n}function a(e){throw new Error("Missing entity entry for entity id '"+e+"'.")}Object.defineProperty(t,"__esModule",{value:!0}),t.getCoarseKeys=function(e,t){for(var n=e.entity_id,o=e.asym_id,u=e.seq_id_begin,s=e.seq_id_end,c=e.count,l=e.chainElementSegments,f=new Map,d=new Map,p={index:0},h=new Int32Array(c),m=new Int32Array(c),y=0;y<c;y++)m[y]=t.getEntityIndex(n.value(y)),m[y]<0&&a(n.value(y));for(var v=0;v<l.count;v++){var b=l.offsets[v],g=l.offsets[v+1],_=r(i(d,m[b]),o.value(b),p);for(y=b;y<g;y++)h[y]=_;var S=new Map;for(f.set(_,S),y=b;y<g;y++)for(var C=u.value(y),x=s.value(y),w=C;w<=x;w++)S.set(w,y)}var P=function(e,t,n){var r=e.getEntityIndex;return{findChainKey:function(e,n){var i=r(e);if(i<0)return-1;var a=t.get(i);return a.has(n)?a.get(n):-1},findSequenceKey:function(e,i,a){var o=r(e);if(o<0)return-1;var u=t.get(o);if(void 0===u)return-1;var s=u.get(i);if(void 0===s)return-1;var c=n.get(s);return c.has(a)?c.get(a):-1}}}(t,d,f),T=P.findChainKey;return{chainKey:h,entityKey:m,findSequenceKey:P.findSequenceKey,findChainKey:T}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(5),i=n(91);t.getCoarseRanges=function(e,t){for(var n=[],a=[],o=r.Segmentation.transientSegments(e.chainElementSegments,r.Interval.ofBounds(0,e.count)),u=e.seq_id_begin,s=e.seq_id_end;o.hasNext;)for(var c=o.move(),l=c.start,f=c.end,d=-1,p=-1,h=l;h<f;++h){var m=s.value(h);h===l?(d=h,p=s.value(h)):p!==u.value(h)-1&&(n.push(d,h-1),a.push(h-1,h),d=h),h===f-1&&n.push(d,h),p=m}return{polymerRanges:i.default.ofSortedRanges(n),gapRanges:i.default.ofSortedRanges(a)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(23),i=n(119),a=n(531);function o(e,t){var n=new Map,a=[{kind:"none"}];!function(e,t,n){if(!e._rowCount)return;for(var i=e.beg_label_asym_id,a=e.beg_label_seq_id,o=e.pdbx_beg_PDB_ins_code,u=e.end_label_seq_id,s=e.pdbx_end_PDB_ins_code,c=e.pdbx_PDB_helix_class,l=e.conf_type_id,f=e.details,d=0,p=e._rowCount;d<p;d++){var h=r.SecondaryStructureType.create(0===c.valueKind(d)?r.SecondaryStructureType.SecondaryStructurePdb[c.value(d)]:0===l.valueKind(d)?r.SecondaryStructureType.SecondaryStructureMmcif[l.value(d)]:268435456),m={kind:"helix",flags:h,type_id:0===l.valueKind(d)?l.value(d):"HELIX_P",helix_class:c.value(d),details:0===f.valueKind(d)?f.value(d):void 0},y={startSeqNumber:a.value(d),startInsCode:o.value(d),endSeqNumber:u.value(d),endInsCode:s.value(d),type:h,key:n.length};n[n.length]=m;var v=i.value(d);t.has(v)?t.get(v).set(y.startSeqNumber,y):t.set(v,new Map([[y.startSeqNumber,y]]))}}(e.struct_conf,n,a),function(e,t,n,i){if(!e._rowCount)return;for(var a=e.beg_label_asym_id,o=e.beg_label_seq_id,u=e.pdbx_beg_PDB_ins_code,s=e.end_label_seq_id,c=e.pdbx_end_PDB_ins_code,l=e.sheet_id,f=new Map,d=n+1,p=0,h=e._rowCount;p<h;p++){var m=l.value(p),y=void 0;f.has(m)?y=f.get(m):(y=d++,f.set(m,y));var v=r.SecondaryStructureType.create(4194308),b={kind:"sheet",flags:v,sheet_id:m,symmetry:void 0},g={startSeqNumber:o.value(p),startInsCode:u.value(p),endSeqNumber:s.value(p),endInsCode:c.value(p),type:v,key:i.length};i[i.length]=b;var _=a.value(p);t.has(_)?t.get(_).set(g.startSeqNumber,g):t.set(_,new Map([[g.startSeqNumber,g]]))}}(e.struct_sheet_range,n,e.struct_conf._rowCount,a);var o={type:new Int32Array(t.residues._rowCount),key:new Int32Array(t.residues._rowCount),elements:a};return n.size>0&&function(e,t,n){for(var r=e.chainAtomSegments.count,a=e.chains.label_asym_id,o=e.residues,s=o.label_seq_id,c=o.pdbx_PDB_ins_code,l=0;l<r;l++){var f=i.AtomicHierarchy.chainStartResidueIndex(e,l),d=i.AtomicHierarchy.chainEndResidueIndexExcl(e,l),p=a.value(l);if(t.has(p))for(var h=t.get(p),m=f;m<d;m++){var y=s.value(m);if(h.has(y)){var v=h.get(y),b=c.value(m);if(v.startInsCode!==b)continue;u(e,v,m,d,n)}}}}(t,n,o),o}function u(e,t,n,r,i){for(var a=e.residues,o=a.label_seq_id,u=a.pdbx_PDB_ins_code,s=t.endSeqNumber,c=t.endInsCode,l=t.key,f=t.type,d=n;d<r;){var p=o.value(d);if(i.type[d]=f,i.key[d]=l,p>s||p===s&&u.value(d)===c)break;d++}}t.getSecondaryStructure=function(e,t,n){return e.struct_conf._rowCount||e.struct_sheet_range._rowCount?o(e,t):a.computeSecondaryStructure(t,n)},t.getSecondaryStructureMmCif=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(23),a=n(2),o=n(19),u=n(5),s=n(118),c=n(7);function l(e,t){var n=function(e,t){for(var n=t.x,r=t.y,i=t.z,a=e.derived.residue,s=a.moleculeType,c=a.traceElementIndex,l=[],f=[],d=0,p=s.length;d<p;++d)4===s[d]&&(l[l.length]=c[d],f[f.length]=d);var h=o.GridLookup3D({x:n,y:r,z:i,indices:u.SortedArray.ofSortedArray(l)}),m=u.SortedArray.ofSortedArray(f);return{lookup3d:h,proteinResidues:m}}(e,t),i=n.lookup3d,c=n.proteinResidues,l=function(e,t,n,r,i){for(var o=r.cIndices,u=r.hIndices,c=r.nIndices,l=r.oIndices,d=e.index,p=t.x,h=t.y,v=t.z,b=e.derived.residue.traceElementIndex,g=n.length,_=function(e,t){return a.Vec3.set(t,p[e],h[e],v[e])},S=[],C=[],x=[],w=a.Vec3.zero(),P=a.Vec3.zero(),T=a.Vec3.zero(),A=a.Vec3.zero(),E=a.Vec3.zero(),k=a.Vec3.zero(),I=a.Vec3.zero(),M=0,V=n.length;M<V;++M){var O=M,D=n[M],R=l[O],j=o[O],N=b[D];if(-1!==R&&-1!==j&&-1===d.findAtomOnResidue(D,"OXT")){_(R,w),_(j,P),_(N,T);for(var B=i.find(T[0],T[1],T[2],f),F=B.indices,L=B.count,z=0;z<L;++z){var U=F[z];if(U!==O&&U-1!==O&&U+1!==O){var G=c[U];if(-1!==G){_(G,A);var q=u[U];if(-1===q){if(0===U)continue;var H=U-1,W=l[H],Y=o[H];if(-1===W||-1===Y)continue;_(W,I),_(Y,k),a.Vec3.sub(E,k,I);var K=a.Vec3.distance(I,k);a.Vec3.scaleAndAdd(E,A,E,1/K)}else _(q,E);var X=y(w,P,A,E);X>m||(S[S.length]=O,C[C.length]=U,x[x.length]=X)}}}}}return function(e,t,n,r){for(var i=new s.IntAdjacencyGraph.DirectedEdgeBuilder(e,t,n),a=new Float32Array(i.slotCount),o=0,u=i.edgeCount;o<u;o++)i.addNextEdge(),i.assignProperty(a,r[o]);return i.createGraph({energies:r})}(g,S,C,x)}(e,t,c,function(e,t){for(var n=t.length,r=e.index,i=new Int32Array(n),a=new Int32Array(n),o=new Int32Array(n),u=new Int32Array(n),s=0,c=n;s<c;++s){var l=t[s];i[s]=r.findAtomOnResidue(l,"C"),a[s]=r.findAtomOnResidue(l,"H"),o[s]=r.findAtomOnResidue(l,"O"),u[s]=r.findAtomOnResidue(l,"N")}return{cIndices:i,hIndices:a,oIndices:o,nIndices:u}}(e,c),i),h=c.length,v=new Uint32Array(h),b={hierarchy:e,proteinResidues:c,flags:v,hbonds:l};!function(e){for(var t=e.proteinResidues,n=e.hbonds,r=e.flags,i=e.hierarchy,a=i.chains,o=i.residueAtomSegments,u=i.chainAtomSegments,s=a.label_asym_id,c=[0,0,0,128,256,512],l=0,f=t.length;l<f;++l)for(var d=t[l],p=u.index[o.offsets[d]],h=3;h<=5;++h)if(!(l+h>=t.length)){var m=t[l+h],y=u.index[o.offsets[m]];s.areValuesEqual(p,y)&&-1!==n.getDirectedEdgeIndex(l,l+h)&&(r[l]|=64|c[h])}}(b),function(e){for(var t=e.proteinResidues,n=e.flags,i=[0,0,0,128,256,512],a=[0,0,0,8,1,16],o=1,u=t.length;o<u;++o)for(var s=r.create(n[o]),c=r.create(n[o-1]),l=3;l<=5;++l)if(r.is(s,i[l])&&r.is(c,i[l]))for(var f=0;f<l;++f)n[o+f]|=a[l]}(b),function(e){for(var t,n,r=e.proteinResidues,i=e.hbonds,a=e.flags,o=i.offset,u=i.b,s=0,c=r.length;s<c;++s)for(var l=o[s],f=o[s+1];l<f;l++){var d=u[l];s>d||((t=s+1)!==(n=d)&&-1!==i.getDirectedEdgeIndex(n,t+1)&&(a[t]|=2,a[n]|=2),(t=s)!==(n=d-1)&&-1!==i.getDirectedEdgeIndex(n-1,t)&&(a[t]|=2,a[n]|=2),(t=s)!==(n=d)&&-1!==i.getDirectedEdgeIndex(n,t)&&(a[t]|=2,a[n]|=2),(t=s+1)!==(n=d-1)&&-1!==i.getDirectedEdgeIndex(n-1,t+1)&&(a[t]|=2,a[n]|=2))}}(b);for(var g=function(e,t){void 0===t&&(t=!1);for(var n=t?d:p,i=new Uint32Array(e.length),a=0,o=e.length;a<o;++a){var u=r.create(e[a]);i[a]=n(u)}return i}(v),_=new Uint32Array(e.residues._rowCount),S=0,C=c.length;S<C;++S)_[c[S]]=g[S];return{type:_,key:[],elements:[]}}t.computeSecondaryStructure=function(e,t){return l(e,t)},t.computeModelDSSP=l,function(e){e.is=c.BitFlags.has,e.create=c.BitFlags.create}(r||(r={}));var f=7;function d(e){return r.is(e,1)?i.SecondaryStructureType.SecondaryStructureDssp.H:r.is(e,2)?i.SecondaryStructureType.SecondaryStructureDssp.B:r.is(e,4)?i.SecondaryStructureType.SecondaryStructureDssp.E:r.is(e,8)?i.SecondaryStructureType.SecondaryStructureDssp.G:r.is(e,16)?i.SecondaryStructureType.SecondaryStructureDssp.I:r.is(e,64)?i.SecondaryStructureType.SecondaryStructureDssp.T:r.is(e,32)?i.SecondaryStructureType.SecondaryStructureDssp.S:0}function p(e){return r.is(e,16)?i.SecondaryStructureType.SecondaryStructureDssp.I:r.is(e,1)?i.SecondaryStructureType.SecondaryStructureDssp.H:r.is(e,2)?i.SecondaryStructureType.SecondaryStructureDssp.B:r.is(e,4)?i.SecondaryStructureType.SecondaryStructureDssp.E:r.is(e,8)?i.SecondaryStructureType.SecondaryStructureDssp.G:r.is(e,64)?i.SecondaryStructureType.SecondaryStructureDssp.T:r.is(e,32)?i.SecondaryStructureType.SecondaryStructureDssp.S:0}var h=-27.888,m=-.5;function y(e,t,n,r){var i=a.Vec3.distance(e,r),o=a.Vec3.distance(t,r),u=a.Vec3.distance(t,n),s=a.Vec3.distance(e,n);return h/i-h/o+(h/u-h/s)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(236),i=n(21),a=n(237);t.getSequence=function(e,t,n,o){if(!e.entity_poly_seq._rowCount)return r.default.fromAtomicHierarchy(t,n,o);for(var u=e.entity_poly_seq,s=u.entity_id,c=u.num,l=u.mon_id,f={},d=[],p=s.rowCount,h=0;h<p;){for(var m=h;h<p-1&&s.areValuesEqual(h,h+1);)h++;h++;var y=s.value(m),v=i.Column.window(l,m,h),b=i.Column.window(c,m,h),g=t.getEntityIndex(y);f[g]={entityId:y,compId:v,num:b,sequence:a.Sequence.ofResidueNames(v,b,o)},d.push(f[g])}return{byEntityKey:f,sequences:d}}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{s(r.next(e))}catch(e){a(e)}}function u(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,u)}s((r=r.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}};Object.defineProperty(t,"__esModule",{value:!0});var a=n(17),o=n(21);t.sortAtomSite=function(e,t,n,u){return r(this,void 0,void 0,function(){var r,s,c,l,f,d,p,h,m,y,v;return i(this,function(i){switch(i.label){case 0:return r=a.createRangeArray(n,u-1),s=t.label_entity_id,c=t.label_asym_id,l=t.label_seq_id,f=a.makeBuckets(r,s.value),e.shouldUpdate?[4,e.update()]:[3,2];case 1:i.sent(),i.label=2;case 2:d=0,p=f.length-1,i.label=3;case 3:if(!(d<p))return[3,10];h=a.makeBuckets(r,c.value,{start:f[d],end:f[d+1]}),m=0,y=h.length-1,i.label=4;case 4:return m<y?(v=h[m],0!==l.valueKind(v)?[3,6]:(a.makeBuckets(r,l.value,{sort:!0,start:v,end:h[m+1]}),e.shouldUpdate?[4,e.update()]:[3,6])):[3,7];case 5:i.sent(),i.label=6;case 6:return m++,[3,4];case 7:return e.shouldUpdate?[4,e.update()]:[3,9];case 8:i.sent(),i.label=9;case 9:return d++,[3,3];case 10:return function(e){for(var t=0,n=e.length;t<n;t++)if(e[t]!==t)return!1;return!0}(r)&&r.length===t._rowCount?[2,t]:[2,o.Table.view(t,t._schema,r)]}})})}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{s(r.next(e))}catch(e){a(e)}}function u(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,u)}s((r=r.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}};Object.defineProperty(t,"__esModule",{value:!0});var a=n(535),o=n(11),u=n(290),s=n(291);t.trajectoryFromPDB=function(e){var t=this;return o.Task.create("Parse PDB",function(n){return r(t,void 0,void 0,function(){var t,r;return i(this,function(i){switch(i.label){case 0:return[4,n.update("Converting to mmCIF")];case 1:return i.sent(),[4,a.pdbToMmCif(e)];case 2:return t=i.sent(),r=u.ModelFormat.mmCIF(t),[2,s._parse_mmCif(r,n)]}})})})}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{s(r.next(e))}catch(e){a(e)}}function u(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,u)}s((r=r.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}};Object.defineProperty(t,"__esModule",{value:!0});var a=n(151),o=n(75),u=n(215),s=n(536),c=n(23),l=n(537);function f(e,t,n,r,i,a){var o=n.data,s=i-r;u.TokenBuilder.addToken(e.group_PDB,u.Tokenizer.trim(n,r,r+6)),u.Tokenizer.trim(n,r+6,r+11),e.id[e.index]=n.data.substring(n.tokenStart,n.tokenEnd),u.TokenBuilder.addToken(e.auth_atom_id,u.Tokenizer.trim(n,r+12,r+16)),32===o.charCodeAt(r+16)?u.TokenBuilder.add(e.label_alt_id,0,0):u.TokenBuilder.add(e.label_alt_id,r+16,r+17),u.TokenBuilder.addToken(e.auth_comp_id,u.Tokenizer.trim(n,r+17,r+20));var l=o.substring(n.tokenStart,n.tokenEnd);u.TokenBuilder.add(e.auth_asym_id,r+21,r+22),u.TokenBuilder.addToken(e.auth_seq_id,u.Tokenizer.trim(n,r+22,r+26)),32===o.charCodeAt(r+26)?u.TokenBuilder.add(e.label_alt_id,0,0):u.TokenBuilder.add(e.label_alt_id,r+26,r+27),u.TokenBuilder.addToken(e.Cartn_x,u.Tokenizer.trim(n,r+30,r+38)),u.TokenBuilder.addToken(e.Cartn_y,u.Tokenizer.trim(n,r+38,r+46)),u.TokenBuilder.addToken(e.Cartn_z,u.Tokenizer.trim(n,r+46,r+54)),u.TokenBuilder.addToken(e.occupancy,u.Tokenizer.trim(n,r+54,r+60)),s>=66?u.TokenBuilder.addToken(e.B_iso_or_equiv,u.Tokenizer.trim(n,r+60,r+66)):u.TokenBuilder.add(e.label_alt_id,0,0),s>=78?(u.Tokenizer.trim(n,r+76,r+78),n.tokenStart<n.tokenEnd?u.TokenBuilder.addToken(e.type_symbol,n):u.TokenBuilder.add(e.type_symbol,r+12,r+13)):u.TokenBuilder.add(e.type_symbol,r+12,r+13),e.label_entity_id[e.index]=function(e,t){return t?c.WaterNames.has(e)?"3":"2":"1"}(l,a),e.pdbx_PDB_model_num[e.index]=t,e.index++}t.pdbToMmCif=function(e){return r(this,void 0,void 0,function(){var t,n,r,c,d,p,h,m,y,v,b,g,_,S,C,x,w,P;return i(this,function(i){for(t=e.lines,n=t.data,r=t.indices,c=u.Tokenizer(n),d=0,v=0,b=t.count;v<b;v++)switch(g=r[2*v],_=r[2*v+1],n[g]){case"A":a.substringStartsWith(n,g,_,"ATOM  ")&&d++;break;case"H":a.substringStartsWith(n,g,_,"HETATM")&&d++}for(p=function(e,t){var n=function(){return u.TokenBuilder.create(e,2*t)};return{index:0,count:t,group_PDB:n(),id:[],auth_atom_id:n(),label_alt_id:n(),auth_comp_id:n(),auth_asym_id:n(),auth_seq_id:n(),pdbx_PDB_ins_code:n(),Cartn_x:n(),Cartn_y:n(),Cartn_z:n(),occupancy:n(),B_iso_or_equiv:n(),type_symbol:n(),pdbx_PDB_model_num:[],label_entity_id:[]}}(n,d),h=[],m=0,y="",v=0,b=t.count;v<b;v++)switch(g=r[2*v],_=r[2*v+1],n[g]){case"A":if(!a.substringStartsWith(n,g,_,"ATOM  "))continue;m||(y=""+ ++m),f(p,y,c,g,_,!1);break;case"C":a.substringStartsWith(n,g,_,"CRYST1")&&h.push.apply(h,s.parseCryst1(e.id||"?",n.substring(g,_)));break;case"H":if(a.substringStartsWith(n,g,_,"HETATM"))m||(y=""+ ++m),f(p,y,c,g,_,!0);else if(a.substringStartsWith(n,g,_,"HELIX")){for(S=v+1;g=r[2*S],_=r[2*S+1],a.substringStartsWith(n,g,_,"HELIX");)S++;h.push(l.parseHelix(t,v,S)),v=S-1}break;case"M":if(a.substringStartsWith(n,g,_,"MODEL ")&&(y=""+ ++m),a.substringStartsWith(n,g,_,"MTRIX")){for(S=v+1;g=r[2*S],_=r[2*S+1],a.substringStartsWith(n,g,_,"MTRIX");)S++;h.push.apply(h,s.parseMtrix(t,v,S)),v=S-1}break;case"O":break;case"R":if(a.substringStartsWith(n,g,_,"REMARK 350")){for(S=v+1;g=r[2*S],_=r[2*S+1],a.substringStartsWith(n,g,_,"REMARK 350");)S++;h.push.apply(h,s.parseRemark350(t,v,S)),v=S-1}break;case"S":if(a.substringStartsWith(n,g,_,"SHEET")){for(S=v+1;g=r[2*S],_=r[2*S+1],a.substringStartsWith(n,g,_,"SHEET");)S++;h.push(l.parseSheet(t,v,S)),v=S-1}}var T,A,E,k,I;for(C={entity:o.CifCategory.ofFields("entity",{id:o.CifField.ofStrings(["1","2","3"]),type:o.CifField.ofStrings(["polymer","non-polymer","water"])}),atom_site:o.CifCategory.ofFields("atom_site",(T=p,A=o.CifField.ofTokens(T.auth_asym_id),E=o.CifField.ofTokens(T.auth_atom_id),k=o.CifField.ofTokens(T.auth_comp_id),I=o.CifField.ofTokens(T.auth_seq_id),{auth_asym_id:A,auth_atom_id:E,auth_comp_id:k,auth_seq_id:I,B_iso_or_equiv:o.CifField.ofTokens(T.B_iso_or_equiv),Cartn_x:o.CifField.ofTokens(T.Cartn_x),Cartn_y:o.CifField.ofTokens(T.Cartn_y),Cartn_z:o.CifField.ofTokens(T.Cartn_z),group_PDB:o.CifField.ofTokens(T.group_PDB),id:o.CifField.ofStrings(T.id),label_alt_id:o.CifField.ofTokens(T.label_alt_id),label_asym_id:A,label_atom_id:E,label_comp_id:k,label_seq_id:I,label_entity_id:o.CifField.ofStrings(T.label_entity_id),occupancy:o.CifField.ofTokens(T.occupancy),type_symbol:o.CifField.ofTokens(T.type_symbol),pdbx_PDB_ins_code:o.CifField.ofTokens(T.pdbx_PDB_ins_code),pdbx_PDB_model_num:o.CifField.ofStrings(T.pdbx_PDB_model_num)}))},x=0,w=h;x<w.length;x++)P=w[x],C[P.name]=P;return[2,{header:e.id||"PDB",categoryNames:Object.keys(C),categories:C}]})})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(75),i=n(2);function a(e,t){return{id:e,details:t,groups:[]}}t.parseCryst1=function(e,t){var n=function(e,n){return(t.substr(e,n)||"").trim()},i={entry_id:r.CifField.ofString(e),length_a:r.CifField.ofString(n(6,9)),length_b:r.CifField.ofString(n(15,9)),length_c:r.CifField.ofString(n(24,9)),angle_alpha:r.CifField.ofString(n(33,7)),angle_beta:r.CifField.ofString(n(40,7)),angle_gamma:r.CifField.ofString(n(47,7)),Z_PDB:r.CifField.ofString(n(66,4)),pdbx_unique_axis:r.CifField.ofString("?")},a={entry_id:r.CifField.ofString(e),"space_group_name_H-M":r.CifField.ofString(n(55,11)),Int_Tables_number:r.CifField.ofString("?"),cell_setting:r.CifField.ofString("?"),space_group_name_Hall:r.CifField.ofString("?")};return[r.CifCategory.ofFields("cell",i),r.CifCategory.ofFields("symmetry",a)]},t.parseRemark350=function(e,t,n){for(var o,u,s,c=[],l=1,f=function(t){return e.data.substring(e.indices[2*t],e.indices[2*t+1])},d=t;d<n;d++){var p=f(d);if("BIOMOLECULE:"===p.substr(11,12)){var h=p.substr(23).trim(),m="Biomolecule "+h;"APPLY THE FOLLOWING TO CHAINS:"!==(p=f(d+1)).substr(11,30)&&(d++,m=p.substr(11).trim()),o=a(h,m),c.push(o)}else if("BIOMT"===p.substr(13,5)){var y=p.split(/\s+/);0==(B=parseInt(p[18])-1)&&(s=i.Mat4.identity(),u.operators.push({id:l++,matrix:s})),i.Mat4.setValue(s,B,0,parseFloat(y[4])),i.Mat4.setValue(s,B,1,parseFloat(y[5])),i.Mat4.setValue(s,B,2,parseFloat(y[6])),i.Mat4.setValue(s,B,3,parseFloat(y[7]))}else if("APPLY THE FOLLOWING TO CHAINS:"===p.substr(11,30)||"                   AND CHAINS:"===p.substr(11,30)){"APPLY"===p.substr(11,5)&&(u={chains:[],operators:[]},o.groups.push(u));for(var v=p.substr(41,30).split(","),b=0,g=v.length;b<g;++b){var _=v[b].trim();_&&u.chains.push(_)}}}if(0===c.length)return[];for(var S={id:r.CifField.ofStrings(c.map(function(e){return e.id})),details:r.CifField.ofStrings(c.map(function(e){return e.details}))},C=[],x=0,w=c;x<w.length;x++)for(var P=0,T=(V=w[x]).groups;P<T.length;P++){var A=T[P];C.push({assembly_id:V.id,oper_expression:A.operators.map(function(e){return e.id}).join(","),asym_id_list:A.chains.join(",")})}for(var E={assembly_id:r.CifField.ofStrings(C.map(function(e){return e.assembly_id})),oper_expression:r.CifField.ofStrings(C.map(function(e){return e.oper_expression})),asym_id_list:r.CifField.ofStrings(C.map(function(e){return e.asym_id_list}))},k=[],I=0,M=c;I<M.length;I++)for(var V,O=0,D=(V=M[I]).groups;O<D.length;O++)for(var R=0,j=D[O].operators;R<j.length;R++){var N=j[R],B={id:""+N.id,type:"?",name:"?",symmetry_operation:"?"};for(d=0;d<3;d++){for(b=0;b<3;b++)B["matrix["+(d+1)+"]["+(b+1)+"]"]=""+i.Mat4.getValue(N.matrix,d,b);B["vector["+(d+1)+"]"]=""+i.Mat4.getValue(N.matrix,d,3)}k.push(B)}var F={id:r.CifField.ofStrings(k.map(function(e){return e.id})),type:r.CifField.ofStrings(k.map(function(e){return e.type})),name:r.CifField.ofStrings(k.map(function(e){return e.name})),symmetry_operation:r.CifField.ofStrings(k.map(function(e){return e.symmetry_operation}))},L=function(e){for(var t=function(t){var n="matrix["+(e+1)+"]["+(t+1)+"]";F[n]=r.CifField.ofStrings(k.map(function(e){return e[n]}))},n=0;n<3;n++)t(n);var i="vector["+(e+1)+"]";F[i]=r.CifField.ofStrings(k.map(function(e){return e[i]}))};for(d=0;d<3;d++)L(d);return[r.CifCategory.ofFields("pdbx_struct_assembly",S),r.CifCategory.ofFields("pdbx_struct_assembly_gen",E),r.CifCategory.ofFields("pdbx_struct_oper_list",F)]},t.parseMtrix=function(e,t,n){for(var a,o,u=[],s=t;s<n;s++){var c=(o=s,e.data.substring(e.indices[2*o],e.indices[2*o+1])),l=c.split(/\s+/);0==(y=parseInt(c[5])-1)&&(a=i.Mat4.identity(),u.push(a)),i.Mat4.setValue(a,y,0,parseFloat(l[2])),i.Mat4.setValue(a,y,1,parseFloat(l[3])),i.Mat4.setValue(a,y,2,parseFloat(l[4])),i.Mat4.setValue(a,y,3,parseFloat(l[5]))}if(0===u.length)return[];for(var f=[],d=1,p=0,h=u;p<h.length;p++){var m=h[p],y={id:"ncsop"+d++,code:".",details:"."};for(s=0;s<3;s++){for(var v=0;v<3;v++)y["matrix["+(s+1)+"]["+(v+1)+"]"]=""+i.Mat4.getValue(m,s,v);y["vector["+(s+1)+"]"]=""+i.Mat4.getValue(m,s,3)}f.push(y)}var b={id:r.CifField.ofStrings(f.map(function(e){return e.id})),code:r.CifField.ofStrings(f.map(function(e){return e.code})),details:r.CifField.ofStrings(f.map(function(e){return e.details}))},g=function(e){for(var t=function(t){var n="matrix["+(e+1)+"]["+(t+1)+"]";b[n]=r.CifField.ofStrings(f.map(function(e){return e[n]}))},n=0;n<3;n++)t(n);var i="vector["+(e+1)+"]";b[i]=r.CifField.ofStrings(f.map(function(e){return e[i]}))};for(s=0;s<3;s++)g(s);return[r.CifCategory.ofFields("struct_ncs_oper",b)]}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(75),i={1:"HELX_RH_AL_P",2:"HELX_RH_OM_P",3:"HELX_RH_PI_P",4:"HELX_RH_GA_P",5:"HELX_RH_3T_P",6:"HELX_LH_AL_P",7:"HELX_LH_OM_P",8:"HELX_LH_GA_P",9:"HELX_RH_27_P",10:"HELX_RH_PP_P"};t.parseHelix=function(e,t,n){for(var a,o=[],u=t;u<n;u++){var s=(a=u,e.data.substring(e.indices[2*a],e.indices[2*a+1]));o.push({serNum:s.substr(7,3).trim(),helixID:s.substr(11,3).trim(),initResName:s.substr(15,3).trim(),initChainID:s.substr(19,1).trim(),initSeqNum:s.substr(21,4).trim(),initICode:s.substr(25,1).trim(),endResName:s.substr(27,3).trim(),endChainID:s.substr(31,3).trim(),endSeqNum:s.substr(33,4).trim(),endICode:s.substr(37,1).trim(),helixClass:s.substr(38,2).trim(),comment:s.substr(40,30).trim(),length:s.substr(71,5).trim()})}var c=r.CifField.ofStrings(o.map(function(e){return e.initChainID})),l=r.CifField.ofStrings(o.map(function(e){return e.initResName})),f=r.CifField.ofStrings(o.map(function(e){return e.initSeqNum})),d=r.CifField.ofStrings(o.map(function(e){return e.endChainID})),p=r.CifField.ofStrings(o.map(function(e){return e.endResName})),h=r.CifField.ofStrings(o.map(function(e){return e.endSeqNum})),m={beg_label_asym_id:c,beg_label_comp_id:l,beg_label_seq_id:f,beg_auth_asym_id:c,beg_auth_comp_id:l,beg_auth_seq_id:f,conf_type_id:r.CifField.ofStrings(o.map(function(e){return t=e.helixClass,i[t]||"HELX_P";var t})),details:r.CifField.ofStrings(o.map(function(e){return e.comment})),end_label_asym_id:d,end_label_comp_id:d,end_label_seq_id:h,end_auth_asym_id:d,end_auth_comp_id:p,end_auth_seq_id:h,id:r.CifField.ofStrings(o.map(function(e){return e.serNum})),pdbx_beg_PDB_ins_code:r.CifField.ofStrings(o.map(function(e){return e.initICode})),pdbx_end_PDB_ins_code:r.CifField.ofStrings(o.map(function(e){return e.endICode})),pdbx_PDB_helix_class:r.CifField.ofStrings(o.map(function(e){return e.helixClass})),pdbx_PDB_helix_length:r.CifField.ofStrings(o.map(function(e){return e.length})),pdbx_PDB_helix_id:r.CifField.ofStrings(o.map(function(e){return e.helixID}))};return r.CifCategory.ofFields("struct_conf",m)},t.parseSheet=function(e,t,n){for(var i,a=[],o=t;o<n;o++){var u=(i=o,e.data.substring(e.indices[2*i],e.indices[2*i+1]));a.push({strand:u.substr(7,3).trim(),sheetID:u.substr(11,3).trim(),numStrands:u.substr(14,2).trim(),initResName:u.substr(17,3).trim(),initChainID:u.substr(21,1).trim(),initSeqNum:u.substr(22,4).trim(),initICode:u.substr(26,1).trim(),endResName:u.substr(28,3).trim(),endChainID:u.substr(32,1).trim(),endSeqNum:u.substr(33,4).trim(),endICode:u.substr(37,1).trim(),sense:u.substr(38,2).trim(),curAtom:u.substr(41,4).trim(),curResName:u.substr(45,3).trim(),curChainId:u.substr(49,1).trim(),curResSeq:u.substr(50,4).trim(),curICode:u.substr(54,1).trim(),prevAtom:u.substr(56,4).trim(),prevResName:u.substr(60,3).trim(),prevChainId:u.substr(64,1).trim(),prevResSeq:u.substr(65,4).trim(),prevICode:u.substr(69,1).trim()})}var s=r.CifField.ofStrings(a.map(function(e){return e.initChainID})),c=r.CifField.ofStrings(a.map(function(e){return e.initResName})),l=r.CifField.ofStrings(a.map(function(e){return e.initSeqNum})),f=r.CifField.ofStrings(a.map(function(e){return e.endChainID})),d=r.CifField.ofStrings(a.map(function(e){return e.endResName})),p=r.CifField.ofStrings(a.map(function(e){return e.endSeqNum})),h={beg_label_asym_id:s,beg_label_comp_id:c,beg_label_seq_id:l,beg_auth_asym_id:s,beg_auth_comp_id:c,beg_auth_seq_id:l,end_label_asym_id:f,end_label_comp_id:f,end_label_seq_id:p,end_auth_asym_id:f,end_auth_comp_id:d,end_auth_seq_id:p,id:r.CifField.ofStrings(a.map(function(e){return e.strand})),sheet_id:r.CifField.ofStrings(a.map(function(e){return e.sheetID})),pdbx_beg_PDB_ins_code:r.CifField.ofStrings(a.map(function(e){return e.initICode})),pdbx_end_PDB_ins_code:r.CifField.ofStrings(a.map(function(e){return e.endICode}))};return r.CifCategory.ofFields("struct_sheet_range",h)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(277);!function(e){e.core=r.MolScriptSymbolTable.core,e.struct=r.MolScriptSymbolTable.structureQuery,e.atomName=function(t){return e.struct.type.atomName([t])},e.es=function(t){return e.struct.type.elementSymbol([t])},e.list=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return e.core.type.list(t)},e.set=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return e.core.type.set(t)},e.fn=function(t){return e.core.ctrl.fn([t])},e.evaluate=function(t){return e.core.ctrl.eval([t])};var t=e.struct.atomProperty.core,n=e.struct.atomProperty.macromolecular,i=e.struct.atomProperty.topology;function a(e){return t[e]()}function o(e){return i[e]()}function u(e){return n[e]()}e.acp=a,e.atp=o,e.ammp=u;var s=e.struct.atomSet.propertySet;e.acpSet=function(e){return s([a(e)])},e.atpSet=function(e){return s([o(e)])},e.ammpSet=function(e){return s([u(e)])}}(t.MolScriptBuilder||(t.MolScriptBuilder={}))},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{s(r.next(e))}catch(e){a(e)}}function u(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,u)}s((r=r.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}},o=this;Object.defineProperty(t,"__esModule",{value:!0});var u=n(75),s=n(2),c=n(540),l=n(292),f=n(541),d=n(11),p=n(3),h=n(26),m=n(293),y=n(27),v=n(86),b=n(281),g=n(53),_=n(160),S=h.PluginStateTransform.BuiltIn({name:"volume-from-ccp4",display:{name:"Volume from CCP4/MRC/MAP",description:"Create Volume from CCP4/MRC/MAP data"},from:h.PluginStateObject.Format.Ccp4,to:h.PluginStateObject.Volume.Data,params:function(e){return{voxelSize:p.ParamDefinition.Vec3(s.Vec3.create(1,1,1))}}})({apply:function(e){var t=this,n=e.a,r=e.params;return d.Task.create("Create volume from CCP4/MRC/MAP",function(e){return i(t,void 0,void 0,function(){var t,i;return a(this,function(a){switch(a.label){case 0:return[4,c.volumeFromCcp4(n.data,r).runInContext(e)];case 1:return t=a.sent(),i={label:"Volume"},[2,new h.PluginStateObject.Volume.Data(t,i)]}})})})}});t.VolumeFromCcp4=S;var C=h.PluginStateTransform.BuiltIn({name:"volume-from-dsn6",display:{name:"Volume from DSN6/BRIX",description:"Create Volume from DSN6/BRIX data"},from:h.PluginStateObject.Format.Dsn6,to:h.PluginStateObject.Volume.Data,params:function(e){return{voxelSize:p.ParamDefinition.Vec3(s.Vec3.create(1,1,1))}}})({apply:function(e){var t=this,n=e.a,r=e.params;return d.Task.create("Create volume from DSN6/BRIX",function(e){return i(t,void 0,void 0,function(){var t,i;return a(this,function(a){switch(a.label){case 0:return[4,f.volumeFromDsn6(n.data,r).runInContext(e)];case 1:return t=a.sent(),i={label:"Volume"},[2,new h.PluginStateObject.Volume.Data(t,i)]}})})})}});t.VolumeFromDsn6=C;var x=h.PluginStateTransform.BuiltIn({name:"volume-from-density-server-cif",display:{name:"Volume from density-server CIF",description:"Identify and create all separate models in the specified CIF data block"},from:h.PluginStateObject.Format.Cif,to:h.PluginStateObject.Volume.Data,params:function(e){if(!e)return{blockHeader:p.ParamDefinition.makeOptional(p.ParamDefinition.Text(void 0,{description:"Header of the block to parse. If none is specifed, the 1st data block in the file is used."}))};var t=e.data.blocks.slice(1);return{blockHeader:p.ParamDefinition.makeOptional(p.ParamDefinition.Select(t[0]&&t[0].header,t.map(function(e){return[e.header,e.header]}),{description:"Header of the block to parse"}))}}})({isApplicable:function(e){return e.data.blocks.length>0},apply:function(e){var t=this,n=e.a,r=e.params;return d.Task.create("Parse density-server CIF",function(e){return i(t,void 0,void 0,function(){var t,i,o,s,c;return a(this,function(a){switch(a.label){case 0:if(t=r.blockHeader||n.data.blocks[1].header,!(i=n.data.blocks.find(function(e){return e.header===t})))throw new Error("Data block '"+[t]+"' not found.");return o=u.default.schema.densityServer(i),[4,l.volumeFromDensityServerData(o).runInContext(e)];case 1:return s=a.sent(),c={label:o.volume_data_3d_info.name.value(0),description:""+o.volume_data_3d_info.name.value(0)},[2,new h.PluginStateObject.Volume.Data(s,c)]}})})})}});t.VolumeFromDensityServerCif=x;var w=h.PluginStateTransform.BuiltIn({name:"volume-streaming-behavior",display:{name:"Volume Streaming Behavior",description:"Create Volume Streaming behavior."},from:h.PluginStateObject.Molecule.Structure,to:m.VolumeStreaming.Obj,params:m.VolumeStreaming.Params})({canAutoUpdate:function(e){var t=e.oldParams,n=e.newParams;return t.serverUrl===n.serverUrl&&t.id===n.id},apply:function(e,t){var n=e.a,r=e.params;return d.Task.create("Volume Streaming",function(e){return i(o,void 0,void 0,function(){var e;return a(this,function(i){switch(i.label){case 0:return[4,(e=new m.VolumeStreaming.Behavior(t,r,n.data)).update(e.params)];case 1:return i.sent(),[2,new m.VolumeStreaming.Obj(e,{label:"Volume Streaming"})]}})})})},update:function(e){var t=this,n=e.b,r=e.newParams;return d.Task.create("Update Volume Streaming",function(e){return i(t,void 0,void 0,function(){return a(this,function(e){switch(e.label){case 0:return[4,n.data.update(r)];case 1:return e.sent(),[2,y.StateTransformer.UpdateResult.Updated]}})})})}});t.VolumeStreamingBehavior=w;var P=h.PluginStateTransform.BuiltIn({name:"volume-streaming-visual",display:{name:"Volume Streaming Visual"},from:m.VolumeStreaming.Obj,to:h.PluginStateObject.Volume.Representation3D,params:{channel:p.ParamDefinition.Select("EM",[["EM","EM"],["FO-FC","Fo-Fc"],["2FO-FC","2Fo-Fc"]],{isHidden:!0}),level:p.ParamDefinition.Text("em")}})({apply:function(e,t){var n=e.a,u=e.params;return d.Task.create("Volume Representation",function(e){return i(o,void 0,void 0,function(){var i,o,s,c,l,f;return a(this,function(a){switch(a.label){case 0:return i=T(n.data,u.channel,u.level),o=i.data,s=i.params,c=b.BuiltInVolumeRepresentations.isosurface,l=s.type.params||{},(f=c.factory(r({webgl:t.canvas3d.webgl},t.volumeRepresentation.themeCtx),c.getParams)).setTheme(g.createTheme(t.volumeRepresentation.themeCtx,{volume:o},s)),[4,f.createOrUpdate(l,o).runInContext(e)];case 1:return a.sent(),[2,new h.PluginStateObject.Volume.Representation3D(f,{label:u.level,description:_.VolumeRepresentation3DHelpers.getDescription(l)})]}})})})},update:function(e,t){var n=e.a,u=e.b,s=(e.oldParams,e.newParams);return d.Task.create("Volume Representation",function(e){return i(o,void 0,void 0,function(){var i,o,c,l;return a(this,function(a){switch(a.label){case 0:return i=T(n.data,s.channel,s.level),o=i.data,c=i.params,l=r({},u.data.props,c.type.params),u.data.setTheme(g.createTheme(t.volumeRepresentation.themeCtx,{volume:o},c)),[4,u.data.createOrUpdate(l,o).runInContext(e)];case 1:return a.sent(),[2,y.StateTransformer.UpdateResult.Updated]}})})})}});function T(e,t,n){var r,i,a=e.currentData[t]||v.VolumeData.One;if("em"===n&&"em"===e.params.levels.name)r=e.params.levels.params.isoValue,i=e.params.levels.params.color;else{if("em"===n||"x-ray"!==e.params.levels.name)throw new Error("Unsupported iso level "+n+".");r=e.params.levels.params[n].isoValue,i=e.params.levels.params[n].color}return{data:a,params:_.VolumeRepresentation3DHelpers.getDefaultParamsStatic(e.ctx,"isosurface",{isoValue:r,alpha:.3},"uniform",{value:i})}}t.VolumeStreamingVisual=P},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{s(r.next(e))}catch(e){a(e)}}function u(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,u)}s((r=r.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}};Object.defineProperty(t,"__esModule",{value:!0});var a=n(11),o=n(19),u=n(2),s=n(131),c=n(286),l=n(288);function f(e){return 0===e.originX&&0===e.originY&&0===e.originZ?[e.NCSTART,e.NRSTART,e.NSSTART]:[e.originX,e.originY,e.originZ]}t.getCcp4Origin=f,t.volumeFromCcp4=function(e,t){var n=this;return a.Task.create("Create Volume Data",function(a){return r(n,void 0,void 0,function(){var n,r,a,d,p,h,m,y,v,b,g,_,S,C;return i(this,function(i){return n=e.header,r=e.values,console.log({header:n,values:r}),a=u.Vec3.create(n.xLength,n.yLength,n.zLength),t&&t.voxelSize&&u.Vec3.mul(a,a,t.voxelSize),d=u.Vec3.create(s.degToRad(n.alpha),s.degToRad(n.beta),s.degToRad(n.gamma)),p=o.SpacegroupCell.create(n.ISPG||"P 1",a,d),h=u.Vec3.create(n.MAPC-1,n.MAPR-1,n.MAPS-1),m=u.Tensor.convertToCanonicalAxisIndicesFastToSlow(h),y=[n.NX,n.NY,n.NZ],v=m([n.NC,n.NR,n.NS]),b=m(f(n)),g=u.Vec3.create(b[0]/y[0],b[1]/y[1],b[2]/y[2]),_=u.Vec3.create(v[0]/y[0],v[1]/y[1],v[2]/y[2]),S=u.Tensor.Space(v,u.Tensor.invertAxisOrder(h),function(e){var t=c.getCcp4ValueType(e);switch(t){case l.TypedArrayValueType.Float32:return Float32Array;case l.TypedArrayValueType.Int8:return Int8Array;case l.TypedArrayValueType.Int16:return Int16Array}throw Error(t+" is not a supported value format.")}(n)),C=u.Tensor.create(S,u.Tensor.Data1(r)),[2,{cell:p,fractionalBox:o.Box3D.create(g,u.Vec3.add(u.Vec3.zero(),g,_)),data:C,dataStats:{min:n.AMIN,max:n.AMAX,mean:n.AMEAN,sigma:n.ARMS}}]})})})}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{s(r.next(e))}catch(e){a(e)}}function u(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,u)}s((r=r.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}};Object.defineProperty(t,"__esModule",{value:!0});var a=n(11),o=n(19),u=n(2),s=n(131),c=n(142);t.volumeFromDsn6=function(e,t){var n=this;return a.Task.create("Create Volume Data",function(a){return r(n,void 0,void 0,function(){var n,r,a,l,f,d,p,h,m,y,v,b;return i(this,function(i){return n=e.header,r=e.values,a=u.Vec3.create(n.xlen,n.ylen,n.zlen),t&&t.voxelSize&&u.Vec3.mul(a,a,t.voxelSize),l=u.Vec3.create(s.degToRad(n.alpha),s.degToRad(n.beta),s.degToRad(n.gamma)),f=o.SpacegroupCell.create("P 1",a,l),d=[n.xRate,n.yRate,n.zRate],p=[n.xExtent,n.yExtent,n.zExtent],h=[n.xStart,n.yStart,n.zStart],m=u.Vec3.create(h[0]/d[0],h[1]/d[1],h[2]/d[2]),y=u.Vec3.create(p[0]/d[0],p[1]/d[1],p[2]/d[2]),v=u.Tensor.Space(p,[0,1,2],Float32Array),b=u.Tensor.create(v,u.Tensor.Data1(r)),[2,{cell:f,fractionalBox:o.Box3D.create(m,u.Vec3.add(u.Vec3.zero(),m,y)),data:b,dataStats:{min:c.arrayMin(r),max:c.arrayMax(r),mean:c.arrayMean(r),sigma:void 0!==n.sigma?n.sigma:c.arrayRms(r)}}]})})})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(45);!function(e){e.create=function(e){return{entries:i.LinkedList(),capacity:Math.max(1,e)}},e.get=function(e,t){for(var n=e.entries.first;n;n=n.next)if(n.value.key===t)return e.entries.remove(n),e.entries.addLast(n.value),n.value.data},e.set=function(e,t,n){return e.entries.count>=e.capacity&&e.entries.remove(e.entries.first),e.entries.addLast(function(e,t){return{key:e,data:t}}(t,n)),n}}(r||(r={})),t.LRUCache=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(74),i=n(3),a=function(){function e(){this.providers=r.OrderedMap().asMutable()}return e.prototype.getSelect=function(e){for(var t=this.providers.values(),n=[],r=[];;){var a=t.next();if(a.done)break;a.value.attachableTo(e)&&(n.push(a.value.option),a.value.defaultSelected&&r.push(a.value.option[0]))}return i.ParamDefinition.MultiSelect(r,n)},e.prototype.getDefault=function(e){for(var t=this.providers.values(),n=[];;){var r=t.next();if(r.done)break;r.value.attachableTo(e)&&(r.value.defaultSelected&&n.push(r.value.option[0]))}return n},e.prototype.get=function(e){if(!this.providers.get(e))throw new Error("Custom prop '"+e+"' is not registered.");return this.providers.get(e)},e.prototype.register=function(e){this.providers.set(e.descriptor.name,e)},e.prototype.unregister=function(e){this.providers.delete(e)},e}();t.CustomPropertyRegistry=a},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var a=n(7),o=n(24),u=n(61),s=n(546),c=n(550),l=n(551),f=n(296),d=n(553),p=n(554),h=n(556),m=n(557),y=n(27),v=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.region=function(e,t){return o.createElement("div",{className:"msp-layout-region msp-layout-"+e},o.createElement("div",{className:"msp-layout-static"},t))},t.prototype.render=function(){return o.createElement(u.PluginReactContext.Provider,{value:this.props.plugin},o.createElement(b,null))},t}(o.Component);t.Plugin=v;var b=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.componentDidMount=function(){var e=this;this.subscribe(this.plugin.layout.events.updated,function(){return e.forceUpdate()})},t.prototype.region=function(e,t){return o.createElement("div",{className:"msp-layout-region msp-layout-"+e},o.createElement("div",{className:"msp-layout-static"},t))},t.prototype.render=function(){var e=this.plugin.layout.state;return o.createElement("div",{className:"msp-plugin"},o.createElement("div",{className:"msp-plugin-content "+(e.isExpanded?"msp-layout-expanded":"msp-layout-standard msp-layout-standard-outside")},o.createElement("div",{className:e.showControls?"msp-layout-hide-top":"msp-layout-hide-top msp-layout-hide-right msp-layout-hide-bottom msp-layout-hide-left"},this.region("main",o.createElement(g,null)),e.showControls&&this.region("left",o.createElement(_,null)),e.showControls&&this.region("right",o.createElement("div",{className:"msp-scrollable-container msp-right-controls"},o.createElement(C,null),o.createElement(c.Controls,null),o.createElement(d.AnimationControls,null),o.createElement(s.CameraSnapshots,null),o.createElement(l.StateSnapshots,null))),e.showControls&&this.region("bottom",o.createElement(S,null)))))},t}(u.PluginUIComponent),g=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.render=function(){return o.createElement(o.Fragment,null,o.createElement(m.Viewport,null),o.createElement("div",{style:{position:"absolute",left:"10px",top:"10px",color:"white"}},o.createElement(c.TrajectoryControls,null)),o.createElement(m.ViewportControls,null),o.createElement("div",{style:{position:"absolute",left:"10px",bottom:"10px"}},o.createElement(h.BackgroundTaskProgress,null)),o.createElement("div",{style:{position:"absolute",right:"10px",bottom:"10px"}},o.createElement(c.LociLabelControl,null)))},t}(u.PluginUIComponent);t.ViewportWrapper=g;var _=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.componentDidMount=function(){var e=this;this.subscribe(this.plugin.state.behavior.kind,function(){return e.forceUpdate()})},t.prototype.set=function(e){this.plugin.state.setKind(e)},t.prototype.render=function(){var e=this,t=this.plugin.state.behavior.kind.value;return o.createElement("div",{className:"msp-scrollable-container"},o.createElement("div",{className:"msp-btn-row-group msp-data-beh"},o.createElement("button",{className:"msp-btn msp-btn-block msp-form-control",onClick:function(){return e.set("data")},style:{fontWeight:"data"===t?"bold":"normal"}},"Data"),o.createElement("button",{className:"msp-btn msp-btn-block msp-form-control",onClick:function(){return e.set("behavior")},style:{fontWeight:"behavior"===t?"bold":"normal"}},"Behavior")),o.createElement(p.StateTree,{state:"data"===t?this.plugin.state.dataState:this.plugin.state.behaviorState}))},t}(u.PluginUIComponent);t.State=_;var S=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.wrapper=o.createRef(),t.state={entries:t.plugin.log.entries},t}return i(t,e),t.prototype.componentDidMount=function(){var e=this;this.subscribe(this.plugin.events.log,function(){return e.setState({entries:e.plugin.log.entries})})},t.prototype.componentDidUpdate=function(){this.scrollToBottom()},t.prototype.scrollToBottom=function(){var e=this.wrapper.current;e&&(e.scrollTop=e.scrollHeight-e.clientHeight-1)},t.prototype.render=function(){for(var e=this.state.entries,t=e.size,n=[],r=Math.max(0,t-10),i=0;r<t;r++){var u=e.get(r);n.push(o.createElement("li",{key:i++},o.createElement("div",{className:"msp-log-entry-badge msp-log-entry-"+u.type}),o.createElement("div",{className:"msp-log-timestamp"},a.formatTime(u.timestamp)),o.createElement("div",{className:"msp-log-entry"},u.message)))}return o.createElement("div",{ref:this.wrapper,className:"msp-log",style:{position:"absolute",top:"0",right:"0",bottom:"0",left:"0",overflowY:"auto"}},o.createElement("ul",{className:"msp-list-unstyled"},n))},t}(u.PluginUIComponent);t.Log=S;var C=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),Object.defineProperty(t.prototype,"current",{get:function(){return this.plugin.state.behavior.currentObject.value},enumerable:!0,configurable:!0}),t.prototype.componentDidMount=function(){var e=this;this.subscribe(this.plugin.state.behavior.currentObject,function(t){e.forceUpdate()}),this.subscribe(this.plugin.events.state.object.updated,function(t){var n=t.ref,r=t.state,i=e.current;i.ref===n&&i.state===r&&e.forceUpdate()})},t.prototype.render=function(){var e=this.current,t=e.ref,n=e.state.cells.get(t),r=n.transform.transformer.definition,i=n.obj?n.obj.label:r.display&&r.display.name||r.name,a=!0;t===y.StateTransform.RootRef&&(a=0!==e.state.tree.children.get(t).size);return a?"ok"===n.status&&o.createElement(o.Fragment,null,o.createElement("div",{className:"msp-section-header"},"Actions ("+i+")"),o.createElement(f.StateObjectActions,{state:e.state,nodeRef:t})):null},t}(u.PluginUIComponent);t.CurrentObject=C},function(e,t,n){"use strict";
/** @license React v16.8.2
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var r=n(294),i="function"==typeof Symbol&&Symbol.for,a=i?Symbol.for("react.element"):60103,o=i?Symbol.for("react.portal"):60106,u=i?Symbol.for("react.fragment"):60107,s=i?Symbol.for("react.strict_mode"):60108,c=i?Symbol.for("react.profiler"):60114,l=i?Symbol.for("react.provider"):60109,f=i?Symbol.for("react.context"):60110,d=i?Symbol.for("react.concurrent_mode"):60111,p=i?Symbol.for("react.forward_ref"):60112,h=i?Symbol.for("react.suspense"):60113,m=i?Symbol.for("react.memo"):60115,y=i?Symbol.for("react.lazy"):60116,v="function"==typeof Symbol&&Symbol.iterator;function b(e){for(var t=arguments.length-1,n="https://reactjs.org/docs/error-decoder.html?invariant="+e,r=0;r<t;r++)n+="&args[]="+encodeURIComponent(arguments[r+1]);!function(e,t,n,r,i,a,o,u){if(!e){if(e=void 0,void 0===t)e=Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var s=[n,r,i,a,o,u],c=0;(e=Error(t.replace(/%s/g,function(){return s[c++]}))).name="Invariant Violation"}throw e.framesToPop=1,e}}(!1,"Minified React error #"+e+"; visit %s for the full message or use the non-minified dev environment for full errors and additional helpful warnings. ",n)}var g={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},_={};function S(e,t,n){this.props=e,this.context=t,this.refs=_,this.updater=n||g}function C(){}function x(e,t,n){this.props=e,this.context=t,this.refs=_,this.updater=n||g}S.prototype.isReactComponent={},S.prototype.setState=function(e,t){"object"!=typeof e&&"function"!=typeof e&&null!=e&&b("85"),this.updater.enqueueSetState(this,e,t,"setState")},S.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},C.prototype=S.prototype;var w=x.prototype=new C;w.constructor=x,r(w,S.prototype),w.isPureReactComponent=!0;var P={current:null},T={current:null},A=Object.prototype.hasOwnProperty,E={key:!0,ref:!0,__self:!0,__source:!0};function k(e,t,n){var r=void 0,i={},o=null,u=null;if(null!=t)for(r in void 0!==t.ref&&(u=t.ref),void 0!==t.key&&(o=""+t.key),t)A.call(t,r)&&!E.hasOwnProperty(r)&&(i[r]=t[r]);var s=arguments.length-2;if(1===s)i.children=n;else if(1<s){for(var c=Array(s),l=0;l<s;l++)c[l]=arguments[l+2];i.children=c}if(e&&e.defaultProps)for(r in s=e.defaultProps)void 0===i[r]&&(i[r]=s[r]);return{$$typeof:a,type:e,key:o,ref:u,props:i,_owner:T.current}}function I(e){return"object"==typeof e&&null!==e&&e.$$typeof===a}var M=/\/+/g,V=[];function O(e,t,n,r){if(V.length){var i=V.pop();return i.result=e,i.keyPrefix=t,i.func=n,i.context=r,i.count=0,i}return{result:e,keyPrefix:t,func:n,context:r,count:0}}function D(e){e.result=null,e.keyPrefix=null,e.func=null,e.context=null,e.count=0,10>V.length&&V.push(e)}function R(e,t,n){return null==e?0:function e(t,n,r,i){var u=typeof t;"undefined"!==u&&"boolean"!==u||(t=null);var s=!1;if(null===t)s=!0;else switch(u){case"string":case"number":s=!0;break;case"object":switch(t.$$typeof){case a:case o:s=!0}}if(s)return r(i,t,""===n?"."+j(t,0):n),1;if(s=0,n=""===n?".":n+":",Array.isArray(t))for(var c=0;c<t.length;c++){var l=n+j(u=t[c],c);s+=e(u,l,r,i)}else if(l=null===t||"object"!=typeof t?null:"function"==typeof(l=v&&t[v]||t["@@iterator"])?l:null,"function"==typeof l)for(t=l.call(t),c=0;!(u=t.next()).done;)s+=e(u=u.value,l=n+j(u,c++),r,i);else"object"===u&&b("31","[object Object]"==(r=""+t)?"object with keys {"+Object.keys(t).join(", ")+"}":r,"");return s}(e,"",t,n)}function j(e,t){return"object"==typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+(""+e).replace(/[=:]/g,function(e){return t[e]})}(e.key):t.toString(36)}function N(e,t){e.func.call(e.context,t,e.count++)}function B(e,t,n){var r=e.result,i=e.keyPrefix;e=e.func.call(e.context,t,e.count++),Array.isArray(e)?F(e,r,n,function(e){return e}):null!=e&&(I(e)&&(e=function(e,t){return{$$typeof:a,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(e,i+(!e.key||t&&t.key===e.key?"":(""+e.key).replace(M,"$&/")+"/")+n)),r.push(e))}function F(e,t,n,r,i){var a="";null!=n&&(a=(""+n).replace(M,"$&/")+"/"),R(e,B,t=O(t,a,r,i)),D(t)}function L(){var e=P.current;return null===e&&b("307"),e}var z={Children:{map:function(e,t,n){if(null==e)return e;var r=[];return F(e,r,null,t,n),r},forEach:function(e,t,n){if(null==e)return e;R(e,N,t=O(null,null,t,n)),D(t)},count:function(e){return R(e,function(){return null},null)},toArray:function(e){var t=[];return F(e,t,null,function(e){return e}),t},only:function(e){return I(e)||b("143"),e}},createRef:function(){return{current:null}},Component:S,PureComponent:x,createContext:function(e,t){return void 0===t&&(t=null),(e={$$typeof:f,_calculateChangedBits:t,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null}).Provider={$$typeof:l,_context:e},e.Consumer=e},forwardRef:function(e){return{$$typeof:p,render:e}},lazy:function(e){return{$$typeof:y,_ctor:e,_status:-1,_result:null}},memo:function(e,t){return{$$typeof:m,type:e,compare:void 0===t?null:t}},useCallback:function(e,t){return L().useCallback(e,t)},useContext:function(e,t){return L().useContext(e,t)},useEffect:function(e,t){return L().useEffect(e,t)},useImperativeHandle:function(e,t,n){return L().useImperativeHandle(e,t,n)},useDebugValue:function(){},useLayoutEffect:function(e,t){return L().useLayoutEffect(e,t)},useMemo:function(e,t){return L().useMemo(e,t)},useReducer:function(e,t,n){return L().useReducer(e,t,n)},useRef:function(e){return L().useRef(e)},useState:function(e){return L().useState(e)},Fragment:u,StrictMode:s,Suspense:h,createElement:k,cloneElement:function(e,t,n){null==e&&b("267",e);var i=void 0,o=r({},e.props),u=e.key,s=e.ref,c=e._owner;if(null!=t){void 0!==t.ref&&(s=t.ref,c=T.current),void 0!==t.key&&(u=""+t.key);var l=void 0;for(i in e.type&&e.type.defaultProps&&(l=e.type.defaultProps),t)A.call(t,i)&&!E.hasOwnProperty(i)&&(o[i]=void 0===t[i]&&void 0!==l?l[i]:t[i])}if(1===(i=arguments.length-2))o.children=n;else if(1<i){l=Array(i);for(var f=0;f<i;f++)l[f]=arguments[f+2];o.children=l}return{$$typeof:a,type:e.type,key:u,ref:s,props:o,_owner:c}},createFactory:function(e){var t=k.bind(null,e);return t.type=e,t},isValidElement:I,version:"16.8.2",unstable_ConcurrentMode:d,unstable_Profiler:c,__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:{ReactCurrentDispatcher:P,ReactCurrentOwner:T,assign:r}},U={default:z},G=U&&z||U;e.exports=G.default||G},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var a=n(37),o=n(24),u=n(61),s=n(3),c=n(128),l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.render=function(){return o.createElement("div",null,o.createElement("div",{className:"msp-section-header"},"Camera Snapshots"),o.createElement(f,null),o.createElement(d,null))},t}(u.PluginUIComponent);t.CameraSnapshots=l;var f=function(e){function t(){var n=null!==e&&e.apply(this,arguments)||this;return n.state=s.ParamDefinition.getDefaultValues(t.Params),n.add=function(){a.PluginCommands.Camera.Snapshots.Add.dispatch(n.plugin,n.state),n.setState({name:"",description:""})},n.clear=function(){a.PluginCommands.Camera.Snapshots.Clear.dispatch(n.plugin,{})},n}return i(t,e),t.prototype.render=function(){var e=this;return o.createElement("div",null,o.createElement(c.ParameterControls,{params:t.Params,values:this.state,onEnter:this.add,onChange:function(t){var n;return e.setState(((n={})[t.name]=t.value,n))}}),o.createElement("div",{className:"msp-btn-row-group"},o.createElement("button",{className:"msp-btn msp-btn-block msp-form-control",onClick:this.add},"Add"),o.createElement("button",{className:"msp-btn msp-btn-block msp-form-control",onClick:this.clear},"Clear")))},t.Params={name:s.ParamDefinition.Text(),description:s.ParamDefinition.Text()},t}(u.PluginUIComponent),d=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.componentDidMount=function(){var e=this;this.subscribe(this.plugin.events.state.cameraSnapshots.changed,function(){return e.forceUpdate()})},t.prototype.apply=function(e){var t=this;return function(){return a.PluginCommands.Camera.Snapshots.Apply.dispatch(t.plugin,{id:e})}},t.prototype.remove=function(e){var t=this;return function(){a.PluginCommands.Camera.Snapshots.Remove.dispatch(t.plugin,{id:e})}},t.prototype.render=function(){var e=this;return o.createElement("ul",{style:{listStyle:"none"},className:"msp-state-list"},this.plugin.state.cameraSnapshots.state.entries.valueSeq().map(function(t){return o.createElement("li",{key:t.id},o.createElement("button",{className:"msp-btn msp-btn-block msp-form-control",onClick:e.apply(t.id)},t.name||t.timestamp," ",o.createElement("small",null,t.description)),o.createElement("button",{onClick:e.remove(t.id),className:"msp-btn msp-btn-link msp-state-list-remove-button"},o.createElement("span",{className:"msp-icon msp-icon-remove"})))}))},t}(u.PluginUIComponent)},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var a=n(548),o=n(24),u=n(2),s=function(e){function t(t){var n=e.call(this,t)||this;n.handleKeyDown=function(e){},n.handleKeyUp=function(e){},n.handleClick=function(e){return function(e){}},n.handleMouseDown=function(e){return function(t){if(0!==e&&e!==n.state.points.length-1&&!n.state.canSelectMultiple){var r=n.normalizePoint(u.Vec2.create(n.state.points[e][0],n.state.points[e][1]));n.ghostPoints.push(document.createElementNS(n.namespace,"circle")),n.ghostPoints[0].setAttribute("r","10"),n.ghostPoints[0].setAttribute("fill","orange"),n.ghostPoints[0].setAttribute("cx",""+r[0]),n.ghostPoints[0].setAttribute("cy",""+r[1]),n.ghostPoints[0].setAttribute("style","display: none"),n.gElement.appendChild(n.ghostPoints[0]),n.updatedX=r[0],n.updatedY=r[1],n.selected=[e]}}},n.deletePoint=function(e){return function(t){if(0!==e&&e!==n.state.points.length-1){var r=n.state.points.filter(function(t,n){return n!==e});r.sort(function(e,t){return e[0]===t[0]?0===e[0]?e[1]-t[1]:1===e[1]?t[1]-e[1]:e[1]-t[1]:e[0]-t[0]}),n.setState({points:r}),n.change(r),t.stopPropagation()}}},n.myRef=o.createRef(),n.state={points:[u.Vec2.create(0,0),u.Vec2.create(1,0)],copyPoint:void 0,canSelectMultiple:!1},n.height=400,n.width=600,n.padding=70,n.selected=void 0,n.ghostPoints=[],n.namespace="http://www.w3.org/2000/svg";for(var r=0,i=n.props.data;r<i.length;r++){var a=i[r];n.state.points.push(a)}return n.state.points.sort(function(e,t){return e[0]===t[0]?0===e[0]?e[1]-t[1]:1===e[1]?t[1]-e[1]:e[1]-t[1]:e[0]-t[0]}),n.handleDrag=n.handleDrag.bind(n),n.handleMultipleDrag=n.handleMultipleDrag.bind(n),n.handleDoubleClick=n.handleDoubleClick.bind(n),n.refCallBack=n.refCallBack.bind(n),n.handlePointUpdate=n.handlePointUpdate.bind(n),n.change=n.change.bind(n),n.handleKeyUp=n.handleKeyUp.bind(n),n.handleLeave=n.handleLeave.bind(n),n.handleEnter=n.handleEnter.bind(n),n}return i(t,e),t.prototype.render=function(){var e=this.renderPoints(),t=this.renderLines();return[o.createElement("div",{key:"LineGraph"},o.createElement("svg",{className:"msp-canvas",ref:this.refCallBack,viewBox:"0 0 "+(this.width+this.padding)+" "+(this.height+this.padding),onMouseMove:this.handleDrag,onMouseUp:this.handlePointUpdate,onMouseLeave:this.handleLeave,onMouseEnter:this.handleEnter,tabIndex:0,onKeyDown:this.handleKeyDown,onKeyUp:this.handleKeyUp,onDoubleClick:this.handleDoubleClick},o.createElement("g",{stroke:"black",fill:"black"},t,e),o.createElement("g",{className:"ghost-points",stroke:"black",fill:"black"}))),o.createElement("div",{key:"modal",id:"modal-root"})]},t.prototype.componentDidMount=function(){this.gElement=document.getElementsByClassName("ghost-points")[0]},t.prototype.change=function(e){var t=e.slice();t.shift(),t.pop(),this.props.onChange(t)},t.prototype.handleDrag=function(e){if(void 0!==this.selected){var t,n=this.myRef.createSVGPoint(),r=this.padding/2;n.x=e.clientX,n.y=e.clientY;var i=n.matrixTransform(this.myRef.getScreenCTM().inverse());t=u.Vec2.create(i.x,i.y),t=(i.x<r||i.x>this.width+r)&&(i.y>this.height+r||i.y<r)?u.Vec2.create(this.updatedX,this.updatedY):i.x<r?u.Vec2.create(r,i.y):i.x>this.width+r?u.Vec2.create(this.width+r,i.y):i.y>this.height+r?u.Vec2.create(i.x,this.height+r):i.y<r?u.Vec2.create(i.x,r):u.Vec2.create(i.x,i.y),this.updatedX=t[0],this.updatedY=t[1];var a=this.unNormalizePoint(t);this.ghostPoints[0].setAttribute("style","display: visible"),this.ghostPoints[0].setAttribute("cx",""+t[0]),this.ghostPoints[0].setAttribute("cy",""+t[1]),this.props.onDrag(a)}},t.prototype.handleMultipleDrag=function(){},t.prototype.handlePointUpdate=function(e){var t=this.selected;if(!this.state.canSelectMultiple)if(void 0!==t&&0!==t[0]&&t[0]!==this.state.points.length-1){this.selected=void 0;var n=this.unNormalizePoint(u.Vec2.create(this.updatedX,this.updatedY)),r=this.state.points.filter(function(e,n){return n!==t[0]});r.push(n),r.sort(function(e,t){return e[0]===t[0]?0===e[0]?e[1]-t[1]:1===e[1]?t[1]-e[1]:e[1]-t[1]:e[0]-t[0]}),this.setState({points:r}),this.change(r),this.gElement.innerHTML="",this.ghostPoints=[],document.removeEventListener("mousemove",this.handleDrag,!0),document.removeEventListener("mouseup",this.handlePointUpdate,!0)}else this.setState({copyPoint:void 0})},t.prototype.handleDoubleClick=function(e){var t,n=this.myRef.createSVGPoint();n.x=e.clientX,n.y=e.clientY;var r=n.matrixTransform(this.myRef.getScreenCTM().inverse()),i=this.state.points,a=this.padding/2;r.x<a||r.x>this.width+a||r.y>this.height+a||r.y<this.padding/2||(t=this.unNormalizePoint(u.Vec2.create(r.x,r.y)),i.push(t),i.sort(function(e,t){return e[0]===t[0]?0===e[0]?e[1]-t[1]:1===e[1]?t[1]-e[1]:e[1]-t[1]:e[0]-t[0]}),this.setState({points:i}),this.change(i))},t.prototype.handleLeave=function(){void 0!==this.selected&&(document.addEventListener("mousemove",this.handleDrag,!0),document.addEventListener("mouseup",this.handlePointUpdate,!0))},t.prototype.handleEnter=function(){document.removeEventListener("mousemove",this.handleDrag,!0),document.removeEventListener("mouseup",this.handlePointUpdate,!0)},t.prototype.normalizePoint=function(e){var t=this.padding/2,n=this.width+t,r=this.height+t,i=e[0]*(n-t)+t,a=e[1]*(r-t)+t,o=this.height+this.padding-a;return u.Vec2.create(i,o)},t.prototype.unNormalizePoint=function(e){var t=this.padding/2,n=this.width+t,r=this.height+t,i=(e[0]-t)/(n-t),a=(this.height+this.padding-e[1]-t)/(r-t);return u.Vec2.create(i,a)},t.prototype.refCallBack=function(e){e&&(this.myRef=e)},t.prototype.renderPoints=function(){for(var e,t=[],n=0;n<this.state.points.length;n++)0!=n&&n!=this.state.points.length-1&&(e=this.normalizePoint(this.state.points[n]),t.push(o.createElement(a.default,{key:n,id:n,x:e[0],y:e[1],nX:this.state.points[n][0],nY:this.state.points[n][1],selected:!1,delete:this.deletePoint,onmouseover:this.props.onHover,onmousedown:this.handleMouseDown(n),onclick:this.handleClick(n)})));return t},t.prototype.renderLines=function(){for(var e,t,n,r,i,a,s=[],c=[],l=0,f=this.state.points;l<f.length;l++){var d=f[l];e=this.padding/2,t=this.width+e,n=this.height+e,r=d[0]*(t-e)+e,i=d[1]*(n-e)+e,a=this.height+this.padding-i,s.push(u.Vec2.create(r,a))}for(var p=s,h=p.length,m=0;m<h-1;m++){var y=p[m][0],v=p[m][1],b=p[m+1][0],g=p[m+1][1];c.push(o.createElement("line",{key:"lineOf"+m,x1:y,x2:b,y1:v,y2:g,stroke:"#cec9ba",strokeWidth:"5"}))}return c},t}(o.Component);t.default=s},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var a=n(24),o=n(2),u=function(e){function t(t){var n=e.call(this,t)||this;return n.state={show:!1},n.handleHover=n.handleHover.bind(n),n.handleHoverOff=n.handleHoverOff.bind(n),n.deletePoint=n.deletePoint.bind(n),n}return i(t,e),t.prototype.handleHover=function(){this.setState({show:!0});var e=o.Vec2.create(this.props.nX,this.props.nY);this.props.onmouseover(e)},t.prototype.handleHoverOff=function(){this.setState({show:!1}),this.props.onmouseover(void 0)},t.prototype.deletePoint=function(){this.props.delete(this.props.id)},t.prototype.render=function(){return[a.createElement("circle",{r:"10",key:this.props.id+"circle",id:""+this.props.id,cx:this.props.x,cy:this.props.y,onClick:this.props.onclick,onDoubleClick:this.props.delete(this.props.id),onMouseEnter:this.handleHover,onMouseLeave:this.handleHoverOff,onMouseDown:this.props.onmousedown,fill:"black"})]},t}(a.Component);t.default=u},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),a=this&&this.__assign||function(){return(a=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var o=n(24),u=n(216),s=n(7),c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={isChanging:!1,current:0},t.begin=function(){t.setState({isChanging:!0})},t.end=function(e){t.setState({isChanging:!1}),t.props.onChange(e)},t.updateCurrent=function(e){t.setState({current:e})},t.updateManually=function(e){t.setState({isChanging:!0});var n=e;1===t.props.step&&(n=Math.round(n)),n<t.props.min&&(n=t.props.min),n>t.props.max&&(n=t.props.max),t.setState({current:n,isChanging:!0})},t.onManualBlur=function(){t.setState({isChanging:!1}),t.props.onChange(t.state.current)},t}return i(t,e),t.getDerivedStateFromProps=function(e,t){return t.isChanging||e.value===t.current?null:{current:e.value}},t.prototype.render=function(){var e=this.props.step;return void 0===e&&(e=1),o.createElement("div",{className:"msp-slider"},o.createElement("div",null,o.createElement(b,{min:this.props.min,max:this.props.max,step:e,value:this.state.current,disabled:this.props.disabled,onBeforeChange:this.begin,onChange:this.updateCurrent,onAfterChange:this.end})),o.createElement("div",null,o.createElement(u.NumericInput,{value:this.state.current,blurOnEnter:!0,onBlur:this.onManualBlur,isDisabled:this.props.disabled,onChange:this.updateManually})))},t}(o.Component);t.Slider=c;var l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={isChanging:!1,current:[0,1]},t.begin=function(){t.setState({isChanging:!0})},t.end=function(e){t.setState({isChanging:!1}),t.props.onChange(e)},t.updateCurrent=function(e){t.setState({current:e})},t.updateMax=function(e){var n=e;1===t.props.step&&(n=Math.round(n)),n<t.state.current[0]?n=t.state.current[0]:n<t.props.min&&(n=t.props.min),n>t.props.max&&(n=t.props.max),t.props.onChange([t.state.current[0],n])},t.updateMin=function(e){var n=e;1===t.props.step&&(n=Math.round(n)),n<t.props.min&&(n=t.props.min),n>t.state.current[1]?n=t.state.current[1]:n>t.props.max&&(n=t.props.max),t.props.onChange([n,t.state.current[1]])},t}return i(t,e),t.getDerivedStateFromProps=function(e,t){return t.isChanging||e.value[0]===t.current[0]&&e.value[1]===t.current[1]?null:{current:e.value}},t.prototype.render=function(){var e=this.props.step;return void 0===e&&(e=1),o.createElement("div",{className:"msp-slider2"},o.createElement("div",null,o.createElement(u.NumericInput,{value:this.state.current[0],onEnter:this.props.onEnter,blurOnEnter:!0,isDisabled:this.props.disabled,onChange:this.updateMin})),o.createElement("div",null,o.createElement(b,{min:this.props.min,max:this.props.max,step:e,value:this.state.current,disabled:this.props.disabled,onBeforeChange:this.begin,onChange:this.updateCurrent,onAfterChange:this.end,range:!0,pushable:!0})),o.createElement("div",null,o.createElement(u.NumericInput,{value:this.state.current[1],onEnter:this.props.onEnter,blurOnEnter:!0,isDisabled:this.props.disabled,onChange:this.updateMax})))},t}(o.Component);function f(e){for(var t=[],n={}.hasOwnProperty,r=0;r<arguments.length;r++){var i=arguments[r];if(i){var a=typeof i;if("string"===a||"number"===a)t.push(i);else if(Array.isArray(i))t.push(f.apply(null,i));else if("object"===a)for(var o in i)n.call(i,o)&&i[o]&&t.push(o)}}return t.join(" ")}function d(e){return e.touches.length>1||"touchend"===e.type.toLowerCase()&&e.touches.length>0}function p(e,t){return e?t.touches[0].clientY:t.touches[0].pageX}function h(e,t){return e?t.clientY:t.pageX}function m(e,t){var n=t.getBoundingClientRect();return e?n.top+.5*n.height:n.left+.5*n.width}function y(e){e.stopPropagation(),e.preventDefault()}t.Slider2=l;var v=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.render=function(){var e=this.props,t=e.className,n=e.tipFormatter,r=e.vertical,i=e.offset,a=e.value,u=e.index,s=r?{bottom:i+"%"}:{left:i+"%"};return o.createElement("div",{className:t,style:s,title:n(a,u)})},t}(o.Component);t.Handle=v;var b=function(e){function t(t){var n=e.call(this,t)||this;n.sliderElement=void 0,n.handleElements=[],n.dragOffset=0,n.startPosition=0,n.startValue=0,n._getPointsCache=void 0,n.eventHandlers={touchmove:function(e){return n.onTouchMove(e)},touchend:function(e){return n.end("touch")},mousemove:function(e){return n.onMouseMove(e)},mouseup:function(e){return n.end("mouse")}};var r,i=t.range,a=t.min,o=t.max,u=i?Array.apply(null,Array(+i+1)).map(function(){return a}):a,s="defaultValue"in t?t.defaultValue:u,c=void 0!==t.value?t.value:s,l=(i?c:[a,c]).map(function(e){return n.trimAlignValue(e)});return r=i&&l[0]===l[l.length-1]&&l[0]===o?0:l.length-1,n.state={handle:null,recent:r,bounds:l},n}return i(t,e),t.prototype.componentWillReceiveProps=function(e){var t=this;if("value"in e||"min"in e||"max"in e){var n=this.state.bounds;if(e.range){var r=(i=e.value||n).map(function(n){return t.trimAlignValue(n,e)});if(r.every(function(e,t){return e===n[t]}))return;this.setState({bounds:r}),n.some(function(n){return t.isValueOutOfBounds(n,e)})&&this.props.onChange(r)}else{var i=void 0!==e.value?e.value:n[1],a=this.trimAlignValue(i,e);if(a===n[1]&&n[0]===e.min)return;this.setState({bounds:[e.min,a]}),this.isValueOutOfBounds(n[1],e)&&this.props.onChange(a)}}},t.prototype.onChange=function(e){var t=this.props;!("value"in t)?this.setState(e):void 0!==e.handle&&this.setState({handle:e.handle});var n=a({},this.state,e),r=t.range?n.bounds:n.bounds[1];t.onChange(r)},t.prototype.onMouseDown=function(e){if(0===e.button){var t=h(this.props.vertical,e);if(this.isEventFromHandle(e)){var n=m(this.props.vertical,e.target);this.dragOffset=t-n,t=n}else this.dragOffset=0;this.onStart(t),this.addDocumentEvents("mouse"),y(e)}},t.prototype.onMouseMove=function(e){var t=h(this.props.vertical,e);this.onMove(e,t-this.dragOffset)},t.prototype.onMove=function(e,t){y(e);var n=this.props,r=this.state,i=t-this.startPosition,a=(i=this.props.vertical?-i:i)/this.getSliderLength()*(n.max-n.min),o=this.trimAlignValue(this.startValue+a);if(o!==r.bounds[r.handle]){var u=r.bounds.slice();u[r.handle]=o;var s=r.handle;if(!1!==n.pushable){var c=r.bounds[s];this.pushSurroundingHandles(u,s,c)}else n.allowCross&&(u.sort(function(e,t){return e-t}),s=u.indexOf(o));this.onChange({handle:s,bounds:u})}},t.prototype.onStart=function(e){this.props.onBeforeChange(this.getValue());var t=this.calcValueByPos(e);this.startValue=t,this.startPosition=e;var n=this.state,r=n.bounds,i=1;if(this.props.range){for(var a=0,o=1;o<r.length-1;++o)t>r[o]&&(a=o);Math.abs(r[a+1]-t)<Math.abs(r[a]-t)&&(a+=1),i=a;var u=r[a+1]===r[a];u&&(i=n.recent),u&&t!==r[a+1]&&(i=t<r[a+1]?a:a+1)}if(this.setState({handle:i,recent:i}),t!==n.bounds[i]){var s=n.bounds.slice();s[i]=t,this.onChange({bounds:s})}},t.prototype.onTouchMove=function(e){if(d(e))this.end("touch");else{var t=p(this.props.vertical,e);this.onMove(e,t-this.dragOffset)}},t.prototype.onTouchStart=function(e){if(!d(e)){var t=p(this.props.vertical,e);if(this.isEventFromHandle(e)){var n=m(this.props.vertical,e.target);this.dragOffset=t-n,t=n}else this.dragOffset=0;this.onStart(t),this.addDocumentEvents("touch"),y(e)}},t.prototype.getPoints=function(){var e=this.props,t=e.marks,n=e.step,r=e.min,i=e.max,o=this._getPointsCache;if(!o||o.marks!==t||o.step!==n){var u=a({},t);if(null!==n)for(var s=r;s<=i;s+=n)u[s]=s;var c=Object.keys(u).map(parseFloat);c.sort(function(e,t){return e-t}),this._getPointsCache={marks:t,step:n,points:c}}return this._getPointsCache.points},t.prototype.getPrecision=function(e){var t=e.toString(),n=0;return t.indexOf(".")>=0&&(n=t.length-t.indexOf(".")-1),n},t.prototype.getSliderLength=function(){var e=this.sliderElement;return e?this.props.vertical?e.clientHeight:e.clientWidth:0},t.prototype.getSliderStart=function(){var e=this.sliderElement.getBoundingClientRect();return this.props.vertical?e.top:e.left},t.prototype.getValue=function(){var e=this.state.bounds;return this.props.range?e:e[1]},t.prototype.addDocumentEvents=function(e){"touch"===e?(document.addEventListener("touchmove",this.eventHandlers.touchmove),document.addEventListener("touchend",this.eventHandlers.touchend)):"mouse"===e&&(document.addEventListener("mousemove",this.eventHandlers.mousemove),document.addEventListener("mouseup",this.eventHandlers.mouseup))},t.prototype.calcOffset=function(e){var t=this.props,n=t.min;return 100*((e-n)/(t.max-n))},t.prototype.calcValue=function(e){var t=this.props,n=t.vertical,r=t.min,i=t.max,a=Math.abs(e/this.getSliderLength());return n?(1-a)*(i-r)+r:a*(i-r)+r},t.prototype.calcValueByPos=function(e){var t=e-this.getSliderStart();return this.trimAlignValue(this.calcValue(t))},t.prototype.end=function(e){this.removeEvents(e),this.props.onAfterChange(this.getValue()),this.setState({handle:null})},t.prototype.isEventFromHandle=function(e){for(var t=0,n=this.handleElements;t<n.length;t++){if(n[t]===e.target)return!0}return!1},t.prototype.isValueOutOfBounds=function(e,t){return e<t.min||e>t.max},t.prototype.pushHandle=function(e,t,n,r){for(var i=e[t],a=e[t];n*(a-i)<r;){if(!this.pushHandleOnePoint(e,t,n))return e[t]=i,!1;a=e[t]}return!0},t.prototype.pushHandleOnePoint=function(e,t,n){var r=this.getPoints(),i=r.indexOf(e[t])+n;if(i>=r.length||i<0)return!1;var a=t+n,o=r[i],u=this.props.pushable,s=n*(e[a]-o);return!!this.pushHandle(e,a,n,+u-s)&&(e[t]=o,!0)},t.prototype.pushSurroundingHandles=function(e,t,n){var r=this.props.pushable,i=e[t],a=0;if(e[t+1]-i<r?a=1:i-e[t-1]<r&&(a=-1),0!==a){var o=t+a,u=a*(e[o]-i);this.pushHandle(e,o,a,+r-u)||(e[t]=n)}},t.prototype.removeEvents=function(e){"touch"===e?(document.removeEventListener("touchmove",this.eventHandlers.touchmove),document.removeEventListener("touchend",this.eventHandlers.touchend)):"mouse"===e&&(document.removeEventListener("mousemove",this.eventHandlers.mousemove),document.removeEventListener("mouseup",this.eventHandlers.mouseup))},t.prototype.trimAlignValue=function(e,t){var n=this.state||{},r=n.handle,i=n.bounds,o=a({},this.props,t||{}),u=o.marks,s=o.step,c=o.min,l=o.max,f=o.allowCross,d=e;d<=c&&(d=c),d>=l&&(d=l),!f&&null!=r&&r>0&&d<=i[r-1]&&(d=i[r-1]),!f&&null!=r&&r<i.length-1&&d>=i[r+1]&&(d=i[r+1]);var p=Object.keys(u).map(parseFloat);if(null!==s){var h=Math.round((d-c)/s)*s+c;p.push(h)}var m=p.map(function(e){return Math.abs(d-e)}),y=p[m.indexOf(Math.min.apply(Math,m))];return null!==s?parseFloat(y.toFixed(this.getPrecision(s))):y},t.prototype.render=function(){var e,t=this,n=this.state,r=n.handle,i=n.bounds,u=this.props,c=u.className,l=u.prefixCls,d=u.disabled,p=u.vertical,h=u.dots,m=u.included,y=u.range,v=u.step,b=u.marks,S=u.max,C=u.min,x=u.tipFormatter,w=u.children,P=this.props.handle,T=i.map(function(e){return t.calcOffset(e)}),A=l+"-handle",E=i.map(function(e,t){var n;return f(((n={})[A]=!0,n[A+"-"+(t+1)]=!0,n[A+"-lower"]=0===t,n[A+"-upper"]=t===i.length-1,n))}),k={prefixCls:l,noTip:null===v||null===x,tipFormatter:x,vertical:p};this.handleElements=[];var I=i.map(function(e,n){return o.cloneElement(P,a({},k,{className:E[n],value:e,offset:T[n],dragging:r===n,index:n,key:n,ref:function(e){return t.handleElements.push(e)}}))});y||I.shift();var M=m||y,V=f(((e={})[l]=!0,e[l+"-with-marks"]=Object.keys(b).length,e[l+"-disabled"]=d,e[l+"-vertical"]=this.props.vertical,e[c]=!!c,e));return o.createElement("div",{ref:function(e){return t.sliderElement=e},className:V,onTouchStart:d?s.noop:this.onTouchStart.bind(this),onMouseDown:d?s.noop:this.onMouseDown.bind(this)},o.createElement("div",{className:l+"-rail"}),[],o.createElement(_,{prefixCls:l,vertical:p,marks:b,dots:h,step:v,included:M,lowerBound:i[0],upperBound:i[i.length-1],max:S,min:C}),I,o.createElement(g,{className:l+"-mark",vertical:p,marks:b,included:M,lowerBound:i[0],upperBound:i[i.length-1],max:S,min:C}),w)},t.defaultProps={prefixCls:"msp-slider-base",className:"",min:0,max:100,step:1,marks:{},handle:o.createElement(v,{className:"",vertical:!1,offset:0,tipFormatter:function(e){return e},value:0,index:0}),onBeforeChange:s.noop,onChange:s.noop,onAfterChange:s.noop,tipFormatter:function(e,t){return e},included:!0,disabled:!1,dots:!1,range:!1,vertical:!1,allowCross:!0,pushable:!1},t}(o.Component);t.SliderBase=b;var g=function(e){var t=e.className,n=e.vertical,r=e.marks,i=e.included,u=e.upperBound,s=e.lowerBound,c=e.max,l=e.min,d=Object.keys(r),p=.9*(100/(d.length-1)),h=c-l,m=d.map(parseFloat).sort(function(e,t){return e-t}).map(function(e){var c,d=!i&&e===u||i&&e<=u&&e>=s,m=f(((c={})[t+"-text"]=!0,c[t+"-text-active"]=d,c)),y=n?{marginBottom:"-50%",bottom:(e-l)/h*100+"%"}:{width:p+"%",marginLeft:-p/2+"%",left:(e-l)/h*100+"%"},v=r[e],b="object"==typeof v&&!o.isValidElement(v),g=b?v.label:v,_=b?a({},y,v.style):y;return o.createElement("span",{className:m,style:_,key:e},g)});return o.createElement("div",{className:t},m)};var _=function(e){var t=e.prefixCls,n=e.vertical,r=e.marks,i=e.dots,a=e.step,u=e.included,s=e.lowerBound,c=e.upperBound,l=e.max,d=e.min,p=l-d,h=function(e,t,n,r,i,a){var o=Object.keys(t).map(parseFloat);if(n)for(var u=i;u<=a;u+=r)o.indexOf(u)>=0||o.push(u);return o}(0,r,i,a,d,l).map(function(e){var r,i=Math.abs(e-d)/p*100+"%",a=n?{bottom:i}:{left:i},l=!u&&e===c||u&&e<=c&&e>=s,h=f(((r={})[t+"-dot"]=!0,r[t+"-dot-active"]=l,r));return o.createElement("span",{className:h,style:a,key:e})});return o.createElement("div",{className:t+"-step"},h)}},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var a=n(24),o=n(37),u=n(295),s=n(61),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.render=function(){return a.createElement(a.Fragment,null)},t}(s.PluginUIComponent);t.Controls=c;var l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.render=function(){var e=this;return a.createElement("div",null,a.createElement("button",{className:"msp-btn msp-btn-link",onClick:function(){return o.PluginCommands.State.ApplyAction.dispatch(e.plugin,{state:e.plugin.state.dataState,action:u.UpdateTrajectory.create({action:"advance",by:-1})})},title:"Previou Model"},""),a.createElement("button",{className:"msp-btn msp-btn-link",onClick:function(){return o.PluginCommands.State.ApplyAction.dispatch(e.plugin,{state:e.plugin.state.dataState,action:u.UpdateTrajectory.create({action:"reset"})})},title:"First Model"},""),a.createElement("button",{className:"msp-btn msp-btn-link",onClick:function(){return o.PluginCommands.State.ApplyAction.dispatch(e.plugin,{state:e.plugin.state.dataState,action:u.UpdateTrajectory.create({action:"advance",by:1})})},title:"Next Model"},""),a.createElement("br",null))},t}(s.PluginUIComponent);t.TrajectoryControls=l;var f=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={entries:[]},t}return i(t,e),t.prototype.componentDidMount=function(){var e=this;this.subscribe(this.plugin.events.labels.highlight,function(t){return e.setState({entries:t.entries})})},t.prototype.render=function(){return a.createElement("div",{style:{textAlign:"right"}},this.state.entries.map(function(e,t){return a.createElement("div",{key:""+t},e)}))},t}(s.PluginUIComponent);t.LociLabelControl=f},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),a=this&&this.__assign||function(){return(a=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{s(r.next(e))}catch(e){a(e)}}function u(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,u)}s((r=r.apply(e,t||[])).next())})},u=this&&this.__generator||function(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}};Object.defineProperty(t,"__esModule",{value:!0});var s=n(37),c=n(24),l=n(61),f=n(7),d=n(74),p=n(128),h=n(3),m=n(39),y=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={serverUrl:"https://webchem.ncbr.muni.cz/molstar-state"},t.updateServerUrl=function(e){t.setState({serverUrl:e})},t}return i(t,e),t.prototype.render=function(){return c.createElement("div",null,c.createElement("div",{className:"msp-section-header"},"State Snapshots"),c.createElement(b,{serverUrl:this.state.serverUrl,serverChanged:this.updateServerUrl}),c.createElement(g,null),c.createElement(_,{serverUrl:this.state.serverUrl}))},t}(l.PluginUIComponent);t.StateSnapshots=y;var v=new m.Subject,b=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={name:"",description:"",serverUrl:t.props.serverUrl,isUploading:!1},t.add=function(){s.PluginCommands.State.Snapshots.Add.dispatch(t.plugin,{name:t.state.name,description:t.state.description}),t.setState({name:"",description:""})},t.clear=function(){s.PluginCommands.State.Snapshots.Clear.dispatch(t.plugin,{})},t.upload=function(){return o(t,void 0,void 0,function(){return u(this,function(e){switch(e.label){case 0:return this.setState({isUploading:!0}),[4,s.PluginCommands.State.Snapshots.Upload.dispatch(this.plugin,{name:this.state.name,description:this.state.description,serverUrl:this.state.serverUrl})];case 1:return e.sent(),this.setState({isUploading:!1}),this.plugin.log.message("Snapshot uploaded."),v.next(),[2]}})})},t.download=function(){s.PluginCommands.State.Snapshots.DownloadToFile.dispatch(t.plugin,{name:t.state.name})},t.open=function(e){e.target.files&&e.target.files[0]&&s.PluginCommands.State.Snapshots.OpenFile.dispatch(t.plugin,{file:e.target.files[0]})},t}return i(t,e),t.prototype.shouldComponentUpdate=function(e,t){return!f.shallowEqual(this.props,e)||!f.shallowEqual(this.state,t)},t.prototype.render=function(){var e=this;return c.createElement("div",null,c.createElement(p.ParameterControls,{params:t.Params,values:this.state,onEnter:this.add,onChange:function(t){var n;e.setState(((n={})[t.name]=t.value,n)),"serverUrl"===t.name&&e.props.serverChanged(t.value)}}),c.createElement("div",{className:"msp-btn-row-group"},c.createElement("button",{className:"msp-btn msp-btn-block msp-form-control",onClick:this.add},"Add Local"),c.createElement("button",{className:"msp-btn msp-btn-block msp-form-control",onClick:this.upload,disabled:this.state.isUploading},"Upload"),c.createElement("button",{className:"msp-btn msp-btn-block msp-form-control",onClick:this.clear},"Clear")),c.createElement("div",{className:"msp-btn-row-group"},c.createElement("button",{className:"msp-btn msp-btn-block msp-form-control",onClick:this.download},"Download JSON"),c.createElement("div",{className:"msp-btn msp-btn-block msp-btn-action msp-loader-msp-btn-file"},"Open JSON"," ",c.createElement("input",{onChange:this.open,type:"file",multiple:!1,accept:".json"}))))},t.Params={name:h.ParamDefinition.Text(),description:h.ParamDefinition.Text(),serverUrl:h.ParamDefinition.Text()},t}(l.PluginUIComponent),g=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.componentDidMount=function(){var e=this;this.subscribe(this.plugin.events.state.snapshots.changed,function(){return e.forceUpdate()})},t.prototype.apply=function(e){var t=this;return function(){return s.PluginCommands.State.Snapshots.Apply.dispatch(t.plugin,{id:e})}},t.prototype.remove=function(e){var t=this;return function(){s.PluginCommands.State.Snapshots.Remove.dispatch(t.plugin,{id:e})}},t.prototype.render=function(){var e=this;return c.createElement("ul",{style:{listStyle:"none"},className:"msp-state-list"},this.plugin.state.snapshots.state.entries.valueSeq().map(function(t){return c.createElement("li",{key:t.id},c.createElement("button",{className:"msp-btn msp-btn-block msp-form-control",onClick:e.apply(t.id)},t.name||t.timestamp," ",c.createElement("small",null,t.description)),c.createElement("button",{onClick:e.remove(t.id),className:"msp-btn msp-btn-link msp-state-list-remove-button"},c.createElement("span",{className:"msp-icon msp-icon-remove"})))}))},t}(l.PluginUIComponent),_=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={entries:d.List(),isFetching:!1},t.refresh=function(){return o(t,void 0,void 0,function(){var e,t,n=this;return u(this,function(r){switch(r.label){case 0:return r.trys.push([0,3,,4]),this.setState({isFetching:!0}),[4,fetch(this.props.serverUrl+"/list")];case 1:return[4,r.sent().json()];case 2:return e=r.sent(),this.setState({entries:d.List(e.map(function(e){return a({},e,{url:n.props.serverUrl+"/get/"+e.id,removeUrl:n.props.serverUrl+"/remove/"+e.id})})),isFetching:!1}),[3,4];case 3:return t=r.sent(),this.plugin.log.error("Fetching Remote Snapshots: "+t),this.setState({entries:d.List(),isFetching:!1}),[3,4];case 4:return[2]}})})},t}return i(t,e),t.prototype.componentDidMount=function(){var e=this;this.subscribe(this.plugin.events.state.snapshots.changed,function(){return e.forceUpdate()}),this.refresh(),this.subscribe(v,this.refresh)},t.prototype.fetch=function(e){var t=this;return function(){return s.PluginCommands.State.Snapshots.Fetch.dispatch(t.plugin,{url:e})}},t.prototype.remove=function(e){var t=this;return function(){return o(t,void 0,void 0,function(){return u(this,function(t){switch(t.label){case 0:this.setState({entries:d.List()}),t.label=1;case 1:return t.trys.push([1,3,,4]),[4,fetch(e)];case 2:return t.sent(),[3,4];case 3:return t.sent(),[3,4];case 4:return this.refresh(),[2]}})})}},t.prototype.render=function(){var e=this;return c.createElement("div",null,c.createElement("button",{title:"Click to Refresh",style:{fontWeight:"bold"},className:"msp-btn msp-btn-block msp-form-control msp-section-header",onClick:this.refresh,disabled:this.state.isFetching}," Remote Snapshots"),c.createElement("ul",{style:{listStyle:"none"},className:"msp-state-list"},this.state.entries.valueSeq().map(function(t){return c.createElement("li",{key:t.id},c.createElement("button",{className:"msp-btn msp-btn-block msp-form-control",onClick:e.fetch(t.url)},t.name||t.timestamp," ",c.createElement("small",null,t.description)),c.createElement("button",{onClick:e.remove(t.removeUrl),className:"msp-btn msp-btn-link msp-state-list-remove-button"},c.createElement("span",{className:"msp-icon msp-icon-remove"})))})))},t}(l.PluginUIComponent)},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var a=n(37),o=n(159),u=n(297),s=n(3),c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._getInfo=o.memoizeLatest(function(e,n){return u.StateTransformParameters.infoFromAction(t.plugin,t.props.state,t.props.action,t.props.nodeRef)}),t.state={ref:t.props.nodeRef,version:t.props.state.transforms.get(t.props.nodeRef).version,error:void 0,isInitial:!0,params:t.getInfo().initialValues,busy:!1},t}return i(t,e),t.prototype.applyAction=function(){return a.PluginCommands.State.ApplyAction.dispatch(this.plugin,{state:this.props.state,action:this.props.action.create(this.state.params),ref:this.props.nodeRef})},t.prototype.getInfo=function(){return this._getInfo(this.props.nodeRef,this.props.state.transforms.get(this.props.nodeRef).version)},t.prototype.getTransformerId=function(){return this.props.state.transforms.get(this.props.nodeRef).transformer.id},t.prototype.getHeader=function(){return this.props.action.definition.display},t.prototype.canApply=function(){return!this.state.error&&!this.state.busy},t.prototype.canAutoApply=function(){return!1},t.prototype.applyText=function(){return"Apply"},t.prototype.isUpdate=function(){return!1},t.getDerivedStateFromProps=function(e,t){if(e.nodeRef===t.ref)return null;var n=e.state.transforms.get(e.nodeRef).version;if(n===t.version)return null;var r=e.state.cells.get(e.nodeRef).obj,i=e.action.definition.params?s.ParamDefinition.getDefaultValues(e.action.definition.params(r,e.plugin)):{};return{ref:e.nodeRef,version:n,params:i,isInitial:!0,error:void 0}},t}(u.TransformContolBase);t.ApplyActionContol=c},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var a=n(24),o=n(61),u=n(128),s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.updateParams=function(e){var n;t.plugin.state.animation.updateParams(((n={})[e.name]=e.value,n))},t.updateCurrentParams=function(e){var n;t.plugin.state.animation.updateCurrentParams(((n={})[e.name]=e.value,n))},t.startOrStop=function(){var e=t.plugin.state.animation;"playing"===e.state.animationState?e.stop():e.start()},t}return i(t,e),t.prototype.componentDidMount=function(){var e=this;this.subscribe(this.plugin.state.animation.events.updated,function(){return e.forceUpdate()})},t.prototype.render=function(){var e=this.plugin.state.animation;if(e.isEmpty)return null;var t="playing"===e.state.animationState;return a.createElement("div",{className:"msp-animation-section"},a.createElement("div",{className:"msp-section-header"},"Animations"),a.createElement(u.ParameterControls,{params:e.getParams(),values:e.state.params,onChange:this.updateParams,isDisabled:t}),a.createElement(u.ParameterControls,{params:e.current.params,values:e.current.paramValues,onChange:this.updateCurrentParams,isDisabled:t}),a.createElement("div",{className:"msp-btn-row-group"},a.createElement("button",{className:"msp-btn msp-btn-block msp-form-control",onClick:this.startOrStop},"playing"===e.state.animationState?"Stop":"Start")))},t}(o.PluginUIComponent);t.AnimationControls=s},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),a=this&&this.__assign||function(){return(a=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var o=n(24),u=n(27),s=n(37),c=n(61),l=n(555),f=n(296),d=n(39),p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={showActions:!0},t}return i(t,e),t.prototype.componentDidMount=function(){var e=this;this.subscribe(this.plugin.events.state.cell.created,function(t){t.cell.transform.parent===u.StateTransform.RootRef&&e.forceUpdate()}),this.subscribe(this.plugin.events.state.cell.removed,function(t){t.parent===u.StateTransform.RootRef&&e.forceUpdate()})},t.getDerivedStateFromProps=function(e,t){var n=e.state.tree.root.ref,r=0===e.state.tree.children.get(n).size;return t.showActions===r?null:{showActions:r}},t.prototype.render=function(){var e=this.props.state.tree.root.ref;return this.state.showActions?o.createElement(f.StateObjectActions,{state:this.props.state,nodeRef:e}):o.createElement(h,{state:this.props.state,nodeRef:e,depth:0})},t}(c.PluginUIComponent);t.StateTree=p;var h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={isCollapsed:t.props.state.cellStates.get(t.props.nodeRef).isCollapsed,state:t.props.state},t}return i(t,e),t.prototype.is=function(e){return e.ref===this.props.nodeRef&&e.state===this.props.state},Object.defineProperty(t.prototype,"cellState",{get:function(){return this.props.state.cellStates.get(this.props.nodeRef)},enumerable:!0,configurable:!0}),t.prototype.componentDidMount=function(){var e=this;this.subscribe(this.plugin.events.state.cell.stateUpdated,function(t){e.is(t)&&t.state.transforms.has(e.props.nodeRef)&&e.setState({isCollapsed:t.cellState.isCollapsed})}),this.subscribe(this.plugin.events.state.cell.created,function(t){e.props.state===t.state&&e.props.nodeRef===t.cell.transform.parent&&e.forceUpdate()}),this.subscribe(this.plugin.events.state.cell.removed,function(t){e.props.state===t.state&&e.props.nodeRef===t.parent&&e.forceUpdate()})},t.getDerivedStateFromProps=function(e,t){return e.state===t.state?null:{isCollapsed:e.state.cellStates.get(e.nodeRef).isCollapsed,state:e.state}},t.prototype.render=function(){var e=this,n=this.props.state.cells.get(this.props.nodeRef);if(n.obj===u.StateObject.Null)return null;var r=this.cellState,i="ok"!==n.status||!n.transform.props||!n.transform.props.isGhost,a=this.props.state.tree.children.get(this.props.nodeRef),s=i?this.props.depth+1:this.props.depth;return i?o.createElement(o.Fragment,null,o.createElement(m,{nodeRef:this.props.nodeRef,state:this.props.state,depth:this.props.depth}),0===a.size?void 0:o.createElement("div",{style:{display:r.isCollapsed?"none":"block"}},a.map(function(n){return o.createElement(t,{state:e.props.state,nodeRef:n,key:n,depth:s})}))):0===a.size?null:o.createElement("div",{style:{display:r.isCollapsed?"none":"block"}},a.map(function(n){return o.createElement(t,{state:e.props.state,nodeRef:n,key:n,depth:s})}))},t}(c.PluginUIComponent),m=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={isCurrent:t.props.state.current===t.props.nodeRef,isCollapsed:t.props.state.cellStates.get(t.props.nodeRef).isCollapsed,state:t.props.state,updaterCollapsed:!0},t.setCurrent=function(e){e.preventDefault(),e.currentTarget.blur(),s.PluginCommands.State.SetCurrentObject.dispatch(t.plugin,{state:t.props.state,ref:t.props.nodeRef})},t.remove=function(e){e.preventDefault(),s.PluginCommands.State.RemoveObject.dispatch(t.plugin,{state:t.props.state,ref:t.props.nodeRef,removeParentGhosts:!0})},t.toggleVisible=function(e){e.preventDefault(),s.PluginCommands.State.ToggleVisibility.dispatch(t.plugin,{state:t.props.state,ref:t.props.nodeRef}),e.currentTarget.blur()},t.toggleExpanded=function(e){e.preventDefault(),s.PluginCommands.State.ToggleExpanded.dispatch(t.plugin,{state:t.props.state,ref:t.props.nodeRef}),e.currentTarget.blur()},t.highlight=function(e){e.preventDefault(),s.PluginCommands.State.Highlight.dispatch(t.plugin,{state:t.props.state,ref:t.props.nodeRef}),e.currentTarget.blur()},t.clearHighlight=function(e){e.preventDefault(),s.PluginCommands.State.ClearHighlight.dispatch(t.plugin,{state:t.props.state,ref:t.props.nodeRef}),e.currentTarget.blur()},t.toggleUpdaterObs=new d.Subject,t.toggleUpdater=function(e){e.preventDefault(),e.currentTarget.blur(),t.toggleUpdaterObs.next()},t}return i(t,e),t.prototype.is=function(e){return e.ref===this.props.nodeRef&&e.state===this.props.state},t.prototype.componentDidMount=function(){var e=this;this.subscribe(this.plugin.events.state.cell.stateUpdated,function(t){e.is(t)&&e.forceUpdate()}),this.subscribe(this.plugin.state.behavior.currentObject,function(t){e.is(t)?t.state.transforms.has(e.props.nodeRef)&&e.setState({isCurrent:e.props.state.current===e.props.nodeRef,isCollapsed:e.props.state.cellStates.get(e.props.nodeRef).isCollapsed}):e.state.isCurrent&&t.state.transforms.has(e.props.nodeRef)&&e.setState({isCurrent:e.props.state.current===e.props.nodeRef})})},t.getDerivedStateFromProps=function(e,t){return e.state===t.state?null:{isCurrent:e.state.current===e.nodeRef,isCollapsed:e.state.cellStates.get(e.nodeRef).isCollapsed,state:e.state,updaterCollapsed:!0}},t.prototype.render=function(){var e,t=this.props.state.transforms.get(this.props.nodeRef),n=this.props.state.cells.get(this.props.nodeRef),r=this.is(this.props.state.behaviors.currentObject.value);if("pending"===n.status||"processing"===n.status){var i=t.transformer.definition.display.name;e=o.createElement(o.Fragment,null,o.createElement("b",null,"[",n.status,"]")," ",o.createElement("span",{title:i},i))}else if("ok"===n.status&&n.obj){var u=n.obj;c=u.label+" "+(u.description?u.description:"");e=this.state.isCurrent?o.createElement(o.Fragment,null,o.createElement("a",{title:c,href:"#",onClick:this.toggleUpdater},o.createElement("b",null,u.label)," ",u.description?o.createElement("small",null,u.description):void 0)):o.createElement(o.Fragment,null,o.createElement("a",{title:c,href:"#",onClick:this.setCurrent},u.label," ",u.description?o.createElement("small",null,u.description):void 0))}else{var s=t.transformer.definition.display.name,c=""+n.errorText;e=o.createElement(o.Fragment,null,o.createElement("b",null,"[",n.status,"]")," ",o.createElement("a",{title:c,href:"#",onClick:this.setCurrent},s),": ",o.createElement("i",null,n.errorText))}var l=this.props.state.tree.children.get(this.props.nodeRef),f=this.props.state.cellStates.get(this.props.nodeRef),d=o.createElement("button",{onClick:this.toggleVisible,className:"msp-btn msp-btn-link msp-tree-visibility"+(f.isHidden?" msp-tree-visibility-hidden":"")},o.createElement("span",{className:"msp-icon msp-icon-visual-visibility"})),p={marginLeft:this.state.isCurrent?void 0:10*this.props.depth+"px",borderLeft:r||0===this.props.depth?"none":void 0},h=o.createElement("div",{className:"msp-tree-row"+(r?" msp-tree-row-current":""),onMouseEnter:this.highlight,onMouseLeave:this.clearHighlight,style:p},e,l.size>0&&o.createElement("button",{onClick:this.toggleExpanded,className:"msp-btn msp-btn-link msp-tree-toggle-exp-button"},o.createElement("span",{className:"msp-icon msp-icon-"+(f.isCollapsed?"expand":"collapse")})),!n.transform.props.isLocked&&o.createElement("button",{onClick:this.remove,className:"msp-btn msp-btn-link msp-tree-remove-button"},o.createElement("span",{className:"msp-icon msp-icon-remove"})),d);return this.state.isCurrent?o.createElement(o.Fragment,null,h,o.createElement(y,a({},this.props,{toggleCollapsed:this.toggleUpdaterObs}))):h},t}(c.PluginUIComponent),y=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.componentDidMount=function(){},t.prototype.render=function(){var e=this.props.nodeRef,t=this.props.state.cells.get(e),n=t.sourceRef&&this.props.state.cells.get(t.sourceRef)||void 0;if(!n||"ok"!==n.status)return null;var r=t.transform;return o.createElement(l.UpdateTransformContol,{state:this.props.state,transform:r,initiallyCollapsed:!0,toggleCollapsed:this.props.toggleCollapsed})},t}(c.PluginUIComponent)},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var a=n(159),o=n(297),u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._getInfo=a.memoizeLatest(function(e){return o.StateTransformParameters.infoFromTransform(t.plugin,t.props.state,e)}),t.state={transform:t.props.transform,error:void 0,isInitial:!0,params:t.getInfo().initialValues,busy:!1,isCollapsed:t.props.initiallyCollapsed},t}return i(t,e),t.prototype.applyAction=function(){return this.plugin.updateTransform(this.props.state,this.props.transform.ref,this.state.params)},t.prototype.getInfo=function(){return this._getInfo(this.props.transform)},t.prototype.getTransformerId=function(){return this.props.transform.transformer.id},t.prototype.getHeader=function(){return this.props.transform.transformer.definition.display},t.prototype.canApply=function(){return!this.state.error&&!this.state.busy&&!this.state.isInitial},t.prototype.applyText=function(){return this.canApply()?"Update":"Nothing to Update"},t.prototype.isUpdate=function(){return!0},t.prototype.canAutoApply=function(e){var t=this.props.transform.transformer.definition.canAutoUpdate;if(!t)return!1;var n=this.props.state,r=n.cells.get(this.props.transform.ref);if(!r||!r.sourceRef||"ok"!==r.status)return!1;var i=n.cells.get(r.sourceRef);return t({a:r.obj,b:i.obj,oldParams:this.getInfo().initialValues,newParams:e},this.plugin)},t.prototype.componentDidMount=function(){var t=this;e.prototype.componentDidMount&&e.prototype.componentDidMount.call(this),this.props.toggleCollapsed&&this.subscribe(this.props.toggleCollapsed,function(){return t.setState({isCollapsed:!t.state.isCollapsed})}),this.subscribe(this.plugin.events.state.object.updated,function(e){var n=e.ref,r=e.state;t.props.transform.ref===n&&t.props.state===r&&t.state.params!==t.props.transform.params&&(t._getInfo=a.memoizeLatest(function(e){return o.StateTransformParameters.infoFromTransform(t.plugin,t.props.state,e)}),t.setState({params:t.props.transform.params,isInitial:!0}))})},t.getDerivedStateFromProps=function(e,t){if(e.transform===t.transform)return null;var n=e.state.cells.get(e.transform.ref);return{transform:e.transform,params:n.params&&n.params.values||{},isInitial:!0,error:void 0}},t}(o.TransformContolBase);t.UpdateTransformContol=u},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var a=n(24),o=n(61),u=n(74),s=n(569),c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={tracked:u.OrderedMap()},t}return i(t,e),t.prototype.componentDidMount=function(){var e=this;this.subscribe(this.plugin.events.task.progress.pipe(s.filter(function(e){return"none"!==e.level})),function(t){e.setState({tracked:e.state.tracked.set(t.id,t)})}),this.subscribe(this.plugin.events.task.finished,function(t){var n=t.id;e.setState({tracked:e.state.tracked.delete(n)})})},t.prototype.render=function(){return a.createElement("div",null,this.state.tracked.valueSeq().map(function(e){return a.createElement(l,{key:e.id,event:e})}))},t}(o.PluginUIComponent);t.BackgroundTaskProgress=c;var l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.render=function(){var e=this.props.event.progress.root,t=function e(t){if(0===t.children.length)return 1;var n=0;for(var r=0,i=t.children;r<i.length;r++){var a=i[r];n+=e(a)}return n}(this.props.event.progress.root)-1,n=e.progress.isIndeterminate?void 0:a.createElement(a.Fragment,null,"[",e.progress.current,"/",e.progress.max,"]"),r=t>0?a.createElement(a.Fragment,null,"[",t," subtask(s)]"):void 0;return a.createElement("div",null,e.progress.message," ",n," ",r)},t}(o.PluginUIComponent)},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var a=n(24),o=n(558),u=n(61),s=n(37),c=n(128),l=n(217),f=n(284),d=n(216),p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={isSettingsExpanded:!1},t.resetCamera=function(){s.PluginCommands.Camera.Reset.dispatch(t.plugin,{})},t.toggleSettingsExpanded=function(e){t.setState({isSettingsExpanded:!t.state.isSettingsExpanded}),e.currentTarget.blur()},t.toggleControls=function(){s.PluginCommands.Layout.Update.dispatch(t.plugin,{state:{showControls:!t.plugin.layout.state.showControls}})},t.toggleExpanded=function(){s.PluginCommands.Layout.Update.dispatch(t.plugin,{state:{isExpanded:!t.plugin.layout.state.isExpanded}})},t.setSettings=function(e){var n;s.PluginCommands.Canvas3D.SetSettings.dispatch(t.plugin,{settings:(n={},n[e.name]=e.value,n)})},t.setLayout=function(e){var n;s.PluginCommands.Layout.Update.dispatch(t.plugin,{state:(n={},n[e.name]=e.value,n)})},t}return i(t,e),t.prototype.componentDidMount=function(){var e=this;this.subscribe(this.plugin.events.canvad3d.settingsUpdated,function(t){e.forceUpdate()}),this.subscribe(this.plugin.layout.events.updated,function(){e.forceUpdate()})},t.prototype.icon=function(e,t,n,r){return void 0===r&&(r=!0),a.createElement("button",{className:"msp-btn msp-btn-link msp-btn-link-toggle-"+(r?"on":"off"),onClick:t,title:n},a.createElement("span",{className:"msp-icon msp-icon-"+e}))},t.prototype.render=function(){return a.createElement("div",{className:"msp-viewport-controls"},a.createElement("div",{className:"msp-viewport-controls-buttons"},this.icon("tools",this.toggleControls,"Toggle Controls",this.plugin.layout.state.showControls),this.icon("expand-layout",this.toggleExpanded,"Toggle Expanded",this.plugin.layout.state.isExpanded),this.icon("settings",this.toggleSettingsExpanded,"Settings",this.state.isSettingsExpanded),this.icon("reset-scene",this.resetCamera,"Reset Camera")),this.state.isSettingsExpanded&&a.createElement("div",{className:"msp-viewport-controls-scene-options"},a.createElement(d.ControlGroup,{header:"Layout",initialExpanded:!0},a.createElement(c.ParameterControls,{params:f.PluginLayoutStateParams,values:this.plugin.layout.state,onChange:this.setLayout})),a.createElement(d.ControlGroup,{header:"Viewport",initialExpanded:!0},a.createElement(c.ParameterControls,{params:l.Canvas3DParams,values:this.plugin.canvas3d.props,onChange:this.setSettings}))))},t}(u.PluginUIComponent);t.ViewportControls=p;var h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.container=a.createRef(),t.canvas=a.createRef(),t.state={noWebGl:!1},t.handleResize=function(){t.plugin.canvas3d.handleResize()},t}return i(t,e),t.prototype.componentDidMount=function(){var e=this;this.canvas.current&&this.container.current&&this.plugin.initViewer(this.canvas.current,this.container.current)||this.setState({noWebGl:!0}),this.handleResize();var t=this.plugin.canvas3d;this.subscribe(t.input.resize,this.handleResize);var n=new o.Canvas3dIdentifyHelper(this.plugin,15);this.subscribe(t.input.move,function(e){var t=e.x,r=e.y,i=e.inside,a=e.buttons;i&&!a&&n.move(t,r)}),this.subscribe(t.input.leave,function(){n.leave()}),this.subscribe(t.input.click,function(e){var t=e.x,r=e.y;1===e.buttons&&n.select(t,r)}),this.subscribe(this.plugin.layout.events.updated,function(){setTimeout(e.handleResize,50)})},t.prototype.componentWillUnmount=function(){e.prototype.componentWillUnmount&&e.prototype.componentWillUnmount.call(this)},t.prototype.renderMissing=function(){return a.createElement("div",null,a.createElement("div",null,a.createElement("p",null,a.createElement("b",null,"WebGL does not seem to be available.")),a.createElement("p",null,"This can be caused by an outdated browser, graphics card driver issue, or bad weather. Sometimes, just restarting the browser helps."),a.createElement("p",null,"For a list of supported browsers, refer to ",a.createElement("a",{href:"http://caniuse.com/#feat=webgl",target:"_blank"},"http://caniuse.com/#feat=webgl"),".")))},t.prototype.render=function(){return this.state.noWebGl?this.renderMissing():a.createElement("div",{className:"msp-viewport"},a.createElement("div",{className:"msp-viewport-host3d",ref:this.container},a.createElement("canvas",{ref:this.canvas})))},t}(u.PluginUIComponent);t.Viewport=h},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{s(r.next(e))}catch(e){a(e)}}function u(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,u)}s((r=r.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}};Object.defineProperty(t,"__esModule",{value:!0});var a=n(16),o=function(){function e(e,t){void 0===t&&(t=15);var n=this;this.ctx=e,this.maxFps=t,this.cX=-1,this.cY=-1,this.lastX=-1,this.lastY=-1,this.id=void 0,this.currentIdentifyT=0,this.prevLoci={loci:a.EmptyLoci},this.prevT=0,this.inside=!1,this.animate=function(e){!n.ctx.state.animation.isAnimating&&n.inside&&e-n.prevT>1e3/n.maxFps&&(n.prevT=e,n.currentIdentifyT=e,n.identify(!1,e)),requestAnimationFrame(n.animate)},this.animate(0)}return e.prototype.identify=function(e,t){return r(this,void 0,void 0,function(){var n,r;return i(this,function(i){switch(i.label){case 0:return this.lastX===this.cX||this.lastY===this.cY?[3,2]:(n=this,[4,this.ctx.canvas3d.identify(this.cX,this.cY)]);case 1:n.id=i.sent(),this.lastX=this.cX,this.lastY=this.cY,i.label=2;case 2:return this.id?e?(this.ctx.behaviors.canvas.selectLoci.next(this.ctx.canvas3d.getLoci(this.id)),[2]):this.inside&&this.currentIdentifyT===t?((r=this.ctx.canvas3d.getLoci(this.id)).repr===this.prevLoci.repr&&a.Loci.areEqual(r.loci,this.prevLoci.loci)||(this.ctx.behaviors.canvas.highlightLoci.next(r),this.prevLoci=r),[2]):[2]:[2]}})})},e.prototype.leave=function(){this.inside=!1,this.prevLoci.loci!==a.EmptyLoci&&(this.prevLoci={loci:a.EmptyLoci},this.ctx.behaviors.canvas.highlightLoci.next(this.prevLoci),this.ctx.canvas3d.requestDraw(!0))},e.prototype.move=function(e,t){this.inside=!0,this.cX=e,this.cY=t},e.prototype.select=function(e,t){this.cX=e,this.cY=t,this.identify(!0,0)},e}();t.Canvas3dIdentifyHelper=o},function(e,t,n){"use strict";!function e(){if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(e){console.error(e)}}(),e.exports=n(560)},function(e,t,n){"use strict";
/** @license React v16.8.2
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var r=n(24),i=n(294),a=n(561);function o(e){for(var t=arguments.length-1,n="https://reactjs.org/docs/error-decoder.html?invariant="+e,r=0;r<t;r++)n+="&args[]="+encodeURIComponent(arguments[r+1]);!function(e,t,n,r,i,a,o,u){if(!e){if(e=void 0,void 0===t)e=Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var s=[n,r,i,a,o,u],c=0;(e=Error(t.replace(/%s/g,function(){return s[c++]}))).name="Invariant Violation"}throw e.framesToPop=1,e}}(!1,"Minified React error #"+e+"; visit %s for the full message or use the non-minified dev environment for full errors and additional helpful warnings. ",n)}r||o("227");var u=!1,s=null,c=!1,l=null,f={onError:function(e){u=!0,s=e}};function d(e,t,n,r,i,a,o,c,l){u=!1,s=null,function(e,t,n,r,i,a,o,u,s){var c=Array.prototype.slice.call(arguments,3);try{t.apply(n,c)}catch(e){this.onError(e)}}.apply(f,arguments)}var p=null,h={};function m(){if(p)for(var e in h){var t=h[e],n=p.indexOf(e);if(-1<n||o("96",e),!v[n])for(var r in t.extractEvents||o("97",e),v[n]=t,n=t.eventTypes){var i=void 0,a=n[r],u=t,s=r;b.hasOwnProperty(s)&&o("99",s),b[s]=a;var c=a.phasedRegistrationNames;if(c){for(i in c)c.hasOwnProperty(i)&&y(c[i],u,s);i=!0}else a.registrationName?(y(a.registrationName,u,s),i=!0):i=!1;i||o("98",r,e)}}}function y(e,t,n){g[e]&&o("100",e),g[e]=t,_[e]=t.eventTypes[n].dependencies}var v=[],b={},g={},_={},S=null,C=null,x=null;function w(e,t,n){var r=e.type||"unknown-event";e.currentTarget=x(n),function(e,t,n,r,i,a,f,p,h){if(d.apply(this,arguments),u){if(u){var m=s;u=!1,s=null}else o("198"),m=void 0;c||(c=!0,l=m)}}(r,t,void 0,e),e.currentTarget=null}function P(e,t){return null==t&&o("30"),null==e?t:Array.isArray(e)?Array.isArray(t)?(e.push.apply(e,t),e):(e.push(t),e):Array.isArray(t)?[e].concat(t):[e,t]}function T(e,t,n){Array.isArray(e)?e.forEach(t,n):e&&t.call(n,e)}var A=null;function E(e){if(e){var t=e._dispatchListeners,n=e._dispatchInstances;if(Array.isArray(t))for(var r=0;r<t.length&&!e.isPropagationStopped();r++)w(e,t[r],n[r]);else t&&w(e,t,n);e._dispatchListeners=null,e._dispatchInstances=null,e.isPersistent()||e.constructor.release(e)}}var k={injectEventPluginOrder:function(e){p&&o("101"),p=Array.prototype.slice.call(e),m()},injectEventPluginsByName:function(e){var t,n=!1;for(t in e)if(e.hasOwnProperty(t)){var r=e[t];h.hasOwnProperty(t)&&h[t]===r||(h[t]&&o("102",t),h[t]=r,n=!0)}n&&m()}};function I(e,t){var n=e.stateNode;if(!n)return null;var r=S(n);if(!r)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":(r=!r.disabled)||(r=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!r;break e;default:e=!1}return e?null:(n&&"function"!=typeof n&&o("231",t,typeof n),n)}function M(e){if(null!==e&&(A=P(A,e)),e=A,A=null,e&&(T(e,E),A&&o("95"),c))throw e=l,c=!1,l=null,e}var V=Math.random().toString(36).slice(2),O="__reactInternalInstance$"+V,D="__reactEventHandlers$"+V;function R(e){if(e[O])return e[O];for(;!e[O];){if(!e.parentNode)return null;e=e.parentNode}return 5===(e=e[O]).tag||6===e.tag?e:null}function j(e){return!(e=e[O])||5!==e.tag&&6!==e.tag?null:e}function N(e){if(5===e.tag||6===e.tag)return e.stateNode;o("33")}function B(e){return e[D]||null}function F(e){do{e=e.return}while(e&&5!==e.tag);return e||null}function L(e,t,n){(t=I(e,n.dispatchConfig.phasedRegistrationNames[t]))&&(n._dispatchListeners=P(n._dispatchListeners,t),n._dispatchInstances=P(n._dispatchInstances,e))}function z(e){if(e&&e.dispatchConfig.phasedRegistrationNames){for(var t=e._targetInst,n=[];t;)n.push(t),t=F(t);for(t=n.length;0<t--;)L(n[t],"captured",e);for(t=0;t<n.length;t++)L(n[t],"bubbled",e)}}function U(e,t,n){e&&n&&n.dispatchConfig.registrationName&&(t=I(e,n.dispatchConfig.registrationName))&&(n._dispatchListeners=P(n._dispatchListeners,t),n._dispatchInstances=P(n._dispatchInstances,e))}function G(e){e&&e.dispatchConfig.registrationName&&U(e._targetInst,null,e)}function q(e){T(e,z)}var H=!("undefined"==typeof window||!window.document||!window.document.createElement);function W(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var Y={animationend:W("Animation","AnimationEnd"),animationiteration:W("Animation","AnimationIteration"),animationstart:W("Animation","AnimationStart"),transitionend:W("Transition","TransitionEnd")},K={},X={};function Q(e){if(K[e])return K[e];if(!Y[e])return e;var t,n=Y[e];for(t in n)if(n.hasOwnProperty(t)&&t in X)return K[e]=n[t];return e}H&&(X=document.createElement("div").style,"AnimationEvent"in window||(delete Y.animationend.animation,delete Y.animationiteration.animation,delete Y.animationstart.animation),"TransitionEvent"in window||delete Y.transitionend.transition);var Z=Q("animationend"),J=Q("animationiteration"),$=Q("animationstart"),ee=Q("transitionend"),te="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),ne=null,re=null,ie=null;function ae(){if(ie)return ie;var e,t,n=re,r=n.length,i="value"in ne?ne.value:ne.textContent,a=i.length;for(e=0;e<r&&n[e]===i[e];e++);var o=r-e;for(t=1;t<=o&&n[r-t]===i[a-t];t++);return ie=i.slice(e,1<t?1-t:void 0)}function oe(){return!0}function ue(){return!1}function se(e,t,n,r){for(var i in this.dispatchConfig=e,this._targetInst=t,this.nativeEvent=n,e=this.constructor.Interface)e.hasOwnProperty(i)&&((t=e[i])?this[i]=t(n):"target"===i?this.target=r:this[i]=n[i]);return this.isDefaultPrevented=(null!=n.defaultPrevented?n.defaultPrevented:!1===n.returnValue)?oe:ue,this.isPropagationStopped=ue,this}function ce(e,t,n,r){if(this.eventPool.length){var i=this.eventPool.pop();return this.call(i,e,t,n,r),i}return new this(e,t,n,r)}function le(e){e instanceof this||o("279"),e.destructor(),10>this.eventPool.length&&this.eventPool.push(e)}function fe(e){e.eventPool=[],e.getPooled=ce,e.release=le}i(se.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!=typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=oe)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!=typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=oe)},persist:function(){this.isPersistent=oe},isPersistent:ue,destructor:function(){var e,t=this.constructor.Interface;for(e in t)this[e]=null;this.nativeEvent=this._targetInst=this.dispatchConfig=null,this.isPropagationStopped=this.isDefaultPrevented=ue,this._dispatchInstances=this._dispatchListeners=null}}),se.Interface={type:null,target:null,currentTarget:function(){return null},eventPhase:null,bubbles:null,cancelable:null,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:null,isTrusted:null},se.extend=function(e){function t(){}function n(){return r.apply(this,arguments)}var r=this;t.prototype=r.prototype;var a=new t;return i(a,n.prototype),n.prototype=a,n.prototype.constructor=n,n.Interface=i({},r.Interface,e),n.extend=r.extend,fe(n),n},fe(se);var de=se.extend({data:null}),pe=se.extend({data:null}),he=[9,13,27,32],me=H&&"CompositionEvent"in window,ye=null;H&&"documentMode"in document&&(ye=document.documentMode);var ve=H&&"TextEvent"in window&&!ye,be=H&&(!me||ye&&8<ye&&11>=ye),ge=String.fromCharCode(32),_e={beforeInput:{phasedRegistrationNames:{bubbled:"onBeforeInput",captured:"onBeforeInputCapture"},dependencies:["compositionend","keypress","textInput","paste"]},compositionEnd:{phasedRegistrationNames:{bubbled:"onCompositionEnd",captured:"onCompositionEndCapture"},dependencies:"blur compositionend keydown keypress keyup mousedown".split(" ")},compositionStart:{phasedRegistrationNames:{bubbled:"onCompositionStart",captured:"onCompositionStartCapture"},dependencies:"blur compositionstart keydown keypress keyup mousedown".split(" ")},compositionUpdate:{phasedRegistrationNames:{bubbled:"onCompositionUpdate",captured:"onCompositionUpdateCapture"},dependencies:"blur compositionupdate keydown keypress keyup mousedown".split(" ")}},Se=!1;function Ce(e,t){switch(e){case"keyup":return-1!==he.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"blur":return!0;default:return!1}}function xe(e){return"object"==typeof(e=e.detail)&&"data"in e?e.data:null}var we=!1;var Pe={eventTypes:_e,extractEvents:function(e,t,n,r){var i=void 0,a=void 0;if(me)e:{switch(e){case"compositionstart":i=_e.compositionStart;break e;case"compositionend":i=_e.compositionEnd;break e;case"compositionupdate":i=_e.compositionUpdate;break e}i=void 0}else we?Ce(e,n)&&(i=_e.compositionEnd):"keydown"===e&&229===n.keyCode&&(i=_e.compositionStart);return i?(be&&"ko"!==n.locale&&(we||i!==_e.compositionStart?i===_e.compositionEnd&&we&&(a=ae()):(re="value"in(ne=r)?ne.value:ne.textContent,we=!0)),i=de.getPooled(i,t,n,r),a?i.data=a:null!==(a=xe(n))&&(i.data=a),q(i),a=i):a=null,(e=ve?function(e,t){switch(e){case"compositionend":return xe(t);case"keypress":return 32!==t.which?null:(Se=!0,ge);case"textInput":return(e=t.data)===ge&&Se?null:e;default:return null}}(e,n):function(e,t){if(we)return"compositionend"===e||!me&&Ce(e,t)?(e=ae(),ie=re=ne=null,we=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return be&&"ko"!==t.locale?null:t.data;default:return null}}(e,n))?((t=pe.getPooled(_e.beforeInput,t,n,r)).data=e,q(t)):t=null,null===a?t:null===t?a:[a,t]}},Te=null,Ae=null,Ee=null;function ke(e){if(e=C(e)){"function"!=typeof Te&&o("280");var t=S(e.stateNode);Te(e.stateNode,e.type,t)}}function Ie(e){Ae?Ee?Ee.push(e):Ee=[e]:Ae=e}function Me(){if(Ae){var e=Ae,t=Ee;if(Ee=Ae=null,ke(e),t)for(e=0;e<t.length;e++)ke(t[e])}}function Ve(e,t){return e(t)}function Oe(e,t,n){return e(t,n)}function De(){}var Re=!1;function je(e,t){if(Re)return e(t);Re=!0;try{return Ve(e,t)}finally{Re=!1,(null!==Ae||null!==Ee)&&(De(),Me())}}var Ne={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Be(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Ne[e.type]:"textarea"===t}function Fe(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}function Le(e){if(!H)return!1;var t=(e="on"+e)in document;return t||((t=document.createElement("div")).setAttribute(e,"return;"),t="function"==typeof t[e]),t}function ze(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function Ue(e){e._valueTracker||(e._valueTracker=function(e){var t=ze(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&void 0!==n&&"function"==typeof n.get&&"function"==typeof n.set){var i=n.get,a=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return i.call(this)},set:function(e){r=""+e,a.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(e){r=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function Ge(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=ze(e)?e.checked?"true":"false":e.value),(e=r)!==n&&(t.setValue(e),!0)}var qe=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;qe.hasOwnProperty("ReactCurrentDispatcher")||(qe.ReactCurrentDispatcher={current:null});var He=/^(.*)[\\\/]/,We="function"==typeof Symbol&&Symbol.for,Ye=We?Symbol.for("react.element"):60103,Ke=We?Symbol.for("react.portal"):60106,Xe=We?Symbol.for("react.fragment"):60107,Qe=We?Symbol.for("react.strict_mode"):60108,Ze=We?Symbol.for("react.profiler"):60114,Je=We?Symbol.for("react.provider"):60109,$e=We?Symbol.for("react.context"):60110,et=We?Symbol.for("react.concurrent_mode"):60111,tt=We?Symbol.for("react.forward_ref"):60112,nt=We?Symbol.for("react.suspense"):60113,rt=We?Symbol.for("react.memo"):60115,it=We?Symbol.for("react.lazy"):60116,at="function"==typeof Symbol&&Symbol.iterator;function ot(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=at&&e[at]||e["@@iterator"])?e:null}function ut(e){if(null==e)return null;if("function"==typeof e)return e.displayName||e.name||null;if("string"==typeof e)return e;switch(e){case et:return"ConcurrentMode";case Xe:return"Fragment";case Ke:return"Portal";case Ze:return"Profiler";case Qe:return"StrictMode";case nt:return"Suspense"}if("object"==typeof e)switch(e.$$typeof){case $e:return"Context.Consumer";case Je:return"Context.Provider";case tt:var t=e.render;return t=t.displayName||t.name||"",e.displayName||(""!==t?"ForwardRef("+t+")":"ForwardRef");case rt:return ut(e.type);case it:if(e=1===e._status?e._result:null)return ut(e)}return null}function st(e){var t="";do{e:switch(e.tag){case 3:case 4:case 6:case 7:case 10:case 9:var n="";break e;default:var r=e._debugOwner,i=e._debugSource,a=ut(e.type);n=null,r&&(n=ut(r.type)),r=a,a="",i?a=" (at "+i.fileName.replace(He,"")+":"+i.lineNumber+")":n&&(a=" (created by "+n+")"),n="\n    in "+(r||"Unknown")+a}t+=n,e=e.return}while(e);return t}var ct=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,lt=Object.prototype.hasOwnProperty,ft={},dt={};function pt(e,t,n,r,i){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=e,this.type=t}var ht={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){ht[e]=new pt(e,0,!1,e,null)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];ht[t]=new pt(t,1,!1,e[1],null)}),["contentEditable","draggable","spellCheck","value"].forEach(function(e){ht[e]=new pt(e,2,!1,e.toLowerCase(),null)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){ht[e]=new pt(e,2,!1,e,null)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){ht[e]=new pt(e,3,!1,e.toLowerCase(),null)}),["checked","multiple","muted","selected"].forEach(function(e){ht[e]=new pt(e,3,!0,e,null)}),["capture","download"].forEach(function(e){ht[e]=new pt(e,4,!1,e,null)}),["cols","rows","size","span"].forEach(function(e){ht[e]=new pt(e,6,!1,e,null)}),["rowSpan","start"].forEach(function(e){ht[e]=new pt(e,5,!1,e.toLowerCase(),null)});var mt=/[\-:]([a-z])/g;function yt(e){return e[1].toUpperCase()}function vt(e,t,n,r){var i=ht.hasOwnProperty(t)?ht[t]:null;(null!==i?0===i.type:!r&&(2<t.length&&("o"===t[0]||"O"===t[0])&&("n"===t[1]||"N"===t[1])))||(function(e,t,n,r){if(null==t||function(e,t,n,r){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!r&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,r))return!0;if(r)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,i,r)&&(n=null),r||null===i?function(e){return!!lt.call(dt,e)||!lt.call(ft,e)&&(ct.test(e)?dt[e]=!0:(ft[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):i.mustUseProperty?e[i.propertyName]=null===n?3!==i.type&&"":n:(t=i.attributeName,r=i.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(i=i.type)||4===i&&!0===n?"":""+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}function bt(e){switch(typeof e){case"boolean":case"number":case"object":case"string":case"undefined":return e;default:return""}}function gt(e,t){var n=t.checked;return i({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function _t(e,t){var n=null==t.defaultValue?"":t.defaultValue,r=null!=t.checked?t.checked:t.defaultChecked;n=bt(null!=t.value?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function St(e,t){null!=(t=t.checked)&&vt(e,"checked",t,!1)}function Ct(e,t){St(e,t);var n=bt(t.value),r=t.type;if(null!=n)"number"===r?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===r||"reset"===r)return void e.removeAttribute("value");t.hasOwnProperty("value")?wt(e,t.type,n):t.hasOwnProperty("defaultValue")&&wt(e,t.type,bt(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function xt(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!("submit"!==r&&"reset"!==r||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!e.defaultChecked,e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function wt(e,t,n){"number"===t&&e.ownerDocument.activeElement===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(mt,yt);ht[t]=new pt(t,1,!1,e,null)}),"xlink:actuate xlink:arcrole xlink:href xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(mt,yt);ht[t]=new pt(t,1,!1,e,"http://www.w3.org/1999/xlink")}),["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(mt,yt);ht[t]=new pt(t,1,!1,e,"http://www.w3.org/XML/1998/namespace")}),["tabIndex","crossOrigin"].forEach(function(e){ht[e]=new pt(e,1,!1,e.toLowerCase(),null)});var Pt={change:{phasedRegistrationNames:{bubbled:"onChange",captured:"onChangeCapture"},dependencies:"blur change click focus input keydown keyup selectionchange".split(" ")}};function Tt(e,t,n){return(e=se.getPooled(Pt.change,e,t,n)).type="change",Ie(n),q(e),e}var At=null,Et=null;function kt(e){M(e)}function It(e){if(Ge(N(e)))return e}function Mt(e,t){if("change"===e)return t}var Vt=!1;function Ot(){At&&(At.detachEvent("onpropertychange",Dt),Et=At=null)}function Dt(e){"value"===e.propertyName&&It(Et)&&je(kt,e=Tt(Et,e,Fe(e)))}function Rt(e,t,n){"focus"===e?(Ot(),Et=n,(At=t).attachEvent("onpropertychange",Dt)):"blur"===e&&Ot()}function jt(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return It(Et)}function Nt(e,t){if("click"===e)return It(t)}function Bt(e,t){if("input"===e||"change"===e)return It(t)}H&&(Vt=Le("input")&&(!document.documentMode||9<document.documentMode));var Ft={eventTypes:Pt,_isInputEventSupported:Vt,extractEvents:function(e,t,n,r){var i=t?N(t):window,a=void 0,o=void 0,u=i.nodeName&&i.nodeName.toLowerCase();if("select"===u||"input"===u&&"file"===i.type?a=Mt:Be(i)?Vt?a=Bt:(a=jt,o=Rt):(u=i.nodeName)&&"input"===u.toLowerCase()&&("checkbox"===i.type||"radio"===i.type)&&(a=Nt),a&&(a=a(e,t)))return Tt(a,n,r);o&&o(e,i,t),"blur"===e&&(e=i._wrapperState)&&e.controlled&&"number"===i.type&&wt(i,"number",i.value)}},Lt=se.extend({view:null,detail:null}),zt={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Ut(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=zt[e])&&!!t[e]}function Gt(){return Ut}var qt=0,Ht=0,Wt=!1,Yt=!1,Kt=Lt.extend({screenX:null,screenY:null,clientX:null,clientY:null,pageX:null,pageY:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,getModifierState:Gt,button:null,buttons:null,relatedTarget:function(e){return e.relatedTarget||(e.fromElement===e.srcElement?e.toElement:e.fromElement)},movementX:function(e){if("movementX"in e)return e.movementX;var t=qt;return qt=e.screenX,Wt?"mousemove"===e.type?e.screenX-t:0:(Wt=!0,0)},movementY:function(e){if("movementY"in e)return e.movementY;var t=Ht;return Ht=e.screenY,Yt?"mousemove"===e.type?e.screenY-t:0:(Yt=!0,0)}}),Xt=Kt.extend({pointerId:null,width:null,height:null,pressure:null,tangentialPressure:null,tiltX:null,tiltY:null,twist:null,pointerType:null,isPrimary:null}),Qt={mouseEnter:{registrationName:"onMouseEnter",dependencies:["mouseout","mouseover"]},mouseLeave:{registrationName:"onMouseLeave",dependencies:["mouseout","mouseover"]},pointerEnter:{registrationName:"onPointerEnter",dependencies:["pointerout","pointerover"]},pointerLeave:{registrationName:"onPointerLeave",dependencies:["pointerout","pointerover"]}},Zt={eventTypes:Qt,extractEvents:function(e,t,n,r){var i="mouseover"===e||"pointerover"===e,a="mouseout"===e||"pointerout"===e;if(i&&(n.relatedTarget||n.fromElement)||!a&&!i)return null;if(i=r.window===r?r:(i=r.ownerDocument)?i.defaultView||i.parentWindow:window,a?(a=t,t=(t=n.relatedTarget||n.toElement)?R(t):null):a=null,a===t)return null;var o=void 0,u=void 0,s=void 0,c=void 0;"mouseout"===e||"mouseover"===e?(o=Kt,u=Qt.mouseLeave,s=Qt.mouseEnter,c="mouse"):"pointerout"!==e&&"pointerover"!==e||(o=Xt,u=Qt.pointerLeave,s=Qt.pointerEnter,c="pointer");var l=null==a?i:N(a);if(i=null==t?i:N(t),(e=o.getPooled(u,a,n,r)).type=c+"leave",e.target=l,e.relatedTarget=i,(n=o.getPooled(s,t,n,r)).type=c+"enter",n.target=i,n.relatedTarget=l,r=t,a&&r)e:{for(i=r,c=0,o=t=a;o;o=F(o))c++;for(o=0,s=i;s;s=F(s))o++;for(;0<c-o;)t=F(t),c--;for(;0<o-c;)i=F(i),o--;for(;c--;){if(t===i||t===i.alternate)break e;t=F(t),i=F(i)}t=null}else t=null;for(i=t,t=[];a&&a!==i&&(null===(c=a.alternate)||c!==i);)t.push(a),a=F(a);for(a=[];r&&r!==i&&(null===(c=r.alternate)||c!==i);)a.push(r),r=F(r);for(r=0;r<t.length;r++)U(t[r],"bubbled",e);for(r=a.length;0<r--;)U(a[r],"captured",n);return[e,n]}};function Jt(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t}var $t=Object.prototype.hasOwnProperty;function en(e,t){if(Jt(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++)if(!$t.call(t,n[r])||!Jt(e[n[r]],t[n[r]]))return!1;return!0}function tn(e){var t=e;if(e.alternate)for(;t.return;)t=t.return;else{if(0!=(2&t.effectTag))return 1;for(;t.return;)if(0!=(2&(t=t.return).effectTag))return 1}return 3===t.tag?2:3}function nn(e){2!==tn(e)&&o("188")}function rn(e){if(!(e=function(e){var t=e.alternate;if(!t)return 3===(t=tn(e))&&o("188"),1===t?null:e;for(var n=e,r=t;;){var i=n.return,a=i?i.alternate:null;if(!i||!a)break;if(i.child===a.child){for(var u=i.child;u;){if(u===n)return nn(i),e;if(u===r)return nn(i),t;u=u.sibling}o("188")}if(n.return!==r.return)n=i,r=a;else{u=!1;for(var s=i.child;s;){if(s===n){u=!0,n=i,r=a;break}if(s===r){u=!0,r=i,n=a;break}s=s.sibling}if(!u){for(s=a.child;s;){if(s===n){u=!0,n=a,r=i;break}if(s===r){u=!0,r=a,n=i;break}s=s.sibling}u||o("189")}}n.alternate!==r&&o("190")}return 3!==n.tag&&o("188"),n.stateNode.current===n?e:t}(e)))return null;for(var t=e;;){if(5===t.tag||6===t.tag)return t;if(t.child)t.child.return=t,t=t.child;else{if(t===e)break;for(;!t.sibling;){if(!t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}}return null}var an=se.extend({animationName:null,elapsedTime:null,pseudoElement:null}),on=se.extend({clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),un=Lt.extend({relatedTarget:null});function sn(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}var cn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},ln={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},fn=Lt.extend({key:function(e){if(e.key){var t=cn[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=sn(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?ln[e.keyCode]||"Unidentified":""},location:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,repeat:null,locale:null,getModifierState:Gt,charCode:function(e){return"keypress"===e.type?sn(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?sn(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),dn=Kt.extend({dataTransfer:null}),pn=Lt.extend({touches:null,targetTouches:null,changedTouches:null,altKey:null,metaKey:null,ctrlKey:null,shiftKey:null,getModifierState:Gt}),hn=se.extend({propertyName:null,elapsedTime:null,pseudoElement:null}),mn=Kt.extend({deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:null,deltaMode:null}),yn=[["abort","abort"],[Z,"animationEnd"],[J,"animationIteration"],[$,"animationStart"],["canplay","canPlay"],["canplaythrough","canPlayThrough"],["drag","drag"],["dragenter","dragEnter"],["dragexit","dragExit"],["dragleave","dragLeave"],["dragover","dragOver"],["durationchange","durationChange"],["emptied","emptied"],["encrypted","encrypted"],["ended","ended"],["error","error"],["gotpointercapture","gotPointerCapture"],["load","load"],["loadeddata","loadedData"],["loadedmetadata","loadedMetadata"],["loadstart","loadStart"],["lostpointercapture","lostPointerCapture"],["mousemove","mouseMove"],["mouseout","mouseOut"],["mouseover","mouseOver"],["playing","playing"],["pointermove","pointerMove"],["pointerout","pointerOut"],["pointerover","pointerOver"],["progress","progress"],["scroll","scroll"],["seeking","seeking"],["stalled","stalled"],["suspend","suspend"],["timeupdate","timeUpdate"],["toggle","toggle"],["touchmove","touchMove"],[ee,"transitionEnd"],["waiting","waiting"],["wheel","wheel"]],vn={},bn={};function gn(e,t){var n=e[0],r="on"+((e=e[1])[0].toUpperCase()+e.slice(1));t={phasedRegistrationNames:{bubbled:r,captured:r+"Capture"},dependencies:[n],isInteractive:t},vn[e]=t,bn[n]=t}[["blur","blur"],["cancel","cancel"],["click","click"],["close","close"],["contextmenu","contextMenu"],["copy","copy"],["cut","cut"],["auxclick","auxClick"],["dblclick","doubleClick"],["dragend","dragEnd"],["dragstart","dragStart"],["drop","drop"],["focus","focus"],["input","input"],["invalid","invalid"],["keydown","keyDown"],["keypress","keyPress"],["keyup","keyUp"],["mousedown","mouseDown"],["mouseup","mouseUp"],["paste","paste"],["pause","pause"],["play","play"],["pointercancel","pointerCancel"],["pointerdown","pointerDown"],["pointerup","pointerUp"],["ratechange","rateChange"],["reset","reset"],["seeked","seeked"],["submit","submit"],["touchcancel","touchCancel"],["touchend","touchEnd"],["touchstart","touchStart"],["volumechange","volumeChange"]].forEach(function(e){gn(e,!0)}),yn.forEach(function(e){gn(e,!1)});var _n={eventTypes:vn,isInteractiveTopLevelEventType:function(e){return void 0!==(e=bn[e])&&!0===e.isInteractive},extractEvents:function(e,t,n,r){var i=bn[e];if(!i)return null;switch(e){case"keypress":if(0===sn(n))return null;case"keydown":case"keyup":e=fn;break;case"blur":case"focus":e=un;break;case"click":if(2===n.button)return null;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":e=Kt;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":e=dn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":e=pn;break;case Z:case J:case $:e=an;break;case ee:e=hn;break;case"scroll":e=Lt;break;case"wheel":e=mn;break;case"copy":case"cut":case"paste":e=on;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":e=Xt;break;default:e=se}return q(t=e.getPooled(i,t,n,r)),t}},Sn=_n.isInteractiveTopLevelEventType,Cn=[];function xn(e){var t=e.targetInst,n=t;do{if(!n){e.ancestors.push(n);break}var r;for(r=n;r.return;)r=r.return;if(!(r=3!==r.tag?null:r.stateNode.containerInfo))break;e.ancestors.push(n),n=R(r)}while(n);for(n=0;n<e.ancestors.length;n++){t=e.ancestors[n];var i=Fe(e.nativeEvent);r=e.topLevelType;for(var a=e.nativeEvent,o=null,u=0;u<v.length;u++){var s=v[u];s&&(s=s.extractEvents(r,t,a,i))&&(o=P(o,s))}M(o)}}var wn=!0;function Pn(e,t){if(!t)return null;var n=(Sn(e)?An:En).bind(null,e);t.addEventListener(e,n,!1)}function Tn(e,t){if(!t)return null;var n=(Sn(e)?An:En).bind(null,e);t.addEventListener(e,n,!0)}function An(e,t){Oe(En,e,t)}function En(e,t){if(wn){var n=Fe(t);if(null===(n=R(n))||"number"!=typeof n.tag||2===tn(n)||(n=null),Cn.length){var r=Cn.pop();r.topLevelType=e,r.nativeEvent=t,r.targetInst=n,e=r}else e={topLevelType:e,nativeEvent:t,targetInst:n,ancestors:[]};try{je(xn,e)}finally{e.topLevelType=null,e.nativeEvent=null,e.targetInst=null,e.ancestors.length=0,10>Cn.length&&Cn.push(e)}}}var kn={},In=0,Mn="_reactListenersID"+(""+Math.random()).slice(2);function Vn(e){return Object.prototype.hasOwnProperty.call(e,Mn)||(e[Mn]=In++,kn[e[Mn]]={}),kn[e[Mn]]}function On(e){if(void 0===(e=e||("undefined"!=typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function Dn(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function Rn(e,t){var n,r=Dn(e);for(e=0;r;){if(3===r.nodeType){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=Dn(r)}}function jn(){for(var e=window,t=On();t instanceof e.HTMLIFrameElement;){try{e=t.contentDocument.defaultView}catch(e){break}t=On(e.document)}return t}function Nn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function Bn(e){var t=jn(),n=e.focusedElem,r=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&function e(t,n){return!(!t||!n)&&(t===n||(!t||3!==t.nodeType)&&(n&&3===n.nodeType?e(t,n.parentNode):"contains"in t?t.contains(n):!!t.compareDocumentPosition&&!!(16&t.compareDocumentPosition(n))))}(n.ownerDocument.documentElement,n)){if(null!==r&&Nn(n))if(t=r.start,void 0===(e=r.end)&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if((e=(t=n.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var i=n.textContent.length,a=Math.min(r.start,i);r=void 0===r.end?a:Math.min(r.end,i),!e.extend&&a>r&&(i=r,r=a,a=i),i=Rn(n,a);var o=Rn(n,r);i&&o&&(1!==e.rangeCount||e.anchorNode!==i.node||e.anchorOffset!==i.offset||e.focusNode!==o.node||e.focusOffset!==o.offset)&&((t=t.createRange()).setStart(i.node,i.offset),e.removeAllRanges(),a>r?(e.addRange(t),e.extend(o.node,o.offset)):(t.setEnd(o.node,o.offset),e.addRange(t)))}for(t=[],e=n;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"==typeof n.focus&&n.focus(),n=0;n<t.length;n++)(e=t[n]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var Fn=H&&"documentMode"in document&&11>=document.documentMode,Ln={select:{phasedRegistrationNames:{bubbled:"onSelect",captured:"onSelectCapture"},dependencies:"blur contextmenu dragend focus keydown keyup mousedown mouseup selectionchange".split(" ")}},zn=null,Un=null,Gn=null,qn=!1;function Hn(e,t){var n=t.window===t?t.document:9===t.nodeType?t:t.ownerDocument;return qn||null==zn||zn!==On(n)?null:("selectionStart"in(n=zn)&&Nn(n)?n={start:n.selectionStart,end:n.selectionEnd}:n={anchorNode:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset},Gn&&en(Gn,n)?null:(Gn=n,(e=se.getPooled(Ln.select,Un,e,t)).type="select",e.target=zn,q(e),e))}var Wn={eventTypes:Ln,extractEvents:function(e,t,n,r){var i,a=r.window===r?r.document:9===r.nodeType?r:r.ownerDocument;if(!(i=!a)){e:{a=Vn(a),i=_.onSelect;for(var o=0;o<i.length;o++){var u=i[o];if(!a.hasOwnProperty(u)||!a[u]){a=!1;break e}}a=!0}i=!a}if(i)return null;switch(a=t?N(t):window,e){case"focus":(Be(a)||"true"===a.contentEditable)&&(zn=a,Un=t,Gn=null);break;case"blur":Gn=Un=zn=null;break;case"mousedown":qn=!0;break;case"contextmenu":case"mouseup":case"dragend":return qn=!1,Hn(n,r);case"selectionchange":if(Fn)break;case"keydown":case"keyup":return Hn(n,r)}return null}};function Yn(e,t){return e=i({children:void 0},t),(t=function(e){var t="";return r.Children.forEach(e,function(e){null!=e&&(t+=e)}),t}(t.children))&&(e.children=t),e}function Kn(e,t,n,r){if(e=e.options,t){t={};for(var i=0;i<n.length;i++)t["$"+n[i]]=!0;for(n=0;n<e.length;n++)i=t.hasOwnProperty("$"+e[n].value),e[n].selected!==i&&(e[n].selected=i),i&&r&&(e[n].defaultSelected=!0)}else{for(n=""+bt(n),t=null,i=0;i<e.length;i++){if(e[i].value===n)return e[i].selected=!0,void(r&&(e[i].defaultSelected=!0));null!==t||e[i].disabled||(t=e[i])}null!==t&&(t.selected=!0)}}function Xn(e,t){return null!=t.dangerouslySetInnerHTML&&o("91"),i({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function Qn(e,t){var n=t.value;null==n&&(n=t.defaultValue,null!=(t=t.children)&&(null!=n&&o("92"),Array.isArray(t)&&(1>=t.length||o("93"),t=t[0]),n=t),null==n&&(n="")),e._wrapperState={initialValue:bt(n)}}function Zn(e,t){var n=bt(t.value),r=bt(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=r&&(e.defaultValue=""+r)}function Jn(e){var t=e.textContent;t===e._wrapperState.initialValue&&(e.value=t)}k.injectEventPluginOrder("ResponderEventPlugin SimpleEventPlugin EnterLeaveEventPlugin ChangeEventPlugin SelectEventPlugin BeforeInputEventPlugin".split(" ")),S=B,C=j,x=N,k.injectEventPluginsByName({SimpleEventPlugin:_n,EnterLeaveEventPlugin:Zt,ChangeEventPlugin:Ft,SelectEventPlugin:Wn,BeforeInputEventPlugin:Pe});var $n={html:"http://www.w3.org/1999/xhtml",mathml:"http://www.w3.org/1998/Math/MathML",svg:"http://www.w3.org/2000/svg"};function er(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function tr(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?er(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var nr,rr=void 0,ir=(nr=function(e,t){if(e.namespaceURI!==$n.svg||"innerHTML"in e)e.innerHTML=t;else{for((rr=rr||document.createElement("div")).innerHTML="<svg>"+t+"</svg>",t=rr.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!=typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,r){MSApp.execUnsafeLocalFunction(function(){return nr(e,t)})}:nr);function ar(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var or={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},ur=["Webkit","ms","Moz","O"];function sr(e,t,n){return null==t||"boolean"==typeof t||""===t?"":n||"number"!=typeof t||0===t||or.hasOwnProperty(e)&&or[e]?(""+t).trim():t+"px"}function cr(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var r=0===n.indexOf("--"),i=sr(n,t[n],r);"float"===n&&(n="cssFloat"),r?e.setProperty(n,i):e[n]=i}}Object.keys(or).forEach(function(e){ur.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),or[t]=or[e]})});var lr=i({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function fr(e,t){t&&(lr[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML)&&o("137",e,""),null!=t.dangerouslySetInnerHTML&&(null!=t.children&&o("60"),"object"==typeof t.dangerouslySetInnerHTML&&"__html"in t.dangerouslySetInnerHTML||o("61")),null!=t.style&&"object"!=typeof t.style&&o("62",""))}function dr(e,t){if(-1===e.indexOf("-"))return"string"==typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}function pr(e,t){var n=Vn(e=9===e.nodeType||11===e.nodeType?e:e.ownerDocument);t=_[t];for(var r=0;r<t.length;r++){var i=t[r];if(!n.hasOwnProperty(i)||!n[i]){switch(i){case"scroll":Tn("scroll",e);break;case"focus":case"blur":Tn("focus",e),Tn("blur",e),n.blur=!0,n.focus=!0;break;case"cancel":case"close":Le(i)&&Tn(i,e);break;case"invalid":case"submit":case"reset":break;default:-1===te.indexOf(i)&&Pn(i,e)}n[i]=!0}}}function hr(){}var mr=null,yr=null;function vr(e,t){switch(e){case"button":case"input":case"select":case"textarea":return!!t.autoFocus}return!1}function br(e,t){return"textarea"===e||"option"===e||"noscript"===e||"string"==typeof t.children||"number"==typeof t.children||"object"==typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var gr="function"==typeof setTimeout?setTimeout:void 0,_r="function"==typeof clearTimeout?clearTimeout:void 0,Sr=a.unstable_scheduleCallback,Cr=a.unstable_cancelCallback;function xr(e){for(e=e.nextSibling;e&&1!==e.nodeType&&3!==e.nodeType;)e=e.nextSibling;return e}function wr(e){for(e=e.firstChild;e&&1!==e.nodeType&&3!==e.nodeType;)e=e.nextSibling;return e}new Set;var Pr=[],Tr=-1;function Ar(e){0>Tr||(e.current=Pr[Tr],Pr[Tr]=null,Tr--)}function Er(e,t){Pr[++Tr]=e.current,e.current=t}var kr={},Ir={current:kr},Mr={current:!1},Vr=kr;function Or(e,t){var n=e.type.contextTypes;if(!n)return kr;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var i,a={};for(i in n)a[i]=t[i];return r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=a),a}function Dr(e){return null!=(e=e.childContextTypes)}function Rr(e){Ar(Mr),Ar(Ir)}function jr(e){Ar(Mr),Ar(Ir)}function Nr(e,t,n){Ir.current!==kr&&o("168"),Er(Ir,t),Er(Mr,n)}function Br(e,t,n){var r=e.stateNode;if(e=t.childContextTypes,"function"!=typeof r.getChildContext)return n;for(var a in r=r.getChildContext())a in e||o("108",ut(t)||"Unknown",a);return i({},n,r)}function Fr(e){var t=e.stateNode;return t=t&&t.__reactInternalMemoizedMergedChildContext||kr,Vr=Ir.current,Er(Ir,t),Er(Mr,Mr.current),!0}function Lr(e,t,n){var r=e.stateNode;r||o("169"),n?(t=Br(e,t,Vr),r.__reactInternalMemoizedMergedChildContext=t,Ar(Mr),Ar(Ir),Er(Ir,t)):Ar(Mr),Er(Mr,n)}var zr=null,Ur=null;function Gr(e){return function(t){try{return e(t)}catch(e){}}}function qr(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.contextDependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.effectTag=0,this.lastEffect=this.firstEffect=this.nextEffect=null,this.childExpirationTime=this.expirationTime=0,this.alternate=null}function Hr(e,t,n,r){return new qr(e,t,n,r)}function Wr(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Yr(e,t){var n=e.alternate;return null===n?((n=Hr(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.effectTag=0,n.nextEffect=null,n.firstEffect=null,n.lastEffect=null),n.childExpirationTime=e.childExpirationTime,n.expirationTime=e.expirationTime,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,n.contextDependencies=e.contextDependencies,n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Kr(e,t,n,r,i,a){var u=2;if(r=e,"function"==typeof e)Wr(e)&&(u=1);else if("string"==typeof e)u=5;else e:switch(e){case Xe:return Xr(n.children,i,a,t);case et:return Qr(n,3|i,a,t);case Qe:return Qr(n,2|i,a,t);case Ze:return(e=Hr(12,n,t,4|i)).elementType=Ze,e.type=Ze,e.expirationTime=a,e;case nt:return(e=Hr(13,n,t,i)).elementType=nt,e.type=nt,e.expirationTime=a,e;default:if("object"==typeof e&&null!==e)switch(e.$$typeof){case Je:u=10;break e;case $e:u=9;break e;case tt:u=11;break e;case rt:u=14;break e;case it:u=16,r=null;break e}o("130",null==e?e:typeof e,"")}return(t=Hr(u,n,t,i)).elementType=e,t.type=r,t.expirationTime=a,t}function Xr(e,t,n,r){return(e=Hr(7,e,r,t)).expirationTime=n,e}function Qr(e,t,n,r){return e=Hr(8,e,r,t),t=0==(1&t)?Qe:et,e.elementType=t,e.type=t,e.expirationTime=n,e}function Zr(e,t,n){return(e=Hr(6,e,null,t)).expirationTime=n,e}function Jr(e,t,n){return(t=Hr(4,null!==e.children?e.children:[],e.key,t)).expirationTime=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function $r(e,t){e.didError=!1;var n=e.earliestPendingTime;0===n?e.earliestPendingTime=e.latestPendingTime=t:n<t?e.earliestPendingTime=t:e.latestPendingTime>t&&(e.latestPendingTime=t),ni(t,e)}function ei(e,t){e.didError=!1,e.latestPingedTime>=t&&(e.latestPingedTime=0);var n=e.earliestPendingTime,r=e.latestPendingTime;n===t?e.earliestPendingTime=r===t?e.latestPendingTime=0:r:r===t&&(e.latestPendingTime=n),n=e.earliestSuspendedTime,r=e.latestSuspendedTime,0===n?e.earliestSuspendedTime=e.latestSuspendedTime=t:n<t?e.earliestSuspendedTime=t:r>t&&(e.latestSuspendedTime=t),ni(t,e)}function ti(e,t){var n=e.earliestPendingTime;return n>t&&(t=n),(e=e.earliestSuspendedTime)>t&&(t=e),t}function ni(e,t){var n=t.earliestSuspendedTime,r=t.latestSuspendedTime,i=t.earliestPendingTime,a=t.latestPingedTime;0===(i=0!==i?i:a)&&(0===e||r<e)&&(i=r),0!==(e=i)&&n>e&&(e=n),t.nextExpirationTimeToWorkOn=i,t.expirationTime=e}function ri(e,t){if(e&&e.defaultProps)for(var n in t=i({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}var ii=(new r.Component).refs;function ai(e,t,n,r){n=null==(n=n(r,t=e.memoizedState))?t:i({},t,n),e.memoizedState=n,null!==(r=e.updateQueue)&&0===e.expirationTime&&(r.baseState=n)}var oi={isMounted:function(e){return!!(e=e._reactInternalFiber)&&2===tn(e)},enqueueSetState:function(e,t,n){e=e._reactInternalFiber;var r=Cu(),i=Xa(r=Xo(r,e));i.payload=t,null!=n&&(i.callback=n),Go(),Za(e,i),Jo(e,r)},enqueueReplaceState:function(e,t,n){e=e._reactInternalFiber;var r=Cu(),i=Xa(r=Xo(r,e));i.tag=Ga,i.payload=t,null!=n&&(i.callback=n),Go(),Za(e,i),Jo(e,r)},enqueueForceUpdate:function(e,t){e=e._reactInternalFiber;var n=Cu(),r=Xa(n=Xo(n,e));r.tag=qa,null!=t&&(r.callback=t),Go(),Za(e,r),Jo(e,n)}};function ui(e,t,n,r,i,a,o){return"function"==typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,a,o):!t.prototype||!t.prototype.isPureReactComponent||(!en(n,r)||!en(i,a))}function si(e,t,n){var r=!1,i=kr,a=t.contextType;return"object"==typeof a&&null!==a?a=za(a):(i=Dr(t)?Vr:Ir.current,a=(r=null!=(r=t.contextTypes))?Or(e,i):kr),t=new t(n,a),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=oi,e.stateNode=t,t._reactInternalFiber=e,r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=i,e.__reactInternalMemoizedMaskedChildContext=a),t}function ci(e,t,n,r){e=t.state,"function"==typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"==typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&oi.enqueueReplaceState(t,t.state,null)}function li(e,t,n,r){var i=e.stateNode;i.props=n,i.state=e.memoizedState,i.refs=ii;var a=t.contextType;"object"==typeof a&&null!==a?i.context=za(a):(a=Dr(t)?Vr:Ir.current,i.context=Or(e,a)),null!==(a=e.updateQueue)&&(to(e,a,n,i,r),i.state=e.memoizedState),"function"==typeof(a=t.getDerivedStateFromProps)&&(ai(e,t,a,n),i.state=e.memoizedState),"function"==typeof t.getDerivedStateFromProps||"function"==typeof i.getSnapshotBeforeUpdate||"function"!=typeof i.UNSAFE_componentWillMount&&"function"!=typeof i.componentWillMount||(t=i.state,"function"==typeof i.componentWillMount&&i.componentWillMount(),"function"==typeof i.UNSAFE_componentWillMount&&i.UNSAFE_componentWillMount(),t!==i.state&&oi.enqueueReplaceState(i,i.state,null),null!==(a=e.updateQueue)&&(to(e,a,n,i,r),i.state=e.memoizedState)),"function"==typeof i.componentDidMount&&(e.effectTag|=4)}var fi=Array.isArray;function di(e,t,n){if(null!==(e=n.ref)&&"function"!=typeof e&&"object"!=typeof e){if(n._owner){n=n._owner;var r=void 0;n&&(1!==n.tag&&o("309"),r=n.stateNode),r||o("147",e);var i=""+e;return null!==t&&null!==t.ref&&"function"==typeof t.ref&&t.ref._stringRef===i?t.ref:((t=function(e){var t=r.refs;t===ii&&(t=r.refs={}),null===e?delete t[i]:t[i]=e})._stringRef=i,t)}"string"!=typeof e&&o("284"),n._owner||o("290",e)}return e}function pi(e,t){"textarea"!==e.type&&o("31","[object Object]"===Object.prototype.toString.call(t)?"object with keys {"+Object.keys(t).join(", ")+"}":t,"")}function hi(e){function t(t,n){if(e){var r=t.lastEffect;null!==r?(r.nextEffect=n,t.lastEffect=n):t.firstEffect=t.lastEffect=n,n.nextEffect=null,n.effectTag=8}}function n(n,r){if(!e)return null;for(;null!==r;)t(n,r),r=r.sibling;return null}function r(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function i(e,t,n){return(e=Yr(e,t)).index=0,e.sibling=null,e}function a(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.effectTag=2,n):r:(t.effectTag=2,n):n}function u(t){return e&&null===t.alternate&&(t.effectTag=2),t}function s(e,t,n,r){return null===t||6!==t.tag?((t=Zr(n,e.mode,r)).return=e,t):((t=i(t,n)).return=e,t)}function c(e,t,n,r){return null!==t&&t.elementType===n.type?((r=i(t,n.props)).ref=di(e,t,n),r.return=e,r):((r=Kr(n.type,n.key,n.props,null,e.mode,r)).ref=di(e,t,n),r.return=e,r)}function l(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Jr(n,e.mode,r)).return=e,t):((t=i(t,n.children||[])).return=e,t)}function f(e,t,n,r,a){return null===t||7!==t.tag?((t=Xr(n,e.mode,r,a)).return=e,t):((t=i(t,n)).return=e,t)}function d(e,t,n){if("string"==typeof t||"number"==typeof t)return(t=Zr(""+t,e.mode,n)).return=e,t;if("object"==typeof t&&null!==t){switch(t.$$typeof){case Ye:return(n=Kr(t.type,t.key,t.props,null,e.mode,n)).ref=di(e,null,t),n.return=e,n;case Ke:return(t=Jr(t,e.mode,n)).return=e,t}if(fi(t)||ot(t))return(t=Xr(t,e.mode,n,null)).return=e,t;pi(e,t)}return null}function p(e,t,n,r){var i=null!==t?t.key:null;if("string"==typeof n||"number"==typeof n)return null!==i?null:s(e,t,""+n,r);if("object"==typeof n&&null!==n){switch(n.$$typeof){case Ye:return n.key===i?n.type===Xe?f(e,t,n.props.children,r,i):c(e,t,n,r):null;case Ke:return n.key===i?l(e,t,n,r):null}if(fi(n)||ot(n))return null!==i?null:f(e,t,n,r,null);pi(e,n)}return null}function h(e,t,n,r,i){if("string"==typeof r||"number"==typeof r)return s(t,e=e.get(n)||null,""+r,i);if("object"==typeof r&&null!==r){switch(r.$$typeof){case Ye:return e=e.get(null===r.key?n:r.key)||null,r.type===Xe?f(t,e,r.props.children,i,r.key):c(t,e,r,i);case Ke:return l(t,e=e.get(null===r.key?n:r.key)||null,r,i)}if(fi(r)||ot(r))return f(t,e=e.get(n)||null,r,i,null);pi(t,r)}return null}function m(i,o,u,s){for(var c=null,l=null,f=o,m=o=0,y=null;null!==f&&m<u.length;m++){f.index>m?(y=f,f=null):y=f.sibling;var v=p(i,f,u[m],s);if(null===v){null===f&&(f=y);break}e&&f&&null===v.alternate&&t(i,f),o=a(v,o,m),null===l?c=v:l.sibling=v,l=v,f=y}if(m===u.length)return n(i,f),c;if(null===f){for(;m<u.length;m++)(f=d(i,u[m],s))&&(o=a(f,o,m),null===l?c=f:l.sibling=f,l=f);return c}for(f=r(i,f);m<u.length;m++)(y=h(f,i,m,u[m],s))&&(e&&null!==y.alternate&&f.delete(null===y.key?m:y.key),o=a(y,o,m),null===l?c=y:l.sibling=y,l=y);return e&&f.forEach(function(e){return t(i,e)}),c}function y(i,u,s,c){var l=ot(s);"function"!=typeof l&&o("150"),null==(s=l.call(s))&&o("151");for(var f=l=null,m=u,y=u=0,v=null,b=s.next();null!==m&&!b.done;y++,b=s.next()){m.index>y?(v=m,m=null):v=m.sibling;var g=p(i,m,b.value,c);if(null===g){m||(m=v);break}e&&m&&null===g.alternate&&t(i,m),u=a(g,u,y),null===f?l=g:f.sibling=g,f=g,m=v}if(b.done)return n(i,m),l;if(null===m){for(;!b.done;y++,b=s.next())null!==(b=d(i,b.value,c))&&(u=a(b,u,y),null===f?l=b:f.sibling=b,f=b);return l}for(m=r(i,m);!b.done;y++,b=s.next())null!==(b=h(m,i,y,b.value,c))&&(e&&null!==b.alternate&&m.delete(null===b.key?y:b.key),u=a(b,u,y),null===f?l=b:f.sibling=b,f=b);return e&&m.forEach(function(e){return t(i,e)}),l}return function(e,r,a,s){var c="object"==typeof a&&null!==a&&a.type===Xe&&null===a.key;c&&(a=a.props.children);var l="object"==typeof a&&null!==a;if(l)switch(a.$$typeof){case Ye:e:{for(l=a.key,c=r;null!==c;){if(c.key===l){if(7===c.tag?a.type===Xe:c.elementType===a.type){n(e,c.sibling),(r=i(c,a.type===Xe?a.props.children:a.props)).ref=di(e,c,a),r.return=e,e=r;break e}n(e,c);break}t(e,c),c=c.sibling}a.type===Xe?((r=Xr(a.props.children,e.mode,s,a.key)).return=e,e=r):((s=Kr(a.type,a.key,a.props,null,e.mode,s)).ref=di(e,r,a),s.return=e,e=s)}return u(e);case Ke:e:{for(c=a.key;null!==r;){if(r.key===c){if(4===r.tag&&r.stateNode.containerInfo===a.containerInfo&&r.stateNode.implementation===a.implementation){n(e,r.sibling),(r=i(r,a.children||[])).return=e,e=r;break e}n(e,r);break}t(e,r),r=r.sibling}(r=Jr(a,e.mode,s)).return=e,e=r}return u(e)}if("string"==typeof a||"number"==typeof a)return a=""+a,null!==r&&6===r.tag?(n(e,r.sibling),(r=i(r,a)).return=e,e=r):(n(e,r),(r=Zr(a,e.mode,s)).return=e,e=r),u(e);if(fi(a))return m(e,r,a,s);if(ot(a))return y(e,r,a,s);if(l&&pi(e,a),void 0===a&&!c)switch(e.tag){case 1:case 0:o("152",(s=e.type).displayName||s.name||"Component")}return n(e,r)}}var mi=hi(!0),yi=hi(!1),vi={},bi={current:vi},gi={current:vi},_i={current:vi};function Si(e){return e===vi&&o("174"),e}function Ci(e,t){Er(_i,t),Er(gi,e),Er(bi,vi);var n=t.nodeType;switch(n){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:tr(null,"");break;default:t=tr(t=(n=8===n?t.parentNode:t).namespaceURI||null,n=n.tagName)}Ar(bi),Er(bi,t)}function xi(e){Ar(bi),Ar(gi),Ar(_i)}function wi(e){Si(_i.current);var t=Si(bi.current),n=tr(t,e.type);t!==n&&(Er(gi,e),Er(bi,n))}function Pi(e){gi.current===e&&(Ar(bi),Ar(gi))}var Ti=0,Ai=2,Ei=4,ki=8,Ii=16,Mi=32,Vi=64,Oi=128,Di=qe.ReactCurrentDispatcher,Ri=0,ji=null,Ni=null,Bi=null,Fi=null,Li=null,zi=null,Ui=0,Gi=null,qi=0,Hi=!1,Wi=null,Yi=0;function Ki(){o("307")}function Xi(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!Jt(e[n],t[n]))return!1;return!0}function Qi(e,t,n,r,i,a){if(Ri=a,ji=t,Bi=null!==e?e.memoizedState:null,Di.current=null===Bi?ca:la,t=n(r,i),Hi){do{Hi=!1,Yi+=1,Bi=null!==e?e.memoizedState:null,zi=Fi,Gi=Li=Ni=null,Di.current=la,t=n(r,i)}while(Hi);Wi=null,Yi=0}return Di.current=sa,(e=ji).memoizedState=Fi,e.expirationTime=Ui,e.updateQueue=Gi,e.effectTag|=qi,e=null!==Ni&&null!==Ni.next,Ri=0,zi=Li=Fi=Bi=Ni=ji=null,Ui=0,Gi=null,qi=0,e&&o("300"),t}function Zi(){Di.current=sa,Ri=0,zi=Li=Fi=Bi=Ni=ji=null,Ui=0,Gi=null,qi=0,Hi=!1,Wi=null,Yi=0}function Ji(){var e={memoizedState:null,baseState:null,queue:null,baseUpdate:null,next:null};return null===Li?Fi=Li=e:Li=Li.next=e,Li}function $i(){if(null!==zi)zi=(Li=zi).next,Bi=null!==(Ni=Bi)?Ni.next:null;else{null===Bi&&o("310");var e={memoizedState:(Ni=Bi).memoizedState,baseState:Ni.baseState,queue:Ni.queue,baseUpdate:Ni.baseUpdate,next:null};Li=null===Li?Fi=e:Li.next=e,Bi=Ni.next}return Li}function ea(e,t){return"function"==typeof t?t(e):t}function ta(e){var t=$i(),n=t.queue;if(null===n&&o("311"),0<Yi){var r=n.dispatch;if(null!==Wi){var i=Wi.get(n);if(void 0!==i){Wi.delete(n);var a=t.memoizedState;do{a=e(a,i.action),i=i.next}while(null!==i);return Jt(a,t.memoizedState)||(Sa=!0),t.memoizedState=a,t.baseUpdate===n.last&&(t.baseState=a),[a,r]}}return[t.memoizedState,r]}r=n.last;var u=t.baseUpdate;if(a=t.baseState,null!==u?(null!==r&&(r.next=null),r=u.next):r=null!==r?r.next:null,null!==r){var s=i=null,c=r,l=!1;do{var f=c.expirationTime;f<Ri?(l||(l=!0,s=u,i=a),f>Ui&&(Ui=f)):a=c.eagerReducer===e?c.eagerState:e(a,c.action),u=c,c=c.next}while(null!==c&&c!==r);l||(s=u,i=a),Jt(a,t.memoizedState)||(Sa=!0),t.memoizedState=a,t.baseUpdate=s,t.baseState=i,n.eagerReducer=e,n.eagerState=a}return[t.memoizedState,n.dispatch]}function na(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},null===Gi?(Gi={lastEffect:null}).lastEffect=e.next=e:null===(t=Gi.lastEffect)?Gi.lastEffect=e.next=e:(n=t.next,t.next=e,e.next=n,Gi.lastEffect=e),e}function ra(e,t,n,r){var i=Ji();qi|=e,i.memoizedState=na(t,n,void 0,void 0===r?null:r)}function ia(e,t,n,r){var i=$i();r=void 0===r?null:r;var a=void 0;if(null!==Ni){var o=Ni.memoizedState;if(a=o.destroy,null!==r&&Xi(r,o.deps))return void na(Ti,n,a,r)}qi|=e,i.memoizedState=na(t,n,a,r)}function aa(e,t){return"function"==typeof t?(e=e(),t(e),function(){t(null)}):null!=t?(e=e(),t.current=e,function(){t.current=null}):void 0}function oa(){}function ua(e,t,n){25>Yi||o("301");var r=e.alternate;if(e===ji||null!==r&&r===ji)if(Hi=!0,e={expirationTime:Ri,action:n,eagerReducer:null,eagerState:null,next:null},null===Wi&&(Wi=new Map),void 0===(n=Wi.get(t)))Wi.set(t,e);else{for(t=n;null!==t.next;)t=t.next;t.next=e}else{Go();var i=Cu(),a={expirationTime:i=Xo(i,e),action:n,eagerReducer:null,eagerState:null,next:null},u=t.last;if(null===u)a.next=a;else{var s=u.next;null!==s&&(a.next=s),u.next=a}if(t.last=a,0===e.expirationTime&&(null===r||0===r.expirationTime)&&null!==(r=t.eagerReducer))try{var c=t.eagerState,l=r(c,n);if(a.eagerReducer=r,a.eagerState=l,Jt(l,c))return}catch(e){}Jo(e,i)}}var sa={readContext:za,useCallback:Ki,useContext:Ki,useEffect:Ki,useImperativeHandle:Ki,useLayoutEffect:Ki,useMemo:Ki,useReducer:Ki,useRef:Ki,useState:Ki,useDebugValue:Ki},ca={readContext:za,useCallback:function(e,t){return Ji().memoizedState=[e,void 0===t?null:t],e},useContext:za,useEffect:function(e,t){return ra(516,Oi|Vi,e,t)},useImperativeHandle:function(e,t,n){return n=null!=n?n.concat([e]):null,ra(4,Ei|Mi,aa.bind(null,t,e),n)},useLayoutEffect:function(e,t){return ra(4,Ei|Mi,e,t)},useMemo:function(e,t){var n=Ji();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=Ji();return t=void 0!==n?n(t):t,r.memoizedState=r.baseState=t,e=(e=r.queue={last:null,dispatch:null,eagerReducer:e,eagerState:t}).dispatch=ua.bind(null,ji,e),[r.memoizedState,e]},useRef:function(e){return e={current:e},Ji().memoizedState=e},useState:function(e){var t=Ji();return"function"==typeof e&&(e=e()),t.memoizedState=t.baseState=e,e=(e=t.queue={last:null,dispatch:null,eagerReducer:ea,eagerState:e}).dispatch=ua.bind(null,ji,e),[t.memoizedState,e]},useDebugValue:oa},la={readContext:za,useCallback:function(e,t){var n=$i();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&Xi(t,r[1])?r[0]:(n.memoizedState=[e,t],e)},useContext:za,useEffect:function(e,t){return ia(516,Oi|Vi,e,t)},useImperativeHandle:function(e,t,n){return n=null!=n?n.concat([e]):null,ia(4,Ei|Mi,aa.bind(null,t,e),n)},useLayoutEffect:function(e,t){return ia(4,Ei|Mi,e,t)},useMemo:function(e,t){var n=$i();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&Xi(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)},useReducer:ta,useRef:function(){return $i().memoizedState},useState:function(e){return ta(ea)},useDebugValue:oa},fa=null,da=null,pa=!1;function ha(e,t){var n=Hr(5,null,null,0);n.elementType="DELETED",n.type="DELETED",n.stateNode=t,n.return=e,n.effectTag=8,null!==e.lastEffect?(e.lastEffect.nextEffect=n,e.lastEffect=n):e.firstEffect=e.lastEffect=n}function ma(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,!0);case 13:default:return!1}}function ya(e){if(pa){var t=da;if(t){var n=t;if(!ma(e,t)){if(!(t=xr(n))||!ma(e,t))return e.effectTag|=2,pa=!1,void(fa=e);ha(fa,n)}fa=e,da=wr(t)}else e.effectTag|=2,pa=!1,fa=e}}function va(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&18!==e.tag;)e=e.return;fa=e}function ba(e){if(e!==fa)return!1;if(!pa)return va(e),pa=!0,!1;var t=e.type;if(5!==e.tag||"head"!==t&&"body"!==t&&!br(t,e.memoizedProps))for(t=da;t;)ha(e,t),t=xr(t);return va(e),da=fa?xr(e.stateNode):null,!0}function ga(){da=fa=null,pa=!1}var _a=qe.ReactCurrentOwner,Sa=!1;function Ca(e,t,n,r){t.child=null===e?yi(t,null,n,r):mi(t,e.child,n,r)}function xa(e,t,n,r,i){n=n.render;var a=t.ref;return La(t,i),r=Qi(e,t,n,r,a,i),null===e||Sa?(t.effectTag|=1,Ca(e,t,r,i),t.child):(t.updateQueue=e.updateQueue,t.effectTag&=-517,e.expirationTime<=i&&(e.expirationTime=0),Va(e,t,i))}function wa(e,t,n,r,i,a){if(null===e){var o=n.type;return"function"!=typeof o||Wr(o)||void 0!==o.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=Kr(n.type,null,r,null,t.mode,a)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=o,Pa(e,t,o,r,i,a))}return o=e.child,i<a&&(i=o.memoizedProps,(n=null!==(n=n.compare)?n:en)(i,r)&&e.ref===t.ref)?Va(e,t,a):(t.effectTag|=1,(e=Yr(o,r)).ref=t.ref,e.return=t,t.child=e)}function Pa(e,t,n,r,i,a){return null!==e&&en(e.memoizedProps,r)&&e.ref===t.ref&&(Sa=!1,i<a)?Va(e,t,a):Aa(e,t,n,r,a)}function Ta(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.effectTag|=128)}function Aa(e,t,n,r,i){var a=Dr(n)?Vr:Ir.current;return a=Or(t,a),La(t,i),n=Qi(e,t,n,r,a,i),null===e||Sa?(t.effectTag|=1,Ca(e,t,n,i),t.child):(t.updateQueue=e.updateQueue,t.effectTag&=-517,e.expirationTime<=i&&(e.expirationTime=0),Va(e,t,i))}function Ea(e,t,n,r,i){if(Dr(n)){var a=!0;Fr(t)}else a=!1;if(La(t,i),null===t.stateNode)null!==e&&(e.alternate=null,t.alternate=null,t.effectTag|=2),si(t,n,r),li(t,n,r,i),r=!0;else if(null===e){var o=t.stateNode,u=t.memoizedProps;o.props=u;var s=o.context,c=n.contextType;"object"==typeof c&&null!==c?c=za(c):c=Or(t,c=Dr(n)?Vr:Ir.current);var l=n.getDerivedStateFromProps,f="function"==typeof l||"function"==typeof o.getSnapshotBeforeUpdate;f||"function"!=typeof o.UNSAFE_componentWillReceiveProps&&"function"!=typeof o.componentWillReceiveProps||(u!==r||s!==c)&&ci(t,o,r,c),Wa=!1;var d=t.memoizedState;s=o.state=d;var p=t.updateQueue;null!==p&&(to(t,p,r,o,i),s=t.memoizedState),u!==r||d!==s||Mr.current||Wa?("function"==typeof l&&(ai(t,n,l,r),s=t.memoizedState),(u=Wa||ui(t,n,u,r,d,s,c))?(f||"function"!=typeof o.UNSAFE_componentWillMount&&"function"!=typeof o.componentWillMount||("function"==typeof o.componentWillMount&&o.componentWillMount(),"function"==typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount()),"function"==typeof o.componentDidMount&&(t.effectTag|=4)):("function"==typeof o.componentDidMount&&(t.effectTag|=4),t.memoizedProps=r,t.memoizedState=s),o.props=r,o.state=s,o.context=c,r=u):("function"==typeof o.componentDidMount&&(t.effectTag|=4),r=!1)}else o=t.stateNode,u=t.memoizedProps,o.props=t.type===t.elementType?u:ri(t.type,u),s=o.context,"object"==typeof(c=n.contextType)&&null!==c?c=za(c):c=Or(t,c=Dr(n)?Vr:Ir.current),(f="function"==typeof(l=n.getDerivedStateFromProps)||"function"==typeof o.getSnapshotBeforeUpdate)||"function"!=typeof o.UNSAFE_componentWillReceiveProps&&"function"!=typeof o.componentWillReceiveProps||(u!==r||s!==c)&&ci(t,o,r,c),Wa=!1,s=t.memoizedState,d=o.state=s,null!==(p=t.updateQueue)&&(to(t,p,r,o,i),d=t.memoizedState),u!==r||s!==d||Mr.current||Wa?("function"==typeof l&&(ai(t,n,l,r),d=t.memoizedState),(l=Wa||ui(t,n,u,r,s,d,c))?(f||"function"!=typeof o.UNSAFE_componentWillUpdate&&"function"!=typeof o.componentWillUpdate||("function"==typeof o.componentWillUpdate&&o.componentWillUpdate(r,d,c),"function"==typeof o.UNSAFE_componentWillUpdate&&o.UNSAFE_componentWillUpdate(r,d,c)),"function"==typeof o.componentDidUpdate&&(t.effectTag|=4),"function"==typeof o.getSnapshotBeforeUpdate&&(t.effectTag|=256)):("function"!=typeof o.componentDidUpdate||u===e.memoizedProps&&s===e.memoizedState||(t.effectTag|=4),"function"!=typeof o.getSnapshotBeforeUpdate||u===e.memoizedProps&&s===e.memoizedState||(t.effectTag|=256),t.memoizedProps=r,t.memoizedState=d),o.props=r,o.state=d,o.context=c,r=l):("function"!=typeof o.componentDidUpdate||u===e.memoizedProps&&s===e.memoizedState||(t.effectTag|=4),"function"!=typeof o.getSnapshotBeforeUpdate||u===e.memoizedProps&&s===e.memoizedState||(t.effectTag|=256),r=!1);return ka(e,t,n,r,a,i)}function ka(e,t,n,r,i,a){Ta(e,t);var o=0!=(64&t.effectTag);if(!r&&!o)return i&&Lr(t,n,!1),Va(e,t,a);r=t.stateNode,_a.current=t;var u=o&&"function"!=typeof n.getDerivedStateFromError?null:r.render();return t.effectTag|=1,null!==e&&o?(t.child=mi(t,e.child,null,a),t.child=mi(t,null,u,a)):Ca(e,t,u,a),t.memoizedState=r.state,i&&Lr(t,n,!0),t.child}function Ia(e){var t=e.stateNode;t.pendingContext?Nr(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Nr(0,t.context,!1),Ci(e,t.containerInfo)}function Ma(e,t,n){var r=t.mode,i=t.pendingProps,a=t.memoizedState;if(0==(64&t.effectTag)){a=null;var o=!1}else a={timedOutAt:null!==a?a.timedOutAt:0},o=!0,t.effectTag&=-65;if(null===e)if(o){var u=i.fallback;e=Xr(null,r,0,null),0==(1&t.mode)&&(e.child=null!==t.memoizedState?t.child.child:t.child),r=Xr(u,r,n,null),e.sibling=r,(n=e).return=r.return=t}else n=r=yi(t,null,i.children,n);else null!==e.memoizedState?(u=(r=e.child).sibling,o?(n=i.fallback,i=Yr(r,r.pendingProps),0==(1&t.mode)&&((o=null!==t.memoizedState?t.child.child:t.child)!==r.child&&(i.child=o)),r=i.sibling=Yr(u,n,u.expirationTime),n=i,i.childExpirationTime=0,n.return=r.return=t):n=r=mi(t,r.child,i.children,n)):(u=e.child,o?(o=i.fallback,(i=Xr(null,r,0,null)).child=u,0==(1&t.mode)&&(i.child=null!==t.memoizedState?t.child.child:t.child),(r=i.sibling=Xr(o,r,n,null)).effectTag|=2,n=i,i.childExpirationTime=0,n.return=r.return=t):r=n=mi(t,u,i.children,n)),t.stateNode=e.stateNode;return t.memoizedState=a,t.child=n,r}function Va(e,t,n){if(null!==e&&(t.contextDependencies=e.contextDependencies),t.childExpirationTime<n)return null;if(null!==e&&t.child!==e.child&&o("153"),null!==t.child){for(n=Yr(e=t.child,e.pendingProps,e.expirationTime),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Yr(e,e.pendingProps,e.expirationTime)).return=t;n.sibling=null}return t.child}function Oa(e,t,n){var r=t.expirationTime;if(null!==e){if(e.memoizedProps!==t.pendingProps||Mr.current)Sa=!0;else if(r<n){switch(Sa=!1,t.tag){case 3:Ia(t),ga();break;case 5:wi(t);break;case 1:Dr(t.type)&&Fr(t);break;case 4:Ci(t,t.stateNode.containerInfo);break;case 10:Ba(t,t.memoizedProps.value);break;case 13:if(null!==t.memoizedState)return 0!==(r=t.child.childExpirationTime)&&r>=n?Ma(e,t,n):null!==(t=Va(e,t,n))?t.sibling:null}return Va(e,t,n)}}else Sa=!1;switch(t.expirationTime=0,t.tag){case 2:r=t.elementType,null!==e&&(e.alternate=null,t.alternate=null,t.effectTag|=2),e=t.pendingProps;var i=Or(t,Ir.current);if(La(t,n),i=Qi(null,t,r,e,i,n),t.effectTag|=1,"object"==typeof i&&null!==i&&"function"==typeof i.render&&void 0===i.$$typeof){if(t.tag=1,Zi(),Dr(r)){var a=!0;Fr(t)}else a=!1;t.memoizedState=null!==i.state&&void 0!==i.state?i.state:null;var u=r.getDerivedStateFromProps;"function"==typeof u&&ai(t,r,u,e),i.updater=oi,t.stateNode=i,i._reactInternalFiber=t,li(t,r,e,n),t=ka(null,t,r,!0,a,n)}else t.tag=0,Ca(null,t,i,n),t=t.child;return t;case 16:switch(i=t.elementType,null!==e&&(e.alternate=null,t.alternate=null,t.effectTag|=2),a=t.pendingProps,e=function(e){var t=e._result;switch(e._status){case 1:return t;case 2:case 0:throw t;default:switch(e._status=0,(t=(t=e._ctor)()).then(function(t){0===e._status&&(t=t.default,e._status=1,e._result=t)},function(t){0===e._status&&(e._status=2,e._result=t)}),e._status){case 1:return e._result;case 2:throw e._result}throw e._result=t,t}}(i),t.type=e,i=t.tag=function(e){if("function"==typeof e)return Wr(e)?1:0;if(null!=e){if((e=e.$$typeof)===tt)return 11;if(e===rt)return 14}return 2}(e),a=ri(e,a),u=void 0,i){case 0:u=Aa(null,t,e,a,n);break;case 1:u=Ea(null,t,e,a,n);break;case 11:u=xa(null,t,e,a,n);break;case 14:u=wa(null,t,e,ri(e.type,a),r,n);break;default:o("306",e,"")}return u;case 0:return r=t.type,i=t.pendingProps,Aa(e,t,r,i=t.elementType===r?i:ri(r,i),n);case 1:return r=t.type,i=t.pendingProps,Ea(e,t,r,i=t.elementType===r?i:ri(r,i),n);case 3:return Ia(t),null===(r=t.updateQueue)&&o("282"),i=null!==(i=t.memoizedState)?i.element:null,to(t,r,t.pendingProps,null,n),(r=t.memoizedState.element)===i?(ga(),t=Va(e,t,n)):(i=t.stateNode,(i=(null===e||null===e.child)&&i.hydrate)&&(da=wr(t.stateNode.containerInfo),fa=t,i=pa=!0),i?(t.effectTag|=2,t.child=yi(t,null,r,n)):(Ca(e,t,r,n),ga()),t=t.child),t;case 5:return wi(t),null===e&&ya(t),r=t.type,i=t.pendingProps,a=null!==e?e.memoizedProps:null,u=i.children,br(r,i)?u=null:null!==a&&br(r,a)&&(t.effectTag|=16),Ta(e,t),1!==n&&1&t.mode&&i.hidden?(t.expirationTime=t.childExpirationTime=1,t=null):(Ca(e,t,u,n),t=t.child),t;case 6:return null===e&&ya(t),null;case 13:return Ma(e,t,n);case 4:return Ci(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=mi(t,null,r,n):Ca(e,t,r,n),t.child;case 11:return r=t.type,i=t.pendingProps,xa(e,t,r,i=t.elementType===r?i:ri(r,i),n);case 7:return Ca(e,t,t.pendingProps,n),t.child;case 8:case 12:return Ca(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(r=t.type._context,i=t.pendingProps,u=t.memoizedProps,Ba(t,a=i.value),null!==u){var s=u.value;if(0===(a=Jt(s,a)?0:0|("function"==typeof r._calculateChangedBits?r._calculateChangedBits(s,a):1073741823))){if(u.children===i.children&&!Mr.current){t=Va(e,t,n);break e}}else for(null!==(s=t.child)&&(s.return=t);null!==s;){var c=s.contextDependencies;if(null!==c){u=s.child;for(var l=c.first;null!==l;){if(l.context===r&&0!=(l.observedBits&a)){1===s.tag&&((l=Xa(n)).tag=qa,Za(s,l)),s.expirationTime<n&&(s.expirationTime=n),null!==(l=s.alternate)&&l.expirationTime<n&&(l.expirationTime=n),l=n;for(var f=s.return;null!==f;){var d=f.alternate;if(f.childExpirationTime<l)f.childExpirationTime=l,null!==d&&d.childExpirationTime<l&&(d.childExpirationTime=l);else{if(!(null!==d&&d.childExpirationTime<l))break;d.childExpirationTime=l}f=f.return}c.expirationTime<n&&(c.expirationTime=n);break}l=l.next}}else u=10===s.tag&&s.type===t.type?null:s.child;if(null!==u)u.return=s;else for(u=s;null!==u;){if(u===t){u=null;break}if(null!==(s=u.sibling)){s.return=u.return,u=s;break}u=u.return}s=u}}Ca(e,t,i.children,n),t=t.child}return t;case 9:return i=t.type,r=(a=t.pendingProps).children,La(t,n),r=r(i=za(i,a.unstable_observedBits)),t.effectTag|=1,Ca(e,t,r,n),t.child;case 14:return a=ri(i=t.type,t.pendingProps),wa(e,t,i,a=ri(i.type,a),r,n);case 15:return Pa(e,t,t.type,t.pendingProps,r,n);case 17:return r=t.type,i=t.pendingProps,i=t.elementType===r?i:ri(r,i),null!==e&&(e.alternate=null,t.alternate=null,t.effectTag|=2),t.tag=1,Dr(r)?(e=!0,Fr(t)):e=!1,La(t,n),si(t,r,i),li(t,r,i,n),ka(null,t,r,!0,e,n)}o("156")}var Da={current:null},Ra=null,ja=null,Na=null;function Ba(e,t){var n=e.type._context;Er(Da,n._currentValue),n._currentValue=t}function Fa(e){var t=Da.current;Ar(Da),e.type._context._currentValue=t}function La(e,t){Ra=e,Na=ja=null;var n=e.contextDependencies;null!==n&&n.expirationTime>=t&&(Sa=!0),e.contextDependencies=null}function za(e,t){return Na!==e&&!1!==t&&0!==t&&("number"==typeof t&&1073741823!==t||(Na=e,t=1073741823),t={context:e,observedBits:t,next:null},null===ja?(null===Ra&&o("308"),ja=t,Ra.contextDependencies={first:t,expirationTime:0}):ja=ja.next=t),e._currentValue}var Ua=0,Ga=1,qa=2,Ha=3,Wa=!1;function Ya(e){return{baseState:e,firstUpdate:null,lastUpdate:null,firstCapturedUpdate:null,lastCapturedUpdate:null,firstEffect:null,lastEffect:null,firstCapturedEffect:null,lastCapturedEffect:null}}function Ka(e){return{baseState:e.baseState,firstUpdate:e.firstUpdate,lastUpdate:e.lastUpdate,firstCapturedUpdate:null,lastCapturedUpdate:null,firstEffect:null,lastEffect:null,firstCapturedEffect:null,lastCapturedEffect:null}}function Xa(e){return{expirationTime:e,tag:Ua,payload:null,callback:null,next:null,nextEffect:null}}function Qa(e,t){null===e.lastUpdate?e.firstUpdate=e.lastUpdate=t:(e.lastUpdate.next=t,e.lastUpdate=t)}function Za(e,t){var n=e.alternate;if(null===n){var r=e.updateQueue,i=null;null===r&&(r=e.updateQueue=Ya(e.memoizedState))}else r=e.updateQueue,i=n.updateQueue,null===r?null===i?(r=e.updateQueue=Ya(e.memoizedState),i=n.updateQueue=Ya(n.memoizedState)):r=e.updateQueue=Ka(i):null===i&&(i=n.updateQueue=Ka(r));null===i||r===i?Qa(r,t):null===r.lastUpdate||null===i.lastUpdate?(Qa(r,t),Qa(i,t)):(Qa(r,t),i.lastUpdate=t)}function Ja(e,t){var n=e.updateQueue;null===(n=null===n?e.updateQueue=Ya(e.memoizedState):$a(e,n)).lastCapturedUpdate?n.firstCapturedUpdate=n.lastCapturedUpdate=t:(n.lastCapturedUpdate.next=t,n.lastCapturedUpdate=t)}function $a(e,t){var n=e.alternate;return null!==n&&t===n.updateQueue&&(t=e.updateQueue=Ka(t)),t}function eo(e,t,n,r,a,o){switch(n.tag){case Ga:return"function"==typeof(e=n.payload)?e.call(o,r,a):e;case Ha:e.effectTag=-2049&e.effectTag|64;case Ua:if(null==(a="function"==typeof(e=n.payload)?e.call(o,r,a):e))break;return i({},r,a);case qa:Wa=!0}return r}function to(e,t,n,r,i){Wa=!1;for(var a=(t=$a(e,t)).baseState,o=null,u=0,s=t.firstUpdate,c=a;null!==s;){var l=s.expirationTime;l<i?(null===o&&(o=s,a=c),u<l&&(u=l)):(c=eo(e,0,s,c,n,r),null!==s.callback&&(e.effectTag|=32,s.nextEffect=null,null===t.lastEffect?t.firstEffect=t.lastEffect=s:(t.lastEffect.nextEffect=s,t.lastEffect=s))),s=s.next}for(l=null,s=t.firstCapturedUpdate;null!==s;){var f=s.expirationTime;f<i?(null===l&&(l=s,null===o&&(a=c)),u<f&&(u=f)):(c=eo(e,0,s,c,n,r),null!==s.callback&&(e.effectTag|=32,s.nextEffect=null,null===t.lastCapturedEffect?t.firstCapturedEffect=t.lastCapturedEffect=s:(t.lastCapturedEffect.nextEffect=s,t.lastCapturedEffect=s))),s=s.next}null===o&&(t.lastUpdate=null),null===l?t.lastCapturedUpdate=null:e.effectTag|=32,null===o&&null===l&&(a=c),t.baseState=a,t.firstUpdate=o,t.firstCapturedUpdate=l,e.expirationTime=u,e.memoizedState=c}function no(e,t,n){null!==t.firstCapturedUpdate&&(null!==t.lastUpdate&&(t.lastUpdate.next=t.firstCapturedUpdate,t.lastUpdate=t.lastCapturedUpdate),t.firstCapturedUpdate=t.lastCapturedUpdate=null),ro(t.firstEffect,n),t.firstEffect=t.lastEffect=null,ro(t.firstCapturedEffect,n),t.firstCapturedEffect=t.lastCapturedEffect=null}function ro(e,t){for(;null!==e;){var n=e.callback;if(null!==n){e.callback=null;var r=t;"function"!=typeof n&&o("191",n),n.call(r)}e=e.nextEffect}}function io(e,t){return{value:e,source:t,stack:st(t)}}function ao(e){e.effectTag|=4}var oo=void 0,uo=void 0,so=void 0,co=void 0;oo=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},uo=function(){},so=function(e,t,n,r,a){var o=e.memoizedProps;if(o!==r){var u=t.stateNode;switch(Si(bi.current),e=null,n){case"input":o=gt(u,o),r=gt(u,r),e=[];break;case"option":o=Yn(u,o),r=Yn(u,r),e=[];break;case"select":o=i({},o,{value:void 0}),r=i({},r,{value:void 0}),e=[];break;case"textarea":o=Xn(u,o),r=Xn(u,r),e=[];break;default:"function"!=typeof o.onClick&&"function"==typeof r.onClick&&(u.onclick=hr)}fr(n,r),u=n=void 0;var s=null;for(n in o)if(!r.hasOwnProperty(n)&&o.hasOwnProperty(n)&&null!=o[n])if("style"===n){var c=o[n];for(u in c)c.hasOwnProperty(u)&&(s||(s={}),s[u]="")}else"dangerouslySetInnerHTML"!==n&&"children"!==n&&"suppressContentEditableWarning"!==n&&"suppressHydrationWarning"!==n&&"autoFocus"!==n&&(g.hasOwnProperty(n)?e||(e=[]):(e=e||[]).push(n,null));for(n in r){var l=r[n];if(c=null!=o?o[n]:void 0,r.hasOwnProperty(n)&&l!==c&&(null!=l||null!=c))if("style"===n)if(c){for(u in c)!c.hasOwnProperty(u)||l&&l.hasOwnProperty(u)||(s||(s={}),s[u]="");for(u in l)l.hasOwnProperty(u)&&c[u]!==l[u]&&(s||(s={}),s[u]=l[u])}else s||(e||(e=[]),e.push(n,s)),s=l;else"dangerouslySetInnerHTML"===n?(l=l?l.__html:void 0,c=c?c.__html:void 0,null!=l&&c!==l&&(e=e||[]).push(n,""+l)):"children"===n?c===l||"string"!=typeof l&&"number"!=typeof l||(e=e||[]).push(n,""+l):"suppressContentEditableWarning"!==n&&"suppressHydrationWarning"!==n&&(g.hasOwnProperty(n)?(null!=l&&pr(a,n),e||c===l||(e=[])):(e=e||[]).push(n,l))}s&&(e=e||[]).push("style",s),a=e,(t.updateQueue=a)&&ao(t)}},co=function(e,t,n,r){n!==r&&ao(t)};var lo="function"==typeof WeakSet?WeakSet:Set;function fo(e,t){var n=t.source,r=t.stack;null===r&&null!==n&&(r=st(n)),null!==n&&ut(n.type),t=t.value,null!==e&&1===e.tag&&ut(e.type);try{console.error(t)}catch(e){setTimeout(function(){throw e})}}function po(e){var t=e.ref;if(null!==t)if("function"==typeof t)try{t(null)}catch(t){Ko(e,t)}else t.current=null}function ho(e,t,n){if(null!==(n=null!==(n=n.updateQueue)?n.lastEffect:null)){var r=n=n.next;do{if((r.tag&e)!==Ti){var i=r.destroy;r.destroy=void 0,void 0!==i&&i()}(r.tag&t)!==Ti&&(i=r.create,r.destroy=i()),r=r.next}while(r!==n)}}function mo(e){switch("function"==typeof Ur&&Ur(e),e.tag){case 0:case 11:case 14:case 15:var t=e.updateQueue;if(null!==t&&null!==(t=t.lastEffect)){var n=t=t.next;do{var r=n.destroy;if(void 0!==r){var i=e;try{r()}catch(e){Ko(i,e)}}n=n.next}while(n!==t)}break;case 1:if(po(e),"function"==typeof(t=e.stateNode).componentWillUnmount)try{t.props=e.memoizedProps,t.state=e.memoizedState,t.componentWillUnmount()}catch(t){Ko(e,t)}break;case 5:po(e);break;case 4:bo(e)}}function yo(e){return 5===e.tag||3===e.tag||4===e.tag}function vo(e){e:{for(var t=e.return;null!==t;){if(yo(t)){var n=t;break e}t=t.return}o("160"),n=void 0}var r=t=void 0;switch(n.tag){case 5:t=n.stateNode,r=!1;break;case 3:case 4:t=n.stateNode.containerInfo,r=!0;break;default:o("161")}16&n.effectTag&&(ar(t,""),n.effectTag&=-17);e:t:for(n=e;;){for(;null===n.sibling;){if(null===n.return||yo(n.return)){n=null;break e}n=n.return}for(n.sibling.return=n.return,n=n.sibling;5!==n.tag&&6!==n.tag&&18!==n.tag;){if(2&n.effectTag)continue t;if(null===n.child||4===n.tag)continue t;n.child.return=n,n=n.child}if(!(2&n.effectTag)){n=n.stateNode;break e}}for(var i=e;;){if(5===i.tag||6===i.tag)if(n)if(r){var a=t,u=i.stateNode,s=n;8===a.nodeType?a.parentNode.insertBefore(u,s):a.insertBefore(u,s)}else t.insertBefore(i.stateNode,n);else r?(u=t,s=i.stateNode,8===u.nodeType?(a=u.parentNode).insertBefore(s,u):(a=u).appendChild(s),null!=(u=u._reactRootContainer)||null!==a.onclick||(a.onclick=hr)):t.appendChild(i.stateNode);else if(4!==i.tag&&null!==i.child){i.child.return=i,i=i.child;continue}if(i===e)break;for(;null===i.sibling;){if(null===i.return||i.return===e)return;i=i.return}i.sibling.return=i.return,i=i.sibling}}function bo(e){for(var t=e,n=!1,r=void 0,i=void 0;;){if(!n){n=t.return;e:for(;;){switch(null===n&&o("160"),n.tag){case 5:r=n.stateNode,i=!1;break e;case 3:case 4:r=n.stateNode.containerInfo,i=!0;break e}n=n.return}n=!0}if(5===t.tag||6===t.tag){e:for(var a=t,u=a;;)if(mo(u),null!==u.child&&4!==u.tag)u.child.return=u,u=u.child;else{if(u===a)break;for(;null===u.sibling;){if(null===u.return||u.return===a)break e;u=u.return}u.sibling.return=u.return,u=u.sibling}i?(a=r,u=t.stateNode,8===a.nodeType?a.parentNode.removeChild(u):a.removeChild(u)):r.removeChild(t.stateNode)}else if(4===t.tag){if(null!==t.child){r=t.stateNode.containerInfo,i=!0,t.child.return=t,t=t.child;continue}}else if(mo(t),null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return;4===(t=t.return).tag&&(n=!1)}t.sibling.return=t.return,t=t.sibling}}function go(e,t){switch(t.tag){case 0:case 11:case 14:case 15:ho(Ei,ki,t);break;case 1:break;case 5:var n=t.stateNode;if(null!=n){var r=t.memoizedProps;e=null!==e?e.memoizedProps:r;var i=t.type,a=t.updateQueue;t.updateQueue=null,null!==a&&function(e,t,n,r,i){e[D]=i,"input"===n&&"radio"===i.type&&null!=i.name&&St(e,i),dr(n,r),r=dr(n,i);for(var a=0;a<t.length;a+=2){var o=t[a],u=t[a+1];"style"===o?cr(e,u):"dangerouslySetInnerHTML"===o?ir(e,u):"children"===o?ar(e,u):vt(e,o,u,r)}switch(n){case"input":Ct(e,i);break;case"textarea":Zn(e,i);break;case"select":t=e._wrapperState.wasMultiple,e._wrapperState.wasMultiple=!!i.multiple,null!=(n=i.value)?Kn(e,!!i.multiple,n,!1):t!==!!i.multiple&&(null!=i.defaultValue?Kn(e,!!i.multiple,i.defaultValue,!0):Kn(e,!!i.multiple,i.multiple?[]:"",!1))}}(n,a,i,e,r)}break;case 6:null===t.stateNode&&o("162"),t.stateNode.nodeValue=t.memoizedProps;break;case 3:case 12:break;case 13:if(n=t.memoizedState,r=void 0,e=t,null===n?r=!1:(r=!0,e=t.child,0===n.timedOutAt&&(n.timedOutAt=Cu())),null!==e&&function(e,t){for(var n=e;;){if(5===n.tag){var r=n.stateNode;if(t)r.style.display="none";else{r=n.stateNode;var i=n.memoizedProps.style;i=null!=i&&i.hasOwnProperty("display")?i.display:null,r.style.display=sr("display",i)}}else if(6===n.tag)n.stateNode.nodeValue=t?"":n.memoizedProps;else{if(13===n.tag&&null!==n.memoizedState){(r=n.child.sibling).return=n,n=r;continue}if(null!==n.child){n.child.return=n,n=n.child;continue}}if(n===e)break;for(;null===n.sibling;){if(null===n.return||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}}(e,r),null!==(n=t.updateQueue)){t.updateQueue=null;var u=t.stateNode;null===u&&(u=t.stateNode=new lo),n.forEach(function(e){var n=function(e,t){var n=e.stateNode;null!==n&&n.delete(t),t=Xo(t=Cu(),e),null!==(e=Zo(e,t))&&($r(e,t),0!==(t=e.expirationTime)&&xu(e,t))}.bind(null,t,e);u.has(e)||(u.add(e),e.then(n,n))})}break;case 17:break;default:o("163")}}var _o="function"==typeof WeakMap?WeakMap:Map;function So(e,t,n){(n=Xa(n)).tag=Ha,n.payload={element:null};var r=t.value;return n.callback=function(){Vu(r),fo(e,t)},n}function Co(e,t,n){(n=Xa(n)).tag=Ha;var r=e.type.getDerivedStateFromError;if("function"==typeof r){var i=t.value;n.payload=function(){return r(i)}}var a=e.stateNode;return null!==a&&"function"==typeof a.componentDidCatch&&(n.callback=function(){"function"!=typeof r&&(null===Bo?Bo=new Set([this]):Bo.add(this));var n=t.value,i=t.stack;fo(e,t),this.componentDidCatch(n,{componentStack:null!==i?i:""})}),n}function xo(e){switch(e.tag){case 1:Dr(e.type)&&Rr();var t=e.effectTag;return 2048&t?(e.effectTag=-2049&t|64,e):null;case 3:return xi(),jr(),0!=(64&(t=e.effectTag))&&o("285"),e.effectTag=-2049&t|64,e;case 5:return Pi(e),null;case 13:return 2048&(t=e.effectTag)?(e.effectTag=-2049&t|64,e):null;case 18:return null;case 4:return xi(),null;case 10:return Fa(e),null;default:return null}}var wo=qe.ReactCurrentDispatcher,Po=qe.ReactCurrentOwner,To=1073741822,Ao=!1,Eo=null,ko=null,Io=0,Mo=-1,Vo=!1,Oo=null,Do=!1,Ro=null,jo=null,No=null,Bo=null;function Fo(){if(null!==Eo)for(var e=Eo.return;null!==e;){var t=e;switch(t.tag){case 1:var n=t.type.childContextTypes;null!=n&&Rr();break;case 3:xi(),jr();break;case 5:Pi(t);break;case 4:xi();break;case 10:Fa(t)}e=e.return}ko=null,Io=0,Mo=-1,Vo=!1,Eo=null}function Lo(){for(;null!==Oo;){var e=Oo.effectTag;if(16&e&&ar(Oo.stateNode,""),128&e){var t=Oo.alternate;null!==t&&(null!==(t=t.ref)&&("function"==typeof t?t(null):t.current=null))}switch(14&e){case 2:vo(Oo),Oo.effectTag&=-3;break;case 6:vo(Oo),Oo.effectTag&=-3,go(Oo.alternate,Oo);break;case 4:go(Oo.alternate,Oo);break;case 8:bo(e=Oo),e.return=null,e.child=null,e.memoizedState=null,e.updateQueue=null,null!==(e=e.alternate)&&(e.return=null,e.child=null,e.memoizedState=null,e.updateQueue=null)}Oo=Oo.nextEffect}}function zo(){for(;null!==Oo;){if(256&Oo.effectTag)e:{var e=Oo.alternate,t=Oo;switch(t.tag){case 0:case 11:case 15:ho(Ai,Ti,t);break e;case 1:if(256&t.effectTag&&null!==e){var n=e.memoizedProps,r=e.memoizedState;t=(e=t.stateNode).getSnapshotBeforeUpdate(t.elementType===t.type?n:ri(t.type,n),r),e.__reactInternalSnapshotBeforeUpdate=t}break e;case 3:case 5:case 6:case 4:case 17:break e;default:o("163")}}Oo=Oo.nextEffect}}function Uo(e,t){for(;null!==Oo;){var n=Oo.effectTag;if(36&n){var r=Oo.alternate,i=Oo,a=t;switch(i.tag){case 0:case 11:case 15:ho(Ii,Mi,i);break;case 1:var u=i.stateNode;if(4&i.effectTag)if(null===r)u.componentDidMount();else{var s=i.elementType===i.type?r.memoizedProps:ri(i.type,r.memoizedProps);u.componentDidUpdate(s,r.memoizedState,u.__reactInternalSnapshotBeforeUpdate)}null!==(r=i.updateQueue)&&no(0,r,u);break;case 3:if(null!==(r=i.updateQueue)){if(u=null,null!==i.child)switch(i.child.tag){case 5:u=i.child.stateNode;break;case 1:u=i.child.stateNode}no(0,r,u)}break;case 5:a=i.stateNode,null===r&&4&i.effectTag&&vr(i.type,i.memoizedProps)&&a.focus();break;case 6:case 4:case 12:case 13:case 17:break;default:o("163")}}128&n&&(null!==(i=Oo.ref)&&(a=Oo.stateNode,"function"==typeof i?i(a):i.current=a)),512&n&&(Ro=e),Oo=Oo.nextEffect}}function Go(){null!==jo&&Cr(jo),null!==No&&No()}function qo(e,t){Do=Ao=!0,e.current===t&&o("177");var n=e.pendingCommitExpirationTime;0===n&&o("261"),e.pendingCommitExpirationTime=0;var r=t.expirationTime,i=t.childExpirationTime;for(function(e,t){if(e.didError=!1,0===t)e.earliestPendingTime=0,e.latestPendingTime=0,e.earliestSuspendedTime=0,e.latestSuspendedTime=0,e.latestPingedTime=0;else{t<e.latestPingedTime&&(e.latestPingedTime=0);var n=e.latestPendingTime;0!==n&&(n>t?e.earliestPendingTime=e.latestPendingTime=0:e.earliestPendingTime>t&&(e.earliestPendingTime=e.latestPendingTime)),0===(n=e.earliestSuspendedTime)?$r(e,t):t<e.latestSuspendedTime?(e.earliestSuspendedTime=0,e.latestSuspendedTime=0,e.latestPingedTime=0,$r(e,t)):t>n&&$r(e,t)}ni(0,e)}(e,i>r?i:r),Po.current=null,r=void 0,1<t.effectTag?null!==t.lastEffect?(t.lastEffect.nextEffect=t,r=t.firstEffect):r=t:r=t.firstEffect,mr=wn,yr=function(){var e=jn();if(Nn(e)){if("selectionStart"in e)var t={start:e.selectionStart,end:e.selectionEnd};else e:{var n=(t=(t=e.ownerDocument)&&t.defaultView||window).getSelection&&t.getSelection();if(n&&0!==n.rangeCount){t=n.anchorNode;var r=n.anchorOffset,i=n.focusNode;n=n.focusOffset;try{t.nodeType,i.nodeType}catch(e){t=null;break e}var a=0,o=-1,u=-1,s=0,c=0,l=e,f=null;t:for(;;){for(var d;l!==t||0!==r&&3!==l.nodeType||(o=a+r),l!==i||0!==n&&3!==l.nodeType||(u=a+n),3===l.nodeType&&(a+=l.nodeValue.length),null!==(d=l.firstChild);)f=l,l=d;for(;;){if(l===e)break t;if(f===t&&++s===r&&(o=a),f===i&&++c===n&&(u=a),null!==(d=l.nextSibling))break;f=(l=f).parentNode}l=d}t=-1===o||-1===u?null:{start:o,end:u}}else t=null}t=t||{start:0,end:0}}else t=null;return{focusedElem:e,selectionRange:t}}(),wn=!1,Oo=r;null!==Oo;){i=!1;var u=void 0;try{zo()}catch(e){i=!0,u=e}i&&(null===Oo&&o("178"),Ko(Oo,u),null!==Oo&&(Oo=Oo.nextEffect))}for(Oo=r;null!==Oo;){i=!1,u=void 0;try{Lo()}catch(e){i=!0,u=e}i&&(null===Oo&&o("178"),Ko(Oo,u),null!==Oo&&(Oo=Oo.nextEffect))}for(Bn(yr),yr=null,wn=!!mr,mr=null,e.current=t,Oo=r;null!==Oo;){i=!1,u=void 0;try{Uo(e,n)}catch(e){i=!0,u=e}i&&(null===Oo&&o("178"),Ko(Oo,u),null!==Oo&&(Oo=Oo.nextEffect))}if(null!==r&&null!==Ro){var s=function(e,t){No=jo=Ro=null;var n=iu;iu=!0;do{if(512&t.effectTag){var r=!1,i=void 0;try{var a=t;ho(Oi,Ti,a),ho(Ti,Vi,a)}catch(e){r=!0,i=e}r&&Ko(t,i)}t=t.nextEffect}while(null!==t);iu=n,0!==(n=e.expirationTime)&&xu(e,n),lu||iu||Eu(1073741823,!1)}.bind(null,e,r);jo=a.unstable_runWithPriority(a.unstable_NormalPriority,function(){return Sr(s)}),No=s}Ao=Do=!1,"function"==typeof zr&&zr(t.stateNode),n=t.expirationTime,0===(t=(t=t.childExpirationTime)>n?t:n)&&(Bo=null),function(e,t){e.expirationTime=t,e.finishedWork=null}(e,t)}function Ho(e){for(;;){var t=e.alternate,n=e.return,r=e.sibling;if(0==(1024&e.effectTag)){Eo=e;e:{var a=t,u=Io,s=(t=e).pendingProps;switch(t.tag){case 2:case 16:break;case 15:case 0:break;case 1:Dr(t.type)&&Rr();break;case 3:xi(),jr(),(s=t.stateNode).pendingContext&&(s.context=s.pendingContext,s.pendingContext=null),null!==a&&null!==a.child||(ba(t),t.effectTag&=-3),uo(t);break;case 5:Pi(t);var c=Si(_i.current);if(u=t.type,null!==a&&null!=t.stateNode)so(a,t,u,s,c),a.ref!==t.ref&&(t.effectTag|=128);else if(s){var l=Si(bi.current);if(ba(t)){a=(s=t).stateNode;var f=s.type,d=s.memoizedProps,p=c;switch(a[O]=s,a[D]=d,u=void 0,c=f){case"iframe":case"object":Pn("load",a);break;case"video":case"audio":for(f=0;f<te.length;f++)Pn(te[f],a);break;case"source":Pn("error",a);break;case"img":case"image":case"link":Pn("error",a),Pn("load",a);break;case"form":Pn("reset",a),Pn("submit",a);break;case"details":Pn("toggle",a);break;case"input":_t(a,d),Pn("invalid",a),pr(p,"onChange");break;case"select":a._wrapperState={wasMultiple:!!d.multiple},Pn("invalid",a),pr(p,"onChange");break;case"textarea":Qn(a,d),Pn("invalid",a),pr(p,"onChange")}for(u in fr(c,d),f=null,d)d.hasOwnProperty(u)&&(l=d[u],"children"===u?"string"==typeof l?a.textContent!==l&&(f=["children",l]):"number"==typeof l&&a.textContent!==""+l&&(f=["children",""+l]):g.hasOwnProperty(u)&&null!=l&&pr(p,u));switch(c){case"input":Ue(a),xt(a,d,!0);break;case"textarea":Ue(a),Jn(a);break;case"select":case"option":break;default:"function"==typeof d.onClick&&(a.onclick=hr)}u=f,s.updateQueue=u,(s=null!==u)&&ao(t)}else{d=t,a=u,p=s,f=9===c.nodeType?c:c.ownerDocument,l===$n.html&&(l=er(a)),l===$n.html?"script"===a?((a=f.createElement("div")).innerHTML="<script><\/script>",f=a.removeChild(a.firstChild)):"string"==typeof p.is?f=f.createElement(a,{is:p.is}):(f=f.createElement(a),"select"===a&&p.multiple&&(f.multiple=!0)):f=f.createElementNS(l,a),(a=f)[O]=d,a[D]=s,oo(a,t,!1,!1),p=a;var h=c,m=dr(f=u,d=s);switch(f){case"iframe":case"object":Pn("load",p),c=d;break;case"video":case"audio":for(c=0;c<te.length;c++)Pn(te[c],p);c=d;break;case"source":Pn("error",p),c=d;break;case"img":case"image":case"link":Pn("error",p),Pn("load",p),c=d;break;case"form":Pn("reset",p),Pn("submit",p),c=d;break;case"details":Pn("toggle",p),c=d;break;case"input":_t(p,d),c=gt(p,d),Pn("invalid",p),pr(h,"onChange");break;case"option":c=Yn(p,d);break;case"select":p._wrapperState={wasMultiple:!!d.multiple},c=i({},d,{value:void 0}),Pn("invalid",p),pr(h,"onChange");break;case"textarea":Qn(p,d),c=Xn(p,d),Pn("invalid",p),pr(h,"onChange");break;default:c=d}fr(f,c),l=void 0;var y=f,v=p,b=c;for(l in b)if(b.hasOwnProperty(l)){var _=b[l];"style"===l?cr(v,_):"dangerouslySetInnerHTML"===l?null!=(_=_?_.__html:void 0)&&ir(v,_):"children"===l?"string"==typeof _?("textarea"!==y||""!==_)&&ar(v,_):"number"==typeof _&&ar(v,""+_):"suppressContentEditableWarning"!==l&&"suppressHydrationWarning"!==l&&"autoFocus"!==l&&(g.hasOwnProperty(l)?null!=_&&pr(h,l):null!=_&&vt(v,l,_,m))}switch(f){case"input":Ue(p),xt(p,d,!1);break;case"textarea":Ue(p),Jn(p);break;case"option":null!=d.value&&p.setAttribute("value",""+bt(d.value));break;case"select":(c=p).multiple=!!d.multiple,null!=(p=d.value)?Kn(c,!!d.multiple,p,!1):null!=d.defaultValue&&Kn(c,!!d.multiple,d.defaultValue,!0);break;default:"function"==typeof c.onClick&&(p.onclick=hr)}(s=vr(u,s))&&ao(t),t.stateNode=a}null!==t.ref&&(t.effectTag|=128)}else null===t.stateNode&&o("166");break;case 6:a&&null!=t.stateNode?co(a,t,a.memoizedProps,s):("string"!=typeof s&&(null===t.stateNode&&o("166")),a=Si(_i.current),Si(bi.current),ba(t)?(u=(s=t).stateNode,a=s.memoizedProps,u[O]=s,(s=u.nodeValue!==a)&&ao(t)):(u=t,(s=(9===a.nodeType?a:a.ownerDocument).createTextNode(s))[O]=t,u.stateNode=s));break;case 11:break;case 13:if(s=t.memoizedState,0!=(64&t.effectTag)){t.expirationTime=u,Eo=t;break e}s=null!==s,u=null!==a&&null!==a.memoizedState,null!==a&&!s&&u&&(null!==(a=a.child.sibling)&&(null!==(c=t.firstEffect)?(t.firstEffect=a,a.nextEffect=c):(t.firstEffect=t.lastEffect=a,a.nextEffect=null),a.effectTag=8)),(s||u)&&(t.effectTag|=4);break;case 7:case 8:case 12:break;case 4:xi(),uo(t);break;case 10:Fa(t);break;case 9:case 14:break;case 17:Dr(t.type)&&Rr();break;case 18:break;default:o("156")}Eo=null}if(t=e,1===Io||1!==t.childExpirationTime){for(s=0,u=t.child;null!==u;)(a=u.expirationTime)>s&&(s=a),(c=u.childExpirationTime)>s&&(s=c),u=u.sibling;t.childExpirationTime=s}if(null!==Eo)return Eo;null!==n&&0==(1024&n.effectTag)&&(null===n.firstEffect&&(n.firstEffect=e.firstEffect),null!==e.lastEffect&&(null!==n.lastEffect&&(n.lastEffect.nextEffect=e.firstEffect),n.lastEffect=e.lastEffect),1<e.effectTag&&(null!==n.lastEffect?n.lastEffect.nextEffect=e:n.firstEffect=e,n.lastEffect=e))}else{if(null!==(e=xo(e)))return e.effectTag&=1023,e;null!==n&&(n.firstEffect=n.lastEffect=null,n.effectTag|=1024)}if(null!==r)return r;if(null===n)break;e=n}return null}function Wo(e){var t=Oa(e.alternate,e,Io);return e.memoizedProps=e.pendingProps,null===t&&(t=Ho(e)),Po.current=null,t}function Yo(e,t){Ao&&o("243"),Go(),Ao=!0;var n=wo.current;wo.current=sa;var r=e.nextExpirationTimeToWorkOn;r===Io&&e===ko&&null!==Eo||(Fo(),Io=r,Eo=Yr((ko=e).current,null),e.pendingCommitExpirationTime=0);for(var i=!1;;){try{if(t)for(;null!==Eo&&!Tu();)Eo=Wo(Eo);else for(;null!==Eo;)Eo=Wo(Eo)}catch(t){if(Na=ja=Ra=null,Zi(),null===Eo)i=!0,Vu(t);else{null===Eo&&o("271");var a=Eo,u=a.return;if(null!==u){e:{var s=e,c=u,l=a,f=t;if(u=Io,l.effectTag|=1024,l.firstEffect=l.lastEffect=null,null!==f&&"object"==typeof f&&"function"==typeof f.then){var d=f;f=c;var p=-1,h=-1;do{if(13===f.tag){var m=f.alternate;if(null!==m&&null!==(m=m.memoizedState)){h=10*(1073741822-m.timedOutAt);break}"number"==typeof(m=f.pendingProps.maxDuration)&&(0>=m?p=0:(-1===p||m<p)&&(p=m))}f=f.return}while(null!==f);f=c;do{if((m=13===f.tag)&&(m=void 0!==f.memoizedProps.fallback&&null===f.memoizedState),m){if(null===(c=f.updateQueue)?((c=new Set).add(d),f.updateQueue=c):c.add(d),0==(1&f.mode)){f.effectTag|=64,l.effectTag&=-1957,1===l.tag&&(null===l.alternate?l.tag=17:((u=Xa(1073741823)).tag=qa,Za(l,u))),l.expirationTime=1073741823;break e}c=u;var y=(l=s).pingCache;null===y?(y=l.pingCache=new _o,m=new Set,y.set(d,m)):void 0===(m=y.get(d))&&(m=new Set,y.set(d,m)),m.has(c)||(m.add(c),l=Qo.bind(null,l,d,c),d.then(l,l)),-1===p?s=1073741823:(-1===h&&(h=10*(1073741822-ti(s,u))-5e3),s=h+p),0<=s&&Mo<s&&(Mo=s),f.effectTag|=2048,f.expirationTime=u;break e}f=f.return}while(null!==f);f=Error((ut(l.type)||"A React component")+" suspended while rendering, but no fallback UI was specified.\n\nAdd a <Suspense fallback=...> component higher in the tree to provide a loading indicator or placeholder to display."+st(l))}Vo=!0,f=io(f,l),s=c;do{switch(s.tag){case 3:s.effectTag|=2048,s.expirationTime=u,Ja(s,u=So(s,f,u));break e;case 1:if(p=f,h=s.type,l=s.stateNode,0==(64&s.effectTag)&&("function"==typeof h.getDerivedStateFromError||null!==l&&"function"==typeof l.componentDidCatch&&(null===Bo||!Bo.has(l)))){s.effectTag|=2048,s.expirationTime=u,Ja(s,u=Co(s,p,u));break e}}s=s.return}while(null!==s)}Eo=Ho(a);continue}i=!0,Vu(t)}}break}if(Ao=!1,wo.current=n,Na=ja=Ra=null,Zi(),i)ko=null,e.finishedWork=null;else if(null!==Eo)e.finishedWork=null;else{if(null===(n=e.current.alternate)&&o("281"),ko=null,Vo){if(i=e.latestPendingTime,a=e.latestSuspendedTime,u=e.latestPingedTime,0!==i&&i<r||0!==a&&a<r||0!==u&&u<r)return ei(e,r),void Su(e,n,r,e.expirationTime,-1);if(!e.didError&&t)return e.didError=!0,r=e.nextExpirationTimeToWorkOn=r,t=e.expirationTime=1073741823,void Su(e,n,r,t,-1)}t&&-1!==Mo?(ei(e,r),(t=10*(1073741822-ti(e,r)))<Mo&&(Mo=t),t=10*(1073741822-Cu()),t=Mo-t,Su(e,n,r,e.expirationTime,0>t?0:t)):(e.pendingCommitExpirationTime=r,e.finishedWork=n)}}function Ko(e,t){for(var n=e.return;null!==n;){switch(n.tag){case 1:var r=n.stateNode;if("function"==typeof n.type.getDerivedStateFromError||"function"==typeof r.componentDidCatch&&(null===Bo||!Bo.has(r)))return Za(n,e=Co(n,e=io(t,e),1073741823)),void Jo(n,1073741823);break;case 3:return Za(n,e=So(n,e=io(t,e),1073741823)),void Jo(n,1073741823)}n=n.return}3===e.tag&&(Za(e,n=So(e,n=io(t,e),1073741823)),Jo(e,1073741823))}function Xo(e,t){var n=a.unstable_getCurrentPriorityLevel(),r=void 0;if(0==(1&t.mode))r=1073741823;else if(Ao&&!Do)r=Io;else{switch(n){case a.unstable_ImmediatePriority:r=1073741823;break;case a.unstable_UserBlockingPriority:r=1073741822-10*(1+((1073741822-e+15)/10|0));break;case a.unstable_NormalPriority:r=1073741822-25*(1+((1073741822-e+500)/25|0));break;case a.unstable_LowPriority:case a.unstable_IdlePriority:r=1;break;default:o("313")}null!==ko&&r===Io&&--r}return n===a.unstable_UserBlockingPriority&&(0===uu||r<uu)&&(uu=r),r}function Qo(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),null!==ko&&Io===n?ko=null:(t=e.earliestSuspendedTime,r=e.latestSuspendedTime,0!==t&&n<=t&&n>=r&&(e.didError=!1,(0===(t=e.latestPingedTime)||t>n)&&(e.latestPingedTime=n),ni(n,e),0!==(n=e.expirationTime)&&xu(e,n)))}function Zo(e,t){e.expirationTime<t&&(e.expirationTime=t);var n=e.alternate;null!==n&&n.expirationTime<t&&(n.expirationTime=t);var r=e.return,i=null;if(null===r&&3===e.tag)i=e.stateNode;else for(;null!==r;){if(n=r.alternate,r.childExpirationTime<t&&(r.childExpirationTime=t),null!==n&&n.childExpirationTime<t&&(n.childExpirationTime=t),null===r.return&&3===r.tag){i=r.stateNode;break}r=r.return}return i}function Jo(e,t){null!==(e=Zo(e,t))&&(!Ao&&0!==Io&&t>Io&&Fo(),$r(e,t),Ao&&!Do&&ko===e||xu(e,e.expirationTime),vu>yu&&(vu=0,o("185")))}function $o(e,t,n,r,i){return a.unstable_runWithPriority(a.unstable_ImmediatePriority,function(){return e(t,n,r,i)})}var eu=null,tu=null,nu=0,ru=void 0,iu=!1,au=null,ou=0,uu=0,su=!1,cu=null,lu=!1,fu=!1,du=null,pu=a.unstable_now(),hu=1073741822-(pu/10|0),mu=hu,yu=50,vu=0,bu=null;function gu(){hu=1073741822-((a.unstable_now()-pu)/10|0)}function _u(e,t){if(0!==nu){if(t<nu)return;null!==ru&&a.unstable_cancelCallback(ru)}nu=t,e=a.unstable_now()-pu,ru=a.unstable_scheduleCallback(Au,{timeout:10*(1073741822-t)-e})}function Su(e,t,n,r,i){e.expirationTime=r,0!==i||Tu()?0<i&&(e.timeoutHandle=gr(function(e,t,n){e.pendingCommitExpirationTime=n,e.finishedWork=t,gu(),mu=hu,ku(e,n)}.bind(null,e,t,n),i)):(e.pendingCommitExpirationTime=n,e.finishedWork=t)}function Cu(){return iu?mu:(wu(),0!==ou&&1!==ou||(gu(),mu=hu),mu)}function xu(e,t){null===e.nextScheduledRoot?(e.expirationTime=t,null===tu?(eu=tu=e,e.nextScheduledRoot=e):(tu=tu.nextScheduledRoot=e).nextScheduledRoot=eu):t>e.expirationTime&&(e.expirationTime=t),iu||(lu?fu&&(au=e,ou=1073741823,Iu(e,1073741823,!1)):1073741823===t?Eu(1073741823,!1):_u(e,t))}function wu(){var e=0,t=null;if(null!==tu)for(var n=tu,r=eu;null!==r;){var i=r.expirationTime;if(0===i){if((null===n||null===tu)&&o("244"),r===r.nextScheduledRoot){eu=tu=r.nextScheduledRoot=null;break}if(r===eu)eu=i=r.nextScheduledRoot,tu.nextScheduledRoot=i,r.nextScheduledRoot=null;else{if(r===tu){(tu=n).nextScheduledRoot=eu,r.nextScheduledRoot=null;break}n.nextScheduledRoot=r.nextScheduledRoot,r.nextScheduledRoot=null}r=n.nextScheduledRoot}else{if(i>e&&(e=i,t=r),r===tu)break;if(1073741823===e)break;n=r,r=r.nextScheduledRoot}}au=t,ou=e}var Pu=!1;function Tu(){return!!Pu||!!a.unstable_shouldYield()&&(Pu=!0)}function Au(){try{if(!Tu()&&null!==eu){gu();var e=eu;do{var t=e.expirationTime;0!==t&&hu<=t&&(e.nextExpirationTimeToWorkOn=hu),e=e.nextScheduledRoot}while(e!==eu)}Eu(0,!0)}finally{Pu=!1}}function Eu(e,t){if(wu(),t)for(gu(),mu=hu;null!==au&&0!==ou&&e<=ou&&!(Pu&&hu>ou);)Iu(au,ou,hu>ou),wu(),gu(),mu=hu;else for(;null!==au&&0!==ou&&e<=ou;)Iu(au,ou,!1),wu();if(t&&(nu=0,ru=null),0!==ou&&_u(au,ou),vu=0,bu=null,null!==du)for(e=du,du=null,t=0;t<e.length;t++){var n=e[t];try{n._onComplete()}catch(e){su||(su=!0,cu=e)}}if(su)throw e=cu,cu=null,su=!1,e}function ku(e,t){iu&&o("253"),au=e,ou=t,Iu(e,t,!1),Eu(1073741823,!1)}function Iu(e,t,n){if(iu&&o("245"),iu=!0,n){var r=e.finishedWork;null!==r?Mu(e,r,t):(e.finishedWork=null,-1!==(r=e.timeoutHandle)&&(e.timeoutHandle=-1,_r(r)),Yo(e,n),null!==(r=e.finishedWork)&&(Tu()?e.finishedWork=r:Mu(e,r,t)))}else null!==(r=e.finishedWork)?Mu(e,r,t):(e.finishedWork=null,-1!==(r=e.timeoutHandle)&&(e.timeoutHandle=-1,_r(r)),Yo(e,n),null!==(r=e.finishedWork)&&Mu(e,r,t));iu=!1}function Mu(e,t,n){var r=e.firstBatch;if(null!==r&&r._expirationTime>=n&&(null===du?du=[r]:du.push(r),r._defer))return e.finishedWork=t,void(e.expirationTime=0);e.finishedWork=null,e===bu?vu++:(bu=e,vu=0),a.unstable_runWithPriority(a.unstable_ImmediatePriority,function(){qo(e,t)})}function Vu(e){null===au&&o("246"),au.expirationTime=0,su||(su=!0,cu=e)}function Ou(e,t){var n=lu;lu=!0;try{return e(t)}finally{(lu=n)||iu||Eu(1073741823,!1)}}function Du(e,t){if(lu&&!fu){fu=!0;try{return e(t)}finally{fu=!1}}return e(t)}function Ru(e,t,n){lu||iu||0===uu||(Eu(uu,!1),uu=0);var r=lu;lu=!0;try{return a.unstable_runWithPriority(a.unstable_UserBlockingPriority,function(){return e(t,n)})}finally{(lu=r)||iu||Eu(1073741823,!1)}}function ju(e,t,n,r,i){var a=t.current;e:if(n){t:{2===tn(n=n._reactInternalFiber)&&1===n.tag||o("170");var u=n;do{switch(u.tag){case 3:u=u.stateNode.context;break t;case 1:if(Dr(u.type)){u=u.stateNode.__reactInternalMemoizedMergedChildContext;break t}}u=u.return}while(null!==u);o("171"),u=void 0}if(1===n.tag){var s=n.type;if(Dr(s)){n=Br(n,s,u);break e}}n=u}else n=kr;return null===t.context?t.context=n:t.pendingContext=n,t=i,(i=Xa(r)).payload={element:e},null!==(t=void 0===t?null:t)&&(i.callback=t),Go(),Za(a,i),Jo(a,r),r}function Nu(e,t,n,r){var i=t.current;return ju(e,t,n,i=Xo(Cu(),i),r)}function Bu(e){if(!(e=e.current).child)return null;switch(e.child.tag){case 5:default:return e.child.stateNode}}function Fu(e){var t=1073741822-25*(1+((1073741822-Cu()+500)/25|0));t>=To&&(t=To-1),this._expirationTime=To=t,this._root=e,this._callbacks=this._next=null,this._hasChildren=this._didComplete=!1,this._children=null,this._defer=!0}function Lu(){this._callbacks=null,this._didCommit=!1,this._onCommit=this._onCommit.bind(this)}function zu(e,t,n){e={current:t=Hr(3,null,null,t?3:0),containerInfo:e,pendingChildren:null,pingCache:null,earliestPendingTime:0,latestPendingTime:0,earliestSuspendedTime:0,latestSuspendedTime:0,latestPingedTime:0,didError:!1,pendingCommitExpirationTime:0,finishedWork:null,timeoutHandle:-1,context:null,pendingContext:null,hydrate:n,nextExpirationTimeToWorkOn:0,expirationTime:0,firstBatch:null,nextScheduledRoot:null},this._internalRoot=t.stateNode=e}function Uu(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function Gu(e,t,n,r,i){var a=n._reactRootContainer;if(a){if("function"==typeof i){var o=i;i=function(){var e=Bu(a._internalRoot);o.call(e)}}null!=e?a.legacy_renderSubtreeIntoContainer(e,t,i):a.render(t,i)}else{if(a=n._reactRootContainer=function(e,t){if(t||(t=!(!(t=e?9===e.nodeType?e.documentElement:e.firstChild:null)||1!==t.nodeType||!t.hasAttribute("data-reactroot"))),!t)for(var n;n=e.lastChild;)e.removeChild(n);return new zu(e,!1,t)}(n,r),"function"==typeof i){var u=i;i=function(){var e=Bu(a._internalRoot);u.call(e)}}Du(function(){null!=e?a.legacy_renderSubtreeIntoContainer(e,t,i):a.render(t,i)})}return Bu(a._internalRoot)}function qu(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;return Uu(t)||o("200"),function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:Ke,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}}(e,t,null,n)}Te=function(e,t,n){switch(t){case"input":if(Ct(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var i=B(r);i||o("90"),Ge(r),Ct(r,i)}}}break;case"textarea":Zn(e,n);break;case"select":null!=(t=n.value)&&Kn(e,!!n.multiple,t,!1)}},Fu.prototype.render=function(e){this._defer||o("250"),this._hasChildren=!0,this._children=e;var t=this._root._internalRoot,n=this._expirationTime,r=new Lu;return ju(e,t,null,n,r._onCommit),r},Fu.prototype.then=function(e){if(this._didComplete)e();else{var t=this._callbacks;null===t&&(t=this._callbacks=[]),t.push(e)}},Fu.prototype.commit=function(){var e=this._root._internalRoot,t=e.firstBatch;if(this._defer&&null!==t||o("251"),this._hasChildren){var n=this._expirationTime;if(t!==this){this._hasChildren&&(n=this._expirationTime=t._expirationTime,this.render(this._children));for(var r=null,i=t;i!==this;)r=i,i=i._next;null===r&&o("251"),r._next=i._next,this._next=t,e.firstBatch=this}this._defer=!1,ku(e,n),t=this._next,this._next=null,null!==(t=e.firstBatch=t)&&t._hasChildren&&t.render(t._children)}else this._next=null,this._defer=!1},Fu.prototype._onComplete=function(){if(!this._didComplete){this._didComplete=!0;var e=this._callbacks;if(null!==e)for(var t=0;t<e.length;t++)(0,e[t])()}},Lu.prototype.then=function(e){if(this._didCommit)e();else{var t=this._callbacks;null===t&&(t=this._callbacks=[]),t.push(e)}},Lu.prototype._onCommit=function(){if(!this._didCommit){this._didCommit=!0;var e=this._callbacks;if(null!==e)for(var t=0;t<e.length;t++){var n=e[t];"function"!=typeof n&&o("191",n),n()}}},zu.prototype.render=function(e,t){var n=this._internalRoot,r=new Lu;return null!==(t=void 0===t?null:t)&&r.then(t),Nu(e,n,null,r._onCommit),r},zu.prototype.unmount=function(e){var t=this._internalRoot,n=new Lu;return null!==(e=void 0===e?null:e)&&n.then(e),Nu(null,t,null,n._onCommit),n},zu.prototype.legacy_renderSubtreeIntoContainer=function(e,t,n){var r=this._internalRoot,i=new Lu;return null!==(n=void 0===n?null:n)&&i.then(n),Nu(t,r,e,i._onCommit),i},zu.prototype.createBatch=function(){var e=new Fu(this),t=e._expirationTime,n=this._internalRoot,r=n.firstBatch;if(null===r)n.firstBatch=e,e._next=null;else{for(n=null;null!==r&&r._expirationTime>=t;)n=r,r=r._next;e._next=r,null!==n&&(n._next=e)}return e},Ve=Ou,Oe=Ru,De=function(){iu||0===uu||(Eu(uu,!1),uu=0)};var Hu={createPortal:qu,findDOMNode:function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternalFiber;return void 0===t&&("function"==typeof e.render?o("188"):o("268",Object.keys(e))),e=null===(e=rn(t))?null:e.stateNode},hydrate:function(e,t,n){return Uu(t)||o("200"),Gu(null,e,t,!0,n)},render:function(e,t,n){return Uu(t)||o("200"),Gu(null,e,t,!1,n)},unstable_renderSubtreeIntoContainer:function(e,t,n,r){return Uu(n)||o("200"),(null==e||void 0===e._reactInternalFiber)&&o("38"),Gu(e,t,n,!1,r)},unmountComponentAtNode:function(e){return Uu(e)||o("40"),!!e._reactRootContainer&&(Du(function(){Gu(null,null,e,!1,function(){e._reactRootContainer=null})}),!0)},unstable_createPortal:function(){return qu.apply(void 0,arguments)},unstable_batchedUpdates:Ou,unstable_interactiveUpdates:Ru,flushSync:function(e,t){iu&&o("187");var n=lu;lu=!0;try{return $o(e,t)}finally{lu=n,Eu(1073741823,!1)}},unstable_createRoot:function(e,t){return Uu(e)||o("299","unstable_createRoot"),new zu(e,!0,null!=t&&!0===t.hydrate)},unstable_flushControlled:function(e){var t=lu;lu=!0;try{$o(e)}finally{(lu=t)||iu||Eu(1073741823,!1)}},__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:{Events:[j,N,B,k.injectEventPluginsByName,b,q,function(e){T(e,G)},Ie,Me,En,M]}};!function(e){var t=e.findFiberByHostInstance;(function(e){if("undefined"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__)return!1;var t=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(t.isDisabled||!t.supportsFiber)return!0;try{var n=t.inject(e);zr=Gr(function(e){return t.onCommitFiberRoot(n,e)}),Ur=Gr(function(e){return t.onCommitFiberUnmount(n,e)})}catch(e){}})(i({},e,{overrideProps:null,currentDispatcherRef:qe.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=rn(e))?null:e.stateNode},findFiberByHostInstance:function(e){return t?t(e):null}}))}({findFiberByHostInstance:R,bundleType:0,version:"16.8.2",rendererPackageName:"react-dom"});var Wu={default:Hu},Yu=Wu&&Hu||Wu;e.exports=Yu.default||Yu},function(e,t,n){"use strict";e.exports=n(562)},function(e,t,n){"use strict";(function(e){
/** @license React v0.13.2
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
Object.defineProperty(t,"__esModule",{value:!0});var n=null,r=!1,i=3,a=-1,o=-1,u=!1,s=!1;function c(){if(!u){var e=n.expirationTime;s?x():s=!0,C(d,e)}}function l(){var e=n,t=n.next;if(n===t)n=null;else{var r=n.previous;n=r.next=t,t.previous=r}e.next=e.previous=null,r=e.callback,t=e.expirationTime,e=e.priorityLevel;var a=i,u=o;i=e,o=t;try{var s=r()}finally{i=a,o=u}if("function"==typeof s)if(s={callback:s,priorityLevel:e,expirationTime:t,next:null,previous:null},null===n)n=s.next=s.previous=s;else{r=null,e=n;do{if(e.expirationTime>=t){r=e;break}e=e.next}while(e!==n);null===r?r=n:r===n&&(n=s,c()),(t=r.previous).next=r.previous=s,s.next=r,s.previous=t}}function f(){if(-1===a&&null!==n&&1===n.priorityLevel){u=!0;try{do{l()}while(null!==n&&1===n.priorityLevel)}finally{u=!1,null!==n?c():s=!1}}}function d(e){u=!0;var i=r;r=e;try{if(e)for(;null!==n;){var a=t.unstable_now();if(!(n.expirationTime<=a))break;do{l()}while(null!==n&&n.expirationTime<=a)}else if(null!==n)do{l()}while(null!==n&&!w())}finally{u=!1,r=i,null!==n?c():s=!1,f()}}var p,h,m=Date,y="function"==typeof setTimeout?setTimeout:void 0,v="function"==typeof clearTimeout?clearTimeout:void 0,b="function"==typeof requestAnimationFrame?requestAnimationFrame:void 0,g="function"==typeof cancelAnimationFrame?cancelAnimationFrame:void 0;function _(e){p=b(function(t){v(h),e(t)}),h=y(function(){g(p),e(t.unstable_now())},100)}if("object"==typeof performance&&"function"==typeof performance.now){var S=performance;t.unstable_now=function(){return S.now()}}else t.unstable_now=function(){return m.now()};var C,x,w,P=null;if("undefined"!=typeof window?P=window:void 0!==e&&(P=e),P&&P._schedMock){var T=P._schedMock;C=T[0],x=T[1],w=T[2],t.unstable_now=T[3]}else if("undefined"==typeof window||"function"!=typeof MessageChannel){var A=null,E=function(e){if(null!==A)try{A(e)}finally{A=null}};C=function(e){null!==A?setTimeout(C,0,e):(A=e,setTimeout(E,0,!1))},x=function(){A=null},w=function(){return!1}}else{"undefined"!=typeof console&&("function"!=typeof b&&console.error("This browser doesn't support requestAnimationFrame. Make sure that you load a polyfill in older browsers. https://fb.me/react-polyfills"),"function"!=typeof g&&console.error("This browser doesn't support cancelAnimationFrame. Make sure that you load a polyfill in older browsers. https://fb.me/react-polyfills"));var k=null,I=!1,M=-1,V=!1,O=!1,D=0,R=33,j=33;w=function(){return D<=t.unstable_now()};var N=new MessageChannel,B=N.port2;N.port1.onmessage=function(){I=!1;var e=k,n=M;k=null,M=-1;var r=t.unstable_now(),i=!1;if(0>=D-r){if(!(-1!==n&&n<=r))return V||(V=!0,_(F)),k=e,void(M=n);i=!0}if(null!==e){O=!0;try{e(i)}finally{O=!1}}};var F=function(e){if(null!==k){_(F);var t=e-D+j;t<j&&R<j?(8>t&&(t=8),j=t<R?R:t):R=t,D=e+j,I||(I=!0,B.postMessage(void 0))}else V=!1};C=function(e,t){k=e,M=t,O||0>t?B.postMessage(void 0):V||(V=!0,_(F))},x=function(){k=null,I=!1,M=-1}}t.unstable_ImmediatePriority=1,t.unstable_UserBlockingPriority=2,t.unstable_NormalPriority=3,t.unstable_IdlePriority=5,t.unstable_LowPriority=4,t.unstable_runWithPriority=function(e,n){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var r=i,o=a;i=e,a=t.unstable_now();try{return n()}finally{i=r,a=o,f()}},t.unstable_next=function(e){switch(i){case 1:case 2:case 3:var n=3;break;default:n=i}var r=i,o=a;i=n,a=t.unstable_now();try{return e()}finally{i=r,a=o,f()}},t.unstable_scheduleCallback=function(e,r){var o=-1!==a?a:t.unstable_now();if("object"==typeof r&&null!==r&&"number"==typeof r.timeout)r=o+r.timeout;else switch(i){case 1:r=o+-1;break;case 2:r=o+250;break;case 5:r=o+1073741823;break;case 4:r=o+1e4;break;default:r=o+5e3}if(e={callback:e,priorityLevel:i,expirationTime:r,next:null,previous:null},null===n)n=e.next=e.previous=e,c();else{o=null;var u=n;do{if(u.expirationTime>r){o=u;break}u=u.next}while(u!==n);null===o?o=n:o===n&&(n=e,c()),(r=o.previous).next=o.previous=e,e.next=o,e.previous=r}return e},t.unstable_cancelCallback=function(e){var t=e.next;if(null!==t){if(t===e)n=null;else{e===n&&(n=t);var r=e.previous;r.next=t,t.previous=r}e.next=e.previous=null}},t.unstable_wrapCallback=function(e){var n=i;return function(){var r=i,o=a;i=n,a=t.unstable_now();try{return e.apply(this,arguments)}finally{i=r,a=o,f()}}},t.unstable_getCurrentPriorityLevel=function(){return i},t.unstable_shouldYield=function(){return!r&&(null!==n&&n.expirationTime<o||w())},t.unstable_continueExecution=function(){null!==n&&c()},t.unstable_pauseExecution=function(){},t.unstable_getFirstCallbackNode=function(){return n}}).call(this,n(132))},function(e,t,n){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.Action=function(e,t){return{action:e,customControl:t&&t.customControl,autoUpdate:t&&t.autoUpdate}},e.Behavior=function(e,t){return{transformer:e,defaultParams:t}}}(r||(r={})),t.PluginSpec=r},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{s(r.next(e))}catch(e){a(e)}}function u(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,u)}s((r=r.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}};Object.defineProperty(t,"__esModule",{value:!0});var a=n(565),o=n(26),u=n(157),s=n(27),c=n(37),l=n(3);t.AnimateModelIndex=a.PluginStateAnimation.create({name:"built-in.animate-model-index",display:{name:"Animate Model Index"},params:function(){return{mode:l.ParamDefinition.MappedStatic("once",{once:l.ParamDefinition.Group({direction:l.ParamDefinition.Select("forward",[["forward","Forward"],["backward","Backward"]])},{isFlat:!0}),palindrome:l.ParamDefinition.Group({}),loop:l.ParamDefinition.Group({})},{options:[["once","Once"],["palindrome","Palindrome"],["loop","Loop"]]}),maxFPS:l.ParamDefinition.Numeric(3,{min:.5,max:30,step:.5})}},initialState:function(){return{}},apply:function(e,t,n){return r(this,void 0,void 0,function(){var r,a,l,f,d,p,h,m,y,v;return i(this,function(i){switch(i.label){case 0:if(t.current>0&&t.current-t.lastApplied<1e3/n.params.maxFPS)return[2,{kind:"skip"}];for(r=n.plugin.state.dataState,a=r.selectQ(function(e){return e.rootsOfType(o.PluginStateObject.Molecule.Model).filter(function(e){return e.transform.transformer===u.StateTransforms.Model.ModelFromTrajectory})}),l=r.build(),f=n.params,d=e.palindromeDirections||{},p=!1,h=function(e){var t=s.StateSelection.findAncestorOfType(r.tree,r.cells,e.transform.ref,[o.PluginStateObject.Molecule.Trajectory]);if(!t||!t.obj)return"continue";var n=t.obj;l.to(e.transform.ref).update(u.StateTransforms.Model.ModelFromTrajectory,function(t){var r=n.data.length,i=1;if("once"===f.mode.name){if(-1===(i="backward"===f.mode.params.direction?-1:1)&&0===t.modelIndex||1===i&&t.modelIndex===r-1)return p=!0,t}else"palindrome"===f.mode.name&&(i=0===t.modelIndex?1:t.modelIndex===r-1?-1:d[e.transform.ref]||1);d[e.transform.ref]=i;var a=(t.modelIndex+i)%r;return a<0&&(a+=r),p=p||-1===i&&0===a||1===i&&a===r-1,{modelIndex:a}})},m=0,y=a;m<y.length;m++)v=y[m],h(v);return[4,c.PluginCommands.State.Update.dispatch(n.plugin,{state:r,tree:l,doNotLogTiming:!0})];case 1:return i.sent(),"once"===f.mode.name&&p?[2,{kind:"finished"}]:"palindrome"===f.mode.name?[2,{kind:"next",state:{palindromeDirections:d}}]:[2,{kind:"next",state:{}}]}})})}})},function(e,t,n){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.create=function(e){return e}}(r||(r={})),t.PluginStateAnimation=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(295),i=n(285);t.StateActions={Structure:r,Volume:i}},function(e,t,n){e.exports=n.p+"index.html"},function(e,t,n){},function(e,t,n){"use strict";n.r(t);var r=n(0),i=n(8),a=n(6);function o(e){return function(t){return t.lift(new u(e))}}var u=function(){function e(e){this.durationSelector=e}return e.prototype.call=function(e,t){return t.subscribe(new s(e,this.durationSelector))},e}(),s=function(e){function t(t,n){var r=e.call(this,t)||this;return r.durationSelector=n,r.hasValue=!1,r}return r.a(t,e),t.prototype._next=function(e){if(this.value=e,this.hasValue=!0,!this.throttled){var t=void 0;try{t=(0,this.durationSelector)(e)}catch(e){return this.destination.error(e)}var n=Object(a.a)(this,t);!n||n.closed?this.clearThrottle():this.add(this.throttled=n)}},t.prototype.clearThrottle=function(){var e=this.value,t=this.hasValue,n=this.throttled;n&&(this.remove(n),this.throttled=null,n.unsubscribe()),t&&(this.value=null,this.hasValue=!1,this.destination.next(e))},t.prototype.notifyNext=function(e,t,n,r){this.clearThrottle()},t.prototype.notifyComplete=function(){this.clearThrottle()},t}(i.a),c=n(14),l=n(168);function f(e,t){return void 0===t&&(t=c.a),o(function(){return Object(l.a)(e,t)})}function d(e){return function(t){return t.lift(new p(e))}}var p=function(){function e(e){this.closingNotifier=e}return e.prototype.call=function(e,t){return t.subscribe(new h(e,this.closingNotifier))},e}(),h=function(e){function t(t,n){var r=e.call(this,t)||this;return r.buffer=[],r.add(Object(a.a)(r,n)),r}return r.a(t,e),t.prototype._next=function(e){this.buffer.push(e)},t.prototype.notifyNext=function(e,t,n,r,i){var a=this.buffer;this.buffer=[],this.destination.next(a)},t}(i.a),m=n(1);function y(e,t){return void 0===t&&(t=null),function(n){return n.lift(new v(e,t))}}var v=function(){function e(e,t){this.bufferSize=e,this.startBufferEvery=t,this.subscriberClass=t&&e!==t?g:b}return e.prototype.call=function(e,t){return t.subscribe(new this.subscriberClass(e,this.bufferSize,this.startBufferEvery))},e}(),b=function(e){function t(t,n){var r=e.call(this,t)||this;return r.bufferSize=n,r.buffer=[],r}return r.a(t,e),t.prototype._next=function(e){var t=this.buffer;t.push(e),t.length==this.bufferSize&&(this.destination.next(t),this.buffer=[])},t.prototype._complete=function(){var t=this.buffer;t.length>0&&this.destination.next(t),e.prototype._complete.call(this)},t}(m.a),g=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.bufferSize=n,i.startBufferEvery=r,i.buffers=[],i.count=0,i}return r.a(t,e),t.prototype._next=function(e){var t=this.bufferSize,n=this.startBufferEvery,r=this.buffers,i=this.count;this.count++,i%n==0&&r.push([]);for(var a=r.length;a--;){var o=r[a];o.push(e),o.length===t&&(r.splice(a,1),this.destination.next(o))}},t.prototype._complete=function(){for(var t=this.buffers,n=this.destination;t.length>0;){var r=t.shift();r.length>0&&n.next(r)}e.prototype._complete.call(this)},t}(m.a),_=n(20);function S(e){var t=arguments.length,n=c.a;Object(_.a)(arguments[arguments.length-1])&&(n=arguments[arguments.length-1],t--);var r=null;t>=2&&(r=arguments[1]);var i=Number.POSITIVE_INFINITY;return t>=3&&(i=arguments[2]),function(t){return t.lift(new C(e,r,i,n))}}var C=function(){function e(e,t,n,r){this.bufferTimeSpan=e,this.bufferCreationInterval=t,this.maxBufferSize=n,this.scheduler=r}return e.prototype.call=function(e,t){return t.subscribe(new w(e,this.bufferTimeSpan,this.bufferCreationInterval,this.maxBufferSize,this.scheduler))},e}(),x=function(){return function(){this.buffer=[]}}(),w=function(e){function t(t,n,r,i,a){var o=e.call(this,t)||this;o.bufferTimeSpan=n,o.bufferCreationInterval=r,o.maxBufferSize=i,o.scheduler=a,o.contexts=[];var u=o.openContext();if(o.timespanOnly=null==r||r<0,o.timespanOnly){var s={subscriber:o,context:u,bufferTimeSpan:n};o.add(u.closeAction=a.schedule(P,n,s))}else{var c={subscriber:o,context:u},l={bufferTimeSpan:n,bufferCreationInterval:r,subscriber:o,scheduler:a};o.add(u.closeAction=a.schedule(A,n,c)),o.add(a.schedule(T,r,l))}return o}return r.a(t,e),t.prototype._next=function(e){for(var t,n=this.contexts,r=n.length,i=0;i<r;i++){var a=n[i],o=a.buffer;o.push(e),o.length==this.maxBufferSize&&(t=a)}t&&this.onBufferFull(t)},t.prototype._error=function(t){this.contexts.length=0,e.prototype._error.call(this,t)},t.prototype._complete=function(){for(var t=this.contexts,n=this.destination;t.length>0;){var r=t.shift();n.next(r.buffer)}e.prototype._complete.call(this)},t.prototype._unsubscribe=function(){this.contexts=null},t.prototype.onBufferFull=function(e){this.closeContext(e);var t=e.closeAction;if(t.unsubscribe(),this.remove(t),!this.closed&&this.timespanOnly){e=this.openContext();var n=this.bufferTimeSpan,r={subscriber:this,context:e,bufferTimeSpan:n};this.add(e.closeAction=this.scheduler.schedule(P,n,r))}},t.prototype.openContext=function(){var e=new x;return this.contexts.push(e),e},t.prototype.closeContext=function(e){this.destination.next(e.buffer);var t=this.contexts;(t?t.indexOf(e):-1)>=0&&t.splice(t.indexOf(e),1)},t}(m.a);function P(e){var t=e.subscriber,n=e.context;n&&t.closeContext(n),t.closed||(e.context=t.openContext(),e.context.closeAction=this.schedule(e,e.bufferTimeSpan))}function T(e){var t=e.bufferCreationInterval,n=e.bufferTimeSpan,r=e.subscriber,i=e.scheduler,a=r.openContext();r.closed||(r.add(a.closeAction=i.schedule(A,n,{subscriber:r,context:a})),this.schedule(e,t))}function A(e){var t=e.subscriber,n=e.context;t.closeContext(n)}var E=n(10);function k(e,t){return function(n){return n.lift(new I(e,t))}}var I=function(){function e(e,t){this.openings=e,this.closingSelector=t}return e.prototype.call=function(e,t){return t.subscribe(new M(e,this.openings,this.closingSelector))},e}(),M=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.openings=n,i.closingSelector=r,i.contexts=[],i.add(Object(a.a)(i,n)),i}return r.a(t,e),t.prototype._next=function(e){for(var t=this.contexts,n=t.length,r=0;r<n;r++)t[r].buffer.push(e)},t.prototype._error=function(t){for(var n=this.contexts;n.length>0;){var r=n.shift();r.subscription.unsubscribe(),r.buffer=null,r.subscription=null}this.contexts=null,e.prototype._error.call(this,t)},t.prototype._complete=function(){for(var t=this.contexts;t.length>0;){var n=t.shift();this.destination.next(n.buffer),n.subscription.unsubscribe(),n.buffer=null,n.subscription=null}this.contexts=null,e.prototype._complete.call(this)},t.prototype.notifyNext=function(e,t,n,r,i){e?this.closeBuffer(e):this.openBuffer(t)},t.prototype.notifyComplete=function(e){this.closeBuffer(e.context)},t.prototype.openBuffer=function(e){try{var t=this.closingSelector.call(this,e);t&&this.trySubscribe(t)}catch(e){this._error(e)}},t.prototype.closeBuffer=function(e){var t=this.contexts;if(t&&e){var n=e.buffer,r=e.subscription;this.destination.next(n),t.splice(t.indexOf(e),1),this.remove(r),r.unsubscribe()}},t.prototype.trySubscribe=function(e){var t=this.contexts,n=new E.a,r={buffer:[],subscription:n};t.push(r);var i=Object(a.a)(this,e,r);!i||i.closed?this.closeBuffer(r):(i.context=r,this.add(i),n.add(i))},t}(i.a);function V(e){return function(t){return t.lift(new O(e))}}var O=function(){function e(e){this.closingSelector=e}return e.prototype.call=function(e,t){return t.subscribe(new D(e,this.closingSelector))},e}(),D=function(e){function t(t,n){var r=e.call(this,t)||this;return r.closingSelector=n,r.subscribing=!1,r.openBuffer(),r}return r.a(t,e),t.prototype._next=function(e){this.buffer.push(e)},t.prototype._complete=function(){var t=this.buffer;t&&this.destination.next(t),e.prototype._complete.call(this)},t.prototype._unsubscribe=function(){this.buffer=null,this.subscribing=!1},t.prototype.notifyNext=function(e,t,n,r,i){this.openBuffer()},t.prototype.notifyComplete=function(){this.subscribing?this.complete():this.openBuffer()},t.prototype.openBuffer=function(){var e=this.closingSubscription;e&&(this.remove(e),e.unsubscribe());var t,n=this.buffer;this.buffer&&this.destination.next(n),this.buffer=[];try{t=(0,this.closingSelector)()}catch(e){return this.error(e)}e=new E.a,this.closingSubscription=e,this.add(e),this.subscribing=!0,e.add(Object(a.a)(this,t)),this.subscribing=!1},t}(i.a),R=n(30);function j(e){return function(t){var n=new N(e),r=t.lift(n);return n.caught=r}}var N=function(){function e(e){this.selector=e}return e.prototype.call=function(e,t){return t.subscribe(new B(e,this.selector,this.caught))},e}(),B=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.selector=n,i.caught=r,i}return r.a(t,e),t.prototype.error=function(t){if(!this.isStopped){var n=void 0;try{n=this.selector(t,this.caught)}catch(t){return void e.prototype.error.call(this,t)}this._unsubscribeAndRecycle();var r=new R.a(this,void 0,void 0);this.add(r),Object(a.a)(this,n,void 0,void 0,r)}},t}(i.a),F=n(105);function L(e){return function(t){return t.lift(new F.a(e))}}var z=n(15),U=n(25);function G(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=null;return"function"==typeof e[e.length-1]&&(n=e.pop()),1===e.length&&Object(z.a)(e[0])&&(e=e[0].slice()),function(t){return t.lift.call(Object(U.a)([t].concat(e)),new F.a(n))}}var q=n(49);function H(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t){return t.lift.call(q.a.apply(void 0,[t].concat(e)))}}var W=n(165),Y=n(55);function K(e,t){return Object(Y.a)(e,t,1)}function X(e,t){return K(function(){return e},t)}function Q(e){return function(t){return t.lift(new Z(e,t))}}var Z=function(){function e(e,t){this.predicate=e,this.source=t}return e.prototype.call=function(e,t){return t.subscribe(new J(e,this.predicate,this.source))},e}(),J=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.predicate=n,i.source=r,i.count=0,i.index=0,i}return r.a(t,e),t.prototype._next=function(e){this.predicate?this._tryPredicate(e):this.count++},t.prototype._tryPredicate=function(e){var t;try{t=this.predicate(e,this.index++,this.source)}catch(e){return void this.destination.error(e)}t&&this.count++},t.prototype._complete=function(){this.destination.next(this.count),this.destination.complete()},t}(m.a);function $(e){return function(t){return t.lift(new ee(e))}}var ee=function(){function e(e){this.durationSelector=e}return e.prototype.call=function(e,t){return t.subscribe(new te(e,this.durationSelector))},e}(),te=function(e){function t(t,n){var r=e.call(this,t)||this;return r.durationSelector=n,r.hasValue=!1,r.durationSubscription=null,r}return r.a(t,e),t.prototype._next=function(e){try{var t=this.durationSelector.call(this,e);t&&this._tryNext(e,t)}catch(e){this.destination.error(e)}},t.prototype._complete=function(){this.emitValue(),this.destination.complete()},t.prototype._tryNext=function(e,t){var n=this.durationSubscription;this.value=e,this.hasValue=!0,n&&(n.unsubscribe(),this.remove(n)),(n=Object(a.a)(this,t))&&!n.closed&&this.add(this.durationSubscription=n)},t.prototype.notifyNext=function(e,t,n,r,i){this.emitValue()},t.prototype.notifyComplete=function(){this.emitValue()},t.prototype.emitValue=function(){if(this.hasValue){var t=this.value,n=this.durationSubscription;n&&(this.durationSubscription=null,n.unsubscribe(),this.remove(n)),this.value=null,this.hasValue=!1,e.prototype._next.call(this,t)}},t}(i.a);function ne(e,t){return void 0===t&&(t=c.a),function(n){return n.lift(new re(e,t))}}var re=function(){function e(e,t){this.dueTime=e,this.scheduler=t}return e.prototype.call=function(e,t){return t.subscribe(new ie(e,this.dueTime,this.scheduler))},e}(),ie=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.dueTime=n,i.scheduler=r,i.debouncedSubscription=null,i.lastValue=null,i.hasValue=!1,i}return r.a(t,e),t.prototype._next=function(e){this.clearDebounce(),this.lastValue=e,this.hasValue=!0,this.add(this.debouncedSubscription=this.scheduler.schedule(ae,this.dueTime,this))},t.prototype._complete=function(){this.debouncedNext(),this.destination.complete()},t.prototype.debouncedNext=function(){if(this.clearDebounce(),this.hasValue){var e=this.lastValue;this.lastValue=null,this.hasValue=!1,this.destination.next(e)}},t.prototype.clearDebounce=function(){var e=this.debouncedSubscription;null!==e&&(this.remove(e),e.unsubscribe(),this.debouncedSubscription=null)},t}(m.a);function ae(e){e.debouncedNext()}function oe(e){return void 0===e&&(e=null),function(t){return t.lift(new ue(e))}}var ue=function(){function e(e){this.defaultValue=e}return e.prototype.call=function(e,t){return t.subscribe(new se(e,this.defaultValue))},e}(),se=function(e){function t(t,n){var r=e.call(this,t)||this;return r.defaultValue=n,r.isEmpty=!0,r}return r.a(t,e),t.prototype._next=function(e){this.isEmpty=!1,this.destination.next(e)},t.prototype._complete=function(){this.isEmpty&&this.destination.next(this.defaultValue),this.destination.complete()},t}(m.a);function ce(e){return e instanceof Date&&!isNaN(+e)}var le=n(41);function fe(e,t){void 0===t&&(t=c.a);var n=ce(e)?+e-t.now():Math.abs(e);return function(e){return e.lift(new de(n,t))}}var de=function(){function e(e,t){this.delay=e,this.scheduler=t}return e.prototype.call=function(e,t){return t.subscribe(new pe(e,this.delay,this.scheduler))},e}(),pe=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.delay=n,i.scheduler=r,i.queue=[],i.active=!1,i.errored=!1,i}return r.a(t,e),t.dispatch=function(e){for(var t=e.source,n=t.queue,r=e.scheduler,i=e.destination;n.length>0&&n[0].time-r.now()<=0;)n.shift().notification.observe(i);if(n.length>0){var a=Math.max(0,n[0].time-r.now());this.schedule(e,a)}else this.unsubscribe(),t.active=!1},t.prototype._schedule=function(e){this.active=!0,this.destination.add(e.schedule(t.dispatch,this.delay,{source:this,destination:this.destination,scheduler:e}))},t.prototype.scheduleNotification=function(e){if(!0!==this.errored){var t=this.scheduler,n=new he(t.now()+this.delay,e);this.queue.push(n),!1===this.active&&this._schedule(t)}},t.prototype._next=function(e){this.scheduleNotification(le.a.createNext(e))},t.prototype._error=function(e){this.errored=!0,this.queue=[],this.destination.error(e),this.unsubscribe()},t.prototype._complete=function(){this.scheduleNotification(le.a.createComplete()),this.unsubscribe()},t}(m.a),he=function(){return function(e,t){this.time=e,this.notification=t}}(),me=n(4);function ye(e,t){return t?function(n){return new ge(n,t).lift(new ve(e))}:function(t){return t.lift(new ve(e))}}var ve=function(){function e(e){this.delayDurationSelector=e}return e.prototype.call=function(e,t){return t.subscribe(new be(e,this.delayDurationSelector))},e}(),be=function(e){function t(t,n){var r=e.call(this,t)||this;return r.delayDurationSelector=n,r.completed=!1,r.delayNotifierSubscriptions=[],r.index=0,r}return r.a(t,e),t.prototype.notifyNext=function(e,t,n,r,i){this.destination.next(e),this.removeSubscription(i),this.tryComplete()},t.prototype.notifyError=function(e,t){this._error(e)},t.prototype.notifyComplete=function(e){var t=this.removeSubscription(e);t&&this.destination.next(t),this.tryComplete()},t.prototype._next=function(e){var t=this.index++;try{var n=this.delayDurationSelector(e,t);n&&this.tryDelay(n,e)}catch(e){this.destination.error(e)}},t.prototype._complete=function(){this.completed=!0,this.tryComplete(),this.unsubscribe()},t.prototype.removeSubscription=function(e){e.unsubscribe();var t=this.delayNotifierSubscriptions.indexOf(e);return-1!==t&&this.delayNotifierSubscriptions.splice(t,1),e.outerValue},t.prototype.tryDelay=function(e,t){var n=Object(a.a)(this,e,t);n&&!n.closed&&(this.destination.add(n),this.delayNotifierSubscriptions.push(n))},t.prototype.tryComplete=function(){this.completed&&0===this.delayNotifierSubscriptions.length&&this.destination.complete()},t}(i.a),ge=function(e){function t(t,n){var r=e.call(this)||this;return r.source=t,r.subscriptionDelay=n,r}return r.a(t,e),t.prototype._subscribe=function(e){this.subscriptionDelay.subscribe(new _e(e,this.source))},t}(me.a),_e=function(e){function t(t,n){var r=e.call(this)||this;return r.parent=t,r.source=n,r.sourceSubscribed=!1,r}return r.a(t,e),t.prototype._next=function(e){this.subscribeToSource()},t.prototype._error=function(e){this.unsubscribe(),this.parent.error(e)},t.prototype._complete=function(){this.unsubscribe(),this.subscribeToSource()},t.prototype.subscribeToSource=function(){this.sourceSubscribed||(this.sourceSubscribed=!0,this.unsubscribe(),this.source.subscribe(this.parent))},t}(m.a);function Se(){return function(e){return e.lift(new Ce)}}var Ce=function(){function e(){}return e.prototype.call=function(e,t){return t.subscribe(new xe(e))},e}(),xe=function(e){function t(t){return e.call(this,t)||this}return r.a(t,e),t.prototype._next=function(e){e.observe(this.destination)},t}(m.a);function we(e,t){return function(n){return n.lift(new Pe(e,t))}}var Pe=function(){function e(e,t){this.keySelector=e,this.flushes=t}return e.prototype.call=function(e,t){return t.subscribe(new Te(e,this.keySelector,this.flushes))},e}(),Te=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.keySelector=n,i.values=new Set,r&&i.add(Object(a.a)(i,r)),i}return r.a(t,e),t.prototype.notifyNext=function(e,t,n,r,i){this.values.clear()},t.prototype.notifyError=function(e,t){this._error(e)},t.prototype._next=function(e){this.keySelector?this._useKeySelector(e):this._finalizeNext(e,e)},t.prototype._useKeySelector=function(e){var t,n=this.destination;try{t=this.keySelector(e)}catch(e){return void n.error(e)}this._finalizeNext(t,e)},t.prototype._finalizeNext=function(e,t){var n=this.values;n.has(e)||(n.add(e),this.destination.next(t))},t}(i.a);function Ae(e,t){return function(n){return n.lift(new Ee(e,t))}}var Ee=function(){function e(e,t){this.compare=e,this.keySelector=t}return e.prototype.call=function(e,t){return t.subscribe(new ke(e,this.compare,this.keySelector))},e}(),ke=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.keySelector=r,i.hasKey=!1,"function"==typeof n&&(i.compare=n),i}return r.a(t,e),t.prototype.compare=function(e,t){return e===t},t.prototype._next=function(e){var t;try{var n=this.keySelector;t=n?n(e):e}catch(e){return this.destination.error(e)}var r=!1;if(this.hasKey)try{r=(0,this.compare)(this.key,t)}catch(e){return this.destination.error(e)}else this.hasKey=!0;r||(this.key=t,this.destination.next(e))},t}(m.a);function Ie(e,t){return Ae(function(n,r){return t?t(n[e],r[e]):n[e]===r[e]})}var Me=n(56);function Ve(e,t){return function(n){return n.lift(new Oe(e,t))}}var Oe=function(){function e(e,t){this.predicate=e,this.thisArg=t}return e.prototype.call=function(e,t){return t.subscribe(new De(e,this.predicate,this.thisArg))},e}(),De=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.predicate=n,i.thisArg=r,i.count=0,i}return r.a(t,e),t.prototype._next=function(e){var t;try{t=this.predicate.call(this.thisArg,e,this.count++)}catch(e){return void this.destination.error(e)}t&&this.destination.next(e)},t}(m.a),Re=n(33),je=n(57);function Ne(e,t,n){return function(r){return r.lift(new Be(e,t,n))}}var Be=function(){function e(e,t,n){this.nextOrObserver=e,this.error=t,this.complete=n}return e.prototype.call=function(e,t){return t.subscribe(new Fe(e,this.nextOrObserver,this.error,this.complete))},e}(),Fe=function(e){function t(t,n,r,i){var a=e.call(this,t)||this;return a._tapNext=Re.a,a._tapError=Re.a,a._tapComplete=Re.a,a._tapError=r||Re.a,a._tapComplete=i||Re.a,Object(je.a)(n)?(a._context=a,a._tapNext=n):n&&(a._context=n,a._tapNext=n.next||Re.a,a._tapError=n.error||Re.a,a._tapComplete=n.complete||Re.a),a}return r.a(t,e),t.prototype._next=function(e){try{this._tapNext.call(this._context,e)}catch(e){return void this.destination.error(e)}this.destination.next(e)},t.prototype._error=function(e){try{this._tapError.call(this._context,e)}catch(e){return void this.destination.error(e)}this.destination.error(e)},t.prototype._complete=function(){try{this._tapComplete.call(this._context)}catch(e){return void this.destination.error(e)}return this.destination.complete()},t}(m.a),Le=n(62),ze=function(e){return void 0===e&&(e=Ue),Ne({hasValue:!1,next:function(){this.hasValue=!0},complete:function(){if(!this.hasValue)throw e()}})};function Ue(){return new Le.a}var Ge=n(13);function qe(e){return function(t){return 0===e?Object(Ge.b)():t.lift(new He(e))}}var He=function(){function e(e){if(this.total=e,this.total<0)throw new Me.a}return e.prototype.call=function(e,t){return t.subscribe(new We(e,this.total))},e}(),We=function(e){function t(t,n){var r=e.call(this,t)||this;return r.total=n,r.count=0,r}return r.a(t,e),t.prototype._next=function(e){var t=this.total,n=++this.count;n<=t&&(this.destination.next(e),n===t&&(this.destination.complete(),this.unsubscribe()))},t}(m.a);function Ye(e,t){if(e<0)throw new Me.a;var n=arguments.length>=2;return function(r){return r.pipe(Ve(function(t,n){return n===e}),qe(1),n?oe(t):ze(function(){return new Me.a}))}}var Ke=n(28),Xe=n(110);function Qe(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t){var n=e[e.length-1];Object(_.a)(n)?e.pop():n=null;var r=e.length;return 1!==r||n?r>0?Object(q.a)(t,Object(Ke.a)(e,n)):Object(q.a)(t,Object(Ge.b)(n)):Object(q.a)(t,Object(Xe.a)(e[0]))}}function Ze(e,t){return function(n){return n.lift(new Je(e,t,n))}}var Je=function(){function e(e,t,n){this.predicate=e,this.thisArg=t,this.source=n}return e.prototype.call=function(e,t){return t.subscribe(new $e(e,this.predicate,this.thisArg,this.source))},e}(),$e=function(e){function t(t,n,r,i){var a=e.call(this,t)||this;return a.predicate=n,a.thisArg=r,a.source=i,a.index=0,a.thisArg=r||a,a}return r.a(t,e),t.prototype.notifyComplete=function(e){this.destination.next(e),this.destination.complete()},t.prototype._next=function(e){var t=!1;try{t=this.predicate.call(this.thisArg,e,this.index++,this.source)}catch(e){return void this.destination.error(e)}t||this.notifyComplete(!1)},t.prototype._complete=function(){this.notifyComplete(!0)},t}(m.a);function et(){return function(e){return e.lift(new tt)}}var tt=function(){function e(){}return e.prototype.call=function(e,t){return t.subscribe(new nt(e))},e}(),nt=function(e){function t(t){var n=e.call(this,t)||this;return n.hasCompleted=!1,n.hasSubscription=!1,n}return r.a(t,e),t.prototype._next=function(e){this.hasSubscription||(this.hasSubscription=!0,this.add(Object(a.a)(this,e)))},t.prototype._complete=function(){this.hasCompleted=!0,this.hasSubscription||this.destination.complete()},t.prototype.notifyComplete=function(e){this.remove(e),this.hasSubscription=!1,this.hasCompleted&&this.destination.complete()},t}(i.a),rt=n(22);function it(e,t){return t?function(n){return n.pipe(it(function(n,r){return Object(U.a)(e(n,r)).pipe(Object(rt.a)(function(e,i){return t(n,e,r,i)}))}))}:function(t){return t.lift(new at(e))}}var at=function(){function e(e){this.project=e}return e.prototype.call=function(e,t){return t.subscribe(new ot(e,this.project))},e}(),ot=function(e){function t(t,n){var r=e.call(this,t)||this;return r.project=n,r.hasSubscription=!1,r.hasCompleted=!1,r.index=0,r}return r.a(t,e),t.prototype._next=function(e){this.hasSubscription||this.tryNext(e)},t.prototype.tryNext=function(e){var t,n=this.index++;try{t=this.project(e,n)}catch(e){return void this.destination.error(e)}this.hasSubscription=!0,this._innerSub(t,e,n)},t.prototype._innerSub=function(e,t,n){var r=new R.a(this,void 0,void 0);this.destination.add(r),Object(a.a)(this,e,t,n,r)},t.prototype._complete=function(){this.hasCompleted=!0,this.hasSubscription||this.destination.complete(),this.unsubscribe()},t.prototype.notifyNext=function(e,t,n,r,i){this.destination.next(t)},t.prototype.notifyError=function(e){this.destination.error(e)},t.prototype.notifyComplete=function(e){this.destination.remove(e),this.hasSubscription=!1,this.hasCompleted&&this.destination.complete()},t}(i.a);function ut(e,t,n){return void 0===t&&(t=Number.POSITIVE_INFINITY),void 0===n&&(n=void 0),t=(t||0)<1?Number.POSITIVE_INFINITY:t,function(r){return r.lift(new st(e,t,n))}}var st=function(){function e(e,t,n){this.project=e,this.concurrent=t,this.scheduler=n}return e.prototype.call=function(e,t){return t.subscribe(new ct(e,this.project,this.concurrent,this.scheduler))},e}(),ct=function(e){function t(t,n,r,i){var a=e.call(this,t)||this;return a.project=n,a.concurrent=r,a.scheduler=i,a.index=0,a.active=0,a.hasCompleted=!1,r<Number.POSITIVE_INFINITY&&(a.buffer=[]),a}return r.a(t,e),t.dispatch=function(e){var t=e.subscriber,n=e.result,r=e.value,i=e.index;t.subscribeToProjection(n,r,i)},t.prototype._next=function(e){var n=this.destination;if(n.closed)this._complete();else{var r=this.index++;if(this.active<this.concurrent){n.next(e);try{var i=(0,this.project)(e,r);if(this.scheduler){var a={subscriber:this,result:i,value:e,index:r};this.destination.add(this.scheduler.schedule(t.dispatch,0,a))}else this.subscribeToProjection(i,e,r)}catch(e){n.error(e)}}else this.buffer.push(e)}},t.prototype.subscribeToProjection=function(e,t,n){this.active++,this.destination.add(Object(a.a)(this,e,t,n))},t.prototype._complete=function(){this.hasCompleted=!0,this.hasCompleted&&0===this.active&&this.destination.complete(),this.unsubscribe()},t.prototype.notifyNext=function(e,t,n,r,i){this._next(t)},t.prototype.notifyComplete=function(e){var t=this.buffer;this.destination.remove(e),this.active--,t&&t.length>0&&this._next(t.shift()),this.hasCompleted&&0===this.active&&this.destination.complete()},t}(i.a);function lt(e){return function(t){return t.lift(new ft(e))}}var ft=function(){function e(e){this.callback=e}return e.prototype.call=function(e,t){return t.subscribe(new dt(e,this.callback))},e}(),dt=function(e){function t(t,n){var r=e.call(this,t)||this;return r.add(new E.a(n)),r}return r.a(t,e),t}(m.a);function pt(e,t){if("function"!=typeof e)throw new TypeError("predicate is not a function");return function(n){return n.lift(new ht(e,n,!1,t))}}var ht=function(){function e(e,t,n,r){this.predicate=e,this.source=t,this.yieldIndex=n,this.thisArg=r}return e.prototype.call=function(e,t){return t.subscribe(new mt(e,this.predicate,this.source,this.yieldIndex,this.thisArg))},e}(),mt=function(e){function t(t,n,r,i,a){var o=e.call(this,t)||this;return o.predicate=n,o.source=r,o.yieldIndex=i,o.thisArg=a,o.index=0,o}return r.a(t,e),t.prototype.notifyComplete=function(e){var t=this.destination;t.next(e),t.complete(),this.unsubscribe()},t.prototype._next=function(e){var t=this.predicate,n=this.thisArg,r=this.index++;try{t.call(n||this,e,r,this.source)&&this.notifyComplete(this.yieldIndex?r:e)}catch(e){this.destination.error(e)}},t.prototype._complete=function(){this.notifyComplete(this.yieldIndex?-1:void 0)},t}(m.a);function yt(e,t){return function(n){return n.lift(new ht(e,n,!0,t))}}var vt=n(40);function bt(e,t){var n=arguments.length>=2;return function(r){return r.pipe(e?Ve(function(t,n){return e(t,n,r)}):vt.a,qe(1),n?oe(t):ze(function(){return new Le.a}))}}var gt=n(130);function _t(){return function(e){return e.lift(new St)}}var St=function(){function e(){}return e.prototype.call=function(e,t){return t.subscribe(new Ct(e))},e}(),Ct=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.a(t,e),t.prototype._next=function(e){},t}(m.a);function xt(){return function(e){return e.lift(new wt)}}var wt=function(){function e(){}return e.prototype.call=function(e,t){return t.subscribe(new Pt(e))},e}(),Pt=function(e){function t(t){return e.call(this,t)||this}return r.a(t,e),t.prototype.notifyComplete=function(e){var t=this.destination;t.next(e),t.complete()},t.prototype._next=function(e){this.notifyComplete(!1)},t.prototype._complete=function(){this.notifyComplete(!0)},t}(m.a);function Tt(e){return function(t){return 0===e?Object(Ge.b)():t.lift(new At(e))}}var At=function(){function e(e){if(this.total=e,this.total<0)throw new Me.a}return e.prototype.call=function(e,t){return t.subscribe(new Et(e,this.total))},e}(),Et=function(e){function t(t,n){var r=e.call(this,t)||this;return r.total=n,r.ring=new Array,r.count=0,r}return r.a(t,e),t.prototype._next=function(e){var t=this.ring,n=this.total,r=this.count++;t.length<n?t.push(e):t[r%n]=e},t.prototype._complete=function(){var e=this.destination,t=this.count;if(t>0)for(var n=this.count>=this.total?this.total:this.count,r=this.ring,i=0;i<n;i++){var a=t++%n;e.next(r[a])}e.complete()},t}(m.a);function kt(e,t){var n=arguments.length>=2;return function(r){return r.pipe(e?Ve(function(t,n){return e(t,n,r)}):vt.a,Tt(1),n?oe(t):ze(function(){return new Le.a}))}}function It(e){return function(t){return t.lift(new Mt(e))}}var Mt=function(){function e(e){this.value=e}return e.prototype.call=function(e,t){return t.subscribe(new Vt(e,this.value))},e}(),Vt=function(e){function t(t,n){var r=e.call(this,t)||this;return r.value=n,r}return r.a(t,e),t.prototype._next=function(e){this.destination.next(this.value)},t}(m.a);function Ot(){return function(e){return e.lift(new Dt)}}var Dt=function(){function e(){}return e.prototype.call=function(e,t){return t.subscribe(new Rt(e))},e}(),Rt=function(e){function t(t){return e.call(this,t)||this}return r.a(t,e),t.prototype._next=function(e){this.destination.next(le.a.createNext(e))},t.prototype._error=function(e){var t=this.destination;t.next(le.a.createError(e)),t.complete()},t.prototype._complete=function(){var e=this.destination;e.next(le.a.createComplete()),e.complete()},t}(m.a);function jt(e,t){var n=!1;return arguments.length>=2&&(n=!0),function(r){return r.lift(new Nt(e,t,n))}}var Nt=function(){function e(e,t,n){void 0===n&&(n=!1),this.accumulator=e,this.seed=t,this.hasSeed=n}return e.prototype.call=function(e,t){return t.subscribe(new Bt(e,this.accumulator,this.seed,this.hasSeed))},e}(),Bt=function(e){function t(t,n,r,i){var a=e.call(this,t)||this;return a.accumulator=n,a._seed=r,a.hasSeed=i,a.index=0,a}return r.a(t,e),Object.defineProperty(t.prototype,"seed",{get:function(){return this._seed},set:function(e){this.hasSeed=!0,this._seed=e},enumerable:!0,configurable:!0}),t.prototype._next=function(e){if(this.hasSeed)return this._tryNext(e);this.seed=e,this.destination.next(e)},t.prototype._tryNext=function(e){var t,n=this.index++;try{t=this.accumulator(this.seed,e,n)}catch(e){this.destination.error(e)}this.seed=t,this.destination.next(t)},t}(m.a),Ft=n(87);function Lt(e,t){return arguments.length>=2?function(n){return Object(Ft.a)(jt(e,t),Tt(1),oe(t))(n)}:function(t){return Object(Ft.a)(jt(function(t,n,r){return e(t,n,r+1)}),Tt(1))(t)}}function zt(e){return Lt("function"==typeof e?function(t,n){return e(t,n)>0?t:n}:function(e,t){return e>t?e:t})}var Ut=n(166);function Gt(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t){return t.lift.call(Ut.a.apply(void 0,[t].concat(e)))}}var qt=n(106);function Ht(e,t,n){return void 0===n&&(n=Number.POSITIVE_INFINITY),"function"==typeof t?Object(Y.a)(function(){return e},t,n):("number"==typeof t&&(n=t),Object(Y.a)(function(){return e},n))}function Wt(e,t,n){return void 0===n&&(n=Number.POSITIVE_INFINITY),function(r){return r.lift(new Yt(e,t,n))}}var Yt=function(){function e(e,t,n){this.accumulator=e,this.seed=t,this.concurrent=n}return e.prototype.call=function(e,t){return t.subscribe(new Kt(e,this.accumulator,this.seed,this.concurrent))},e}(),Kt=function(e){function t(t,n,r,i){var a=e.call(this,t)||this;return a.accumulator=n,a.acc=r,a.concurrent=i,a.hasValue=!1,a.hasCompleted=!1,a.buffer=[],a.active=0,a.index=0,a}return r.a(t,e),t.prototype._next=function(e){if(this.active<this.concurrent){var t=this.index++,n=this.destination,r=void 0;try{r=(0,this.accumulator)(this.acc,e,t)}catch(e){return n.error(e)}this.active++,this._innerSub(r,e,t)}else this.buffer.push(e)},t.prototype._innerSub=function(e,t,n){var r=new R.a(this,void 0,void 0);this.destination.add(r),Object(a.a)(this,e,t,n,r)},t.prototype._complete=function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&(!1===this.hasValue&&this.destination.next(this.acc),this.destination.complete()),this.unsubscribe()},t.prototype.notifyNext=function(e,t,n,r,i){var a=this.destination;this.acc=t,this.hasValue=!0,a.next(t)},t.prototype.notifyComplete=function(e){var t=this.buffer;this.destination.remove(e),this.active--,t.length>0?this._next(t.shift()):0===this.active&&this.hasCompleted&&(!1===this.hasValue&&this.destination.next(this.acc),this.destination.complete())},t}(i.a);function Xt(e){return Lt("function"==typeof e?function(t,n){return e(t,n)<0?t:n}:function(e,t){return e<t?e:t})}var Qt=n(161);function Zt(e,t){return function(n){var r;if(r="function"==typeof e?e:function(){return e},"function"==typeof t)return n.lift(new Jt(r,t));var i=Object.create(n,Qt.b);return i.source=n,i.subjectFactory=r,i}}var Jt=function(){function e(e,t){this.subjectFactory=e,this.selector=t}return e.prototype.call=function(e,t){var n=this.selector,r=this.subjectFactory(),i=n(r).subscribe(e);return i.add(t.subscribe(r)),i},e}(),$t=n(163);function en(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return 1===e.length&&Object(z.a)(e[0])&&(e=e[0]),function(t){return t.lift(new tn(e))}}var tn=function(){function e(e){this.nextSources=e}return e.prototype.call=function(e,t){return t.subscribe(new nn(e,this.nextSources))},e}(),nn=function(e){function t(t,n){var r=e.call(this,t)||this;return r.destination=t,r.nextSources=n,r}return r.a(t,e),t.prototype.notifyError=function(e,t){this.subscribeToNextSource()},t.prototype.notifyComplete=function(e){this.subscribeToNextSource()},t.prototype._error=function(e){this.subscribeToNextSource(),this.unsubscribe()},t.prototype._complete=function(){this.subscribeToNextSource(),this.unsubscribe()},t.prototype.subscribeToNextSource=function(){var e=this.nextSources.shift();if(e){var t=new R.a(this,void 0,void 0);this.destination.add(t),Object(a.a)(this,e,void 0,void 0,t)}else this.destination.complete()},t}(i.a);function rn(){return function(e){return e.lift(new an)}}var an=function(){function e(){}return e.prototype.call=function(e,t){return t.subscribe(new on(e))},e}(),on=function(e){function t(t){var n=e.call(this,t)||this;return n.hasPrev=!1,n}return r.a(t,e),t.prototype._next=function(e){this.hasPrev?this.destination.next([this.prev,e]):this.hasPrev=!0,this.prev=e},t}(m.a);function un(e,t){function n(){return!n.pred.apply(n.thisArg,arguments)}return n.pred=e,n.thisArg=t,n}function sn(e,t){return function(n){return[Ve(e,t)(n),Ve(un(e,t))(n)]}}function cn(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e.length;if(0===n)throw new Error("list of properties cannot be empty.");return function(t){return Object(rt.a)(function(e,t){return function(n){for(var r=n,i=0;i<t;i++){var a=r[e[i]];if(void 0===a)return;r=a}return r}}(e,n))(t)}}var ln=n(12);function fn(e){return e?Zt(function(){return new ln.a},e):Zt(new ln.a)}var dn=n(162);function pn(e){return function(t){return Zt(new dn.a(e))(t)}}var hn=n(64);function mn(){return function(e){return Zt(new hn.a)(e)}}var yn=n(102);function vn(e,t,n,r){n&&"function"!=typeof n&&(r=n);var i="function"==typeof n?n:void 0,a=new yn.a(e,t,r);return function(e){return Zt(function(){return a},i)(e)}}var bn=n(167);function gn(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t){return 1===e.length&&Object(z.a)(e[0])&&(e=e[0]),t.lift.call(bn.a.apply(void 0,[t].concat(e)))}}function _n(e){return void 0===e&&(e=-1),function(t){return 0===e?Object(Ge.b)():e<0?t.lift(new Sn(-1,t)):t.lift(new Sn(e-1,t))}}var Sn=function(){function e(e,t){this.count=e,this.source=t}return e.prototype.call=function(e,t){return t.subscribe(new Cn(e,this.count,this.source))},e}(),Cn=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.count=n,i.source=r,i}return r.a(t,e),t.prototype.complete=function(){if(!this.isStopped){var t=this.source,n=this.count;if(0===n)return e.prototype.complete.call(this);n>-1&&(this.count=n-1),t.subscribe(this._unsubscribeAndRecycle())}},t}(m.a);function xn(e){return function(t){return t.lift(new wn(e))}}var wn=function(){function e(e){this.notifier=e}return e.prototype.call=function(e,t){return t.subscribe(new Pn(e,this.notifier,t))},e}(),Pn=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.notifier=n,i.source=r,i.sourceIsBeingSubscribedTo=!0,i}return r.a(t,e),t.prototype.notifyNext=function(e,t,n,r,i){this.sourceIsBeingSubscribedTo=!0,this.source.subscribe(this)},t.prototype.notifyComplete=function(t){if(!1===this.sourceIsBeingSubscribedTo)return e.prototype.complete.call(this)},t.prototype.complete=function(){if(this.sourceIsBeingSubscribedTo=!1,!this.isStopped){if(this.retries||this.subscribeToRetries(),!this.retriesSubscription||this.retriesSubscription.closed)return e.prototype.complete.call(this);this._unsubscribeAndRecycle(),this.notifications.next()}},t.prototype._unsubscribe=function(){var e=this.notifications,t=this.retriesSubscription;e&&(e.unsubscribe(),this.notifications=null),t&&(t.unsubscribe(),this.retriesSubscription=null),this.retries=null},t.prototype._unsubscribeAndRecycle=function(){var t=this._unsubscribe;return this._unsubscribe=null,e.prototype._unsubscribeAndRecycle.call(this),this._unsubscribe=t,this},t.prototype.subscribeToRetries=function(){var t;this.notifications=new ln.a;try{t=(0,this.notifier)(this.notifications)}catch(t){return e.prototype.complete.call(this)}this.retries=t,this.retriesSubscription=Object(a.a)(this,t)},t}(i.a);function Tn(e){return void 0===e&&(e=-1),function(t){return t.lift(new An(e,t))}}var An=function(){function e(e,t){this.count=e,this.source=t}return e.prototype.call=function(e,t){return t.subscribe(new En(e,this.count,this.source))},e}(),En=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.count=n,i.source=r,i}return r.a(t,e),t.prototype.error=function(t){if(!this.isStopped){var n=this.source,r=this.count;if(0===r)return e.prototype.error.call(this,t);r>-1&&(this.count=r-1),n.subscribe(this._unsubscribeAndRecycle())}},t}(m.a);function kn(e){return function(t){return t.lift(new In(e,t))}}var In=function(){function e(e,t){this.notifier=e,this.source=t}return e.prototype.call=function(e,t){return t.subscribe(new Mn(e,this.notifier,this.source))},e}(),Mn=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.notifier=n,i.source=r,i}return r.a(t,e),t.prototype.error=function(t){if(!this.isStopped){var n=this.errors,r=this.retries,i=this.retriesSubscription;if(r)this.errors=null,this.retriesSubscription=null;else{n=new ln.a;try{r=(0,this.notifier)(n)}catch(t){return e.prototype.error.call(this,t)}i=Object(a.a)(this,r)}this._unsubscribeAndRecycle(),this.errors=n,this.retries=r,this.retriesSubscription=i,n.next(t)}},t.prototype._unsubscribe=function(){var e=this.errors,t=this.retriesSubscription;e&&(e.unsubscribe(),this.errors=null),t&&(t.unsubscribe(),this.retriesSubscription=null),this.retries=null},t.prototype.notifyNext=function(e,t,n,r,i){var a=this._unsubscribe;this._unsubscribe=null,this._unsubscribeAndRecycle(),this._unsubscribe=a,this.source.subscribe(this)},t}(i.a),Vn=n(101);function On(e){return function(t){return t.lift(new Dn(e))}}var Dn=function(){function e(e){this.notifier=e}return e.prototype.call=function(e,t){var n=new Rn(e),r=t.subscribe(n);return r.add(Object(a.a)(n,this.notifier)),r},e}(),Rn=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.hasValue=!1,t}return r.a(t,e),t.prototype._next=function(e){this.value=e,this.hasValue=!0},t.prototype.notifyNext=function(e,t,n,r,i){this.emitValue()},t.prototype.notifyComplete=function(){this.emitValue()},t.prototype.emitValue=function(){this.hasValue&&(this.hasValue=!1,this.destination.next(this.value))},t}(i.a);function jn(e,t){return void 0===t&&(t=c.a),function(n){return n.lift(new Nn(e,t))}}var Nn=function(){function e(e,t){this.period=e,this.scheduler=t}return e.prototype.call=function(e,t){return t.subscribe(new Bn(e,this.period,this.scheduler))},e}(),Bn=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.period=n,i.scheduler=r,i.hasValue=!1,i.add(r.schedule(Fn,n,{subscriber:i,period:n})),i}return r.a(t,e),t.prototype._next=function(e){this.lastValue=e,this.hasValue=!0},t.prototype.notifyNext=function(){this.hasValue&&(this.hasValue=!1,this.destination.next(this.lastValue))},t}(m.a);function Fn(e){var t=e.subscriber,n=e.period;t.notifyNext(),this.schedule(e,n)}function Ln(e,t){return function(n){return n.lift(new zn(e,t))}}var zn=function(){function e(e,t){this.compareTo=e,this.comparator=t}return e.prototype.call=function(e,t){return t.subscribe(new Un(e,this.compareTo,this.comparator))},e}(),Un=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.compareTo=n,i.comparator=r,i._a=[],i._b=[],i._oneComplete=!1,i.destination.add(n.subscribe(new Gn(t,i))),i}return r.a(t,e),t.prototype._next=function(e){this._oneComplete&&0===this._b.length?this.emit(!1):(this._a.push(e),this.checkValues())},t.prototype._complete=function(){this._oneComplete?this.emit(0===this._a.length&&0===this._b.length):this._oneComplete=!0,this.unsubscribe()},t.prototype.checkValues=function(){for(var e=this._a,t=this._b,n=this.comparator;e.length>0&&t.length>0;){var r=e.shift(),i=t.shift(),a=!1;try{a=n?n(r,i):r===i}catch(e){this.destination.error(e)}a||this.emit(!1)}},t.prototype.emit=function(e){var t=this.destination;t.next(e),t.complete()},t.prototype.nextB=function(e){this._oneComplete&&0===this._a.length?this.emit(!1):(this._b.push(e),this.checkValues())},t.prototype.completeB=function(){this._oneComplete?this.emit(0===this._a.length&&0===this._b.length):this._oneComplete=!0},t}(m.a),Gn=function(e){function t(t,n){var r=e.call(this,t)||this;return r.parent=n,r}return r.a(t,e),t.prototype._next=function(e){this.parent.nextB(e)},t.prototype._error=function(e){this.parent.error(e),this.unsubscribe()},t.prototype._complete=function(){this.parent.completeB(),this.unsubscribe()},t}(m.a);function qn(){return new ln.a}function Hn(){return function(e){return Object(Vn.a)()(Zt(qn)(e))}}function Wn(e,t,n){var r;return r=e&&"object"==typeof e?e:{bufferSize:e,windowTime:t,refCount:!1,scheduler:n},function(e){return e.lift((a=(t=r).bufferSize,o=void 0===a?Number.POSITIVE_INFINITY:a,u=t.windowTime,s=void 0===u?Number.POSITIVE_INFINITY:u,c=t.refCount,l=t.scheduler,f=0,d=!1,p=!1,function(e){f++,n&&!d||(d=!1,n=new yn.a(o,s,l),i=e.subscribe({next:function(e){n.next(e)},error:function(e){d=!0,n.error(e)},complete:function(){p=!0,n.complete()}}));var t=n.subscribe(this);this.add(function(){f--,t.unsubscribe(),i&&!p&&c&&0===f&&(i.unsubscribe(),i=void 0,n=void 0)})}));var t,n,i,a,o,u,s,c,l,f,d,p}}function Yn(e){return function(t){return t.lift(new Kn(e,t))}}var Kn=function(){function e(e,t){this.predicate=e,this.source=t}return e.prototype.call=function(e,t){return t.subscribe(new Xn(e,this.predicate,this.source))},e}(),Xn=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.predicate=n,i.source=r,i.seenValue=!1,i.index=0,i}return r.a(t,e),t.prototype.applySingleValue=function(e){this.seenValue?this.destination.error("Sequence contains more than one element"):(this.seenValue=!0,this.singleValue=e)},t.prototype._next=function(e){var t=this.index++;this.predicate?this.tryNext(e,t):this.applySingleValue(e)},t.prototype.tryNext=function(e,t){try{this.predicate(e,t,this.source)&&this.applySingleValue(e)}catch(e){this.destination.error(e)}},t.prototype._complete=function(){var e=this.destination;this.index>0?(e.next(this.seenValue?this.singleValue:void 0),e.complete()):e.error(new Le.a)},t}(m.a);function Qn(e){return function(t){return t.lift(new Zn(e))}}var Zn=function(){function e(e){this.total=e}return e.prototype.call=function(e,t){return t.subscribe(new Jn(e,this.total))},e}(),Jn=function(e){function t(t,n){var r=e.call(this,t)||this;return r.total=n,r.count=0,r}return r.a(t,e),t.prototype._next=function(e){++this.count>this.total&&this.destination.next(e)},t}(m.a);function $n(e){return function(t){return t.lift(new er(e))}}var er=function(){function e(e){if(this._skipCount=e,this._skipCount<0)throw new Me.a}return e.prototype.call=function(e,t){return 0===this._skipCount?t.subscribe(new m.a(e)):t.subscribe(new tr(e,this._skipCount))},e}(),tr=function(e){function t(t,n){var r=e.call(this,t)||this;return r._skipCount=n,r._count=0,r._ring=new Array(n),r}return r.a(t,e),t.prototype._next=function(e){var t=this._skipCount,n=this._count++;if(n<t)this._ring[n]=e;else{var r=n%t,i=this._ring,a=i[r];i[r]=e,this.destination.next(a)}},t}(m.a);function nr(e){return function(t){return t.lift(new rr(e))}}var rr=function(){function e(e){this.notifier=e}return e.prototype.call=function(e,t){return t.subscribe(new ir(e,this.notifier))},e}(),ir=function(e){function t(t,n){var r=e.call(this,t)||this;r.hasValue=!1;var i=new R.a(r,void 0,void 0);return r.add(i),r.innerSubscription=i,Object(a.a)(r,n,void 0,void 0,i),r}return r.a(t,e),t.prototype._next=function(t){this.hasValue&&e.prototype._next.call(this,t)},t.prototype.notifyNext=function(e,t,n,r,i){this.hasValue=!0,this.innerSubscription&&this.innerSubscription.unsubscribe()},t.prototype.notifyComplete=function(){},t}(i.a);function ar(e){return function(t){return t.lift(new or(e))}}var or=function(){function e(e){this.predicate=e}return e.prototype.call=function(e,t){return t.subscribe(new ur(e,this.predicate))},e}(),ur=function(e){function t(t,n){var r=e.call(this,t)||this;return r.predicate=n,r.skipping=!0,r.index=0,r}return r.a(t,e),t.prototype._next=function(e){var t=this.destination;this.skipping&&this.tryCallPredicate(e),this.skipping||t.next(e)},t.prototype.tryCallPredicate=function(e){try{var t=this.predicate(e,this.index++);this.skipping=Boolean(t)}catch(e){this.destination.error(e)}},t}(m.a);function sr(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t){var n=e[e.length-1];Object(_.a)(n)?e.pop():n=null;var r=e.length;return 1!==r||n?r>0?Object(q.a)(Object(Ke.a)(e,n),t):Object(q.a)(Object(Ge.b)(n),t):Object(q.a)(Object(Xe.a)(e[0]),t)}}var cr=n(111),lr=n(66),fr=function(e){function t(t,n,r){void 0===n&&(n=0),void 0===r&&(r=cr.a);var i=e.call(this)||this;return i.source=t,i.delayTime=n,i.scheduler=r,(!Object(lr.a)(n)||n<0)&&(i.delayTime=0),r&&"function"==typeof r.schedule||(i.scheduler=cr.a),i}return r.a(t,e),t.create=function(e,n,r){return void 0===n&&(n=0),void 0===r&&(r=cr.a),new t(e,n,r)},t.dispatch=function(e){var t=e.source,n=e.subscriber;return this.add(t.subscribe(n))},t.prototype._subscribe=function(e){var n=this.delayTime,r=this.source;return this.scheduler.schedule(t.dispatch,n,{source:r,subscriber:e})},t}(me.a);function dr(e,t){return void 0===t&&(t=0),function(n){return n.lift(new pr(e,t))}}var pr=function(){function e(e,t){this.scheduler=e,this.delay=t}return e.prototype.call=function(e,t){return new fr(t,this.delay,this.scheduler).subscribe(e)},e}();function hr(e,t){return"function"==typeof t?function(n){return n.pipe(hr(function(n,r){return Object(U.a)(e(n,r)).pipe(Object(rt.a)(function(e,i){return t(n,e,r,i)}))}))}:function(t){return t.lift(new mr(e))}}var mr=function(){function e(e){this.project=e}return e.prototype.call=function(e,t){return t.subscribe(new yr(e,this.project))},e}(),yr=function(e){function t(t,n){var r=e.call(this,t)||this;return r.project=n,r.index=0,r}return r.a(t,e),t.prototype._next=function(e){var t,n=this.index++;try{t=this.project(e,n)}catch(e){return void this.destination.error(e)}this._innerSub(t,e,n)},t.prototype._innerSub=function(e,t,n){var r=this.innerSubscription;r&&r.unsubscribe();var i=new R.a(this,void 0,void 0);this.destination.add(i),this.innerSubscription=Object(a.a)(this,e,t,n,i)},t.prototype._complete=function(){var t=this.innerSubscription;t&&!t.closed||e.prototype._complete.call(this),this.unsubscribe()},t.prototype._unsubscribe=function(){this.innerSubscription=null},t.prototype.notifyComplete=function(t){this.destination.remove(t),this.innerSubscription=null,this.isStopped&&e.prototype._complete.call(this)},t.prototype.notifyNext=function(e,t,n,r,i){this.destination.next(t)},t}(i.a);function vr(){return hr(vt.a)}function br(e,t){return t?hr(function(){return e},t):hr(function(){return e})}function gr(e){return function(t){return t.lift(new _r(e))}}var _r=function(){function e(e){this.notifier=e}return e.prototype.call=function(e,t){var n=new Sr(e),r=Object(a.a)(n,this.notifier);return r&&!n.seenValue?(n.add(r),t.subscribe(n)):n},e}(),Sr=function(e){function t(t){var n=e.call(this,t)||this;return n.seenValue=!1,n}return r.a(t,e),t.prototype.notifyNext=function(e,t,n,r,i){this.seenValue=!0,this.complete()},t.prototype.notifyComplete=function(){},t}(i.a);function Cr(e,t){return void 0===t&&(t=!1),function(n){return n.lift(new xr(e,t))}}var xr=function(){function e(e,t){this.predicate=e,this.inclusive=t}return e.prototype.call=function(e,t){return t.subscribe(new wr(e,this.predicate,this.inclusive))},e}(),wr=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.predicate=n,i.inclusive=r,i.index=0,i}return r.a(t,e),t.prototype._next=function(e){var t,n=this.destination;try{t=this.predicate(e,this.index++)}catch(e){return void n.error(e)}this.nextOrComplete(e,t)},t.prototype.nextOrComplete=function(e,t){var n=this.destination;Boolean(t)?n.next(e):(this.inclusive&&n.next(e),n.complete())},t}(m.a),Pr={leading:!0,trailing:!1};function Tr(e,t){return void 0===t&&(t=Pr),function(n){return n.lift(new Ar(e,t.leading,t.trailing))}}var Ar=function(){function e(e,t,n){this.durationSelector=e,this.leading=t,this.trailing=n}return e.prototype.call=function(e,t){return t.subscribe(new Er(e,this.durationSelector,this.leading,this.trailing))},e}(),Er=function(e){function t(t,n,r,i){var a=e.call(this,t)||this;return a.destination=t,a.durationSelector=n,a._leading=r,a._trailing=i,a._hasValue=!1,a}return r.a(t,e),t.prototype._next=function(e){this._hasValue=!0,this._sendValue=e,this._throttled||(this._leading?this.send():this.throttle(e))},t.prototype.send=function(){var e=this._hasValue,t=this._sendValue;e&&(this.destination.next(t),this.throttle(t)),this._hasValue=!1,this._sendValue=null},t.prototype.throttle=function(e){var t=this.tryDurationSelector(e);t&&this.add(this._throttled=Object(a.a)(this,t))},t.prototype.tryDurationSelector=function(e){try{return this.durationSelector(e)}catch(e){return this.destination.error(e),null}},t.prototype.throttlingDone=function(){var e=this._throttled,t=this._trailing;e&&e.unsubscribe(),this._throttled=null,t&&this.send()},t.prototype.notifyNext=function(e,t,n,r,i){this.throttlingDone()},t.prototype.notifyComplete=function(){this.throttlingDone()},t}(i.a);function kr(e,t,n){return void 0===t&&(t=c.a),void 0===n&&(n=Pr),function(r){return r.lift(new Ir(e,t,n.leading,n.trailing))}}var Ir=function(){function e(e,t,n,r){this.duration=e,this.scheduler=t,this.leading=n,this.trailing=r}return e.prototype.call=function(e,t){return t.subscribe(new Mr(e,this.duration,this.scheduler,this.leading,this.trailing))},e}(),Mr=function(e){function t(t,n,r,i,a){var o=e.call(this,t)||this;return o.duration=n,o.scheduler=r,o.leading=i,o.trailing=a,o._hasTrailingValue=!1,o._trailingValue=null,o}return r.a(t,e),t.prototype._next=function(e){this.throttled?this.trailing&&(this._trailingValue=e,this._hasTrailingValue=!0):(this.add(this.throttled=this.scheduler.schedule(Vr,this.duration,{subscriber:this})),this.leading&&this.destination.next(e))},t.prototype._complete=function(){this._hasTrailingValue?(this.destination.next(this._trailingValue),this.destination.complete()):this.destination.complete()},t.prototype.clearThrottle=function(){var e=this.throttled;e&&(this.trailing&&this._hasTrailingValue&&(this.destination.next(this._trailingValue),this._trailingValue=null,this._hasTrailingValue=!1),e.unsubscribe(),this.remove(e),this.throttled=null)},t}(m.a);function Vr(e){e.subscriber.clearThrottle()}var Or=n(107);function Dr(e){return void 0===e&&(e=c.a),function(t){return Object(Or.a)(function(){return t.pipe(jt(function(t,n){var r=t.current;return{value:n,current:e.now(),last:r}},{current:e.now(),value:void 0,last:void 0}),Object(rt.a)(function(e){var t=e.current,n=e.last,r=e.value;return new Rr(r,t-n)}))})}}var Rr=function(){return function(e,t){this.value=e,this.interval=t}}(),jr=n(164);function Nr(e,t,n){return void 0===n&&(n=c.a),function(r){var i=ce(e),a=i?+e-n.now():Math.abs(e);return r.lift(new Br(a,i,t,n))}}var Br=function(){function e(e,t,n,r){this.waitFor=e,this.absoluteTimeout=t,this.withObservable=n,this.scheduler=r}return e.prototype.call=function(e,t){return t.subscribe(new Fr(e,this.absoluteTimeout,this.waitFor,this.withObservable,this.scheduler))},e}(),Fr=function(e){function t(t,n,r,i,a){var o=e.call(this,t)||this;return o.absoluteTimeout=n,o.waitFor=r,o.withObservable=i,o.scheduler=a,o.action=null,o.scheduleTimeout(),o}return r.a(t,e),t.dispatchTimeout=function(e){var t=e.withObservable;e._unsubscribeAndRecycle(),e.add(Object(a.a)(e,t))},t.prototype.scheduleTimeout=function(){var e=this.action;e?this.action=e.schedule(this,this.waitFor):this.add(this.action=this.scheduler.schedule(t.dispatchTimeout,this.waitFor,this))},t.prototype._next=function(t){this.absoluteTimeout||this.scheduleTimeout(),e.prototype._next.call(this,t)},t.prototype._unsubscribe=function(){this.action=null,this.scheduler=null,this.withObservable=null},t}(i.a),Lr=n(104);function zr(e,t){return void 0===t&&(t=c.a),Nr(e,Object(Lr.a)(new jr.a),t)}function Ur(e){return void 0===e&&(e=c.a),Object(rt.a)(function(t){return new Gr(t,e.now())})}var Gr=function(){return function(e,t){this.value=e,this.timestamp=t}}();function qr(e,t,n){return 0===n?[t]:(e.push(t),e)}function Hr(){return Lt(qr,[])}function Wr(e){return function(t){return t.lift(new Yr(e))}}var Yr=function(){function e(e){this.windowBoundaries=e}return e.prototype.call=function(e,t){var n=new Kr(e),r=t.subscribe(n);return r.closed||n.add(Object(a.a)(n,this.windowBoundaries)),r},e}(),Kr=function(e){function t(t){var n=e.call(this,t)||this;return n.window=new ln.a,t.next(n.window),n}return r.a(t,e),t.prototype.notifyNext=function(e,t,n,r,i){this.openWindow()},t.prototype.notifyError=function(e,t){this._error(e)},t.prototype.notifyComplete=function(e){this._complete()},t.prototype._next=function(e){this.window.next(e)},t.prototype._error=function(e){this.window.error(e),this.destination.error(e)},t.prototype._complete=function(){this.window.complete(),this.destination.complete()},t.prototype._unsubscribe=function(){this.window=null},t.prototype.openWindow=function(){var e=this.window;e&&e.complete();var t=this.destination,n=this.window=new ln.a;t.next(n)},t}(i.a);function Xr(e,t){return void 0===t&&(t=0),function(n){return n.lift(new Qr(e,t))}}var Qr=function(){function e(e,t){this.windowSize=e,this.startWindowEvery=t}return e.prototype.call=function(e,t){return t.subscribe(new Zr(e,this.windowSize,this.startWindowEvery))},e}(),Zr=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.destination=t,i.windowSize=n,i.startWindowEvery=r,i.windows=[new ln.a],i.count=0,t.next(i.windows[0]),i}return r.a(t,e),t.prototype._next=function(e){for(var t=this.startWindowEvery>0?this.startWindowEvery:this.windowSize,n=this.destination,r=this.windowSize,i=this.windows,a=i.length,o=0;o<a&&!this.closed;o++)i[o].next(e);var u=this.count-r+1;if(u>=0&&u%t==0&&!this.closed&&i.shift().complete(),++this.count%t==0&&!this.closed){var s=new ln.a;i.push(s),n.next(s)}},t.prototype._error=function(e){var t=this.windows;if(t)for(;t.length>0&&!this.closed;)t.shift().error(e);this.destination.error(e)},t.prototype._complete=function(){var e=this.windows;if(e)for(;e.length>0&&!this.closed;)e.shift().complete();this.destination.complete()},t.prototype._unsubscribe=function(){this.count=0,this.windows=null},t}(m.a);function Jr(e){var t=c.a,n=null,r=Number.POSITIVE_INFINITY;return Object(_.a)(arguments[3])&&(t=arguments[3]),Object(_.a)(arguments[2])?t=arguments[2]:Object(lr.a)(arguments[2])&&(r=arguments[2]),Object(_.a)(arguments[1])?t=arguments[1]:Object(lr.a)(arguments[1])&&(n=arguments[1]),function(i){return i.lift(new $r(e,n,r,t))}}var $r=function(){function e(e,t,n,r){this.windowTimeSpan=e,this.windowCreationInterval=t,this.maxWindowSize=n,this.scheduler=r}return e.prototype.call=function(e,t){return t.subscribe(new ti(e,this.windowTimeSpan,this.windowCreationInterval,this.maxWindowSize,this.scheduler))},e}(),ei=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._numberOfNextedValues=0,t}return r.a(t,e),t.prototype.next=function(t){this._numberOfNextedValues++,e.prototype.next.call(this,t)},Object.defineProperty(t.prototype,"numberOfNextedValues",{get:function(){return this._numberOfNextedValues},enumerable:!0,configurable:!0}),t}(ln.a),ti=function(e){function t(t,n,r,i,a){var o=e.call(this,t)||this;o.destination=t,o.windowTimeSpan=n,o.windowCreationInterval=r,o.maxWindowSize=i,o.scheduler=a,o.windows=[];var u=o.openWindow();if(null!==r&&r>=0){var s={subscriber:o,window:u,context:null},c={windowTimeSpan:n,windowCreationInterval:r,subscriber:o,scheduler:a};o.add(a.schedule(ii,n,s)),o.add(a.schedule(ri,r,c))}else{var l={subscriber:o,window:u,windowTimeSpan:n};o.add(a.schedule(ni,n,l))}return o}return r.a(t,e),t.prototype._next=function(e){for(var t=this.windows,n=t.length,r=0;r<n;r++){var i=t[r];i.closed||(i.next(e),i.numberOfNextedValues>=this.maxWindowSize&&this.closeWindow(i))}},t.prototype._error=function(e){for(var t=this.windows;t.length>0;)t.shift().error(e);this.destination.error(e)},t.prototype._complete=function(){for(var e=this.windows;e.length>0;){var t=e.shift();t.closed||t.complete()}this.destination.complete()},t.prototype.openWindow=function(){var e=new ei;return this.windows.push(e),this.destination.next(e),e},t.prototype.closeWindow=function(e){e.complete();var t=this.windows;t.splice(t.indexOf(e),1)},t}(m.a);function ni(e){var t=e.subscriber,n=e.windowTimeSpan,r=e.window;r&&t.closeWindow(r),e.window=t.openWindow(),this.schedule(e,n)}function ri(e){var t=e.windowTimeSpan,n=e.subscriber,r=e.scheduler,i=e.windowCreationInterval,a=n.openWindow(),o={action:this,subscription:null},u={subscriber:n,window:a,context:o};o.subscription=r.schedule(ii,t,u),this.add(o.subscription),this.schedule(e,i)}function ii(e){var t=e.subscriber,n=e.window,r=e.context;r&&r.action&&r.subscription&&r.action.remove(r.subscription),t.closeWindow(n)}function ai(e,t){return function(n){return n.lift(new oi(e,t))}}var oi=function(){function e(e,t){this.openings=e,this.closingSelector=t}return e.prototype.call=function(e,t){return t.subscribe(new ui(e,this.openings,this.closingSelector))},e}(),ui=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.openings=n,i.closingSelector=r,i.contexts=[],i.add(i.openSubscription=Object(a.a)(i,n,n)),i}return r.a(t,e),t.prototype._next=function(e){var t=this.contexts;if(t)for(var n=t.length,r=0;r<n;r++)t[r].window.next(e)},t.prototype._error=function(t){var n=this.contexts;if(this.contexts=null,n)for(var r=n.length,i=-1;++i<r;){var a=n[i];a.window.error(t),a.subscription.unsubscribe()}e.prototype._error.call(this,t)},t.prototype._complete=function(){var t=this.contexts;if(this.contexts=null,t)for(var n=t.length,r=-1;++r<n;){var i=t[r];i.window.complete(),i.subscription.unsubscribe()}e.prototype._complete.call(this)},t.prototype._unsubscribe=function(){var e=this.contexts;if(this.contexts=null,e)for(var t=e.length,n=-1;++n<t;){var r=e[n];r.window.unsubscribe(),r.subscription.unsubscribe()}},t.prototype.notifyNext=function(e,t,n,r,i){if(e===this.openings){var o=void 0;try{o=(0,this.closingSelector)(t)}catch(e){return this.error(e)}var u=new ln.a,s=new E.a,c={window:u,subscription:s};this.contexts.push(c);var l=Object(a.a)(this,o,c);l.closed?this.closeWindow(this.contexts.length-1):(l.context=c,s.add(l)),this.destination.next(u)}else this.closeWindow(this.contexts.indexOf(e))},t.prototype.notifyError=function(e){this.error(e)},t.prototype.notifyComplete=function(e){e!==this.openSubscription&&this.closeWindow(this.contexts.indexOf(e.context))},t.prototype.closeWindow=function(e){if(-1!==e){var t=this.contexts,n=t[e],r=n.window,i=n.subscription;t.splice(e,1),r.complete(),i.unsubscribe()}},t}(i.a);function si(e){return function(t){return t.lift(new ci(e))}}var ci=function(){function e(e){this.closingSelector=e}return e.prototype.call=function(e,t){return t.subscribe(new li(e,this.closingSelector))},e}(),li=function(e){function t(t,n){var r=e.call(this,t)||this;return r.destination=t,r.closingSelector=n,r.openWindow(),r}return r.a(t,e),t.prototype.notifyNext=function(e,t,n,r,i){this.openWindow(i)},t.prototype.notifyError=function(e,t){this._error(e)},t.prototype.notifyComplete=function(e){this.openWindow(e)},t.prototype._next=function(e){this.window.next(e)},t.prototype._error=function(e){this.window.error(e),this.destination.error(e),this.unsubscribeClosingNotification()},t.prototype._complete=function(){this.window.complete(),this.destination.complete(),this.unsubscribeClosingNotification()},t.prototype.unsubscribeClosingNotification=function(){this.closingNotification&&this.closingNotification.unsubscribe()},t.prototype.openWindow=function(e){void 0===e&&(e=null),e&&(this.remove(e),e.unsubscribe());var t=this.window;t&&t.complete();var n,r=this.window=new ln.a;this.destination.next(r);try{n=(0,this.closingSelector)()}catch(e){return this.destination.error(e),void this.window.error(e)}this.add(this.closingNotification=Object(a.a)(this,n))},t}(i.a);function fi(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t){var n;"function"==typeof e[e.length-1]&&(n=e.pop());var r=e;return t.lift(new di(r,n))}}var di=function(){function e(e,t){this.observables=e,this.project=t}return e.prototype.call=function(e,t){return t.subscribe(new pi(e,this.observables,this.project))},e}(),pi=function(e){function t(t,n,r){var i=e.call(this,t)||this;i.observables=n,i.project=r,i.toRespond=[];var o=n.length;i.values=new Array(o);for(var u=0;u<o;u++)i.toRespond.push(u);for(u=0;u<o;u++){var s=n[u];i.add(Object(a.a)(i,s,s,u))}return i}return r.a(t,e),t.prototype.notifyNext=function(e,t,n,r,i){this.values[n]=t;var a=this.toRespond;if(a.length>0){var o=a.indexOf(n);-1!==o&&a.splice(o,1)}},t.prototype.notifyComplete=function(){},t.prototype._next=function(e){if(0===this.toRespond.length){var t=[e].concat(this.values);this.project?this._tryProject(t):this.destination.next(t)}},t.prototype._tryProject=function(e){var t;try{t=this.project.apply(this,e)}catch(e){return void this.destination.error(e)}this.destination.next(t)},t}(i.a),hi=n(108);function mi(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t){return t.lift.call(hi.b.apply(void 0,[t].concat(e)))}}function yi(e){return function(t){return t.lift(new hi.a(e))}}n.d(t,"audit",function(){return o}),n.d(t,"auditTime",function(){return f}),n.d(t,"buffer",function(){return d}),n.d(t,"bufferCount",function(){return y}),n.d(t,"bufferTime",function(){return S}),n.d(t,"bufferToggle",function(){return k}),n.d(t,"bufferWhen",function(){return V}),n.d(t,"catchError",function(){return j}),n.d(t,"combineAll",function(){return L}),n.d(t,"combineLatest",function(){return G}),n.d(t,"concat",function(){return H}),n.d(t,"concatAll",function(){return W.a}),n.d(t,"concatMap",function(){return K}),n.d(t,"concatMapTo",function(){return X}),n.d(t,"count",function(){return Q}),n.d(t,"debounce",function(){return $}),n.d(t,"debounceTime",function(){return ne}),n.d(t,"defaultIfEmpty",function(){return oe}),n.d(t,"delay",function(){return fe}),n.d(t,"delayWhen",function(){return ye}),n.d(t,"dematerialize",function(){return Se}),n.d(t,"distinct",function(){return we}),n.d(t,"distinctUntilChanged",function(){return Ae}),n.d(t,"distinctUntilKeyChanged",function(){return Ie}),n.d(t,"elementAt",function(){return Ye}),n.d(t,"endWith",function(){return Qe}),n.d(t,"every",function(){return Ze}),n.d(t,"exhaust",function(){return et}),n.d(t,"exhaustMap",function(){return it}),n.d(t,"expand",function(){return ut}),n.d(t,"filter",function(){return Ve}),n.d(t,"finalize",function(){return lt}),n.d(t,"find",function(){return pt}),n.d(t,"findIndex",function(){return yt}),n.d(t,"first",function(){return bt}),n.d(t,"groupBy",function(){return gt.b}),n.d(t,"ignoreElements",function(){return _t}),n.d(t,"isEmpty",function(){return xt}),n.d(t,"last",function(){return kt}),n.d(t,"map",function(){return rt.a}),n.d(t,"mapTo",function(){return It}),n.d(t,"materialize",function(){return Ot}),n.d(t,"max",function(){return zt}),n.d(t,"merge",function(){return Gt}),n.d(t,"mergeAll",function(){return qt.a}),n.d(t,"mergeMap",function(){return Y.a}),n.d(t,"flatMap",function(){return Y.a}),n.d(t,"mergeMapTo",function(){return Ht}),n.d(t,"mergeScan",function(){return Wt}),n.d(t,"min",function(){return Xt}),n.d(t,"multicast",function(){return Zt}),n.d(t,"observeOn",function(){return $t.b}),n.d(t,"onErrorResumeNext",function(){return en}),n.d(t,"pairwise",function(){return rn}),n.d(t,"partition",function(){return sn}),n.d(t,"pluck",function(){return cn}),n.d(t,"publish",function(){return fn}),n.d(t,"publishBehavior",function(){return pn}),n.d(t,"publishLast",function(){return mn}),n.d(t,"publishReplay",function(){return vn}),n.d(t,"race",function(){return gn}),n.d(t,"reduce",function(){return Lt}),n.d(t,"repeat",function(){return _n}),n.d(t,"repeatWhen",function(){return xn}),n.d(t,"retry",function(){return Tn}),n.d(t,"retryWhen",function(){return kn}),n.d(t,"refCount",function(){return Vn.a}),n.d(t,"sample",function(){return On}),n.d(t,"sampleTime",function(){return jn}),n.d(t,"scan",function(){return jt}),n.d(t,"sequenceEqual",function(){return Ln}),n.d(t,"share",function(){return Hn}),n.d(t,"shareReplay",function(){return Wn}),n.d(t,"single",function(){return Yn}),n.d(t,"skip",function(){return Qn}),n.d(t,"skipLast",function(){return $n}),n.d(t,"skipUntil",function(){return nr}),n.d(t,"skipWhile",function(){return ar}),n.d(t,"startWith",function(){return sr}),n.d(t,"subscribeOn",function(){return dr}),n.d(t,"switchAll",function(){return vr}),n.d(t,"switchMap",function(){return hr}),n.d(t,"switchMapTo",function(){return br}),n.d(t,"take",function(){return qe}),n.d(t,"takeLast",function(){return Tt}),n.d(t,"takeUntil",function(){return gr}),n.d(t,"takeWhile",function(){return Cr}),n.d(t,"tap",function(){return Ne}),n.d(t,"throttle",function(){return Tr}),n.d(t,"throttleTime",function(){return kr}),n.d(t,"throwIfEmpty",function(){return ze}),n.d(t,"timeInterval",function(){return Dr}),n.d(t,"timeout",function(){return zr}),n.d(t,"timeoutWith",function(){return Nr}),n.d(t,"timestamp",function(){return Ur}),n.d(t,"toArray",function(){return Hr}),n.d(t,"window",function(){return Wr}),n.d(t,"windowCount",function(){return Xr}),n.d(t,"windowTime",function(){return Jr}),n.d(t,"windowToggle",function(){return ai}),n.d(t,"windowWhen",function(){return si}),n.d(t,"withLatestFrom",function(){return fi}),n.d(t,"zip",function(){return mi}),n.d(t,"zipAll",function(){return yi})}]);